<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html" class="current">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7000846">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7000901">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7000955">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7001006">package</span>&nbsp;<span class="ident" id="7001014">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7001024">import</span>&nbsp;<span class="op" id="7001031">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7001034">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7001041">&#34;net/http&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7001053">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7001063">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7001066">func</span>&nbsp;<span class="ident" id="7001071">TestRecorder</span><span class="op" id="7001083">(</span><span class="ident" id="7001084">t</span>&nbsp;<span class="op" id="7001086">*</span><span class="ident" id="7001087">testing</span><span class="op" id="7001094">.</span><span class="ident" id="7001095">T</span><span class="op" id="7001096">)</span>&nbsp;<span class="op" id="7001098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001101">type</span>&nbsp;<span class="ident" id="7001106">checkFunc</span>&nbsp;<span class="keyword" id="7001116">func</span><span class="op" id="7001120">(</span><span class="op" id="7001121">*</span><span class="ident" id="7001122">ResponseRecorder</span><span class="op" id="7001138">)</span>&nbsp;<span class="builtintype" id="7001140">error</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001147">check</span>&nbsp;<span class="op" id="7001153">:=</span>&nbsp;<span class="keyword" id="7001156">func</span><span class="op" id="7001160">(</span><span class="ident" id="7001161">fns</span>&nbsp;<span class="op" id="7001165">...</span><span class="ident" id="7001168">checkFunc</span><span class="op" id="7001177">)</span>&nbsp;<span class="op" id="7001179">[</span><span class="op" id="7001180">]</span><span class="ident" id="7001181">checkFunc</span>&nbsp;<span class="op" id="7001191">{</span>&nbsp;<span class="keyword" id="7001193">return</span>&nbsp;<span class="ident" id="7001200">fns</span>&nbsp;<span class="op" id="7001204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001208">hasStatus</span>&nbsp;<span class="op" id="7001218">:=</span>&nbsp;<span class="keyword" id="7001221">func</span><span class="op" id="7001225">(</span><span class="ident" id="7001226">wantCode</span>&nbsp;<span class="builtintype" id="7001235">int</span><span class="op" id="7001238">)</span>&nbsp;<span class="ident" id="7001240">checkFunc</span>&nbsp;<span class="op" id="7001250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001254">return</span>&nbsp;<span class="keyword" id="7001261">func</span><span class="op" id="7001265">(</span><span class="ident" id="7001266">rec</span>&nbsp;<span class="op" id="7001270">*</span><span class="ident" id="7001271">ResponseRecorder</span><span class="op" id="7001287">)</span>&nbsp;<span class="builtintype" id="7001289">error</span>&nbsp;<span class="op" id="7001295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001300">if</span>&nbsp;<span class="ident" id="7001303">rec</span><span class="op" id="7001306">.</span><span class="ident" id="7001307">Code</span>&nbsp;<span class="op" id="7001312">!=</span>&nbsp;<span class="ident" id="7001315">wantCode</span>&nbsp;<span class="op" id="7001324">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001330">return</span>&nbsp;<span class="ident" id="7001337">fmt</span><span class="op" id="7001340">.</span><span class="ident" id="7001341">Errorf</span><span class="op" id="7001347">(</span><span class="string" id="7001348">&#34;Status&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7001370">,</span>&nbsp;<span class="ident" id="7001372">rec</span><span class="op" id="7001375">.</span><span class="ident" id="7001376">Code</span><span class="op" id="7001380">,</span>&nbsp;<span class="ident" id="7001382">wantCode</span><span class="op" id="7001390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001400">return</span>&nbsp;<span class="builtintype" id="7001407">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001416">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001419">hasContents</span>&nbsp;<span class="op" id="7001431">:=</span>&nbsp;<span class="keyword" id="7001434">func</span><span class="op" id="7001438">(</span><span class="ident" id="7001439">want</span>&nbsp;<span class="builtintype" id="7001444">string</span><span class="op" id="7001450">)</span>&nbsp;<span class="ident" id="7001452">checkFunc</span>&nbsp;<span class="op" id="7001462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001466">return</span>&nbsp;<span class="keyword" id="7001473">func</span><span class="op" id="7001477">(</span><span class="ident" id="7001478">rec</span>&nbsp;<span class="op" id="7001482">*</span><span class="ident" id="7001483">ResponseRecorder</span><span class="op" id="7001499">)</span>&nbsp;<span class="builtintype" id="7001501">error</span>&nbsp;<span class="op" id="7001507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001512">if</span>&nbsp;<span class="ident" id="7001515">rec</span><span class="op" id="7001518">.</span><span class="ident" id="7001519">Body</span><span class="op" id="7001523">.</span><span class="ident" id="7001524">String</span><span class="op" id="7001530">(</span><span class="op" id="7001531">)</span>&nbsp;<span class="op" id="7001533">!=</span>&nbsp;<span class="ident" id="7001536">want</span>&nbsp;<span class="op" id="7001541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001547">return</span>&nbsp;<span class="ident" id="7001554">fmt</span><span class="op" id="7001557">.</span><span class="ident" id="7001558">Errorf</span><span class="op" id="7001564">(</span><span class="string" id="7001565">&#34;wrote&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7001586">,</span>&nbsp;<span class="ident" id="7001588">rec</span><span class="op" id="7001591">.</span><span class="ident" id="7001592">Body</span><span class="op" id="7001596">.</span><span class="ident" id="7001597">String</span><span class="op" id="7001603">(</span><span class="op" id="7001604">)</span><span class="op" id="7001605">,</span>&nbsp;<span class="ident" id="7001607">want</span><span class="op" id="7001611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001616">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001621">return</span>&nbsp;<span class="builtintype" id="7001628">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001640">hasFlush</span>&nbsp;<span class="op" id="7001649">:=</span>&nbsp;<span class="keyword" id="7001652">func</span><span class="op" id="7001656">(</span><span class="ident" id="7001657">want</span>&nbsp;<span class="builtintype" id="7001662">bool</span><span class="op" id="7001666">)</span>&nbsp;<span class="ident" id="7001668">checkFunc</span>&nbsp;<span class="op" id="7001678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001682">return</span>&nbsp;<span class="keyword" id="7001689">func</span><span class="op" id="7001693">(</span><span class="ident" id="7001694">rec</span>&nbsp;<span class="op" id="7001698">*</span><span class="ident" id="7001699">ResponseRecorder</span><span class="op" id="7001715">)</span>&nbsp;<span class="builtintype" id="7001717">error</span>&nbsp;<span class="op" id="7001723">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001728">if</span>&nbsp;<span class="ident" id="7001731">rec</span><span class="op" id="7001734">.</span><span class="ident" id="7001735">Flushed</span>&nbsp;<span class="op" id="7001743">!=</span>&nbsp;<span class="ident" id="7001746">want</span>&nbsp;<span class="op" id="7001751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001757">return</span>&nbsp;<span class="ident" id="7001764">fmt</span><span class="op" id="7001767">.</span><span class="ident" id="7001768">Errorf</span><span class="op" id="7001774">(</span><span class="string" id="7001775">&#34;Flushed&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7001798">,</span>&nbsp;<span class="ident" id="7001800">rec</span><span class="op" id="7001803">.</span><span class="ident" id="7001804">Flushed</span><span class="op" id="7001811">,</span>&nbsp;<span class="ident" id="7001813">want</span><span class="op" id="7001817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001827">return</span>&nbsp;<span class="builtintype" id="7001834">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001840">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001847">tests</span>&nbsp;<span class="op" id="7001853">:=</span>&nbsp;<span class="op" id="7001856">[</span><span class="op" id="7001857">]</span><span class="keyword" id="7001858">struct</span>&nbsp;<span class="op" id="7001865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001869">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7001876">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001885">h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001892">func</span><span class="op" id="7001896">(</span><span class="ident" id="7001897">w</span>&nbsp;<span class="ident" id="7001899">http</span><span class="op" id="7001903">.</span><span class="ident" id="7001904">ResponseWriter</span><span class="op" id="7001918">,</span>&nbsp;<span class="ident" id="7001920">r</span>&nbsp;<span class="op" id="7001922">*</span><span class="ident" id="7001923">http</span><span class="op" id="7001927">.</span><span class="ident" id="7001928">Request</span><span class="op" id="7001935">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001939">checks</span>&nbsp;<span class="op" id="7001946">[</span><span class="op" id="7001947">]</span><span class="ident" id="7001948">checkFunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001959">}</span><span class="op" id="7001960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7001969">&#34;200&nbsp;default&#34;</span><span class="op" id="7001982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001987">func</span><span class="op" id="7001991">(</span><span class="ident" id="7001992">w</span>&nbsp;<span class="ident" id="7001994">http</span><span class="op" id="7001998">.</span><span class="ident" id="7001999">ResponseWriter</span><span class="op" id="7002013">,</span>&nbsp;<span class="ident" id="7002015">r</span>&nbsp;<span class="op" id="7002017">*</span><span class="ident" id="7002018">http</span><span class="op" id="7002022">.</span><span class="ident" id="7002023">Request</span><span class="op" id="7002030">)</span>&nbsp;<span class="op" id="7002032">{</span><span class="op" id="7002033">}</span><span class="op" id="7002034">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002039">check</span><span class="op" id="7002044">(</span><span class="ident" id="7002045">hasStatus</span><span class="op" id="7002054">(</span><span class="num" id="7002055">200</span><span class="op" id="7002058">)</span><span class="op" id="7002059">,</span>&nbsp;<span class="ident" id="7002061">hasContents</span><span class="op" id="7002072">(</span><span class="string" id="7002073">&#34;&#34;</span><span class="op" id="7002075">)</span><span class="op" id="7002076">)</span><span class="op" id="7002077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002081">}</span><span class="op" id="7002082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7002091">&#34;first&nbsp;code&nbsp;only&#34;</span><span class="op" id="7002108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002113">func</span><span class="op" id="7002117">(</span><span class="ident" id="7002118">w</span>&nbsp;<span class="ident" id="7002120">http</span><span class="op" id="7002124">.</span><span class="ident" id="7002125">ResponseWriter</span><span class="op" id="7002139">,</span>&nbsp;<span class="ident" id="7002141">r</span>&nbsp;<span class="op" id="7002143">*</span><span class="ident" id="7002144">http</span><span class="op" id="7002148">.</span><span class="ident" id="7002149">Request</span><span class="op" id="7002156">)</span>&nbsp;<span class="op" id="7002158">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002164">w</span><span class="op" id="7002165">.</span><span class="ident" id="7002166">WriteHeader</span><span class="op" id="7002177">(</span><span class="num" id="7002178">201</span><span class="op" id="7002181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002187">w</span><span class="op" id="7002188">.</span><span class="ident" id="7002189">WriteHeader</span><span class="op" id="7002200">(</span><span class="num" id="7002201">202</span><span class="op" id="7002204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002210">w</span><span class="op" id="7002211">.</span><span class="ident" id="7002212">Write</span><span class="op" id="7002217">(</span><span class="op" id="7002218">[</span><span class="op" id="7002219">]</span><span class="builtintype" id="7002220">byte</span><span class="op" id="7002224">(</span><span class="string" id="7002225">&#34;hi&#34;</span><span class="op" id="7002229">)</span><span class="op" id="7002230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002235">}</span><span class="op" id="7002236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002241">check</span><span class="op" id="7002246">(</span><span class="ident" id="7002247">hasStatus</span><span class="op" id="7002256">(</span><span class="num" id="7002257">201</span><span class="op" id="7002260">)</span><span class="op" id="7002261">,</span>&nbsp;<span class="ident" id="7002263">hasContents</span><span class="op" id="7002274">(</span><span class="string" id="7002275">&#34;hi&#34;</span><span class="op" id="7002279">)</span><span class="op" id="7002280">)</span><span class="op" id="7002281">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002285">}</span><span class="op" id="7002286">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7002295">&#34;write&nbsp;sends&nbsp;200&#34;</span><span class="op" id="7002312">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002317">func</span><span class="op" id="7002321">(</span><span class="ident" id="7002322">w</span>&nbsp;<span class="ident" id="7002324">http</span><span class="op" id="7002328">.</span><span class="ident" id="7002329">ResponseWriter</span><span class="op" id="7002343">,</span>&nbsp;<span class="ident" id="7002345">r</span>&nbsp;<span class="op" id="7002347">*</span><span class="ident" id="7002348">http</span><span class="op" id="7002352">.</span><span class="ident" id="7002353">Request</span><span class="op" id="7002360">)</span>&nbsp;<span class="op" id="7002362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002368">w</span><span class="op" id="7002369">.</span><span class="ident" id="7002370">Write</span><span class="op" id="7002375">(</span><span class="op" id="7002376">[</span><span class="op" id="7002377">]</span><span class="builtintype" id="7002378">byte</span><span class="op" id="7002382">(</span><span class="string" id="7002383">&#34;hi&nbsp;first&#34;</span><span class="op" id="7002393">)</span><span class="op" id="7002394">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002400">w</span><span class="op" id="7002401">.</span><span class="ident" id="7002402">WriteHeader</span><span class="op" id="7002413">(</span><span class="num" id="7002414">201</span><span class="op" id="7002417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002423">w</span><span class="op" id="7002424">.</span><span class="ident" id="7002425">WriteHeader</span><span class="op" id="7002436">(</span><span class="num" id="7002437">202</span><span class="op" id="7002440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002445">}</span><span class="op" id="7002446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002451">check</span><span class="op" id="7002456">(</span><span class="ident" id="7002457">hasStatus</span><span class="op" id="7002466">(</span><span class="num" id="7002467">200</span><span class="op" id="7002470">)</span><span class="op" id="7002471">,</span>&nbsp;<span class="ident" id="7002473">hasContents</span><span class="op" id="7002484">(</span><span class="string" id="7002485">&#34;hi&nbsp;first&#34;</span><span class="op" id="7002495">)</span><span class="op" id="7002496">,</span>&nbsp;<span class="ident" id="7002498">hasFlush</span><span class="op" id="7002506">(</span><span class="builtintype" id="7002507">false</span><span class="op" id="7002512">)</span><span class="op" id="7002513">)</span><span class="op" id="7002514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002518">}</span><span class="op" id="7002519">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7002528">&#34;flush&#34;</span><span class="op" id="7002535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002540">func</span><span class="op" id="7002544">(</span><span class="ident" id="7002545">w</span>&nbsp;<span class="ident" id="7002547">http</span><span class="op" id="7002551">.</span><span class="ident" id="7002552">ResponseWriter</span><span class="op" id="7002566">,</span>&nbsp;<span class="ident" id="7002568">r</span>&nbsp;<span class="op" id="7002570">*</span><span class="ident" id="7002571">http</span><span class="op" id="7002575">.</span><span class="ident" id="7002576">Request</span><span class="op" id="7002583">)</span>&nbsp;<span class="op" id="7002585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002591">w</span><span class="op" id="7002592">.</span><span class="op" id="7002593">(</span><span class="ident" id="7002594">http</span><span class="op" id="7002598">.</span><span class="ident" id="7002599">Flusher</span><span class="op" id="7002606">)</span><span class="op" id="7002607">.</span><span class="ident" id="7002608">Flush</span><span class="op" id="7002613">(</span><span class="op" id="7002614">)</span>&nbsp;<span class="comment" id="7002616">//&nbsp;also&nbsp;sends&nbsp;a&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002640">w</span><span class="op" id="7002641">.</span><span class="ident" id="7002642">WriteHeader</span><span class="op" id="7002653">(</span><span class="num" id="7002654">201</span><span class="op" id="7002657">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002662">}</span><span class="op" id="7002663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002668">check</span><span class="op" id="7002673">(</span><span class="ident" id="7002674">hasStatus</span><span class="op" id="7002683">(</span><span class="num" id="7002684">200</span><span class="op" id="7002687">)</span><span class="op" id="7002688">,</span>&nbsp;<span class="ident" id="7002690">hasFlush</span><span class="op" id="7002698">(</span><span class="builtintype" id="7002699">true</span><span class="op" id="7002703">)</span><span class="op" id="7002704">)</span><span class="op" id="7002705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002709">}</span><span class="op" id="7002710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002716">r</span><span class="op" id="7002717">,</span>&nbsp;<span class="ident" id="7002719">_</span>&nbsp;<span class="op" id="7002721">:=</span>&nbsp;<span class="ident" id="7002724">http</span><span class="op" id="7002728">.</span><span class="ident" id="7002729">NewRequest</span><span class="op" id="7002739">(</span><span class="string" id="7002740">&#34;GET&#34;</span><span class="op" id="7002745">,</span>&nbsp;<span class="string" id="7002747">&#34;http://foo.com/&#34;</span><span class="op" id="7002764">,</span>&nbsp;<span class="builtintype" id="7002766">nil</span><span class="op" id="7002769">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002772">for</span>&nbsp;<span class="ident" id="7002776">_</span><span class="op" id="7002777">,</span>&nbsp;<span class="ident" id="7002779">tt</span>&nbsp;<span class="op" id="7002782">:=</span>&nbsp;<span class="keyword" id="7002785">range</span>&nbsp;<span class="ident" id="7002791">tests</span>&nbsp;<span class="op" id="7002797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002801">h</span>&nbsp;<span class="op" id="7002803">:=</span>&nbsp;<span class="ident" id="7002806">http</span><span class="op" id="7002810">.</span><span class="ident" id="7002811">HandlerFunc</span><span class="op" id="7002822">(</span><span class="ident" id="7002823">tt</span><span class="op" id="7002825">.</span><span class="ident" id="7002826">h</span><span class="op" id="7002827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002831">rec</span>&nbsp;<span class="op" id="7002835">:=</span>&nbsp;<span class="ident" id="7002838">NewRecorder</span><span class="op" id="7002849">(</span><span class="op" id="7002850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002854">h</span><span class="op" id="7002855">.</span><span class="ident" id="7002856">ServeHTTP</span><span class="op" id="7002865">(</span><span class="ident" id="7002866">rec</span><span class="op" id="7002869">,</span>&nbsp;<span class="ident" id="7002871">r</span><span class="op" id="7002872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002876">for</span>&nbsp;<span class="ident" id="7002880">_</span><span class="op" id="7002881">,</span>&nbsp;<span class="ident" id="7002883">check</span>&nbsp;<span class="op" id="7002889">:=</span>&nbsp;<span class="keyword" id="7002892">range</span>&nbsp;<span class="ident" id="7002898">tt</span><span class="op" id="7002900">.</span><span class="ident" id="7002901">checks</span>&nbsp;<span class="op" id="7002908">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002913">if</span>&nbsp;<span class="ident" id="7002916">err</span>&nbsp;<span class="op" id="7002920">:=</span>&nbsp;<span class="ident" id="7002923">check</span><span class="op" id="7002928">(</span><span class="ident" id="7002929">rec</span><span class="op" id="7002932">)</span><span class="op" id="7002933">;</span>&nbsp;<span class="ident" id="7002935">err</span>&nbsp;<span class="op" id="7002939">!=</span>&nbsp;<span class="builtintype" id="7002942">nil</span>&nbsp;<span class="op" id="7002946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002952">t</span><span class="op" id="7002953">.</span><span class="ident" id="7002954">Errorf</span><span class="op" id="7002960">(</span><span class="string" id="7002961">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7002969">,</span>&nbsp;<span class="ident" id="7002971">tt</span><span class="op" id="7002973">.</span><span class="ident" id="7002974">name</span><span class="op" id="7002978">,</span>&nbsp;<span class="ident" id="7002980">err</span><span class="op" id="7002983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002995">}</span><br>
<span class="lineno">90</span><span class="op" id="7002997">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
