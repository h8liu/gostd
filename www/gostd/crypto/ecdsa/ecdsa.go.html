<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/ecdsa</h2>
<ul>
<li><a href="/gostd/crypto/ecdsa/ecdsa.go.html" class="current">ecdsa.go</a></li>
<li><a href="/gostd/crypto/ecdsa/ecdsa_test.go.html">ecdsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4096691">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4096746">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4096800">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4096851">//&nbsp;Package&nbsp;ecdsa&nbsp;implements&nbsp;the&nbsp;Elliptic&nbsp;Curve&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4096930">//&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4096956">package</span>&nbsp;<span class="ident" id="4096964">ecdsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4096971">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="4096986">//&nbsp;&nbsp;&nbsp;[NSA]:&nbsp;Suite&nbsp;B&nbsp;implementer&#39;s&nbsp;guide&nbsp;to&nbsp;FIPS&nbsp;186-3,</span><br>
<span class="lineno"></span><span class="comment" id="4097041">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.nsa.gov/ia/_files/ecdsa.pdf</span><br>
<span class="lineno"></span><span class="comment" id="4097087">//&nbsp;&nbsp;&nbsp;[SECG]:&nbsp;SECG,&nbsp;SEC1</span><br>
<span class="lineno"></span><span class="comment" id="4097111">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.secg.org/download/aid-780/sec1-v2.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4097168">import</span>&nbsp;<span class="op" id="4097175">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4097178">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4097188">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4097207">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4097224">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4097230">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4097241">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4097244">//&nbsp;PublicKey&nbsp;represents&nbsp;an&nbsp;ECDSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4097289">type</span>&nbsp;<span class="ident" id="4097294">PublicKey</span>&nbsp;<span class="keyword" id="4097304">struct</span>&nbsp;<span class="op" id="4097311">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4097314">elliptic</span><span class="op" id="4097322">.</span><span class="ident" id="4097323">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4097330">X</span><span class="op" id="4097331">,</span>&nbsp;<span class="ident" id="4097333">Y</span>&nbsp;<span class="op" id="4097335">*</span><span class="ident" id="4097336">big</span><span class="op" id="4097339">.</span><span class="ident" id="4097340">Int</span><br>
<span class="lineno"></span><span class="op" id="4097344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4097347">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;ECDSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">30</span><span class="keyword" id="4097393">type</span>&nbsp;<span class="ident" id="4097398">PrivateKey</span>&nbsp;<span class="keyword" id="4097409">struct</span>&nbsp;<span class="op" id="4097416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4097419">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4097430">D</span>&nbsp;<span class="op" id="4097432">*</span><span class="ident" id="4097433">big</span><span class="op" id="4097436">.</span><span class="ident" id="4097437">Int</span><br>
<span class="lineno"></span><span class="op" id="4097441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="4097444">type</span>&nbsp;<span class="ident" id="4097449">ecdsaSignature</span>&nbsp;<span class="keyword" id="4097464">struct</span>&nbsp;<span class="op" id="4097471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4097474">R</span><span class="op" id="4097475">,</span>&nbsp;<span class="ident" id="4097477">S</span>&nbsp;<span class="op" id="4097479">*</span><span class="ident" id="4097480">big</span><span class="op" id="4097483">.</span><span class="ident" id="4097484">Int</span><br>
<span class="lineno"></span><span class="op" id="4097488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4097491">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno">40</span><span class="keyword" id="4097547">func</span>&nbsp;<span class="op" id="4097552">(</span><span class="ident" id="4097553">priv</span>&nbsp;<span class="op" id="4097558">*</span><span class="ident" id="4097559">PrivateKey</span><span class="op" id="4097569">)</span>&nbsp;<span class="ident" id="4097571">Public</span><span class="op" id="4097577">(</span><span class="op" id="4097578">)</span>&nbsp;<span class="ident" id="4097580">crypto</span><span class="op" id="4097586">.</span><span class="ident" id="4097587">PublicKey</span>&nbsp;<span class="op" id="4097597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4097600">return</span>&nbsp;<span class="op" id="4097607">&amp;</span><span class="ident" id="4097608">priv</span><span class="op" id="4097612">.</span><span class="ident" id="4097613">PublicKey</span><br>
<span class="lineno"></span><span class="op" id="4097623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4097626">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;This&nbsp;method&nbsp;is</span><br>
<span class="lineno">45</span><span class="comment" id="4097700">//&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4097778">//&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign&nbsp;function&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4097855">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4097868">func</span>&nbsp;<span class="op" id="4097873">(</span><span class="ident" id="4097874">priv</span>&nbsp;<span class="op" id="4097879">*</span><span class="ident" id="4097880">PrivateKey</span><span class="op" id="4097890">)</span>&nbsp;<span class="ident" id="4097892">Sign</span><span class="op" id="4097896">(</span><span class="ident" id="4097897">rand</span>&nbsp;<span class="ident" id="4097902">io</span><span class="op" id="4097904">.</span><span class="ident" id="4097905">Reader</span><span class="op" id="4097911">,</span>&nbsp;<span class="ident" id="4097913">msg</span>&nbsp;<span class="op" id="4097917">[</span><span class="op" id="4097918">]</span><span class="builtintype" id="4097919">byte</span><span class="op" id="4097923">,</span>&nbsp;<span class="ident" id="4097925">opts</span>&nbsp;<span class="ident" id="4097930">crypto</span><span class="op" id="4097936">.</span><span class="ident" id="4097937">SignerOpts</span><span class="op" id="4097947">)</span>&nbsp;<span class="op" id="4097949">(</span><span class="op" id="4097950">[</span><span class="op" id="4097951">]</span><span class="builtintype" id="4097952">byte</span><span class="op" id="4097956">,</span>&nbsp;<span class="builtintype" id="4097958">error</span><span class="op" id="4097963">)</span>&nbsp;<span class="op" id="4097965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4097968">r</span><span class="op" id="4097969">,</span>&nbsp;<span class="ident" id="4097971">s</span><span class="op" id="4097972">,</span>&nbsp;<span class="ident" id="4097974">err</span>&nbsp;<span class="op" id="4097978">:=</span>&nbsp;<span class="ident" id="4097981">Sign</span><span class="op" id="4097985">(</span><span class="ident" id="4097986">rand</span><span class="op" id="4097990">,</span>&nbsp;<span class="ident" id="4097992">priv</span><span class="op" id="4097996">,</span>&nbsp;<span class="ident" id="4097998">msg</span><span class="op" id="4098001">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098004">if</span>&nbsp;<span class="ident" id="4098007">err</span>&nbsp;<span class="op" id="4098011">!=</span>&nbsp;<span class="builtintype" id="4098014">nil</span>&nbsp;<span class="op" id="4098018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098022">return</span>&nbsp;<span class="builtintype" id="4098029">nil</span><span class="op" id="4098032">,</span>&nbsp;<span class="ident" id="4098034">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4098039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098043">return</span>&nbsp;<span class="ident" id="4098050">asn1</span><span class="op" id="4098054">.</span><span class="ident" id="4098055">Marshal</span><span class="op" id="4098062">(</span><span class="ident" id="4098063">ecdsaSignature</span><span class="op" id="4098077">{</span><span class="ident" id="4098078">r</span><span class="op" id="4098079">,</span>&nbsp;<span class="ident" id="4098081">s</span><span class="op" id="4098082">}</span><span class="op" id="4098083">)</span><br>
<span class="lineno">55</span><span class="op" id="4098085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4098088">var</span>&nbsp;<span class="ident" id="4098092">one</span>&nbsp;<span class="op" id="4098096">=</span>&nbsp;<span class="builtinfunc" id="4098098">new</span><span class="op" id="4098101">(</span><span class="ident" id="4098102">big</span><span class="op" id="4098105">.</span><span class="ident" id="4098106">Int</span><span class="op" id="4098109">)</span><span class="op" id="4098110">.</span><span class="ident" id="4098111">SetInt64</span><span class="op" id="4098119">(</span><span class="num" id="4098120">1</span><span class="op" id="4098121">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4098124">//&nbsp;randFieldElement&nbsp;returns&nbsp;a&nbsp;random&nbsp;element&nbsp;of&nbsp;the&nbsp;field&nbsp;underlying&nbsp;the&nbsp;given</span><br>
<span class="lineno">60</span><span class="comment" id="4098203">//&nbsp;curve&nbsp;using&nbsp;the&nbsp;procedure&nbsp;given&nbsp;in&nbsp;[NSA]&nbsp;A.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4098254">func</span>&nbsp;<span class="ident" id="4098259">randFieldElement</span><span class="op" id="4098275">(</span><span class="ident" id="4098276">c</span>&nbsp;<span class="ident" id="4098278">elliptic</span><span class="op" id="4098286">.</span><span class="ident" id="4098287">Curve</span><span class="op" id="4098292">,</span>&nbsp;<span class="ident" id="4098294">rand</span>&nbsp;<span class="ident" id="4098299">io</span><span class="op" id="4098301">.</span><span class="ident" id="4098302">Reader</span><span class="op" id="4098308">)</span>&nbsp;<span class="op" id="4098310">(</span><span class="ident" id="4098311">k</span>&nbsp;<span class="op" id="4098313">*</span><span class="ident" id="4098314">big</span><span class="op" id="4098317">.</span><span class="ident" id="4098318">Int</span><span class="op" id="4098321">,</span>&nbsp;<span class="ident" id="4098323">err</span>&nbsp;<span class="builtintype" id="4098327">error</span><span class="op" id="4098332">)</span>&nbsp;<span class="op" id="4098334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098337">params</span>&nbsp;<span class="op" id="4098344">:=</span>&nbsp;<span class="ident" id="4098347">c</span><span class="op" id="4098348">.</span><span class="ident" id="4098349">Params</span><span class="op" id="4098355">(</span><span class="op" id="4098356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098359">b</span>&nbsp;<span class="op" id="4098361">:=</span>&nbsp;<span class="builtinfunc" id="4098364">make</span><span class="op" id="4098368">(</span><span class="op" id="4098369">[</span><span class="op" id="4098370">]</span><span class="builtintype" id="4098371">byte</span><span class="op" id="4098375">,</span>&nbsp;<span class="ident" id="4098377">params</span><span class="op" id="4098383">.</span><span class="ident" id="4098384">BitSize</span><span class="op" id="4098391">/</span><span class="num" id="4098392">8</span><span class="op" id="4098393">+</span><span class="num" id="4098394">8</span><span class="op" id="4098395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098398">_</span><span class="op" id="4098399">,</span>&nbsp;<span class="ident" id="4098401">err</span>&nbsp;<span class="op" id="4098405">=</span>&nbsp;<span class="ident" id="4098407">io</span><span class="op" id="4098409">.</span><span class="ident" id="4098410">ReadFull</span><span class="op" id="4098418">(</span><span class="ident" id="4098419">rand</span><span class="op" id="4098423">,</span>&nbsp;<span class="ident" id="4098425">b</span><span class="op" id="4098426">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098429">if</span>&nbsp;<span class="ident" id="4098432">err</span>&nbsp;<span class="op" id="4098436">!=</span>&nbsp;<span class="builtintype" id="4098439">nil</span>&nbsp;<span class="op" id="4098443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098447">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4098455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098459">k</span>&nbsp;<span class="op" id="4098461">=</span>&nbsp;<span class="builtinfunc" id="4098463">new</span><span class="op" id="4098466">(</span><span class="ident" id="4098467">big</span><span class="op" id="4098470">.</span><span class="ident" id="4098471">Int</span><span class="op" id="4098474">)</span><span class="op" id="4098475">.</span><span class="ident" id="4098476">SetBytes</span><span class="op" id="4098484">(</span><span class="ident" id="4098485">b</span><span class="op" id="4098486">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098489">n</span>&nbsp;<span class="op" id="4098491">:=</span>&nbsp;<span class="builtinfunc" id="4098494">new</span><span class="op" id="4098497">(</span><span class="ident" id="4098498">big</span><span class="op" id="4098501">.</span><span class="ident" id="4098502">Int</span><span class="op" id="4098505">)</span><span class="op" id="4098506">.</span><span class="ident" id="4098507">Sub</span><span class="op" id="4098510">(</span><span class="ident" id="4098511">params</span><span class="op" id="4098517">.</span><span class="ident" id="4098518">N</span><span class="op" id="4098519">,</span>&nbsp;<span class="ident" id="4098521">one</span><span class="op" id="4098524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098527">k</span><span class="op" id="4098528">.</span><span class="ident" id="4098529">Mod</span><span class="op" id="4098532">(</span><span class="ident" id="4098533">k</span><span class="op" id="4098534">,</span>&nbsp;<span class="ident" id="4098536">n</span><span class="op" id="4098537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098540">k</span><span class="op" id="4098541">.</span><span class="ident" id="4098542">Add</span><span class="op" id="4098545">(</span><span class="ident" id="4098546">k</span><span class="op" id="4098547">,</span>&nbsp;<span class="ident" id="4098549">one</span><span class="op" id="4098552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098555">return</span><br>
<span class="lineno"></span><span class="op" id="4098562">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4098565">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&nbsp;and&nbsp;private&nbsp;key&nbsp;pair.</span><br>
<span class="lineno"></span><span class="keyword" id="4098621">func</span>&nbsp;<span class="ident" id="4098626">GenerateKey</span><span class="op" id="4098637">(</span><span class="ident" id="4098638">c</span>&nbsp;<span class="ident" id="4098640">elliptic</span><span class="op" id="4098648">.</span><span class="ident" id="4098649">Curve</span><span class="op" id="4098654">,</span>&nbsp;<span class="ident" id="4098656">rand</span>&nbsp;<span class="ident" id="4098661">io</span><span class="op" id="4098663">.</span><span class="ident" id="4098664">Reader</span><span class="op" id="4098670">)</span>&nbsp;<span class="op" id="4098672">(</span><span class="ident" id="4098673">priv</span>&nbsp;<span class="op" id="4098678">*</span><span class="ident" id="4098679">PrivateKey</span><span class="op" id="4098689">,</span>&nbsp;<span class="ident" id="4098691">err</span>&nbsp;<span class="builtintype" id="4098695">error</span><span class="op" id="4098700">)</span>&nbsp;<span class="op" id="4098702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098705">k</span><span class="op" id="4098706">,</span>&nbsp;<span class="ident" id="4098708">err</span>&nbsp;<span class="op" id="4098712">:=</span>&nbsp;<span class="ident" id="4098715">randFieldElement</span><span class="op" id="4098731">(</span><span class="ident" id="4098732">c</span><span class="op" id="4098733">,</span>&nbsp;<span class="ident" id="4098735">rand</span><span class="op" id="4098739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098742">if</span>&nbsp;<span class="ident" id="4098745">err</span>&nbsp;<span class="op" id="4098749">!=</span>&nbsp;<span class="builtintype" id="4098752">nil</span>&nbsp;<span class="op" id="4098756">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098760">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4098768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098772">priv</span>&nbsp;<span class="op" id="4098777">=</span>&nbsp;<span class="builtinfunc" id="4098779">new</span><span class="op" id="4098782">(</span><span class="ident" id="4098783">PrivateKey</span><span class="op" id="4098793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098796">priv</span><span class="op" id="4098800">.</span><span class="ident" id="4098801">PublicKey</span><span class="op" id="4098810">.</span><span class="ident" id="4098811">Curve</span>&nbsp;<span class="op" id="4098817">=</span>&nbsp;<span class="ident" id="4098819">c</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098822">priv</span><span class="op" id="4098826">.</span><span class="ident" id="4098827">D</span>&nbsp;<span class="op" id="4098829">=</span>&nbsp;<span class="ident" id="4098831">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098834">priv</span><span class="op" id="4098838">.</span><span class="ident" id="4098839">PublicKey</span><span class="op" id="4098848">.</span><span class="ident" id="4098849">X</span><span class="op" id="4098850">,</span>&nbsp;<span class="ident" id="4098852">priv</span><span class="op" id="4098856">.</span><span class="ident" id="4098857">PublicKey</span><span class="op" id="4098866">.</span><span class="ident" id="4098867">Y</span>&nbsp;<span class="op" id="4098869">=</span>&nbsp;<span class="ident" id="4098871">c</span><span class="op" id="4098872">.</span><span class="ident" id="4098873">ScalarBaseMult</span><span class="op" id="4098887">(</span><span class="ident" id="4098888">k</span><span class="op" id="4098889">.</span><span class="ident" id="4098890">Bytes</span><span class="op" id="4098895">(</span><span class="op" id="4098896">)</span><span class="op" id="4098897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098900">return</span><br>
<span class="lineno"></span><span class="op" id="4098907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4098910">//&nbsp;hashToInt&nbsp;converts&nbsp;a&nbsp;hash&nbsp;value&nbsp;to&nbsp;an&nbsp;integer.&nbsp;There&nbsp;is&nbsp;some&nbsp;disagreement</span><br>
<span class="lineno"></span><span class="comment" id="4098987">//&nbsp;about&nbsp;how&nbsp;this&nbsp;is&nbsp;done.&nbsp;[NSA]&nbsp;suggests&nbsp;that&nbsp;this&nbsp;is&nbsp;done&nbsp;in&nbsp;the&nbsp;obvious</span><br>
<span class="lineno"></span><span class="comment" id="4099062">//&nbsp;manner,&nbsp;but&nbsp;[SECG]&nbsp;truncates&nbsp;the&nbsp;hash&nbsp;to&nbsp;the&nbsp;bit-length&nbsp;of&nbsp;the&nbsp;curve&nbsp;order</span><br>
<span class="lineno"></span><span class="comment" id="4099140">//&nbsp;first.&nbsp;We&nbsp;follow&nbsp;[SECG]&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;OpenSSL&nbsp;does.&nbsp;Additionally,</span><br>
<span class="lineno"></span><span class="comment" id="4099215">//&nbsp;OpenSSL&nbsp;right&nbsp;shifts&nbsp;excess&nbsp;bits&nbsp;from&nbsp;the&nbsp;number&nbsp;if&nbsp;the&nbsp;hash&nbsp;is&nbsp;too&nbsp;large</span><br>
<span class="lineno">95</span><span class="comment" id="4099292">//&nbsp;and&nbsp;we&nbsp;mirror&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span><span class="keyword" id="4099319">func</span>&nbsp;<span class="ident" id="4099324">hashToInt</span><span class="op" id="4099333">(</span><span class="ident" id="4099334">hash</span>&nbsp;<span class="op" id="4099339">[</span><span class="op" id="4099340">]</span><span class="builtintype" id="4099341">byte</span><span class="op" id="4099345">,</span>&nbsp;<span class="ident" id="4099347">c</span>&nbsp;<span class="ident" id="4099349">elliptic</span><span class="op" id="4099357">.</span><span class="ident" id="4099358">Curve</span><span class="op" id="4099363">)</span>&nbsp;<span class="op" id="4099365">*</span><span class="ident" id="4099366">big</span><span class="op" id="4099369">.</span><span class="ident" id="4099370">Int</span>&nbsp;<span class="op" id="4099374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099377">orderBits</span>&nbsp;<span class="op" id="4099387">:=</span>&nbsp;<span class="ident" id="4099390">c</span><span class="op" id="4099391">.</span><span class="ident" id="4099392">Params</span><span class="op" id="4099398">(</span><span class="op" id="4099399">)</span><span class="op" id="4099400">.</span><span class="ident" id="4099401">N</span><span class="op" id="4099402">.</span><span class="ident" id="4099403">BitLen</span><span class="op" id="4099409">(</span><span class="op" id="4099410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099413">orderBytes</span>&nbsp;<span class="op" id="4099424">:=</span>&nbsp;<span class="op" id="4099427">(</span><span class="ident" id="4099428">orderBits</span>&nbsp;<span class="op" id="4099438">+</span>&nbsp;<span class="num" id="4099440">7</span><span class="op" id="4099441">)</span>&nbsp;<span class="op" id="4099443">/</span>&nbsp;<span class="num" id="4099445">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4099448">if</span>&nbsp;<span class="builtinfunc" id="4099451">len</span><span class="op" id="4099454">(</span><span class="ident" id="4099455">hash</span><span class="op" id="4099459">)</span>&nbsp;<span class="op" id="4099461">&gt;</span>&nbsp;<span class="ident" id="4099463">orderBytes</span>&nbsp;<span class="op" id="4099474">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099478">hash</span>&nbsp;<span class="op" id="4099483">=</span>&nbsp;<span class="ident" id="4099485">hash</span><span class="op" id="4099489">[</span><span class="op" id="4099490">:</span><span class="ident" id="4099491">orderBytes</span><span class="op" id="4099501">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4099504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099508">ret</span>&nbsp;<span class="op" id="4099512">:=</span>&nbsp;<span class="builtinfunc" id="4099515">new</span><span class="op" id="4099518">(</span><span class="ident" id="4099519">big</span><span class="op" id="4099522">.</span><span class="ident" id="4099523">Int</span><span class="op" id="4099526">)</span><span class="op" id="4099527">.</span><span class="ident" id="4099528">SetBytes</span><span class="op" id="4099536">(</span><span class="ident" id="4099537">hash</span><span class="op" id="4099541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099544">excess</span>&nbsp;<span class="op" id="4099551">:=</span>&nbsp;<span class="builtinfunc" id="4099554">len</span><span class="op" id="4099557">(</span><span class="ident" id="4099558">hash</span><span class="op" id="4099562">)</span><span class="op" id="4099563">*</span><span class="num" id="4099564">8</span>&nbsp;<span class="op" id="4099566">-</span>&nbsp;<span class="ident" id="4099568">orderBits</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4099579">if</span>&nbsp;<span class="ident" id="4099582">excess</span>&nbsp;<span class="op" id="4099589">&gt;</span>&nbsp;<span class="num" id="4099591">0</span>&nbsp;<span class="op" id="4099593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099597">ret</span><span class="op" id="4099600">.</span><span class="ident" id="4099601">Rsh</span><span class="op" id="4099604">(</span><span class="ident" id="4099605">ret</span><span class="op" id="4099608">,</span>&nbsp;<span class="builtintype" id="4099610">uint</span><span class="op" id="4099614">(</span><span class="ident" id="4099615">excess</span><span class="op" id="4099621">)</span><span class="op" id="4099622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4099625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4099628">return</span>&nbsp;<span class="ident" id="4099635">ret</span><br>
<span class="lineno"></span><span class="op" id="4099639">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4099642">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4099719">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4099797">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4099868">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">115</span><span class="keyword" id="4099906">func</span>&nbsp;<span class="ident" id="4099911">fermatInverse</span><span class="op" id="4099924">(</span><span class="ident" id="4099925">k</span><span class="op" id="4099926">,</span>&nbsp;<span class="ident" id="4099928">N</span>&nbsp;<span class="op" id="4099930">*</span><span class="ident" id="4099931">big</span><span class="op" id="4099934">.</span><span class="ident" id="4099935">Int</span><span class="op" id="4099938">)</span>&nbsp;<span class="op" id="4099940">*</span><span class="ident" id="4099941">big</span><span class="op" id="4099944">.</span><span class="ident" id="4099945">Int</span>&nbsp;<span class="op" id="4099949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099952">two</span>&nbsp;<span class="op" id="4099956">:=</span>&nbsp;<span class="ident" id="4099959">big</span><span class="op" id="4099962">.</span><span class="ident" id="4099963">NewInt</span><span class="op" id="4099969">(</span><span class="num" id="4099970">2</span><span class="op" id="4099971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099974">nMinus2</span>&nbsp;<span class="op" id="4099982">:=</span>&nbsp;<span class="builtinfunc" id="4099985">new</span><span class="op" id="4099988">(</span><span class="ident" id="4099989">big</span><span class="op" id="4099992">.</span><span class="ident" id="4099993">Int</span><span class="op" id="4099996">)</span><span class="op" id="4099997">.</span><span class="ident" id="4099998">Sub</span><span class="op" id="4100001">(</span><span class="ident" id="4100002">N</span><span class="op" id="4100003">,</span>&nbsp;<span class="ident" id="4100005">two</span><span class="op" id="4100008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100011">return</span>&nbsp;<span class="builtinfunc" id="4100018">new</span><span class="op" id="4100021">(</span><span class="ident" id="4100022">big</span><span class="op" id="4100025">.</span><span class="ident" id="4100026">Int</span><span class="op" id="4100029">)</span><span class="op" id="4100030">.</span><span class="ident" id="4100031">Exp</span><span class="op" id="4100034">(</span><span class="ident" id="4100035">k</span><span class="op" id="4100036">,</span>&nbsp;<span class="ident" id="4100038">nMinus2</span><span class="op" id="4100045">,</span>&nbsp;<span class="ident" id="4100047">N</span><span class="op" id="4100048">)</span><br>
<span class="lineno"></span><span class="op" id="4100050">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4100053">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4100133">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4100211">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4100290">//&nbsp;rand.</span><br>
<span class="lineno">125</span><span class="keyword" id="4100299">func</span>&nbsp;<span class="ident" id="4100304">Sign</span><span class="op" id="4100308">(</span><span class="ident" id="4100309">rand</span>&nbsp;<span class="ident" id="4100314">io</span><span class="op" id="4100316">.</span><span class="ident" id="4100317">Reader</span><span class="op" id="4100323">,</span>&nbsp;<span class="ident" id="4100325">priv</span>&nbsp;<span class="op" id="4100330">*</span><span class="ident" id="4100331">PrivateKey</span><span class="op" id="4100341">,</span>&nbsp;<span class="ident" id="4100343">hash</span>&nbsp;<span class="op" id="4100348">[</span><span class="op" id="4100349">]</span><span class="builtintype" id="4100350">byte</span><span class="op" id="4100354">)</span>&nbsp;<span class="op" id="4100356">(</span><span class="ident" id="4100357">r</span><span class="op" id="4100358">,</span>&nbsp;<span class="ident" id="4100360">s</span>&nbsp;<span class="op" id="4100362">*</span><span class="ident" id="4100363">big</span><span class="op" id="4100366">.</span><span class="ident" id="4100367">Int</span><span class="op" id="4100370">,</span>&nbsp;<span class="ident" id="4100372">err</span>&nbsp;<span class="builtintype" id="4100376">error</span><span class="op" id="4100381">)</span>&nbsp;<span class="op" id="4100383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100386">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100406">c</span>&nbsp;<span class="op" id="4100408">:=</span>&nbsp;<span class="ident" id="4100411">priv</span><span class="op" id="4100415">.</span><span class="ident" id="4100416">PublicKey</span><span class="op" id="4100425">.</span><span class="ident" id="4100426">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100433">N</span>&nbsp;<span class="op" id="4100435">:=</span>&nbsp;<span class="ident" id="4100438">c</span><span class="op" id="4100439">.</span><span class="ident" id="4100440">Params</span><span class="op" id="4100446">(</span><span class="op" id="4100447">)</span><span class="op" id="4100448">.</span><span class="ident" id="4100449">N</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100453">var</span>&nbsp;<span class="ident" id="4100457">k</span><span class="op" id="4100458">,</span>&nbsp;<span class="ident" id="4100460">kInv</span>&nbsp;<span class="op" id="4100465">*</span><span class="ident" id="4100466">big</span><span class="op" id="4100469">.</span><span class="ident" id="4100470">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100475">for</span>&nbsp;<span class="op" id="4100479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100483">for</span>&nbsp;<span class="op" id="4100487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100492">k</span><span class="op" id="4100493">,</span>&nbsp;<span class="ident" id="4100495">err</span>&nbsp;<span class="op" id="4100499">=</span>&nbsp;<span class="ident" id="4100501">randFieldElement</span><span class="op" id="4100517">(</span><span class="ident" id="4100518">c</span><span class="op" id="4100519">,</span>&nbsp;<span class="ident" id="4100521">rand</span><span class="op" id="4100525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100530">if</span>&nbsp;<span class="ident" id="4100533">err</span>&nbsp;<span class="op" id="4100537">!=</span>&nbsp;<span class="builtintype" id="4100540">nil</span>&nbsp;<span class="op" id="4100544">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100550">r</span>&nbsp;<span class="op" id="4100552">=</span>&nbsp;<span class="builtintype" id="4100554">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100562">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4100572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100578">kInv</span>&nbsp;<span class="op" id="4100583">=</span>&nbsp;<span class="ident" id="4100585">fermatInverse</span><span class="op" id="4100598">(</span><span class="ident" id="4100599">k</span><span class="op" id="4100600">,</span>&nbsp;<span class="ident" id="4100602">N</span><span class="op" id="4100603">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100608">r</span><span class="op" id="4100609">,</span>&nbsp;<span class="ident" id="4100611">_</span>&nbsp;<span class="op" id="4100613">=</span>&nbsp;<span class="ident" id="4100615">priv</span><span class="op" id="4100619">.</span><span class="ident" id="4100620">Curve</span><span class="op" id="4100625">.</span><span class="ident" id="4100626">ScalarBaseMult</span><span class="op" id="4100640">(</span><span class="ident" id="4100641">k</span><span class="op" id="4100642">.</span><span class="ident" id="4100643">Bytes</span><span class="op" id="4100648">(</span><span class="op" id="4100649">)</span><span class="op" id="4100650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100655">r</span><span class="op" id="4100656">.</span><span class="ident" id="4100657">Mod</span><span class="op" id="4100660">(</span><span class="ident" id="4100661">r</span><span class="op" id="4100662">,</span>&nbsp;<span class="ident" id="4100664">N</span><span class="op" id="4100665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100670">if</span>&nbsp;<span class="ident" id="4100673">r</span><span class="op" id="4100674">.</span><span class="ident" id="4100675">Sign</span><span class="op" id="4100679">(</span><span class="op" id="4100680">)</span>&nbsp;<span class="op" id="4100682">!=</span>&nbsp;<span class="num" id="4100685">0</span>&nbsp;<span class="op" id="4100687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100693">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4100702">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4100706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100711">e</span>&nbsp;<span class="op" id="4100713">:=</span>&nbsp;<span class="ident" id="4100716">hashToInt</span><span class="op" id="4100725">(</span><span class="ident" id="4100726">hash</span><span class="op" id="4100730">,</span>&nbsp;<span class="ident" id="4100732">c</span><span class="op" id="4100733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100737">s</span>&nbsp;<span class="op" id="4100739">=</span>&nbsp;<span class="builtinfunc" id="4100741">new</span><span class="op" id="4100744">(</span><span class="ident" id="4100745">big</span><span class="op" id="4100748">.</span><span class="ident" id="4100749">Int</span><span class="op" id="4100752">)</span><span class="op" id="4100753">.</span><span class="ident" id="4100754">Mul</span><span class="op" id="4100757">(</span><span class="ident" id="4100758">priv</span><span class="op" id="4100762">.</span><span class="ident" id="4100763">D</span><span class="op" id="4100764">,</span>&nbsp;<span class="ident" id="4100766">r</span><span class="op" id="4100767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100771">s</span><span class="op" id="4100772">.</span><span class="ident" id="4100773">Add</span><span class="op" id="4100776">(</span><span class="ident" id="4100777">s</span><span class="op" id="4100778">,</span>&nbsp;<span class="ident" id="4100780">e</span><span class="op" id="4100781">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100785">s</span><span class="op" id="4100786">.</span><span class="ident" id="4100787">Mul</span><span class="op" id="4100790">(</span><span class="ident" id="4100791">s</span><span class="op" id="4100792">,</span>&nbsp;<span class="ident" id="4100794">kInv</span><span class="op" id="4100798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100802">s</span><span class="op" id="4100803">.</span><span class="ident" id="4100804">Mod</span><span class="op" id="4100807">(</span><span class="ident" id="4100808">s</span><span class="op" id="4100809">,</span>&nbsp;<span class="ident" id="4100811">N</span><span class="op" id="4100812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100816">if</span>&nbsp;<span class="ident" id="4100819">s</span><span class="op" id="4100820">.</span><span class="ident" id="4100821">Sign</span><span class="op" id="4100825">(</span><span class="op" id="4100826">)</span>&nbsp;<span class="op" id="4100828">!=</span>&nbsp;<span class="num" id="4100831">0</span>&nbsp;<span class="op" id="4100833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100838">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4100846">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4100849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100853">return</span><br>
<span class="lineno"></span><span class="op" id="4100860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4100863">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;Its</span><br>
<span class="lineno"></span><span class="comment" id="4100943">//&nbsp;return&nbsp;value&nbsp;records&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4100999">func</span>&nbsp;<span class="ident" id="4101004">Verify</span><span class="op" id="4101010">(</span><span class="ident" id="4101011">pub</span>&nbsp;<span class="op" id="4101015">*</span><span class="ident" id="4101016">PublicKey</span><span class="op" id="4101025">,</span>&nbsp;<span class="ident" id="4101027">hash</span>&nbsp;<span class="op" id="4101032">[</span><span class="op" id="4101033">]</span><span class="builtintype" id="4101034">byte</span><span class="op" id="4101038">,</span>&nbsp;<span class="ident" id="4101040">r</span><span class="op" id="4101041">,</span>&nbsp;<span class="ident" id="4101043">s</span>&nbsp;<span class="op" id="4101045">*</span><span class="ident" id="4101046">big</span><span class="op" id="4101049">.</span><span class="ident" id="4101050">Int</span><span class="op" id="4101053">)</span>&nbsp;<span class="builtintype" id="4101055">bool</span>&nbsp;<span class="op" id="4101060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101063">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101083">c</span>&nbsp;<span class="op" id="4101085">:=</span>&nbsp;<span class="ident" id="4101088">pub</span><span class="op" id="4101091">.</span><span class="ident" id="4101092">Curve</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101099">N</span>&nbsp;<span class="op" id="4101101">:=</span>&nbsp;<span class="ident" id="4101104">c</span><span class="op" id="4101105">.</span><span class="ident" id="4101106">Params</span><span class="op" id="4101112">(</span><span class="op" id="4101113">)</span><span class="op" id="4101114">.</span><span class="ident" id="4101115">N</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101119">if</span>&nbsp;<span class="ident" id="4101122">r</span><span class="op" id="4101123">.</span><span class="ident" id="4101124">Sign</span><span class="op" id="4101128">(</span><span class="op" id="4101129">)</span>&nbsp;<span class="op" id="4101131">==</span>&nbsp;<span class="num" id="4101134">0</span>&nbsp;<span class="op" id="4101136">||</span>&nbsp;<span class="ident" id="4101139">s</span><span class="op" id="4101140">.</span><span class="ident" id="4101141">Sign</span><span class="op" id="4101145">(</span><span class="op" id="4101146">)</span>&nbsp;<span class="op" id="4101148">==</span>&nbsp;<span class="num" id="4101151">0</span>&nbsp;<span class="op" id="4101153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101157">return</span>&nbsp;<span class="builtintype" id="4101164">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4101171">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101174">if</span>&nbsp;<span class="ident" id="4101177">r</span><span class="op" id="4101178">.</span><span class="ident" id="4101179">Cmp</span><span class="op" id="4101182">(</span><span class="ident" id="4101183">N</span><span class="op" id="4101184">)</span>&nbsp;<span class="op" id="4101186">&gt;=</span>&nbsp;<span class="num" id="4101189">0</span>&nbsp;<span class="op" id="4101191">||</span>&nbsp;<span class="ident" id="4101194">s</span><span class="op" id="4101195">.</span><span class="ident" id="4101196">Cmp</span><span class="op" id="4101199">(</span><span class="ident" id="4101200">N</span><span class="op" id="4101201">)</span>&nbsp;<span class="op" id="4101203">&gt;=</span>&nbsp;<span class="num" id="4101206">0</span>&nbsp;<span class="op" id="4101208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101212">return</span>&nbsp;<span class="builtintype" id="4101219">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4101226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101229">e</span>&nbsp;<span class="op" id="4101231">:=</span>&nbsp;<span class="ident" id="4101234">hashToInt</span><span class="op" id="4101243">(</span><span class="ident" id="4101244">hash</span><span class="op" id="4101248">,</span>&nbsp;<span class="ident" id="4101250">c</span><span class="op" id="4101251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101254">w</span>&nbsp;<span class="op" id="4101256">:=</span>&nbsp;<span class="builtinfunc" id="4101259">new</span><span class="op" id="4101262">(</span><span class="ident" id="4101263">big</span><span class="op" id="4101266">.</span><span class="ident" id="4101267">Int</span><span class="op" id="4101270">)</span><span class="op" id="4101271">.</span><span class="ident" id="4101272">ModInverse</span><span class="op" id="4101282">(</span><span class="ident" id="4101283">s</span><span class="op" id="4101284">,</span>&nbsp;<span class="ident" id="4101286">N</span><span class="op" id="4101287">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101291">u1</span>&nbsp;<span class="op" id="4101294">:=</span>&nbsp;<span class="ident" id="4101297">e</span><span class="op" id="4101298">.</span><span class="ident" id="4101299">Mul</span><span class="op" id="4101302">(</span><span class="ident" id="4101303">e</span><span class="op" id="4101304">,</span>&nbsp;<span class="ident" id="4101306">w</span><span class="op" id="4101307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101310">u1</span><span class="op" id="4101312">.</span><span class="ident" id="4101313">Mod</span><span class="op" id="4101316">(</span><span class="ident" id="4101317">u1</span><span class="op" id="4101319">,</span>&nbsp;<span class="ident" id="4101321">N</span><span class="op" id="4101322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101325">u2</span>&nbsp;<span class="op" id="4101328">:=</span>&nbsp;<span class="ident" id="4101331">w</span><span class="op" id="4101332">.</span><span class="ident" id="4101333">Mul</span><span class="op" id="4101336">(</span><span class="ident" id="4101337">r</span><span class="op" id="4101338">,</span>&nbsp;<span class="ident" id="4101340">w</span><span class="op" id="4101341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101344">u2</span><span class="op" id="4101346">.</span><span class="ident" id="4101347">Mod</span><span class="op" id="4101350">(</span><span class="ident" id="4101351">u2</span><span class="op" id="4101353">,</span>&nbsp;<span class="ident" id="4101355">N</span><span class="op" id="4101356">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101360">x1</span><span class="op" id="4101362">,</span>&nbsp;<span class="ident" id="4101364">y1</span>&nbsp;<span class="op" id="4101367">:=</span>&nbsp;<span class="ident" id="4101370">c</span><span class="op" id="4101371">.</span><span class="ident" id="4101372">ScalarBaseMult</span><span class="op" id="4101386">(</span><span class="ident" id="4101387">u1</span><span class="op" id="4101389">.</span><span class="ident" id="4101390">Bytes</span><span class="op" id="4101395">(</span><span class="op" id="4101396">)</span><span class="op" id="4101397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101400">x2</span><span class="op" id="4101402">,</span>&nbsp;<span class="ident" id="4101404">y2</span>&nbsp;<span class="op" id="4101407">:=</span>&nbsp;<span class="ident" id="4101410">c</span><span class="op" id="4101411">.</span><span class="ident" id="4101412">ScalarMult</span><span class="op" id="4101422">(</span><span class="ident" id="4101423">pub</span><span class="op" id="4101426">.</span><span class="ident" id="4101427">X</span><span class="op" id="4101428">,</span>&nbsp;<span class="ident" id="4101430">pub</span><span class="op" id="4101433">.</span><span class="ident" id="4101434">Y</span><span class="op" id="4101435">,</span>&nbsp;<span class="ident" id="4101437">u2</span><span class="op" id="4101439">.</span><span class="ident" id="4101440">Bytes</span><span class="op" id="4101445">(</span><span class="op" id="4101446">)</span><span class="op" id="4101447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101450">x</span><span class="op" id="4101451">,</span>&nbsp;<span class="ident" id="4101453">y</span>&nbsp;<span class="op" id="4101455">:=</span>&nbsp;<span class="ident" id="4101458">c</span><span class="op" id="4101459">.</span><span class="ident" id="4101460">Add</span><span class="op" id="4101463">(</span><span class="ident" id="4101464">x1</span><span class="op" id="4101466">,</span>&nbsp;<span class="ident" id="4101468">y1</span><span class="op" id="4101470">,</span>&nbsp;<span class="ident" id="4101472">x2</span><span class="op" id="4101474">,</span>&nbsp;<span class="ident" id="4101476">y2</span><span class="op" id="4101478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101481">if</span>&nbsp;<span class="ident" id="4101484">x</span><span class="op" id="4101485">.</span><span class="ident" id="4101486">Sign</span><span class="op" id="4101490">(</span><span class="op" id="4101491">)</span>&nbsp;<span class="op" id="4101493">==</span>&nbsp;<span class="num" id="4101496">0</span>&nbsp;<span class="op" id="4101498">&amp;&amp;</span>&nbsp;<span class="ident" id="4101501">y</span><span class="op" id="4101502">.</span><span class="ident" id="4101503">Sign</span><span class="op" id="4101507">(</span><span class="op" id="4101508">)</span>&nbsp;<span class="op" id="4101510">==</span>&nbsp;<span class="num" id="4101513">0</span>&nbsp;<span class="op" id="4101515">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101519">return</span>&nbsp;<span class="builtintype" id="4101526">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4101533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101536">x</span><span class="op" id="4101537">.</span><span class="ident" id="4101538">Mod</span><span class="op" id="4101541">(</span><span class="ident" id="4101542">x</span><span class="op" id="4101543">,</span>&nbsp;<span class="ident" id="4101545">N</span><span class="op" id="4101546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101549">return</span>&nbsp;<span class="ident" id="4101556">x</span><span class="op" id="4101557">.</span><span class="ident" id="4101558">Cmp</span><span class="op" id="4101561">(</span><span class="ident" id="4101562">r</span><span class="op" id="4101563">)</span>&nbsp;<span class="op" id="4101565">==</span>&nbsp;<span class="num" id="4101568">0</span><br>
<span class="lineno"></span><span class="op" id="4101570">}</span>
</div>
</body>
</html>
