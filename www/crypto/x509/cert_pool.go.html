<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4059148">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4059203">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4059257">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4059308">package</span>&nbsp;<span class="ident" id="4059316">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4059322">import</span>&nbsp;<span class="op" id="4059329">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4059332">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span><span class="op" id="4059347">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4059350">//&nbsp;CertPool&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="4059388">type</span>&nbsp;<span class="ident" id="4059393">CertPool</span>&nbsp;<span class="keyword" id="4059402">struct</span>&nbsp;<span class="op" id="4059409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059412">bySubjectKeyId</span>&nbsp;<span class="keyword" id="4059427">map</span><span class="op" id="4059430">[</span><span class="builtintype" id="4059431">string</span><span class="op" id="4059437">]</span><span class="op" id="4059438">[</span><span class="op" id="4059439">]</span><span class="builtintype" id="4059440">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059445">byName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4059460">map</span><span class="op" id="4059463">[</span><span class="builtintype" id="4059464">string</span><span class="op" id="4059470">]</span><span class="op" id="4059471">[</span><span class="op" id="4059472">]</span><span class="builtintype" id="4059473">int</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059478">certs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4059493">[</span><span class="op" id="4059494">]</span><span class="op" id="4059495">*</span><span class="ident" id="4059496">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4059508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4059511">//&nbsp;NewCertPool&nbsp;returns&nbsp;a&nbsp;new,&nbsp;empty&nbsp;CertPool.</span><br>
<span class="lineno"></span><span class="keyword" id="4059557">func</span>&nbsp;<span class="ident" id="4059562">NewCertPool</span><span class="op" id="4059573">(</span><span class="op" id="4059574">)</span>&nbsp;<span class="op" id="4059576">*</span><span class="ident" id="4059577">CertPool</span>&nbsp;<span class="op" id="4059586">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4059589">return</span>&nbsp;<span class="op" id="4059596">&amp;</span><span class="ident" id="4059597">CertPool</span><span class="op" id="4059605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4059609">make</span><span class="op" id="4059613">(</span><span class="keyword" id="4059614">map</span><span class="op" id="4059617">[</span><span class="builtintype" id="4059618">string</span><span class="op" id="4059624">]</span><span class="op" id="4059625">[</span><span class="op" id="4059626">]</span><span class="builtintype" id="4059627">int</span><span class="op" id="4059630">)</span><span class="op" id="4059631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4059635">make</span><span class="op" id="4059639">(</span><span class="keyword" id="4059640">map</span><span class="op" id="4059643">[</span><span class="builtintype" id="4059644">string</span><span class="op" id="4059650">]</span><span class="op" id="4059651">[</span><span class="op" id="4059652">]</span><span class="builtintype" id="4059653">int</span><span class="op" id="4059656">)</span><span class="op" id="4059657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059661">nil</span><span class="op" id="4059664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4059667">}</span><br>
<span class="lineno">25</span><span class="op" id="4059669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4059672">//&nbsp;findVerifiedParents&nbsp;attempts&nbsp;to&nbsp;find&nbsp;certificates&nbsp;in&nbsp;s&nbsp;which&nbsp;have&nbsp;signed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4059752">//&nbsp;given&nbsp;certificate.&nbsp;If&nbsp;any&nbsp;candidates&nbsp;were&nbsp;rejected&nbsp;then&nbsp;errCert&nbsp;will&nbsp;be&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4059831">//&nbsp;to&nbsp;one&nbsp;of&nbsp;them,&nbsp;arbitrarily,&nbsp;and&nbsp;err&nbsp;will&nbsp;contain&nbsp;the&nbsp;reason&nbsp;that&nbsp;it&nbsp;was</span><br>
<span class="lineno">30</span><span class="comment" id="4059907">//&nbsp;rejected.</span><br>
<span class="lineno"></span><span class="keyword" id="4059920">func</span>&nbsp;<span class="op" id="4059925">(</span><span class="ident" id="4059926">s</span>&nbsp;<span class="op" id="4059928">*</span><span class="ident" id="4059929">CertPool</span><span class="op" id="4059937">)</span>&nbsp;<span class="ident" id="4059939">findVerifiedParents</span><span class="op" id="4059958">(</span><span class="ident" id="4059959">cert</span>&nbsp;<span class="op" id="4059964">*</span><span class="ident" id="4059965">Certificate</span><span class="op" id="4059976">)</span>&nbsp;<span class="op" id="4059978">(</span><span class="ident" id="4059979">parents</span>&nbsp;<span class="op" id="4059987">[</span><span class="op" id="4059988">]</span><span class="builtintype" id="4059989">int</span><span class="op" id="4059992">,</span>&nbsp;<span class="ident" id="4059994">errCert</span>&nbsp;<span class="op" id="4060002">*</span><span class="ident" id="4060003">Certificate</span><span class="op" id="4060014">,</span>&nbsp;<span class="ident" id="4060016">err</span>&nbsp;<span class="builtintype" id="4060020">error</span><span class="op" id="4060025">)</span>&nbsp;<span class="op" id="4060027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060030">if</span>&nbsp;<span class="ident" id="4060033">s</span>&nbsp;<span class="op" id="4060035">==</span>&nbsp;<span class="ident" id="4060038">nil</span>&nbsp;<span class="op" id="4060042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060046">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060054">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060057">var</span>&nbsp;<span class="ident" id="4060061">candidates</span>&nbsp;<span class="op" id="4060072">[</span><span class="op" id="4060073">]</span><span class="builtintype" id="4060074">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060080">if</span>&nbsp;<span class="builtinfunc" id="4060083">len</span><span class="op" id="4060086">(</span><span class="ident" id="4060087">cert</span><span class="op" id="4060091">.</span><span class="ident" id="4060092">AuthorityKeyId</span><span class="op" id="4060106">)</span>&nbsp;<span class="op" id="4060108">&gt;</span>&nbsp;<span class="num" id="4060110">0</span>&nbsp;<span class="op" id="4060112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060116">candidates</span>&nbsp;<span class="op" id="4060127">=</span>&nbsp;<span class="ident" id="4060129">s</span><span class="op" id="4060130">.</span><span class="ident" id="4060131">bySubjectKeyId</span><span class="op" id="4060145">[</span><span class="builtintype" id="4060146">string</span><span class="op" id="4060152">(</span><span class="ident" id="4060153">cert</span><span class="op" id="4060157">.</span><span class="ident" id="4060158">AuthorityKeyId</span><span class="op" id="4060172">)</span><span class="op" id="4060173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060176">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060179">if</span>&nbsp;<span class="builtinfunc" id="4060182">len</span><span class="op" id="4060185">(</span><span class="ident" id="4060186">candidates</span><span class="op" id="4060196">)</span>&nbsp;<span class="op" id="4060198">==</span>&nbsp;<span class="num" id="4060201">0</span>&nbsp;<span class="op" id="4060203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060207">candidates</span>&nbsp;<span class="op" id="4060218">=</span>&nbsp;<span class="ident" id="4060220">s</span><span class="op" id="4060221">.</span><span class="ident" id="4060222">byName</span><span class="op" id="4060228">[</span><span class="builtintype" id="4060229">string</span><span class="op" id="4060235">(</span><span class="ident" id="4060236">cert</span><span class="op" id="4060240">.</span><span class="ident" id="4060241">RawIssuer</span><span class="op" id="4060250">)</span><span class="op" id="4060251">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060258">for</span>&nbsp;<span class="ident" id="4060262">_</span><span class="op" id="4060263">,</span>&nbsp;<span class="ident" id="4060265">c</span>&nbsp;<span class="op" id="4060267">:=</span>&nbsp;<span class="keyword" id="4060270">range</span>&nbsp;<span class="ident" id="4060276">candidates</span>&nbsp;<span class="op" id="4060287">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060291">if</span>&nbsp;<span class="ident" id="4060294">err</span>&nbsp;<span class="op" id="4060298">=</span>&nbsp;<span class="ident" id="4060300">cert</span><span class="op" id="4060304">.</span><span class="ident" id="4060305">CheckSignatureFrom</span><span class="op" id="4060323">(</span><span class="ident" id="4060324">s</span><span class="op" id="4060325">.</span><span class="ident" id="4060326">certs</span><span class="op" id="4060331">[</span><span class="ident" id="4060332">c</span><span class="op" id="4060333">]</span><span class="op" id="4060334">)</span><span class="op" id="4060335">;</span>&nbsp;<span class="ident" id="4060337">err</span>&nbsp;<span class="op" id="4060341">==</span>&nbsp;<span class="ident" id="4060344">nil</span>&nbsp;<span class="op" id="4060348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060353">parents</span>&nbsp;<span class="op" id="4060361">=</span>&nbsp;<span class="builtinfunc" id="4060363">append</span><span class="op" id="4060369">(</span><span class="ident" id="4060370">parents</span><span class="op" id="4060377">,</span>&nbsp;<span class="ident" id="4060379">c</span><span class="op" id="4060380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060384">}</span>&nbsp;<span class="keyword" id="4060386">else</span>&nbsp;<span class="op" id="4060391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060396">errCert</span>&nbsp;<span class="op" id="4060404">=</span>&nbsp;<span class="ident" id="4060406">s</span><span class="op" id="4060407">.</span><span class="ident" id="4060408">certs</span><span class="op" id="4060413">[</span><span class="ident" id="4060414">c</span><span class="op" id="4060415">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060419">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060426">return</span><br>
<span class="lineno"></span><span class="op" id="4060433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="4060436">//&nbsp;AddCert&nbsp;adds&nbsp;a&nbsp;certificate&nbsp;to&nbsp;a&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="4060477">func</span>&nbsp;<span class="op" id="4060482">(</span><span class="ident" id="4060483">s</span>&nbsp;<span class="op" id="4060485">*</span><span class="ident" id="4060486">CertPool</span><span class="op" id="4060494">)</span>&nbsp;<span class="ident" id="4060496">AddCert</span><span class="op" id="4060503">(</span><span class="ident" id="4060504">cert</span>&nbsp;<span class="op" id="4060509">*</span><span class="ident" id="4060510">Certificate</span><span class="op" id="4060521">)</span>&nbsp;<span class="op" id="4060523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060526">if</span>&nbsp;<span class="ident" id="4060529">cert</span>&nbsp;<span class="op" id="4060534">==</span>&nbsp;<span class="ident" id="4060537">nil</span>&nbsp;<span class="op" id="4060541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4060545">panic</span><span class="op" id="4060550">(</span><span class="string" id="4060551">&#34;adding&nbsp;nil&nbsp;Certificate&nbsp;to&nbsp;CertPool&#34;</span><span class="op" id="4060587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060590">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4060594">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;certificate&nbsp;isn&#39;t&nbsp;being&nbsp;added&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060650">for</span>&nbsp;<span class="ident" id="4060654">_</span><span class="op" id="4060655">,</span>&nbsp;<span class="ident" id="4060657">c</span>&nbsp;<span class="op" id="4060659">:=</span>&nbsp;<span class="keyword" id="4060662">range</span>&nbsp;<span class="ident" id="4060668">s</span><span class="op" id="4060669">.</span><span class="ident" id="4060670">certs</span>&nbsp;<span class="op" id="4060676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060680">if</span>&nbsp;<span class="ident" id="4060683">c</span><span class="op" id="4060684">.</span><span class="ident" id="4060685">Equal</span><span class="op" id="4060690">(</span><span class="ident" id="4060691">cert</span><span class="op" id="4060695">)</span>&nbsp;<span class="op" id="4060697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060702">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060718">n</span>&nbsp;<span class="op" id="4060720">:=</span>&nbsp;<span class="builtinfunc" id="4060723">len</span><span class="op" id="4060726">(</span><span class="ident" id="4060727">s</span><span class="op" id="4060728">.</span><span class="ident" id="4060729">certs</span><span class="op" id="4060734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060737">s</span><span class="op" id="4060738">.</span><span class="ident" id="4060739">certs</span>&nbsp;<span class="op" id="4060745">=</span>&nbsp;<span class="builtinfunc" id="4060747">append</span><span class="op" id="4060753">(</span><span class="ident" id="4060754">s</span><span class="op" id="4060755">.</span><span class="ident" id="4060756">certs</span><span class="op" id="4060761">,</span>&nbsp;<span class="ident" id="4060763">cert</span><span class="op" id="4060767">)</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060771">if</span>&nbsp;<span class="builtinfunc" id="4060774">len</span><span class="op" id="4060777">(</span><span class="ident" id="4060778">cert</span><span class="op" id="4060782">.</span><span class="ident" id="4060783">SubjectKeyId</span><span class="op" id="4060795">)</span>&nbsp;<span class="op" id="4060797">&gt;</span>&nbsp;<span class="num" id="4060799">0</span>&nbsp;<span class="op" id="4060801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060805">keyId</span>&nbsp;<span class="op" id="4060811">:=</span>&nbsp;<span class="builtintype" id="4060814">string</span><span class="op" id="4060820">(</span><span class="ident" id="4060821">cert</span><span class="op" id="4060825">.</span><span class="ident" id="4060826">SubjectKeyId</span><span class="op" id="4060838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060842">s</span><span class="op" id="4060843">.</span><span class="ident" id="4060844">bySubjectKeyId</span><span class="op" id="4060858">[</span><span class="ident" id="4060859">keyId</span><span class="op" id="4060864">]</span>&nbsp;<span class="op" id="4060866">=</span>&nbsp;<span class="builtinfunc" id="4060868">append</span><span class="op" id="4060874">(</span><span class="ident" id="4060875">s</span><span class="op" id="4060876">.</span><span class="ident" id="4060877">bySubjectKeyId</span><span class="op" id="4060891">[</span><span class="ident" id="4060892">keyId</span><span class="op" id="4060897">]</span><span class="op" id="4060898">,</span>&nbsp;<span class="ident" id="4060900">n</span><span class="op" id="4060901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060904">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060907">name</span>&nbsp;<span class="op" id="4060912">:=</span>&nbsp;<span class="builtintype" id="4060915">string</span><span class="op" id="4060921">(</span><span class="ident" id="4060922">cert</span><span class="op" id="4060926">.</span><span class="ident" id="4060927">RawSubject</span><span class="op" id="4060937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060940">s</span><span class="op" id="4060941">.</span><span class="ident" id="4060942">byName</span><span class="op" id="4060948">[</span><span class="ident" id="4060949">name</span><span class="op" id="4060953">]</span>&nbsp;<span class="op" id="4060955">=</span>&nbsp;<span class="builtinfunc" id="4060957">append</span><span class="op" id="4060963">(</span><span class="ident" id="4060964">s</span><span class="op" id="4060965">.</span><span class="ident" id="4060966">byName</span><span class="op" id="4060972">[</span><span class="ident" id="4060973">name</span><span class="op" id="4060977">]</span><span class="op" id="4060978">,</span>&nbsp;<span class="ident" id="4060980">n</span><span class="op" id="4060981">)</span><br>
<span class="lineno"></span><span class="op" id="4060983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4060986">//&nbsp;AppendCertsFromPEM&nbsp;attempts&nbsp;to&nbsp;parse&nbsp;a&nbsp;series&nbsp;of&nbsp;PEM&nbsp;encoded&nbsp;certificates.</span><br>
<span class="lineno">80</span><span class="comment" id="4061064">//&nbsp;It&nbsp;appends&nbsp;any&nbsp;certificates&nbsp;found&nbsp;to&nbsp;s&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;certificates</span><br>
<span class="lineno"></span><span class="comment" id="4061143">//&nbsp;were&nbsp;successfully&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="4061172">//</span><br>
<span class="lineno"></span><span class="comment" id="4061175">//&nbsp;On&nbsp;many&nbsp;Linux&nbsp;systems,&nbsp;/etc/ssl/cert.pem&nbsp;will&nbsp;contain&nbsp;the&nbsp;system&nbsp;wide&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4061252">//&nbsp;of&nbsp;root&nbsp;CAs&nbsp;in&nbsp;a&nbsp;format&nbsp;suitable&nbsp;for&nbsp;this&nbsp;function.</span><br>
<span class="lineno">85</span><span class="keyword" id="4061307">func</span>&nbsp;<span class="op" id="4061312">(</span><span class="ident" id="4061313">s</span>&nbsp;<span class="op" id="4061315">*</span><span class="ident" id="4061316">CertPool</span><span class="op" id="4061324">)</span>&nbsp;<span class="ident" id="4061326">AppendCertsFromPEM</span><span class="op" id="4061344">(</span><span class="ident" id="4061345">pemCerts</span>&nbsp;<span class="op" id="4061354">[</span><span class="op" id="4061355">]</span><span class="builtintype" id="4061356">byte</span><span class="op" id="4061360">)</span>&nbsp;<span class="op" id="4061362">(</span><span class="ident" id="4061363">ok</span>&nbsp;<span class="builtintype" id="4061366">bool</span><span class="op" id="4061370">)</span>&nbsp;<span class="op" id="4061372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061375">for</span>&nbsp;<span class="builtinfunc" id="4061379">len</span><span class="op" id="4061382">(</span><span class="ident" id="4061383">pemCerts</span><span class="op" id="4061391">)</span>&nbsp;<span class="op" id="4061393">&gt;</span>&nbsp;<span class="num" id="4061395">0</span>&nbsp;<span class="op" id="4061397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061401">var</span>&nbsp;<span class="ident" id="4061405">block</span>&nbsp;<span class="op" id="4061411">*</span><span class="ident" id="4061412">pem</span><span class="op" id="4061415">.</span><span class="ident" id="4061416">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061424">block</span><span class="op" id="4061429">,</span>&nbsp;<span class="ident" id="4061431">pemCerts</span>&nbsp;<span class="op" id="4061440">=</span>&nbsp;<span class="ident" id="4061442">pem</span><span class="op" id="4061445">.</span><span class="ident" id="4061446">Decode</span><span class="op" id="4061452">(</span><span class="ident" id="4061453">pemCerts</span><span class="op" id="4061461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061465">if</span>&nbsp;<span class="ident" id="4061468">block</span>&nbsp;<span class="op" id="4061474">==</span>&nbsp;<span class="ident" id="4061477">nil</span>&nbsp;<span class="op" id="4061481">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061486">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061498">if</span>&nbsp;<span class="ident" id="4061501">block</span><span class="op" id="4061506">.</span><span class="ident" id="4061507">Type</span>&nbsp;<span class="op" id="4061512">!=</span>&nbsp;<span class="string" id="4061515">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="4061529">||</span>&nbsp;<span class="builtinfunc" id="4061532">len</span><span class="op" id="4061535">(</span><span class="ident" id="4061536">block</span><span class="op" id="4061541">.</span><span class="ident" id="4061542">Headers</span><span class="op" id="4061549">)</span>&nbsp;<span class="op" id="4061551">!=</span>&nbsp;<span class="num" id="4061554">0</span>&nbsp;<span class="op" id="4061556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061561">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061572">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061577">cert</span><span class="op" id="4061581">,</span>&nbsp;<span class="ident" id="4061583">err</span>&nbsp;<span class="op" id="4061587">:=</span>&nbsp;<span class="ident" id="4061590">ParseCertificate</span><span class="op" id="4061606">(</span><span class="ident" id="4061607">block</span><span class="op" id="4061612">.</span><span class="ident" id="4061613">Bytes</span><span class="op" id="4061618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061622">if</span>&nbsp;<span class="ident" id="4061625">err</span>&nbsp;<span class="op" id="4061629">!=</span>&nbsp;<span class="ident" id="4061632">nil</span>&nbsp;<span class="op" id="4061636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061641">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061652">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061657">s</span><span class="op" id="4061658">.</span><span class="ident" id="4061659">AddCert</span><span class="op" id="4061666">(</span><span class="ident" id="4061667">cert</span><span class="op" id="4061671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061675">ok</span>&nbsp;<span class="op" id="4061678">=</span>&nbsp;<span class="ident" id="4061680">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061690">return</span><br>
<span class="lineno"></span><span class="op" id="4061697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4061700">//&nbsp;Subjects&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;DER-encoded&nbsp;subjects&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4061758">//&nbsp;all&nbsp;of&nbsp;the&nbsp;certificates&nbsp;in&nbsp;the&nbsp;pool.</span><br>
<span class="lineno">110</span><span class="keyword" id="4061798">func</span>&nbsp;<span class="op" id="4061803">(</span><span class="ident" id="4061804">s</span>&nbsp;<span class="op" id="4061806">*</span><span class="ident" id="4061807">CertPool</span><span class="op" id="4061815">)</span>&nbsp;<span class="ident" id="4061817">Subjects</span><span class="op" id="4061825">(</span><span class="op" id="4061826">)</span>&nbsp;<span class="op" id="4061828">(</span><span class="ident" id="4061829">res</span>&nbsp;<span class="op" id="4061833">[</span><span class="op" id="4061834">]</span><span class="op" id="4061835">[</span><span class="op" id="4061836">]</span><span class="builtintype" id="4061837">byte</span><span class="op" id="4061841">)</span>&nbsp;<span class="op" id="4061843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061846">res</span>&nbsp;<span class="op" id="4061850">=</span>&nbsp;<span class="builtinfunc" id="4061852">make</span><span class="op" id="4061856">(</span><span class="op" id="4061857">[</span><span class="op" id="4061858">]</span><span class="op" id="4061859">[</span><span class="op" id="4061860">]</span><span class="builtintype" id="4061861">byte</span><span class="op" id="4061865">,</span>&nbsp;<span class="builtinfunc" id="4061867">len</span><span class="op" id="4061870">(</span><span class="ident" id="4061871">s</span><span class="op" id="4061872">.</span><span class="ident" id="4061873">certs</span><span class="op" id="4061878">)</span><span class="op" id="4061879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061882">for</span>&nbsp;<span class="ident" id="4061886">i</span><span class="op" id="4061887">,</span>&nbsp;<span class="ident" id="4061889">c</span>&nbsp;<span class="op" id="4061891">:=</span>&nbsp;<span class="keyword" id="4061894">range</span>&nbsp;<span class="ident" id="4061900">s</span><span class="op" id="4061901">.</span><span class="ident" id="4061902">certs</span>&nbsp;<span class="op" id="4061908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061912">res</span><span class="op" id="4061915">[</span><span class="ident" id="4061916">i</span><span class="op" id="4061917">]</span>&nbsp;<span class="op" id="4061919">=</span>&nbsp;<span class="ident" id="4061921">c</span><span class="op" id="4061922">.</span><span class="ident" id="4061923">RawSubject</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061935">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061938">return</span><br>
<span class="lineno"></span><span class="op" id="4061945">}</span>
</div>
</body>
</html>
