<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5832242">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5832297">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5832351">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5832402">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;export&nbsp;filtering&nbsp;of&nbsp;an&nbsp;AST.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5832455">package</span>&nbsp;<span class="ident" id="5832463">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5832468">import</span>&nbsp;<span class="op" id="5832475">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5832478">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5832488">&#34;go/token&#34;</span><br>
<span class="lineno"></span><span class="op" id="5832499">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5832502">//&nbsp;filterIdentList&nbsp;removes&nbsp;unexported&nbsp;names&nbsp;from&nbsp;list&nbsp;in&nbsp;place</span><br>
<span class="lineno">15</span><span class="comment" id="5832565">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;list.&nbsp;If&nbsp;blankOk&nbsp;is&nbsp;set,&nbsp;blank</span><br>
<span class="lineno"></span><span class="comment" id="5832625">//&nbsp;identifiers&nbsp;are&nbsp;considered&nbsp;exported&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="5832671">//</span><br>
<span class="lineno"></span><span class="keyword" id="5832674">func</span>&nbsp;<span class="ident" id="5832679">filterIdentList</span><span class="op" id="5832694">(</span><span class="ident" id="5832695">list</span>&nbsp;<span class="op" id="5832700">[</span><span class="op" id="5832701">]</span><span class="op" id="5832702">*</span><span class="ident" id="5832703">ast</span><span class="op" id="5832706">.</span><span class="ident" id="5832707">Ident</span><span class="op" id="5832712">,</span>&nbsp;<span class="ident" id="5832714">blankOk</span>&nbsp;<span class="builtintype" id="5832722">bool</span><span class="op" id="5832726">)</span>&nbsp;<span class="op" id="5832728">[</span><span class="op" id="5832729">]</span><span class="op" id="5832730">*</span><span class="ident" id="5832731">ast</span><span class="op" id="5832734">.</span><span class="ident" id="5832735">Ident</span>&nbsp;<span class="op" id="5832741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832744">j</span>&nbsp;<span class="op" id="5832746">:=</span>&nbsp;<span class="num" id="5832749">0</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5832752">for</span>&nbsp;<span class="ident" id="5832756">_</span><span class="op" id="5832757">,</span>&nbsp;<span class="ident" id="5832759">x</span>&nbsp;<span class="op" id="5832761">:=</span>&nbsp;<span class="keyword" id="5832764">range</span>&nbsp;<span class="ident" id="5832770">list</span>&nbsp;<span class="op" id="5832775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5832779">if</span>&nbsp;<span class="ident" id="5832782">ast</span><span class="op" id="5832785">.</span><span class="ident" id="5832786">IsExported</span><span class="op" id="5832796">(</span><span class="ident" id="5832797">x</span><span class="op" id="5832798">.</span><span class="ident" id="5832799">Name</span><span class="op" id="5832803">)</span>&nbsp;<span class="op" id="5832805">||</span>&nbsp;<span class="op" id="5832808">(</span><span class="ident" id="5832809">blankOk</span>&nbsp;<span class="op" id="5832817">&amp;&amp;</span>&nbsp;<span class="ident" id="5832820">x</span><span class="op" id="5832821">.</span><span class="ident" id="5832822">Name</span>&nbsp;<span class="op" id="5832827">==</span>&nbsp;<span class="string" id="5832830">&#34;_&#34;</span><span class="op" id="5832833">)</span>&nbsp;<span class="op" id="5832835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832840">list</span><span class="op" id="5832844">[</span><span class="ident" id="5832845">j</span><span class="op" id="5832846">]</span>&nbsp;<span class="op" id="5832848">=</span>&nbsp;<span class="ident" id="5832850">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832855">j</span><span class="op" id="5832856">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5832861">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5832864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5832867">return</span>&nbsp;<span class="ident" id="5832874">list</span><span class="op" id="5832878">[</span><span class="num" id="5832879">0</span><span class="op" id="5832880">:</span><span class="ident" id="5832881">j</span><span class="op" id="5832882">]</span><br>
<span class="lineno"></span><span class="op" id="5832884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5832887">//&nbsp;removeErrorField&nbsp;removes&nbsp;anonymous&nbsp;fields&nbsp;named&nbsp;&#34;error&#34;&nbsp;from&nbsp;an&nbsp;interface.</span><br>
<span class="lineno">30</span><span class="comment" id="5832965">//&nbsp;This&nbsp;is&nbsp;called&nbsp;when&nbsp;&#34;error&#34;&nbsp;has&nbsp;been&nbsp;determined&nbsp;to&nbsp;be&nbsp;a&nbsp;local&nbsp;name,</span><br>
<span class="lineno"></span><span class="comment" id="5833036">//&nbsp;not&nbsp;the&nbsp;predeclared&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5833065">//</span><br>
<span class="lineno"></span><span class="keyword" id="5833068">func</span>&nbsp;<span class="ident" id="5833073">removeErrorField</span><span class="op" id="5833089">(</span><span class="ident" id="5833090">ityp</span>&nbsp;<span class="op" id="5833095">*</span><span class="ident" id="5833096">ast</span><span class="op" id="5833099">.</span><span class="ident" id="5833100">InterfaceType</span><span class="op" id="5833113">)</span>&nbsp;<span class="op" id="5833115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833118">list</span>&nbsp;<span class="op" id="5833123">:=</span>&nbsp;<span class="ident" id="5833126">ityp</span><span class="op" id="5833130">.</span><span class="ident" id="5833131">Methods</span><span class="op" id="5833138">.</span><span class="ident" id="5833139">List</span>&nbsp;<span class="comment" id="5833144">//&nbsp;we&nbsp;know&nbsp;that&nbsp;ityp.Methods&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833181">j</span>&nbsp;<span class="op" id="5833183">:=</span>&nbsp;<span class="num" id="5833186">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5833189">for</span>&nbsp;<span class="ident" id="5833193">_</span><span class="op" id="5833194">,</span>&nbsp;<span class="ident" id="5833196">field</span>&nbsp;<span class="op" id="5833202">:=</span>&nbsp;<span class="keyword" id="5833205">range</span>&nbsp;<span class="ident" id="5833211">list</span>&nbsp;<span class="op" id="5833216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833220">keepField</span>&nbsp;<span class="op" id="5833230">:=</span>&nbsp;<span class="builtintype" id="5833233">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5833240">if</span>&nbsp;<span class="ident" id="5833243">n</span>&nbsp;<span class="op" id="5833245">:=</span>&nbsp;<span class="builtinfunc" id="5833248">len</span><span class="op" id="5833251">(</span><span class="ident" id="5833252">field</span><span class="op" id="5833257">.</span><span class="ident" id="5833258">Names</span><span class="op" id="5833263">)</span><span class="op" id="5833264">;</span>&nbsp;<span class="ident" id="5833266">n</span>&nbsp;<span class="op" id="5833268">==</span>&nbsp;<span class="num" id="5833271">0</span>&nbsp;<span class="op" id="5833273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5833278">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5833300">if</span>&nbsp;<span class="ident" id="5833303">fname</span><span class="op" id="5833308">,</span>&nbsp;<span class="ident" id="5833310">_</span>&nbsp;<span class="op" id="5833312">:=</span>&nbsp;<span class="ident" id="5833315">baseTypeName</span><span class="op" id="5833327">(</span><span class="ident" id="5833328">field</span><span class="op" id="5833333">.</span><span class="ident" id="5833334">Type</span><span class="op" id="5833338">)</span><span class="op" id="5833339">;</span>&nbsp;<span class="ident" id="5833341">fname</span>&nbsp;<span class="op" id="5833347">==</span>&nbsp;<span class="string" id="5833350">&#34;error&#34;</span>&nbsp;<span class="op" id="5833358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833364">keepField</span>&nbsp;<span class="op" id="5833374">=</span>&nbsp;<span class="builtintype" id="5833376">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5833385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5833389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5833393">if</span>&nbsp;<span class="ident" id="5833396">keepField</span>&nbsp;<span class="op" id="5833406">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833411">list</span><span class="op" id="5833415">[</span><span class="ident" id="5833416">j</span><span class="op" id="5833417">]</span>&nbsp;<span class="op" id="5833419">=</span>&nbsp;<span class="ident" id="5833421">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833430">j</span><span class="op" id="5833431">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5833436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5833439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5833442">if</span>&nbsp;<span class="ident" id="5833445">j</span>&nbsp;<span class="op" id="5833447">&lt;</span>&nbsp;<span class="builtinfunc" id="5833449">len</span><span class="op" id="5833452">(</span><span class="ident" id="5833453">list</span><span class="op" id="5833457">)</span>&nbsp;<span class="op" id="5833459">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833463">ityp</span><span class="op" id="5833467">.</span><span class="ident" id="5833468">Incomplete</span>&nbsp;<span class="op" id="5833479">=</span>&nbsp;<span class="builtintype" id="5833481">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5833487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833490">ityp</span><span class="op" id="5833494">.</span><span class="ident" id="5833495">Methods</span><span class="op" id="5833502">.</span><span class="ident" id="5833503">List</span>&nbsp;<span class="op" id="5833508">=</span>&nbsp;<span class="ident" id="5833510">list</span><span class="op" id="5833514">[</span><span class="num" id="5833515">0</span><span class="op" id="5833516">:</span><span class="ident" id="5833517">j</span><span class="op" id="5833518">]</span><br>
<span class="lineno"></span><span class="op" id="5833520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5833523">//&nbsp;filterFieldList&nbsp;removes&nbsp;unexported&nbsp;fields&nbsp;(field&nbsp;names)&nbsp;from&nbsp;the&nbsp;field&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5833602">//&nbsp;in&nbsp;place&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;fields&nbsp;were&nbsp;removed.&nbsp;Anonymous&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5833676">//&nbsp;recorded&nbsp;with&nbsp;the&nbsp;parent&nbsp;type.&nbsp;filterType&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;types&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5833749">//&nbsp;all&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="5833774">//</span><br>
<span class="lineno">60</span><span class="keyword" id="5833777">func</span>&nbsp;<span class="op" id="5833782">(</span><span class="ident" id="5833783">r</span>&nbsp;<span class="op" id="5833785">*</span><span class="ident" id="5833786">reader</span><span class="op" id="5833792">)</span>&nbsp;<span class="ident" id="5833794">filterFieldList</span><span class="op" id="5833809">(</span><span class="ident" id="5833810">parent</span>&nbsp;<span class="op" id="5833817">*</span><span class="ident" id="5833818">namedType</span><span class="op" id="5833827">,</span>&nbsp;<span class="ident" id="5833829">fields</span>&nbsp;<span class="op" id="5833836">*</span><span class="ident" id="5833837">ast</span><span class="op" id="5833840">.</span><span class="ident" id="5833841">FieldList</span><span class="op" id="5833850">,</span>&nbsp;<span class="ident" id="5833852">ityp</span>&nbsp;<span class="op" id="5833857">*</span><span class="ident" id="5833858">ast</span><span class="op" id="5833861">.</span><span class="ident" id="5833862">InterfaceType</span><span class="op" id="5833875">)</span>&nbsp;<span class="op" id="5833877">(</span><span class="ident" id="5833878">removedFields</span>&nbsp;<span class="builtintype" id="5833892">bool</span><span class="op" id="5833896">)</span>&nbsp;<span class="op" id="5833898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5833901">if</span>&nbsp;<span class="ident" id="5833904">fields</span>&nbsp;<span class="op" id="5833911">==</span>&nbsp;<span class="ident" id="5833914">nil</span>&nbsp;<span class="op" id="5833918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5833922">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5833930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833933">list</span>&nbsp;<span class="op" id="5833938">:=</span>&nbsp;<span class="ident" id="5833941">fields</span><span class="op" id="5833947">.</span><span class="ident" id="5833948">List</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833954">j</span>&nbsp;<span class="op" id="5833956">:=</span>&nbsp;<span class="num" id="5833959">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5833962">for</span>&nbsp;<span class="ident" id="5833966">_</span><span class="op" id="5833967">,</span>&nbsp;<span class="ident" id="5833969">field</span>&nbsp;<span class="op" id="5833975">:=</span>&nbsp;<span class="keyword" id="5833978">range</span>&nbsp;<span class="ident" id="5833984">list</span>&nbsp;<span class="op" id="5833989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833993">keepField</span>&nbsp;<span class="op" id="5834003">:=</span>&nbsp;<span class="builtintype" id="5834006">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5834014">if</span>&nbsp;<span class="ident" id="5834017">n</span>&nbsp;<span class="op" id="5834019">:=</span>&nbsp;<span class="builtinfunc" id="5834022">len</span><span class="op" id="5834025">(</span><span class="ident" id="5834026">field</span><span class="op" id="5834031">.</span><span class="ident" id="5834032">Names</span><span class="op" id="5834037">)</span><span class="op" id="5834038">;</span>&nbsp;<span class="ident" id="5834040">n</span>&nbsp;<span class="op" id="5834042">==</span>&nbsp;<span class="num" id="5834045">0</span>&nbsp;<span class="op" id="5834047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5834052">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834074">fname</span>&nbsp;<span class="op" id="5834080">:=</span>&nbsp;<span class="ident" id="5834083">r</span><span class="op" id="5834084">.</span><span class="ident" id="5834085">recordAnonymousField</span><span class="op" id="5834105">(</span><span class="ident" id="5834106">parent</span><span class="op" id="5834112">,</span>&nbsp;<span class="ident" id="5834114">field</span><span class="op" id="5834119">.</span><span class="ident" id="5834120">Type</span><span class="op" id="5834124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5834129">if</span>&nbsp;<span class="ident" id="5834132">ast</span><span class="op" id="5834135">.</span><span class="ident" id="5834136">IsExported</span><span class="op" id="5834146">(</span><span class="ident" id="5834147">fname</span><span class="op" id="5834152">)</span>&nbsp;<span class="op" id="5834154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834160">keepField</span>&nbsp;<span class="op" id="5834170">=</span>&nbsp;<span class="builtintype" id="5834172">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834180">}</span>&nbsp;<span class="keyword" id="5834182">else</span>&nbsp;<span class="keyword" id="5834187">if</span>&nbsp;<span class="ident" id="5834190">ityp</span>&nbsp;<span class="op" id="5834195">!=</span>&nbsp;<span class="ident" id="5834198">nil</span>&nbsp;<span class="op" id="5834202">&amp;&amp;</span>&nbsp;<span class="ident" id="5834205">fname</span>&nbsp;<span class="op" id="5834211">==</span>&nbsp;<span class="string" id="5834214">&#34;error&#34;</span>&nbsp;<span class="op" id="5834222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5834228">//&nbsp;possibly&nbsp;the&nbsp;predeclared&nbsp;error&nbsp;interface;&nbsp;keep</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5834282">//&nbsp;it&nbsp;for&nbsp;now&nbsp;but&nbsp;remember&nbsp;this&nbsp;interface&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5834336">//&nbsp;it&nbsp;can&nbsp;be&nbsp;fixed&nbsp;if&nbsp;error&nbsp;is&nbsp;also&nbsp;defined&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834392">keepField</span>&nbsp;<span class="op" id="5834402">=</span>&nbsp;<span class="builtintype" id="5834404">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834413">r</span><span class="op" id="5834414">.</span><span class="ident" id="5834415">remember</span><span class="op" id="5834423">(</span><span class="ident" id="5834424">ityp</span><span class="op" id="5834428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834433">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834437">}</span>&nbsp;<span class="keyword" id="5834439">else</span>&nbsp;<span class="op" id="5834444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834449">field</span><span class="op" id="5834454">.</span><span class="ident" id="5834455">Names</span>&nbsp;<span class="op" id="5834461">=</span>&nbsp;<span class="ident" id="5834463">filterIdentList</span><span class="op" id="5834478">(</span><span class="ident" id="5834479">field</span><span class="op" id="5834484">.</span><span class="ident" id="5834485">Names</span><span class="op" id="5834490">,</span>&nbsp;<span class="builtintype" id="5834492">false</span><span class="op" id="5834497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5834502">if</span>&nbsp;<span class="builtinfunc" id="5834505">len</span><span class="op" id="5834508">(</span><span class="ident" id="5834509">field</span><span class="op" id="5834514">.</span><span class="ident" id="5834515">Names</span><span class="op" id="5834520">)</span>&nbsp;<span class="op" id="5834522">&lt;</span>&nbsp;<span class="ident" id="5834524">n</span>&nbsp;<span class="op" id="5834526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834532">removedFields</span>&nbsp;<span class="op" id="5834546">=</span>&nbsp;<span class="builtintype" id="5834548">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834556">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5834561">if</span>&nbsp;<span class="builtinfunc" id="5834564">len</span><span class="op" id="5834567">(</span><span class="ident" id="5834568">field</span><span class="op" id="5834573">.</span><span class="ident" id="5834574">Names</span><span class="op" id="5834579">)</span>&nbsp;<span class="op" id="5834581">&gt;</span>&nbsp;<span class="num" id="5834583">0</span>&nbsp;<span class="op" id="5834585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834591">keepField</span>&nbsp;<span class="op" id="5834601">=</span>&nbsp;<span class="builtintype" id="5834603">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5834619">if</span>&nbsp;<span class="ident" id="5834622">keepField</span>&nbsp;<span class="op" id="5834632">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834637">r</span><span class="op" id="5834638">.</span><span class="ident" id="5834639">filterType</span><span class="op" id="5834649">(</span><span class="ident" id="5834650">nil</span><span class="op" id="5834653">,</span>&nbsp;<span class="ident" id="5834655">field</span><span class="op" id="5834660">.</span><span class="ident" id="5834661">Type</span><span class="op" id="5834665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834670">list</span><span class="op" id="5834674">[</span><span class="ident" id="5834675">j</span><span class="op" id="5834676">]</span>&nbsp;<span class="op" id="5834678">=</span>&nbsp;<span class="ident" id="5834680">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834689">j</span><span class="op" id="5834690">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834698">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5834701">if</span>&nbsp;<span class="ident" id="5834704">j</span>&nbsp;<span class="op" id="5834706">&lt;</span>&nbsp;<span class="builtinfunc" id="5834708">len</span><span class="op" id="5834711">(</span><span class="ident" id="5834712">list</span><span class="op" id="5834716">)</span>&nbsp;<span class="op" id="5834718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834722">removedFields</span>&nbsp;<span class="op" id="5834736">=</span>&nbsp;<span class="builtintype" id="5834738">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834747">fields</span><span class="op" id="5834753">.</span><span class="ident" id="5834754">List</span>&nbsp;<span class="op" id="5834759">=</span>&nbsp;<span class="ident" id="5834761">list</span><span class="op" id="5834765">[</span><span class="num" id="5834766">0</span><span class="op" id="5834767">:</span><span class="ident" id="5834768">j</span><span class="op" id="5834769">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5834772">return</span><br>
<span class="lineno">100</span><span class="op" id="5834779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5834782">//&nbsp;filterParamList&nbsp;applies&nbsp;filterType&nbsp;to&nbsp;each&nbsp;parameter&nbsp;type&nbsp;in&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="5834854">//</span><br>
<span class="lineno"></span><span class="keyword" id="5834857">func</span>&nbsp;<span class="op" id="5834862">(</span><span class="ident" id="5834863">r</span>&nbsp;<span class="op" id="5834865">*</span><span class="ident" id="5834866">reader</span><span class="op" id="5834872">)</span>&nbsp;<span class="ident" id="5834874">filterParamList</span><span class="op" id="5834889">(</span><span class="ident" id="5834890">fields</span>&nbsp;<span class="op" id="5834897">*</span><span class="ident" id="5834898">ast</span><span class="op" id="5834901">.</span><span class="ident" id="5834902">FieldList</span><span class="op" id="5834911">)</span>&nbsp;<span class="op" id="5834913">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5834916">if</span>&nbsp;<span class="ident" id="5834919">fields</span>&nbsp;<span class="op" id="5834926">!=</span>&nbsp;<span class="ident" id="5834929">nil</span>&nbsp;<span class="op" id="5834933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5834937">for</span>&nbsp;<span class="ident" id="5834941">_</span><span class="op" id="5834942">,</span>&nbsp;<span class="ident" id="5834944">f</span>&nbsp;<span class="op" id="5834946">:=</span>&nbsp;<span class="keyword" id="5834949">range</span>&nbsp;<span class="ident" id="5834955">fields</span><span class="op" id="5834961">.</span><span class="ident" id="5834962">List</span>&nbsp;<span class="op" id="5834967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834972">r</span><span class="op" id="5834973">.</span><span class="ident" id="5834974">filterType</span><span class="op" id="5834984">(</span><span class="ident" id="5834985">nil</span><span class="op" id="5834988">,</span>&nbsp;<span class="ident" id="5834990">f</span><span class="op" id="5834991">.</span><span class="ident" id="5834992">Type</span><span class="op" id="5834996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5835000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5835003">}</span><br>
<span class="lineno">110</span><span class="op" id="5835005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5835008">//&nbsp;filterType&nbsp;strips&nbsp;any&nbsp;unexported&nbsp;struct&nbsp;fields&nbsp;or&nbsp;method&nbsp;types&nbsp;from&nbsp;typ</span><br>
<span class="lineno"></span><span class="comment" id="5835083">//&nbsp;in&nbsp;place.&nbsp;If&nbsp;fields&nbsp;(or&nbsp;methods)&nbsp;have&nbsp;been&nbsp;removed,&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5835156">//&nbsp;struct&nbsp;or&nbsp;interface&nbsp;type&nbsp;has&nbsp;the&nbsp;Incomplete&nbsp;field&nbsp;set&nbsp;to&nbsp;true.</span><br>
<span class="lineno">115</span><span class="comment" id="5835222">//</span><br>
<span class="lineno"></span><span class="keyword" id="5835225">func</span>&nbsp;<span class="op" id="5835230">(</span><span class="ident" id="5835231">r</span>&nbsp;<span class="op" id="5835233">*</span><span class="ident" id="5835234">reader</span><span class="op" id="5835240">)</span>&nbsp;<span class="ident" id="5835242">filterType</span><span class="op" id="5835252">(</span><span class="ident" id="5835253">parent</span>&nbsp;<span class="op" id="5835260">*</span><span class="ident" id="5835261">namedType</span><span class="op" id="5835270">,</span>&nbsp;<span class="ident" id="5835272">typ</span>&nbsp;<span class="ident" id="5835276">ast</span><span class="op" id="5835279">.</span><span class="ident" id="5835280">Expr</span><span class="op" id="5835284">)</span>&nbsp;<span class="op" id="5835286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835289">switch</span>&nbsp;<span class="ident" id="5835296">t</span>&nbsp;<span class="op" id="5835298">:=</span>&nbsp;<span class="ident" id="5835301">typ</span><span class="op" id="5835304">.</span><span class="op" id="5835305">(</span><span class="keyword" id="5835306">type</span><span class="op" id="5835310">)</span>&nbsp;<span class="op" id="5835312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835315">case</span>&nbsp;<span class="op" id="5835320">*</span><span class="ident" id="5835321">ast</span><span class="op" id="5835324">.</span><span class="ident" id="5835325">Ident</span><span class="op" id="5835330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5835334">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835352">case</span>&nbsp;<span class="op" id="5835357">*</span><span class="ident" id="5835358">ast</span><span class="op" id="5835361">.</span><span class="ident" id="5835362">ParenExpr</span><span class="op" id="5835371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835375">r</span><span class="op" id="5835376">.</span><span class="ident" id="5835377">filterType</span><span class="op" id="5835387">(</span><span class="ident" id="5835388">nil</span><span class="op" id="5835391">,</span>&nbsp;<span class="ident" id="5835393">t</span><span class="op" id="5835394">.</span><span class="ident" id="5835395">X</span><span class="op" id="5835396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835399">case</span>&nbsp;<span class="op" id="5835404">*</span><span class="ident" id="5835405">ast</span><span class="op" id="5835408">.</span><span class="ident" id="5835409">ArrayType</span><span class="op" id="5835418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835422">r</span><span class="op" id="5835423">.</span><span class="ident" id="5835424">filterType</span><span class="op" id="5835434">(</span><span class="ident" id="5835435">nil</span><span class="op" id="5835438">,</span>&nbsp;<span class="ident" id="5835440">t</span><span class="op" id="5835441">.</span><span class="ident" id="5835442">Elt</span><span class="op" id="5835445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835448">case</span>&nbsp;<span class="op" id="5835453">*</span><span class="ident" id="5835454">ast</span><span class="op" id="5835457">.</span><span class="ident" id="5835458">StructType</span><span class="op" id="5835468">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835472">if</span>&nbsp;<span class="ident" id="5835475">r</span><span class="op" id="5835476">.</span><span class="ident" id="5835477">filterFieldList</span><span class="op" id="5835492">(</span><span class="ident" id="5835493">parent</span><span class="op" id="5835499">,</span>&nbsp;<span class="ident" id="5835501">t</span><span class="op" id="5835502">.</span><span class="ident" id="5835503">Fields</span><span class="op" id="5835509">,</span>&nbsp;<span class="ident" id="5835511">nil</span><span class="op" id="5835514">)</span>&nbsp;<span class="op" id="5835516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835521">t</span><span class="op" id="5835522">.</span><span class="ident" id="5835523">Incomplete</span>&nbsp;<span class="op" id="5835534">=</span>&nbsp;<span class="builtintype" id="5835536">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5835543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835546">case</span>&nbsp;<span class="op" id="5835551">*</span><span class="ident" id="5835552">ast</span><span class="op" id="5835555">.</span><span class="ident" id="5835556">FuncType</span><span class="op" id="5835564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835568">r</span><span class="op" id="5835569">.</span><span class="ident" id="5835570">filterParamList</span><span class="op" id="5835585">(</span><span class="ident" id="5835586">t</span><span class="op" id="5835587">.</span><span class="ident" id="5835588">Params</span><span class="op" id="5835594">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835598">r</span><span class="op" id="5835599">.</span><span class="ident" id="5835600">filterParamList</span><span class="op" id="5835615">(</span><span class="ident" id="5835616">t</span><span class="op" id="5835617">.</span><span class="ident" id="5835618">Results</span><span class="op" id="5835625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835628">case</span>&nbsp;<span class="op" id="5835633">*</span><span class="ident" id="5835634">ast</span><span class="op" id="5835637">.</span><span class="ident" id="5835638">InterfaceType</span><span class="op" id="5835651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835655">if</span>&nbsp;<span class="ident" id="5835658">r</span><span class="op" id="5835659">.</span><span class="ident" id="5835660">filterFieldList</span><span class="op" id="5835675">(</span><span class="ident" id="5835676">parent</span><span class="op" id="5835682">,</span>&nbsp;<span class="ident" id="5835684">t</span><span class="op" id="5835685">.</span><span class="ident" id="5835686">Methods</span><span class="op" id="5835693">,</span>&nbsp;<span class="ident" id="5835695">t</span><span class="op" id="5835696">)</span>&nbsp;<span class="op" id="5835698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835703">t</span><span class="op" id="5835704">.</span><span class="ident" id="5835705">Incomplete</span>&nbsp;<span class="op" id="5835716">=</span>&nbsp;<span class="builtintype" id="5835718">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5835725">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835728">case</span>&nbsp;<span class="op" id="5835733">*</span><span class="ident" id="5835734">ast</span><span class="op" id="5835737">.</span><span class="ident" id="5835738">MapType</span><span class="op" id="5835745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835749">r</span><span class="op" id="5835750">.</span><span class="ident" id="5835751">filterType</span><span class="op" id="5835761">(</span><span class="ident" id="5835762">nil</span><span class="op" id="5835765">,</span>&nbsp;<span class="ident" id="5835767">t</span><span class="op" id="5835768">.</span><span class="ident" id="5835769">Key</span><span class="op" id="5835772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835776">r</span><span class="op" id="5835777">.</span><span class="ident" id="5835778">filterType</span><span class="op" id="5835788">(</span><span class="ident" id="5835789">nil</span><span class="op" id="5835792">,</span>&nbsp;<span class="ident" id="5835794">t</span><span class="op" id="5835795">.</span><span class="ident" id="5835796">Value</span><span class="op" id="5835801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835804">case</span>&nbsp;<span class="op" id="5835809">*</span><span class="ident" id="5835810">ast</span><span class="op" id="5835813">.</span><span class="ident" id="5835814">ChanType</span><span class="op" id="5835822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835826">r</span><span class="op" id="5835827">.</span><span class="ident" id="5835828">filterType</span><span class="op" id="5835838">(</span><span class="ident" id="5835839">nil</span><span class="op" id="5835842">,</span>&nbsp;<span class="ident" id="5835844">t</span><span class="op" id="5835845">.</span><span class="ident" id="5835846">Value</span><span class="op" id="5835851">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5835854">}</span><br>
<span class="lineno"></span><span class="op" id="5835856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5835859">func</span>&nbsp;<span class="op" id="5835864">(</span><span class="ident" id="5835865">r</span>&nbsp;<span class="op" id="5835867">*</span><span class="ident" id="5835868">reader</span><span class="op" id="5835874">)</span>&nbsp;<span class="ident" id="5835876">filterSpec</span><span class="op" id="5835886">(</span><span class="ident" id="5835887">spec</span>&nbsp;<span class="ident" id="5835892">ast</span><span class="op" id="5835895">.</span><span class="ident" id="5835896">Spec</span><span class="op" id="5835900">,</span>&nbsp;<span class="ident" id="5835902">tok</span>&nbsp;<span class="ident" id="5835906">token</span><span class="op" id="5835911">.</span><span class="ident" id="5835912">Token</span><span class="op" id="5835917">)</span>&nbsp;<span class="builtintype" id="5835919">bool</span>&nbsp;<span class="op" id="5835924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835927">switch</span>&nbsp;<span class="ident" id="5835934">s</span>&nbsp;<span class="op" id="5835936">:=</span>&nbsp;<span class="ident" id="5835939">spec</span><span class="op" id="5835943">.</span><span class="op" id="5835944">(</span><span class="keyword" id="5835945">type</span><span class="op" id="5835949">)</span>&nbsp;<span class="op" id="5835951">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835954">case</span>&nbsp;<span class="op" id="5835959">*</span><span class="ident" id="5835960">ast</span><span class="op" id="5835963">.</span><span class="ident" id="5835964">ImportSpec</span><span class="op" id="5835974">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5835978">//&nbsp;always&nbsp;keep&nbsp;imports&nbsp;so&nbsp;we&nbsp;can&nbsp;collect&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836026">return</span>&nbsp;<span class="builtintype" id="5836033">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836039">case</span>&nbsp;<span class="op" id="5836044">*</span><span class="ident" id="5836045">ast</span><span class="op" id="5836048">.</span><span class="ident" id="5836049">ValueSpec</span><span class="op" id="5836058">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5836062">//&nbsp;special&nbsp;case:&nbsp;consider&nbsp;blank&nbsp;constants&nbsp;as&nbsp;exported</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5836118">//&nbsp;(work-around&nbsp;for&nbsp;issue&nbsp;5397)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836152">s</span><span class="op" id="5836153">.</span><span class="ident" id="5836154">Names</span>&nbsp;<span class="op" id="5836160">=</span>&nbsp;<span class="ident" id="5836162">filterIdentList</span><span class="op" id="5836177">(</span><span class="ident" id="5836178">s</span><span class="op" id="5836179">.</span><span class="ident" id="5836180">Names</span><span class="op" id="5836185">,</span>&nbsp;<span class="ident" id="5836187">tok</span>&nbsp;<span class="op" id="5836191">==</span>&nbsp;<span class="ident" id="5836194">token</span><span class="op" id="5836199">.</span><span class="ident" id="5836200">CONST</span><span class="op" id="5836205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836209">if</span>&nbsp;<span class="builtinfunc" id="5836212">len</span><span class="op" id="5836215">(</span><span class="ident" id="5836216">s</span><span class="op" id="5836217">.</span><span class="ident" id="5836218">Names</span><span class="op" id="5836223">)</span>&nbsp;<span class="op" id="5836225">&gt;</span>&nbsp;<span class="num" id="5836227">0</span>&nbsp;<span class="op" id="5836229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836234">r</span><span class="op" id="5836235">.</span><span class="ident" id="5836236">filterType</span><span class="op" id="5836246">(</span><span class="ident" id="5836247">nil</span><span class="op" id="5836250">,</span>&nbsp;<span class="ident" id="5836252">s</span><span class="op" id="5836253">.</span><span class="ident" id="5836254">Type</span><span class="op" id="5836258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836263">return</span>&nbsp;<span class="builtintype" id="5836270">true</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5836277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836280">case</span>&nbsp;<span class="op" id="5836285">*</span><span class="ident" id="5836286">ast</span><span class="op" id="5836289">.</span><span class="ident" id="5836290">TypeSpec</span><span class="op" id="5836298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836302">if</span>&nbsp;<span class="ident" id="5836305">name</span>&nbsp;<span class="op" id="5836310">:=</span>&nbsp;<span class="ident" id="5836313">s</span><span class="op" id="5836314">.</span><span class="ident" id="5836315">Name</span><span class="op" id="5836319">.</span><span class="ident" id="5836320">Name</span><span class="op" id="5836324">;</span>&nbsp;<span class="ident" id="5836326">ast</span><span class="op" id="5836329">.</span><span class="ident" id="5836330">IsExported</span><span class="op" id="5836340">(</span><span class="ident" id="5836341">name</span><span class="op" id="5836345">)</span>&nbsp;<span class="op" id="5836347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836352">r</span><span class="op" id="5836353">.</span><span class="ident" id="5836354">filterType</span><span class="op" id="5836364">(</span><span class="ident" id="5836365">r</span><span class="op" id="5836366">.</span><span class="ident" id="5836367">lookupType</span><span class="op" id="5836377">(</span><span class="ident" id="5836378">s</span><span class="op" id="5836379">.</span><span class="ident" id="5836380">Name</span><span class="op" id="5836384">.</span><span class="ident" id="5836385">Name</span><span class="op" id="5836389">)</span><span class="op" id="5836390">,</span>&nbsp;<span class="ident" id="5836392">s</span><span class="op" id="5836393">.</span><span class="ident" id="5836394">Type</span><span class="op" id="5836398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836403">return</span>&nbsp;<span class="builtintype" id="5836410">true</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5836417">}</span>&nbsp;<span class="keyword" id="5836419">else</span>&nbsp;<span class="keyword" id="5836424">if</span>&nbsp;<span class="ident" id="5836427">name</span>&nbsp;<span class="op" id="5836432">==</span>&nbsp;<span class="string" id="5836435">&#34;error&#34;</span>&nbsp;<span class="op" id="5836443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5836448">//&nbsp;special&nbsp;case:&nbsp;remember&nbsp;that&nbsp;error&nbsp;is&nbsp;declared&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836508">r</span><span class="op" id="5836509">.</span><span class="ident" id="5836510">errorDecl</span>&nbsp;<span class="op" id="5836520">=</span>&nbsp;<span class="builtintype" id="5836522">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5836529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5836532">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836535">return</span>&nbsp;<span class="builtintype" id="5836542">false</span><br>
<span class="lineno"></span><span class="op" id="5836548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5836551">func</span>&nbsp;<span class="op" id="5836556">(</span><span class="ident" id="5836557">r</span>&nbsp;<span class="op" id="5836559">*</span><span class="ident" id="5836560">reader</span><span class="op" id="5836566">)</span>&nbsp;<span class="ident" id="5836568">filterSpecList</span><span class="op" id="5836582">(</span><span class="ident" id="5836583">list</span>&nbsp;<span class="op" id="5836588">[</span><span class="op" id="5836589">]</span><span class="ident" id="5836590">ast</span><span class="op" id="5836593">.</span><span class="ident" id="5836594">Spec</span><span class="op" id="5836598">,</span>&nbsp;<span class="ident" id="5836600">tok</span>&nbsp;<span class="ident" id="5836604">token</span><span class="op" id="5836609">.</span><span class="ident" id="5836610">Token</span><span class="op" id="5836615">)</span>&nbsp;<span class="op" id="5836617">[</span><span class="op" id="5836618">]</span><span class="ident" id="5836619">ast</span><span class="op" id="5836622">.</span><span class="ident" id="5836623">Spec</span>&nbsp;<span class="op" id="5836628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836631">j</span>&nbsp;<span class="op" id="5836633">:=</span>&nbsp;<span class="num" id="5836636">0</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836639">for</span>&nbsp;<span class="ident" id="5836643">_</span><span class="op" id="5836644">,</span>&nbsp;<span class="ident" id="5836646">s</span>&nbsp;<span class="op" id="5836648">:=</span>&nbsp;<span class="keyword" id="5836651">range</span>&nbsp;<span class="ident" id="5836657">list</span>&nbsp;<span class="op" id="5836662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836666">if</span>&nbsp;<span class="ident" id="5836669">r</span><span class="op" id="5836670">.</span><span class="ident" id="5836671">filterSpec</span><span class="op" id="5836681">(</span><span class="ident" id="5836682">s</span><span class="op" id="5836683">,</span>&nbsp;<span class="ident" id="5836685">tok</span><span class="op" id="5836688">)</span>&nbsp;<span class="op" id="5836690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836695">list</span><span class="op" id="5836699">[</span><span class="ident" id="5836700">j</span><span class="op" id="5836701">]</span>&nbsp;<span class="op" id="5836703">=</span>&nbsp;<span class="ident" id="5836705">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836710">j</span><span class="op" id="5836711">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5836716">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5836719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836722">return</span>&nbsp;<span class="ident" id="5836729">list</span><span class="op" id="5836733">[</span><span class="num" id="5836734">0</span><span class="op" id="5836735">:</span><span class="ident" id="5836736">j</span><span class="op" id="5836737">]</span><br>
<span class="lineno"></span><span class="op" id="5836739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5836742">func</span>&nbsp;<span class="op" id="5836747">(</span><span class="ident" id="5836748">r</span>&nbsp;<span class="op" id="5836750">*</span><span class="ident" id="5836751">reader</span><span class="op" id="5836757">)</span>&nbsp;<span class="ident" id="5836759">filterDecl</span><span class="op" id="5836769">(</span><span class="ident" id="5836770">decl</span>&nbsp;<span class="ident" id="5836775">ast</span><span class="op" id="5836778">.</span><span class="ident" id="5836779">Decl</span><span class="op" id="5836783">)</span>&nbsp;<span class="builtintype" id="5836785">bool</span>&nbsp;<span class="op" id="5836790">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836793">switch</span>&nbsp;<span class="ident" id="5836800">d</span>&nbsp;<span class="op" id="5836802">:=</span>&nbsp;<span class="ident" id="5836805">decl</span><span class="op" id="5836809">.</span><span class="op" id="5836810">(</span><span class="keyword" id="5836811">type</span><span class="op" id="5836815">)</span>&nbsp;<span class="op" id="5836817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836820">case</span>&nbsp;<span class="op" id="5836825">*</span><span class="ident" id="5836826">ast</span><span class="op" id="5836829">.</span><span class="ident" id="5836830">GenDecl</span><span class="op" id="5836837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836841">d</span><span class="op" id="5836842">.</span><span class="ident" id="5836843">Specs</span>&nbsp;<span class="op" id="5836849">=</span>&nbsp;<span class="ident" id="5836851">r</span><span class="op" id="5836852">.</span><span class="ident" id="5836853">filterSpecList</span><span class="op" id="5836867">(</span><span class="ident" id="5836868">d</span><span class="op" id="5836869">.</span><span class="ident" id="5836870">Specs</span><span class="op" id="5836875">,</span>&nbsp;<span class="ident" id="5836877">d</span><span class="op" id="5836878">.</span><span class="ident" id="5836879">Tok</span><span class="op" id="5836882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836886">return</span>&nbsp;<span class="builtinfunc" id="5836893">len</span><span class="op" id="5836896">(</span><span class="ident" id="5836897">d</span><span class="op" id="5836898">.</span><span class="ident" id="5836899">Specs</span><span class="op" id="5836904">)</span>&nbsp;<span class="op" id="5836906">&gt;</span>&nbsp;<span class="num" id="5836908">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836911">case</span>&nbsp;<span class="op" id="5836916">*</span><span class="ident" id="5836917">ast</span><span class="op" id="5836920">.</span><span class="ident" id="5836921">FuncDecl</span><span class="op" id="5836929">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5836933">//&nbsp;ok&nbsp;to&nbsp;filter&nbsp;these&nbsp;methods&nbsp;early&nbsp;because&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5836983">//&nbsp;conflicting&nbsp;method&nbsp;will&nbsp;be&nbsp;filtered&nbsp;here,&nbsp;too&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5837036">//&nbsp;thus,&nbsp;removing&nbsp;these&nbsp;methods&nbsp;early&nbsp;will&nbsp;not&nbsp;lead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5837090">//&nbsp;to&nbsp;the&nbsp;false&nbsp;removal&nbsp;of&nbsp;possible&nbsp;conflicts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5837138">return</span>&nbsp;<span class="ident" id="5837145">ast</span><span class="op" id="5837148">.</span><span class="ident" id="5837149">IsExported</span><span class="op" id="5837159">(</span><span class="ident" id="5837160">d</span><span class="op" id="5837161">.</span><span class="ident" id="5837162">Name</span><span class="op" id="5837166">.</span><span class="ident" id="5837167">Name</span><span class="op" id="5837171">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5837174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5837177">return</span>&nbsp;<span class="builtintype" id="5837184">false</span><br>
<span class="lineno"></span><span class="op" id="5837190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5837193">//&nbsp;fileExports&nbsp;removes&nbsp;unexported&nbsp;declarations&nbsp;from&nbsp;src&nbsp;in&nbsp;place.</span><br>
<span class="lineno">195</span><span class="comment" id="5837259">//</span><br>
<span class="lineno"></span><span class="keyword" id="5837262">func</span>&nbsp;<span class="op" id="5837267">(</span><span class="ident" id="5837268">r</span>&nbsp;<span class="op" id="5837270">*</span><span class="ident" id="5837271">reader</span><span class="op" id="5837277">)</span>&nbsp;<span class="ident" id="5837279">fileExports</span><span class="op" id="5837290">(</span><span class="ident" id="5837291">src</span>&nbsp;<span class="op" id="5837295">*</span><span class="ident" id="5837296">ast</span><span class="op" id="5837299">.</span><span class="ident" id="5837300">File</span><span class="op" id="5837304">)</span>&nbsp;<span class="op" id="5837306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5837309">j</span>&nbsp;<span class="op" id="5837311">:=</span>&nbsp;<span class="num" id="5837314">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5837317">for</span>&nbsp;<span class="ident" id="5837321">_</span><span class="op" id="5837322">,</span>&nbsp;<span class="ident" id="5837324">d</span>&nbsp;<span class="op" id="5837326">:=</span>&nbsp;<span class="keyword" id="5837329">range</span>&nbsp;<span class="ident" id="5837335">src</span><span class="op" id="5837338">.</span><span class="ident" id="5837339">Decls</span>&nbsp;<span class="op" id="5837345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5837349">if</span>&nbsp;<span class="ident" id="5837352">r</span><span class="op" id="5837353">.</span><span class="ident" id="5837354">filterDecl</span><span class="op" id="5837364">(</span><span class="ident" id="5837365">d</span><span class="op" id="5837366">)</span>&nbsp;<span class="op" id="5837368">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5837373">src</span><span class="op" id="5837376">.</span><span class="ident" id="5837377">Decls</span><span class="op" id="5837382">[</span><span class="ident" id="5837383">j</span><span class="op" id="5837384">]</span>&nbsp;<span class="op" id="5837386">=</span>&nbsp;<span class="ident" id="5837388">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5837393">j</span><span class="op" id="5837394">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5837399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5837402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5837405">src</span><span class="op" id="5837408">.</span><span class="ident" id="5837409">Decls</span>&nbsp;<span class="op" id="5837415">=</span>&nbsp;<span class="ident" id="5837417">src</span><span class="op" id="5837420">.</span><span class="ident" id="5837421">Decls</span><span class="op" id="5837426">[</span><span class="num" id="5837427">0</span><span class="op" id="5837428">:</span><span class="ident" id="5837429">j</span><span class="op" id="5837430">]</span><br>
<span class="lineno">205</span><span class="op" id="5837432">}</span>
</div>
</body>
</html>
