<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3211306">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3211362">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3211416">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3211467">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="3211534">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="3211593">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="3211634">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="3211681">//</span><br>
<span class="lineno">10</span><span class="comment" id="3211684">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3211749">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="3211783">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="3211834">//</span><br>
<span class="lineno"></span><span class="comment" id="3211837">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="3211891">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3211920">//</span><br>
<span class="lineno"></span><span class="comment" id="3211923">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="3211989">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3212057">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="3212102">//</span><br>
<span class="lineno"></span><span class="comment" id="3212105">//&nbsp;&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="3212121">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="3212182">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp}()</span><br>
<span class="lineno"></span><span class="comment" id="3212190">//</span><br>
<span class="lineno">25</span><span class="comment" id="3212193">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="3212249">//</span><br>
<span class="lineno"></span><span class="comment" id="3212252">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="3212308">//</span><br>
<span class="lineno"></span><span class="comment" id="3212311">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="3212353">//</span><br>
<span class="lineno"></span><span class="comment" id="3212356">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="3212415">//</span><br>
<span class="lineno"></span><span class="comment" id="3212418">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="3212467">//</span><br>
<span class="lineno">35</span><span class="comment" id="3212470">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="3212527">//</span><br>
<span class="lineno"></span><span class="comment" id="3212530">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="3212605">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="3212625">//</span><br>
<span class="lineno">40</span><span class="comment" id="3212628">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="3212676">//</span><br>
<span class="lineno"></span><span class="comment" id="3212679">//&nbsp;&nbsp;&nbsp;&nbsphttp://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="3212740">//</span><br>
<span class="lineno"></span><span class="keyword" id="3212743">package</span>&nbsp;<span class="ident" id="3212751">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3212758">import</span>&nbsp;<span class="op" id="3212765">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3212768">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3212777">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3212786">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3212793">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3212810">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3212816">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3212823">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3212835">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3212841">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3212852">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3212869">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3212880">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3212891">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="3212898">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3212901">func</span>&nbsp;<span class="ident" id="3212906">init</span><span class="op" id="3212910">(</span><span class="op" id="3212911">)</span>&nbsp;<span class="op" id="3212913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3212916"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3212920">.</span><span class="ident" id="3212921">Handle</span><span class="op" id="3212927">(</span><span class="string" id="3212928">&#34;/debug/pprof/&#34;</span><span class="op" id="3212943">,</span>&nbsp;<span class="ident" id="3212945"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3212949">.</span><span class="ident" id="3212950">HandlerFunc</span><span class="op" id="3212961">(</span><span class="ident" id="3212962"><a href="/net/http/pprof/pprof.go.html#3216496">Index</a></span><span class="op" id="3212967">)</span><span class="op" id="3212968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3212971"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3212975">.</span><span class="ident" id="3212976">Handle</span><span class="op" id="3212982">(</span><span class="string" id="3212983">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="3213005">,</span>&nbsp;<span class="ident" id="3213007"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3213011">.</span><span class="ident" id="3213012">HandlerFunc</span><span class="op" id="3213023">(</span><span class="ident" id="3213024"><a href="/net/http/pprof/pprof.go.html#3213339">Cmdline</a></span><span class="op" id="3213031">)</span><span class="op" id="3213032">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3213035"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3213039">.</span><span class="ident" id="3213040">Handle</span><span class="op" id="3213046">(</span><span class="string" id="3213047">&#34;/debug/pprof/profile&#34;</span><span class="op" id="3213069">,</span>&nbsp;<span class="ident" id="3213071"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3213075">.</span><span class="ident" id="3213076">HandlerFunc</span><span class="op" id="3213087">(</span><span class="ident" id="3213088"><a href="/net/http/pprof/pprof.go.html#3213631">Profile</a></span><span class="op" id="3213095">)</span><span class="op" id="3213096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3213099"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3213103">.</span><span class="ident" id="3213104">Handle</span><span class="op" id="3213110">(</span><span class="string" id="3213111">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="3213132">,</span>&nbsp;<span class="ident" id="3213134"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3213138">.</span><span class="ident" id="3213139">HandlerFunc</span><span class="op" id="3213150">(</span><span class="ident" id="3213151"><a href="/net/http/pprof/pprof.go.html#3214560">Symbol</a></span><span class="op" id="3213157">)</span><span class="op" id="3213158">)</span><br>
<span class="lineno"></span><span class="op" id="3213160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3213163">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="3213210">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="3213266">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="3213334">func</span>&nbsp;<span class="ident" id="3213339">Cmdline</span><span class="op" id="3213346">(</span><span class="ident" id="3213347">w</span>&nbsp;<span class="ident" id="3213349"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3213353">.</span><span class="ident" id="3213354">ResponseWriter</span><span class="op" id="3213368">,</span>&nbsp;<span class="ident" id="3213370">r</span>&nbsp;<span class="op" id="3213372">*</span><span class="ident" id="3213373"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3213377">.</span><span class="ident" id="3213378">Request</span><span class="op" id="3213385">)</span>&nbsp;<span class="op" id="3213387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3213390"><a href="/net/http/pprof/pprof.go.html#3213347">w</a></span><span class="op" id="3213391">.</span><span class="ident" id="3213392">Header</span><span class="op" id="3213398">(</span><span class="op" id="3213399">)</span><span class="op" id="3213400">.</span><span class="ident" id="3213401">Set</span><span class="op" id="3213404">(</span><span class="string" id="3213405">&#34;Content-Type&#34;</span><span class="op" id="3213419">,</span>&nbsp;<span class="string" id="3213421">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="3213448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3213451"><a href="/net/http/pprof/pprof.go.html#3212786">fmt</a></span><span class="op" id="3213454">.</span><span class="ident" id="3213455">Fprintf</span><span class="op" id="3213462">(</span><span class="ident" id="3213463"><a href="/net/http/pprof/pprof.go.html#3213347">w</a></span><span class="op" id="3213464">,</span>&nbsp;<span class="ident" id="3213466"><a href="/net/http/pprof/pprof.go.html#3212880">strings</a></span><span class="op" id="3213473">.</span><span class="ident" id="3213474">Join</span><span class="op" id="3213478">(</span><span class="ident" id="3213479"><a href="/net/http/pprof/pprof.go.html#3212835">os</a></span><span class="op" id="3213481">.</span><span class="ident" id="3213482">Args</span><span class="op" id="3213486">,</span>&nbsp;<span class="string" id="3213488">&#34;\x00&#34;</span><span class="op" id="3213494">)</span><span class="op" id="3213495">)</span><br>
<span class="lineno">75</span><span class="op" id="3213497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3213500">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="3213558">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="3213626">func</span>&nbsp;<span class="ident" id="3213631">Profile</span><span class="op" id="3213638">(</span><span class="ident" id="3213639">w</span>&nbsp;<span class="ident" id="3213641"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3213645">.</span><span class="ident" id="3213646">ResponseWriter</span><span class="op" id="3213660">,</span>&nbsp;<span class="ident" id="3213662">r</span>&nbsp;<span class="op" id="3213664">*</span><span class="ident" id="3213665"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3213669">.</span><span class="ident" id="3213670">Request</span><span class="op" id="3213677">)</span>&nbsp;<span class="op" id="3213679">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3213682">sec</span><span class="op" id="3213685">,</span>&nbsp;<span class="ident" id="3213687">_</span>&nbsp;<span class="op" id="3213689">:=</span>&nbsp;<span class="ident" id="3213692"><a href="/net/http/pprof/pprof.go.html#3212869">strconv</a></span><span class="op" id="3213699">.</span><span class="ident" id="3213700">ParseInt</span><span class="op" id="3213708">(</span><span class="ident" id="3213709"><a href="/net/http/pprof/pprof.go.html#3213662">r</a></span><span class="op" id="3213710">.</span><span class="ident" id="3213711">FormValue</span><span class="op" id="3213720">(</span><span class="string" id="3213721">&#34;seconds&#34;</span><span class="op" id="3213730">)</span><span class="op" id="3213731">,</span>&nbsp;<span class="num" id="3213733">10</span><span class="op" id="3213735">,</span>&nbsp;<span class="num" id="3213737">64</span><span class="op" id="3213739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213742">if</span>&nbsp;<span class="ident" id="3213745"><a href="/net/http/pprof/pprof.go.html#3213682">sec</a></span>&nbsp;<span class="op" id="3213749">==</span>&nbsp;<span class="num" id="3213752">0</span>&nbsp;<span class="op" id="3213754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3213758"><a href="/net/http/pprof/pprof.go.html#3213682">sec</a></span>&nbsp;<span class="op" id="3213762">=</span>&nbsp;<span class="num" id="3213764">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3213768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3213772">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3213829">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3213871"><a href="/net/http/pprof/pprof.go.html#3213639">w</a></span><span class="op" id="3213872">.</span><span class="ident" id="3213873">Header</span><span class="op" id="3213879">(</span><span class="op" id="3213880">)</span><span class="op" id="3213881">.</span><span class="ident" id="3213882">Set</span><span class="op" id="3213885">(</span><span class="string" id="3213886">&#34;Content-Type&#34;</span><span class="op" id="3213900">,</span>&nbsp;<span class="string" id="3213902">&#34;application/octet-stream&#34;</span><span class="op" id="3213928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213931">if</span>&nbsp;<span class="ident" id="3213934">err</span>&nbsp;<span class="op" id="3213938">:=</span>&nbsp;<span class="ident" id="3213941"><a href="/net/http/pprof/pprof.go.html#3212852">pprof</a></span><span class="op" id="3213946">.</span><span class="ident" id="3213947">StartCPUProfile</span><span class="op" id="3213962">(</span><span class="ident" id="3213963"><a href="/net/http/pprof/pprof.go.html#3213639">w</a></span><span class="op" id="3213964">)</span><span class="op" id="3213965">;</span>&nbsp;<span class="ident" id="3213967"><a href="/net/http/pprof/pprof.go.html#3213934">err</a></span>&nbsp;<span class="op" id="3213971">!=</span>&nbsp;<span class="ident" id="3213974">nil</span>&nbsp;<span class="op" id="3213978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3213982">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3214029">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3214073">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3214099"><a href="/net/http/pprof/pprof.go.html#3213639">w</a></span><span class="op" id="3214100">.</span><span class="ident" id="3214101">Header</span><span class="op" id="3214107">(</span><span class="op" id="3214108">)</span><span class="op" id="3214109">.</span><span class="ident" id="3214110">Set</span><span class="op" id="3214113">(</span><span class="string" id="3214114">&#34;Content-Type&#34;</span><span class="op" id="3214128">,</span>&nbsp;<span class="string" id="3214130">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="3214157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3214161"><a href="/net/http/pprof/pprof.go.html#3213639">w</a></span><span class="op" id="3214162">.</span><span class="ident" id="3214163">WriteHeader</span><span class="op" id="3214174">(</span><span class="ident" id="3214175"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3214179">.</span><span class="ident" id="3214180">StatusInternalServerError</span><span class="op" id="3214205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3214209"><a href="/net/http/pprof/pprof.go.html#3212786">fmt</a></span><span class="op" id="3214212">.</span><span class="ident" id="3214213">Fprintf</span><span class="op" id="3214220">(</span><span class="ident" id="3214221"><a href="/net/http/pprof/pprof.go.html#3213639">w</a></span><span class="op" id="3214222">,</span>&nbsp;<span class="string" id="3214224">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="3214262">,</span>&nbsp;<span class="ident" id="3214264"><a href="/net/http/pprof/pprof.go.html#3213934">err</a></span><span class="op" id="3214267">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3214271">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3214279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3214282"><a href="/net/http/pprof/pprof.go.html#3212891">time</a></span><span class="op" id="3214286">.</span><span class="ident" id="3214287">Sleep</span><span class="op" id="3214292">(</span><span class="ident" id="3214293"><a href="/net/http/pprof/pprof.go.html#3212891">time</a></span><span class="op" id="3214297">.</span><span class="ident" id="3214298">Duration</span><span class="op" id="3214306">(</span><span class="ident" id="3214307"><a href="/net/http/pprof/pprof.go.html#3213682">sec</a></span><span class="op" id="3214310">)</span>&nbsp;<span class="op" id="3214312">*</span>&nbsp;<span class="ident" id="3214314"><a href="/net/http/pprof/pprof.go.html#3212891">time</a></span><span class="op" id="3214318">.</span><span class="ident" id="3214319">Second</span><span class="op" id="3214325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3214328"><a href="/net/http/pprof/pprof.go.html#3212852">pprof</a></span><span class="op" id="3214333">.</span><span class="ident" id="3214334">StopCPUProfile</span><span class="op" id="3214348">(</span><span class="op" id="3214349">)</span><br>
<span class="lineno"></span><span class="op" id="3214351">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3214354">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="3214417">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="3214488">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="3214555">func</span>&nbsp;<span class="ident" id="3214560">Symbol</span><span class="op" id="3214566">(</span><span class="ident" id="3214567">w</span>&nbsp;<span class="ident" id="3214569"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3214573">.</span><span class="ident" id="3214574">ResponseWriter</span><span class="op" id="3214588">,</span>&nbsp;<span class="ident" id="3214590">r</span>&nbsp;<span class="op" id="3214592">*</span><span class="ident" id="3214593"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3214597">.</span><span class="ident" id="3214598">Request</span><span class="op" id="3214605">)</span>&nbsp;<span class="op" id="3214607">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3214610"><a href="/net/http/pprof/pprof.go.html#3214567">w</a></span><span class="op" id="3214611">.</span><span class="ident" id="3214612">Header</span><span class="op" id="3214618">(</span><span class="op" id="3214619">)</span><span class="op" id="3214620">.</span><span class="ident" id="3214621">Set</span><span class="op" id="3214624">(</span><span class="string" id="3214625">&#34;Content-Type&#34;</span><span class="op" id="3214639">,</span>&nbsp;<span class="string" id="3214641">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="3214668">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3214672">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3214719">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3214768">var</span>&nbsp;<span class="ident" id="3214772">buf</span>&nbsp;<span class="ident" id="3214776"><a href="/net/http/pprof/pprof.go.html#3212777">bytes</a></span><span class="op" id="3214781">.</span><span class="ident" id="3214782">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3214791">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3214842">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3214900">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3214952"><a href="/net/http/pprof/pprof.go.html#3212786">fmt</a></span><span class="op" id="3214955">.</span><span class="ident" id="3214956">Fprintf</span><span class="op" id="3214963">(</span><span class="op" id="3214964">&amp;</span><span class="ident" id="3214965"><a href="/net/http/pprof/pprof.go.html#3214772">buf</a></span><span class="op" id="3214968">,</span>&nbsp;<span class="string" id="3214970">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="3214988">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3214992">var</span>&nbsp;<span class="ident" id="3214996">b</span>&nbsp;<span class="op" id="3214998">*</span><span class="ident" id="3214999"><a href="/net/http/pprof/pprof.go.html#3212768">bufio</a></span><span class="op" id="3215004">.</span><span class="ident" id="3215005">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215013">if</span>&nbsp;<span class="ident" id="3215016"><a href="/net/http/pprof/pprof.go.html#3214590">r</a></span><span class="op" id="3215017">.</span><span class="ident" id="3215018">Method</span>&nbsp;<span class="op" id="3215025">==</span>&nbsp;<span class="string" id="3215028">&#34;POST&#34;</span>&nbsp;<span class="op" id="3215035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215039"><a href="/net/http/pprof/pprof.go.html#3214996">b</a></span>&nbsp;<span class="op" id="3215041">=</span>&nbsp;<span class="ident" id="3215043"><a href="/net/http/pprof/pprof.go.html#3212768">bufio</a></span><span class="op" id="3215048">.</span><span class="ident" id="3215049">NewReader</span><span class="op" id="3215058">(</span><span class="ident" id="3215059"><a href="/net/http/pprof/pprof.go.html#3214590">r</a></span><span class="op" id="3215060">.</span><span class="ident" id="3215061">Body</span><span class="op" id="3215065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215068">}</span>&nbsp;<span class="keyword" id="3215070">else</span>&nbsp;<span class="op" id="3215075">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215079"><a href="/net/http/pprof/pprof.go.html#3214996">b</a></span>&nbsp;<span class="op" id="3215081">=</span>&nbsp;<span class="ident" id="3215083"><a href="/net/http/pprof/pprof.go.html#3212768">bufio</a></span><span class="op" id="3215088">.</span><span class="ident" id="3215089">NewReader</span><span class="op" id="3215098">(</span><span class="ident" id="3215099"><a href="/net/http/pprof/pprof.go.html#3212880">strings</a></span><span class="op" id="3215106">.</span><span class="ident" id="3215107">NewReader</span><span class="op" id="3215116">(</span><span class="ident" id="3215117"><a href="/net/http/pprof/pprof.go.html#3214590">r</a></span><span class="op" id="3215118">.</span><span class="ident" id="3215119">URL</span><span class="op" id="3215122">.</span><span class="ident" id="3215123">RawQuery</span><span class="op" id="3215131">)</span><span class="op" id="3215132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215139">for</span>&nbsp;<span class="op" id="3215143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215147">word</span><span class="op" id="3215151">,</span>&nbsp;<span class="ident" id="3215153">err</span>&nbsp;<span class="op" id="3215157">:=</span>&nbsp;<span class="ident" id="3215160"><a href="/net/http/pprof/pprof.go.html#3214996">b</a></span><span class="op" id="3215161">.</span><span class="ident" id="3215162">ReadSlice</span><span class="op" id="3215171">(</span><span class="string" id="3215172">&#39;+&#39;</span><span class="op" id="3215175">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215179">if</span>&nbsp;<span class="ident" id="3215182"><a href="/net/http/pprof/pprof.go.html#3215153">err</a></span>&nbsp;<span class="op" id="3215186">==</span>&nbsp;<span class="ident" id="3215189">nil</span>&nbsp;<span class="op" id="3215193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215198"><a href="/net/http/pprof/pprof.go.html#3215147">word</a></span>&nbsp;<span class="op" id="3215203">=</span>&nbsp;<span class="ident" id="3215205"><a href="/net/http/pprof/pprof.go.html#3215147">word</a></span><span class="op" id="3215209">[</span><span class="num" id="3215210">0</span>&nbsp;<span class="op" id="3215212">:</span>&nbsp;<span class="builtinfunc" id="3215214">len</span><span class="op" id="3215217">(</span><span class="ident" id="3215218"><a href="/net/http/pprof/pprof.go.html#3215147">word</a></span><span class="op" id="3215222">)</span><span class="op" id="3215223">-</span><span class="num" id="3215224">1</span><span class="op" id="3215225">]</span>&nbsp;<span class="comment" id="3215227">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215243">pc</span><span class="op" id="3215245">,</span>&nbsp;<span class="ident" id="3215247">_</span>&nbsp;<span class="op" id="3215249">:=</span>&nbsp;<span class="ident" id="3215252"><a href="/net/http/pprof/pprof.go.html#3212869">strconv</a></span><span class="op" id="3215259">.</span><span class="ident" id="3215260">ParseUint</span><span class="op" id="3215269">(</span><span class="builtintype" id="3215270">string</span><span class="op" id="3215276">(</span><span class="ident" id="3215277"><a href="/net/http/pprof/pprof.go.html#3215147">word</a></span><span class="op" id="3215281">)</span><span class="op" id="3215282">,</span>&nbsp;<span class="num" id="3215284">0</span><span class="op" id="3215285">,</span>&nbsp;<span class="num" id="3215287">64</span><span class="op" id="3215289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215293">if</span>&nbsp;<span class="ident" id="3215296"><a href="/net/http/pprof/pprof.go.html#3215243">pc</a></span>&nbsp;<span class="op" id="3215299">!=</span>&nbsp;<span class="num" id="3215302">0</span>&nbsp;<span class="op" id="3215304">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215309">f</span>&nbsp;<span class="op" id="3215311">:=</span>&nbsp;<span class="ident" id="3215314"><a href="/net/http/pprof/pprof.go.html#3212841">runtime</a></span><span class="op" id="3215321">.</span><span class="ident" id="3215322">FuncForPC</span><span class="op" id="3215331">(</span><span class="builtintype" id="3215332">uintptr</span><span class="op" id="3215339">(</span><span class="ident" id="3215340"><a href="/net/http/pprof/pprof.go.html#3215243">pc</a></span><span class="op" id="3215342">)</span><span class="op" id="3215343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215348">if</span>&nbsp;<span class="ident" id="3215351"><a href="/net/http/pprof/pprof.go.html#3215309">f</a></span>&nbsp;<span class="op" id="3215353">!=</span>&nbsp;<span class="ident" id="3215356">nil</span>&nbsp;<span class="op" id="3215360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215366"><a href="/net/http/pprof/pprof.go.html#3212786">fmt</a></span><span class="op" id="3215369">.</span><span class="ident" id="3215370">Fprintf</span><span class="op" id="3215377">(</span><span class="op" id="3215378">&amp;</span><span class="ident" id="3215379"><a href="/net/http/pprof/pprof.go.html#3214772">buf</a></span><span class="op" id="3215382">,</span>&nbsp;<span class="string" id="3215384">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="3215394">,</span>&nbsp;<span class="ident" id="3215396"><a href="/net/http/pprof/pprof.go.html#3215243">pc</a></span><span class="op" id="3215398">,</span>&nbsp;<span class="ident" id="3215400"><a href="/net/http/pprof/pprof.go.html#3215309">f</a></span><span class="op" id="3215401">.</span><span class="ident" id="3215402">Name</span><span class="op" id="3215406">(</span><span class="op" id="3215407">)</span><span class="op" id="3215408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215417">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3215422">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3215470">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215528">if</span>&nbsp;<span class="ident" id="3215531"><a href="/net/http/pprof/pprof.go.html#3215153">err</a></span>&nbsp;<span class="op" id="3215535">!=</span>&nbsp;<span class="ident" id="3215538">nil</span>&nbsp;<span class="op" id="3215542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215547">if</span>&nbsp;<span class="ident" id="3215550"><a href="/net/http/pprof/pprof.go.html#3215153">err</a></span>&nbsp;<span class="op" id="3215554">!=</span>&nbsp;<span class="ident" id="3215557"><a href="/net/http/pprof/pprof.go.html#3212810">io</a></span><span class="op" id="3215559">.</span><span class="ident" id="3215560">EOF</span>&nbsp;<span class="op" id="3215564">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215570"><a href="/net/http/pprof/pprof.go.html#3212786">fmt</a></span><span class="op" id="3215573">.</span><span class="ident" id="3215574">Fprintf</span><span class="op" id="3215581">(</span><span class="op" id="3215582">&amp;</span><span class="ident" id="3215583"><a href="/net/http/pprof/pprof.go.html#3214772">buf</a></span><span class="op" id="3215586">,</span>&nbsp;<span class="string" id="3215588">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="3215611">,</span>&nbsp;<span class="ident" id="3215613"><a href="/net/http/pprof/pprof.go.html#3215153">err</a></span><span class="op" id="3215616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215626">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215637">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215641"><a href="/net/http/pprof/pprof.go.html#3214567">w</a></span><span class="op" id="3215642">.</span><span class="ident" id="3215643">Write</span><span class="op" id="3215648">(</span><span class="ident" id="3215649"><a href="/net/http/pprof/pprof.go.html#3214772">buf</a></span><span class="op" id="3215652">.</span><span class="ident" id="3215653">Bytes</span><span class="op" id="3215658">(</span><span class="op" id="3215659">)</span><span class="op" id="3215660">)</span><br>
<span class="lineno"></span><span class="op" id="3215662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3215665">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="3215731">func</span>&nbsp;<span class="ident" id="3215736">Handler</span><span class="op" id="3215743">(</span><span class="ident" id="3215744">name</span>&nbsp;<span class="builtintype" id="3215749">string</span><span class="op" id="3215755">)</span>&nbsp;<span class="ident" id="3215757"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3215761">.</span><span class="ident" id="3215762">Handler</span>&nbsp;<span class="op" id="3215770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215773">return</span>&nbsp;<span class="ident" id="3215780"><a href="/net/http/pprof/pprof.go.html#3215802">handler</a></span><span class="op" id="3215787">(</span><span class="ident" id="3215788"><a href="/net/http/pprof/pprof.go.html#3215744">name</a></span><span class="op" id="3215792">)</span><br>
<span class="lineno"></span><span class="op" id="3215794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3215797">type</span>&nbsp;<span class="ident" id="3215802">handler</span>&nbsp;<span class="builtintype" id="3215810">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="3215818">func</span>&nbsp;<span class="op" id="3215823">(</span><span class="ident" id="3215824">name</span>&nbsp;<span class="ident" id="3215829"><a href="/net/http/pprof/pprof.go.html#3215802">handler</a></span><span class="op" id="3215836">)</span>&nbsp;<span class="ident" id="3215838">ServeHTTP</span><span class="op" id="3215847">(</span><span class="ident" id="3215848">w</span>&nbsp;<span class="ident" id="3215850"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3215854">.</span><span class="ident" id="3215855">ResponseWriter</span><span class="op" id="3215869">,</span>&nbsp;<span class="ident" id="3215871">r</span>&nbsp;<span class="op" id="3215873">*</span><span class="ident" id="3215874"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3215878">.</span><span class="ident" id="3215879">Request</span><span class="op" id="3215886">)</span>&nbsp;<span class="op" id="3215888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215891"><a href="/net/http/pprof/pprof.go.html#3215848">w</a></span><span class="op" id="3215892">.</span><span class="ident" id="3215893">Header</span><span class="op" id="3215899">(</span><span class="op" id="3215900">)</span><span class="op" id="3215901">.</span><span class="ident" id="3215902">Set</span><span class="op" id="3215905">(</span><span class="string" id="3215906">&#34;Content-Type&#34;</span><span class="op" id="3215920">,</span>&nbsp;<span class="string" id="3215922">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="3215949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215952">debug</span><span class="op" id="3215957">,</span>&nbsp;<span class="ident" id="3215959">_</span>&nbsp;<span class="op" id="3215961">:=</span>&nbsp;<span class="ident" id="3215964"><a href="/net/http/pprof/pprof.go.html#3212869">strconv</a></span><span class="op" id="3215971">.</span><span class="ident" id="3215972">Atoi</span><span class="op" id="3215976">(</span><span class="ident" id="3215977"><a href="/net/http/pprof/pprof.go.html#3215871">r</a></span><span class="op" id="3215978">.</span><span class="ident" id="3215979">FormValue</span><span class="op" id="3215988">(</span><span class="string" id="3215989">&#34;debug&#34;</span><span class="op" id="3215996">)</span><span class="op" id="3215997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3216000">p</span>&nbsp;<span class="op" id="3216002">:=</span>&nbsp;<span class="ident" id="3216005"><a href="/net/http/pprof/pprof.go.html#3212852">pprof</a></span><span class="op" id="3216010">.</span><span class="ident" id="3216011">Lookup</span><span class="op" id="3216017">(</span><span class="builtintype" id="3216018">string</span><span class="op" id="3216024">(</span><span class="ident" id="3216025"><a href="/net/http/pprof/pprof.go.html#3215824">name</a></span><span class="op" id="3216029">)</span><span class="op" id="3216030">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216033">if</span>&nbsp;<span class="ident" id="3216036"><a href="/net/http/pprof/pprof.go.html#3216000">p</a></span>&nbsp;<span class="op" id="3216038">==</span>&nbsp;<span class="ident" id="3216041">nil</span>&nbsp;<span class="op" id="3216045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3216049"><a href="/net/http/pprof/pprof.go.html#3215848">w</a></span><span class="op" id="3216050">.</span><span class="ident" id="3216051">WriteHeader</span><span class="op" id="3216062">(</span><span class="num" id="3216063">404</span><span class="op" id="3216066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3216070"><a href="/net/http/pprof/pprof.go.html#3212786">fmt</a></span><span class="op" id="3216073">.</span><span class="ident" id="3216074">Fprintf</span><span class="op" id="3216081">(</span><span class="ident" id="3216082"><a href="/net/http/pprof/pprof.go.html#3215848">w</a></span><span class="op" id="3216083">,</span>&nbsp;<span class="string" id="3216085">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="3216108">,</span>&nbsp;<span class="ident" id="3216110"><a href="/net/http/pprof/pprof.go.html#3215824">name</a></span><span class="op" id="3216114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216118">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3216126">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3216129">gc</span><span class="op" id="3216131">,</span>&nbsp;<span class="ident" id="3216133">_</span>&nbsp;<span class="op" id="3216135">:=</span>&nbsp;<span class="ident" id="3216138"><a href="/net/http/pprof/pprof.go.html#3212869">strconv</a></span><span class="op" id="3216145">.</span><span class="ident" id="3216146">Atoi</span><span class="op" id="3216150">(</span><span class="ident" id="3216151"><a href="/net/http/pprof/pprof.go.html#3215871">r</a></span><span class="op" id="3216152">.</span><span class="ident" id="3216153">FormValue</span><span class="op" id="3216162">(</span><span class="string" id="3216163">&#34;gc&#34;</span><span class="op" id="3216167">)</span><span class="op" id="3216168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216171">if</span>&nbsp;<span class="ident" id="3216174"><a href="/net/http/pprof/pprof.go.html#3215824">name</a></span>&nbsp;<span class="op" id="3216179">==</span>&nbsp;<span class="string" id="3216182">&#34;heap&#34;</span>&nbsp;<span class="op" id="3216189">&amp;&amp;</span>&nbsp;<span class="ident" id="3216192"><a href="/net/http/pprof/pprof.go.html#3216129">gc</a></span>&nbsp;<span class="op" id="3216195">&gt;</span>&nbsp;<span class="num" id="3216197">0</span>&nbsp;<span class="op" id="3216199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3216203"><a href="/net/http/pprof/pprof.go.html#3212841">runtime</a></span><span class="op" id="3216210">.</span><span class="ident" id="3216211">GC</span><span class="op" id="3216213">(</span><span class="op" id="3216214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3216217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3216220"><a href="/net/http/pprof/pprof.go.html#3216000">p</a></span><span class="op" id="3216221">.</span><span class="ident" id="3216222">WriteTo</span><span class="op" id="3216229">(</span><span class="ident" id="3216230"><a href="/net/http/pprof/pprof.go.html#3215848">w</a></span><span class="op" id="3216231">,</span>&nbsp;<span class="ident" id="3216233"><a href="/net/http/pprof/pprof.go.html#3215952">debug</a></span><span class="op" id="3216238">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216241">return</span><br>
<span class="lineno"></span><span class="op" id="3216248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3216251">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3216324">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="3216387">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="3216456">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="3216491">func</span>&nbsp;<span class="ident" id="3216496">Index</span><span class="op" id="3216501">(</span><span class="ident" id="3216502">w</span>&nbsp;<span class="ident" id="3216504"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3216508">.</span><span class="ident" id="3216509">ResponseWriter</span><span class="op" id="3216523">,</span>&nbsp;<span class="ident" id="3216525">r</span>&nbsp;<span class="op" id="3216527">*</span><span class="ident" id="3216528"><a href="/net/http/pprof/pprof.go.html#3212823">http</a></span><span class="op" id="3216532">.</span><span class="ident" id="3216533">Request</span><span class="op" id="3216540">)</span>&nbsp;<span class="op" id="3216542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216545">if</span>&nbsp;<span class="ident" id="3216548"><a href="/net/http/pprof/pprof.go.html#3212880">strings</a></span><span class="op" id="3216555">.</span><span class="ident" id="3216556">HasPrefix</span><span class="op" id="3216565">(</span><span class="ident" id="3216566"><a href="/net/http/pprof/pprof.go.html#3216525">r</a></span><span class="op" id="3216567">.</span><span class="ident" id="3216568">URL</span><span class="op" id="3216571">.</span><span class="ident" id="3216572">Path</span><span class="op" id="3216576">,</span>&nbsp;<span class="string" id="3216578">&#34;/debug/pprof/&#34;</span><span class="op" id="3216593">)</span>&nbsp;<span class="op" id="3216595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3216599">name</span>&nbsp;<span class="op" id="3216604">:=</span>&nbsp;<span class="ident" id="3216607"><a href="/net/http/pprof/pprof.go.html#3212880">strings</a></span><span class="op" id="3216614">.</span><span class="ident" id="3216615">TrimPrefix</span><span class="op" id="3216625">(</span><span class="ident" id="3216626"><a href="/net/http/pprof/pprof.go.html#3216525">r</a></span><span class="op" id="3216627">.</span><span class="ident" id="3216628">URL</span><span class="op" id="3216631">.</span><span class="ident" id="3216632">Path</span><span class="op" id="3216636">,</span>&nbsp;<span class="string" id="3216638">&#34;/debug/pprof/&#34;</span><span class="op" id="3216653">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216657">if</span>&nbsp;<span class="ident" id="3216660"><a href="/net/http/pprof/pprof.go.html#3216599">name</a></span>&nbsp;<span class="op" id="3216665">!=</span>&nbsp;<span class="string" id="3216668">&#34;&#34;</span>&nbsp;<span class="op" id="3216671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3216676"><a href="/net/http/pprof/pprof.go.html#3215802">handler</a></span><span class="op" id="3216683">(</span><span class="ident" id="3216684"><a href="/net/http/pprof/pprof.go.html#3216599">name</a></span><span class="op" id="3216688">)</span><span class="op" id="3216689">.</span><span class="ident" id="3216690">ServeHTTP</span><span class="op" id="3216699">(</span><span class="ident" id="3216700"><a href="/net/http/pprof/pprof.go.html#3216502">w</a></span><span class="op" id="3216701">,</span>&nbsp;<span class="ident" id="3216703"><a href="/net/http/pprof/pprof.go.html#3216525">r</a></span><span class="op" id="3216704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216709">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3216718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3216721">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3216725">profiles</span>&nbsp;<span class="op" id="3216734">:=</span>&nbsp;<span class="ident" id="3216737"><a href="/net/http/pprof/pprof.go.html#3212852">pprof</a></span><span class="op" id="3216742">.</span><span class="ident" id="3216743">Profiles</span><span class="op" id="3216751">(</span><span class="op" id="3216752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216755">if</span>&nbsp;<span class="ident" id="3216758">err</span>&nbsp;<span class="op" id="3216762">:=</span>&nbsp;<span class="ident" id="3216765"><a href="/net/http/pprof/pprof.go.html#3216837">indexTmpl</a></span><span class="op" id="3216774">.</span><span class="ident" id="3216775">Execute</span><span class="op" id="3216782">(</span><span class="ident" id="3216783"><a href="/net/http/pprof/pprof.go.html#3216502">w</a></span><span class="op" id="3216784">,</span>&nbsp;<span class="ident" id="3216786"><a href="/net/http/pprof/pprof.go.html#3216725">profiles</a></span><span class="op" id="3216794">)</span><span class="op" id="3216795">;</span>&nbsp;<span class="ident" id="3216797"><a href="/net/http/pprof/pprof.go.html#3216758">err</a></span>&nbsp;<span class="op" id="3216801">!=</span>&nbsp;<span class="ident" id="3216804">nil</span>&nbsp;<span class="op" id="3216808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3216812"><a href="/net/http/pprof/pprof.go.html#3212816">log</a></span><span class="op" id="3216815">.</span><span class="ident" id="3216816">Print</span><span class="op" id="3216821">(</span><span class="ident" id="3216822"><a href="/net/http/pprof/pprof.go.html#3216758">err</a></span><span class="op" id="3216825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3216828">}</span><br>
<span class="lineno">190</span><span class="op" id="3216830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3216833">var</span>&nbsp;<span class="ident" id="3216837">indexTmpl</span>&nbsp;<span class="op" id="3216847">=</span>&nbsp;<span class="ident" id="3216849"><a href="/net/http/pprof/pprof.go.html#3212793">template</a></span><span class="op" id="3216857">.</span><span class="ident" id="3216858">Must</span><span class="op" id="3216862">(</span><span class="ident" id="3216863"><a href="/net/http/pprof/pprof.go.html#3212793">template</a></span><span class="op" id="3216871">.</span><span class="ident" id="3216872">New</span><span class="op" id="3216875">(</span><span class="string" id="3216876">&#34;index&#34;</span><span class="op" id="3216883">)</span><span class="op" id="3216884">.</span><span class="ident" id="3216885">Parse</span><span class="op" id="3216890">(</span><span class="string" id="3216891">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="3217210">)</span><span class="op" id="3217211">)</span>
</div>
</body>
</html>
