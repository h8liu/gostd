<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3790748">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3790803">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3790857">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3790908">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;multi-precision&nbsp;rational&nbsp;numbers.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3790967">package</span>&nbsp;<span class="ident" id="3790975">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3790980">import</span>&nbsp;<span class="op" id="3790987">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3790990">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3791009">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3791019">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3791026">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3791034">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3791044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3791047">//&nbsp;A&nbsp;Rat&nbsp;represents&nbsp;a&nbsp;quotient&nbsp;a/b&nbsp;of&nbsp;arbitrary&nbsp;precision.</span><br>
<span class="lineno"></span><span class="comment" id="3791106">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Rat&nbsp;represents&nbsp;the&nbsp;value&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3791158">type</span>&nbsp;<span class="ident" id="3791163">Rat</span>&nbsp;<span class="keyword" id="3791167">struct</span>&nbsp;<span class="op" id="3791174">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791177">//&nbsp;To&nbsp;make&nbsp;zero&nbsp;values&nbsp;for&nbsp;Rat&nbsp;work&nbsp;w/o&nbsp;initialization,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791234">//&nbsp;a&nbsp;zero&nbsp;value&nbsp;of&nbsp;b&nbsp;(len(b)&nbsp;==&nbsp;0)&nbsp;acts&nbsp;like&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791288">//&nbsp;a.neg&nbsp;determines&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;Rat,&nbsp;b.neg&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791348">a</span><span class="op" id="3791349">,</span>&nbsp;<span class="ident" id="3791351">b</span>&nbsp;<span class="ident" id="3791353">Int</span><br>
<span class="lineno"></span><span class="op" id="3791357">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3791360">//&nbsp;NewRat&nbsp;creates&nbsp;a&nbsp;new&nbsp;Rat&nbsp;with&nbsp;numerator&nbsp;a&nbsp;and&nbsp;denominator&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3791424">func</span>&nbsp;<span class="ident" id="3791429">NewRat</span><span class="op" id="3791435">(</span><span class="ident" id="3791436">a</span><span class="op" id="3791437">,</span>&nbsp;<span class="ident" id="3791439">b</span>&nbsp;<span class="ident" id="3791441">int64</span><span class="op" id="3791446">)</span>&nbsp;<span class="op" id="3791448">*</span><span class="ident" id="3791449">Rat</span>&nbsp;<span class="op" id="3791453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791456">return</span>&nbsp;<span class="builtinfunc" id="3791463">new</span><span class="op" id="3791466">(</span><span class="ident" id="3791467">Rat</span><span class="op" id="3791470">)</span><span class="op" id="3791471">.</span><span class="ident" id="3791472">SetFrac64</span><span class="op" id="3791481">(</span><span class="ident" id="3791482">a</span><span class="op" id="3791483">,</span>&nbsp;<span class="ident" id="3791485">b</span><span class="op" id="3791486">)</span><br>
<span class="lineno"></span><span class="op" id="3791488">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3791491">//&nbsp;SetFloat64&nbsp;sets&nbsp;z&nbsp;to&nbsp;exactly&nbsp;f&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3791540">//&nbsp;If&nbsp;f&nbsp;is&nbsp;not&nbsp;finite,&nbsp;SetFloat&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3791585">func</span>&nbsp;<span class="op" id="3791590">(</span><span class="ident" id="3791591">z</span>&nbsp;<span class="op" id="3791593">*</span><span class="ident" id="3791594">Rat</span><span class="op" id="3791597">)</span>&nbsp;<span class="ident" id="3791599">SetFloat64</span><span class="op" id="3791609">(</span><span class="ident" id="3791610">f</span>&nbsp;<span class="builtintype" id="3791612">float64</span><span class="op" id="3791619">)</span>&nbsp;<span class="op" id="3791621">*</span><span class="ident" id="3791622">Rat</span>&nbsp;<span class="op" id="3791626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791629">const</span>&nbsp;<span class="ident" id="3791635">expMask</span>&nbsp;<span class="op" id="3791643">=</span>&nbsp;<span class="num" id="3791645">1</span><span class="op" id="3791646">&lt;&lt;</span><span class="num" id="3791648">11</span>&nbsp;<span class="op" id="3791651">-</span>&nbsp;<span class="num" id="3791653">1</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791656">bits</span>&nbsp;<span class="op" id="3791661">:=</span>&nbsp;<span class="ident" id="3791664">math</span><span class="op" id="3791668">.</span><span class="ident" id="3791669">Float64bits</span><span class="op" id="3791680">(</span><span class="ident" id="3791681">f</span><span class="op" id="3791682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791685">mantissa</span>&nbsp;<span class="op" id="3791694">:=</span>&nbsp;<span class="ident" id="3791697">bits</span>&nbsp;<span class="op" id="3791702">&amp;</span>&nbsp;<span class="op" id="3791704">(</span><span class="num" id="3791705">1</span><span class="op" id="3791706">&lt;&lt;</span><span class="num" id="3791708">52</span>&nbsp;<span class="op" id="3791711">-</span>&nbsp;<span class="num" id="3791713">1</span><span class="op" id="3791714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791717">exp</span>&nbsp;<span class="op" id="3791721">:=</span>&nbsp;<span class="builtintype" id="3791724">int</span><span class="op" id="3791727">(</span><span class="op" id="3791728">(</span><span class="ident" id="3791729">bits</span>&nbsp;<span class="op" id="3791734">&gt;&gt;</span>&nbsp;<span class="num" id="3791737">52</span><span class="op" id="3791739">)</span>&nbsp;<span class="op" id="3791741">&amp;</span>&nbsp;<span class="ident" id="3791743">expMask</span><span class="op" id="3791750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791753">switch</span>&nbsp;<span class="ident" id="3791760">exp</span>&nbsp;<span class="op" id="3791764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791767">case</span>&nbsp;<span class="ident" id="3791772">expMask</span><span class="op" id="3791779">:</span>&nbsp;<span class="comment" id="3791781">//&nbsp;non-finite</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791797">return</span>&nbsp;<span class="ident" id="3791804">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791809">case</span>&nbsp;<span class="num" id="3791814">0</span><span class="op" id="3791815">:</span>&nbsp;<span class="comment" id="3791817">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791831">exp</span>&nbsp;<span class="op" id="3791835">-=</span>&nbsp;<span class="num" id="3791838">1022</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791844">default</span><span class="op" id="3791851">:</span>&nbsp;<span class="comment" id="3791853">//&nbsp;normal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791865">mantissa</span>&nbsp;<span class="op" id="3791874">|=</span>&nbsp;<span class="num" id="3791877">1</span>&nbsp;<span class="op" id="3791879">&lt;&lt;</span>&nbsp;<span class="num" id="3791882">52</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791887">exp</span>&nbsp;<span class="op" id="3791891">-=</span>&nbsp;<span class="num" id="3791894">1023</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3791900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791904">shift</span>&nbsp;<span class="op" id="3791910">:=</span>&nbsp;<span class="num" id="3791913">52</span>&nbsp;<span class="op" id="3791916">-</span>&nbsp;<span class="ident" id="3791918">exp</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791924">//&nbsp;Optimization&nbsp;(?):&nbsp;partially&nbsp;pre-normalise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791971">for</span>&nbsp;<span class="ident" id="3791975">mantissa</span><span class="op" id="3791983">&amp;</span><span class="num" id="3791984">1</span>&nbsp;<span class="op" id="3791986">==</span>&nbsp;<span class="num" id="3791989">0</span>&nbsp;<span class="op" id="3791991">&amp;&amp;</span>&nbsp;<span class="ident" id="3791994">shift</span>&nbsp;<span class="op" id="3792000">&gt;</span>&nbsp;<span class="num" id="3792002">0</span>&nbsp;<span class="op" id="3792004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792008">mantissa</span>&nbsp;<span class="op" id="3792017">&gt;&gt;=</span>&nbsp;<span class="num" id="3792021">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792025">shift</span><span class="op" id="3792030">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792034">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792038">z</span><span class="op" id="3792039">.</span><span class="ident" id="3792040">a</span><span class="op" id="3792041">.</span><span class="ident" id="3792042">SetUint64</span><span class="op" id="3792051">(</span><span class="ident" id="3792052">mantissa</span><span class="op" id="3792060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792063">z</span><span class="op" id="3792064">.</span><span class="ident" id="3792065">a</span><span class="op" id="3792066">.</span><span class="ident" id="3792067">neg</span>&nbsp;<span class="op" id="3792071">=</span>&nbsp;<span class="ident" id="3792073">f</span>&nbsp;<span class="op" id="3792075">&lt;</span>&nbsp;<span class="num" id="3792077">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792080">z</span><span class="op" id="3792081">.</span><span class="ident" id="3792082">b</span><span class="op" id="3792083">.</span><span class="ident" id="3792084">Set</span><span class="op" id="3792087">(</span><span class="ident" id="3792088">intOne</span><span class="op" id="3792094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792097">if</span>&nbsp;<span class="ident" id="3792100">shift</span>&nbsp;<span class="op" id="3792106">&gt;</span>&nbsp;<span class="num" id="3792108">0</span>&nbsp;<span class="op" id="3792110">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792114">z</span><span class="op" id="3792115">.</span><span class="ident" id="3792116">b</span><span class="op" id="3792117">.</span><span class="ident" id="3792118">Lsh</span><span class="op" id="3792121">(</span><span class="op" id="3792122">&amp;</span><span class="ident" id="3792123">z</span><span class="op" id="3792124">.</span><span class="ident" id="3792125">b</span><span class="op" id="3792126">,</span>&nbsp;<span class="builtintype" id="3792128">uint</span><span class="op" id="3792132">(</span><span class="ident" id="3792133">shift</span><span class="op" id="3792138">)</span><span class="op" id="3792139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792142">}</span>&nbsp;<span class="keyword" id="3792144">else</span>&nbsp;<span class="op" id="3792149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792153">z</span><span class="op" id="3792154">.</span><span class="ident" id="3792155">a</span><span class="op" id="3792156">.</span><span class="ident" id="3792157">Lsh</span><span class="op" id="3792160">(</span><span class="op" id="3792161">&amp;</span><span class="ident" id="3792162">z</span><span class="op" id="3792163">.</span><span class="ident" id="3792164">a</span><span class="op" id="3792165">,</span>&nbsp;<span class="builtintype" id="3792167">uint</span><span class="op" id="3792171">(</span><span class="op" id="3792172">-</span><span class="ident" id="3792173">shift</span><span class="op" id="3792178">)</span><span class="op" id="3792179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792185">return</span>&nbsp;<span class="ident" id="3792192">z</span><span class="op" id="3792193">.</span><span class="ident" id="3792194">norm</span><span class="op" id="3792198">(</span><span class="op" id="3792199">)</span><br>
<span class="lineno">65</span><span class="op" id="3792201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3792204">//&nbsp;quotToFloat32&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float32&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3792260">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3792315">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno">70</span><span class="comment" id="3792368">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3792433">func</span>&nbsp;<span class="ident" id="3792438">quotToFloat32</span><span class="op" id="3792451">(</span><span class="ident" id="3792452">a</span><span class="op" id="3792453">,</span>&nbsp;<span class="ident" id="3792455">b</span>&nbsp;<span class="ident" id="3792457">nat</span><span class="op" id="3792460">)</span>&nbsp;<span class="op" id="3792462">(</span><span class="ident" id="3792463">f</span>&nbsp;<span class="builtintype" id="3792465">float32</span><span class="op" id="3792472">,</span>&nbsp;<span class="ident" id="3792474">exact</span>&nbsp;<span class="builtintype" id="3792480">bool</span><span class="op" id="3792484">)</span>&nbsp;<span class="op" id="3792486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792489">const</span>&nbsp;<span class="op" id="3792495">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3792499">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792523">Fsize</span>&nbsp;<span class="op" id="3792529">=</span>&nbsp;<span class="num" id="3792531">32</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3792537">//&nbsp;mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792551">Msize</span>&nbsp;&nbsp;<span class="op" id="3792558">=</span>&nbsp;<span class="num" id="3792560">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792565">Msize1</span>&nbsp;<span class="op" id="3792572">=</span>&nbsp;<span class="ident" id="3792574">Msize</span>&nbsp;<span class="op" id="3792580">+</span>&nbsp;<span class="num" id="3792582">1</span>&nbsp;<span class="comment" id="3792584">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792606">Msize2</span>&nbsp;<span class="op" id="3792613">=</span>&nbsp;<span class="ident" id="3792615">Msize1</span>&nbsp;<span class="op" id="3792622">+</span>&nbsp;<span class="num" id="3792624">1</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3792629">//&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792643">Esize</span>&nbsp;<span class="op" id="3792649">=</span>&nbsp;<span class="ident" id="3792651">Fsize</span>&nbsp;<span class="op" id="3792657">-</span>&nbsp;<span class="ident" id="3792659">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792668">Ebias</span>&nbsp;<span class="op" id="3792674">=</span>&nbsp;<span class="num" id="3792676">1</span><span class="op" id="3792677">&lt;&lt;</span><span class="op" id="3792679">(</span><span class="ident" id="3792680">Esize</span><span class="op" id="3792685">-</span><span class="num" id="3792686">1</span><span class="op" id="3792687">)</span>&nbsp;<span class="op" id="3792689">-</span>&nbsp;<span class="num" id="3792691">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792695">Emin</span>&nbsp;&nbsp;<span class="op" id="3792701">=</span>&nbsp;<span class="num" id="3792703">1</span>&nbsp;<span class="op" id="3792705">-</span>&nbsp;<span class="ident" id="3792707">Ebias</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792715">Emax</span>&nbsp;&nbsp;<span class="op" id="3792721">=</span>&nbsp;<span class="ident" id="3792723">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792730">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3792734">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792805">alen</span>&nbsp;<span class="op" id="3792810">:=</span>&nbsp;<span class="ident" id="3792813">a</span><span class="op" id="3792814">.</span><span class="ident" id="3792815">bitLen</span><span class="op" id="3792821">(</span><span class="op" id="3792822">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792825">if</span>&nbsp;<span class="ident" id="3792828">alen</span>&nbsp;<span class="op" id="3792833">==</span>&nbsp;<span class="num" id="3792836">0</span>&nbsp;<span class="op" id="3792838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792842">return</span>&nbsp;<span class="num" id="3792849">0</span><span class="op" id="3792850">,</span>&nbsp;<span class="builtintype" id="3792852">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792861">blen</span>&nbsp;<span class="op" id="3792866">:=</span>&nbsp;<span class="ident" id="3792869">b</span><span class="op" id="3792870">.</span><span class="ident" id="3792871">bitLen</span><span class="op" id="3792877">(</span><span class="op" id="3792878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792881">if</span>&nbsp;<span class="ident" id="3792884">blen</span>&nbsp;<span class="op" id="3792889">==</span>&nbsp;<span class="num" id="3792892">0</span>&nbsp;<span class="op" id="3792894">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3792898">panic</span><span class="op" id="3792903">(</span><span class="string" id="3792904">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3792922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3792929">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793009">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793089">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float32&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793161">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793223">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793285">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793352">exp</span>&nbsp;<span class="op" id="3793356">:=</span>&nbsp;<span class="ident" id="3793359">alen</span>&nbsp;<span class="op" id="3793364">-</span>&nbsp;<span class="ident" id="3793366">blen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793372">var</span>&nbsp;<span class="ident" id="3793376">a2</span><span class="op" id="3793378">,</span>&nbsp;<span class="ident" id="3793380">b2</span>&nbsp;<span class="ident" id="3793383">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793388">a2</span>&nbsp;<span class="op" id="3793391">=</span>&nbsp;<span class="ident" id="3793393">a2</span><span class="op" id="3793395">.</span><span class="ident" id="3793396">set</span><span class="op" id="3793399">(</span><span class="ident" id="3793400">a</span><span class="op" id="3793401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793404">b2</span>&nbsp;<span class="op" id="3793407">=</span>&nbsp;<span class="ident" id="3793409">b2</span><span class="op" id="3793411">.</span><span class="ident" id="3793412">set</span><span class="op" id="3793415">(</span><span class="ident" id="3793416">b</span><span class="op" id="3793417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793420">if</span>&nbsp;<span class="ident" id="3793423">shift</span>&nbsp;<span class="op" id="3793429">:=</span>&nbsp;<span class="ident" id="3793432">Msize2</span>&nbsp;<span class="op" id="3793439">-</span>&nbsp;<span class="ident" id="3793441">exp</span><span class="op" id="3793444">;</span>&nbsp;<span class="ident" id="3793446">shift</span>&nbsp;<span class="op" id="3793452">&gt;</span>&nbsp;<span class="num" id="3793454">0</span>&nbsp;<span class="op" id="3793456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793460">a2</span>&nbsp;<span class="op" id="3793463">=</span>&nbsp;<span class="ident" id="3793465">a2</span><span class="op" id="3793467">.</span><span class="ident" id="3793468">shl</span><span class="op" id="3793471">(</span><span class="ident" id="3793472">a2</span><span class="op" id="3793474">,</span>&nbsp;<span class="builtintype" id="3793476">uint</span><span class="op" id="3793480">(</span><span class="ident" id="3793481">shift</span><span class="op" id="3793486">)</span><span class="op" id="3793487">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3793490">}</span>&nbsp;<span class="keyword" id="3793492">else</span>&nbsp;<span class="keyword" id="3793497">if</span>&nbsp;<span class="ident" id="3793500">shift</span>&nbsp;<span class="op" id="3793506">&lt;</span>&nbsp;<span class="num" id="3793508">0</span>&nbsp;<span class="op" id="3793510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793514">b2</span>&nbsp;<span class="op" id="3793517">=</span>&nbsp;<span class="ident" id="3793519">b2</span><span class="op" id="3793521">.</span><span class="ident" id="3793522">shl</span><span class="op" id="3793525">(</span><span class="ident" id="3793526">b2</span><span class="op" id="3793528">,</span>&nbsp;<span class="builtintype" id="3793530">uint</span><span class="op" id="3793534">(</span><span class="op" id="3793535">-</span><span class="ident" id="3793536">shift</span><span class="op" id="3793541">)</span><span class="op" id="3793542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3793545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793549">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793611">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793668">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793693">var</span>&nbsp;<span class="ident" id="3793697">q</span>&nbsp;<span class="ident" id="3793699">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793704">q</span><span class="op" id="3793705">,</span>&nbsp;<span class="ident" id="3793707">r</span>&nbsp;<span class="op" id="3793709">:=</span>&nbsp;<span class="ident" id="3793712">q</span><span class="op" id="3793713">.</span><span class="ident" id="3793714">div</span><span class="op" id="3793717">(</span><span class="ident" id="3793718">a2</span><span class="op" id="3793720">,</span>&nbsp;<span class="ident" id="3793722">a2</span><span class="op" id="3793724">,</span>&nbsp;<span class="ident" id="3793726">b2</span><span class="op" id="3793728">)</span>&nbsp;<span class="comment" id="3793730">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793747">mantissa</span>&nbsp;<span class="op" id="3793756">:=</span>&nbsp;<span class="ident" id="3793759">low32</span><span class="op" id="3793764">(</span><span class="ident" id="3793765">q</span><span class="op" id="3793766">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793769">haveRem</span>&nbsp;<span class="op" id="3793777">:=</span>&nbsp;<span class="builtinfunc" id="3793780">len</span><span class="op" id="3793783">(</span><span class="ident" id="3793784">r</span><span class="op" id="3793785">)</span>&nbsp;<span class="op" id="3793787">&gt;</span>&nbsp;<span class="num" id="3793789">0</span>&nbsp;<span class="comment" id="3793791">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793848">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793917">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793969">if</span>&nbsp;<span class="ident" id="3793972">mantissa</span><span class="op" id="3793980">&gt;&gt;</span><span class="ident" id="3793982">Msize2</span>&nbsp;<span class="op" id="3793989">==</span>&nbsp;<span class="num" id="3793992">1</span>&nbsp;<span class="op" id="3793994">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793998">if</span>&nbsp;<span class="ident" id="3794001">mantissa</span><span class="op" id="3794009">&amp;</span><span class="num" id="3794010">1</span>&nbsp;<span class="op" id="3794012">==</span>&nbsp;<span class="num" id="3794015">1</span>&nbsp;<span class="op" id="3794017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794022">haveRem</span>&nbsp;<span class="op" id="3794030">=</span>&nbsp;<span class="builtintype" id="3794032">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794043">mantissa</span>&nbsp;<span class="op" id="3794052">&gt;&gt;=</span>&nbsp;<span class="num" id="3794056">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794060">exp</span><span class="op" id="3794063">++</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794070">if</span>&nbsp;<span class="ident" id="3794073">mantissa</span><span class="op" id="3794081">&gt;&gt;</span><span class="ident" id="3794083">Msize1</span>&nbsp;<span class="op" id="3794090">!=</span>&nbsp;<span class="num" id="3794093">1</span>&nbsp;<span class="op" id="3794095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3794099">panic</span><span class="op" id="3794104">(</span><span class="ident" id="3794105">fmt</span><span class="op" id="3794108">.</span><span class="ident" id="3794109">Sprintf</span><span class="op" id="3794116">(</span><span class="string" id="3794117">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3794153">,</span>&nbsp;<span class="ident" id="3794155">Msize2</span><span class="op" id="3794161">)</span><span class="op" id="3794162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3794169">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794186">if</span>&nbsp;<span class="ident" id="3794189">Emin</span><span class="op" id="3794193">-</span><span class="ident" id="3794194">Msize</span>&nbsp;<span class="op" id="3794200">&lt;=</span>&nbsp;<span class="ident" id="3794203">exp</span>&nbsp;<span class="op" id="3794207">&amp;&amp;</span>&nbsp;<span class="ident" id="3794210">exp</span>&nbsp;<span class="op" id="3794214">&lt;=</span>&nbsp;<span class="ident" id="3794217">Emin</span>&nbsp;<span class="op" id="3794222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3794226">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794278">shift</span>&nbsp;<span class="op" id="3794284">:=</span>&nbsp;<span class="builtintype" id="3794287">uint</span><span class="op" id="3794291">(</span><span class="ident" id="3794292">Emin</span>&nbsp;<span class="op" id="3794297">-</span>&nbsp;<span class="op" id="3794299">(</span><span class="ident" id="3794300">exp</span>&nbsp;<span class="op" id="3794304">-</span>&nbsp;<span class="num" id="3794306">1</span><span class="op" id="3794307">)</span><span class="op" id="3794308">)</span>&nbsp;<span class="comment" id="3794310">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794327">lostbits</span>&nbsp;<span class="op" id="3794336">:=</span>&nbsp;<span class="ident" id="3794339">mantissa</span>&nbsp;<span class="op" id="3794348">&amp;</span>&nbsp;<span class="op" id="3794350">(</span><span class="num" id="3794351">1</span><span class="op" id="3794352">&lt;&lt;</span><span class="ident" id="3794354">shift</span>&nbsp;<span class="op" id="3794360">-</span>&nbsp;<span class="num" id="3794362">1</span><span class="op" id="3794363">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794367">haveRem</span>&nbsp;<span class="op" id="3794375">=</span>&nbsp;<span class="ident" id="3794377">haveRem</span>&nbsp;<span class="op" id="3794385">||</span>&nbsp;<span class="ident" id="3794388">lostbits</span>&nbsp;<span class="op" id="3794397">!=</span>&nbsp;<span class="num" id="3794400">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794404">mantissa</span>&nbsp;<span class="op" id="3794413">&gt;&gt;=</span>&nbsp;<span class="ident" id="3794417">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794425">exp</span>&nbsp;<span class="op" id="3794429">=</span>&nbsp;<span class="num" id="3794431">2</span>&nbsp;<span class="op" id="3794433">-</span>&nbsp;<span class="ident" id="3794435">Ebias</span>&nbsp;<span class="comment" id="3794441">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3794463">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794501">exact</span>&nbsp;<span class="op" id="3794507">=</span>&nbsp;<span class="op" id="3794509">!</span><span class="ident" id="3794510">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794519">if</span>&nbsp;<span class="ident" id="3794522">mantissa</span><span class="op" id="3794530">&amp;</span><span class="num" id="3794531">1</span>&nbsp;<span class="op" id="3794533">!=</span>&nbsp;<span class="num" id="3794536">0</span>&nbsp;<span class="op" id="3794538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794542">exact</span>&nbsp;<span class="op" id="3794548">=</span>&nbsp;<span class="builtintype" id="3794550">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794558">if</span>&nbsp;<span class="ident" id="3794561">haveRem</span>&nbsp;<span class="op" id="3794569">||</span>&nbsp;<span class="ident" id="3794572">mantissa</span><span class="op" id="3794580">&amp;</span><span class="num" id="3794581">2</span>&nbsp;<span class="op" id="3794583">!=</span>&nbsp;<span class="num" id="3794586">0</span>&nbsp;<span class="op" id="3794588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794593">if</span>&nbsp;<span class="ident" id="3794596">mantissa</span><span class="op" id="3794604">++</span><span class="op" id="3794606">;</span>&nbsp;<span class="ident" id="3794608">mantissa</span>&nbsp;<span class="op" id="3794617">&gt;=</span>&nbsp;<span class="num" id="3794620">1</span><span class="op" id="3794621">&lt;&lt;</span><span class="ident" id="3794623">Msize2</span>&nbsp;<span class="op" id="3794630">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3794636">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794697">mantissa</span>&nbsp;<span class="op" id="3794706">&gt;&gt;=</span>&nbsp;<span class="num" id="3794710">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794716">exp</span><span class="op" id="3794719">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794729">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794735">mantissa</span>&nbsp;<span class="op" id="3794744">&gt;&gt;=</span>&nbsp;<span class="num" id="3794748">1</span>&nbsp;<span class="comment" id="3794750">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794812">f</span>&nbsp;<span class="op" id="3794814">=</span>&nbsp;<span class="builtintype" id="3794816">float32</span><span class="op" id="3794823">(</span><span class="ident" id="3794824">math</span><span class="op" id="3794828">.</span><span class="ident" id="3794829">Ldexp</span><span class="op" id="3794834">(</span><span class="builtintype" id="3794835">float64</span><span class="op" id="3794842">(</span><span class="ident" id="3794843">mantissa</span><span class="op" id="3794851">)</span><span class="op" id="3794852">,</span>&nbsp;<span class="ident" id="3794854">exp</span><span class="op" id="3794857">-</span><span class="ident" id="3794858">Msize1</span><span class="op" id="3794864">)</span><span class="op" id="3794865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794868">if</span>&nbsp;<span class="ident" id="3794871">math</span><span class="op" id="3794875">.</span><span class="ident" id="3794876">IsInf</span><span class="op" id="3794881">(</span><span class="builtintype" id="3794882">float64</span><span class="op" id="3794889">(</span><span class="ident" id="3794890">f</span><span class="op" id="3794891">)</span><span class="op" id="3794892">,</span>&nbsp;<span class="num" id="3794894">0</span><span class="op" id="3794895">)</span>&nbsp;<span class="op" id="3794897">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794901">exact</span>&nbsp;<span class="op" id="3794907">=</span>&nbsp;<span class="builtintype" id="3794909">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794919">return</span><br>
<span class="lineno"></span><span class="op" id="3794926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3794929">//&nbsp;quotToFloat64&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float64&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3794985">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3795040">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="3795093">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3795158">func</span>&nbsp;<span class="ident" id="3795163">quotToFloat64</span><span class="op" id="3795176">(</span><span class="ident" id="3795177">a</span><span class="op" id="3795178">,</span>&nbsp;<span class="ident" id="3795180">b</span>&nbsp;<span class="ident" id="3795182">nat</span><span class="op" id="3795185">)</span>&nbsp;<span class="op" id="3795187">(</span><span class="ident" id="3795188">f</span>&nbsp;<span class="builtintype" id="3795190">float64</span><span class="op" id="3795197">,</span>&nbsp;<span class="ident" id="3795199">exact</span>&nbsp;<span class="builtintype" id="3795205">bool</span><span class="op" id="3795209">)</span>&nbsp;<span class="op" id="3795211">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795214">const</span>&nbsp;<span class="op" id="3795220">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795224">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795248">Fsize</span>&nbsp;<span class="op" id="3795254">=</span>&nbsp;<span class="num" id="3795256">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795262">//&nbsp;mantissa</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795276">Msize</span>&nbsp;&nbsp;<span class="op" id="3795283">=</span>&nbsp;<span class="num" id="3795285">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795290">Msize1</span>&nbsp;<span class="op" id="3795297">=</span>&nbsp;<span class="ident" id="3795299">Msize</span>&nbsp;<span class="op" id="3795305">+</span>&nbsp;<span class="num" id="3795307">1</span>&nbsp;<span class="comment" id="3795309">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795331">Msize2</span>&nbsp;<span class="op" id="3795338">=</span>&nbsp;<span class="ident" id="3795340">Msize1</span>&nbsp;<span class="op" id="3795347">+</span>&nbsp;<span class="num" id="3795349">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795354">//&nbsp;exponent</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795368">Esize</span>&nbsp;<span class="op" id="3795374">=</span>&nbsp;<span class="ident" id="3795376">Fsize</span>&nbsp;<span class="op" id="3795382">-</span>&nbsp;<span class="ident" id="3795384">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795393">Ebias</span>&nbsp;<span class="op" id="3795399">=</span>&nbsp;<span class="num" id="3795401">1</span><span class="op" id="3795402">&lt;&lt;</span><span class="op" id="3795404">(</span><span class="ident" id="3795405">Esize</span><span class="op" id="3795410">-</span><span class="num" id="3795411">1</span><span class="op" id="3795412">)</span>&nbsp;<span class="op" id="3795414">-</span>&nbsp;<span class="num" id="3795416">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795420">Emin</span>&nbsp;&nbsp;<span class="op" id="3795426">=</span>&nbsp;<span class="num" id="3795428">1</span>&nbsp;<span class="op" id="3795430">-</span>&nbsp;<span class="ident" id="3795432">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795440">Emax</span>&nbsp;&nbsp;<span class="op" id="3795446">=</span>&nbsp;<span class="ident" id="3795448">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795455">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795459">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795530">alen</span>&nbsp;<span class="op" id="3795535">:=</span>&nbsp;<span class="ident" id="3795538">a</span><span class="op" id="3795539">.</span><span class="ident" id="3795540">bitLen</span><span class="op" id="3795546">(</span><span class="op" id="3795547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795550">if</span>&nbsp;<span class="ident" id="3795553">alen</span>&nbsp;<span class="op" id="3795558">==</span>&nbsp;<span class="num" id="3795561">0</span>&nbsp;<span class="op" id="3795563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795567">return</span>&nbsp;<span class="num" id="3795574">0</span><span class="op" id="3795575">,</span>&nbsp;<span class="builtintype" id="3795577">true</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795586">blen</span>&nbsp;<span class="op" id="3795591">:=</span>&nbsp;<span class="ident" id="3795594">b</span><span class="op" id="3795595">.</span><span class="ident" id="3795596">bitLen</span><span class="op" id="3795602">(</span><span class="op" id="3795603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795606">if</span>&nbsp;<span class="ident" id="3795609">blen</span>&nbsp;<span class="op" id="3795614">==</span>&nbsp;<span class="num" id="3795617">0</span>&nbsp;<span class="op" id="3795619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3795623">panic</span><span class="op" id="3795628">(</span><span class="string" id="3795629">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3795647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795650">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795654">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795734">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795814">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float64&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795886">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795948">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796010">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796077">exp</span>&nbsp;<span class="op" id="3796081">:=</span>&nbsp;<span class="ident" id="3796084">alen</span>&nbsp;<span class="op" id="3796089">-</span>&nbsp;<span class="ident" id="3796091">blen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796097">var</span>&nbsp;<span class="ident" id="3796101">a2</span><span class="op" id="3796103">,</span>&nbsp;<span class="ident" id="3796105">b2</span>&nbsp;<span class="ident" id="3796108">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796113">a2</span>&nbsp;<span class="op" id="3796116">=</span>&nbsp;<span class="ident" id="3796118">a2</span><span class="op" id="3796120">.</span><span class="ident" id="3796121">set</span><span class="op" id="3796124">(</span><span class="ident" id="3796125">a</span><span class="op" id="3796126">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796129">b2</span>&nbsp;<span class="op" id="3796132">=</span>&nbsp;<span class="ident" id="3796134">b2</span><span class="op" id="3796136">.</span><span class="ident" id="3796137">set</span><span class="op" id="3796140">(</span><span class="ident" id="3796141">b</span><span class="op" id="3796142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796145">if</span>&nbsp;<span class="ident" id="3796148">shift</span>&nbsp;<span class="op" id="3796154">:=</span>&nbsp;<span class="ident" id="3796157">Msize2</span>&nbsp;<span class="op" id="3796164">-</span>&nbsp;<span class="ident" id="3796166">exp</span><span class="op" id="3796169">;</span>&nbsp;<span class="ident" id="3796171">shift</span>&nbsp;<span class="op" id="3796177">&gt;</span>&nbsp;<span class="num" id="3796179">0</span>&nbsp;<span class="op" id="3796181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796185">a2</span>&nbsp;<span class="op" id="3796188">=</span>&nbsp;<span class="ident" id="3796190">a2</span><span class="op" id="3796192">.</span><span class="ident" id="3796193">shl</span><span class="op" id="3796196">(</span><span class="ident" id="3796197">a2</span><span class="op" id="3796199">,</span>&nbsp;<span class="builtintype" id="3796201">uint</span><span class="op" id="3796205">(</span><span class="ident" id="3796206">shift</span><span class="op" id="3796211">)</span><span class="op" id="3796212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796215">}</span>&nbsp;<span class="keyword" id="3796217">else</span>&nbsp;<span class="keyword" id="3796222">if</span>&nbsp;<span class="ident" id="3796225">shift</span>&nbsp;<span class="op" id="3796231">&lt;</span>&nbsp;<span class="num" id="3796233">0</span>&nbsp;<span class="op" id="3796235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796239">b2</span>&nbsp;<span class="op" id="3796242">=</span>&nbsp;<span class="ident" id="3796244">b2</span><span class="op" id="3796246">.</span><span class="ident" id="3796247">shl</span><span class="op" id="3796250">(</span><span class="ident" id="3796251">b2</span><span class="op" id="3796253">,</span>&nbsp;<span class="builtintype" id="3796255">uint</span><span class="op" id="3796259">(</span><span class="op" id="3796260">-</span><span class="ident" id="3796261">shift</span><span class="op" id="3796266">)</span><span class="op" id="3796267">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796274">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796336">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796393">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796418">var</span>&nbsp;<span class="ident" id="3796422">q</span>&nbsp;<span class="ident" id="3796424">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796429">q</span><span class="op" id="3796430">,</span>&nbsp;<span class="ident" id="3796432">r</span>&nbsp;<span class="op" id="3796434">:=</span>&nbsp;<span class="ident" id="3796437">q</span><span class="op" id="3796438">.</span><span class="ident" id="3796439">div</span><span class="op" id="3796442">(</span><span class="ident" id="3796443">a2</span><span class="op" id="3796445">,</span>&nbsp;<span class="ident" id="3796447">a2</span><span class="op" id="3796449">,</span>&nbsp;<span class="ident" id="3796451">b2</span><span class="op" id="3796453">)</span>&nbsp;<span class="comment" id="3796455">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796472">mantissa</span>&nbsp;<span class="op" id="3796481">:=</span>&nbsp;<span class="ident" id="3796484">low64</span><span class="op" id="3796489">(</span><span class="ident" id="3796490">q</span><span class="op" id="3796491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796494">haveRem</span>&nbsp;<span class="op" id="3796502">:=</span>&nbsp;<span class="builtinfunc" id="3796505">len</span><span class="op" id="3796508">(</span><span class="ident" id="3796509">r</span><span class="op" id="3796510">)</span>&nbsp;<span class="op" id="3796512">&gt;</span>&nbsp;<span class="num" id="3796514">0</span>&nbsp;<span class="comment" id="3796516">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796573">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796642">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796694">if</span>&nbsp;<span class="ident" id="3796697">mantissa</span><span class="op" id="3796705">&gt;&gt;</span><span class="ident" id="3796707">Msize2</span>&nbsp;<span class="op" id="3796714">==</span>&nbsp;<span class="num" id="3796717">1</span>&nbsp;<span class="op" id="3796719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796723">if</span>&nbsp;<span class="ident" id="3796726">mantissa</span><span class="op" id="3796734">&amp;</span><span class="num" id="3796735">1</span>&nbsp;<span class="op" id="3796737">==</span>&nbsp;<span class="num" id="3796740">1</span>&nbsp;<span class="op" id="3796742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796747">haveRem</span>&nbsp;<span class="op" id="3796755">=</span>&nbsp;<span class="builtintype" id="3796757">true</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796768">mantissa</span>&nbsp;<span class="op" id="3796777">&gt;&gt;=</span>&nbsp;<span class="num" id="3796781">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3796785">exp</span><span class="op" id="3796788">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796795">if</span>&nbsp;<span class="ident" id="3796798">mantissa</span><span class="op" id="3796806">&gt;&gt;</span><span class="ident" id="3796808">Msize1</span>&nbsp;<span class="op" id="3796815">!=</span>&nbsp;<span class="num" id="3796818">1</span>&nbsp;<span class="op" id="3796820">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3796824">panic</span><span class="op" id="3796829">(</span><span class="ident" id="3796830">fmt</span><span class="op" id="3796833">.</span><span class="ident" id="3796834">Sprintf</span><span class="op" id="3796841">(</span><span class="string" id="3796842">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3796878">,</span>&nbsp;<span class="ident" id="3796880">Msize2</span><span class="op" id="3796886">)</span><span class="op" id="3796887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796894">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796911">if</span>&nbsp;<span class="ident" id="3796914">Emin</span><span class="op" id="3796918">-</span><span class="ident" id="3796919">Msize</span>&nbsp;<span class="op" id="3796925">&lt;=</span>&nbsp;<span class="ident" id="3796928">exp</span>&nbsp;<span class="op" id="3796932">&amp;&amp;</span>&nbsp;<span class="ident" id="3796935">exp</span>&nbsp;<span class="op" id="3796939">&lt;=</span>&nbsp;<span class="ident" id="3796942">Emin</span>&nbsp;<span class="op" id="3796947">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796951">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797003">shift</span>&nbsp;<span class="op" id="3797009">:=</span>&nbsp;<span class="builtintype" id="3797012">uint</span><span class="op" id="3797016">(</span><span class="ident" id="3797017">Emin</span>&nbsp;<span class="op" id="3797022">-</span>&nbsp;<span class="op" id="3797024">(</span><span class="ident" id="3797025">exp</span>&nbsp;<span class="op" id="3797029">-</span>&nbsp;<span class="num" id="3797031">1</span><span class="op" id="3797032">)</span><span class="op" id="3797033">)</span>&nbsp;<span class="comment" id="3797035">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797052">lostbits</span>&nbsp;<span class="op" id="3797061">:=</span>&nbsp;<span class="ident" id="3797064">mantissa</span>&nbsp;<span class="op" id="3797073">&amp;</span>&nbsp;<span class="op" id="3797075">(</span><span class="num" id="3797076">1</span><span class="op" id="3797077">&lt;&lt;</span><span class="ident" id="3797079">shift</span>&nbsp;<span class="op" id="3797085">-</span>&nbsp;<span class="num" id="3797087">1</span><span class="op" id="3797088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797092">haveRem</span>&nbsp;<span class="op" id="3797100">=</span>&nbsp;<span class="ident" id="3797102">haveRem</span>&nbsp;<span class="op" id="3797110">||</span>&nbsp;<span class="ident" id="3797113">lostbits</span>&nbsp;<span class="op" id="3797122">!=</span>&nbsp;<span class="num" id="3797125">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797129">mantissa</span>&nbsp;<span class="op" id="3797138">&gt;&gt;=</span>&nbsp;<span class="ident" id="3797142">shift</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797150">exp</span>&nbsp;<span class="op" id="3797154">=</span>&nbsp;<span class="num" id="3797156">2</span>&nbsp;<span class="op" id="3797158">-</span>&nbsp;<span class="ident" id="3797160">Ebias</span>&nbsp;<span class="comment" id="3797166">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3797185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3797188">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797226">exact</span>&nbsp;<span class="op" id="3797232">=</span>&nbsp;<span class="op" id="3797234">!</span><span class="ident" id="3797235">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797244">if</span>&nbsp;<span class="ident" id="3797247">mantissa</span><span class="op" id="3797255">&amp;</span><span class="num" id="3797256">1</span>&nbsp;<span class="op" id="3797258">!=</span>&nbsp;<span class="num" id="3797261">0</span>&nbsp;<span class="op" id="3797263">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797267">exact</span>&nbsp;<span class="op" id="3797273">=</span>&nbsp;<span class="builtintype" id="3797275">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797283">if</span>&nbsp;<span class="ident" id="3797286">haveRem</span>&nbsp;<span class="op" id="3797294">||</span>&nbsp;<span class="ident" id="3797297">mantissa</span><span class="op" id="3797305">&amp;</span><span class="num" id="3797306">2</span>&nbsp;<span class="op" id="3797308">!=</span>&nbsp;<span class="num" id="3797311">0</span>&nbsp;<span class="op" id="3797313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797318">if</span>&nbsp;<span class="ident" id="3797321">mantissa</span><span class="op" id="3797329">++</span><span class="op" id="3797331">;</span>&nbsp;<span class="ident" id="3797333">mantissa</span>&nbsp;<span class="op" id="3797342">&gt;=</span>&nbsp;<span class="num" id="3797345">1</span><span class="op" id="3797346">&lt;&lt;</span><span class="ident" id="3797348">Msize2</span>&nbsp;<span class="op" id="3797355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3797361">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797422">mantissa</span>&nbsp;<span class="op" id="3797431">&gt;&gt;=</span>&nbsp;<span class="num" id="3797435">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797441">exp</span><span class="op" id="3797444">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3797450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3797454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3797457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797460">mantissa</span>&nbsp;<span class="op" id="3797469">&gt;&gt;=</span>&nbsp;<span class="num" id="3797473">1</span>&nbsp;<span class="comment" id="3797475">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797537">f</span>&nbsp;<span class="op" id="3797539">=</span>&nbsp;<span class="ident" id="3797541">math</span><span class="op" id="3797545">.</span><span class="ident" id="3797546">Ldexp</span><span class="op" id="3797551">(</span><span class="builtintype" id="3797552">float64</span><span class="op" id="3797559">(</span><span class="ident" id="3797560">mantissa</span><span class="op" id="3797568">)</span><span class="op" id="3797569">,</span>&nbsp;<span class="ident" id="3797571">exp</span><span class="op" id="3797574">-</span><span class="ident" id="3797575">Msize1</span><span class="op" id="3797581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797584">if</span>&nbsp;<span class="ident" id="3797587">math</span><span class="op" id="3797591">.</span><span class="ident" id="3797592">IsInf</span><span class="op" id="3797597">(</span><span class="ident" id="3797598">f</span><span class="op" id="3797599">,</span>&nbsp;<span class="num" id="3797601">0</span><span class="op" id="3797602">)</span>&nbsp;<span class="op" id="3797604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797608">exact</span>&nbsp;<span class="op" id="3797614">=</span>&nbsp;<span class="builtintype" id="3797616">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3797623">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797626">return</span><br>
<span class="lineno"></span><span class="op" id="3797633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3797636">//&nbsp;Float32&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float32&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3797709">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno">265</span><span class="comment" id="3797782">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float32,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3797851">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3797914">func</span>&nbsp;<span class="op" id="3797919">(</span><span class="ident" id="3797920">x</span>&nbsp;<span class="op" id="3797922">*</span><span class="ident" id="3797923">Rat</span><span class="op" id="3797926">)</span>&nbsp;<span class="ident" id="3797928">Float32</span><span class="op" id="3797935">(</span><span class="op" id="3797936">)</span>&nbsp;<span class="op" id="3797938">(</span><span class="ident" id="3797939">f</span>&nbsp;<span class="builtintype" id="3797941">float32</span><span class="op" id="3797948">,</span>&nbsp;<span class="ident" id="3797950">exact</span>&nbsp;<span class="builtintype" id="3797956">bool</span><span class="op" id="3797960">)</span>&nbsp;<span class="op" id="3797962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797965">b</span>&nbsp;<span class="op" id="3797967">:=</span>&nbsp;<span class="ident" id="3797970">x</span><span class="op" id="3797971">.</span><span class="ident" id="3797972">b</span><span class="op" id="3797973">.</span><span class="ident" id="3797974">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797979">if</span>&nbsp;<span class="builtinfunc" id="3797982">len</span><span class="op" id="3797985">(</span><span class="ident" id="3797986">b</span><span class="op" id="3797987">)</span>&nbsp;<span class="op" id="3797989">==</span>&nbsp;<span class="num" id="3797992">0</span>&nbsp;<span class="op" id="3797994">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797998">b</span>&nbsp;<span class="op" id="3798000">=</span>&nbsp;<span class="ident" id="3798002">b</span><span class="op" id="3798003">.</span><span class="ident" id="3798004">set</span><span class="op" id="3798007">(</span><span class="ident" id="3798008">natOne</span><span class="op" id="3798014">)</span>&nbsp;<span class="comment" id="3798016">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798047">f</span><span class="op" id="3798048">,</span>&nbsp;<span class="ident" id="3798050">exact</span>&nbsp;<span class="op" id="3798056">=</span>&nbsp;<span class="ident" id="3798058">quotToFloat32</span><span class="op" id="3798071">(</span><span class="ident" id="3798072">x</span><span class="op" id="3798073">.</span><span class="ident" id="3798074">a</span><span class="op" id="3798075">.</span><span class="ident" id="3798076">abs</span><span class="op" id="3798079">,</span>&nbsp;<span class="ident" id="3798081">b</span><span class="op" id="3798082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798085">if</span>&nbsp;<span class="ident" id="3798088">x</span><span class="op" id="3798089">.</span><span class="ident" id="3798090">a</span><span class="op" id="3798091">.</span><span class="ident" id="3798092">neg</span>&nbsp;<span class="op" id="3798096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798100">f</span>&nbsp;<span class="op" id="3798102">=</span>&nbsp;<span class="op" id="3798104">-</span><span class="ident" id="3798105">f</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798111">return</span><br>
<span class="lineno"></span><span class="op" id="3798118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3798121">//&nbsp;Float64&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float64&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno">280</span><span class="comment" id="3798194">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3798267">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float64,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3798336">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3798399">func</span>&nbsp;<span class="op" id="3798404">(</span><span class="ident" id="3798405">x</span>&nbsp;<span class="op" id="3798407">*</span><span class="ident" id="3798408">Rat</span><span class="op" id="3798411">)</span>&nbsp;<span class="ident" id="3798413">Float64</span><span class="op" id="3798420">(</span><span class="op" id="3798421">)</span>&nbsp;<span class="op" id="3798423">(</span><span class="ident" id="3798424">f</span>&nbsp;<span class="builtintype" id="3798426">float64</span><span class="op" id="3798433">,</span>&nbsp;<span class="ident" id="3798435">exact</span>&nbsp;<span class="builtintype" id="3798441">bool</span><span class="op" id="3798445">)</span>&nbsp;<span class="op" id="3798447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798450">b</span>&nbsp;<span class="op" id="3798452">:=</span>&nbsp;<span class="ident" id="3798455">x</span><span class="op" id="3798456">.</span><span class="ident" id="3798457">b</span><span class="op" id="3798458">.</span><span class="ident" id="3798459">abs</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798464">if</span>&nbsp;<span class="builtinfunc" id="3798467">len</span><span class="op" id="3798470">(</span><span class="ident" id="3798471">b</span><span class="op" id="3798472">)</span>&nbsp;<span class="op" id="3798474">==</span>&nbsp;<span class="num" id="3798477">0</span>&nbsp;<span class="op" id="3798479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798483">b</span>&nbsp;<span class="op" id="3798485">=</span>&nbsp;<span class="ident" id="3798487">b</span><span class="op" id="3798488">.</span><span class="ident" id="3798489">set</span><span class="op" id="3798492">(</span><span class="ident" id="3798493">natOne</span><span class="op" id="3798499">)</span>&nbsp;<span class="comment" id="3798501">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798532">f</span><span class="op" id="3798533">,</span>&nbsp;<span class="ident" id="3798535">exact</span>&nbsp;<span class="op" id="3798541">=</span>&nbsp;<span class="ident" id="3798543">quotToFloat64</span><span class="op" id="3798556">(</span><span class="ident" id="3798557">x</span><span class="op" id="3798558">.</span><span class="ident" id="3798559">a</span><span class="op" id="3798560">.</span><span class="ident" id="3798561">abs</span><span class="op" id="3798564">,</span>&nbsp;<span class="ident" id="3798566">b</span><span class="op" id="3798567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798570">if</span>&nbsp;<span class="ident" id="3798573">x</span><span class="op" id="3798574">.</span><span class="ident" id="3798575">a</span><span class="op" id="3798576">.</span><span class="ident" id="3798577">neg</span>&nbsp;<span class="op" id="3798581">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798585">f</span>&nbsp;<span class="op" id="3798587">=</span>&nbsp;<span class="op" id="3798589">-</span><span class="ident" id="3798590">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798596">return</span><br>
<span class="lineno"></span><span class="op" id="3798603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="3798606">//&nbsp;SetFrac&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3798646">func</span>&nbsp;<span class="op" id="3798651">(</span><span class="ident" id="3798652">z</span>&nbsp;<span class="op" id="3798654">*</span><span class="ident" id="3798655">Rat</span><span class="op" id="3798658">)</span>&nbsp;<span class="ident" id="3798660">SetFrac</span><span class="op" id="3798667">(</span><span class="ident" id="3798668">a</span><span class="op" id="3798669">,</span>&nbsp;<span class="ident" id="3798671">b</span>&nbsp;<span class="op" id="3798673">*</span><span class="ident" id="3798674">Int</span><span class="op" id="3798677">)</span>&nbsp;<span class="op" id="3798679">*</span><span class="ident" id="3798680">Rat</span>&nbsp;<span class="op" id="3798684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798687">z</span><span class="op" id="3798688">.</span><span class="ident" id="3798689">a</span><span class="op" id="3798690">.</span><span class="ident" id="3798691">neg</span>&nbsp;<span class="op" id="3798695">=</span>&nbsp;<span class="ident" id="3798697">a</span><span class="op" id="3798698">.</span><span class="ident" id="3798699">neg</span>&nbsp;<span class="op" id="3798703">!=</span>&nbsp;<span class="ident" id="3798706">b</span><span class="op" id="3798707">.</span><span class="ident" id="3798708">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798713">babs</span>&nbsp;<span class="op" id="3798718">:=</span>&nbsp;<span class="ident" id="3798721">b</span><span class="op" id="3798722">.</span><span class="ident" id="3798723">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798728">if</span>&nbsp;<span class="builtinfunc" id="3798731">len</span><span class="op" id="3798734">(</span><span class="ident" id="3798735">babs</span><span class="op" id="3798739">)</span>&nbsp;<span class="op" id="3798741">==</span>&nbsp;<span class="num" id="3798744">0</span>&nbsp;<span class="op" id="3798746">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3798750">panic</span><span class="op" id="3798755">(</span><span class="string" id="3798756">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3798774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798780">if</span>&nbsp;<span class="op" id="3798783">&amp;</span><span class="ident" id="3798784">z</span><span class="op" id="3798785">.</span><span class="ident" id="3798786">a</span>&nbsp;<span class="op" id="3798788">==</span>&nbsp;<span class="ident" id="3798791">b</span>&nbsp;<span class="op" id="3798793">||</span>&nbsp;<span class="ident" id="3798796">alias</span><span class="op" id="3798801">(</span><span class="ident" id="3798802">z</span><span class="op" id="3798803">.</span><span class="ident" id="3798804">a</span><span class="op" id="3798805">.</span><span class="ident" id="3798806">abs</span><span class="op" id="3798809">,</span>&nbsp;<span class="ident" id="3798811">babs</span><span class="op" id="3798815">)</span>&nbsp;<span class="op" id="3798817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798821">babs</span>&nbsp;<span class="op" id="3798826">=</span>&nbsp;<span class="ident" id="3798828">nat</span><span class="op" id="3798831">(</span><span class="ident" id="3798832">nil</span><span class="op" id="3798835">)</span><span class="op" id="3798836">.</span><span class="ident" id="3798837">set</span><span class="op" id="3798840">(</span><span class="ident" id="3798841">babs</span><span class="op" id="3798845">)</span>&nbsp;<span class="comment" id="3798847">//&nbsp;make&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798863">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798866">z</span><span class="op" id="3798867">.</span><span class="ident" id="3798868">a</span><span class="op" id="3798869">.</span><span class="ident" id="3798870">abs</span>&nbsp;<span class="op" id="3798874">=</span>&nbsp;<span class="ident" id="3798876">z</span><span class="op" id="3798877">.</span><span class="ident" id="3798878">a</span><span class="op" id="3798879">.</span><span class="ident" id="3798880">abs</span><span class="op" id="3798883">.</span><span class="ident" id="3798884">set</span><span class="op" id="3798887">(</span><span class="ident" id="3798888">a</span><span class="op" id="3798889">.</span><span class="ident" id="3798890">abs</span><span class="op" id="3798893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798896">z</span><span class="op" id="3798897">.</span><span class="ident" id="3798898">b</span><span class="op" id="3798899">.</span><span class="ident" id="3798900">abs</span>&nbsp;<span class="op" id="3798904">=</span>&nbsp;<span class="ident" id="3798906">z</span><span class="op" id="3798907">.</span><span class="ident" id="3798908">b</span><span class="op" id="3798909">.</span><span class="ident" id="3798910">abs</span><span class="op" id="3798913">.</span><span class="ident" id="3798914">set</span><span class="op" id="3798917">(</span><span class="ident" id="3798918">babs</span><span class="op" id="3798922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798925">return</span>&nbsp;<span class="ident" id="3798932">z</span><span class="op" id="3798933">.</span><span class="ident" id="3798934">norm</span><span class="op" id="3798938">(</span><span class="op" id="3798939">)</span><br>
<span class="lineno"></span><span class="op" id="3798941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="3798944">//&nbsp;SetFrac64&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3798986">func</span>&nbsp;<span class="op" id="3798991">(</span><span class="ident" id="3798992">z</span>&nbsp;<span class="op" id="3798994">*</span><span class="ident" id="3798995">Rat</span><span class="op" id="3798998">)</span>&nbsp;<span class="ident" id="3799000">SetFrac64</span><span class="op" id="3799009">(</span><span class="ident" id="3799010">a</span><span class="op" id="3799011">,</span>&nbsp;<span class="ident" id="3799013">b</span>&nbsp;<span class="ident" id="3799015">int64</span><span class="op" id="3799020">)</span>&nbsp;<span class="op" id="3799022">*</span><span class="ident" id="3799023">Rat</span>&nbsp;<span class="op" id="3799027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799030">z</span><span class="op" id="3799031">.</span><span class="ident" id="3799032">a</span><span class="op" id="3799033">.</span><span class="ident" id="3799034">SetInt64</span><span class="op" id="3799042">(</span><span class="ident" id="3799043">a</span><span class="op" id="3799044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799047">if</span>&nbsp;<span class="ident" id="3799050">b</span>&nbsp;<span class="op" id="3799052">==</span>&nbsp;<span class="num" id="3799055">0</span>&nbsp;<span class="op" id="3799057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3799061">panic</span><span class="op" id="3799066">(</span><span class="string" id="3799067">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3799085">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799091">if</span>&nbsp;<span class="ident" id="3799094">b</span>&nbsp;<span class="op" id="3799096">&lt;</span>&nbsp;<span class="num" id="3799098">0</span>&nbsp;<span class="op" id="3799100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799104">b</span>&nbsp;<span class="op" id="3799106">=</span>&nbsp;<span class="op" id="3799108">-</span><span class="ident" id="3799109">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799113">z</span><span class="op" id="3799114">.</span><span class="ident" id="3799115">a</span><span class="op" id="3799116">.</span><span class="ident" id="3799117">neg</span>&nbsp;<span class="op" id="3799121">=</span>&nbsp;<span class="op" id="3799123">!</span><span class="ident" id="3799124">z</span><span class="op" id="3799125">.</span><span class="ident" id="3799126">a</span><span class="op" id="3799127">.</span><span class="ident" id="3799128">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799133">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799136">z</span><span class="op" id="3799137">.</span><span class="ident" id="3799138">b</span><span class="op" id="3799139">.</span><span class="ident" id="3799140">abs</span>&nbsp;<span class="op" id="3799144">=</span>&nbsp;<span class="ident" id="3799146">z</span><span class="op" id="3799147">.</span><span class="ident" id="3799148">b</span><span class="op" id="3799149">.</span><span class="ident" id="3799150">abs</span><span class="op" id="3799153">.</span><span class="ident" id="3799154">setUint64</span><span class="op" id="3799163">(</span><span class="ident" id="3799164">uint64</span><span class="op" id="3799170">(</span><span class="ident" id="3799171">b</span><span class="op" id="3799172">)</span><span class="op" id="3799173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799176">return</span>&nbsp;<span class="ident" id="3799183">z</span><span class="op" id="3799184">.</span><span class="ident" id="3799185">norm</span><span class="op" id="3799189">(</span><span class="op" id="3799190">)</span><br>
<span class="lineno"></span><span class="op" id="3799192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3799195">//&nbsp;SetInt&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">325</span><span class="keyword" id="3799256">func</span>&nbsp;<span class="op" id="3799261">(</span><span class="ident" id="3799262">z</span>&nbsp;<span class="op" id="3799264">*</span><span class="ident" id="3799265">Rat</span><span class="op" id="3799268">)</span>&nbsp;<span class="ident" id="3799270">SetInt</span><span class="op" id="3799276">(</span><span class="ident" id="3799277">x</span>&nbsp;<span class="op" id="3799279">*</span><span class="ident" id="3799280">Int</span><span class="op" id="3799283">)</span>&nbsp;<span class="op" id="3799285">*</span><span class="ident" id="3799286">Rat</span>&nbsp;<span class="op" id="3799290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799293">z</span><span class="op" id="3799294">.</span><span class="ident" id="3799295">a</span><span class="op" id="3799296">.</span><span class="ident" id="3799297">Set</span><span class="op" id="3799300">(</span><span class="ident" id="3799301">x</span><span class="op" id="3799302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799305">z</span><span class="op" id="3799306">.</span><span class="ident" id="3799307">b</span><span class="op" id="3799308">.</span><span class="ident" id="3799309">abs</span>&nbsp;<span class="op" id="3799313">=</span>&nbsp;<span class="ident" id="3799315">z</span><span class="op" id="3799316">.</span><span class="ident" id="3799317">b</span><span class="op" id="3799318">.</span><span class="ident" id="3799319">abs</span><span class="op" id="3799322">.</span><span class="builtinfunc" id="3799323">make</span><span class="op" id="3799327">(</span><span class="num" id="3799328">0</span><span class="op" id="3799329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799332">return</span>&nbsp;<span class="ident" id="3799339">z</span><br>
<span class="lineno"></span><span class="op" id="3799341">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3799344">//&nbsp;SetInt64&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3799383">func</span>&nbsp;<span class="op" id="3799388">(</span><span class="ident" id="3799389">z</span>&nbsp;<span class="op" id="3799391">*</span><span class="ident" id="3799392">Rat</span><span class="op" id="3799395">)</span>&nbsp;<span class="ident" id="3799397">SetInt64</span><span class="op" id="3799405">(</span><span class="ident" id="3799406">x</span>&nbsp;<span class="ident" id="3799408">int64</span><span class="op" id="3799413">)</span>&nbsp;<span class="op" id="3799415">*</span><span class="ident" id="3799416">Rat</span>&nbsp;<span class="op" id="3799420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799423">z</span><span class="op" id="3799424">.</span><span class="ident" id="3799425">a</span><span class="op" id="3799426">.</span><span class="ident" id="3799427">SetInt64</span><span class="op" id="3799435">(</span><span class="ident" id="3799436">x</span><span class="op" id="3799437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799440">z</span><span class="op" id="3799441">.</span><span class="ident" id="3799442">b</span><span class="op" id="3799443">.</span><span class="ident" id="3799444">abs</span>&nbsp;<span class="op" id="3799448">=</span>&nbsp;<span class="ident" id="3799450">z</span><span class="op" id="3799451">.</span><span class="ident" id="3799452">b</span><span class="op" id="3799453">.</span><span class="ident" id="3799454">abs</span><span class="op" id="3799457">.</span><span class="builtinfunc" id="3799458">make</span><span class="op" id="3799462">(</span><span class="num" id="3799463">0</span><span class="op" id="3799464">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799467">return</span>&nbsp;<span class="ident" id="3799474">z</span><br>
<span class="lineno"></span><span class="op" id="3799476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3799479">//&nbsp;Set&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3799537">func</span>&nbsp;<span class="op" id="3799542">(</span><span class="ident" id="3799543">z</span>&nbsp;<span class="op" id="3799545">*</span><span class="ident" id="3799546">Rat</span><span class="op" id="3799549">)</span>&nbsp;<span class="ident" id="3799551">Set</span><span class="op" id="3799554">(</span><span class="ident" id="3799555">x</span>&nbsp;<span class="op" id="3799557">*</span><span class="ident" id="3799558">Rat</span><span class="op" id="3799561">)</span>&nbsp;<span class="op" id="3799563">*</span><span class="ident" id="3799564">Rat</span>&nbsp;<span class="op" id="3799568">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799571">if</span>&nbsp;<span class="ident" id="3799574">z</span>&nbsp;<span class="op" id="3799576">!=</span>&nbsp;<span class="ident" id="3799579">x</span>&nbsp;<span class="op" id="3799581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799585">z</span><span class="op" id="3799586">.</span><span class="ident" id="3799587">a</span><span class="op" id="3799588">.</span><span class="ident" id="3799589">Set</span><span class="op" id="3799592">(</span><span class="op" id="3799593">&amp;</span><span class="ident" id="3799594">x</span><span class="op" id="3799595">.</span><span class="ident" id="3799596">a</span><span class="op" id="3799597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799601">z</span><span class="op" id="3799602">.</span><span class="ident" id="3799603">b</span><span class="op" id="3799604">.</span><span class="ident" id="3799605">Set</span><span class="op" id="3799608">(</span><span class="op" id="3799609">&amp;</span><span class="ident" id="3799610">x</span><span class="op" id="3799611">.</span><span class="ident" id="3799612">b</span><span class="op" id="3799613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799619">return</span>&nbsp;<span class="ident" id="3799626">z</span><br>
<span class="lineno">345</span><span class="op" id="3799628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3799631">//&nbsp;Abs&nbsp;sets&nbsp;z&nbsp;to&nbsp;|x|&nbsp;(the&nbsp;absolute&nbsp;value&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3799693">func</span>&nbsp;<span class="op" id="3799698">(</span><span class="ident" id="3799699">z</span>&nbsp;<span class="op" id="3799701">*</span><span class="ident" id="3799702">Rat</span><span class="op" id="3799705">)</span>&nbsp;<span class="ident" id="3799707">Abs</span><span class="op" id="3799710">(</span><span class="ident" id="3799711">x</span>&nbsp;<span class="op" id="3799713">*</span><span class="ident" id="3799714">Rat</span><span class="op" id="3799717">)</span>&nbsp;<span class="op" id="3799719">*</span><span class="ident" id="3799720">Rat</span>&nbsp;<span class="op" id="3799724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799727">z</span><span class="op" id="3799728">.</span><span class="ident" id="3799729">Set</span><span class="op" id="3799732">(</span><span class="ident" id="3799733">x</span><span class="op" id="3799734">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799737">z</span><span class="op" id="3799738">.</span><span class="ident" id="3799739">a</span><span class="op" id="3799740">.</span><span class="ident" id="3799741">neg</span>&nbsp;<span class="op" id="3799745">=</span>&nbsp;<span class="builtintype" id="3799747">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799754">return</span>&nbsp;<span class="ident" id="3799761">z</span><br>
<span class="lineno"></span><span class="op" id="3799763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3799766">//&nbsp;Neg&nbsp;sets&nbsp;z&nbsp;to&nbsp;-x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">355</span><span class="keyword" id="3799801">func</span>&nbsp;<span class="op" id="3799806">(</span><span class="ident" id="3799807">z</span>&nbsp;<span class="op" id="3799809">*</span><span class="ident" id="3799810">Rat</span><span class="op" id="3799813">)</span>&nbsp;<span class="ident" id="3799815">Neg</span><span class="op" id="3799818">(</span><span class="ident" id="3799819">x</span>&nbsp;<span class="op" id="3799821">*</span><span class="ident" id="3799822">Rat</span><span class="op" id="3799825">)</span>&nbsp;<span class="op" id="3799827">*</span><span class="ident" id="3799828">Rat</span>&nbsp;<span class="op" id="3799832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799835">z</span><span class="op" id="3799836">.</span><span class="ident" id="3799837">Set</span><span class="op" id="3799840">(</span><span class="ident" id="3799841">x</span><span class="op" id="3799842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799845">z</span><span class="op" id="3799846">.</span><span class="ident" id="3799847">a</span><span class="op" id="3799848">.</span><span class="ident" id="3799849">neg</span>&nbsp;<span class="op" id="3799853">=</span>&nbsp;<span class="builtinfunc" id="3799855">len</span><span class="op" id="3799858">(</span><span class="ident" id="3799859">z</span><span class="op" id="3799860">.</span><span class="ident" id="3799861">a</span><span class="op" id="3799862">.</span><span class="ident" id="3799863">abs</span><span class="op" id="3799866">)</span>&nbsp;<span class="op" id="3799868">&gt;</span>&nbsp;<span class="num" id="3799870">0</span>&nbsp;<span class="op" id="3799872">&amp;&amp;</span>&nbsp;<span class="op" id="3799875">!</span><span class="ident" id="3799876">z</span><span class="op" id="3799877">.</span><span class="ident" id="3799878">a</span><span class="op" id="3799879">.</span><span class="ident" id="3799880">neg</span>&nbsp;<span class="comment" id="3799884">//&nbsp;0&nbsp;has&nbsp;no&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799902">return</span>&nbsp;<span class="ident" id="3799909">z</span><br>
<span class="lineno"></span><span class="op" id="3799911">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="3799914">//&nbsp;Inv&nbsp;sets&nbsp;z&nbsp;to&nbsp;1/x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3799950">func</span>&nbsp;<span class="op" id="3799955">(</span><span class="ident" id="3799956">z</span>&nbsp;<span class="op" id="3799958">*</span><span class="ident" id="3799959">Rat</span><span class="op" id="3799962">)</span>&nbsp;<span class="ident" id="3799964">Inv</span><span class="op" id="3799967">(</span><span class="ident" id="3799968">x</span>&nbsp;<span class="op" id="3799970">*</span><span class="ident" id="3799971">Rat</span><span class="op" id="3799974">)</span>&nbsp;<span class="op" id="3799976">*</span><span class="ident" id="3799977">Rat</span>&nbsp;<span class="op" id="3799981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799984">if</span>&nbsp;<span class="builtinfunc" id="3799987">len</span><span class="op" id="3799990">(</span><span class="ident" id="3799991">x</span><span class="op" id="3799992">.</span><span class="ident" id="3799993">a</span><span class="op" id="3799994">.</span><span class="ident" id="3799995">abs</span><span class="op" id="3799998">)</span>&nbsp;<span class="op" id="3800000">==</span>&nbsp;<span class="num" id="3800003">0</span>&nbsp;<span class="op" id="3800005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3800009">panic</span><span class="op" id="3800014">(</span><span class="string" id="3800015">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3800033">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800039">z</span><span class="op" id="3800040">.</span><span class="ident" id="3800041">Set</span><span class="op" id="3800044">(</span><span class="ident" id="3800045">x</span><span class="op" id="3800046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800049">a</span>&nbsp;<span class="op" id="3800051">:=</span>&nbsp;<span class="ident" id="3800054">z</span><span class="op" id="3800055">.</span><span class="ident" id="3800056">b</span><span class="op" id="3800057">.</span><span class="ident" id="3800058">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800063">if</span>&nbsp;<span class="builtinfunc" id="3800066">len</span><span class="op" id="3800069">(</span><span class="ident" id="3800070">a</span><span class="op" id="3800071">)</span>&nbsp;<span class="op" id="3800073">==</span>&nbsp;<span class="num" id="3800076">0</span>&nbsp;<span class="op" id="3800078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800082">a</span>&nbsp;<span class="op" id="3800084">=</span>&nbsp;<span class="ident" id="3800086">a</span><span class="op" id="3800087">.</span><span class="ident" id="3800088">set</span><span class="op" id="3800091">(</span><span class="ident" id="3800092">natOne</span><span class="op" id="3800098">)</span>&nbsp;<span class="comment" id="3800100">//&nbsp;materialize&nbsp;numerator</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800129">b</span>&nbsp;<span class="op" id="3800131">:=</span>&nbsp;<span class="ident" id="3800134">z</span><span class="op" id="3800135">.</span><span class="ident" id="3800136">a</span><span class="op" id="3800137">.</span><span class="ident" id="3800138">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800143">if</span>&nbsp;<span class="ident" id="3800146">b</span><span class="op" id="3800147">.</span><span class="ident" id="3800148">cmp</span><span class="op" id="3800151">(</span><span class="ident" id="3800152">natOne</span><span class="op" id="3800158">)</span>&nbsp;<span class="op" id="3800160">==</span>&nbsp;<span class="num" id="3800163">0</span>&nbsp;<span class="op" id="3800165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800169">b</span>&nbsp;<span class="op" id="3800171">=</span>&nbsp;<span class="ident" id="3800173">b</span><span class="op" id="3800174">.</span><span class="builtinfunc" id="3800175">make</span><span class="op" id="3800179">(</span><span class="num" id="3800180">0</span><span class="op" id="3800181">)</span>&nbsp;<span class="comment" id="3800183">//&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800209">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800212">z</span><span class="op" id="3800213">.</span><span class="ident" id="3800214">a</span><span class="op" id="3800215">.</span><span class="ident" id="3800216">abs</span><span class="op" id="3800219">,</span>&nbsp;<span class="ident" id="3800221">z</span><span class="op" id="3800222">.</span><span class="ident" id="3800223">b</span><span class="op" id="3800224">.</span><span class="ident" id="3800225">abs</span>&nbsp;<span class="op" id="3800229">=</span>&nbsp;<span class="ident" id="3800231">a</span><span class="op" id="3800232">,</span>&nbsp;<span class="ident" id="3800234">b</span>&nbsp;<span class="comment" id="3800236">//&nbsp;sign&nbsp;doesn&#39;t&nbsp;change</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800260">return</span>&nbsp;<span class="ident" id="3800267">z</span><br>
<span class="lineno"></span><span class="op" id="3800269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3800272">//&nbsp;Sign&nbsp;returns:</span><br>
<span class="lineno">380</span><span class="comment" id="3800289">//</span><br>
<span class="lineno"></span><span class="comment" id="3800292">//&nbsp;&nbsp;&nbsp;&nbsp-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3800308">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3800324">//&nbsp;&nbsp;&nbsp;&nbsp+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3800340">//</span><br>
<span class="lineno">385</span><span class="keyword" id="3800343">func</span>&nbsp;<span class="op" id="3800348">(</span><span class="ident" id="3800349">x</span>&nbsp;<span class="op" id="3800351">*</span><span class="ident" id="3800352">Rat</span><span class="op" id="3800355">)</span>&nbsp;<span class="ident" id="3800357">Sign</span><span class="op" id="3800361">(</span><span class="op" id="3800362">)</span>&nbsp;<span class="builtintype" id="3800364">int</span>&nbsp;<span class="op" id="3800368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800371">return</span>&nbsp;<span class="ident" id="3800378">x</span><span class="op" id="3800379">.</span><span class="ident" id="3800380">a</span><span class="op" id="3800381">.</span><span class="ident" id="3800382">Sign</span><span class="op" id="3800386">(</span><span class="op" id="3800387">)</span><br>
<span class="lineno"></span><span class="op" id="3800389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3800392">//&nbsp;IsInt&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x&nbsp;is&nbsp;1.</span><br>
<span class="lineno">390</span><span class="keyword" id="3800444">func</span>&nbsp;<span class="op" id="3800449">(</span><span class="ident" id="3800450">x</span>&nbsp;<span class="op" id="3800452">*</span><span class="ident" id="3800453">Rat</span><span class="op" id="3800456">)</span>&nbsp;<span class="ident" id="3800458">IsInt</span><span class="op" id="3800463">(</span><span class="op" id="3800464">)</span>&nbsp;<span class="builtintype" id="3800466">bool</span>&nbsp;<span class="op" id="3800471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800474">return</span>&nbsp;<span class="builtinfunc" id="3800481">len</span><span class="op" id="3800484">(</span><span class="ident" id="3800485">x</span><span class="op" id="3800486">.</span><span class="ident" id="3800487">b</span><span class="op" id="3800488">.</span><span class="ident" id="3800489">abs</span><span class="op" id="3800492">)</span>&nbsp;<span class="op" id="3800494">==</span>&nbsp;<span class="num" id="3800497">0</span>&nbsp;<span class="op" id="3800499">||</span>&nbsp;<span class="ident" id="3800502">x</span><span class="op" id="3800503">.</span><span class="ident" id="3800504">b</span><span class="op" id="3800505">.</span><span class="ident" id="3800506">abs</span><span class="op" id="3800509">.</span><span class="ident" id="3800510">cmp</span><span class="op" id="3800513">(</span><span class="ident" id="3800514">natOne</span><span class="op" id="3800520">)</span>&nbsp;<span class="op" id="3800522">==</span>&nbsp;<span class="num" id="3800525">0</span><br>
<span class="lineno"></span><span class="op" id="3800527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3800530">//&nbsp;Num&nbsp;returns&nbsp;the&nbsp;numerator&nbsp;of&nbsp;x;&nbsp;it&nbsp;may&nbsp;be&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno">395</span><span class="comment" id="3800581">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;numerator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3800631">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span><span class="comment" id="3800694">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;the&nbsp;numerator&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;sign&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3800753">func</span>&nbsp;<span class="op" id="3800758">(</span><span class="ident" id="3800759">x</span>&nbsp;<span class="op" id="3800761">*</span><span class="ident" id="3800762">Rat</span><span class="op" id="3800765">)</span>&nbsp;<span class="ident" id="3800767">Num</span><span class="op" id="3800770">(</span><span class="op" id="3800771">)</span>&nbsp;<span class="op" id="3800773">*</span><span class="ident" id="3800774">Int</span>&nbsp;<span class="op" id="3800778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800781">return</span>&nbsp;<span class="op" id="3800788">&amp;</span><span class="ident" id="3800789">x</span><span class="op" id="3800790">.</span><span class="ident" id="3800791">a</span><br>
<span class="lineno">400</span><span class="op" id="3800793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3800796">//&nbsp;Denom&nbsp;returns&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x;&nbsp;it&nbsp;is&nbsp;always&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3800853">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;denominator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3800905">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno">405</span><span class="keyword" id="3800968">func</span>&nbsp;<span class="op" id="3800973">(</span><span class="ident" id="3800974">x</span>&nbsp;<span class="op" id="3800976">*</span><span class="ident" id="3800977">Rat</span><span class="op" id="3800980">)</span>&nbsp;<span class="ident" id="3800982">Denom</span><span class="op" id="3800987">(</span><span class="op" id="3800988">)</span>&nbsp;<span class="op" id="3800990">*</span><span class="ident" id="3800991">Int</span>&nbsp;<span class="op" id="3800995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800998">x</span><span class="op" id="3800999">.</span><span class="ident" id="3801000">b</span><span class="op" id="3801001">.</span><span class="ident" id="3801002">neg</span>&nbsp;<span class="op" id="3801006">=</span>&nbsp;<span class="builtintype" id="3801008">false</span>&nbsp;<span class="comment" id="3801014">//&nbsp;the&nbsp;result&nbsp;is&nbsp;always&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801044">if</span>&nbsp;<span class="builtinfunc" id="3801047">len</span><span class="op" id="3801050">(</span><span class="ident" id="3801051">x</span><span class="op" id="3801052">.</span><span class="ident" id="3801053">b</span><span class="op" id="3801054">.</span><span class="ident" id="3801055">abs</span><span class="op" id="3801058">)</span>&nbsp;<span class="op" id="3801060">==</span>&nbsp;<span class="num" id="3801063">0</span>&nbsp;<span class="op" id="3801065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801069">x</span><span class="op" id="3801070">.</span><span class="ident" id="3801071">b</span><span class="op" id="3801072">.</span><span class="ident" id="3801073">abs</span>&nbsp;<span class="op" id="3801077">=</span>&nbsp;<span class="ident" id="3801079">x</span><span class="op" id="3801080">.</span><span class="ident" id="3801081">b</span><span class="op" id="3801082">.</span><span class="ident" id="3801083">abs</span><span class="op" id="3801086">.</span><span class="ident" id="3801087">set</span><span class="op" id="3801090">(</span><span class="ident" id="3801091">natOne</span><span class="op" id="3801097">)</span>&nbsp;<span class="comment" id="3801099">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3801127">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801130">return</span>&nbsp;<span class="op" id="3801137">&amp;</span><span class="ident" id="3801138">x</span><span class="op" id="3801139">.</span><span class="ident" id="3801140">b</span><br>
<span class="lineno"></span><span class="op" id="3801142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3801145">func</span>&nbsp;<span class="op" id="3801150">(</span><span class="ident" id="3801151">z</span>&nbsp;<span class="op" id="3801153">*</span><span class="ident" id="3801154">Rat</span><span class="op" id="3801157">)</span>&nbsp;<span class="ident" id="3801159">norm</span><span class="op" id="3801163">(</span><span class="op" id="3801164">)</span>&nbsp;<span class="op" id="3801166">*</span><span class="ident" id="3801167">Rat</span>&nbsp;<span class="op" id="3801171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801174">switch</span>&nbsp;<span class="op" id="3801181">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801184">case</span>&nbsp;<span class="builtinfunc" id="3801189">len</span><span class="op" id="3801192">(</span><span class="ident" id="3801193">z</span><span class="op" id="3801194">.</span><span class="ident" id="3801195">a</span><span class="op" id="3801196">.</span><span class="ident" id="3801197">abs</span><span class="op" id="3801200">)</span>&nbsp;<span class="op" id="3801202">==</span>&nbsp;<span class="num" id="3801205">0</span><span class="op" id="3801206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3801210">//&nbsp;z&nbsp;==&nbsp;0&nbsp;-&nbsp;normalize&nbsp;sign&nbsp;and&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801255">z</span><span class="op" id="3801256">.</span><span class="ident" id="3801257">a</span><span class="op" id="3801258">.</span><span class="ident" id="3801259">neg</span>&nbsp;<span class="op" id="3801263">=</span>&nbsp;<span class="builtintype" id="3801265">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801273">z</span><span class="op" id="3801274">.</span><span class="ident" id="3801275">b</span><span class="op" id="3801276">.</span><span class="ident" id="3801277">abs</span>&nbsp;<span class="op" id="3801281">=</span>&nbsp;<span class="ident" id="3801283">z</span><span class="op" id="3801284">.</span><span class="ident" id="3801285">b</span><span class="op" id="3801286">.</span><span class="ident" id="3801287">abs</span><span class="op" id="3801290">.</span><span class="builtinfunc" id="3801291">make</span><span class="op" id="3801295">(</span><span class="num" id="3801296">0</span><span class="op" id="3801297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801300">case</span>&nbsp;<span class="builtinfunc" id="3801305">len</span><span class="op" id="3801308">(</span><span class="ident" id="3801309">z</span><span class="op" id="3801310">.</span><span class="ident" id="3801311">b</span><span class="op" id="3801312">.</span><span class="ident" id="3801313">abs</span><span class="op" id="3801316">)</span>&nbsp;<span class="op" id="3801318">==</span>&nbsp;<span class="num" id="3801321">0</span><span class="op" id="3801322">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3801326">//&nbsp;z&nbsp;is&nbsp;normalized&nbsp;int&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801366">case</span>&nbsp;<span class="ident" id="3801371">z</span><span class="op" id="3801372">.</span><span class="ident" id="3801373">b</span><span class="op" id="3801374">.</span><span class="ident" id="3801375">abs</span><span class="op" id="3801378">.</span><span class="ident" id="3801379">cmp</span><span class="op" id="3801382">(</span><span class="ident" id="3801383">natOne</span><span class="op" id="3801389">)</span>&nbsp;<span class="op" id="3801391">==</span>&nbsp;<span class="num" id="3801394">0</span><span class="op" id="3801395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3801399">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801437">z</span><span class="op" id="3801438">.</span><span class="ident" id="3801439">b</span><span class="op" id="3801440">.</span><span class="ident" id="3801441">abs</span>&nbsp;<span class="op" id="3801445">=</span>&nbsp;<span class="ident" id="3801447">z</span><span class="op" id="3801448">.</span><span class="ident" id="3801449">b</span><span class="op" id="3801450">.</span><span class="ident" id="3801451">abs</span><span class="op" id="3801454">.</span><span class="builtinfunc" id="3801455">make</span><span class="op" id="3801459">(</span><span class="num" id="3801460">0</span><span class="op" id="3801461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801464">default</span><span class="op" id="3801471">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801475">neg</span>&nbsp;<span class="op" id="3801479">:=</span>&nbsp;<span class="ident" id="3801482">z</span><span class="op" id="3801483">.</span><span class="ident" id="3801484">a</span><span class="op" id="3801485">.</span><span class="ident" id="3801486">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801492">z</span><span class="op" id="3801493">.</span><span class="ident" id="3801494">a</span><span class="op" id="3801495">.</span><span class="ident" id="3801496">neg</span>&nbsp;<span class="op" id="3801500">=</span>&nbsp;<span class="builtintype" id="3801502">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801510">z</span><span class="op" id="3801511">.</span><span class="ident" id="3801512">b</span><span class="op" id="3801513">.</span><span class="ident" id="3801514">neg</span>&nbsp;<span class="op" id="3801518">=</span>&nbsp;<span class="builtintype" id="3801520">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801528">if</span>&nbsp;<span class="ident" id="3801531">f</span>&nbsp;<span class="op" id="3801533">:=</span>&nbsp;<span class="ident" id="3801536">NewInt</span><span class="op" id="3801542">(</span><span class="num" id="3801543">0</span><span class="op" id="3801544">)</span><span class="op" id="3801545">.</span><span class="ident" id="3801546">binaryGCD</span><span class="op" id="3801555">(</span><span class="op" id="3801556">&amp;</span><span class="ident" id="3801557">z</span><span class="op" id="3801558">.</span><span class="ident" id="3801559">a</span><span class="op" id="3801560">,</span>&nbsp;<span class="op" id="3801562">&amp;</span><span class="ident" id="3801563">z</span><span class="op" id="3801564">.</span><span class="ident" id="3801565">b</span><span class="op" id="3801566">)</span><span class="op" id="3801567">;</span>&nbsp;<span class="ident" id="3801569">f</span><span class="op" id="3801570">.</span><span class="ident" id="3801571">Cmp</span><span class="op" id="3801574">(</span><span class="ident" id="3801575">intOne</span><span class="op" id="3801581">)</span>&nbsp;<span class="op" id="3801583">!=</span>&nbsp;<span class="num" id="3801586">0</span>&nbsp;<span class="op" id="3801588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801593">z</span><span class="op" id="3801594">.</span><span class="ident" id="3801595">a</span><span class="op" id="3801596">.</span><span class="ident" id="3801597">abs</span><span class="op" id="3801600">,</span>&nbsp;<span class="ident" id="3801602">_</span>&nbsp;<span class="op" id="3801604">=</span>&nbsp;<span class="ident" id="3801606">z</span><span class="op" id="3801607">.</span><span class="ident" id="3801608">a</span><span class="op" id="3801609">.</span><span class="ident" id="3801610">abs</span><span class="op" id="3801613">.</span><span class="ident" id="3801614">div</span><span class="op" id="3801617">(</span><span class="ident" id="3801618">nil</span><span class="op" id="3801621">,</span>&nbsp;<span class="ident" id="3801623">z</span><span class="op" id="3801624">.</span><span class="ident" id="3801625">a</span><span class="op" id="3801626">.</span><span class="ident" id="3801627">abs</span><span class="op" id="3801630">,</span>&nbsp;<span class="ident" id="3801632">f</span><span class="op" id="3801633">.</span><span class="ident" id="3801634">abs</span><span class="op" id="3801637">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801642">z</span><span class="op" id="3801643">.</span><span class="ident" id="3801644">b</span><span class="op" id="3801645">.</span><span class="ident" id="3801646">abs</span><span class="op" id="3801649">,</span>&nbsp;<span class="ident" id="3801651">_</span>&nbsp;<span class="op" id="3801653">=</span>&nbsp;<span class="ident" id="3801655">z</span><span class="op" id="3801656">.</span><span class="ident" id="3801657">b</span><span class="op" id="3801658">.</span><span class="ident" id="3801659">abs</span><span class="op" id="3801662">.</span><span class="ident" id="3801663">div</span><span class="op" id="3801666">(</span><span class="ident" id="3801667">nil</span><span class="op" id="3801670">,</span>&nbsp;<span class="ident" id="3801672">z</span><span class="op" id="3801673">.</span><span class="ident" id="3801674">b</span><span class="op" id="3801675">.</span><span class="ident" id="3801676">abs</span><span class="op" id="3801679">,</span>&nbsp;<span class="ident" id="3801681">f</span><span class="op" id="3801682">.</span><span class="ident" id="3801683">abs</span><span class="op" id="3801686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801691">if</span>&nbsp;<span class="ident" id="3801694">z</span><span class="op" id="3801695">.</span><span class="ident" id="3801696">b</span><span class="op" id="3801697">.</span><span class="ident" id="3801698">abs</span><span class="op" id="3801701">.</span><span class="ident" id="3801702">cmp</span><span class="op" id="3801705">(</span><span class="ident" id="3801706">natOne</span><span class="op" id="3801712">)</span>&nbsp;<span class="op" id="3801714">==</span>&nbsp;<span class="num" id="3801717">0</span>&nbsp;<span class="op" id="3801719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3801725">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801765">z</span><span class="op" id="3801766">.</span><span class="ident" id="3801767">b</span><span class="op" id="3801768">.</span><span class="ident" id="3801769">abs</span>&nbsp;<span class="op" id="3801773">=</span>&nbsp;<span class="ident" id="3801775">z</span><span class="op" id="3801776">.</span><span class="ident" id="3801777">b</span><span class="op" id="3801778">.</span><span class="ident" id="3801779">abs</span><span class="op" id="3801782">.</span><span class="builtinfunc" id="3801783">make</span><span class="op" id="3801787">(</span><span class="num" id="3801788">0</span><span class="op" id="3801789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3801794">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3801798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801802">z</span><span class="op" id="3801803">.</span><span class="ident" id="3801804">a</span><span class="op" id="3801805">.</span><span class="ident" id="3801806">neg</span>&nbsp;<span class="op" id="3801810">=</span>&nbsp;<span class="ident" id="3801812">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3801817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801820">return</span>&nbsp;<span class="ident" id="3801827">z</span><br>
<span class="lineno"></span><span class="op" id="3801829">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="3801832">//&nbsp;mulDenom&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;denominator&nbsp;product&nbsp;x*y&nbsp;(by&nbsp;taking&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3801898">//&nbsp;account&nbsp;that&nbsp;0&nbsp;values&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;1)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3801964">//&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3801978">func</span>&nbsp;<span class="ident" id="3801983">mulDenom</span><span class="op" id="3801991">(</span><span class="ident" id="3801992">z</span><span class="op" id="3801993">,</span>&nbsp;<span class="ident" id="3801995">x</span><span class="op" id="3801996">,</span>&nbsp;<span class="ident" id="3801998">y</span>&nbsp;<span class="ident" id="3802000">nat</span><span class="op" id="3802003">)</span>&nbsp;<span class="ident" id="3802005">nat</span>&nbsp;<span class="op" id="3802009">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802012">switch</span>&nbsp;<span class="op" id="3802019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802022">case</span>&nbsp;<span class="builtinfunc" id="3802027">len</span><span class="op" id="3802030">(</span><span class="ident" id="3802031">x</span><span class="op" id="3802032">)</span>&nbsp;<span class="op" id="3802034">==</span>&nbsp;<span class="num" id="3802037">0</span><span class="op" id="3802038">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802042">return</span>&nbsp;<span class="ident" id="3802049">z</span><span class="op" id="3802050">.</span><span class="ident" id="3802051">set</span><span class="op" id="3802054">(</span><span class="ident" id="3802055">y</span><span class="op" id="3802056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802059">case</span>&nbsp;<span class="builtinfunc" id="3802064">len</span><span class="op" id="3802067">(</span><span class="ident" id="3802068">y</span><span class="op" id="3802069">)</span>&nbsp;<span class="op" id="3802071">==</span>&nbsp;<span class="num" id="3802074">0</span><span class="op" id="3802075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802079">return</span>&nbsp;<span class="ident" id="3802086">z</span><span class="op" id="3802087">.</span><span class="ident" id="3802088">set</span><span class="op" id="3802091">(</span><span class="ident" id="3802092">x</span><span class="op" id="3802093">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3802096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802099">return</span>&nbsp;<span class="ident" id="3802106">z</span><span class="op" id="3802107">.</span><span class="ident" id="3802108">mul</span><span class="op" id="3802111">(</span><span class="ident" id="3802112">x</span><span class="op" id="3802113">,</span>&nbsp;<span class="ident" id="3802115">y</span><span class="op" id="3802116">)</span><br>
<span class="lineno"></span><span class="op" id="3802118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3802121">//&nbsp;scaleDenom&nbsp;computes&nbsp;x*f.</span><br>
<span class="lineno">455</span><span class="comment" id="3802149">//&nbsp;If&nbsp;f&nbsp;==&nbsp;0&nbsp;(zero&nbsp;value&nbsp;of&nbsp;denominator),&nbsp;the&nbsp;result&nbsp;is&nbsp;(a&nbsp;copy&nbsp;of)&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3802220">func</span>&nbsp;<span class="ident" id="3802225">scaleDenom</span><span class="op" id="3802235">(</span><span class="ident" id="3802236">x</span>&nbsp;<span class="op" id="3802238">*</span><span class="ident" id="3802239">Int</span><span class="op" id="3802242">,</span>&nbsp;<span class="ident" id="3802244">f</span>&nbsp;<span class="ident" id="3802246">nat</span><span class="op" id="3802249">)</span>&nbsp;<span class="op" id="3802251">*</span><span class="ident" id="3802252">Int</span>&nbsp;<span class="op" id="3802256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802259">var</span>&nbsp;<span class="ident" id="3802263">z</span>&nbsp;<span class="ident" id="3802265">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802270">if</span>&nbsp;<span class="builtinfunc" id="3802273">len</span><span class="op" id="3802276">(</span><span class="ident" id="3802277">f</span><span class="op" id="3802278">)</span>&nbsp;<span class="op" id="3802280">==</span>&nbsp;<span class="num" id="3802283">0</span>&nbsp;<span class="op" id="3802285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802289">return</span>&nbsp;<span class="ident" id="3802296">z</span><span class="op" id="3802297">.</span><span class="ident" id="3802298">Set</span><span class="op" id="3802301">(</span><span class="ident" id="3802302">x</span><span class="op" id="3802303">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3802306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802309">z</span><span class="op" id="3802310">.</span><span class="ident" id="3802311">abs</span>&nbsp;<span class="op" id="3802315">=</span>&nbsp;<span class="ident" id="3802317">z</span><span class="op" id="3802318">.</span><span class="ident" id="3802319">abs</span><span class="op" id="3802322">.</span><span class="ident" id="3802323">mul</span><span class="op" id="3802326">(</span><span class="ident" id="3802327">x</span><span class="op" id="3802328">.</span><span class="ident" id="3802329">abs</span><span class="op" id="3802332">,</span>&nbsp;<span class="ident" id="3802334">f</span><span class="op" id="3802335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802338">z</span><span class="op" id="3802339">.</span><span class="ident" id="3802340">neg</span>&nbsp;<span class="op" id="3802344">=</span>&nbsp;<span class="ident" id="3802346">x</span><span class="op" id="3802347">.</span><span class="ident" id="3802348">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802353">return</span>&nbsp;<span class="op" id="3802360">&amp;</span><span class="ident" id="3802361">z</span><br>
<span class="lineno"></span><span class="op" id="3802363">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span><span class="comment" id="3802366">//&nbsp;Cmp&nbsp;compares&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;returns:</span><br>
<span class="lineno"></span><span class="comment" id="3802403">//</span><br>
<span class="lineno"></span><span class="comment" id="3802406">//&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3802424">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;y</span><br>
<span class="lineno">470</span><span class="comment" id="3802442">//&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3802460">//</span><br>
<span class="lineno"></span><span class="keyword" id="3802463">func</span>&nbsp;<span class="op" id="3802468">(</span><span class="ident" id="3802469">x</span>&nbsp;<span class="op" id="3802471">*</span><span class="ident" id="3802472">Rat</span><span class="op" id="3802475">)</span>&nbsp;<span class="ident" id="3802477">Cmp</span><span class="op" id="3802480">(</span><span class="ident" id="3802481">y</span>&nbsp;<span class="op" id="3802483">*</span><span class="ident" id="3802484">Rat</span><span class="op" id="3802487">)</span>&nbsp;<span class="builtintype" id="3802489">int</span>&nbsp;<span class="op" id="3802493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802496">return</span>&nbsp;<span class="ident" id="3802503">scaleDenom</span><span class="op" id="3802513">(</span><span class="op" id="3802514">&amp;</span><span class="ident" id="3802515">x</span><span class="op" id="3802516">.</span><span class="ident" id="3802517">a</span><span class="op" id="3802518">,</span>&nbsp;<span class="ident" id="3802520">y</span><span class="op" id="3802521">.</span><span class="ident" id="3802522">b</span><span class="op" id="3802523">.</span><span class="ident" id="3802524">abs</span><span class="op" id="3802527">)</span><span class="op" id="3802528">.</span><span class="ident" id="3802529">Cmp</span><span class="op" id="3802532">(</span><span class="ident" id="3802533">scaleDenom</span><span class="op" id="3802543">(</span><span class="op" id="3802544">&amp;</span><span class="ident" id="3802545">y</span><span class="op" id="3802546">.</span><span class="ident" id="3802547">a</span><span class="op" id="3802548">,</span>&nbsp;<span class="ident" id="3802550">x</span><span class="op" id="3802551">.</span><span class="ident" id="3802552">b</span><span class="op" id="3802553">.</span><span class="ident" id="3802554">abs</span><span class="op" id="3802557">)</span><span class="op" id="3802558">)</span><br>
<span class="lineno"></span><span class="op" id="3802560">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="3802563">//&nbsp;Add&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;sum&nbsp;x+y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3802607">func</span>&nbsp;<span class="op" id="3802612">(</span><span class="ident" id="3802613">z</span>&nbsp;<span class="op" id="3802615">*</span><span class="ident" id="3802616">Rat</span><span class="op" id="3802619">)</span>&nbsp;<span class="ident" id="3802621">Add</span><span class="op" id="3802624">(</span><span class="ident" id="3802625">x</span><span class="op" id="3802626">,</span>&nbsp;<span class="ident" id="3802628">y</span>&nbsp;<span class="op" id="3802630">*</span><span class="ident" id="3802631">Rat</span><span class="op" id="3802634">)</span>&nbsp;<span class="op" id="3802636">*</span><span class="ident" id="3802637">Rat</span>&nbsp;<span class="op" id="3802641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802644">a1</span>&nbsp;<span class="op" id="3802647">:=</span>&nbsp;<span class="ident" id="3802650">scaleDenom</span><span class="op" id="3802660">(</span><span class="op" id="3802661">&amp;</span><span class="ident" id="3802662">x</span><span class="op" id="3802663">.</span><span class="ident" id="3802664">a</span><span class="op" id="3802665">,</span>&nbsp;<span class="ident" id="3802667">y</span><span class="op" id="3802668">.</span><span class="ident" id="3802669">b</span><span class="op" id="3802670">.</span><span class="ident" id="3802671">abs</span><span class="op" id="3802674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802677">a2</span>&nbsp;<span class="op" id="3802680">:=</span>&nbsp;<span class="ident" id="3802683">scaleDenom</span><span class="op" id="3802693">(</span><span class="op" id="3802694">&amp;</span><span class="ident" id="3802695">y</span><span class="op" id="3802696">.</span><span class="ident" id="3802697">a</span><span class="op" id="3802698">,</span>&nbsp;<span class="ident" id="3802700">x</span><span class="op" id="3802701">.</span><span class="ident" id="3802702">b</span><span class="op" id="3802703">.</span><span class="ident" id="3802704">abs</span><span class="op" id="3802707">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802710">z</span><span class="op" id="3802711">.</span><span class="ident" id="3802712">a</span><span class="op" id="3802713">.</span><span class="ident" id="3802714">Add</span><span class="op" id="3802717">(</span><span class="ident" id="3802718">a1</span><span class="op" id="3802720">,</span>&nbsp;<span class="ident" id="3802722">a2</span><span class="op" id="3802724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802727">z</span><span class="op" id="3802728">.</span><span class="ident" id="3802729">b</span><span class="op" id="3802730">.</span><span class="ident" id="3802731">abs</span>&nbsp;<span class="op" id="3802735">=</span>&nbsp;<span class="ident" id="3802737">mulDenom</span><span class="op" id="3802745">(</span><span class="ident" id="3802746">z</span><span class="op" id="3802747">.</span><span class="ident" id="3802748">b</span><span class="op" id="3802749">.</span><span class="ident" id="3802750">abs</span><span class="op" id="3802753">,</span>&nbsp;<span class="ident" id="3802755">x</span><span class="op" id="3802756">.</span><span class="ident" id="3802757">b</span><span class="op" id="3802758">.</span><span class="ident" id="3802759">abs</span><span class="op" id="3802762">,</span>&nbsp;<span class="ident" id="3802764">y</span><span class="op" id="3802765">.</span><span class="ident" id="3802766">b</span><span class="op" id="3802767">.</span><span class="ident" id="3802768">abs</span><span class="op" id="3802771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802774">return</span>&nbsp;<span class="ident" id="3802781">z</span><span class="op" id="3802782">.</span><span class="ident" id="3802783">norm</span><span class="op" id="3802787">(</span><span class="op" id="3802788">)</span><br>
<span class="lineno"></span><span class="op" id="3802790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span><span class="comment" id="3802793">//&nbsp;Sub&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;difference&nbsp;x-y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3802844">func</span>&nbsp;<span class="op" id="3802849">(</span><span class="ident" id="3802850">z</span>&nbsp;<span class="op" id="3802852">*</span><span class="ident" id="3802853">Rat</span><span class="op" id="3802856">)</span>&nbsp;<span class="ident" id="3802858">Sub</span><span class="op" id="3802861">(</span><span class="ident" id="3802862">x</span><span class="op" id="3802863">,</span>&nbsp;<span class="ident" id="3802865">y</span>&nbsp;<span class="op" id="3802867">*</span><span class="ident" id="3802868">Rat</span><span class="op" id="3802871">)</span>&nbsp;<span class="op" id="3802873">*</span><span class="ident" id="3802874">Rat</span>&nbsp;<span class="op" id="3802878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802881">a1</span>&nbsp;<span class="op" id="3802884">:=</span>&nbsp;<span class="ident" id="3802887">scaleDenom</span><span class="op" id="3802897">(</span><span class="op" id="3802898">&amp;</span><span class="ident" id="3802899">x</span><span class="op" id="3802900">.</span><span class="ident" id="3802901">a</span><span class="op" id="3802902">,</span>&nbsp;<span class="ident" id="3802904">y</span><span class="op" id="3802905">.</span><span class="ident" id="3802906">b</span><span class="op" id="3802907">.</span><span class="ident" id="3802908">abs</span><span class="op" id="3802911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802914">a2</span>&nbsp;<span class="op" id="3802917">:=</span>&nbsp;<span class="ident" id="3802920">scaleDenom</span><span class="op" id="3802930">(</span><span class="op" id="3802931">&amp;</span><span class="ident" id="3802932">y</span><span class="op" id="3802933">.</span><span class="ident" id="3802934">a</span><span class="op" id="3802935">,</span>&nbsp;<span class="ident" id="3802937">x</span><span class="op" id="3802938">.</span><span class="ident" id="3802939">b</span><span class="op" id="3802940">.</span><span class="ident" id="3802941">abs</span><span class="op" id="3802944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802947">z</span><span class="op" id="3802948">.</span><span class="ident" id="3802949">a</span><span class="op" id="3802950">.</span><span class="ident" id="3802951">Sub</span><span class="op" id="3802954">(</span><span class="ident" id="3802955">a1</span><span class="op" id="3802957">,</span>&nbsp;<span class="ident" id="3802959">a2</span><span class="op" id="3802961">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802964">z</span><span class="op" id="3802965">.</span><span class="ident" id="3802966">b</span><span class="op" id="3802967">.</span><span class="ident" id="3802968">abs</span>&nbsp;<span class="op" id="3802972">=</span>&nbsp;<span class="ident" id="3802974">mulDenom</span><span class="op" id="3802982">(</span><span class="ident" id="3802983">z</span><span class="op" id="3802984">.</span><span class="ident" id="3802985">b</span><span class="op" id="3802986">.</span><span class="ident" id="3802987">abs</span><span class="op" id="3802990">,</span>&nbsp;<span class="ident" id="3802992">x</span><span class="op" id="3802993">.</span><span class="ident" id="3802994">b</span><span class="op" id="3802995">.</span><span class="ident" id="3802996">abs</span><span class="op" id="3802999">,</span>&nbsp;<span class="ident" id="3803001">y</span><span class="op" id="3803002">.</span><span class="ident" id="3803003">b</span><span class="op" id="3803004">.</span><span class="ident" id="3803005">abs</span><span class="op" id="3803008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803011">return</span>&nbsp;<span class="ident" id="3803018">z</span><span class="op" id="3803019">.</span><span class="ident" id="3803020">norm</span><span class="op" id="3803024">(</span><span class="op" id="3803025">)</span><br>
<span class="lineno"></span><span class="op" id="3803027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3803030">//&nbsp;Mul&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;product&nbsp;x*y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">495</span><span class="keyword" id="3803078">func</span>&nbsp;<span class="op" id="3803083">(</span><span class="ident" id="3803084">z</span>&nbsp;<span class="op" id="3803086">*</span><span class="ident" id="3803087">Rat</span><span class="op" id="3803090">)</span>&nbsp;<span class="ident" id="3803092">Mul</span><span class="op" id="3803095">(</span><span class="ident" id="3803096">x</span><span class="op" id="3803097">,</span>&nbsp;<span class="ident" id="3803099">y</span>&nbsp;<span class="op" id="3803101">*</span><span class="ident" id="3803102">Rat</span><span class="op" id="3803105">)</span>&nbsp;<span class="op" id="3803107">*</span><span class="ident" id="3803108">Rat</span>&nbsp;<span class="op" id="3803112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803115">z</span><span class="op" id="3803116">.</span><span class="ident" id="3803117">a</span><span class="op" id="3803118">.</span><span class="ident" id="3803119">Mul</span><span class="op" id="3803122">(</span><span class="op" id="3803123">&amp;</span><span class="ident" id="3803124">x</span><span class="op" id="3803125">.</span><span class="ident" id="3803126">a</span><span class="op" id="3803127">,</span>&nbsp;<span class="op" id="3803129">&amp;</span><span class="ident" id="3803130">y</span><span class="op" id="3803131">.</span><span class="ident" id="3803132">a</span><span class="op" id="3803133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803136">z</span><span class="op" id="3803137">.</span><span class="ident" id="3803138">b</span><span class="op" id="3803139">.</span><span class="ident" id="3803140">abs</span>&nbsp;<span class="op" id="3803144">=</span>&nbsp;<span class="ident" id="3803146">mulDenom</span><span class="op" id="3803154">(</span><span class="ident" id="3803155">z</span><span class="op" id="3803156">.</span><span class="ident" id="3803157">b</span><span class="op" id="3803158">.</span><span class="ident" id="3803159">abs</span><span class="op" id="3803162">,</span>&nbsp;<span class="ident" id="3803164">x</span><span class="op" id="3803165">.</span><span class="ident" id="3803166">b</span><span class="op" id="3803167">.</span><span class="ident" id="3803168">abs</span><span class="op" id="3803171">,</span>&nbsp;<span class="ident" id="3803173">y</span><span class="op" id="3803174">.</span><span class="ident" id="3803175">b</span><span class="op" id="3803176">.</span><span class="ident" id="3803177">abs</span><span class="op" id="3803180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803183">return</span>&nbsp;<span class="ident" id="3803190">z</span><span class="op" id="3803191">.</span><span class="ident" id="3803192">norm</span><span class="op" id="3803196">(</span><span class="op" id="3803197">)</span><br>
<span class="lineno"></span><span class="op" id="3803199">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="3803202">//&nbsp;Quo&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;quotient&nbsp;x/y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3803251">//&nbsp;If&nbsp;y&nbsp;==&nbsp;0,&nbsp;a&nbsp;division-by-zero&nbsp;run-time&nbsp;panic&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword" id="3803307">func</span>&nbsp;<span class="op" id="3803312">(</span><span class="ident" id="3803313">z</span>&nbsp;<span class="op" id="3803315">*</span><span class="ident" id="3803316">Rat</span><span class="op" id="3803319">)</span>&nbsp;<span class="ident" id="3803321">Quo</span><span class="op" id="3803324">(</span><span class="ident" id="3803325">x</span><span class="op" id="3803326">,</span>&nbsp;<span class="ident" id="3803328">y</span>&nbsp;<span class="op" id="3803330">*</span><span class="ident" id="3803331">Rat</span><span class="op" id="3803334">)</span>&nbsp;<span class="op" id="3803336">*</span><span class="ident" id="3803337">Rat</span>&nbsp;<span class="op" id="3803341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803344">if</span>&nbsp;<span class="builtinfunc" id="3803347">len</span><span class="op" id="3803350">(</span><span class="ident" id="3803351">y</span><span class="op" id="3803352">.</span><span class="ident" id="3803353">a</span><span class="op" id="3803354">.</span><span class="ident" id="3803355">abs</span><span class="op" id="3803358">)</span>&nbsp;<span class="op" id="3803360">==</span>&nbsp;<span class="num" id="3803363">0</span>&nbsp;<span class="op" id="3803365">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3803369">panic</span><span class="op" id="3803374">(</span><span class="string" id="3803375">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3803393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803399">a</span>&nbsp;<span class="op" id="3803401">:=</span>&nbsp;<span class="ident" id="3803404">scaleDenom</span><span class="op" id="3803414">(</span><span class="op" id="3803415">&amp;</span><span class="ident" id="3803416">x</span><span class="op" id="3803417">.</span><span class="ident" id="3803418">a</span><span class="op" id="3803419">,</span>&nbsp;<span class="ident" id="3803421">y</span><span class="op" id="3803422">.</span><span class="ident" id="3803423">b</span><span class="op" id="3803424">.</span><span class="ident" id="3803425">abs</span><span class="op" id="3803428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803431">b</span>&nbsp;<span class="op" id="3803433">:=</span>&nbsp;<span class="ident" id="3803436">scaleDenom</span><span class="op" id="3803446">(</span><span class="op" id="3803447">&amp;</span><span class="ident" id="3803448">y</span><span class="op" id="3803449">.</span><span class="ident" id="3803450">a</span><span class="op" id="3803451">,</span>&nbsp;<span class="ident" id="3803453">x</span><span class="op" id="3803454">.</span><span class="ident" id="3803455">b</span><span class="op" id="3803456">.</span><span class="ident" id="3803457">abs</span><span class="op" id="3803460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803463">z</span><span class="op" id="3803464">.</span><span class="ident" id="3803465">a</span><span class="op" id="3803466">.</span><span class="ident" id="3803467">abs</span>&nbsp;<span class="op" id="3803471">=</span>&nbsp;<span class="ident" id="3803473">a</span><span class="op" id="3803474">.</span><span class="ident" id="3803475">abs</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803480">z</span><span class="op" id="3803481">.</span><span class="ident" id="3803482">b</span><span class="op" id="3803483">.</span><span class="ident" id="3803484">abs</span>&nbsp;<span class="op" id="3803488">=</span>&nbsp;<span class="ident" id="3803490">b</span><span class="op" id="3803491">.</span><span class="ident" id="3803492">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803497">z</span><span class="op" id="3803498">.</span><span class="ident" id="3803499">a</span><span class="op" id="3803500">.</span><span class="ident" id="3803501">neg</span>&nbsp;<span class="op" id="3803505">=</span>&nbsp;<span class="ident" id="3803507">a</span><span class="op" id="3803508">.</span><span class="ident" id="3803509">neg</span>&nbsp;<span class="op" id="3803513">!=</span>&nbsp;<span class="ident" id="3803516">b</span><span class="op" id="3803517">.</span><span class="ident" id="3803518">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803523">return</span>&nbsp;<span class="ident" id="3803530">z</span><span class="op" id="3803531">.</span><span class="ident" id="3803532">norm</span><span class="op" id="3803536">(</span><span class="op" id="3803537">)</span><br>
<span class="lineno"></span><span class="op" id="3803539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="3803542">func</span>&nbsp;<span class="ident" id="3803547">ratTok</span><span class="op" id="3803553">(</span><span class="ident" id="3803554">ch</span>&nbsp;<span class="builtintype" id="3803557">rune</span><span class="op" id="3803561">)</span>&nbsp;<span class="builtintype" id="3803563">bool</span>&nbsp;<span class="op" id="3803568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803571">return</span>&nbsp;<span class="ident" id="3803578">strings</span><span class="op" id="3803585">.</span><span class="ident" id="3803586">IndexRune</span><span class="op" id="3803595">(</span><span class="string" id="3803596">&#34;+-/0123456789.eE&#34;</span><span class="op" id="3803614">,</span>&nbsp;<span class="ident" id="3803616">ch</span><span class="op" id="3803618">)</span>&nbsp;<span class="op" id="3803620">&gt;=</span>&nbsp;<span class="num" id="3803623">0</span><br>
<span class="lineno"></span><span class="op" id="3803625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3803628">//&nbsp;Scan&nbsp;is&nbsp;a&nbsp;support&nbsp;routine&nbsp;for&nbsp;fmt.Scanner.&nbsp;It&nbsp;accepts&nbsp;the&nbsp;formats</span><br>
<span class="lineno">520</span><span class="comment" id="3803697">//&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;F&#39;,&nbsp;&#39;g&#39;,&nbsp;&#39;G&#39;,&nbsp;and&nbsp;&#39;v&#39;.&nbsp;All&nbsp;formats&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno"></span><span class="keyword" id="3803767">func</span>&nbsp;<span class="op" id="3803772">(</span><span class="ident" id="3803773">z</span>&nbsp;<span class="op" id="3803775">*</span><span class="ident" id="3803776">Rat</span><span class="op" id="3803779">)</span>&nbsp;<span class="ident" id="3803781">Scan</span><span class="op" id="3803785">(</span><span class="ident" id="3803786">s</span>&nbsp;<span class="ident" id="3803788">fmt</span><span class="op" id="3803791">.</span><span class="ident" id="3803792">ScanState</span><span class="op" id="3803801">,</span>&nbsp;<span class="ident" id="3803803">ch</span>&nbsp;<span class="builtintype" id="3803806">rune</span><span class="op" id="3803810">)</span>&nbsp;<span class="builtintype" id="3803812">error</span>&nbsp;<span class="op" id="3803818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803821">tok</span><span class="op" id="3803824">,</span>&nbsp;<span class="ident" id="3803826">err</span>&nbsp;<span class="op" id="3803830">:=</span>&nbsp;<span class="ident" id="3803833">s</span><span class="op" id="3803834">.</span><span class="ident" id="3803835">Token</span><span class="op" id="3803840">(</span><span class="builtintype" id="3803841">true</span><span class="op" id="3803845">,</span>&nbsp;<span class="ident" id="3803847">ratTok</span><span class="op" id="3803853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803856">if</span>&nbsp;<span class="ident" id="3803859">err</span>&nbsp;<span class="op" id="3803863">!=</span>&nbsp;<span class="ident" id="3803866">nil</span>&nbsp;<span class="op" id="3803870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803874">return</span>&nbsp;<span class="ident" id="3803881">err</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803889">if</span>&nbsp;<span class="ident" id="3803892">strings</span><span class="op" id="3803899">.</span><span class="ident" id="3803900">IndexRune</span><span class="op" id="3803909">(</span><span class="string" id="3803910">&#34;efgEFGv&#34;</span><span class="op" id="3803919">,</span>&nbsp;<span class="ident" id="3803921">ch</span><span class="op" id="3803923">)</span>&nbsp;<span class="op" id="3803925">&lt;</span>&nbsp;<span class="num" id="3803927">0</span>&nbsp;<span class="op" id="3803929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803933">return</span>&nbsp;<span class="ident" id="3803940">errors</span><span class="op" id="3803946">.</span><span class="ident" id="3803947">New</span><span class="op" id="3803950">(</span><span class="string" id="3803951">&#34;Rat.Scan:&nbsp;invalid&nbsp;verb&#34;</span><span class="op" id="3803975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803981">if</span>&nbsp;<span class="ident" id="3803984">_</span><span class="op" id="3803985">,</span>&nbsp;<span class="ident" id="3803987">ok</span>&nbsp;<span class="op" id="3803990">:=</span>&nbsp;<span class="ident" id="3803993">z</span><span class="op" id="3803994">.</span><span class="ident" id="3803995">SetString</span><span class="op" id="3804004">(</span><span class="builtintype" id="3804005">string</span><span class="op" id="3804011">(</span><span class="ident" id="3804012">tok</span><span class="op" id="3804015">)</span><span class="op" id="3804016">)</span><span class="op" id="3804017">;</span>&nbsp;<span class="op" id="3804019">!</span><span class="ident" id="3804020">ok</span>&nbsp;<span class="op" id="3804023">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804027">return</span>&nbsp;<span class="ident" id="3804034">errors</span><span class="op" id="3804040">.</span><span class="ident" id="3804041">New</span><span class="op" id="3804044">(</span><span class="string" id="3804045">&#34;Rat.Scan:&nbsp;invalid&nbsp;syntax&#34;</span><span class="op" id="3804071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804077">return</span>&nbsp;<span class="ident" id="3804084">nil</span><br>
<span class="lineno"></span><span class="op" id="3804088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3804091">//&nbsp;SetString&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;s&nbsp;and&nbsp;returns&nbsp;z&nbsp;and&nbsp;a&nbsp;boolean&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3804168">//&nbsp;success.&nbsp;s&nbsp;can&nbsp;be&nbsp;given&nbsp;as&nbsp;a&nbsp;fraction&nbsp;&#34;a/b&#34;&nbsp;or&nbsp;as&nbsp;a&nbsp;floating-point&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3804245">//&nbsp;optionally&nbsp;followed&nbsp;by&nbsp;an&nbsp;exponent.&nbsp;If&nbsp;the&nbsp;operation&nbsp;failed,&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3804322">//&nbsp;z&nbsp;is&nbsp;undefined&nbsp;but&nbsp;the&nbsp;returned&nbsp;value&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3804371">func</span>&nbsp;<span class="op" id="3804376">(</span><span class="ident" id="3804377">z</span>&nbsp;<span class="op" id="3804379">*</span><span class="ident" id="3804380">Rat</span><span class="op" id="3804383">)</span>&nbsp;<span class="ident" id="3804385">SetString</span><span class="op" id="3804394">(</span><span class="ident" id="3804395">s</span>&nbsp;<span class="builtintype" id="3804397">string</span><span class="op" id="3804403">)</span>&nbsp;<span class="op" id="3804405">(</span><span class="op" id="3804406">*</span><span class="ident" id="3804407">Rat</span><span class="op" id="3804410">,</span>&nbsp;<span class="builtintype" id="3804412">bool</span><span class="op" id="3804416">)</span>&nbsp;<span class="op" id="3804418">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804421">if</span>&nbsp;<span class="builtinfunc" id="3804424">len</span><span class="op" id="3804427">(</span><span class="ident" id="3804428">s</span><span class="op" id="3804429">)</span>&nbsp;<span class="op" id="3804431">==</span>&nbsp;<span class="num" id="3804434">0</span>&nbsp;<span class="op" id="3804436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804440">return</span>&nbsp;<span class="ident" id="3804447">nil</span><span class="op" id="3804450">,</span>&nbsp;<span class="builtintype" id="3804452">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3804463">//&nbsp;check&nbsp;for&nbsp;a&nbsp;quotient</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804488">sep</span>&nbsp;<span class="op" id="3804492">:=</span>&nbsp;<span class="ident" id="3804495">strings</span><span class="op" id="3804502">.</span><span class="ident" id="3804503">Index</span><span class="op" id="3804508">(</span><span class="ident" id="3804509">s</span><span class="op" id="3804510">,</span>&nbsp;<span class="string" id="3804512">&#34;/&#34;</span><span class="op" id="3804515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804518">if</span>&nbsp;<span class="ident" id="3804521">sep</span>&nbsp;<span class="op" id="3804525">&gt;=</span>&nbsp;<span class="num" id="3804528">0</span>&nbsp;<span class="op" id="3804530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804534">if</span>&nbsp;<span class="ident" id="3804537">_</span><span class="op" id="3804538">,</span>&nbsp;<span class="ident" id="3804540">ok</span>&nbsp;<span class="op" id="3804543">:=</span>&nbsp;<span class="ident" id="3804546">z</span><span class="op" id="3804547">.</span><span class="ident" id="3804548">a</span><span class="op" id="3804549">.</span><span class="ident" id="3804550">SetString</span><span class="op" id="3804559">(</span><span class="ident" id="3804560">s</span><span class="op" id="3804561">[</span><span class="num" id="3804562">0</span><span class="op" id="3804563">:</span><span class="ident" id="3804564">sep</span><span class="op" id="3804567">]</span><span class="op" id="3804568">,</span>&nbsp;<span class="num" id="3804570">10</span><span class="op" id="3804572">)</span><span class="op" id="3804573">;</span>&nbsp;<span class="op" id="3804575">!</span><span class="ident" id="3804576">ok</span>&nbsp;<span class="op" id="3804579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804584">return</span>&nbsp;<span class="ident" id="3804591">nil</span><span class="op" id="3804594">,</span>&nbsp;<span class="builtintype" id="3804596">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804604">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804608">s</span>&nbsp;<span class="op" id="3804610">=</span>&nbsp;<span class="ident" id="3804612">s</span><span class="op" id="3804613">[</span><span class="ident" id="3804614">sep</span><span class="op" id="3804617">+</span><span class="num" id="3804618">1</span><span class="op" id="3804619">:</span><span class="op" id="3804620">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804624">var</span>&nbsp;<span class="ident" id="3804628">err</span>&nbsp;<span class="builtintype" id="3804632">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804640">if</span>&nbsp;<span class="ident" id="3804643">z</span><span class="op" id="3804644">.</span><span class="ident" id="3804645">b</span><span class="op" id="3804646">.</span><span class="ident" id="3804647">abs</span><span class="op" id="3804650">,</span>&nbsp;<span class="ident" id="3804652">_</span><span class="op" id="3804653">,</span>&nbsp;<span class="ident" id="3804655">err</span>&nbsp;<span class="op" id="3804659">=</span>&nbsp;<span class="ident" id="3804661">z</span><span class="op" id="3804662">.</span><span class="ident" id="3804663">b</span><span class="op" id="3804664">.</span><span class="ident" id="3804665">abs</span><span class="op" id="3804668">.</span><span class="ident" id="3804669">scan</span><span class="op" id="3804673">(</span><span class="ident" id="3804674">strings</span><span class="op" id="3804681">.</span><span class="ident" id="3804682">NewReader</span><span class="op" id="3804691">(</span><span class="ident" id="3804692">s</span><span class="op" id="3804693">)</span><span class="op" id="3804694">,</span>&nbsp;<span class="num" id="3804696">10</span><span class="op" id="3804698">)</span><span class="op" id="3804699">;</span>&nbsp;<span class="ident" id="3804701">err</span>&nbsp;<span class="op" id="3804705">!=</span>&nbsp;<span class="ident" id="3804708">nil</span>&nbsp;<span class="op" id="3804712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804717">return</span>&nbsp;<span class="ident" id="3804724">nil</span><span class="op" id="3804727">,</span>&nbsp;<span class="builtintype" id="3804729">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804737">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804741">if</span>&nbsp;<span class="builtinfunc" id="3804744">len</span><span class="op" id="3804747">(</span><span class="ident" id="3804748">z</span><span class="op" id="3804749">.</span><span class="ident" id="3804750">b</span><span class="op" id="3804751">.</span><span class="ident" id="3804752">abs</span><span class="op" id="3804755">)</span>&nbsp;<span class="op" id="3804757">==</span>&nbsp;<span class="num" id="3804760">0</span>&nbsp;<span class="op" id="3804762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804767">return</span>&nbsp;<span class="ident" id="3804774">nil</span><span class="op" id="3804777">,</span>&nbsp;<span class="builtintype" id="3804779">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804791">return</span>&nbsp;<span class="ident" id="3804798">z</span><span class="op" id="3804799">.</span><span class="ident" id="3804800">norm</span><span class="op" id="3804804">(</span><span class="op" id="3804805">)</span><span class="op" id="3804806">,</span>&nbsp;<span class="builtintype" id="3804808">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3804814">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3804818">//&nbsp;check&nbsp;for&nbsp;a&nbsp;decimal&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804848">sep</span>&nbsp;<span class="op" id="3804852">=</span>&nbsp;<span class="ident" id="3804854">strings</span><span class="op" id="3804861">.</span><span class="ident" id="3804862">Index</span><span class="op" id="3804867">(</span><span class="ident" id="3804868">s</span><span class="op" id="3804869">,</span>&nbsp;<span class="string" id="3804871">&#34;.&#34;</span><span class="op" id="3804874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3804877">//&nbsp;check&nbsp;for&nbsp;an&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3804903">e</span>&nbsp;<span class="op" id="3804905">:=</span>&nbsp;<span class="ident" id="3804908">strings</span><span class="op" id="3804915">.</span><span class="ident" id="3804916">IndexAny</span><span class="op" id="3804924">(</span><span class="ident" id="3804925">s</span><span class="op" id="3804926">,</span>&nbsp;<span class="string" id="3804928">&#34;eE&#34;</span><span class="op" id="3804932">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804935">var</span>&nbsp;<span class="ident" id="3804939">exp</span>&nbsp;<span class="ident" id="3804943">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804948">if</span>&nbsp;<span class="ident" id="3804951">e</span>&nbsp;<span class="op" id="3804953">&gt;=</span>&nbsp;<span class="num" id="3804956">0</span>&nbsp;<span class="op" id="3804958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3804962">if</span>&nbsp;<span class="ident" id="3804965">e</span>&nbsp;<span class="op" id="3804967">&lt;</span>&nbsp;<span class="ident" id="3804969">sep</span>&nbsp;<span class="op" id="3804973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3804978">//&nbsp;The&nbsp;E&nbsp;must&nbsp;come&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805025">return</span>&nbsp;<span class="ident" id="3805032">nil</span><span class="op" id="3805035">,</span>&nbsp;<span class="builtintype" id="3805037">false</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805049">if</span>&nbsp;<span class="ident" id="3805052">_</span><span class="op" id="3805053">,</span>&nbsp;<span class="ident" id="3805055">ok</span>&nbsp;<span class="op" id="3805058">:=</span>&nbsp;<span class="ident" id="3805061">exp</span><span class="op" id="3805064">.</span><span class="ident" id="3805065">SetString</span><span class="op" id="3805074">(</span><span class="ident" id="3805075">s</span><span class="op" id="3805076">[</span><span class="ident" id="3805077">e</span><span class="op" id="3805078">+</span><span class="num" id="3805079">1</span><span class="op" id="3805080">:</span><span class="op" id="3805081">]</span><span class="op" id="3805082">,</span>&nbsp;<span class="num" id="3805084">10</span><span class="op" id="3805086">)</span><span class="op" id="3805087">;</span>&nbsp;<span class="op" id="3805089">!</span><span class="ident" id="3805090">ok</span>&nbsp;<span class="op" id="3805093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805098">return</span>&nbsp;<span class="ident" id="3805105">nil</span><span class="op" id="3805108">,</span>&nbsp;<span class="builtintype" id="3805110">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805122">s</span>&nbsp;<span class="op" id="3805124">=</span>&nbsp;<span class="ident" id="3805126">s</span><span class="op" id="3805127">[</span><span class="num" id="3805128">0</span><span class="op" id="3805129">:</span><span class="ident" id="3805130">e</span><span class="op" id="3805131">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805137">if</span>&nbsp;<span class="ident" id="3805140">sep</span>&nbsp;<span class="op" id="3805144">&gt;=</span>&nbsp;<span class="num" id="3805147">0</span>&nbsp;<span class="op" id="3805149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805153">s</span>&nbsp;<span class="op" id="3805155">=</span>&nbsp;<span class="ident" id="3805157">s</span><span class="op" id="3805158">[</span><span class="num" id="3805159">0</span><span class="op" id="3805160">:</span><span class="ident" id="3805161">sep</span><span class="op" id="3805164">]</span>&nbsp;<span class="op" id="3805166">+</span>&nbsp;<span class="ident" id="3805168">s</span><span class="op" id="3805169">[</span><span class="ident" id="3805170">sep</span><span class="op" id="3805173">+</span><span class="num" id="3805174">1</span><span class="op" id="3805175">:</span><span class="op" id="3805176">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805180">exp</span><span class="op" id="3805183">.</span><span class="ident" id="3805184">Sub</span><span class="op" id="3805187">(</span><span class="op" id="3805188">&amp;</span><span class="ident" id="3805189">exp</span><span class="op" id="3805192">,</span>&nbsp;<span class="ident" id="3805194">NewInt</span><span class="op" id="3805200">(</span><span class="ident" id="3805201">int64</span><span class="op" id="3805206">(</span><span class="builtinfunc" id="3805207">len</span><span class="op" id="3805210">(</span><span class="ident" id="3805211">s</span><span class="op" id="3805212">)</span><span class="op" id="3805213">-</span><span class="ident" id="3805214">sep</span><span class="op" id="3805217">)</span><span class="op" id="3805218">)</span><span class="op" id="3805219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805222">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805226">if</span>&nbsp;<span class="ident" id="3805229">_</span><span class="op" id="3805230">,</span>&nbsp;<span class="ident" id="3805232">ok</span>&nbsp;<span class="op" id="3805235">:=</span>&nbsp;<span class="ident" id="3805238">z</span><span class="op" id="3805239">.</span><span class="ident" id="3805240">a</span><span class="op" id="3805241">.</span><span class="ident" id="3805242">SetString</span><span class="op" id="3805251">(</span><span class="ident" id="3805252">s</span><span class="op" id="3805253">,</span>&nbsp;<span class="num" id="3805255">10</span><span class="op" id="3805257">)</span><span class="op" id="3805258">;</span>&nbsp;<span class="op" id="3805260">!</span><span class="ident" id="3805261">ok</span>&nbsp;<span class="op" id="3805264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805268">return</span>&nbsp;<span class="ident" id="3805275">nil</span><span class="op" id="3805278">,</span>&nbsp;<span class="builtintype" id="3805280">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805290">powTen</span>&nbsp;<span class="op" id="3805297">:=</span>&nbsp;<span class="ident" id="3805300">nat</span><span class="op" id="3805303">(</span><span class="ident" id="3805304">nil</span><span class="op" id="3805307">)</span><span class="op" id="3805308">.</span><span class="ident" id="3805309">expNN</span><span class="op" id="3805314">(</span><span class="ident" id="3805315">natTen</span><span class="op" id="3805321">,</span>&nbsp;<span class="ident" id="3805323">exp</span><span class="op" id="3805326">.</span><span class="ident" id="3805327">abs</span><span class="op" id="3805330">,</span>&nbsp;<span class="ident" id="3805332">nil</span><span class="op" id="3805335">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805338">if</span>&nbsp;<span class="ident" id="3805341">exp</span><span class="op" id="3805344">.</span><span class="ident" id="3805345">neg</span>&nbsp;<span class="op" id="3805349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805353">z</span><span class="op" id="3805354">.</span><span class="ident" id="3805355">b</span><span class="op" id="3805356">.</span><span class="ident" id="3805357">abs</span>&nbsp;<span class="op" id="3805361">=</span>&nbsp;<span class="ident" id="3805363">powTen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805372">z</span><span class="op" id="3805373">.</span><span class="ident" id="3805374">norm</span><span class="op" id="3805378">(</span><span class="op" id="3805379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805382">}</span>&nbsp;<span class="keyword" id="3805384">else</span>&nbsp;<span class="op" id="3805389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805393">z</span><span class="op" id="3805394">.</span><span class="ident" id="3805395">a</span><span class="op" id="3805396">.</span><span class="ident" id="3805397">abs</span>&nbsp;<span class="op" id="3805401">=</span>&nbsp;<span class="ident" id="3805403">z</span><span class="op" id="3805404">.</span><span class="ident" id="3805405">a</span><span class="op" id="3805406">.</span><span class="ident" id="3805407">abs</span><span class="op" id="3805410">.</span><span class="ident" id="3805411">mul</span><span class="op" id="3805414">(</span><span class="ident" id="3805415">z</span><span class="op" id="3805416">.</span><span class="ident" id="3805417">a</span><span class="op" id="3805418">.</span><span class="ident" id="3805419">abs</span><span class="op" id="3805422">,</span>&nbsp;<span class="ident" id="3805424">powTen</span><span class="op" id="3805430">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805434">z</span><span class="op" id="3805435">.</span><span class="ident" id="3805436">b</span><span class="op" id="3805437">.</span><span class="ident" id="3805438">abs</span>&nbsp;<span class="op" id="3805442">=</span>&nbsp;<span class="ident" id="3805444">z</span><span class="op" id="3805445">.</span><span class="ident" id="3805446">b</span><span class="op" id="3805447">.</span><span class="ident" id="3805448">abs</span><span class="op" id="3805451">.</span><span class="builtinfunc" id="3805452">make</span><span class="op" id="3805456">(</span><span class="num" id="3805457">0</span><span class="op" id="3805458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805465">return</span>&nbsp;<span class="ident" id="3805472">z</span><span class="op" id="3805473">,</span>&nbsp;<span class="builtintype" id="3805475">true</span><br>
<span class="lineno"></span><span class="op" id="3805480">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="comment" id="3805483">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;(even&nbsp;if&nbsp;b&nbsp;==&nbsp;1).</span><br>
<span class="lineno"></span><span class="keyword" id="3805566">func</span>&nbsp;<span class="op" id="3805571">(</span><span class="ident" id="3805572">x</span>&nbsp;<span class="op" id="3805574">*</span><span class="ident" id="3805575">Rat</span><span class="op" id="3805578">)</span>&nbsp;<span class="ident" id="3805580">String</span><span class="op" id="3805586">(</span><span class="op" id="3805587">)</span>&nbsp;<span class="builtintype" id="3805589">string</span>&nbsp;<span class="op" id="3805596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805599">s</span>&nbsp;<span class="op" id="3805601">:=</span>&nbsp;<span class="string" id="3805604">&#34;/1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805610">if</span>&nbsp;<span class="builtinfunc" id="3805613">len</span><span class="op" id="3805616">(</span><span class="ident" id="3805617">x</span><span class="op" id="3805618">.</span><span class="ident" id="3805619">b</span><span class="op" id="3805620">.</span><span class="ident" id="3805621">abs</span><span class="op" id="3805624">)</span>&nbsp;<span class="op" id="3805626">!=</span>&nbsp;<span class="num" id="3805629">0</span>&nbsp;<span class="op" id="3805631">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3805635">s</span>&nbsp;<span class="op" id="3805637">=</span>&nbsp;<span class="string" id="3805639">&#34;/&#34;</span>&nbsp;<span class="op" id="3805643">+</span>&nbsp;<span class="ident" id="3805645">x</span><span class="op" id="3805646">.</span><span class="ident" id="3805647">b</span><span class="op" id="3805648">.</span><span class="ident" id="3805649">abs</span><span class="op" id="3805652">.</span><span class="ident" id="3805653">decimalString</span><span class="op" id="3805666">(</span><span class="op" id="3805667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805673">return</span>&nbsp;<span class="ident" id="3805680">x</span><span class="op" id="3805681">.</span><span class="ident" id="3805682">a</span><span class="op" id="3805683">.</span><span class="ident" id="3805684">String</span><span class="op" id="3805690">(</span><span class="op" id="3805691">)</span>&nbsp;<span class="op" id="3805693">+</span>&nbsp;<span class="ident" id="3805695">s</span><br>
<span class="lineno"></span><span class="op" id="3805697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="comment" id="3805700">//&nbsp;RatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;if&nbsp;b&nbsp;!=&nbsp;1,</span><br>
<span class="lineno"></span><span class="comment" id="3805779">//&nbsp;and&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a&#34;&nbsp;if&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3805813">func</span>&nbsp;<span class="op" id="3805818">(</span><span class="ident" id="3805819">x</span>&nbsp;<span class="op" id="3805821">*</span><span class="ident" id="3805822">Rat</span><span class="op" id="3805825">)</span>&nbsp;<span class="ident" id="3805827">RatString</span><span class="op" id="3805836">(</span><span class="op" id="3805837">)</span>&nbsp;<span class="builtintype" id="3805839">string</span>&nbsp;<span class="op" id="3805846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805849">if</span>&nbsp;<span class="ident" id="3805852">x</span><span class="op" id="3805853">.</span><span class="ident" id="3805854">IsInt</span><span class="op" id="3805859">(</span><span class="op" id="3805860">)</span>&nbsp;<span class="op" id="3805862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805866">return</span>&nbsp;<span class="ident" id="3805873">x</span><span class="op" id="3805874">.</span><span class="ident" id="3805875">a</span><span class="op" id="3805876">.</span><span class="ident" id="3805877">String</span><span class="op" id="3805883">(</span><span class="op" id="3805884">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3805887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3805890">return</span>&nbsp;<span class="ident" id="3805897">x</span><span class="op" id="3805898">.</span><span class="ident" id="3805899">String</span><span class="op" id="3805905">(</span><span class="op" id="3805906">)</span><br>
<span class="lineno"></span><span class="op" id="3805908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3805911">//&nbsp;FloatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;decimal&nbsp;form&nbsp;with&nbsp;prec</span><br>
<span class="lineno">615</span><span class="comment" id="3805989">//&nbsp;digits&nbsp;of&nbsp;precision&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point&nbsp;and&nbsp;the&nbsp;last&nbsp;digit&nbsp;rounded.</span><br>
<span class="lineno"></span><span class="keyword" id="3806064">func</span>&nbsp;<span class="op" id="3806069">(</span><span class="ident" id="3806070">x</span>&nbsp;<span class="op" id="3806072">*</span><span class="ident" id="3806073">Rat</span><span class="op" id="3806076">)</span>&nbsp;<span class="ident" id="3806078">FloatString</span><span class="op" id="3806089">(</span><span class="ident" id="3806090">prec</span>&nbsp;<span class="builtintype" id="3806095">int</span><span class="op" id="3806098">)</span>&nbsp;<span class="builtintype" id="3806100">string</span>&nbsp;<span class="op" id="3806107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806110">if</span>&nbsp;<span class="ident" id="3806113">x</span><span class="op" id="3806114">.</span><span class="ident" id="3806115">IsInt</span><span class="op" id="3806120">(</span><span class="op" id="3806121">)</span>&nbsp;<span class="op" id="3806123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806127">s</span>&nbsp;<span class="op" id="3806129">:=</span>&nbsp;<span class="ident" id="3806132">x</span><span class="op" id="3806133">.</span><span class="ident" id="3806134">a</span><span class="op" id="3806135">.</span><span class="ident" id="3806136">String</span><span class="op" id="3806142">(</span><span class="op" id="3806143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806147">if</span>&nbsp;<span class="ident" id="3806150">prec</span>&nbsp;<span class="op" id="3806155">&gt;</span>&nbsp;<span class="num" id="3806157">0</span>&nbsp;<span class="op" id="3806159">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806164">s</span>&nbsp;<span class="op" id="3806166">+=</span>&nbsp;<span class="string" id="3806169">&#34;.&#34;</span>&nbsp;<span class="op" id="3806173">+</span>&nbsp;<span class="ident" id="3806175">strings</span><span class="op" id="3806182">.</span><span class="ident" id="3806183">Repeat</span><span class="op" id="3806189">(</span><span class="string" id="3806190">&#34;0&#34;</span><span class="op" id="3806193">,</span>&nbsp;<span class="ident" id="3806195">prec</span><span class="op" id="3806199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806207">return</span>&nbsp;<span class="ident" id="3806214">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3806220">//&nbsp;x.b.abs&nbsp;!=&nbsp;0</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806238">q</span><span class="op" id="3806239">,</span>&nbsp;<span class="ident" id="3806241">r</span>&nbsp;<span class="op" id="3806243">:=</span>&nbsp;<span class="ident" id="3806246">nat</span><span class="op" id="3806249">(</span><span class="ident" id="3806250">nil</span><span class="op" id="3806253">)</span><span class="op" id="3806254">.</span><span class="ident" id="3806255">div</span><span class="op" id="3806258">(</span><span class="ident" id="3806259">nat</span><span class="op" id="3806262">(</span><span class="ident" id="3806263">nil</span><span class="op" id="3806266">)</span><span class="op" id="3806267">,</span>&nbsp;<span class="ident" id="3806269">x</span><span class="op" id="3806270">.</span><span class="ident" id="3806271">a</span><span class="op" id="3806272">.</span><span class="ident" id="3806273">abs</span><span class="op" id="3806276">,</span>&nbsp;<span class="ident" id="3806278">x</span><span class="op" id="3806279">.</span><span class="ident" id="3806280">b</span><span class="op" id="3806281">.</span><span class="ident" id="3806282">abs</span><span class="op" id="3806285">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806289">p</span>&nbsp;<span class="op" id="3806291">:=</span>&nbsp;<span class="ident" id="3806294">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806302">if</span>&nbsp;<span class="ident" id="3806305">prec</span>&nbsp;<span class="op" id="3806310">&gt;</span>&nbsp;<span class="num" id="3806312">0</span>&nbsp;<span class="op" id="3806314">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806318">p</span>&nbsp;<span class="op" id="3806320">=</span>&nbsp;<span class="ident" id="3806322">nat</span><span class="op" id="3806325">(</span><span class="ident" id="3806326">nil</span><span class="op" id="3806329">)</span><span class="op" id="3806330">.</span><span class="ident" id="3806331">expNN</span><span class="op" id="3806336">(</span><span class="ident" id="3806337">natTen</span><span class="op" id="3806343">,</span>&nbsp;<span class="ident" id="3806345">nat</span><span class="op" id="3806348">(</span><span class="ident" id="3806349">nil</span><span class="op" id="3806352">)</span><span class="op" id="3806353">.</span><span class="ident" id="3806354">setUint64</span><span class="op" id="3806363">(</span><span class="ident" id="3806364">uint64</span><span class="op" id="3806370">(</span><span class="ident" id="3806371">prec</span><span class="op" id="3806375">)</span><span class="op" id="3806376">)</span><span class="op" id="3806377">,</span>&nbsp;<span class="ident" id="3806379">nil</span><span class="op" id="3806382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806389">r</span>&nbsp;<span class="op" id="3806391">=</span>&nbsp;<span class="ident" id="3806393">r</span><span class="op" id="3806394">.</span><span class="ident" id="3806395">mul</span><span class="op" id="3806398">(</span><span class="ident" id="3806399">r</span><span class="op" id="3806400">,</span>&nbsp;<span class="ident" id="3806402">p</span><span class="op" id="3806403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806406">r</span><span class="op" id="3806407">,</span>&nbsp;<span class="ident" id="3806409">r2</span>&nbsp;<span class="op" id="3806412">:=</span>&nbsp;<span class="ident" id="3806415">r</span><span class="op" id="3806416">.</span><span class="ident" id="3806417">div</span><span class="op" id="3806420">(</span><span class="ident" id="3806421">nat</span><span class="op" id="3806424">(</span><span class="ident" id="3806425">nil</span><span class="op" id="3806428">)</span><span class="op" id="3806429">,</span>&nbsp;<span class="ident" id="3806431">r</span><span class="op" id="3806432">,</span>&nbsp;<span class="ident" id="3806434">x</span><span class="op" id="3806435">.</span><span class="ident" id="3806436">b</span><span class="op" id="3806437">.</span><span class="ident" id="3806438">abs</span><span class="op" id="3806441">)</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3806445">//&nbsp;see&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;round&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806476">r2</span>&nbsp;<span class="op" id="3806479">=</span>&nbsp;<span class="ident" id="3806481">r2</span><span class="op" id="3806483">.</span><span class="ident" id="3806484">add</span><span class="op" id="3806487">(</span><span class="ident" id="3806488">r2</span><span class="op" id="3806490">,</span>&nbsp;<span class="ident" id="3806492">r2</span><span class="op" id="3806494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806497">if</span>&nbsp;<span class="ident" id="3806500">x</span><span class="op" id="3806501">.</span><span class="ident" id="3806502">b</span><span class="op" id="3806503">.</span><span class="ident" id="3806504">abs</span><span class="op" id="3806507">.</span><span class="ident" id="3806508">cmp</span><span class="op" id="3806511">(</span><span class="ident" id="3806512">r2</span><span class="op" id="3806514">)</span>&nbsp;<span class="op" id="3806516">&lt;=</span>&nbsp;<span class="num" id="3806519">0</span>&nbsp;<span class="op" id="3806521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806525">r</span>&nbsp;<span class="op" id="3806527">=</span>&nbsp;<span class="ident" id="3806529">r</span><span class="op" id="3806530">.</span><span class="ident" id="3806531">add</span><span class="op" id="3806534">(</span><span class="ident" id="3806535">r</span><span class="op" id="3806536">,</span>&nbsp;<span class="ident" id="3806538">natOne</span><span class="op" id="3806544">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806548">if</span>&nbsp;<span class="ident" id="3806551">r</span><span class="op" id="3806552">.</span><span class="ident" id="3806553">cmp</span><span class="op" id="3806556">(</span><span class="ident" id="3806557">p</span><span class="op" id="3806558">)</span>&nbsp;<span class="op" id="3806560">&gt;=</span>&nbsp;<span class="num" id="3806563">0</span>&nbsp;<span class="op" id="3806565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806570">q</span>&nbsp;<span class="op" id="3806572">=</span>&nbsp;<span class="ident" id="3806574">nat</span><span class="op" id="3806577">(</span><span class="ident" id="3806578">nil</span><span class="op" id="3806581">)</span><span class="op" id="3806582">.</span><span class="ident" id="3806583">add</span><span class="op" id="3806586">(</span><span class="ident" id="3806587">q</span><span class="op" id="3806588">,</span>&nbsp;<span class="ident" id="3806590">natOne</span><span class="op" id="3806596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806601">r</span>&nbsp;<span class="op" id="3806603">=</span>&nbsp;<span class="ident" id="3806605">nat</span><span class="op" id="3806608">(</span><span class="ident" id="3806609">nil</span><span class="op" id="3806612">)</span><span class="op" id="3806613">.</span><span class="ident" id="3806614">sub</span><span class="op" id="3806617">(</span><span class="ident" id="3806618">r</span><span class="op" id="3806619">,</span>&nbsp;<span class="ident" id="3806621">p</span><span class="op" id="3806622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806629">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806633">s</span>&nbsp;<span class="op" id="3806635">:=</span>&nbsp;<span class="ident" id="3806638">q</span><span class="op" id="3806639">.</span><span class="ident" id="3806640">decimalString</span><span class="op" id="3806653">(</span><span class="op" id="3806654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806657">if</span>&nbsp;<span class="ident" id="3806660">x</span><span class="op" id="3806661">.</span><span class="ident" id="3806662">a</span><span class="op" id="3806663">.</span><span class="ident" id="3806664">neg</span>&nbsp;<span class="op" id="3806668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806672">s</span>&nbsp;<span class="op" id="3806674">=</span>&nbsp;<span class="string" id="3806676">&#34;-&#34;</span>&nbsp;<span class="op" id="3806680">+</span>&nbsp;<span class="ident" id="3806682">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806685">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806689">if</span>&nbsp;<span class="ident" id="3806692">prec</span>&nbsp;<span class="op" id="3806697">&gt;</span>&nbsp;<span class="num" id="3806699">0</span>&nbsp;<span class="op" id="3806701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806705">rs</span>&nbsp;<span class="op" id="3806708">:=</span>&nbsp;<span class="ident" id="3806711">r</span><span class="op" id="3806712">.</span><span class="ident" id="3806713">decimalString</span><span class="op" id="3806726">(</span><span class="op" id="3806727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806731">leadingZeros</span>&nbsp;<span class="op" id="3806744">:=</span>&nbsp;<span class="ident" id="3806747">prec</span>&nbsp;<span class="op" id="3806752">-</span>&nbsp;<span class="builtinfunc" id="3806754">len</span><span class="op" id="3806757">(</span><span class="ident" id="3806758">rs</span><span class="op" id="3806760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3806764">s</span>&nbsp;<span class="op" id="3806766">+=</span>&nbsp;<span class="string" id="3806769">&#34;.&#34;</span>&nbsp;<span class="op" id="3806773">+</span>&nbsp;<span class="ident" id="3806775">strings</span><span class="op" id="3806782">.</span><span class="ident" id="3806783">Repeat</span><span class="op" id="3806789">(</span><span class="string" id="3806790">&#34;0&#34;</span><span class="op" id="3806793">,</span>&nbsp;<span class="ident" id="3806795">leadingZeros</span><span class="op" id="3806807">)</span>&nbsp;<span class="op" id="3806809">+</span>&nbsp;<span class="ident" id="3806811">rs</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3806815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3806819">return</span>&nbsp;<span class="ident" id="3806826">s</span><br>
<span class="lineno"></span><span class="op" id="3806828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="3806831">//&nbsp;Gob&nbsp;codec&nbsp;version.&nbsp;Permits&nbsp;backward-compatible&nbsp;changes&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3806906">const</span>&nbsp;<span class="ident" id="3806912">ratGobVersion</span>&nbsp;<span class="builtintype" id="3806926">byte</span>&nbsp;<span class="op" id="3806931">=</span>&nbsp;<span class="num" id="3806933">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3806936">//&nbsp;GobEncode&nbsp;implements&nbsp;the&nbsp;gob.GobEncoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3806990">func</span>&nbsp;<span class="op" id="3806995">(</span><span class="ident" id="3806996">x</span>&nbsp;<span class="op" id="3806998">*</span><span class="ident" id="3806999">Rat</span><span class="op" id="3807002">)</span>&nbsp;<span class="ident" id="3807004">GobEncode</span><span class="op" id="3807013">(</span><span class="op" id="3807014">)</span>&nbsp;<span class="op" id="3807016">(</span><span class="op" id="3807017">[</span><span class="op" id="3807018">]</span><span class="builtintype" id="3807019">byte</span><span class="op" id="3807023">,</span>&nbsp;<span class="builtintype" id="3807025">error</span><span class="op" id="3807030">)</span>&nbsp;<span class="op" id="3807032">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807035">if</span>&nbsp;<span class="ident" id="3807038">x</span>&nbsp;<span class="op" id="3807040">==</span>&nbsp;<span class="ident" id="3807043">nil</span>&nbsp;<span class="op" id="3807047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807051">return</span>&nbsp;<span class="ident" id="3807058">nil</span><span class="op" id="3807061">,</span>&nbsp;<span class="ident" id="3807063">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807071">buf</span>&nbsp;<span class="op" id="3807075">:=</span>&nbsp;<span class="builtinfunc" id="3807078">make</span><span class="op" id="3807082">(</span><span class="op" id="3807083">[</span><span class="op" id="3807084">]</span><span class="builtintype" id="3807085">byte</span><span class="op" id="3807089">,</span>&nbsp;<span class="num" id="3807091">1</span><span class="op" id="3807092">+</span><span class="num" id="3807093">4</span><span class="op" id="3807094">+</span><span class="op" id="3807095">(</span><span class="builtinfunc" id="3807096">len</span><span class="op" id="3807099">(</span><span class="ident" id="3807100">x</span><span class="op" id="3807101">.</span><span class="ident" id="3807102">a</span><span class="op" id="3807103">.</span><span class="ident" id="3807104">abs</span><span class="op" id="3807107">)</span><span class="op" id="3807108">+</span><span class="builtinfunc" id="3807109">len</span><span class="op" id="3807112">(</span><span class="ident" id="3807113">x</span><span class="op" id="3807114">.</span><span class="ident" id="3807115">b</span><span class="op" id="3807116">.</span><span class="ident" id="3807117">abs</span><span class="op" id="3807120">)</span><span class="op" id="3807121">)</span><span class="op" id="3807122">*</span><span class="ident" id="3807123">_S</span><span class="op" id="3807125">)</span>&nbsp;<span class="comment" id="3807127">//&nbsp;extra&nbsp;bytes&nbsp;for&nbsp;version&nbsp;and&nbsp;sign&nbsp;bit&nbsp;(1),&nbsp;and&nbsp;numerator&nbsp;length&nbsp;(4)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807198">i</span>&nbsp;<span class="op" id="3807200">:=</span>&nbsp;<span class="ident" id="3807203">x</span><span class="op" id="3807204">.</span><span class="ident" id="3807205">b</span><span class="op" id="3807206">.</span><span class="ident" id="3807207">abs</span><span class="op" id="3807210">.</span><span class="ident" id="3807211">bytes</span><span class="op" id="3807216">(</span><span class="ident" id="3807217">buf</span><span class="op" id="3807220">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807223">j</span>&nbsp;<span class="op" id="3807225">:=</span>&nbsp;<span class="ident" id="3807228">x</span><span class="op" id="3807229">.</span><span class="ident" id="3807230">a</span><span class="op" id="3807231">.</span><span class="ident" id="3807232">abs</span><span class="op" id="3807235">.</span><span class="ident" id="3807236">bytes</span><span class="op" id="3807241">(</span><span class="ident" id="3807242">buf</span><span class="op" id="3807245">[</span><span class="num" id="3807246">0</span><span class="op" id="3807247">:</span><span class="ident" id="3807248">i</span><span class="op" id="3807249">]</span><span class="op" id="3807250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807253">n</span>&nbsp;<span class="op" id="3807255">:=</span>&nbsp;<span class="ident" id="3807258">i</span>&nbsp;<span class="op" id="3807260">-</span>&nbsp;<span class="ident" id="3807262">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807265">if</span>&nbsp;<span class="builtintype" id="3807268">int</span><span class="op" id="3807271">(</span><span class="builtintype" id="3807272">uint32</span><span class="op" id="3807278">(</span><span class="ident" id="3807279">n</span><span class="op" id="3807280">)</span><span class="op" id="3807281">)</span>&nbsp;<span class="op" id="3807283">!=</span>&nbsp;<span class="ident" id="3807286">n</span>&nbsp;<span class="op" id="3807288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3807292">//&nbsp;this&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807322">return</span>&nbsp;<span class="ident" id="3807329">nil</span><span class="op" id="3807332">,</span>&nbsp;<span class="ident" id="3807334">errors</span><span class="op" id="3807340">.</span><span class="ident" id="3807341">New</span><span class="op" id="3807344">(</span><span class="string" id="3807345">&#34;Rat.GobEncode:&nbsp;numerator&nbsp;too&nbsp;large&#34;</span><span class="op" id="3807381">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807387">binary</span><span class="op" id="3807393">.</span><span class="ident" id="3807394">BigEndian</span><span class="op" id="3807403">.</span><span class="ident" id="3807404">PutUint32</span><span class="op" id="3807413">(</span><span class="ident" id="3807414">buf</span><span class="op" id="3807417">[</span><span class="ident" id="3807418">j</span><span class="op" id="3807419">-</span><span class="num" id="3807420">4</span><span class="op" id="3807421">:</span><span class="ident" id="3807422">j</span><span class="op" id="3807423">]</span><span class="op" id="3807424">,</span>&nbsp;<span class="builtintype" id="3807426">uint32</span><span class="op" id="3807432">(</span><span class="ident" id="3807433">n</span><span class="op" id="3807434">)</span><span class="op" id="3807435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807438">j</span>&nbsp;<span class="op" id="3807440">-=</span>&nbsp;<span class="num" id="3807443">1</span>&nbsp;<span class="op" id="3807445">+</span>&nbsp;<span class="num" id="3807447">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807450">b</span>&nbsp;<span class="op" id="3807452">:=</span>&nbsp;<span class="ident" id="3807455">ratGobVersion</span>&nbsp;<span class="op" id="3807469">&lt;&lt;</span>&nbsp;<span class="num" id="3807472">1</span>&nbsp;<span class="comment" id="3807474">//&nbsp;make&nbsp;space&nbsp;for&nbsp;sign&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807502">if</span>&nbsp;<span class="ident" id="3807505">x</span><span class="op" id="3807506">.</span><span class="ident" id="3807507">a</span><span class="op" id="3807508">.</span><span class="ident" id="3807509">neg</span>&nbsp;<span class="op" id="3807513">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807517">b</span>&nbsp;<span class="op" id="3807519">|=</span>&nbsp;<span class="num" id="3807522">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807528">buf</span><span class="op" id="3807531">[</span><span class="ident" id="3807532">j</span><span class="op" id="3807533">]</span>&nbsp;<span class="op" id="3807535">=</span>&nbsp;<span class="ident" id="3807537">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807540">return</span>&nbsp;<span class="ident" id="3807547">buf</span><span class="op" id="3807550">[</span><span class="ident" id="3807551">j</span><span class="op" id="3807552">:</span><span class="op" id="3807553">]</span><span class="op" id="3807554">,</span>&nbsp;<span class="ident" id="3807556">nil</span><br>
<span class="lineno"></span><span class="op" id="3807560">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="3807563">//&nbsp;GobDecode&nbsp;implements&nbsp;the&nbsp;gob.GobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3807617">func</span>&nbsp;<span class="op" id="3807622">(</span><span class="ident" id="3807623">z</span>&nbsp;<span class="op" id="3807625">*</span><span class="ident" id="3807626">Rat</span><span class="op" id="3807629">)</span>&nbsp;<span class="ident" id="3807631">GobDecode</span><span class="op" id="3807640">(</span><span class="ident" id="3807641">buf</span>&nbsp;<span class="op" id="3807645">[</span><span class="op" id="3807646">]</span><span class="builtintype" id="3807647">byte</span><span class="op" id="3807651">)</span>&nbsp;<span class="builtintype" id="3807653">error</span>&nbsp;<span class="op" id="3807659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807662">if</span>&nbsp;<span class="builtinfunc" id="3807665">len</span><span class="op" id="3807668">(</span><span class="ident" id="3807669">buf</span><span class="op" id="3807672">)</span>&nbsp;<span class="op" id="3807674">==</span>&nbsp;<span class="num" id="3807677">0</span>&nbsp;<span class="op" id="3807679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3807683">//&nbsp;Other&nbsp;side&nbsp;sent&nbsp;a&nbsp;nil&nbsp;or&nbsp;default&nbsp;value.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807728">*</span><span class="ident" id="3807729">z</span>&nbsp;<span class="op" id="3807731">=</span>&nbsp;<span class="ident" id="3807733">Rat</span><span class="op" id="3807736">{</span><span class="op" id="3807737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807741">return</span>&nbsp;<span class="ident" id="3807748">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807756">b</span>&nbsp;<span class="op" id="3807758">:=</span>&nbsp;<span class="ident" id="3807761">buf</span><span class="op" id="3807764">[</span><span class="num" id="3807765">0</span><span class="op" id="3807766">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807769">if</span>&nbsp;<span class="ident" id="3807772">b</span><span class="op" id="3807773">&gt;&gt;</span><span class="num" id="3807775">1</span>&nbsp;<span class="op" id="3807777">!=</span>&nbsp;<span class="ident" id="3807780">ratGobVersion</span>&nbsp;<span class="op" id="3807794">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807798">return</span>&nbsp;<span class="ident" id="3807805">errors</span><span class="op" id="3807811">.</span><span class="ident" id="3807812">New</span><span class="op" id="3807815">(</span><span class="ident" id="3807816">fmt</span><span class="op" id="3807819">.</span><span class="ident" id="3807820">Sprintf</span><span class="op" id="3807827">(</span><span class="string" id="3807828">&#34;Rat.GobDecode:&nbsp;encoding&nbsp;version&nbsp;%d&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3807878">,</span>&nbsp;<span class="ident" id="3807880">b</span><span class="op" id="3807881">&gt;&gt;</span><span class="num" id="3807883">1</span><span class="op" id="3807884">)</span><span class="op" id="3807885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3807888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3807891">const</span>&nbsp;<span class="ident" id="3807897">j</span>&nbsp;<span class="op" id="3807899">=</span>&nbsp;<span class="num" id="3807901">1</span>&nbsp;<span class="op" id="3807903">+</span>&nbsp;<span class="num" id="3807905">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807908">i</span>&nbsp;<span class="op" id="3807910">:=</span>&nbsp;<span class="ident" id="3807913">j</span>&nbsp;<span class="op" id="3807915">+</span>&nbsp;<span class="ident" id="3807917">binary</span><span class="op" id="3807923">.</span><span class="ident" id="3807924">BigEndian</span><span class="op" id="3807933">.</span><span class="ident" id="3807934">Uint32</span><span class="op" id="3807940">(</span><span class="ident" id="3807941">buf</span><span class="op" id="3807944">[</span><span class="ident" id="3807945">j</span><span class="op" id="3807946">-</span><span class="num" id="3807947">4</span><span class="op" id="3807948">:</span><span class="ident" id="3807949">j</span><span class="op" id="3807950">]</span><span class="op" id="3807951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807954">z</span><span class="op" id="3807955">.</span><span class="ident" id="3807956">a</span><span class="op" id="3807957">.</span><span class="ident" id="3807958">neg</span>&nbsp;<span class="op" id="3807962">=</span>&nbsp;<span class="ident" id="3807964">b</span><span class="op" id="3807965">&amp;</span><span class="num" id="3807966">1</span>&nbsp;<span class="op" id="3807968">!=</span>&nbsp;<span class="num" id="3807971">0</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3807974">z</span><span class="op" id="3807975">.</span><span class="ident" id="3807976">a</span><span class="op" id="3807977">.</span><span class="ident" id="3807978">abs</span>&nbsp;<span class="op" id="3807982">=</span>&nbsp;<span class="ident" id="3807984">z</span><span class="op" id="3807985">.</span><span class="ident" id="3807986">a</span><span class="op" id="3807987">.</span><span class="ident" id="3807988">abs</span><span class="op" id="3807991">.</span><span class="ident" id="3807992">setBytes</span><span class="op" id="3808000">(</span><span class="ident" id="3808001">buf</span><span class="op" id="3808004">[</span><span class="ident" id="3808005">j</span><span class="op" id="3808006">:</span><span class="ident" id="3808007">i</span><span class="op" id="3808008">]</span><span class="op" id="3808009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3808012">z</span><span class="op" id="3808013">.</span><span class="ident" id="3808014">b</span><span class="op" id="3808015">.</span><span class="ident" id="3808016">abs</span>&nbsp;<span class="op" id="3808020">=</span>&nbsp;<span class="ident" id="3808022">z</span><span class="op" id="3808023">.</span><span class="ident" id="3808024">b</span><span class="op" id="3808025">.</span><span class="ident" id="3808026">abs</span><span class="op" id="3808029">.</span><span class="ident" id="3808030">setBytes</span><span class="op" id="3808038">(</span><span class="ident" id="3808039">buf</span><span class="op" id="3808042">[</span><span class="ident" id="3808043">i</span><span class="op" id="3808044">:</span><span class="op" id="3808045">]</span><span class="op" id="3808046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808049">return</span>&nbsp;<span class="ident" id="3808056">nil</span><br>
<span class="lineno"></span><span class="op" id="3808060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="3808063">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3808127">func</span>&nbsp;<span class="op" id="3808132">(</span><span class="ident" id="3808133">r</span>&nbsp;<span class="op" id="3808135">*</span><span class="ident" id="3808136">Rat</span><span class="op" id="3808139">)</span>&nbsp;<span class="ident" id="3808141">MarshalText</span><span class="op" id="3808152">(</span><span class="op" id="3808153">)</span>&nbsp;<span class="op" id="3808155">(</span><span class="ident" id="3808156">text</span>&nbsp;<span class="op" id="3808161">[</span><span class="op" id="3808162">]</span><span class="builtintype" id="3808163">byte</span><span class="op" id="3808167">,</span>&nbsp;<span class="ident" id="3808169">err</span>&nbsp;<span class="builtintype" id="3808173">error</span><span class="op" id="3808178">)</span>&nbsp;<span class="op" id="3808180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808183">return</span>&nbsp;<span class="op" id="3808190">[</span><span class="op" id="3808191">]</span><span class="builtintype" id="3808192">byte</span><span class="op" id="3808196">(</span><span class="ident" id="3808197">r</span><span class="op" id="3808198">.</span><span class="ident" id="3808199">RatString</span><span class="op" id="3808208">(</span><span class="op" id="3808209">)</span><span class="op" id="3808210">)</span><span class="op" id="3808211">,</span>&nbsp;<span class="ident" id="3808213">nil</span><br>
<span class="lineno"></span><span class="op" id="3808217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span><span class="comment" id="3808220">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3808288">func</span>&nbsp;<span class="op" id="3808293">(</span><span class="ident" id="3808294">r</span>&nbsp;<span class="op" id="3808296">*</span><span class="ident" id="3808297">Rat</span><span class="op" id="3808300">)</span>&nbsp;<span class="ident" id="3808302">UnmarshalText</span><span class="op" id="3808315">(</span><span class="ident" id="3808316">text</span>&nbsp;<span class="op" id="3808321">[</span><span class="op" id="3808322">]</span><span class="builtintype" id="3808323">byte</span><span class="op" id="3808327">)</span>&nbsp;<span class="builtintype" id="3808329">error</span>&nbsp;<span class="op" id="3808335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808338">if</span>&nbsp;<span class="ident" id="3808341">_</span><span class="op" id="3808342">,</span>&nbsp;<span class="ident" id="3808344">ok</span>&nbsp;<span class="op" id="3808347">:=</span>&nbsp;<span class="ident" id="3808350">r</span><span class="op" id="3808351">.</span><span class="ident" id="3808352">SetString</span><span class="op" id="3808361">(</span><span class="builtintype" id="3808362">string</span><span class="op" id="3808368">(</span><span class="ident" id="3808369">text</span><span class="op" id="3808373">)</span><span class="op" id="3808374">)</span><span class="op" id="3808375">;</span>&nbsp;<span class="op" id="3808377">!</span><span class="ident" id="3808378">ok</span>&nbsp;<span class="op" id="3808381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808385">return</span>&nbsp;<span class="ident" id="3808392">fmt</span><span class="op" id="3808395">.</span><span class="ident" id="3808396">Errorf</span><span class="op" id="3808402">(</span><span class="string" id="3808403">&#34;math/big:&nbsp;cannot&nbsp;unmarshal&nbsp;%q&nbsp;into&nbsp;a&nbsp;*big.Rat&#34;</span><span class="op" id="3808450">,</span>&nbsp;<span class="ident" id="3808452">text</span><span class="op" id="3808456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3808459">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3808462">return</span>&nbsp;<span class="ident" id="3808469">nil</span><br>
<span class="lineno"></span><span class="op" id="3808473">}</span>
</div>
</body>
</html>
