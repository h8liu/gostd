<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html" class="current">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7759345">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7759401">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7759455">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7759506">package</span>&nbsp;<span class="ident" id="7759514">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7759523">import</span>&nbsp;<span class="op" id="7759530">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7759533">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7759542">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7759559">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7759569">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7759576">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7759582">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7759595">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7759602">&#34;net/rpc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7759613">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7759624">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7759634">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7759637">type</span>&nbsp;<span class="ident" id="7759642">Args</span>&nbsp;<span class="keyword" id="7759647">struct</span>&nbsp;<span class="op" id="7759654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7759657">A</span><span class="op" id="7759658">,</span>&nbsp;<span class="ident" id="7759660">B</span>&nbsp;<span class="builtintype" id="7759662">int</span><br>
<span class="lineno"></span><span class="op" id="7759666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7759669">type</span>&nbsp;<span class="ident" id="7759674">Reply</span>&nbsp;<span class="keyword" id="7759680">struct</span>&nbsp;<span class="op" id="7759687">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7759690">C</span>&nbsp;<span class="builtintype" id="7759692">int</span><br>
<span class="lineno"></span><span class="op" id="7759696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7759699">type</span>&nbsp;<span class="ident" id="7759704">Arith</span>&nbsp;<span class="builtintype" id="7759710">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7759715">type</span>&nbsp;<span class="ident" id="7759720">ArithAddResp</span>&nbsp;<span class="keyword" id="7759733">struct</span>&nbsp;<span class="op" id="7759740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7759743">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7759750">interface</span><span class="op" id="7759759">{</span><span class="op" id="7759760">}</span>&nbsp;<span class="string" id="7759762">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7759775">Result</span>&nbsp;<span class="ident" id="7759782">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7759794">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7759811">Error</span>&nbsp;&nbsp;<span class="keyword" id="7759818">interface</span><span class="op" id="7759827">{</span><span class="op" id="7759828">}</span>&nbsp;<span class="string" id="7759830">`json:&#34;error&#34;`</span><br>
<span class="lineno"></span><span class="op" id="7759845">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="7759848">func</span>&nbsp;<span class="op" id="7759853">(</span><span class="ident" id="7759854">t</span>&nbsp;<span class="op" id="7759856">*</span><span class="ident" id="7759857">Arith</span><span class="op" id="7759862">)</span>&nbsp;<span class="ident" id="7759864">Add</span><span class="op" id="7759867">(</span><span class="ident" id="7759868">args</span>&nbsp;<span class="op" id="7759873">*</span><span class="ident" id="7759874">Args</span><span class="op" id="7759878">,</span>&nbsp;<span class="ident" id="7759880">reply</span>&nbsp;<span class="op" id="7759886">*</span><span class="ident" id="7759887">Reply</span><span class="op" id="7759892">)</span>&nbsp;<span class="builtintype" id="7759894">error</span>&nbsp;<span class="op" id="7759900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7759903">reply</span><span class="op" id="7759908">.</span><span class="ident" id="7759909">C</span>&nbsp;<span class="op" id="7759911">=</span>&nbsp;<span class="ident" id="7759913">args</span><span class="op" id="7759917">.</span><span class="ident" id="7759918">A</span>&nbsp;<span class="op" id="7759920">+</span>&nbsp;<span class="ident" id="7759922">args</span><span class="op" id="7759926">.</span><span class="ident" id="7759927">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7759930">return</span>&nbsp;<span class="builtintype" id="7759937">nil</span><br>
<span class="lineno"></span><span class="op" id="7759941">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7759944">func</span>&nbsp;<span class="op" id="7759949">(</span><span class="ident" id="7759950">t</span>&nbsp;<span class="op" id="7759952">*</span><span class="ident" id="7759953">Arith</span><span class="op" id="7759958">)</span>&nbsp;<span class="ident" id="7759960">Mul</span><span class="op" id="7759963">(</span><span class="ident" id="7759964">args</span>&nbsp;<span class="op" id="7759969">*</span><span class="ident" id="7759970">Args</span><span class="op" id="7759974">,</span>&nbsp;<span class="ident" id="7759976">reply</span>&nbsp;<span class="op" id="7759982">*</span><span class="ident" id="7759983">Reply</span><span class="op" id="7759988">)</span>&nbsp;<span class="builtintype" id="7759990">error</span>&nbsp;<span class="op" id="7759996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7759999">reply</span><span class="op" id="7760004">.</span><span class="ident" id="7760005">C</span>&nbsp;<span class="op" id="7760007">=</span>&nbsp;<span class="ident" id="7760009">args</span><span class="op" id="7760013">.</span><span class="ident" id="7760014">A</span>&nbsp;<span class="op" id="7760016">*</span>&nbsp;<span class="ident" id="7760018">args</span><span class="op" id="7760022">.</span><span class="ident" id="7760023">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760026">return</span>&nbsp;<span class="builtintype" id="7760033">nil</span><br>
<span class="lineno"></span><span class="op" id="7760037">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7760040">func</span>&nbsp;<span class="op" id="7760045">(</span><span class="ident" id="7760046">t</span>&nbsp;<span class="op" id="7760048">*</span><span class="ident" id="7760049">Arith</span><span class="op" id="7760054">)</span>&nbsp;<span class="ident" id="7760056">Div</span><span class="op" id="7760059">(</span><span class="ident" id="7760060">args</span>&nbsp;<span class="op" id="7760065">*</span><span class="ident" id="7760066">Args</span><span class="op" id="7760070">,</span>&nbsp;<span class="ident" id="7760072">reply</span>&nbsp;<span class="op" id="7760078">*</span><span class="ident" id="7760079">Reply</span><span class="op" id="7760084">)</span>&nbsp;<span class="builtintype" id="7760086">error</span>&nbsp;<span class="op" id="7760092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760095">if</span>&nbsp;<span class="ident" id="7760098">args</span><span class="op" id="7760102">.</span><span class="ident" id="7760103">B</span>&nbsp;<span class="op" id="7760105">==</span>&nbsp;<span class="num" id="7760108">0</span>&nbsp;<span class="op" id="7760110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760114">return</span>&nbsp;<span class="ident" id="7760121">errors</span><span class="op" id="7760127">.</span><span class="ident" id="7760128">New</span><span class="op" id="7760131">(</span><span class="string" id="7760132">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="7760148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7760151">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7760154">reply</span><span class="op" id="7760159">.</span><span class="ident" id="7760160">C</span>&nbsp;<span class="op" id="7760162">=</span>&nbsp;<span class="ident" id="7760164">args</span><span class="op" id="7760168">.</span><span class="ident" id="7760169">A</span>&nbsp;<span class="op" id="7760171">/</span>&nbsp;<span class="ident" id="7760173">args</span><span class="op" id="7760177">.</span><span class="ident" id="7760178">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760181">return</span>&nbsp;<span class="builtintype" id="7760188">nil</span><br>
<span class="lineno"></span><span class="op" id="7760192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7760195">func</span>&nbsp;<span class="op" id="7760200">(</span><span class="ident" id="7760201">t</span>&nbsp;<span class="op" id="7760203">*</span><span class="ident" id="7760204">Arith</span><span class="op" id="7760209">)</span>&nbsp;<span class="ident" id="7760211">Error</span><span class="op" id="7760216">(</span><span class="ident" id="7760217">args</span>&nbsp;<span class="op" id="7760222">*</span><span class="ident" id="7760223">Args</span><span class="op" id="7760227">,</span>&nbsp;<span class="ident" id="7760229">reply</span>&nbsp;<span class="op" id="7760235">*</span><span class="ident" id="7760236">Reply</span><span class="op" id="7760241">)</span>&nbsp;<span class="builtintype" id="7760243">error</span>&nbsp;<span class="op" id="7760249">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7760252">panic</span><span class="op" id="7760257">(</span><span class="string" id="7760258">&#34;ERROR&#34;</span><span class="op" id="7760265">)</span><br>
<span class="lineno"></span><span class="op" id="7760267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7760270">func</span>&nbsp;<span class="ident" id="7760275">init</span><span class="op" id="7760279">(</span><span class="op" id="7760280">)</span>&nbsp;<span class="op" id="7760282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7760285">rpc</span><span class="op" id="7760288">.</span><span class="ident" id="7760289">Register</span><span class="op" id="7760297">(</span><span class="builtinfunc" id="7760298">new</span><span class="op" id="7760301">(</span><span class="ident" id="7760302">Arith</span><span class="op" id="7760307">)</span><span class="op" id="7760308">)</span><br>
<span class="lineno">60</span><span class="op" id="7760310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7760313">func</span>&nbsp;<span class="ident" id="7760318">TestServerNoParams</span><span class="op" id="7760336">(</span><span class="ident" id="7760337">t</span>&nbsp;<span class="op" id="7760339">*</span><span class="ident" id="7760340">testing</span><span class="op" id="7760347">.</span><span class="ident" id="7760348">T</span><span class="op" id="7760349">)</span>&nbsp;<span class="op" id="7760351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7760354">cli</span><span class="op" id="7760357">,</span>&nbsp;<span class="ident" id="7760359">srv</span>&nbsp;<span class="op" id="7760363">:=</span>&nbsp;<span class="ident" id="7760366">net</span><span class="op" id="7760369">.</span><span class="ident" id="7760370">Pipe</span><span class="op" id="7760374">(</span><span class="op" id="7760375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760378">defer</span>&nbsp;<span class="ident" id="7760384">cli</span><span class="op" id="7760387">.</span><span class="ident" id="7760388">Close</span><span class="op" id="7760393">(</span><span class="op" id="7760394">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760397">go</span>&nbsp;<span class="ident" id="7760400">ServeConn</span><span class="op" id="7760409">(</span><span class="ident" id="7760410">srv</span><span class="op" id="7760413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7760416">dec</span>&nbsp;<span class="op" id="7760420">:=</span>&nbsp;<span class="ident" id="7760423">json</span><span class="op" id="7760427">.</span><span class="ident" id="7760428">NewDecoder</span><span class="op" id="7760438">(</span><span class="ident" id="7760439">cli</span><span class="op" id="7760442">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7760446">fmt</span><span class="op" id="7760449">.</span><span class="ident" id="7760450">Fprintf</span><span class="op" id="7760457">(</span><span class="ident" id="7760458">cli</span><span class="op" id="7760461">,</span>&nbsp;<span class="string" id="7760463">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;}`</span><span class="op" id="7760501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760504">var</span>&nbsp;<span class="ident" id="7760508">resp</span>&nbsp;<span class="ident" id="7760513">ArithAddResp</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760527">if</span>&nbsp;<span class="ident" id="7760530">err</span>&nbsp;<span class="op" id="7760534">:=</span>&nbsp;<span class="ident" id="7760537">dec</span><span class="op" id="7760540">.</span><span class="ident" id="7760541">Decode</span><span class="op" id="7760547">(</span><span class="op" id="7760548">&amp;</span><span class="ident" id="7760549">resp</span><span class="op" id="7760553">)</span><span class="op" id="7760554">;</span>&nbsp;<span class="ident" id="7760556">err</span>&nbsp;<span class="op" id="7760560">!=</span>&nbsp;<span class="builtintype" id="7760563">nil</span>&nbsp;<span class="op" id="7760567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7760571">t</span><span class="op" id="7760572">.</span><span class="ident" id="7760573">Fatalf</span><span class="op" id="7760579">(</span><span class="string" id="7760580">&#34;Decode&nbsp;after&nbsp;no&nbsp;params:&nbsp;%s&#34;</span><span class="op" id="7760608">,</span>&nbsp;<span class="ident" id="7760610">err</span><span class="op" id="7760613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7760616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760619">if</span>&nbsp;<span class="ident" id="7760622">resp</span><span class="op" id="7760626">.</span><span class="ident" id="7760627">Error</span>&nbsp;<span class="op" id="7760633">==</span>&nbsp;<span class="builtintype" id="7760636">nil</span>&nbsp;<span class="op" id="7760640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7760644">t</span><span class="op" id="7760645">.</span><span class="ident" id="7760646">Fatalf</span><span class="op" id="7760652">(</span><span class="string" id="7760653">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="7760678">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7760681">}</span><br>
<span class="lineno"></span><span class="op" id="7760683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7760686">func</span>&nbsp;<span class="ident" id="7760691">TestServerEmptyMessage</span><span class="op" id="7760713">(</span><span class="ident" id="7760714">t</span>&nbsp;<span class="op" id="7760716">*</span><span class="ident" id="7760717">testing</span><span class="op" id="7760724">.</span><span class="ident" id="7760725">T</span><span class="op" id="7760726">)</span>&nbsp;<span class="op" id="7760728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7760731">cli</span><span class="op" id="7760734">,</span>&nbsp;<span class="ident" id="7760736">srv</span>&nbsp;<span class="op" id="7760740">:=</span>&nbsp;<span class="ident" id="7760743">net</span><span class="op" id="7760746">.</span><span class="ident" id="7760747">Pipe</span><span class="op" id="7760751">(</span><span class="op" id="7760752">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760755">defer</span>&nbsp;<span class="ident" id="7760761">cli</span><span class="op" id="7760764">.</span><span class="ident" id="7760765">Close</span><span class="op" id="7760770">(</span><span class="op" id="7760771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760774">go</span>&nbsp;<span class="ident" id="7760777">ServeConn</span><span class="op" id="7760786">(</span><span class="ident" id="7760787">srv</span><span class="op" id="7760790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7760793">dec</span>&nbsp;<span class="op" id="7760797">:=</span>&nbsp;<span class="ident" id="7760800">json</span><span class="op" id="7760804">.</span><span class="ident" id="7760805">NewDecoder</span><span class="op" id="7760815">(</span><span class="ident" id="7760816">cli</span><span class="op" id="7760819">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7760823">fmt</span><span class="op" id="7760826">.</span><span class="ident" id="7760827">Fprintf</span><span class="op" id="7760834">(</span><span class="ident" id="7760835">cli</span><span class="op" id="7760838">,</span>&nbsp;<span class="string" id="7760840">&#34;{}&#34;</span><span class="op" id="7760844">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760847">var</span>&nbsp;<span class="ident" id="7760851">resp</span>&nbsp;<span class="ident" id="7760856">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760870">if</span>&nbsp;<span class="ident" id="7760873">err</span>&nbsp;<span class="op" id="7760877">:=</span>&nbsp;<span class="ident" id="7760880">dec</span><span class="op" id="7760883">.</span><span class="ident" id="7760884">Decode</span><span class="op" id="7760890">(</span><span class="op" id="7760891">&amp;</span><span class="ident" id="7760892">resp</span><span class="op" id="7760896">)</span><span class="op" id="7760897">;</span>&nbsp;<span class="ident" id="7760899">err</span>&nbsp;<span class="op" id="7760903">!=</span>&nbsp;<span class="builtintype" id="7760906">nil</span>&nbsp;<span class="op" id="7760910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7760914">t</span><span class="op" id="7760915">.</span><span class="ident" id="7760916">Fatalf</span><span class="op" id="7760922">(</span><span class="string" id="7760923">&#34;Decode&nbsp;after&nbsp;empty:&nbsp;%s&#34;</span><span class="op" id="7760947">,</span>&nbsp;<span class="ident" id="7760949">err</span><span class="op" id="7760952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7760955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7760958">if</span>&nbsp;<span class="ident" id="7760961">resp</span><span class="op" id="7760965">.</span><span class="ident" id="7760966">Error</span>&nbsp;<span class="op" id="7760972">==</span>&nbsp;<span class="builtintype" id="7760975">nil</span>&nbsp;<span class="op" id="7760979">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7760983">t</span><span class="op" id="7760984">.</span><span class="ident" id="7760985">Fatalf</span><span class="op" id="7760991">(</span><span class="string" id="7760992">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="7761017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7761020">}</span><br>
<span class="lineno"></span><span class="op" id="7761022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7761025">func</span>&nbsp;<span class="ident" id="7761030">TestServer</span><span class="op" id="7761040">(</span><span class="ident" id="7761041">t</span>&nbsp;<span class="op" id="7761043">*</span><span class="ident" id="7761044">testing</span><span class="op" id="7761051">.</span><span class="ident" id="7761052">T</span><span class="op" id="7761053">)</span>&nbsp;<span class="op" id="7761055">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7761058">cli</span><span class="op" id="7761061">,</span>&nbsp;<span class="ident" id="7761063">srv</span>&nbsp;<span class="op" id="7761067">:=</span>&nbsp;<span class="ident" id="7761070">net</span><span class="op" id="7761073">.</span><span class="ident" id="7761074">Pipe</span><span class="op" id="7761078">(</span><span class="op" id="7761079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7761082">defer</span>&nbsp;<span class="ident" id="7761088">cli</span><span class="op" id="7761091">.</span><span class="ident" id="7761092">Close</span><span class="op" id="7761097">(</span><span class="op" id="7761098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7761101">go</span>&nbsp;<span class="ident" id="7761104">ServeConn</span><span class="op" id="7761113">(</span><span class="ident" id="7761114">srv</span><span class="op" id="7761117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7761120">dec</span>&nbsp;<span class="op" id="7761124">:=</span>&nbsp;<span class="ident" id="7761127">json</span><span class="op" id="7761131">.</span><span class="ident" id="7761132">NewDecoder</span><span class="op" id="7761142">(</span><span class="ident" id="7761143">cli</span><span class="op" id="7761146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7761150">//&nbsp;Send&nbsp;hand-coded&nbsp;requests&nbsp;to&nbsp;server,&nbsp;parse&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7761207">for</span>&nbsp;<span class="ident" id="7761211">i</span>&nbsp;<span class="op" id="7761213">:=</span>&nbsp;<span class="num" id="7761216">0</span><span class="op" id="7761217">;</span>&nbsp;<span class="ident" id="7761219">i</span>&nbsp;<span class="op" id="7761221">&lt;</span>&nbsp;<span class="num" id="7761223">10</span><span class="op" id="7761225">;</span>&nbsp;<span class="ident" id="7761227">i</span><span class="op" id="7761228">++</span>&nbsp;<span class="op" id="7761231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7761235">fmt</span><span class="op" id="7761238">.</span><span class="ident" id="7761239">Fprintf</span><span class="op" id="7761246">(</span><span class="ident" id="7761247">cli</span><span class="op" id="7761250">,</span>&nbsp;<span class="string" id="7761252">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;\u%04d&#34;,&nbsp;&#34;params&#34;:&nbsp;[{&#34;A&#34;:&nbsp;%d,&nbsp;&#34;B&#34;:&nbsp;%d}]}`</span><span class="op" id="7761325">,</span>&nbsp;<span class="ident" id="7761327">i</span><span class="op" id="7761328">,</span>&nbsp;<span class="ident" id="7761330">i</span><span class="op" id="7761331">,</span>&nbsp;<span class="ident" id="7761333">i</span><span class="op" id="7761334">+</span><span class="num" id="7761335">1</span><span class="op" id="7761336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7761340">var</span>&nbsp;<span class="ident" id="7761344">resp</span>&nbsp;<span class="ident" id="7761349">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7761364">err</span>&nbsp;<span class="op" id="7761368">:=</span>&nbsp;<span class="ident" id="7761371">dec</span><span class="op" id="7761374">.</span><span class="ident" id="7761375">Decode</span><span class="op" id="7761381">(</span><span class="op" id="7761382">&amp;</span><span class="ident" id="7761383">resp</span><span class="op" id="7761387">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7761391">if</span>&nbsp;<span class="ident" id="7761394">err</span>&nbsp;<span class="op" id="7761398">!=</span>&nbsp;<span class="builtintype" id="7761401">nil</span>&nbsp;<span class="op" id="7761405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7761410">t</span><span class="op" id="7761411">.</span><span class="ident" id="7761412">Fatalf</span><span class="op" id="7761418">(</span><span class="string" id="7761419">&#34;Decode:&nbsp;%s&#34;</span><span class="op" id="7761431">,</span>&nbsp;<span class="ident" id="7761433">err</span><span class="op" id="7761436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7761440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7761444">if</span>&nbsp;<span class="ident" id="7761447">resp</span><span class="op" id="7761451">.</span><span class="ident" id="7761452">Error</span>&nbsp;<span class="op" id="7761458">!=</span>&nbsp;<span class="builtintype" id="7761461">nil</span>&nbsp;<span class="op" id="7761465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7761470">t</span><span class="op" id="7761471">.</span><span class="ident" id="7761472">Fatalf</span><span class="op" id="7761478">(</span><span class="string" id="7761479">&#34;resp.Error:&nbsp;%s&#34;</span><span class="op" id="7761495">,</span>&nbsp;<span class="ident" id="7761497">resp</span><span class="op" id="7761501">.</span><span class="ident" id="7761502">Error</span><span class="op" id="7761507">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7761511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7761515">if</span>&nbsp;<span class="ident" id="7761518">resp</span><span class="op" id="7761522">.</span><span class="ident" id="7761523">Id</span><span class="op" id="7761525">.</span><span class="op" id="7761526">(</span><span class="builtintype" id="7761527">string</span><span class="op" id="7761533">)</span>&nbsp;<span class="op" id="7761535">!=</span>&nbsp;<span class="builtintype" id="7761538">string</span><span class="op" id="7761544">(</span><span class="ident" id="7761545">i</span><span class="op" id="7761546">)</span>&nbsp;<span class="op" id="7761548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7761553">t</span><span class="op" id="7761554">.</span><span class="ident" id="7761555">Fatalf</span><span class="op" id="7761561">(</span><span class="string" id="7761562">&#34;resp:&nbsp;bad&nbsp;id&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7761587">,</span>&nbsp;<span class="ident" id="7761589">resp</span><span class="op" id="7761593">.</span><span class="ident" id="7761594">Id</span><span class="op" id="7761596">.</span><span class="op" id="7761597">(</span><span class="builtintype" id="7761598">string</span><span class="op" id="7761604">)</span><span class="op" id="7761605">,</span>&nbsp;<span class="builtintype" id="7761607">string</span><span class="op" id="7761613">(</span><span class="ident" id="7761614">i</span><span class="op" id="7761615">)</span><span class="op" id="7761616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7761620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7761624">if</span>&nbsp;<span class="ident" id="7761627">resp</span><span class="op" id="7761631">.</span><span class="ident" id="7761632">Result</span><span class="op" id="7761638">.</span><span class="ident" id="7761639">C</span>&nbsp;<span class="op" id="7761641">!=</span>&nbsp;<span class="num" id="7761644">2</span><span class="op" id="7761645">*</span><span class="ident" id="7761646">i</span><span class="op" id="7761647">+</span><span class="num" id="7761648">1</span>&nbsp;<span class="op" id="7761650">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7761655">t</span><span class="op" id="7761656">.</span><span class="ident" id="7761657">Fatalf</span><span class="op" id="7761663">(</span><span class="string" id="7761664">&#34;resp:&nbsp;bad&nbsp;result:&nbsp;%d+%d=%d&#34;</span><span class="op" id="7761692">,</span>&nbsp;<span class="ident" id="7761694">i</span><span class="op" id="7761695">,</span>&nbsp;<span class="ident" id="7761697">i</span><span class="op" id="7761698">+</span><span class="num" id="7761699">1</span><span class="op" id="7761700">,</span>&nbsp;<span class="ident" id="7761702">resp</span><span class="op" id="7761706">.</span><span class="ident" id="7761707">Result</span><span class="op" id="7761713">.</span><span class="ident" id="7761714">C</span><span class="op" id="7761715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7761719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7761722">}</span><br>
<span class="lineno"></span><span class="op" id="7761724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7761727">func</span>&nbsp;<span class="ident" id="7761732">TestClient</span><span class="op" id="7761742">(</span><span class="ident" id="7761743">t</span>&nbsp;<span class="op" id="7761745">*</span><span class="ident" id="7761746">testing</span><span class="op" id="7761753">.</span><span class="ident" id="7761754">T</span><span class="op" id="7761755">)</span>&nbsp;<span class="op" id="7761757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7761760">//&nbsp;Assume&nbsp;server&nbsp;is&nbsp;okay&nbsp;(TestServer&nbsp;is&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7761809">//&nbsp;Test&nbsp;client&nbsp;against&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7761841">cli</span><span class="op" id="7761844">,</span>&nbsp;<span class="ident" id="7761846">srv</span>&nbsp;<span class="op" id="7761850">:=</span>&nbsp;<span class="ident" id="7761853">net</span><span class="op" id="7761856">.</span><span class="ident" id="7761857">Pipe</span><span class="op" id="7761861">(</span><span class="op" id="7761862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7761865">go</span>&nbsp;<span class="ident" id="7761868">ServeConn</span><span class="op" id="7761877">(</span><span class="ident" id="7761878">srv</span><span class="op" id="7761881">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7761885">client</span>&nbsp;<span class="op" id="7761892">:=</span>&nbsp;<span class="ident" id="7761895">NewClient</span><span class="op" id="7761904">(</span><span class="ident" id="7761905">cli</span><span class="op" id="7761908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7761911">defer</span>&nbsp;<span class="ident" id="7761917">client</span><span class="op" id="7761923">.</span><span class="ident" id="7761924">Close</span><span class="op" id="7761929">(</span><span class="op" id="7761930">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7761934">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7761956">args</span>&nbsp;<span class="op" id="7761961">:=</span>&nbsp;<span class="op" id="7761964">&amp;</span><span class="ident" id="7761965">Args</span><span class="op" id="7761969">{</span><span class="num" id="7761970">7</span><span class="op" id="7761971">,</span>&nbsp;<span class="num" id="7761973">8</span><span class="op" id="7761974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7761977">reply</span>&nbsp;<span class="op" id="7761983">:=</span>&nbsp;<span class="builtinfunc" id="7761986">new</span><span class="op" id="7761989">(</span><span class="ident" id="7761990">Reply</span><span class="op" id="7761995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7761998">err</span>&nbsp;<span class="op" id="7762002">:=</span>&nbsp;<span class="ident" id="7762005">client</span><span class="op" id="7762011">.</span><span class="ident" id="7762012">Call</span><span class="op" id="7762016">(</span><span class="string" id="7762017">&#34;Arith.Add&#34;</span><span class="op" id="7762028">,</span>&nbsp;<span class="ident" id="7762030">args</span><span class="op" id="7762034">,</span>&nbsp;<span class="ident" id="7762036">reply</span><span class="op" id="7762041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7762044">if</span>&nbsp;<span class="ident" id="7762047">err</span>&nbsp;<span class="op" id="7762051">!=</span>&nbsp;<span class="builtintype" id="7762054">nil</span>&nbsp;<span class="op" id="7762058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762062">t</span><span class="op" id="7762063">.</span><span class="ident" id="7762064">Errorf</span><span class="op" id="7762070">(</span><span class="string" id="7762071">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7762113">,</span>&nbsp;<span class="ident" id="7762115">err</span><span class="op" id="7762118">.</span><span class="ident" id="7762119">Error</span><span class="op" id="7762124">(</span><span class="op" id="7762125">)</span><span class="op" id="7762126">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7762129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7762132">if</span>&nbsp;<span class="ident" id="7762135">reply</span><span class="op" id="7762140">.</span><span class="ident" id="7762141">C</span>&nbsp;<span class="op" id="7762143">!=</span>&nbsp;<span class="ident" id="7762146">args</span><span class="op" id="7762150">.</span><span class="ident" id="7762151">A</span><span class="op" id="7762152">+</span><span class="ident" id="7762153">args</span><span class="op" id="7762157">.</span><span class="ident" id="7762158">B</span>&nbsp;<span class="op" id="7762160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762164">t</span><span class="op" id="7762165">.</span><span class="ident" id="7762166">Errorf</span><span class="op" id="7762172">(</span><span class="string" id="7762173">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7762198">,</span>&nbsp;<span class="ident" id="7762200">reply</span><span class="op" id="7762205">.</span><span class="ident" id="7762206">C</span><span class="op" id="7762207">,</span>&nbsp;<span class="ident" id="7762209">args</span><span class="op" id="7762213">.</span><span class="ident" id="7762214">A</span><span class="op" id="7762215">+</span><span class="ident" id="7762216">args</span><span class="op" id="7762220">.</span><span class="ident" id="7762221">B</span><span class="op" id="7762222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7762225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762229">args</span>&nbsp;<span class="op" id="7762234">=</span>&nbsp;<span class="op" id="7762236">&amp;</span><span class="ident" id="7762237">Args</span><span class="op" id="7762241">{</span><span class="num" id="7762242">7</span><span class="op" id="7762243">,</span>&nbsp;<span class="num" id="7762245">8</span><span class="op" id="7762246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762249">reply</span>&nbsp;<span class="op" id="7762255">=</span>&nbsp;<span class="builtinfunc" id="7762257">new</span><span class="op" id="7762260">(</span><span class="ident" id="7762261">Reply</span><span class="op" id="7762266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762269">err</span>&nbsp;<span class="op" id="7762273">=</span>&nbsp;<span class="ident" id="7762275">client</span><span class="op" id="7762281">.</span><span class="ident" id="7762282">Call</span><span class="op" id="7762286">(</span><span class="string" id="7762287">&#34;Arith.Mul&#34;</span><span class="op" id="7762298">,</span>&nbsp;<span class="ident" id="7762300">args</span><span class="op" id="7762304">,</span>&nbsp;<span class="ident" id="7762306">reply</span><span class="op" id="7762311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7762314">if</span>&nbsp;<span class="ident" id="7762317">err</span>&nbsp;<span class="op" id="7762321">!=</span>&nbsp;<span class="builtintype" id="7762324">nil</span>&nbsp;<span class="op" id="7762328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762332">t</span><span class="op" id="7762333">.</span><span class="ident" id="7762334">Errorf</span><span class="op" id="7762340">(</span><span class="string" id="7762341">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7762383">,</span>&nbsp;<span class="ident" id="7762385">err</span><span class="op" id="7762388">.</span><span class="ident" id="7762389">Error</span><span class="op" id="7762394">(</span><span class="op" id="7762395">)</span><span class="op" id="7762396">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7762399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7762402">if</span>&nbsp;<span class="ident" id="7762405">reply</span><span class="op" id="7762410">.</span><span class="ident" id="7762411">C</span>&nbsp;<span class="op" id="7762413">!=</span>&nbsp;<span class="ident" id="7762416">args</span><span class="op" id="7762420">.</span><span class="ident" id="7762421">A</span><span class="op" id="7762422">*</span><span class="ident" id="7762423">args</span><span class="op" id="7762427">.</span><span class="ident" id="7762428">B</span>&nbsp;<span class="op" id="7762430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762434">t</span><span class="op" id="7762435">.</span><span class="ident" id="7762436">Errorf</span><span class="op" id="7762442">(</span><span class="string" id="7762443">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7762468">,</span>&nbsp;<span class="ident" id="7762470">reply</span><span class="op" id="7762475">.</span><span class="ident" id="7762476">C</span><span class="op" id="7762477">,</span>&nbsp;<span class="ident" id="7762479">args</span><span class="op" id="7762483">.</span><span class="ident" id="7762484">A</span><span class="op" id="7762485">*</span><span class="ident" id="7762486">args</span><span class="op" id="7762490">.</span><span class="ident" id="7762491">B</span><span class="op" id="7762492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7762495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7762499">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762517">args</span>&nbsp;<span class="op" id="7762522">=</span>&nbsp;<span class="op" id="7762524">&amp;</span><span class="ident" id="7762525">Args</span><span class="op" id="7762529">{</span><span class="num" id="7762530">7</span><span class="op" id="7762531">,</span>&nbsp;<span class="num" id="7762533">8</span><span class="op" id="7762534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762537">mulReply</span>&nbsp;<span class="op" id="7762546">:=</span>&nbsp;<span class="builtinfunc" id="7762549">new</span><span class="op" id="7762552">(</span><span class="ident" id="7762553">Reply</span><span class="op" id="7762558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762561">mulCall</span>&nbsp;<span class="op" id="7762569">:=</span>&nbsp;<span class="ident" id="7762572">client</span><span class="op" id="7762578">.</span><span class="ident" id="7762579">Go</span><span class="op" id="7762581">(</span><span class="string" id="7762582">&#34;Arith.Mul&#34;</span><span class="op" id="7762593">,</span>&nbsp;<span class="ident" id="7762595">args</span><span class="op" id="7762599">,</span>&nbsp;<span class="ident" id="7762601">mulReply</span><span class="op" id="7762609">,</span>&nbsp;<span class="builtintype" id="7762611">nil</span><span class="op" id="7762614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762617">addReply</span>&nbsp;<span class="op" id="7762626">:=</span>&nbsp;<span class="builtinfunc" id="7762629">new</span><span class="op" id="7762632">(</span><span class="ident" id="7762633">Reply</span><span class="op" id="7762638">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762641">addCall</span>&nbsp;<span class="op" id="7762649">:=</span>&nbsp;<span class="ident" id="7762652">client</span><span class="op" id="7762658">.</span><span class="ident" id="7762659">Go</span><span class="op" id="7762661">(</span><span class="string" id="7762662">&#34;Arith.Add&#34;</span><span class="op" id="7762673">,</span>&nbsp;<span class="ident" id="7762675">args</span><span class="op" id="7762679">,</span>&nbsp;<span class="ident" id="7762681">addReply</span><span class="op" id="7762689">,</span>&nbsp;<span class="builtintype" id="7762691">nil</span><span class="op" id="7762694">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762698">addCall</span>&nbsp;<span class="op" id="7762706">=</span>&nbsp;<span class="op" id="7762708">&lt;-</span><span class="ident" id="7762710">addCall</span><span class="op" id="7762717">.</span><span class="ident" id="7762718">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7762724">if</span>&nbsp;<span class="ident" id="7762727">addCall</span><span class="op" id="7762734">.</span><span class="ident" id="7762735">Error</span>&nbsp;<span class="op" id="7762741">!=</span>&nbsp;<span class="builtintype" id="7762744">nil</span>&nbsp;<span class="op" id="7762748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762752">t</span><span class="op" id="7762753">.</span><span class="ident" id="7762754">Errorf</span><span class="op" id="7762760">(</span><span class="string" id="7762761">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7762803">,</span>&nbsp;<span class="ident" id="7762805">addCall</span><span class="op" id="7762812">.</span><span class="ident" id="7762813">Error</span><span class="op" id="7762818">.</span><span class="ident" id="7762819">Error</span><span class="op" id="7762824">(</span><span class="op" id="7762825">)</span><span class="op" id="7762826">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7762829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7762832">if</span>&nbsp;<span class="ident" id="7762835">addReply</span><span class="op" id="7762843">.</span><span class="ident" id="7762844">C</span>&nbsp;<span class="op" id="7762846">!=</span>&nbsp;<span class="ident" id="7762849">args</span><span class="op" id="7762853">.</span><span class="ident" id="7762854">A</span><span class="op" id="7762855">+</span><span class="ident" id="7762856">args</span><span class="op" id="7762860">.</span><span class="ident" id="7762861">B</span>&nbsp;<span class="op" id="7762863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762867">t</span><span class="op" id="7762868">.</span><span class="ident" id="7762869">Errorf</span><span class="op" id="7762875">(</span><span class="string" id="7762876">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7762901">,</span>&nbsp;<span class="ident" id="7762903">addReply</span><span class="op" id="7762911">.</span><span class="ident" id="7762912">C</span><span class="op" id="7762913">,</span>&nbsp;<span class="ident" id="7762915">args</span><span class="op" id="7762919">.</span><span class="ident" id="7762920">A</span><span class="op" id="7762921">+</span><span class="ident" id="7762922">args</span><span class="op" id="7762926">.</span><span class="ident" id="7762927">B</span><span class="op" id="7762928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7762931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762935">mulCall</span>&nbsp;<span class="op" id="7762943">=</span>&nbsp;<span class="op" id="7762945">&lt;-</span><span class="ident" id="7762947">mulCall</span><span class="op" id="7762954">.</span><span class="ident" id="7762955">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7762961">if</span>&nbsp;<span class="ident" id="7762964">mulCall</span><span class="op" id="7762971">.</span><span class="ident" id="7762972">Error</span>&nbsp;<span class="op" id="7762978">!=</span>&nbsp;<span class="builtintype" id="7762981">nil</span>&nbsp;<span class="op" id="7762985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7762989">t</span><span class="op" id="7762990">.</span><span class="ident" id="7762991">Errorf</span><span class="op" id="7762997">(</span><span class="string" id="7762998">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7763040">,</span>&nbsp;<span class="ident" id="7763042">mulCall</span><span class="op" id="7763049">.</span><span class="ident" id="7763050">Error</span><span class="op" id="7763055">.</span><span class="ident" id="7763056">Error</span><span class="op" id="7763061">(</span><span class="op" id="7763062">)</span><span class="op" id="7763063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7763066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7763069">if</span>&nbsp;<span class="ident" id="7763072">mulReply</span><span class="op" id="7763080">.</span><span class="ident" id="7763081">C</span>&nbsp;<span class="op" id="7763083">!=</span>&nbsp;<span class="ident" id="7763086">args</span><span class="op" id="7763090">.</span><span class="ident" id="7763091">A</span><span class="op" id="7763092">*</span><span class="ident" id="7763093">args</span><span class="op" id="7763097">.</span><span class="ident" id="7763098">B</span>&nbsp;<span class="op" id="7763100">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763104">t</span><span class="op" id="7763105">.</span><span class="ident" id="7763106">Errorf</span><span class="op" id="7763112">(</span><span class="string" id="7763113">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7763138">,</span>&nbsp;<span class="ident" id="7763140">mulReply</span><span class="op" id="7763148">.</span><span class="ident" id="7763149">C</span><span class="op" id="7763150">,</span>&nbsp;<span class="ident" id="7763152">args</span><span class="op" id="7763156">.</span><span class="ident" id="7763157">A</span><span class="op" id="7763158">*</span><span class="ident" id="7763159">args</span><span class="op" id="7763163">.</span><span class="ident" id="7763164">B</span><span class="op" id="7763165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7763168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7763172">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763187">args</span>&nbsp;<span class="op" id="7763192">=</span>&nbsp;<span class="op" id="7763194">&amp;</span><span class="ident" id="7763195">Args</span><span class="op" id="7763199">{</span><span class="num" id="7763200">7</span><span class="op" id="7763201">,</span>&nbsp;<span class="num" id="7763203">0</span><span class="op" id="7763204">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763207">reply</span>&nbsp;<span class="op" id="7763213">=</span>&nbsp;<span class="builtinfunc" id="7763215">new</span><span class="op" id="7763218">(</span><span class="ident" id="7763219">Reply</span><span class="op" id="7763224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763227">err</span>&nbsp;<span class="op" id="7763231">=</span>&nbsp;<span class="ident" id="7763233">client</span><span class="op" id="7763239">.</span><span class="ident" id="7763240">Call</span><span class="op" id="7763244">(</span><span class="string" id="7763245">&#34;Arith.Div&#34;</span><span class="op" id="7763256">,</span>&nbsp;<span class="ident" id="7763258">args</span><span class="op" id="7763262">,</span>&nbsp;<span class="ident" id="7763264">reply</span><span class="op" id="7763269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7763272">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7763305">if</span>&nbsp;<span class="ident" id="7763308">err</span>&nbsp;<span class="op" id="7763312">==</span>&nbsp;<span class="builtintype" id="7763315">nil</span>&nbsp;<span class="op" id="7763319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763323">t</span><span class="op" id="7763324">.</span><span class="ident" id="7763325">Error</span><span class="op" id="7763330">(</span><span class="string" id="7763331">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7763352">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7763355">}</span>&nbsp;<span class="keyword" id="7763357">else</span>&nbsp;<span class="keyword" id="7763362">if</span>&nbsp;<span class="ident" id="7763365">err</span><span class="op" id="7763368">.</span><span class="ident" id="7763369">Error</span><span class="op" id="7763374">(</span><span class="op" id="7763375">)</span>&nbsp;<span class="op" id="7763377">!=</span>&nbsp;<span class="string" id="7763380">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="7763397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763401">t</span><span class="op" id="7763402">.</span><span class="ident" id="7763403">Error</span><span class="op" id="7763408">(</span><span class="string" id="7763409">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7763450">,</span>&nbsp;<span class="ident" id="7763452">err</span><span class="op" id="7763455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7763458">}</span><br>
<span class="lineno"></span><span class="op" id="7763460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="7763463">func</span>&nbsp;<span class="ident" id="7763468">TestMalformedInput</span><span class="op" id="7763486">(</span><span class="ident" id="7763487">t</span>&nbsp;<span class="op" id="7763489">*</span><span class="ident" id="7763490">testing</span><span class="op" id="7763497">.</span><span class="ident" id="7763498">T</span><span class="op" id="7763499">)</span>&nbsp;<span class="op" id="7763501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763504">cli</span><span class="op" id="7763507">,</span>&nbsp;<span class="ident" id="7763509">srv</span>&nbsp;<span class="op" id="7763513">:=</span>&nbsp;<span class="ident" id="7763516">net</span><span class="op" id="7763519">.</span><span class="ident" id="7763520">Pipe</span><span class="op" id="7763524">(</span><span class="op" id="7763525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7763528">go</span>&nbsp;<span class="ident" id="7763531">cli</span><span class="op" id="7763534">.</span><span class="ident" id="7763535">Write</span><span class="op" id="7763540">(</span><span class="op" id="7763541">[</span><span class="op" id="7763542">]</span><span class="builtintype" id="7763543">byte</span><span class="op" id="7763547">(</span><span class="string" id="7763548">`{id:1}`</span><span class="op" id="7763556">)</span><span class="op" id="7763557">)</span>&nbsp;<span class="comment" id="7763559">//&nbsp;invalid&nbsp;json</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763576">ServeConn</span><span class="op" id="7763585">(</span><span class="ident" id="7763586">srv</span><span class="op" id="7763589">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7763607">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="7763632">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="7763635">func</span>&nbsp;<span class="ident" id="7763640">TestMalformedOutput</span><span class="op" id="7763659">(</span><span class="ident" id="7763660">t</span>&nbsp;<span class="op" id="7763662">*</span><span class="ident" id="7763663">testing</span><span class="op" id="7763670">.</span><span class="ident" id="7763671">T</span><span class="op" id="7763672">)</span>&nbsp;<span class="op" id="7763674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763677">cli</span><span class="op" id="7763680">,</span>&nbsp;<span class="ident" id="7763682">srv</span>&nbsp;<span class="op" id="7763686">:=</span>&nbsp;<span class="ident" id="7763689">net</span><span class="op" id="7763692">.</span><span class="ident" id="7763693">Pipe</span><span class="op" id="7763697">(</span><span class="op" id="7763698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7763701">go</span>&nbsp;<span class="ident" id="7763704">srv</span><span class="op" id="7763707">.</span><span class="ident" id="7763708">Write</span><span class="op" id="7763713">(</span><span class="op" id="7763714">[</span><span class="op" id="7763715">]</span><span class="builtintype" id="7763716">byte</span><span class="op" id="7763720">(</span><span class="string" id="7763721">`{&#34;id&#34;:0,&#34;result&#34;:null,&#34;error&#34;:null}`</span><span class="op" id="7763758">)</span><span class="op" id="7763759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7763762">go</span>&nbsp;<span class="ident" id="7763765">ioutil</span><span class="op" id="7763771">.</span><span class="ident" id="7763772">ReadAll</span><span class="op" id="7763779">(</span><span class="ident" id="7763780">srv</span><span class="op" id="7763783">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763787">client</span>&nbsp;<span class="op" id="7763794">:=</span>&nbsp;<span class="ident" id="7763797">NewClient</span><span class="op" id="7763806">(</span><span class="ident" id="7763807">cli</span><span class="op" id="7763810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7763813">defer</span>&nbsp;<span class="ident" id="7763819">client</span><span class="op" id="7763825">.</span><span class="ident" id="7763826">Close</span><span class="op" id="7763831">(</span><span class="op" id="7763832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763836">args</span>&nbsp;<span class="op" id="7763841">:=</span>&nbsp;<span class="op" id="7763844">&amp;</span><span class="ident" id="7763845">Args</span><span class="op" id="7763849">{</span><span class="num" id="7763850">7</span><span class="op" id="7763851">,</span>&nbsp;<span class="num" id="7763853">8</span><span class="op" id="7763854">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763857">reply</span>&nbsp;<span class="op" id="7763863">:=</span>&nbsp;<span class="builtinfunc" id="7763866">new</span><span class="op" id="7763869">(</span><span class="ident" id="7763870">Reply</span><span class="op" id="7763875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763878">err</span>&nbsp;<span class="op" id="7763882">:=</span>&nbsp;<span class="ident" id="7763885">client</span><span class="op" id="7763891">.</span><span class="ident" id="7763892">Call</span><span class="op" id="7763896">(</span><span class="string" id="7763897">&#34;Arith.Add&#34;</span><span class="op" id="7763908">,</span>&nbsp;<span class="ident" id="7763910">args</span><span class="op" id="7763914">,</span>&nbsp;<span class="ident" id="7763916">reply</span><span class="op" id="7763921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7763924">if</span>&nbsp;<span class="ident" id="7763927">err</span>&nbsp;<span class="op" id="7763931">==</span>&nbsp;<span class="builtintype" id="7763934">nil</span>&nbsp;<span class="op" id="7763938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7763942">t</span><span class="op" id="7763943">.</span><span class="ident" id="7763944">Error</span><span class="op" id="7763949">(</span><span class="string" id="7763950">&#34;expected&nbsp;error&#34;</span><span class="op" id="7763966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7763969">}</span><br>
<span class="lineno">205</span><span class="op" id="7763971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7763974">func</span>&nbsp;<span class="ident" id="7763979">TestServerErrorHasNullResult</span><span class="op" id="7764007">(</span><span class="ident" id="7764008">t</span>&nbsp;<span class="op" id="7764010">*</span><span class="ident" id="7764011">testing</span><span class="op" id="7764018">.</span><span class="ident" id="7764019">T</span><span class="op" id="7764020">)</span>&nbsp;<span class="op" id="7764022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7764025">var</span>&nbsp;<span class="ident" id="7764029">out</span>&nbsp;<span class="ident" id="7764033">bytes</span><span class="op" id="7764038">.</span><span class="ident" id="7764039">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764047">sc</span>&nbsp;<span class="op" id="7764050">:=</span>&nbsp;<span class="ident" id="7764053">NewServerCodec</span><span class="op" id="7764067">(</span><span class="keyword" id="7764068">struct</span>&nbsp;<span class="op" id="7764075">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764079">io</span><span class="op" id="7764081">.</span><span class="ident" id="7764082">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764091">io</span><span class="op" id="7764093">.</span><span class="ident" id="7764094">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764103">io</span><span class="op" id="7764105">.</span><span class="ident" id="7764106">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7764114">}</span><span class="op" id="7764115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764119">Reader</span><span class="op" id="7764125">:</span>&nbsp;<span class="ident" id="7764127">strings</span><span class="op" id="7764134">.</span><span class="ident" id="7764135">NewReader</span><span class="op" id="7764144">(</span><span class="string" id="7764145">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;,&nbsp;&#34;params&#34;:&nbsp;[]}`</span><span class="op" id="7764197">)</span><span class="op" id="7764198">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764202">Writer</span><span class="op" id="7764208">:</span>&nbsp;<span class="op" id="7764210">&amp;</span><span class="ident" id="7764211">out</span><span class="op" id="7764214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764218">Closer</span><span class="op" id="7764224">:</span>&nbsp;<span class="ident" id="7764226">ioutil</span><span class="op" id="7764232">.</span><span class="ident" id="7764233">NopCloser</span><span class="op" id="7764242">(</span><span class="builtintype" id="7764243">nil</span><span class="op" id="7764246">)</span><span class="op" id="7764247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7764250">}</span><span class="op" id="7764251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764254">r</span>&nbsp;<span class="op" id="7764256">:=</span>&nbsp;<span class="builtinfunc" id="7764259">new</span><span class="op" id="7764262">(</span><span class="ident" id="7764263">rpc</span><span class="op" id="7764266">.</span><span class="ident" id="7764267">Request</span><span class="op" id="7764274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7764277">if</span>&nbsp;<span class="ident" id="7764280">err</span>&nbsp;<span class="op" id="7764284">:=</span>&nbsp;<span class="ident" id="7764287">sc</span><span class="op" id="7764289">.</span><span class="ident" id="7764290">ReadRequestHeader</span><span class="op" id="7764307">(</span><span class="ident" id="7764308">r</span><span class="op" id="7764309">)</span><span class="op" id="7764310">;</span>&nbsp;<span class="ident" id="7764312">err</span>&nbsp;<span class="op" id="7764316">!=</span>&nbsp;<span class="builtintype" id="7764319">nil</span>&nbsp;<span class="op" id="7764323">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764327">t</span><span class="op" id="7764328">.</span><span class="ident" id="7764329">Fatal</span><span class="op" id="7764334">(</span><span class="ident" id="7764335">err</span><span class="op" id="7764338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7764341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7764344">const</span>&nbsp;<span class="ident" id="7764350">valueText</span>&nbsp;<span class="op" id="7764360">=</span>&nbsp;<span class="string" id="7764362">&#34;the&nbsp;value&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;see&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7764396">const</span>&nbsp;<span class="ident" id="7764402">errorText</span>&nbsp;<span class="op" id="7764412">=</span>&nbsp;<span class="string" id="7764414">&#34;some&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764428">err</span>&nbsp;<span class="op" id="7764432">:=</span>&nbsp;<span class="ident" id="7764435">sc</span><span class="op" id="7764437">.</span><span class="ident" id="7764438">WriteResponse</span><span class="op" id="7764451">(</span><span class="op" id="7764452">&amp;</span><span class="ident" id="7764453">rpc</span><span class="op" id="7764456">.</span><span class="ident" id="7764457">Response</span><span class="op" id="7764465">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764469">ServiceMethod</span><span class="op" id="7764482">:</span>&nbsp;<span class="string" id="7764484">&#34;Method&#34;</span><span class="op" id="7764492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764496">Seq</span><span class="op" id="7764499">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7764511">1</span><span class="op" id="7764512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764516">Error</span><span class="op" id="7764521">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764531">errorText</span><span class="op" id="7764540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7764543">}</span><span class="op" id="7764544">,</span>&nbsp;<span class="ident" id="7764546">valueText</span><span class="op" id="7764555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7764558">if</span>&nbsp;<span class="ident" id="7764561">err</span>&nbsp;<span class="op" id="7764565">!=</span>&nbsp;<span class="builtintype" id="7764568">nil</span>&nbsp;<span class="op" id="7764572">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764576">t</span><span class="op" id="7764577">.</span><span class="ident" id="7764578">Fatal</span><span class="op" id="7764583">(</span><span class="ident" id="7764584">err</span><span class="op" id="7764587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7764590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7764593">if</span>&nbsp;<span class="op" id="7764596">!</span><span class="ident" id="7764597">strings</span><span class="op" id="7764604">.</span><span class="ident" id="7764605">Contains</span><span class="op" id="7764613">(</span><span class="ident" id="7764614">out</span><span class="op" id="7764617">.</span><span class="ident" id="7764618">String</span><span class="op" id="7764624">(</span><span class="op" id="7764625">)</span><span class="op" id="7764626">,</span>&nbsp;<span class="ident" id="7764628">errorText</span><span class="op" id="7764637">)</span>&nbsp;<span class="op" id="7764639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764643">t</span><span class="op" id="7764644">.</span><span class="ident" id="7764645">Fatalf</span><span class="op" id="7764651">(</span><span class="string" id="7764652">&#34;Response&nbsp;didn&#39;t&nbsp;contain&nbsp;expected&nbsp;error&nbsp;%q:&nbsp;%s&#34;</span><span class="op" id="7764699">,</span>&nbsp;<span class="ident" id="7764701">errorText</span><span class="op" id="7764710">,</span>&nbsp;<span class="op" id="7764712">&amp;</span><span class="ident" id="7764713">out</span><span class="op" id="7764716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7764719">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7764722">if</span>&nbsp;<span class="ident" id="7764725">strings</span><span class="op" id="7764732">.</span><span class="ident" id="7764733">Contains</span><span class="op" id="7764741">(</span><span class="ident" id="7764742">out</span><span class="op" id="7764745">.</span><span class="ident" id="7764746">String</span><span class="op" id="7764752">(</span><span class="op" id="7764753">)</span><span class="op" id="7764754">,</span>&nbsp;<span class="ident" id="7764756">valueText</span><span class="op" id="7764765">)</span>&nbsp;<span class="op" id="7764767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764771">t</span><span class="op" id="7764772">.</span><span class="ident" id="7764773">Errorf</span><span class="op" id="7764779">(</span><span class="string" id="7764780">&#34;Response&nbsp;contains&nbsp;both&nbsp;an&nbsp;error&nbsp;and&nbsp;value:&nbsp;%s&#34;</span><span class="op" id="7764827">,</span>&nbsp;<span class="op" id="7764829">&amp;</span><span class="ident" id="7764830">out</span><span class="op" id="7764833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7764836">}</span><br>
<span class="lineno"></span><span class="op" id="7764838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7764841">func</span>&nbsp;<span class="ident" id="7764846">TestUnexpectedError</span><span class="op" id="7764865">(</span><span class="ident" id="7764866">t</span>&nbsp;<span class="op" id="7764868">*</span><span class="ident" id="7764869">testing</span><span class="op" id="7764876">.</span><span class="ident" id="7764877">T</span><span class="op" id="7764878">)</span>&nbsp;<span class="op" id="7764880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7764883">cli</span><span class="op" id="7764886">,</span>&nbsp;<span class="ident" id="7764888">srv</span>&nbsp;<span class="op" id="7764892">:=</span>&nbsp;<span class="ident" id="7764895">myPipe</span><span class="op" id="7764901">(</span><span class="op" id="7764902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7764905">go</span>&nbsp;<span class="ident" id="7764908">cli</span><span class="op" id="7764911">.</span><span class="ident" id="7764912">PipeWriter</span><span class="op" id="7764922">.</span><span class="ident" id="7764923">CloseWithError</span><span class="op" id="7764937">(</span><span class="ident" id="7764938">errors</span><span class="op" id="7764944">.</span><span class="ident" id="7764945">New</span><span class="op" id="7764948">(</span><span class="string" id="7764949">&#34;unexpected&nbsp;error!&#34;</span><span class="op" id="7764968">)</span><span class="op" id="7764969">)</span>&nbsp;<span class="comment" id="7764971">//&nbsp;reader&nbsp;will&nbsp;get&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7765002">ServeConn</span><span class="op" id="7765011">(</span><span class="ident" id="7765012">srv</span><span class="op" id="7765015">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7765068">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="7765093">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="7765096">//&nbsp;Copied&nbsp;from&nbsp;package&nbsp;net.</span><br>
<span class="lineno"></span><span class="keyword" id="7765124">func</span>&nbsp;<span class="ident" id="7765129">myPipe</span><span class="op" id="7765135">(</span><span class="op" id="7765136">)</span>&nbsp;<span class="op" id="7765138">(</span><span class="op" id="7765139">*</span><span class="ident" id="7765140">pipe</span><span class="op" id="7765144">,</span>&nbsp;<span class="op" id="7765146">*</span><span class="ident" id="7765147">pipe</span><span class="op" id="7765151">)</span>&nbsp;<span class="op" id="7765153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7765156">r1</span><span class="op" id="7765158">,</span>&nbsp;<span class="ident" id="7765160">w1</span>&nbsp;<span class="op" id="7765163">:=</span>&nbsp;<span class="ident" id="7765166">io</span><span class="op" id="7765168">.</span><span class="ident" id="7765169">Pipe</span><span class="op" id="7765173">(</span><span class="op" id="7765174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7765177">r2</span><span class="op" id="7765179">,</span>&nbsp;<span class="ident" id="7765181">w2</span>&nbsp;<span class="op" id="7765184">:=</span>&nbsp;<span class="ident" id="7765187">io</span><span class="op" id="7765189">.</span><span class="ident" id="7765190">Pipe</span><span class="op" id="7765194">(</span><span class="op" id="7765195">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7765199">return</span>&nbsp;<span class="op" id="7765206">&amp;</span><span class="ident" id="7765207">pipe</span><span class="op" id="7765211">{</span><span class="ident" id="7765212">r1</span><span class="op" id="7765214">,</span>&nbsp;<span class="ident" id="7765216">w2</span><span class="op" id="7765218">}</span><span class="op" id="7765219">,</span>&nbsp;<span class="op" id="7765221">&amp;</span><span class="ident" id="7765222">pipe</span><span class="op" id="7765226">{</span><span class="ident" id="7765227">r2</span><span class="op" id="7765229">,</span>&nbsp;<span class="ident" id="7765231">w1</span><span class="op" id="7765233">}</span><br>
<span class="lineno"></span><span class="op" id="7765235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7765238">type</span>&nbsp;<span class="ident" id="7765243">pipe</span>&nbsp;<span class="keyword" id="7765248">struct</span>&nbsp;<span class="op" id="7765255">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7765258">*</span><span class="ident" id="7765259">io</span><span class="op" id="7765261">.</span><span class="ident" id="7765262">PipeReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7765274">*</span><span class="ident" id="7765275">io</span><span class="op" id="7765277">.</span><span class="ident" id="7765278">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="7765289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7765292">type</span>&nbsp;<span class="ident" id="7765297">pipeAddr</span>&nbsp;<span class="builtintype" id="7765306">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="7765311">func</span>&nbsp;<span class="op" id="7765316">(</span><span class="ident" id="7765317">pipeAddr</span><span class="op" id="7765325">)</span>&nbsp;<span class="ident" id="7765327">Network</span><span class="op" id="7765334">(</span><span class="op" id="7765335">)</span>&nbsp;<span class="builtintype" id="7765337">string</span>&nbsp;<span class="op" id="7765344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7765347">return</span>&nbsp;<span class="string" id="7765354">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="7765361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="7765364">func</span>&nbsp;<span class="op" id="7765369">(</span><span class="ident" id="7765370">pipeAddr</span><span class="op" id="7765378">)</span>&nbsp;<span class="ident" id="7765380">String</span><span class="op" id="7765386">(</span><span class="op" id="7765387">)</span>&nbsp;<span class="builtintype" id="7765389">string</span>&nbsp;<span class="op" id="7765396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7765399">return</span>&nbsp;<span class="string" id="7765406">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="7765413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7765416">func</span>&nbsp;<span class="op" id="7765421">(</span><span class="ident" id="7765422">p</span>&nbsp;<span class="op" id="7765424">*</span><span class="ident" id="7765425">pipe</span><span class="op" id="7765429">)</span>&nbsp;<span class="ident" id="7765431">Close</span><span class="op" id="7765436">(</span><span class="op" id="7765437">)</span>&nbsp;<span class="builtintype" id="7765439">error</span>&nbsp;<span class="op" id="7765445">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7765448">err</span>&nbsp;<span class="op" id="7765452">:=</span>&nbsp;<span class="ident" id="7765455">p</span><span class="op" id="7765456">.</span><span class="ident" id="7765457">PipeReader</span><span class="op" id="7765467">.</span><span class="ident" id="7765468">Close</span><span class="op" id="7765473">(</span><span class="op" id="7765474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7765477">err1</span>&nbsp;<span class="op" id="7765482">:=</span>&nbsp;<span class="ident" id="7765485">p</span><span class="op" id="7765486">.</span><span class="ident" id="7765487">PipeWriter</span><span class="op" id="7765497">.</span><span class="ident" id="7765498">Close</span><span class="op" id="7765503">(</span><span class="op" id="7765504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7765507">if</span>&nbsp;<span class="ident" id="7765510">err</span>&nbsp;<span class="op" id="7765514">==</span>&nbsp;<span class="builtintype" id="7765517">nil</span>&nbsp;<span class="op" id="7765521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7765525">err</span>&nbsp;<span class="op" id="7765529">=</span>&nbsp;<span class="ident" id="7765531">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7765537">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7765540">return</span>&nbsp;<span class="ident" id="7765547">err</span><br>
<span class="lineno"></span><span class="op" id="7765551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7765554">func</span>&nbsp;<span class="op" id="7765559">(</span><span class="ident" id="7765560">p</span>&nbsp;<span class="op" id="7765562">*</span><span class="ident" id="7765563">pipe</span><span class="op" id="7765567">)</span>&nbsp;<span class="ident" id="7765569">LocalAddr</span><span class="op" id="7765578">(</span><span class="op" id="7765579">)</span>&nbsp;<span class="ident" id="7765581">net</span><span class="op" id="7765584">.</span><span class="ident" id="7765585">Addr</span>&nbsp;<span class="op" id="7765590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7765593">return</span>&nbsp;<span class="ident" id="7765600">pipeAddr</span><span class="op" id="7765608">(</span><span class="num" id="7765609">0</span><span class="op" id="7765610">)</span><br>
<span class="lineno">280</span><span class="op" id="7765612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7765615">func</span>&nbsp;<span class="op" id="7765620">(</span><span class="ident" id="7765621">p</span>&nbsp;<span class="op" id="7765623">*</span><span class="ident" id="7765624">pipe</span><span class="op" id="7765628">)</span>&nbsp;<span class="ident" id="7765630">RemoteAddr</span><span class="op" id="7765640">(</span><span class="op" id="7765641">)</span>&nbsp;<span class="ident" id="7765643">net</span><span class="op" id="7765646">.</span><span class="ident" id="7765647">Addr</span>&nbsp;<span class="op" id="7765652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7765655">return</span>&nbsp;<span class="ident" id="7765662">pipeAddr</span><span class="op" id="7765670">(</span><span class="num" id="7765671">0</span><span class="op" id="7765672">)</span><br>
<span class="lineno"></span><span class="op" id="7765674">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="7765677">func</span>&nbsp;<span class="op" id="7765682">(</span><span class="ident" id="7765683">p</span>&nbsp;<span class="op" id="7765685">*</span><span class="ident" id="7765686">pipe</span><span class="op" id="7765690">)</span>&nbsp;<span class="ident" id="7765692">SetTimeout</span><span class="op" id="7765702">(</span><span class="ident" id="7765703">nsec</span>&nbsp;<span class="ident" id="7765708">int64</span><span class="op" id="7765713">)</span>&nbsp;<span class="builtintype" id="7765715">error</span>&nbsp;<span class="op" id="7765721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7765724">return</span>&nbsp;<span class="ident" id="7765731">errors</span><span class="op" id="7765737">.</span><span class="ident" id="7765738">New</span><span class="op" id="7765741">(</span><span class="string" id="7765742">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7765778">)</span><br>
<span class="lineno"></span><span class="op" id="7765780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="7765783">func</span>&nbsp;<span class="op" id="7765788">(</span><span class="ident" id="7765789">p</span>&nbsp;<span class="op" id="7765791">*</span><span class="ident" id="7765792">pipe</span><span class="op" id="7765796">)</span>&nbsp;<span class="ident" id="7765798">SetReadTimeout</span><span class="op" id="7765812">(</span><span class="ident" id="7765813">nsec</span>&nbsp;<span class="ident" id="7765818">int64</span><span class="op" id="7765823">)</span>&nbsp;<span class="builtintype" id="7765825">error</span>&nbsp;<span class="op" id="7765831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7765834">return</span>&nbsp;<span class="ident" id="7765841">errors</span><span class="op" id="7765847">.</span><span class="ident" id="7765848">New</span><span class="op" id="7765851">(</span><span class="string" id="7765852">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7765888">)</span><br>
<span class="lineno"></span><span class="op" id="7765890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7765893">func</span>&nbsp;<span class="op" id="7765898">(</span><span class="ident" id="7765899">p</span>&nbsp;<span class="op" id="7765901">*</span><span class="ident" id="7765902">pipe</span><span class="op" id="7765906">)</span>&nbsp;<span class="ident" id="7765908">SetWriteTimeout</span><span class="op" id="7765923">(</span><span class="ident" id="7765924">nsec</span>&nbsp;<span class="ident" id="7765929">int64</span><span class="op" id="7765934">)</span>&nbsp;<span class="builtintype" id="7765936">error</span>&nbsp;<span class="op" id="7765942">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7765945">return</span>&nbsp;<span class="ident" id="7765952">errors</span><span class="op" id="7765958">.</span><span class="ident" id="7765959">New</span><span class="op" id="7765962">(</span><span class="string" id="7765963">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7765999">)</span><br>
<span class="lineno"></span><span class="op" id="7766001">}</span>
</div>
</body>
</html>
