<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2380065">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2380121">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2380175">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2380226">//&nbsp;Linux&nbsp;socket&nbsp;filter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2380250">package</span>&nbsp;<span class="ident" id="2380258">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2380267">import</span>&nbsp;<span class="op" id="2380274">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2380277">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2380286">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2380289">func</span>&nbsp;<span class="ident" id="2380294">LsfStmt</span><span class="op" id="2380301">(</span><span class="ident" id="2380302">code</span><span class="op" id="2380306">,</span>&nbsp;<span class="ident" id="2380308">k</span>&nbsp;<span class="builtintype" id="2380310">int</span><span class="op" id="2380313">)</span>&nbsp;<span class="op" id="2380315">*</span><span class="ident" id="2380316">SockFilter</span>&nbsp;<span class="op" id="2380327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2380330">return</span>&nbsp;<span class="op" id="2380337">&amp;</span><span class="ident" id="2380338">SockFilter</span><span class="op" id="2380348">{</span><span class="ident" id="2380349">Code</span><span class="op" id="2380353">:</span>&nbsp;<span class="builtintype" id="2380355">uint16</span><span class="op" id="2380361">(</span><span class="ident" id="2380362">code</span><span class="op" id="2380366">)</span><span class="op" id="2380367">,</span>&nbsp;<span class="ident" id="2380369">K</span><span class="op" id="2380370">:</span>&nbsp;<span class="builtintype" id="2380372">uint32</span><span class="op" id="2380378">(</span><span class="ident" id="2380379">k</span><span class="op" id="2380380">)</span><span class="op" id="2380381">}</span><br>
<span class="lineno">15</span><span class="op" id="2380383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2380386">func</span>&nbsp;<span class="ident" id="2380391">LsfJump</span><span class="op" id="2380398">(</span><span class="ident" id="2380399">code</span><span class="op" id="2380403">,</span>&nbsp;<span class="ident" id="2380405">k</span><span class="op" id="2380406">,</span>&nbsp;<span class="ident" id="2380408">jt</span><span class="op" id="2380410">,</span>&nbsp;<span class="ident" id="2380412">jf</span>&nbsp;<span class="builtintype" id="2380415">int</span><span class="op" id="2380418">)</span>&nbsp;<span class="op" id="2380420">*</span><span class="ident" id="2380421">SockFilter</span>&nbsp;<span class="op" id="2380432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2380435">return</span>&nbsp;<span class="op" id="2380442">&amp;</span><span class="ident" id="2380443">SockFilter</span><span class="op" id="2380453">{</span><span class="ident" id="2380454">Code</span><span class="op" id="2380458">:</span>&nbsp;<span class="builtintype" id="2380460">uint16</span><span class="op" id="2380466">(</span><span class="ident" id="2380467">code</span><span class="op" id="2380471">)</span><span class="op" id="2380472">,</span>&nbsp;<span class="ident" id="2380474">Jt</span><span class="op" id="2380476">:</span>&nbsp;<span class="builtintype" id="2380478">uint8</span><span class="op" id="2380483">(</span><span class="ident" id="2380484">jt</span><span class="op" id="2380486">)</span><span class="op" id="2380487">,</span>&nbsp;<span class="ident" id="2380489">Jf</span><span class="op" id="2380491">:</span>&nbsp;<span class="builtintype" id="2380493">uint8</span><span class="op" id="2380498">(</span><span class="ident" id="2380499">jf</span><span class="op" id="2380501">)</span><span class="op" id="2380502">,</span>&nbsp;<span class="ident" id="2380504">K</span><span class="op" id="2380505">:</span>&nbsp;<span class="builtintype" id="2380507">uint32</span><span class="op" id="2380513">(</span><span class="ident" id="2380514">k</span><span class="op" id="2380515">)</span><span class="op" id="2380516">}</span><br>
<span class="lineno"></span><span class="op" id="2380518">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2380521">func</span>&nbsp;<span class="ident" id="2380526">LsfSocket</span><span class="op" id="2380535">(</span><span class="ident" id="2380536">ifindex</span><span class="op" id="2380543">,</span>&nbsp;<span class="ident" id="2380545">proto</span>&nbsp;<span class="builtintype" id="2380551">int</span><span class="op" id="2380554">)</span>&nbsp;<span class="op" id="2380556">(</span><span class="builtintype" id="2380557">int</span><span class="op" id="2380560">,</span>&nbsp;<span class="builtintype" id="2380562">error</span><span class="op" id="2380567">)</span>&nbsp;<span class="op" id="2380569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2380572">var</span>&nbsp;<span class="ident" id="2380576">lsall</span>&nbsp;<span class="ident" id="2380582">SockaddrLinklayer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2380601">s</span><span class="op" id="2380602">,</span>&nbsp;<span class="ident" id="2380604">e</span>&nbsp;<span class="op" id="2380606">:=</span>&nbsp;<span class="ident" id="2380609">Socket</span><span class="op" id="2380615">(</span><span class="ident" id="2380616">AF_PACKET</span><span class="op" id="2380625">,</span>&nbsp;<span class="ident" id="2380627">SOCK_RAW</span><span class="op" id="2380635">,</span>&nbsp;<span class="ident" id="2380637">proto</span><span class="op" id="2380642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2380645">if</span>&nbsp;<span class="ident" id="2380648">e</span>&nbsp;<span class="op" id="2380650">!=</span>&nbsp;<span class="ident" id="2380653">nil</span>&nbsp;<span class="op" id="2380657">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2380661">return</span>&nbsp;<span class="num" id="2380668">0</span><span class="op" id="2380669">,</span>&nbsp;<span class="ident" id="2380671">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2380674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2380677">p</span>&nbsp;<span class="op" id="2380679">:=</span>&nbsp;<span class="op" id="2380682">(</span><span class="op" id="2380683">*</span><span class="op" id="2380684">[</span><span class="num" id="2380685">2</span><span class="op" id="2380686">]</span><span class="builtintype" id="2380687">byte</span><span class="op" id="2380691">)</span><span class="op" id="2380692">(</span><span class="ident" id="2380693">unsafe</span><span class="op" id="2380699">.</span><span class="ident" id="2380700">Pointer</span><span class="op" id="2380707">(</span><span class="op" id="2380708">&amp;</span><span class="ident" id="2380709">lsall</span><span class="op" id="2380714">.</span><span class="ident" id="2380715">Protocol</span><span class="op" id="2380723">)</span><span class="op" id="2380724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2380727">p</span><span class="op" id="2380728">[</span><span class="num" id="2380729">0</span><span class="op" id="2380730">]</span>&nbsp;<span class="op" id="2380732">=</span>&nbsp;<span class="builtintype" id="2380734">byte</span><span class="op" id="2380738">(</span><span class="ident" id="2380739">proto</span>&nbsp;<span class="op" id="2380745">&gt;&gt;</span>&nbsp;<span class="num" id="2380748">8</span><span class="op" id="2380749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2380752">p</span><span class="op" id="2380753">[</span><span class="num" id="2380754">1</span><span class="op" id="2380755">]</span>&nbsp;<span class="op" id="2380757">=</span>&nbsp;<span class="builtintype" id="2380759">byte</span><span class="op" id="2380763">(</span><span class="ident" id="2380764">proto</span><span class="op" id="2380769">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2380772">lsall</span><span class="op" id="2380777">.</span><span class="ident" id="2380778">Ifindex</span>&nbsp;<span class="op" id="2380786">=</span>&nbsp;<span class="ident" id="2380788">ifindex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2380797">e</span>&nbsp;<span class="op" id="2380799">=</span>&nbsp;<span class="ident" id="2380801">Bind</span><span class="op" id="2380805">(</span><span class="ident" id="2380806">s</span><span class="op" id="2380807">,</span>&nbsp;<span class="op" id="2380809">&amp;</span><span class="ident" id="2380810">lsall</span><span class="op" id="2380815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2380818">if</span>&nbsp;<span class="ident" id="2380821">e</span>&nbsp;<span class="op" id="2380823">!=</span>&nbsp;<span class="ident" id="2380826">nil</span>&nbsp;<span class="op" id="2380830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2380834">Close</span><span class="op" id="2380839">(</span><span class="ident" id="2380840">s</span><span class="op" id="2380841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2380845">return</span>&nbsp;<span class="num" id="2380852">0</span><span class="op" id="2380853">,</span>&nbsp;<span class="ident" id="2380855">e</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2380858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2380861">return</span>&nbsp;<span class="ident" id="2380868">s</span><span class="op" id="2380869">,</span>&nbsp;<span class="ident" id="2380871">nil</span><br>
<span class="lineno"></span><span class="op" id="2380875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2380878">type</span>&nbsp;<span class="ident" id="2380883">iflags</span>&nbsp;<span class="keyword" id="2380890">struct</span>&nbsp;<span class="op" id="2380897">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2380900">name</span>&nbsp;&nbsp;<span class="op" id="2380906">[</span><span class="ident" id="2380907">IFNAMSIZ</span><span class="op" id="2380915">]</span><span class="builtintype" id="2380916">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2380922">flags</span>&nbsp;<span class="builtintype" id="2380928">uint16</span><br>
<span class="lineno"></span><span class="op" id="2380935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2380938">func</span>&nbsp;<span class="ident" id="2380943">SetLsfPromisc</span><span class="op" id="2380956">(</span><span class="ident" id="2380957">name</span>&nbsp;<span class="builtintype" id="2380962">string</span><span class="op" id="2380968">,</span>&nbsp;<span class="ident" id="2380970">m</span>&nbsp;<span class="builtintype" id="2380972">bool</span><span class="op" id="2380976">)</span>&nbsp;<span class="builtintype" id="2380978">error</span>&nbsp;<span class="op" id="2380984">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2380987">s</span><span class="op" id="2380988">,</span>&nbsp;<span class="ident" id="2380990">e</span>&nbsp;<span class="op" id="2380992">:=</span>&nbsp;<span class="ident" id="2380995">Socket</span><span class="op" id="2381001">(</span><span class="ident" id="2381002">AF_INET</span><span class="op" id="2381009">,</span>&nbsp;<span class="ident" id="2381011">SOCK_DGRAM</span><span class="op" id="2381021">,</span>&nbsp;<span class="num" id="2381023">0</span><span class="op" id="2381024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381027">if</span>&nbsp;<span class="ident" id="2381030">e</span>&nbsp;<span class="op" id="2381032">!=</span>&nbsp;<span class="ident" id="2381035">nil</span>&nbsp;<span class="op" id="2381039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381043">return</span>&nbsp;<span class="ident" id="2381050">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2381053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381056">defer</span>&nbsp;<span class="ident" id="2381062">Close</span><span class="op" id="2381067">(</span><span class="ident" id="2381068">s</span><span class="op" id="2381069">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381072">var</span>&nbsp;<span class="ident" id="2381076">ifl</span>&nbsp;<span class="ident" id="2381080">iflags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2381088">copy</span><span class="op" id="2381092">(</span><span class="ident" id="2381093">ifl</span><span class="op" id="2381096">.</span><span class="ident" id="2381097">name</span><span class="op" id="2381101">[</span><span class="op" id="2381102">:</span><span class="op" id="2381103">]</span><span class="op" id="2381104">,</span>&nbsp;<span class="op" id="2381106">[</span><span class="op" id="2381107">]</span><span class="builtintype" id="2381108">byte</span><span class="op" id="2381112">(</span><span class="ident" id="2381113">name</span><span class="op" id="2381117">)</span><span class="op" id="2381118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2381121">_</span><span class="op" id="2381122">,</span>&nbsp;<span class="ident" id="2381124">_</span><span class="op" id="2381125">,</span>&nbsp;<span class="ident" id="2381127">ep</span>&nbsp;<span class="op" id="2381130">:=</span>&nbsp;<span class="ident" id="2381133">Syscall</span><span class="op" id="2381140">(</span><span class="ident" id="2381141">SYS_IOCTL</span><span class="op" id="2381150">,</span>&nbsp;<span class="builtintype" id="2381152">uintptr</span><span class="op" id="2381159">(</span><span class="ident" id="2381160">s</span><span class="op" id="2381161">)</span><span class="op" id="2381162">,</span>&nbsp;<span class="ident" id="2381164">SIOCGIFFLAGS</span><span class="op" id="2381176">,</span>&nbsp;<span class="builtintype" id="2381178">uintptr</span><span class="op" id="2381185">(</span><span class="ident" id="2381186">unsafe</span><span class="op" id="2381192">.</span><span class="ident" id="2381193">Pointer</span><span class="op" id="2381200">(</span><span class="op" id="2381201">&amp;</span><span class="ident" id="2381202">ifl</span><span class="op" id="2381205">)</span><span class="op" id="2381206">)</span><span class="op" id="2381207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381210">if</span>&nbsp;<span class="ident" id="2381213">ep</span>&nbsp;<span class="op" id="2381216">!=</span>&nbsp;<span class="num" id="2381219">0</span>&nbsp;<span class="op" id="2381221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381225">return</span>&nbsp;<span class="ident" id="2381232">Errno</span><span class="op" id="2381237">(</span><span class="ident" id="2381238">ep</span><span class="op" id="2381240">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2381243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381246">if</span>&nbsp;<span class="ident" id="2381249">m</span>&nbsp;<span class="op" id="2381251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2381255">ifl</span><span class="op" id="2381258">.</span><span class="ident" id="2381259">flags</span>&nbsp;<span class="op" id="2381265">|=</span>&nbsp;<span class="builtintype" id="2381268">uint16</span><span class="op" id="2381274">(</span><span class="ident" id="2381275">IFF_PROMISC</span><span class="op" id="2381286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2381289">}</span>&nbsp;<span class="keyword" id="2381291">else</span>&nbsp;<span class="op" id="2381296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2381300">ifl</span><span class="op" id="2381303">.</span><span class="ident" id="2381304">flags</span>&nbsp;<span class="op" id="2381310">&amp;=</span>&nbsp;<span class="op" id="2381313">^</span><span class="builtintype" id="2381314">uint16</span><span class="op" id="2381320">(</span><span class="ident" id="2381321">IFF_PROMISC</span><span class="op" id="2381332">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2381335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2381338">_</span><span class="op" id="2381339">,</span>&nbsp;<span class="ident" id="2381341">_</span><span class="op" id="2381342">,</span>&nbsp;<span class="ident" id="2381344">ep</span>&nbsp;<span class="op" id="2381347">=</span>&nbsp;<span class="ident" id="2381349">Syscall</span><span class="op" id="2381356">(</span><span class="ident" id="2381357">SYS_IOCTL</span><span class="op" id="2381366">,</span>&nbsp;<span class="builtintype" id="2381368">uintptr</span><span class="op" id="2381375">(</span><span class="ident" id="2381376">s</span><span class="op" id="2381377">)</span><span class="op" id="2381378">,</span>&nbsp;<span class="ident" id="2381380">SIOCSIFFLAGS</span><span class="op" id="2381392">,</span>&nbsp;<span class="builtintype" id="2381394">uintptr</span><span class="op" id="2381401">(</span><span class="ident" id="2381402">unsafe</span><span class="op" id="2381408">.</span><span class="ident" id="2381409">Pointer</span><span class="op" id="2381416">(</span><span class="op" id="2381417">&amp;</span><span class="ident" id="2381418">ifl</span><span class="op" id="2381421">)</span><span class="op" id="2381422">)</span><span class="op" id="2381423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381426">if</span>&nbsp;<span class="ident" id="2381429">ep</span>&nbsp;<span class="op" id="2381432">!=</span>&nbsp;<span class="num" id="2381435">0</span>&nbsp;<span class="op" id="2381437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381441">return</span>&nbsp;<span class="ident" id="2381448">Errno</span><span class="op" id="2381453">(</span><span class="ident" id="2381454">ep</span><span class="op" id="2381456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2381459">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381462">return</span>&nbsp;<span class="ident" id="2381469">nil</span><br>
<span class="lineno"></span><span class="op" id="2381473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2381476">func</span>&nbsp;<span class="ident" id="2381481">AttachLsf</span><span class="op" id="2381490">(</span><span class="ident" id="2381491">fd</span>&nbsp;<span class="builtintype" id="2381494">int</span><span class="op" id="2381497">,</span>&nbsp;<span class="ident" id="2381499">i</span>&nbsp;<span class="op" id="2381501">[</span><span class="op" id="2381502">]</span><span class="ident" id="2381503">SockFilter</span><span class="op" id="2381513">)</span>&nbsp;<span class="builtintype" id="2381515">error</span>&nbsp;<span class="op" id="2381521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381524">var</span>&nbsp;<span class="ident" id="2381528">p</span>&nbsp;<span class="ident" id="2381530">SockFprog</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2381541">p</span><span class="op" id="2381542">.</span><span class="ident" id="2381543">Len</span>&nbsp;<span class="op" id="2381547">=</span>&nbsp;<span class="builtintype" id="2381549">uint16</span><span class="op" id="2381555">(</span><span class="builtinfunc" id="2381556">len</span><span class="op" id="2381559">(</span><span class="ident" id="2381560">i</span><span class="op" id="2381561">)</span><span class="op" id="2381562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2381565">p</span><span class="op" id="2381566">.</span><span class="ident" id="2381567">Filter</span>&nbsp;<span class="op" id="2381574">=</span>&nbsp;<span class="op" id="2381576">(</span><span class="op" id="2381577">*</span><span class="ident" id="2381578">SockFilter</span><span class="op" id="2381588">)</span><span class="op" id="2381589">(</span><span class="ident" id="2381590">unsafe</span><span class="op" id="2381596">.</span><span class="ident" id="2381597">Pointer</span><span class="op" id="2381604">(</span><span class="op" id="2381605">&amp;</span><span class="ident" id="2381606">i</span><span class="op" id="2381607">[</span><span class="num" id="2381608">0</span><span class="op" id="2381609">]</span><span class="op" id="2381610">)</span><span class="op" id="2381611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381614">return</span>&nbsp;<span class="ident" id="2381621">setsockopt</span><span class="op" id="2381631">(</span><span class="ident" id="2381632">fd</span><span class="op" id="2381634">,</span>&nbsp;<span class="ident" id="2381636">SOL_SOCKET</span><span class="op" id="2381646">,</span>&nbsp;<span class="ident" id="2381648">SO_ATTACH_FILTER</span><span class="op" id="2381664">,</span>&nbsp;<span class="ident" id="2381666">unsafe</span><span class="op" id="2381672">.</span><span class="ident" id="2381673">Pointer</span><span class="op" id="2381680">(</span><span class="op" id="2381681">&amp;</span><span class="ident" id="2381682">p</span><span class="op" id="2381683">)</span><span class="op" id="2381684">,</span>&nbsp;<span class="ident" id="2381686">unsafe</span><span class="op" id="2381692">.</span><span class="ident" id="2381693">Sizeof</span><span class="op" id="2381699">(</span><span class="ident" id="2381700">p</span><span class="op" id="2381701">)</span><span class="op" id="2381702">)</span><br>
<span class="lineno"></span><span class="op" id="2381704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="2381707">func</span>&nbsp;<span class="ident" id="2381712">DetachLsf</span><span class="op" id="2381721">(</span><span class="ident" id="2381722">fd</span>&nbsp;<span class="builtintype" id="2381725">int</span><span class="op" id="2381728">)</span>&nbsp;<span class="builtintype" id="2381730">error</span>&nbsp;<span class="op" id="2381736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381739">var</span>&nbsp;<span class="ident" id="2381743">dummy</span>&nbsp;<span class="builtintype" id="2381749">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2381754">return</span>&nbsp;<span class="ident" id="2381761">setsockopt</span><span class="op" id="2381771">(</span><span class="ident" id="2381772">fd</span><span class="op" id="2381774">,</span>&nbsp;<span class="ident" id="2381776">SOL_SOCKET</span><span class="op" id="2381786">,</span>&nbsp;<span class="ident" id="2381788">SO_DETACH_FILTER</span><span class="op" id="2381804">,</span>&nbsp;<span class="ident" id="2381806">unsafe</span><span class="op" id="2381812">.</span><span class="ident" id="2381813">Pointer</span><span class="op" id="2381820">(</span><span class="op" id="2381821">&amp;</span><span class="ident" id="2381822">dummy</span><span class="op" id="2381827">)</span><span class="op" id="2381828">,</span>&nbsp;<span class="ident" id="2381830">unsafe</span><span class="op" id="2381836">.</span><span class="ident" id="2381837">Sizeof</span><span class="op" id="2381843">(</span><span class="ident" id="2381844">dummy</span><span class="op" id="2381849">)</span><span class="op" id="2381850">)</span><br>
<span class="lineno"></span><span class="op" id="2381852">}</span>
</div>
</body>
</html>
