<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3494680">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3494735">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3494789">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3494840">package</span>&nbsp;<span class="ident" id="3494848">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3494859">import</span>&nbsp;<span class="op" id="3494866">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3494869">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3494878">&#34;crypto/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3494893">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3494903">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3494910">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3494916">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3494933">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3494943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3494946">//&nbsp;A&nbsp;Writer&nbsp;generates&nbsp;multipart&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="3494988">type</span>&nbsp;<span class="ident" id="3494993">Writer</span>&nbsp;<span class="keyword" id="3495000">struct</span>&nbsp;<span class="op" id="3495007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495010">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495019">io</span><span class="op" id="3495021">.</span><span class="ident" id="3495022">Writer</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495030">boundary</span>&nbsp;<span class="builtintype" id="3495039">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495047">lastpart</span>&nbsp;<span class="op" id="3495056">*</span><span class="ident" id="3495057">part</span><br>
<span class="lineno"></span><span class="op" id="3495062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3495065">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;multipart&nbsp;Writer&nbsp;with&nbsp;a&nbsp;random&nbsp;boundary,</span><br>
<span class="lineno">25</span><span class="comment" id="3495133">//&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3495150">func</span>&nbsp;<span class="ident" id="3495155">NewWriter</span><span class="op" id="3495164">(</span><span class="ident" id="3495165">w</span>&nbsp;<span class="ident" id="3495167">io</span><span class="op" id="3495169">.</span><span class="ident" id="3495170">Writer</span><span class="op" id="3495176">)</span>&nbsp;<span class="op" id="3495178">*</span><span class="ident" id="3495179">Writer</span>&nbsp;<span class="op" id="3495186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495189">return</span>&nbsp;<span class="op" id="3495196">&amp;</span><span class="ident" id="3495197">Writer</span><span class="op" id="3495203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495207">w</span><span class="op" id="3495208">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495217">w</span><span class="op" id="3495218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495222">boundary</span><span class="op" id="3495230">:</span>&nbsp;<span class="ident" id="3495232">randomBoundary</span><span class="op" id="3495246">(</span><span class="op" id="3495247">)</span><span class="op" id="3495248">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495251">}</span><br>
<span class="lineno"></span><span class="op" id="3495253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3495256">//&nbsp;Boundary&nbsp;returns&nbsp;the&nbsp;Writer&#39;s&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3495299">func</span>&nbsp;<span class="op" id="3495304">(</span><span class="ident" id="3495305">w</span>&nbsp;<span class="op" id="3495307">*</span><span class="ident" id="3495308">Writer</span><span class="op" id="3495314">)</span>&nbsp;<span class="ident" id="3495316">Boundary</span><span class="op" id="3495324">(</span><span class="op" id="3495325">)</span>&nbsp;<span class="builtintype" id="3495327">string</span>&nbsp;<span class="op" id="3495334">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495337">return</span>&nbsp;<span class="ident" id="3495344">w</span><span class="op" id="3495345">.</span><span class="ident" id="3495346">boundary</span><br>
<span class="lineno"></span><span class="op" id="3495355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3495358">//&nbsp;SetBoundary&nbsp;overrides&nbsp;the&nbsp;Writer&#39;s&nbsp;default&nbsp;randomly-generated</span><br>
<span class="lineno"></span><span class="comment" id="3495423">//&nbsp;boundary&nbsp;separator&nbsp;with&nbsp;an&nbsp;explicit&nbsp;value.</span><br>
<span class="lineno">40</span><span class="comment" id="3495469">//</span><br>
<span class="lineno"></span><span class="comment" id="3495472">//&nbsp;SetBoundary&nbsp;must&nbsp;be&nbsp;called&nbsp;before&nbsp;any&nbsp;parts&nbsp;are&nbsp;created,&nbsp;may&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="3495541">//&nbsp;contain&nbsp;certain&nbsp;ASCII&nbsp;characters,&nbsp;and&nbsp;must&nbsp;be&nbsp;1-69&nbsp;bytes&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="3495607">func</span>&nbsp;<span class="op" id="3495612">(</span><span class="ident" id="3495613">w</span>&nbsp;<span class="op" id="3495615">*</span><span class="ident" id="3495616">Writer</span><span class="op" id="3495622">)</span>&nbsp;<span class="ident" id="3495624">SetBoundary</span><span class="op" id="3495635">(</span><span class="ident" id="3495636">boundary</span>&nbsp;<span class="builtintype" id="3495645">string</span><span class="op" id="3495651">)</span>&nbsp;<span class="builtintype" id="3495653">error</span>&nbsp;<span class="op" id="3495659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495662">if</span>&nbsp;<span class="ident" id="3495665">w</span><span class="op" id="3495666">.</span><span class="ident" id="3495667">lastpart</span>&nbsp;<span class="op" id="3495676">!=</span>&nbsp;<span class="builtintype" id="3495679">nil</span>&nbsp;<span class="op" id="3495683">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495687">return</span>&nbsp;<span class="ident" id="3495694">errors</span><span class="op" id="3495700">.</span><span class="ident" id="3495701">New</span><span class="op" id="3495704">(</span><span class="string" id="3495705">&#34;mime:&nbsp;SetBoundary&nbsp;called&nbsp;after&nbsp;write&#34;</span><span class="op" id="3495743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3495749">//&nbsp;rfc2046#section-5.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495775">if</span>&nbsp;<span class="builtinfunc" id="3495778">len</span><span class="op" id="3495781">(</span><span class="ident" id="3495782">boundary</span><span class="op" id="3495790">)</span>&nbsp;<span class="op" id="3495792">&lt;</span>&nbsp;<span class="num" id="3495794">1</span>&nbsp;<span class="op" id="3495796">||</span>&nbsp;<span class="builtinfunc" id="3495799">len</span><span class="op" id="3495802">(</span><span class="ident" id="3495803">boundary</span><span class="op" id="3495811">)</span>&nbsp;<span class="op" id="3495813">&gt;</span>&nbsp;<span class="num" id="3495815">69</span>&nbsp;<span class="op" id="3495818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495822">return</span>&nbsp;<span class="ident" id="3495829">errors</span><span class="op" id="3495835">.</span><span class="ident" id="3495836">New</span><span class="op" id="3495839">(</span><span class="string" id="3495840">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;length&#34;</span><span class="op" id="3495871">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495877">for</span>&nbsp;<span class="ident" id="3495881">_</span><span class="op" id="3495882">,</span>&nbsp;<span class="ident" id="3495884">b</span>&nbsp;<span class="op" id="3495886">:=</span>&nbsp;<span class="keyword" id="3495889">range</span>&nbsp;<span class="ident" id="3495895">boundary</span>&nbsp;<span class="op" id="3495904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495908">if</span>&nbsp;<span class="string" id="3495911">&#39;A&#39;</span>&nbsp;<span class="op" id="3495915">&lt;=</span>&nbsp;<span class="ident" id="3495918">b</span>&nbsp;<span class="op" id="3495920">&amp;&amp;</span>&nbsp;<span class="ident" id="3495923">b</span>&nbsp;<span class="op" id="3495925">&lt;=</span>&nbsp;<span class="string" id="3495928">&#39;Z&#39;</span>&nbsp;<span class="op" id="3495932">||</span>&nbsp;<span class="string" id="3495935">&#39;a&#39;</span>&nbsp;<span class="op" id="3495939">&lt;=</span>&nbsp;<span class="ident" id="3495942">b</span>&nbsp;<span class="op" id="3495944">&amp;&amp;</span>&nbsp;<span class="ident" id="3495947">b</span>&nbsp;<span class="op" id="3495949">&lt;=</span>&nbsp;<span class="string" id="3495952">&#39;z&#39;</span>&nbsp;<span class="op" id="3495956">||</span>&nbsp;<span class="string" id="3495959">&#39;0&#39;</span>&nbsp;<span class="op" id="3495963">&lt;=</span>&nbsp;<span class="ident" id="3495966">b</span>&nbsp;<span class="op" id="3495968">&amp;&amp;</span>&nbsp;<span class="ident" id="3495971">b</span>&nbsp;<span class="op" id="3495973">&lt;=</span>&nbsp;<span class="string" id="3495976">&#39;9&#39;</span>&nbsp;<span class="op" id="3495980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495985">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495996">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496000">switch</span>&nbsp;<span class="ident" id="3496007">b</span>&nbsp;<span class="op" id="3496009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496013">case</span>&nbsp;<span class="string" id="3496018">&#39;\&#39;&#39;</span><span class="op" id="3496022">,</span>&nbsp;<span class="string" id="3496024">&#39;(&#39;</span><span class="op" id="3496027">,</span>&nbsp;<span class="string" id="3496029">&#39;)&#39;</span><span class="op" id="3496032">,</span>&nbsp;<span class="string" id="3496034">&#39;+&#39;</span><span class="op" id="3496037">,</span>&nbsp;<span class="string" id="3496039">&#39;_&#39;</span><span class="op" id="3496042">,</span>&nbsp;<span class="string" id="3496044">&#39;,&#39;</span><span class="op" id="3496047">,</span>&nbsp;<span class="string" id="3496049">&#39;-&#39;</span><span class="op" id="3496052">,</span>&nbsp;<span class="string" id="3496054">&#39;.&#39;</span><span class="op" id="3496057">,</span>&nbsp;<span class="string" id="3496059">&#39;/&#39;</span><span class="op" id="3496062">,</span>&nbsp;<span class="string" id="3496064">&#39;:&#39;</span><span class="op" id="3496067">,</span>&nbsp;<span class="string" id="3496069">&#39;=&#39;</span><span class="op" id="3496072">,</span>&nbsp;<span class="string" id="3496074">&#39;?&#39;</span><span class="op" id="3496077">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496082">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496097">return</span>&nbsp;<span class="ident" id="3496104">errors</span><span class="op" id="3496110">.</span><span class="ident" id="3496111">New</span><span class="op" id="3496114">(</span><span class="string" id="3496115">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;character&#34;</span><span class="op" id="3496149">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3496155">w</span><span class="op" id="3496156">.</span><span class="ident" id="3496157">boundary</span>&nbsp;<span class="op" id="3496166">=</span>&nbsp;<span class="ident" id="3496168">boundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496178">return</span>&nbsp;<span class="builtintype" id="3496185">nil</span><br>
<span class="lineno"></span><span class="op" id="3496189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3496192">//&nbsp;FormDataContentType&nbsp;returns&nbsp;the&nbsp;Content-Type&nbsp;for&nbsp;an&nbsp;HTTP</span><br>
<span class="lineno"></span><span class="comment" id="3496252">//&nbsp;multipart/form-data&nbsp;with&nbsp;this&nbsp;Writer&#39;s&nbsp;Boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3496304">func</span>&nbsp;<span class="op" id="3496309">(</span><span class="ident" id="3496310">w</span>&nbsp;<span class="op" id="3496312">*</span><span class="ident" id="3496313">Writer</span><span class="op" id="3496319">)</span>&nbsp;<span class="ident" id="3496321">FormDataContentType</span><span class="op" id="3496340">(</span><span class="op" id="3496341">)</span>&nbsp;<span class="builtintype" id="3496343">string</span>&nbsp;<span class="op" id="3496350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496353">return</span>&nbsp;<span class="string" id="3496360">&#34;multipart/form-data;&nbsp;boundary=&#34;</span>&nbsp;<span class="op" id="3496393">+</span>&nbsp;<span class="ident" id="3496395">w</span><span class="op" id="3496396">.</span><span class="ident" id="3496397">boundary</span><br>
<span class="lineno"></span><span class="op" id="3496406">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3496409">func</span>&nbsp;<span class="ident" id="3496414">randomBoundary</span><span class="op" id="3496428">(</span><span class="op" id="3496429">)</span>&nbsp;<span class="builtintype" id="3496431">string</span>&nbsp;<span class="op" id="3496438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496441">var</span>&nbsp;<span class="ident" id="3496445">buf</span>&nbsp;<span class="op" id="3496449">[</span><span class="num" id="3496450">30</span><span class="op" id="3496452">]</span><span class="builtintype" id="3496453">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3496459">_</span><span class="op" id="3496460">,</span>&nbsp;<span class="ident" id="3496462">err</span>&nbsp;<span class="op" id="3496466">:=</span>&nbsp;<span class="ident" id="3496469">io</span><span class="op" id="3496471">.</span><span class="ident" id="3496472">ReadFull</span><span class="op" id="3496480">(</span><span class="ident" id="3496481">rand</span><span class="op" id="3496485">.</span><span class="ident" id="3496486">Reader</span><span class="op" id="3496492">,</span>&nbsp;<span class="ident" id="3496494">buf</span><span class="op" id="3496497">[</span><span class="op" id="3496498">:</span><span class="op" id="3496499">]</span><span class="op" id="3496500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496503">if</span>&nbsp;<span class="ident" id="3496506">err</span>&nbsp;<span class="op" id="3496510">!=</span>&nbsp;<span class="builtintype" id="3496513">nil</span>&nbsp;<span class="op" id="3496517">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3496521">panic</span><span class="op" id="3496526">(</span><span class="ident" id="3496527">err</span><span class="op" id="3496530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496536">return</span>&nbsp;<span class="ident" id="3496543">fmt</span><span class="op" id="3496546">.</span><span class="ident" id="3496547">Sprintf</span><span class="op" id="3496554">(</span><span class="string" id="3496555">&#34;%x&#34;</span><span class="op" id="3496559">,</span>&nbsp;<span class="ident" id="3496561">buf</span><span class="op" id="3496564">[</span><span class="op" id="3496565">:</span><span class="op" id="3496566">]</span><span class="op" id="3496567">)</span><br>
<span class="lineno"></span><span class="op" id="3496569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3496572">//&nbsp;CreatePart&nbsp;creates&nbsp;a&nbsp;new&nbsp;multipart&nbsp;section&nbsp;with&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="3496636">//&nbsp;header.&nbsp;The&nbsp;body&nbsp;of&nbsp;the&nbsp;part&nbsp;should&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="3496702">//&nbsp;Writer.&nbsp;After&nbsp;calling&nbsp;CreatePart,&nbsp;any&nbsp;previous&nbsp;part&nbsp;may&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="3496771">//&nbsp;be&nbsp;written&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="3496789">func</span>&nbsp;<span class="op" id="3496794">(</span><span class="ident" id="3496795">w</span>&nbsp;<span class="op" id="3496797">*</span><span class="ident" id="3496798">Writer</span><span class="op" id="3496804">)</span>&nbsp;<span class="ident" id="3496806">CreatePart</span><span class="op" id="3496816">(</span><span class="ident" id="3496817">header</span>&nbsp;<span class="ident" id="3496824">textproto</span><span class="op" id="3496833">.</span><span class="ident" id="3496834">MIMEHeader</span><span class="op" id="3496844">)</span>&nbsp;<span class="op" id="3496846">(</span><span class="ident" id="3496847">io</span><span class="op" id="3496849">.</span><span class="ident" id="3496850">Writer</span><span class="op" id="3496856">,</span>&nbsp;<span class="builtintype" id="3496858">error</span><span class="op" id="3496863">)</span>&nbsp;<span class="op" id="3496865">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496868">if</span>&nbsp;<span class="ident" id="3496871">w</span><span class="op" id="3496872">.</span><span class="ident" id="3496873">lastpart</span>&nbsp;<span class="op" id="3496882">!=</span>&nbsp;<span class="builtintype" id="3496885">nil</span>&nbsp;<span class="op" id="3496889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496893">if</span>&nbsp;<span class="ident" id="3496896">err</span>&nbsp;<span class="op" id="3496900">:=</span>&nbsp;<span class="ident" id="3496903">w</span><span class="op" id="3496904">.</span><span class="ident" id="3496905">lastpart</span><span class="op" id="3496913">.</span><span class="builtinfunc" id="3496914">close</span><span class="op" id="3496919">(</span><span class="op" id="3496920">)</span><span class="op" id="3496921">;</span>&nbsp;<span class="ident" id="3496923">err</span>&nbsp;<span class="op" id="3496927">!=</span>&nbsp;<span class="builtintype" id="3496930">nil</span>&nbsp;<span class="op" id="3496934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496939">return</span>&nbsp;<span class="builtintype" id="3496946">nil</span><span class="op" id="3496949">,</span>&nbsp;<span class="ident" id="3496951">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496960">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496963">var</span>&nbsp;<span class="ident" id="3496967">b</span>&nbsp;<span class="ident" id="3496969">bytes</span><span class="op" id="3496974">.</span><span class="ident" id="3496975">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496983">if</span>&nbsp;<span class="ident" id="3496986">w</span><span class="op" id="3496987">.</span><span class="ident" id="3496988">lastpart</span>&nbsp;<span class="op" id="3496997">!=</span>&nbsp;<span class="builtintype" id="3497000">nil</span>&nbsp;<span class="op" id="3497004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497008">fmt</span><span class="op" id="3497011">.</span><span class="ident" id="3497012">Fprintf</span><span class="op" id="3497019">(</span><span class="op" id="3497020">&amp;</span><span class="ident" id="3497021">b</span><span class="op" id="3497022">,</span>&nbsp;<span class="string" id="3497024">&#34;\r\n--%s\r\n&#34;</span><span class="op" id="3497038">,</span>&nbsp;<span class="ident" id="3497040">w</span><span class="op" id="3497041">.</span><span class="ident" id="3497042">boundary</span><span class="op" id="3497050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3497053">}</span>&nbsp;<span class="keyword" id="3497055">else</span>&nbsp;<span class="op" id="3497060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497064">fmt</span><span class="op" id="3497067">.</span><span class="ident" id="3497068">Fprintf</span><span class="op" id="3497075">(</span><span class="op" id="3497076">&amp;</span><span class="ident" id="3497077">b</span><span class="op" id="3497078">,</span>&nbsp;<span class="string" id="3497080">&#34;--%s\r\n&#34;</span><span class="op" id="3497090">,</span>&nbsp;<span class="ident" id="3497092">w</span><span class="op" id="3497093">.</span><span class="ident" id="3497094">boundary</span><span class="op" id="3497102">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3497105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497108">//&nbsp;TODO(bradfitz):&nbsp;move&nbsp;this&nbsp;to&nbsp;textproto.MimeHeader.Write(w),&nbsp;have&nbsp;it&nbsp;sort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497185">//&nbsp;and&nbsp;clean,&nbsp;like&nbsp;http.Header.Write(w)&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497232">for</span>&nbsp;<span class="ident" id="3497236">k</span><span class="op" id="3497237">,</span>&nbsp;<span class="ident" id="3497239">vv</span>&nbsp;<span class="op" id="3497242">:=</span>&nbsp;<span class="keyword" id="3497245">range</span>&nbsp;<span class="ident" id="3497251">header</span>&nbsp;<span class="op" id="3497258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497262">for</span>&nbsp;<span class="ident" id="3497266">_</span><span class="op" id="3497267">,</span>&nbsp;<span class="ident" id="3497269">v</span>&nbsp;<span class="op" id="3497271">:=</span>&nbsp;<span class="keyword" id="3497274">range</span>&nbsp;<span class="ident" id="3497280">vv</span>&nbsp;<span class="op" id="3497283">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497288">fmt</span><span class="op" id="3497291">.</span><span class="ident" id="3497292">Fprintf</span><span class="op" id="3497299">(</span><span class="op" id="3497300">&amp;</span><span class="ident" id="3497301">b</span><span class="op" id="3497302">,</span>&nbsp;<span class="string" id="3497304">&#34;%s:&nbsp;%s\r\n&#34;</span><span class="op" id="3497316">,</span>&nbsp;<span class="ident" id="3497318">k</span><span class="op" id="3497319">,</span>&nbsp;<span class="ident" id="3497321">v</span><span class="op" id="3497322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3497326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3497329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497332">fmt</span><span class="op" id="3497335">.</span><span class="ident" id="3497336">Fprintf</span><span class="op" id="3497343">(</span><span class="op" id="3497344">&amp;</span><span class="ident" id="3497345">b</span><span class="op" id="3497346">,</span>&nbsp;<span class="string" id="3497348">&#34;\r\n&#34;</span><span class="op" id="3497354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497357">_</span><span class="op" id="3497358">,</span>&nbsp;<span class="ident" id="3497360">err</span>&nbsp;<span class="op" id="3497364">:=</span>&nbsp;<span class="ident" id="3497367">io</span><span class="op" id="3497369">.</span><span class="ident" id="3497370">Copy</span><span class="op" id="3497374">(</span><span class="ident" id="3497375">w</span><span class="op" id="3497376">.</span><span class="ident" id="3497377">w</span><span class="op" id="3497378">,</span>&nbsp;<span class="op" id="3497380">&amp;</span><span class="ident" id="3497381">b</span><span class="op" id="3497382">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497385">if</span>&nbsp;<span class="ident" id="3497388">err</span>&nbsp;<span class="op" id="3497392">!=</span>&nbsp;<span class="builtintype" id="3497395">nil</span>&nbsp;<span class="op" id="3497399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497403">return</span>&nbsp;<span class="builtintype" id="3497410">nil</span><span class="op" id="3497413">,</span>&nbsp;<span class="ident" id="3497415">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3497420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497423">p</span>&nbsp;<span class="op" id="3497425">:=</span>&nbsp;<span class="op" id="3497428">&amp;</span><span class="ident" id="3497429">part</span><span class="op" id="3497433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497437">mw</span><span class="op" id="3497439">:</span>&nbsp;<span class="ident" id="3497441">w</span><span class="op" id="3497442">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3497445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497448">w</span><span class="op" id="3497449">.</span><span class="ident" id="3497450">lastpart</span>&nbsp;<span class="op" id="3497459">=</span>&nbsp;<span class="ident" id="3497461">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497464">return</span>&nbsp;<span class="ident" id="3497471">p</span><span class="op" id="3497472">,</span>&nbsp;<span class="builtintype" id="3497474">nil</span><br>
<span class="lineno"></span><span class="op" id="3497478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3497481">var</span>&nbsp;<span class="ident" id="3497485">quoteEscaper</span>&nbsp;<span class="op" id="3497498">=</span>&nbsp;<span class="ident" id="3497500">strings</span><span class="op" id="3497507">.</span><span class="ident" id="3497508">NewReplacer</span><span class="op" id="3497519">(</span><span class="string" id="3497520">&#34;\\&#34;</span><span class="op" id="3497524">,</span>&nbsp;<span class="string" id="3497526">&#34;\\\\&#34;</span><span class="op" id="3497532">,</span>&nbsp;<span class="string" id="3497534">`&#34;`</span><span class="op" id="3497537">,</span>&nbsp;<span class="string" id="3497539">&#34;\\\&#34;&#34;</span><span class="op" id="3497545">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3497548">func</span>&nbsp;<span class="ident" id="3497553">escapeQuotes</span><span class="op" id="3497565">(</span><span class="ident" id="3497566">s</span>&nbsp;<span class="builtintype" id="3497568">string</span><span class="op" id="3497574">)</span>&nbsp;<span class="builtintype" id="3497576">string</span>&nbsp;<span class="op" id="3497583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497586">return</span>&nbsp;<span class="ident" id="3497593">quoteEscaper</span><span class="op" id="3497605">.</span><span class="ident" id="3497606">Replace</span><span class="op" id="3497613">(</span><span class="ident" id="3497614">s</span><span class="op" id="3497615">)</span><br>
<span class="lineno"></span><span class="op" id="3497617">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3497620">//&nbsp;CreateFormFile&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;around&nbsp;CreatePart.&nbsp;It&nbsp;creates</span><br>
<span class="lineno"></span><span class="comment" id="3497693">//&nbsp;a&nbsp;new&nbsp;form-data&nbsp;header&nbsp;with&nbsp;the&nbsp;provided&nbsp;field&nbsp;name&nbsp;and&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3497763">func</span>&nbsp;<span class="op" id="3497768">(</span><span class="ident" id="3497769">w</span>&nbsp;<span class="op" id="3497771">*</span><span class="ident" id="3497772">Writer</span><span class="op" id="3497778">)</span>&nbsp;<span class="ident" id="3497780">CreateFormFile</span><span class="op" id="3497794">(</span><span class="ident" id="3497795">fieldname</span><span class="op" id="3497804">,</span>&nbsp;<span class="ident" id="3497806">filename</span>&nbsp;<span class="builtintype" id="3497815">string</span><span class="op" id="3497821">)</span>&nbsp;<span class="op" id="3497823">(</span><span class="ident" id="3497824">io</span><span class="op" id="3497826">.</span><span class="ident" id="3497827">Writer</span><span class="op" id="3497833">,</span>&nbsp;<span class="builtintype" id="3497835">error</span><span class="op" id="3497840">)</span>&nbsp;<span class="op" id="3497842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497845">h</span>&nbsp;<span class="op" id="3497847">:=</span>&nbsp;<span class="builtinfunc" id="3497850">make</span><span class="op" id="3497854">(</span><span class="ident" id="3497855">textproto</span><span class="op" id="3497864">.</span><span class="ident" id="3497865">MIMEHeader</span><span class="op" id="3497875">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497878">h</span><span class="op" id="3497879">.</span><span class="ident" id="3497880">Set</span><span class="op" id="3497883">(</span><span class="string" id="3497884">&#34;Content-Disposition&#34;</span><span class="op" id="3497905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497909">fmt</span><span class="op" id="3497912">.</span><span class="ident" id="3497913">Sprintf</span><span class="op" id="3497920">(</span><span class="string" id="3497921">`form-data;&nbsp;name=&#34;%s&#34;;&nbsp;filename=&#34;%s&#34;`</span><span class="op" id="3497958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497963">escapeQuotes</span><span class="op" id="3497975">(</span><span class="ident" id="3497976">fieldname</span><span class="op" id="3497985">)</span><span class="op" id="3497986">,</span>&nbsp;<span class="ident" id="3497988">escapeQuotes</span><span class="op" id="3498000">(</span><span class="ident" id="3498001">filename</span><span class="op" id="3498009">)</span><span class="op" id="3498010">)</span><span class="op" id="3498011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498014">h</span><span class="op" id="3498015">.</span><span class="ident" id="3498016">Set</span><span class="op" id="3498019">(</span><span class="string" id="3498020">&#34;Content-Type&#34;</span><span class="op" id="3498034">,</span>&nbsp;<span class="string" id="3498036">&#34;application/octet-stream&#34;</span><span class="op" id="3498062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498065">return</span>&nbsp;<span class="ident" id="3498072">w</span><span class="op" id="3498073">.</span><span class="ident" id="3498074">CreatePart</span><span class="op" id="3498084">(</span><span class="ident" id="3498085">h</span><span class="op" id="3498086">)</span><br>
<span class="lineno">130</span><span class="op" id="3498088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3498091">//&nbsp;CreateFormField&nbsp;calls&nbsp;CreatePart&nbsp;with&nbsp;a&nbsp;header&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3498151">//&nbsp;given&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3498172">func</span>&nbsp;<span class="op" id="3498177">(</span><span class="ident" id="3498178">w</span>&nbsp;<span class="op" id="3498180">*</span><span class="ident" id="3498181">Writer</span><span class="op" id="3498187">)</span>&nbsp;<span class="ident" id="3498189">CreateFormField</span><span class="op" id="3498204">(</span><span class="ident" id="3498205">fieldname</span>&nbsp;<span class="builtintype" id="3498215">string</span><span class="op" id="3498221">)</span>&nbsp;<span class="op" id="3498223">(</span><span class="ident" id="3498224">io</span><span class="op" id="3498226">.</span><span class="ident" id="3498227">Writer</span><span class="op" id="3498233">,</span>&nbsp;<span class="builtintype" id="3498235">error</span><span class="op" id="3498240">)</span>&nbsp;<span class="op" id="3498242">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498245">h</span>&nbsp;<span class="op" id="3498247">:=</span>&nbsp;<span class="builtinfunc" id="3498250">make</span><span class="op" id="3498254">(</span><span class="ident" id="3498255">textproto</span><span class="op" id="3498264">.</span><span class="ident" id="3498265">MIMEHeader</span><span class="op" id="3498275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498278">h</span><span class="op" id="3498279">.</span><span class="ident" id="3498280">Set</span><span class="op" id="3498283">(</span><span class="string" id="3498284">&#34;Content-Disposition&#34;</span><span class="op" id="3498305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498309">fmt</span><span class="op" id="3498312">.</span><span class="ident" id="3498313">Sprintf</span><span class="op" id="3498320">(</span><span class="string" id="3498321">`form-data;&nbsp;name=&#34;%s&#34;`</span><span class="op" id="3498343">,</span>&nbsp;<span class="ident" id="3498345">escapeQuotes</span><span class="op" id="3498357">(</span><span class="ident" id="3498358">fieldname</span><span class="op" id="3498367">)</span><span class="op" id="3498368">)</span><span class="op" id="3498369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498372">return</span>&nbsp;<span class="ident" id="3498379">w</span><span class="op" id="3498380">.</span><span class="ident" id="3498381">CreatePart</span><span class="op" id="3498391">(</span><span class="ident" id="3498392">h</span><span class="op" id="3498393">)</span><br>
<span class="lineno"></span><span class="op" id="3498395">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="3498398">//&nbsp;WriteField&nbsp;calls&nbsp;CreateFormField&nbsp;and&nbsp;then&nbsp;writes&nbsp;the&nbsp;given&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3498467">func</span>&nbsp;<span class="op" id="3498472">(</span><span class="ident" id="3498473">w</span>&nbsp;<span class="op" id="3498475">*</span><span class="ident" id="3498476">Writer</span><span class="op" id="3498482">)</span>&nbsp;<span class="ident" id="3498484">WriteField</span><span class="op" id="3498494">(</span><span class="ident" id="3498495">fieldname</span><span class="op" id="3498504">,</span>&nbsp;<span class="ident" id="3498506">value</span>&nbsp;<span class="builtintype" id="3498512">string</span><span class="op" id="3498518">)</span>&nbsp;<span class="builtintype" id="3498520">error</span>&nbsp;<span class="op" id="3498526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498529">p</span><span class="op" id="3498530">,</span>&nbsp;<span class="ident" id="3498532">err</span>&nbsp;<span class="op" id="3498536">:=</span>&nbsp;<span class="ident" id="3498539">w</span><span class="op" id="3498540">.</span><span class="ident" id="3498541">CreateFormField</span><span class="op" id="3498556">(</span><span class="ident" id="3498557">fieldname</span><span class="op" id="3498566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498569">if</span>&nbsp;<span class="ident" id="3498572">err</span>&nbsp;<span class="op" id="3498576">!=</span>&nbsp;<span class="builtintype" id="3498579">nil</span>&nbsp;<span class="op" id="3498583">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498587">return</span>&nbsp;<span class="ident" id="3498594">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3498599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498602">_</span><span class="op" id="3498603">,</span>&nbsp;<span class="ident" id="3498605">err</span>&nbsp;<span class="op" id="3498609">=</span>&nbsp;<span class="ident" id="3498611">p</span><span class="op" id="3498612">.</span><span class="ident" id="3498613">Write</span><span class="op" id="3498618">(</span><span class="op" id="3498619">[</span><span class="op" id="3498620">]</span><span class="builtintype" id="3498621">byte</span><span class="op" id="3498625">(</span><span class="ident" id="3498626">value</span><span class="op" id="3498631">)</span><span class="op" id="3498632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498635">return</span>&nbsp;<span class="ident" id="3498642">err</span><br>
<span class="lineno"></span><span class="op" id="3498646">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="3498649">//&nbsp;Close&nbsp;finishes&nbsp;the&nbsp;multipart&nbsp;message&nbsp;and&nbsp;writes&nbsp;the&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3498713">//&nbsp;boundary&nbsp;end&nbsp;line&nbsp;to&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="3498749">func</span>&nbsp;<span class="op" id="3498754">(</span><span class="ident" id="3498755">w</span>&nbsp;<span class="op" id="3498757">*</span><span class="ident" id="3498758">Writer</span><span class="op" id="3498764">)</span>&nbsp;<span class="ident" id="3498766">Close</span><span class="op" id="3498771">(</span><span class="op" id="3498772">)</span>&nbsp;<span class="builtintype" id="3498774">error</span>&nbsp;<span class="op" id="3498780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498783">if</span>&nbsp;<span class="ident" id="3498786">w</span><span class="op" id="3498787">.</span><span class="ident" id="3498788">lastpart</span>&nbsp;<span class="op" id="3498797">!=</span>&nbsp;<span class="builtintype" id="3498800">nil</span>&nbsp;<span class="op" id="3498804">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498808">if</span>&nbsp;<span class="ident" id="3498811">err</span>&nbsp;<span class="op" id="3498815">:=</span>&nbsp;<span class="ident" id="3498818">w</span><span class="op" id="3498819">.</span><span class="ident" id="3498820">lastpart</span><span class="op" id="3498828">.</span><span class="builtinfunc" id="3498829">close</span><span class="op" id="3498834">(</span><span class="op" id="3498835">)</span><span class="op" id="3498836">;</span>&nbsp;<span class="ident" id="3498838">err</span>&nbsp;<span class="op" id="3498842">!=</span>&nbsp;<span class="builtintype" id="3498845">nil</span>&nbsp;<span class="op" id="3498849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498854">return</span>&nbsp;<span class="ident" id="3498861">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3498867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498871">w</span><span class="op" id="3498872">.</span><span class="ident" id="3498873">lastpart</span>&nbsp;<span class="op" id="3498882">=</span>&nbsp;<span class="builtintype" id="3498884">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3498889">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498892">_</span><span class="op" id="3498893">,</span>&nbsp;<span class="ident" id="3498895">err</span>&nbsp;<span class="op" id="3498899">:=</span>&nbsp;<span class="ident" id="3498902">fmt</span><span class="op" id="3498905">.</span><span class="ident" id="3498906">Fprintf</span><span class="op" id="3498913">(</span><span class="ident" id="3498914">w</span><span class="op" id="3498915">.</span><span class="ident" id="3498916">w</span><span class="op" id="3498917">,</span>&nbsp;<span class="string" id="3498919">&#34;\r\n--%s--\r\n&#34;</span><span class="op" id="3498935">,</span>&nbsp;<span class="ident" id="3498937">w</span><span class="op" id="3498938">.</span><span class="ident" id="3498939">boundary</span><span class="op" id="3498947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498950">return</span>&nbsp;<span class="ident" id="3498957">err</span><br>
<span class="lineno"></span><span class="op" id="3498961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3498964">type</span>&nbsp;<span class="ident" id="3498969">part</span>&nbsp;<span class="keyword" id="3498974">struct</span>&nbsp;<span class="op" id="3498981">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498984">mw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3498991">*</span><span class="ident" id="3498992">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499000">closed</span>&nbsp;<span class="builtintype" id="3499007">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499013">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3499020">error</span>&nbsp;<span class="comment" id="3499026">//&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;writing</span><br>
<span class="lineno"></span><span class="op" id="3499062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3499065">func</span>&nbsp;<span class="op" id="3499070">(</span><span class="ident" id="3499071">p</span>&nbsp;<span class="op" id="3499073">*</span><span class="ident" id="3499074">part</span><span class="op" id="3499078">)</span>&nbsp;<span class="builtinfunc" id="3499080">close</span><span class="op" id="3499085">(</span><span class="op" id="3499086">)</span>&nbsp;<span class="builtintype" id="3499088">error</span>&nbsp;<span class="op" id="3499094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499097">p</span><span class="op" id="3499098">.</span><span class="ident" id="3499099">closed</span>&nbsp;<span class="op" id="3499106">=</span>&nbsp;<span class="builtintype" id="3499108">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499114">return</span>&nbsp;<span class="ident" id="3499121">p</span><span class="op" id="3499122">.</span><span class="ident" id="3499123">we</span><br>
<span class="lineno"></span><span class="op" id="3499126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="3499129">func</span>&nbsp;<span class="op" id="3499134">(</span><span class="ident" id="3499135">p</span>&nbsp;<span class="op" id="3499137">*</span><span class="ident" id="3499138">part</span><span class="op" id="3499142">)</span>&nbsp;<span class="ident" id="3499144">Write</span><span class="op" id="3499149">(</span><span class="ident" id="3499150">d</span>&nbsp;<span class="op" id="3499152">[</span><span class="op" id="3499153">]</span><span class="builtintype" id="3499154">byte</span><span class="op" id="3499158">)</span>&nbsp;<span class="op" id="3499160">(</span><span class="ident" id="3499161">n</span>&nbsp;<span class="builtintype" id="3499163">int</span><span class="op" id="3499166">,</span>&nbsp;<span class="ident" id="3499168">err</span>&nbsp;<span class="builtintype" id="3499172">error</span><span class="op" id="3499177">)</span>&nbsp;<span class="op" id="3499179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499182">if</span>&nbsp;<span class="ident" id="3499185">p</span><span class="op" id="3499186">.</span><span class="ident" id="3499187">closed</span>&nbsp;<span class="op" id="3499194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499198">return</span>&nbsp;<span class="num" id="3499205">0</span><span class="op" id="3499206">,</span>&nbsp;<span class="ident" id="3499208">errors</span><span class="op" id="3499214">.</span><span class="ident" id="3499215">New</span><span class="op" id="3499218">(</span><span class="string" id="3499219">&#34;multipart:&nbsp;can&#39;t&nbsp;write&nbsp;to&nbsp;finished&nbsp;part&#34;</span><span class="op" id="3499260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3499263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499266">n</span><span class="op" id="3499267">,</span>&nbsp;<span class="ident" id="3499269">err</span>&nbsp;<span class="op" id="3499273">=</span>&nbsp;<span class="ident" id="3499275">p</span><span class="op" id="3499276">.</span><span class="ident" id="3499277">mw</span><span class="op" id="3499279">.</span><span class="ident" id="3499280">w</span><span class="op" id="3499281">.</span><span class="ident" id="3499282">Write</span><span class="op" id="3499287">(</span><span class="ident" id="3499288">d</span><span class="op" id="3499289">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499292">if</span>&nbsp;<span class="ident" id="3499295">err</span>&nbsp;<span class="op" id="3499299">!=</span>&nbsp;<span class="builtintype" id="3499302">nil</span>&nbsp;<span class="op" id="3499306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499310">p</span><span class="op" id="3499311">.</span><span class="ident" id="3499312">we</span>&nbsp;<span class="op" id="3499315">=</span>&nbsp;<span class="ident" id="3499317">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3499322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499325">return</span><br>
<span class="lineno"></span><span class="op" id="3499332">}</span>
</div>
</body>
</html>
