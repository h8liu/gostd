<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7675261">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7675316">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7675370">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7675421">package</span>&nbsp;<span class="ident" id="7675429">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7675434">import</span>&nbsp;<span class="op" id="7675441">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7675444">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7675454">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7675461">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7675467">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7675474">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7675481">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7675502">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7675513">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7675524">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7675532">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7675547">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7675558">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="7675565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7675568">var</span>&nbsp;<span class="op" id="7675572">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675575">newServer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7675601">*</span><span class="ident" id="7675602">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675610">serverAddr</span><span class="op" id="7675620">,</span>&nbsp;<span class="ident" id="7675622">newServerAddr</span>&nbsp;<span class="builtintype" id="7675636">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675644">httpServerAddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7675670">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675678">once</span><span class="op" id="7675682">,</span>&nbsp;<span class="ident" id="7675684">newOnce</span><span class="op" id="7675691">,</span>&nbsp;<span class="ident" id="7675693">httpOnce</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7675704">sync</span><span class="op" id="7675708">.</span><span class="ident" id="7675709">Once</span><br>
<span class="lineno"></span><span class="op" id="7675714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7675717">const</span>&nbsp;<span class="op" id="7675723">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675726">newHttpPath</span>&nbsp;<span class="op" id="7675738">=</span>&nbsp;<span class="string" id="7675740">&#34;/foo&#34;</span><br>
<span class="lineno"></span><span class="op" id="7675747">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7675750">type</span>&nbsp;<span class="ident" id="7675755">Args</span>&nbsp;<span class="keyword" id="7675760">struct</span>&nbsp;<span class="op" id="7675767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675770">A</span><span class="op" id="7675771">,</span>&nbsp;<span class="ident" id="7675773">B</span>&nbsp;<span class="builtintype" id="7675775">int</span><br>
<span class="lineno">35</span><span class="op" id="7675779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7675782">type</span>&nbsp;<span class="ident" id="7675787">Reply</span>&nbsp;<span class="keyword" id="7675793">struct</span>&nbsp;<span class="op" id="7675800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675803">C</span>&nbsp;<span class="builtintype" id="7675805">int</span><br>
<span class="lineno"></span><span class="op" id="7675809">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7675812">type</span>&nbsp;<span class="ident" id="7675817">Arith</span>&nbsp;<span class="builtintype" id="7675823">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7675828">//&nbsp;Some&nbsp;of&nbsp;Arith&#39;s&nbsp;methods&nbsp;have&nbsp;value&nbsp;args,&nbsp;some&nbsp;have&nbsp;pointer&nbsp;args.&nbsp;That&#39;s&nbsp;deliberate.</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="7675916">func</span>&nbsp;<span class="op" id="7675921">(</span><span class="ident" id="7675922">t</span>&nbsp;<span class="op" id="7675924">*</span><span class="ident" id="7675925">Arith</span><span class="op" id="7675930">)</span>&nbsp;<span class="ident" id="7675932">Add</span><span class="op" id="7675935">(</span><span class="ident" id="7675936">args</span>&nbsp;<span class="ident" id="7675941">Args</span><span class="op" id="7675945">,</span>&nbsp;<span class="ident" id="7675947">reply</span>&nbsp;<span class="op" id="7675953">*</span><span class="ident" id="7675954">Reply</span><span class="op" id="7675959">)</span>&nbsp;<span class="builtintype" id="7675961">error</span>&nbsp;<span class="op" id="7675967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7675970">reply</span><span class="op" id="7675975">.</span><span class="ident" id="7675976">C</span>&nbsp;<span class="op" id="7675978">=</span>&nbsp;<span class="ident" id="7675980">args</span><span class="op" id="7675984">.</span><span class="ident" id="7675985">A</span>&nbsp;<span class="op" id="7675987">+</span>&nbsp;<span class="ident" id="7675989">args</span><span class="op" id="7675993">.</span><span class="ident" id="7675994">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7675997">return</span>&nbsp;<span class="ident" id="7676004">nil</span><br>
<span class="lineno"></span><span class="op" id="7676008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7676011">func</span>&nbsp;<span class="op" id="7676016">(</span><span class="ident" id="7676017">t</span>&nbsp;<span class="op" id="7676019">*</span><span class="ident" id="7676020">Arith</span><span class="op" id="7676025">)</span>&nbsp;<span class="ident" id="7676027">Mul</span><span class="op" id="7676030">(</span><span class="ident" id="7676031">args</span>&nbsp;<span class="op" id="7676036">*</span><span class="ident" id="7676037">Args</span><span class="op" id="7676041">,</span>&nbsp;<span class="ident" id="7676043">reply</span>&nbsp;<span class="op" id="7676049">*</span><span class="ident" id="7676050">Reply</span><span class="op" id="7676055">)</span>&nbsp;<span class="builtintype" id="7676057">error</span>&nbsp;<span class="op" id="7676063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676066">reply</span><span class="op" id="7676071">.</span><span class="ident" id="7676072">C</span>&nbsp;<span class="op" id="7676074">=</span>&nbsp;<span class="ident" id="7676076">args</span><span class="op" id="7676080">.</span><span class="ident" id="7676081">A</span>&nbsp;<span class="op" id="7676083">*</span>&nbsp;<span class="ident" id="7676085">args</span><span class="op" id="7676089">.</span><span class="ident" id="7676090">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676093">return</span>&nbsp;<span class="ident" id="7676100">nil</span><br>
<span class="lineno"></span><span class="op" id="7676104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7676107">func</span>&nbsp;<span class="op" id="7676112">(</span><span class="ident" id="7676113">t</span>&nbsp;<span class="op" id="7676115">*</span><span class="ident" id="7676116">Arith</span><span class="op" id="7676121">)</span>&nbsp;<span class="ident" id="7676123">Div</span><span class="op" id="7676126">(</span><span class="ident" id="7676127">args</span>&nbsp;<span class="ident" id="7676132">Args</span><span class="op" id="7676136">,</span>&nbsp;<span class="ident" id="7676138">reply</span>&nbsp;<span class="op" id="7676144">*</span><span class="ident" id="7676145">Reply</span><span class="op" id="7676150">)</span>&nbsp;<span class="builtintype" id="7676152">error</span>&nbsp;<span class="op" id="7676158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676161">if</span>&nbsp;<span class="ident" id="7676164">args</span><span class="op" id="7676168">.</span><span class="ident" id="7676169">B</span>&nbsp;<span class="op" id="7676171">==</span>&nbsp;<span class="num" id="7676174">0</span>&nbsp;<span class="op" id="7676176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676180">return</span>&nbsp;<span class="ident" id="7676187">errors</span><span class="op" id="7676193">.</span><span class="ident" id="7676194">New</span><span class="op" id="7676197">(</span><span class="string" id="7676198">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="7676214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7676217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676220">reply</span><span class="op" id="7676225">.</span><span class="ident" id="7676226">C</span>&nbsp;<span class="op" id="7676228">=</span>&nbsp;<span class="ident" id="7676230">args</span><span class="op" id="7676234">.</span><span class="ident" id="7676235">A</span>&nbsp;<span class="op" id="7676237">/</span>&nbsp;<span class="ident" id="7676239">args</span><span class="op" id="7676243">.</span><span class="ident" id="7676244">B</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676247">return</span>&nbsp;<span class="ident" id="7676254">nil</span><br>
<span class="lineno"></span><span class="op" id="7676258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7676261">func</span>&nbsp;<span class="op" id="7676266">(</span><span class="ident" id="7676267">t</span>&nbsp;<span class="op" id="7676269">*</span><span class="ident" id="7676270">Arith</span><span class="op" id="7676275">)</span>&nbsp;<span class="ident" id="7676277">String</span><span class="op" id="7676283">(</span><span class="ident" id="7676284">args</span>&nbsp;<span class="op" id="7676289">*</span><span class="ident" id="7676290">Args</span><span class="op" id="7676294">,</span>&nbsp;<span class="ident" id="7676296">reply</span>&nbsp;<span class="op" id="7676302">*</span><span class="builtintype" id="7676303">string</span><span class="op" id="7676309">)</span>&nbsp;<span class="builtintype" id="7676311">error</span>&nbsp;<span class="op" id="7676317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7676320">*</span><span class="ident" id="7676321">reply</span>&nbsp;<span class="op" id="7676327">=</span>&nbsp;<span class="ident" id="7676329">fmt</span><span class="op" id="7676332">.</span><span class="ident" id="7676333">Sprintf</span><span class="op" id="7676340">(</span><span class="string" id="7676341">&#34;%d+%d=%d&#34;</span><span class="op" id="7676351">,</span>&nbsp;<span class="ident" id="7676353">args</span><span class="op" id="7676357">.</span><span class="ident" id="7676358">A</span><span class="op" id="7676359">,</span>&nbsp;<span class="ident" id="7676361">args</span><span class="op" id="7676365">.</span><span class="ident" id="7676366">B</span><span class="op" id="7676367">,</span>&nbsp;<span class="ident" id="7676369">args</span><span class="op" id="7676373">.</span><span class="ident" id="7676374">A</span><span class="op" id="7676375">+</span><span class="ident" id="7676376">args</span><span class="op" id="7676380">.</span><span class="ident" id="7676381">B</span><span class="op" id="7676382">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676385">return</span>&nbsp;<span class="ident" id="7676392">nil</span><br>
<span class="lineno"></span><span class="op" id="7676396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7676399">func</span>&nbsp;<span class="op" id="7676404">(</span><span class="ident" id="7676405">t</span>&nbsp;<span class="op" id="7676407">*</span><span class="ident" id="7676408">Arith</span><span class="op" id="7676413">)</span>&nbsp;<span class="ident" id="7676415">Scan</span><span class="op" id="7676419">(</span><span class="ident" id="7676420">args</span>&nbsp;<span class="builtintype" id="7676425">string</span><span class="op" id="7676431">,</span>&nbsp;<span class="ident" id="7676433">reply</span>&nbsp;<span class="op" id="7676439">*</span><span class="ident" id="7676440">Reply</span><span class="op" id="7676445">)</span>&nbsp;<span class="op" id="7676447">(</span><span class="ident" id="7676448">err</span>&nbsp;<span class="builtintype" id="7676452">error</span><span class="op" id="7676457">)</span>&nbsp;<span class="op" id="7676459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676462">_</span><span class="op" id="7676463">,</span>&nbsp;<span class="ident" id="7676465">err</span>&nbsp;<span class="op" id="7676469">=</span>&nbsp;<span class="ident" id="7676471">fmt</span><span class="op" id="7676474">.</span><span class="ident" id="7676475">Sscan</span><span class="op" id="7676480">(</span><span class="ident" id="7676481">args</span><span class="op" id="7676485">,</span>&nbsp;<span class="op" id="7676487">&amp;</span><span class="ident" id="7676488">reply</span><span class="op" id="7676493">.</span><span class="ident" id="7676494">C</span><span class="op" id="7676495">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676498">return</span><br>
<span class="lineno"></span><span class="op" id="7676505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7676508">func</span>&nbsp;<span class="op" id="7676513">(</span><span class="ident" id="7676514">t</span>&nbsp;<span class="op" id="7676516">*</span><span class="ident" id="7676517">Arith</span><span class="op" id="7676522">)</span>&nbsp;<span class="ident" id="7676524">Error</span><span class="op" id="7676529">(</span><span class="ident" id="7676530">args</span>&nbsp;<span class="op" id="7676535">*</span><span class="ident" id="7676536">Args</span><span class="op" id="7676540">,</span>&nbsp;<span class="ident" id="7676542">reply</span>&nbsp;<span class="op" id="7676548">*</span><span class="ident" id="7676549">Reply</span><span class="op" id="7676554">)</span>&nbsp;<span class="builtintype" id="7676556">error</span>&nbsp;<span class="op" id="7676562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7676565">panic</span><span class="op" id="7676570">(</span><span class="string" id="7676571">&#34;ERROR&#34;</span><span class="op" id="7676578">)</span><br>
<span class="lineno">75</span><span class="op" id="7676580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7676583">func</span>&nbsp;<span class="ident" id="7676588">listenTCP</span><span class="op" id="7676597">(</span><span class="op" id="7676598">)</span>&nbsp;<span class="op" id="7676600">(</span><span class="ident" id="7676601">net</span><span class="op" id="7676604">.</span><span class="ident" id="7676605">Listener</span><span class="op" id="7676613">,</span>&nbsp;<span class="builtintype" id="7676615">string</span><span class="op" id="7676621">)</span>&nbsp;<span class="op" id="7676623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676626">l</span><span class="op" id="7676627">,</span>&nbsp;<span class="ident" id="7676629">e</span>&nbsp;<span class="op" id="7676631">:=</span>&nbsp;<span class="ident" id="7676634">net</span><span class="op" id="7676637">.</span><span class="ident" id="7676638">Listen</span><span class="op" id="7676644">(</span><span class="string" id="7676645">&#34;tcp&#34;</span><span class="op" id="7676650">,</span>&nbsp;<span class="string" id="7676652">&#34;127.0.0.1:0&#34;</span><span class="op" id="7676665">)</span>&nbsp;<span class="comment" id="7676667">//&nbsp;any&nbsp;available&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676693">if</span>&nbsp;<span class="ident" id="7676696">e</span>&nbsp;<span class="op" id="7676698">!=</span>&nbsp;<span class="ident" id="7676701">nil</span>&nbsp;<span class="op" id="7676705">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676709">log</span><span class="op" id="7676712">.</span><span class="ident" id="7676713">Fatalf</span><span class="op" id="7676719">(</span><span class="string" id="7676720">&#34;net.Listen&nbsp;tcp&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="7676743">,</span>&nbsp;<span class="ident" id="7676745">e</span><span class="op" id="7676746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7676749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676752">return</span>&nbsp;<span class="ident" id="7676759">l</span><span class="op" id="7676760">,</span>&nbsp;<span class="ident" id="7676762">l</span><span class="op" id="7676763">.</span><span class="ident" id="7676764">Addr</span><span class="op" id="7676768">(</span><span class="op" id="7676769">)</span><span class="op" id="7676770">.</span><span class="ident" id="7676771">String</span><span class="op" id="7676777">(</span><span class="op" id="7676778">)</span><br>
<span class="lineno"></span><span class="op" id="7676780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="7676783">func</span>&nbsp;<span class="ident" id="7676788">startServer</span><span class="op" id="7676799">(</span><span class="op" id="7676800">)</span>&nbsp;<span class="op" id="7676802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676805">Register</span><span class="op" id="7676813">(</span><span class="builtinfunc" id="7676814">new</span><span class="op" id="7676817">(</span><span class="ident" id="7676818">Arith</span><span class="op" id="7676823">)</span><span class="op" id="7676824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676827">RegisterName</span><span class="op" id="7676839">(</span><span class="string" id="7676840">&#34;net.rpc.Arith&#34;</span><span class="op" id="7676855">,</span>&nbsp;<span class="builtinfunc" id="7676857">new</span><span class="op" id="7676860">(</span><span class="ident" id="7676861">Arith</span><span class="op" id="7676866">)</span><span class="op" id="7676867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676871">var</span>&nbsp;<span class="ident" id="7676875">l</span>&nbsp;<span class="ident" id="7676877">net</span><span class="op" id="7676880">.</span><span class="ident" id="7676881">Listener</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676891">l</span><span class="op" id="7676892">,</span>&nbsp;<span class="ident" id="7676894">serverAddr</span>&nbsp;<span class="op" id="7676905">=</span>&nbsp;<span class="ident" id="7676907">listenTCP</span><span class="op" id="7676916">(</span><span class="op" id="7676917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676920">log</span><span class="op" id="7676923">.</span><span class="ident" id="7676924">Println</span><span class="op" id="7676931">(</span><span class="string" id="7676932">&#34;Test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="7676962">,</span>&nbsp;<span class="ident" id="7676964">serverAddr</span><span class="op" id="7676974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7676977">go</span>&nbsp;<span class="ident" id="7676980">Accept</span><span class="op" id="7676986">(</span><span class="ident" id="7676987">l</span><span class="op" id="7676988">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7676992">HandleHTTP</span><span class="op" id="7677002">(</span><span class="op" id="7677003">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677006">httpOnce</span><span class="op" id="7677014">.</span><span class="ident" id="7677015">Do</span><span class="op" id="7677017">(</span><span class="ident" id="7677018">startHttpServer</span><span class="op" id="7677033">)</span><br>
<span class="lineno"></span><span class="op" id="7677035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7677038">func</span>&nbsp;<span class="ident" id="7677043">startNewServer</span><span class="op" id="7677057">(</span><span class="op" id="7677058">)</span>&nbsp;<span class="op" id="7677060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677063">newServer</span>&nbsp;<span class="op" id="7677073">=</span>&nbsp;<span class="ident" id="7677075">NewServer</span><span class="op" id="7677084">(</span><span class="op" id="7677085">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677088">newServer</span><span class="op" id="7677097">.</span><span class="ident" id="7677098">Register</span><span class="op" id="7677106">(</span><span class="builtinfunc" id="7677107">new</span><span class="op" id="7677110">(</span><span class="ident" id="7677111">Arith</span><span class="op" id="7677116">)</span><span class="op" id="7677117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677120">newServer</span><span class="op" id="7677129">.</span><span class="ident" id="7677130">RegisterName</span><span class="op" id="7677142">(</span><span class="string" id="7677143">&#34;net.rpc.Arith&#34;</span><span class="op" id="7677158">,</span>&nbsp;<span class="builtinfunc" id="7677160">new</span><span class="op" id="7677163">(</span><span class="ident" id="7677164">Arith</span><span class="op" id="7677169">)</span><span class="op" id="7677170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677173">newServer</span><span class="op" id="7677182">.</span><span class="ident" id="7677183">RegisterName</span><span class="op" id="7677195">(</span><span class="string" id="7677196">&#34;newServer.Arith&#34;</span><span class="op" id="7677213">,</span>&nbsp;<span class="builtinfunc" id="7677215">new</span><span class="op" id="7677218">(</span><span class="ident" id="7677219">Arith</span><span class="op" id="7677224">)</span><span class="op" id="7677225">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677229">var</span>&nbsp;<span class="ident" id="7677233">l</span>&nbsp;<span class="ident" id="7677235">net</span><span class="op" id="7677238">.</span><span class="ident" id="7677239">Listener</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677249">l</span><span class="op" id="7677250">,</span>&nbsp;<span class="ident" id="7677252">newServerAddr</span>&nbsp;<span class="op" id="7677266">=</span>&nbsp;<span class="ident" id="7677268">listenTCP</span><span class="op" id="7677277">(</span><span class="op" id="7677278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677281">log</span><span class="op" id="7677284">.</span><span class="ident" id="7677285">Println</span><span class="op" id="7677292">(</span><span class="string" id="7677293">&#34;NewServer&nbsp;test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="7677333">,</span>&nbsp;<span class="ident" id="7677335">newServerAddr</span><span class="op" id="7677348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677351">go</span>&nbsp;<span class="ident" id="7677354">newServer</span><span class="op" id="7677363">.</span><span class="ident" id="7677364">Accept</span><span class="op" id="7677370">(</span><span class="ident" id="7677371">l</span><span class="op" id="7677372">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677376">newServer</span><span class="op" id="7677385">.</span><span class="ident" id="7677386">HandleHTTP</span><span class="op" id="7677396">(</span><span class="ident" id="7677397">newHttpPath</span><span class="op" id="7677408">,</span>&nbsp;<span class="string" id="7677410">&#34;/bar&#34;</span><span class="op" id="7677416">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677419">httpOnce</span><span class="op" id="7677427">.</span><span class="ident" id="7677428">Do</span><span class="op" id="7677430">(</span><span class="ident" id="7677431">startHttpServer</span><span class="op" id="7677446">)</span><br>
<span class="lineno"></span><span class="op" id="7677448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7677451">func</span>&nbsp;<span class="ident" id="7677456">startHttpServer</span><span class="op" id="7677471">(</span><span class="op" id="7677472">)</span>&nbsp;<span class="op" id="7677474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677477">server</span>&nbsp;<span class="op" id="7677484">:=</span>&nbsp;<span class="ident" id="7677487">httptest</span><span class="op" id="7677495">.</span><span class="ident" id="7677496">NewServer</span><span class="op" id="7677505">(</span><span class="ident" id="7677506">nil</span><span class="op" id="7677509">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677512">httpServerAddr</span>&nbsp;<span class="op" id="7677527">=</span>&nbsp;<span class="ident" id="7677529">server</span><span class="op" id="7677535">.</span><span class="ident" id="7677536">Listener</span><span class="op" id="7677544">.</span><span class="ident" id="7677545">Addr</span><span class="op" id="7677549">(</span><span class="op" id="7677550">)</span><span class="op" id="7677551">.</span><span class="ident" id="7677552">String</span><span class="op" id="7677558">(</span><span class="op" id="7677559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677562">log</span><span class="op" id="7677565">.</span><span class="ident" id="7677566">Println</span><span class="op" id="7677573">(</span><span class="string" id="7677574">&#34;Test&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="7677609">,</span>&nbsp;<span class="ident" id="7677611">httpServerAddr</span><span class="op" id="7677625">)</span><br>
<span class="lineno"></span><span class="op" id="7677627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7677630">func</span>&nbsp;<span class="ident" id="7677635">TestRPC</span><span class="op" id="7677642">(</span><span class="ident" id="7677643">t</span>&nbsp;<span class="op" id="7677645">*</span><span class="ident" id="7677646">testing</span><span class="op" id="7677653">.</span><span class="ident" id="7677654">T</span><span class="op" id="7677655">)</span>&nbsp;<span class="op" id="7677657">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677660">once</span><span class="op" id="7677664">.</span><span class="ident" id="7677665">Do</span><span class="op" id="7677667">(</span><span class="ident" id="7677668">startServer</span><span class="op" id="7677679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677682">testRPC</span><span class="op" id="7677689">(</span><span class="ident" id="7677690">t</span><span class="op" id="7677691">,</span>&nbsp;<span class="ident" id="7677693">serverAddr</span><span class="op" id="7677703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677706">newOnce</span><span class="op" id="7677713">.</span><span class="ident" id="7677714">Do</span><span class="op" id="7677716">(</span><span class="ident" id="7677717">startNewServer</span><span class="op" id="7677731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677734">testRPC</span><span class="op" id="7677741">(</span><span class="ident" id="7677742">t</span><span class="op" id="7677743">,</span>&nbsp;<span class="ident" id="7677745">newServerAddr</span><span class="op" id="7677758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677761">testNewServerRPC</span><span class="op" id="7677777">(</span><span class="ident" id="7677778">t</span><span class="op" id="7677779">,</span>&nbsp;<span class="ident" id="7677781">newServerAddr</span><span class="op" id="7677794">)</span><br>
<span class="lineno">125</span><span class="op" id="7677796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7677799">func</span>&nbsp;<span class="ident" id="7677804">testRPC</span><span class="op" id="7677811">(</span><span class="ident" id="7677812">t</span>&nbsp;<span class="op" id="7677814">*</span><span class="ident" id="7677815">testing</span><span class="op" id="7677822">.</span><span class="ident" id="7677823">T</span><span class="op" id="7677824">,</span>&nbsp;<span class="ident" id="7677826">addr</span>&nbsp;<span class="builtintype" id="7677831">string</span><span class="op" id="7677837">)</span>&nbsp;<span class="op" id="7677839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677842">client</span><span class="op" id="7677848">,</span>&nbsp;<span class="ident" id="7677850">err</span>&nbsp;<span class="op" id="7677854">:=</span>&nbsp;<span class="ident" id="7677857">Dial</span><span class="op" id="7677861">(</span><span class="string" id="7677862">&#34;tcp&#34;</span><span class="op" id="7677867">,</span>&nbsp;<span class="ident" id="7677869">addr</span><span class="op" id="7677873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677876">if</span>&nbsp;<span class="ident" id="7677879">err</span>&nbsp;<span class="op" id="7677883">!=</span>&nbsp;<span class="ident" id="7677886">nil</span>&nbsp;<span class="op" id="7677890">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677894">t</span><span class="op" id="7677895">.</span><span class="ident" id="7677896">Fatal</span><span class="op" id="7677901">(</span><span class="string" id="7677902">&#34;dialing&#34;</span><span class="op" id="7677911">,</span>&nbsp;<span class="ident" id="7677913">err</span><span class="op" id="7677916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7677919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7677922">defer</span>&nbsp;<span class="ident" id="7677928">client</span><span class="op" id="7677934">.</span><span class="ident" id="7677935">Close</span><span class="op" id="7677940">(</span><span class="op" id="7677941">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7677945">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677967">args</span>&nbsp;<span class="op" id="7677972">:=</span>&nbsp;<span class="op" id="7677975">&amp;</span><span class="ident" id="7677976">Args</span><span class="op" id="7677980">{</span><span class="num" id="7677981">7</span><span class="op" id="7677982">,</span>&nbsp;<span class="num" id="7677984">8</span><span class="op" id="7677985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7677988">reply</span>&nbsp;<span class="op" id="7677994">:=</span>&nbsp;<span class="builtinfunc" id="7677997">new</span><span class="op" id="7678000">(</span><span class="ident" id="7678001">Reply</span><span class="op" id="7678006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678009">err</span>&nbsp;<span class="op" id="7678013">=</span>&nbsp;<span class="ident" id="7678015">client</span><span class="op" id="7678021">.</span><span class="ident" id="7678022">Call</span><span class="op" id="7678026">(</span><span class="string" id="7678027">&#34;Arith.Add&#34;</span><span class="op" id="7678038">,</span>&nbsp;<span class="ident" id="7678040">args</span><span class="op" id="7678044">,</span>&nbsp;<span class="ident" id="7678046">reply</span><span class="op" id="7678051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7678054">if</span>&nbsp;<span class="ident" id="7678057">err</span>&nbsp;<span class="op" id="7678061">!=</span>&nbsp;<span class="ident" id="7678064">nil</span>&nbsp;<span class="op" id="7678068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678072">t</span><span class="op" id="7678073">.</span><span class="ident" id="7678074">Errorf</span><span class="op" id="7678080">(</span><span class="string" id="7678081">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7678123">,</span>&nbsp;<span class="ident" id="7678125">err</span><span class="op" id="7678128">.</span><span class="ident" id="7678129">Error</span><span class="op" id="7678134">(</span><span class="op" id="7678135">)</span><span class="op" id="7678136">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7678139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7678142">if</span>&nbsp;<span class="ident" id="7678145">reply</span><span class="op" id="7678150">.</span><span class="ident" id="7678151">C</span>&nbsp;<span class="op" id="7678153">!=</span>&nbsp;<span class="ident" id="7678156">args</span><span class="op" id="7678160">.</span><span class="ident" id="7678161">A</span><span class="op" id="7678162">+</span><span class="ident" id="7678163">args</span><span class="op" id="7678167">.</span><span class="ident" id="7678168">B</span>&nbsp;<span class="op" id="7678170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678174">t</span><span class="op" id="7678175">.</span><span class="ident" id="7678176">Errorf</span><span class="op" id="7678182">(</span><span class="string" id="7678183">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7678208">,</span>&nbsp;<span class="ident" id="7678210">reply</span><span class="op" id="7678215">.</span><span class="ident" id="7678216">C</span><span class="op" id="7678217">,</span>&nbsp;<span class="ident" id="7678219">args</span><span class="op" id="7678223">.</span><span class="ident" id="7678224">A</span><span class="op" id="7678225">+</span><span class="ident" id="7678226">args</span><span class="op" id="7678230">.</span><span class="ident" id="7678231">B</span><span class="op" id="7678232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7678235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7678239">//&nbsp;Nonexistent&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678262">args</span>&nbsp;<span class="op" id="7678267">=</span>&nbsp;<span class="op" id="7678269">&amp;</span><span class="ident" id="7678270">Args</span><span class="op" id="7678274">{</span><span class="num" id="7678275">7</span><span class="op" id="7678276">,</span>&nbsp;<span class="num" id="7678278">0</span><span class="op" id="7678279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678282">reply</span>&nbsp;<span class="op" id="7678288">=</span>&nbsp;<span class="builtinfunc" id="7678290">new</span><span class="op" id="7678293">(</span><span class="ident" id="7678294">Reply</span><span class="op" id="7678299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678302">err</span>&nbsp;<span class="op" id="7678306">=</span>&nbsp;<span class="ident" id="7678308">client</span><span class="op" id="7678314">.</span><span class="ident" id="7678315">Call</span><span class="op" id="7678319">(</span><span class="string" id="7678320">&#34;Arith.BadOperation&#34;</span><span class="op" id="7678340">,</span>&nbsp;<span class="ident" id="7678342">args</span><span class="op" id="7678346">,</span>&nbsp;<span class="ident" id="7678348">reply</span><span class="op" id="7678353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7678356">//&nbsp;expect&nbsp;an&nbsp;error</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7678376">if</span>&nbsp;<span class="ident" id="7678379">err</span>&nbsp;<span class="op" id="7678383">==</span>&nbsp;<span class="ident" id="7678386">nil</span>&nbsp;<span class="op" id="7678390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678394">t</span><span class="op" id="7678395">.</span><span class="ident" id="7678396">Error</span><span class="op" id="7678401">(</span><span class="string" id="7678402">&#34;BadOperation:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7678432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7678435">}</span>&nbsp;<span class="keyword" id="7678437">else</span>&nbsp;<span class="keyword" id="7678442">if</span>&nbsp;<span class="op" id="7678445">!</span><span class="ident" id="7678446">strings</span><span class="op" id="7678453">.</span><span class="ident" id="7678454">HasPrefix</span><span class="op" id="7678463">(</span><span class="ident" id="7678464">err</span><span class="op" id="7678467">.</span><span class="ident" id="7678468">Error</span><span class="op" id="7678473">(</span><span class="op" id="7678474">)</span><span class="op" id="7678475">,</span>&nbsp;<span class="string" id="7678477">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span><span class="op" id="7678502">)</span>&nbsp;<span class="op" id="7678504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678508">t</span><span class="op" id="7678509">.</span><span class="ident" id="7678510">Errorf</span><span class="op" id="7678516">(</span><span class="string" id="7678517">&#34;BadOperation:&nbsp;expected&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;error;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7678573">,</span>&nbsp;<span class="ident" id="7678575">err</span><span class="op" id="7678578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7678581">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7678585">//&nbsp;Unknown&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678605">args</span>&nbsp;<span class="op" id="7678610">=</span>&nbsp;<span class="op" id="7678612">&amp;</span><span class="ident" id="7678613">Args</span><span class="op" id="7678617">{</span><span class="num" id="7678618">7</span><span class="op" id="7678619">,</span>&nbsp;<span class="num" id="7678621">8</span><span class="op" id="7678622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678625">reply</span>&nbsp;<span class="op" id="7678631">=</span>&nbsp;<span class="builtinfunc" id="7678633">new</span><span class="op" id="7678636">(</span><span class="ident" id="7678637">Reply</span><span class="op" id="7678642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678645">err</span>&nbsp;<span class="op" id="7678649">=</span>&nbsp;<span class="ident" id="7678651">client</span><span class="op" id="7678657">.</span><span class="ident" id="7678658">Call</span><span class="op" id="7678662">(</span><span class="string" id="7678663">&#34;Arith.Unknown&#34;</span><span class="op" id="7678678">,</span>&nbsp;<span class="ident" id="7678680">args</span><span class="op" id="7678684">,</span>&nbsp;<span class="ident" id="7678686">reply</span><span class="op" id="7678691">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7678694">if</span>&nbsp;<span class="ident" id="7678697">err</span>&nbsp;<span class="op" id="7678701">==</span>&nbsp;<span class="ident" id="7678704">nil</span>&nbsp;<span class="op" id="7678708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678712">t</span><span class="op" id="7678713">.</span><span class="ident" id="7678714">Error</span><span class="op" id="7678719">(</span><span class="string" id="7678720">&#34;expected&nbsp;error&nbsp;calling&nbsp;unknown&nbsp;service&#34;</span><span class="op" id="7678760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7678763">}</span>&nbsp;<span class="keyword" id="7678765">else</span>&nbsp;<span class="keyword" id="7678770">if</span>&nbsp;<span class="ident" id="7678773">strings</span><span class="op" id="7678780">.</span><span class="ident" id="7678781">Index</span><span class="op" id="7678786">(</span><span class="ident" id="7678787">err</span><span class="op" id="7678790">.</span><span class="ident" id="7678791">Error</span><span class="op" id="7678796">(</span><span class="op" id="7678797">)</span><span class="op" id="7678798">,</span>&nbsp;<span class="string" id="7678800">&#34;method&#34;</span><span class="op" id="7678808">)</span>&nbsp;<span class="op" id="7678810">&lt;</span>&nbsp;<span class="num" id="7678812">0</span>&nbsp;<span class="op" id="7678814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678818">t</span><span class="op" id="7678819">.</span><span class="ident" id="7678820">Error</span><span class="op" id="7678825">(</span><span class="string" id="7678826">&#34;expected&nbsp;error&nbsp;about&nbsp;method;&nbsp;got&#34;</span><span class="op" id="7678860">,</span>&nbsp;<span class="ident" id="7678862">err</span><span class="op" id="7678865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7678868">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7678872">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678890">args</span>&nbsp;<span class="op" id="7678895">=</span>&nbsp;<span class="op" id="7678897">&amp;</span><span class="ident" id="7678898">Args</span><span class="op" id="7678902">{</span><span class="num" id="7678903">7</span><span class="op" id="7678904">,</span>&nbsp;<span class="num" id="7678906">8</span><span class="op" id="7678907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678910">mulReply</span>&nbsp;<span class="op" id="7678919">:=</span>&nbsp;<span class="builtinfunc" id="7678922">new</span><span class="op" id="7678925">(</span><span class="ident" id="7678926">Reply</span><span class="op" id="7678931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678934">mulCall</span>&nbsp;<span class="op" id="7678942">:=</span>&nbsp;<span class="ident" id="7678945">client</span><span class="op" id="7678951">.</span><span class="ident" id="7678952">Go</span><span class="op" id="7678954">(</span><span class="string" id="7678955">&#34;Arith.Mul&#34;</span><span class="op" id="7678966">,</span>&nbsp;<span class="ident" id="7678968">args</span><span class="op" id="7678972">,</span>&nbsp;<span class="ident" id="7678974">mulReply</span><span class="op" id="7678982">,</span>&nbsp;<span class="ident" id="7678984">nil</span><span class="op" id="7678987">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7678990">addReply</span>&nbsp;<span class="op" id="7678999">:=</span>&nbsp;<span class="builtinfunc" id="7679002">new</span><span class="op" id="7679005">(</span><span class="ident" id="7679006">Reply</span><span class="op" id="7679011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679014">addCall</span>&nbsp;<span class="op" id="7679022">:=</span>&nbsp;<span class="ident" id="7679025">client</span><span class="op" id="7679031">.</span><span class="ident" id="7679032">Go</span><span class="op" id="7679034">(</span><span class="string" id="7679035">&#34;Arith.Add&#34;</span><span class="op" id="7679046">,</span>&nbsp;<span class="ident" id="7679048">args</span><span class="op" id="7679052">,</span>&nbsp;<span class="ident" id="7679054">addReply</span><span class="op" id="7679062">,</span>&nbsp;<span class="ident" id="7679064">nil</span><span class="op" id="7679067">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679071">addCall</span>&nbsp;<span class="op" id="7679079">=</span>&nbsp;<span class="op" id="7679081">&lt;-</span><span class="ident" id="7679083">addCall</span><span class="op" id="7679090">.</span><span class="ident" id="7679091">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679097">if</span>&nbsp;<span class="ident" id="7679100">addCall</span><span class="op" id="7679107">.</span><span class="ident" id="7679108">Error</span>&nbsp;<span class="op" id="7679114">!=</span>&nbsp;<span class="ident" id="7679117">nil</span>&nbsp;<span class="op" id="7679121">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679125">t</span><span class="op" id="7679126">.</span><span class="ident" id="7679127">Errorf</span><span class="op" id="7679133">(</span><span class="string" id="7679134">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7679176">,</span>&nbsp;<span class="ident" id="7679178">addCall</span><span class="op" id="7679185">.</span><span class="ident" id="7679186">Error</span><span class="op" id="7679191">.</span><span class="ident" id="7679192">Error</span><span class="op" id="7679197">(</span><span class="op" id="7679198">)</span><span class="op" id="7679199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679205">if</span>&nbsp;<span class="ident" id="7679208">addReply</span><span class="op" id="7679216">.</span><span class="ident" id="7679217">C</span>&nbsp;<span class="op" id="7679219">!=</span>&nbsp;<span class="ident" id="7679222">args</span><span class="op" id="7679226">.</span><span class="ident" id="7679227">A</span><span class="op" id="7679228">+</span><span class="ident" id="7679229">args</span><span class="op" id="7679233">.</span><span class="ident" id="7679234">B</span>&nbsp;<span class="op" id="7679236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679240">t</span><span class="op" id="7679241">.</span><span class="ident" id="7679242">Errorf</span><span class="op" id="7679248">(</span><span class="string" id="7679249">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7679274">,</span>&nbsp;<span class="ident" id="7679276">addReply</span><span class="op" id="7679284">.</span><span class="ident" id="7679285">C</span><span class="op" id="7679286">,</span>&nbsp;<span class="ident" id="7679288">args</span><span class="op" id="7679292">.</span><span class="ident" id="7679293">A</span><span class="op" id="7679294">+</span><span class="ident" id="7679295">args</span><span class="op" id="7679299">.</span><span class="ident" id="7679300">B</span><span class="op" id="7679301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679304">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679308">mulCall</span>&nbsp;<span class="op" id="7679316">=</span>&nbsp;<span class="op" id="7679318">&lt;-</span><span class="ident" id="7679320">mulCall</span><span class="op" id="7679327">.</span><span class="ident" id="7679328">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679334">if</span>&nbsp;<span class="ident" id="7679337">mulCall</span><span class="op" id="7679344">.</span><span class="ident" id="7679345">Error</span>&nbsp;<span class="op" id="7679351">!=</span>&nbsp;<span class="ident" id="7679354">nil</span>&nbsp;<span class="op" id="7679358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679362">t</span><span class="op" id="7679363">.</span><span class="ident" id="7679364">Errorf</span><span class="op" id="7679370">(</span><span class="string" id="7679371">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7679413">,</span>&nbsp;<span class="ident" id="7679415">mulCall</span><span class="op" id="7679422">.</span><span class="ident" id="7679423">Error</span><span class="op" id="7679428">.</span><span class="ident" id="7679429">Error</span><span class="op" id="7679434">(</span><span class="op" id="7679435">)</span><span class="op" id="7679436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679439">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679442">if</span>&nbsp;<span class="ident" id="7679445">mulReply</span><span class="op" id="7679453">.</span><span class="ident" id="7679454">C</span>&nbsp;<span class="op" id="7679456">!=</span>&nbsp;<span class="ident" id="7679459">args</span><span class="op" id="7679463">.</span><span class="ident" id="7679464">A</span><span class="op" id="7679465">*</span><span class="ident" id="7679466">args</span><span class="op" id="7679470">.</span><span class="ident" id="7679471">B</span>&nbsp;<span class="op" id="7679473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679477">t</span><span class="op" id="7679478">.</span><span class="ident" id="7679479">Errorf</span><span class="op" id="7679485">(</span><span class="string" id="7679486">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7679511">,</span>&nbsp;<span class="ident" id="7679513">mulReply</span><span class="op" id="7679521">.</span><span class="ident" id="7679522">C</span><span class="op" id="7679523">,</span>&nbsp;<span class="ident" id="7679525">args</span><span class="op" id="7679529">.</span><span class="ident" id="7679530">A</span><span class="op" id="7679531">*</span><span class="ident" id="7679532">args</span><span class="op" id="7679536">.</span><span class="ident" id="7679537">B</span><span class="op" id="7679538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7679545">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679560">args</span>&nbsp;<span class="op" id="7679565">=</span>&nbsp;<span class="op" id="7679567">&amp;</span><span class="ident" id="7679568">Args</span><span class="op" id="7679572">{</span><span class="num" id="7679573">7</span><span class="op" id="7679574">,</span>&nbsp;<span class="num" id="7679576">0</span><span class="op" id="7679577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679580">reply</span>&nbsp;<span class="op" id="7679586">=</span>&nbsp;<span class="builtinfunc" id="7679588">new</span><span class="op" id="7679591">(</span><span class="ident" id="7679592">Reply</span><span class="op" id="7679597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679600">err</span>&nbsp;<span class="op" id="7679604">=</span>&nbsp;<span class="ident" id="7679606">client</span><span class="op" id="7679612">.</span><span class="ident" id="7679613">Call</span><span class="op" id="7679617">(</span><span class="string" id="7679618">&#34;Arith.Div&#34;</span><span class="op" id="7679629">,</span>&nbsp;<span class="ident" id="7679631">args</span><span class="op" id="7679635">,</span>&nbsp;<span class="ident" id="7679637">reply</span><span class="op" id="7679642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7679645">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679678">if</span>&nbsp;<span class="ident" id="7679681">err</span>&nbsp;<span class="op" id="7679685">==</span>&nbsp;<span class="ident" id="7679688">nil</span>&nbsp;<span class="op" id="7679692">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679696">t</span><span class="op" id="7679697">.</span><span class="ident" id="7679698">Error</span><span class="op" id="7679703">(</span><span class="string" id="7679704">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7679725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679728">}</span>&nbsp;<span class="keyword" id="7679730">else</span>&nbsp;<span class="keyword" id="7679735">if</span>&nbsp;<span class="ident" id="7679738">err</span><span class="op" id="7679741">.</span><span class="ident" id="7679742">Error</span><span class="op" id="7679747">(</span><span class="op" id="7679748">)</span>&nbsp;<span class="op" id="7679750">!=</span>&nbsp;<span class="string" id="7679753">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="7679770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679774">t</span><span class="op" id="7679775">.</span><span class="ident" id="7679776">Error</span><span class="op" id="7679781">(</span><span class="string" id="7679782">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7679823">,</span>&nbsp;<span class="ident" id="7679825">err</span><span class="op" id="7679828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7679831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7679835">//&nbsp;Bad&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679849">reply</span>&nbsp;<span class="op" id="7679855">=</span>&nbsp;<span class="builtinfunc" id="7679857">new</span><span class="op" id="7679860">(</span><span class="ident" id="7679861">Reply</span><span class="op" id="7679866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679869">err</span>&nbsp;<span class="op" id="7679873">=</span>&nbsp;<span class="ident" id="7679875">client</span><span class="op" id="7679881">.</span><span class="ident" id="7679882">Call</span><span class="op" id="7679886">(</span><span class="string" id="7679887">&#34;Arith.Add&#34;</span><span class="op" id="7679898">,</span>&nbsp;<span class="ident" id="7679900">reply</span><span class="op" id="7679905">,</span>&nbsp;<span class="ident" id="7679907">reply</span><span class="op" id="7679912">)</span>&nbsp;<span class="comment" id="7679914">//&nbsp;args,&nbsp;reply&nbsp;would&nbsp;be&nbsp;the&nbsp;correct&nbsp;thing&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7679964">if</span>&nbsp;<span class="ident" id="7679967">err</span>&nbsp;<span class="op" id="7679971">==</span>&nbsp;<span class="ident" id="7679974">nil</span>&nbsp;<span class="op" id="7679978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7679982">t</span><span class="op" id="7679983">.</span><span class="ident" id="7679984">Error</span><span class="op" id="7679989">(</span><span class="string" id="7679990">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;wrong&nbsp;arg&nbsp;type&#34;</span><span class="op" id="7680044">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680047">}</span>&nbsp;<span class="keyword" id="7680049">else</span>&nbsp;<span class="keyword" id="7680054">if</span>&nbsp;<span class="ident" id="7680057">strings</span><span class="op" id="7680064">.</span><span class="ident" id="7680065">Index</span><span class="op" id="7680070">(</span><span class="ident" id="7680071">err</span><span class="op" id="7680074">.</span><span class="ident" id="7680075">Error</span><span class="op" id="7680080">(</span><span class="op" id="7680081">)</span><span class="op" id="7680082">,</span>&nbsp;<span class="string" id="7680084">&#34;type&#34;</span><span class="op" id="7680090">)</span>&nbsp;<span class="op" id="7680092">&lt;</span>&nbsp;<span class="num" id="7680094">0</span>&nbsp;<span class="op" id="7680096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680100">t</span><span class="op" id="7680101">.</span><span class="ident" id="7680102">Error</span><span class="op" id="7680107">(</span><span class="string" id="7680108">&#34;expected&nbsp;error&nbsp;about&nbsp;type;&nbsp;got&#34;</span><span class="op" id="7680140">,</span>&nbsp;<span class="ident" id="7680142">err</span><span class="op" id="7680145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7680152">//&nbsp;Non-struct&nbsp;argument</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680176">const</span>&nbsp;<span class="ident" id="7680182">Val</span>&nbsp;<span class="op" id="7680186">=</span>&nbsp;<span class="num" id="7680188">12345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680195">str</span>&nbsp;<span class="op" id="7680199">:=</span>&nbsp;<span class="ident" id="7680202">fmt</span><span class="op" id="7680205">.</span><span class="ident" id="7680206">Sprint</span><span class="op" id="7680212">(</span><span class="ident" id="7680213">Val</span><span class="op" id="7680216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680219">reply</span>&nbsp;<span class="op" id="7680225">=</span>&nbsp;<span class="builtinfunc" id="7680227">new</span><span class="op" id="7680230">(</span><span class="ident" id="7680231">Reply</span><span class="op" id="7680236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680239">err</span>&nbsp;<span class="op" id="7680243">=</span>&nbsp;<span class="ident" id="7680245">client</span><span class="op" id="7680251">.</span><span class="ident" id="7680252">Call</span><span class="op" id="7680256">(</span><span class="string" id="7680257">&#34;Arith.Scan&#34;</span><span class="op" id="7680269">,</span>&nbsp;<span class="op" id="7680271">&amp;</span><span class="ident" id="7680272">str</span><span class="op" id="7680275">,</span>&nbsp;<span class="ident" id="7680277">reply</span><span class="op" id="7680282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680285">if</span>&nbsp;<span class="ident" id="7680288">err</span>&nbsp;<span class="op" id="7680292">!=</span>&nbsp;<span class="ident" id="7680295">nil</span>&nbsp;<span class="op" id="7680299">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680303">t</span><span class="op" id="7680304">.</span><span class="ident" id="7680305">Errorf</span><span class="op" id="7680311">(</span><span class="string" id="7680312">&#34;Scan:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7680355">,</span>&nbsp;<span class="ident" id="7680357">err</span><span class="op" id="7680360">.</span><span class="ident" id="7680361">Error</span><span class="op" id="7680366">(</span><span class="op" id="7680367">)</span><span class="op" id="7680368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680371">}</span>&nbsp;<span class="keyword" id="7680373">else</span>&nbsp;<span class="keyword" id="7680378">if</span>&nbsp;<span class="ident" id="7680381">reply</span><span class="op" id="7680386">.</span><span class="ident" id="7680387">C</span>&nbsp;<span class="op" id="7680389">!=</span>&nbsp;<span class="ident" id="7680392">Val</span>&nbsp;<span class="op" id="7680396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680400">t</span><span class="op" id="7680401">.</span><span class="ident" id="7680402">Errorf</span><span class="op" id="7680408">(</span><span class="string" id="7680409">&#34;Scan:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7680435">,</span>&nbsp;<span class="ident" id="7680437">Val</span><span class="op" id="7680440">,</span>&nbsp;<span class="ident" id="7680442">reply</span><span class="op" id="7680447">.</span><span class="ident" id="7680448">C</span><span class="op" id="7680449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7680456">//&nbsp;Non-struct&nbsp;reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680477">args</span>&nbsp;<span class="op" id="7680482">=</span>&nbsp;<span class="op" id="7680484">&amp;</span><span class="ident" id="7680485">Args</span><span class="op" id="7680489">{</span><span class="num" id="7680490">27</span><span class="op" id="7680492">,</span>&nbsp;<span class="num" id="7680494">35</span><span class="op" id="7680496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680499">str</span>&nbsp;<span class="op" id="7680503">=</span>&nbsp;<span class="string" id="7680505">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680509">err</span>&nbsp;<span class="op" id="7680513">=</span>&nbsp;<span class="ident" id="7680515">client</span><span class="op" id="7680521">.</span><span class="ident" id="7680522">Call</span><span class="op" id="7680526">(</span><span class="string" id="7680527">&#34;Arith.String&#34;</span><span class="op" id="7680541">,</span>&nbsp;<span class="ident" id="7680543">args</span><span class="op" id="7680547">,</span>&nbsp;<span class="op" id="7680549">&amp;</span><span class="ident" id="7680550">str</span><span class="op" id="7680553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680556">if</span>&nbsp;<span class="ident" id="7680559">err</span>&nbsp;<span class="op" id="7680563">!=</span>&nbsp;<span class="ident" id="7680566">nil</span>&nbsp;<span class="op" id="7680570">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680574">t</span><span class="op" id="7680575">.</span><span class="ident" id="7680576">Errorf</span><span class="op" id="7680582">(</span><span class="string" id="7680583">&#34;String:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7680628">,</span>&nbsp;<span class="ident" id="7680630">err</span><span class="op" id="7680633">.</span><span class="ident" id="7680634">Error</span><span class="op" id="7680639">(</span><span class="op" id="7680640">)</span><span class="op" id="7680641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680647">expect</span>&nbsp;<span class="op" id="7680654">:=</span>&nbsp;<span class="ident" id="7680657">fmt</span><span class="op" id="7680660">.</span><span class="ident" id="7680661">Sprintf</span><span class="op" id="7680668">(</span><span class="string" id="7680669">&#34;%d+%d=%d&#34;</span><span class="op" id="7680679">,</span>&nbsp;<span class="ident" id="7680681">args</span><span class="op" id="7680685">.</span><span class="ident" id="7680686">A</span><span class="op" id="7680687">,</span>&nbsp;<span class="ident" id="7680689">args</span><span class="op" id="7680693">.</span><span class="ident" id="7680694">B</span><span class="op" id="7680695">,</span>&nbsp;<span class="ident" id="7680697">args</span><span class="op" id="7680701">.</span><span class="ident" id="7680702">A</span><span class="op" id="7680703">+</span><span class="ident" id="7680704">args</span><span class="op" id="7680708">.</span><span class="ident" id="7680709">B</span><span class="op" id="7680710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680713">if</span>&nbsp;<span class="ident" id="7680716">str</span>&nbsp;<span class="op" id="7680720">!=</span>&nbsp;<span class="ident" id="7680723">expect</span>&nbsp;<span class="op" id="7680730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680734">t</span><span class="op" id="7680735">.</span><span class="ident" id="7680736">Errorf</span><span class="op" id="7680742">(</span><span class="string" id="7680743">&#34;String:&nbsp;expected&nbsp;%s&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7680771">,</span>&nbsp;<span class="ident" id="7680773">expect</span><span class="op" id="7680779">,</span>&nbsp;<span class="ident" id="7680781">str</span><span class="op" id="7680784">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680791">args</span>&nbsp;<span class="op" id="7680796">=</span>&nbsp;<span class="op" id="7680798">&amp;</span><span class="ident" id="7680799">Args</span><span class="op" id="7680803">{</span><span class="num" id="7680804">7</span><span class="op" id="7680805">,</span>&nbsp;<span class="num" id="7680807">8</span><span class="op" id="7680808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680811">reply</span>&nbsp;<span class="op" id="7680817">=</span>&nbsp;<span class="builtinfunc" id="7680819">new</span><span class="op" id="7680822">(</span><span class="ident" id="7680823">Reply</span><span class="op" id="7680828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680831">err</span>&nbsp;<span class="op" id="7680835">=</span>&nbsp;<span class="ident" id="7680837">client</span><span class="op" id="7680843">.</span><span class="ident" id="7680844">Call</span><span class="op" id="7680848">(</span><span class="string" id="7680849">&#34;Arith.Mul&#34;</span><span class="op" id="7680860">,</span>&nbsp;<span class="ident" id="7680862">args</span><span class="op" id="7680866">,</span>&nbsp;<span class="ident" id="7680868">reply</span><span class="op" id="7680873">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680876">if</span>&nbsp;<span class="ident" id="7680879">err</span>&nbsp;<span class="op" id="7680883">!=</span>&nbsp;<span class="ident" id="7680886">nil</span>&nbsp;<span class="op" id="7680890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680894">t</span><span class="op" id="7680895">.</span><span class="ident" id="7680896">Errorf</span><span class="op" id="7680902">(</span><span class="string" id="7680903">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7680945">,</span>&nbsp;<span class="ident" id="7680947">err</span><span class="op" id="7680950">.</span><span class="ident" id="7680951">Error</span><span class="op" id="7680956">(</span><span class="op" id="7680957">)</span><span class="op" id="7680958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7680961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7680964">if</span>&nbsp;<span class="ident" id="7680967">reply</span><span class="op" id="7680972">.</span><span class="ident" id="7680973">C</span>&nbsp;<span class="op" id="7680975">!=</span>&nbsp;<span class="ident" id="7680978">args</span><span class="op" id="7680982">.</span><span class="ident" id="7680983">A</span><span class="op" id="7680984">*</span><span class="ident" id="7680985">args</span><span class="op" id="7680989">.</span><span class="ident" id="7680990">B</span>&nbsp;<span class="op" id="7680992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7680996">t</span><span class="op" id="7680997">.</span><span class="ident" id="7680998">Errorf</span><span class="op" id="7681004">(</span><span class="string" id="7681005">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7681030">,</span>&nbsp;<span class="ident" id="7681032">reply</span><span class="op" id="7681037">.</span><span class="ident" id="7681038">C</span><span class="op" id="7681039">,</span>&nbsp;<span class="ident" id="7681041">args</span><span class="op" id="7681045">.</span><span class="ident" id="7681046">A</span><span class="op" id="7681047">*</span><span class="ident" id="7681048">args</span><span class="op" id="7681052">.</span><span class="ident" id="7681053">B</span><span class="op" id="7681054">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7681061">//&nbsp;ServiceName&nbsp;contain&nbsp;&#34;.&#34;&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681099">args</span>&nbsp;<span class="op" id="7681104">=</span>&nbsp;<span class="op" id="7681106">&amp;</span><span class="ident" id="7681107">Args</span><span class="op" id="7681111">{</span><span class="num" id="7681112">7</span><span class="op" id="7681113">,</span>&nbsp;<span class="num" id="7681115">8</span><span class="op" id="7681116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681119">reply</span>&nbsp;<span class="op" id="7681125">=</span>&nbsp;<span class="builtinfunc" id="7681127">new</span><span class="op" id="7681130">(</span><span class="ident" id="7681131">Reply</span><span class="op" id="7681136">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681139">err</span>&nbsp;<span class="op" id="7681143">=</span>&nbsp;<span class="ident" id="7681145">client</span><span class="op" id="7681151">.</span><span class="ident" id="7681152">Call</span><span class="op" id="7681156">(</span><span class="string" id="7681157">&#34;net.rpc.Arith.Add&#34;</span><span class="op" id="7681176">,</span>&nbsp;<span class="ident" id="7681178">args</span><span class="op" id="7681182">,</span>&nbsp;<span class="ident" id="7681184">reply</span><span class="op" id="7681189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681192">if</span>&nbsp;<span class="ident" id="7681195">err</span>&nbsp;<span class="op" id="7681199">!=</span>&nbsp;<span class="ident" id="7681202">nil</span>&nbsp;<span class="op" id="7681206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681210">t</span><span class="op" id="7681211">.</span><span class="ident" id="7681212">Errorf</span><span class="op" id="7681218">(</span><span class="string" id="7681219">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7681261">,</span>&nbsp;<span class="ident" id="7681263">err</span><span class="op" id="7681266">.</span><span class="ident" id="7681267">Error</span><span class="op" id="7681272">(</span><span class="op" id="7681273">)</span><span class="op" id="7681274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681280">if</span>&nbsp;<span class="ident" id="7681283">reply</span><span class="op" id="7681288">.</span><span class="ident" id="7681289">C</span>&nbsp;<span class="op" id="7681291">!=</span>&nbsp;<span class="ident" id="7681294">args</span><span class="op" id="7681298">.</span><span class="ident" id="7681299">A</span><span class="op" id="7681300">+</span><span class="ident" id="7681301">args</span><span class="op" id="7681305">.</span><span class="ident" id="7681306">B</span>&nbsp;<span class="op" id="7681308">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681312">t</span><span class="op" id="7681313">.</span><span class="ident" id="7681314">Errorf</span><span class="op" id="7681320">(</span><span class="string" id="7681321">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7681346">,</span>&nbsp;<span class="ident" id="7681348">reply</span><span class="op" id="7681353">.</span><span class="ident" id="7681354">C</span><span class="op" id="7681355">,</span>&nbsp;<span class="ident" id="7681357">args</span><span class="op" id="7681361">.</span><span class="ident" id="7681362">A</span><span class="op" id="7681363">+</span><span class="ident" id="7681364">args</span><span class="op" id="7681368">.</span><span class="ident" id="7681369">B</span><span class="op" id="7681370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681373">}</span><br>
<span class="lineno"></span><span class="op" id="7681375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7681378">func</span>&nbsp;<span class="ident" id="7681383">testNewServerRPC</span><span class="op" id="7681399">(</span><span class="ident" id="7681400">t</span>&nbsp;<span class="op" id="7681402">*</span><span class="ident" id="7681403">testing</span><span class="op" id="7681410">.</span><span class="ident" id="7681411">T</span><span class="op" id="7681412">,</span>&nbsp;<span class="ident" id="7681414">addr</span>&nbsp;<span class="builtintype" id="7681419">string</span><span class="op" id="7681425">)</span>&nbsp;<span class="op" id="7681427">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681430">client</span><span class="op" id="7681436">,</span>&nbsp;<span class="ident" id="7681438">err</span>&nbsp;<span class="op" id="7681442">:=</span>&nbsp;<span class="ident" id="7681445">Dial</span><span class="op" id="7681449">(</span><span class="string" id="7681450">&#34;tcp&#34;</span><span class="op" id="7681455">,</span>&nbsp;<span class="ident" id="7681457">addr</span><span class="op" id="7681461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681464">if</span>&nbsp;<span class="ident" id="7681467">err</span>&nbsp;<span class="op" id="7681471">!=</span>&nbsp;<span class="ident" id="7681474">nil</span>&nbsp;<span class="op" id="7681478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681482">t</span><span class="op" id="7681483">.</span><span class="ident" id="7681484">Fatal</span><span class="op" id="7681489">(</span><span class="string" id="7681490">&#34;dialing&#34;</span><span class="op" id="7681499">,</span>&nbsp;<span class="ident" id="7681501">err</span><span class="op" id="7681504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681510">defer</span>&nbsp;<span class="ident" id="7681516">client</span><span class="op" id="7681522">.</span><span class="ident" id="7681523">Close</span><span class="op" id="7681528">(</span><span class="op" id="7681529">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7681533">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681555">args</span>&nbsp;<span class="op" id="7681560">:=</span>&nbsp;<span class="op" id="7681563">&amp;</span><span class="ident" id="7681564">Args</span><span class="op" id="7681568">{</span><span class="num" id="7681569">7</span><span class="op" id="7681570">,</span>&nbsp;<span class="num" id="7681572">8</span><span class="op" id="7681573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681576">reply</span>&nbsp;<span class="op" id="7681582">:=</span>&nbsp;<span class="builtinfunc" id="7681585">new</span><span class="op" id="7681588">(</span><span class="ident" id="7681589">Reply</span><span class="op" id="7681594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681597">err</span>&nbsp;<span class="op" id="7681601">=</span>&nbsp;<span class="ident" id="7681603">client</span><span class="op" id="7681609">.</span><span class="ident" id="7681610">Call</span><span class="op" id="7681614">(</span><span class="string" id="7681615">&#34;newServer.Arith.Add&#34;</span><span class="op" id="7681636">,</span>&nbsp;<span class="ident" id="7681638">args</span><span class="op" id="7681642">,</span>&nbsp;<span class="ident" id="7681644">reply</span><span class="op" id="7681649">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681652">if</span>&nbsp;<span class="ident" id="7681655">err</span>&nbsp;<span class="op" id="7681659">!=</span>&nbsp;<span class="ident" id="7681662">nil</span>&nbsp;<span class="op" id="7681666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681670">t</span><span class="op" id="7681671">.</span><span class="ident" id="7681672">Errorf</span><span class="op" id="7681678">(</span><span class="string" id="7681679">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7681721">,</span>&nbsp;<span class="ident" id="7681723">err</span><span class="op" id="7681726">.</span><span class="ident" id="7681727">Error</span><span class="op" id="7681732">(</span><span class="op" id="7681733">)</span><span class="op" id="7681734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7681740">if</span>&nbsp;<span class="ident" id="7681743">reply</span><span class="op" id="7681748">.</span><span class="ident" id="7681749">C</span>&nbsp;<span class="op" id="7681751">!=</span>&nbsp;<span class="ident" id="7681754">args</span><span class="op" id="7681758">.</span><span class="ident" id="7681759">A</span><span class="op" id="7681760">+</span><span class="ident" id="7681761">args</span><span class="op" id="7681765">.</span><span class="ident" id="7681766">B</span>&nbsp;<span class="op" id="7681768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681772">t</span><span class="op" id="7681773">.</span><span class="ident" id="7681774">Errorf</span><span class="op" id="7681780">(</span><span class="string" id="7681781">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7681806">,</span>&nbsp;<span class="ident" id="7681808">reply</span><span class="op" id="7681813">.</span><span class="ident" id="7681814">C</span><span class="op" id="7681815">,</span>&nbsp;<span class="ident" id="7681817">args</span><span class="op" id="7681821">.</span><span class="ident" id="7681822">A</span><span class="op" id="7681823">+</span><span class="ident" id="7681824">args</span><span class="op" id="7681828">.</span><span class="ident" id="7681829">B</span><span class="op" id="7681830">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7681833">}</span><br>
<span class="lineno"></span><span class="op" id="7681835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7681838">func</span>&nbsp;<span class="ident" id="7681843">TestHTTP</span><span class="op" id="7681851">(</span><span class="ident" id="7681852">t</span>&nbsp;<span class="op" id="7681854">*</span><span class="ident" id="7681855">testing</span><span class="op" id="7681862">.</span><span class="ident" id="7681863">T</span><span class="op" id="7681864">)</span>&nbsp;<span class="op" id="7681866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681869">once</span><span class="op" id="7681873">.</span><span class="ident" id="7681874">Do</span><span class="op" id="7681876">(</span><span class="ident" id="7681877">startServer</span><span class="op" id="7681888">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681891">testHTTPRPC</span><span class="op" id="7681902">(</span><span class="ident" id="7681903">t</span><span class="op" id="7681904">,</span>&nbsp;<span class="string" id="7681906">&#34;&#34;</span><span class="op" id="7681908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681911">newOnce</span><span class="op" id="7681918">.</span><span class="ident" id="7681919">Do</span><span class="op" id="7681921">(</span><span class="ident" id="7681922">startNewServer</span><span class="op" id="7681936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7681939">testHTTPRPC</span><span class="op" id="7681950">(</span><span class="ident" id="7681951">t</span><span class="op" id="7681952">,</span>&nbsp;<span class="ident" id="7681954">newHttpPath</span><span class="op" id="7681965">)</span><br>
<span class="lineno"></span><span class="op" id="7681967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7681970">func</span>&nbsp;<span class="ident" id="7681975">testHTTPRPC</span><span class="op" id="7681986">(</span><span class="ident" id="7681987">t</span>&nbsp;<span class="op" id="7681989">*</span><span class="ident" id="7681990">testing</span><span class="op" id="7681997">.</span><span class="ident" id="7681998">T</span><span class="op" id="7681999">,</span>&nbsp;<span class="ident" id="7682001">path</span>&nbsp;<span class="builtintype" id="7682006">string</span><span class="op" id="7682012">)</span>&nbsp;<span class="op" id="7682014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682017">var</span>&nbsp;<span class="ident" id="7682021">client</span>&nbsp;<span class="op" id="7682028">*</span><span class="ident" id="7682029">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682037">var</span>&nbsp;<span class="ident" id="7682041">err</span>&nbsp;<span class="builtintype" id="7682045">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682052">if</span>&nbsp;<span class="ident" id="7682055">path</span>&nbsp;<span class="op" id="7682060">==</span>&nbsp;<span class="string" id="7682063">&#34;&#34;</span>&nbsp;<span class="op" id="7682066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682070">client</span><span class="op" id="7682076">,</span>&nbsp;<span class="ident" id="7682078">err</span>&nbsp;<span class="op" id="7682082">=</span>&nbsp;<span class="ident" id="7682084">DialHTTP</span><span class="op" id="7682092">(</span><span class="string" id="7682093">&#34;tcp&#34;</span><span class="op" id="7682098">,</span>&nbsp;<span class="ident" id="7682100">httpServerAddr</span><span class="op" id="7682114">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682117">}</span>&nbsp;<span class="keyword" id="7682119">else</span>&nbsp;<span class="op" id="7682124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682128">client</span><span class="op" id="7682134">,</span>&nbsp;<span class="ident" id="7682136">err</span>&nbsp;<span class="op" id="7682140">=</span>&nbsp;<span class="ident" id="7682142">DialHTTPPath</span><span class="op" id="7682154">(</span><span class="string" id="7682155">&#34;tcp&#34;</span><span class="op" id="7682160">,</span>&nbsp;<span class="ident" id="7682162">httpServerAddr</span><span class="op" id="7682176">,</span>&nbsp;<span class="ident" id="7682178">path</span><span class="op" id="7682182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682188">if</span>&nbsp;<span class="ident" id="7682191">err</span>&nbsp;<span class="op" id="7682195">!=</span>&nbsp;<span class="ident" id="7682198">nil</span>&nbsp;<span class="op" id="7682202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682206">t</span><span class="op" id="7682207">.</span><span class="ident" id="7682208">Fatal</span><span class="op" id="7682213">(</span><span class="string" id="7682214">&#34;dialing&#34;</span><span class="op" id="7682223">,</span>&nbsp;<span class="ident" id="7682225">err</span><span class="op" id="7682228">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682234">defer</span>&nbsp;<span class="ident" id="7682240">client</span><span class="op" id="7682246">.</span><span class="ident" id="7682247">Close</span><span class="op" id="7682252">(</span><span class="op" id="7682253">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7682257">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682279">args</span>&nbsp;<span class="op" id="7682284">:=</span>&nbsp;<span class="op" id="7682287">&amp;</span><span class="ident" id="7682288">Args</span><span class="op" id="7682292">{</span><span class="num" id="7682293">7</span><span class="op" id="7682294">,</span>&nbsp;<span class="num" id="7682296">8</span><span class="op" id="7682297">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682300">reply</span>&nbsp;<span class="op" id="7682306">:=</span>&nbsp;<span class="builtinfunc" id="7682309">new</span><span class="op" id="7682312">(</span><span class="ident" id="7682313">Reply</span><span class="op" id="7682318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682321">err</span>&nbsp;<span class="op" id="7682325">=</span>&nbsp;<span class="ident" id="7682327">client</span><span class="op" id="7682333">.</span><span class="ident" id="7682334">Call</span><span class="op" id="7682338">(</span><span class="string" id="7682339">&#34;Arith.Add&#34;</span><span class="op" id="7682350">,</span>&nbsp;<span class="ident" id="7682352">args</span><span class="op" id="7682356">,</span>&nbsp;<span class="ident" id="7682358">reply</span><span class="op" id="7682363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682366">if</span>&nbsp;<span class="ident" id="7682369">err</span>&nbsp;<span class="op" id="7682373">!=</span>&nbsp;<span class="ident" id="7682376">nil</span>&nbsp;<span class="op" id="7682380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682384">t</span><span class="op" id="7682385">.</span><span class="ident" id="7682386">Errorf</span><span class="op" id="7682392">(</span><span class="string" id="7682393">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7682435">,</span>&nbsp;<span class="ident" id="7682437">err</span><span class="op" id="7682440">.</span><span class="ident" id="7682441">Error</span><span class="op" id="7682446">(</span><span class="op" id="7682447">)</span><span class="op" id="7682448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682451">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682454">if</span>&nbsp;<span class="ident" id="7682457">reply</span><span class="op" id="7682462">.</span><span class="ident" id="7682463">C</span>&nbsp;<span class="op" id="7682465">!=</span>&nbsp;<span class="ident" id="7682468">args</span><span class="op" id="7682472">.</span><span class="ident" id="7682473">A</span><span class="op" id="7682474">+</span><span class="ident" id="7682475">args</span><span class="op" id="7682479">.</span><span class="ident" id="7682480">B</span>&nbsp;<span class="op" id="7682482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682486">t</span><span class="op" id="7682487">.</span><span class="ident" id="7682488">Errorf</span><span class="op" id="7682494">(</span><span class="string" id="7682495">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7682520">,</span>&nbsp;<span class="ident" id="7682522">reply</span><span class="op" id="7682527">.</span><span class="ident" id="7682528">C</span><span class="op" id="7682529">,</span>&nbsp;<span class="ident" id="7682531">args</span><span class="op" id="7682535">.</span><span class="ident" id="7682536">A</span><span class="op" id="7682537">+</span><span class="ident" id="7682538">args</span><span class="op" id="7682542">.</span><span class="ident" id="7682543">B</span><span class="op" id="7682544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7682547">}</span><br>
<span class="lineno"></span><span class="op" id="7682549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="7682552">//&nbsp;CodecEmulator&nbsp;provides&nbsp;a&nbsp;client-like&nbsp;api&nbsp;and&nbsp;a&nbsp;ServerCodec&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="7682625">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;test&nbsp;ServeRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="7682662">type</span>&nbsp;<span class="ident" id="7682667">CodecEmulator</span>&nbsp;<span class="keyword" id="7682681">struct</span>&nbsp;<span class="op" id="7682688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682691">server</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682705">*</span><span class="ident" id="7682706">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682714">serviceMethod</span>&nbsp;<span class="builtintype" id="7682728">string</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682736">args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682750">*</span><span class="ident" id="7682751">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682757">reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682771">*</span><span class="ident" id="7682772">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682779">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7682793">error</span><br>
<span class="lineno"></span><span class="op" id="7682799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="7682802">func</span>&nbsp;<span class="op" id="7682807">(</span><span class="ident" id="7682808">codec</span>&nbsp;<span class="op" id="7682814">*</span><span class="ident" id="7682815">CodecEmulator</span><span class="op" id="7682828">)</span>&nbsp;<span class="ident" id="7682830">Call</span><span class="op" id="7682834">(</span><span class="ident" id="7682835">serviceMethod</span>&nbsp;<span class="builtintype" id="7682849">string</span><span class="op" id="7682855">,</span>&nbsp;<span class="ident" id="7682857">args</span>&nbsp;<span class="op" id="7682862">*</span><span class="ident" id="7682863">Args</span><span class="op" id="7682867">,</span>&nbsp;<span class="ident" id="7682869">reply</span>&nbsp;<span class="op" id="7682875">*</span><span class="ident" id="7682876">Reply</span><span class="op" id="7682881">)</span>&nbsp;<span class="builtintype" id="7682883">error</span>&nbsp;<span class="op" id="7682889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682892">codec</span><span class="op" id="7682897">.</span><span class="ident" id="7682898">serviceMethod</span>&nbsp;<span class="op" id="7682912">=</span>&nbsp;<span class="ident" id="7682914">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682929">codec</span><span class="op" id="7682934">.</span><span class="ident" id="7682935">args</span>&nbsp;<span class="op" id="7682940">=</span>&nbsp;<span class="ident" id="7682942">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682948">codec</span><span class="op" id="7682953">.</span><span class="ident" id="7682954">reply</span>&nbsp;<span class="op" id="7682960">=</span>&nbsp;<span class="ident" id="7682962">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7682969">codec</span><span class="op" id="7682974">.</span><span class="ident" id="7682975">err</span>&nbsp;<span class="op" id="7682979">=</span>&nbsp;<span class="ident" id="7682981">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7682986">var</span>&nbsp;<span class="ident" id="7682990">serverError</span>&nbsp;<span class="builtintype" id="7683002">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683009">if</span>&nbsp;<span class="ident" id="7683012">codec</span><span class="op" id="7683017">.</span><span class="ident" id="7683018">server</span>&nbsp;<span class="op" id="7683025">==</span>&nbsp;<span class="ident" id="7683028">nil</span>&nbsp;<span class="op" id="7683032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683036">serverError</span>&nbsp;<span class="op" id="7683048">=</span>&nbsp;<span class="ident" id="7683050">ServeRequest</span><span class="op" id="7683062">(</span><span class="ident" id="7683063">codec</span><span class="op" id="7683068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683071">}</span>&nbsp;<span class="keyword" id="7683073">else</span>&nbsp;<span class="op" id="7683078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683082">serverError</span>&nbsp;<span class="op" id="7683094">=</span>&nbsp;<span class="ident" id="7683096">codec</span><span class="op" id="7683101">.</span><span class="ident" id="7683102">server</span><span class="op" id="7683108">.</span><span class="ident" id="7683109">ServeRequest</span><span class="op" id="7683121">(</span><span class="ident" id="7683122">codec</span><span class="op" id="7683127">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683133">if</span>&nbsp;<span class="ident" id="7683136">codec</span><span class="op" id="7683141">.</span><span class="ident" id="7683142">err</span>&nbsp;<span class="op" id="7683146">==</span>&nbsp;<span class="ident" id="7683149">nil</span>&nbsp;<span class="op" id="7683153">&amp;&amp;</span>&nbsp;<span class="ident" id="7683156">serverError</span>&nbsp;<span class="op" id="7683168">!=</span>&nbsp;<span class="ident" id="7683171">nil</span>&nbsp;<span class="op" id="7683175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683179">codec</span><span class="op" id="7683184">.</span><span class="ident" id="7683185">err</span>&nbsp;<span class="op" id="7683189">=</span>&nbsp;<span class="ident" id="7683191">serverError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683207">return</span>&nbsp;<span class="ident" id="7683214">codec</span><span class="op" id="7683219">.</span><span class="ident" id="7683220">err</span><br>
<span class="lineno">330</span><span class="op" id="7683224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7683227">func</span>&nbsp;<span class="op" id="7683232">(</span><span class="ident" id="7683233">codec</span>&nbsp;<span class="op" id="7683239">*</span><span class="ident" id="7683240">CodecEmulator</span><span class="op" id="7683253">)</span>&nbsp;<span class="ident" id="7683255">ReadRequestHeader</span><span class="op" id="7683272">(</span><span class="ident" id="7683273">req</span>&nbsp;<span class="op" id="7683277">*</span><span class="ident" id="7683278">Request</span><span class="op" id="7683285">)</span>&nbsp;<span class="builtintype" id="7683287">error</span>&nbsp;<span class="op" id="7683293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683296">req</span><span class="op" id="7683299">.</span><span class="ident" id="7683300">ServiceMethod</span>&nbsp;<span class="op" id="7683314">=</span>&nbsp;<span class="ident" id="7683316">codec</span><span class="op" id="7683321">.</span><span class="ident" id="7683322">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683337">req</span><span class="op" id="7683340">.</span><span class="ident" id="7683341">Seq</span>&nbsp;<span class="op" id="7683345">=</span>&nbsp;<span class="num" id="7683347">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683350">return</span>&nbsp;<span class="ident" id="7683357">nil</span><br>
<span class="lineno"></span><span class="op" id="7683361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7683364">func</span>&nbsp;<span class="op" id="7683369">(</span><span class="ident" id="7683370">codec</span>&nbsp;<span class="op" id="7683376">*</span><span class="ident" id="7683377">CodecEmulator</span><span class="op" id="7683390">)</span>&nbsp;<span class="ident" id="7683392">ReadRequestBody</span><span class="op" id="7683407">(</span><span class="ident" id="7683408">argv</span>&nbsp;<span class="keyword" id="7683413">interface</span><span class="op" id="7683422">{</span><span class="op" id="7683423">}</span><span class="op" id="7683424">)</span>&nbsp;<span class="builtintype" id="7683426">error</span>&nbsp;<span class="op" id="7683432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683435">if</span>&nbsp;<span class="ident" id="7683438">codec</span><span class="op" id="7683443">.</span><span class="ident" id="7683444">args</span>&nbsp;<span class="op" id="7683449">==</span>&nbsp;<span class="ident" id="7683452">nil</span>&nbsp;<span class="op" id="7683456">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683460">return</span>&nbsp;<span class="ident" id="7683467">io</span><span class="op" id="7683469">.</span><span class="ident" id="7683470">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683491">*</span><span class="op" id="7683492">(</span><span class="ident" id="7683493">argv</span><span class="op" id="7683497">.</span><span class="op" id="7683498">(</span><span class="op" id="7683499">*</span><span class="ident" id="7683500">Args</span><span class="op" id="7683504">)</span><span class="op" id="7683505">)</span>&nbsp;<span class="op" id="7683507">=</span>&nbsp;<span class="op" id="7683509">*</span><span class="ident" id="7683510">codec</span><span class="op" id="7683515">.</span><span class="ident" id="7683516">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683522">return</span>&nbsp;<span class="ident" id="7683529">nil</span><br>
<span class="lineno"></span><span class="op" id="7683533">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7683536">func</span>&nbsp;<span class="op" id="7683541">(</span><span class="ident" id="7683542">codec</span>&nbsp;<span class="op" id="7683548">*</span><span class="ident" id="7683549">CodecEmulator</span><span class="op" id="7683562">)</span>&nbsp;<span class="ident" id="7683564">WriteResponse</span><span class="op" id="7683577">(</span><span class="ident" id="7683578">resp</span>&nbsp;<span class="op" id="7683583">*</span><span class="ident" id="7683584">Response</span><span class="op" id="7683592">,</span>&nbsp;<span class="ident" id="7683594">reply</span>&nbsp;<span class="keyword" id="7683600">interface</span><span class="op" id="7683609">{</span><span class="op" id="7683610">}</span><span class="op" id="7683611">)</span>&nbsp;<span class="builtintype" id="7683613">error</span>&nbsp;<span class="op" id="7683619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683622">if</span>&nbsp;<span class="ident" id="7683625">resp</span><span class="op" id="7683629">.</span><span class="ident" id="7683630">Error</span>&nbsp;<span class="op" id="7683636">!=</span>&nbsp;<span class="string" id="7683639">&#34;&#34;</span>&nbsp;<span class="op" id="7683642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683646">codec</span><span class="op" id="7683651">.</span><span class="ident" id="7683652">err</span>&nbsp;<span class="op" id="7683656">=</span>&nbsp;<span class="ident" id="7683658">errors</span><span class="op" id="7683664">.</span><span class="ident" id="7683665">New</span><span class="op" id="7683668">(</span><span class="ident" id="7683669">resp</span><span class="op" id="7683673">.</span><span class="ident" id="7683674">Error</span><span class="op" id="7683679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683682">}</span>&nbsp;<span class="keyword" id="7683684">else</span>&nbsp;<span class="op" id="7683689">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683693">*</span><span class="ident" id="7683694">codec</span><span class="op" id="7683699">.</span><span class="ident" id="7683700">reply</span>&nbsp;<span class="op" id="7683706">=</span>&nbsp;<span class="op" id="7683708">*</span><span class="op" id="7683709">(</span><span class="ident" id="7683710">reply</span><span class="op" id="7683715">.</span><span class="op" id="7683716">(</span><span class="op" id="7683717">*</span><span class="ident" id="7683718">Reply</span><span class="op" id="7683723">)</span><span class="op" id="7683724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7683727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683730">return</span>&nbsp;<span class="ident" id="7683737">nil</span><br>
<span class="lineno"></span><span class="op" id="7683741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="7683744">func</span>&nbsp;<span class="op" id="7683749">(</span><span class="ident" id="7683750">codec</span>&nbsp;<span class="op" id="7683756">*</span><span class="ident" id="7683757">CodecEmulator</span><span class="op" id="7683770">)</span>&nbsp;<span class="ident" id="7683772">Close</span><span class="op" id="7683777">(</span><span class="op" id="7683778">)</span>&nbsp;<span class="builtintype" id="7683780">error</span>&nbsp;<span class="op" id="7683786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7683789">return</span>&nbsp;<span class="ident" id="7683796">nil</span><br>
<span class="lineno"></span><span class="op" id="7683800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7683803">func</span>&nbsp;<span class="ident" id="7683808">TestServeRequest</span><span class="op" id="7683824">(</span><span class="ident" id="7683825">t</span>&nbsp;<span class="op" id="7683827">*</span><span class="ident" id="7683828">testing</span><span class="op" id="7683835">.</span><span class="ident" id="7683836">T</span><span class="op" id="7683837">)</span>&nbsp;<span class="op" id="7683839">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683842">once</span><span class="op" id="7683846">.</span><span class="ident" id="7683847">Do</span><span class="op" id="7683849">(</span><span class="ident" id="7683850">startServer</span><span class="op" id="7683861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683864">testServeRequest</span><span class="op" id="7683880">(</span><span class="ident" id="7683881">t</span><span class="op" id="7683882">,</span>&nbsp;<span class="ident" id="7683884">nil</span><span class="op" id="7683887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683890">newOnce</span><span class="op" id="7683897">.</span><span class="ident" id="7683898">Do</span><span class="op" id="7683900">(</span><span class="ident" id="7683901">startNewServer</span><span class="op" id="7683915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7683918">testServeRequest</span><span class="op" id="7683934">(</span><span class="ident" id="7683935">t</span><span class="op" id="7683936">,</span>&nbsp;<span class="ident" id="7683938">newServer</span><span class="op" id="7683947">)</span><br>
<span class="lineno"></span><span class="op" id="7683949">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7683952">func</span>&nbsp;<span class="ident" id="7683957">testServeRequest</span><span class="op" id="7683973">(</span><span class="ident" id="7683974">t</span>&nbsp;<span class="op" id="7683976">*</span><span class="ident" id="7683977">testing</span><span class="op" id="7683984">.</span><span class="ident" id="7683985">T</span><span class="op" id="7683986">,</span>&nbsp;<span class="ident" id="7683988">server</span>&nbsp;<span class="op" id="7683995">*</span><span class="ident" id="7683996">Server</span><span class="op" id="7684002">)</span>&nbsp;<span class="op" id="7684004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684007">client</span>&nbsp;<span class="op" id="7684014">:=</span>&nbsp;<span class="ident" id="7684017">CodecEmulator</span><span class="op" id="7684030">{</span><span class="ident" id="7684031">server</span><span class="op" id="7684037">:</span>&nbsp;<span class="ident" id="7684039">server</span><span class="op" id="7684045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684048">defer</span>&nbsp;<span class="ident" id="7684054">client</span><span class="op" id="7684060">.</span><span class="ident" id="7684061">Close</span><span class="op" id="7684066">(</span><span class="op" id="7684067">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684071">args</span>&nbsp;<span class="op" id="7684076">:=</span>&nbsp;<span class="op" id="7684079">&amp;</span><span class="ident" id="7684080">Args</span><span class="op" id="7684084">{</span><span class="num" id="7684085">7</span><span class="op" id="7684086">,</span>&nbsp;<span class="num" id="7684088">8</span><span class="op" id="7684089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684092">reply</span>&nbsp;<span class="op" id="7684098">:=</span>&nbsp;<span class="builtinfunc" id="7684101">new</span><span class="op" id="7684104">(</span><span class="ident" id="7684105">Reply</span><span class="op" id="7684110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684113">err</span>&nbsp;<span class="op" id="7684117">:=</span>&nbsp;<span class="ident" id="7684120">client</span><span class="op" id="7684126">.</span><span class="ident" id="7684127">Call</span><span class="op" id="7684131">(</span><span class="string" id="7684132">&#34;Arith.Add&#34;</span><span class="op" id="7684143">,</span>&nbsp;<span class="ident" id="7684145">args</span><span class="op" id="7684149">,</span>&nbsp;<span class="ident" id="7684151">reply</span><span class="op" id="7684156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684159">if</span>&nbsp;<span class="ident" id="7684162">err</span>&nbsp;<span class="op" id="7684166">!=</span>&nbsp;<span class="ident" id="7684169">nil</span>&nbsp;<span class="op" id="7684173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684177">t</span><span class="op" id="7684178">.</span><span class="ident" id="7684179">Errorf</span><span class="op" id="7684185">(</span><span class="string" id="7684186">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7684228">,</span>&nbsp;<span class="ident" id="7684230">err</span><span class="op" id="7684233">.</span><span class="ident" id="7684234">Error</span><span class="op" id="7684239">(</span><span class="op" id="7684240">)</span><span class="op" id="7684241">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684247">if</span>&nbsp;<span class="ident" id="7684250">reply</span><span class="op" id="7684255">.</span><span class="ident" id="7684256">C</span>&nbsp;<span class="op" id="7684258">!=</span>&nbsp;<span class="ident" id="7684261">args</span><span class="op" id="7684265">.</span><span class="ident" id="7684266">A</span><span class="op" id="7684267">+</span><span class="ident" id="7684268">args</span><span class="op" id="7684272">.</span><span class="ident" id="7684273">B</span>&nbsp;<span class="op" id="7684275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684279">t</span><span class="op" id="7684280">.</span><span class="ident" id="7684281">Errorf</span><span class="op" id="7684287">(</span><span class="string" id="7684288">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7684313">,</span>&nbsp;<span class="ident" id="7684315">reply</span><span class="op" id="7684320">.</span><span class="ident" id="7684321">C</span><span class="op" id="7684322">,</span>&nbsp;<span class="ident" id="7684324">args</span><span class="op" id="7684328">.</span><span class="ident" id="7684329">A</span><span class="op" id="7684330">+</span><span class="ident" id="7684331">args</span><span class="op" id="7684335">.</span><span class="ident" id="7684336">B</span><span class="op" id="7684337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684344">err</span>&nbsp;<span class="op" id="7684348">=</span>&nbsp;<span class="ident" id="7684350">client</span><span class="op" id="7684356">.</span><span class="ident" id="7684357">Call</span><span class="op" id="7684361">(</span><span class="string" id="7684362">&#34;Arith.Add&#34;</span><span class="op" id="7684373">,</span>&nbsp;<span class="ident" id="7684375">nil</span><span class="op" id="7684378">,</span>&nbsp;<span class="ident" id="7684380">reply</span><span class="op" id="7684385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684388">if</span>&nbsp;<span class="ident" id="7684391">err</span>&nbsp;<span class="op" id="7684395">==</span>&nbsp;<span class="ident" id="7684398">nil</span>&nbsp;<span class="op" id="7684402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7684406">t</span><span class="op" id="7684407">.</span><span class="ident" id="7684408">Errorf</span><span class="op" id="7684414">(</span><span class="string" id="7684415">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;nil&nbsp;arg&#34;</span><span class="op" id="7684462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7684465">}</span><br>
<span class="lineno"></span><span class="op" id="7684467">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="7684470">type</span>&nbsp;<span class="ident" id="7684475">ReplyNotPointer</span>&nbsp;<span class="builtintype" id="7684491">int</span><br>
<span class="lineno"></span><span class="keyword" id="7684495">type</span>&nbsp;<span class="ident" id="7684500">ArgNotPublic</span>&nbsp;<span class="builtintype" id="7684513">int</span><br>
<span class="lineno"></span><span class="keyword" id="7684517">type</span>&nbsp;<span class="ident" id="7684522">ReplyNotPublic</span>&nbsp;<span class="builtintype" id="7684537">int</span><br>
<span class="lineno"></span><span class="keyword" id="7684541">type</span>&nbsp;<span class="ident" id="7684546">NeedsPtrType</span>&nbsp;<span class="builtintype" id="7684559">int</span><br>
<span class="lineno">390</span><span class="keyword" id="7684563">type</span>&nbsp;<span class="ident" id="7684568">local</span>&nbsp;<span class="keyword" id="7684574">struct</span><span class="op" id="7684580">{</span><span class="op" id="7684581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7684584">func</span>&nbsp;<span class="op" id="7684589">(</span><span class="ident" id="7684590">t</span>&nbsp;<span class="op" id="7684592">*</span><span class="ident" id="7684593">ReplyNotPointer</span><span class="op" id="7684608">)</span>&nbsp;<span class="ident" id="7684610">ReplyNotPointer</span><span class="op" id="7684625">(</span><span class="ident" id="7684626">args</span>&nbsp;<span class="op" id="7684631">*</span><span class="ident" id="7684632">Args</span><span class="op" id="7684636">,</span>&nbsp;<span class="ident" id="7684638">reply</span>&nbsp;<span class="ident" id="7684644">Reply</span><span class="op" id="7684649">)</span>&nbsp;<span class="builtintype" id="7684651">error</span>&nbsp;<span class="op" id="7684657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684660">return</span>&nbsp;<span class="ident" id="7684667">nil</span><br>
<span class="lineno"></span><span class="op" id="7684671">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="7684674">func</span>&nbsp;<span class="op" id="7684679">(</span><span class="ident" id="7684680">t</span>&nbsp;<span class="op" id="7684682">*</span><span class="ident" id="7684683">ArgNotPublic</span><span class="op" id="7684695">)</span>&nbsp;<span class="ident" id="7684697">ArgNotPublic</span><span class="op" id="7684709">(</span><span class="ident" id="7684710">args</span>&nbsp;<span class="op" id="7684715">*</span><span class="ident" id="7684716">local</span><span class="op" id="7684721">,</span>&nbsp;<span class="ident" id="7684723">reply</span>&nbsp;<span class="op" id="7684729">*</span><span class="ident" id="7684730">Reply</span><span class="op" id="7684735">)</span>&nbsp;<span class="builtintype" id="7684737">error</span>&nbsp;<span class="op" id="7684743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684746">return</span>&nbsp;<span class="ident" id="7684753">nil</span><br>
<span class="lineno"></span><span class="op" id="7684757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="7684760">func</span>&nbsp;<span class="op" id="7684765">(</span><span class="ident" id="7684766">t</span>&nbsp;<span class="op" id="7684768">*</span><span class="ident" id="7684769">ReplyNotPublic</span><span class="op" id="7684783">)</span>&nbsp;<span class="ident" id="7684785">ReplyNotPublic</span><span class="op" id="7684799">(</span><span class="ident" id="7684800">args</span>&nbsp;<span class="op" id="7684805">*</span><span class="ident" id="7684806">Args</span><span class="op" id="7684810">,</span>&nbsp;<span class="ident" id="7684812">reply</span>&nbsp;<span class="op" id="7684818">*</span><span class="ident" id="7684819">local</span><span class="op" id="7684824">)</span>&nbsp;<span class="builtintype" id="7684826">error</span>&nbsp;<span class="op" id="7684832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684835">return</span>&nbsp;<span class="ident" id="7684842">nil</span><br>
<span class="lineno"></span><span class="op" id="7684846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7684849">func</span>&nbsp;<span class="op" id="7684854">(</span><span class="ident" id="7684855">t</span>&nbsp;<span class="op" id="7684857">*</span><span class="ident" id="7684858">NeedsPtrType</span><span class="op" id="7684870">)</span>&nbsp;<span class="ident" id="7684872">NeedsPtrType</span><span class="op" id="7684884">(</span><span class="ident" id="7684885">args</span>&nbsp;<span class="op" id="7684890">*</span><span class="ident" id="7684891">Args</span><span class="op" id="7684895">,</span>&nbsp;<span class="ident" id="7684897">reply</span>&nbsp;<span class="op" id="7684903">*</span><span class="ident" id="7684904">Reply</span><span class="op" id="7684909">)</span>&nbsp;<span class="builtintype" id="7684911">error</span>&nbsp;<span class="op" id="7684917">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7684920">return</span>&nbsp;<span class="ident" id="7684927">nil</span><br>
<span class="lineno"></span><span class="op" id="7684931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7684934">//&nbsp;Check&nbsp;that&nbsp;registration&nbsp;handles&nbsp;lots&nbsp;of&nbsp;bad&nbsp;methods&nbsp;and&nbsp;a&nbsp;type&nbsp;with&nbsp;no&nbsp;suitable&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="7685026">func</span>&nbsp;<span class="ident" id="7685031">TestRegistrationError</span><span class="op" id="7685052">(</span><span class="ident" id="7685053">t</span>&nbsp;<span class="op" id="7685055">*</span><span class="ident" id="7685056">testing</span><span class="op" id="7685063">.</span><span class="ident" id="7685064">T</span><span class="op" id="7685065">)</span>&nbsp;<span class="op" id="7685067">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685070">err</span>&nbsp;<span class="op" id="7685074">:=</span>&nbsp;<span class="ident" id="7685077">Register</span><span class="op" id="7685085">(</span><span class="builtinfunc" id="7685086">new</span><span class="op" id="7685089">(</span><span class="ident" id="7685090">ReplyNotPointer</span><span class="op" id="7685105">)</span><span class="op" id="7685106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685109">if</span>&nbsp;<span class="ident" id="7685112">err</span>&nbsp;<span class="op" id="7685116">==</span>&nbsp;<span class="ident" id="7685119">nil</span>&nbsp;<span class="op" id="7685123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685127">t</span><span class="op" id="7685128">.</span><span class="ident" id="7685129">Error</span><span class="op" id="7685134">(</span><span class="string" id="7685135">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPointer&#34;</span><span class="op" id="7685179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685185">err</span>&nbsp;<span class="op" id="7685189">=</span>&nbsp;<span class="ident" id="7685191">Register</span><span class="op" id="7685199">(</span><span class="builtinfunc" id="7685200">new</span><span class="op" id="7685203">(</span><span class="ident" id="7685204">ArgNotPublic</span><span class="op" id="7685216">)</span><span class="op" id="7685217">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685220">if</span>&nbsp;<span class="ident" id="7685223">err</span>&nbsp;<span class="op" id="7685227">==</span>&nbsp;<span class="ident" id="7685230">nil</span>&nbsp;<span class="op" id="7685234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685238">t</span><span class="op" id="7685239">.</span><span class="ident" id="7685240">Error</span><span class="op" id="7685245">(</span><span class="string" id="7685246">&#34;expected&nbsp;error&nbsp;registering&nbsp;ArgNotPublic&#34;</span><span class="op" id="7685287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685293">err</span>&nbsp;<span class="op" id="7685297">=</span>&nbsp;<span class="ident" id="7685299">Register</span><span class="op" id="7685307">(</span><span class="builtinfunc" id="7685308">new</span><span class="op" id="7685311">(</span><span class="ident" id="7685312">ReplyNotPublic</span><span class="op" id="7685326">)</span><span class="op" id="7685327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685330">if</span>&nbsp;<span class="ident" id="7685333">err</span>&nbsp;<span class="op" id="7685337">==</span>&nbsp;<span class="ident" id="7685340">nil</span>&nbsp;<span class="op" id="7685344">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685348">t</span><span class="op" id="7685349">.</span><span class="ident" id="7685350">Error</span><span class="op" id="7685355">(</span><span class="string" id="7685356">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPublic&#34;</span><span class="op" id="7685399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685405">err</span>&nbsp;<span class="op" id="7685409">=</span>&nbsp;<span class="ident" id="7685411">Register</span><span class="op" id="7685419">(</span><span class="ident" id="7685420">NeedsPtrType</span><span class="op" id="7685432">(</span><span class="num" id="7685433">0</span><span class="op" id="7685434">)</span><span class="op" id="7685435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685438">if</span>&nbsp;<span class="ident" id="7685441">err</span>&nbsp;<span class="op" id="7685445">==</span>&nbsp;<span class="ident" id="7685448">nil</span>&nbsp;<span class="op" id="7685452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685456">t</span><span class="op" id="7685457">.</span><span class="ident" id="7685458">Error</span><span class="op" id="7685463">(</span><span class="string" id="7685464">&#34;expected&nbsp;error&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="7685505">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685508">}</span>&nbsp;<span class="keyword" id="7685510">else</span>&nbsp;<span class="keyword" id="7685515">if</span>&nbsp;<span class="op" id="7685518">!</span><span class="ident" id="7685519">strings</span><span class="op" id="7685526">.</span><span class="ident" id="7685527">Contains</span><span class="op" id="7685535">(</span><span class="ident" id="7685536">err</span><span class="op" id="7685539">.</span><span class="ident" id="7685540">Error</span><span class="op" id="7685545">(</span><span class="op" id="7685546">)</span><span class="op" id="7685547">,</span>&nbsp;<span class="string" id="7685549">&#34;pointer&#34;</span><span class="op" id="7685558">)</span>&nbsp;<span class="op" id="7685560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685564">t</span><span class="op" id="7685565">.</span><span class="ident" id="7685566">Error</span><span class="op" id="7685571">(</span><span class="string" id="7685572">&#34;expected&nbsp;hint&nbsp;when&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="7685617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685620">}</span><br>
<span class="lineno"></span><span class="op" id="7685622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7685625">type</span>&nbsp;<span class="ident" id="7685630">WriteFailCodec</span>&nbsp;<span class="builtintype" id="7685645">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7685650">func</span>&nbsp;<span class="op" id="7685655">(</span><span class="ident" id="7685656">WriteFailCodec</span><span class="op" id="7685670">)</span>&nbsp;<span class="ident" id="7685672">WriteRequest</span><span class="op" id="7685684">(</span><span class="op" id="7685685">*</span><span class="ident" id="7685686">Request</span><span class="op" id="7685693">,</span>&nbsp;<span class="keyword" id="7685695">interface</span><span class="op" id="7685704">{</span><span class="op" id="7685705">}</span><span class="op" id="7685706">)</span>&nbsp;<span class="builtintype" id="7685708">error</span>&nbsp;<span class="op" id="7685714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685717">//&nbsp;the&nbsp;panic&nbsp;caused&nbsp;by&nbsp;this&nbsp;error&nbsp;used&nbsp;to&nbsp;not&nbsp;unlock&nbsp;a&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685779">return</span>&nbsp;<span class="ident" id="7685786">errors</span><span class="op" id="7685792">.</span><span class="ident" id="7685793">New</span><span class="op" id="7685796">(</span><span class="string" id="7685797">&#34;fail&#34;</span><span class="op" id="7685803">)</span><br>
<span class="lineno">435</span><span class="op" id="7685805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7685808">func</span>&nbsp;<span class="op" id="7685813">(</span><span class="ident" id="7685814">WriteFailCodec</span><span class="op" id="7685828">)</span>&nbsp;<span class="ident" id="7685830">ReadResponseHeader</span><span class="op" id="7685848">(</span><span class="op" id="7685849">*</span><span class="ident" id="7685850">Response</span><span class="op" id="7685858">)</span>&nbsp;<span class="builtintype" id="7685860">error</span>&nbsp;<span class="op" id="7685866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685869">select</span>&nbsp;<span class="op" id="7685876">{</span><span class="op" id="7685877">}</span><br>
<span class="lineno"></span><span class="op" id="7685879">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="keyword" id="7685882">func</span>&nbsp;<span class="op" id="7685887">(</span><span class="ident" id="7685888">WriteFailCodec</span><span class="op" id="7685902">)</span>&nbsp;<span class="ident" id="7685904">ReadResponseBody</span><span class="op" id="7685920">(</span><span class="keyword" id="7685921">interface</span><span class="op" id="7685930">{</span><span class="op" id="7685931">}</span><span class="op" id="7685932">)</span>&nbsp;<span class="builtintype" id="7685934">error</span>&nbsp;<span class="op" id="7685940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685943">select</span>&nbsp;<span class="op" id="7685950">{</span><span class="op" id="7685951">}</span><br>
<span class="lineno"></span><span class="op" id="7685953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="keyword" id="7685956">func</span>&nbsp;<span class="op" id="7685961">(</span><span class="ident" id="7685962">WriteFailCodec</span><span class="op" id="7685976">)</span>&nbsp;<span class="ident" id="7685978">Close</span><span class="op" id="7685983">(</span><span class="op" id="7685984">)</span>&nbsp;<span class="builtintype" id="7685986">error</span>&nbsp;<span class="op" id="7685992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685995">return</span>&nbsp;<span class="ident" id="7686002">nil</span><br>
<span class="lineno"></span><span class="op" id="7686006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7686009">func</span>&nbsp;<span class="ident" id="7686014">TestSendDeadlock</span><span class="op" id="7686030">(</span><span class="ident" id="7686031">t</span>&nbsp;<span class="op" id="7686033">*</span><span class="ident" id="7686034">testing</span><span class="op" id="7686041">.</span><span class="ident" id="7686042">T</span><span class="op" id="7686043">)</span>&nbsp;<span class="op" id="7686045">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686048">client</span>&nbsp;<span class="op" id="7686055">:=</span>&nbsp;<span class="ident" id="7686058">NewClientWithCodec</span><span class="op" id="7686076">(</span><span class="ident" id="7686077">WriteFailCodec</span><span class="op" id="7686091">(</span><span class="num" id="7686092">0</span><span class="op" id="7686093">)</span><span class="op" id="7686094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686097">defer</span>&nbsp;<span class="ident" id="7686103">client</span><span class="op" id="7686109">.</span><span class="ident" id="7686110">Close</span><span class="op" id="7686115">(</span><span class="op" id="7686116">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686120">done</span>&nbsp;<span class="op" id="7686125">:=</span>&nbsp;<span class="builtinfunc" id="7686128">make</span><span class="op" id="7686132">(</span><span class="keyword" id="7686133">chan</span>&nbsp;<span class="builtintype" id="7686138">bool</span><span class="op" id="7686142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686145">go</span>&nbsp;<span class="keyword" id="7686148">func</span><span class="op" id="7686152">(</span><span class="op" id="7686153">)</span>&nbsp;<span class="op" id="7686155">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686159">testSendDeadlock</span><span class="op" id="7686175">(</span><span class="ident" id="7686176">client</span><span class="op" id="7686182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686186">testSendDeadlock</span><span class="op" id="7686202">(</span><span class="ident" id="7686203">client</span><span class="op" id="7686209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686213">done</span>&nbsp;<span class="op" id="7686218">&lt;-</span>&nbsp;<span class="builtintype" id="7686221">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686227">}</span><span class="op" id="7686228">(</span><span class="op" id="7686229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686232">select</span>&nbsp;<span class="op" id="7686239">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686242">case</span>&nbsp;<span class="op" id="7686247">&lt;-</span><span class="ident" id="7686249">done</span><span class="op" id="7686253">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686257">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686265">case</span>&nbsp;<span class="op" id="7686270">&lt;-</span><span class="ident" id="7686272">time</span><span class="op" id="7686276">.</span><span class="ident" id="7686277">After</span><span class="op" id="7686282">(</span><span class="num" id="7686283">5</span>&nbsp;<span class="op" id="7686285">*</span>&nbsp;<span class="ident" id="7686287">time</span><span class="op" id="7686291">.</span><span class="ident" id="7686292">Second</span><span class="op" id="7686298">)</span><span class="op" id="7686299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686303">t</span><span class="op" id="7686304">.</span><span class="ident" id="7686305">Fatal</span><span class="op" id="7686310">(</span><span class="string" id="7686311">&#34;deadlock&#34;</span><span class="op" id="7686321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686324">}</span><br>
<span class="lineno">465</span><span class="op" id="7686326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7686329">func</span>&nbsp;<span class="ident" id="7686334">testSendDeadlock</span><span class="op" id="7686350">(</span><span class="ident" id="7686351">client</span>&nbsp;<span class="op" id="7686358">*</span><span class="ident" id="7686359">Client</span><span class="op" id="7686365">)</span>&nbsp;<span class="op" id="7686367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686370">defer</span>&nbsp;<span class="keyword" id="7686376">func</span><span class="op" id="7686380">(</span><span class="op" id="7686381">)</span>&nbsp;<span class="op" id="7686383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7686387">recover</span><span class="op" id="7686394">(</span><span class="op" id="7686395">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686398">}</span><span class="op" id="7686399">(</span><span class="op" id="7686400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686403">args</span>&nbsp;<span class="op" id="7686408">:=</span>&nbsp;<span class="op" id="7686411">&amp;</span><span class="ident" id="7686412">Args</span><span class="op" id="7686416">{</span><span class="num" id="7686417">7</span><span class="op" id="7686418">,</span>&nbsp;<span class="num" id="7686420">8</span><span class="op" id="7686421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686424">reply</span>&nbsp;<span class="op" id="7686430">:=</span>&nbsp;<span class="builtinfunc" id="7686433">new</span><span class="op" id="7686436">(</span><span class="ident" id="7686437">Reply</span><span class="op" id="7686442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686445">client</span><span class="op" id="7686451">.</span><span class="ident" id="7686452">Call</span><span class="op" id="7686456">(</span><span class="string" id="7686457">&#34;Arith.Add&#34;</span><span class="op" id="7686468">,</span>&nbsp;<span class="ident" id="7686470">args</span><span class="op" id="7686474">,</span>&nbsp;<span class="ident" id="7686476">reply</span><span class="op" id="7686481">)</span><br>
<span class="lineno"></span><span class="op" id="7686483">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="7686486">func</span>&nbsp;<span class="ident" id="7686491">dialDirect</span><span class="op" id="7686501">(</span><span class="op" id="7686502">)</span>&nbsp;<span class="op" id="7686504">(</span><span class="op" id="7686505">*</span><span class="ident" id="7686506">Client</span><span class="op" id="7686512">,</span>&nbsp;<span class="builtintype" id="7686514">error</span><span class="op" id="7686519">)</span>&nbsp;<span class="op" id="7686521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686524">return</span>&nbsp;<span class="ident" id="7686531">Dial</span><span class="op" id="7686535">(</span><span class="string" id="7686536">&#34;tcp&#34;</span><span class="op" id="7686541">,</span>&nbsp;<span class="ident" id="7686543">serverAddr</span><span class="op" id="7686553">)</span><br>
<span class="lineno"></span><span class="op" id="7686555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="7686558">func</span>&nbsp;<span class="ident" id="7686563">dialHTTP</span><span class="op" id="7686571">(</span><span class="op" id="7686572">)</span>&nbsp;<span class="op" id="7686574">(</span><span class="op" id="7686575">*</span><span class="ident" id="7686576">Client</span><span class="op" id="7686582">,</span>&nbsp;<span class="builtintype" id="7686584">error</span><span class="op" id="7686589">)</span>&nbsp;<span class="op" id="7686591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686594">return</span>&nbsp;<span class="ident" id="7686601">DialHTTP</span><span class="op" id="7686609">(</span><span class="string" id="7686610">&#34;tcp&#34;</span><span class="op" id="7686615">,</span>&nbsp;<span class="ident" id="7686617">httpServerAddr</span><span class="op" id="7686631">)</span><br>
<span class="lineno"></span><span class="op" id="7686633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7686636">func</span>&nbsp;<span class="ident" id="7686641">countMallocs</span><span class="op" id="7686653">(</span><span class="ident" id="7686654">dial</span>&nbsp;<span class="keyword" id="7686659">func</span><span class="op" id="7686663">(</span><span class="op" id="7686664">)</span>&nbsp;<span class="op" id="7686666">(</span><span class="op" id="7686667">*</span><span class="ident" id="7686668">Client</span><span class="op" id="7686674">,</span>&nbsp;<span class="builtintype" id="7686676">error</span><span class="op" id="7686681">)</span><span class="op" id="7686682">,</span>&nbsp;<span class="ident" id="7686684">t</span>&nbsp;<span class="op" id="7686686">*</span><span class="ident" id="7686687">testing</span><span class="op" id="7686694">.</span><span class="ident" id="7686695">T</span><span class="op" id="7686696">)</span>&nbsp;<span class="builtintype" id="7686698">float64</span>&nbsp;<span class="op" id="7686706">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686709">once</span><span class="op" id="7686713">.</span><span class="ident" id="7686714">Do</span><span class="op" id="7686716">(</span><span class="ident" id="7686717">startServer</span><span class="op" id="7686728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686731">client</span><span class="op" id="7686737">,</span>&nbsp;<span class="ident" id="7686739">err</span>&nbsp;<span class="op" id="7686743">:=</span>&nbsp;<span class="ident" id="7686746">dial</span><span class="op" id="7686750">(</span><span class="op" id="7686751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686754">if</span>&nbsp;<span class="ident" id="7686757">err</span>&nbsp;<span class="op" id="7686761">!=</span>&nbsp;<span class="ident" id="7686764">nil</span>&nbsp;<span class="op" id="7686768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686772">t</span><span class="op" id="7686773">.</span><span class="ident" id="7686774">Fatal</span><span class="op" id="7686779">(</span><span class="string" id="7686780">&#34;error&nbsp;dialing&#34;</span><span class="op" id="7686795">,</span>&nbsp;<span class="ident" id="7686797">err</span><span class="op" id="7686800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686803">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686806">defer</span>&nbsp;<span class="ident" id="7686812">client</span><span class="op" id="7686818">.</span><span class="ident" id="7686819">Close</span><span class="op" id="7686824">(</span><span class="op" id="7686825">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686829">args</span>&nbsp;<span class="op" id="7686834">:=</span>&nbsp;<span class="op" id="7686837">&amp;</span><span class="ident" id="7686838">Args</span><span class="op" id="7686842">{</span><span class="num" id="7686843">7</span><span class="op" id="7686844">,</span>&nbsp;<span class="num" id="7686846">8</span><span class="op" id="7686847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686850">reply</span>&nbsp;<span class="op" id="7686856">:=</span>&nbsp;<span class="builtinfunc" id="7686859">new</span><span class="op" id="7686862">(</span><span class="ident" id="7686863">Reply</span><span class="op" id="7686868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686871">return</span>&nbsp;<span class="ident" id="7686878">testing</span><span class="op" id="7686885">.</span><span class="ident" id="7686886">AllocsPerRun</span><span class="op" id="7686898">(</span><span class="num" id="7686899">100</span><span class="op" id="7686902">,</span>&nbsp;<span class="keyword" id="7686904">func</span><span class="op" id="7686908">(</span><span class="op" id="7686909">)</span>&nbsp;<span class="op" id="7686911">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686915">err</span>&nbsp;<span class="op" id="7686919">:=</span>&nbsp;<span class="ident" id="7686922">client</span><span class="op" id="7686928">.</span><span class="ident" id="7686929">Call</span><span class="op" id="7686933">(</span><span class="string" id="7686934">&#34;Arith.Add&#34;</span><span class="op" id="7686945">,</span>&nbsp;<span class="ident" id="7686947">args</span><span class="op" id="7686951">,</span>&nbsp;<span class="ident" id="7686953">reply</span><span class="op" id="7686958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686962">if</span>&nbsp;<span class="ident" id="7686965">err</span>&nbsp;<span class="op" id="7686969">!=</span>&nbsp;<span class="ident" id="7686972">nil</span>&nbsp;<span class="op" id="7686976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686981">t</span><span class="op" id="7686982">.</span><span class="ident" id="7686983">Errorf</span><span class="op" id="7686989">(</span><span class="string" id="7686990">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7687032">,</span>&nbsp;<span class="ident" id="7687034">err</span><span class="op" id="7687037">.</span><span class="ident" id="7687038">Error</span><span class="op" id="7687043">(</span><span class="op" id="7687044">)</span><span class="op" id="7687045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687053">if</span>&nbsp;<span class="ident" id="7687056">reply</span><span class="op" id="7687061">.</span><span class="ident" id="7687062">C</span>&nbsp;<span class="op" id="7687064">!=</span>&nbsp;<span class="ident" id="7687067">args</span><span class="op" id="7687071">.</span><span class="ident" id="7687072">A</span><span class="op" id="7687073">+</span><span class="ident" id="7687074">args</span><span class="op" id="7687078">.</span><span class="ident" id="7687079">B</span>&nbsp;<span class="op" id="7687081">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687086">t</span><span class="op" id="7687087">.</span><span class="ident" id="7687088">Errorf</span><span class="op" id="7687094">(</span><span class="string" id="7687095">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7687120">,</span>&nbsp;<span class="ident" id="7687122">reply</span><span class="op" id="7687127">.</span><span class="ident" id="7687128">C</span><span class="op" id="7687129">,</span>&nbsp;<span class="ident" id="7687131">args</span><span class="op" id="7687135">.</span><span class="ident" id="7687136">A</span><span class="op" id="7687137">+</span><span class="ident" id="7687138">args</span><span class="op" id="7687142">.</span><span class="ident" id="7687143">B</span><span class="op" id="7687144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687151">}</span><span class="op" id="7687152">)</span><br>
<span class="lineno"></span><span class="op" id="7687154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="7687157">func</span>&nbsp;<span class="ident" id="7687162">TestCountMallocs</span><span class="op" id="7687178">(</span><span class="ident" id="7687179">t</span>&nbsp;<span class="op" id="7687181">*</span><span class="ident" id="7687182">testing</span><span class="op" id="7687189">.</span><span class="ident" id="7687190">T</span><span class="op" id="7687191">)</span>&nbsp;<span class="op" id="7687193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687196">if</span>&nbsp;<span class="ident" id="7687199">testing</span><span class="op" id="7687206">.</span><span class="ident" id="7687207">Short</span><span class="op" id="7687212">(</span><span class="op" id="7687213">)</span>&nbsp;<span class="op" id="7687215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687219">t</span><span class="op" id="7687220">.</span><span class="ident" id="7687221">Skip</span><span class="op" id="7687225">(</span><span class="string" id="7687226">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7687263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687269">if</span>&nbsp;<span class="ident" id="7687272">runtime</span><span class="op" id="7687279">.</span><span class="ident" id="7687280">GOMAXPROCS</span><span class="op" id="7687290">(</span><span class="num" id="7687291">0</span><span class="op" id="7687292">)</span>&nbsp;<span class="op" id="7687294">&gt;</span>&nbsp;<span class="num" id="7687296">1</span>&nbsp;<span class="op" id="7687298">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687302">t</span><span class="op" id="7687303">.</span><span class="ident" id="7687304">Skip</span><span class="op" id="7687308">(</span><span class="string" id="7687309">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="7687333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687339">fmt</span><span class="op" id="7687342">.</span><span class="ident" id="7687343">Printf</span><span class="op" id="7687349">(</span><span class="string" id="7687350">&#34;mallocs&nbsp;per&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="7687384">,</span>&nbsp;<span class="ident" id="7687386">countMallocs</span><span class="op" id="7687398">(</span><span class="ident" id="7687399">dialDirect</span><span class="op" id="7687409">,</span>&nbsp;<span class="ident" id="7687411">t</span><span class="op" id="7687412">)</span><span class="op" id="7687413">)</span><br>
<span class="lineno"></span><span class="op" id="7687415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="7687418">func</span>&nbsp;<span class="ident" id="7687423">TestCountMallocsOverHTTP</span><span class="op" id="7687447">(</span><span class="ident" id="7687448">t</span>&nbsp;<span class="op" id="7687450">*</span><span class="ident" id="7687451">testing</span><span class="op" id="7687458">.</span><span class="ident" id="7687459">T</span><span class="op" id="7687460">)</span>&nbsp;<span class="op" id="7687462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687465">if</span>&nbsp;<span class="ident" id="7687468">testing</span><span class="op" id="7687475">.</span><span class="ident" id="7687476">Short</span><span class="op" id="7687481">(</span><span class="op" id="7687482">)</span>&nbsp;<span class="op" id="7687484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687488">t</span><span class="op" id="7687489">.</span><span class="ident" id="7687490">Skip</span><span class="op" id="7687494">(</span><span class="string" id="7687495">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7687532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687538">if</span>&nbsp;<span class="ident" id="7687541">runtime</span><span class="op" id="7687548">.</span><span class="ident" id="7687549">GOMAXPROCS</span><span class="op" id="7687559">(</span><span class="num" id="7687560">0</span><span class="op" id="7687561">)</span>&nbsp;<span class="op" id="7687563">&gt;</span>&nbsp;<span class="num" id="7687565">1</span>&nbsp;<span class="op" id="7687567">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687571">t</span><span class="op" id="7687572">.</span><span class="ident" id="7687573">Skip</span><span class="op" id="7687577">(</span><span class="string" id="7687578">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="7687602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687608">fmt</span><span class="op" id="7687611">.</span><span class="ident" id="7687612">Printf</span><span class="op" id="7687618">(</span><span class="string" id="7687619">&#34;mallocs&nbsp;per&nbsp;HTTP&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="7687658">,</span>&nbsp;<span class="ident" id="7687660">countMallocs</span><span class="op" id="7687672">(</span><span class="ident" id="7687673">dialHTTP</span><span class="op" id="7687681">,</span>&nbsp;<span class="ident" id="7687683">t</span><span class="op" id="7687684">)</span><span class="op" id="7687685">)</span><br>
<span class="lineno"></span><span class="op" id="7687687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="7687690">type</span>&nbsp;<span class="ident" id="7687695">writeCrasher</span>&nbsp;<span class="keyword" id="7687708">struct</span>&nbsp;<span class="op" id="7687715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687718">done</span>&nbsp;<span class="keyword" id="7687723">chan</span>&nbsp;<span class="builtintype" id="7687728">bool</span><br>
<span class="lineno"></span><span class="op" id="7687733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7687736">func</span>&nbsp;<span class="op" id="7687741">(</span><span class="ident" id="7687742">writeCrasher</span><span class="op" id="7687754">)</span>&nbsp;<span class="ident" id="7687756">Close</span><span class="op" id="7687761">(</span><span class="op" id="7687762">)</span>&nbsp;<span class="builtintype" id="7687764">error</span>&nbsp;<span class="op" id="7687770">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687773">return</span>&nbsp;<span class="ident" id="7687780">nil</span><br>
<span class="lineno"></span><span class="op" id="7687784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7687787">func</span>&nbsp;<span class="op" id="7687792">(</span><span class="ident" id="7687793">w</span>&nbsp;<span class="op" id="7687795">*</span><span class="ident" id="7687796">writeCrasher</span><span class="op" id="7687808">)</span>&nbsp;<span class="ident" id="7687810">Read</span><span class="op" id="7687814">(</span><span class="ident" id="7687815">p</span>&nbsp;<span class="op" id="7687817">[</span><span class="op" id="7687818">]</span><span class="builtintype" id="7687819">byte</span><span class="op" id="7687823">)</span>&nbsp;<span class="op" id="7687825">(</span><span class="builtintype" id="7687826">int</span><span class="op" id="7687829">,</span>&nbsp;<span class="builtintype" id="7687831">error</span><span class="op" id="7687836">)</span>&nbsp;<span class="op" id="7687838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687841">&lt;-</span><span class="ident" id="7687843">w</span><span class="op" id="7687844">.</span><span class="ident" id="7687845">done</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687851">return</span>&nbsp;<span class="num" id="7687858">0</span><span class="op" id="7687859">,</span>&nbsp;<span class="ident" id="7687861">io</span><span class="op" id="7687863">.</span><span class="ident" id="7687864">EOF</span><br>
<span class="lineno"></span><span class="op" id="7687868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7687871">func</span>&nbsp;<span class="op" id="7687876">(</span><span class="ident" id="7687877">writeCrasher</span><span class="op" id="7687889">)</span>&nbsp;<span class="ident" id="7687891">Write</span><span class="op" id="7687896">(</span><span class="ident" id="7687897">p</span>&nbsp;<span class="op" id="7687899">[</span><span class="op" id="7687900">]</span><span class="builtintype" id="7687901">byte</span><span class="op" id="7687905">)</span>&nbsp;<span class="op" id="7687907">(</span><span class="builtintype" id="7687908">int</span><span class="op" id="7687911">,</span>&nbsp;<span class="builtintype" id="7687913">error</span><span class="op" id="7687918">)</span>&nbsp;<span class="op" id="7687920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687923">return</span>&nbsp;<span class="num" id="7687930">0</span><span class="op" id="7687931">,</span>&nbsp;<span class="ident" id="7687933">errors</span><span class="op" id="7687939">.</span><span class="ident" id="7687940">New</span><span class="op" id="7687943">(</span><span class="string" id="7687944">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="7687964">)</span><br>
<span class="lineno">540</span><span class="op" id="7687966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7687969">func</span>&nbsp;<span class="ident" id="7687974">TestClientWriteError</span><span class="op" id="7687994">(</span><span class="ident" id="7687995">t</span>&nbsp;<span class="op" id="7687997">*</span><span class="ident" id="7687998">testing</span><span class="op" id="7688005">.</span><span class="ident" id="7688006">T</span><span class="op" id="7688007">)</span>&nbsp;<span class="op" id="7688009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688012">w</span>&nbsp;<span class="op" id="7688014">:=</span>&nbsp;<span class="op" id="7688017">&amp;</span><span class="ident" id="7688018">writeCrasher</span><span class="op" id="7688030">{</span><span class="ident" id="7688031">done</span><span class="op" id="7688035">:</span>&nbsp;<span class="builtinfunc" id="7688037">make</span><span class="op" id="7688041">(</span><span class="keyword" id="7688042">chan</span>&nbsp;<span class="builtintype" id="7688047">bool</span><span class="op" id="7688051">)</span><span class="op" id="7688052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688055">c</span>&nbsp;<span class="op" id="7688057">:=</span>&nbsp;<span class="ident" id="7688060">NewClient</span><span class="op" id="7688069">(</span><span class="ident" id="7688070">w</span><span class="op" id="7688071">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688074">defer</span>&nbsp;<span class="ident" id="7688080">c</span><span class="op" id="7688081">.</span><span class="ident" id="7688082">Close</span><span class="op" id="7688087">(</span><span class="op" id="7688088">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688092">res</span>&nbsp;<span class="op" id="7688096">:=</span>&nbsp;<span class="builtintype" id="7688099">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688106">err</span>&nbsp;<span class="op" id="7688110">:=</span>&nbsp;<span class="ident" id="7688113">c</span><span class="op" id="7688114">.</span><span class="ident" id="7688115">Call</span><span class="op" id="7688119">(</span><span class="string" id="7688120">&#34;foo&#34;</span><span class="op" id="7688125">,</span>&nbsp;<span class="num" id="7688127">1</span><span class="op" id="7688128">,</span>&nbsp;<span class="op" id="7688130">&amp;</span><span class="ident" id="7688131">res</span><span class="op" id="7688134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688137">if</span>&nbsp;<span class="ident" id="7688140">err</span>&nbsp;<span class="op" id="7688144">==</span>&nbsp;<span class="ident" id="7688147">nil</span>&nbsp;<span class="op" id="7688151">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688155">t</span><span class="op" id="7688156">.</span><span class="ident" id="7688157">Fatal</span><span class="op" id="7688162">(</span><span class="string" id="7688163">&#34;expected&nbsp;error&#34;</span><span class="op" id="7688179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688185">if</span>&nbsp;<span class="ident" id="7688188">err</span><span class="op" id="7688191">.</span><span class="ident" id="7688192">Error</span><span class="op" id="7688197">(</span><span class="op" id="7688198">)</span>&nbsp;<span class="op" id="7688200">!=</span>&nbsp;<span class="string" id="7688203">&#34;fake&nbsp;write&nbsp;failure&#34;</span>&nbsp;<span class="op" id="7688224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688228">t</span><span class="op" id="7688229">.</span><span class="ident" id="7688230">Error</span><span class="op" id="7688235">(</span><span class="string" id="7688236">&#34;unexpected&nbsp;value&nbsp;of&nbsp;error:&#34;</span><span class="op" id="7688264">,</span>&nbsp;<span class="ident" id="7688266">err</span><span class="op" id="7688269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688272">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688275">w</span><span class="op" id="7688276">.</span><span class="ident" id="7688277">done</span>&nbsp;<span class="op" id="7688282">&lt;-</span>&nbsp;<span class="builtintype" id="7688285">true</span><br>
<span class="lineno"></span><span class="op" id="7688290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7688293">func</span>&nbsp;<span class="ident" id="7688298">TestTCPClose</span><span class="op" id="7688310">(</span><span class="ident" id="7688311">t</span>&nbsp;<span class="op" id="7688313">*</span><span class="ident" id="7688314">testing</span><span class="op" id="7688321">.</span><span class="ident" id="7688322">T</span><span class="op" id="7688323">)</span>&nbsp;<span class="op" id="7688325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688328">once</span><span class="op" id="7688332">.</span><span class="ident" id="7688333">Do</span><span class="op" id="7688335">(</span><span class="ident" id="7688336">startServer</span><span class="op" id="7688347">)</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688351">client</span><span class="op" id="7688357">,</span>&nbsp;<span class="ident" id="7688359">err</span>&nbsp;<span class="op" id="7688363">:=</span>&nbsp;<span class="ident" id="7688366">dialHTTP</span><span class="op" id="7688374">(</span><span class="op" id="7688375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688378">if</span>&nbsp;<span class="ident" id="7688381">err</span>&nbsp;<span class="op" id="7688385">!=</span>&nbsp;<span class="ident" id="7688388">nil</span>&nbsp;<span class="op" id="7688392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688396">t</span><span class="op" id="7688397">.</span><span class="ident" id="7688398">Fatalf</span><span class="op" id="7688404">(</span><span class="string" id="7688405">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="7688418">,</span>&nbsp;<span class="ident" id="7688420">err</span><span class="op" id="7688423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688426">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688429">defer</span>&nbsp;<span class="ident" id="7688435">client</span><span class="op" id="7688441">.</span><span class="ident" id="7688442">Close</span><span class="op" id="7688447">(</span><span class="op" id="7688448">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688452">args</span>&nbsp;<span class="op" id="7688457">:=</span>&nbsp;<span class="ident" id="7688460">Args</span><span class="op" id="7688464">{</span><span class="num" id="7688465">17</span><span class="op" id="7688467">,</span>&nbsp;<span class="num" id="7688469">8</span><span class="op" id="7688470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688473">var</span>&nbsp;<span class="ident" id="7688477">reply</span>&nbsp;<span class="ident" id="7688483">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688490">err</span>&nbsp;<span class="op" id="7688494">=</span>&nbsp;<span class="ident" id="7688496">client</span><span class="op" id="7688502">.</span><span class="ident" id="7688503">Call</span><span class="op" id="7688507">(</span><span class="string" id="7688508">&#34;Arith.Mul&#34;</span><span class="op" id="7688519">,</span>&nbsp;<span class="ident" id="7688521">args</span><span class="op" id="7688525">,</span>&nbsp;<span class="op" id="7688527">&amp;</span><span class="ident" id="7688528">reply</span><span class="op" id="7688533">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688536">if</span>&nbsp;<span class="ident" id="7688539">err</span>&nbsp;<span class="op" id="7688543">!=</span>&nbsp;<span class="ident" id="7688546">nil</span>&nbsp;<span class="op" id="7688550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688554">t</span><span class="op" id="7688555">.</span><span class="ident" id="7688556">Fatal</span><span class="op" id="7688561">(</span><span class="string" id="7688562">&#34;arith&nbsp;error:&#34;</span><span class="op" id="7688576">,</span>&nbsp;<span class="ident" id="7688578">err</span><span class="op" id="7688581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688587">t</span><span class="op" id="7688588">.</span><span class="ident" id="7688589">Logf</span><span class="op" id="7688593">(</span><span class="string" id="7688594">&#34;Arith:&nbsp;%d*%d=%d\n&#34;</span><span class="op" id="7688613">,</span>&nbsp;<span class="ident" id="7688615">args</span><span class="op" id="7688619">.</span><span class="ident" id="7688620">A</span><span class="op" id="7688621">,</span>&nbsp;<span class="ident" id="7688623">args</span><span class="op" id="7688627">.</span><span class="ident" id="7688628">B</span><span class="op" id="7688629">,</span>&nbsp;<span class="ident" id="7688631">reply</span><span class="op" id="7688636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688639">if</span>&nbsp;<span class="ident" id="7688642">reply</span><span class="op" id="7688647">.</span><span class="ident" id="7688648">C</span>&nbsp;<span class="op" id="7688650">!=</span>&nbsp;<span class="ident" id="7688653">args</span><span class="op" id="7688657">.</span><span class="ident" id="7688658">A</span><span class="op" id="7688659">*</span><span class="ident" id="7688660">args</span><span class="op" id="7688664">.</span><span class="ident" id="7688665">B</span>&nbsp;<span class="op" id="7688667">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688671">t</span><span class="op" id="7688672">.</span><span class="ident" id="7688673">Errorf</span><span class="op" id="7688679">(</span><span class="string" id="7688680">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7688705">,</span>&nbsp;<span class="ident" id="7688707">reply</span><span class="op" id="7688712">.</span><span class="ident" id="7688713">C</span><span class="op" id="7688714">,</span>&nbsp;<span class="ident" id="7688716">args</span><span class="op" id="7688720">.</span><span class="ident" id="7688721">A</span><span class="op" id="7688722">*</span><span class="ident" id="7688723">args</span><span class="op" id="7688727">.</span><span class="ident" id="7688728">B</span><span class="op" id="7688729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688732">}</span><br>
<span class="lineno"></span><span class="op" id="7688734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7688737">func</span>&nbsp;<span class="ident" id="7688742">TestErrorAfterClientClose</span><span class="op" id="7688767">(</span><span class="ident" id="7688768">t</span>&nbsp;<span class="op" id="7688770">*</span><span class="ident" id="7688771">testing</span><span class="op" id="7688778">.</span><span class="ident" id="7688779">T</span><span class="op" id="7688780">)</span>&nbsp;<span class="op" id="7688782">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688785">once</span><span class="op" id="7688789">.</span><span class="ident" id="7688790">Do</span><span class="op" id="7688792">(</span><span class="ident" id="7688793">startServer</span><span class="op" id="7688804">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688808">client</span><span class="op" id="7688814">,</span>&nbsp;<span class="ident" id="7688816">err</span>&nbsp;<span class="op" id="7688820">:=</span>&nbsp;<span class="ident" id="7688823">dialHTTP</span><span class="op" id="7688831">(</span><span class="op" id="7688832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688835">if</span>&nbsp;<span class="ident" id="7688838">err</span>&nbsp;<span class="op" id="7688842">!=</span>&nbsp;<span class="ident" id="7688845">nil</span>&nbsp;<span class="op" id="7688849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688853">t</span><span class="op" id="7688854">.</span><span class="ident" id="7688855">Fatalf</span><span class="op" id="7688861">(</span><span class="string" id="7688862">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="7688875">,</span>&nbsp;<span class="ident" id="7688877">err</span><span class="op" id="7688880">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688886">err</span>&nbsp;<span class="op" id="7688890">=</span>&nbsp;<span class="ident" id="7688892">client</span><span class="op" id="7688898">.</span><span class="ident" id="7688899">Close</span><span class="op" id="7688904">(</span><span class="op" id="7688905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688908">if</span>&nbsp;<span class="ident" id="7688911">err</span>&nbsp;<span class="op" id="7688915">!=</span>&nbsp;<span class="ident" id="7688918">nil</span>&nbsp;<span class="op" id="7688922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688926">t</span><span class="op" id="7688927">.</span><span class="ident" id="7688928">Fatal</span><span class="op" id="7688933">(</span><span class="string" id="7688934">&#34;close&nbsp;error:&#34;</span><span class="op" id="7688948">,</span>&nbsp;<span class="ident" id="7688950">err</span><span class="op" id="7688953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688956">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688959">err</span>&nbsp;<span class="op" id="7688963">=</span>&nbsp;<span class="ident" id="7688965">client</span><span class="op" id="7688971">.</span><span class="ident" id="7688972">Call</span><span class="op" id="7688976">(</span><span class="string" id="7688977">&#34;Arith.Add&#34;</span><span class="op" id="7688988">,</span>&nbsp;<span class="op" id="7688990">&amp;</span><span class="ident" id="7688991">Args</span><span class="op" id="7688995">{</span><span class="num" id="7688996">7</span><span class="op" id="7688997">,</span>&nbsp;<span class="num" id="7688999">9</span><span class="op" id="7689000">}</span><span class="op" id="7689001">,</span>&nbsp;<span class="builtinfunc" id="7689003">new</span><span class="op" id="7689006">(</span><span class="ident" id="7689007">Reply</span><span class="op" id="7689012">)</span><span class="op" id="7689013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689016">if</span>&nbsp;<span class="ident" id="7689019">err</span>&nbsp;<span class="op" id="7689023">!=</span>&nbsp;<span class="ident" id="7689026">ErrShutdown</span>&nbsp;<span class="op" id="7689038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689042">t</span><span class="op" id="7689043">.</span><span class="ident" id="7689044">Errorf</span><span class="op" id="7689050">(</span><span class="string" id="7689051">&#34;Forever:&nbsp;expected&nbsp;ErrShutdown&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7689089">,</span>&nbsp;<span class="ident" id="7689091">err</span><span class="op" id="7689094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689097">}</span><br>
<span class="lineno"></span><span class="op" id="7689099">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="7689102">func</span>&nbsp;<span class="ident" id="7689107">benchmarkEndToEnd</span><span class="op" id="7689124">(</span><span class="ident" id="7689125">dial</span>&nbsp;<span class="keyword" id="7689130">func</span><span class="op" id="7689134">(</span><span class="op" id="7689135">)</span>&nbsp;<span class="op" id="7689137">(</span><span class="op" id="7689138">*</span><span class="ident" id="7689139">Client</span><span class="op" id="7689145">,</span>&nbsp;<span class="builtintype" id="7689147">error</span><span class="op" id="7689152">)</span><span class="op" id="7689153">,</span>&nbsp;<span class="ident" id="7689155">b</span>&nbsp;<span class="op" id="7689157">*</span><span class="ident" id="7689158">testing</span><span class="op" id="7689165">.</span><span class="ident" id="7689166">B</span><span class="op" id="7689167">)</span>&nbsp;<span class="op" id="7689169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689172">once</span><span class="op" id="7689176">.</span><span class="ident" id="7689177">Do</span><span class="op" id="7689179">(</span><span class="ident" id="7689180">startServer</span><span class="op" id="7689191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689194">client</span><span class="op" id="7689200">,</span>&nbsp;<span class="ident" id="7689202">err</span>&nbsp;<span class="op" id="7689206">:=</span>&nbsp;<span class="ident" id="7689209">dial</span><span class="op" id="7689213">(</span><span class="op" id="7689214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689217">if</span>&nbsp;<span class="ident" id="7689220">err</span>&nbsp;<span class="op" id="7689224">!=</span>&nbsp;<span class="ident" id="7689227">nil</span>&nbsp;<span class="op" id="7689231">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689235">b</span><span class="op" id="7689236">.</span><span class="ident" id="7689237">Fatal</span><span class="op" id="7689242">(</span><span class="string" id="7689243">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="7689259">,</span>&nbsp;<span class="ident" id="7689261">err</span><span class="op" id="7689264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689270">defer</span>&nbsp;<span class="ident" id="7689276">client</span><span class="op" id="7689282">.</span><span class="ident" id="7689283">Close</span><span class="op" id="7689288">(</span><span class="op" id="7689289">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7689293">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689315">args</span>&nbsp;<span class="op" id="7689320">:=</span>&nbsp;<span class="op" id="7689323">&amp;</span><span class="ident" id="7689324">Args</span><span class="op" id="7689328">{</span><span class="num" id="7689329">7</span><span class="op" id="7689330">,</span>&nbsp;<span class="num" id="7689332">8</span><span class="op" id="7689333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689336">b</span><span class="op" id="7689337">.</span><span class="ident" id="7689338">ResetTimer</span><span class="op" id="7689348">(</span><span class="op" id="7689349">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689353">b</span><span class="op" id="7689354">.</span><span class="ident" id="7689355">RunParallel</span><span class="op" id="7689366">(</span><span class="keyword" id="7689367">func</span><span class="op" id="7689371">(</span><span class="ident" id="7689372">pb</span>&nbsp;<span class="op" id="7689375">*</span><span class="ident" id="7689376">testing</span><span class="op" id="7689383">.</span><span class="ident" id="7689384">PB</span><span class="op" id="7689386">)</span>&nbsp;<span class="op" id="7689388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689392">reply</span>&nbsp;<span class="op" id="7689398">:=</span>&nbsp;<span class="builtinfunc" id="7689401">new</span><span class="op" id="7689404">(</span><span class="ident" id="7689405">Reply</span><span class="op" id="7689410">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689414">for</span>&nbsp;<span class="ident" id="7689418">pb</span><span class="op" id="7689420">.</span><span class="ident" id="7689421">Next</span><span class="op" id="7689425">(</span><span class="op" id="7689426">)</span>&nbsp;<span class="op" id="7689428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689433">err</span>&nbsp;<span class="op" id="7689437">:=</span>&nbsp;<span class="ident" id="7689440">client</span><span class="op" id="7689446">.</span><span class="ident" id="7689447">Call</span><span class="op" id="7689451">(</span><span class="string" id="7689452">&#34;Arith.Add&#34;</span><span class="op" id="7689463">,</span>&nbsp;<span class="ident" id="7689465">args</span><span class="op" id="7689469">,</span>&nbsp;<span class="ident" id="7689471">reply</span><span class="op" id="7689476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689481">if</span>&nbsp;<span class="ident" id="7689484">err</span>&nbsp;<span class="op" id="7689488">!=</span>&nbsp;<span class="ident" id="7689491">nil</span>&nbsp;<span class="op" id="7689495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689501">b</span><span class="op" id="7689502">.</span><span class="ident" id="7689503">Fatalf</span><span class="op" id="7689509">(</span><span class="string" id="7689510">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7689563">,</span>&nbsp;<span class="ident" id="7689565">err</span><span class="op" id="7689568">.</span><span class="ident" id="7689569">Error</span><span class="op" id="7689574">(</span><span class="op" id="7689575">)</span><span class="op" id="7689576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689581">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689586">if</span>&nbsp;<span class="ident" id="7689589">reply</span><span class="op" id="7689594">.</span><span class="ident" id="7689595">C</span>&nbsp;<span class="op" id="7689597">!=</span>&nbsp;<span class="ident" id="7689600">args</span><span class="op" id="7689604">.</span><span class="ident" id="7689605">A</span><span class="op" id="7689606">+</span><span class="ident" id="7689607">args</span><span class="op" id="7689611">.</span><span class="ident" id="7689612">B</span>&nbsp;<span class="op" id="7689614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689620">b</span><span class="op" id="7689621">.</span><span class="ident" id="7689622">Fatalf</span><span class="op" id="7689628">(</span><span class="string" id="7689629">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7689665">,</span>&nbsp;<span class="ident" id="7689667">reply</span><span class="op" id="7689672">.</span><span class="ident" id="7689673">C</span><span class="op" id="7689674">,</span>&nbsp;<span class="ident" id="7689676">args</span><span class="op" id="7689680">.</span><span class="ident" id="7689681">A</span><span class="op" id="7689682">+</span><span class="ident" id="7689683">args</span><span class="op" id="7689687">.</span><span class="ident" id="7689688">B</span><span class="op" id="7689689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689701">}</span><span class="op" id="7689702">)</span><br>
<span class="lineno">620</span><span class="op" id="7689704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7689707">func</span>&nbsp;<span class="ident" id="7689712">benchmarkEndToEndAsync</span><span class="op" id="7689734">(</span><span class="ident" id="7689735">dial</span>&nbsp;<span class="keyword" id="7689740">func</span><span class="op" id="7689744">(</span><span class="op" id="7689745">)</span>&nbsp;<span class="op" id="7689747">(</span><span class="op" id="7689748">*</span><span class="ident" id="7689749">Client</span><span class="op" id="7689755">,</span>&nbsp;<span class="builtintype" id="7689757">error</span><span class="op" id="7689762">)</span><span class="op" id="7689763">,</span>&nbsp;<span class="ident" id="7689765">b</span>&nbsp;<span class="op" id="7689767">*</span><span class="ident" id="7689768">testing</span><span class="op" id="7689775">.</span><span class="ident" id="7689776">B</span><span class="op" id="7689777">)</span>&nbsp;<span class="op" id="7689779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689782">const</span>&nbsp;<span class="ident" id="7689788">MaxConcurrentCalls</span>&nbsp;<span class="op" id="7689807">=</span>&nbsp;<span class="num" id="7689809">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689814">once</span><span class="op" id="7689818">.</span><span class="ident" id="7689819">Do</span><span class="op" id="7689821">(</span><span class="ident" id="7689822">startServer</span><span class="op" id="7689833">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689836">client</span><span class="op" id="7689842">,</span>&nbsp;<span class="ident" id="7689844">err</span>&nbsp;<span class="op" id="7689848">:=</span>&nbsp;<span class="ident" id="7689851">dial</span><span class="op" id="7689855">(</span><span class="op" id="7689856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689859">if</span>&nbsp;<span class="ident" id="7689862">err</span>&nbsp;<span class="op" id="7689866">!=</span>&nbsp;<span class="ident" id="7689869">nil</span>&nbsp;<span class="op" id="7689873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689877">b</span><span class="op" id="7689878">.</span><span class="ident" id="7689879">Fatal</span><span class="op" id="7689884">(</span><span class="string" id="7689885">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="7689901">,</span>&nbsp;<span class="ident" id="7689903">err</span><span class="op" id="7689906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689912">defer</span>&nbsp;<span class="ident" id="7689918">client</span><span class="op" id="7689924">.</span><span class="ident" id="7689925">Close</span><span class="op" id="7689930">(</span><span class="op" id="7689931">)</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7689935">//&nbsp;Asynchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689958">args</span>&nbsp;<span class="op" id="7689963">:=</span>&nbsp;<span class="op" id="7689966">&amp;</span><span class="ident" id="7689967">Args</span><span class="op" id="7689971">{</span><span class="num" id="7689972">7</span><span class="op" id="7689973">,</span>&nbsp;<span class="num" id="7689975">8</span><span class="op" id="7689976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689979">procs</span>&nbsp;<span class="op" id="7689985">:=</span>&nbsp;<span class="num" id="7689988">4</span>&nbsp;<span class="op" id="7689990">*</span>&nbsp;<span class="ident" id="7689992">runtime</span><span class="op" id="7689999">.</span><span class="ident" id="7690000">GOMAXPROCS</span><span class="op" id="7690010">(</span><span class="op" id="7690011">-</span><span class="num" id="7690012">1</span><span class="op" id="7690013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690016">send</span>&nbsp;<span class="op" id="7690021">:=</span>&nbsp;<span class="builtintype" id="7690024">int32</span><span class="op" id="7690029">(</span><span class="ident" id="7690030">b</span><span class="op" id="7690031">.</span><span class="ident" id="7690032">N</span><span class="op" id="7690033">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690036">recv</span>&nbsp;<span class="op" id="7690041">:=</span>&nbsp;<span class="builtintype" id="7690044">int32</span><span class="op" id="7690049">(</span><span class="ident" id="7690050">b</span><span class="op" id="7690051">.</span><span class="ident" id="7690052">N</span><span class="op" id="7690053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690056">var</span>&nbsp;<span class="ident" id="7690060">wg</span>&nbsp;<span class="ident" id="7690063">sync</span><span class="op" id="7690067">.</span><span class="ident" id="7690068">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690079">wg</span><span class="op" id="7690081">.</span><span class="ident" id="7690082">Add</span><span class="op" id="7690085">(</span><span class="ident" id="7690086">procs</span><span class="op" id="7690091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690094">gate</span>&nbsp;<span class="op" id="7690099">:=</span>&nbsp;<span class="builtinfunc" id="7690102">make</span><span class="op" id="7690106">(</span><span class="keyword" id="7690107">chan</span>&nbsp;<span class="builtintype" id="7690112">bool</span><span class="op" id="7690116">,</span>&nbsp;<span class="ident" id="7690118">MaxConcurrentCalls</span><span class="op" id="7690136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690139">res</span>&nbsp;<span class="op" id="7690143">:=</span>&nbsp;<span class="builtinfunc" id="7690146">make</span><span class="op" id="7690150">(</span><span class="keyword" id="7690151">chan</span>&nbsp;<span class="op" id="7690156">*</span><span class="ident" id="7690157">Call</span><span class="op" id="7690161">,</span>&nbsp;<span class="ident" id="7690163">MaxConcurrentCalls</span><span class="op" id="7690181">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690184">b</span><span class="op" id="7690185">.</span><span class="ident" id="7690186">ResetTimer</span><span class="op" id="7690196">(</span><span class="op" id="7690197">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690201">for</span>&nbsp;<span class="ident" id="7690205">p</span>&nbsp;<span class="op" id="7690207">:=</span>&nbsp;<span class="num" id="7690210">0</span><span class="op" id="7690211">;</span>&nbsp;<span class="ident" id="7690213">p</span>&nbsp;<span class="op" id="7690215">&lt;</span>&nbsp;<span class="ident" id="7690217">procs</span><span class="op" id="7690222">;</span>&nbsp;<span class="ident" id="7690224">p</span><span class="op" id="7690225">++</span>&nbsp;<span class="op" id="7690228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690232">go</span>&nbsp;<span class="keyword" id="7690235">func</span><span class="op" id="7690239">(</span><span class="op" id="7690240">)</span>&nbsp;<span class="op" id="7690242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690247">for</span>&nbsp;<span class="ident" id="7690251">atomic</span><span class="op" id="7690257">.</span><span class="ident" id="7690258">AddInt32</span><span class="op" id="7690266">(</span><span class="op" id="7690267">&amp;</span><span class="ident" id="7690268">send</span><span class="op" id="7690272">,</span>&nbsp;<span class="op" id="7690274">-</span><span class="num" id="7690275">1</span><span class="op" id="7690276">)</span>&nbsp;<span class="op" id="7690278">&gt;=</span>&nbsp;<span class="num" id="7690281">0</span>&nbsp;<span class="op" id="7690283">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690289">gate</span>&nbsp;<span class="op" id="7690294">&lt;-</span>&nbsp;<span class="builtintype" id="7690297">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690306">reply</span>&nbsp;<span class="op" id="7690312">:=</span>&nbsp;<span class="builtinfunc" id="7690315">new</span><span class="op" id="7690318">(</span><span class="ident" id="7690319">Reply</span><span class="op" id="7690324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690330">client</span><span class="op" id="7690336">.</span><span class="ident" id="7690337">Go</span><span class="op" id="7690339">(</span><span class="string" id="7690340">&#34;Arith.Add&#34;</span><span class="op" id="7690351">,</span>&nbsp;<span class="ident" id="7690353">args</span><span class="op" id="7690357">,</span>&nbsp;<span class="ident" id="7690359">reply</span><span class="op" id="7690364">,</span>&nbsp;<span class="ident" id="7690366">res</span><span class="op" id="7690369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690378">}</span><span class="op" id="7690379">(</span><span class="op" id="7690380">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690384">go</span>&nbsp;<span class="keyword" id="7690387">func</span><span class="op" id="7690391">(</span><span class="op" id="7690392">)</span>&nbsp;<span class="op" id="7690394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690399">for</span>&nbsp;<span class="ident" id="7690403">call</span>&nbsp;<span class="op" id="7690408">:=</span>&nbsp;<span class="keyword" id="7690411">range</span>&nbsp;<span class="ident" id="7690417">res</span>&nbsp;<span class="op" id="7690421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690427">A</span>&nbsp;<span class="op" id="7690429">:=</span>&nbsp;<span class="ident" id="7690432">call</span><span class="op" id="7690436">.</span><span class="ident" id="7690437">Args</span><span class="op" id="7690441">.</span><span class="op" id="7690442">(</span><span class="op" id="7690443">*</span><span class="ident" id="7690444">Args</span><span class="op" id="7690448">)</span><span class="op" id="7690449">.</span><span class="ident" id="7690450">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690456">B</span>&nbsp;<span class="op" id="7690458">:=</span>&nbsp;<span class="ident" id="7690461">call</span><span class="op" id="7690465">.</span><span class="ident" id="7690466">Args</span><span class="op" id="7690470">.</span><span class="op" id="7690471">(</span><span class="op" id="7690472">*</span><span class="ident" id="7690473">Args</span><span class="op" id="7690477">)</span><span class="op" id="7690478">.</span><span class="ident" id="7690479">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690485">C</span>&nbsp;<span class="op" id="7690487">:=</span>&nbsp;<span class="ident" id="7690490">call</span><span class="op" id="7690494">.</span><span class="ident" id="7690495">Reply</span><span class="op" id="7690500">.</span><span class="op" id="7690501">(</span><span class="op" id="7690502">*</span><span class="ident" id="7690503">Reply</span><span class="op" id="7690508">)</span><span class="op" id="7690509">.</span><span class="ident" id="7690510">C</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690516">if</span>&nbsp;<span class="ident" id="7690519">A</span><span class="op" id="7690520">+</span><span class="ident" id="7690521">B</span>&nbsp;<span class="op" id="7690523">!=</span>&nbsp;<span class="ident" id="7690526">C</span>&nbsp;<span class="op" id="7690528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690535">b</span><span class="op" id="7690536">.</span><span class="ident" id="7690537">Fatalf</span><span class="op" id="7690543">(</span><span class="string" id="7690544">&#34;incorrect&nbsp;reply:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7690586">,</span>&nbsp;<span class="ident" id="7690588">A</span><span class="op" id="7690589">+</span><span class="ident" id="7690590">B</span><span class="op" id="7690591">,</span>&nbsp;<span class="ident" id="7690593">C</span><span class="op" id="7690594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690606">&lt;-</span><span class="ident" id="7690608">gate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690617">if</span>&nbsp;<span class="ident" id="7690620">atomic</span><span class="op" id="7690626">.</span><span class="ident" id="7690627">AddInt32</span><span class="op" id="7690635">(</span><span class="op" id="7690636">&amp;</span><span class="ident" id="7690637">recv</span><span class="op" id="7690641">,</span>&nbsp;<span class="op" id="7690643">-</span><span class="num" id="7690644">1</span><span class="op" id="7690645">)</span>&nbsp;<span class="op" id="7690647">==</span>&nbsp;<span class="num" id="7690650">0</span>&nbsp;<span class="op" id="7690652">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7690659">close</span><span class="op" id="7690664">(</span><span class="ident" id="7690665">res</span><span class="op" id="7690668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690684">wg</span><span class="op" id="7690686">.</span><span class="ident" id="7690687">Done</span><span class="op" id="7690691">(</span><span class="op" id="7690692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690696">}</span><span class="op" id="7690697">(</span><span class="op" id="7690698">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690704">wg</span><span class="op" id="7690706">.</span><span class="ident" id="7690707">Wait</span><span class="op" id="7690711">(</span><span class="op" id="7690712">)</span><br>
<span class="lineno"></span><span class="op" id="7690714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7690717">func</span>&nbsp;<span class="ident" id="7690722">BenchmarkEndToEnd</span><span class="op" id="7690739">(</span><span class="ident" id="7690740">b</span>&nbsp;<span class="op" id="7690742">*</span><span class="ident" id="7690743">testing</span><span class="op" id="7690750">.</span><span class="ident" id="7690751">B</span><span class="op" id="7690752">)</span>&nbsp;<span class="op" id="7690754">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690757">benchmarkEndToEnd</span><span class="op" id="7690774">(</span><span class="ident" id="7690775">dialDirect</span><span class="op" id="7690785">,</span>&nbsp;<span class="ident" id="7690787">b</span><span class="op" id="7690788">)</span><br>
<span class="lineno"></span><span class="op" id="7690790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7690793">func</span>&nbsp;<span class="ident" id="7690798">BenchmarkEndToEndHTTP</span><span class="op" id="7690819">(</span><span class="ident" id="7690820">b</span>&nbsp;<span class="op" id="7690822">*</span><span class="ident" id="7690823">testing</span><span class="op" id="7690830">.</span><span class="ident" id="7690831">B</span><span class="op" id="7690832">)</span>&nbsp;<span class="op" id="7690834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690837">benchmarkEndToEnd</span><span class="op" id="7690854">(</span><span class="ident" id="7690855">dialHTTP</span><span class="op" id="7690863">,</span>&nbsp;<span class="ident" id="7690865">b</span><span class="op" id="7690866">)</span><br>
<span class="lineno">675</span><span class="op" id="7690868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7690871">func</span>&nbsp;<span class="ident" id="7690876">BenchmarkEndToEndAsync</span><span class="op" id="7690898">(</span><span class="ident" id="7690899">b</span>&nbsp;<span class="op" id="7690901">*</span><span class="ident" id="7690902">testing</span><span class="op" id="7690909">.</span><span class="ident" id="7690910">B</span><span class="op" id="7690911">)</span>&nbsp;<span class="op" id="7690913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690916">benchmarkEndToEndAsync</span><span class="op" id="7690938">(</span><span class="ident" id="7690939">dialDirect</span><span class="op" id="7690949">,</span>&nbsp;<span class="ident" id="7690951">b</span><span class="op" id="7690952">)</span><br>
<span class="lineno"></span><span class="op" id="7690954">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="7690957">func</span>&nbsp;<span class="ident" id="7690962">BenchmarkEndToEndAsyncHTTP</span><span class="op" id="7690988">(</span><span class="ident" id="7690989">b</span>&nbsp;<span class="op" id="7690991">*</span><span class="ident" id="7690992">testing</span><span class="op" id="7690999">.</span><span class="ident" id="7691000">B</span><span class="op" id="7691001">)</span>&nbsp;<span class="op" id="7691003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691006">benchmarkEndToEndAsync</span><span class="op" id="7691028">(</span><span class="ident" id="7691029">dialHTTP</span><span class="op" id="7691037">,</span>&nbsp;<span class="ident" id="7691039">b</span><span class="op" id="7691040">)</span><br>
<span class="lineno"></span><span class="op" id="7691042">}</span>
</div>
</body>
</html>
