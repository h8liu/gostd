<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/tabwriter</h2>
<ul>
<li><a href="/gostd/text/tabwriter/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter.go.html" class="current">tabwriter.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter_test.go.html">tabwriter_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4608084">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4608139">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4608193">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4608244">//&nbsp;Package&nbsp;tabwriter&nbsp;implements&nbsp;a&nbsp;write&nbsp;filter&nbsp;(tabwriter.Writer)&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4608315">//&nbsp;translates&nbsp;tabbed&nbsp;columns&nbsp;in&nbsp;input&nbsp;into&nbsp;properly&nbsp;aligned&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="4608381">//</span><br>
<span class="lineno"></span><span class="comment" id="4608384">//&nbsp;The&nbsp;package&nbsp;is&nbsp;using&nbsp;the&nbsp;Elastic&nbsp;Tabstops&nbsp;algorithm&nbsp;described&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="4608452">//&nbsp;http://nickgravgaard.com/elastictabstops/index.html.</span><br>
<span class="lineno">10</span><span class="comment" id="4608508">//</span><br>
<span class="lineno"></span><span class="keyword" id="4608511">package</span>&nbsp;<span class="ident" id="4608519">tabwriter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4608530">import</span>&nbsp;<span class="op" id="4608537">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4608540">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4608549">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4608555">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4608570">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4608573">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">20</span><span class="comment" id="4608653">//&nbsp;Filter&nbsp;implementation</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4608679">//&nbsp;A&nbsp;cell&nbsp;represents&nbsp;a&nbsp;segment&nbsp;of&nbsp;text&nbsp;terminated&nbsp;by&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks.</span><br>
<span class="lineno"></span><span class="comment" id="4608753">//&nbsp;The&nbsp;text&nbsp;itself&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;separate&nbsp;buffer;&nbsp;cell&nbsp;only&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4608828">//&nbsp;segment&#39;s&nbsp;size&nbsp;in&nbsp;bytes,&nbsp;its&nbsp;width&nbsp;in&nbsp;runes,&nbsp;and&nbsp;whether&nbsp;it&#39;s&nbsp;an&nbsp;htab</span><br>
<span class="lineno">25</span><span class="comment" id="4608901">//&nbsp;(&#39;\t&#39;)&nbsp;terminated&nbsp;cell.</span><br>
<span class="lineno"></span><span class="comment" id="4608928">//</span><br>
<span class="lineno"></span><span class="keyword" id="4608931">type</span>&nbsp;<span class="ident" id="4608936">cell</span>&nbsp;<span class="keyword" id="4608941">struct</span>&nbsp;<span class="op" id="4608948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4608951">size</span>&nbsp;&nbsp;<span class="builtintype" id="4608957">int</span>&nbsp;&nbsp;<span class="comment" id="4608962">//&nbsp;cell&nbsp;size&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4608985">width</span>&nbsp;<span class="builtintype" id="4608991">int</span>&nbsp;&nbsp;<span class="comment" id="4608996">//&nbsp;cell&nbsp;width&nbsp;in&nbsp;runes</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4609020">htab</span>&nbsp;&nbsp;<span class="builtintype" id="4609026">bool</span>&nbsp;<span class="comment" id="4609031">//&nbsp;true&nbsp;if&nbsp;the&nbsp;cell&nbsp;is&nbsp;terminated&nbsp;by&nbsp;an&nbsp;htab&nbsp;(&#39;\t&#39;)</span><br>
<span class="lineno"></span><span class="op" id="4609083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4609086">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;filter&nbsp;that&nbsp;inserts&nbsp;padding&nbsp;around&nbsp;tab-delimited</span><br>
<span class="lineno"></span><span class="comment" id="4609152">//&nbsp;columns&nbsp;in&nbsp;its&nbsp;input&nbsp;to&nbsp;align&nbsp;them&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno">35</span><span class="comment" id="4609205">//</span><br>
<span class="lineno"></span><span class="comment" id="4609208">//&nbsp;The&nbsp;Writer&nbsp;treats&nbsp;incoming&nbsp;bytes&nbsp;as&nbsp;UTF-8&nbsp;encoded&nbsp;text&nbsp;consisting</span><br>
<span class="lineno"></span><span class="comment" id="4609277">//&nbsp;of&nbsp;cells&nbsp;terminated&nbsp;by&nbsp;(horizontal&nbsp;or&nbsp;vertical)&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4609341">//&nbsp;breaks&nbsp;(newline&nbsp;or&nbsp;formfeed&nbsp;characters).&nbsp;Cells&nbsp;in&nbsp;adjacent&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="4609409">//&nbsp;constitute&nbsp;a&nbsp;column.&nbsp;The&nbsp;Writer&nbsp;inserts&nbsp;padding&nbsp;as&nbsp;needed&nbsp;to</span><br>
<span class="lineno">40</span><span class="comment" id="4609473">//&nbsp;make&nbsp;all&nbsp;cells&nbsp;in&nbsp;a&nbsp;column&nbsp;have&nbsp;the&nbsp;same&nbsp;width,&nbsp;effectively</span><br>
<span class="lineno"></span><span class="comment" id="4609536">//&nbsp;aligning&nbsp;the&nbsp;columns.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;all&nbsp;characters&nbsp;have&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4609601">//&nbsp;same&nbsp;width&nbsp;except&nbsp;for&nbsp;tabs&nbsp;for&nbsp;which&nbsp;a&nbsp;tabwidth&nbsp;must&nbsp;be&nbsp;specified.</span><br>
<span class="lineno"></span><span class="comment" id="4609671">//&nbsp;Note&nbsp;that&nbsp;cells&nbsp;are&nbsp;tab-terminated,&nbsp;not&nbsp;tab-separated:&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="4609738">//&nbsp;non-tab&nbsp;text&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;does&nbsp;not&nbsp;form&nbsp;a&nbsp;column&nbsp;cell.</span><br>
<span class="lineno">45</span><span class="comment" id="4609804">//</span><br>
<span class="lineno"></span><span class="comment" id="4609807">//&nbsp;The&nbsp;Writer&nbsp;assumes&nbsp;that&nbsp;all&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;have&nbsp;the&nbsp;same&nbsp;width;</span><br>
<span class="lineno"></span><span class="comment" id="4609879">//&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;true&nbsp;in&nbsp;some&nbsp;fonts.</span><br>
<span class="lineno"></span><span class="comment" id="4609918">//</span><br>
<span class="lineno"></span><span class="comment" id="4609921">//&nbsp;If&nbsp;DiscardEmptyColumns&nbsp;is&nbsp;set,&nbsp;empty&nbsp;columns&nbsp;that&nbsp;are&nbsp;terminated</span><br>
<span class="lineno">50</span><span class="comment" id="4609989">//&nbsp;entirely&nbsp;by&nbsp;vertical&nbsp;(or&nbsp;&#34;soft&#34;)&nbsp;tabs&nbsp;are&nbsp;discarded.&nbsp;Columns</span><br>
<span class="lineno"></span><span class="comment" id="4610053">//&nbsp;terminated&nbsp;by&nbsp;horizontal&nbsp;(or&nbsp;&#34;hard&#34;)&nbsp;tabs&nbsp;are&nbsp;not&nbsp;affected&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4610118">//&nbsp;this&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="4610132">//</span><br>
<span class="lineno"></span><span class="comment" id="4610135">//&nbsp;If&nbsp;a&nbsp;Writer&nbsp;is&nbsp;configured&nbsp;to&nbsp;filter&nbsp;HTML,&nbsp;HTML&nbsp;tags&nbsp;and&nbsp;entities</span><br>
<span class="lineno">55</span><span class="comment" id="4610203">//&nbsp;are&nbsp;passed&nbsp;through.&nbsp;The&nbsp;widths&nbsp;of&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4610262">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;(tags)&nbsp;and&nbsp;one&nbsp;(entities)&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4610335">//</span><br>
<span class="lineno"></span><span class="comment" id="4610338">//&nbsp;A&nbsp;segment&nbsp;of&nbsp;text&nbsp;may&nbsp;be&nbsp;escaped&nbsp;by&nbsp;bracketing&nbsp;it&nbsp;with&nbsp;Escape</span><br>
<span class="lineno"></span><span class="comment" id="4610403">//&nbsp;characters.&nbsp;The&nbsp;tabwriter&nbsp;passes&nbsp;escaped&nbsp;text&nbsp;segments&nbsp;through</span><br>
<span class="lineno">60</span><span class="comment" id="4610469">//&nbsp;unchanged.&nbsp;In&nbsp;particular,&nbsp;it&nbsp;does&nbsp;not&nbsp;interpret&nbsp;any&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4610537">//&nbsp;breaks&nbsp;within&nbsp;the&nbsp;segment.&nbsp;If&nbsp;the&nbsp;StripEscape&nbsp;flag&nbsp;is&nbsp;set,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4610603">//&nbsp;Escape&nbsp;characters&nbsp;are&nbsp;stripped&nbsp;from&nbsp;the&nbsp;output;&nbsp;otherwise&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="4610669">//&nbsp;are&nbsp;passed&nbsp;through&nbsp;as&nbsp;well.&nbsp;For&nbsp;the&nbsp;purpose&nbsp;of&nbsp;formatting,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4610735">//&nbsp;width&nbsp;of&nbsp;the&nbsp;escaped&nbsp;text&nbsp;is&nbsp;always&nbsp;computed&nbsp;excluding&nbsp;the&nbsp;Escape</span><br>
<span class="lineno">65</span><span class="comment" id="4610804">//&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="4610819">//</span><br>
<span class="lineno"></span><span class="comment" id="4610822">//&nbsp;The&nbsp;formfeed&nbsp;character&nbsp;(&#39;\f&#39;)&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline&nbsp;but&nbsp;it&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4610887">//&nbsp;terminates&nbsp;all&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;line&nbsp;(effectively&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="4610954">//&nbsp;Flush).&nbsp;Cells&nbsp;in&nbsp;the&nbsp;next&nbsp;line&nbsp;start&nbsp;new&nbsp;columns.&nbsp;Unless&nbsp;found</span><br>
<span class="lineno">70</span><span class="comment" id="4611020">//&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;tag&nbsp;or&nbsp;inside&nbsp;an&nbsp;escaped&nbsp;text&nbsp;segment,&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="4611086">//&nbsp;characters&nbsp;appear&nbsp;as&nbsp;newlines&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="4611134">//</span><br>
<span class="lineno"></span><span class="comment" id="4611137">//&nbsp;The&nbsp;Writer&nbsp;must&nbsp;buffer&nbsp;input&nbsp;internally,&nbsp;because&nbsp;proper&nbsp;spacing</span><br>
<span class="lineno"></span><span class="comment" id="4611204">//&nbsp;of&nbsp;one&nbsp;line&nbsp;may&nbsp;depend&nbsp;on&nbsp;the&nbsp;cells&nbsp;in&nbsp;future&nbsp;lines.&nbsp;Clients&nbsp;must</span><br>
<span class="lineno">75</span><span class="comment" id="4611273">//&nbsp;call&nbsp;Flush&nbsp;when&nbsp;done&nbsp;calling&nbsp;Write.</span><br>
<span class="lineno"></span><span class="comment" id="4611312">//</span><br>
<span class="lineno"></span><span class="keyword" id="4611315">type</span>&nbsp;<span class="ident" id="4611320">Writer</span>&nbsp;<span class="keyword" id="4611327">struct</span>&nbsp;<span class="op" id="4611334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4611337">//&nbsp;configuration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611355">output</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4611364">io</span><span class="op" id="4611366">.</span><span class="ident" id="4611367">Writer</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611375">minwidth</span>&nbsp;<span class="builtintype" id="4611384">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611389">tabwidth</span>&nbsp;<span class="builtintype" id="4611398">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611403">padding</span>&nbsp;&nbsp;<span class="builtintype" id="4611412">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611417">padbytes</span>&nbsp;<span class="op" id="4611426">[</span><span class="num" id="4611427">8</span><span class="op" id="4611428">]</span><span class="builtintype" id="4611429">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611435">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4611444">uint</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4611451">//&nbsp;current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611469">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611477">bytes</span><span class="op" id="4611482">.</span><span class="ident" id="4611483">Buffer</span>&nbsp;<span class="comment" id="4611490">//&nbsp;collected&nbsp;text&nbsp;excluding&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611539">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4611547">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4611560">//&nbsp;buffer&nbsp;position&nbsp;up&nbsp;to&nbsp;which&nbsp;cell.width&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;has&nbsp;been&nbsp;computed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611640">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611648">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4611661">//&nbsp;current&nbsp;incomplete&nbsp;cell;&nbsp;cell.width&nbsp;is&nbsp;up&nbsp;to&nbsp;buf[pos]&nbsp;excluding&nbsp;ignored&nbsp;sections</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611746">endChar</span>&nbsp;<span class="builtintype" id="4611754">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4611767">//&nbsp;terminating&nbsp;char&nbsp;of&nbsp;escaped&nbsp;sequence&nbsp;(Escape&nbsp;for&nbsp;escapes,&nbsp;&#39;&gt;&#39;,&nbsp;&#39;;&#39;&nbsp;for&nbsp;HTML&nbsp;tags/entities,&nbsp;or&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611868">lines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4611876">[</span><span class="op" id="4611877">]</span><span class="op" id="4611878">[</span><span class="op" id="4611879">]</span><span class="ident" id="4611880">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4611889">//&nbsp;list&nbsp;of&nbsp;lines;&nbsp;each&nbsp;line&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611937">widths</span>&nbsp;&nbsp;<span class="op" id="4611945">[</span><span class="op" id="4611946">]</span><span class="builtintype" id="4611947">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4611958">//&nbsp;list&nbsp;of&nbsp;column&nbsp;widths&nbsp;in&nbsp;runes&nbsp;-&nbsp;re-used&nbsp;during&nbsp;formatting</span><br>
<span class="lineno"></span><span class="op" id="4612020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4612023">func</span>&nbsp;<span class="op" id="4612028">(</span><span class="ident" id="4612029">b</span>&nbsp;<span class="op" id="4612031">*</span><span class="ident" id="4612032">Writer</span><span class="op" id="4612038">)</span>&nbsp;<span class="ident" id="4612040">addLine</span><span class="op" id="4612047">(</span><span class="op" id="4612048">)</span>&nbsp;<span class="op" id="4612050">{</span>&nbsp;<span class="ident" id="4612052">b</span><span class="op" id="4612053">.</span><span class="ident" id="4612054">lines</span>&nbsp;<span class="op" id="4612060">=</span>&nbsp;<span class="builtinfunc" id="4612062">append</span><span class="op" id="4612068">(</span><span class="ident" id="4612069">b</span><span class="op" id="4612070">.</span><span class="ident" id="4612071">lines</span><span class="op" id="4612076">,</span>&nbsp;<span class="op" id="4612078">[</span><span class="op" id="4612079">]</span><span class="ident" id="4612080">cell</span><span class="op" id="4612084">{</span><span class="op" id="4612085">}</span><span class="op" id="4612086">)</span>&nbsp;<span class="op" id="4612088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4612091">//&nbsp;Reset&nbsp;the&nbsp;current&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4612119">func</span>&nbsp;<span class="op" id="4612124">(</span><span class="ident" id="4612125">b</span>&nbsp;<span class="op" id="4612127">*</span><span class="ident" id="4612128">Writer</span><span class="op" id="4612134">)</span>&nbsp;<span class="ident" id="4612136">reset</span><span class="op" id="4612141">(</span><span class="op" id="4612142">)</span>&nbsp;<span class="op" id="4612144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612147">b</span><span class="op" id="4612148">.</span><span class="ident" id="4612149">buf</span><span class="op" id="4612152">.</span><span class="ident" id="4612153">Reset</span><span class="op" id="4612158">(</span><span class="op" id="4612159">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612162">b</span><span class="op" id="4612163">.</span><span class="ident" id="4612164">pos</span>&nbsp;<span class="op" id="4612168">=</span>&nbsp;<span class="num" id="4612170">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612173">b</span><span class="op" id="4612174">.</span><span class="ident" id="4612175">cell</span>&nbsp;<span class="op" id="4612180">=</span>&nbsp;<span class="ident" id="4612182">cell</span><span class="op" id="4612186">{</span><span class="op" id="4612187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612190">b</span><span class="op" id="4612191">.</span><span class="ident" id="4612192">endChar</span>&nbsp;<span class="op" id="4612200">=</span>&nbsp;<span class="num" id="4612202">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612205">b</span><span class="op" id="4612206">.</span><span class="ident" id="4612207">lines</span>&nbsp;<span class="op" id="4612213">=</span>&nbsp;<span class="ident" id="4612215">b</span><span class="op" id="4612216">.</span><span class="ident" id="4612217">lines</span><span class="op" id="4612222">[</span><span class="num" id="4612223">0</span><span class="op" id="4612224">:</span><span class="num" id="4612225">0</span><span class="op" id="4612226">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612229">b</span><span class="op" id="4612230">.</span><span class="ident" id="4612231">widths</span>&nbsp;<span class="op" id="4612238">=</span>&nbsp;<span class="ident" id="4612240">b</span><span class="op" id="4612241">.</span><span class="ident" id="4612242">widths</span><span class="op" id="4612248">[</span><span class="num" id="4612249">0</span><span class="op" id="4612250">:</span><span class="num" id="4612251">0</span><span class="op" id="4612252">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612255">b</span><span class="op" id="4612256">.</span><span class="ident" id="4612257">addLine</span><span class="op" id="4612264">(</span><span class="op" id="4612265">)</span><br>
<span class="lineno"></span><span class="op" id="4612267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4612270">//&nbsp;Internal&nbsp;representation&nbsp;(current&nbsp;state):</span><br>
<span class="lineno"></span><span class="comment" id="4612314">//</span><br>
<span class="lineno">110</span><span class="comment" id="4612317">//&nbsp;-&nbsp;all&nbsp;text&nbsp;written&nbsp;is&nbsp;appended&nbsp;to&nbsp;buf;&nbsp;tabs&nbsp;and&nbsp;line&nbsp;breaks&nbsp;are&nbsp;stripped&nbsp;away</span><br>
<span class="lineno"></span><span class="comment" id="4612398">//&nbsp;-&nbsp;at&nbsp;any&nbsp;given&nbsp;time&nbsp;there&nbsp;is&nbsp;a&nbsp;(possibly&nbsp;empty)&nbsp;incomplete&nbsp;cell&nbsp;at&nbsp;the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="4612476">//&nbsp;&nbsp;&nbsp;(the&nbsp;cell&nbsp;starts&nbsp;after&nbsp;a&nbsp;tab&nbsp;or&nbsp;line&nbsp;break)</span><br>
<span class="lineno"></span><span class="comment" id="4612525">//&nbsp;-&nbsp;cell.size&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;belonging&nbsp;to&nbsp;the&nbsp;cell&nbsp;so&nbsp;far</span><br>
<span class="lineno"></span><span class="comment" id="4612592">//&nbsp;-&nbsp;cell.width&nbsp;is&nbsp;text&nbsp;width&nbsp;in&nbsp;runes&nbsp;of&nbsp;that&nbsp;cell&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;cell&nbsp;to</span><br>
<span class="lineno">115</span><span class="comment" id="4612674">//&nbsp;&nbsp;&nbsp;position&nbsp;pos;&nbsp;html&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are&nbsp;excluded&nbsp;from&nbsp;this&nbsp;width&nbsp;if&nbsp;html</span><br>
<span class="lineno"></span><span class="comment" id="4612753">//&nbsp;&nbsp;&nbsp;filtering&nbsp;is&nbsp;enabled</span><br>
<span class="lineno"></span><span class="comment" id="4612779">//&nbsp;-&nbsp;the&nbsp;sizes&nbsp;and&nbsp;widths&nbsp;of&nbsp;processed&nbsp;text&nbsp;are&nbsp;kept&nbsp;in&nbsp;the&nbsp;lines&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="4612850">//&nbsp;&nbsp;&nbsp;which&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;cells&nbsp;for&nbsp;each&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4612900">//&nbsp;-&nbsp;the&nbsp;widths&nbsp;list&nbsp;is&nbsp;a&nbsp;temporary&nbsp;list&nbsp;with&nbsp;current&nbsp;widths&nbsp;used&nbsp;during</span><br>
<span class="lineno">120</span><span class="comment" id="4612973">//&nbsp;&nbsp;&nbsp;formatting;&nbsp;it&nbsp;is&nbsp;kept&nbsp;in&nbsp;Writer&nbsp;because&nbsp;it&#39;s&nbsp;re-used</span><br>
<span class="lineno"></span><span class="comment" id="4613032">//</span><br>
<span class="lineno"></span><span class="comment" id="4613035">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;----------&nbsp;size&nbsp;----------&gt;|</span><br>
<span class="lineno"></span><span class="comment" id="4613088">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4613141">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;-&nbsp;width&nbsp;-&gt;|&lt;-&nbsp;ignored&nbsp;-&gt;|&nbsp;&nbsp;|</span><br>
<span class="lineno">125</span><span class="comment" id="4613194">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4613247">//&nbsp;[---processed---tab------------&lt;tag&gt;...&lt;/tag&gt;...]</span><br>
<span class="lineno"></span><span class="comment" id="4613300">//&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="4613350">//&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4613400">//&nbsp;buf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;&nbsp;pos</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4613453">//&nbsp;Formatting&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;these&nbsp;flags.</span><br>
<span class="lineno"></span><span class="keyword" id="4613503">const</span>&nbsp;<span class="op" id="4613509">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4613512">//&nbsp;Ignore&nbsp;html&nbsp;tags&nbsp;and&nbsp;treat&nbsp;entities&nbsp;(starting&nbsp;with&nbsp;&#39;&amp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4613571">//&nbsp;and&nbsp;ending&nbsp;in&nbsp;&#39;;&#39;)&nbsp;as&nbsp;single&nbsp;characters&nbsp;(width&nbsp;=&nbsp;1).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4613628">FilterHTML</span>&nbsp;<span class="builtintype" id="4613639">uint</span>&nbsp;<span class="op" id="4613644">=</span>&nbsp;<span class="num" id="4613646">1</span>&nbsp;<span class="op" id="4613648">&lt;&lt;</span>&nbsp;<span class="ident" id="4613651">iota</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4613658">//&nbsp;Strip&nbsp;Escape&nbsp;characters&nbsp;bracketing&nbsp;escaped&nbsp;text&nbsp;segments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4613719">//&nbsp;instead&nbsp;of&nbsp;passing&nbsp;them&nbsp;through&nbsp;unchanged&nbsp;with&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4613780">StripEscape</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4613794">//&nbsp;Force&nbsp;right-alignment&nbsp;of&nbsp;cell&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4613837">//&nbsp;Default&nbsp;is&nbsp;left-alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4613868">AlignRight</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4613881">//&nbsp;Handle&nbsp;empty&nbsp;columns&nbsp;as&nbsp;if&nbsp;they&nbsp;were&nbsp;not&nbsp;present&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4613937">//&nbsp;the&nbsp;input&nbsp;in&nbsp;the&nbsp;first&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4613971">DiscardEmptyColumns</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4613993">//&nbsp;Always&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;columns&nbsp;(i.e.,&nbsp;padding&nbsp;of</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4614055">//&nbsp;leading&nbsp;empty&nbsp;cells&nbsp;on&nbsp;the&nbsp;left)&nbsp;independent&nbsp;of&nbsp;padchar.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4614116">TabIndent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4614128">//&nbsp;Print&nbsp;a&nbsp;vertical&nbsp;bar&nbsp;(&#39;|&#39;)&nbsp;between&nbsp;columns&nbsp;(after&nbsp;formatting).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4614195">//&nbsp;Discarded&nbsp;columns&nbsp;appear&nbsp;as&nbsp;zero-width&nbsp;columns&nbsp;(&#34;||&#34;).</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4614254">Debug</span><br>
<span class="lineno"></span><span class="op" id="4614260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4614263">//&nbsp;A&nbsp;Writer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Init.&nbsp;The&nbsp;first&nbsp;parameter&nbsp;(output)</span><br>
<span class="lineno"></span><span class="comment" id="4614345">//&nbsp;specifies&nbsp;the&nbsp;filter&nbsp;output.&nbsp;The&nbsp;remaining&nbsp;parameters&nbsp;control&nbsp;the&nbsp;formatting:</span><br>
<span class="lineno">160</span><span class="comment" id="4614426">//</span><br>
<span class="lineno"></span><span class="comment" id="4614429">//&nbsp;&nbsp;&nbsp;&nbsp;minwidth&nbsp;&nbsp;&nbsp;&nbsp;minimal&nbsp;cell&nbsp;width&nbsp;including&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span><span class="comment" id="4614482">//&nbsp;&nbsp;&nbsp;&nbsp;tabwidth&nbsp;&nbsp;&nbsp;&nbsp;width&nbsp;of&nbsp;tab&nbsp;characters&nbsp;(equivalent&nbsp;number&nbsp;of&nbsp;spaces)</span><br>
<span class="lineno"></span><span class="comment" id="4614548">//&nbsp;&nbsp;&nbsp;&nbsp;padding&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;padding&nbsp;added&nbsp;to&nbsp;a&nbsp;cell&nbsp;before&nbsp;computing&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="4614611">//&nbsp;&nbsp;&nbsp;&nbsp;padchar&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASCII&nbsp;char&nbsp;used&nbsp;for&nbsp;padding</span><br>
<span class="lineno">165</span><span class="comment" id="4614651">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;padchar&nbsp;==&nbsp;&#39;\t&#39;,&nbsp;the&nbsp;Writer&nbsp;will&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4614708">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width&nbsp;of&nbsp;a&nbsp;&#39;\t&#39;&nbsp;in&nbsp;the&nbsp;formatted&nbsp;output&nbsp;is&nbsp;tabwidth,</span><br>
<span class="lineno"></span><span class="comment" id="4614766">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;cells&nbsp;are&nbsp;left-aligned&nbsp;independent&nbsp;of&nbsp;align_left</span><br>
<span class="lineno"></span><span class="comment" id="4614824">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(for&nbsp;correct-looking&nbsp;results,&nbsp;tabwidth&nbsp;must&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="4614884">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;tab&nbsp;width&nbsp;in&nbsp;the&nbsp;viewer&nbsp;displaying&nbsp;the&nbsp;result)</span><br>
<span class="lineno">170</span><span class="comment" id="4614943">//&nbsp;&nbsp;&nbsp;&nbsp;flags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formatting&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="4614972">//</span><br>
<span class="lineno"></span><span class="keyword" id="4614975">func</span>&nbsp;<span class="op" id="4614980">(</span><span class="ident" id="4614981">b</span>&nbsp;<span class="op" id="4614983">*</span><span class="ident" id="4614984">Writer</span><span class="op" id="4614990">)</span>&nbsp;<span class="ident" id="4614992">Init</span><span class="op" id="4614996">(</span><span class="ident" id="4614997">output</span>&nbsp;<span class="ident" id="4615004">io</span><span class="op" id="4615006">.</span><span class="ident" id="4615007">Writer</span><span class="op" id="4615013">,</span>&nbsp;<span class="ident" id="4615015">minwidth</span><span class="op" id="4615023">,</span>&nbsp;<span class="ident" id="4615025">tabwidth</span><span class="op" id="4615033">,</span>&nbsp;<span class="ident" id="4615035">padding</span>&nbsp;<span class="builtintype" id="4615043">int</span><span class="op" id="4615046">,</span>&nbsp;<span class="ident" id="4615048">padchar</span>&nbsp;<span class="builtintype" id="4615056">byte</span><span class="op" id="4615060">,</span>&nbsp;<span class="ident" id="4615062">flags</span>&nbsp;<span class="builtintype" id="4615068">uint</span><span class="op" id="4615072">)</span>&nbsp;<span class="op" id="4615074">*</span><span class="ident" id="4615075">Writer</span>&nbsp;<span class="op" id="4615082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4615085">if</span>&nbsp;<span class="ident" id="4615088">minwidth</span>&nbsp;<span class="op" id="4615097">&lt;</span>&nbsp;<span class="num" id="4615099">0</span>&nbsp;<span class="op" id="4615101">||</span>&nbsp;<span class="ident" id="4615104">tabwidth</span>&nbsp;<span class="op" id="4615113">&lt;</span>&nbsp;<span class="num" id="4615115">0</span>&nbsp;<span class="op" id="4615117">||</span>&nbsp;<span class="ident" id="4615120">padding</span>&nbsp;<span class="op" id="4615128">&lt;</span>&nbsp;<span class="num" id="4615130">0</span>&nbsp;<span class="op" id="4615132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4615136">panic</span><span class="op" id="4615141">(</span><span class="string" id="4615142">&#34;negative&nbsp;minwidth,&nbsp;tabwidth,&nbsp;or&nbsp;padding&#34;</span><span class="op" id="4615183">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4615186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4615189">b</span><span class="op" id="4615190">.</span><span class="ident" id="4615191">output</span>&nbsp;<span class="op" id="4615198">=</span>&nbsp;<span class="ident" id="4615200">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4615208">b</span><span class="op" id="4615209">.</span><span class="ident" id="4615210">minwidth</span>&nbsp;<span class="op" id="4615219">=</span>&nbsp;<span class="ident" id="4615221">minwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4615231">b</span><span class="op" id="4615232">.</span><span class="ident" id="4615233">tabwidth</span>&nbsp;<span class="op" id="4615242">=</span>&nbsp;<span class="ident" id="4615244">tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4615254">b</span><span class="op" id="4615255">.</span><span class="ident" id="4615256">padding</span>&nbsp;<span class="op" id="4615264">=</span>&nbsp;<span class="ident" id="4615266">padding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4615275">for</span>&nbsp;<span class="ident" id="4615279">i</span>&nbsp;<span class="op" id="4615281">:=</span>&nbsp;<span class="keyword" id="4615284">range</span>&nbsp;<span class="ident" id="4615290">b</span><span class="op" id="4615291">.</span><span class="ident" id="4615292">padbytes</span>&nbsp;<span class="op" id="4615301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4615305">b</span><span class="op" id="4615306">.</span><span class="ident" id="4615307">padbytes</span><span class="op" id="4615315">[</span><span class="ident" id="4615316">i</span><span class="op" id="4615317">]</span>&nbsp;<span class="op" id="4615319">=</span>&nbsp;<span class="ident" id="4615321">padchar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4615330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4615333">if</span>&nbsp;<span class="ident" id="4615336">padchar</span>&nbsp;<span class="op" id="4615344">==</span>&nbsp;<span class="string" id="4615347">&#39;\t&#39;</span>&nbsp;<span class="op" id="4615352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4615356">//&nbsp;tab&nbsp;padding&nbsp;enforces&nbsp;left-alignment</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4615397">flags</span>&nbsp;<span class="op" id="4615403">&amp;^=</span>&nbsp;<span class="ident" id="4615407">AlignRight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4615419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4615422">b</span><span class="op" id="4615423">.</span><span class="ident" id="4615424">flags</span>&nbsp;<span class="op" id="4615430">=</span>&nbsp;<span class="ident" id="4615432">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4615440">b</span><span class="op" id="4615441">.</span><span class="ident" id="4615442">reset</span><span class="op" id="4615447">(</span><span class="op" id="4615448">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4615452">return</span>&nbsp;<span class="ident" id="4615459">b</span><br>
<span class="lineno"></span><span class="op" id="4615461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4615464">//&nbsp;debugging&nbsp;support&nbsp;(keep&nbsp;code&nbsp;around)</span><br>
<span class="lineno">195</span><span class="keyword" id="4615504">func</span>&nbsp;<span class="op" id="4615509">(</span><span class="ident" id="4615510">b</span>&nbsp;<span class="op" id="4615512">*</span><span class="ident" id="4615513">Writer</span><span class="op" id="4615519">)</span>&nbsp;<span class="ident" id="4615521">dump</span><span class="op" id="4615525">(</span><span class="op" id="4615526">)</span>&nbsp;<span class="op" id="4615528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4615531">pos</span>&nbsp;<span class="op" id="4615535">:=</span>&nbsp;<span class="num" id="4615538">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4615541">for</span>&nbsp;<span class="ident" id="4615545">i</span><span class="op" id="4615546">,</span>&nbsp;<span class="ident" id="4615548">line</span>&nbsp;<span class="op" id="4615553">:=</span>&nbsp;<span class="keyword" id="4615556">range</span>&nbsp;<span class="ident" id="4615562">b</span><span class="op" id="4615563">.</span><span class="ident" id="4615564">lines</span>&nbsp;<span class="op" id="4615570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4615574">print</span><span class="op" id="4615579">(</span><span class="string" id="4615580">&#34;(&#34;</span><span class="op" id="4615583">,</span>&nbsp;<span class="ident" id="4615585">i</span><span class="op" id="4615586">,</span>&nbsp;<span class="string" id="4615588">&#34;)&nbsp;&#34;</span><span class="op" id="4615592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4615596">for</span>&nbsp;<span class="ident" id="4615600">_</span><span class="op" id="4615601">,</span>&nbsp;<span class="ident" id="4615603">c</span>&nbsp;<span class="op" id="4615605">:=</span>&nbsp;<span class="keyword" id="4615608">range</span>&nbsp;<span class="ident" id="4615614">line</span>&nbsp;<span class="op" id="4615619">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4615624">print</span><span class="op" id="4615629">(</span><span class="string" id="4615630">&#34;[&#34;</span><span class="op" id="4615633">,</span>&nbsp;<span class="builtintype" id="4615635">string</span><span class="op" id="4615641">(</span><span class="ident" id="4615642">b</span><span class="op" id="4615643">.</span><span class="ident" id="4615644">buf</span><span class="op" id="4615647">.</span><span class="ident" id="4615648">Bytes</span><span class="op" id="4615653">(</span><span class="op" id="4615654">)</span><span class="op" id="4615655">[</span><span class="ident" id="4615656">pos</span><span class="op" id="4615659">:</span><span class="ident" id="4615660">pos</span><span class="op" id="4615663">+</span><span class="ident" id="4615664">c</span><span class="op" id="4615665">.</span><span class="ident" id="4615666">size</span><span class="op" id="4615670">]</span><span class="op" id="4615671">)</span><span class="op" id="4615672">,</span>&nbsp;<span class="string" id="4615674">&#34;]&#34;</span><span class="op" id="4615677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4615682">pos</span>&nbsp;<span class="op" id="4615686">+=</span>&nbsp;<span class="ident" id="4615689">c</span><span class="op" id="4615690">.</span><span class="ident" id="4615691">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4615698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4615702">print</span><span class="op" id="4615707">(</span><span class="string" id="4615708">&#34;\n&#34;</span><span class="op" id="4615712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4615715">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4615718">print</span><span class="op" id="4615723">(</span><span class="string" id="4615724">&#34;\n&#34;</span><span class="op" id="4615728">)</span><br>
<span class="lineno"></span><span class="op" id="4615730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4615733">//&nbsp;local&nbsp;error&nbsp;wrapper&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish&nbsp;errors&nbsp;we&nbsp;want&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4615803">//&nbsp;as&nbsp;errors&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;(which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors)</span><br>
<span class="lineno">210</span><span class="keyword" id="4615878">type</span>&nbsp;<span class="ident" id="4615883">osError</span>&nbsp;<span class="keyword" id="4615891">struct</span>&nbsp;<span class="op" id="4615898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4615901">err</span>&nbsp;<span class="builtintype" id="4615905">error</span><br>
<span class="lineno"></span><span class="op" id="4615911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4615914">func</span>&nbsp;<span class="op" id="4615919">(</span><span class="ident" id="4615920">b</span>&nbsp;<span class="op" id="4615922">*</span><span class="ident" id="4615923">Writer</span><span class="op" id="4615929">)</span>&nbsp;<span class="ident" id="4615931">write0</span><span class="op" id="4615937">(</span><span class="ident" id="4615938">buf</span>&nbsp;<span class="op" id="4615942">[</span><span class="op" id="4615943">]</span><span class="builtintype" id="4615944">byte</span><span class="op" id="4615948">)</span>&nbsp;<span class="op" id="4615950">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4615953">n</span><span class="op" id="4615954">,</span>&nbsp;<span class="ident" id="4615956">err</span>&nbsp;<span class="op" id="4615960">:=</span>&nbsp;<span class="ident" id="4615963">b</span><span class="op" id="4615964">.</span><span class="ident" id="4615965">output</span><span class="op" id="4615971">.</span><span class="ident" id="4615972">Write</span><span class="op" id="4615977">(</span><span class="ident" id="4615978">buf</span><span class="op" id="4615981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4615984">if</span>&nbsp;<span class="ident" id="4615987">n</span>&nbsp;<span class="op" id="4615989">!=</span>&nbsp;<span class="builtinfunc" id="4615992">len</span><span class="op" id="4615995">(</span><span class="ident" id="4615996">buf</span><span class="op" id="4615999">)</span>&nbsp;<span class="op" id="4616001">&amp;&amp;</span>&nbsp;<span class="ident" id="4616004">err</span>&nbsp;<span class="op" id="4616008">==</span>&nbsp;<span class="ident" id="4616011">nil</span>&nbsp;<span class="op" id="4616015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4616019">err</span>&nbsp;<span class="op" id="4616023">=</span>&nbsp;<span class="ident" id="4616025">io</span><span class="op" id="4616027">.</span><span class="ident" id="4616028">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4616043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4616046">if</span>&nbsp;<span class="ident" id="4616049">err</span>&nbsp;<span class="op" id="4616053">!=</span>&nbsp;<span class="ident" id="4616056">nil</span>&nbsp;<span class="op" id="4616060">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4616064">panic</span><span class="op" id="4616069">(</span><span class="ident" id="4616070">osError</span><span class="op" id="4616077">{</span><span class="ident" id="4616078">err</span><span class="op" id="4616081">}</span><span class="op" id="4616082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4616085">}</span><br>
<span class="lineno"></span><span class="op" id="4616087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4616090">func</span>&nbsp;<span class="op" id="4616095">(</span><span class="ident" id="4616096">b</span>&nbsp;<span class="op" id="4616098">*</span><span class="ident" id="4616099">Writer</span><span class="op" id="4616105">)</span>&nbsp;<span class="ident" id="4616107">writeN</span><span class="op" id="4616113">(</span><span class="ident" id="4616114">src</span>&nbsp;<span class="op" id="4616118">[</span><span class="op" id="4616119">]</span><span class="builtintype" id="4616120">byte</span><span class="op" id="4616124">,</span>&nbsp;<span class="ident" id="4616126">n</span>&nbsp;<span class="builtintype" id="4616128">int</span><span class="op" id="4616131">)</span>&nbsp;<span class="op" id="4616133">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4616136">for</span>&nbsp;<span class="ident" id="4616140">n</span>&nbsp;<span class="op" id="4616142">&gt;</span>&nbsp;<span class="builtinfunc" id="4616144">len</span><span class="op" id="4616147">(</span><span class="ident" id="4616148">src</span><span class="op" id="4616151">)</span>&nbsp;<span class="op" id="4616153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4616157">b</span><span class="op" id="4616158">.</span><span class="ident" id="4616159">write0</span><span class="op" id="4616165">(</span><span class="ident" id="4616166">src</span><span class="op" id="4616169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4616173">n</span>&nbsp;<span class="op" id="4616175">-=</span>&nbsp;<span class="builtinfunc" id="4616178">len</span><span class="op" id="4616181">(</span><span class="ident" id="4616182">src</span><span class="op" id="4616185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4616188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4616191">b</span><span class="op" id="4616192">.</span><span class="ident" id="4616193">write0</span><span class="op" id="4616199">(</span><span class="ident" id="4616200">src</span><span class="op" id="4616203">[</span><span class="num" id="4616204">0</span><span class="op" id="4616205">:</span><span class="ident" id="4616206">n</span><span class="op" id="4616207">]</span><span class="op" id="4616208">)</span><br>
<span class="lineno">230</span><span class="op" id="4616210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4616213">var</span>&nbsp;<span class="op" id="4616217">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4616220">newline</span>&nbsp;<span class="op" id="4616228">=</span>&nbsp;<span class="op" id="4616230">[</span><span class="op" id="4616231">]</span><span class="builtintype" id="4616232">byte</span><span class="op" id="4616236">{</span><span class="string" id="4616237">&#39;\n&#39;</span><span class="op" id="4616241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4616244">tabs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4616252">=</span>&nbsp;<span class="op" id="4616254">[</span><span class="op" id="4616255">]</span><span class="builtintype" id="4616256">byte</span><span class="op" id="4616260">(</span><span class="string" id="4616261">&#34;\t\t\t\t\t\t\t\t&#34;</span><span class="op" id="4616279">)</span><br>
<span class="lineno">235</span><span class="op" id="4616281">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4616284">func</span>&nbsp;<span class="op" id="4616289">(</span><span class="ident" id="4616290">b</span>&nbsp;<span class="op" id="4616292">*</span><span class="ident" id="4616293">Writer</span><span class="op" id="4616299">)</span>&nbsp;<span class="ident" id="4616301">writePadding</span><span class="op" id="4616313">(</span><span class="ident" id="4616314">textw</span><span class="op" id="4616319">,</span>&nbsp;<span class="ident" id="4616321">cellw</span>&nbsp;<span class="builtintype" id="4616327">int</span><span class="op" id="4616330">,</span>&nbsp;<span class="ident" id="4616332">useTabs</span>&nbsp;<span class="builtintype" id="4616340">bool</span><span class="op" id="4616344">)</span>&nbsp;<span class="op" id="4616346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4616349">if</span>&nbsp;<span class="ident" id="4616352">b</span><span class="op" id="4616353">.</span><span class="ident" id="4616354">padbytes</span><span class="op" id="4616362">[</span><span class="num" id="4616363">0</span><span class="op" id="4616364">]</span>&nbsp;<span class="op" id="4616366">==</span>&nbsp;<span class="string" id="4616369">&#39;\t&#39;</span>&nbsp;<span class="op" id="4616374">||</span>&nbsp;<span class="ident" id="4616377">useTabs</span>&nbsp;<span class="op" id="4616385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4616389">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;tabs</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4616420">if</span>&nbsp;<span class="ident" id="4616423">b</span><span class="op" id="4616424">.</span><span class="ident" id="4616425">tabwidth</span>&nbsp;<span class="op" id="4616434">==</span>&nbsp;<span class="num" id="4616437">0</span>&nbsp;<span class="op" id="4616439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4616444">return</span>&nbsp;<span class="comment" id="4616451">//&nbsp;tabs&nbsp;have&nbsp;no&nbsp;width&nbsp;-&nbsp;can&#39;t&nbsp;do&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4616498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4616502">//&nbsp;make&nbsp;cellw&nbsp;the&nbsp;smallest&nbsp;multiple&nbsp;of&nbsp;b.tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4616554">cellw</span>&nbsp;<span class="op" id="4616560">=</span>&nbsp;<span class="op" id="4616562">(</span><span class="ident" id="4616563">cellw</span>&nbsp;<span class="op" id="4616569">+</span>&nbsp;<span class="ident" id="4616571">b</span><span class="op" id="4616572">.</span><span class="ident" id="4616573">tabwidth</span>&nbsp;<span class="op" id="4616582">-</span>&nbsp;<span class="num" id="4616584">1</span><span class="op" id="4616585">)</span>&nbsp;<span class="op" id="4616587">/</span>&nbsp;<span class="ident" id="4616589">b</span><span class="op" id="4616590">.</span><span class="ident" id="4616591">tabwidth</span>&nbsp;<span class="op" id="4616600">*</span>&nbsp;<span class="ident" id="4616602">b</span><span class="op" id="4616603">.</span><span class="ident" id="4616604">tabwidth</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4616615">n</span>&nbsp;<span class="op" id="4616617">:=</span>&nbsp;<span class="ident" id="4616620">cellw</span>&nbsp;<span class="op" id="4616626">-</span>&nbsp;<span class="ident" id="4616628">textw</span>&nbsp;<span class="comment" id="4616634">//&nbsp;amount&nbsp;of&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4616657">if</span>&nbsp;<span class="ident" id="4616660">n</span>&nbsp;<span class="op" id="4616662">&lt;</span>&nbsp;<span class="num" id="4616664">0</span>&nbsp;<span class="op" id="4616666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4616671">panic</span><span class="op" id="4616676">(</span><span class="string" id="4616677">&#34;internal&nbsp;error&#34;</span><span class="op" id="4616693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4616697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4616701">b</span><span class="op" id="4616702">.</span><span class="ident" id="4616703">writeN</span><span class="op" id="4616709">(</span><span class="ident" id="4616710">tabs</span><span class="op" id="4616714">,</span>&nbsp;<span class="op" id="4616716">(</span><span class="ident" id="4616717">n</span><span class="op" id="4616718">+</span><span class="ident" id="4616719">b</span><span class="op" id="4616720">.</span><span class="ident" id="4616721">tabwidth</span><span class="op" id="4616729">-</span><span class="num" id="4616730">1</span><span class="op" id="4616731">)</span><span class="op" id="4616732">/</span><span class="ident" id="4616733">b</span><span class="op" id="4616734">.</span><span class="ident" id="4616735">tabwidth</span><span class="op" id="4616743">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4616747">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4616755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4616759">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;non-tab&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4616803">b</span><span class="op" id="4616804">.</span><span class="ident" id="4616805">writeN</span><span class="op" id="4616811">(</span><span class="ident" id="4616812">b</span><span class="op" id="4616813">.</span><span class="ident" id="4616814">padbytes</span><span class="op" id="4616822">[</span><span class="num" id="4616823">0</span><span class="op" id="4616824">:</span><span class="op" id="4616825">]</span><span class="op" id="4616826">,</span>&nbsp;<span class="ident" id="4616828">cellw</span><span class="op" id="4616833">-</span><span class="ident" id="4616834">textw</span><span class="op" id="4616839">)</span><br>
<span class="lineno">255</span><span class="op" id="4616841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4616844">var</span>&nbsp;<span class="ident" id="4616848">vbar</span>&nbsp;<span class="op" id="4616853">=</span>&nbsp;<span class="op" id="4616855">[</span><span class="op" id="4616856">]</span><span class="builtintype" id="4616857">byte</span><span class="op" id="4616861">{</span><span class="string" id="4616862">&#39;|&#39;</span><span class="op" id="4616865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4616868">func</span>&nbsp;<span class="op" id="4616873">(</span><span class="ident" id="4616874">b</span>&nbsp;<span class="op" id="4616876">*</span><span class="ident" id="4616877">Writer</span><span class="op" id="4616883">)</span>&nbsp;<span class="ident" id="4616885">writeLines</span><span class="op" id="4616895">(</span><span class="ident" id="4616896">pos0</span>&nbsp;<span class="builtintype" id="4616901">int</span><span class="op" id="4616904">,</span>&nbsp;<span class="ident" id="4616906">line0</span><span class="op" id="4616911">,</span>&nbsp;<span class="ident" id="4616913">line1</span>&nbsp;<span class="builtintype" id="4616919">int</span><span class="op" id="4616922">)</span>&nbsp;<span class="op" id="4616924">(</span><span class="ident" id="4616925">pos</span>&nbsp;<span class="builtintype" id="4616929">int</span><span class="op" id="4616932">)</span>&nbsp;<span class="op" id="4616934">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4616937">pos</span>&nbsp;<span class="op" id="4616941">=</span>&nbsp;<span class="ident" id="4616943">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4616949">for</span>&nbsp;<span class="ident" id="4616953">i</span>&nbsp;<span class="op" id="4616955">:=</span>&nbsp;<span class="ident" id="4616958">line0</span><span class="op" id="4616963">;</span>&nbsp;<span class="ident" id="4616965">i</span>&nbsp;<span class="op" id="4616967">&lt;</span>&nbsp;<span class="ident" id="4616969">line1</span><span class="op" id="4616974">;</span>&nbsp;<span class="ident" id="4616976">i</span><span class="op" id="4616977">++</span>&nbsp;<span class="op" id="4616980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4616984">line</span>&nbsp;<span class="op" id="4616989">:=</span>&nbsp;<span class="ident" id="4616992">b</span><span class="op" id="4616993">.</span><span class="ident" id="4616994">lines</span><span class="op" id="4616999">[</span><span class="ident" id="4617000">i</span><span class="op" id="4617001">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4617006">//&nbsp;if&nbsp;TabIndent&nbsp;is&nbsp;set,&nbsp;use&nbsp;tabs&nbsp;to&nbsp;pad&nbsp;leading&nbsp;empty&nbsp;cells</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617068">useTabs</span>&nbsp;<span class="op" id="4617076">:=</span>&nbsp;<span class="ident" id="4617079">b</span><span class="op" id="4617080">.</span><span class="ident" id="4617081">flags</span><span class="op" id="4617086">&amp;</span><span class="ident" id="4617087">TabIndent</span>&nbsp;<span class="op" id="4617097">!=</span>&nbsp;<span class="num" id="4617100">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4617105">for</span>&nbsp;<span class="ident" id="4617109">j</span><span class="op" id="4617110">,</span>&nbsp;<span class="ident" id="4617112">c</span>&nbsp;<span class="op" id="4617114">:=</span>&nbsp;<span class="keyword" id="4617117">range</span>&nbsp;<span class="ident" id="4617123">line</span>&nbsp;<span class="op" id="4617128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4617133">if</span>&nbsp;<span class="ident" id="4617136">j</span>&nbsp;<span class="op" id="4617138">&gt;</span>&nbsp;<span class="num" id="4617140">0</span>&nbsp;<span class="op" id="4617142">&amp;&amp;</span>&nbsp;<span class="ident" id="4617145">b</span><span class="op" id="4617146">.</span><span class="ident" id="4617147">flags</span><span class="op" id="4617152">&amp;</span><span class="ident" id="4617153">Debug</span>&nbsp;<span class="op" id="4617159">!=</span>&nbsp;<span class="num" id="4617162">0</span>&nbsp;<span class="op" id="4617164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4617170">//&nbsp;indicate&nbsp;column&nbsp;break</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617199">b</span><span class="op" id="4617200">.</span><span class="ident" id="4617201">write0</span><span class="op" id="4617207">(</span><span class="ident" id="4617208">vbar</span><span class="op" id="4617212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4617217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4617223">if</span>&nbsp;<span class="ident" id="4617226">c</span><span class="op" id="4617227">.</span><span class="ident" id="4617228">size</span>&nbsp;<span class="op" id="4617233">==</span>&nbsp;<span class="num" id="4617236">0</span>&nbsp;<span class="op" id="4617238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4617244">//&nbsp;empty&nbsp;cell</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4617262">if</span>&nbsp;<span class="ident" id="4617265">j</span>&nbsp;<span class="op" id="4617267">&lt;</span>&nbsp;<span class="builtinfunc" id="4617269">len</span><span class="op" id="4617272">(</span><span class="ident" id="4617273">b</span><span class="op" id="4617274">.</span><span class="ident" id="4617275">widths</span><span class="op" id="4617281">)</span>&nbsp;<span class="op" id="4617283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617290">b</span><span class="op" id="4617291">.</span><span class="ident" id="4617292">writePadding</span><span class="op" id="4617304">(</span><span class="ident" id="4617305">c</span><span class="op" id="4617306">.</span><span class="ident" id="4617307">width</span><span class="op" id="4617312">,</span>&nbsp;<span class="ident" id="4617314">b</span><span class="op" id="4617315">.</span><span class="ident" id="4617316">widths</span><span class="op" id="4617322">[</span><span class="ident" id="4617323">j</span><span class="op" id="4617324">]</span><span class="op" id="4617325">,</span>&nbsp;<span class="ident" id="4617327">useTabs</span><span class="op" id="4617334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4617340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4617345">}</span>&nbsp;<span class="keyword" id="4617347">else</span>&nbsp;<span class="op" id="4617352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4617358">//&nbsp;non-empty&nbsp;cell</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617380">useTabs</span>&nbsp;<span class="op" id="4617388">=</span>&nbsp;<span class="builtintype" id="4617390">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4617400">if</span>&nbsp;<span class="ident" id="4617403">b</span><span class="op" id="4617404">.</span><span class="ident" id="4617405">flags</span><span class="op" id="4617410">&amp;</span><span class="ident" id="4617411">AlignRight</span>&nbsp;<span class="op" id="4617422">==</span>&nbsp;<span class="num" id="4617425">0</span>&nbsp;<span class="op" id="4617427">{</span>&nbsp;<span class="comment" id="4617429">//&nbsp;align&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617448">b</span><span class="op" id="4617449">.</span><span class="ident" id="4617450">write0</span><span class="op" id="4617456">(</span><span class="ident" id="4617457">b</span><span class="op" id="4617458">.</span><span class="ident" id="4617459">buf</span><span class="op" id="4617462">.</span><span class="ident" id="4617463">Bytes</span><span class="op" id="4617468">(</span><span class="op" id="4617469">)</span><span class="op" id="4617470">[</span><span class="ident" id="4617471">pos</span>&nbsp;<span class="op" id="4617475">:</span>&nbsp;<span class="ident" id="4617477">pos</span><span class="op" id="4617480">+</span><span class="ident" id="4617481">c</span><span class="op" id="4617482">.</span><span class="ident" id="4617483">size</span><span class="op" id="4617487">]</span><span class="op" id="4617488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617495">pos</span>&nbsp;<span class="op" id="4617499">+=</span>&nbsp;<span class="ident" id="4617502">c</span><span class="op" id="4617503">.</span><span class="ident" id="4617504">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4617514">if</span>&nbsp;<span class="ident" id="4617517">j</span>&nbsp;<span class="op" id="4617519">&lt;</span>&nbsp;<span class="builtinfunc" id="4617521">len</span><span class="op" id="4617524">(</span><span class="ident" id="4617525">b</span><span class="op" id="4617526">.</span><span class="ident" id="4617527">widths</span><span class="op" id="4617533">)</span>&nbsp;<span class="op" id="4617535">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617543">b</span><span class="op" id="4617544">.</span><span class="ident" id="4617545">writePadding</span><span class="op" id="4617557">(</span><span class="ident" id="4617558">c</span><span class="op" id="4617559">.</span><span class="ident" id="4617560">width</span><span class="op" id="4617565">,</span>&nbsp;<span class="ident" id="4617567">b</span><span class="op" id="4617568">.</span><span class="ident" id="4617569">widths</span><span class="op" id="4617575">[</span><span class="ident" id="4617576">j</span><span class="op" id="4617577">]</span><span class="op" id="4617578">,</span>&nbsp;<span class="builtintype" id="4617580">false</span><span class="op" id="4617585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4617592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4617598">}</span>&nbsp;<span class="keyword" id="4617600">else</span>&nbsp;<span class="op" id="4617605">{</span>&nbsp;<span class="comment" id="4617607">//&nbsp;align&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4617627">if</span>&nbsp;<span class="ident" id="4617630">j</span>&nbsp;<span class="op" id="4617632">&lt;</span>&nbsp;<span class="builtinfunc" id="4617634">len</span><span class="op" id="4617637">(</span><span class="ident" id="4617638">b</span><span class="op" id="4617639">.</span><span class="ident" id="4617640">widths</span><span class="op" id="4617646">)</span>&nbsp;<span class="op" id="4617648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617656">b</span><span class="op" id="4617657">.</span><span class="ident" id="4617658">writePadding</span><span class="op" id="4617670">(</span><span class="ident" id="4617671">c</span><span class="op" id="4617672">.</span><span class="ident" id="4617673">width</span><span class="op" id="4617678">,</span>&nbsp;<span class="ident" id="4617680">b</span><span class="op" id="4617681">.</span><span class="ident" id="4617682">widths</span><span class="op" id="4617688">[</span><span class="ident" id="4617689">j</span><span class="op" id="4617690">]</span><span class="op" id="4617691">,</span>&nbsp;<span class="builtintype" id="4617693">false</span><span class="op" id="4617698">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4617705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617712">b</span><span class="op" id="4617713">.</span><span class="ident" id="4617714">write0</span><span class="op" id="4617720">(</span><span class="ident" id="4617721">b</span><span class="op" id="4617722">.</span><span class="ident" id="4617723">buf</span><span class="op" id="4617726">.</span><span class="ident" id="4617727">Bytes</span><span class="op" id="4617732">(</span><span class="op" id="4617733">)</span><span class="op" id="4617734">[</span><span class="ident" id="4617735">pos</span>&nbsp;<span class="op" id="4617739">:</span>&nbsp;<span class="ident" id="4617741">pos</span><span class="op" id="4617744">+</span><span class="ident" id="4617745">c</span><span class="op" id="4617746">.</span><span class="ident" id="4617747">size</span><span class="op" id="4617751">]</span><span class="op" id="4617752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617759">pos</span>&nbsp;<span class="op" id="4617763">+=</span>&nbsp;<span class="ident" id="4617766">c</span><span class="op" id="4617767">.</span><span class="ident" id="4617768">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4617777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4617782">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4617786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4617791">if</span>&nbsp;<span class="ident" id="4617794">i</span><span class="op" id="4617795">+</span><span class="num" id="4617796">1</span>&nbsp;<span class="op" id="4617798">==</span>&nbsp;<span class="builtinfunc" id="4617801">len</span><span class="op" id="4617804">(</span><span class="ident" id="4617805">b</span><span class="op" id="4617806">.</span><span class="ident" id="4617807">lines</span><span class="op" id="4617812">)</span>&nbsp;<span class="op" id="4617814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4617819">//&nbsp;last&nbsp;buffered&nbsp;line&nbsp;-&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;newline,&nbsp;so&nbsp;just&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4617885">//&nbsp;any&nbsp;outstanding&nbsp;buffered&nbsp;data</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617921">b</span><span class="op" id="4617922">.</span><span class="ident" id="4617923">write0</span><span class="op" id="4617929">(</span><span class="ident" id="4617930">b</span><span class="op" id="4617931">.</span><span class="ident" id="4617932">buf</span><span class="op" id="4617935">.</span><span class="ident" id="4617936">Bytes</span><span class="op" id="4617941">(</span><span class="op" id="4617942">)</span><span class="op" id="4617943">[</span><span class="ident" id="4617944">pos</span>&nbsp;<span class="op" id="4617948">:</span>&nbsp;<span class="ident" id="4617950">pos</span><span class="op" id="4617953">+</span><span class="ident" id="4617954">b</span><span class="op" id="4617955">.</span><span class="ident" id="4617956">cell</span><span class="op" id="4617960">.</span><span class="ident" id="4617961">size</span><span class="op" id="4617965">]</span><span class="op" id="4617966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4617971">pos</span>&nbsp;<span class="op" id="4617975">+=</span>&nbsp;<span class="ident" id="4617978">b</span><span class="op" id="4617979">.</span><span class="ident" id="4617980">cell</span><span class="op" id="4617984">.</span><span class="ident" id="4617985">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4617992">}</span>&nbsp;<span class="keyword" id="4617994">else</span>&nbsp;<span class="op" id="4617999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4618004">//&nbsp;not&nbsp;the&nbsp;last&nbsp;line&nbsp;-&nbsp;write&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618044">b</span><span class="op" id="4618045">.</span><span class="ident" id="4618046">write0</span><span class="op" id="4618052">(</span><span class="ident" id="4618053">newline</span><span class="op" id="4618060">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4618064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4618067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4618070">return</span><br>
<span class="lineno"></span><span class="op" id="4618077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="4618080">//&nbsp;Format&nbsp;the&nbsp;text&nbsp;between&nbsp;line0&nbsp;and&nbsp;line1&nbsp;(excluding&nbsp;line1);&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="4618146">//&nbsp;is&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;line0.</span><br>
<span class="lineno"></span><span class="comment" id="4618213">//&nbsp;Returns&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4618278">//&nbsp;line1&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="4618309">//</span><br>
<span class="lineno">315</span><span class="keyword" id="4618312">func</span>&nbsp;<span class="op" id="4618317">(</span><span class="ident" id="4618318">b</span>&nbsp;<span class="op" id="4618320">*</span><span class="ident" id="4618321">Writer</span><span class="op" id="4618327">)</span>&nbsp;<span class="ident" id="4618329">format</span><span class="op" id="4618335">(</span><span class="ident" id="4618336">pos0</span>&nbsp;<span class="builtintype" id="4618341">int</span><span class="op" id="4618344">,</span>&nbsp;<span class="ident" id="4618346">line0</span><span class="op" id="4618351">,</span>&nbsp;<span class="ident" id="4618353">line1</span>&nbsp;<span class="builtintype" id="4618359">int</span><span class="op" id="4618362">)</span>&nbsp;<span class="op" id="4618364">(</span><span class="ident" id="4618365">pos</span>&nbsp;<span class="builtintype" id="4618369">int</span><span class="op" id="4618372">)</span>&nbsp;<span class="op" id="4618374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618377">pos</span>&nbsp;<span class="op" id="4618381">=</span>&nbsp;<span class="ident" id="4618383">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618389">column</span>&nbsp;<span class="op" id="4618396">:=</span>&nbsp;<span class="builtinfunc" id="4618399">len</span><span class="op" id="4618402">(</span><span class="ident" id="4618403">b</span><span class="op" id="4618404">.</span><span class="ident" id="4618405">widths</span><span class="op" id="4618411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4618414">for</span>&nbsp;<span class="ident" id="4618418">this</span>&nbsp;<span class="op" id="4618423">:=</span>&nbsp;<span class="ident" id="4618426">line0</span><span class="op" id="4618431">;</span>&nbsp;<span class="ident" id="4618433">this</span>&nbsp;<span class="op" id="4618438">&lt;</span>&nbsp;<span class="ident" id="4618440">line1</span><span class="op" id="4618445">;</span>&nbsp;<span class="ident" id="4618447">this</span><span class="op" id="4618451">++</span>&nbsp;<span class="op" id="4618454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618458">line</span>&nbsp;<span class="op" id="4618463">:=</span>&nbsp;<span class="ident" id="4618466">b</span><span class="op" id="4618467">.</span><span class="ident" id="4618468">lines</span><span class="op" id="4618473">[</span><span class="ident" id="4618474">this</span><span class="op" id="4618478">]</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4618483">if</span>&nbsp;<span class="ident" id="4618486">column</span>&nbsp;<span class="op" id="4618493">&lt;</span>&nbsp;<span class="builtinfunc" id="4618495">len</span><span class="op" id="4618498">(</span><span class="ident" id="4618499">line</span><span class="op" id="4618503">)</span><span class="op" id="4618504">-</span><span class="num" id="4618505">1</span>&nbsp;<span class="op" id="4618507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4618512">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column&nbsp;=&gt;&nbsp;this&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4618558">//&nbsp;has&nbsp;more&nbsp;cells&nbsp;than&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4618602">//&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;is&nbsp;ignored&nbsp;because&nbsp;cells&nbsp;are</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4618661">//&nbsp;tab-terminated;&nbsp;the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4618720">//&nbsp;text&nbsp;before&nbsp;the&nbsp;newline/formfeed&nbsp;and&nbsp;does&nbsp;not&nbsp;belong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4618779">//&nbsp;to&nbsp;a&nbsp;column)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4618799">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;beginning&nbsp;of&nbsp;block</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618852">pos</span>&nbsp;<span class="op" id="4618856">=</span>&nbsp;<span class="ident" id="4618858">b</span><span class="op" id="4618859">.</span><span class="ident" id="4618860">writeLines</span><span class="op" id="4618870">(</span><span class="ident" id="4618871">pos</span><span class="op" id="4618874">,</span>&nbsp;<span class="ident" id="4618876">line0</span><span class="op" id="4618881">,</span>&nbsp;<span class="ident" id="4618883">this</span><span class="op" id="4618887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618892">line0</span>&nbsp;<span class="op" id="4618898">=</span>&nbsp;<span class="ident" id="4618900">this</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4618909">//&nbsp;column&nbsp;block&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618934">width</span>&nbsp;<span class="op" id="4618940">:=</span>&nbsp;<span class="ident" id="4618943">b</span><span class="op" id="4618944">.</span><span class="ident" id="4618945">minwidth</span>&nbsp;<span class="comment" id="4618954">//&nbsp;minimal&nbsp;column&nbsp;width</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4618981">discardable</span>&nbsp;<span class="op" id="4618993">:=</span>&nbsp;<span class="builtintype" id="4618996">true</span>&nbsp;<span class="comment" id="4619001">//&nbsp;true&nbsp;if&nbsp;all&nbsp;cells&nbsp;in&nbsp;this&nbsp;column&nbsp;are&nbsp;empty&nbsp;and&nbsp;&#34;soft&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4619061">for</span>&nbsp;<span class="op" id="4619065">;</span>&nbsp;<span class="ident" id="4619067">this</span>&nbsp;<span class="op" id="4619072">&lt;</span>&nbsp;<span class="ident" id="4619074">line1</span><span class="op" id="4619079">;</span>&nbsp;<span class="ident" id="4619081">this</span><span class="op" id="4619085">++</span>&nbsp;<span class="op" id="4619088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619094">line</span>&nbsp;<span class="op" id="4619099">=</span>&nbsp;<span class="ident" id="4619101">b</span><span class="op" id="4619102">.</span><span class="ident" id="4619103">lines</span><span class="op" id="4619108">[</span><span class="ident" id="4619109">this</span><span class="op" id="4619113">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4619119">if</span>&nbsp;<span class="ident" id="4619122">column</span>&nbsp;<span class="op" id="4619129">&lt;</span>&nbsp;<span class="builtinfunc" id="4619131">len</span><span class="op" id="4619134">(</span><span class="ident" id="4619135">line</span><span class="op" id="4619139">)</span><span class="op" id="4619140">-</span><span class="num" id="4619141">1</span>&nbsp;<span class="op" id="4619143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4619150">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619185">c</span>&nbsp;<span class="op" id="4619187">:=</span>&nbsp;<span class="ident" id="4619190">line</span><span class="op" id="4619194">[</span><span class="ident" id="4619195">column</span><span class="op" id="4619201">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4619208">//&nbsp;update&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4619229">if</span>&nbsp;<span class="ident" id="4619232">w</span>&nbsp;<span class="op" id="4619234">:=</span>&nbsp;<span class="ident" id="4619237">c</span><span class="op" id="4619238">.</span><span class="ident" id="4619239">width</span>&nbsp;<span class="op" id="4619245">+</span>&nbsp;<span class="ident" id="4619247">b</span><span class="op" id="4619248">.</span><span class="ident" id="4619249">padding</span><span class="op" id="4619256">;</span>&nbsp;<span class="ident" id="4619258">w</span>&nbsp;<span class="op" id="4619260">&gt;</span>&nbsp;<span class="ident" id="4619262">width</span>&nbsp;<span class="op" id="4619268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619276">width</span>&nbsp;<span class="op" id="4619282">=</span>&nbsp;<span class="ident" id="4619284">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619291">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4619298">//&nbsp;update&nbsp;discardable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4619325">if</span>&nbsp;<span class="ident" id="4619328">c</span><span class="op" id="4619329">.</span><span class="ident" id="4619330">width</span>&nbsp;<span class="op" id="4619336">&gt;</span>&nbsp;<span class="num" id="4619338">0</span>&nbsp;<span class="op" id="4619340">||</span>&nbsp;<span class="ident" id="4619343">c</span><span class="op" id="4619344">.</span><span class="ident" id="4619345">htab</span>&nbsp;<span class="op" id="4619350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619358">discardable</span>&nbsp;<span class="op" id="4619370">=</span>&nbsp;<span class="builtintype" id="4619372">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619389">}</span>&nbsp;<span class="keyword" id="4619391">else</span>&nbsp;<span class="op" id="4619396">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4619403">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4619423">//&nbsp;column&nbsp;block&nbsp;end</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4619447">//&nbsp;discard&nbsp;empty&nbsp;columns&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4619488">if</span>&nbsp;<span class="ident" id="4619491">discardable</span>&nbsp;<span class="op" id="4619503">&amp;&amp;</span>&nbsp;<span class="ident" id="4619506">b</span><span class="op" id="4619507">.</span><span class="ident" id="4619508">flags</span><span class="op" id="4619513">&amp;</span><span class="ident" id="4619514">DiscardEmptyColumns</span>&nbsp;<span class="op" id="4619534">!=</span>&nbsp;<span class="num" id="4619537">0</span>&nbsp;<span class="op" id="4619539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619545">width</span>&nbsp;<span class="op" id="4619551">=</span>&nbsp;<span class="num" id="4619553">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4619564">//&nbsp;format&nbsp;and&nbsp;print&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;right&nbsp;of&nbsp;this&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4619627">//&nbsp;(we&nbsp;know&nbsp;the&nbsp;widths&nbsp;of&nbsp;this&nbsp;column&nbsp;and&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;left)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619697">b</span><span class="op" id="4619698">.</span><span class="ident" id="4619699">widths</span>&nbsp;<span class="op" id="4619706">=</span>&nbsp;<span class="builtinfunc" id="4619708">append</span><span class="op" id="4619714">(</span><span class="ident" id="4619715">b</span><span class="op" id="4619716">.</span><span class="ident" id="4619717">widths</span><span class="op" id="4619723">,</span>&nbsp;<span class="ident" id="4619725">width</span><span class="op" id="4619730">)</span>&nbsp;<span class="comment" id="4619732">//&nbsp;push&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619749">pos</span>&nbsp;<span class="op" id="4619753">=</span>&nbsp;<span class="ident" id="4619755">b</span><span class="op" id="4619756">.</span><span class="ident" id="4619757">format</span><span class="op" id="4619763">(</span><span class="ident" id="4619764">pos</span><span class="op" id="4619767">,</span>&nbsp;<span class="ident" id="4619769">line0</span><span class="op" id="4619774">,</span>&nbsp;<span class="ident" id="4619776">this</span><span class="op" id="4619780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619785">b</span><span class="op" id="4619786">.</span><span class="ident" id="4619787">widths</span>&nbsp;<span class="op" id="4619794">=</span>&nbsp;<span class="ident" id="4619796">b</span><span class="op" id="4619797">.</span><span class="ident" id="4619798">widths</span><span class="op" id="4619804">[</span><span class="num" id="4619805">0</span>&nbsp;<span class="op" id="4619807">:</span>&nbsp;<span class="builtinfunc" id="4619809">len</span><span class="op" id="4619812">(</span><span class="ident" id="4619813">b</span><span class="op" id="4619814">.</span><span class="ident" id="4619815">widths</span><span class="op" id="4619821">)</span><span class="op" id="4619822">-</span><span class="num" id="4619823">1</span><span class="op" id="4619824">]</span>&nbsp;<span class="comment" id="4619826">//&nbsp;pop&nbsp;width</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4619842">line0</span>&nbsp;<span class="op" id="4619848">=</span>&nbsp;<span class="ident" id="4619850">this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4619864">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;end</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4619900">return</span>&nbsp;<span class="ident" id="4619907">b</span><span class="op" id="4619908">.</span><span class="ident" id="4619909">writeLines</span><span class="op" id="4619919">(</span><span class="ident" id="4619920">pos</span><span class="op" id="4619923">,</span>&nbsp;<span class="ident" id="4619925">line0</span><span class="op" id="4619930">,</span>&nbsp;<span class="ident" id="4619932">line1</span><span class="op" id="4619937">)</span><br>
<span class="lineno"></span><span class="op" id="4619939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4619942">//&nbsp;Append&nbsp;text&nbsp;to&nbsp;current&nbsp;cell.</span><br>
<span class="lineno"></span><span class="keyword" id="4619974">func</span>&nbsp;<span class="op" id="4619979">(</span><span class="ident" id="4619980">b</span>&nbsp;<span class="op" id="4619982">*</span><span class="ident" id="4619983">Writer</span><span class="op" id="4619989">)</span>&nbsp;<span class="builtinfunc" id="4619991">append</span><span class="op" id="4619997">(</span><span class="ident" id="4619998">text</span>&nbsp;<span class="op" id="4620003">[</span><span class="op" id="4620004">]</span><span class="builtintype" id="4620005">byte</span><span class="op" id="4620009">)</span>&nbsp;<span class="op" id="4620011">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620014">b</span><span class="op" id="4620015">.</span><span class="ident" id="4620016">buf</span><span class="op" id="4620019">.</span><span class="ident" id="4620020">Write</span><span class="op" id="4620025">(</span><span class="ident" id="4620026">text</span><span class="op" id="4620030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620033">b</span><span class="op" id="4620034">.</span><span class="ident" id="4620035">cell</span><span class="op" id="4620039">.</span><span class="ident" id="4620040">size</span>&nbsp;<span class="op" id="4620045">+=</span>&nbsp;<span class="builtinfunc" id="4620048">len</span><span class="op" id="4620051">(</span><span class="ident" id="4620052">text</span><span class="op" id="4620056">)</span><br>
<span class="lineno"></span><span class="op" id="4620058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4620061">//&nbsp;Update&nbsp;the&nbsp;cell&nbsp;width.</span><br>
<span class="lineno">380</span><span class="keyword" id="4620087">func</span>&nbsp;<span class="op" id="4620092">(</span><span class="ident" id="4620093">b</span>&nbsp;<span class="op" id="4620095">*</span><span class="ident" id="4620096">Writer</span><span class="op" id="4620102">)</span>&nbsp;<span class="ident" id="4620104">updateWidth</span><span class="op" id="4620115">(</span><span class="op" id="4620116">)</span>&nbsp;<span class="op" id="4620118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620121">b</span><span class="op" id="4620122">.</span><span class="ident" id="4620123">cell</span><span class="op" id="4620127">.</span><span class="ident" id="4620128">width</span>&nbsp;<span class="op" id="4620134">+=</span>&nbsp;<span class="ident" id="4620137">utf8</span><span class="op" id="4620141">.</span><span class="ident" id="4620142">RuneCount</span><span class="op" id="4620151">(</span><span class="ident" id="4620152">b</span><span class="op" id="4620153">.</span><span class="ident" id="4620154">buf</span><span class="op" id="4620157">.</span><span class="ident" id="4620158">Bytes</span><span class="op" id="4620163">(</span><span class="op" id="4620164">)</span><span class="op" id="4620165">[</span><span class="ident" id="4620166">b</span><span class="op" id="4620167">.</span><span class="ident" id="4620168">pos</span><span class="op" id="4620171">:</span><span class="ident" id="4620172">b</span><span class="op" id="4620173">.</span><span class="ident" id="4620174">buf</span><span class="op" id="4620177">.</span><span class="ident" id="4620178">Len</span><span class="op" id="4620181">(</span><span class="op" id="4620182">)</span><span class="op" id="4620183">]</span><span class="op" id="4620184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620187">b</span><span class="op" id="4620188">.</span><span class="ident" id="4620189">pos</span>&nbsp;<span class="op" id="4620193">=</span>&nbsp;<span class="ident" id="4620195">b</span><span class="op" id="4620196">.</span><span class="ident" id="4620197">buf</span><span class="op" id="4620200">.</span><span class="ident" id="4620201">Len</span><span class="op" id="4620204">(</span><span class="op" id="4620205">)</span><br>
<span class="lineno"></span><span class="op" id="4620207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="4620210">//&nbsp;To&nbsp;escape&nbsp;a&nbsp;text&nbsp;segment,&nbsp;bracket&nbsp;it&nbsp;with&nbsp;Escape&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="4620274">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;tab&nbsp;in&nbsp;this&nbsp;string&nbsp;&#34;Ignore&nbsp;this&nbsp;tab:&nbsp;\xff\t\xff&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4620344">//&nbsp;does&nbsp;not&nbsp;terminate&nbsp;a&nbsp;cell&nbsp;and&nbsp;constitutes&nbsp;a&nbsp;single&nbsp;character&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4620411">//&nbsp;width&nbsp;one&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4620449">//</span><br>
<span class="lineno">390</span><span class="comment" id="4620452">//&nbsp;The&nbsp;value&nbsp;0xff&nbsp;was&nbsp;chosen&nbsp;because&nbsp;it&nbsp;cannot&nbsp;appear&nbsp;in&nbsp;a&nbsp;valid&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="4620533">//</span><br>
<span class="lineno"></span><span class="keyword" id="4620536">const</span>&nbsp;<span class="ident" id="4620542">Escape</span>&nbsp;<span class="op" id="4620549">=</span>&nbsp;<span class="string" id="4620551">&#39;\xff&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4620559">//&nbsp;Start&nbsp;escaped&nbsp;mode.</span><br>
<span class="lineno">395</span><span class="keyword" id="4620582">func</span>&nbsp;<span class="op" id="4620587">(</span><span class="ident" id="4620588">b</span>&nbsp;<span class="op" id="4620590">*</span><span class="ident" id="4620591">Writer</span><span class="op" id="4620597">)</span>&nbsp;<span class="ident" id="4620599">startEscape</span><span class="op" id="4620610">(</span><span class="ident" id="4620611">ch</span>&nbsp;<span class="builtintype" id="4620614">byte</span><span class="op" id="4620618">)</span>&nbsp;<span class="op" id="4620620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4620623">switch</span>&nbsp;<span class="ident" id="4620630">ch</span>&nbsp;<span class="op" id="4620633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4620636">case</span>&nbsp;<span class="ident" id="4620641">Escape</span><span class="op" id="4620647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620651">b</span><span class="op" id="4620652">.</span><span class="ident" id="4620653">endChar</span>&nbsp;<span class="op" id="4620661">=</span>&nbsp;<span class="ident" id="4620663">Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4620671">case</span>&nbsp;<span class="string" id="4620676">&#39;&lt;&#39;</span><span class="op" id="4620679">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620683">b</span><span class="op" id="4620684">.</span><span class="ident" id="4620685">endChar</span>&nbsp;<span class="op" id="4620693">=</span>&nbsp;<span class="string" id="4620695">&#39;&gt;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4620700">case</span>&nbsp;<span class="string" id="4620705">&#39;&amp;&#39;</span><span class="op" id="4620708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620712">b</span><span class="op" id="4620713">.</span><span class="ident" id="4620714">endChar</span>&nbsp;<span class="op" id="4620722">=</span>&nbsp;<span class="string" id="4620724">&#39;;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4620729">}</span><br>
<span class="lineno"></span><span class="op" id="4620731">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4620734">//&nbsp;Terminate&nbsp;escaped&nbsp;mode.&nbsp;If&nbsp;the&nbsp;escaped&nbsp;text&nbsp;was&nbsp;an&nbsp;HTML&nbsp;tag,&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="4620808">//&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;for&nbsp;formatting&nbsp;purposes;&nbsp;if&nbsp;it&nbsp;was&nbsp;an&nbsp;HTML&nbsp;entity,</span><br>
<span class="lineno"></span><span class="comment" id="4620884">//&nbsp;its&nbsp;width&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;one.&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;the&nbsp;width&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4620956">//&nbsp;unicode&nbsp;width&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno">410</span><span class="comment" id="4620986">//</span><br>
<span class="lineno"></span><span class="keyword" id="4620989">func</span>&nbsp;<span class="op" id="4620994">(</span><span class="ident" id="4620995">b</span>&nbsp;<span class="op" id="4620997">*</span><span class="ident" id="4620998">Writer</span><span class="op" id="4621004">)</span>&nbsp;<span class="ident" id="4621006">endEscape</span><span class="op" id="4621015">(</span><span class="op" id="4621016">)</span>&nbsp;<span class="op" id="4621018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621021">switch</span>&nbsp;<span class="ident" id="4621028">b</span><span class="op" id="4621029">.</span><span class="ident" id="4621030">endChar</span>&nbsp;<span class="op" id="4621038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621041">case</span>&nbsp;<span class="ident" id="4621046">Escape</span><span class="op" id="4621052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621056">b</span><span class="op" id="4621057">.</span><span class="ident" id="4621058">updateWidth</span><span class="op" id="4621069">(</span><span class="op" id="4621070">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621074">if</span>&nbsp;<span class="ident" id="4621077">b</span><span class="op" id="4621078">.</span><span class="ident" id="4621079">flags</span><span class="op" id="4621084">&amp;</span><span class="ident" id="4621085">StripEscape</span>&nbsp;<span class="op" id="4621097">==</span>&nbsp;<span class="num" id="4621100">0</span>&nbsp;<span class="op" id="4621102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621107">b</span><span class="op" id="4621108">.</span><span class="ident" id="4621109">cell</span><span class="op" id="4621113">.</span><span class="ident" id="4621114">width</span>&nbsp;<span class="op" id="4621120">-=</span>&nbsp;<span class="num" id="4621123">2</span>&nbsp;<span class="comment" id="4621125">//&nbsp;don&#39;t&nbsp;count&nbsp;the&nbsp;Escape&nbsp;chars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4621159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621162">case</span>&nbsp;<span class="string" id="4621167">&#39;&gt;&#39;</span><span class="op" id="4621170">:</span>&nbsp;<span class="comment" id="4621172">//&nbsp;tag&nbsp;of&nbsp;zero&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621194">case</span>&nbsp;<span class="string" id="4621199">&#39;;&#39;</span><span class="op" id="4621202">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621206">b</span><span class="op" id="4621207">.</span><span class="ident" id="4621208">cell</span><span class="op" id="4621212">.</span><span class="ident" id="4621213">width</span><span class="op" id="4621218">++</span>&nbsp;<span class="comment" id="4621221">//&nbsp;entity,&nbsp;count&nbsp;as&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4621251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621254">b</span><span class="op" id="4621255">.</span><span class="ident" id="4621256">pos</span>&nbsp;<span class="op" id="4621260">=</span>&nbsp;<span class="ident" id="4621262">b</span><span class="op" id="4621263">.</span><span class="ident" id="4621264">buf</span><span class="op" id="4621267">.</span><span class="ident" id="4621268">Len</span><span class="op" id="4621271">(</span><span class="op" id="4621272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621275">b</span><span class="op" id="4621276">.</span><span class="ident" id="4621277">endChar</span>&nbsp;<span class="op" id="4621285">=</span>&nbsp;<span class="num" id="4621287">0</span><br>
<span class="lineno"></span><span class="op" id="4621289">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="4621292">//&nbsp;Terminate&nbsp;the&nbsp;current&nbsp;cell&nbsp;by&nbsp;adding&nbsp;it&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;cells&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4621363">//&nbsp;current&nbsp;line.&nbsp;Returns&nbsp;the&nbsp;number&nbsp;of&nbsp;cells&nbsp;in&nbsp;that&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="4621422">//</span><br>
<span class="lineno"></span><span class="keyword" id="4621425">func</span>&nbsp;<span class="op" id="4621430">(</span><span class="ident" id="4621431">b</span>&nbsp;<span class="op" id="4621433">*</span><span class="ident" id="4621434">Writer</span><span class="op" id="4621440">)</span>&nbsp;<span class="ident" id="4621442">terminateCell</span><span class="op" id="4621455">(</span><span class="ident" id="4621456">htab</span>&nbsp;<span class="builtintype" id="4621461">bool</span><span class="op" id="4621465">)</span>&nbsp;<span class="builtintype" id="4621467">int</span>&nbsp;<span class="op" id="4621471">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621474">b</span><span class="op" id="4621475">.</span><span class="ident" id="4621476">cell</span><span class="op" id="4621480">.</span><span class="ident" id="4621481">htab</span>&nbsp;<span class="op" id="4621486">=</span>&nbsp;<span class="ident" id="4621488">htab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621494">line</span>&nbsp;<span class="op" id="4621499">:=</span>&nbsp;<span class="op" id="4621502">&amp;</span><span class="ident" id="4621503">b</span><span class="op" id="4621504">.</span><span class="ident" id="4621505">lines</span><span class="op" id="4621510">[</span><span class="builtinfunc" id="4621511">len</span><span class="op" id="4621514">(</span><span class="ident" id="4621515">b</span><span class="op" id="4621516">.</span><span class="ident" id="4621517">lines</span><span class="op" id="4621522">)</span><span class="op" id="4621523">-</span><span class="num" id="4621524">1</span><span class="op" id="4621525">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4621528">*</span><span class="ident" id="4621529">line</span>&nbsp;<span class="op" id="4621534">=</span>&nbsp;<span class="builtinfunc" id="4621536">append</span><span class="op" id="4621542">(</span><span class="op" id="4621543">*</span><span class="ident" id="4621544">line</span><span class="op" id="4621548">,</span>&nbsp;<span class="ident" id="4621550">b</span><span class="op" id="4621551">.</span><span class="ident" id="4621552">cell</span><span class="op" id="4621556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621559">b</span><span class="op" id="4621560">.</span><span class="ident" id="4621561">cell</span>&nbsp;<span class="op" id="4621566">=</span>&nbsp;<span class="ident" id="4621568">cell</span><span class="op" id="4621572">{</span><span class="op" id="4621573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621576">return</span>&nbsp;<span class="builtinfunc" id="4621583">len</span><span class="op" id="4621586">(</span><span class="op" id="4621587">*</span><span class="ident" id="4621588">line</span><span class="op" id="4621592">)</span><br>
<span class="lineno">435</span><span class="op" id="4621594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4621597">func</span>&nbsp;<span class="ident" id="4621602">handlePanic</span><span class="op" id="4621613">(</span><span class="ident" id="4621614">err</span>&nbsp;<span class="op" id="4621618">*</span><span class="builtintype" id="4621619">error</span><span class="op" id="4621624">,</span>&nbsp;<span class="ident" id="4621626">op</span>&nbsp;<span class="builtintype" id="4621629">string</span><span class="op" id="4621635">)</span>&nbsp;<span class="op" id="4621637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621640">if</span>&nbsp;<span class="ident" id="4621643">e</span>&nbsp;<span class="op" id="4621645">:=</span>&nbsp;<span class="builtinfunc" id="4621648">recover</span><span class="op" id="4621655">(</span><span class="op" id="4621656">)</span><span class="op" id="4621657">;</span>&nbsp;<span class="ident" id="4621659">e</span>&nbsp;<span class="op" id="4621661">!=</span>&nbsp;<span class="ident" id="4621664">nil</span>&nbsp;<span class="op" id="4621668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621672">if</span>&nbsp;<span class="ident" id="4621675">nerr</span><span class="op" id="4621679">,</span>&nbsp;<span class="ident" id="4621681">ok</span>&nbsp;<span class="op" id="4621684">:=</span>&nbsp;<span class="ident" id="4621687">e</span><span class="op" id="4621688">.</span><span class="op" id="4621689">(</span><span class="ident" id="4621690">osError</span><span class="op" id="4621697">)</span><span class="op" id="4621698">;</span>&nbsp;<span class="ident" id="4621700">ok</span>&nbsp;<span class="op" id="4621703">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4621708">*</span><span class="ident" id="4621709">err</span>&nbsp;<span class="op" id="4621713">=</span>&nbsp;<span class="ident" id="4621715">nerr</span><span class="op" id="4621719">.</span><span class="ident" id="4621720">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621727">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4621736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4621740">panic</span><span class="op" id="4621745">(</span><span class="string" id="4621746">&#34;tabwriter:&nbsp;panic&nbsp;during&nbsp;&#34;</span>&nbsp;<span class="op" id="4621773">+</span>&nbsp;<span class="ident" id="4621775">op</span><span class="op" id="4621777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4621780">}</span><br>
<span class="lineno">445</span><span class="op" id="4621782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4621785">//&nbsp;Flush&nbsp;should&nbsp;be&nbsp;called&nbsp;after&nbsp;the&nbsp;last&nbsp;call&nbsp;to&nbsp;Write&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="4621850">//&nbsp;that&nbsp;any&nbsp;data&nbsp;buffered&nbsp;in&nbsp;the&nbsp;Writer&nbsp;is&nbsp;written&nbsp;to&nbsp;output.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="4621916">//&nbsp;incomplete&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;end&nbsp;is&nbsp;considered</span><br>
<span class="lineno">450</span><span class="comment" id="4621971">//&nbsp;complete&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4622008">//</span><br>
<span class="lineno"></span><span class="keyword" id="4622011">func</span>&nbsp;<span class="op" id="4622016">(</span><span class="ident" id="4622017">b</span>&nbsp;<span class="op" id="4622019">*</span><span class="ident" id="4622020">Writer</span><span class="op" id="4622026">)</span>&nbsp;<span class="ident" id="4622028">Flush</span><span class="op" id="4622033">(</span><span class="op" id="4622034">)</span>&nbsp;<span class="op" id="4622036">(</span><span class="ident" id="4622037">err</span>&nbsp;<span class="builtintype" id="4622041">error</span><span class="op" id="4622046">)</span>&nbsp;<span class="op" id="4622048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622051">defer</span>&nbsp;<span class="ident" id="4622057">b</span><span class="op" id="4622058">.</span><span class="ident" id="4622059">reset</span><span class="op" id="4622064">(</span><span class="op" id="4622065">)</span>&nbsp;<span class="comment" id="4622067">//&nbsp;even&nbsp;in&nbsp;the&nbsp;presence&nbsp;of&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622102">defer</span>&nbsp;<span class="ident" id="4622108">handlePanic</span><span class="op" id="4622119">(</span><span class="op" id="4622120">&amp;</span><span class="ident" id="4622121">err</span><span class="op" id="4622124">,</span>&nbsp;<span class="string" id="4622126">&#34;Flush&#34;</span><span class="op" id="4622133">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622137">//&nbsp;add&nbsp;current&nbsp;cell&nbsp;if&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622171">if</span>&nbsp;<span class="ident" id="4622174">b</span><span class="op" id="4622175">.</span><span class="ident" id="4622176">cell</span><span class="op" id="4622180">.</span><span class="ident" id="4622181">size</span>&nbsp;<span class="op" id="4622186">&gt;</span>&nbsp;<span class="num" id="4622188">0</span>&nbsp;<span class="op" id="4622190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622194">if</span>&nbsp;<span class="ident" id="4622197">b</span><span class="op" id="4622198">.</span><span class="ident" id="4622199">endChar</span>&nbsp;<span class="op" id="4622207">!=</span>&nbsp;<span class="num" id="4622210">0</span>&nbsp;<span class="op" id="4622212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622217">//&nbsp;inside&nbsp;escape&nbsp;-&nbsp;terminate&nbsp;it&nbsp;even&nbsp;if&nbsp;incomplete</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622271">b</span><span class="op" id="4622272">.</span><span class="ident" id="4622273">endEscape</span><span class="op" id="4622282">(</span><span class="op" id="4622283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4622287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622291">b</span><span class="op" id="4622292">.</span><span class="ident" id="4622293">terminateCell</span><span class="op" id="4622306">(</span><span class="builtintype" id="4622307">false</span><span class="op" id="4622312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4622315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622319">//&nbsp;format&nbsp;contents&nbsp;of&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622349">b</span><span class="op" id="4622350">.</span><span class="ident" id="4622351">format</span><span class="op" id="4622357">(</span><span class="num" id="4622358">0</span><span class="op" id="4622359">,</span>&nbsp;<span class="num" id="4622361">0</span><span class="op" id="4622362">,</span>&nbsp;<span class="builtinfunc" id="4622364">len</span><span class="op" id="4622367">(</span><span class="ident" id="4622368">b</span><span class="op" id="4622369">.</span><span class="ident" id="4622370">lines</span><span class="op" id="4622375">)</span><span class="op" id="4622376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622380">return</span><br>
<span class="lineno"></span><span class="op" id="4622387">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="4622390">var</span>&nbsp;<span class="ident" id="4622394">hbar</span>&nbsp;<span class="op" id="4622399">=</span>&nbsp;<span class="op" id="4622401">[</span><span class="op" id="4622402">]</span><span class="builtintype" id="4622403">byte</span><span class="op" id="4622407">(</span><span class="string" id="4622408">&#34;---\n&#34;</span><span class="op" id="4622415">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4622418">//&nbsp;Write&nbsp;writes&nbsp;buf&nbsp;to&nbsp;the&nbsp;writer&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="4622455">//&nbsp;The&nbsp;only&nbsp;errors&nbsp;returned&nbsp;are&nbsp;ones&nbsp;encountered</span><br>
<span class="lineno">475</span><span class="comment" id="4622504">//&nbsp;while&nbsp;writing&nbsp;to&nbsp;the&nbsp;underlying&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="4622554">//</span><br>
<span class="lineno"></span><span class="keyword" id="4622557">func</span>&nbsp;<span class="op" id="4622562">(</span><span class="ident" id="4622563">b</span>&nbsp;<span class="op" id="4622565">*</span><span class="ident" id="4622566">Writer</span><span class="op" id="4622572">)</span>&nbsp;<span class="ident" id="4622574">Write</span><span class="op" id="4622579">(</span><span class="ident" id="4622580">buf</span>&nbsp;<span class="op" id="4622584">[</span><span class="op" id="4622585">]</span><span class="builtintype" id="4622586">byte</span><span class="op" id="4622590">)</span>&nbsp;<span class="op" id="4622592">(</span><span class="ident" id="4622593">n</span>&nbsp;<span class="builtintype" id="4622595">int</span><span class="op" id="4622598">,</span>&nbsp;<span class="ident" id="4622600">err</span>&nbsp;<span class="builtintype" id="4622604">error</span><span class="op" id="4622609">)</span>&nbsp;<span class="op" id="4622611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622614">defer</span>&nbsp;<span class="ident" id="4622620">handlePanic</span><span class="op" id="4622631">(</span><span class="op" id="4622632">&amp;</span><span class="ident" id="4622633">err</span><span class="op" id="4622636">,</span>&nbsp;<span class="string" id="4622638">&#34;Write&#34;</span><span class="op" id="4622645">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622649">//&nbsp;split&nbsp;text&nbsp;into&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622675">n</span>&nbsp;<span class="op" id="4622677">=</span>&nbsp;<span class="num" id="4622679">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622682">for</span>&nbsp;<span class="ident" id="4622686">i</span><span class="op" id="4622687">,</span>&nbsp;<span class="ident" id="4622689">ch</span>&nbsp;<span class="op" id="4622692">:=</span>&nbsp;<span class="keyword" id="4622695">range</span>&nbsp;<span class="ident" id="4622701">buf</span>&nbsp;<span class="op" id="4622705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622709">if</span>&nbsp;<span class="ident" id="4622712">b</span><span class="op" id="4622713">.</span><span class="ident" id="4622714">endChar</span>&nbsp;<span class="op" id="4622722">==</span>&nbsp;<span class="num" id="4622725">0</span>&nbsp;<span class="op" id="4622727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622732">//&nbsp;outside&nbsp;escape</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622753">switch</span>&nbsp;<span class="ident" id="4622760">ch</span>&nbsp;<span class="op" id="4622763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622768">case</span>&nbsp;<span class="string" id="4622773">&#39;\t&#39;</span><span class="op" id="4622777">,</span>&nbsp;<span class="string" id="4622779">&#39;\v&#39;</span><span class="op" id="4622783">,</span>&nbsp;<span class="string" id="4622785">&#39;\n&#39;</span><span class="op" id="4622789">,</span>&nbsp;<span class="string" id="4622791">&#39;\f&#39;</span><span class="op" id="4622795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622801">//&nbsp;end&nbsp;of&nbsp;cell</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622820">b</span><span class="op" id="4622821">.</span><span class="builtinfunc" id="4622822">append</span><span class="op" id="4622828">(</span><span class="ident" id="4622829">buf</span><span class="op" id="4622832">[</span><span class="ident" id="4622833">n</span><span class="op" id="4622834">:</span><span class="ident" id="4622835">i</span><span class="op" id="4622836">]</span><span class="op" id="4622837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622843">b</span><span class="op" id="4622844">.</span><span class="ident" id="4622845">updateWidth</span><span class="op" id="4622856">(</span><span class="op" id="4622857">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622863">n</span>&nbsp;<span class="op" id="4622865">=</span>&nbsp;<span class="ident" id="4622867">i</span>&nbsp;<span class="op" id="4622869">+</span>&nbsp;<span class="num" id="4622871">1</span>&nbsp;<span class="comment" id="4622873">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622892">ncells</span>&nbsp;<span class="op" id="4622899">:=</span>&nbsp;<span class="ident" id="4622902">b</span><span class="op" id="4622903">.</span><span class="ident" id="4622904">terminateCell</span><span class="op" id="4622917">(</span><span class="ident" id="4622918">ch</span>&nbsp;<span class="op" id="4622921">==</span>&nbsp;<span class="string" id="4622924">&#39;\t&#39;</span><span class="op" id="4622928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622934">if</span>&nbsp;<span class="ident" id="4622937">ch</span>&nbsp;<span class="op" id="4622940">==</span>&nbsp;<span class="string" id="4622943">&#39;\n&#39;</span>&nbsp;<span class="op" id="4622948">||</span>&nbsp;<span class="ident" id="4622951">ch</span>&nbsp;<span class="op" id="4622954">==</span>&nbsp;<span class="string" id="4622957">&#39;\f&#39;</span>&nbsp;<span class="op" id="4622962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4622969">//&nbsp;terminate&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622992">b</span><span class="op" id="4622993">.</span><span class="ident" id="4622994">addLine</span><span class="op" id="4623001">(</span><span class="op" id="4623002">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623009">if</span>&nbsp;<span class="ident" id="4623012">ch</span>&nbsp;<span class="op" id="4623015">==</span>&nbsp;<span class="string" id="4623018">&#39;\f&#39;</span>&nbsp;<span class="op" id="4623023">||</span>&nbsp;<span class="ident" id="4623026">ncells</span>&nbsp;<span class="op" id="4623033">==</span>&nbsp;<span class="num" id="4623036">1</span>&nbsp;<span class="op" id="4623038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623046">//&nbsp;A&nbsp;&#39;\f&#39;&nbsp;always&nbsp;forces&nbsp;a&nbsp;flush.&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;previous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623112">//&nbsp;line&nbsp;has&nbsp;only&nbsp;one&nbsp;cell&nbsp;which&nbsp;does&nbsp;not&nbsp;have&nbsp;an&nbsp;impact&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623177">//&nbsp;the&nbsp;formatting&nbsp;of&nbsp;the&nbsp;following&nbsp;lines&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623243">//&nbsp;line&nbsp;is&nbsp;ignored&nbsp;by&nbsp;format()),&nbsp;thus&nbsp;we&nbsp;can&nbsp;flush&nbsp;the</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623304">//&nbsp;Writer&nbsp;contents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623330">if</span>&nbsp;<span class="ident" id="4623333">err</span>&nbsp;<span class="op" id="4623337">=</span>&nbsp;<span class="ident" id="4623339">b</span><span class="op" id="4623340">.</span><span class="ident" id="4623341">Flush</span><span class="op" id="4623346">(</span><span class="op" id="4623347">)</span><span class="op" id="4623348">;</span>&nbsp;<span class="ident" id="4623350">err</span>&nbsp;<span class="op" id="4623354">!=</span>&nbsp;<span class="ident" id="4623357">nil</span>&nbsp;<span class="op" id="4623361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623370">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623391">if</span>&nbsp;<span class="ident" id="4623394">ch</span>&nbsp;<span class="op" id="4623397">==</span>&nbsp;<span class="string" id="4623400">&#39;\f&#39;</span>&nbsp;<span class="op" id="4623405">&amp;&amp;</span>&nbsp;<span class="ident" id="4623408">b</span><span class="op" id="4623409">.</span><span class="ident" id="4623410">flags</span><span class="op" id="4623415">&amp;</span><span class="ident" id="4623416">Debug</span>&nbsp;<span class="op" id="4623422">!=</span>&nbsp;<span class="num" id="4623425">0</span>&nbsp;<span class="op" id="4623427">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623436">//&nbsp;indicate&nbsp;section&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623469">b</span><span class="op" id="4623470">.</span><span class="ident" id="4623471">write0</span><span class="op" id="4623477">(</span><span class="ident" id="4623478">hbar</span><span class="op" id="4623482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623503">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623509">case</span>&nbsp;<span class="ident" id="4623514">Escape</span><span class="op" id="4623520">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623526">//&nbsp;start&nbsp;of&nbsp;escaped&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623559">b</span><span class="op" id="4623560">.</span><span class="builtinfunc" id="4623561">append</span><span class="op" id="4623567">(</span><span class="ident" id="4623568">buf</span><span class="op" id="4623571">[</span><span class="ident" id="4623572">n</span><span class="op" id="4623573">:</span><span class="ident" id="4623574">i</span><span class="op" id="4623575">]</span><span class="op" id="4623576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623582">b</span><span class="op" id="4623583">.</span><span class="ident" id="4623584">updateWidth</span><span class="op" id="4623595">(</span><span class="op" id="4623596">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623602">n</span>&nbsp;<span class="op" id="4623604">=</span>&nbsp;<span class="ident" id="4623606">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623612">if</span>&nbsp;<span class="ident" id="4623615">b</span><span class="op" id="4623616">.</span><span class="ident" id="4623617">flags</span><span class="op" id="4623622">&amp;</span><span class="ident" id="4623623">StripEscape</span>&nbsp;<span class="op" id="4623635">!=</span>&nbsp;<span class="num" id="4623638">0</span>&nbsp;<span class="op" id="4623640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623647">n</span><span class="op" id="4623648">++</span>&nbsp;<span class="comment" id="4623651">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623677">b</span><span class="op" id="4623678">.</span><span class="ident" id="4623679">startEscape</span><span class="op" id="4623690">(</span><span class="ident" id="4623691">Escape</span><span class="op" id="4623697">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623703">case</span>&nbsp;<span class="string" id="4623708">&#39;&lt;&#39;</span><span class="op" id="4623711">,</span>&nbsp;<span class="string" id="4623713">&#39;&amp;&#39;</span><span class="op" id="4623716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623722">//&nbsp;possibly&nbsp;an&nbsp;html&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623757">if</span>&nbsp;<span class="ident" id="4623760">b</span><span class="op" id="4623761">.</span><span class="ident" id="4623762">flags</span><span class="op" id="4623767">&amp;</span><span class="ident" id="4623768">FilterHTML</span>&nbsp;<span class="op" id="4623779">!=</span>&nbsp;<span class="num" id="4623782">0</span>&nbsp;<span class="op" id="4623784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623791">//&nbsp;begin&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623819">b</span><span class="op" id="4623820">.</span><span class="builtinfunc" id="4623821">append</span><span class="op" id="4623827">(</span><span class="ident" id="4623828">buf</span><span class="op" id="4623831">[</span><span class="ident" id="4623832">n</span><span class="op" id="4623833">:</span><span class="ident" id="4623834">i</span><span class="op" id="4623835">]</span><span class="op" id="4623836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623843">b</span><span class="op" id="4623844">.</span><span class="ident" id="4623845">updateWidth</span><span class="op" id="4623856">(</span><span class="op" id="4623857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623864">n</span>&nbsp;<span class="op" id="4623866">=</span>&nbsp;<span class="ident" id="4623868">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623875">b</span><span class="op" id="4623876">.</span><span class="ident" id="4623877">startEscape</span><span class="op" id="4623888">(</span><span class="ident" id="4623889">ch</span><span class="op" id="4623891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623897">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623907">}</span>&nbsp;<span class="keyword" id="4623909">else</span>&nbsp;<span class="op" id="4623914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623919">//&nbsp;inside&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623939">if</span>&nbsp;<span class="ident" id="4623942">ch</span>&nbsp;<span class="op" id="4623945">==</span>&nbsp;<span class="ident" id="4623948">b</span><span class="op" id="4623949">.</span><span class="ident" id="4623950">endChar</span>&nbsp;<span class="op" id="4623958">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4623964">//&nbsp;end&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623989">j</span>&nbsp;<span class="op" id="4623991">:=</span>&nbsp;<span class="ident" id="4623994">i</span>&nbsp;<span class="op" id="4623996">+</span>&nbsp;<span class="num" id="4623998">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624004">if</span>&nbsp;<span class="ident" id="4624007">ch</span>&nbsp;<span class="op" id="4624010">==</span>&nbsp;<span class="ident" id="4624013">Escape</span>&nbsp;<span class="op" id="4624020">&amp;&amp;</span>&nbsp;<span class="ident" id="4624023">b</span><span class="op" id="4624024">.</span><span class="ident" id="4624025">flags</span><span class="op" id="4624030">&amp;</span><span class="ident" id="4624031">StripEscape</span>&nbsp;<span class="op" id="4624043">!=</span>&nbsp;<span class="num" id="4624046">0</span>&nbsp;<span class="op" id="4624048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624055">j</span>&nbsp;<span class="op" id="4624057">=</span>&nbsp;<span class="ident" id="4624059">i</span>&nbsp;<span class="comment" id="4624061">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4624081">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624087">b</span><span class="op" id="4624088">.</span><span class="builtinfunc" id="4624089">append</span><span class="op" id="4624095">(</span><span class="ident" id="4624096">buf</span><span class="op" id="4624099">[</span><span class="ident" id="4624100">n</span><span class="op" id="4624101">:</span><span class="ident" id="4624102">j</span><span class="op" id="4624103">]</span><span class="op" id="4624104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624110">n</span>&nbsp;<span class="op" id="4624112">=</span>&nbsp;<span class="ident" id="4624114">i</span>&nbsp;<span class="op" id="4624116">+</span>&nbsp;<span class="num" id="4624118">1</span>&nbsp;<span class="comment" id="4624120">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624139">b</span><span class="op" id="4624140">.</span><span class="ident" id="4624141">endEscape</span><span class="op" id="4624150">(</span><span class="op" id="4624151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4624156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4624160">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4624163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4624167">//&nbsp;append&nbsp;leftover&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624192">b</span><span class="op" id="4624193">.</span><span class="builtinfunc" id="4624194">append</span><span class="op" id="4624200">(</span><span class="ident" id="4624201">buf</span><span class="op" id="4624204">[</span><span class="ident" id="4624205">n</span><span class="op" id="4624206">:</span><span class="op" id="4624207">]</span><span class="op" id="4624208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624211">n</span>&nbsp;<span class="op" id="4624213">=</span>&nbsp;<span class="builtinfunc" id="4624215">len</span><span class="op" id="4624218">(</span><span class="ident" id="4624219">buf</span><span class="op" id="4624222">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624225">return</span><br>
<span class="lineno"></span><span class="op" id="4624232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4624235">//&nbsp;NewWriter&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;tabwriter.Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4624298">//&nbsp;The&nbsp;parameters&nbsp;are&nbsp;the&nbsp;same&nbsp;as&nbsp;for&nbsp;the&nbsp;Init&nbsp;function.</span><br>
<span class="lineno">555</span><span class="comment" id="4624355">//</span><br>
<span class="lineno"></span><span class="keyword" id="4624358">func</span>&nbsp;<span class="ident" id="4624363">NewWriter</span><span class="op" id="4624372">(</span><span class="ident" id="4624373">output</span>&nbsp;<span class="ident" id="4624380">io</span><span class="op" id="4624382">.</span><span class="ident" id="4624383">Writer</span><span class="op" id="4624389">,</span>&nbsp;<span class="ident" id="4624391">minwidth</span><span class="op" id="4624399">,</span>&nbsp;<span class="ident" id="4624401">tabwidth</span><span class="op" id="4624409">,</span>&nbsp;<span class="ident" id="4624411">padding</span>&nbsp;<span class="builtintype" id="4624419">int</span><span class="op" id="4624422">,</span>&nbsp;<span class="ident" id="4624424">padchar</span>&nbsp;<span class="builtintype" id="4624432">byte</span><span class="op" id="4624436">,</span>&nbsp;<span class="ident" id="4624438">flags</span>&nbsp;<span class="builtintype" id="4624444">uint</span><span class="op" id="4624448">)</span>&nbsp;<span class="op" id="4624450">*</span><span class="ident" id="4624451">Writer</span>&nbsp;<span class="op" id="4624458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624461">return</span>&nbsp;<span class="builtinfunc" id="4624468">new</span><span class="op" id="4624471">(</span><span class="ident" id="4624472">Writer</span><span class="op" id="4624478">)</span><span class="op" id="4624479">.</span><span class="ident" id="4624480">Init</span><span class="op" id="4624484">(</span><span class="ident" id="4624485">output</span><span class="op" id="4624491">,</span>&nbsp;<span class="ident" id="4624493">minwidth</span><span class="op" id="4624501">,</span>&nbsp;<span class="ident" id="4624503">tabwidth</span><span class="op" id="4624511">,</span>&nbsp;<span class="ident" id="4624513">padding</span><span class="op" id="4624520">,</span>&nbsp;<span class="ident" id="4624522">padchar</span><span class="op" id="4624529">,</span>&nbsp;<span class="ident" id="4624531">flags</span><span class="op" id="4624536">)</span><br>
<span class="lineno"></span><span class="op" id="4624538">}</span>
</div>
</body>
</html>
