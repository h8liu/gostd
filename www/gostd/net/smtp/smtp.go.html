<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4111311">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4111366">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4111420">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4111471">//&nbsp;Package&nbsp;smtp&nbsp;implements&nbsp;the&nbsp;Simple&nbsp;Mail&nbsp;Transfer&nbsp;Protocol&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="comment" id="4111556">//&nbsp;It&nbsp;also&nbsp;implements&nbsp;the&nbsp;following&nbsp;extensions:</span><br>
<span class="lineno"></span><span class="comment" id="4111604">//&nbsp;&nbsp;&nbsp;&nbsp8BITMIME&nbsp;&nbsp;RFC&nbsp;1652</span><br>
<span class="lineno"></span><span class="comment" id="4111626">//&nbsp;&nbsp;&nbsp;&nbspAUTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;2554</span><br>
<span class="lineno"></span><span class="comment" id="4111648">//&nbsp;&nbsp;&nbsp;&nbspSTARTTLS&nbsp;&nbsp;RFC&nbsp;3207</span><br>
<span class="lineno">10</span><span class="comment" id="4111670">//&nbsp;Additional&nbsp;extensions&nbsp;may&nbsp;be&nbsp;handled&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="4111722">package</span>&nbsp;<span class="ident" id="4111730">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4111736">import</span>&nbsp;<span class="op" id="4111743">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4111746">&#34;crypto/tls&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4111760">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4111779">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4111789">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4111795">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4111802">&#34;net/textproto&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4111819">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4111829">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4111832">//&nbsp;A&nbsp;Client&nbsp;represents&nbsp;a&nbsp;client&nbsp;connection&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="4111894">type</span>&nbsp;<span class="ident" id="4111899">Client</span>&nbsp;<span class="keyword" id="4111906">struct</span>&nbsp;<span class="op" id="4111913">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4111916">//&nbsp;Text&nbsp;is&nbsp;the&nbsp;textproto.Conn&nbsp;used&nbsp;by&nbsp;the&nbsp;Client.&nbsp;It&nbsp;is&nbsp;exported&nbsp;to&nbsp;allow&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4111995">//&nbsp;clients&nbsp;to&nbsp;add&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112026">Text</span>&nbsp;<span class="op" id="4112031">*</span><span class="ident" id="4112032">textproto</span><span class="op" id="4112041">.</span><span class="ident" id="4112042">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112048">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112121">//&nbsp;connection&nbsp;later</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112142">conn</span>&nbsp;<span class="ident" id="4112147">net</span><span class="op" id="4112150">.</span><span class="ident" id="4112151">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112157">//&nbsp;whether&nbsp;the&nbsp;Client&nbsp;is&nbsp;using&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112193">tls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4112204">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112210">serverName</span>&nbsp;<span class="builtintype" id="4112221">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112229">//&nbsp;map&nbsp;of&nbsp;supported&nbsp;extensions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112261">ext</span>&nbsp;<span class="keyword" id="4112265">map</span><span class="op" id="4112268">[</span><span class="builtintype" id="4112269">string</span><span class="op" id="4112275">]</span><span class="builtintype" id="4112276">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112284">//&nbsp;supported&nbsp;auth&nbsp;mechanisms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112314">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112325">[</span><span class="op" id="4112326">]</span><span class="builtintype" id="4112327">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112335">localName</span>&nbsp;&nbsp;<span class="builtintype" id="4112346">string</span>&nbsp;<span class="comment" id="4112353">//&nbsp;the&nbsp;name&nbsp;to&nbsp;use&nbsp;in&nbsp;HELO/EHLO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112386">didHello</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4112397">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4112404">//&nbsp;whether&nbsp;we&#39;ve&nbsp;said&nbsp;HELO/EHLO</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112437">helloError</span>&nbsp;<span class="builtintype" id="4112448">error</span>&nbsp;&nbsp;<span class="comment" id="4112455">//&nbsp;the&nbsp;error&nbsp;from&nbsp;the&nbsp;hello</span><br>
<span class="lineno"></span><span class="op" id="4112483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4112486">//&nbsp;Dial&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;connected&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="4112552">//&nbsp;The&nbsp;addr&nbsp;must&nbsp;include&nbsp;a&nbsp;port&nbsp;number.</span><br>
<span class="lineno">45</span><span class="keyword" id="4112592">func</span>&nbsp;<span class="ident" id="4112597">Dial</span><span class="op" id="4112601">(</span><span class="ident" id="4112602">addr</span>&nbsp;<span class="builtintype" id="4112607">string</span><span class="op" id="4112613">)</span>&nbsp;<span class="op" id="4112615">(</span><span class="op" id="4112616">*</span><span class="ident" id="4112617">Client</span><span class="op" id="4112623">,</span>&nbsp;<span class="builtintype" id="4112625">error</span><span class="op" id="4112630">)</span>&nbsp;<span class="op" id="4112632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112635">conn</span><span class="op" id="4112639">,</span>&nbsp;<span class="ident" id="4112641">err</span>&nbsp;<span class="op" id="4112645">:=</span>&nbsp;<span class="ident" id="4112648">net</span><span class="op" id="4112651">.</span><span class="ident" id="4112652">Dial</span><span class="op" id="4112656">(</span><span class="string" id="4112657">&#34;tcp&#34;</span><span class="op" id="4112662">,</span>&nbsp;<span class="ident" id="4112664">addr</span><span class="op" id="4112668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112671">if</span>&nbsp;<span class="ident" id="4112674">err</span>&nbsp;<span class="op" id="4112678">!=</span>&nbsp;<span class="ident" id="4112681">nil</span>&nbsp;<span class="op" id="4112685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112689">return</span>&nbsp;<span class="ident" id="4112696">nil</span><span class="op" id="4112699">,</span>&nbsp;<span class="ident" id="4112701">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4112706">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112709">host</span><span class="op" id="4112713">,</span>&nbsp;<span class="ident" id="4112715">_</span><span class="op" id="4112716">,</span>&nbsp;<span class="ident" id="4112718">_</span>&nbsp;<span class="op" id="4112720">:=</span>&nbsp;<span class="ident" id="4112723">net</span><span class="op" id="4112726">.</span><span class="ident" id="4112727">SplitHostPort</span><span class="op" id="4112740">(</span><span class="ident" id="4112741">addr</span><span class="op" id="4112745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112748">return</span>&nbsp;<span class="ident" id="4112755">NewClient</span><span class="op" id="4112764">(</span><span class="ident" id="4112765">conn</span><span class="op" id="4112769">,</span>&nbsp;<span class="ident" id="4112771">host</span><span class="op" id="4112775">)</span><br>
<span class="lineno"></span><span class="op" id="4112777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4112780">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;using&nbsp;an&nbsp;existing&nbsp;connection&nbsp;and&nbsp;host&nbsp;as&nbsp;a</span><br>
<span class="lineno">55</span><span class="comment" id="4112857">//&nbsp;server&nbsp;name&nbsp;to&nbsp;be&nbsp;used&nbsp;when&nbsp;authenticating.</span><br>
<span class="lineno"></span><span class="keyword" id="4112904">func</span>&nbsp;<span class="ident" id="4112909">NewClient</span><span class="op" id="4112918">(</span><span class="ident" id="4112919">conn</span>&nbsp;<span class="ident" id="4112924">net</span><span class="op" id="4112927">.</span><span class="ident" id="4112928">Conn</span><span class="op" id="4112932">,</span>&nbsp;<span class="ident" id="4112934">host</span>&nbsp;<span class="builtintype" id="4112939">string</span><span class="op" id="4112945">)</span>&nbsp;<span class="op" id="4112947">(</span><span class="op" id="4112948">*</span><span class="ident" id="4112949">Client</span><span class="op" id="4112955">,</span>&nbsp;<span class="builtintype" id="4112957">error</span><span class="op" id="4112962">)</span>&nbsp;<span class="op" id="4112964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112967">text</span>&nbsp;<span class="op" id="4112972">:=</span>&nbsp;<span class="ident" id="4112975">textproto</span><span class="op" id="4112984">.</span><span class="ident" id="4112985">NewConn</span><span class="op" id="4112992">(</span><span class="ident" id="4112993">conn</span><span class="op" id="4112997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113000">_</span><span class="op" id="4113001">,</span>&nbsp;<span class="ident" id="4113003">_</span><span class="op" id="4113004">,</span>&nbsp;<span class="ident" id="4113006">err</span>&nbsp;<span class="op" id="4113010">:=</span>&nbsp;<span class="ident" id="4113013">text</span><span class="op" id="4113017">.</span><span class="ident" id="4113018">ReadResponse</span><span class="op" id="4113030">(</span><span class="num" id="4113031">220</span><span class="op" id="4113034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113037">if</span>&nbsp;<span class="ident" id="4113040">err</span>&nbsp;<span class="op" id="4113044">!=</span>&nbsp;<span class="ident" id="4113047">nil</span>&nbsp;<span class="op" id="4113051">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113055">text</span><span class="op" id="4113059">.</span><span class="ident" id="4113060">Close</span><span class="op" id="4113065">(</span><span class="op" id="4113066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113070">return</span>&nbsp;<span class="ident" id="4113077">nil</span><span class="op" id="4113080">,</span>&nbsp;<span class="ident" id="4113082">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113090">c</span>&nbsp;<span class="op" id="4113092">:=</span>&nbsp;<span class="op" id="4113095">&amp;</span><span class="ident" id="4113096">Client</span><span class="op" id="4113102">{</span><span class="ident" id="4113103">Text</span><span class="op" id="4113107">:</span>&nbsp;<span class="ident" id="4113109">text</span><span class="op" id="4113113">,</span>&nbsp;<span class="ident" id="4113115">conn</span><span class="op" id="4113119">:</span>&nbsp;<span class="ident" id="4113121">conn</span><span class="op" id="4113125">,</span>&nbsp;<span class="ident" id="4113127">serverName</span><span class="op" id="4113137">:</span>&nbsp;<span class="ident" id="4113139">host</span><span class="op" id="4113143">,</span>&nbsp;<span class="ident" id="4113145">localName</span><span class="op" id="4113154">:</span>&nbsp;<span class="string" id="4113156">&#34;localhost&#34;</span><span class="op" id="4113167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113170">return</span>&nbsp;<span class="ident" id="4113177">c</span><span class="op" id="4113178">,</span>&nbsp;<span class="ident" id="4113180">nil</span><br>
<span class="lineno">65</span><span class="op" id="4113184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4113187">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4113219">func</span>&nbsp;<span class="op" id="4113224">(</span><span class="ident" id="4113225">c</span>&nbsp;<span class="op" id="4113227">*</span><span class="ident" id="4113228">Client</span><span class="op" id="4113234">)</span>&nbsp;<span class="ident" id="4113236">Close</span><span class="op" id="4113241">(</span><span class="op" id="4113242">)</span>&nbsp;<span class="builtintype" id="4113244">error</span>&nbsp;<span class="op" id="4113250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113253">return</span>&nbsp;<span class="ident" id="4113260">c</span><span class="op" id="4113261">.</span><span class="ident" id="4113262">Text</span><span class="op" id="4113266">.</span><span class="ident" id="4113267">Close</span><span class="op" id="4113272">(</span><span class="op" id="4113273">)</span><br>
<span class="lineno">70</span><span class="op" id="4113275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4113278">//&nbsp;hello&nbsp;runs&nbsp;a&nbsp;hello&nbsp;exchange&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="4113320">func</span>&nbsp;<span class="op" id="4113325">(</span><span class="ident" id="4113326">c</span>&nbsp;<span class="op" id="4113328">*</span><span class="ident" id="4113329">Client</span><span class="op" id="4113335">)</span>&nbsp;<span class="ident" id="4113337">hello</span><span class="op" id="4113342">(</span><span class="op" id="4113343">)</span>&nbsp;<span class="builtintype" id="4113345">error</span>&nbsp;<span class="op" id="4113351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113354">if</span>&nbsp;<span class="op" id="4113357">!</span><span class="ident" id="4113358">c</span><span class="op" id="4113359">.</span><span class="ident" id="4113360">didHello</span>&nbsp;<span class="op" id="4113369">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113373">c</span><span class="op" id="4113374">.</span><span class="ident" id="4113375">didHello</span>&nbsp;<span class="op" id="4113384">=</span>&nbsp;<span class="builtintype" id="4113386">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113393">err</span>&nbsp;<span class="op" id="4113397">:=</span>&nbsp;<span class="ident" id="4113400">c</span><span class="op" id="4113401">.</span><span class="ident" id="4113402">ehlo</span><span class="op" id="4113406">(</span><span class="op" id="4113407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113411">if</span>&nbsp;<span class="ident" id="4113414">err</span>&nbsp;<span class="op" id="4113418">!=</span>&nbsp;<span class="ident" id="4113421">nil</span>&nbsp;<span class="op" id="4113425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113430">c</span><span class="op" id="4113431">.</span><span class="ident" id="4113432">helloError</span>&nbsp;<span class="op" id="4113443">=</span>&nbsp;<span class="ident" id="4113445">c</span><span class="op" id="4113446">.</span><span class="ident" id="4113447">helo</span><span class="op" id="4113451">(</span><span class="op" id="4113452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113456">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113462">return</span>&nbsp;<span class="ident" id="4113469">c</span><span class="op" id="4113470">.</span><span class="ident" id="4113471">helloError</span><br>
<span class="lineno"></span><span class="op" id="4113482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4113485">//&nbsp;Hello&nbsp;sends&nbsp;a&nbsp;HELO&nbsp;or&nbsp;EHLO&nbsp;to&nbsp;the&nbsp;server&nbsp;as&nbsp;the&nbsp;given&nbsp;host&nbsp;name.</span><br>
<span class="lineno">85</span><span class="comment" id="4113553">//&nbsp;Calling&nbsp;this&nbsp;method&nbsp;is&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;client&nbsp;needs&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="4113622">//&nbsp;over&nbsp;the&nbsp;host&nbsp;name&nbsp;used.&nbsp;&nbsp;The&nbsp;client&nbsp;will&nbsp;introduce&nbsp;itself&nbsp;as&nbsp;&#34;localhost&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4113699">//&nbsp;automatically&nbsp;otherwise.&nbsp;&nbsp;If&nbsp;Hello&nbsp;is&nbsp;called,&nbsp;it&nbsp;must&nbsp;be&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4113773">//&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="4113802">func</span>&nbsp;<span class="op" id="4113807">(</span><span class="ident" id="4113808">c</span>&nbsp;<span class="op" id="4113810">*</span><span class="ident" id="4113811">Client</span><span class="op" id="4113817">)</span>&nbsp;<span class="ident" id="4113819">Hello</span><span class="op" id="4113824">(</span><span class="ident" id="4113825">localName</span>&nbsp;<span class="builtintype" id="4113835">string</span><span class="op" id="4113841">)</span>&nbsp;<span class="builtintype" id="4113843">error</span>&nbsp;<span class="op" id="4113849">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113852">if</span>&nbsp;<span class="ident" id="4113855">c</span><span class="op" id="4113856">.</span><span class="ident" id="4113857">didHello</span>&nbsp;<span class="op" id="4113866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113870">return</span>&nbsp;<span class="ident" id="4113877">errors</span><span class="op" id="4113883">.</span><span class="ident" id="4113884">New</span><span class="op" id="4113887">(</span><span class="string" id="4113888">&#34;smtp:&nbsp;Hello&nbsp;called&nbsp;after&nbsp;other&nbsp;methods&#34;</span><span class="op" id="4113928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113934">c</span><span class="op" id="4113935">.</span><span class="ident" id="4113936">localName</span>&nbsp;<span class="op" id="4113946">=</span>&nbsp;<span class="ident" id="4113948">localName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113959">return</span>&nbsp;<span class="ident" id="4113966">c</span><span class="op" id="4113967">.</span><span class="ident" id="4113968">hello</span><span class="op" id="4113973">(</span><span class="op" id="4113974">)</span><br>
<span class="lineno">95</span><span class="op" id="4113976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4113979">//&nbsp;cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;and&nbsp;returns&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="keyword" id="4114058">func</span>&nbsp;<span class="op" id="4114063">(</span><span class="ident" id="4114064">c</span>&nbsp;<span class="op" id="4114066">*</span><span class="ident" id="4114067">Client</span><span class="op" id="4114073">)</span>&nbsp;<span class="ident" id="4114075">cmd</span><span class="op" id="4114078">(</span><span class="ident" id="4114079">expectCode</span>&nbsp;<span class="builtintype" id="4114090">int</span><span class="op" id="4114093">,</span>&nbsp;<span class="ident" id="4114095">format</span>&nbsp;<span class="builtintype" id="4114102">string</span><span class="op" id="4114108">,</span>&nbsp;<span class="ident" id="4114110">args</span>&nbsp;<span class="op" id="4114115">...</span><span class="keyword" id="4114118">interface</span><span class="op" id="4114127">{</span><span class="op" id="4114128">}</span><span class="op" id="4114129">)</span>&nbsp;<span class="op" id="4114131">(</span><span class="builtintype" id="4114132">int</span><span class="op" id="4114135">,</span>&nbsp;<span class="builtintype" id="4114137">string</span><span class="op" id="4114143">,</span>&nbsp;<span class="builtintype" id="4114145">error</span><span class="op" id="4114150">)</span>&nbsp;<span class="op" id="4114152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114155">id</span><span class="op" id="4114157">,</span>&nbsp;<span class="ident" id="4114159">err</span>&nbsp;<span class="op" id="4114163">:=</span>&nbsp;<span class="ident" id="4114166">c</span><span class="op" id="4114167">.</span><span class="ident" id="4114168">Text</span><span class="op" id="4114172">.</span><span class="ident" id="4114173">Cmd</span><span class="op" id="4114176">(</span><span class="ident" id="4114177">format</span><span class="op" id="4114183">,</span>&nbsp;<span class="ident" id="4114185">args</span><span class="op" id="4114189">...</span><span class="op" id="4114192">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114195">if</span>&nbsp;<span class="ident" id="4114198">err</span>&nbsp;<span class="op" id="4114202">!=</span>&nbsp;<span class="ident" id="4114205">nil</span>&nbsp;<span class="op" id="4114209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114213">return</span>&nbsp;<span class="num" id="4114220">0</span><span class="op" id="4114221">,</span>&nbsp;<span class="string" id="4114223">&#34;&#34;</span><span class="op" id="4114225">,</span>&nbsp;<span class="ident" id="4114227">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114235">c</span><span class="op" id="4114236">.</span><span class="ident" id="4114237">Text</span><span class="op" id="4114241">.</span><span class="ident" id="4114242">StartResponse</span><span class="op" id="4114255">(</span><span class="ident" id="4114256">id</span><span class="op" id="4114258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114261">defer</span>&nbsp;<span class="ident" id="4114267">c</span><span class="op" id="4114268">.</span><span class="ident" id="4114269">Text</span><span class="op" id="4114273">.</span><span class="ident" id="4114274">EndResponse</span><span class="op" id="4114285">(</span><span class="ident" id="4114286">id</span><span class="op" id="4114288">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114291">code</span><span class="op" id="4114295">,</span>&nbsp;<span class="ident" id="4114297">msg</span><span class="op" id="4114300">,</span>&nbsp;<span class="ident" id="4114302">err</span>&nbsp;<span class="op" id="4114306">:=</span>&nbsp;<span class="ident" id="4114309">c</span><span class="op" id="4114310">.</span><span class="ident" id="4114311">Text</span><span class="op" id="4114315">.</span><span class="ident" id="4114316">ReadResponse</span><span class="op" id="4114328">(</span><span class="ident" id="4114329">expectCode</span><span class="op" id="4114339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114342">return</span>&nbsp;<span class="ident" id="4114349">code</span><span class="op" id="4114353">,</span>&nbsp;<span class="ident" id="4114355">msg</span><span class="op" id="4114358">,</span>&nbsp;<span class="ident" id="4114360">err</span><br>
<span class="lineno"></span><span class="op" id="4114364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4114367">//&nbsp;helo&nbsp;sends&nbsp;the&nbsp;HELO&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;when&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="4114446">//&nbsp;server&nbsp;does&nbsp;not&nbsp;support&nbsp;ehlo.</span><br>
<span class="lineno"></span><span class="keyword" id="4114479">func</span>&nbsp;<span class="op" id="4114484">(</span><span class="ident" id="4114485">c</span>&nbsp;<span class="op" id="4114487">*</span><span class="ident" id="4114488">Client</span><span class="op" id="4114494">)</span>&nbsp;<span class="ident" id="4114496">helo</span><span class="op" id="4114500">(</span><span class="op" id="4114501">)</span>&nbsp;<span class="builtintype" id="4114503">error</span>&nbsp;<span class="op" id="4114509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114512">c</span><span class="op" id="4114513">.</span><span class="ident" id="4114514">ext</span>&nbsp;<span class="op" id="4114518">=</span>&nbsp;<span class="ident" id="4114520">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114525">_</span><span class="op" id="4114526">,</span>&nbsp;<span class="ident" id="4114528">_</span><span class="op" id="4114529">,</span>&nbsp;<span class="ident" id="4114531">err</span>&nbsp;<span class="op" id="4114535">:=</span>&nbsp;<span class="ident" id="4114538">c</span><span class="op" id="4114539">.</span><span class="ident" id="4114540">cmd</span><span class="op" id="4114543">(</span><span class="num" id="4114544">250</span><span class="op" id="4114547">,</span>&nbsp;<span class="string" id="4114549">&#34;HELO&nbsp;%s&#34;</span><span class="op" id="4114558">,</span>&nbsp;<span class="ident" id="4114560">c</span><span class="op" id="4114561">.</span><span class="ident" id="4114562">localName</span><span class="op" id="4114571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114574">return</span>&nbsp;<span class="ident" id="4114581">err</span><br>
<span class="lineno">115</span><span class="op" id="4114585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4114588">//&nbsp;ehlo&nbsp;sends&nbsp;the&nbsp;EHLO&nbsp;(extended&nbsp;hello)&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4114655">//&nbsp;should&nbsp;be&nbsp;the&nbsp;preferred&nbsp;greeting&nbsp;for&nbsp;servers&nbsp;that&nbsp;support&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4114720">func</span>&nbsp;<span class="op" id="4114725">(</span><span class="ident" id="4114726">c</span>&nbsp;<span class="op" id="4114728">*</span><span class="ident" id="4114729">Client</span><span class="op" id="4114735">)</span>&nbsp;<span class="ident" id="4114737">ehlo</span><span class="op" id="4114741">(</span><span class="op" id="4114742">)</span>&nbsp;<span class="builtintype" id="4114744">error</span>&nbsp;<span class="op" id="4114750">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114753">_</span><span class="op" id="4114754">,</span>&nbsp;<span class="ident" id="4114756">msg</span><span class="op" id="4114759">,</span>&nbsp;<span class="ident" id="4114761">err</span>&nbsp;<span class="op" id="4114765">:=</span>&nbsp;<span class="ident" id="4114768">c</span><span class="op" id="4114769">.</span><span class="ident" id="4114770">cmd</span><span class="op" id="4114773">(</span><span class="num" id="4114774">250</span><span class="op" id="4114777">,</span>&nbsp;<span class="string" id="4114779">&#34;EHLO&nbsp;%s&#34;</span><span class="op" id="4114788">,</span>&nbsp;<span class="ident" id="4114790">c</span><span class="op" id="4114791">.</span><span class="ident" id="4114792">localName</span><span class="op" id="4114801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114804">if</span>&nbsp;<span class="ident" id="4114807">err</span>&nbsp;<span class="op" id="4114811">!=</span>&nbsp;<span class="ident" id="4114814">nil</span>&nbsp;<span class="op" id="4114818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114822">return</span>&nbsp;<span class="ident" id="4114829">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114837">ext</span>&nbsp;<span class="op" id="4114841">:=</span>&nbsp;<span class="builtinfunc" id="4114844">make</span><span class="op" id="4114848">(</span><span class="keyword" id="4114849">map</span><span class="op" id="4114852">[</span><span class="builtintype" id="4114853">string</span><span class="op" id="4114859">]</span><span class="builtintype" id="4114860">string</span><span class="op" id="4114866">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114869">extList</span>&nbsp;<span class="op" id="4114877">:=</span>&nbsp;<span class="ident" id="4114880">strings</span><span class="op" id="4114887">.</span><span class="ident" id="4114888">Split</span><span class="op" id="4114893">(</span><span class="ident" id="4114894">msg</span><span class="op" id="4114897">,</span>&nbsp;<span class="string" id="4114899">&#34;\n&#34;</span><span class="op" id="4114903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114906">if</span>&nbsp;<span class="builtinfunc" id="4114909">len</span><span class="op" id="4114912">(</span><span class="ident" id="4114913">extList</span><span class="op" id="4114920">)</span>&nbsp;<span class="op" id="4114922">&gt;</span>&nbsp;<span class="num" id="4114924">1</span>&nbsp;<span class="op" id="4114926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114930">extList</span>&nbsp;<span class="op" id="4114938">=</span>&nbsp;<span class="ident" id="4114940">extList</span><span class="op" id="4114947">[</span><span class="num" id="4114948">1</span><span class="op" id="4114949">:</span><span class="op" id="4114950">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114954">for</span>&nbsp;<span class="ident" id="4114958">_</span><span class="op" id="4114959">,</span>&nbsp;<span class="ident" id="4114961">line</span>&nbsp;<span class="op" id="4114966">:=</span>&nbsp;<span class="keyword" id="4114969">range</span>&nbsp;<span class="ident" id="4114975">extList</span>&nbsp;<span class="op" id="4114983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114988">args</span>&nbsp;<span class="op" id="4114993">:=</span>&nbsp;<span class="ident" id="4114996">strings</span><span class="op" id="4115003">.</span><span class="ident" id="4115004">SplitN</span><span class="op" id="4115010">(</span><span class="ident" id="4115011">line</span><span class="op" id="4115015">,</span>&nbsp;<span class="string" id="4115017">&#34;&nbsp;&#34;</span><span class="op" id="4115020">,</span>&nbsp;<span class="num" id="4115022">2</span><span class="op" id="4115023">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115028">if</span>&nbsp;<span class="builtinfunc" id="4115031">len</span><span class="op" id="4115034">(</span><span class="ident" id="4115035">args</span><span class="op" id="4115039">)</span>&nbsp;<span class="op" id="4115041">&gt;</span>&nbsp;<span class="num" id="4115043">1</span>&nbsp;<span class="op" id="4115045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115051">ext</span><span class="op" id="4115054">[</span><span class="ident" id="4115055">args</span><span class="op" id="4115059">[</span><span class="num" id="4115060">0</span><span class="op" id="4115061">]</span><span class="op" id="4115062">]</span>&nbsp;<span class="op" id="4115064">=</span>&nbsp;<span class="ident" id="4115066">args</span><span class="op" id="4115070">[</span><span class="num" id="4115071">1</span><span class="op" id="4115072">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115077">}</span>&nbsp;<span class="keyword" id="4115079">else</span>&nbsp;<span class="op" id="4115084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115090">ext</span><span class="op" id="4115093">[</span><span class="ident" id="4115094">args</span><span class="op" id="4115098">[</span><span class="num" id="4115099">0</span><span class="op" id="4115100">]</span><span class="op" id="4115101">]</span>&nbsp;<span class="op" id="4115103">=</span>&nbsp;<span class="string" id="4115105">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115111">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115121">if</span>&nbsp;<span class="ident" id="4115124">mechs</span><span class="op" id="4115129">,</span>&nbsp;<span class="ident" id="4115131">ok</span>&nbsp;<span class="op" id="4115134">:=</span>&nbsp;<span class="ident" id="4115137">ext</span><span class="op" id="4115140">[</span><span class="string" id="4115141">&#34;AUTH&#34;</span><span class="op" id="4115147">]</span><span class="op" id="4115148">;</span>&nbsp;<span class="ident" id="4115150">ok</span>&nbsp;<span class="op" id="4115153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115157">c</span><span class="op" id="4115158">.</span><span class="ident" id="4115159">auth</span>&nbsp;<span class="op" id="4115164">=</span>&nbsp;<span class="ident" id="4115166">strings</span><span class="op" id="4115173">.</span><span class="ident" id="4115174">Split</span><span class="op" id="4115179">(</span><span class="ident" id="4115180">mechs</span><span class="op" id="4115185">,</span>&nbsp;<span class="string" id="4115187">&#34;&nbsp;&#34;</span><span class="op" id="4115190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115193">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115196">c</span><span class="op" id="4115197">.</span><span class="ident" id="4115198">ext</span>&nbsp;<span class="op" id="4115202">=</span>&nbsp;<span class="ident" id="4115204">ext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115209">return</span>&nbsp;<span class="ident" id="4115216">err</span><br>
<span class="lineno"></span><span class="op" id="4115220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4115223">//&nbsp;StartTLS&nbsp;sends&nbsp;the&nbsp;STARTTLS&nbsp;command&nbsp;and&nbsp;encrypts&nbsp;all&nbsp;further&nbsp;communication.</span><br>
<span class="lineno">145</span><span class="comment" id="4115302">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;STARTTLS&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="4115379">func</span>&nbsp;<span class="op" id="4115384">(</span><span class="ident" id="4115385">c</span>&nbsp;<span class="op" id="4115387">*</span><span class="ident" id="4115388">Client</span><span class="op" id="4115394">)</span>&nbsp;<span class="ident" id="4115396">StartTLS</span><span class="op" id="4115404">(</span><span class="ident" id="4115405">config</span>&nbsp;<span class="op" id="4115412">*</span><span class="ident" id="4115413">tls</span><span class="op" id="4115416">.</span><span class="ident" id="4115417">Config</span><span class="op" id="4115423">)</span>&nbsp;<span class="builtintype" id="4115425">error</span>&nbsp;<span class="op" id="4115431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115434">if</span>&nbsp;<span class="ident" id="4115437">err</span>&nbsp;<span class="op" id="4115441">:=</span>&nbsp;<span class="ident" id="4115444">c</span><span class="op" id="4115445">.</span><span class="ident" id="4115446">hello</span><span class="op" id="4115451">(</span><span class="op" id="4115452">)</span><span class="op" id="4115453">;</span>&nbsp;<span class="ident" id="4115455">err</span>&nbsp;<span class="op" id="4115459">!=</span>&nbsp;<span class="ident" id="4115462">nil</span>&nbsp;<span class="op" id="4115466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115470">return</span>&nbsp;<span class="ident" id="4115477">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115482">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115485">_</span><span class="op" id="4115486">,</span>&nbsp;<span class="ident" id="4115488">_</span><span class="op" id="4115489">,</span>&nbsp;<span class="ident" id="4115491">err</span>&nbsp;<span class="op" id="4115495">:=</span>&nbsp;<span class="ident" id="4115498">c</span><span class="op" id="4115499">.</span><span class="ident" id="4115500">cmd</span><span class="op" id="4115503">(</span><span class="num" id="4115504">220</span><span class="op" id="4115507">,</span>&nbsp;<span class="string" id="4115509">&#34;STARTTLS&#34;</span><span class="op" id="4115519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115522">if</span>&nbsp;<span class="ident" id="4115525">err</span>&nbsp;<span class="op" id="4115529">!=</span>&nbsp;<span class="ident" id="4115532">nil</span>&nbsp;<span class="op" id="4115536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115540">return</span>&nbsp;<span class="ident" id="4115547">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115555">c</span><span class="op" id="4115556">.</span><span class="ident" id="4115557">conn</span>&nbsp;<span class="op" id="4115562">=</span>&nbsp;<span class="ident" id="4115564">tls</span><span class="op" id="4115567">.</span><span class="ident" id="4115568">Client</span><span class="op" id="4115574">(</span><span class="ident" id="4115575">c</span><span class="op" id="4115576">.</span><span class="ident" id="4115577">conn</span><span class="op" id="4115581">,</span>&nbsp;<span class="ident" id="4115583">config</span><span class="op" id="4115589">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115592">c</span><span class="op" id="4115593">.</span><span class="ident" id="4115594">Text</span>&nbsp;<span class="op" id="4115599">=</span>&nbsp;<span class="ident" id="4115601">textproto</span><span class="op" id="4115610">.</span><span class="ident" id="4115611">NewConn</span><span class="op" id="4115618">(</span><span class="ident" id="4115619">c</span><span class="op" id="4115620">.</span><span class="ident" id="4115621">conn</span><span class="op" id="4115625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115628">c</span><span class="op" id="4115629">.</span><span class="ident" id="4115630">tls</span>&nbsp;<span class="op" id="4115634">=</span>&nbsp;<span class="builtintype" id="4115636">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115642">return</span>&nbsp;<span class="ident" id="4115649">c</span><span class="op" id="4115650">.</span><span class="ident" id="4115651">ehlo</span><span class="op" id="4115655">(</span><span class="op" id="4115656">)</span><br>
<span class="lineno"></span><span class="op" id="4115658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4115661">//&nbsp;Verify&nbsp;checks&nbsp;the&nbsp;validity&nbsp;of&nbsp;an&nbsp;email&nbsp;address&nbsp;on&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="4115726">//&nbsp;If&nbsp;Verify&nbsp;returns&nbsp;nil,&nbsp;the&nbsp;address&nbsp;is&nbsp;valid.&nbsp;A&nbsp;non-nil&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4115791">//&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;indicate&nbsp;an&nbsp;invalid&nbsp;address.&nbsp;Many&nbsp;servers</span><br>
<span class="lineno"></span><span class="comment" id="4115857">//&nbsp;will&nbsp;not&nbsp;verify&nbsp;addresses&nbsp;for&nbsp;security&nbsp;reasons.</span><br>
<span class="lineno"></span><span class="keyword" id="4115908">func</span>&nbsp;<span class="op" id="4115913">(</span><span class="ident" id="4115914">c</span>&nbsp;<span class="op" id="4115916">*</span><span class="ident" id="4115917">Client</span><span class="op" id="4115923">)</span>&nbsp;<span class="ident" id="4115925">Verify</span><span class="op" id="4115931">(</span><span class="ident" id="4115932">addr</span>&nbsp;<span class="builtintype" id="4115937">string</span><span class="op" id="4115943">)</span>&nbsp;<span class="builtintype" id="4115945">error</span>&nbsp;<span class="op" id="4115951">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115954">if</span>&nbsp;<span class="ident" id="4115957">err</span>&nbsp;<span class="op" id="4115961">:=</span>&nbsp;<span class="ident" id="4115964">c</span><span class="op" id="4115965">.</span><span class="ident" id="4115966">hello</span><span class="op" id="4115971">(</span><span class="op" id="4115972">)</span><span class="op" id="4115973">;</span>&nbsp;<span class="ident" id="4115975">err</span>&nbsp;<span class="op" id="4115979">!=</span>&nbsp;<span class="ident" id="4115982">nil</span>&nbsp;<span class="op" id="4115986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115990">return</span>&nbsp;<span class="ident" id="4115997">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116005">_</span><span class="op" id="4116006">,</span>&nbsp;<span class="ident" id="4116008">_</span><span class="op" id="4116009">,</span>&nbsp;<span class="ident" id="4116011">err</span>&nbsp;<span class="op" id="4116015">:=</span>&nbsp;<span class="ident" id="4116018">c</span><span class="op" id="4116019">.</span><span class="ident" id="4116020">cmd</span><span class="op" id="4116023">(</span><span class="num" id="4116024">250</span><span class="op" id="4116027">,</span>&nbsp;<span class="string" id="4116029">&#34;VRFY&nbsp;%s&#34;</span><span class="op" id="4116038">,</span>&nbsp;<span class="ident" id="4116040">addr</span><span class="op" id="4116044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116047">return</span>&nbsp;<span class="ident" id="4116054">err</span><br>
<span class="lineno">170</span><span class="op" id="4116058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4116061">//&nbsp;Auth&nbsp;authenticates&nbsp;a&nbsp;client&nbsp;using&nbsp;the&nbsp;provided&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="comment" id="4116137">//&nbsp;A&nbsp;failed&nbsp;authentication&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4116187">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;AUTH&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno">175</span><span class="keyword" id="4116260">func</span>&nbsp;<span class="op" id="4116265">(</span><span class="ident" id="4116266">c</span>&nbsp;<span class="op" id="4116268">*</span><span class="ident" id="4116269">Client</span><span class="op" id="4116275">)</span>&nbsp;<span class="ident" id="4116277">Auth</span><span class="op" id="4116281">(</span><span class="ident" id="4116282">a</span>&nbsp;<span class="ident" id="4116284">Auth</span><span class="op" id="4116288">)</span>&nbsp;<span class="builtintype" id="4116290">error</span>&nbsp;<span class="op" id="4116296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116299">if</span>&nbsp;<span class="ident" id="4116302">err</span>&nbsp;<span class="op" id="4116306">:=</span>&nbsp;<span class="ident" id="4116309">c</span><span class="op" id="4116310">.</span><span class="ident" id="4116311">hello</span><span class="op" id="4116316">(</span><span class="op" id="4116317">)</span><span class="op" id="4116318">;</span>&nbsp;<span class="ident" id="4116320">err</span>&nbsp;<span class="op" id="4116324">!=</span>&nbsp;<span class="ident" id="4116327">nil</span>&nbsp;<span class="op" id="4116331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116335">return</span>&nbsp;<span class="ident" id="4116342">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116350">encoding</span>&nbsp;<span class="op" id="4116359">:=</span>&nbsp;<span class="ident" id="4116362">base64</span><span class="op" id="4116368">.</span><span class="ident" id="4116369">StdEncoding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116382">mech</span><span class="op" id="4116386">,</span>&nbsp;<span class="ident" id="4116388">resp</span><span class="op" id="4116392">,</span>&nbsp;<span class="ident" id="4116394">err</span>&nbsp;<span class="op" id="4116398">:=</span>&nbsp;<span class="ident" id="4116401">a</span><span class="op" id="4116402">.</span><span class="ident" id="4116403">Start</span><span class="op" id="4116408">(</span><span class="op" id="4116409">&amp;</span><span class="ident" id="4116410">ServerInfo</span><span class="op" id="4116420">{</span><span class="ident" id="4116421">c</span><span class="op" id="4116422">.</span><span class="ident" id="4116423">serverName</span><span class="op" id="4116433">,</span>&nbsp;<span class="ident" id="4116435">c</span><span class="op" id="4116436">.</span><span class="ident" id="4116437">tls</span><span class="op" id="4116440">,</span>&nbsp;<span class="ident" id="4116442">c</span><span class="op" id="4116443">.</span><span class="ident" id="4116444">auth</span><span class="op" id="4116448">}</span><span class="op" id="4116449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116452">if</span>&nbsp;<span class="ident" id="4116455">err</span>&nbsp;<span class="op" id="4116459">!=</span>&nbsp;<span class="ident" id="4116462">nil</span>&nbsp;<span class="op" id="4116466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116470">c</span><span class="op" id="4116471">.</span><span class="ident" id="4116472">Quit</span><span class="op" id="4116476">(</span><span class="op" id="4116477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116481">return</span>&nbsp;<span class="ident" id="4116488">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116493">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116496">resp64</span>&nbsp;<span class="op" id="4116503">:=</span>&nbsp;<span class="builtinfunc" id="4116506">make</span><span class="op" id="4116510">(</span><span class="op" id="4116511">[</span><span class="op" id="4116512">]</span><span class="builtintype" id="4116513">byte</span><span class="op" id="4116517">,</span>&nbsp;<span class="ident" id="4116519">encoding</span><span class="op" id="4116527">.</span><span class="ident" id="4116528">EncodedLen</span><span class="op" id="4116538">(</span><span class="builtinfunc" id="4116539">len</span><span class="op" id="4116542">(</span><span class="ident" id="4116543">resp</span><span class="op" id="4116547">)</span><span class="op" id="4116548">)</span><span class="op" id="4116549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116552">encoding</span><span class="op" id="4116560">.</span><span class="ident" id="4116561">Encode</span><span class="op" id="4116567">(</span><span class="ident" id="4116568">resp64</span><span class="op" id="4116574">,</span>&nbsp;<span class="ident" id="4116576">resp</span><span class="op" id="4116580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116583">code</span><span class="op" id="4116587">,</span>&nbsp;<span class="ident" id="4116589">msg64</span><span class="op" id="4116594">,</span>&nbsp;<span class="ident" id="4116596">err</span>&nbsp;<span class="op" id="4116600">:=</span>&nbsp;<span class="ident" id="4116603">c</span><span class="op" id="4116604">.</span><span class="ident" id="4116605">cmd</span><span class="op" id="4116608">(</span><span class="num" id="4116609">0</span><span class="op" id="4116610">,</span>&nbsp;<span class="string" id="4116612">&#34;AUTH&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="4116624">,</span>&nbsp;<span class="ident" id="4116626">mech</span><span class="op" id="4116630">,</span>&nbsp;<span class="ident" id="4116632">resp64</span><span class="op" id="4116638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116641">for</span>&nbsp;<span class="ident" id="4116645">err</span>&nbsp;<span class="op" id="4116649">==</span>&nbsp;<span class="ident" id="4116652">nil</span>&nbsp;<span class="op" id="4116656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116660">var</span>&nbsp;<span class="ident" id="4116664">msg</span>&nbsp;<span class="op" id="4116668">[</span><span class="op" id="4116669">]</span><span class="builtintype" id="4116670">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116677">switch</span>&nbsp;<span class="ident" id="4116684">code</span>&nbsp;<span class="op" id="4116689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116693">case</span>&nbsp;<span class="num" id="4116698">334</span><span class="op" id="4116701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116706">msg</span><span class="op" id="4116709">,</span>&nbsp;<span class="ident" id="4116711">err</span>&nbsp;<span class="op" id="4116715">=</span>&nbsp;<span class="ident" id="4116717">encoding</span><span class="op" id="4116725">.</span><span class="ident" id="4116726">DecodeString</span><span class="op" id="4116738">(</span><span class="ident" id="4116739">msg64</span><span class="op" id="4116744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116748">case</span>&nbsp;<span class="num" id="4116753">235</span><span class="op" id="4116756">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4116761">//&nbsp;the&nbsp;last&nbsp;message&nbsp;isn&#39;t&nbsp;base64&nbsp;because&nbsp;it&nbsp;isn&#39;t&nbsp;a&nbsp;challenge</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116826">msg</span>&nbsp;<span class="op" id="4116830">=</span>&nbsp;<span class="op" id="4116832">[</span><span class="op" id="4116833">]</span><span class="builtintype" id="4116834">byte</span><span class="op" id="4116838">(</span><span class="ident" id="4116839">msg64</span><span class="op" id="4116844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116848">default</span><span class="op" id="4116855">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116860">err</span>&nbsp;<span class="op" id="4116864">=</span>&nbsp;<span class="op" id="4116866">&amp;</span><span class="ident" id="4116867">textproto</span><span class="op" id="4116876">.</span><span class="ident" id="4116877">Error</span><span class="op" id="4116882">{</span><span class="ident" id="4116883">Code</span><span class="op" id="4116887">:</span>&nbsp;<span class="ident" id="4116889">code</span><span class="op" id="4116893">,</span>&nbsp;<span class="ident" id="4116895">Msg</span><span class="op" id="4116898">:</span>&nbsp;<span class="ident" id="4116900">msg64</span><span class="op" id="4116905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116913">if</span>&nbsp;<span class="ident" id="4116916">err</span>&nbsp;<span class="op" id="4116920">==</span>&nbsp;<span class="ident" id="4116923">nil</span>&nbsp;<span class="op" id="4116927">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116932">resp</span><span class="op" id="4116936">,</span>&nbsp;<span class="ident" id="4116938">err</span>&nbsp;<span class="op" id="4116942">=</span>&nbsp;<span class="ident" id="4116944">a</span><span class="op" id="4116945">.</span><span class="ident" id="4116946">Next</span><span class="op" id="4116950">(</span><span class="ident" id="4116951">msg</span><span class="op" id="4116954">,</span>&nbsp;<span class="ident" id="4116956">code</span>&nbsp;<span class="op" id="4116961">==</span>&nbsp;<span class="num" id="4116964">334</span><span class="op" id="4116967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116975">if</span>&nbsp;<span class="ident" id="4116978">err</span>&nbsp;<span class="op" id="4116982">!=</span>&nbsp;<span class="ident" id="4116985">nil</span>&nbsp;<span class="op" id="4116989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4116994">//&nbsp;abort&nbsp;the&nbsp;AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117015">c</span><span class="op" id="4117016">.</span><span class="ident" id="4117017">cmd</span><span class="op" id="4117020">(</span><span class="num" id="4117021">501</span><span class="op" id="4117024">,</span>&nbsp;<span class="string" id="4117026">&#34;*&#34;</span><span class="op" id="4117029">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117034">c</span><span class="op" id="4117035">.</span><span class="ident" id="4117036">Quit</span><span class="op" id="4117040">(</span><span class="op" id="4117041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117046">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117058">if</span>&nbsp;<span class="ident" id="4117061">resp</span>&nbsp;<span class="op" id="4117066">==</span>&nbsp;<span class="ident" id="4117069">nil</span>&nbsp;<span class="op" id="4117073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117078">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117090">resp64</span>&nbsp;<span class="op" id="4117097">=</span>&nbsp;<span class="builtinfunc" id="4117099">make</span><span class="op" id="4117103">(</span><span class="op" id="4117104">[</span><span class="op" id="4117105">]</span><span class="builtintype" id="4117106">byte</span><span class="op" id="4117110">,</span>&nbsp;<span class="ident" id="4117112">encoding</span><span class="op" id="4117120">.</span><span class="ident" id="4117121">EncodedLen</span><span class="op" id="4117131">(</span><span class="builtinfunc" id="4117132">len</span><span class="op" id="4117135">(</span><span class="ident" id="4117136">resp</span><span class="op" id="4117140">)</span><span class="op" id="4117141">)</span><span class="op" id="4117142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117146">encoding</span><span class="op" id="4117154">.</span><span class="ident" id="4117155">Encode</span><span class="op" id="4117161">(</span><span class="ident" id="4117162">resp64</span><span class="op" id="4117168">,</span>&nbsp;<span class="ident" id="4117170">resp</span><span class="op" id="4117174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117178">code</span><span class="op" id="4117182">,</span>&nbsp;<span class="ident" id="4117184">msg64</span><span class="op" id="4117189">,</span>&nbsp;<span class="ident" id="4117191">err</span>&nbsp;<span class="op" id="4117195">=</span>&nbsp;<span class="ident" id="4117197">c</span><span class="op" id="4117198">.</span><span class="ident" id="4117199">cmd</span><span class="op" id="4117202">(</span><span class="num" id="4117203">0</span><span class="op" id="4117204">,</span>&nbsp;<span class="builtintype" id="4117206">string</span><span class="op" id="4117212">(</span><span class="ident" id="4117213">resp64</span><span class="op" id="4117219">)</span><span class="op" id="4117220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117223">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117226">return</span>&nbsp;<span class="ident" id="4117233">err</span><br>
<span class="lineno"></span><span class="op" id="4117237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4117240">//&nbsp;Mail&nbsp;issues&nbsp;a&nbsp;MAIL&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="4117318">//&nbsp;If&nbsp;the&nbsp;server&nbsp;supports&nbsp;the&nbsp;8BITMIME&nbsp;extension,&nbsp;Mail&nbsp;adds&nbsp;the&nbsp;BODY=8BITMIME</span><br>
<span class="lineno">220</span><span class="comment" id="4117396">//&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="4117410">//&nbsp;This&nbsp;initiates&nbsp;a&nbsp;mail&nbsp;transaction&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;Rcpt&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="4117490">func</span>&nbsp;<span class="op" id="4117495">(</span><span class="ident" id="4117496">c</span>&nbsp;<span class="op" id="4117498">*</span><span class="ident" id="4117499">Client</span><span class="op" id="4117505">)</span>&nbsp;<span class="ident" id="4117507">Mail</span><span class="op" id="4117511">(</span><span class="ident" id="4117512">from</span>&nbsp;<span class="builtintype" id="4117517">string</span><span class="op" id="4117523">)</span>&nbsp;<span class="builtintype" id="4117525">error</span>&nbsp;<span class="op" id="4117531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117534">if</span>&nbsp;<span class="ident" id="4117537">err</span>&nbsp;<span class="op" id="4117541">:=</span>&nbsp;<span class="ident" id="4117544">c</span><span class="op" id="4117545">.</span><span class="ident" id="4117546">hello</span><span class="op" id="4117551">(</span><span class="op" id="4117552">)</span><span class="op" id="4117553">;</span>&nbsp;<span class="ident" id="4117555">err</span>&nbsp;<span class="op" id="4117559">!=</span>&nbsp;<span class="ident" id="4117562">nil</span>&nbsp;<span class="op" id="4117566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117570">return</span>&nbsp;<span class="ident" id="4117577">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117585">cmdStr</span>&nbsp;<span class="op" id="4117592">:=</span>&nbsp;<span class="string" id="4117595">&#34;MAIL&nbsp;FROM:&lt;%s&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117613">if</span>&nbsp;<span class="ident" id="4117616">c</span><span class="op" id="4117617">.</span><span class="ident" id="4117618">ext</span>&nbsp;<span class="op" id="4117622">!=</span>&nbsp;<span class="ident" id="4117625">nil</span>&nbsp;<span class="op" id="4117629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117633">if</span>&nbsp;<span class="ident" id="4117636">_</span><span class="op" id="4117637">,</span>&nbsp;<span class="ident" id="4117639">ok</span>&nbsp;<span class="op" id="4117642">:=</span>&nbsp;<span class="ident" id="4117645">c</span><span class="op" id="4117646">.</span><span class="ident" id="4117647">ext</span><span class="op" id="4117650">[</span><span class="string" id="4117651">&#34;8BITMIME&#34;</span><span class="op" id="4117661">]</span><span class="op" id="4117662">;</span>&nbsp;<span class="ident" id="4117664">ok</span>&nbsp;<span class="op" id="4117667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117672">cmdStr</span>&nbsp;<span class="op" id="4117679">+=</span>&nbsp;<span class="string" id="4117682">&#34;&nbsp;BODY=8BITMIME&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117707">_</span><span class="op" id="4117708">,</span>&nbsp;<span class="ident" id="4117710">_</span><span class="op" id="4117711">,</span>&nbsp;<span class="ident" id="4117713">err</span>&nbsp;<span class="op" id="4117717">:=</span>&nbsp;<span class="ident" id="4117720">c</span><span class="op" id="4117721">.</span><span class="ident" id="4117722">cmd</span><span class="op" id="4117725">(</span><span class="num" id="4117726">250</span><span class="op" id="4117729">,</span>&nbsp;<span class="ident" id="4117731">cmdStr</span><span class="op" id="4117737">,</span>&nbsp;<span class="ident" id="4117739">from</span><span class="op" id="4117743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117746">return</span>&nbsp;<span class="ident" id="4117753">err</span><br>
<span class="lineno"></span><span class="op" id="4117757">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="4117760">//&nbsp;Rcpt&nbsp;issues&nbsp;a&nbsp;RCPT&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="4117838">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Rcpt&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Mail&nbsp;and&nbsp;may&nbsp;be&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4117914">//&nbsp;a&nbsp;Data&nbsp;call&nbsp;or&nbsp;another&nbsp;Rcpt&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="4117951">func</span>&nbsp;<span class="op" id="4117956">(</span><span class="ident" id="4117957">c</span>&nbsp;<span class="op" id="4117959">*</span><span class="ident" id="4117960">Client</span><span class="op" id="4117966">)</span>&nbsp;<span class="ident" id="4117968">Rcpt</span><span class="op" id="4117972">(</span><span class="ident" id="4117973">to</span>&nbsp;<span class="builtintype" id="4117976">string</span><span class="op" id="4117982">)</span>&nbsp;<span class="builtintype" id="4117984">error</span>&nbsp;<span class="op" id="4117990">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117993">_</span><span class="op" id="4117994">,</span>&nbsp;<span class="ident" id="4117996">_</span><span class="op" id="4117997">,</span>&nbsp;<span class="ident" id="4117999">err</span>&nbsp;<span class="op" id="4118003">:=</span>&nbsp;<span class="ident" id="4118006">c</span><span class="op" id="4118007">.</span><span class="ident" id="4118008">cmd</span><span class="op" id="4118011">(</span><span class="num" id="4118012">25</span><span class="op" id="4118014">,</span>&nbsp;<span class="string" id="4118016">&#34;RCPT&nbsp;TO:&lt;%s&gt;&#34;</span><span class="op" id="4118030">,</span>&nbsp;<span class="ident" id="4118032">to</span><span class="op" id="4118034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118037">return</span>&nbsp;<span class="ident" id="4118044">err</span><br>
<span class="lineno"></span><span class="op" id="4118048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4118051">type</span>&nbsp;<span class="ident" id="4118056">dataCloser</span>&nbsp;<span class="keyword" id="4118067">struct</span>&nbsp;<span class="op" id="4118074">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118077">c</span>&nbsp;<span class="op" id="4118079">*</span><span class="ident" id="4118080">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118088">io</span><span class="op" id="4118090">.</span><span class="ident" id="4118091">WriteCloser</span><br>
<span class="lineno"></span><span class="op" id="4118103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4118106">func</span>&nbsp;<span class="op" id="4118111">(</span><span class="ident" id="4118112">d</span>&nbsp;<span class="op" id="4118114">*</span><span class="ident" id="4118115">dataCloser</span><span class="op" id="4118125">)</span>&nbsp;<span class="ident" id="4118127">Close</span><span class="op" id="4118132">(</span><span class="op" id="4118133">)</span>&nbsp;<span class="builtintype" id="4118135">error</span>&nbsp;<span class="op" id="4118141">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118144">d</span><span class="op" id="4118145">.</span><span class="ident" id="4118146">WriteCloser</span><span class="op" id="4118157">.</span><span class="ident" id="4118158">Close</span><span class="op" id="4118163">(</span><span class="op" id="4118164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118167">_</span><span class="op" id="4118168">,</span>&nbsp;<span class="ident" id="4118170">_</span><span class="op" id="4118171">,</span>&nbsp;<span class="ident" id="4118173">err</span>&nbsp;<span class="op" id="4118177">:=</span>&nbsp;<span class="ident" id="4118180">d</span><span class="op" id="4118181">.</span><span class="ident" id="4118182">c</span><span class="op" id="4118183">.</span><span class="ident" id="4118184">Text</span><span class="op" id="4118188">.</span><span class="ident" id="4118189">ReadResponse</span><span class="op" id="4118201">(</span><span class="num" id="4118202">250</span><span class="op" id="4118205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118208">return</span>&nbsp;<span class="ident" id="4118215">err</span><br>
<span class="lineno"></span><span class="op" id="4118219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="4118222">//&nbsp;Data&nbsp;issues&nbsp;a&nbsp;DATA&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4118292">//&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;the&nbsp;data.&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the&nbsp;writer</span><br>
<span class="lineno"></span><span class="comment" id="4118361">//&nbsp;before&nbsp;calling&nbsp;any&nbsp;more&nbsp;methods&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="4118402">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Data&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;calls&nbsp;to&nbsp;Rcpt.</span><br>
<span class="lineno"></span><span class="keyword" id="4118467">func</span>&nbsp;<span class="op" id="4118472">(</span><span class="ident" id="4118473">c</span>&nbsp;<span class="op" id="4118475">*</span><span class="ident" id="4118476">Client</span><span class="op" id="4118482">)</span>&nbsp;<span class="ident" id="4118484">Data</span><span class="op" id="4118488">(</span><span class="op" id="4118489">)</span>&nbsp;<span class="op" id="4118491">(</span><span class="ident" id="4118492">io</span><span class="op" id="4118494">.</span><span class="ident" id="4118495">WriteCloser</span><span class="op" id="4118506">,</span>&nbsp;<span class="builtintype" id="4118508">error</span><span class="op" id="4118513">)</span>&nbsp;<span class="op" id="4118515">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118518">_</span><span class="op" id="4118519">,</span>&nbsp;<span class="ident" id="4118521">_</span><span class="op" id="4118522">,</span>&nbsp;<span class="ident" id="4118524">err</span>&nbsp;<span class="op" id="4118528">:=</span>&nbsp;<span class="ident" id="4118531">c</span><span class="op" id="4118532">.</span><span class="ident" id="4118533">cmd</span><span class="op" id="4118536">(</span><span class="num" id="4118537">354</span><span class="op" id="4118540">,</span>&nbsp;<span class="string" id="4118542">&#34;DATA&#34;</span><span class="op" id="4118548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118551">if</span>&nbsp;<span class="ident" id="4118554">err</span>&nbsp;<span class="op" id="4118558">!=</span>&nbsp;<span class="ident" id="4118561">nil</span>&nbsp;<span class="op" id="4118565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118569">return</span>&nbsp;<span class="ident" id="4118576">nil</span><span class="op" id="4118579">,</span>&nbsp;<span class="ident" id="4118581">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4118586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118589">return</span>&nbsp;<span class="op" id="4118596">&amp;</span><span class="ident" id="4118597">dataCloser</span><span class="op" id="4118607">{</span><span class="ident" id="4118608">c</span><span class="op" id="4118609">,</span>&nbsp;<span class="ident" id="4118611">c</span><span class="op" id="4118612">.</span><span class="ident" id="4118613">Text</span><span class="op" id="4118617">.</span><span class="ident" id="4118618">DotWriter</span><span class="op" id="4118627">(</span><span class="op" id="4118628">)</span><span class="op" id="4118629">}</span><span class="op" id="4118630">,</span>&nbsp;<span class="ident" id="4118632">nil</span><br>
<span class="lineno">265</span><span class="op" id="4118636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4118639">var</span>&nbsp;<span class="ident" id="4118643">testHookStartTLS</span>&nbsp;<span class="keyword" id="4118660">func</span><span class="op" id="4118664">(</span><span class="op" id="4118665">*</span><span class="ident" id="4118666">tls</span><span class="op" id="4118669">.</span><span class="ident" id="4118670">Config</span><span class="op" id="4118676">)</span>&nbsp;<span class="comment" id="4118678">//&nbsp;nil,&nbsp;except&nbsp;for&nbsp;tests</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4118704">//&nbsp;SendMail&nbsp;connects&nbsp;to&nbsp;the&nbsp;server&nbsp;at&nbsp;addr,&nbsp;switches&nbsp;to&nbsp;TLS&nbsp;if</span><br>
<span class="lineno">270</span><span class="comment" id="4118767">//&nbsp;possible,&nbsp;authenticates&nbsp;with&nbsp;the&nbsp;optional&nbsp;mechanism&nbsp;a&nbsp;if&nbsp;possible,</span><br>
<span class="lineno"></span><span class="comment" id="4118837">//&nbsp;and&nbsp;then&nbsp;sends&nbsp;an&nbsp;email&nbsp;from&nbsp;address&nbsp;from,&nbsp;to&nbsp;addresses&nbsp;to,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4118905">//&nbsp;message&nbsp;msg.</span><br>
<span class="lineno"></span><span class="keyword" id="4118921">func</span>&nbsp;<span class="ident" id="4118926">SendMail</span><span class="op" id="4118934">(</span><span class="ident" id="4118935">addr</span>&nbsp;<span class="builtintype" id="4118940">string</span><span class="op" id="4118946">,</span>&nbsp;<span class="ident" id="4118948">a</span>&nbsp;<span class="ident" id="4118950">Auth</span><span class="op" id="4118954">,</span>&nbsp;<span class="ident" id="4118956">from</span>&nbsp;<span class="builtintype" id="4118961">string</span><span class="op" id="4118967">,</span>&nbsp;<span class="ident" id="4118969">to</span>&nbsp;<span class="op" id="4118972">[</span><span class="op" id="4118973">]</span><span class="builtintype" id="4118974">string</span><span class="op" id="4118980">,</span>&nbsp;<span class="ident" id="4118982">msg</span>&nbsp;<span class="op" id="4118986">[</span><span class="op" id="4118987">]</span><span class="builtintype" id="4118988">byte</span><span class="op" id="4118992">)</span>&nbsp;<span class="builtintype" id="4118994">error</span>&nbsp;<span class="op" id="4119000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119003">c</span><span class="op" id="4119004">,</span>&nbsp;<span class="ident" id="4119006">err</span>&nbsp;<span class="op" id="4119010">:=</span>&nbsp;<span class="ident" id="4119013">Dial</span><span class="op" id="4119017">(</span><span class="ident" id="4119018">addr</span><span class="op" id="4119022">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119025">if</span>&nbsp;<span class="ident" id="4119028">err</span>&nbsp;<span class="op" id="4119032">!=</span>&nbsp;<span class="ident" id="4119035">nil</span>&nbsp;<span class="op" id="4119039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119043">return</span>&nbsp;<span class="ident" id="4119050">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119058">defer</span>&nbsp;<span class="ident" id="4119064">c</span><span class="op" id="4119065">.</span><span class="ident" id="4119066">Close</span><span class="op" id="4119071">(</span><span class="op" id="4119072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119075">if</span>&nbsp;<span class="ident" id="4119078">err</span>&nbsp;<span class="op" id="4119082">=</span>&nbsp;<span class="ident" id="4119084">c</span><span class="op" id="4119085">.</span><span class="ident" id="4119086">hello</span><span class="op" id="4119091">(</span><span class="op" id="4119092">)</span><span class="op" id="4119093">;</span>&nbsp;<span class="ident" id="4119095">err</span>&nbsp;<span class="op" id="4119099">!=</span>&nbsp;<span class="ident" id="4119102">nil</span>&nbsp;<span class="op" id="4119106">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119110">return</span>&nbsp;<span class="ident" id="4119117">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119125">if</span>&nbsp;<span class="ident" id="4119128">ok</span><span class="op" id="4119130">,</span>&nbsp;<span class="ident" id="4119132">_</span>&nbsp;<span class="op" id="4119134">:=</span>&nbsp;<span class="ident" id="4119137">c</span><span class="op" id="4119138">.</span><span class="ident" id="4119139">Extension</span><span class="op" id="4119148">(</span><span class="string" id="4119149">&#34;STARTTLS&#34;</span><span class="op" id="4119159">)</span><span class="op" id="4119160">;</span>&nbsp;<span class="ident" id="4119162">ok</span>&nbsp;<span class="op" id="4119165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119169">config</span>&nbsp;<span class="op" id="4119176">:=</span>&nbsp;<span class="op" id="4119179">&amp;</span><span class="ident" id="4119180">tls</span><span class="op" id="4119183">.</span><span class="ident" id="4119184">Config</span><span class="op" id="4119190">{</span><span class="ident" id="4119191">ServerName</span><span class="op" id="4119201">:</span>&nbsp;<span class="ident" id="4119203">c</span><span class="op" id="4119204">.</span><span class="ident" id="4119205">serverName</span><span class="op" id="4119215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119219">if</span>&nbsp;<span class="ident" id="4119222">testHookStartTLS</span>&nbsp;<span class="op" id="4119239">!=</span>&nbsp;<span class="ident" id="4119242">nil</span>&nbsp;<span class="op" id="4119246">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119251">testHookStartTLS</span><span class="op" id="4119267">(</span><span class="ident" id="4119268">config</span><span class="op" id="4119274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119282">if</span>&nbsp;<span class="ident" id="4119285">err</span>&nbsp;<span class="op" id="4119289">=</span>&nbsp;<span class="ident" id="4119291">c</span><span class="op" id="4119292">.</span><span class="ident" id="4119293">StartTLS</span><span class="op" id="4119301">(</span><span class="ident" id="4119302">config</span><span class="op" id="4119308">)</span><span class="op" id="4119309">;</span>&nbsp;<span class="ident" id="4119311">err</span>&nbsp;<span class="op" id="4119315">!=</span>&nbsp;<span class="ident" id="4119318">nil</span>&nbsp;<span class="op" id="4119322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119327">return</span>&nbsp;<span class="ident" id="4119334">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119340">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119346">if</span>&nbsp;<span class="ident" id="4119349">a</span>&nbsp;<span class="op" id="4119351">!=</span>&nbsp;<span class="ident" id="4119354">nil</span>&nbsp;<span class="op" id="4119358">&amp;&amp;</span>&nbsp;<span class="ident" id="4119361">c</span><span class="op" id="4119362">.</span><span class="ident" id="4119363">ext</span>&nbsp;<span class="op" id="4119367">!=</span>&nbsp;<span class="ident" id="4119370">nil</span>&nbsp;<span class="op" id="4119374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119378">if</span>&nbsp;<span class="ident" id="4119381">_</span><span class="op" id="4119382">,</span>&nbsp;<span class="ident" id="4119384">ok</span>&nbsp;<span class="op" id="4119387">:=</span>&nbsp;<span class="ident" id="4119390">c</span><span class="op" id="4119391">.</span><span class="ident" id="4119392">ext</span><span class="op" id="4119395">[</span><span class="string" id="4119396">&#34;AUTH&#34;</span><span class="op" id="4119402">]</span><span class="op" id="4119403">;</span>&nbsp;<span class="ident" id="4119405">ok</span>&nbsp;<span class="op" id="4119408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119413">if</span>&nbsp;<span class="ident" id="4119416">err</span>&nbsp;<span class="op" id="4119420">=</span>&nbsp;<span class="ident" id="4119422">c</span><span class="op" id="4119423">.</span><span class="ident" id="4119424">Auth</span><span class="op" id="4119428">(</span><span class="ident" id="4119429">a</span><span class="op" id="4119430">)</span><span class="op" id="4119431">;</span>&nbsp;<span class="ident" id="4119433">err</span>&nbsp;<span class="op" id="4119437">!=</span>&nbsp;<span class="ident" id="4119440">nil</span>&nbsp;<span class="op" id="4119444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119450">return</span>&nbsp;<span class="ident" id="4119457">err</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119474">if</span>&nbsp;<span class="ident" id="4119477">err</span>&nbsp;<span class="op" id="4119481">=</span>&nbsp;<span class="ident" id="4119483">c</span><span class="op" id="4119484">.</span><span class="ident" id="4119485">Mail</span><span class="op" id="4119489">(</span><span class="ident" id="4119490">from</span><span class="op" id="4119494">)</span><span class="op" id="4119495">;</span>&nbsp;<span class="ident" id="4119497">err</span>&nbsp;<span class="op" id="4119501">!=</span>&nbsp;<span class="ident" id="4119504">nil</span>&nbsp;<span class="op" id="4119508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119512">return</span>&nbsp;<span class="ident" id="4119519">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119527">for</span>&nbsp;<span class="ident" id="4119531">_</span><span class="op" id="4119532">,</span>&nbsp;<span class="ident" id="4119534">addr</span>&nbsp;<span class="op" id="4119539">:=</span>&nbsp;<span class="keyword" id="4119542">range</span>&nbsp;<span class="ident" id="4119548">to</span>&nbsp;<span class="op" id="4119551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119555">if</span>&nbsp;<span class="ident" id="4119558">err</span>&nbsp;<span class="op" id="4119562">=</span>&nbsp;<span class="ident" id="4119564">c</span><span class="op" id="4119565">.</span><span class="ident" id="4119566">Rcpt</span><span class="op" id="4119570">(</span><span class="ident" id="4119571">addr</span><span class="op" id="4119575">)</span><span class="op" id="4119576">;</span>&nbsp;<span class="ident" id="4119578">err</span>&nbsp;<span class="op" id="4119582">!=</span>&nbsp;<span class="ident" id="4119585">nil</span>&nbsp;<span class="op" id="4119589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119594">return</span>&nbsp;<span class="ident" id="4119601">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119607">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119613">w</span><span class="op" id="4119614">,</span>&nbsp;<span class="ident" id="4119616">err</span>&nbsp;<span class="op" id="4119620">:=</span>&nbsp;<span class="ident" id="4119623">c</span><span class="op" id="4119624">.</span><span class="ident" id="4119625">Data</span><span class="op" id="4119629">(</span><span class="op" id="4119630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119633">if</span>&nbsp;<span class="ident" id="4119636">err</span>&nbsp;<span class="op" id="4119640">!=</span>&nbsp;<span class="ident" id="4119643">nil</span>&nbsp;<span class="op" id="4119647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119651">return</span>&nbsp;<span class="ident" id="4119658">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119663">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119666">_</span><span class="op" id="4119667">,</span>&nbsp;<span class="ident" id="4119669">err</span>&nbsp;<span class="op" id="4119673">=</span>&nbsp;<span class="ident" id="4119675">w</span><span class="op" id="4119676">.</span><span class="ident" id="4119677">Write</span><span class="op" id="4119682">(</span><span class="ident" id="4119683">msg</span><span class="op" id="4119686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119689">if</span>&nbsp;<span class="ident" id="4119692">err</span>&nbsp;<span class="op" id="4119696">!=</span>&nbsp;<span class="ident" id="4119699">nil</span>&nbsp;<span class="op" id="4119703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119707">return</span>&nbsp;<span class="ident" id="4119714">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119722">err</span>&nbsp;<span class="op" id="4119726">=</span>&nbsp;<span class="ident" id="4119728">w</span><span class="op" id="4119729">.</span><span class="ident" id="4119730">Close</span><span class="op" id="4119735">(</span><span class="op" id="4119736">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119739">if</span>&nbsp;<span class="ident" id="4119742">err</span>&nbsp;<span class="op" id="4119746">!=</span>&nbsp;<span class="ident" id="4119749">nil</span>&nbsp;<span class="op" id="4119753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119757">return</span>&nbsp;<span class="ident" id="4119764">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119772">return</span>&nbsp;<span class="ident" id="4119779">c</span><span class="op" id="4119780">.</span><span class="ident" id="4119781">Quit</span><span class="op" id="4119785">(</span><span class="op" id="4119786">)</span><br>
<span class="lineno"></span><span class="op" id="4119788">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="4119791">//&nbsp;Extension&nbsp;reports&nbsp;whether&nbsp;an&nbsp;extension&nbsp;is&nbsp;support&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="4119859">//&nbsp;The&nbsp;extension&nbsp;name&nbsp;is&nbsp;case-insensitive.&nbsp;If&nbsp;the&nbsp;extension&nbsp;is&nbsp;supported,</span><br>
<span class="lineno"></span><span class="comment" id="4119933">//&nbsp;Extension&nbsp;also&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;contains&nbsp;any&nbsp;parameters&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4120001">//&nbsp;server&nbsp;specifies&nbsp;for&nbsp;the&nbsp;extension.</span><br>
<span class="lineno">325</span><span class="keyword" id="4120040">func</span>&nbsp;<span class="op" id="4120045">(</span><span class="ident" id="4120046">c</span>&nbsp;<span class="op" id="4120048">*</span><span class="ident" id="4120049">Client</span><span class="op" id="4120055">)</span>&nbsp;<span class="ident" id="4120057">Extension</span><span class="op" id="4120066">(</span><span class="ident" id="4120067">ext</span>&nbsp;<span class="builtintype" id="4120071">string</span><span class="op" id="4120077">)</span>&nbsp;<span class="op" id="4120079">(</span><span class="builtintype" id="4120080">bool</span><span class="op" id="4120084">,</span>&nbsp;<span class="builtintype" id="4120086">string</span><span class="op" id="4120092">)</span>&nbsp;<span class="op" id="4120094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120097">if</span>&nbsp;<span class="ident" id="4120100">err</span>&nbsp;<span class="op" id="4120104">:=</span>&nbsp;<span class="ident" id="4120107">c</span><span class="op" id="4120108">.</span><span class="ident" id="4120109">hello</span><span class="op" id="4120114">(</span><span class="op" id="4120115">)</span><span class="op" id="4120116">;</span>&nbsp;<span class="ident" id="4120118">err</span>&nbsp;<span class="op" id="4120122">!=</span>&nbsp;<span class="ident" id="4120125">nil</span>&nbsp;<span class="op" id="4120129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120133">return</span>&nbsp;<span class="builtintype" id="4120140">false</span><span class="op" id="4120145">,</span>&nbsp;<span class="string" id="4120147">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120154">if</span>&nbsp;<span class="ident" id="4120157">c</span><span class="op" id="4120158">.</span><span class="ident" id="4120159">ext</span>&nbsp;<span class="op" id="4120163">==</span>&nbsp;<span class="ident" id="4120166">nil</span>&nbsp;<span class="op" id="4120170">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120174">return</span>&nbsp;<span class="builtintype" id="4120181">false</span><span class="op" id="4120186">,</span>&nbsp;<span class="string" id="4120188">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120195">ext</span>&nbsp;<span class="op" id="4120199">=</span>&nbsp;<span class="ident" id="4120201">strings</span><span class="op" id="4120208">.</span><span class="ident" id="4120209">ToUpper</span><span class="op" id="4120216">(</span><span class="ident" id="4120217">ext</span><span class="op" id="4120220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120223">param</span><span class="op" id="4120228">,</span>&nbsp;<span class="ident" id="4120230">ok</span>&nbsp;<span class="op" id="4120233">:=</span>&nbsp;<span class="ident" id="4120236">c</span><span class="op" id="4120237">.</span><span class="ident" id="4120238">ext</span><span class="op" id="4120241">[</span><span class="ident" id="4120242">ext</span><span class="op" id="4120245">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120248">return</span>&nbsp;<span class="ident" id="4120255">ok</span><span class="op" id="4120257">,</span>&nbsp;<span class="ident" id="4120259">param</span><br>
<span class="lineno">335</span><span class="op" id="4120265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4120268">//&nbsp;Reset&nbsp;sends&nbsp;the&nbsp;RSET&nbsp;command&nbsp;to&nbsp;the&nbsp;server,&nbsp;aborting&nbsp;the&nbsp;current&nbsp;mail</span><br>
<span class="lineno"></span><span class="comment" id="4120341">//&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="4120357">func</span>&nbsp;<span class="op" id="4120362">(</span><span class="ident" id="4120363">c</span>&nbsp;<span class="op" id="4120365">*</span><span class="ident" id="4120366">Client</span><span class="op" id="4120372">)</span>&nbsp;<span class="ident" id="4120374">Reset</span><span class="op" id="4120379">(</span><span class="op" id="4120380">)</span>&nbsp;<span class="builtintype" id="4120382">error</span>&nbsp;<span class="op" id="4120388">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120391">if</span>&nbsp;<span class="ident" id="4120394">err</span>&nbsp;<span class="op" id="4120398">:=</span>&nbsp;<span class="ident" id="4120401">c</span><span class="op" id="4120402">.</span><span class="ident" id="4120403">hello</span><span class="op" id="4120408">(</span><span class="op" id="4120409">)</span><span class="op" id="4120410">;</span>&nbsp;<span class="ident" id="4120412">err</span>&nbsp;<span class="op" id="4120416">!=</span>&nbsp;<span class="ident" id="4120419">nil</span>&nbsp;<span class="op" id="4120423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120427">return</span>&nbsp;<span class="ident" id="4120434">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120442">_</span><span class="op" id="4120443">,</span>&nbsp;<span class="ident" id="4120445">_</span><span class="op" id="4120446">,</span>&nbsp;<span class="ident" id="4120448">err</span>&nbsp;<span class="op" id="4120452">:=</span>&nbsp;<span class="ident" id="4120455">c</span><span class="op" id="4120456">.</span><span class="ident" id="4120457">cmd</span><span class="op" id="4120460">(</span><span class="num" id="4120461">250</span><span class="op" id="4120464">,</span>&nbsp;<span class="string" id="4120466">&#34;RSET&#34;</span><span class="op" id="4120472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120475">return</span>&nbsp;<span class="ident" id="4120482">err</span><br>
<span class="lineno">345</span><span class="op" id="4120486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4120489">//&nbsp;Quit&nbsp;sends&nbsp;the&nbsp;QUIT&nbsp;command&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="4120561">func</span>&nbsp;<span class="op" id="4120566">(</span><span class="ident" id="4120567">c</span>&nbsp;<span class="op" id="4120569">*</span><span class="ident" id="4120570">Client</span><span class="op" id="4120576">)</span>&nbsp;<span class="ident" id="4120578">Quit</span><span class="op" id="4120582">(</span><span class="op" id="4120583">)</span>&nbsp;<span class="builtintype" id="4120585">error</span>&nbsp;<span class="op" id="4120591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120594">if</span>&nbsp;<span class="ident" id="4120597">err</span>&nbsp;<span class="op" id="4120601">:=</span>&nbsp;<span class="ident" id="4120604">c</span><span class="op" id="4120605">.</span><span class="ident" id="4120606">hello</span><span class="op" id="4120611">(</span><span class="op" id="4120612">)</span><span class="op" id="4120613">;</span>&nbsp;<span class="ident" id="4120615">err</span>&nbsp;<span class="op" id="4120619">!=</span>&nbsp;<span class="ident" id="4120622">nil</span>&nbsp;<span class="op" id="4120626">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120630">return</span>&nbsp;<span class="ident" id="4120637">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120645">_</span><span class="op" id="4120646">,</span>&nbsp;<span class="ident" id="4120648">_</span><span class="op" id="4120649">,</span>&nbsp;<span class="ident" id="4120651">err</span>&nbsp;<span class="op" id="4120655">:=</span>&nbsp;<span class="ident" id="4120658">c</span><span class="op" id="4120659">.</span><span class="ident" id="4120660">cmd</span><span class="op" id="4120663">(</span><span class="num" id="4120664">221</span><span class="op" id="4120667">,</span>&nbsp;<span class="string" id="4120669">&#34;QUIT&#34;</span><span class="op" id="4120675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120678">if</span>&nbsp;<span class="ident" id="4120681">err</span>&nbsp;<span class="op" id="4120685">!=</span>&nbsp;<span class="ident" id="4120688">nil</span>&nbsp;<span class="op" id="4120692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120696">return</span>&nbsp;<span class="ident" id="4120703">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120711">return</span>&nbsp;<span class="ident" id="4120718">c</span><span class="op" id="4120719">.</span><span class="ident" id="4120720">Text</span><span class="op" id="4120724">.</span><span class="ident" id="4120725">Close</span><span class="op" id="4120730">(</span><span class="op" id="4120731">)</span><br>
<span class="lineno"></span><span class="op" id="4120733">}</span>
</div>
</body>
</html>
