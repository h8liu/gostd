<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2450901">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2450956">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2451010">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2451061">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2451131">package</span>&nbsp;<span class="ident" id="2451139">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2451143">import</span>&nbsp;<span class="op" id="2451150">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2451153">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2451164">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2451179">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2451189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2451192">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2451236">type</span>&nbsp;<span class="ident" id="2451241">File</span>&nbsp;<span class="keyword" id="2451246">struct</span>&nbsp;<span class="op" id="2451253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2451256">*</span><span class="ident" id="2451257"><a href="/os/file_unix.go.html#2451478">file</a></span><br>
<span class="lineno"></span><span class="op" id="2451262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2451265">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2451310">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2451374">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2451434">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2451473">type</span>&nbsp;<span class="ident" id="2451478">file</span>&nbsp;<span class="keyword" id="2451483">struct</span>&nbsp;<span class="op" id="2451490">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2451493">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2451501">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2451506">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2451514">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2451522">dirinfo</span>&nbsp;<span class="op" id="2451530">*</span><span class="ident" id="2451531"><a href="/os/file_unix.go.html#2452218">dirInfo</a></span>&nbsp;<span class="comment" id="2451539">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2451575">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2451583">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2451592">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2451632">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2451635">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2451709">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2451797">func</span>&nbsp;<span class="op" id="2451802">(</span><span class="ident" id="2451803">f</span>&nbsp;<span class="op" id="2451805">*</span><span class="ident" id="2451806"><a href="/os/file_unix.go.html#2451241">File</a></span><span class="op" id="2451810">)</span>&nbsp;<span class="ident" id="2451812">Fd</span><span class="op" id="2451814">(</span><span class="op" id="2451815">)</span>&nbsp;<span class="builtintype" id="2451817">uintptr</span>&nbsp;<span class="op" id="2451825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2451828">if</span>&nbsp;<span class="ident" id="2451831"><a href="/os/file_unix.go.html#2451803">f</a></span>&nbsp;<span class="op" id="2451833">==</span>&nbsp;<span class="ident" id="2451836">nil</span>&nbsp;<span class="op" id="2451840">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2451844">return</span>&nbsp;<span class="op" id="2451851">^</span><span class="op" id="2451852">(</span><span class="builtintype" id="2451853">uintptr</span><span class="op" id="2451860">(</span><span class="num" id="2451861">0</span><span class="op" id="2451862">)</span><span class="op" id="2451863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2451866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2451869">return</span>&nbsp;<span class="builtintype" id="2451876">uintptr</span><span class="op" id="2451883">(</span><span class="ident" id="2451884"><a href="/os/file_unix.go.html#2451803">f</a></span><span class="op" id="2451885">.</span><span class="ident" id="2451886">fd</span><span class="op" id="2451888">)</span><br>
<span class="lineno"></span><span class="op" id="2451890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2451893">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2451964">func</span>&nbsp;<span class="ident" id="2451969">NewFile</span><span class="op" id="2451976">(</span><span class="ident" id="2451977">fd</span>&nbsp;<span class="builtintype" id="2451980">uintptr</span><span class="op" id="2451987">,</span>&nbsp;<span class="ident" id="2451989">name</span>&nbsp;<span class="builtintype" id="2451994">string</span><span class="op" id="2452000">)</span>&nbsp;<span class="op" id="2452002">*</span><span class="ident" id="2452003"><a href="/os/file_unix.go.html#2451241">File</a></span>&nbsp;<span class="op" id="2452008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2452011">fdi</span>&nbsp;<span class="op" id="2452015">:=</span>&nbsp;<span class="builtintype" id="2452018">int</span><span class="op" id="2452021">(</span><span class="ident" id="2452022"><a href="/os/file_unix.go.html#2451977">fd</a></span><span class="op" id="2452024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2452027">if</span>&nbsp;<span class="ident" id="2452030"><a href="/os/file_unix.go.html#2452011">fdi</a></span>&nbsp;<span class="op" id="2452034">&lt;</span>&nbsp;<span class="num" id="2452036">0</span>&nbsp;<span class="op" id="2452038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2452042">return</span>&nbsp;<span class="ident" id="2452049">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2452054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2452057">f</span>&nbsp;<span class="op" id="2452059">:=</span>&nbsp;<span class="op" id="2452062">&amp;</span><span class="ident" id="2452063"><a href="/os/file_unix.go.html#2451241">File</a></span><span class="op" id="2452067">{</span><span class="op" id="2452068">&amp;</span><span class="ident" id="2452069"><a href="/os/file_unix.go.html#2451478">file</a></span><span class="op" id="2452073">{</span><span class="ident" id="2452074">fd</span><span class="op" id="2452076">:</span>&nbsp;<span class="ident" id="2452078"><a href="/os/file_unix.go.html#2452011">fdi</a></span><span class="op" id="2452081">,</span>&nbsp;<span class="ident" id="2452083">name</span><span class="op" id="2452087">:</span>&nbsp;<span class="ident" id="2452089"><a href="/os/file_unix.go.html#2451989">name</a></span><span class="op" id="2452093">}</span><span class="op" id="2452094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2452097"><a href="/os/file_unix.go.html#2451153">runtime</a></span><span class="op" id="2452104">.</span><span class="ident" id="2452105">SetFinalizer</span><span class="op" id="2452117">(</span><span class="ident" id="2452118"><a href="/os/file_unix.go.html#2452057">f</a></span><span class="op" id="2452119">.</span><span class="ident" id="2452120">file</span><span class="op" id="2452124">,</span>&nbsp;<span class="op" id="2452126">(</span><span class="op" id="2452127">*</span><span class="ident" id="2452128"><a href="/os/file_unix.go.html#2451478">file</a></span><span class="op" id="2452132">)</span><span class="op" id="2452133">.</span><span class="builtinfunc" id="2452134">close</span><span class="op" id="2452139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2452142">return</span>&nbsp;<span class="ident" id="2452149"><a href="/os/file_unix.go.html#2452057">f</a></span><br>
<span class="lineno"></span><span class="op" id="2452151">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2452154">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2452213">type</span>&nbsp;<span class="ident" id="2452218">dirInfo</span>&nbsp;<span class="keyword" id="2452226">struct</span>&nbsp;<span class="op" id="2452233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2452236">buf</span>&nbsp;&nbsp;<span class="op" id="2452241">[</span><span class="op" id="2452242">]</span><span class="builtintype" id="2452243">byte</span>&nbsp;<span class="comment" id="2452248">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2452277">nbuf</span>&nbsp;<span class="builtintype" id="2452282">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2452289">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2452340">bufp</span>&nbsp;<span class="builtintype" id="2452345">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2452352">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2452387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2452390">func</span>&nbsp;<span class="ident" id="2452395">epipecheck</span><span class="op" id="2452405">(</span><span class="ident" id="2452406">file</span>&nbsp;<span class="op" id="2452411">*</span><span class="ident" id="2452412"><a href="/os/file_unix.go.html#2451241">File</a></span><span class="op" id="2452416">,</span>&nbsp;<span class="ident" id="2452418">e</span>&nbsp;<span class="builtintype" id="2452420">error</span><span class="op" id="2452425">)</span>&nbsp;<span class="op" id="2452427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2452430">if</span>&nbsp;<span class="ident" id="2452433"><a href="/os/file_unix.go.html#2452418">e</a></span>&nbsp;<span class="op" id="2452435">==</span>&nbsp;<span class="ident" id="2452438"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2452445">.</span><span class="ident" id="2452446">EPIPE</span>&nbsp;<span class="op" id="2452452">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2452456">if</span>&nbsp;<span class="ident" id="2452459"><a href="/os/file_unix.go.html#2451164">atomic</a></span><span class="op" id="2452465">.</span><span class="ident" id="2452466">AddInt32</span><span class="op" id="2452474">(</span><span class="op" id="2452475">&amp;</span><span class="ident" id="2452476"><a href="/os/file_unix.go.html#2452406">file</a></span><span class="op" id="2452480">.</span><span class="ident" id="2452481">nepipe</span><span class="op" id="2452487">,</span>&nbsp;<span class="num" id="2452489">1</span><span class="op" id="2452490">)</span>&nbsp;<span class="op" id="2452492">&gt;=</span>&nbsp;<span class="num" id="2452495">10</span>&nbsp;<span class="op" id="2452498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2452503"><a href="/os/file_posix.go.html#2446996">sigpipe</a></span><span class="op" id="2452510">(</span><span class="op" id="2452511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2452515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2452518">}</span>&nbsp;<span class="keyword" id="2452520">else</span>&nbsp;<span class="op" id="2452525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2452529"><a href="/os/file_unix.go.html#2451164">atomic</a></span><span class="op" id="2452535">.</span><span class="ident" id="2452536">StoreInt32</span><span class="op" id="2452546">(</span><span class="op" id="2452547">&amp;</span><span class="ident" id="2452548"><a href="/os/file_unix.go.html#2452406">file</a></span><span class="op" id="2452552">.</span><span class="ident" id="2452553">nepipe</span><span class="op" id="2452559">,</span>&nbsp;<span class="num" id="2452561">0</span><span class="op" id="2452562">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2452565">}</span><br>
<span class="lineno"></span><span class="op" id="2452567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2452570">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2452636">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2452699">const</span>&nbsp;<span class="ident" id="2452705">DevNull</span>&nbsp;<span class="op" id="2452713">=</span>&nbsp;<span class="string" id="2452715">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2452728">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2452795">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2452862">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2452934">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2452987">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2453043">func</span>&nbsp;<span class="ident" id="2453048">OpenFile</span><span class="op" id="2453056">(</span><span class="ident" id="2453057">name</span>&nbsp;<span class="builtintype" id="2453062">string</span><span class="op" id="2453068">,</span>&nbsp;<span class="ident" id="2453070">flag</span>&nbsp;<span class="builtintype" id="2453075">int</span><span class="op" id="2453078">,</span>&nbsp;<span class="ident" id="2453080">perm</span>&nbsp;<span class="ident" id="2453085"><a href="/os/types.go.html#2472066">FileMode</a></span><span class="op" id="2453093">)</span>&nbsp;<span class="op" id="2453095">(</span><span class="ident" id="2453096">file</span>&nbsp;<span class="op" id="2453101">*</span><span class="ident" id="2453102"><a href="/os/file_unix.go.html#2451241">File</a></span><span class="op" id="2453106">,</span>&nbsp;<span class="ident" id="2453108">err</span>&nbsp;<span class="builtintype" id="2453112">error</span><span class="op" id="2453117">)</span>&nbsp;<span class="op" id="2453119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453122">r</span><span class="op" id="2453123">,</span>&nbsp;<span class="ident" id="2453125">e</span>&nbsp;<span class="op" id="2453127">:=</span>&nbsp;<span class="ident" id="2453130"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2453137">.</span><span class="ident" id="2453138">Open</span><span class="op" id="2453142">(</span><span class="ident" id="2453143"><a href="/os/file_unix.go.html#2453057">name</a></span><span class="op" id="2453147">,</span>&nbsp;<span class="ident" id="2453149"><a href="/os/file_unix.go.html#2453070">flag</a></span><span class="op" id="2453153">|</span><span class="ident" id="2453154"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2453161">.</span><span class="ident" id="2453162">O_CLOEXEC</span><span class="op" id="2453171">,</span>&nbsp;<span class="ident" id="2453173"><a href="/os/file_posix.go.html#2447685">syscallMode</a></span><span class="op" id="2453184">(</span><span class="ident" id="2453185"><a href="/os/file_unix.go.html#2453080">perm</a></span><span class="op" id="2453189">)</span><span class="op" id="2453190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453193">if</span>&nbsp;<span class="ident" id="2453196"><a href="/os/file_unix.go.html#2453125">e</a></span>&nbsp;<span class="op" id="2453198">!=</span>&nbsp;<span class="ident" id="2453201">nil</span>&nbsp;<span class="op" id="2453205">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453209">return</span>&nbsp;<span class="ident" id="2453216">nil</span><span class="op" id="2453219">,</span>&nbsp;<span class="op" id="2453221">&amp;</span><span class="ident" id="2453222"><a href="/os/error.go.html#2429885">PathError</a></span><span class="op" id="2453231">{</span><span class="string" id="2453232">&#34;open&#34;</span><span class="op" id="2453238">,</span>&nbsp;<span class="ident" id="2453240"><a href="/os/file_unix.go.html#2453057">name</a></span><span class="op" id="2453244">,</span>&nbsp;<span class="ident" id="2453246"><a href="/os/file_unix.go.html#2453125">e</a></span><span class="op" id="2453247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2453250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2453254">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2453307">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453363">if</span>&nbsp;<span class="op" id="2453366">!</span><span class="ident" id="2453367"><a href="/os/sys_unix.go.html#2470989">supportsCloseOnExec</a></span>&nbsp;<span class="op" id="2453387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453391"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2453398">.</span><span class="ident" id="2453399">CloseOnExec</span><span class="op" id="2453410">(</span><span class="ident" id="2453411"><a href="/os/file_unix.go.html#2453122">r</a></span><span class="op" id="2453412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2453415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453419">return</span>&nbsp;<span class="ident" id="2453426"><a href="/os/file_unix.go.html#2451969">NewFile</a></span><span class="op" id="2453433">(</span><span class="builtintype" id="2453434">uintptr</span><span class="op" id="2453441">(</span><span class="ident" id="2453442"><a href="/os/file_unix.go.html#2453122">r</a></span><span class="op" id="2453443">)</span><span class="op" id="2453444">,</span>&nbsp;<span class="ident" id="2453446"><a href="/os/file_unix.go.html#2453057">name</a></span><span class="op" id="2453450">)</span><span class="op" id="2453451">,</span>&nbsp;<span class="ident" id="2453453">nil</span><br>
<span class="lineno">90</span><span class="op" id="2453457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2453460">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2453517">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2453549">func</span>&nbsp;<span class="op" id="2453554">(</span><span class="ident" id="2453555">f</span>&nbsp;<span class="op" id="2453557">*</span><span class="ident" id="2453558"><a href="/os/file_unix.go.html#2451241">File</a></span><span class="op" id="2453562">)</span>&nbsp;<span class="ident" id="2453564">Close</span><span class="op" id="2453569">(</span><span class="op" id="2453570">)</span>&nbsp;<span class="builtintype" id="2453572">error</span>&nbsp;<span class="op" id="2453578">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453581">if</span>&nbsp;<span class="ident" id="2453584"><a href="/os/file_unix.go.html#2453555">f</a></span>&nbsp;<span class="op" id="2453586">==</span>&nbsp;<span class="ident" id="2453589">nil</span>&nbsp;<span class="op" id="2453593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453597">return</span>&nbsp;<span class="ident" id="2453604"><a href="/os/error.go.html#2429601">ErrInvalid</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2453616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453619">return</span>&nbsp;<span class="ident" id="2453626"><a href="/os/file_unix.go.html#2453555">f</a></span><span class="op" id="2453627">.</span><span class="ident" id="2453628">file</span><span class="op" id="2453632">.</span><span class="builtinfunc" id="2453633">close</span><span class="op" id="2453638">(</span><span class="op" id="2453639">)</span><br>
<span class="lineno"></span><span class="op" id="2453641">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2453644">func</span>&nbsp;<span class="op" id="2453649">(</span><span class="ident" id="2453650">file</span>&nbsp;<span class="op" id="2453655">*</span><span class="ident" id="2453656"><a href="/os/file_unix.go.html#2451478">file</a></span><span class="op" id="2453660">)</span>&nbsp;<span class="builtinfunc" id="2453662">close</span><span class="op" id="2453667">(</span><span class="op" id="2453668">)</span>&nbsp;<span class="builtintype" id="2453670">error</span>&nbsp;<span class="op" id="2453676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453679">if</span>&nbsp;<span class="ident" id="2453682"><a href="/os/file_unix.go.html#2453650">file</a></span>&nbsp;<span class="op" id="2453687">==</span>&nbsp;<span class="ident" id="2453690">nil</span>&nbsp;<span class="op" id="2453694">||</span>&nbsp;<span class="ident" id="2453697"><a href="/os/file_unix.go.html#2453650">file</a></span><span class="op" id="2453701">.</span><span class="ident" id="2453702">fd</span>&nbsp;<span class="op" id="2453705">&lt;</span>&nbsp;<span class="num" id="2453707">0</span>&nbsp;<span class="op" id="2453709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453713">return</span>&nbsp;<span class="ident" id="2453720"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2453727">.</span><span class="ident" id="2453728">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2453736">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453739">var</span>&nbsp;<span class="ident" id="2453743">err</span>&nbsp;<span class="builtintype" id="2453747">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453754">if</span>&nbsp;<span class="ident" id="2453757">e</span>&nbsp;<span class="op" id="2453759">:=</span>&nbsp;<span class="ident" id="2453762"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2453769">.</span><span class="ident" id="2453770">Close</span><span class="op" id="2453775">(</span><span class="ident" id="2453776"><a href="/os/file_unix.go.html#2453650">file</a></span><span class="op" id="2453780">.</span><span class="ident" id="2453781">fd</span><span class="op" id="2453783">)</span><span class="op" id="2453784">;</span>&nbsp;<span class="ident" id="2453786"><a href="/os/file_unix.go.html#2453757">e</a></span>&nbsp;<span class="op" id="2453788">!=</span>&nbsp;<span class="ident" id="2453791">nil</span>&nbsp;<span class="op" id="2453795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453799"><a href="/os/file_unix.go.html#2453743">err</a></span>&nbsp;<span class="op" id="2453803">=</span>&nbsp;<span class="op" id="2453805">&amp;</span><span class="ident" id="2453806"><a href="/os/error.go.html#2429885">PathError</a></span><span class="op" id="2453815">{</span><span class="string" id="2453816">&#34;close&#34;</span><span class="op" id="2453823">,</span>&nbsp;<span class="ident" id="2453825"><a href="/os/file_unix.go.html#2453650">file</a></span><span class="op" id="2453829">.</span><span class="ident" id="2453830">name</span><span class="op" id="2453834">,</span>&nbsp;<span class="ident" id="2453836"><a href="/os/file_unix.go.html#2453757">e</a></span><span class="op" id="2453837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2453840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453843"><a href="/os/file_unix.go.html#2453650">file</a></span><span class="op" id="2453847">.</span><span class="ident" id="2453848">fd</span>&nbsp;<span class="op" id="2453851">=</span>&nbsp;<span class="op" id="2453853">-</span><span class="num" id="2453854">1</span>&nbsp;<span class="comment" id="2453856">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2453889">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2453925"><a href="/os/file_unix.go.html#2451153">runtime</a></span><span class="op" id="2453932">.</span><span class="ident" id="2453933">SetFinalizer</span><span class="op" id="2453945">(</span><span class="ident" id="2453946"><a href="/os/file_unix.go.html#2453650">file</a></span><span class="op" id="2453950">,</span>&nbsp;<span class="ident" id="2453952">nil</span><span class="op" id="2453955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2453958">return</span>&nbsp;<span class="ident" id="2453965"><a href="/os/file_unix.go.html#2453743">err</a></span><br>
<span class="lineno"></span><span class="op" id="2453969">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2453972">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2454028">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2454084">func</span>&nbsp;<span class="op" id="2454089">(</span><span class="ident" id="2454090">f</span>&nbsp;<span class="op" id="2454092">*</span><span class="ident" id="2454093"><a href="/os/file_unix.go.html#2451241">File</a></span><span class="op" id="2454097">)</span>&nbsp;<span class="ident" id="2454099">Stat</span><span class="op" id="2454103">(</span><span class="op" id="2454104">)</span>&nbsp;<span class="op" id="2454106">(</span><span class="ident" id="2454107">fi</span>&nbsp;<span class="ident" id="2454110"><a href="/os/types.go.html#2471413">FileInfo</a></span><span class="op" id="2454118">,</span>&nbsp;<span class="ident" id="2454120">err</span>&nbsp;<span class="builtintype" id="2454124">error</span><span class="op" id="2454129">)</span>&nbsp;<span class="op" id="2454131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2454134">if</span>&nbsp;<span class="ident" id="2454137"><a href="/os/file_unix.go.html#2454090">f</a></span>&nbsp;<span class="op" id="2454139">==</span>&nbsp;<span class="ident" id="2454142">nil</span>&nbsp;<span class="op" id="2454146">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2454150">return</span>&nbsp;<span class="ident" id="2454157">nil</span><span class="op" id="2454160">,</span>&nbsp;<span class="ident" id="2454162"><a href="/os/error.go.html#2429601">ErrInvalid</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2454174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2454177">var</span>&nbsp;<span class="ident" id="2454181">stat</span>&nbsp;<span class="ident" id="2454186"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2454193">.</span><span class="ident" id="2454194">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2454202"><a href="/os/file_unix.go.html#2454120">err</a></span>&nbsp;<span class="op" id="2454206">=</span>&nbsp;<span class="ident" id="2454208"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2454215">.</span><span class="ident" id="2454216">Fstat</span><span class="op" id="2454221">(</span><span class="ident" id="2454222"><a href="/os/file_unix.go.html#2454090">f</a></span><span class="op" id="2454223">.</span><span class="ident" id="2454224">fd</span><span class="op" id="2454226">,</span>&nbsp;<span class="op" id="2454228">&amp;</span><span class="ident" id="2454229"><a href="/os/file_unix.go.html#2454181">stat</a></span><span class="op" id="2454233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2454236">if</span>&nbsp;<span class="ident" id="2454239"><a href="/os/file_unix.go.html#2454120">err</a></span>&nbsp;<span class="op" id="2454243">!=</span>&nbsp;<span class="ident" id="2454246">nil</span>&nbsp;<span class="op" id="2454250">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2454254">return</span>&nbsp;<span class="ident" id="2454261">nil</span><span class="op" id="2454264">,</span>&nbsp;<span class="op" id="2454266">&amp;</span><span class="ident" id="2454267"><a href="/os/error.go.html#2429885">PathError</a></span><span class="op" id="2454276">{</span><span class="string" id="2454277">&#34;stat&#34;</span><span class="op" id="2454283">,</span>&nbsp;<span class="ident" id="2454285"><a href="/os/file_unix.go.html#2454090">f</a></span><span class="op" id="2454286">.</span><span class="ident" id="2454287">name</span><span class="op" id="2454291">,</span>&nbsp;<span class="ident" id="2454293"><a href="/os/file_unix.go.html#2454120">err</a></span><span class="op" id="2454296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2454299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2454302">return</span>&nbsp;<span class="ident" id="2454309"><a href="/os/stat_linux.go.html#2469139">fileInfoFromStat</a></span><span class="op" id="2454325">(</span><span class="op" id="2454326">&amp;</span><span class="ident" id="2454327"><a href="/os/file_unix.go.html#2454181">stat</a></span><span class="op" id="2454331">,</span>&nbsp;<span class="ident" id="2454333"><a href="/os/file_unix.go.html#2454090">f</a></span><span class="op" id="2454334">.</span><span class="ident" id="2454335">name</span><span class="op" id="2454339">)</span><span class="op" id="2454340">,</span>&nbsp;<span class="ident" id="2454342">nil</span><br>
<span class="lineno"></span><span class="op" id="2454346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2454349">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2454403">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2454459">func</span>&nbsp;<span class="ident" id="2454464">Stat</span><span class="op" id="2454468">(</span><span class="ident" id="2454469">name</span>&nbsp;<span class="builtintype" id="2454474">string</span><span class="op" id="2454480">)</span>&nbsp;<span class="op" id="2454482">(</span><span class="ident" id="2454483">fi</span>&nbsp;<span class="ident" id="2454486"><a href="/os/types.go.html#2471413">FileInfo</a></span><span class="op" id="2454494">,</span>&nbsp;<span class="ident" id="2454496">err</span>&nbsp;<span class="builtintype" id="2454500">error</span><span class="op" id="2454505">)</span>&nbsp;<span class="op" id="2454507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2454510">var</span>&nbsp;<span class="ident" id="2454514">stat</span>&nbsp;<span class="ident" id="2454519"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2454526">.</span><span class="ident" id="2454527">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2454535"><a href="/os/file_unix.go.html#2454496">err</a></span>&nbsp;<span class="op" id="2454539">=</span>&nbsp;<span class="ident" id="2454541"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2454548">.</span><span class="ident" id="2454549">Stat</span><span class="op" id="2454553">(</span><span class="ident" id="2454554"><a href="/os/file_unix.go.html#2454469">name</a></span><span class="op" id="2454558">,</span>&nbsp;<span class="op" id="2454560">&amp;</span><span class="ident" id="2454561"><a href="/os/file_unix.go.html#2454514">stat</a></span><span class="op" id="2454565">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2454568">if</span>&nbsp;<span class="ident" id="2454571"><a href="/os/file_unix.go.html#2454496">err</a></span>&nbsp;<span class="op" id="2454575">!=</span>&nbsp;<span class="ident" id="2454578">nil</span>&nbsp;<span class="op" id="2454582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2454586">return</span>&nbsp;<span class="ident" id="2454593">nil</span><span class="op" id="2454596">,</span>&nbsp;<span class="op" id="2454598">&amp;</span><span class="ident" id="2454599"><a href="/os/error.go.html#2429885">PathError</a></span><span class="op" id="2454608">{</span><span class="string" id="2454609">&#34;stat&#34;</span><span class="op" id="2454615">,</span>&nbsp;<span class="ident" id="2454617"><a href="/os/file_unix.go.html#2454469">name</a></span><span class="op" id="2454621">,</span>&nbsp;<span class="ident" id="2454623"><a href="/os/file_unix.go.html#2454496">err</a></span><span class="op" id="2454626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2454629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2454632">return</span>&nbsp;<span class="ident" id="2454639"><a href="/os/stat_linux.go.html#2469139">fileInfoFromStat</a></span><span class="op" id="2454655">(</span><span class="op" id="2454656">&amp;</span><span class="ident" id="2454657"><a href="/os/file_unix.go.html#2454514">stat</a></span><span class="op" id="2454661">,</span>&nbsp;<span class="ident" id="2454663"><a href="/os/file_unix.go.html#2454469">name</a></span><span class="op" id="2454667">)</span><span class="op" id="2454668">,</span>&nbsp;<span class="ident" id="2454670">nil</span><br>
<span class="lineno"></span><span class="op" id="2454674">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2454677">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2454732">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2454789">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2454865">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2454921">func</span>&nbsp;<span class="ident" id="2454926">Lstat</span><span class="op" id="2454931">(</span><span class="ident" id="2454932">name</span>&nbsp;<span class="builtintype" id="2454937">string</span><span class="op" id="2454943">)</span>&nbsp;<span class="op" id="2454945">(</span><span class="ident" id="2454946">fi</span>&nbsp;<span class="ident" id="2454949"><a href="/os/types.go.html#2471413">FileInfo</a></span><span class="op" id="2454957">,</span>&nbsp;<span class="ident" id="2454959">err</span>&nbsp;<span class="builtintype" id="2454963">error</span><span class="op" id="2454968">)</span>&nbsp;<span class="op" id="2454970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2454973">var</span>&nbsp;<span class="ident" id="2454977">stat</span>&nbsp;<span class="ident" id="2454982"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2454989">.</span><span class="ident" id="2454990">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2454998"><a href="/os/file_unix.go.html#2454959">err</a></span>&nbsp;<span class="op" id="2455002">=</span>&nbsp;<span class="ident" id="2455004"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2455011">.</span><span class="ident" id="2455012">Lstat</span><span class="op" id="2455017">(</span><span class="ident" id="2455018"><a href="/os/file_unix.go.html#2454932">name</a></span><span class="op" id="2455022">,</span>&nbsp;<span class="op" id="2455024">&amp;</span><span class="ident" id="2455025"><a href="/os/file_unix.go.html#2454977">stat</a></span><span class="op" id="2455029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2455032">if</span>&nbsp;<span class="ident" id="2455035"><a href="/os/file_unix.go.html#2454959">err</a></span>&nbsp;<span class="op" id="2455039">!=</span>&nbsp;<span class="ident" id="2455042">nil</span>&nbsp;<span class="op" id="2455046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2455050">return</span>&nbsp;<span class="ident" id="2455057">nil</span><span class="op" id="2455060">,</span>&nbsp;<span class="op" id="2455062">&amp;</span><span class="ident" id="2455063"><a href="/os/error.go.html#2429885">PathError</a></span><span class="op" id="2455072">{</span><span class="string" id="2455073">&#34;lstat&#34;</span><span class="op" id="2455080">,</span>&nbsp;<span class="ident" id="2455082"><a href="/os/file_unix.go.html#2454932">name</a></span><span class="op" id="2455086">,</span>&nbsp;<span class="ident" id="2455088"><a href="/os/file_unix.go.html#2454959">err</a></span><span class="op" id="2455091">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2455094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2455097">return</span>&nbsp;<span class="ident" id="2455104"><a href="/os/stat_linux.go.html#2469139">fileInfoFromStat</a></span><span class="op" id="2455120">(</span><span class="op" id="2455121">&amp;</span><span class="ident" id="2455122"><a href="/os/file_unix.go.html#2454977">stat</a></span><span class="op" id="2455126">,</span>&nbsp;<span class="ident" id="2455128"><a href="/os/file_unix.go.html#2454932">name</a></span><span class="op" id="2455132">)</span><span class="op" id="2455133">,</span>&nbsp;<span class="ident" id="2455135">nil</span><br>
<span class="lineno"></span><span class="op" id="2455139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2455142">func</span>&nbsp;<span class="op" id="2455147">(</span><span class="ident" id="2455148">f</span>&nbsp;<span class="op" id="2455150">*</span><span class="ident" id="2455151"><a href="/os/file_unix.go.html#2451241">File</a></span><span class="op" id="2455155">)</span>&nbsp;<span class="ident" id="2455157">readdir</span><span class="op" id="2455164">(</span><span class="ident" id="2455165">n</span>&nbsp;<span class="builtintype" id="2455167">int</span><span class="op" id="2455170">)</span>&nbsp;<span class="op" id="2455172">(</span><span class="ident" id="2455173">fi</span>&nbsp;<span class="op" id="2455176">[</span><span class="op" id="2455177">]</span><span class="ident" id="2455178"><a href="/os/types.go.html#2471413">FileInfo</a></span><span class="op" id="2455186">,</span>&nbsp;<span class="ident" id="2455188">err</span>&nbsp;<span class="builtintype" id="2455192">error</span><span class="op" id="2455197">)</span>&nbsp;<span class="op" id="2455199">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2455202">dirname</span>&nbsp;<span class="op" id="2455210">:=</span>&nbsp;<span class="ident" id="2455213"><a href="/os/file_unix.go.html#2455148">f</a></span><span class="op" id="2455214">.</span><span class="ident" id="2455215">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2455221">if</span>&nbsp;<span class="ident" id="2455224"><a href="/os/file_unix.go.html#2455202">dirname</a></span>&nbsp;<span class="op" id="2455232">==</span>&nbsp;<span class="string" id="2455235">&#34;&#34;</span>&nbsp;<span class="op" id="2455238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2455242"><a href="/os/file_unix.go.html#2455202">dirname</a></span>&nbsp;<span class="op" id="2455250">=</span>&nbsp;<span class="string" id="2455252">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2455257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2455260">names</span><span class="op" id="2455265">,</span>&nbsp;<span class="ident" id="2455267"><a href="/os/file_unix.go.html#2455188">err</a></span>&nbsp;<span class="op" id="2455271">:=</span>&nbsp;<span class="ident" id="2455274"><a href="/os/file_unix.go.html#2455148">f</a></span><span class="op" id="2455275">.</span><span class="ident" id="2455276">Readdirnames</span><span class="op" id="2455288">(</span><span class="ident" id="2455289"><a href="/os/file_unix.go.html#2455165">n</a></span><span class="op" id="2455290">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2455293"><a href="/os/file_unix.go.html#2455173">fi</a></span>&nbsp;<span class="op" id="2455296">=</span>&nbsp;<span class="builtinfunc" id="2455298">make</span><span class="op" id="2455302">(</span><span class="op" id="2455303">[</span><span class="op" id="2455304">]</span><span class="ident" id="2455305"><a href="/os/types.go.html#2471413">FileInfo</a></span><span class="op" id="2455313">,</span>&nbsp;<span class="num" id="2455315">0</span><span class="op" id="2455316">,</span>&nbsp;<span class="builtinfunc" id="2455318">len</span><span class="op" id="2455321">(</span><span class="ident" id="2455322"><a href="/os/file_unix.go.html#2455260">names</a></span><span class="op" id="2455327">)</span><span class="op" id="2455328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2455331">for</span>&nbsp;<span class="ident" id="2455335">_</span><span class="op" id="2455336">,</span>&nbsp;<span class="ident" id="2455338">filename</span>&nbsp;<span class="op" id="2455347">:=</span>&nbsp;<span class="keyword" id="2455350">range</span>&nbsp;<span class="ident" id="2455356"><a href="/os/file_unix.go.html#2455260">names</a></span>&nbsp;<span class="op" id="2455362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2455366">fip</span><span class="op" id="2455369">,</span>&nbsp;<span class="ident" id="2455371">lerr</span>&nbsp;<span class="op" id="2455376">:=</span>&nbsp;<span class="ident" id="2455379"><a href="/os/file.go.html#2446318">lstat</a></span><span class="op" id="2455384">(</span><span class="ident" id="2455385"><a href="/os/file_unix.go.html#2455202">dirname</a></span>&nbsp;<span class="op" id="2455393">+</span>&nbsp;<span class="string" id="2455395">&#34;/&#34;</span>&nbsp;<span class="op" id="2455399">+</span>&nbsp;<span class="ident" id="2455401"><a href="/os/file_unix.go.html#2455338">filename</a></span><span class="op" id="2455409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2455413">if</span>&nbsp;<span class="ident" id="2455416"><a href="/os/error.go.html#2430982">IsNotExist</a></span><span class="op" id="2455426">(</span><span class="ident" id="2455427"><a href="/os/file_unix.go.html#2455371">lerr</a></span><span class="op" id="2455431">)</span>&nbsp;<span class="op" id="2455433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2455438">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2455485">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2455528">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2455539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2455543">if</span>&nbsp;<span class="ident" id="2455546"><a href="/os/file_unix.go.html#2455371">lerr</a></span>&nbsp;<span class="op" id="2455551">!=</span>&nbsp;<span class="ident" id="2455554">nil</span>&nbsp;<span class="op" id="2455558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2455563">return</span>&nbsp;<span class="ident" id="2455570"><a href="/os/file_unix.go.html#2455173">fi</a></span><span class="op" id="2455572">,</span>&nbsp;<span class="ident" id="2455574"><a href="/os/file_unix.go.html#2455371">lerr</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2455581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2455585"><a href="/os/file_unix.go.html#2455173">fi</a></span>&nbsp;<span class="op" id="2455588">=</span>&nbsp;<span class="builtinfunc" id="2455590">append</span><span class="op" id="2455596">(</span><span class="ident" id="2455597"><a href="/os/file_unix.go.html#2455173">fi</a></span><span class="op" id="2455599">,</span>&nbsp;<span class="ident" id="2455601"><a href="/os/file_unix.go.html#2455366">fip</a></span><span class="op" id="2455604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2455607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2455610">return</span>&nbsp;<span class="ident" id="2455617"><a href="/os/file_unix.go.html#2455173">fi</a></span><span class="op" id="2455619">,</span>&nbsp;<span class="ident" id="2455621"><a href="/os/file_unix.go.html#2455188">err</a></span><br>
<span class="lineno"></span><span class="op" id="2455625">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2455628">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2455686">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2455740">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2455794">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2455812">const</span>&nbsp;<span class="op" id="2455818">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2455821">needsMaxRW</span>&nbsp;<span class="op" id="2455832">=</span>&nbsp;<span class="ident" id="2455834"><a href="/os/file_unix.go.html#2451153">runtime</a></span><span class="op" id="2455841">.</span><span class="ident" id="2455842">GOOS</span>&nbsp;<span class="op" id="2455847">==</span>&nbsp;<span class="string" id="2455850">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2455859">||</span>&nbsp;<span class="ident" id="2455862"><a href="/os/file_unix.go.html#2451153">runtime</a></span><span class="op" id="2455869">.</span><span class="ident" id="2455870">GOOS</span>&nbsp;<span class="op" id="2455875">==</span>&nbsp;<span class="string" id="2455878">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2455889">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2455900">=</span>&nbsp;<span class="num" id="2455902">1</span>&nbsp;<span class="op" id="2455904">&lt;&lt;</span>&nbsp;<span class="num" id="2455907">30</span><br>
<span class="lineno"></span><span class="op" id="2455910">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2455913">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2455961">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2456022">func</span>&nbsp;<span class="op" id="2456027">(</span><span class="ident" id="2456028">f</span>&nbsp;<span class="op" id="2456030">*</span><span class="ident" id="2456031"><a href="/os/file_unix.go.html#2451241">File</a></span><span class="op" id="2456035">)</span>&nbsp;<span class="ident" id="2456037">read</span><span class="op" id="2456041">(</span><span class="ident" id="2456042">b</span>&nbsp;<span class="op" id="2456044">[</span><span class="op" id="2456045">]</span><span class="builtintype" id="2456046">byte</span><span class="op" id="2456050">)</span>&nbsp;<span class="op" id="2456052">(</span><span class="ident" id="2456053">n</span>&nbsp;<span class="builtintype" id="2456055">int</span><span class="op" id="2456058">,</span>&nbsp;<span class="ident" id="2456060">err</span>&nbsp;<span class="builtintype" id="2456064">error</span><span class="op" id="2456069">)</span>&nbsp;<span class="op" id="2456071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2456074">if</span>&nbsp;<span class="ident" id="2456077"><a href="/os/file_unix.go.html#2455821">needsMaxRW</a></span>&nbsp;<span class="op" id="2456088">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2456091">len</span><span class="op" id="2456094">(</span><span class="ident" id="2456095"><a href="/os/file_unix.go.html#2456042">b</a></span><span class="op" id="2456096">)</span>&nbsp;<span class="op" id="2456098">&gt;</span>&nbsp;<span class="ident" id="2456100"><a href="/os/file_unix.go.html#2455889">maxRW</a></span>&nbsp;<span class="op" id="2456106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2456110"><a href="/os/file_unix.go.html#2456042">b</a></span>&nbsp;<span class="op" id="2456112">=</span>&nbsp;<span class="ident" id="2456114"><a href="/os/file_unix.go.html#2456042">b</a></span><span class="op" id="2456115">[</span><span class="op" id="2456116">:</span><span class="ident" id="2456117"><a href="/os/file_unix.go.html#2455889">maxRW</a></span><span class="op" id="2456122">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2456125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2456128">return</span>&nbsp;<span class="ident" id="2456135"><a href="/os/file.go.html#2446627">fixCount</a></span><span class="op" id="2456143">(</span><span class="ident" id="2456144"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2456151">.</span><span class="ident" id="2456152">Read</span><span class="op" id="2456156">(</span><span class="ident" id="2456157"><a href="/os/file_unix.go.html#2456028">f</a></span><span class="op" id="2456158">.</span><span class="ident" id="2456159">fd</span><span class="op" id="2456161">,</span>&nbsp;<span class="ident" id="2456163"><a href="/os/file_unix.go.html#2456042">b</a></span><span class="op" id="2456164">)</span><span class="op" id="2456165">)</span><br>
<span class="lineno"></span><span class="op" id="2456167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2456170">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2456241">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2456303">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2456359">func</span>&nbsp;<span class="op" id="2456364">(</span><span class="ident" id="2456365">f</span>&nbsp;<span class="op" id="2456367">*</span><span class="ident" id="2456368"><a href="/os/file_unix.go.html#2451241">File</a></span><span class="op" id="2456372">)</span>&nbsp;<span class="ident" id="2456374">pread</span><span class="op" id="2456379">(</span><span class="ident" id="2456380">b</span>&nbsp;<span class="op" id="2456382">[</span><span class="op" id="2456383">]</span><span class="builtintype" id="2456384">byte</span><span class="op" id="2456388">,</span>&nbsp;<span class="ident" id="2456390">off</span>&nbsp;<span class="ident" id="2456394">int64</span><span class="op" id="2456399">)</span>&nbsp;<span class="op" id="2456401">(</span><span class="ident" id="2456402">n</span>&nbsp;<span class="builtintype" id="2456404">int</span><span class="op" id="2456407">,</span>&nbsp;<span class="ident" id="2456409">err</span>&nbsp;<span class="builtintype" id="2456413">error</span><span class="op" id="2456418">)</span>&nbsp;<span class="op" id="2456420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2456423">if</span>&nbsp;<span class="ident" id="2456426"><a href="/os/file_unix.go.html#2455821">needsMaxRW</a></span>&nbsp;<span class="op" id="2456437">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2456440">len</span><span class="op" id="2456443">(</span><span class="ident" id="2456444"><a href="/os/file_unix.go.html#2456380">b</a></span><span class="op" id="2456445">)</span>&nbsp;<span class="op" id="2456447">&gt;</span>&nbsp;<span class="ident" id="2456449"><a href="/os/file_unix.go.html#2455889">maxRW</a></span>&nbsp;<span class="op" id="2456455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2456459"><a href="/os/file_unix.go.html#2456380">b</a></span>&nbsp;<span class="op" id="2456461">=</span>&nbsp;<span class="ident" id="2456463"><a href="/os/file_unix.go.html#2456380">b</a></span><span class="op" id="2456464">[</span><span class="op" id="2456465">:</span><span class="ident" id="2456466"><a href="/os/file_unix.go.html#2455889">maxRW</a></span><span class="op" id="2456471">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2456474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2456477">return</span>&nbsp;<span class="ident" id="2456484"><a href="/os/file.go.html#2446627">fixCount</a></span><span class="op" id="2456492">(</span><span class="ident" id="2456493"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2456500">.</span><span class="ident" id="2456501">Pread</span><span class="op" id="2456506">(</span><span class="ident" id="2456507"><a href="/os/file_unix.go.html#2456365">f</a></span><span class="op" id="2456508">.</span><span class="ident" id="2456509">fd</span><span class="op" id="2456511">,</span>&nbsp;<span class="ident" id="2456513"><a href="/os/file_unix.go.html#2456380">b</a></span><span class="op" id="2456514">,</span>&nbsp;<span class="ident" id="2456516"><a href="/os/file_unix.go.html#2456390">off</a></span><span class="op" id="2456519">)</span><span class="op" id="2456520">)</span><br>
<span class="lineno"></span><span class="op" id="2456522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2456525">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2456567">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2456631">func</span>&nbsp;<span class="op" id="2456636">(</span><span class="ident" id="2456637">f</span>&nbsp;<span class="op" id="2456639">*</span><span class="ident" id="2456640"><a href="/os/file_unix.go.html#2451241">File</a></span><span class="op" id="2456644">)</span>&nbsp;<span class="ident" id="2456646">write</span><span class="op" id="2456651">(</span><span class="ident" id="2456652">b</span>&nbsp;<span class="op" id="2456654">[</span><span class="op" id="2456655">]</span><span class="builtintype" id="2456656">byte</span><span class="op" id="2456660">)</span>&nbsp;<span class="op" id="2456662">(</span><span class="ident" id="2456663">n</span>&nbsp;<span class="builtintype" id="2456665">int</span><span class="op" id="2456668">,</span>&nbsp;<span class="ident" id="2456670">err</span>&nbsp;<span class="builtintype" id="2456674">error</span><span class="op" id="2456679">)</span>&nbsp;<span class="op" id="2456681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2456684">for</span>&nbsp;<span class="op" id="2456688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2456692">bcap</span>&nbsp;<span class="op" id="2456697">:=</span>&nbsp;<span class="ident" id="2456700"><a href="/os/file_unix.go.html#2456652">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2456704">if</span>&nbsp;<span class="ident" id="2456707"><a href="/os/file_unix.go.html#2455821">needsMaxRW</a></span>&nbsp;<span class="op" id="2456718">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2456721">len</span><span class="op" id="2456724">(</span><span class="ident" id="2456725"><a href="/os/file_unix.go.html#2456692">bcap</a></span><span class="op" id="2456729">)</span>&nbsp;<span class="op" id="2456731">&gt;</span>&nbsp;<span class="ident" id="2456733"><a href="/os/file_unix.go.html#2455889">maxRW</a></span>&nbsp;<span class="op" id="2456739">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2456744"><a href="/os/file_unix.go.html#2456692">bcap</a></span>&nbsp;<span class="op" id="2456749">=</span>&nbsp;<span class="ident" id="2456751"><a href="/os/file_unix.go.html#2456692">bcap</a></span><span class="op" id="2456755">[</span><span class="op" id="2456756">:</span><span class="ident" id="2456757"><a href="/os/file_unix.go.html#2455889">maxRW</a></span><span class="op" id="2456762">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2456766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2456770">m</span><span class="op" id="2456771">,</span>&nbsp;<span class="ident" id="2456773">err</span>&nbsp;<span class="op" id="2456777">:=</span>&nbsp;<span class="ident" id="2456780"><a href="/os/file.go.html#2446627">fixCount</a></span><span class="op" id="2456788">(</span><span class="ident" id="2456789"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2456796">.</span><span class="ident" id="2456797">Write</span><span class="op" id="2456802">(</span><span class="ident" id="2456803"><a href="/os/file_unix.go.html#2456637">f</a></span><span class="op" id="2456804">.</span><span class="ident" id="2456805">fd</span><span class="op" id="2456807">,</span>&nbsp;<span class="ident" id="2456809"><a href="/os/file_unix.go.html#2456692">bcap</a></span><span class="op" id="2456813">)</span><span class="op" id="2456814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2456818"><a href="/os/file_unix.go.html#2456663">n</a></span>&nbsp;<span class="op" id="2456820">+=</span>&nbsp;<span class="ident" id="2456823"><a href="/os/file_unix.go.html#2456770">m</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2456828">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2456890">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2456950">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2457016">if</span>&nbsp;<span class="num" id="2457019">0</span>&nbsp;<span class="op" id="2457021">&lt;</span>&nbsp;<span class="ident" id="2457023"><a href="/os/file_unix.go.html#2456770">m</a></span>&nbsp;<span class="op" id="2457025">&amp;&amp;</span>&nbsp;<span class="ident" id="2457028"><a href="/os/file_unix.go.html#2456770">m</a></span>&nbsp;<span class="op" id="2457030">&lt;</span>&nbsp;<span class="builtinfunc" id="2457032">len</span><span class="op" id="2457035">(</span><span class="ident" id="2457036"><a href="/os/file_unix.go.html#2456692">bcap</a></span><span class="op" id="2457040">)</span>&nbsp;<span class="op" id="2457042">||</span>&nbsp;<span class="ident" id="2457045"><a href="/os/file_unix.go.html#2456773">err</a></span>&nbsp;<span class="op" id="2457049">==</span>&nbsp;<span class="ident" id="2457052"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2457059">.</span><span class="ident" id="2457060">EINTR</span>&nbsp;<span class="op" id="2457066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2457071"><a href="/os/file_unix.go.html#2456652">b</a></span>&nbsp;<span class="op" id="2457073">=</span>&nbsp;<span class="ident" id="2457075"><a href="/os/file_unix.go.html#2456652">b</a></span><span class="op" id="2457076">[</span><span class="ident" id="2457077"><a href="/os/file_unix.go.html#2456770">m</a></span><span class="op" id="2457078">:</span><span class="op" id="2457079">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2457084">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2457095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2457100">if</span>&nbsp;<span class="ident" id="2457103"><a href="/os/file_unix.go.html#2455821">needsMaxRW</a></span>&nbsp;<span class="op" id="2457114">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2457117">len</span><span class="op" id="2457120">(</span><span class="ident" id="2457121"><a href="/os/file_unix.go.html#2456692">bcap</a></span><span class="op" id="2457125">)</span>&nbsp;<span class="op" id="2457127">!=</span>&nbsp;<span class="builtinfunc" id="2457130">len</span><span class="op" id="2457133">(</span><span class="ident" id="2457134"><a href="/os/file_unix.go.html#2456652">b</a></span><span class="op" id="2457135">)</span>&nbsp;<span class="op" id="2457137">&amp;&amp;</span>&nbsp;<span class="ident" id="2457140"><a href="/os/file_unix.go.html#2456773">err</a></span>&nbsp;<span class="op" id="2457144">==</span>&nbsp;<span class="ident" id="2457147">nil</span>&nbsp;<span class="op" id="2457151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2457156"><a href="/os/file_unix.go.html#2456652">b</a></span>&nbsp;<span class="op" id="2457158">=</span>&nbsp;<span class="ident" id="2457160"><a href="/os/file_unix.go.html#2456652">b</a></span><span class="op" id="2457161">[</span><span class="ident" id="2457162"><a href="/os/file_unix.go.html#2456770">m</a></span><span class="op" id="2457163">:</span><span class="op" id="2457164">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2457169">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2457180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2457185">return</span>&nbsp;<span class="ident" id="2457192"><a href="/os/file_unix.go.html#2456663">n</a></span><span class="op" id="2457193">,</span>&nbsp;<span class="ident" id="2457195"><a href="/os/file_unix.go.html#2456773">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2457200">}</span><br>
<span class="lineno">230</span><span class="op" id="2457202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2457205">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2457276">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2457340">func</span>&nbsp;<span class="op" id="2457345">(</span><span class="ident" id="2457346">f</span>&nbsp;<span class="op" id="2457348">*</span><span class="ident" id="2457349"><a href="/os/file_unix.go.html#2451241">File</a></span><span class="op" id="2457353">)</span>&nbsp;<span class="ident" id="2457355">pwrite</span><span class="op" id="2457361">(</span><span class="ident" id="2457362">b</span>&nbsp;<span class="op" id="2457364">[</span><span class="op" id="2457365">]</span><span class="builtintype" id="2457366">byte</span><span class="op" id="2457370">,</span>&nbsp;<span class="ident" id="2457372">off</span>&nbsp;<span class="ident" id="2457376">int64</span><span class="op" id="2457381">)</span>&nbsp;<span class="op" id="2457383">(</span><span class="ident" id="2457384">n</span>&nbsp;<span class="builtintype" id="2457386">int</span><span class="op" id="2457389">,</span>&nbsp;<span class="ident" id="2457391">err</span>&nbsp;<span class="builtintype" id="2457395">error</span><span class="op" id="2457400">)</span>&nbsp;<span class="op" id="2457402">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2457405">if</span>&nbsp;<span class="ident" id="2457408"><a href="/os/file_unix.go.html#2455821">needsMaxRW</a></span>&nbsp;<span class="op" id="2457419">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2457422">len</span><span class="op" id="2457425">(</span><span class="ident" id="2457426"><a href="/os/file_unix.go.html#2457362">b</a></span><span class="op" id="2457427">)</span>&nbsp;<span class="op" id="2457429">&gt;</span>&nbsp;<span class="ident" id="2457431"><a href="/os/file_unix.go.html#2455889">maxRW</a></span>&nbsp;<span class="op" id="2457437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2457441"><a href="/os/file_unix.go.html#2457362">b</a></span>&nbsp;<span class="op" id="2457443">=</span>&nbsp;<span class="ident" id="2457445"><a href="/os/file_unix.go.html#2457362">b</a></span><span class="op" id="2457446">[</span><span class="op" id="2457447">:</span><span class="ident" id="2457448"><a href="/os/file_unix.go.html#2455889">maxRW</a></span><span class="op" id="2457453">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2457456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2457459">return</span>&nbsp;<span class="ident" id="2457466"><a href="/os/file.go.html#2446627">fixCount</a></span><span class="op" id="2457474">(</span><span class="ident" id="2457475"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2457482">.</span><span class="ident" id="2457483">Pwrite</span><span class="op" id="2457489">(</span><span class="ident" id="2457490"><a href="/os/file_unix.go.html#2457346">f</a></span><span class="op" id="2457491">.</span><span class="ident" id="2457492">fd</span><span class="op" id="2457494">,</span>&nbsp;<span class="ident" id="2457496"><a href="/os/file_unix.go.html#2457362">b</a></span><span class="op" id="2457497">,</span>&nbsp;<span class="ident" id="2457499"><a href="/os/file_unix.go.html#2457372">off</a></span><span class="op" id="2457502">)</span><span class="op" id="2457503">)</span><br>
<span class="lineno"></span><span class="op" id="2457505">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2457508">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2457590">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2457666">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2457734">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2457785">func</span>&nbsp;<span class="op" id="2457790">(</span><span class="ident" id="2457791">f</span>&nbsp;<span class="op" id="2457793">*</span><span class="ident" id="2457794"><a href="/os/file_unix.go.html#2451241">File</a></span><span class="op" id="2457798">)</span>&nbsp;<span class="ident" id="2457800">seek</span><span class="op" id="2457804">(</span><span class="ident" id="2457805">offset</span>&nbsp;<span class="ident" id="2457812">int64</span><span class="op" id="2457817">,</span>&nbsp;<span class="ident" id="2457819">whence</span>&nbsp;<span class="builtintype" id="2457826">int</span><span class="op" id="2457829">)</span>&nbsp;<span class="op" id="2457831">(</span><span class="ident" id="2457832">ret</span>&nbsp;<span class="ident" id="2457836">int64</span><span class="op" id="2457841">,</span>&nbsp;<span class="ident" id="2457843">err</span>&nbsp;<span class="builtintype" id="2457847">error</span><span class="op" id="2457852">)</span>&nbsp;<span class="op" id="2457854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2457857">return</span>&nbsp;<span class="ident" id="2457864"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2457871">.</span><span class="ident" id="2457872">Seek</span><span class="op" id="2457876">(</span><span class="ident" id="2457877"><a href="/os/file_unix.go.html#2457791">f</a></span><span class="op" id="2457878">.</span><span class="ident" id="2457879">fd</span><span class="op" id="2457881">,</span>&nbsp;<span class="ident" id="2457883"><a href="/os/file_unix.go.html#2457805">offset</a></span><span class="op" id="2457889">,</span>&nbsp;<span class="ident" id="2457891"><a href="/os/file_unix.go.html#2457819">whence</a></span><span class="op" id="2457897">)</span><br>
<span class="lineno"></span><span class="op" id="2457899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2457902">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2457950">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2458027">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2458083">func</span>&nbsp;<span class="ident" id="2458088">Truncate</span><span class="op" id="2458096">(</span><span class="ident" id="2458097">name</span>&nbsp;<span class="builtintype" id="2458102">string</span><span class="op" id="2458108">,</span>&nbsp;<span class="ident" id="2458110">size</span>&nbsp;<span class="ident" id="2458115">int64</span><span class="op" id="2458120">)</span>&nbsp;<span class="builtintype" id="2458122">error</span>&nbsp;<span class="op" id="2458128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2458131">if</span>&nbsp;<span class="ident" id="2458134">e</span>&nbsp;<span class="op" id="2458136">:=</span>&nbsp;<span class="ident" id="2458139"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2458146">.</span><span class="ident" id="2458147">Truncate</span><span class="op" id="2458155">(</span><span class="ident" id="2458156"><a href="/os/file_unix.go.html#2458097">name</a></span><span class="op" id="2458160">,</span>&nbsp;<span class="ident" id="2458162"><a href="/os/file_unix.go.html#2458110">size</a></span><span class="op" id="2458166">)</span><span class="op" id="2458167">;</span>&nbsp;<span class="ident" id="2458169"><a href="/os/file_unix.go.html#2458134">e</a></span>&nbsp;<span class="op" id="2458171">!=</span>&nbsp;<span class="ident" id="2458174">nil</span>&nbsp;<span class="op" id="2458178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2458182">return</span>&nbsp;<span class="op" id="2458189">&amp;</span><span class="ident" id="2458190"><a href="/os/error.go.html#2429885">PathError</a></span><span class="op" id="2458199">{</span><span class="string" id="2458200">&#34;truncate&#34;</span><span class="op" id="2458210">,</span>&nbsp;<span class="ident" id="2458212"><a href="/os/file_unix.go.html#2458097">name</a></span><span class="op" id="2458216">,</span>&nbsp;<span class="ident" id="2458218"><a href="/os/file_unix.go.html#2458134">e</a></span><span class="op" id="2458219">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2458222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2458225">return</span>&nbsp;<span class="ident" id="2458232">nil</span><br>
<span class="lineno"></span><span class="op" id="2458236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2458239">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2458286">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2458342">func</span>&nbsp;<span class="ident" id="2458347">Remove</span><span class="op" id="2458353">(</span><span class="ident" id="2458354">name</span>&nbsp;<span class="builtintype" id="2458359">string</span><span class="op" id="2458365">)</span>&nbsp;<span class="builtintype" id="2458367">error</span>&nbsp;<span class="op" id="2458373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2458376">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2458420">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2458461">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2458505">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2458542">e</span>&nbsp;<span class="op" id="2458544">:=</span>&nbsp;<span class="ident" id="2458547"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2458554">.</span><span class="ident" id="2458555">Unlink</span><span class="op" id="2458561">(</span><span class="ident" id="2458562"><a href="/os/file_unix.go.html#2458354">name</a></span><span class="op" id="2458566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2458569">if</span>&nbsp;<span class="ident" id="2458572"><a href="/os/file_unix.go.html#2458542">e</a></span>&nbsp;<span class="op" id="2458574">==</span>&nbsp;<span class="ident" id="2458577">nil</span>&nbsp;<span class="op" id="2458581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2458585">return</span>&nbsp;<span class="ident" id="2458592">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2458597">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2458600">e1</span>&nbsp;<span class="op" id="2458603">:=</span>&nbsp;<span class="ident" id="2458606"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2458613">.</span><span class="ident" id="2458614">Rmdir</span><span class="op" id="2458619">(</span><span class="ident" id="2458620"><a href="/os/file_unix.go.html#2458354">name</a></span><span class="op" id="2458624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2458627">if</span>&nbsp;<span class="ident" id="2458630"><a href="/os/file_unix.go.html#2458600">e1</a></span>&nbsp;<span class="op" id="2458633">==</span>&nbsp;<span class="ident" id="2458636">nil</span>&nbsp;<span class="op" id="2458640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2458644">return</span>&nbsp;<span class="ident" id="2458651">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2458656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2458660">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2458711">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2458760">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2458809">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2458858">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2458912">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2458963">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2459018">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2459067">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2459098">if</span>&nbsp;<span class="ident" id="2459101"><a href="/os/file_unix.go.html#2458600">e1</a></span>&nbsp;<span class="op" id="2459104">!=</span>&nbsp;<span class="ident" id="2459107"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2459114">.</span><span class="ident" id="2459115">ENOTDIR</span>&nbsp;<span class="op" id="2459123">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2459127"><a href="/os/file_unix.go.html#2458542">e</a></span>&nbsp;<span class="op" id="2459129">=</span>&nbsp;<span class="ident" id="2459131"><a href="/os/file_unix.go.html#2458600">e1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2459135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2459138">return</span>&nbsp;<span class="op" id="2459145">&amp;</span><span class="ident" id="2459146"><a href="/os/error.go.html#2429885">PathError</a></span><span class="op" id="2459155">{</span><span class="string" id="2459156">&#34;remove&#34;</span><span class="op" id="2459164">,</span>&nbsp;<span class="ident" id="2459166"><a href="/os/file_unix.go.html#2458354">name</a></span><span class="op" id="2459170">,</span>&nbsp;<span class="ident" id="2459172"><a href="/os/file_unix.go.html#2458542">e</a></span><span class="op" id="2459173">}</span><br>
<span class="lineno"></span><span class="op" id="2459175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2459178">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2459261">func</span>&nbsp;<span class="ident" id="2459266">basename</span><span class="op" id="2459274">(</span><span class="ident" id="2459275">name</span>&nbsp;<span class="builtintype" id="2459280">string</span><span class="op" id="2459286">)</span>&nbsp;<span class="builtintype" id="2459288">string</span>&nbsp;<span class="op" id="2459295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2459298">i</span>&nbsp;<span class="op" id="2459300">:=</span>&nbsp;<span class="builtinfunc" id="2459303">len</span><span class="op" id="2459306">(</span><span class="ident" id="2459307"><a href="/os/file_unix.go.html#2459275">name</a></span><span class="op" id="2459311">)</span>&nbsp;<span class="op" id="2459313">-</span>&nbsp;<span class="num" id="2459315">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2459318">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2459346">for</span>&nbsp;<span class="op" id="2459350">;</span>&nbsp;<span class="ident" id="2459352"><a href="/os/file_unix.go.html#2459298">i</a></span>&nbsp;<span class="op" id="2459354">&gt;</span>&nbsp;<span class="num" id="2459356">0</span>&nbsp;<span class="op" id="2459358">&amp;&amp;</span>&nbsp;<span class="ident" id="2459361"><a href="/os/file_unix.go.html#2459275">name</a></span><span class="op" id="2459365">[</span><span class="ident" id="2459366"><a href="/os/file_unix.go.html#2459298">i</a></span><span class="op" id="2459367">]</span>&nbsp;<span class="op" id="2459369">==</span>&nbsp;<span class="string" id="2459372">&#39;/&#39;</span><span class="op" id="2459375">;</span>&nbsp;<span class="ident" id="2459377"><a href="/os/file_unix.go.html#2459298">i</a></span><span class="op" id="2459378">--</span>&nbsp;<span class="op" id="2459381">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2459385"><a href="/os/file_unix.go.html#2459275">name</a></span>&nbsp;<span class="op" id="2459390">=</span>&nbsp;<span class="ident" id="2459392"><a href="/os/file_unix.go.html#2459275">name</a></span><span class="op" id="2459396">[</span><span class="op" id="2459397">:</span><span class="ident" id="2459398"><a href="/os/file_unix.go.html#2459298">i</a></span><span class="op" id="2459399">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2459402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2459405">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2459439">for</span>&nbsp;<span class="ident" id="2459443"><a href="/os/file_unix.go.html#2459298">i</a></span><span class="op" id="2459444">--</span><span class="op" id="2459446">;</span>&nbsp;<span class="ident" id="2459448"><a href="/os/file_unix.go.html#2459298">i</a></span>&nbsp;<span class="op" id="2459450">&gt;=</span>&nbsp;<span class="num" id="2459453">0</span><span class="op" id="2459454">;</span>&nbsp;<span class="ident" id="2459456"><a href="/os/file_unix.go.html#2459298">i</a></span><span class="op" id="2459457">--</span>&nbsp;<span class="op" id="2459460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2459464">if</span>&nbsp;<span class="ident" id="2459467"><a href="/os/file_unix.go.html#2459275">name</a></span><span class="op" id="2459471">[</span><span class="ident" id="2459472"><a href="/os/file_unix.go.html#2459298">i</a></span><span class="op" id="2459473">]</span>&nbsp;<span class="op" id="2459475">==</span>&nbsp;<span class="string" id="2459478">&#39;/&#39;</span>&nbsp;<span class="op" id="2459482">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2459487"><a href="/os/file_unix.go.html#2459275">name</a></span>&nbsp;<span class="op" id="2459492">=</span>&nbsp;<span class="ident" id="2459494"><a href="/os/file_unix.go.html#2459275">name</a></span><span class="op" id="2459498">[</span><span class="ident" id="2459499"><a href="/os/file_unix.go.html#2459298">i</a></span><span class="op" id="2459500">+</span><span class="num" id="2459501">1</span><span class="op" id="2459502">:</span><span class="op" id="2459503">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2459508">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2459516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2459519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2459523">return</span>&nbsp;<span class="ident" id="2459530"><a href="/os/file_unix.go.html#2459275">name</a></span><br>
<span class="lineno"></span><span class="op" id="2459535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2459538">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2459607">func</span>&nbsp;<span class="ident" id="2459612">TempDir</span><span class="op" id="2459619">(</span><span class="op" id="2459620">)</span>&nbsp;<span class="builtintype" id="2459622">string</span>&nbsp;<span class="op" id="2459629">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2459632">dir</span>&nbsp;<span class="op" id="2459636">:=</span>&nbsp;<span class="ident" id="2459639"><a href="/os/env.go.html#2428668">Getenv</a></span><span class="op" id="2459645">(</span><span class="string" id="2459646">&#34;TMPDIR&#34;</span><span class="op" id="2459654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2459657">if</span>&nbsp;<span class="ident" id="2459660"><a href="/os/file_unix.go.html#2459632">dir</a></span>&nbsp;<span class="op" id="2459664">==</span>&nbsp;<span class="string" id="2459667">&#34;&#34;</span>&nbsp;<span class="op" id="2459670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2459674">if</span>&nbsp;<span class="ident" id="2459677"><a href="/os/file_unix.go.html#2451153">runtime</a></span><span class="op" id="2459684">.</span><span class="ident" id="2459685">GOOS</span>&nbsp;<span class="op" id="2459690">==</span>&nbsp;<span class="string" id="2459693">&#34;android&#34;</span>&nbsp;<span class="op" id="2459703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2459708"><a href="/os/file_unix.go.html#2459632">dir</a></span>&nbsp;<span class="op" id="2459712">=</span>&nbsp;<span class="string" id="2459714">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2459734">}</span>&nbsp;<span class="keyword" id="2459736">else</span>&nbsp;<span class="op" id="2459741">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2459746"><a href="/os/file_unix.go.html#2459632">dir</a></span>&nbsp;<span class="op" id="2459750">=</span>&nbsp;<span class="string" id="2459752">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2459761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2459764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2459767">return</span>&nbsp;<span class="ident" id="2459774"><a href="/os/file_unix.go.html#2459632">dir</a></span><br>
<span class="lineno"></span><span class="op" id="2459778">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2459781">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2459841">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2459897">func</span>&nbsp;<span class="ident" id="2459902">Link</span><span class="op" id="2459906">(</span><span class="ident" id="2459907">oldname</span><span class="op" id="2459914">,</span>&nbsp;<span class="ident" id="2459916">newname</span>&nbsp;<span class="builtintype" id="2459924">string</span><span class="op" id="2459930">)</span>&nbsp;<span class="builtintype" id="2459932">error</span>&nbsp;<span class="op" id="2459938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2459941">e</span>&nbsp;<span class="op" id="2459943">:=</span>&nbsp;<span class="ident" id="2459946"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2459953">.</span><span class="ident" id="2459954">Link</span><span class="op" id="2459958">(</span><span class="ident" id="2459959"><a href="/os/file_unix.go.html#2459907">oldname</a></span><span class="op" id="2459966">,</span>&nbsp;<span class="ident" id="2459968"><a href="/os/file_unix.go.html#2459916">newname</a></span><span class="op" id="2459975">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2459978">if</span>&nbsp;<span class="ident" id="2459981"><a href="/os/file_unix.go.html#2459941">e</a></span>&nbsp;<span class="op" id="2459983">!=</span>&nbsp;<span class="ident" id="2459986">nil</span>&nbsp;<span class="op" id="2459990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2459994">return</span>&nbsp;<span class="op" id="2460001">&amp;</span><span class="ident" id="2460002"><a href="/os/file.go.html#2441865">LinkError</a></span><span class="op" id="2460011">{</span><span class="string" id="2460012">&#34;link&#34;</span><span class="op" id="2460018">,</span>&nbsp;<span class="ident" id="2460020"><a href="/os/file_unix.go.html#2459907">oldname</a></span><span class="op" id="2460027">,</span>&nbsp;<span class="ident" id="2460029"><a href="/os/file_unix.go.html#2459916">newname</a></span><span class="op" id="2460036">,</span>&nbsp;<span class="ident" id="2460038"><a href="/os/file_unix.go.html#2459941">e</a></span><span class="op" id="2460039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2460042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2460045">return</span>&nbsp;<span class="ident" id="2460052">nil</span><br>
<span class="lineno"></span><span class="op" id="2460056">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2460059">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2460117">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2460173">func</span>&nbsp;<span class="ident" id="2460178">Symlink</span><span class="op" id="2460185">(</span><span class="ident" id="2460186">oldname</span><span class="op" id="2460193">,</span>&nbsp;<span class="ident" id="2460195">newname</span>&nbsp;<span class="builtintype" id="2460203">string</span><span class="op" id="2460209">)</span>&nbsp;<span class="builtintype" id="2460211">error</span>&nbsp;<span class="op" id="2460217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2460220">e</span>&nbsp;<span class="op" id="2460222">:=</span>&nbsp;<span class="ident" id="2460225"><a href="/os/file_unix.go.html#2451179">syscall</a></span><span class="op" id="2460232">.</span><span class="ident" id="2460233">Symlink</span><span class="op" id="2460240">(</span><span class="ident" id="2460241"><a href="/os/file_unix.go.html#2460186">oldname</a></span><span class="op" id="2460248">,</span>&nbsp;<span class="ident" id="2460250"><a href="/os/file_unix.go.html#2460195">newname</a></span><span class="op" id="2460257">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2460260">if</span>&nbsp;<span class="ident" id="2460263"><a href="/os/file_unix.go.html#2460220">e</a></span>&nbsp;<span class="op" id="2460265">!=</span>&nbsp;<span class="ident" id="2460268">nil</span>&nbsp;<span class="op" id="2460272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2460276">return</span>&nbsp;<span class="op" id="2460283">&amp;</span><span class="ident" id="2460284"><a href="/os/file.go.html#2441865">LinkError</a></span><span class="op" id="2460293">{</span><span class="string" id="2460294">&#34;symlink&#34;</span><span class="op" id="2460303">,</span>&nbsp;<span class="ident" id="2460305"><a href="/os/file_unix.go.html#2460186">oldname</a></span><span class="op" id="2460312">,</span>&nbsp;<span class="ident" id="2460314"><a href="/os/file_unix.go.html#2460195">newname</a></span><span class="op" id="2460321">,</span>&nbsp;<span class="ident" id="2460323"><a href="/os/file_unix.go.html#2460220">e</a></span><span class="op" id="2460324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2460327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2460330">return</span>&nbsp;<span class="ident" id="2460337">nil</span><br>
<span class="lineno"></span><span class="op" id="2460341">}</span>
</div>
</body>
</html>
