<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3462960">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3463016">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3463070">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3463121">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3463199">package</span>&nbsp;<span class="ident" id="3463207">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3463212">import</span>&nbsp;<span class="op" id="3463219">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463222">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463233">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3463240">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3463243">func</span>&nbsp;<span class="ident" id="3463248">sockaddrToUDP</span><span class="op" id="3463261">(</span><span class="ident" id="3463262">sa</span>&nbsp;<span class="ident" id="3463265">syscall</span><span class="op" id="3463272">.</span><span class="ident" id="3463273">Sockaddr</span><span class="op" id="3463281">)</span>&nbsp;<span class="ident" id="3463283">Addr</span>&nbsp;<span class="op" id="3463288">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463291">switch</span>&nbsp;<span class="ident" id="3463298">sa</span>&nbsp;<span class="op" id="3463301">:=</span>&nbsp;<span class="ident" id="3463304">sa</span><span class="op" id="3463306">.</span><span class="op" id="3463307">(</span><span class="keyword" id="3463308">type</span><span class="op" id="3463312">)</span>&nbsp;<span class="op" id="3463314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463317">case</span>&nbsp;<span class="op" id="3463322">*</span><span class="ident" id="3463323">syscall</span><span class="op" id="3463330">.</span><span class="ident" id="3463331">SockaddrInet4</span><span class="op" id="3463344">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463348">return</span>&nbsp;<span class="op" id="3463355">&amp;</span><span class="ident" id="3463356">UDPAddr</span><span class="op" id="3463363">{</span><span class="ident" id="3463364">IP</span><span class="op" id="3463366">:</span>&nbsp;<span class="ident" id="3463368">sa</span><span class="op" id="3463370">.</span><span class="ident" id="3463371">Addr</span><span class="op" id="3463375">[</span><span class="num" id="3463376">0</span><span class="op" id="3463377">:</span><span class="op" id="3463378">]</span><span class="op" id="3463379">,</span>&nbsp;<span class="ident" id="3463381">Port</span><span class="op" id="3463385">:</span>&nbsp;<span class="ident" id="3463387">sa</span><span class="op" id="3463389">.</span><span class="ident" id="3463390">Port</span><span class="op" id="3463394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463397">case</span>&nbsp;<span class="op" id="3463402">*</span><span class="ident" id="3463403">syscall</span><span class="op" id="3463410">.</span><span class="ident" id="3463411">SockaddrInet6</span><span class="op" id="3463424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463428">return</span>&nbsp;<span class="op" id="3463435">&amp;</span><span class="ident" id="3463436">UDPAddr</span><span class="op" id="3463443">{</span><span class="ident" id="3463444">IP</span><span class="op" id="3463446">:</span>&nbsp;<span class="ident" id="3463448">sa</span><span class="op" id="3463450">.</span><span class="ident" id="3463451">Addr</span><span class="op" id="3463455">[</span><span class="num" id="3463456">0</span><span class="op" id="3463457">:</span><span class="op" id="3463458">]</span><span class="op" id="3463459">,</span>&nbsp;<span class="ident" id="3463461">Port</span><span class="op" id="3463465">:</span>&nbsp;<span class="ident" id="3463467">sa</span><span class="op" id="3463469">.</span><span class="ident" id="3463470">Port</span><span class="op" id="3463474">,</span>&nbsp;<span class="ident" id="3463476">Zone</span><span class="op" id="3463480">:</span>&nbsp;<span class="ident" id="3463482">zoneToString</span><span class="op" id="3463494">(</span><span class="builtintype" id="3463495">int</span><span class="op" id="3463498">(</span><span class="ident" id="3463499">sa</span><span class="op" id="3463501">.</span><span class="ident" id="3463502">ZoneId</span><span class="op" id="3463508">)</span><span class="op" id="3463509">)</span><span class="op" id="3463510">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3463513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463516">return</span>&nbsp;<span class="ident" id="3463523">nil</span><br>
<span class="lineno"></span><span class="op" id="3463527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3463530">func</span>&nbsp;<span class="op" id="3463535">(</span><span class="ident" id="3463536">a</span>&nbsp;<span class="op" id="3463538">*</span><span class="ident" id="3463539">UDPAddr</span><span class="op" id="3463546">)</span>&nbsp;<span class="ident" id="3463548">family</span><span class="op" id="3463554">(</span><span class="op" id="3463555">)</span>&nbsp;<span class="builtintype" id="3463557">int</span>&nbsp;<span class="op" id="3463561">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463564">if</span>&nbsp;<span class="ident" id="3463567">a</span>&nbsp;<span class="op" id="3463569">==</span>&nbsp;<span class="ident" id="3463572">nil</span>&nbsp;<span class="op" id="3463576">||</span>&nbsp;<span class="builtinfunc" id="3463579">len</span><span class="op" id="3463582">(</span><span class="ident" id="3463583">a</span><span class="op" id="3463584">.</span><span class="ident" id="3463585">IP</span><span class="op" id="3463587">)</span>&nbsp;<span class="op" id="3463589">&lt;=</span>&nbsp;<span class="ident" id="3463592">IPv4len</span>&nbsp;<span class="op" id="3463600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463604">return</span>&nbsp;<span class="ident" id="3463611">syscall</span><span class="op" id="3463618">.</span><span class="ident" id="3463619">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3463628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463631">if</span>&nbsp;<span class="ident" id="3463634">a</span><span class="op" id="3463635">.</span><span class="ident" id="3463636">IP</span><span class="op" id="3463638">.</span><span class="ident" id="3463639">To4</span><span class="op" id="3463642">(</span><span class="op" id="3463643">)</span>&nbsp;<span class="op" id="3463645">!=</span>&nbsp;<span class="ident" id="3463648">nil</span>&nbsp;<span class="op" id="3463652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463656">return</span>&nbsp;<span class="ident" id="3463663">syscall</span><span class="op" id="3463670">.</span><span class="ident" id="3463671">AF_INET</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3463680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463683">return</span>&nbsp;<span class="ident" id="3463690">syscall</span><span class="op" id="3463697">.</span><span class="ident" id="3463698">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3463707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3463710">func</span>&nbsp;<span class="op" id="3463715">(</span><span class="ident" id="3463716">a</span>&nbsp;<span class="op" id="3463718">*</span><span class="ident" id="3463719">UDPAddr</span><span class="op" id="3463726">)</span>&nbsp;<span class="ident" id="3463728">isWildcard</span><span class="op" id="3463738">(</span><span class="op" id="3463739">)</span>&nbsp;<span class="builtintype" id="3463741">bool</span>&nbsp;<span class="op" id="3463746">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463749">if</span>&nbsp;<span class="ident" id="3463752">a</span>&nbsp;<span class="op" id="3463754">==</span>&nbsp;<span class="ident" id="3463757">nil</span>&nbsp;<span class="op" id="3463761">||</span>&nbsp;<span class="ident" id="3463764">a</span><span class="op" id="3463765">.</span><span class="ident" id="3463766">IP</span>&nbsp;<span class="op" id="3463769">==</span>&nbsp;<span class="ident" id="3463772">nil</span>&nbsp;<span class="op" id="3463776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463780">return</span>&nbsp;<span class="ident" id="3463787">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3463793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463796">return</span>&nbsp;<span class="ident" id="3463803">a</span><span class="op" id="3463804">.</span><span class="ident" id="3463805">IP</span><span class="op" id="3463807">.</span><span class="ident" id="3463808">IsUnspecified</span><span class="op" id="3463821">(</span><span class="op" id="3463822">)</span><br>
<span class="lineno"></span><span class="op" id="3463824">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3463827">func</span>&nbsp;<span class="op" id="3463832">(</span><span class="ident" id="3463833">a</span>&nbsp;<span class="op" id="3463835">*</span><span class="ident" id="3463836">UDPAddr</span><span class="op" id="3463843">)</span>&nbsp;<span class="ident" id="3463845">sockaddr</span><span class="op" id="3463853">(</span><span class="ident" id="3463854">family</span>&nbsp;<span class="builtintype" id="3463861">int</span><span class="op" id="3463864">)</span>&nbsp;<span class="op" id="3463866">(</span><span class="ident" id="3463867">syscall</span><span class="op" id="3463874">.</span><span class="ident" id="3463875">Sockaddr</span><span class="op" id="3463883">,</span>&nbsp;<span class="builtintype" id="3463885">error</span><span class="op" id="3463890">)</span>&nbsp;<span class="op" id="3463892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463895">if</span>&nbsp;<span class="ident" id="3463898">a</span>&nbsp;<span class="op" id="3463900">==</span>&nbsp;<span class="ident" id="3463903">nil</span>&nbsp;<span class="op" id="3463907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463911">return</span>&nbsp;<span class="ident" id="3463918">nil</span><span class="op" id="3463921">,</span>&nbsp;<span class="ident" id="3463923">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3463928">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3463931">return</span>&nbsp;<span class="ident" id="3463938">ipToSockaddr</span><span class="op" id="3463950">(</span><span class="ident" id="3463951">family</span><span class="op" id="3463957">,</span>&nbsp;<span class="ident" id="3463959">a</span><span class="op" id="3463960">.</span><span class="ident" id="3463961">IP</span><span class="op" id="3463963">,</span>&nbsp;<span class="ident" id="3463965">a</span><span class="op" id="3463966">.</span><span class="ident" id="3463967">Port</span><span class="op" id="3463971">,</span>&nbsp;<span class="ident" id="3463973">a</span><span class="op" id="3463974">.</span><span class="ident" id="3463975">Zone</span><span class="op" id="3463979">)</span><br>
<span class="lineno"></span><span class="op" id="3463981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3463984">//&nbsp;UDPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="3464055">//&nbsp;for&nbsp;UDP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno">50</span><span class="keyword" id="3464087">type</span>&nbsp;<span class="ident" id="3464092">UDPConn</span>&nbsp;<span class="keyword" id="3464100">struct</span>&nbsp;<span class="op" id="3464107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464110">conn</span><br>
<span class="lineno"></span><span class="op" id="3464115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3464118">func</span>&nbsp;<span class="ident" id="3464123">newUDPConn</span><span class="op" id="3464133">(</span><span class="ident" id="3464134">fd</span>&nbsp;<span class="op" id="3464137">*</span><span class="ident" id="3464138">netFD</span><span class="op" id="3464143">)</span>&nbsp;<span class="op" id="3464145">*</span><span class="ident" id="3464146">UDPConn</span>&nbsp;<span class="op" id="3464154">{</span>&nbsp;<span class="keyword" id="3464156">return</span>&nbsp;<span class="op" id="3464163">&amp;</span><span class="ident" id="3464164">UDPConn</span><span class="op" id="3464171">{</span><span class="ident" id="3464172">conn</span><span class="op" id="3464176">{</span><span class="ident" id="3464177">fd</span><span class="op" id="3464179">}</span><span class="op" id="3464180">}</span>&nbsp;<span class="op" id="3464182">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="3464185">//&nbsp;ReadFromUDP&nbsp;reads&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3464255">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3464326">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3464353">//</span><br>
<span class="lineno">60</span><span class="comment" id="3464356">//&nbsp;ReadFromUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3464420">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3464487">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3464507">func</span>&nbsp;<span class="op" id="3464512">(</span><span class="ident" id="3464513">c</span>&nbsp;<span class="op" id="3464515">*</span><span class="ident" id="3464516">UDPConn</span><span class="op" id="3464523">)</span>&nbsp;<span class="ident" id="3464525">ReadFromUDP</span><span class="op" id="3464536">(</span><span class="ident" id="3464537">b</span>&nbsp;<span class="op" id="3464539">[</span><span class="op" id="3464540">]</span><span class="builtintype" id="3464541">byte</span><span class="op" id="3464545">)</span>&nbsp;<span class="op" id="3464547">(</span><span class="ident" id="3464548">n</span>&nbsp;<span class="builtintype" id="3464550">int</span><span class="op" id="3464553">,</span>&nbsp;<span class="ident" id="3464555">addr</span>&nbsp;<span class="op" id="3464560">*</span><span class="ident" id="3464561">UDPAddr</span><span class="op" id="3464568">,</span>&nbsp;<span class="ident" id="3464570">err</span>&nbsp;<span class="builtintype" id="3464574">error</span><span class="op" id="3464579">)</span>&nbsp;<span class="op" id="3464581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3464584">if</span>&nbsp;<span class="op" id="3464587">!</span><span class="ident" id="3464588">c</span><span class="op" id="3464589">.</span><span class="ident" id="3464590">ok</span><span class="op" id="3464592">(</span><span class="op" id="3464593">)</span>&nbsp;<span class="op" id="3464595">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3464599">return</span>&nbsp;<span class="num" id="3464606">0</span><span class="op" id="3464607">,</span>&nbsp;<span class="ident" id="3464609">nil</span><span class="op" id="3464612">,</span>&nbsp;<span class="ident" id="3464614">syscall</span><span class="op" id="3464621">.</span><span class="ident" id="3464622">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3464630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464633">n</span><span class="op" id="3464634">,</span>&nbsp;<span class="ident" id="3464636">sa</span><span class="op" id="3464638">,</span>&nbsp;<span class="ident" id="3464640">err</span>&nbsp;<span class="op" id="3464644">:=</span>&nbsp;<span class="ident" id="3464647">c</span><span class="op" id="3464648">.</span><span class="ident" id="3464649">fd</span><span class="op" id="3464651">.</span><span class="ident" id="3464652">readFrom</span><span class="op" id="3464660">(</span><span class="ident" id="3464661">b</span><span class="op" id="3464662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3464665">switch</span>&nbsp;<span class="ident" id="3464672">sa</span>&nbsp;<span class="op" id="3464675">:=</span>&nbsp;<span class="ident" id="3464678">sa</span><span class="op" id="3464680">.</span><span class="op" id="3464681">(</span><span class="keyword" id="3464682">type</span><span class="op" id="3464686">)</span>&nbsp;<span class="op" id="3464688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3464691">case</span>&nbsp;<span class="op" id="3464696">*</span><span class="ident" id="3464697">syscall</span><span class="op" id="3464704">.</span><span class="ident" id="3464705">SockaddrInet4</span><span class="op" id="3464718">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464722">addr</span>&nbsp;<span class="op" id="3464727">=</span>&nbsp;<span class="op" id="3464729">&amp;</span><span class="ident" id="3464730">UDPAddr</span><span class="op" id="3464737">{</span><span class="ident" id="3464738">IP</span><span class="op" id="3464740">:</span>&nbsp;<span class="ident" id="3464742">sa</span><span class="op" id="3464744">.</span><span class="ident" id="3464745">Addr</span><span class="op" id="3464749">[</span><span class="num" id="3464750">0</span><span class="op" id="3464751">:</span><span class="op" id="3464752">]</span><span class="op" id="3464753">,</span>&nbsp;<span class="ident" id="3464755">Port</span><span class="op" id="3464759">:</span>&nbsp;<span class="ident" id="3464761">sa</span><span class="op" id="3464763">.</span><span class="ident" id="3464764">Port</span><span class="op" id="3464768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3464771">case</span>&nbsp;<span class="op" id="3464776">*</span><span class="ident" id="3464777">syscall</span><span class="op" id="3464784">.</span><span class="ident" id="3464785">SockaddrInet6</span><span class="op" id="3464798">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464802">addr</span>&nbsp;<span class="op" id="3464807">=</span>&nbsp;<span class="op" id="3464809">&amp;</span><span class="ident" id="3464810">UDPAddr</span><span class="op" id="3464817">{</span><span class="ident" id="3464818">IP</span><span class="op" id="3464820">:</span>&nbsp;<span class="ident" id="3464822">sa</span><span class="op" id="3464824">.</span><span class="ident" id="3464825">Addr</span><span class="op" id="3464829">[</span><span class="num" id="3464830">0</span><span class="op" id="3464831">:</span><span class="op" id="3464832">]</span><span class="op" id="3464833">,</span>&nbsp;<span class="ident" id="3464835">Port</span><span class="op" id="3464839">:</span>&nbsp;<span class="ident" id="3464841">sa</span><span class="op" id="3464843">.</span><span class="ident" id="3464844">Port</span><span class="op" id="3464848">,</span>&nbsp;<span class="ident" id="3464850">Zone</span><span class="op" id="3464854">:</span>&nbsp;<span class="ident" id="3464856">zoneToString</span><span class="op" id="3464868">(</span><span class="builtintype" id="3464869">int</span><span class="op" id="3464872">(</span><span class="ident" id="3464873">sa</span><span class="op" id="3464875">.</span><span class="ident" id="3464876">ZoneId</span><span class="op" id="3464882">)</span><span class="op" id="3464883">)</span><span class="op" id="3464884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3464887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3464890">return</span><br>
<span class="lineno">75</span><span class="op" id="3464897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3464900">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3464955">func</span>&nbsp;<span class="op" id="3464960">(</span><span class="ident" id="3464961">c</span>&nbsp;<span class="op" id="3464963">*</span><span class="ident" id="3464964">UDPConn</span><span class="op" id="3464971">)</span>&nbsp;<span class="ident" id="3464973">ReadFrom</span><span class="op" id="3464981">(</span><span class="ident" id="3464982">b</span>&nbsp;<span class="op" id="3464984">[</span><span class="op" id="3464985">]</span><span class="builtintype" id="3464986">byte</span><span class="op" id="3464990">)</span>&nbsp;<span class="op" id="3464992">(</span><span class="builtintype" id="3464993">int</span><span class="op" id="3464996">,</span>&nbsp;<span class="ident" id="3464998">Addr</span><span class="op" id="3465002">,</span>&nbsp;<span class="builtintype" id="3465004">error</span><span class="op" id="3465009">)</span>&nbsp;<span class="op" id="3465011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465014">if</span>&nbsp;<span class="op" id="3465017">!</span><span class="ident" id="3465018">c</span><span class="op" id="3465019">.</span><span class="ident" id="3465020">ok</span><span class="op" id="3465022">(</span><span class="op" id="3465023">)</span>&nbsp;<span class="op" id="3465025">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465029">return</span>&nbsp;<span class="num" id="3465036">0</span><span class="op" id="3465037">,</span>&nbsp;<span class="ident" id="3465039">nil</span><span class="op" id="3465042">,</span>&nbsp;<span class="ident" id="3465044">syscall</span><span class="op" id="3465051">.</span><span class="ident" id="3465052">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3465060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465063">n</span><span class="op" id="3465064">,</span>&nbsp;<span class="ident" id="3465066">addr</span><span class="op" id="3465070">,</span>&nbsp;<span class="ident" id="3465072">err</span>&nbsp;<span class="op" id="3465076">:=</span>&nbsp;<span class="ident" id="3465079">c</span><span class="op" id="3465080">.</span><span class="ident" id="3465081">ReadFromUDP</span><span class="op" id="3465092">(</span><span class="ident" id="3465093">b</span><span class="op" id="3465094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465097">return</span>&nbsp;<span class="ident" id="3465104">n</span><span class="op" id="3465105">,</span>&nbsp;<span class="ident" id="3465107">addr</span><span class="op" id="3465111">.</span><span class="ident" id="3465112">toAddr</span><span class="op" id="3465118">(</span><span class="op" id="3465119">)</span><span class="op" id="3465120">,</span>&nbsp;<span class="ident" id="3465122">err</span><br>
<span class="lineno"></span><span class="op" id="3465126">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3465129">//&nbsp;ReadMsgUDP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3465197">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3465265">//&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3465333">//&nbsp;flags&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno">90</span><span class="comment" id="3465400">//&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3465411">func</span>&nbsp;<span class="op" id="3465416">(</span><span class="ident" id="3465417">c</span>&nbsp;<span class="op" id="3465419">*</span><span class="ident" id="3465420">UDPConn</span><span class="op" id="3465427">)</span>&nbsp;<span class="ident" id="3465429">ReadMsgUDP</span><span class="op" id="3465439">(</span><span class="ident" id="3465440">b</span><span class="op" id="3465441">,</span>&nbsp;<span class="ident" id="3465443">oob</span>&nbsp;<span class="op" id="3465447">[</span><span class="op" id="3465448">]</span><span class="builtintype" id="3465449">byte</span><span class="op" id="3465453">)</span>&nbsp;<span class="op" id="3465455">(</span><span class="ident" id="3465456">n</span><span class="op" id="3465457">,</span>&nbsp;<span class="ident" id="3465459">oobn</span><span class="op" id="3465463">,</span>&nbsp;<span class="ident" id="3465465">flags</span>&nbsp;<span class="builtintype" id="3465471">int</span><span class="op" id="3465474">,</span>&nbsp;<span class="ident" id="3465476">addr</span>&nbsp;<span class="op" id="3465481">*</span><span class="ident" id="3465482">UDPAddr</span><span class="op" id="3465489">,</span>&nbsp;<span class="ident" id="3465491">err</span>&nbsp;<span class="builtintype" id="3465495">error</span><span class="op" id="3465500">)</span>&nbsp;<span class="op" id="3465502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465505">if</span>&nbsp;<span class="op" id="3465508">!</span><span class="ident" id="3465509">c</span><span class="op" id="3465510">.</span><span class="ident" id="3465511">ok</span><span class="op" id="3465513">(</span><span class="op" id="3465514">)</span>&nbsp;<span class="op" id="3465516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465520">return</span>&nbsp;<span class="num" id="3465527">0</span><span class="op" id="3465528">,</span>&nbsp;<span class="num" id="3465530">0</span><span class="op" id="3465531">,</span>&nbsp;<span class="num" id="3465533">0</span><span class="op" id="3465534">,</span>&nbsp;<span class="ident" id="3465536">nil</span><span class="op" id="3465539">,</span>&nbsp;<span class="ident" id="3465541">syscall</span><span class="op" id="3465548">.</span><span class="ident" id="3465549">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3465557">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465560">var</span>&nbsp;<span class="ident" id="3465564">sa</span>&nbsp;<span class="ident" id="3465567">syscall</span><span class="op" id="3465574">.</span><span class="ident" id="3465575">Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465585">n</span><span class="op" id="3465586">,</span>&nbsp;<span class="ident" id="3465588">oobn</span><span class="op" id="3465592">,</span>&nbsp;<span class="ident" id="3465594">flags</span><span class="op" id="3465599">,</span>&nbsp;<span class="ident" id="3465601">sa</span><span class="op" id="3465603">,</span>&nbsp;<span class="ident" id="3465605">err</span>&nbsp;<span class="op" id="3465609">=</span>&nbsp;<span class="ident" id="3465611">c</span><span class="op" id="3465612">.</span><span class="ident" id="3465613">fd</span><span class="op" id="3465615">.</span><span class="ident" id="3465616">readMsg</span><span class="op" id="3465623">(</span><span class="ident" id="3465624">b</span><span class="op" id="3465625">,</span>&nbsp;<span class="ident" id="3465627">oob</span><span class="op" id="3465630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465633">switch</span>&nbsp;<span class="ident" id="3465640">sa</span>&nbsp;<span class="op" id="3465643">:=</span>&nbsp;<span class="ident" id="3465646">sa</span><span class="op" id="3465648">.</span><span class="op" id="3465649">(</span><span class="keyword" id="3465650">type</span><span class="op" id="3465654">)</span>&nbsp;<span class="op" id="3465656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465659">case</span>&nbsp;<span class="op" id="3465664">*</span><span class="ident" id="3465665">syscall</span><span class="op" id="3465672">.</span><span class="ident" id="3465673">SockaddrInet4</span><span class="op" id="3465686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465690">addr</span>&nbsp;<span class="op" id="3465695">=</span>&nbsp;<span class="op" id="3465697">&amp;</span><span class="ident" id="3465698">UDPAddr</span><span class="op" id="3465705">{</span><span class="ident" id="3465706">IP</span><span class="op" id="3465708">:</span>&nbsp;<span class="ident" id="3465710">sa</span><span class="op" id="3465712">.</span><span class="ident" id="3465713">Addr</span><span class="op" id="3465717">[</span><span class="num" id="3465718">0</span><span class="op" id="3465719">:</span><span class="op" id="3465720">]</span><span class="op" id="3465721">,</span>&nbsp;<span class="ident" id="3465723">Port</span><span class="op" id="3465727">:</span>&nbsp;<span class="ident" id="3465729">sa</span><span class="op" id="3465731">.</span><span class="ident" id="3465732">Port</span><span class="op" id="3465736">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465739">case</span>&nbsp;<span class="op" id="3465744">*</span><span class="ident" id="3465745">syscall</span><span class="op" id="3465752">.</span><span class="ident" id="3465753">SockaddrInet6</span><span class="op" id="3465766">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465770">addr</span>&nbsp;<span class="op" id="3465775">=</span>&nbsp;<span class="op" id="3465777">&amp;</span><span class="ident" id="3465778">UDPAddr</span><span class="op" id="3465785">{</span><span class="ident" id="3465786">IP</span><span class="op" id="3465788">:</span>&nbsp;<span class="ident" id="3465790">sa</span><span class="op" id="3465792">.</span><span class="ident" id="3465793">Addr</span><span class="op" id="3465797">[</span><span class="num" id="3465798">0</span><span class="op" id="3465799">:</span><span class="op" id="3465800">]</span><span class="op" id="3465801">,</span>&nbsp;<span class="ident" id="3465803">Port</span><span class="op" id="3465807">:</span>&nbsp;<span class="ident" id="3465809">sa</span><span class="op" id="3465811">.</span><span class="ident" id="3465812">Port</span><span class="op" id="3465816">,</span>&nbsp;<span class="ident" id="3465818">Zone</span><span class="op" id="3465822">:</span>&nbsp;<span class="ident" id="3465824">zoneToString</span><span class="op" id="3465836">(</span><span class="builtintype" id="3465837">int</span><span class="op" id="3465840">(</span><span class="ident" id="3465841">sa</span><span class="op" id="3465843">.</span><span class="ident" id="3465844">ZoneId</span><span class="op" id="3465850">)</span><span class="op" id="3465851">)</span><span class="op" id="3465852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3465855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465858">return</span><br>
<span class="lineno"></span><span class="op" id="3465865">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3465868">//&nbsp;WriteToUDP&nbsp;writes&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3465937">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3465948">//</span><br>
<span class="lineno"></span><span class="comment" id="3465951">//&nbsp;WriteToUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">110</span><span class="comment" id="3466014">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3466081">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3466150">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3466163">func</span>&nbsp;<span class="op" id="3466168">(</span><span class="ident" id="3466169">c</span>&nbsp;<span class="op" id="3466171">*</span><span class="ident" id="3466172">UDPConn</span><span class="op" id="3466179">)</span>&nbsp;<span class="ident" id="3466181">WriteToUDP</span><span class="op" id="3466191">(</span><span class="ident" id="3466192">b</span>&nbsp;<span class="op" id="3466194">[</span><span class="op" id="3466195">]</span><span class="builtintype" id="3466196">byte</span><span class="op" id="3466200">,</span>&nbsp;<span class="ident" id="3466202">addr</span>&nbsp;<span class="op" id="3466207">*</span><span class="ident" id="3466208">UDPAddr</span><span class="op" id="3466215">)</span>&nbsp;<span class="op" id="3466217">(</span><span class="builtintype" id="3466218">int</span><span class="op" id="3466221">,</span>&nbsp;<span class="builtintype" id="3466223">error</span><span class="op" id="3466228">)</span>&nbsp;<span class="op" id="3466230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466233">if</span>&nbsp;<span class="op" id="3466236">!</span><span class="ident" id="3466237">c</span><span class="op" id="3466238">.</span><span class="ident" id="3466239">ok</span><span class="op" id="3466241">(</span><span class="op" id="3466242">)</span>&nbsp;<span class="op" id="3466244">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466248">return</span>&nbsp;<span class="num" id="3466255">0</span><span class="op" id="3466256">,</span>&nbsp;<span class="ident" id="3466258">syscall</span><span class="op" id="3466265">.</span><span class="ident" id="3466266">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3466274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466277">if</span>&nbsp;<span class="ident" id="3466280">c</span><span class="op" id="3466281">.</span><span class="ident" id="3466282">fd</span><span class="op" id="3466284">.</span><span class="ident" id="3466285">isConnected</span>&nbsp;<span class="op" id="3466297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466301">return</span>&nbsp;<span class="num" id="3466308">0</span><span class="op" id="3466309">,</span>&nbsp;<span class="op" id="3466311">&amp;</span><span class="ident" id="3466312">OpError</span><span class="op" id="3466319">{</span><span class="string" id="3466320">&#34;write&#34;</span><span class="op" id="3466327">,</span>&nbsp;<span class="ident" id="3466329">c</span><span class="op" id="3466330">.</span><span class="ident" id="3466331">fd</span><span class="op" id="3466333">.</span><span class="ident" id="3466334">net</span><span class="op" id="3466337">,</span>&nbsp;<span class="ident" id="3466339">addr</span><span class="op" id="3466343">,</span>&nbsp;<span class="ident" id="3466345">ErrWriteToConnected</span><span class="op" id="3466364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3466367">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466370">if</span>&nbsp;<span class="ident" id="3466373">addr</span>&nbsp;<span class="op" id="3466378">==</span>&nbsp;<span class="ident" id="3466381">nil</span>&nbsp;<span class="op" id="3466385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466389">return</span>&nbsp;<span class="num" id="3466396">0</span><span class="op" id="3466397">,</span>&nbsp;<span class="op" id="3466399">&amp;</span><span class="ident" id="3466400">OpError</span><span class="op" id="3466407">{</span><span class="ident" id="3466408">Op</span><span class="op" id="3466410">:</span>&nbsp;<span class="string" id="3466412">&#34;write&#34;</span><span class="op" id="3466419">,</span>&nbsp;<span class="ident" id="3466421">Net</span><span class="op" id="3466424">:</span>&nbsp;<span class="ident" id="3466426">c</span><span class="op" id="3466427">.</span><span class="ident" id="3466428">fd</span><span class="op" id="3466430">.</span><span class="ident" id="3466431">net</span><span class="op" id="3466434">,</span>&nbsp;<span class="ident" id="3466436">Addr</span><span class="op" id="3466440">:</span>&nbsp;<span class="ident" id="3466442">nil</span><span class="op" id="3466445">,</span>&nbsp;<span class="ident" id="3466447">Err</span><span class="op" id="3466450">:</span>&nbsp;<span class="ident" id="3466452">errMissingAddress</span><span class="op" id="3466469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3466472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466475">sa</span><span class="op" id="3466477">,</span>&nbsp;<span class="ident" id="3466479">err</span>&nbsp;<span class="op" id="3466483">:=</span>&nbsp;<span class="ident" id="3466486">addr</span><span class="op" id="3466490">.</span><span class="ident" id="3466491">sockaddr</span><span class="op" id="3466499">(</span><span class="ident" id="3466500">c</span><span class="op" id="3466501">.</span><span class="ident" id="3466502">fd</span><span class="op" id="3466504">.</span><span class="ident" id="3466505">family</span><span class="op" id="3466511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466514">if</span>&nbsp;<span class="ident" id="3466517">err</span>&nbsp;<span class="op" id="3466521">!=</span>&nbsp;<span class="ident" id="3466524">nil</span>&nbsp;<span class="op" id="3466528">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466532">return</span>&nbsp;<span class="num" id="3466539">0</span><span class="op" id="3466540">,</span>&nbsp;<span class="op" id="3466542">&amp;</span><span class="ident" id="3466543">OpError</span><span class="op" id="3466550">{</span><span class="string" id="3466551">&#34;write&#34;</span><span class="op" id="3466558">,</span>&nbsp;<span class="ident" id="3466560">c</span><span class="op" id="3466561">.</span><span class="ident" id="3466562">fd</span><span class="op" id="3466564">.</span><span class="ident" id="3466565">net</span><span class="op" id="3466568">,</span>&nbsp;<span class="ident" id="3466570">addr</span><span class="op" id="3466574">,</span>&nbsp;<span class="ident" id="3466576">err</span><span class="op" id="3466579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3466582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466585">return</span>&nbsp;<span class="ident" id="3466592">c</span><span class="op" id="3466593">.</span><span class="ident" id="3466594">fd</span><span class="op" id="3466596">.</span><span class="ident" id="3466597">writeTo</span><span class="op" id="3466604">(</span><span class="ident" id="3466605">b</span><span class="op" id="3466606">,</span>&nbsp;<span class="ident" id="3466608">sa</span><span class="op" id="3466610">)</span><br>
<span class="lineno"></span><span class="op" id="3466612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3466615">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3466668">func</span>&nbsp;<span class="op" id="3466673">(</span><span class="ident" id="3466674">c</span>&nbsp;<span class="op" id="3466676">*</span><span class="ident" id="3466677">UDPConn</span><span class="op" id="3466684">)</span>&nbsp;<span class="ident" id="3466686">WriteTo</span><span class="op" id="3466693">(</span><span class="ident" id="3466694">b</span>&nbsp;<span class="op" id="3466696">[</span><span class="op" id="3466697">]</span><span class="builtintype" id="3466698">byte</span><span class="op" id="3466702">,</span>&nbsp;<span class="ident" id="3466704">addr</span>&nbsp;<span class="ident" id="3466709">Addr</span><span class="op" id="3466713">)</span>&nbsp;<span class="op" id="3466715">(</span><span class="builtintype" id="3466716">int</span><span class="op" id="3466719">,</span>&nbsp;<span class="builtintype" id="3466721">error</span><span class="op" id="3466726">)</span>&nbsp;<span class="op" id="3466728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466731">if</span>&nbsp;<span class="op" id="3466734">!</span><span class="ident" id="3466735">c</span><span class="op" id="3466736">.</span><span class="ident" id="3466737">ok</span><span class="op" id="3466739">(</span><span class="op" id="3466740">)</span>&nbsp;<span class="op" id="3466742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466746">return</span>&nbsp;<span class="num" id="3466753">0</span><span class="op" id="3466754">,</span>&nbsp;<span class="ident" id="3466756">syscall</span><span class="op" id="3466763">.</span><span class="ident" id="3466764">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3466772">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466775">a</span><span class="op" id="3466776">,</span>&nbsp;<span class="ident" id="3466778">ok</span>&nbsp;<span class="op" id="3466781">:=</span>&nbsp;<span class="ident" id="3466784">addr</span><span class="op" id="3466788">.</span><span class="op" id="3466789">(</span><span class="op" id="3466790">*</span><span class="ident" id="3466791">UDPAddr</span><span class="op" id="3466798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466801">if</span>&nbsp;<span class="op" id="3466804">!</span><span class="ident" id="3466805">ok</span>&nbsp;<span class="op" id="3466808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466812">return</span>&nbsp;<span class="num" id="3466819">0</span><span class="op" id="3466820">,</span>&nbsp;<span class="op" id="3466822">&amp;</span><span class="ident" id="3466823">OpError</span><span class="op" id="3466830">{</span><span class="string" id="3466831">&#34;write&#34;</span><span class="op" id="3466838">,</span>&nbsp;<span class="ident" id="3466840">c</span><span class="op" id="3466841">.</span><span class="ident" id="3466842">fd</span><span class="op" id="3466844">.</span><span class="ident" id="3466845">net</span><span class="op" id="3466848">,</span>&nbsp;<span class="ident" id="3466850">addr</span><span class="op" id="3466854">,</span>&nbsp;<span class="ident" id="3466856">syscall</span><span class="op" id="3466863">.</span><span class="ident" id="3466864">EINVAL</span><span class="op" id="3466870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3466873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466876">return</span>&nbsp;<span class="ident" id="3466883">c</span><span class="op" id="3466884">.</span><span class="ident" id="3466885">WriteToUDP</span><span class="op" id="3466895">(</span><span class="ident" id="3466896">b</span><span class="op" id="3466897">,</span>&nbsp;<span class="ident" id="3466899">a</span><span class="op" id="3466900">)</span><br>
<span class="lineno">140</span><span class="op" id="3466902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3466905">//&nbsp;WriteMsgUDP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3466976">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3467043">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">145</span><span class="keyword" id="3467095">func</span>&nbsp;<span class="op" id="3467100">(</span><span class="ident" id="3467101">c</span>&nbsp;<span class="op" id="3467103">*</span><span class="ident" id="3467104">UDPConn</span><span class="op" id="3467111">)</span>&nbsp;<span class="ident" id="3467113">WriteMsgUDP</span><span class="op" id="3467124">(</span><span class="ident" id="3467125">b</span><span class="op" id="3467126">,</span>&nbsp;<span class="ident" id="3467128">oob</span>&nbsp;<span class="op" id="3467132">[</span><span class="op" id="3467133">]</span><span class="builtintype" id="3467134">byte</span><span class="op" id="3467138">,</span>&nbsp;<span class="ident" id="3467140">addr</span>&nbsp;<span class="op" id="3467145">*</span><span class="ident" id="3467146">UDPAddr</span><span class="op" id="3467153">)</span>&nbsp;<span class="op" id="3467155">(</span><span class="ident" id="3467156">n</span><span class="op" id="3467157">,</span>&nbsp;<span class="ident" id="3467159">oobn</span>&nbsp;<span class="builtintype" id="3467164">int</span><span class="op" id="3467167">,</span>&nbsp;<span class="ident" id="3467169">err</span>&nbsp;<span class="builtintype" id="3467173">error</span><span class="op" id="3467178">)</span>&nbsp;<span class="op" id="3467180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467183">if</span>&nbsp;<span class="op" id="3467186">!</span><span class="ident" id="3467187">c</span><span class="op" id="3467188">.</span><span class="ident" id="3467189">ok</span><span class="op" id="3467191">(</span><span class="op" id="3467192">)</span>&nbsp;<span class="op" id="3467194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467198">return</span>&nbsp;<span class="num" id="3467205">0</span><span class="op" id="3467206">,</span>&nbsp;<span class="num" id="3467208">0</span><span class="op" id="3467209">,</span>&nbsp;<span class="ident" id="3467211">syscall</span><span class="op" id="3467218">.</span><span class="ident" id="3467219">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3467227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467230">if</span>&nbsp;<span class="ident" id="3467233">c</span><span class="op" id="3467234">.</span><span class="ident" id="3467235">fd</span><span class="op" id="3467237">.</span><span class="ident" id="3467238">isConnected</span>&nbsp;<span class="op" id="3467250">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467254">return</span>&nbsp;<span class="num" id="3467261">0</span><span class="op" id="3467262">,</span>&nbsp;<span class="num" id="3467264">0</span><span class="op" id="3467265">,</span>&nbsp;<span class="op" id="3467267">&amp;</span><span class="ident" id="3467268">OpError</span><span class="op" id="3467275">{</span><span class="string" id="3467276">&#34;write&#34;</span><span class="op" id="3467283">,</span>&nbsp;<span class="ident" id="3467285">c</span><span class="op" id="3467286">.</span><span class="ident" id="3467287">fd</span><span class="op" id="3467289">.</span><span class="ident" id="3467290">net</span><span class="op" id="3467293">,</span>&nbsp;<span class="ident" id="3467295">addr</span><span class="op" id="3467299">,</span>&nbsp;<span class="ident" id="3467301">ErrWriteToConnected</span><span class="op" id="3467320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3467323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467326">if</span>&nbsp;<span class="ident" id="3467329">addr</span>&nbsp;<span class="op" id="3467334">==</span>&nbsp;<span class="ident" id="3467337">nil</span>&nbsp;<span class="op" id="3467341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467345">return</span>&nbsp;<span class="num" id="3467352">0</span><span class="op" id="3467353">,</span>&nbsp;<span class="num" id="3467355">0</span><span class="op" id="3467356">,</span>&nbsp;<span class="op" id="3467358">&amp;</span><span class="ident" id="3467359">OpError</span><span class="op" id="3467366">{</span><span class="ident" id="3467367">Op</span><span class="op" id="3467369">:</span>&nbsp;<span class="string" id="3467371">&#34;write&#34;</span><span class="op" id="3467378">,</span>&nbsp;<span class="ident" id="3467380">Net</span><span class="op" id="3467383">:</span>&nbsp;<span class="ident" id="3467385">c</span><span class="op" id="3467386">.</span><span class="ident" id="3467387">fd</span><span class="op" id="3467389">.</span><span class="ident" id="3467390">net</span><span class="op" id="3467393">,</span>&nbsp;<span class="ident" id="3467395">Addr</span><span class="op" id="3467399">:</span>&nbsp;<span class="ident" id="3467401">nil</span><span class="op" id="3467404">,</span>&nbsp;<span class="ident" id="3467406">Err</span><span class="op" id="3467409">:</span>&nbsp;<span class="ident" id="3467411">errMissingAddress</span><span class="op" id="3467428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3467431">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467434">sa</span><span class="op" id="3467436">,</span>&nbsp;<span class="ident" id="3467438">err</span>&nbsp;<span class="op" id="3467442">:=</span>&nbsp;<span class="ident" id="3467445">addr</span><span class="op" id="3467449">.</span><span class="ident" id="3467450">sockaddr</span><span class="op" id="3467458">(</span><span class="ident" id="3467459">c</span><span class="op" id="3467460">.</span><span class="ident" id="3467461">fd</span><span class="op" id="3467463">.</span><span class="ident" id="3467464">family</span><span class="op" id="3467470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467473">if</span>&nbsp;<span class="ident" id="3467476">err</span>&nbsp;<span class="op" id="3467480">!=</span>&nbsp;<span class="ident" id="3467483">nil</span>&nbsp;<span class="op" id="3467487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467491">return</span>&nbsp;<span class="num" id="3467498">0</span><span class="op" id="3467499">,</span>&nbsp;<span class="num" id="3467501">0</span><span class="op" id="3467502">,</span>&nbsp;<span class="op" id="3467504">&amp;</span><span class="ident" id="3467505">OpError</span><span class="op" id="3467512">{</span><span class="string" id="3467513">&#34;write&#34;</span><span class="op" id="3467520">,</span>&nbsp;<span class="ident" id="3467522">c</span><span class="op" id="3467523">.</span><span class="ident" id="3467524">fd</span><span class="op" id="3467526">.</span><span class="ident" id="3467527">net</span><span class="op" id="3467530">,</span>&nbsp;<span class="ident" id="3467532">addr</span><span class="op" id="3467536">,</span>&nbsp;<span class="ident" id="3467538">err</span><span class="op" id="3467541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3467544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467547">return</span>&nbsp;<span class="ident" id="3467554">c</span><span class="op" id="3467555">.</span><span class="ident" id="3467556">fd</span><span class="op" id="3467558">.</span><span class="ident" id="3467559">writeMsg</span><span class="op" id="3467567">(</span><span class="ident" id="3467568">b</span><span class="op" id="3467569">,</span>&nbsp;<span class="ident" id="3467571">oob</span><span class="op" id="3467574">,</span>&nbsp;<span class="ident" id="3467576">sa</span><span class="op" id="3467578">)</span><br>
<span class="lineno">160</span><span class="op" id="3467580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3467583">//&nbsp;DialUDP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3467651">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3467722">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno">165</span><span class="keyword" id="3467771">func</span>&nbsp;<span class="ident" id="3467776">DialUDP</span><span class="op" id="3467783">(</span><span class="ident" id="3467784">net</span>&nbsp;<span class="builtintype" id="3467788">string</span><span class="op" id="3467794">,</span>&nbsp;<span class="ident" id="3467796">laddr</span><span class="op" id="3467801">,</span>&nbsp;<span class="ident" id="3467803">raddr</span>&nbsp;<span class="op" id="3467809">*</span><span class="ident" id="3467810">UDPAddr</span><span class="op" id="3467817">)</span>&nbsp;<span class="op" id="3467819">(</span><span class="op" id="3467820">*</span><span class="ident" id="3467821">UDPConn</span><span class="op" id="3467828">,</span>&nbsp;<span class="builtintype" id="3467830">error</span><span class="op" id="3467835">)</span>&nbsp;<span class="op" id="3467837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467840">switch</span>&nbsp;<span class="ident" id="3467847">net</span>&nbsp;<span class="op" id="3467851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467854">case</span>&nbsp;<span class="string" id="3467859">&#34;udp&#34;</span><span class="op" id="3467864">,</span>&nbsp;<span class="string" id="3467866">&#34;udp4&#34;</span><span class="op" id="3467872">,</span>&nbsp;<span class="string" id="3467874">&#34;udp6&#34;</span><span class="op" id="3467880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467883">default</span><span class="op" id="3467890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467894">return</span>&nbsp;<span class="ident" id="3467901">nil</span><span class="op" id="3467904">,</span>&nbsp;<span class="op" id="3467906">&amp;</span><span class="ident" id="3467907">OpError</span><span class="op" id="3467914">{</span><span class="ident" id="3467915">Op</span><span class="op" id="3467917">:</span>&nbsp;<span class="string" id="3467919">&#34;dial&#34;</span><span class="op" id="3467925">,</span>&nbsp;<span class="ident" id="3467927">Net</span><span class="op" id="3467930">:</span>&nbsp;<span class="ident" id="3467932">net</span><span class="op" id="3467935">,</span>&nbsp;<span class="ident" id="3467937">Addr</span><span class="op" id="3467941">:</span>&nbsp;<span class="ident" id="3467943">raddr</span><span class="op" id="3467948">,</span>&nbsp;<span class="ident" id="3467950">Err</span><span class="op" id="3467953">:</span>&nbsp;<span class="ident" id="3467955">UnknownNetworkError</span><span class="op" id="3467974">(</span><span class="ident" id="3467975">net</span><span class="op" id="3467978">)</span><span class="op" id="3467979">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3467982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467985">if</span>&nbsp;<span class="ident" id="3467988">raddr</span>&nbsp;<span class="op" id="3467994">==</span>&nbsp;<span class="ident" id="3467997">nil</span>&nbsp;<span class="op" id="3468001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3468005">return</span>&nbsp;<span class="ident" id="3468012">nil</span><span class="op" id="3468015">,</span>&nbsp;<span class="op" id="3468017">&amp;</span><span class="ident" id="3468018">OpError</span><span class="op" id="3468025">{</span><span class="ident" id="3468026">Op</span><span class="op" id="3468028">:</span>&nbsp;<span class="string" id="3468030">&#34;dial&#34;</span><span class="op" id="3468036">,</span>&nbsp;<span class="ident" id="3468038">Net</span><span class="op" id="3468041">:</span>&nbsp;<span class="ident" id="3468043">net</span><span class="op" id="3468046">,</span>&nbsp;<span class="ident" id="3468048">Addr</span><span class="op" id="3468052">:</span>&nbsp;<span class="ident" id="3468054">nil</span><span class="op" id="3468057">,</span>&nbsp;<span class="ident" id="3468059">Err</span><span class="op" id="3468062">:</span>&nbsp;<span class="ident" id="3468064">errMissingAddress</span><span class="op" id="3468081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3468084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3468087">return</span>&nbsp;<span class="ident" id="3468094">dialUDP</span><span class="op" id="3468101">(</span><span class="ident" id="3468102">net</span><span class="op" id="3468105">,</span>&nbsp;<span class="ident" id="3468107">laddr</span><span class="op" id="3468112">,</span>&nbsp;<span class="ident" id="3468114">raddr</span><span class="op" id="3468119">,</span>&nbsp;<span class="ident" id="3468121">noDeadline</span><span class="op" id="3468131">)</span><br>
<span class="lineno">175</span><span class="op" id="3468133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3468136">func</span>&nbsp;<span class="ident" id="3468141">dialUDP</span><span class="op" id="3468148">(</span><span class="ident" id="3468149">net</span>&nbsp;<span class="builtintype" id="3468153">string</span><span class="op" id="3468159">,</span>&nbsp;<span class="ident" id="3468161">laddr</span><span class="op" id="3468166">,</span>&nbsp;<span class="ident" id="3468168">raddr</span>&nbsp;<span class="op" id="3468174">*</span><span class="ident" id="3468175">UDPAddr</span><span class="op" id="3468182">,</span>&nbsp;<span class="ident" id="3468184">deadline</span>&nbsp;<span class="ident" id="3468193">time</span><span class="op" id="3468197">.</span><span class="ident" id="3468198">Time</span><span class="op" id="3468202">)</span>&nbsp;<span class="op" id="3468204">(</span><span class="op" id="3468205">*</span><span class="ident" id="3468206">UDPConn</span><span class="op" id="3468213">,</span>&nbsp;<span class="builtintype" id="3468215">error</span><span class="op" id="3468220">)</span>&nbsp;<span class="op" id="3468222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3468225">fd</span><span class="op" id="3468227">,</span>&nbsp;<span class="ident" id="3468229">err</span>&nbsp;<span class="op" id="3468233">:=</span>&nbsp;<span class="ident" id="3468236">internetSocket</span><span class="op" id="3468250">(</span><span class="ident" id="3468251">net</span><span class="op" id="3468254">,</span>&nbsp;<span class="ident" id="3468256">laddr</span><span class="op" id="3468261">,</span>&nbsp;<span class="ident" id="3468263">raddr</span><span class="op" id="3468268">,</span>&nbsp;<span class="ident" id="3468270">deadline</span><span class="op" id="3468278">,</span>&nbsp;<span class="ident" id="3468280">syscall</span><span class="op" id="3468287">.</span><span class="ident" id="3468288">SOCK_DGRAM</span><span class="op" id="3468298">,</span>&nbsp;<span class="num" id="3468300">0</span><span class="op" id="3468301">,</span>&nbsp;<span class="string" id="3468303">&#34;dial&#34;</span><span class="op" id="3468309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3468312">if</span>&nbsp;<span class="ident" id="3468315">err</span>&nbsp;<span class="op" id="3468319">!=</span>&nbsp;<span class="ident" id="3468322">nil</span>&nbsp;<span class="op" id="3468326">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3468330">return</span>&nbsp;<span class="ident" id="3468337">nil</span><span class="op" id="3468340">,</span>&nbsp;<span class="op" id="3468342">&amp;</span><span class="ident" id="3468343">OpError</span><span class="op" id="3468350">{</span><span class="ident" id="3468351">Op</span><span class="op" id="3468353">:</span>&nbsp;<span class="string" id="3468355">&#34;dial&#34;</span><span class="op" id="3468361">,</span>&nbsp;<span class="ident" id="3468363">Net</span><span class="op" id="3468366">:</span>&nbsp;<span class="ident" id="3468368">net</span><span class="op" id="3468371">,</span>&nbsp;<span class="ident" id="3468373">Addr</span><span class="op" id="3468377">:</span>&nbsp;<span class="ident" id="3468379">raddr</span><span class="op" id="3468384">,</span>&nbsp;<span class="ident" id="3468386">Err</span><span class="op" id="3468389">:</span>&nbsp;<span class="ident" id="3468391">err</span><span class="op" id="3468394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3468397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3468400">return</span>&nbsp;<span class="ident" id="3468407">newUDPConn</span><span class="op" id="3468417">(</span><span class="ident" id="3468418">fd</span><span class="op" id="3468420">)</span><span class="op" id="3468421">,</span>&nbsp;<span class="ident" id="3468423">nil</span><br>
<span class="lineno"></span><span class="op" id="3468427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3468430">//&nbsp;ListenUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;UDP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="3468499">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="3468570">//&nbsp;a&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenUDP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.</span><br>
<span class="lineno"></span><span class="comment" id="3468627">//&nbsp;The&nbsp;LocalAddr&nbsp;method&nbsp;of&nbsp;the&nbsp;returned&nbsp;UDPConn&nbsp;can&nbsp;be&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3468690">//&nbsp;discover&nbsp;the&nbsp;port.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">190</span><span class="comment" id="3468760">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;UDP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="3468831">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3468846">func</span>&nbsp;<span class="ident" id="3468851">ListenUDP</span><span class="op" id="3468860">(</span><span class="ident" id="3468861">net</span>&nbsp;<span class="builtintype" id="3468865">string</span><span class="op" id="3468871">,</span>&nbsp;<span class="ident" id="3468873">laddr</span>&nbsp;<span class="op" id="3468879">*</span><span class="ident" id="3468880">UDPAddr</span><span class="op" id="3468887">)</span>&nbsp;<span class="op" id="3468889">(</span><span class="op" id="3468890">*</span><span class="ident" id="3468891">UDPConn</span><span class="op" id="3468898">,</span>&nbsp;<span class="builtintype" id="3468900">error</span><span class="op" id="3468905">)</span>&nbsp;<span class="op" id="3468907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3468910">switch</span>&nbsp;<span class="ident" id="3468917">net</span>&nbsp;<span class="op" id="3468921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3468924">case</span>&nbsp;<span class="string" id="3468929">&#34;udp&#34;</span><span class="op" id="3468934">,</span>&nbsp;<span class="string" id="3468936">&#34;udp4&#34;</span><span class="op" id="3468942">,</span>&nbsp;<span class="string" id="3468944">&#34;udp6&#34;</span><span class="op" id="3468950">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3468953">default</span><span class="op" id="3468960">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3468964">return</span>&nbsp;<span class="ident" id="3468971">nil</span><span class="op" id="3468974">,</span>&nbsp;<span class="op" id="3468976">&amp;</span><span class="ident" id="3468977">OpError</span><span class="op" id="3468984">{</span><span class="ident" id="3468985">Op</span><span class="op" id="3468987">:</span>&nbsp;<span class="string" id="3468989">&#34;listen&#34;</span><span class="op" id="3468997">,</span>&nbsp;<span class="ident" id="3468999">Net</span><span class="op" id="3469002">:</span>&nbsp;<span class="ident" id="3469004">net</span><span class="op" id="3469007">,</span>&nbsp;<span class="ident" id="3469009">Addr</span><span class="op" id="3469013">:</span>&nbsp;<span class="ident" id="3469015">laddr</span><span class="op" id="3469020">,</span>&nbsp;<span class="ident" id="3469022">Err</span><span class="op" id="3469025">:</span>&nbsp;<span class="ident" id="3469027">UnknownNetworkError</span><span class="op" id="3469046">(</span><span class="ident" id="3469047">net</span><span class="op" id="3469050">)</span><span class="op" id="3469051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3469054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469057">if</span>&nbsp;<span class="ident" id="3469060">laddr</span>&nbsp;<span class="op" id="3469066">==</span>&nbsp;<span class="ident" id="3469069">nil</span>&nbsp;<span class="op" id="3469073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3469077">laddr</span>&nbsp;<span class="op" id="3469083">=</span>&nbsp;<span class="op" id="3469085">&amp;</span><span class="ident" id="3469086">UDPAddr</span><span class="op" id="3469093">{</span><span class="op" id="3469094">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3469097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3469100">fd</span><span class="op" id="3469102">,</span>&nbsp;<span class="ident" id="3469104">err</span>&nbsp;<span class="op" id="3469108">:=</span>&nbsp;<span class="ident" id="3469111">internetSocket</span><span class="op" id="3469125">(</span><span class="ident" id="3469126">net</span><span class="op" id="3469129">,</span>&nbsp;<span class="ident" id="3469131">laddr</span><span class="op" id="3469136">,</span>&nbsp;<span class="ident" id="3469138">nil</span><span class="op" id="3469141">,</span>&nbsp;<span class="ident" id="3469143">noDeadline</span><span class="op" id="3469153">,</span>&nbsp;<span class="ident" id="3469155">syscall</span><span class="op" id="3469162">.</span><span class="ident" id="3469163">SOCK_DGRAM</span><span class="op" id="3469173">,</span>&nbsp;<span class="num" id="3469175">0</span><span class="op" id="3469176">,</span>&nbsp;<span class="string" id="3469178">&#34;listen&#34;</span><span class="op" id="3469186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469189">if</span>&nbsp;<span class="ident" id="3469192">err</span>&nbsp;<span class="op" id="3469196">!=</span>&nbsp;<span class="ident" id="3469199">nil</span>&nbsp;<span class="op" id="3469203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469207">return</span>&nbsp;<span class="ident" id="3469214">nil</span><span class="op" id="3469217">,</span>&nbsp;<span class="op" id="3469219">&amp;</span><span class="ident" id="3469220">OpError</span><span class="op" id="3469227">{</span><span class="ident" id="3469228">Op</span><span class="op" id="3469230">:</span>&nbsp;<span class="string" id="3469232">&#34;listen&#34;</span><span class="op" id="3469240">,</span>&nbsp;<span class="ident" id="3469242">Net</span><span class="op" id="3469245">:</span>&nbsp;<span class="ident" id="3469247">net</span><span class="op" id="3469250">,</span>&nbsp;<span class="ident" id="3469252">Addr</span><span class="op" id="3469256">:</span>&nbsp;<span class="ident" id="3469258">laddr</span><span class="op" id="3469263">,</span>&nbsp;<span class="ident" id="3469265">Err</span><span class="op" id="3469268">:</span>&nbsp;<span class="ident" id="3469270">err</span><span class="op" id="3469273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3469276">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469279">return</span>&nbsp;<span class="ident" id="3469286">newUDPConn</span><span class="op" id="3469296">(</span><span class="ident" id="3469297">fd</span><span class="op" id="3469299">)</span><span class="op" id="3469300">,</span>&nbsp;<span class="ident" id="3469302">nil</span><br>
<span class="lineno"></span><span class="op" id="3469306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3469309">//&nbsp;ListenMulticastUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;multicast&nbsp;UDP&nbsp;packets</span><br>
<span class="lineno"></span><span class="comment" id="3469374">//&nbsp;addressed&nbsp;to&nbsp;the&nbsp;group&nbsp;address&nbsp;gaddr&nbsp;on&nbsp;ifi,&nbsp;which&nbsp;specifies&nbsp;the</span><br>
<span class="lineno">210</span><span class="comment" id="3469442">//&nbsp;interface&nbsp;to&nbsp;join.&nbsp;&nbsp;ListenMulticastUDP&nbsp;uses&nbsp;default&nbsp;multicast</span><br>
<span class="lineno"></span><span class="comment" id="3469507">//&nbsp;interface&nbsp;if&nbsp;ifi&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3469535">func</span>&nbsp;<span class="ident" id="3469540">ListenMulticastUDP</span><span class="op" id="3469558">(</span><span class="ident" id="3469559">net</span>&nbsp;<span class="builtintype" id="3469563">string</span><span class="op" id="3469569">,</span>&nbsp;<span class="ident" id="3469571">ifi</span>&nbsp;<span class="op" id="3469575">*</span><span class="ident" id="3469576">Interface</span><span class="op" id="3469585">,</span>&nbsp;<span class="ident" id="3469587">gaddr</span>&nbsp;<span class="op" id="3469593">*</span><span class="ident" id="3469594">UDPAddr</span><span class="op" id="3469601">)</span>&nbsp;<span class="op" id="3469603">(</span><span class="op" id="3469604">*</span><span class="ident" id="3469605">UDPConn</span><span class="op" id="3469612">,</span>&nbsp;<span class="builtintype" id="3469614">error</span><span class="op" id="3469619">)</span>&nbsp;<span class="op" id="3469621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469624">switch</span>&nbsp;<span class="ident" id="3469631">net</span>&nbsp;<span class="op" id="3469635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469638">case</span>&nbsp;<span class="string" id="3469643">&#34;udp&#34;</span><span class="op" id="3469648">,</span>&nbsp;<span class="string" id="3469650">&#34;udp4&#34;</span><span class="op" id="3469656">,</span>&nbsp;<span class="string" id="3469658">&#34;udp6&#34;</span><span class="op" id="3469664">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469667">default</span><span class="op" id="3469674">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469678">return</span>&nbsp;<span class="ident" id="3469685">nil</span><span class="op" id="3469688">,</span>&nbsp;<span class="op" id="3469690">&amp;</span><span class="ident" id="3469691">OpError</span><span class="op" id="3469698">{</span><span class="ident" id="3469699">Op</span><span class="op" id="3469701">:</span>&nbsp;<span class="string" id="3469703">&#34;listen&#34;</span><span class="op" id="3469711">,</span>&nbsp;<span class="ident" id="3469713">Net</span><span class="op" id="3469716">:</span>&nbsp;<span class="ident" id="3469718">net</span><span class="op" id="3469721">,</span>&nbsp;<span class="ident" id="3469723">Addr</span><span class="op" id="3469727">:</span>&nbsp;<span class="ident" id="3469729">gaddr</span><span class="op" id="3469734">,</span>&nbsp;<span class="ident" id="3469736">Err</span><span class="op" id="3469739">:</span>&nbsp;<span class="ident" id="3469741">UnknownNetworkError</span><span class="op" id="3469760">(</span><span class="ident" id="3469761">net</span><span class="op" id="3469764">)</span><span class="op" id="3469765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3469768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469771">if</span>&nbsp;<span class="ident" id="3469774">gaddr</span>&nbsp;<span class="op" id="3469780">==</span>&nbsp;<span class="ident" id="3469783">nil</span>&nbsp;<span class="op" id="3469787">||</span>&nbsp;<span class="ident" id="3469790">gaddr</span><span class="op" id="3469795">.</span><span class="ident" id="3469796">IP</span>&nbsp;<span class="op" id="3469799">==</span>&nbsp;<span class="ident" id="3469802">nil</span>&nbsp;<span class="op" id="3469806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469810">return</span>&nbsp;<span class="ident" id="3469817">nil</span><span class="op" id="3469820">,</span>&nbsp;<span class="op" id="3469822">&amp;</span><span class="ident" id="3469823">OpError</span><span class="op" id="3469830">{</span><span class="ident" id="3469831">Op</span><span class="op" id="3469833">:</span>&nbsp;<span class="string" id="3469835">&#34;listen&#34;</span><span class="op" id="3469843">,</span>&nbsp;<span class="ident" id="3469845">Net</span><span class="op" id="3469848">:</span>&nbsp;<span class="ident" id="3469850">net</span><span class="op" id="3469853">,</span>&nbsp;<span class="ident" id="3469855">Addr</span><span class="op" id="3469859">:</span>&nbsp;<span class="ident" id="3469861">nil</span><span class="op" id="3469864">,</span>&nbsp;<span class="ident" id="3469866">Err</span><span class="op" id="3469869">:</span>&nbsp;<span class="ident" id="3469871">errMissingAddress</span><span class="op" id="3469888">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3469891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3469894">fd</span><span class="op" id="3469896">,</span>&nbsp;<span class="ident" id="3469898">err</span>&nbsp;<span class="op" id="3469902">:=</span>&nbsp;<span class="ident" id="3469905">internetSocket</span><span class="op" id="3469919">(</span><span class="ident" id="3469920">net</span><span class="op" id="3469923">,</span>&nbsp;<span class="ident" id="3469925">gaddr</span><span class="op" id="3469930">,</span>&nbsp;<span class="ident" id="3469932">nil</span><span class="op" id="3469935">,</span>&nbsp;<span class="ident" id="3469937">noDeadline</span><span class="op" id="3469947">,</span>&nbsp;<span class="ident" id="3469949">syscall</span><span class="op" id="3469956">.</span><span class="ident" id="3469957">SOCK_DGRAM</span><span class="op" id="3469967">,</span>&nbsp;<span class="num" id="3469969">0</span><span class="op" id="3469970">,</span>&nbsp;<span class="string" id="3469972">&#34;listen&#34;</span><span class="op" id="3469980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3469983">if</span>&nbsp;<span class="ident" id="3469986">err</span>&nbsp;<span class="op" id="3469990">!=</span>&nbsp;<span class="ident" id="3469993">nil</span>&nbsp;<span class="op" id="3469997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470001">return</span>&nbsp;<span class="ident" id="3470008">nil</span><span class="op" id="3470011">,</span>&nbsp;<span class="op" id="3470013">&amp;</span><span class="ident" id="3470014">OpError</span><span class="op" id="3470021">{</span><span class="ident" id="3470022">Op</span><span class="op" id="3470024">:</span>&nbsp;<span class="string" id="3470026">&#34;listen&#34;</span><span class="op" id="3470034">,</span>&nbsp;<span class="ident" id="3470036">Net</span><span class="op" id="3470039">:</span>&nbsp;<span class="ident" id="3470041">net</span><span class="op" id="3470044">,</span>&nbsp;<span class="ident" id="3470046">Addr</span><span class="op" id="3470050">:</span>&nbsp;<span class="ident" id="3470052">gaddr</span><span class="op" id="3470057">,</span>&nbsp;<span class="ident" id="3470059">Err</span><span class="op" id="3470062">:</span>&nbsp;<span class="ident" id="3470064">err</span><span class="op" id="3470067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3470070">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3470073">c</span>&nbsp;<span class="op" id="3470075">:=</span>&nbsp;<span class="ident" id="3470078">newUDPConn</span><span class="op" id="3470088">(</span><span class="ident" id="3470089">fd</span><span class="op" id="3470091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470094">if</span>&nbsp;<span class="ident" id="3470097">ip4</span>&nbsp;<span class="op" id="3470101">:=</span>&nbsp;<span class="ident" id="3470104">gaddr</span><span class="op" id="3470109">.</span><span class="ident" id="3470110">IP</span><span class="op" id="3470112">.</span><span class="ident" id="3470113">To4</span><span class="op" id="3470116">(</span><span class="op" id="3470117">)</span><span class="op" id="3470118">;</span>&nbsp;<span class="ident" id="3470120">ip4</span>&nbsp;<span class="op" id="3470124">!=</span>&nbsp;<span class="ident" id="3470127">nil</span>&nbsp;<span class="op" id="3470131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470135">if</span>&nbsp;<span class="ident" id="3470138">err</span>&nbsp;<span class="op" id="3470142">:=</span>&nbsp;<span class="ident" id="3470145">listenIPv4MulticastUDP</span><span class="op" id="3470167">(</span><span class="ident" id="3470168">c</span><span class="op" id="3470169">,</span>&nbsp;<span class="ident" id="3470171">ifi</span><span class="op" id="3470174">,</span>&nbsp;<span class="ident" id="3470176">ip4</span><span class="op" id="3470179">)</span><span class="op" id="3470180">;</span>&nbsp;<span class="ident" id="3470182">err</span>&nbsp;<span class="op" id="3470186">!=</span>&nbsp;<span class="ident" id="3470189">nil</span>&nbsp;<span class="op" id="3470193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3470198">c</span><span class="op" id="3470199">.</span><span class="ident" id="3470200">Close</span><span class="op" id="3470205">(</span><span class="op" id="3470206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470211">return</span>&nbsp;<span class="ident" id="3470218">nil</span><span class="op" id="3470221">,</span>&nbsp;<span class="op" id="3470223">&amp;</span><span class="ident" id="3470224">OpError</span><span class="op" id="3470231">{</span><span class="ident" id="3470232">Op</span><span class="op" id="3470234">:</span>&nbsp;<span class="string" id="3470236">&#34;listen&#34;</span><span class="op" id="3470244">,</span>&nbsp;<span class="ident" id="3470246">Net</span><span class="op" id="3470249">:</span>&nbsp;<span class="ident" id="3470251">net</span><span class="op" id="3470254">,</span>&nbsp;<span class="ident" id="3470256">Addr</span><span class="op" id="3470260">:</span>&nbsp;<span class="op" id="3470262">&amp;</span><span class="ident" id="3470263">IPAddr</span><span class="op" id="3470269">{</span><span class="ident" id="3470270">IP</span><span class="op" id="3470272">:</span>&nbsp;<span class="ident" id="3470274">ip4</span><span class="op" id="3470277">}</span><span class="op" id="3470278">,</span>&nbsp;<span class="ident" id="3470280">Err</span><span class="op" id="3470283">:</span>&nbsp;<span class="ident" id="3470285">err</span><span class="op" id="3470288">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3470292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3470295">}</span>&nbsp;<span class="keyword" id="3470297">else</span>&nbsp;<span class="op" id="3470302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470306">if</span>&nbsp;<span class="ident" id="3470309">err</span>&nbsp;<span class="op" id="3470313">:=</span>&nbsp;<span class="ident" id="3470316">listenIPv6MulticastUDP</span><span class="op" id="3470338">(</span><span class="ident" id="3470339">c</span><span class="op" id="3470340">,</span>&nbsp;<span class="ident" id="3470342">ifi</span><span class="op" id="3470345">,</span>&nbsp;<span class="ident" id="3470347">gaddr</span><span class="op" id="3470352">.</span><span class="ident" id="3470353">IP</span><span class="op" id="3470355">)</span><span class="op" id="3470356">;</span>&nbsp;<span class="ident" id="3470358">err</span>&nbsp;<span class="op" id="3470362">!=</span>&nbsp;<span class="ident" id="3470365">nil</span>&nbsp;<span class="op" id="3470369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3470374">c</span><span class="op" id="3470375">.</span><span class="ident" id="3470376">Close</span><span class="op" id="3470381">(</span><span class="op" id="3470382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470387">return</span>&nbsp;<span class="ident" id="3470394">nil</span><span class="op" id="3470397">,</span>&nbsp;<span class="op" id="3470399">&amp;</span><span class="ident" id="3470400">OpError</span><span class="op" id="3470407">{</span><span class="ident" id="3470408">Op</span><span class="op" id="3470410">:</span>&nbsp;<span class="string" id="3470412">&#34;listen&#34;</span><span class="op" id="3470420">,</span>&nbsp;<span class="ident" id="3470422">Net</span><span class="op" id="3470425">:</span>&nbsp;<span class="ident" id="3470427">net</span><span class="op" id="3470430">,</span>&nbsp;<span class="ident" id="3470432">Addr</span><span class="op" id="3470436">:</span>&nbsp;<span class="op" id="3470438">&amp;</span><span class="ident" id="3470439">IPAddr</span><span class="op" id="3470445">{</span><span class="ident" id="3470446">IP</span><span class="op" id="3470448">:</span>&nbsp;<span class="ident" id="3470450">gaddr</span><span class="op" id="3470455">.</span><span class="ident" id="3470456">IP</span><span class="op" id="3470458">}</span><span class="op" id="3470459">,</span>&nbsp;<span class="ident" id="3470461">Err</span><span class="op" id="3470464">:</span>&nbsp;<span class="ident" id="3470466">err</span><span class="op" id="3470469">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3470473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3470476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470479">return</span>&nbsp;<span class="ident" id="3470486">c</span><span class="op" id="3470487">,</span>&nbsp;<span class="ident" id="3470489">nil</span><br>
<span class="lineno"></span><span class="op" id="3470493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="3470496">func</span>&nbsp;<span class="ident" id="3470501">listenIPv4MulticastUDP</span><span class="op" id="3470523">(</span><span class="ident" id="3470524">c</span>&nbsp;<span class="op" id="3470526">*</span><span class="ident" id="3470527">UDPConn</span><span class="op" id="3470534">,</span>&nbsp;<span class="ident" id="3470536">ifi</span>&nbsp;<span class="op" id="3470540">*</span><span class="ident" id="3470541">Interface</span><span class="op" id="3470550">,</span>&nbsp;<span class="ident" id="3470552">ip</span>&nbsp;<span class="ident" id="3470555">IP</span><span class="op" id="3470557">)</span>&nbsp;<span class="builtintype" id="3470559">error</span>&nbsp;<span class="op" id="3470565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470568">if</span>&nbsp;<span class="ident" id="3470571">ifi</span>&nbsp;<span class="op" id="3470575">!=</span>&nbsp;<span class="ident" id="3470578">nil</span>&nbsp;<span class="op" id="3470582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470586">if</span>&nbsp;<span class="ident" id="3470589">err</span>&nbsp;<span class="op" id="3470593">:=</span>&nbsp;<span class="ident" id="3470596">setIPv4MulticastInterface</span><span class="op" id="3470621">(</span><span class="ident" id="3470622">c</span><span class="op" id="3470623">.</span><span class="ident" id="3470624">fd</span><span class="op" id="3470626">,</span>&nbsp;<span class="ident" id="3470628">ifi</span><span class="op" id="3470631">)</span><span class="op" id="3470632">;</span>&nbsp;<span class="ident" id="3470634">err</span>&nbsp;<span class="op" id="3470638">!=</span>&nbsp;<span class="ident" id="3470641">nil</span>&nbsp;<span class="op" id="3470645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470650">return</span>&nbsp;<span class="ident" id="3470657">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3470663">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3470666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470669">if</span>&nbsp;<span class="ident" id="3470672">err</span>&nbsp;<span class="op" id="3470676">:=</span>&nbsp;<span class="ident" id="3470679">setIPv4MulticastLoopback</span><span class="op" id="3470703">(</span><span class="ident" id="3470704">c</span><span class="op" id="3470705">.</span><span class="ident" id="3470706">fd</span><span class="op" id="3470708">,</span>&nbsp;<span class="ident" id="3470710">false</span><span class="op" id="3470715">)</span><span class="op" id="3470716">;</span>&nbsp;<span class="ident" id="3470718">err</span>&nbsp;<span class="op" id="3470722">!=</span>&nbsp;<span class="ident" id="3470725">nil</span>&nbsp;<span class="op" id="3470729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470733">return</span>&nbsp;<span class="ident" id="3470740">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3470745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470748">if</span>&nbsp;<span class="ident" id="3470751">err</span>&nbsp;<span class="op" id="3470755">:=</span>&nbsp;<span class="ident" id="3470758">joinIPv4Group</span><span class="op" id="3470771">(</span><span class="ident" id="3470772">c</span><span class="op" id="3470773">.</span><span class="ident" id="3470774">fd</span><span class="op" id="3470776">,</span>&nbsp;<span class="ident" id="3470778">ifi</span><span class="op" id="3470781">,</span>&nbsp;<span class="ident" id="3470783">ip</span><span class="op" id="3470785">)</span><span class="op" id="3470786">;</span>&nbsp;<span class="ident" id="3470788">err</span>&nbsp;<span class="op" id="3470792">!=</span>&nbsp;<span class="ident" id="3470795">nil</span>&nbsp;<span class="op" id="3470799">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470803">return</span>&nbsp;<span class="ident" id="3470810">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3470815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470818">return</span>&nbsp;<span class="ident" id="3470825">nil</span><br>
<span class="lineno"></span><span class="op" id="3470829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3470832">func</span>&nbsp;<span class="ident" id="3470837">listenIPv6MulticastUDP</span><span class="op" id="3470859">(</span><span class="ident" id="3470860">c</span>&nbsp;<span class="op" id="3470862">*</span><span class="ident" id="3470863">UDPConn</span><span class="op" id="3470870">,</span>&nbsp;<span class="ident" id="3470872">ifi</span>&nbsp;<span class="op" id="3470876">*</span><span class="ident" id="3470877">Interface</span><span class="op" id="3470886">,</span>&nbsp;<span class="ident" id="3470888">ip</span>&nbsp;<span class="ident" id="3470891">IP</span><span class="op" id="3470893">)</span>&nbsp;<span class="builtintype" id="3470895">error</span>&nbsp;<span class="op" id="3470901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470904">if</span>&nbsp;<span class="ident" id="3470907">ifi</span>&nbsp;<span class="op" id="3470911">!=</span>&nbsp;<span class="ident" id="3470914">nil</span>&nbsp;<span class="op" id="3470918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470922">if</span>&nbsp;<span class="ident" id="3470925">err</span>&nbsp;<span class="op" id="3470929">:=</span>&nbsp;<span class="ident" id="3470932">setIPv6MulticastInterface</span><span class="op" id="3470957">(</span><span class="ident" id="3470958">c</span><span class="op" id="3470959">.</span><span class="ident" id="3470960">fd</span><span class="op" id="3470962">,</span>&nbsp;<span class="ident" id="3470964">ifi</span><span class="op" id="3470967">)</span><span class="op" id="3470968">;</span>&nbsp;<span class="ident" id="3470970">err</span>&nbsp;<span class="op" id="3470974">!=</span>&nbsp;<span class="ident" id="3470977">nil</span>&nbsp;<span class="op" id="3470981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3470986">return</span>&nbsp;<span class="ident" id="3470993">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3470999">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3471002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471005">if</span>&nbsp;<span class="ident" id="3471008">err</span>&nbsp;<span class="op" id="3471012">:=</span>&nbsp;<span class="ident" id="3471015">setIPv6MulticastLoopback</span><span class="op" id="3471039">(</span><span class="ident" id="3471040">c</span><span class="op" id="3471041">.</span><span class="ident" id="3471042">fd</span><span class="op" id="3471044">,</span>&nbsp;<span class="ident" id="3471046">false</span><span class="op" id="3471051">)</span><span class="op" id="3471052">;</span>&nbsp;<span class="ident" id="3471054">err</span>&nbsp;<span class="op" id="3471058">!=</span>&nbsp;<span class="ident" id="3471061">nil</span>&nbsp;<span class="op" id="3471065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471069">return</span>&nbsp;<span class="ident" id="3471076">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3471081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471084">if</span>&nbsp;<span class="ident" id="3471087">err</span>&nbsp;<span class="op" id="3471091">:=</span>&nbsp;<span class="ident" id="3471094">joinIPv6Group</span><span class="op" id="3471107">(</span><span class="ident" id="3471108">c</span><span class="op" id="3471109">.</span><span class="ident" id="3471110">fd</span><span class="op" id="3471112">,</span>&nbsp;<span class="ident" id="3471114">ifi</span><span class="op" id="3471117">,</span>&nbsp;<span class="ident" id="3471119">ip</span><span class="op" id="3471121">)</span><span class="op" id="3471122">;</span>&nbsp;<span class="ident" id="3471124">err</span>&nbsp;<span class="op" id="3471128">!=</span>&nbsp;<span class="ident" id="3471131">nil</span>&nbsp;<span class="op" id="3471135">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471139">return</span>&nbsp;<span class="ident" id="3471146">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3471151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471154">return</span>&nbsp;<span class="ident" id="3471161">nil</span><br>
<span class="lineno"></span><span class="op" id="3471165">}</span>
</div>
</body>
</html>
