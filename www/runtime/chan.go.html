<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1884884">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1884939">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1884993">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1885044">package</span>&nbsp;<span class="ident" id="1885052">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1885061">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;the&nbsp;implementation&nbsp;of&nbsp;Go&nbsp;channels.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1885119">import</span>&nbsp;<span class="string" id="1885126">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1885136">const</span>&nbsp;<span class="op" id="1885142">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885145">maxAlign</span>&nbsp;&nbsp;<span class="op" id="1885155">=</span>&nbsp;<span class="num" id="1885157">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885160">hchanSize</span>&nbsp;<span class="op" id="1885170">=</span>&nbsp;<span class="ident" id="1885172"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1885178">.</span><span class="ident" id="1885179">Sizeof</span><span class="op" id="1885185">(</span><span class="ident" id="1885186"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1885191">{</span><span class="op" id="1885192">}</span><span class="op" id="1885193">)</span>&nbsp;<span class="op" id="1885195">+</span>&nbsp;<span class="builtintype" id="1885197">uintptr</span><span class="op" id="1885204">(</span><span class="op" id="1885205">-</span><span class="builtintype" id="1885206">int</span><span class="op" id="1885209">(</span><span class="ident" id="1885210"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1885216">.</span><span class="ident" id="1885217">Sizeof</span><span class="op" id="1885223">(</span><span class="ident" id="1885224"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1885229">{</span><span class="op" id="1885230">}</span><span class="op" id="1885231">)</span><span class="op" id="1885232">)</span><span class="op" id="1885233">&amp;</span><span class="op" id="1885234">(</span><span class="ident" id="1885235"><a href="/runtime/chan.go.html#1885145">maxAlign</a></span><span class="op" id="1885243">-</span><span class="num" id="1885244">1</span><span class="op" id="1885245">)</span><span class="op" id="1885246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885249">debugChan</span>&nbsp;<span class="op" id="1885259">=</span>&nbsp;<span class="builtintype" id="1885261">false</span><br>
<span class="lineno">15</span><span class="op" id="1885267">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1885270">//&nbsp;TODO(khr):&nbsp;make&nbsp;hchan.buf&nbsp;an&nbsp;unsafe.Pointer,&nbsp;not&nbsp;a&nbsp;*uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1885332">func</span>&nbsp;<span class="ident" id="1885337">makechan</span><span class="op" id="1885345">(</span><span class="ident" id="1885346">t</span>&nbsp;<span class="op" id="1885348">*</span><span class="ident" id="1885349"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189434">chantype</a></span><span class="op" id="1885357">,</span>&nbsp;<span class="ident" id="1885359">size</span>&nbsp;<span class="ident" id="1885364">int64</span><span class="op" id="1885369">)</span>&nbsp;<span class="op" id="1885371">*</span><span class="ident" id="1885372"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span>&nbsp;<span class="op" id="1885378">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885381">elem</span>&nbsp;<span class="op" id="1885386">:=</span>&nbsp;<span class="ident" id="1885389"><a href="/runtime/chan.go.html#1885346">t</a></span><span class="op" id="1885390">.</span><span class="ident" id="1885391">elem</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1885398">//&nbsp;compiler&nbsp;checks&nbsp;this&nbsp;but&nbsp;be&nbsp;safe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885436">if</span>&nbsp;<span class="ident" id="1885439"><a href="/runtime/chan.go.html#1885381">elem</a></span><span class="op" id="1885443">.</span><span class="ident" id="1885444">size</span>&nbsp;<span class="op" id="1885449">&gt;=</span>&nbsp;<span class="num" id="1885452">1</span><span class="op" id="1885453">&lt;&lt;</span><span class="num" id="1885455">16</span>&nbsp;<span class="op" id="1885458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885462"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1885469">(</span><span class="string" id="1885470">&#34;makechan:&nbsp;invalid&nbsp;channel&nbsp;element&nbsp;type&#34;</span><span class="op" id="1885510">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1885513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885516">if</span>&nbsp;<span class="ident" id="1885519"><a href="/runtime/chan.go.html#1885160">hchanSize</a></span><span class="op" id="1885528">%</span><span class="ident" id="1885529"><a href="/runtime/chan.go.html#1885145">maxAlign</a></span>&nbsp;<span class="op" id="1885538">!=</span>&nbsp;<span class="num" id="1885541">0</span>&nbsp;<span class="op" id="1885543">||</span>&nbsp;<span class="ident" id="1885546"><a href="/runtime/chan.go.html#1885381">elem</a></span><span class="op" id="1885550">.</span><span class="ident" id="1885551">align</span>&nbsp;<span class="op" id="1885557">&gt;</span>&nbsp;<span class="ident" id="1885559"><a href="/runtime/chan.go.html#1885145">maxAlign</a></span>&nbsp;<span class="op" id="1885568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1885572"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1885579">(</span><span class="string" id="1885580">&#34;makechan:&nbsp;bad&nbsp;alignment&#34;</span><span class="op" id="1885605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1885608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885611">if</span>&nbsp;<span class="ident" id="1885614"><a href="/runtime/chan.go.html#1885359">size</a></span>&nbsp;<span class="op" id="1885619">&lt;</span>&nbsp;<span class="num" id="1885621">0</span>&nbsp;<span class="op" id="1885623">||</span>&nbsp;<span class="ident" id="1885626">int64</span><span class="op" id="1885631">(</span><span class="builtintype" id="1885632">uintptr</span><span class="op" id="1885639">(</span><span class="ident" id="1885640"><a href="/runtime/chan.go.html#1885359">size</a></span><span class="op" id="1885644">)</span><span class="op" id="1885645">)</span>&nbsp;<span class="op" id="1885647">!=</span>&nbsp;<span class="ident" id="1885650"><a href="/runtime/chan.go.html#1885359">size</a></span>&nbsp;<span class="op" id="1885655">||</span>&nbsp;<span class="op" id="1885658">(</span><span class="ident" id="1885659"><a href="/runtime/chan.go.html#1885381">elem</a></span><span class="op" id="1885663">.</span><span class="ident" id="1885664">size</span>&nbsp;<span class="op" id="1885669">&gt;</span>&nbsp;<span class="num" id="1885671">0</span>&nbsp;<span class="op" id="1885673">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1885676">uintptr</span><span class="op" id="1885683">(</span><span class="ident" id="1885684"><a href="/runtime/chan.go.html#1885359">size</a></span><span class="op" id="1885688">)</span>&nbsp;<span class="op" id="1885690">&gt;</span>&nbsp;<span class="op" id="1885692">(</span><span class="ident" id="1885693"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2194990">maxmem</a></span><span class="op" id="1885699">-</span><span class="ident" id="1885700"><a href="/runtime/chan.go.html#1885160">hchanSize</a></span><span class="op" id="1885709">)</span><span class="op" id="1885710">/</span><span class="builtintype" id="1885711">uintptr</span><span class="op" id="1885718">(</span><span class="ident" id="1885719"><a href="/runtime/chan.go.html#1885381">elem</a></span><span class="op" id="1885723">.</span><span class="ident" id="1885724">size</span><span class="op" id="1885728">)</span><span class="op" id="1885729">)</span>&nbsp;<span class="op" id="1885731">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1885735">panic</span><span class="op" id="1885740">(</span><span class="string" id="1885741">&#34;makechan:&nbsp;size&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1885770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1885773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885777">var</span>&nbsp;<span class="ident" id="1885781">c</span>&nbsp;<span class="op" id="1885783">*</span><span class="ident" id="1885784"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1885791">if</span>&nbsp;<span class="ident" id="1885794"><a href="/runtime/chan.go.html#1885381">elem</a></span><span class="op" id="1885798">.</span><span class="ident" id="1885799">kind</span><span class="op" id="1885803">&amp;</span><span class="ident" id="1885804"><a href="/runtime/typekind.go.html#2178349">kindNoPointers</a></span>&nbsp;<span class="op" id="1885819">!=</span>&nbsp;<span class="num" id="1885822">0</span>&nbsp;<span class="op" id="1885824">||</span>&nbsp;<span class="ident" id="1885827"><a href="/runtime/chan.go.html#1885359">size</a></span>&nbsp;<span class="op" id="1885832">==</span>&nbsp;<span class="num" id="1885835">0</span>&nbsp;<span class="op" id="1885837">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1885841">//&nbsp;Allocate&nbsp;memory&nbsp;in&nbsp;one&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1885875">//&nbsp;Hchan&nbsp;does&nbsp;not&nbsp;contain&nbsp;pointers&nbsp;interesting&nbsp;for&nbsp;GC&nbsp;in&nbsp;this&nbsp;case:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1885945">//&nbsp;buf&nbsp;points&nbsp;into&nbsp;the&nbsp;same&nbsp;allocation,&nbsp;elemtype&nbsp;is&nbsp;persistent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1886011">//&nbsp;SudoG&#39;s&nbsp;are&nbsp;referenced&nbsp;from&nbsp;their&nbsp;owning&nbsp;thread&nbsp;so&nbsp;they&nbsp;can&#39;t&nbsp;be&nbsp;collected.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1886092">//&nbsp;TODO(dvyukov,rlh):&nbsp;Rethink&nbsp;when&nbsp;collector&nbsp;can&nbsp;move&nbsp;allocated&nbsp;objects.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886167"><a href="/runtime/chan.go.html#1885781">c</a></span>&nbsp;<span class="op" id="1886169">=</span>&nbsp;<span class="op" id="1886171">(</span><span class="op" id="1886172">*</span><span class="ident" id="1886173"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1886178">)</span><span class="op" id="1886179">(</span><span class="ident" id="1886180"><a href="/runtime/malloc.go.html#1982729">mallocgc</a></span><span class="op" id="1886188">(</span><span class="ident" id="1886189"><a href="/runtime/chan.go.html#1885160">hchanSize</a></span><span class="op" id="1886198">+</span><span class="builtintype" id="1886199">uintptr</span><span class="op" id="1886206">(</span><span class="ident" id="1886207"><a href="/runtime/chan.go.html#1885359">size</a></span><span class="op" id="1886211">)</span><span class="op" id="1886212">*</span><span class="builtintype" id="1886213">uintptr</span><span class="op" id="1886220">(</span><span class="ident" id="1886221"><a href="/runtime/chan.go.html#1885381">elem</a></span><span class="op" id="1886225">.</span><span class="ident" id="1886226">size</span><span class="op" id="1886230">)</span><span class="op" id="1886231">,</span>&nbsp;<span class="ident" id="1886233">nil</span><span class="op" id="1886236">,</span>&nbsp;<span class="ident" id="1886238"><a href="/runtime/malloc.go.html#1981957">flagNoScan</a></span><span class="op" id="1886248">)</span><span class="op" id="1886249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1886253">if</span>&nbsp;<span class="ident" id="1886256"><a href="/runtime/chan.go.html#1885359">size</a></span>&nbsp;<span class="op" id="1886261">&gt;</span>&nbsp;<span class="num" id="1886263">0</span>&nbsp;<span class="op" id="1886265">&amp;&amp;</span>&nbsp;<span class="ident" id="1886268"><a href="/runtime/chan.go.html#1885381">elem</a></span><span class="op" id="1886272">.</span><span class="ident" id="1886273">size</span>&nbsp;<span class="op" id="1886278">!=</span>&nbsp;<span class="num" id="1886281">0</span>&nbsp;<span class="op" id="1886283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886288"><a href="/runtime/chan.go.html#1885781">c</a></span><span class="op" id="1886289">.</span><span class="ident" id="1886290">buf</span>&nbsp;<span class="op" id="1886294">=</span>&nbsp;<span class="op" id="1886296">(</span><span class="op" id="1886297">*</span><span class="builtintype" id="1886298">uint8</span><span class="op" id="1886303">)</span><span class="op" id="1886304">(</span><span class="ident" id="1886305"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="1886308">(</span><span class="ident" id="1886309"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1886315">.</span><span class="ident" id="1886316">Pointer</span><span class="op" id="1886323">(</span><span class="ident" id="1886324"><a href="/runtime/chan.go.html#1885781">c</a></span><span class="op" id="1886325">)</span><span class="op" id="1886326">,</span>&nbsp;<span class="ident" id="1886328"><a href="/runtime/chan.go.html#1885160">hchanSize</a></span><span class="op" id="1886337">)</span><span class="op" id="1886338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1886342">}</span>&nbsp;<span class="keyword" id="1886344">else</span>&nbsp;<span class="op" id="1886349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886354"><a href="/runtime/chan.go.html#1885781">c</a></span><span class="op" id="1886355">.</span><span class="ident" id="1886356">buf</span>&nbsp;<span class="op" id="1886360">=</span>&nbsp;<span class="op" id="1886362">(</span><span class="op" id="1886363">*</span><span class="builtintype" id="1886364">uint8</span><span class="op" id="1886369">)</span><span class="op" id="1886370">(</span><span class="ident" id="1886371"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1886377">.</span><span class="ident" id="1886378">Pointer</span><span class="op" id="1886385">(</span><span class="ident" id="1886386"><a href="/runtime/chan.go.html#1885781">c</a></span><span class="op" id="1886387">)</span><span class="op" id="1886388">)</span>&nbsp;<span class="comment" id="1886390">//&nbsp;race&nbsp;detector&nbsp;uses&nbsp;this&nbsp;location&nbsp;for&nbsp;synchronization</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1886448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1886451">}</span>&nbsp;<span class="keyword" id="1886453">else</span>&nbsp;<span class="op" id="1886458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886462"><a href="/runtime/chan.go.html#1885781">c</a></span>&nbsp;<span class="op" id="1886464">=</span>&nbsp;<span class="builtinfunc" id="1886466">new</span><span class="op" id="1886469">(</span><span class="ident" id="1886470"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1886475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886479"><a href="/runtime/chan.go.html#1885781">c</a></span><span class="op" id="1886480">.</span><span class="ident" id="1886481">buf</span>&nbsp;<span class="op" id="1886485">=</span>&nbsp;<span class="op" id="1886487">(</span><span class="op" id="1886488">*</span><span class="builtintype" id="1886489">uint8</span><span class="op" id="1886494">)</span><span class="op" id="1886495">(</span><span class="ident" id="1886496"><a href="/runtime/malloc.go.html#1991870">newarray</a></span><span class="op" id="1886504">(</span><span class="ident" id="1886505"><a href="/runtime/chan.go.html#1885381">elem</a></span><span class="op" id="1886509">,</span>&nbsp;<span class="builtintype" id="1886511">uintptr</span><span class="op" id="1886518">(</span><span class="ident" id="1886519"><a href="/runtime/chan.go.html#1885359">size</a></span><span class="op" id="1886523">)</span><span class="op" id="1886524">)</span><span class="op" id="1886525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1886528">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886531"><a href="/runtime/chan.go.html#1885781">c</a></span><span class="op" id="1886532">.</span><span class="ident" id="1886533">elemsize</span>&nbsp;<span class="op" id="1886542">=</span>&nbsp;<span class="builtintype" id="1886544">uint16</span><span class="op" id="1886550">(</span><span class="ident" id="1886551"><a href="/runtime/chan.go.html#1885381">elem</a></span><span class="op" id="1886555">.</span><span class="ident" id="1886556">size</span><span class="op" id="1886560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886563"><a href="/runtime/chan.go.html#1885781">c</a></span><span class="op" id="1886564">.</span><span class="ident" id="1886565">elemtype</span>&nbsp;<span class="op" id="1886574">=</span>&nbsp;<span class="ident" id="1886576"><a href="/runtime/chan.go.html#1885381">elem</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1886582"><a href="/runtime/chan.go.html#1885781">c</a></span><span class="op" id="1886583">.</span><span class="ident" id="1886584">dataqsiz</span>&nbsp;<span class="op" id="1886593">=</span>&nbsp;<span class="builtintype" id="1886595">uint</span><span class="op" id="1886599">(</span><span class="ident" id="1886600"><a href="/runtime/chan.go.html#1885359">size</a></span><span class="op" id="1886604">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1886608">if</span>&nbsp;<span class="ident" id="1886611"><a href="/runtime/chan.go.html#1885249">debugChan</a></span>&nbsp;<span class="op" id="1886621">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1886625">print</span><span class="op" id="1886630">(</span><span class="string" id="1886631">&#34;makechan:&nbsp;chan=&#34;</span><span class="op" id="1886648">,</span>&nbsp;<span class="ident" id="1886650"><a href="/runtime/chan.go.html#1885781">c</a></span><span class="op" id="1886651">,</span>&nbsp;<span class="string" id="1886653">&#34;;&nbsp;elemsize=&#34;</span><span class="op" id="1886666">,</span>&nbsp;<span class="ident" id="1886668"><a href="/runtime/chan.go.html#1885381">elem</a></span><span class="op" id="1886672">.</span><span class="ident" id="1886673">size</span><span class="op" id="1886677">,</span>&nbsp;<span class="string" id="1886679">&#34;;&nbsp;elemalg=&#34;</span><span class="op" id="1886691">,</span>&nbsp;<span class="ident" id="1886693"><a href="/runtime/chan.go.html#1885381">elem</a></span><span class="op" id="1886697">.</span><span class="ident" id="1886698">alg</span><span class="op" id="1886701">,</span>&nbsp;<span class="string" id="1886703">&#34;;&nbsp;dataqsiz=&#34;</span><span class="op" id="1886716">,</span>&nbsp;<span class="ident" id="1886718"><a href="/runtime/chan.go.html#1885359">size</a></span><span class="op" id="1886722">,</span>&nbsp;<span class="string" id="1886724">&#34;\n&#34;</span><span class="op" id="1886728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1886731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1886734">return</span>&nbsp;<span class="ident" id="1886741"><a href="/runtime/chan.go.html#1885781">c</a></span><br>
<span class="lineno"></span><span class="op" id="1886743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="1886746">//&nbsp;chanbuf(c,&nbsp;i)&nbsp;is&nbsp;pointer&nbsp;to&nbsp;the&nbsp;i&#39;th&nbsp;slot&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1886806">func</span>&nbsp;<span class="ident" id="1886811">chanbuf</span><span class="op" id="1886818">(</span><span class="ident" id="1886819">c</span>&nbsp;<span class="op" id="1886821">*</span><span class="ident" id="1886822"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1886827">,</span>&nbsp;<span class="ident" id="1886829">i</span>&nbsp;<span class="builtintype" id="1886831">uint</span><span class="op" id="1886835">)</span>&nbsp;<span class="ident" id="1886837"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1886843">.</span><span class="ident" id="1886844">Pointer</span>&nbsp;<span class="op" id="1886852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1886855">return</span>&nbsp;<span class="ident" id="1886862"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="1886865">(</span><span class="ident" id="1886866"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1886872">.</span><span class="ident" id="1886873">Pointer</span><span class="op" id="1886880">(</span><span class="ident" id="1886881"><a href="/runtime/chan.go.html#1886819">c</a></span><span class="op" id="1886882">.</span><span class="ident" id="1886883">buf</span><span class="op" id="1886886">)</span><span class="op" id="1886887">,</span>&nbsp;<span class="builtintype" id="1886889">uintptr</span><span class="op" id="1886896">(</span><span class="ident" id="1886897"><a href="/runtime/chan.go.html#1886829">i</a></span><span class="op" id="1886898">)</span><span class="op" id="1886899">*</span><span class="builtintype" id="1886900">uintptr</span><span class="op" id="1886907">(</span><span class="ident" id="1886908"><a href="/runtime/chan.go.html#1886819">c</a></span><span class="op" id="1886909">.</span><span class="ident" id="1886910">elemsize</span><span class="op" id="1886918">)</span><span class="op" id="1886919">)</span><br>
<span class="lineno"></span><span class="op" id="1886921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="1886924">//&nbsp;entry&nbsp;point&nbsp;for&nbsp;c&nbsp;&lt;-&nbsp;x&nbsp;from&nbsp;compiled&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="1886969">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1886982">func</span>&nbsp;<span class="ident" id="1886987">chansend1</span><span class="op" id="1886996">(</span><span class="ident" id="1886997">t</span>&nbsp;<span class="op" id="1886999">*</span><span class="ident" id="1887000"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189434">chantype</a></span><span class="op" id="1887008">,</span>&nbsp;<span class="ident" id="1887010">c</span>&nbsp;<span class="op" id="1887012">*</span><span class="ident" id="1887013"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1887018">,</span>&nbsp;<span class="ident" id="1887020">elem</span>&nbsp;<span class="ident" id="1887025"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1887031">.</span><span class="ident" id="1887032">Pointer</span><span class="op" id="1887039">)</span>&nbsp;<span class="op" id="1887041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1887044"><a href="/runtime/chan.go.html#1887446">chansend</a></span><span class="op" id="1887052">(</span><span class="ident" id="1887053"><a href="/runtime/chan.go.html#1886997">t</a></span><span class="op" id="1887054">,</span>&nbsp;<span class="ident" id="1887056"><a href="/runtime/chan.go.html#1887010">c</a></span><span class="op" id="1887057">,</span>&nbsp;<span class="ident" id="1887059"><a href="/runtime/chan.go.html#1887020">elem</a></span><span class="op" id="1887063">,</span>&nbsp;<span class="builtintype" id="1887065">true</span><span class="op" id="1887069">,</span>&nbsp;<span class="ident" id="1887071"><a href="/runtime/stubs.go.html#2139499">getcallerpc</a></span><span class="op" id="1887082">(</span><span class="ident" id="1887083"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1887089">.</span><span class="ident" id="1887090">Pointer</span><span class="op" id="1887097">(</span><span class="op" id="1887098">&amp;</span><span class="ident" id="1887099"><a href="/runtime/chan.go.html#1886997">t</a></span><span class="op" id="1887100">)</span><span class="op" id="1887101">)</span><span class="op" id="1887102">)</span><br>
<span class="lineno"></span><span class="op" id="1887104">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="1887107">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;generic&nbsp;single&nbsp;channel&nbsp;send/recv<br>
<span class="lineno"></span>&nbsp;*&nbsp;If&nbsp;block&nbsp;is&nbsp;not&nbsp;nil,<br>
<span class="lineno"></span>&nbsp;*&nbsp;then&nbsp;the&nbsp;protocol&nbsp;will&nbsp;not<br>
<span class="lineno">75</span>&nbsp;*&nbsp;sleep&nbsp;but&nbsp;return&nbsp;if&nbsp;it&nbsp;could<br>
<span class="lineno"></span>&nbsp;*&nbsp;not&nbsp;complete.<br>
<span class="lineno"></span>&nbsp;*<br>
<span class="lineno"></span>&nbsp;*&nbsp;sleep&nbsp;can&nbsp;wake&nbsp;up&nbsp;with&nbsp;g.param&nbsp;==&nbsp;nil<br>
<span class="lineno"></span>&nbsp;*&nbsp;when&nbsp;a&nbsp;channel&nbsp;involved&nbsp;in&nbsp;the&nbsp;sleep&nbsp;has<br>
<span class="lineno">80</span>&nbsp;*&nbsp;been&nbsp;closed.&nbsp;&nbsp;it&nbsp;is&nbsp;easiest&nbsp;to&nbsp;loop&nbsp;and&nbsp;re-run<br>
<span class="lineno"></span>&nbsp;*&nbsp;the&nbsp;operation;&nbsp;we&#39;ll&nbsp;see&nbsp;that&nbsp;it&#39;s&nbsp;now&nbsp;closed.<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><span class="keyword" id="1887441">func</span>&nbsp;<span class="ident" id="1887446">chansend</span><span class="op" id="1887454">(</span><span class="ident" id="1887455">t</span>&nbsp;<span class="op" id="1887457">*</span><span class="ident" id="1887458"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189434">chantype</a></span><span class="op" id="1887466">,</span>&nbsp;<span class="ident" id="1887468">c</span>&nbsp;<span class="op" id="1887470">*</span><span class="ident" id="1887471"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1887476">,</span>&nbsp;<span class="ident" id="1887478">ep</span>&nbsp;<span class="ident" id="1887481"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1887487">.</span><span class="ident" id="1887488">Pointer</span><span class="op" id="1887495">,</span>&nbsp;<span class="ident" id="1887497">block</span>&nbsp;<span class="builtintype" id="1887503">bool</span><span class="op" id="1887507">,</span>&nbsp;<span class="ident" id="1887509">callerpc</span>&nbsp;<span class="builtintype" id="1887518">uintptr</span><span class="op" id="1887525">)</span>&nbsp;<span class="builtintype" id="1887527">bool</span>&nbsp;<span class="op" id="1887532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1887535">if</span>&nbsp;<span class="ident" id="1887538"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="1887550">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1887554"><a href="/runtime/race0.go.html#2069718">raceReadObjectPC</a></span><span class="op" id="1887570">(</span><span class="ident" id="1887571"><a href="/runtime/chan.go.html#1887455">t</a></span><span class="op" id="1887572">.</span><span class="ident" id="1887573">elem</span><span class="op" id="1887577">,</span>&nbsp;<span class="ident" id="1887579"><a href="/runtime/chan.go.html#1887478">ep</a></span><span class="op" id="1887581">,</span>&nbsp;<span class="ident" id="1887583"><a href="/runtime/chan.go.html#1887509">callerpc</a></span><span class="op" id="1887591">,</span>&nbsp;<span class="ident" id="1887593"><a href="/runtime/proc.go.html#2068560">funcPC</a></span><span class="op" id="1887599">(</span><span class="ident" id="1887600"><a href="/runtime/chan.go.html#1887446">chansend</a></span><span class="op" id="1887608">)</span><span class="op" id="1887609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1887612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1887616">if</span>&nbsp;<span class="ident" id="1887619"><a href="/runtime/chan.go.html#1887468">c</a></span>&nbsp;<span class="op" id="1887621">==</span>&nbsp;<span class="ident" id="1887624">nil</span>&nbsp;<span class="op" id="1887628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1887632">if</span>&nbsp;<span class="op" id="1887635">!</span><span class="ident" id="1887636"><a href="/runtime/chan.go.html#1887497">block</a></span>&nbsp;<span class="op" id="1887642">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1887647">return</span>&nbsp;<span class="builtintype" id="1887654">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1887662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1887666"><a href="/runtime/proc.go.html#2066373">gopark</a></span><span class="op" id="1887672">(</span><span class="ident" id="1887673">nil</span><span class="op" id="1887676">,</span>&nbsp;<span class="ident" id="1887678">nil</span><span class="op" id="1887681">,</span>&nbsp;<span class="string" id="1887683">&#34;chan&nbsp;send&nbsp;(nil&nbsp;chan)&#34;</span><span class="op" id="1887705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1887709"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1887716">(</span><span class="string" id="1887717">&#34;unreachable&#34;</span><span class="op" id="1887730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1887733">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1887737">if</span>&nbsp;<span class="ident" id="1887740"><a href="/runtime/chan.go.html#1885249">debugChan</a></span>&nbsp;<span class="op" id="1887750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1887754">print</span><span class="op" id="1887759">(</span><span class="string" id="1887760">&#34;chansend:&nbsp;chan=&#34;</span><span class="op" id="1887777">,</span>&nbsp;<span class="ident" id="1887779"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1887780">,</span>&nbsp;<span class="string" id="1887782">&#34;\n&#34;</span><span class="op" id="1887786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1887789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1887793">if</span>&nbsp;<span class="ident" id="1887796"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="1887808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1887812"><a href="/runtime/race0.go.html#2070294">racereadpc</a></span><span class="op" id="1887822">(</span><span class="ident" id="1887823"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1887829">.</span><span class="ident" id="1887830">Pointer</span><span class="op" id="1887837">(</span><span class="ident" id="1887838"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1887839">)</span><span class="op" id="1887840">,</span>&nbsp;<span class="ident" id="1887842"><a href="/runtime/chan.go.html#1887509">callerpc</a></span><span class="op" id="1887850">,</span>&nbsp;<span class="ident" id="1887852"><a href="/runtime/proc.go.html#2068560">funcPC</a></span><span class="op" id="1887858">(</span><span class="ident" id="1887859"><a href="/runtime/chan.go.html#1887446">chansend</a></span><span class="op" id="1887867">)</span><span class="op" id="1887868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1887871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1887875">//&nbsp;Fast&nbsp;path:&nbsp;check&nbsp;for&nbsp;failed&nbsp;non-blocking&nbsp;operation&nbsp;without&nbsp;acquiring&nbsp;the&nbsp;lock.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1887958">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1887962">//&nbsp;After&nbsp;observing&nbsp;that&nbsp;the&nbsp;channel&nbsp;is&nbsp;not&nbsp;closed,&nbsp;we&nbsp;observe&nbsp;that&nbsp;the&nbsp;channel&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1888045">//&nbsp;not&nbsp;ready&nbsp;for&nbsp;sending.&nbsp;Each&nbsp;of&nbsp;these&nbsp;observations&nbsp;is&nbsp;a&nbsp;single&nbsp;word-sized&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1888127">//&nbsp;(first&nbsp;c.closed&nbsp;and&nbsp;second&nbsp;c.recvq.first&nbsp;or&nbsp;c.qcount&nbsp;depending&nbsp;on&nbsp;kind&nbsp;of&nbsp;channel).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1888215">//&nbsp;Because&nbsp;a&nbsp;closed&nbsp;channel&nbsp;cannot&nbsp;transition&nbsp;from&nbsp;&#39;ready&nbsp;for&nbsp;sending&#39;&nbsp;to</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1888290">//&nbsp;&#39;not&nbsp;ready&nbsp;for&nbsp;sending&#39;,&nbsp;even&nbsp;if&nbsp;the&nbsp;channel&nbsp;is&nbsp;closed&nbsp;between&nbsp;the&nbsp;two&nbsp;observations,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1888379">//&nbsp;they&nbsp;imply&nbsp;a&nbsp;moment&nbsp;between&nbsp;the&nbsp;two&nbsp;when&nbsp;the&nbsp;channel&nbsp;was&nbsp;both&nbsp;not&nbsp;yet&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1888460">//&nbsp;and&nbsp;not&nbsp;ready&nbsp;for&nbsp;sending.&nbsp;We&nbsp;behave&nbsp;as&nbsp;if&nbsp;we&nbsp;observed&nbsp;the&nbsp;channel&nbsp;at&nbsp;that&nbsp;moment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1888547">//&nbsp;and&nbsp;report&nbsp;that&nbsp;the&nbsp;send&nbsp;cannot&nbsp;proceed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1888592">//</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1888596">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;if&nbsp;the&nbsp;reads&nbsp;are&nbsp;reordered&nbsp;here:&nbsp;if&nbsp;we&nbsp;observe&nbsp;that&nbsp;the&nbsp;channel&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1888682">//&nbsp;ready&nbsp;for&nbsp;sending&nbsp;and&nbsp;then&nbsp;observe&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;closed,&nbsp;that&nbsp;implies&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1888766">//&nbsp;channel&nbsp;wasn&#39;t&nbsp;closed&nbsp;during&nbsp;the&nbsp;first&nbsp;observation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1888822">if</span>&nbsp;<span class="op" id="1888825">!</span><span class="ident" id="1888826"><a href="/runtime/chan.go.html#1887497">block</a></span>&nbsp;<span class="op" id="1888832">&amp;&amp;</span>&nbsp;<span class="ident" id="1888835"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1888836">.</span><span class="ident" id="1888837">closed</span>&nbsp;<span class="op" id="1888844">==</span>&nbsp;<span class="num" id="1888847">0</span>&nbsp;<span class="op" id="1888849">&amp;&amp;</span>&nbsp;<span class="op" id="1888852">(</span><span class="op" id="1888853">(</span><span class="ident" id="1888854"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1888855">.</span><span class="ident" id="1888856">dataqsiz</span>&nbsp;<span class="op" id="1888865">==</span>&nbsp;<span class="num" id="1888868">0</span>&nbsp;<span class="op" id="1888870">&amp;&amp;</span>&nbsp;<span class="ident" id="1888873"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1888874">.</span><span class="ident" id="1888875">recvq</span><span class="op" id="1888880">.</span><span class="ident" id="1888881">first</span>&nbsp;<span class="op" id="1888887">==</span>&nbsp;<span class="ident" id="1888890">nil</span><span class="op" id="1888893">)</span>&nbsp;<span class="op" id="1888895">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1888900">(</span><span class="ident" id="1888901"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1888902">.</span><span class="ident" id="1888903">dataqsiz</span>&nbsp;<span class="op" id="1888912">&gt;</span>&nbsp;<span class="num" id="1888914">0</span>&nbsp;<span class="op" id="1888916">&amp;&amp;</span>&nbsp;<span class="ident" id="1888919"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1888920">.</span><span class="ident" id="1888921">qcount</span>&nbsp;<span class="op" id="1888928">==</span>&nbsp;<span class="ident" id="1888931"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1888932">.</span><span class="ident" id="1888933">dataqsiz</span><span class="op" id="1888941">)</span><span class="op" id="1888942">)</span>&nbsp;<span class="op" id="1888944">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1888948">return</span>&nbsp;<span class="builtintype" id="1888955">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1888962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1888966">var</span>&nbsp;<span class="ident" id="1888970">t0</span>&nbsp;<span class="ident" id="1888973">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1888980">if</span>&nbsp;<span class="ident" id="1888983"><a href="/runtime/mprof.go.html#2019313">blockprofilerate</a></span>&nbsp;<span class="op" id="1889000">&gt;</span>&nbsp;<span class="num" id="1889002">0</span>&nbsp;<span class="op" id="1889004">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889008"><a href="/runtime/chan.go.html#1888970">t0</a></span>&nbsp;<span class="op" id="1889011">=</span>&nbsp;<span class="ident" id="1889013"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="1889021">(</span><span class="op" id="1889022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1889025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889029"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="1889033">(</span><span class="op" id="1889034">&amp;</span><span class="ident" id="1889035"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1889036">.</span><span class="ident" id="1889037">lock</span><span class="op" id="1889041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1889044">if</span>&nbsp;<span class="ident" id="1889047"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1889048">.</span><span class="ident" id="1889049">closed</span>&nbsp;<span class="op" id="1889056">!=</span>&nbsp;<span class="num" id="1889059">0</span>&nbsp;<span class="op" id="1889061">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889065"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1889071">(</span><span class="op" id="1889072">&amp;</span><span class="ident" id="1889073"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1889074">.</span><span class="ident" id="1889075">lock</span><span class="op" id="1889079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1889083">panic</span><span class="op" id="1889088">(</span><span class="string" id="1889089">&#34;send&nbsp;on&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="1889113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1889116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1889120">if</span>&nbsp;<span class="ident" id="1889123"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1889124">.</span><span class="ident" id="1889125">dataqsiz</span>&nbsp;<span class="op" id="1889134">==</span>&nbsp;<span class="num" id="1889137">0</span>&nbsp;<span class="op" id="1889139">{</span>&nbsp;<span class="comment" id="1889141">//&nbsp;synchronous&nbsp;channel</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889166">sg</span>&nbsp;<span class="op" id="1889169">:=</span>&nbsp;<span class="ident" id="1889172"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1889173">.</span><span class="ident" id="1889174">recvq</span><span class="op" id="1889179">.</span><span class="ident" id="1889180">dequeue</span><span class="op" id="1889187">(</span><span class="op" id="1889188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1889192">if</span>&nbsp;<span class="ident" id="1889195"><a href="/runtime/chan.go.html#1889166">sg</a></span>&nbsp;<span class="op" id="1889198">!=</span>&nbsp;<span class="ident" id="1889201">nil</span>&nbsp;<span class="op" id="1889205">{</span>&nbsp;<span class="comment" id="1889207">//&nbsp;found&nbsp;a&nbsp;waiting&nbsp;receiver</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1889238">if</span>&nbsp;<span class="ident" id="1889241"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="1889253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889259"><a href="/runtime/chan.go.html#1899350">racesync</a></span><span class="op" id="1889267">(</span><span class="ident" id="1889268"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1889269">,</span>&nbsp;<span class="ident" id="1889271"><a href="/runtime/chan.go.html#1889166">sg</a></span><span class="op" id="1889273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1889278">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889283"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1889289">(</span><span class="op" id="1889290">&amp;</span><span class="ident" id="1889291"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1889292">.</span><span class="ident" id="1889293">lock</span><span class="op" id="1889297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889303">recvg</span>&nbsp;<span class="op" id="1889309">:=</span>&nbsp;<span class="ident" id="1889312"><a href="/runtime/chan.go.html#1889166">sg</a></span><span class="op" id="1889314">.</span><span class="ident" id="1889315">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1889320">if</span>&nbsp;<span class="ident" id="1889323"><a href="/runtime/chan.go.html#1889166">sg</a></span><span class="op" id="1889325">.</span><span class="ident" id="1889326">elem</span>&nbsp;<span class="op" id="1889331">!=</span>&nbsp;<span class="ident" id="1889334">nil</span>&nbsp;<span class="op" id="1889338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889344"><a href="/runtime/stubs.go.html#2135810">memmove</a></span><span class="op" id="1889351">(</span><span class="ident" id="1889352"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1889358">.</span><span class="ident" id="1889359">Pointer</span><span class="op" id="1889366">(</span><span class="ident" id="1889367"><a href="/runtime/chan.go.html#1889166">sg</a></span><span class="op" id="1889369">.</span><span class="ident" id="1889370">elem</span><span class="op" id="1889374">)</span><span class="op" id="1889375">,</span>&nbsp;<span class="ident" id="1889377"><a href="/runtime/chan.go.html#1887478">ep</a></span><span class="op" id="1889379">,</span>&nbsp;<span class="builtintype" id="1889381">uintptr</span><span class="op" id="1889388">(</span><span class="ident" id="1889389"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1889390">.</span><span class="ident" id="1889391">elemsize</span><span class="op" id="1889399">)</span><span class="op" id="1889400">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889406"><a href="/runtime/chan.go.html#1889166">sg</a></span><span class="op" id="1889408">.</span><span class="ident" id="1889409">elem</span>&nbsp;<span class="op" id="1889414">=</span>&nbsp;<span class="ident" id="1889416">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1889423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889428"><a href="/runtime/chan.go.html#1889303">recvg</a></span><span class="op" id="1889433">.</span><span class="ident" id="1889434">param</span>&nbsp;<span class="op" id="1889440">=</span>&nbsp;<span class="ident" id="1889442"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1889448">.</span><span class="ident" id="1889449">Pointer</span><span class="op" id="1889456">(</span><span class="ident" id="1889457"><a href="/runtime/chan.go.html#1889166">sg</a></span><span class="op" id="1889459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1889464">if</span>&nbsp;<span class="ident" id="1889467"><a href="/runtime/chan.go.html#1889166">sg</a></span><span class="op" id="1889469">.</span><span class="ident" id="1889470">releasetime</span>&nbsp;<span class="op" id="1889482">!=</span>&nbsp;<span class="num" id="1889485">0</span>&nbsp;<span class="op" id="1889487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889493"><a href="/runtime/chan.go.html#1889166">sg</a></span><span class="op" id="1889495">.</span><span class="ident" id="1889496">releasetime</span>&nbsp;<span class="op" id="1889508">=</span>&nbsp;<span class="ident" id="1889510"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="1889518">(</span><span class="op" id="1889519">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1889524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889529"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="1889536">(</span><span class="ident" id="1889537"><a href="/runtime/chan.go.html#1889303">recvg</a></span><span class="op" id="1889542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1889547">return</span>&nbsp;<span class="builtintype" id="1889554">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1889561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1889566">if</span>&nbsp;<span class="op" id="1889569">!</span><span class="ident" id="1889570"><a href="/runtime/chan.go.html#1887497">block</a></span>&nbsp;<span class="op" id="1889576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889581"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1889587">(</span><span class="op" id="1889588">&amp;</span><span class="ident" id="1889589"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1889590">.</span><span class="ident" id="1889591">lock</span><span class="op" id="1889595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1889600">return</span>&nbsp;<span class="builtintype" id="1889607">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1889615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1889620">//&nbsp;no&nbsp;receiver&nbsp;available:&nbsp;block&nbsp;on&nbsp;this&nbsp;channel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889671">gp</span>&nbsp;<span class="op" id="1889674">:=</span>&nbsp;<span class="ident" id="1889677"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="1889681">(</span><span class="op" id="1889682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889686">mysg</span>&nbsp;<span class="op" id="1889691">:=</span>&nbsp;<span class="ident" id="1889694"><a href="/runtime/proc.go.html#2067140">acquireSudog</a></span><span class="op" id="1889706">(</span><span class="op" id="1889707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889711"><a href="/runtime/chan.go.html#1889686">mysg</a></span><span class="op" id="1889715">.</span><span class="ident" id="1889716">releasetime</span>&nbsp;<span class="op" id="1889728">=</span>&nbsp;<span class="num" id="1889730">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1889734">if</span>&nbsp;<span class="ident" id="1889737"><a href="/runtime/chan.go.html#1888970">t0</a></span>&nbsp;<span class="op" id="1889740">!=</span>&nbsp;<span class="num" id="1889743">0</span>&nbsp;<span class="op" id="1889745">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889750"><a href="/runtime/chan.go.html#1889686">mysg</a></span><span class="op" id="1889754">.</span><span class="ident" id="1889755">releasetime</span>&nbsp;<span class="op" id="1889767">=</span>&nbsp;<span class="op" id="1889769">-</span><span class="num" id="1889770">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1889774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889778"><a href="/runtime/chan.go.html#1889686">mysg</a></span><span class="op" id="1889782">.</span><span class="ident" id="1889783">elem</span>&nbsp;<span class="op" id="1889788">=</span>&nbsp;<span class="ident" id="1889790"><a href="/runtime/chan.go.html#1887478">ep</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889795"><a href="/runtime/chan.go.html#1889686">mysg</a></span><span class="op" id="1889799">.</span><span class="ident" id="1889800">waitlink</span>&nbsp;<span class="op" id="1889809">=</span>&nbsp;<span class="ident" id="1889811">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889817"><a href="/runtime/chan.go.html#1889671">gp</a></span><span class="op" id="1889819">.</span><span class="ident" id="1889820">waiting</span>&nbsp;<span class="op" id="1889828">=</span>&nbsp;<span class="ident" id="1889830"><a href="/runtime/chan.go.html#1889686">mysg</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889837"><a href="/runtime/chan.go.html#1889686">mysg</a></span><span class="op" id="1889841">.</span><span class="ident" id="1889842">g</span>&nbsp;<span class="op" id="1889844">=</span>&nbsp;<span class="ident" id="1889846"><a href="/runtime/chan.go.html#1889671">gp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889851"><a href="/runtime/chan.go.html#1889686">mysg</a></span><span class="op" id="1889855">.</span><span class="ident" id="1889856">selectdone</span>&nbsp;<span class="op" id="1889867">=</span>&nbsp;<span class="ident" id="1889869">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889875"><a href="/runtime/chan.go.html#1889671">gp</a></span><span class="op" id="1889877">.</span><span class="ident" id="1889878">param</span>&nbsp;<span class="op" id="1889884">=</span>&nbsp;<span class="ident" id="1889886">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889892"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1889893">.</span><span class="ident" id="1889894">sendq</span><span class="op" id="1889899">.</span><span class="ident" id="1889900">enqueue</span><span class="op" id="1889907">(</span><span class="ident" id="1889908"><a href="/runtime/chan.go.html#1889686">mysg</a></span><span class="op" id="1889912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1889916"><a href="/runtime/proc.go.html#2066901">goparkunlock</a></span><span class="op" id="1889928">(</span><span class="op" id="1889929">&amp;</span><span class="ident" id="1889930"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1889931">.</span><span class="ident" id="1889932">lock</span><span class="op" id="1889936">,</span>&nbsp;<span class="string" id="1889938">&#34;chan&nbsp;send&#34;</span><span class="op" id="1889949">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1889954">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1889979">if</span>&nbsp;<span class="ident" id="1889982"><a href="/runtime/chan.go.html#1889686">mysg</a></span>&nbsp;<span class="op" id="1889987">!=</span>&nbsp;<span class="ident" id="1889990"><a href="/runtime/chan.go.html#1889671">gp</a></span><span class="op" id="1889992">.</span><span class="ident" id="1889993">waiting</span>&nbsp;<span class="op" id="1890001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890006"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1890013">(</span><span class="string" id="1890014">&#34;G&nbsp;waiting&nbsp;list&nbsp;is&nbsp;corrupted!&#34;</span><span class="op" id="1890044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1890048">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890052"><a href="/runtime/chan.go.html#1889671">gp</a></span><span class="op" id="1890054">.</span><span class="ident" id="1890055">waiting</span>&nbsp;<span class="op" id="1890063">=</span>&nbsp;<span class="ident" id="1890065">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1890071">if</span>&nbsp;<span class="ident" id="1890074"><a href="/runtime/chan.go.html#1889671">gp</a></span><span class="op" id="1890076">.</span><span class="ident" id="1890077">param</span>&nbsp;<span class="op" id="1890083">==</span>&nbsp;<span class="ident" id="1890086">nil</span>&nbsp;<span class="op" id="1890090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1890095">if</span>&nbsp;<span class="ident" id="1890098"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1890099">.</span><span class="ident" id="1890100">closed</span>&nbsp;<span class="op" id="1890107">==</span>&nbsp;<span class="num" id="1890110">0</span>&nbsp;<span class="op" id="1890112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890118"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1890125">(</span><span class="string" id="1890126">&#34;chansend:&nbsp;spurious&nbsp;wakeup&#34;</span><span class="op" id="1890153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1890158">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1890163">panic</span><span class="op" id="1890168">(</span><span class="string" id="1890169">&#34;send&nbsp;on&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="1890193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1890197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890201"><a href="/runtime/chan.go.html#1889671">gp</a></span><span class="op" id="1890203">.</span><span class="ident" id="1890204">param</span>&nbsp;<span class="op" id="1890210">=</span>&nbsp;<span class="ident" id="1890212">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1890218">if</span>&nbsp;<span class="ident" id="1890221"><a href="/runtime/chan.go.html#1889686">mysg</a></span><span class="op" id="1890225">.</span><span class="ident" id="1890226">releasetime</span>&nbsp;<span class="op" id="1890238">&gt;</span>&nbsp;<span class="num" id="1890240">0</span>&nbsp;<span class="op" id="1890242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890247"><a href="/runtime/mprof.go.html#2020096">blockevent</a></span><span class="op" id="1890257">(</span><span class="ident" id="1890258">int64</span><span class="op" id="1890263">(</span><span class="ident" id="1890264"><a href="/runtime/chan.go.html#1889686">mysg</a></span><span class="op" id="1890268">.</span><span class="ident" id="1890269">releasetime</span><span class="op" id="1890280">)</span><span class="op" id="1890281">-</span><span class="ident" id="1890282"><a href="/runtime/chan.go.html#1888970">t0</a></span><span class="op" id="1890284">,</span>&nbsp;<span class="num" id="1890286">2</span><span class="op" id="1890287">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1890291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890295"><a href="/runtime/proc.go.html#2067870">releaseSudog</a></span><span class="op" id="1890307">(</span><span class="ident" id="1890308"><a href="/runtime/chan.go.html#1889686">mysg</a></span><span class="op" id="1890312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1890316">return</span>&nbsp;<span class="builtintype" id="1890323">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1890329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1890333">//&nbsp;asynchronous&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1890358">//&nbsp;wait&nbsp;for&nbsp;some&nbsp;space&nbsp;to&nbsp;write&nbsp;our&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1890400">var</span>&nbsp;<span class="ident" id="1890404">t1</span>&nbsp;<span class="ident" id="1890407">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1890414">for</span>&nbsp;<span class="ident" id="1890418"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1890419">.</span><span class="ident" id="1890420">qcount</span>&nbsp;<span class="op" id="1890427">&gt;=</span>&nbsp;<span class="ident" id="1890430"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1890431">.</span><span class="ident" id="1890432">dataqsiz</span>&nbsp;<span class="op" id="1890441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1890445">if</span>&nbsp;<span class="op" id="1890448">!</span><span class="ident" id="1890449"><a href="/runtime/chan.go.html#1887497">block</a></span>&nbsp;<span class="op" id="1890455">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890460"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1890466">(</span><span class="op" id="1890467">&amp;</span><span class="ident" id="1890468"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1890469">.</span><span class="ident" id="1890470">lock</span><span class="op" id="1890474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1890479">return</span>&nbsp;<span class="builtintype" id="1890486">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1890494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890498">gp</span>&nbsp;<span class="op" id="1890501">:=</span>&nbsp;<span class="ident" id="1890504"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="1890508">(</span><span class="op" id="1890509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890513">mysg</span>&nbsp;<span class="op" id="1890518">:=</span>&nbsp;<span class="ident" id="1890521"><a href="/runtime/proc.go.html#2067140">acquireSudog</a></span><span class="op" id="1890533">(</span><span class="op" id="1890534">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890538"><a href="/runtime/chan.go.html#1890513">mysg</a></span><span class="op" id="1890542">.</span><span class="ident" id="1890543">releasetime</span>&nbsp;<span class="op" id="1890555">=</span>&nbsp;<span class="num" id="1890557">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1890561">if</span>&nbsp;<span class="ident" id="1890564"><a href="/runtime/chan.go.html#1888970">t0</a></span>&nbsp;<span class="op" id="1890567">!=</span>&nbsp;<span class="num" id="1890570">0</span>&nbsp;<span class="op" id="1890572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890577"><a href="/runtime/chan.go.html#1890513">mysg</a></span><span class="op" id="1890581">.</span><span class="ident" id="1890582">releasetime</span>&nbsp;<span class="op" id="1890594">=</span>&nbsp;<span class="op" id="1890596">-</span><span class="num" id="1890597">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1890601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890605"><a href="/runtime/chan.go.html#1890513">mysg</a></span><span class="op" id="1890609">.</span><span class="ident" id="1890610">g</span>&nbsp;<span class="op" id="1890612">=</span>&nbsp;<span class="ident" id="1890614"><a href="/runtime/chan.go.html#1890498">gp</a></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890619"><a href="/runtime/chan.go.html#1890513">mysg</a></span><span class="op" id="1890623">.</span><span class="ident" id="1890624">elem</span>&nbsp;<span class="op" id="1890629">=</span>&nbsp;<span class="ident" id="1890631">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890637"><a href="/runtime/chan.go.html#1890513">mysg</a></span><span class="op" id="1890641">.</span><span class="ident" id="1890642">selectdone</span>&nbsp;<span class="op" id="1890653">=</span>&nbsp;<span class="ident" id="1890655">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890661"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1890662">.</span><span class="ident" id="1890663">sendq</span><span class="op" id="1890668">.</span><span class="ident" id="1890669">enqueue</span><span class="op" id="1890676">(</span><span class="ident" id="1890677"><a href="/runtime/chan.go.html#1890513">mysg</a></span><span class="op" id="1890681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890685"><a href="/runtime/proc.go.html#2066901">goparkunlock</a></span><span class="op" id="1890697">(</span><span class="op" id="1890698">&amp;</span><span class="ident" id="1890699"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1890700">.</span><span class="ident" id="1890701">lock</span><span class="op" id="1890705">,</span>&nbsp;<span class="string" id="1890707">&#34;chan&nbsp;send&#34;</span><span class="op" id="1890718">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1890723">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up&nbsp;-&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1890759">if</span>&nbsp;<span class="ident" id="1890762"><a href="/runtime/chan.go.html#1890513">mysg</a></span><span class="op" id="1890766">.</span><span class="ident" id="1890767">releasetime</span>&nbsp;<span class="op" id="1890779">&gt;</span>&nbsp;<span class="num" id="1890781">0</span>&nbsp;<span class="op" id="1890783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890788"><a href="/runtime/chan.go.html#1890404">t1</a></span>&nbsp;<span class="op" id="1890791">=</span>&nbsp;<span class="ident" id="1890793"><a href="/runtime/chan.go.html#1890513">mysg</a></span><span class="op" id="1890797">.</span><span class="ident" id="1890798">releasetime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1890812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890816"><a href="/runtime/proc.go.html#2067870">releaseSudog</a></span><span class="op" id="1890828">(</span><span class="ident" id="1890829"><a href="/runtime/chan.go.html#1890513">mysg</a></span><span class="op" id="1890833">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890837"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="1890841">(</span><span class="op" id="1890842">&amp;</span><span class="ident" id="1890843"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1890844">.</span><span class="ident" id="1890845">lock</span><span class="op" id="1890849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1890853">if</span>&nbsp;<span class="ident" id="1890856"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1890857">.</span><span class="ident" id="1890858">closed</span>&nbsp;<span class="op" id="1890865">!=</span>&nbsp;<span class="num" id="1890868">0</span>&nbsp;<span class="op" id="1890870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890875"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1890881">(</span><span class="op" id="1890882">&amp;</span><span class="ident" id="1890883"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1890884">.</span><span class="ident" id="1890885">lock</span><span class="op" id="1890889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1890894">panic</span><span class="op" id="1890899">(</span><span class="string" id="1890900">&#34;send&nbsp;on&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="1890924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1890928">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1890931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1890935">//&nbsp;write&nbsp;our&nbsp;data&nbsp;into&nbsp;the&nbsp;channel&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1890978">if</span>&nbsp;<span class="ident" id="1890981"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="1890993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1890997"><a href="/runtime/race0.go.html#2070582">raceacquire</a></span><span class="op" id="1891008">(</span><span class="ident" id="1891009"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="1891016">(</span><span class="ident" id="1891017"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891018">,</span>&nbsp;<span class="ident" id="1891020"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891021">.</span><span class="ident" id="1891022">sendx</span><span class="op" id="1891027">)</span><span class="op" id="1891028">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891032"><a href="/runtime/race0.go.html#2070774">racerelease</a></span><span class="op" id="1891043">(</span><span class="ident" id="1891044"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="1891051">(</span><span class="ident" id="1891052"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891053">,</span>&nbsp;<span class="ident" id="1891055"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891056">.</span><span class="ident" id="1891057">sendx</span><span class="op" id="1891062">)</span><span class="op" id="1891063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1891066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891069"><a href="/runtime/stubs.go.html#2135810">memmove</a></span><span class="op" id="1891076">(</span><span class="ident" id="1891077"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="1891084">(</span><span class="ident" id="1891085"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891086">,</span>&nbsp;<span class="ident" id="1891088"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891089">.</span><span class="ident" id="1891090">sendx</span><span class="op" id="1891095">)</span><span class="op" id="1891096">,</span>&nbsp;<span class="ident" id="1891098"><a href="/runtime/chan.go.html#1887478">ep</a></span><span class="op" id="1891100">,</span>&nbsp;<span class="builtintype" id="1891102">uintptr</span><span class="op" id="1891109">(</span><span class="ident" id="1891110"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891111">.</span><span class="ident" id="1891112">elemsize</span><span class="op" id="1891120">)</span><span class="op" id="1891121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891124"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891125">.</span><span class="ident" id="1891126">sendx</span><span class="op" id="1891131">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1891135">if</span>&nbsp;<span class="ident" id="1891138"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891139">.</span><span class="ident" id="1891140">sendx</span>&nbsp;<span class="op" id="1891146">==</span>&nbsp;<span class="ident" id="1891149"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891150">.</span><span class="ident" id="1891151">dataqsiz</span>&nbsp;<span class="op" id="1891160">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891164"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891165">.</span><span class="ident" id="1891166">sendx</span>&nbsp;<span class="op" id="1891172">=</span>&nbsp;<span class="num" id="1891174">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1891177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891180"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891181">.</span><span class="ident" id="1891182">qcount</span><span class="op" id="1891188">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1891193">//&nbsp;wake&nbsp;up&nbsp;a&nbsp;waiting&nbsp;receiver</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891224">sg</span>&nbsp;<span class="op" id="1891227">:=</span>&nbsp;<span class="ident" id="1891230"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891231">.</span><span class="ident" id="1891232">recvq</span><span class="op" id="1891237">.</span><span class="ident" id="1891238">dequeue</span><span class="op" id="1891245">(</span><span class="op" id="1891246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1891249">if</span>&nbsp;<span class="ident" id="1891252"><a href="/runtime/chan.go.html#1891224">sg</a></span>&nbsp;<span class="op" id="1891255">!=</span>&nbsp;<span class="ident" id="1891258">nil</span>&nbsp;<span class="op" id="1891262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891266">recvg</span>&nbsp;<span class="op" id="1891272">:=</span>&nbsp;<span class="ident" id="1891275"><a href="/runtime/chan.go.html#1891224">sg</a></span><span class="op" id="1891277">.</span><span class="ident" id="1891278">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891282"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1891288">(</span><span class="op" id="1891289">&amp;</span><span class="ident" id="1891290"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891291">.</span><span class="ident" id="1891292">lock</span><span class="op" id="1891296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1891300">if</span>&nbsp;<span class="ident" id="1891303"><a href="/runtime/chan.go.html#1891224">sg</a></span><span class="op" id="1891305">.</span><span class="ident" id="1891306">releasetime</span>&nbsp;<span class="op" id="1891318">!=</span>&nbsp;<span class="num" id="1891321">0</span>&nbsp;<span class="op" id="1891323">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891328"><a href="/runtime/chan.go.html#1891224">sg</a></span><span class="op" id="1891330">.</span><span class="ident" id="1891331">releasetime</span>&nbsp;<span class="op" id="1891343">=</span>&nbsp;<span class="ident" id="1891345"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="1891353">(</span><span class="op" id="1891354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1891358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891362"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="1891369">(</span><span class="ident" id="1891370"><a href="/runtime/chan.go.html#1891266">recvg</a></span><span class="op" id="1891375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1891378">}</span>&nbsp;<span class="keyword" id="1891380">else</span>&nbsp;<span class="op" id="1891385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891389"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1891395">(</span><span class="op" id="1891396">&amp;</span><span class="ident" id="1891397"><a href="/runtime/chan.go.html#1887468">c</a></span><span class="op" id="1891398">.</span><span class="ident" id="1891399">lock</span><span class="op" id="1891403">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1891406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1891409">if</span>&nbsp;<span class="ident" id="1891412"><a href="/runtime/chan.go.html#1890404">t1</a></span>&nbsp;<span class="op" id="1891415">&gt;</span>&nbsp;<span class="num" id="1891417">0</span>&nbsp;<span class="op" id="1891419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891423"><a href="/runtime/mprof.go.html#2020096">blockevent</a></span><span class="op" id="1891433">(</span><span class="ident" id="1891434"><a href="/runtime/chan.go.html#1890404">t1</a></span><span class="op" id="1891436">-</span><span class="ident" id="1891437"><a href="/runtime/chan.go.html#1888970">t0</a></span><span class="op" id="1891439">,</span>&nbsp;<span class="num" id="1891441">2</span><span class="op" id="1891442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1891445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1891448">return</span>&nbsp;<span class="builtintype" id="1891455">true</span><br>
<span class="lineno">255</span><span class="op" id="1891460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1891463">func</span>&nbsp;<span class="ident" id="1891468">closechan</span><span class="op" id="1891477">(</span><span class="ident" id="1891478">c</span>&nbsp;<span class="op" id="1891480">*</span><span class="ident" id="1891481"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1891486">)</span>&nbsp;<span class="op" id="1891488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1891491">if</span>&nbsp;<span class="ident" id="1891494"><a href="/runtime/chan.go.html#1891478">c</a></span>&nbsp;<span class="op" id="1891496">==</span>&nbsp;<span class="ident" id="1891499">nil</span>&nbsp;<span class="op" id="1891503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1891507">panic</span><span class="op" id="1891512">(</span><span class="string" id="1891513">&#34;close&nbsp;of&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="1891535">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1891538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891542"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="1891546">(</span><span class="op" id="1891547">&amp;</span><span class="ident" id="1891548"><a href="/runtime/chan.go.html#1891478">c</a></span><span class="op" id="1891549">.</span><span class="ident" id="1891550">lock</span><span class="op" id="1891554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1891557">if</span>&nbsp;<span class="ident" id="1891560"><a href="/runtime/chan.go.html#1891478">c</a></span><span class="op" id="1891561">.</span><span class="ident" id="1891562">closed</span>&nbsp;<span class="op" id="1891569">!=</span>&nbsp;<span class="num" id="1891572">0</span>&nbsp;<span class="op" id="1891574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891578"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1891584">(</span><span class="op" id="1891585">&amp;</span><span class="ident" id="1891586"><a href="/runtime/chan.go.html#1891478">c</a></span><span class="op" id="1891587">.</span><span class="ident" id="1891588">lock</span><span class="op" id="1891592">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1891596">panic</span><span class="op" id="1891601">(</span><span class="string" id="1891602">&#34;close&nbsp;of&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="1891627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1891630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1891634">if</span>&nbsp;<span class="ident" id="1891637"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="1891649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891653">callerpc</span>&nbsp;<span class="op" id="1891662">:=</span>&nbsp;<span class="ident" id="1891665"><a href="/runtime/stubs.go.html#2139499">getcallerpc</a></span><span class="op" id="1891676">(</span><span class="ident" id="1891677"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1891683">.</span><span class="ident" id="1891684">Pointer</span><span class="op" id="1891691">(</span><span class="op" id="1891692">&amp;</span><span class="ident" id="1891693"><a href="/runtime/chan.go.html#1891478">c</a></span><span class="op" id="1891694">)</span><span class="op" id="1891695">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891699"><a href="/runtime/race0.go.html#2070198">racewritepc</a></span><span class="op" id="1891710">(</span><span class="ident" id="1891711"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1891717">.</span><span class="ident" id="1891718">Pointer</span><span class="op" id="1891725">(</span><span class="ident" id="1891726"><a href="/runtime/chan.go.html#1891478">c</a></span><span class="op" id="1891727">)</span><span class="op" id="1891728">,</span>&nbsp;<span class="ident" id="1891730"><a href="/runtime/chan.go.html#1891653">callerpc</a></span><span class="op" id="1891738">,</span>&nbsp;<span class="ident" id="1891740"><a href="/runtime/proc.go.html#2068560">funcPC</a></span><span class="op" id="1891746">(</span><span class="ident" id="1891747"><a href="/runtime/chan.go.html#1891468">closechan</a></span><span class="op" id="1891756">)</span><span class="op" id="1891757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891761"><a href="/runtime/race0.go.html#2070774">racerelease</a></span><span class="op" id="1891772">(</span><span class="ident" id="1891773"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1891779">.</span><span class="ident" id="1891780">Pointer</span><span class="op" id="1891787">(</span><span class="ident" id="1891788"><a href="/runtime/chan.go.html#1891478">c</a></span><span class="op" id="1891789">)</span><span class="op" id="1891790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1891793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891797"><a href="/runtime/chan.go.html#1891478">c</a></span><span class="op" id="1891798">.</span><span class="ident" id="1891799">closed</span>&nbsp;<span class="op" id="1891806">=</span>&nbsp;<span class="num" id="1891808">1</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1891812">//&nbsp;release&nbsp;all&nbsp;readers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1891836">for</span>&nbsp;<span class="op" id="1891840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891844">sg</span>&nbsp;<span class="op" id="1891847">:=</span>&nbsp;<span class="ident" id="1891850"><a href="/runtime/chan.go.html#1891478">c</a></span><span class="op" id="1891851">.</span><span class="ident" id="1891852">recvq</span><span class="op" id="1891857">.</span><span class="ident" id="1891858">dequeue</span><span class="op" id="1891865">(</span><span class="op" id="1891866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1891870">if</span>&nbsp;<span class="ident" id="1891873"><a href="/runtime/chan.go.html#1891844">sg</a></span>&nbsp;<span class="op" id="1891876">==</span>&nbsp;<span class="ident" id="1891879">nil</span>&nbsp;<span class="op" id="1891883">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1891888">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1891896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891900">gp</span>&nbsp;<span class="op" id="1891903">:=</span>&nbsp;<span class="ident" id="1891906"><a href="/runtime/chan.go.html#1891844">sg</a></span><span class="op" id="1891908">.</span><span class="ident" id="1891909">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891913"><a href="/runtime/chan.go.html#1891844">sg</a></span><span class="op" id="1891915">.</span><span class="ident" id="1891916">elem</span>&nbsp;<span class="op" id="1891921">=</span>&nbsp;<span class="ident" id="1891923">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891929"><a href="/runtime/chan.go.html#1891900">gp</a></span><span class="op" id="1891931">.</span><span class="ident" id="1891932">param</span>&nbsp;<span class="op" id="1891938">=</span>&nbsp;<span class="ident" id="1891940">nil</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1891946">if</span>&nbsp;<span class="ident" id="1891949"><a href="/runtime/chan.go.html#1891844">sg</a></span><span class="op" id="1891951">.</span><span class="ident" id="1891952">releasetime</span>&nbsp;<span class="op" id="1891964">!=</span>&nbsp;<span class="num" id="1891967">0</span>&nbsp;<span class="op" id="1891969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1891974"><a href="/runtime/chan.go.html#1891844">sg</a></span><span class="op" id="1891976">.</span><span class="ident" id="1891977">releasetime</span>&nbsp;<span class="op" id="1891989">=</span>&nbsp;<span class="ident" id="1891991"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="1891999">(</span><span class="op" id="1892000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1892004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1892008"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="1892015">(</span><span class="ident" id="1892016"><a href="/runtime/chan.go.html#1891900">gp</a></span><span class="op" id="1892018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1892021">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1892025">//&nbsp;release&nbsp;all&nbsp;writers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1892049">for</span>&nbsp;<span class="op" id="1892053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1892057">sg</span>&nbsp;<span class="op" id="1892060">:=</span>&nbsp;<span class="ident" id="1892063"><a href="/runtime/chan.go.html#1891478">c</a></span><span class="op" id="1892064">.</span><span class="ident" id="1892065">sendq</span><span class="op" id="1892070">.</span><span class="ident" id="1892071">dequeue</span><span class="op" id="1892078">(</span><span class="op" id="1892079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1892083">if</span>&nbsp;<span class="ident" id="1892086"><a href="/runtime/chan.go.html#1892057">sg</a></span>&nbsp;<span class="op" id="1892089">==</span>&nbsp;<span class="ident" id="1892092">nil</span>&nbsp;<span class="op" id="1892096">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1892101">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1892109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1892113">gp</span>&nbsp;<span class="op" id="1892116">:=</span>&nbsp;<span class="ident" id="1892119"><a href="/runtime/chan.go.html#1892057">sg</a></span><span class="op" id="1892121">.</span><span class="ident" id="1892122">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1892126"><a href="/runtime/chan.go.html#1892057">sg</a></span><span class="op" id="1892128">.</span><span class="ident" id="1892129">elem</span>&nbsp;<span class="op" id="1892134">=</span>&nbsp;<span class="ident" id="1892136">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1892142"><a href="/runtime/chan.go.html#1892113">gp</a></span><span class="op" id="1892144">.</span><span class="ident" id="1892145">param</span>&nbsp;<span class="op" id="1892151">=</span>&nbsp;<span class="ident" id="1892153">nil</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1892159">if</span>&nbsp;<span class="ident" id="1892162"><a href="/runtime/chan.go.html#1892057">sg</a></span><span class="op" id="1892164">.</span><span class="ident" id="1892165">releasetime</span>&nbsp;<span class="op" id="1892177">!=</span>&nbsp;<span class="num" id="1892180">0</span>&nbsp;<span class="op" id="1892182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1892187"><a href="/runtime/chan.go.html#1892057">sg</a></span><span class="op" id="1892189">.</span><span class="ident" id="1892190">releasetime</span>&nbsp;<span class="op" id="1892202">=</span>&nbsp;<span class="ident" id="1892204"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="1892212">(</span><span class="op" id="1892213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1892217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1892221"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="1892228">(</span><span class="ident" id="1892229"><a href="/runtime/chan.go.html#1892113">gp</a></span><span class="op" id="1892231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1892234">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1892237"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1892243">(</span><span class="op" id="1892244">&amp;</span><span class="ident" id="1892245"><a href="/runtime/chan.go.html#1891478">c</a></span><span class="op" id="1892246">.</span><span class="ident" id="1892247">lock</span><span class="op" id="1892251">)</span><br>
<span class="lineno"></span><span class="op" id="1892253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1892256">//&nbsp;entry&nbsp;points&nbsp;for&nbsp;&lt;-&nbsp;c&nbsp;from&nbsp;compiled&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="1892300">//go:nosplit</span><br>
<span class="lineno">310</span><span class="keyword" id="1892313">func</span>&nbsp;<span class="ident" id="1892318">chanrecv1</span><span class="op" id="1892327">(</span><span class="ident" id="1892328">t</span>&nbsp;<span class="op" id="1892330">*</span><span class="ident" id="1892331"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189434">chantype</a></span><span class="op" id="1892339">,</span>&nbsp;<span class="ident" id="1892341">c</span>&nbsp;<span class="op" id="1892343">*</span><span class="ident" id="1892344"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1892349">,</span>&nbsp;<span class="ident" id="1892351">elem</span>&nbsp;<span class="ident" id="1892356"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1892362">.</span><span class="ident" id="1892363">Pointer</span><span class="op" id="1892370">)</span>&nbsp;<span class="op" id="1892372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1892375"><a href="/runtime/chan.go.html#1892893">chanrecv</a></span><span class="op" id="1892383">(</span><span class="ident" id="1892384"><a href="/runtime/chan.go.html#1892328">t</a></span><span class="op" id="1892385">,</span>&nbsp;<span class="ident" id="1892387"><a href="/runtime/chan.go.html#1892341">c</a></span><span class="op" id="1892388">,</span>&nbsp;<span class="ident" id="1892390"><a href="/runtime/chan.go.html#1892351">elem</a></span><span class="op" id="1892394">,</span>&nbsp;<span class="builtintype" id="1892396">true</span><span class="op" id="1892400">)</span><br>
<span class="lineno"></span><span class="op" id="1892402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1892405">//go:nosplit</span><br>
<span class="lineno">315</span><span class="keyword" id="1892418">func</span>&nbsp;<span class="ident" id="1892423">chanrecv2</span><span class="op" id="1892432">(</span><span class="ident" id="1892433">t</span>&nbsp;<span class="op" id="1892435">*</span><span class="ident" id="1892436"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189434">chantype</a></span><span class="op" id="1892444">,</span>&nbsp;<span class="ident" id="1892446">c</span>&nbsp;<span class="op" id="1892448">*</span><span class="ident" id="1892449"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1892454">,</span>&nbsp;<span class="ident" id="1892456">elem</span>&nbsp;<span class="ident" id="1892461"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1892467">.</span><span class="ident" id="1892468">Pointer</span><span class="op" id="1892475">)</span>&nbsp;<span class="op" id="1892477">(</span><span class="ident" id="1892478">received</span>&nbsp;<span class="builtintype" id="1892487">bool</span><span class="op" id="1892491">)</span>&nbsp;<span class="op" id="1892493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1892496">_</span><span class="op" id="1892497">,</span>&nbsp;<span class="ident" id="1892499"><a href="/runtime/chan.go.html#1892478">received</a></span>&nbsp;<span class="op" id="1892508">=</span>&nbsp;<span class="ident" id="1892510"><a href="/runtime/chan.go.html#1892893">chanrecv</a></span><span class="op" id="1892518">(</span><span class="ident" id="1892519"><a href="/runtime/chan.go.html#1892433">t</a></span><span class="op" id="1892520">,</span>&nbsp;<span class="ident" id="1892522"><a href="/runtime/chan.go.html#1892446">c</a></span><span class="op" id="1892523">,</span>&nbsp;<span class="ident" id="1892525"><a href="/runtime/chan.go.html#1892456">elem</a></span><span class="op" id="1892529">,</span>&nbsp;<span class="builtintype" id="1892531">true</span><span class="op" id="1892535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1892538">return</span><br>
<span class="lineno"></span><span class="op" id="1892545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="1892548">//&nbsp;chanrecv&nbsp;receives&nbsp;on&nbsp;channel&nbsp;c&nbsp;and&nbsp;writes&nbsp;the&nbsp;received&nbsp;data&nbsp;to&nbsp;ep.</span><br>
<span class="lineno"></span><span class="comment" id="1892618">//&nbsp;ep&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;received&nbsp;data&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="1892676">//&nbsp;If&nbsp;block&nbsp;==&nbsp;false&nbsp;and&nbsp;no&nbsp;elements&nbsp;are&nbsp;available,&nbsp;returns&nbsp;(false,&nbsp;false).</span><br>
<span class="lineno"></span><span class="comment" id="1892752">//&nbsp;Otherwise,&nbsp;if&nbsp;c&nbsp;is&nbsp;closed,&nbsp;zeros&nbsp;*ep&nbsp;and&nbsp;returns&nbsp;(true,&nbsp;false).</span><br>
<span class="lineno"></span><span class="comment" id="1892819">//&nbsp;Otherwise,&nbsp;fills&nbsp;in&nbsp;*ep&nbsp;with&nbsp;an&nbsp;element&nbsp;and&nbsp;returns&nbsp;(true,&nbsp;true).</span><br>
<span class="lineno">325</span><span class="keyword" id="1892888">func</span>&nbsp;<span class="ident" id="1892893">chanrecv</span><span class="op" id="1892901">(</span><span class="ident" id="1892902">t</span>&nbsp;<span class="op" id="1892904">*</span><span class="ident" id="1892905"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189434">chantype</a></span><span class="op" id="1892913">,</span>&nbsp;<span class="ident" id="1892915">c</span>&nbsp;<span class="op" id="1892917">*</span><span class="ident" id="1892918"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1892923">,</span>&nbsp;<span class="ident" id="1892925">ep</span>&nbsp;<span class="ident" id="1892928"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1892934">.</span><span class="ident" id="1892935">Pointer</span><span class="op" id="1892942">,</span>&nbsp;<span class="ident" id="1892944">block</span>&nbsp;<span class="builtintype" id="1892950">bool</span><span class="op" id="1892954">)</span>&nbsp;<span class="op" id="1892956">(</span><span class="ident" id="1892957">selected</span><span class="op" id="1892965">,</span>&nbsp;<span class="ident" id="1892967">received</span>&nbsp;<span class="builtintype" id="1892976">bool</span><span class="op" id="1892980">)</span>&nbsp;<span class="op" id="1892982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1892985">//&nbsp;raceenabled:&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;ep,&nbsp;as&nbsp;it&nbsp;is&nbsp;always&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1893057">if</span>&nbsp;<span class="ident" id="1893060"><a href="/runtime/chan.go.html#1885249">debugChan</a></span>&nbsp;<span class="op" id="1893070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1893074">print</span><span class="op" id="1893079">(</span><span class="string" id="1893080">&#34;chanrecv:&nbsp;chan=&#34;</span><span class="op" id="1893097">,</span>&nbsp;<span class="ident" id="1893099"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1893100">,</span>&nbsp;<span class="string" id="1893102">&#34;\n&#34;</span><span class="op" id="1893106">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1893109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1893113">if</span>&nbsp;<span class="ident" id="1893116"><a href="/runtime/chan.go.html#1892915">c</a></span>&nbsp;<span class="op" id="1893118">==</span>&nbsp;<span class="ident" id="1893121">nil</span>&nbsp;<span class="op" id="1893125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1893129">if</span>&nbsp;<span class="op" id="1893132">!</span><span class="ident" id="1893133"><a href="/runtime/chan.go.html#1892944">block</a></span>&nbsp;<span class="op" id="1893139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1893144">return</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1893153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1893157"><a href="/runtime/proc.go.html#2066373">gopark</a></span><span class="op" id="1893163">(</span><span class="ident" id="1893164">nil</span><span class="op" id="1893167">,</span>&nbsp;<span class="ident" id="1893169">nil</span><span class="op" id="1893172">,</span>&nbsp;<span class="string" id="1893174">&#34;chan&nbsp;receive&nbsp;(nil&nbsp;chan)&#34;</span><span class="op" id="1893199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1893203"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1893210">(</span><span class="string" id="1893211">&#34;unreachable&#34;</span><span class="op" id="1893224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1893227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1893231">//&nbsp;Fast&nbsp;path:&nbsp;check&nbsp;for&nbsp;failed&nbsp;non-blocking&nbsp;operation&nbsp;without&nbsp;acquiring&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1893314">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1893318">//&nbsp;After&nbsp;observing&nbsp;that&nbsp;the&nbsp;channel&nbsp;is&nbsp;not&nbsp;ready&nbsp;for&nbsp;receiving,&nbsp;we&nbsp;observe&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1893403">//&nbsp;channel&nbsp;is&nbsp;not&nbsp;closed.&nbsp;Each&nbsp;of&nbsp;these&nbsp;observations&nbsp;is&nbsp;a&nbsp;single&nbsp;word-sized&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1893485">//&nbsp;(first&nbsp;c.sendq.first&nbsp;or&nbsp;c.qcount,&nbsp;and&nbsp;second&nbsp;c.closed).</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1893545">//&nbsp;Because&nbsp;a&nbsp;channel&nbsp;cannot&nbsp;be&nbsp;reopened,&nbsp;the&nbsp;later&nbsp;observation&nbsp;of&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1893624">//&nbsp;being&nbsp;not&nbsp;closed&nbsp;implies&nbsp;that&nbsp;it&nbsp;was&nbsp;also&nbsp;not&nbsp;closed&nbsp;at&nbsp;the&nbsp;moment&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1893702">//&nbsp;first&nbsp;observation.&nbsp;We&nbsp;behave&nbsp;as&nbsp;if&nbsp;we&nbsp;observed&nbsp;the&nbsp;channel&nbsp;at&nbsp;that&nbsp;moment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1893780">//&nbsp;and&nbsp;report&nbsp;that&nbsp;the&nbsp;receive&nbsp;cannot&nbsp;proceed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1893828">//</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1893832">//&nbsp;The&nbsp;order&nbsp;of&nbsp;operations&nbsp;is&nbsp;important&nbsp;here:&nbsp;reversing&nbsp;the&nbsp;operations&nbsp;can&nbsp;lead&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1893916">//&nbsp;incorrect&nbsp;behavior&nbsp;when&nbsp;racing&nbsp;with&nbsp;a&nbsp;close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1893965">if</span>&nbsp;<span class="op" id="1893968">!</span><span class="ident" id="1893969"><a href="/runtime/chan.go.html#1892944">block</a></span>&nbsp;<span class="op" id="1893975">&amp;&amp;</span>&nbsp;<span class="op" id="1893978">(</span><span class="ident" id="1893979"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1893980">.</span><span class="ident" id="1893981">dataqsiz</span>&nbsp;<span class="op" id="1893990">==</span>&nbsp;<span class="num" id="1893993">0</span>&nbsp;<span class="op" id="1893995">&amp;&amp;</span>&nbsp;<span class="ident" id="1893998"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1893999">.</span><span class="ident" id="1894000">sendq</span><span class="op" id="1894005">.</span><span class="ident" id="1894006">first</span>&nbsp;<span class="op" id="1894012">==</span>&nbsp;<span class="ident" id="1894015">nil</span>&nbsp;<span class="op" id="1894019">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894024"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1894025">.</span><span class="ident" id="1894026">dataqsiz</span>&nbsp;<span class="op" id="1894035">&gt;</span>&nbsp;<span class="num" id="1894037">0</span>&nbsp;<span class="op" id="1894039">&amp;&amp;</span>&nbsp;<span class="ident" id="1894042"><a href="/runtime/stubs.go.html#2138175">atomicloaduint</a></span><span class="op" id="1894056">(</span><span class="op" id="1894057">&amp;</span><span class="ident" id="1894058"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1894059">.</span><span class="ident" id="1894060">qcount</span><span class="op" id="1894066">)</span>&nbsp;<span class="op" id="1894068">==</span>&nbsp;<span class="num" id="1894071">0</span><span class="op" id="1894072">)</span>&nbsp;<span class="op" id="1894074">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894079"><a href="/runtime/atomic.go.html#1874432">atomicload</a></span><span class="op" id="1894089">(</span><span class="op" id="1894090">&amp;</span><span class="ident" id="1894091"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1894092">.</span><span class="ident" id="1894093">closed</span><span class="op" id="1894099">)</span>&nbsp;<span class="op" id="1894101">==</span>&nbsp;<span class="num" id="1894104">0</span>&nbsp;<span class="op" id="1894106">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894110">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1894118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894122">var</span>&nbsp;<span class="ident" id="1894126">t0</span>&nbsp;<span class="ident" id="1894129">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894136">if</span>&nbsp;<span class="ident" id="1894139"><a href="/runtime/mprof.go.html#2019313">blockprofilerate</a></span>&nbsp;<span class="op" id="1894156">&gt;</span>&nbsp;<span class="num" id="1894158">0</span>&nbsp;<span class="op" id="1894160">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894164"><a href="/runtime/chan.go.html#1894126">t0</a></span>&nbsp;<span class="op" id="1894167">=</span>&nbsp;<span class="ident" id="1894169"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="1894177">(</span><span class="op" id="1894178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1894181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894185"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="1894189">(</span><span class="op" id="1894190">&amp;</span><span class="ident" id="1894191"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1894192">.</span><span class="ident" id="1894193">lock</span><span class="op" id="1894197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894200">if</span>&nbsp;<span class="ident" id="1894203"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1894204">.</span><span class="ident" id="1894205">dataqsiz</span>&nbsp;<span class="op" id="1894214">==</span>&nbsp;<span class="num" id="1894217">0</span>&nbsp;<span class="op" id="1894219">{</span>&nbsp;<span class="comment" id="1894221">//&nbsp;synchronous&nbsp;channel</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894246">if</span>&nbsp;<span class="ident" id="1894249"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1894250">.</span><span class="ident" id="1894251">closed</span>&nbsp;<span class="op" id="1894258">!=</span>&nbsp;<span class="num" id="1894261">0</span>&nbsp;<span class="op" id="1894263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894268">return</span>&nbsp;<span class="ident" id="1894275"><a href="/runtime/chan.go.html#1896992">recvclosed</a></span><span class="op" id="1894285">(</span><span class="ident" id="1894286"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1894287">,</span>&nbsp;<span class="ident" id="1894289"><a href="/runtime/chan.go.html#1892925">ep</a></span><span class="op" id="1894291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1894295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894300">sg</span>&nbsp;<span class="op" id="1894303">:=</span>&nbsp;<span class="ident" id="1894306"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1894307">.</span><span class="ident" id="1894308">sendq</span><span class="op" id="1894313">.</span><span class="ident" id="1894314">dequeue</span><span class="op" id="1894321">(</span><span class="op" id="1894322">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894326">if</span>&nbsp;<span class="ident" id="1894329"><a href="/runtime/chan.go.html#1894300">sg</a></span>&nbsp;<span class="op" id="1894332">!=</span>&nbsp;<span class="ident" id="1894335">nil</span>&nbsp;<span class="op" id="1894339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894344">if</span>&nbsp;<span class="ident" id="1894347"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="1894359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894365"><a href="/runtime/chan.go.html#1899350">racesync</a></span><span class="op" id="1894373">(</span><span class="ident" id="1894374"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1894375">,</span>&nbsp;<span class="ident" id="1894377"><a href="/runtime/chan.go.html#1894300">sg</a></span><span class="op" id="1894379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1894384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894389"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1894395">(</span><span class="op" id="1894396">&amp;</span><span class="ident" id="1894397"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1894398">.</span><span class="ident" id="1894399">lock</span><span class="op" id="1894403">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894409">if</span>&nbsp;<span class="ident" id="1894412"><a href="/runtime/chan.go.html#1892925">ep</a></span>&nbsp;<span class="op" id="1894415">!=</span>&nbsp;<span class="ident" id="1894418">nil</span>&nbsp;<span class="op" id="1894422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894428"><a href="/runtime/stubs.go.html#2135810">memmove</a></span><span class="op" id="1894435">(</span><span class="ident" id="1894436"><a href="/runtime/chan.go.html#1892925">ep</a></span><span class="op" id="1894438">,</span>&nbsp;<span class="ident" id="1894440"><a href="/runtime/chan.go.html#1894300">sg</a></span><span class="op" id="1894442">.</span><span class="ident" id="1894443">elem</span><span class="op" id="1894447">,</span>&nbsp;<span class="builtintype" id="1894449">uintptr</span><span class="op" id="1894456">(</span><span class="ident" id="1894457"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1894458">.</span><span class="ident" id="1894459">elemsize</span><span class="op" id="1894467">)</span><span class="op" id="1894468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1894473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894478"><a href="/runtime/chan.go.html#1894300">sg</a></span><span class="op" id="1894480">.</span><span class="ident" id="1894481">elem</span>&nbsp;<span class="op" id="1894486">=</span>&nbsp;<span class="ident" id="1894488">nil</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894495">gp</span>&nbsp;<span class="op" id="1894498">:=</span>&nbsp;<span class="ident" id="1894501"><a href="/runtime/chan.go.html#1894300">sg</a></span><span class="op" id="1894503">.</span><span class="ident" id="1894504">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894509"><a href="/runtime/chan.go.html#1894495">gp</a></span><span class="op" id="1894511">.</span><span class="ident" id="1894512">param</span>&nbsp;<span class="op" id="1894518">=</span>&nbsp;<span class="ident" id="1894520"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1894526">.</span><span class="ident" id="1894527">Pointer</span><span class="op" id="1894534">(</span><span class="ident" id="1894535"><a href="/runtime/chan.go.html#1894300">sg</a></span><span class="op" id="1894537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894542">if</span>&nbsp;<span class="ident" id="1894545"><a href="/runtime/chan.go.html#1894300">sg</a></span><span class="op" id="1894547">.</span><span class="ident" id="1894548">releasetime</span>&nbsp;<span class="op" id="1894560">!=</span>&nbsp;<span class="num" id="1894563">0</span>&nbsp;<span class="op" id="1894565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894571"><a href="/runtime/chan.go.html#1894300">sg</a></span><span class="op" id="1894573">.</span><span class="ident" id="1894574">releasetime</span>&nbsp;<span class="op" id="1894586">=</span>&nbsp;<span class="ident" id="1894588"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="1894596">(</span><span class="op" id="1894597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1894602">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894607"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="1894614">(</span><span class="ident" id="1894615"><a href="/runtime/chan.go.html#1894495">gp</a></span><span class="op" id="1894617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894622"><a href="/runtime/chan.go.html#1892957">selected</a></span>&nbsp;<span class="op" id="1894631">=</span>&nbsp;<span class="builtintype" id="1894633">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894641"><a href="/runtime/chan.go.html#1892967">received</a></span>&nbsp;<span class="op" id="1894650">=</span>&nbsp;<span class="builtintype" id="1894652">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894660">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1894669">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894674">if</span>&nbsp;<span class="op" id="1894677">!</span><span class="ident" id="1894678"><a href="/runtime/chan.go.html#1892944">block</a></span>&nbsp;<span class="op" id="1894684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894689"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1894695">(</span><span class="op" id="1894696">&amp;</span><span class="ident" id="1894697"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1894698">.</span><span class="ident" id="1894699">lock</span><span class="op" id="1894703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894708">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1894717">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1894722">//&nbsp;no&nbsp;sender&nbsp;available:&nbsp;block&nbsp;on&nbsp;this&nbsp;channel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894771">gp</span>&nbsp;<span class="op" id="1894774">:=</span>&nbsp;<span class="ident" id="1894777"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="1894781">(</span><span class="op" id="1894782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894786">mysg</span>&nbsp;<span class="op" id="1894791">:=</span>&nbsp;<span class="ident" id="1894794"><a href="/runtime/proc.go.html#2067140">acquireSudog</a></span><span class="op" id="1894806">(</span><span class="op" id="1894807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894811"><a href="/runtime/chan.go.html#1894786">mysg</a></span><span class="op" id="1894815">.</span><span class="ident" id="1894816">releasetime</span>&nbsp;<span class="op" id="1894828">=</span>&nbsp;<span class="num" id="1894830">0</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1894834">if</span>&nbsp;<span class="ident" id="1894837"><a href="/runtime/chan.go.html#1894126">t0</a></span>&nbsp;<span class="op" id="1894840">!=</span>&nbsp;<span class="num" id="1894843">0</span>&nbsp;<span class="op" id="1894845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894850"><a href="/runtime/chan.go.html#1894786">mysg</a></span><span class="op" id="1894854">.</span><span class="ident" id="1894855">releasetime</span>&nbsp;<span class="op" id="1894867">=</span>&nbsp;<span class="op" id="1894869">-</span><span class="num" id="1894870">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1894874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894878"><a href="/runtime/chan.go.html#1894786">mysg</a></span><span class="op" id="1894882">.</span><span class="ident" id="1894883">elem</span>&nbsp;<span class="op" id="1894888">=</span>&nbsp;<span class="ident" id="1894890"><a href="/runtime/chan.go.html#1892925">ep</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894895"><a href="/runtime/chan.go.html#1894786">mysg</a></span><span class="op" id="1894899">.</span><span class="ident" id="1894900">waitlink</span>&nbsp;<span class="op" id="1894909">=</span>&nbsp;<span class="ident" id="1894911">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894917"><a href="/runtime/chan.go.html#1894771">gp</a></span><span class="op" id="1894919">.</span><span class="ident" id="1894920">waiting</span>&nbsp;<span class="op" id="1894928">=</span>&nbsp;<span class="ident" id="1894930"><a href="/runtime/chan.go.html#1894786">mysg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894937"><a href="/runtime/chan.go.html#1894786">mysg</a></span><span class="op" id="1894941">.</span><span class="ident" id="1894942">g</span>&nbsp;<span class="op" id="1894944">=</span>&nbsp;<span class="ident" id="1894946"><a href="/runtime/chan.go.html#1894771">gp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894951"><a href="/runtime/chan.go.html#1894786">mysg</a></span><span class="op" id="1894955">.</span><span class="ident" id="1894956">selectdone</span>&nbsp;<span class="op" id="1894967">=</span>&nbsp;<span class="ident" id="1894969">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894975"><a href="/runtime/chan.go.html#1894771">gp</a></span><span class="op" id="1894977">.</span><span class="ident" id="1894978">param</span>&nbsp;<span class="op" id="1894984">=</span>&nbsp;<span class="ident" id="1894986">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1894992"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1894993">.</span><span class="ident" id="1894994">recvq</span><span class="op" id="1894999">.</span><span class="ident" id="1895000">enqueue</span><span class="op" id="1895007">(</span><span class="ident" id="1895008"><a href="/runtime/chan.go.html#1894786">mysg</a></span><span class="op" id="1895012">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895016"><a href="/runtime/proc.go.html#2066901">goparkunlock</a></span><span class="op" id="1895028">(</span><span class="op" id="1895029">&amp;</span><span class="ident" id="1895030"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1895031">.</span><span class="ident" id="1895032">lock</span><span class="op" id="1895036">,</span>&nbsp;<span class="string" id="1895038">&#34;chan&nbsp;receive&#34;</span><span class="op" id="1895052">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1895057">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895081">if</span>&nbsp;<span class="ident" id="1895084"><a href="/runtime/chan.go.html#1894786">mysg</a></span>&nbsp;<span class="op" id="1895089">!=</span>&nbsp;<span class="ident" id="1895092"><a href="/runtime/chan.go.html#1894771">gp</a></span><span class="op" id="1895094">.</span><span class="ident" id="1895095">waiting</span>&nbsp;<span class="op" id="1895103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895108"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1895115">(</span><span class="string" id="1895116">&#34;G&nbsp;waiting&nbsp;list&nbsp;is&nbsp;corrupted!&#34;</span><span class="op" id="1895146">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1895150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895154"><a href="/runtime/chan.go.html#1894771">gp</a></span><span class="op" id="1895156">.</span><span class="ident" id="1895157">waiting</span>&nbsp;<span class="op" id="1895165">=</span>&nbsp;<span class="ident" id="1895167">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895173">if</span>&nbsp;<span class="ident" id="1895176"><a href="/runtime/chan.go.html#1894786">mysg</a></span><span class="op" id="1895180">.</span><span class="ident" id="1895181">releasetime</span>&nbsp;<span class="op" id="1895193">&gt;</span>&nbsp;<span class="num" id="1895195">0</span>&nbsp;<span class="op" id="1895197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895202"><a href="/runtime/mprof.go.html#2020096">blockevent</a></span><span class="op" id="1895212">(</span><span class="ident" id="1895213"><a href="/runtime/chan.go.html#1894786">mysg</a></span><span class="op" id="1895217">.</span><span class="ident" id="1895218">releasetime</span><span class="op" id="1895229">-</span><span class="ident" id="1895230"><a href="/runtime/chan.go.html#1894126">t0</a></span><span class="op" id="1895232">,</span>&nbsp;<span class="num" id="1895234">2</span><span class="op" id="1895235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1895239">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895243">haveData</span>&nbsp;<span class="op" id="1895252">:=</span>&nbsp;<span class="ident" id="1895255"><a href="/runtime/chan.go.html#1894771">gp</a></span><span class="op" id="1895257">.</span><span class="ident" id="1895258">param</span>&nbsp;<span class="op" id="1895264">!=</span>&nbsp;<span class="ident" id="1895267">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895273"><a href="/runtime/chan.go.html#1894771">gp</a></span><span class="op" id="1895275">.</span><span class="ident" id="1895276">param</span>&nbsp;<span class="op" id="1895282">=</span>&nbsp;<span class="ident" id="1895284">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895290"><a href="/runtime/proc.go.html#2067870">releaseSudog</a></span><span class="op" id="1895302">(</span><span class="ident" id="1895303"><a href="/runtime/chan.go.html#1894786">mysg</a></span><span class="op" id="1895307">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895312">if</span>&nbsp;<span class="ident" id="1895315"><a href="/runtime/chan.go.html#1895243">haveData</a></span>&nbsp;<span class="op" id="1895324">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1895329">//&nbsp;a&nbsp;sender&nbsp;sent&nbsp;us&nbsp;some&nbsp;data.&nbsp;It&nbsp;already&nbsp;wrote&nbsp;to&nbsp;ep.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895387"><a href="/runtime/chan.go.html#1892957">selected</a></span>&nbsp;<span class="op" id="1895396">=</span>&nbsp;<span class="builtintype" id="1895398">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895406"><a href="/runtime/chan.go.html#1892967">received</a></span>&nbsp;<span class="op" id="1895415">=</span>&nbsp;<span class="builtintype" id="1895417">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895425">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1895434">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895439"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="1895443">(</span><span class="op" id="1895444">&amp;</span><span class="ident" id="1895445"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1895446">.</span><span class="ident" id="1895447">lock</span><span class="op" id="1895451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895455">if</span>&nbsp;<span class="ident" id="1895458"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1895459">.</span><span class="ident" id="1895460">closed</span>&nbsp;<span class="op" id="1895467">==</span>&nbsp;<span class="num" id="1895470">0</span>&nbsp;<span class="op" id="1895472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895477"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1895484">(</span><span class="string" id="1895485">&#34;chanrecv:&nbsp;spurious&nbsp;wakeup&#34;</span><span class="op" id="1895512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1895516">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895520">return</span>&nbsp;<span class="ident" id="1895527"><a href="/runtime/chan.go.html#1896992">recvclosed</a></span><span class="op" id="1895537">(</span><span class="ident" id="1895538"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1895539">,</span>&nbsp;<span class="ident" id="1895541"><a href="/runtime/chan.go.html#1892925">ep</a></span><span class="op" id="1895543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1895546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1895550">//&nbsp;asynchronous&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1895575">//&nbsp;wait&nbsp;for&nbsp;some&nbsp;data&nbsp;to&nbsp;appear</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895608">var</span>&nbsp;<span class="ident" id="1895612">t1</span>&nbsp;<span class="ident" id="1895615">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895622">for</span>&nbsp;<span class="ident" id="1895626"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1895627">.</span><span class="ident" id="1895628">qcount</span>&nbsp;<span class="op" id="1895635">&lt;=</span>&nbsp;<span class="num" id="1895638">0</span>&nbsp;<span class="op" id="1895640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895644">if</span>&nbsp;<span class="ident" id="1895647"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1895648">.</span><span class="ident" id="1895649">closed</span>&nbsp;<span class="op" id="1895656">!=</span>&nbsp;<span class="num" id="1895659">0</span>&nbsp;<span class="op" id="1895661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895666"><a href="/runtime/chan.go.html#1892957">selected</a></span><span class="op" id="1895674">,</span>&nbsp;<span class="ident" id="1895676"><a href="/runtime/chan.go.html#1892967">received</a></span>&nbsp;<span class="op" id="1895685">=</span>&nbsp;<span class="ident" id="1895687"><a href="/runtime/chan.go.html#1896992">recvclosed</a></span><span class="op" id="1895697">(</span><span class="ident" id="1895698"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1895699">,</span>&nbsp;<span class="ident" id="1895701"><a href="/runtime/chan.go.html#1892925">ep</a></span><span class="op" id="1895703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895708">if</span>&nbsp;<span class="ident" id="1895711"><a href="/runtime/chan.go.html#1895612">t1</a></span>&nbsp;<span class="op" id="1895714">&gt;</span>&nbsp;<span class="num" id="1895716">0</span>&nbsp;<span class="op" id="1895718">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895724"><a href="/runtime/mprof.go.html#2020096">blockevent</a></span><span class="op" id="1895734">(</span><span class="ident" id="1895735"><a href="/runtime/chan.go.html#1895612">t1</a></span><span class="op" id="1895737">-</span><span class="ident" id="1895738"><a href="/runtime/chan.go.html#1894126">t0</a></span><span class="op" id="1895740">,</span>&nbsp;<span class="num" id="1895742">2</span><span class="op" id="1895743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1895748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895753">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1895762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895767">if</span>&nbsp;<span class="op" id="1895770">!</span><span class="ident" id="1895771"><a href="/runtime/chan.go.html#1892944">block</a></span>&nbsp;<span class="op" id="1895777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895782"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1895788">(</span><span class="op" id="1895789">&amp;</span><span class="ident" id="1895790"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1895791">.</span><span class="ident" id="1895792">lock</span><span class="op" id="1895796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895801">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1895810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1895815">//&nbsp;wait&nbsp;for&nbsp;someone&nbsp;to&nbsp;send&nbsp;an&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895856">gp</span>&nbsp;<span class="op" id="1895859">:=</span>&nbsp;<span class="ident" id="1895862"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="1895866">(</span><span class="op" id="1895867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895871">mysg</span>&nbsp;<span class="op" id="1895876">:=</span>&nbsp;<span class="ident" id="1895879"><a href="/runtime/proc.go.html#2067140">acquireSudog</a></span><span class="op" id="1895891">(</span><span class="op" id="1895892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895896"><a href="/runtime/chan.go.html#1895871">mysg</a></span><span class="op" id="1895900">.</span><span class="ident" id="1895901">releasetime</span>&nbsp;<span class="op" id="1895913">=</span>&nbsp;<span class="num" id="1895915">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1895919">if</span>&nbsp;<span class="ident" id="1895922"><a href="/runtime/chan.go.html#1894126">t0</a></span>&nbsp;<span class="op" id="1895925">!=</span>&nbsp;<span class="num" id="1895928">0</span>&nbsp;<span class="op" id="1895930">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895935"><a href="/runtime/chan.go.html#1895871">mysg</a></span><span class="op" id="1895939">.</span><span class="ident" id="1895940">releasetime</span>&nbsp;<span class="op" id="1895952">=</span>&nbsp;<span class="op" id="1895954">-</span><span class="num" id="1895955">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1895959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895963"><a href="/runtime/chan.go.html#1895871">mysg</a></span><span class="op" id="1895967">.</span><span class="ident" id="1895968">elem</span>&nbsp;<span class="op" id="1895973">=</span>&nbsp;<span class="ident" id="1895975">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895981"><a href="/runtime/chan.go.html#1895871">mysg</a></span><span class="op" id="1895985">.</span><span class="ident" id="1895986">g</span>&nbsp;<span class="op" id="1895988">=</span>&nbsp;<span class="ident" id="1895990"><a href="/runtime/chan.go.html#1895856">gp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1895995"><a href="/runtime/chan.go.html#1895871">mysg</a></span><span class="op" id="1895999">.</span><span class="ident" id="1896000">selectdone</span>&nbsp;<span class="op" id="1896011">=</span>&nbsp;<span class="ident" id="1896013">nil</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896020"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896021">.</span><span class="ident" id="1896022">recvq</span><span class="op" id="1896027">.</span><span class="ident" id="1896028">enqueue</span><span class="op" id="1896035">(</span><span class="ident" id="1896036"><a href="/runtime/chan.go.html#1895871">mysg</a></span><span class="op" id="1896040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896044"><a href="/runtime/proc.go.html#2066901">goparkunlock</a></span><span class="op" id="1896056">(</span><span class="op" id="1896057">&amp;</span><span class="ident" id="1896058"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896059">.</span><span class="ident" id="1896060">lock</span><span class="op" id="1896064">,</span>&nbsp;<span class="string" id="1896066">&#34;chan&nbsp;receive&#34;</span><span class="op" id="1896080">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1896085">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up&nbsp;-&nbsp;try&nbsp;again</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896121">if</span>&nbsp;<span class="ident" id="1896124"><a href="/runtime/chan.go.html#1895871">mysg</a></span><span class="op" id="1896128">.</span><span class="ident" id="1896129">releasetime</span>&nbsp;<span class="op" id="1896141">&gt;</span>&nbsp;<span class="num" id="1896143">0</span>&nbsp;<span class="op" id="1896145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896150"><a href="/runtime/chan.go.html#1895612">t1</a></span>&nbsp;<span class="op" id="1896153">=</span>&nbsp;<span class="ident" id="1896155"><a href="/runtime/chan.go.html#1895871">mysg</a></span><span class="op" id="1896159">.</span><span class="ident" id="1896160">releasetime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896178"><a href="/runtime/proc.go.html#2067870">releaseSudog</a></span><span class="op" id="1896190">(</span><span class="ident" id="1896191"><a href="/runtime/chan.go.html#1895871">mysg</a></span><span class="op" id="1896195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896199"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="1896203">(</span><span class="op" id="1896204">&amp;</span><span class="ident" id="1896205"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896206">.</span><span class="ident" id="1896207">lock</span><span class="op" id="1896211">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896218">if</span>&nbsp;<span class="ident" id="1896221"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="1896233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896237"><a href="/runtime/race0.go.html#2070582">raceacquire</a></span><span class="op" id="1896248">(</span><span class="ident" id="1896249"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="1896256">(</span><span class="ident" id="1896257"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896258">,</span>&nbsp;<span class="ident" id="1896260"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896261">.</span><span class="ident" id="1896262">recvx</span><span class="op" id="1896267">)</span><span class="op" id="1896268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896272"><a href="/runtime/race0.go.html#2070774">racerelease</a></span><span class="op" id="1896283">(</span><span class="ident" id="1896284"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="1896291">(</span><span class="ident" id="1896292"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896293">,</span>&nbsp;<span class="ident" id="1896295"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896296">.</span><span class="ident" id="1896297">recvx</span><span class="op" id="1896302">)</span><span class="op" id="1896303">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896309">if</span>&nbsp;<span class="ident" id="1896312"><a href="/runtime/chan.go.html#1892925">ep</a></span>&nbsp;<span class="op" id="1896315">!=</span>&nbsp;<span class="ident" id="1896318">nil</span>&nbsp;<span class="op" id="1896322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896326"><a href="/runtime/stubs.go.html#2135810">memmove</a></span><span class="op" id="1896333">(</span><span class="ident" id="1896334"><a href="/runtime/chan.go.html#1892925">ep</a></span><span class="op" id="1896336">,</span>&nbsp;<span class="ident" id="1896338"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="1896345">(</span><span class="ident" id="1896346"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896347">,</span>&nbsp;<span class="ident" id="1896349"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896350">.</span><span class="ident" id="1896351">recvx</span><span class="op" id="1896356">)</span><span class="op" id="1896357">,</span>&nbsp;<span class="builtintype" id="1896359">uintptr</span><span class="op" id="1896366">(</span><span class="ident" id="1896367"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896368">.</span><span class="ident" id="1896369">elemsize</span><span class="op" id="1896377">)</span><span class="op" id="1896378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896384"><a href="/runtime/stubs.go.html#2135687">memclr</a></span><span class="op" id="1896390">(</span><span class="ident" id="1896391"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="1896398">(</span><span class="ident" id="1896399"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896400">,</span>&nbsp;<span class="ident" id="1896402"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896403">.</span><span class="ident" id="1896404">recvx</span><span class="op" id="1896409">)</span><span class="op" id="1896410">,</span>&nbsp;<span class="builtintype" id="1896412">uintptr</span><span class="op" id="1896419">(</span><span class="ident" id="1896420"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896421">.</span><span class="ident" id="1896422">elemsize</span><span class="op" id="1896430">)</span><span class="op" id="1896431">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896435"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896436">.</span><span class="ident" id="1896437">recvx</span><span class="op" id="1896442">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896446">if</span>&nbsp;<span class="ident" id="1896449"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896450">.</span><span class="ident" id="1896451">recvx</span>&nbsp;<span class="op" id="1896457">==</span>&nbsp;<span class="ident" id="1896460"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896461">.</span><span class="ident" id="1896462">dataqsiz</span>&nbsp;<span class="op" id="1896471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896475"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896476">.</span><span class="ident" id="1896477">recvx</span>&nbsp;<span class="op" id="1896483">=</span>&nbsp;<span class="num" id="1896485">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896488">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896491"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896492">.</span><span class="ident" id="1896493">qcount</span><span class="op" id="1896499">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1896504">//&nbsp;ping&nbsp;a&nbsp;sender&nbsp;now&nbsp;that&nbsp;there&nbsp;is&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896546">sg</span>&nbsp;<span class="op" id="1896549">:=</span>&nbsp;<span class="ident" id="1896552"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896553">.</span><span class="ident" id="1896554">sendq</span><span class="op" id="1896559">.</span><span class="ident" id="1896560">dequeue</span><span class="op" id="1896567">(</span><span class="op" id="1896568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896571">if</span>&nbsp;<span class="ident" id="1896574"><a href="/runtime/chan.go.html#1896546">sg</a></span>&nbsp;<span class="op" id="1896577">!=</span>&nbsp;<span class="ident" id="1896580">nil</span>&nbsp;<span class="op" id="1896584">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896588">gp</span>&nbsp;<span class="op" id="1896591">:=</span>&nbsp;<span class="ident" id="1896594"><a href="/runtime/chan.go.html#1896546">sg</a></span><span class="op" id="1896596">.</span><span class="ident" id="1896597">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896601"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1896607">(</span><span class="op" id="1896608">&amp;</span><span class="ident" id="1896609"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896610">.</span><span class="ident" id="1896611">lock</span><span class="op" id="1896615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896619">if</span>&nbsp;<span class="ident" id="1896622"><a href="/runtime/chan.go.html#1896546">sg</a></span><span class="op" id="1896624">.</span><span class="ident" id="1896625">releasetime</span>&nbsp;<span class="op" id="1896637">!=</span>&nbsp;<span class="num" id="1896640">0</span>&nbsp;<span class="op" id="1896642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896647"><a href="/runtime/chan.go.html#1896546">sg</a></span><span class="op" id="1896649">.</span><span class="ident" id="1896650">releasetime</span>&nbsp;<span class="op" id="1896662">=</span>&nbsp;<span class="ident" id="1896664"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="1896672">(</span><span class="op" id="1896673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896677">}</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896681"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="1896688">(</span><span class="ident" id="1896689"><a href="/runtime/chan.go.html#1896588">gp</a></span><span class="op" id="1896691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896694">}</span>&nbsp;<span class="keyword" id="1896696">else</span>&nbsp;<span class="op" id="1896701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896705"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1896711">(</span><span class="op" id="1896712">&amp;</span><span class="ident" id="1896713"><a href="/runtime/chan.go.html#1892915">c</a></span><span class="op" id="1896714">.</span><span class="ident" id="1896715">lock</span><span class="op" id="1896719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896726">if</span>&nbsp;<span class="ident" id="1896729"><a href="/runtime/chan.go.html#1895612">t1</a></span>&nbsp;<span class="op" id="1896732">&gt;</span>&nbsp;<span class="num" id="1896734">0</span>&nbsp;<span class="op" id="1896736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896740"><a href="/runtime/mprof.go.html#2020096">blockevent</a></span><span class="op" id="1896750">(</span><span class="ident" id="1896751"><a href="/runtime/chan.go.html#1895612">t1</a></span><span class="op" id="1896753">-</span><span class="ident" id="1896754"><a href="/runtime/chan.go.html#1894126">t0</a></span><span class="op" id="1896756">,</span>&nbsp;<span class="num" id="1896758">2</span><span class="op" id="1896759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1896762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896765"><a href="/runtime/chan.go.html#1892957">selected</a></span>&nbsp;<span class="op" id="1896774">=</span>&nbsp;<span class="builtintype" id="1896776">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1896782"><a href="/runtime/chan.go.html#1892967">received</a></span>&nbsp;<span class="op" id="1896791">=</span>&nbsp;<span class="builtintype" id="1896793">true</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1896799">return</span><br>
<span class="lineno"></span><span class="op" id="1896806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1896809">//&nbsp;recvclosed&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;chanrecv.&nbsp;&nbsp;Handles&nbsp;cleanup</span><br>
<span class="lineno"></span><span class="comment" id="1896875">//&nbsp;when&nbsp;the&nbsp;receiver&nbsp;encounters&nbsp;a&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">515</span><span class="comment" id="1896925">//&nbsp;Caller&nbsp;must&nbsp;hold&nbsp;c.lock,&nbsp;recvclosed&nbsp;will&nbsp;release&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span><span class="keyword" id="1896987">func</span>&nbsp;<span class="ident" id="1896992">recvclosed</span><span class="op" id="1897002">(</span><span class="ident" id="1897003">c</span>&nbsp;<span class="op" id="1897005">*</span><span class="ident" id="1897006"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1897011">,</span>&nbsp;<span class="ident" id="1897013">ep</span>&nbsp;<span class="ident" id="1897016"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1897022">.</span><span class="ident" id="1897023">Pointer</span><span class="op" id="1897030">)</span>&nbsp;<span class="op" id="1897032">(</span><span class="ident" id="1897033">selected</span><span class="op" id="1897041">,</span>&nbsp;<span class="ident" id="1897043">recevied</span>&nbsp;<span class="builtintype" id="1897052">bool</span><span class="op" id="1897056">)</span>&nbsp;<span class="op" id="1897058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897061">if</span>&nbsp;<span class="ident" id="1897064"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="1897076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897080"><a href="/runtime/race0.go.html#2070582">raceacquire</a></span><span class="op" id="1897091">(</span><span class="ident" id="1897092"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1897098">.</span><span class="ident" id="1897099">Pointer</span><span class="op" id="1897106">(</span><span class="ident" id="1897107"><a href="/runtime/chan.go.html#1897003">c</a></span><span class="op" id="1897108">)</span><span class="op" id="1897109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1897112">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897115"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="1897121">(</span><span class="op" id="1897122">&amp;</span><span class="ident" id="1897123"><a href="/runtime/chan.go.html#1897003">c</a></span><span class="op" id="1897124">.</span><span class="ident" id="1897125">lock</span><span class="op" id="1897129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897132">if</span>&nbsp;<span class="ident" id="1897135"><a href="/runtime/chan.go.html#1897013">ep</a></span>&nbsp;<span class="op" id="1897138">!=</span>&nbsp;<span class="ident" id="1897141">nil</span>&nbsp;<span class="op" id="1897145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897149"><a href="/runtime/stubs.go.html#2135687">memclr</a></span><span class="op" id="1897155">(</span><span class="ident" id="1897156"><a href="/runtime/chan.go.html#1897013">ep</a></span><span class="op" id="1897158">,</span>&nbsp;<span class="builtintype" id="1897160">uintptr</span><span class="op" id="1897167">(</span><span class="ident" id="1897168"><a href="/runtime/chan.go.html#1897003">c</a></span><span class="op" id="1897169">.</span><span class="ident" id="1897170">elemsize</span><span class="op" id="1897178">)</span><span class="op" id="1897179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1897182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897185">return</span>&nbsp;<span class="builtintype" id="1897192">true</span><span class="op" id="1897196">,</span>&nbsp;<span class="builtintype" id="1897198">false</span><br>
<span class="lineno">525</span><span class="op" id="1897204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1897207">//&nbsp;compiler&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="1897230">//</span><br>
<span class="lineno"></span><span class="comment" id="1897233">//&nbsp;&nbsp;&nbsp;&nbspselect&nbsp;{</span><br>
<span class="lineno">530</span><span class="comment" id="1897245">//&nbsp;&nbsp;&nbsp;&nbspcase&nbsp;c&nbsp;&lt;-&nbsp;v:</span><br>
<span class="lineno"></span><span class="comment" id="1897261">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="1897273">//&nbsp;&nbsp;&nbsp;&nbspdefault:</span><br>
<span class="lineno"></span><span class="comment" id="1897285">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;bar</span><br>
<span class="lineno"></span><span class="comment" id="1897297">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno">535</span><span class="comment" id="1897302">//</span><br>
<span class="lineno"></span><span class="comment" id="1897305">//&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1897311">//</span><br>
<span class="lineno"></span><span class="comment" id="1897314">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;selectnbsend(c,&nbsp;v)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1897341">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;foo</span><br>
<span class="lineno">540</span><span class="comment" id="1897353">//&nbsp;&nbsp;&nbsp;&nbsp}&nbsp;else&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1897365">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;bar</span><br>
<span class="lineno"></span><span class="comment" id="1897377">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1897382">//</span><br>
<span class="lineno"></span><span class="keyword" id="1897385">func</span>&nbsp;<span class="ident" id="1897390">selectnbsend</span><span class="op" id="1897402">(</span><span class="ident" id="1897403">t</span>&nbsp;<span class="op" id="1897405">*</span><span class="ident" id="1897406"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189434">chantype</a></span><span class="op" id="1897414">,</span>&nbsp;<span class="ident" id="1897416">c</span>&nbsp;<span class="op" id="1897418">*</span><span class="ident" id="1897419"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1897424">,</span>&nbsp;<span class="ident" id="1897426">elem</span>&nbsp;<span class="ident" id="1897431"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1897437">.</span><span class="ident" id="1897438">Pointer</span><span class="op" id="1897445">)</span>&nbsp;<span class="op" id="1897447">(</span><span class="ident" id="1897448">selected</span>&nbsp;<span class="builtintype" id="1897457">bool</span><span class="op" id="1897461">)</span>&nbsp;<span class="op" id="1897463">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897466">return</span>&nbsp;<span class="ident" id="1897473"><a href="/runtime/chan.go.html#1887446">chansend</a></span><span class="op" id="1897481">(</span><span class="ident" id="1897482"><a href="/runtime/chan.go.html#1897403">t</a></span><span class="op" id="1897483">,</span>&nbsp;<span class="ident" id="1897485"><a href="/runtime/chan.go.html#1897416">c</a></span><span class="op" id="1897486">,</span>&nbsp;<span class="ident" id="1897488"><a href="/runtime/chan.go.html#1897426">elem</a></span><span class="op" id="1897492">,</span>&nbsp;<span class="builtintype" id="1897494">false</span><span class="op" id="1897499">,</span>&nbsp;<span class="ident" id="1897501"><a href="/runtime/stubs.go.html#2139499">getcallerpc</a></span><span class="op" id="1897512">(</span><span class="ident" id="1897513"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1897519">.</span><span class="ident" id="1897520">Pointer</span><span class="op" id="1897527">(</span><span class="op" id="1897528">&amp;</span><span class="ident" id="1897529"><a href="/runtime/chan.go.html#1897403">t</a></span><span class="op" id="1897530">)</span><span class="op" id="1897531">)</span><span class="op" id="1897532">)</span><br>
<span class="lineno"></span><span class="op" id="1897534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1897537">//&nbsp;compiler&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="1897560">//</span><br>
<span class="lineno">550</span><span class="comment" id="1897563">//&nbsp;&nbsp;&nbsp;&nbspselect&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1897575">//&nbsp;&nbsp;&nbsp;&nbspcase&nbsp;v&nbsp;=&nbsp;&lt;-c:</span><br>
<span class="lineno"></span><span class="comment" id="1897592">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="1897604">//&nbsp;&nbsp;&nbsp;&nbspdefault:</span><br>
<span class="lineno"></span><span class="comment" id="1897616">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;bar</span><br>
<span class="lineno">555</span><span class="comment" id="1897628">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1897633">//</span><br>
<span class="lineno"></span><span class="comment" id="1897636">//&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1897642">//</span><br>
<span class="lineno"></span><span class="comment" id="1897645">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;selectnbrecv(&amp;v,&nbsp;c)&nbsp;{</span><br>
<span class="lineno">560</span><span class="comment" id="1897673">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="1897685">//&nbsp;&nbsp;&nbsp;&nbsp}&nbsp;else&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1897697">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;bar</span><br>
<span class="lineno"></span><span class="comment" id="1897709">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1897714">//</span><br>
<span class="lineno">565</span><span class="keyword" id="1897717">func</span>&nbsp;<span class="ident" id="1897722">selectnbrecv</span><span class="op" id="1897734">(</span><span class="ident" id="1897735">t</span>&nbsp;<span class="op" id="1897737">*</span><span class="ident" id="1897738"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189434">chantype</a></span><span class="op" id="1897746">,</span>&nbsp;<span class="ident" id="1897748">elem</span>&nbsp;<span class="ident" id="1897753"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1897759">.</span><span class="ident" id="1897760">Pointer</span><span class="op" id="1897767">,</span>&nbsp;<span class="ident" id="1897769">c</span>&nbsp;<span class="op" id="1897771">*</span><span class="ident" id="1897772"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1897777">)</span>&nbsp;<span class="op" id="1897779">(</span><span class="ident" id="1897780">selected</span>&nbsp;<span class="builtintype" id="1897789">bool</span><span class="op" id="1897793">)</span>&nbsp;<span class="op" id="1897795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1897798"><a href="/runtime/chan.go.html#1897780">selected</a></span><span class="op" id="1897806">,</span>&nbsp;<span class="ident" id="1897808">_</span>&nbsp;<span class="op" id="1897810">=</span>&nbsp;<span class="ident" id="1897812"><a href="/runtime/chan.go.html#1892893">chanrecv</a></span><span class="op" id="1897820">(</span><span class="ident" id="1897821"><a href="/runtime/chan.go.html#1897735">t</a></span><span class="op" id="1897822">,</span>&nbsp;<span class="ident" id="1897824"><a href="/runtime/chan.go.html#1897769">c</a></span><span class="op" id="1897825">,</span>&nbsp;<span class="ident" id="1897827"><a href="/runtime/chan.go.html#1897748">elem</a></span><span class="op" id="1897831">,</span>&nbsp;<span class="builtintype" id="1897833">false</span><span class="op" id="1897838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1897841">return</span><br>
<span class="lineno"></span><span class="op" id="1897848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="1897851">//&nbsp;compiler&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="1897874">//</span><br>
<span class="lineno"></span><span class="comment" id="1897877">//&nbsp;&nbsp;&nbsp;&nbspselect&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1897889">//&nbsp;&nbsp;&nbsp;&nbspcase&nbsp;v,&nbsp;ok&nbsp;=&nbsp;&lt;-c:</span><br>
<span class="lineno"></span><span class="comment" id="1897910">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;foo</span><br>
<span class="lineno">575</span><span class="comment" id="1897922">//&nbsp;&nbsp;&nbsp;&nbspdefault:</span><br>
<span class="lineno"></span><span class="comment" id="1897934">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;bar</span><br>
<span class="lineno"></span><span class="comment" id="1897946">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1897951">//</span><br>
<span class="lineno"></span><span class="comment" id="1897954">//&nbsp;as</span><br>
<span class="lineno">580</span><span class="comment" id="1897960">//</span><br>
<span class="lineno"></span><span class="comment" id="1897963">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;c&nbsp;!=&nbsp;nil&nbsp;&amp;&amp;&nbsp;selectnbrecv2(&amp;v,&nbsp;&amp;ok,&nbsp;c)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1898009">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="1898021">//&nbsp;&nbsp;&nbsp;&nbsp}&nbsp;else&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1898033">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;bar</span><br>
<span class="lineno">585</span><span class="comment" id="1898045">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1898050">//</span><br>
<span class="lineno"></span><span class="keyword" id="1898053">func</span>&nbsp;<span class="ident" id="1898058">selectnbrecv2</span><span class="op" id="1898071">(</span><span class="ident" id="1898072">t</span>&nbsp;<span class="op" id="1898074">*</span><span class="ident" id="1898075"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189434">chantype</a></span><span class="op" id="1898083">,</span>&nbsp;<span class="ident" id="1898085">elem</span>&nbsp;<span class="ident" id="1898090"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1898096">.</span><span class="ident" id="1898097">Pointer</span><span class="op" id="1898104">,</span>&nbsp;<span class="ident" id="1898106">received</span>&nbsp;<span class="op" id="1898115">*</span><span class="builtintype" id="1898116">bool</span><span class="op" id="1898120">,</span>&nbsp;<span class="ident" id="1898122">c</span>&nbsp;<span class="op" id="1898124">*</span><span class="ident" id="1898125"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1898130">)</span>&nbsp;<span class="op" id="1898132">(</span><span class="ident" id="1898133">selected</span>&nbsp;<span class="builtintype" id="1898142">bool</span><span class="op" id="1898146">)</span>&nbsp;<span class="op" id="1898148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1898151">//&nbsp;TODO(khr):&nbsp;just&nbsp;return&nbsp;2&nbsp;values&nbsp;from&nbsp;this&nbsp;function,&nbsp;now&nbsp;that&nbsp;it&nbsp;is&nbsp;in&nbsp;Go.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898229"><a href="/runtime/chan.go.html#1898133">selected</a></span><span class="op" id="1898237">,</span>&nbsp;<span class="op" id="1898239">*</span><span class="ident" id="1898240"><a href="/runtime/chan.go.html#1898106">received</a></span>&nbsp;<span class="op" id="1898249">=</span>&nbsp;<span class="ident" id="1898251"><a href="/runtime/chan.go.html#1892893">chanrecv</a></span><span class="op" id="1898259">(</span><span class="ident" id="1898260"><a href="/runtime/chan.go.html#1898072">t</a></span><span class="op" id="1898261">,</span>&nbsp;<span class="ident" id="1898263"><a href="/runtime/chan.go.html#1898122">c</a></span><span class="op" id="1898264">,</span>&nbsp;<span class="ident" id="1898266"><a href="/runtime/chan.go.html#1898085">elem</a></span><span class="op" id="1898270">,</span>&nbsp;<span class="builtintype" id="1898272">false</span><span class="op" id="1898277">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898280">return</span><br>
<span class="lineno"></span><span class="op" id="1898287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1898290">func</span>&nbsp;<span class="ident" id="1898295">reflect_chansend</span><span class="op" id="1898311">(</span><span class="ident" id="1898312">t</span>&nbsp;<span class="op" id="1898314">*</span><span class="ident" id="1898315"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189434">chantype</a></span><span class="op" id="1898323">,</span>&nbsp;<span class="ident" id="1898325">c</span>&nbsp;<span class="op" id="1898327">*</span><span class="ident" id="1898328"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1898333">,</span>&nbsp;<span class="ident" id="1898335">elem</span>&nbsp;<span class="ident" id="1898340"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1898346">.</span><span class="ident" id="1898347">Pointer</span><span class="op" id="1898354">,</span>&nbsp;<span class="ident" id="1898356">nb</span>&nbsp;<span class="builtintype" id="1898359">bool</span><span class="op" id="1898363">)</span>&nbsp;<span class="op" id="1898365">(</span><span class="ident" id="1898366">selected</span>&nbsp;<span class="builtintype" id="1898375">bool</span><span class="op" id="1898379">)</span>&nbsp;<span class="op" id="1898381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898384">return</span>&nbsp;<span class="ident" id="1898391"><a href="/runtime/chan.go.html#1887446">chansend</a></span><span class="op" id="1898399">(</span><span class="ident" id="1898400"><a href="/runtime/chan.go.html#1898312">t</a></span><span class="op" id="1898401">,</span>&nbsp;<span class="ident" id="1898403"><a href="/runtime/chan.go.html#1898325">c</a></span><span class="op" id="1898404">,</span>&nbsp;<span class="ident" id="1898406"><a href="/runtime/chan.go.html#1898335">elem</a></span><span class="op" id="1898410">,</span>&nbsp;<span class="op" id="1898412">!</span><span class="ident" id="1898413"><a href="/runtime/chan.go.html#1898356">nb</a></span><span class="op" id="1898415">,</span>&nbsp;<span class="ident" id="1898417"><a href="/runtime/stubs.go.html#2139499">getcallerpc</a></span><span class="op" id="1898428">(</span><span class="ident" id="1898429"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1898435">.</span><span class="ident" id="1898436">Pointer</span><span class="op" id="1898443">(</span><span class="op" id="1898444">&amp;</span><span class="ident" id="1898445"><a href="/runtime/chan.go.html#1898312">t</a></span><span class="op" id="1898446">)</span><span class="op" id="1898447">)</span><span class="op" id="1898448">)</span><br>
<span class="lineno">595</span><span class="op" id="1898450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1898453">func</span>&nbsp;<span class="ident" id="1898458">reflect_chanrecv</span><span class="op" id="1898474">(</span><span class="ident" id="1898475">t</span>&nbsp;<span class="op" id="1898477">*</span><span class="ident" id="1898478"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189434">chantype</a></span><span class="op" id="1898486">,</span>&nbsp;<span class="ident" id="1898488">c</span>&nbsp;<span class="op" id="1898490">*</span><span class="ident" id="1898491"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1898496">,</span>&nbsp;<span class="ident" id="1898498">nb</span>&nbsp;<span class="builtintype" id="1898501">bool</span><span class="op" id="1898505">,</span>&nbsp;<span class="ident" id="1898507">elem</span>&nbsp;<span class="ident" id="1898512"><a href="/runtime/chan.go.html#1885126">unsafe</a></span><span class="op" id="1898518">.</span><span class="ident" id="1898519">Pointer</span><span class="op" id="1898526">)</span>&nbsp;<span class="op" id="1898528">(</span><span class="ident" id="1898529">selected</span>&nbsp;<span class="builtintype" id="1898538">bool</span><span class="op" id="1898542">,</span>&nbsp;<span class="ident" id="1898544">received</span>&nbsp;<span class="builtintype" id="1898553">bool</span><span class="op" id="1898557">)</span>&nbsp;<span class="op" id="1898559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898562">return</span>&nbsp;<span class="ident" id="1898569"><a href="/runtime/chan.go.html#1892893">chanrecv</a></span><span class="op" id="1898577">(</span><span class="ident" id="1898578"><a href="/runtime/chan.go.html#1898475">t</a></span><span class="op" id="1898579">,</span>&nbsp;<span class="ident" id="1898581"><a href="/runtime/chan.go.html#1898488">c</a></span><span class="op" id="1898582">,</span>&nbsp;<span class="ident" id="1898584"><a href="/runtime/chan.go.html#1898507">elem</a></span><span class="op" id="1898588">,</span>&nbsp;<span class="op" id="1898590">!</span><span class="ident" id="1898591"><a href="/runtime/chan.go.html#1898498">nb</a></span><span class="op" id="1898593">)</span><br>
<span class="lineno"></span><span class="op" id="1898595">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="1898598">func</span>&nbsp;<span class="ident" id="1898603">reflect_chanlen</span><span class="op" id="1898618">(</span><span class="ident" id="1898619">c</span>&nbsp;<span class="op" id="1898621">*</span><span class="ident" id="1898622"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1898627">)</span>&nbsp;<span class="builtintype" id="1898629">int</span>&nbsp;<span class="op" id="1898633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898636">if</span>&nbsp;<span class="ident" id="1898639"><a href="/runtime/chan.go.html#1898619">c</a></span>&nbsp;<span class="op" id="1898641">==</span>&nbsp;<span class="ident" id="1898644">nil</span>&nbsp;<span class="op" id="1898648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898652">return</span>&nbsp;<span class="num" id="1898659">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898662">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898665">return</span>&nbsp;<span class="builtintype" id="1898672">int</span><span class="op" id="1898675">(</span><span class="ident" id="1898676"><a href="/runtime/chan.go.html#1898619">c</a></span><span class="op" id="1898677">.</span><span class="ident" id="1898678">qcount</span><span class="op" id="1898684">)</span><br>
<span class="lineno"></span><span class="op" id="1898686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1898689">func</span>&nbsp;<span class="ident" id="1898694">reflect_chancap</span><span class="op" id="1898709">(</span><span class="ident" id="1898710">c</span>&nbsp;<span class="op" id="1898712">*</span><span class="ident" id="1898713"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1898718">)</span>&nbsp;<span class="builtintype" id="1898720">int</span>&nbsp;<span class="op" id="1898724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898727">if</span>&nbsp;<span class="ident" id="1898730"><a href="/runtime/chan.go.html#1898710">c</a></span>&nbsp;<span class="op" id="1898732">==</span>&nbsp;<span class="ident" id="1898735">nil</span>&nbsp;<span class="op" id="1898739">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898743">return</span>&nbsp;<span class="num" id="1898750">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898756">return</span>&nbsp;<span class="builtintype" id="1898763">int</span><span class="op" id="1898766">(</span><span class="ident" id="1898767"><a href="/runtime/chan.go.html#1898710">c</a></span><span class="op" id="1898768">.</span><span class="ident" id="1898769">dataqsiz</span><span class="op" id="1898777">)</span><br>
<span class="lineno"></span><span class="op" id="1898779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="1898782">func</span>&nbsp;<span class="op" id="1898787">(</span><span class="ident" id="1898788">q</span>&nbsp;<span class="op" id="1898790">*</span><span class="ident" id="1898791"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189673">waitq</a></span><span class="op" id="1898796">)</span>&nbsp;<span class="ident" id="1898798">enqueue</span><span class="op" id="1898805">(</span><span class="ident" id="1898806">sgp</span>&nbsp;<span class="op" id="1898810">*</span><span class="ident" id="1898811"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179851">sudog</a></span><span class="op" id="1898816">)</span>&nbsp;<span class="op" id="1898818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898821"><a href="/runtime/chan.go.html#1898806">sgp</a></span><span class="op" id="1898824">.</span><span class="ident" id="1898825">next</span>&nbsp;<span class="op" id="1898830">=</span>&nbsp;<span class="ident" id="1898832">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898837">if</span>&nbsp;<span class="ident" id="1898840"><a href="/runtime/chan.go.html#1898788">q</a></span><span class="op" id="1898841">.</span><span class="ident" id="1898842">first</span>&nbsp;<span class="op" id="1898848">==</span>&nbsp;<span class="ident" id="1898851">nil</span>&nbsp;<span class="op" id="1898855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898859"><a href="/runtime/chan.go.html#1898788">q</a></span><span class="op" id="1898860">.</span><span class="ident" id="1898861">first</span>&nbsp;<span class="op" id="1898867">=</span>&nbsp;<span class="ident" id="1898869"><a href="/runtime/chan.go.html#1898806">sgp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898875"><a href="/runtime/chan.go.html#1898788">q</a></span><span class="op" id="1898876">.</span><span class="ident" id="1898877">last</span>&nbsp;<span class="op" id="1898882">=</span>&nbsp;<span class="ident" id="1898884"><a href="/runtime/chan.go.html#1898806">sgp</a></span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898890">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1898898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898901"><a href="/runtime/chan.go.html#1898788">q</a></span><span class="op" id="1898902">.</span><span class="ident" id="1898903">last</span><span class="op" id="1898907">.</span><span class="ident" id="1898908">next</span>&nbsp;<span class="op" id="1898913">=</span>&nbsp;<span class="ident" id="1898915"><a href="/runtime/chan.go.html#1898806">sgp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898920"><a href="/runtime/chan.go.html#1898788">q</a></span><span class="op" id="1898921">.</span><span class="ident" id="1898922">last</span>&nbsp;<span class="op" id="1898927">=</span>&nbsp;<span class="ident" id="1898929"><a href="/runtime/chan.go.html#1898806">sgp</a></span><br>
<span class="lineno"></span><span class="op" id="1898933">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span><span class="keyword" id="1898936">func</span>&nbsp;<span class="op" id="1898941">(</span><span class="ident" id="1898942">q</span>&nbsp;<span class="op" id="1898944">*</span><span class="ident" id="1898945"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189673">waitq</a></span><span class="op" id="1898950">)</span>&nbsp;<span class="ident" id="1898952">dequeue</span><span class="op" id="1898959">(</span><span class="op" id="1898960">)</span>&nbsp;<span class="op" id="1898962">*</span><span class="ident" id="1898963"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179851">sudog</a></span>&nbsp;<span class="op" id="1898969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898972">for</span>&nbsp;<span class="op" id="1898976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1898980">sgp</span>&nbsp;<span class="op" id="1898984">:=</span>&nbsp;<span class="ident" id="1898987"><a href="/runtime/chan.go.html#1898942">q</a></span><span class="op" id="1898988">.</span><span class="ident" id="1898989">first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1898997">if</span>&nbsp;<span class="ident" id="1899000"><a href="/runtime/chan.go.html#1898980">sgp</a></span>&nbsp;<span class="op" id="1899004">==</span>&nbsp;<span class="ident" id="1899007">nil</span>&nbsp;<span class="op" id="1899011">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899016">return</span>&nbsp;<span class="ident" id="1899023">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1899029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899033"><a href="/runtime/chan.go.html#1898942">q</a></span><span class="op" id="1899034">.</span><span class="ident" id="1899035">first</span>&nbsp;<span class="op" id="1899041">=</span>&nbsp;<span class="ident" id="1899043"><a href="/runtime/chan.go.html#1898980">sgp</a></span><span class="op" id="1899046">.</span><span class="ident" id="1899047">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899054"><a href="/runtime/chan.go.html#1898980">sgp</a></span><span class="op" id="1899057">.</span><span class="ident" id="1899058">next</span>&nbsp;<span class="op" id="1899063">=</span>&nbsp;<span class="ident" id="1899065">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899071">if</span>&nbsp;<span class="ident" id="1899074"><a href="/runtime/chan.go.html#1898942">q</a></span><span class="op" id="1899075">.</span><span class="ident" id="1899076">last</span>&nbsp;<span class="op" id="1899081">==</span>&nbsp;<span class="ident" id="1899084"><a href="/runtime/chan.go.html#1898980">sgp</a></span>&nbsp;<span class="op" id="1899088">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899093"><a href="/runtime/chan.go.html#1898942">q</a></span><span class="op" id="1899094">.</span><span class="ident" id="1899095">last</span>&nbsp;<span class="op" id="1899100">=</span>&nbsp;<span class="ident" id="1899102">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1899108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1899113">//&nbsp;if&nbsp;sgp&nbsp;participates&nbsp;in&nbsp;a&nbsp;select&nbsp;and&nbsp;is&nbsp;already&nbsp;signaled,&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899185">if</span>&nbsp;<span class="ident" id="1899188"><a href="/runtime/chan.go.html#1898980">sgp</a></span><span class="op" id="1899191">.</span><span class="ident" id="1899192">selectdone</span>&nbsp;<span class="op" id="1899203">!=</span>&nbsp;<span class="ident" id="1899206">nil</span>&nbsp;<span class="op" id="1899210">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1899215">//&nbsp;claim&nbsp;the&nbsp;right&nbsp;to&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899247">if</span>&nbsp;<span class="op" id="1899250">*</span><span class="ident" id="1899251"><a href="/runtime/chan.go.html#1898980">sgp</a></span><span class="op" id="1899254">.</span><span class="ident" id="1899255">selectdone</span>&nbsp;<span class="op" id="1899266">!=</span>&nbsp;<span class="num" id="1899269">0</span>&nbsp;<span class="op" id="1899271">||</span>&nbsp;<span class="op" id="1899274">!</span><span class="ident" id="1899275"><a href="/runtime/stubs.go.html#2137846">cas</a></span><span class="op" id="1899278">(</span><span class="ident" id="1899279"><a href="/runtime/chan.go.html#1898980">sgp</a></span><span class="op" id="1899282">.</span><span class="ident" id="1899283">selectdone</span><span class="op" id="1899293">,</span>&nbsp;<span class="num" id="1899295">0</span><span class="op" id="1899296">,</span>&nbsp;<span class="num" id="1899298">1</span><span class="op" id="1899299">)</span>&nbsp;<span class="op" id="1899301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899307">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1899319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1899323">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1899328">return</span>&nbsp;<span class="ident" id="1899335"><a href="/runtime/chan.go.html#1898980">sgp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1899340">}</span><br>
<span class="lineno"></span><span class="op" id="1899342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="keyword" id="1899345">func</span>&nbsp;<span class="ident" id="1899350">racesync</span><span class="op" id="1899358">(</span><span class="ident" id="1899359">c</span>&nbsp;<span class="op" id="1899361">*</span><span class="ident" id="1899362"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="1899367">,</span>&nbsp;<span class="ident" id="1899369">sg</span>&nbsp;<span class="op" id="1899372">*</span><span class="ident" id="1899373"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179851">sudog</a></span><span class="op" id="1899378">)</span>&nbsp;<span class="op" id="1899380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899383"><a href="/runtime/race0.go.html#2070774">racerelease</a></span><span class="op" id="1899394">(</span><span class="ident" id="1899395"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="1899402">(</span><span class="ident" id="1899403"><a href="/runtime/chan.go.html#1899359">c</a></span><span class="op" id="1899404">,</span>&nbsp;<span class="num" id="1899406">0</span><span class="op" id="1899407">)</span><span class="op" id="1899408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899411"><a href="/runtime/race0.go.html#2070678">raceacquireg</a></span><span class="op" id="1899423">(</span><span class="ident" id="1899424"><a href="/runtime/chan.go.html#1899369">sg</a></span><span class="op" id="1899426">.</span><span class="ident" id="1899427">g</span><span class="op" id="1899428">,</span>&nbsp;<span class="ident" id="1899430"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="1899437">(</span><span class="ident" id="1899438"><a href="/runtime/chan.go.html#1899359">c</a></span><span class="op" id="1899439">,</span>&nbsp;<span class="num" id="1899441">0</span><span class="op" id="1899442">)</span><span class="op" id="1899443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899446"><a href="/runtime/race0.go.html#2070870">racereleaseg</a></span><span class="op" id="1899458">(</span><span class="ident" id="1899459"><a href="/runtime/chan.go.html#1899369">sg</a></span><span class="op" id="1899461">.</span><span class="ident" id="1899462">g</span><span class="op" id="1899463">,</span>&nbsp;<span class="ident" id="1899465"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="1899472">(</span><span class="ident" id="1899473"><a href="/runtime/chan.go.html#1899359">c</a></span><span class="op" id="1899474">,</span>&nbsp;<span class="num" id="1899476">0</span><span class="op" id="1899477">)</span><span class="op" id="1899478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1899481"><a href="/runtime/race0.go.html#2070582">raceacquire</a></span><span class="op" id="1899492">(</span><span class="ident" id="1899493"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="1899500">(</span><span class="ident" id="1899501"><a href="/runtime/chan.go.html#1899359">c</a></span><span class="op" id="1899502">,</span>&nbsp;<span class="num" id="1899504">0</span><span class="op" id="1899505">)</span><span class="op" id="1899506">)</span><br>
<span class="lineno">655</span><span class="op" id="1899508">}</span>
</div>
</body>
</html>
