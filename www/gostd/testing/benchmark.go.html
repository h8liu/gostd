<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5944374">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5944429">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5944483">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5944534">package</span>&nbsp;<span class="ident" id="5944542">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5944551">import</span>&nbsp;<span class="op" id="5944558">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5944561">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5944569">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5944576">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5944582">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5944593">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5944601">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5944616">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5944623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5944626">var</span>&nbsp;<span class="ident" id="5944630">matchBenchmarks</span>&nbsp;<span class="op" id="5944646">=</span>&nbsp;<span class="ident" id="5944648">flag</span><span class="op" id="5944652">.</span><span class="ident" id="5944653">String</span><span class="op" id="5944659">(</span><span class="string" id="5944660">&#34;test.bench&#34;</span><span class="op" id="5944672">,</span>&nbsp;<span class="string" id="5944674">&#34;&#34;</span><span class="op" id="5944676">,</span>&nbsp;<span class="string" id="5944678">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="5944726">)</span><br>
<span class="lineno"></span><span class="keyword" id="5944728">var</span>&nbsp;<span class="ident" id="5944732">benchTime</span>&nbsp;<span class="op" id="5944742">=</span>&nbsp;<span class="ident" id="5944744">flag</span><span class="op" id="5944748">.</span><span class="ident" id="5944749">Duration</span><span class="op" id="5944757">(</span><span class="string" id="5944758">&#34;test.benchtime&#34;</span><span class="op" id="5944774">,</span>&nbsp;<span class="num" id="5944776">1</span><span class="op" id="5944777">*</span><span class="ident" id="5944778">time</span><span class="op" id="5944782">.</span><span class="ident" id="5944783">Second</span><span class="op" id="5944789">,</span>&nbsp;<span class="string" id="5944791">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="5944832">)</span><br>
<span class="lineno"></span><span class="keyword" id="5944834">var</span>&nbsp;<span class="ident" id="5944838">benchmarkMemory</span>&nbsp;<span class="op" id="5944854">=</span>&nbsp;<span class="ident" id="5944856">flag</span><span class="op" id="5944860">.</span><span class="ident" id="5944861">Bool</span><span class="op" id="5944865">(</span><span class="string" id="5944866">&#34;test.benchmem&#34;</span><span class="op" id="5944881">,</span>&nbsp;<span class="builtintype" id="5944883">false</span><span class="op" id="5944888">,</span>&nbsp;<span class="string" id="5944890">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="5944931">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5944934">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="5944994">var</span>&nbsp;<span class="ident" id="5944998">benchmarkLock</span>&nbsp;<span class="ident" id="5945012">sync</span><span class="op" id="5945016">.</span><span class="ident" id="5945017">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5945024">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="5945074">var</span>&nbsp;<span class="ident" id="5945078">memStats</span>&nbsp;<span class="ident" id="5945087">runtime</span><span class="op" id="5945094">.</span><span class="ident" id="5945095">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5945105">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5945194">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5945223">type</span>&nbsp;<span class="ident" id="5945228">InternalBenchmark</span>&nbsp;<span class="keyword" id="5945246">struct</span>&nbsp;<span class="op" id="5945253">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945256">Name</span>&nbsp;<span class="builtintype" id="5945261">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945269">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945274">func</span><span class="op" id="5945278">(</span><span class="ident" id="5945279">b</span>&nbsp;<span class="op" id="5945281">*</span><span class="ident" id="5945282">B</span><span class="op" id="5945283">)</span><br>
<span class="lineno"></span><span class="op" id="5945285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5945288">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="5945353">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="5945411">type</span>&nbsp;<span class="ident" id="5945416">B</span>&nbsp;<span class="keyword" id="5945418">struct</span>&nbsp;<span class="op" id="5945425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945428">common</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945436">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5945453">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945458">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5945475">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5945489">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945534">previousDuration</span>&nbsp;<span class="ident" id="5945551">time</span><span class="op" id="5945555">.</span><span class="ident" id="5945556">Duration</span>&nbsp;<span class="comment" id="5945565">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945604">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945621">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945640">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945657">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945664">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5945681">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945687">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="5945704">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945710">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945727">BenchmarkResult</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945744">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5945761">int</span>&nbsp;<span class="comment" id="5945765">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945823">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945891">startAllocs</span>&nbsp;<span class="ident" id="5945903">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945911">startBytes</span>&nbsp;&nbsp;<span class="ident" id="5945923">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945931">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945979">netAllocs</span>&nbsp;<span class="ident" id="5945989">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945997">netBytes</span>&nbsp;&nbsp;<span class="ident" id="5946007">uint64</span><br>
<span class="lineno"></span><span class="op" id="5946014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5946017">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="5946092">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="5946166">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="5946190">func</span>&nbsp;<span class="op" id="5946195">(</span><span class="ident" id="5946196">b</span>&nbsp;<span class="op" id="5946198">*</span><span class="ident" id="5946199">B</span><span class="op" id="5946200">)</span>&nbsp;<span class="ident" id="5946202">StartTimer</span><span class="op" id="5946212">(</span><span class="op" id="5946213">)</span>&nbsp;<span class="op" id="5946215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946218">if</span>&nbsp;<span class="op" id="5946221">!</span><span class="ident" id="5946222">b</span><span class="op" id="5946223">.</span><span class="ident" id="5946224">timerOn</span>&nbsp;<span class="op" id="5946232">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946236">runtime</span><span class="op" id="5946243">.</span><span class="ident" id="5946244">ReadMemStats</span><span class="op" id="5946256">(</span><span class="op" id="5946257">&amp;</span><span class="ident" id="5946258">memStats</span><span class="op" id="5946266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946270">b</span><span class="op" id="5946271">.</span><span class="ident" id="5946272">startAllocs</span>&nbsp;<span class="op" id="5946284">=</span>&nbsp;<span class="ident" id="5946286">memStats</span><span class="op" id="5946294">.</span><span class="ident" id="5946295">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946305">b</span><span class="op" id="5946306">.</span><span class="ident" id="5946307">startBytes</span>&nbsp;<span class="op" id="5946318">=</span>&nbsp;<span class="ident" id="5946320">memStats</span><span class="op" id="5946328">.</span><span class="ident" id="5946329">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946342">b</span><span class="op" id="5946343">.</span><span class="ident" id="5946344">start</span>&nbsp;<span class="op" id="5946350">=</span>&nbsp;<span class="ident" id="5946352">time</span><span class="op" id="5946356">.</span><span class="ident" id="5946357">Now</span><span class="op" id="5946360">(</span><span class="op" id="5946361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946365">b</span><span class="op" id="5946366">.</span><span class="ident" id="5946367">timerOn</span>&nbsp;<span class="op" id="5946375">=</span>&nbsp;<span class="builtintype" id="5946377">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946383">}</span><br>
<span class="lineno"></span><span class="op" id="5946385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5946388">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="5946459">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="5946517">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="5946537">func</span>&nbsp;<span class="op" id="5946542">(</span><span class="ident" id="5946543">b</span>&nbsp;<span class="op" id="5946545">*</span><span class="ident" id="5946546">B</span><span class="op" id="5946547">)</span>&nbsp;<span class="ident" id="5946549">StopTimer</span><span class="op" id="5946558">(</span><span class="op" id="5946559">)</span>&nbsp;<span class="op" id="5946561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946564">if</span>&nbsp;<span class="ident" id="5946567">b</span><span class="op" id="5946568">.</span><span class="ident" id="5946569">timerOn</span>&nbsp;<span class="op" id="5946577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946581">b</span><span class="op" id="5946582">.</span><span class="ident" id="5946583">duration</span>&nbsp;<span class="op" id="5946592">+=</span>&nbsp;<span class="ident" id="5946595">time</span><span class="op" id="5946599">.</span><span class="ident" id="5946600">Now</span><span class="op" id="5946603">(</span><span class="op" id="5946604">)</span><span class="op" id="5946605">.</span><span class="ident" id="5946606">Sub</span><span class="op" id="5946609">(</span><span class="ident" id="5946610">b</span><span class="op" id="5946611">.</span><span class="ident" id="5946612">start</span><span class="op" id="5946617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946621">runtime</span><span class="op" id="5946628">.</span><span class="ident" id="5946629">ReadMemStats</span><span class="op" id="5946641">(</span><span class="op" id="5946642">&amp;</span><span class="ident" id="5946643">memStats</span><span class="op" id="5946651">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946655">b</span><span class="op" id="5946656">.</span><span class="ident" id="5946657">netAllocs</span>&nbsp;<span class="op" id="5946667">+=</span>&nbsp;<span class="ident" id="5946670">memStats</span><span class="op" id="5946678">.</span><span class="ident" id="5946679">Mallocs</span>&nbsp;<span class="op" id="5946687">-</span>&nbsp;<span class="ident" id="5946689">b</span><span class="op" id="5946690">.</span><span class="ident" id="5946691">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946705">b</span><span class="op" id="5946706">.</span><span class="ident" id="5946707">netBytes</span>&nbsp;<span class="op" id="5946716">+=</span>&nbsp;<span class="ident" id="5946719">memStats</span><span class="op" id="5946727">.</span><span class="ident" id="5946728">TotalAlloc</span>&nbsp;<span class="op" id="5946739">-</span>&nbsp;<span class="ident" id="5946741">b</span><span class="op" id="5946742">.</span><span class="ident" id="5946743">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946756">b</span><span class="op" id="5946757">.</span><span class="ident" id="5946758">timerOn</span>&nbsp;<span class="op" id="5946766">=</span>&nbsp;<span class="builtintype" id="5946768">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946775">}</span><br>
<span class="lineno"></span><span class="op" id="5946777">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="5946780">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="5946859">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="5946911">func</span>&nbsp;<span class="op" id="5946916">(</span><span class="ident" id="5946917">b</span>&nbsp;<span class="op" id="5946919">*</span><span class="ident" id="5946920">B</span><span class="op" id="5946921">)</span>&nbsp;<span class="ident" id="5946923">ResetTimer</span><span class="op" id="5946933">(</span><span class="op" id="5946934">)</span>&nbsp;<span class="op" id="5946936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946939">if</span>&nbsp;<span class="ident" id="5946942">b</span><span class="op" id="5946943">.</span><span class="ident" id="5946944">timerOn</span>&nbsp;<span class="op" id="5946952">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946956">runtime</span><span class="op" id="5946963">.</span><span class="ident" id="5946964">ReadMemStats</span><span class="op" id="5946976">(</span><span class="op" id="5946977">&amp;</span><span class="ident" id="5946978">memStats</span><span class="op" id="5946986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946990">b</span><span class="op" id="5946991">.</span><span class="ident" id="5946992">startAllocs</span>&nbsp;<span class="op" id="5947004">=</span>&nbsp;<span class="ident" id="5947006">memStats</span><span class="op" id="5947014">.</span><span class="ident" id="5947015">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947025">b</span><span class="op" id="5947026">.</span><span class="ident" id="5947027">startBytes</span>&nbsp;<span class="op" id="5947038">=</span>&nbsp;<span class="ident" id="5947040">memStats</span><span class="op" id="5947048">.</span><span class="ident" id="5947049">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947062">b</span><span class="op" id="5947063">.</span><span class="ident" id="5947064">start</span>&nbsp;<span class="op" id="5947070">=</span>&nbsp;<span class="ident" id="5947072">time</span><span class="op" id="5947076">.</span><span class="ident" id="5947077">Now</span><span class="op" id="5947080">(</span><span class="op" id="5947081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947084">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947087">b</span><span class="op" id="5947088">.</span><span class="ident" id="5947089">duration</span>&nbsp;<span class="op" id="5947098">=</span>&nbsp;<span class="num" id="5947100">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947103">b</span><span class="op" id="5947104">.</span><span class="ident" id="5947105">netAllocs</span>&nbsp;<span class="op" id="5947115">=</span>&nbsp;<span class="num" id="5947117">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947120">b</span><span class="op" id="5947121">.</span><span class="ident" id="5947122">netBytes</span>&nbsp;<span class="op" id="5947131">=</span>&nbsp;<span class="num" id="5947133">0</span><br>
<span class="lineno"></span><span class="op" id="5947135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5947138">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="5947211">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="5947275">func</span>&nbsp;<span class="op" id="5947280">(</span><span class="ident" id="5947281">b</span>&nbsp;<span class="op" id="5947283">*</span><span class="ident" id="5947284">B</span><span class="op" id="5947285">)</span>&nbsp;<span class="ident" id="5947287">SetBytes</span><span class="op" id="5947295">(</span><span class="ident" id="5947296">n</span>&nbsp;<span class="ident" id="5947298">int64</span><span class="op" id="5947303">)</span>&nbsp;<span class="op" id="5947305">{</span>&nbsp;<span class="ident" id="5947307">b</span><span class="op" id="5947308">.</span><span class="ident" id="5947309">bytes</span>&nbsp;<span class="op" id="5947315">=</span>&nbsp;<span class="ident" id="5947317">n</span>&nbsp;<span class="op" id="5947319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5947322">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="5947384">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5947455">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="5947502">func</span>&nbsp;<span class="op" id="5947507">(</span><span class="ident" id="5947508">b</span>&nbsp;<span class="op" id="5947510">*</span><span class="ident" id="5947511">B</span><span class="op" id="5947512">)</span>&nbsp;<span class="ident" id="5947514">ReportAllocs</span><span class="op" id="5947526">(</span><span class="op" id="5947527">)</span>&nbsp;<span class="op" id="5947529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947532">b</span><span class="op" id="5947533">.</span><span class="ident" id="5947534">showAllocResult</span>&nbsp;<span class="op" id="5947550">=</span>&nbsp;<span class="builtintype" id="5947552">true</span><br>
<span class="lineno"></span><span class="op" id="5947557">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5947560">func</span>&nbsp;<span class="op" id="5947565">(</span><span class="ident" id="5947566">b</span>&nbsp;<span class="op" id="5947568">*</span><span class="ident" id="5947569">B</span><span class="op" id="5947570">)</span>&nbsp;<span class="ident" id="5947572">nsPerOp</span><span class="op" id="5947579">(</span><span class="op" id="5947580">)</span>&nbsp;<span class="ident" id="5947582">int64</span>&nbsp;<span class="op" id="5947588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947591">if</span>&nbsp;<span class="ident" id="5947594">b</span><span class="op" id="5947595">.</span><span class="ident" id="5947596">N</span>&nbsp;<span class="op" id="5947598">&lt;=</span>&nbsp;<span class="num" id="5947601">0</span>&nbsp;<span class="op" id="5947603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947607">return</span>&nbsp;<span class="num" id="5947614">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947617">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947620">return</span>&nbsp;<span class="ident" id="5947627">b</span><span class="op" id="5947628">.</span><span class="ident" id="5947629">duration</span><span class="op" id="5947637">.</span><span class="ident" id="5947638">Nanoseconds</span><span class="op" id="5947649">(</span><span class="op" id="5947650">)</span>&nbsp;<span class="op" id="5947652">/</span>&nbsp;<span class="ident" id="5947654">int64</span><span class="op" id="5947659">(</span><span class="ident" id="5947660">b</span><span class="op" id="5947661">.</span><span class="ident" id="5947662">N</span><span class="op" id="5947663">)</span><br>
<span class="lineno"></span><span class="op" id="5947665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5947668">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="5947740">func</span>&nbsp;<span class="op" id="5947745">(</span><span class="ident" id="5947746">b</span>&nbsp;<span class="op" id="5947748">*</span><span class="ident" id="5947749">B</span><span class="op" id="5947750">)</span>&nbsp;<span class="ident" id="5947752">runN</span><span class="op" id="5947756">(</span><span class="ident" id="5947757">n</span>&nbsp;<span class="builtintype" id="5947759">int</span><span class="op" id="5947762">)</span>&nbsp;<span class="op" id="5947764">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947767">benchmarkLock</span><span class="op" id="5947780">.</span><span class="ident" id="5947781">Lock</span><span class="op" id="5947785">(</span><span class="op" id="5947786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947789">defer</span>&nbsp;<span class="ident" id="5947795">benchmarkLock</span><span class="op" id="5947808">.</span><span class="ident" id="5947809">Unlock</span><span class="op" id="5947815">(</span><span class="op" id="5947816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947819">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947872">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947916">runtime</span><span class="op" id="5947923">.</span><span class="ident" id="5947924">GC</span><span class="op" id="5947926">(</span><span class="op" id="5947927">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947930">b</span><span class="op" id="5947931">.</span><span class="ident" id="5947932">N</span>&nbsp;<span class="op" id="5947934">=</span>&nbsp;<span class="ident" id="5947936">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947939">b</span><span class="op" id="5947940">.</span><span class="ident" id="5947941">parallelism</span>&nbsp;<span class="op" id="5947953">=</span>&nbsp;<span class="num" id="5947955">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947958">b</span><span class="op" id="5947959">.</span><span class="ident" id="5947960">ResetTimer</span><span class="op" id="5947970">(</span><span class="op" id="5947971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947974">b</span><span class="op" id="5947975">.</span><span class="ident" id="5947976">StartTimer</span><span class="op" id="5947986">(</span><span class="op" id="5947987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947990">b</span><span class="op" id="5947991">.</span><span class="ident" id="5947992">benchmark</span><span class="op" id="5948001">.</span><span class="ident" id="5948002">F</span><span class="op" id="5948003">(</span><span class="ident" id="5948004">b</span><span class="op" id="5948005">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948008">b</span><span class="op" id="5948009">.</span><span class="ident" id="5948010">StopTimer</span><span class="op" id="5948019">(</span><span class="op" id="5948020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948023">b</span><span class="op" id="5948024">.</span><span class="ident" id="5948025">previousN</span>&nbsp;<span class="op" id="5948035">=</span>&nbsp;<span class="ident" id="5948037">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948040">b</span><span class="op" id="5948041">.</span><span class="ident" id="5948042">previousDuration</span>&nbsp;<span class="op" id="5948059">=</span>&nbsp;<span class="ident" id="5948061">b</span><span class="op" id="5948062">.</span><span class="ident" id="5948063">duration</span><br>
<span class="lineno"></span><span class="op" id="5948072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5948075">func</span>&nbsp;<span class="ident" id="5948080">min</span><span class="op" id="5948083">(</span><span class="ident" id="5948084">x</span><span class="op" id="5948085">,</span>&nbsp;<span class="ident" id="5948087">y</span>&nbsp;<span class="builtintype" id="5948089">int</span><span class="op" id="5948092">)</span>&nbsp;<span class="builtintype" id="5948094">int</span>&nbsp;<span class="op" id="5948098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948101">if</span>&nbsp;<span class="ident" id="5948104">x</span>&nbsp;<span class="op" id="5948106">&gt;</span>&nbsp;<span class="ident" id="5948108">y</span>&nbsp;<span class="op" id="5948110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948114">return</span>&nbsp;<span class="ident" id="5948121">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948127">return</span>&nbsp;<span class="ident" id="5948134">x</span><br>
<span class="lineno">135</span><span class="op" id="5948136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5948139">func</span>&nbsp;<span class="ident" id="5948144">max</span><span class="op" id="5948147">(</span><span class="ident" id="5948148">x</span><span class="op" id="5948149">,</span>&nbsp;<span class="ident" id="5948151">y</span>&nbsp;<span class="builtintype" id="5948153">int</span><span class="op" id="5948156">)</span>&nbsp;<span class="builtintype" id="5948158">int</span>&nbsp;<span class="op" id="5948162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948165">if</span>&nbsp;<span class="ident" id="5948168">x</span>&nbsp;<span class="op" id="5948170">&lt;</span>&nbsp;<span class="ident" id="5948172">y</span>&nbsp;<span class="op" id="5948174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948178">return</span>&nbsp;<span class="ident" id="5948185">y</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948191">return</span>&nbsp;<span class="ident" id="5948198">x</span><br>
<span class="lineno"></span><span class="op" id="5948200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5948203">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="5948267">func</span>&nbsp;<span class="ident" id="5948272">roundDown10</span><span class="op" id="5948283">(</span><span class="ident" id="5948284">n</span>&nbsp;<span class="builtintype" id="5948286">int</span><span class="op" id="5948289">)</span>&nbsp;<span class="builtintype" id="5948291">int</span>&nbsp;<span class="op" id="5948295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948298">var</span>&nbsp;<span class="ident" id="5948302">tens</span>&nbsp;<span class="op" id="5948307">=</span>&nbsp;<span class="num" id="5948309">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948312">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948340">for</span>&nbsp;<span class="ident" id="5948344">n</span>&nbsp;<span class="op" id="5948346">&gt;=</span>&nbsp;<span class="num" id="5948349">10</span>&nbsp;<span class="op" id="5948352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948356">n</span>&nbsp;<span class="op" id="5948358">=</span>&nbsp;<span class="ident" id="5948360">n</span>&nbsp;<span class="op" id="5948362">/</span>&nbsp;<span class="num" id="5948364">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948369">tens</span><span class="op" id="5948373">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948380">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948401">result</span>&nbsp;<span class="op" id="5948408">:=</span>&nbsp;<span class="num" id="5948411">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948414">for</span>&nbsp;<span class="ident" id="5948418">i</span>&nbsp;<span class="op" id="5948420">:=</span>&nbsp;<span class="num" id="5948423">0</span><span class="op" id="5948424">;</span>&nbsp;<span class="ident" id="5948426">i</span>&nbsp;<span class="op" id="5948428">&lt;</span>&nbsp;<span class="ident" id="5948430">tens</span><span class="op" id="5948434">;</span>&nbsp;<span class="ident" id="5948436">i</span><span class="op" id="5948437">++</span>&nbsp;<span class="op" id="5948440">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948444">result</span>&nbsp;<span class="op" id="5948451">*=</span>&nbsp;<span class="num" id="5948454">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948461">return</span>&nbsp;<span class="ident" id="5948468">result</span><br>
<span class="lineno"></span><span class="op" id="5948475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5948478">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="5948547">func</span>&nbsp;<span class="ident" id="5948552">roundUp</span><span class="op" id="5948559">(</span><span class="ident" id="5948560">n</span>&nbsp;<span class="builtintype" id="5948562">int</span><span class="op" id="5948565">)</span>&nbsp;<span class="builtintype" id="5948567">int</span>&nbsp;<span class="op" id="5948571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948574">base</span>&nbsp;<span class="op" id="5948579">:=</span>&nbsp;<span class="ident" id="5948582">roundDown10</span><span class="op" id="5948593">(</span><span class="ident" id="5948594">n</span><span class="op" id="5948595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948598">switch</span>&nbsp;<span class="op" id="5948605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948608">case</span>&nbsp;<span class="ident" id="5948613">n</span>&nbsp;<span class="op" id="5948615">&lt;=</span>&nbsp;<span class="ident" id="5948618">base</span><span class="op" id="5948622">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948626">return</span>&nbsp;<span class="ident" id="5948633">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948639">case</span>&nbsp;<span class="ident" id="5948644">n</span>&nbsp;<span class="op" id="5948646">&lt;=</span>&nbsp;<span class="op" id="5948649">(</span><span class="num" id="5948650">2</span>&nbsp;<span class="op" id="5948652">*</span>&nbsp;<span class="ident" id="5948654">base</span><span class="op" id="5948658">)</span><span class="op" id="5948659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948663">return</span>&nbsp;<span class="num" id="5948670">2</span>&nbsp;<span class="op" id="5948672">*</span>&nbsp;<span class="ident" id="5948674">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948680">case</span>&nbsp;<span class="ident" id="5948685">n</span>&nbsp;<span class="op" id="5948687">&lt;=</span>&nbsp;<span class="op" id="5948690">(</span><span class="num" id="5948691">3</span>&nbsp;<span class="op" id="5948693">*</span>&nbsp;<span class="ident" id="5948695">base</span><span class="op" id="5948699">)</span><span class="op" id="5948700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948704">return</span>&nbsp;<span class="num" id="5948711">3</span>&nbsp;<span class="op" id="5948713">*</span>&nbsp;<span class="ident" id="5948715">base</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948721">case</span>&nbsp;<span class="ident" id="5948726">n</span>&nbsp;<span class="op" id="5948728">&lt;=</span>&nbsp;<span class="op" id="5948731">(</span><span class="num" id="5948732">5</span>&nbsp;<span class="op" id="5948734">*</span>&nbsp;<span class="ident" id="5948736">base</span><span class="op" id="5948740">)</span><span class="op" id="5948741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948745">return</span>&nbsp;<span class="num" id="5948752">5</span>&nbsp;<span class="op" id="5948754">*</span>&nbsp;<span class="ident" id="5948756">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948762">default</span><span class="op" id="5948769">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948773">return</span>&nbsp;<span class="num" id="5948780">10</span>&nbsp;<span class="op" id="5948783">*</span>&nbsp;<span class="ident" id="5948785">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948791">}</span><br>
<span class="lineno">175</span><span class="op" id="5948793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5948796">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="5948857">func</span>&nbsp;<span class="op" id="5948862">(</span><span class="ident" id="5948863">b</span>&nbsp;<span class="op" id="5948865">*</span><span class="ident" id="5948866">B</span><span class="op" id="5948867">)</span>&nbsp;<span class="ident" id="5948869">run</span><span class="op" id="5948872">(</span><span class="op" id="5948873">)</span>&nbsp;<span class="ident" id="5948875">BenchmarkResult</span>&nbsp;<span class="op" id="5948891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948894">go</span>&nbsp;<span class="ident" id="5948897">b</span><span class="op" id="5948898">.</span><span class="ident" id="5948899">launch</span><span class="op" id="5948905">(</span><span class="op" id="5948906">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948909">&lt;-</span><span class="ident" id="5948911">b</span><span class="op" id="5948912">.</span><span class="ident" id="5948913">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948921">return</span>&nbsp;<span class="ident" id="5948928">b</span><span class="op" id="5948929">.</span><span class="ident" id="5948930">result</span><br>
<span class="lineno"></span><span class="op" id="5948937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5948940">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="5949018">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="5949099">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5949144">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptesting.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp100000&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="5949188">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="5949250">func</span>&nbsp;<span class="op" id="5949255">(</span><span class="ident" id="5949256">b</span>&nbsp;<span class="op" id="5949258">*</span><span class="ident" id="5949259">B</span><span class="op" id="5949260">)</span>&nbsp;<span class="ident" id="5949262">launch</span><span class="op" id="5949268">(</span><span class="op" id="5949269">)</span>&nbsp;<span class="op" id="5949271">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949274">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949343">n</span>&nbsp;<span class="op" id="5949345">:=</span>&nbsp;<span class="num" id="5949348">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949352">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949406">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949442">defer</span>&nbsp;<span class="keyword" id="5949448">func</span><span class="op" id="5949452">(</span><span class="op" id="5949453">)</span>&nbsp;<span class="op" id="5949455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949459">b</span><span class="op" id="5949460">.</span><span class="ident" id="5949461">signal</span>&nbsp;<span class="op" id="5949468">&lt;-</span>&nbsp;<span class="ident" id="5949471">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5949474">}</span><span class="op" id="5949475">(</span><span class="op" id="5949476">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949480">b</span><span class="op" id="5949481">.</span><span class="ident" id="5949482">runN</span><span class="op" id="5949486">(</span><span class="ident" id="5949487">n</span><span class="op" id="5949488">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949491">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949556">d</span>&nbsp;<span class="op" id="5949558">:=</span>&nbsp;<span class="op" id="5949561">*</span><span class="ident" id="5949562">benchTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949573">for</span>&nbsp;<span class="op" id="5949577">!</span><span class="ident" id="5949578">b</span><span class="op" id="5949579">.</span><span class="ident" id="5949580">failed</span>&nbsp;<span class="op" id="5949587">&amp;&amp;</span>&nbsp;<span class="ident" id="5949590">b</span><span class="op" id="5949591">.</span><span class="ident" id="5949592">duration</span>&nbsp;<span class="op" id="5949601">&lt;</span>&nbsp;<span class="ident" id="5949603">d</span>&nbsp;<span class="op" id="5949605">&amp;&amp;</span>&nbsp;<span class="ident" id="5949608">n</span>&nbsp;<span class="op" id="5949610">&lt;</span>&nbsp;<span class="num" id="5949612">1e9</span>&nbsp;<span class="op" id="5949616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949620">last</span>&nbsp;<span class="op" id="5949625">:=</span>&nbsp;<span class="ident" id="5949628">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949632">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949666">if</span>&nbsp;<span class="ident" id="5949669">b</span><span class="op" id="5949670">.</span><span class="ident" id="5949671">nsPerOp</span><span class="op" id="5949678">(</span><span class="op" id="5949679">)</span>&nbsp;<span class="op" id="5949681">==</span>&nbsp;<span class="num" id="5949684">0</span>&nbsp;<span class="op" id="5949686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949691">n</span>&nbsp;<span class="op" id="5949693">=</span>&nbsp;<span class="num" id="5949695">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5949701">}</span>&nbsp;<span class="keyword" id="5949703">else</span>&nbsp;<span class="op" id="5949708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949713">n</span>&nbsp;<span class="op" id="5949715">=</span>&nbsp;<span class="builtintype" id="5949717">int</span><span class="op" id="5949720">(</span><span class="ident" id="5949721">d</span><span class="op" id="5949722">.</span><span class="ident" id="5949723">Nanoseconds</span><span class="op" id="5949734">(</span><span class="op" id="5949735">)</span>&nbsp;<span class="op" id="5949737">/</span>&nbsp;<span class="ident" id="5949739">b</span><span class="op" id="5949740">.</span><span class="ident" id="5949741">nsPerOp</span><span class="op" id="5949748">(</span><span class="op" id="5949749">)</span><span class="op" id="5949750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5949754">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949758">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949816">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949882">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5949936">n</span>&nbsp;<span class="op" id="5949938">=</span>&nbsp;<span class="ident" id="5949940">max</span><span class="op" id="5949943">(</span><span class="ident" id="5949944">min</span><span class="op" id="5949947">(</span><span class="ident" id="5949948">n</span><span class="op" id="5949949">+</span><span class="ident" id="5949950">n</span><span class="op" id="5949951">/</span><span class="num" id="5949952">5</span><span class="op" id="5949953">,</span>&nbsp;<span class="num" id="5949955">100</span><span class="op" id="5949958">*</span><span class="ident" id="5949959">last</span><span class="op" id="5949963">)</span><span class="op" id="5949964">,</span>&nbsp;<span class="ident" id="5949966">last</span><span class="op" id="5949970">+</span><span class="num" id="5949971">1</span><span class="op" id="5949972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5949976">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950017">n</span>&nbsp;<span class="op" id="5950019">=</span>&nbsp;<span class="ident" id="5950021">roundUp</span><span class="op" id="5950028">(</span><span class="ident" id="5950029">n</span><span class="op" id="5950030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950034">b</span><span class="op" id="5950035">.</span><span class="ident" id="5950036">runN</span><span class="op" id="5950040">(</span><span class="ident" id="5950041">n</span><span class="op" id="5950042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950048">b</span><span class="op" id="5950049">.</span><span class="ident" id="5950050">result</span>&nbsp;<span class="op" id="5950057">=</span>&nbsp;<span class="ident" id="5950059">BenchmarkResult</span><span class="op" id="5950074">{</span><span class="ident" id="5950075">b</span><span class="op" id="5950076">.</span><span class="ident" id="5950077">N</span><span class="op" id="5950078">,</span>&nbsp;<span class="ident" id="5950080">b</span><span class="op" id="5950081">.</span><span class="ident" id="5950082">duration</span><span class="op" id="5950090">,</span>&nbsp;<span class="ident" id="5950092">b</span><span class="op" id="5950093">.</span><span class="ident" id="5950094">bytes</span><span class="op" id="5950099">,</span>&nbsp;<span class="ident" id="5950101">b</span><span class="op" id="5950102">.</span><span class="ident" id="5950103">netAllocs</span><span class="op" id="5950112">,</span>&nbsp;<span class="ident" id="5950114">b</span><span class="op" id="5950115">.</span><span class="ident" id="5950116">netBytes</span><span class="op" id="5950124">}</span><br>
<span class="lineno"></span><span class="op" id="5950126">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5950129">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="5950164">type</span>&nbsp;<span class="ident" id="5950169">BenchmarkResult</span>&nbsp;<span class="keyword" id="5950185">struct</span>&nbsp;<span class="op" id="5950192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950195">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5950205">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5950219">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950249">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950259">time</span><span class="op" id="5950263">.</span><span class="ident" id="5950264">Duration</span>&nbsp;<span class="comment" id="5950273">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950299">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950309">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5950323">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950361">MemAllocs</span>&nbsp;<span class="ident" id="5950371">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5950385">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5950429">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="5950439">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5950453">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="5950493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5950496">func</span>&nbsp;<span class="op" id="5950501">(</span><span class="ident" id="5950502">r</span>&nbsp;<span class="ident" id="5950504">BenchmarkResult</span><span class="op" id="5950519">)</span>&nbsp;<span class="ident" id="5950521">NsPerOp</span><span class="op" id="5950528">(</span><span class="op" id="5950529">)</span>&nbsp;<span class="ident" id="5950531">int64</span>&nbsp;<span class="op" id="5950537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950540">if</span>&nbsp;<span class="ident" id="5950543">r</span><span class="op" id="5950544">.</span><span class="ident" id="5950545">N</span>&nbsp;<span class="op" id="5950547">&lt;=</span>&nbsp;<span class="num" id="5950550">0</span>&nbsp;<span class="op" id="5950552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950556">return</span>&nbsp;<span class="num" id="5950563">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950569">return</span>&nbsp;<span class="ident" id="5950576">r</span><span class="op" id="5950577">.</span><span class="ident" id="5950578">T</span><span class="op" id="5950579">.</span><span class="ident" id="5950580">Nanoseconds</span><span class="op" id="5950591">(</span><span class="op" id="5950592">)</span>&nbsp;<span class="op" id="5950594">/</span>&nbsp;<span class="ident" id="5950596">int64</span><span class="op" id="5950601">(</span><span class="ident" id="5950602">r</span><span class="op" id="5950603">.</span><span class="ident" id="5950604">N</span><span class="op" id="5950605">)</span><br>
<span class="lineno">235</span><span class="op" id="5950607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5950610">func</span>&nbsp;<span class="op" id="5950615">(</span><span class="ident" id="5950616">r</span>&nbsp;<span class="ident" id="5950618">BenchmarkResult</span><span class="op" id="5950633">)</span>&nbsp;<span class="ident" id="5950635">mbPerSec</span><span class="op" id="5950643">(</span><span class="op" id="5950644">)</span>&nbsp;<span class="builtintype" id="5950646">float64</span>&nbsp;<span class="op" id="5950654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950657">if</span>&nbsp;<span class="ident" id="5950660">r</span><span class="op" id="5950661">.</span><span class="ident" id="5950662">Bytes</span>&nbsp;<span class="op" id="5950668">&lt;=</span>&nbsp;<span class="num" id="5950671">0</span>&nbsp;<span class="op" id="5950673">||</span>&nbsp;<span class="ident" id="5950676">r</span><span class="op" id="5950677">.</span><span class="ident" id="5950678">T</span>&nbsp;<span class="op" id="5950680">&lt;=</span>&nbsp;<span class="num" id="5950683">0</span>&nbsp;<span class="op" id="5950685">||</span>&nbsp;<span class="ident" id="5950688">r</span><span class="op" id="5950689">.</span><span class="ident" id="5950690">N</span>&nbsp;<span class="op" id="5950692">&lt;=</span>&nbsp;<span class="num" id="5950695">0</span>&nbsp;<span class="op" id="5950697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950701">return</span>&nbsp;<span class="num" id="5950708">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950714">return</span>&nbsp;<span class="op" id="5950721">(</span><span class="builtintype" id="5950722">float64</span><span class="op" id="5950729">(</span><span class="ident" id="5950730">r</span><span class="op" id="5950731">.</span><span class="ident" id="5950732">Bytes</span><span class="op" id="5950737">)</span>&nbsp;<span class="op" id="5950739">*</span>&nbsp;<span class="builtintype" id="5950741">float64</span><span class="op" id="5950748">(</span><span class="ident" id="5950749">r</span><span class="op" id="5950750">.</span><span class="ident" id="5950751">N</span><span class="op" id="5950752">)</span>&nbsp;<span class="op" id="5950754">/</span>&nbsp;<span class="num" id="5950756">1e6</span><span class="op" id="5950759">)</span>&nbsp;<span class="op" id="5950761">/</span>&nbsp;<span class="ident" id="5950763">r</span><span class="op" id="5950764">.</span><span class="ident" id="5950765">T</span><span class="op" id="5950766">.</span><span class="ident" id="5950767">Seconds</span><span class="op" id="5950774">(</span><span class="op" id="5950775">)</span><br>
<span class="lineno"></span><span class="op" id="5950777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5950780">func</span>&nbsp;<span class="op" id="5950785">(</span><span class="ident" id="5950786">r</span>&nbsp;<span class="ident" id="5950788">BenchmarkResult</span><span class="op" id="5950803">)</span>&nbsp;<span class="ident" id="5950805">AllocsPerOp</span><span class="op" id="5950816">(</span><span class="op" id="5950817">)</span>&nbsp;<span class="ident" id="5950819">int64</span>&nbsp;<span class="op" id="5950825">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950828">if</span>&nbsp;<span class="ident" id="5950831">r</span><span class="op" id="5950832">.</span><span class="ident" id="5950833">N</span>&nbsp;<span class="op" id="5950835">&lt;=</span>&nbsp;<span class="num" id="5950838">0</span>&nbsp;<span class="op" id="5950840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950844">return</span>&nbsp;<span class="num" id="5950851">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950857">return</span>&nbsp;<span class="ident" id="5950864">int64</span><span class="op" id="5950869">(</span><span class="ident" id="5950870">r</span><span class="op" id="5950871">.</span><span class="ident" id="5950872">MemAllocs</span><span class="op" id="5950881">)</span>&nbsp;<span class="op" id="5950883">/</span>&nbsp;<span class="ident" id="5950885">int64</span><span class="op" id="5950890">(</span><span class="ident" id="5950891">r</span><span class="op" id="5950892">.</span><span class="ident" id="5950893">N</span><span class="op" id="5950894">)</span><br>
<span class="lineno"></span><span class="op" id="5950896">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="5950899">func</span>&nbsp;<span class="op" id="5950904">(</span><span class="ident" id="5950905">r</span>&nbsp;<span class="ident" id="5950907">BenchmarkResult</span><span class="op" id="5950922">)</span>&nbsp;<span class="ident" id="5950924">AllocedBytesPerOp</span><span class="op" id="5950941">(</span><span class="op" id="5950942">)</span>&nbsp;<span class="ident" id="5950944">int64</span>&nbsp;<span class="op" id="5950950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950953">if</span>&nbsp;<span class="ident" id="5950956">r</span><span class="op" id="5950957">.</span><span class="ident" id="5950958">N</span>&nbsp;<span class="op" id="5950960">&lt;=</span>&nbsp;<span class="num" id="5950963">0</span>&nbsp;<span class="op" id="5950965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950969">return</span>&nbsp;<span class="num" id="5950976">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5950979">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5950982">return</span>&nbsp;<span class="ident" id="5950989">int64</span><span class="op" id="5950994">(</span><span class="ident" id="5950995">r</span><span class="op" id="5950996">.</span><span class="ident" id="5950997">MemBytes</span><span class="op" id="5951005">)</span>&nbsp;<span class="op" id="5951007">/</span>&nbsp;<span class="ident" id="5951009">int64</span><span class="op" id="5951014">(</span><span class="ident" id="5951015">r</span><span class="op" id="5951016">.</span><span class="ident" id="5951017">N</span><span class="op" id="5951018">)</span><br>
<span class="lineno"></span><span class="op" id="5951020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5951023">func</span>&nbsp;<span class="op" id="5951028">(</span><span class="ident" id="5951029">r</span>&nbsp;<span class="ident" id="5951031">BenchmarkResult</span><span class="op" id="5951046">)</span>&nbsp;<span class="ident" id="5951048">String</span><span class="op" id="5951054">(</span><span class="op" id="5951055">)</span>&nbsp;<span class="builtintype" id="5951057">string</span>&nbsp;<span class="op" id="5951064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951067">mbs</span>&nbsp;<span class="op" id="5951071">:=</span>&nbsp;<span class="ident" id="5951074">r</span><span class="op" id="5951075">.</span><span class="ident" id="5951076">mbPerSec</span><span class="op" id="5951084">(</span><span class="op" id="5951085">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951088">mb</span>&nbsp;<span class="op" id="5951091">:=</span>&nbsp;<span class="string" id="5951094">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951098">if</span>&nbsp;<span class="ident" id="5951101">mbs</span>&nbsp;<span class="op" id="5951105">!=</span>&nbsp;<span class="num" id="5951108">0</span>&nbsp;<span class="op" id="5951110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951114">mb</span>&nbsp;<span class="op" id="5951117">=</span>&nbsp;<span class="ident" id="5951119">fmt</span><span class="op" id="5951122">.</span><span class="ident" id="5951123">Sprintf</span><span class="op" id="5951130">(</span><span class="string" id="5951131">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="5951145">,</span>&nbsp;<span class="ident" id="5951147">mbs</span><span class="op" id="5951150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951156">nsop</span>&nbsp;<span class="op" id="5951161">:=</span>&nbsp;<span class="ident" id="5951164">r</span><span class="op" id="5951165">.</span><span class="ident" id="5951166">NsPerOp</span><span class="op" id="5951173">(</span><span class="op" id="5951174">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951177">ns</span>&nbsp;<span class="op" id="5951180">:=</span>&nbsp;<span class="ident" id="5951183">fmt</span><span class="op" id="5951186">.</span><span class="ident" id="5951187">Sprintf</span><span class="op" id="5951194">(</span><span class="string" id="5951195">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="5951207">,</span>&nbsp;<span class="ident" id="5951209">nsop</span><span class="op" id="5951213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951216">if</span>&nbsp;<span class="ident" id="5951219">r</span><span class="op" id="5951220">.</span><span class="ident" id="5951221">N</span>&nbsp;<span class="op" id="5951223">&gt;</span>&nbsp;<span class="num" id="5951225">0</span>&nbsp;<span class="op" id="5951227">&amp;&amp;</span>&nbsp;<span class="ident" id="5951230">nsop</span>&nbsp;<span class="op" id="5951235">&lt;</span>&nbsp;<span class="num" id="5951237">100</span>&nbsp;<span class="op" id="5951241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951245">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951292">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951353">if</span>&nbsp;<span class="ident" id="5951356">nsop</span>&nbsp;<span class="op" id="5951361">&lt;</span>&nbsp;<span class="num" id="5951363">10</span>&nbsp;<span class="op" id="5951366">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951371">ns</span>&nbsp;<span class="op" id="5951374">=</span>&nbsp;<span class="ident" id="5951376">fmt</span><span class="op" id="5951379">.</span><span class="ident" id="5951380">Sprintf</span><span class="op" id="5951387">(</span><span class="string" id="5951388">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="5951402">,</span>&nbsp;<span class="builtintype" id="5951404">float64</span><span class="op" id="5951411">(</span><span class="ident" id="5951412">r</span><span class="op" id="5951413">.</span><span class="ident" id="5951414">T</span><span class="op" id="5951415">.</span><span class="ident" id="5951416">Nanoseconds</span><span class="op" id="5951427">(</span><span class="op" id="5951428">)</span><span class="op" id="5951429">)</span><span class="op" id="5951430">/</span><span class="builtintype" id="5951431">float64</span><span class="op" id="5951438">(</span><span class="ident" id="5951439">r</span><span class="op" id="5951440">.</span><span class="ident" id="5951441">N</span><span class="op" id="5951442">)</span><span class="op" id="5951443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951447">}</span>&nbsp;<span class="keyword" id="5951449">else</span>&nbsp;<span class="op" id="5951454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951459">ns</span>&nbsp;<span class="op" id="5951462">=</span>&nbsp;<span class="ident" id="5951464">fmt</span><span class="op" id="5951467">.</span><span class="ident" id="5951468">Sprintf</span><span class="op" id="5951475">(</span><span class="string" id="5951476">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="5951490">,</span>&nbsp;<span class="builtintype" id="5951492">float64</span><span class="op" id="5951499">(</span><span class="ident" id="5951500">r</span><span class="op" id="5951501">.</span><span class="ident" id="5951502">T</span><span class="op" id="5951503">.</span><span class="ident" id="5951504">Nanoseconds</span><span class="op" id="5951515">(</span><span class="op" id="5951516">)</span><span class="op" id="5951517">)</span><span class="op" id="5951518">/</span><span class="builtintype" id="5951519">float64</span><span class="op" id="5951526">(</span><span class="ident" id="5951527">r</span><span class="op" id="5951528">.</span><span class="ident" id="5951529">N</span><span class="op" id="5951530">)</span><span class="op" id="5951531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5951538">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951541">return</span>&nbsp;<span class="ident" id="5951548">fmt</span><span class="op" id="5951551">.</span><span class="ident" id="5951552">Sprintf</span><span class="op" id="5951559">(</span><span class="string" id="5951560">&#34;%8d\t%s%s&#34;</span><span class="op" id="5951571">,</span>&nbsp;<span class="ident" id="5951573">r</span><span class="op" id="5951574">.</span><span class="ident" id="5951575">N</span><span class="op" id="5951576">,</span>&nbsp;<span class="ident" id="5951578">ns</span><span class="op" id="5951580">,</span>&nbsp;<span class="ident" id="5951582">mb</span><span class="op" id="5951584">)</span><br>
<span class="lineno"></span><span class="op" id="5951586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5951589">func</span>&nbsp;<span class="op" id="5951594">(</span><span class="ident" id="5951595">r</span>&nbsp;<span class="ident" id="5951597">BenchmarkResult</span><span class="op" id="5951612">)</span>&nbsp;<span class="ident" id="5951614">MemString</span><span class="op" id="5951623">(</span><span class="op" id="5951624">)</span>&nbsp;<span class="builtintype" id="5951626">string</span>&nbsp;<span class="op" id="5951633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5951636">return</span>&nbsp;<span class="ident" id="5951643">fmt</span><span class="op" id="5951646">.</span><span class="ident" id="5951647">Sprintf</span><span class="op" id="5951654">(</span><span class="string" id="5951655">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="5951680">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5951684">r</span><span class="op" id="5951685">.</span><span class="ident" id="5951686">AllocedBytesPerOp</span><span class="op" id="5951703">(</span><span class="op" id="5951704">)</span><span class="op" id="5951705">,</span>&nbsp;<span class="ident" id="5951707">r</span><span class="op" id="5951708">.</span><span class="ident" id="5951709">AllocsPerOp</span><span class="op" id="5951720">(</span><span class="op" id="5951721">)</span><span class="op" id="5951722">)</span><br>
<span class="lineno"></span><span class="op" id="5951724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5951727">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5951820">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="5951849">func</span>&nbsp;<span class="ident" id="5951854">RunBenchmarks</span><span class="op" id="5951867">(</span><span class="ident" id="5951868">matchString</span>&nbsp;<span class="keyword" id="5951880">func</span><span class="op" id="5951884">(</span><span class="ident" id="5951885">pat</span><span class="op" id="5951888">,</span>&nbsp;<span class="ident" id="5951890">str</span>&nbsp;<span class="builtintype" id="5951894">string</span><span class="op" id="5951900">)</span>&nbsp;<span class="op" id="5951902">(</span><span class="builtintype" id="5951903">bool</span><span class="op" id="5951907">,</span>&nbsp;<span class="builtintype" id="5951909">error</span><span class="op" id="5951914">)</span><span class="op" id="5951915">,</span>&nbsp;<span class="ident" id="5951917">benchmarks</span>&nbsp;<span class="op" id="5951928">[</span><span class="op" id="5951929">]</span><span class="ident" id="5951930">InternalBenchmark</span><span class="op" id="5951947">)</span>&nbsp;<span class="op" id="5951949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5951952">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952004">if</span>&nbsp;<span class="builtinfunc" id="5952007">len</span><span class="op" id="5952010">(</span><span class="op" id="5952011">*</span><span class="ident" id="5952012">matchBenchmarks</span><span class="op" id="5952027">)</span>&nbsp;<span class="op" id="5952029">==</span>&nbsp;<span class="num" id="5952032">0</span>&nbsp;<span class="op" id="5952034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952038">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952046">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952049">for</span>&nbsp;<span class="ident" id="5952053">_</span><span class="op" id="5952054">,</span>&nbsp;<span class="ident" id="5952056">Benchmark</span>&nbsp;<span class="op" id="5952066">:=</span>&nbsp;<span class="keyword" id="5952069">range</span>&nbsp;<span class="ident" id="5952075">benchmarks</span>&nbsp;<span class="op" id="5952086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952090">matched</span><span class="op" id="5952097">,</span>&nbsp;<span class="ident" id="5952099">err</span>&nbsp;<span class="op" id="5952103">:=</span>&nbsp;<span class="ident" id="5952106">matchString</span><span class="op" id="5952117">(</span><span class="op" id="5952118">*</span><span class="ident" id="5952119">matchBenchmarks</span><span class="op" id="5952134">,</span>&nbsp;<span class="ident" id="5952136">Benchmark</span><span class="op" id="5952145">.</span><span class="ident" id="5952146">Name</span><span class="op" id="5952150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952154">if</span>&nbsp;<span class="ident" id="5952157">err</span>&nbsp;<span class="op" id="5952161">!=</span>&nbsp;<span class="ident" id="5952164">nil</span>&nbsp;<span class="op" id="5952168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952173">fmt</span><span class="op" id="5952176">.</span><span class="ident" id="5952177">Fprintf</span><span class="op" id="5952184">(</span><span class="ident" id="5952185">os</span><span class="op" id="5952187">.</span><span class="ident" id="5952188">Stderr</span><span class="op" id="5952194">,</span>&nbsp;<span class="string" id="5952196">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="5952243">,</span>&nbsp;<span class="ident" id="5952245">err</span><span class="op" id="5952248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952253">os</span><span class="op" id="5952255">.</span><span class="ident" id="5952256">Exit</span><span class="op" id="5952260">(</span><span class="num" id="5952261">1</span><span class="op" id="5952262">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952270">if</span>&nbsp;<span class="op" id="5952273">!</span><span class="ident" id="5952274">matched</span>&nbsp;<span class="op" id="5952282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952287">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952302">for</span>&nbsp;<span class="ident" id="5952306">_</span><span class="op" id="5952307">,</span>&nbsp;<span class="ident" id="5952309">procs</span>&nbsp;<span class="op" id="5952315">:=</span>&nbsp;<span class="keyword" id="5952318">range</span>&nbsp;<span class="ident" id="5952324">cpuList</span>&nbsp;<span class="op" id="5952332">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952337">runtime</span><span class="op" id="5952344">.</span><span class="ident" id="5952345">GOMAXPROCS</span><span class="op" id="5952355">(</span><span class="ident" id="5952356">procs</span><span class="op" id="5952361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952366">b</span>&nbsp;<span class="op" id="5952368">:=</span>&nbsp;<span class="op" id="5952371">&amp;</span><span class="ident" id="5952372">B</span><span class="op" id="5952373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952379">common</span><span class="op" id="5952385">:</span>&nbsp;<span class="ident" id="5952387">common</span><span class="op" id="5952393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952400">signal</span><span class="op" id="5952406">:</span>&nbsp;<span class="builtinfunc" id="5952408">make</span><span class="op" id="5952412">(</span><span class="keyword" id="5952413">chan</span>&nbsp;<span class="keyword" id="5952418">interface</span><span class="op" id="5952427">{</span><span class="op" id="5952428">}</span><span class="op" id="5952429">)</span><span class="op" id="5952430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952436">}</span><span class="op" id="5952437">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952443">benchmark</span><span class="op" id="5952452">:</span>&nbsp;<span class="ident" id="5952454">Benchmark</span><span class="op" id="5952463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952473">benchName</span>&nbsp;<span class="op" id="5952483">:=</span>&nbsp;<span class="ident" id="5952486">Benchmark</span><span class="op" id="5952495">.</span><span class="ident" id="5952496">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952504">if</span>&nbsp;<span class="ident" id="5952507">procs</span>&nbsp;<span class="op" id="5952513">!=</span>&nbsp;<span class="num" id="5952516">1</span>&nbsp;<span class="op" id="5952518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952524">benchName</span>&nbsp;<span class="op" id="5952534">=</span>&nbsp;<span class="ident" id="5952536">fmt</span><span class="op" id="5952539">.</span><span class="ident" id="5952540">Sprintf</span><span class="op" id="5952547">(</span><span class="string" id="5952548">&#34;%s-%d&#34;</span><span class="op" id="5952555">,</span>&nbsp;<span class="ident" id="5952557">Benchmark</span><span class="op" id="5952566">.</span><span class="ident" id="5952567">Name</span><span class="op" id="5952571">,</span>&nbsp;<span class="ident" id="5952573">procs</span><span class="op" id="5952578">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952588">fmt</span><span class="op" id="5952591">.</span><span class="ident" id="5952592">Printf</span><span class="op" id="5952598">(</span><span class="string" id="5952599">&#34;%s\t&#34;</span><span class="op" id="5952605">,</span>&nbsp;<span class="ident" id="5952607">benchName</span><span class="op" id="5952616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952621">r</span>&nbsp;<span class="op" id="5952623">:=</span>&nbsp;<span class="ident" id="5952626">b</span><span class="op" id="5952627">.</span><span class="ident" id="5952628">run</span><span class="op" id="5952631">(</span><span class="op" id="5952632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952637">if</span>&nbsp;<span class="ident" id="5952640">b</span><span class="op" id="5952641">.</span><span class="ident" id="5952642">failed</span>&nbsp;<span class="op" id="5952649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952655">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952718">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5952795">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952824">fmt</span><span class="op" id="5952827">.</span><span class="ident" id="5952828">Printf</span><span class="op" id="5952834">(</span><span class="string" id="5952835">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="5952853">,</span>&nbsp;<span class="ident" id="5952855">benchName</span><span class="op" id="5952864">,</span>&nbsp;<span class="ident" id="5952866">b</span><span class="op" id="5952867">.</span><span class="ident" id="5952868">output</span><span class="op" id="5952874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952880">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5952892">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952897">results</span>&nbsp;<span class="op" id="5952905">:=</span>&nbsp;<span class="ident" id="5952908">r</span><span class="op" id="5952909">.</span><span class="ident" id="5952910">String</span><span class="op" id="5952916">(</span><span class="op" id="5952917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5952922">if</span>&nbsp;<span class="op" id="5952925">*</span><span class="ident" id="5952926">benchmarkMemory</span>&nbsp;<span class="op" id="5952942">||</span>&nbsp;<span class="ident" id="5952945">b</span><span class="op" id="5952946">.</span><span class="ident" id="5952947">showAllocResult</span>&nbsp;<span class="op" id="5952963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5952969">results</span>&nbsp;<span class="op" id="5952977">+=</span>&nbsp;<span class="string" id="5952980">&#34;\t&#34;</span>&nbsp;<span class="op" id="5952985">+</span>&nbsp;<span class="ident" id="5952987">r</span><span class="op" id="5952988">.</span><span class="ident" id="5952989">MemString</span><span class="op" id="5952998">(</span><span class="op" id="5952999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953009">fmt</span><span class="op" id="5953012">.</span><span class="ident" id="5953013">Println</span><span class="op" id="5953020">(</span><span class="ident" id="5953021">results</span><span class="op" id="5953028">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953033">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953113">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953186">if</span>&nbsp;<span class="builtinfunc" id="5953189">len</span><span class="op" id="5953192">(</span><span class="ident" id="5953193">b</span><span class="op" id="5953194">.</span><span class="ident" id="5953195">output</span><span class="op" id="5953201">)</span>&nbsp;<span class="op" id="5953203">&gt;</span>&nbsp;<span class="num" id="5953205">0</span>&nbsp;<span class="op" id="5953207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953213">b</span><span class="op" id="5953214">.</span><span class="ident" id="5953215">trimOutput</span><span class="op" id="5953225">(</span><span class="op" id="5953226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953232">fmt</span><span class="op" id="5953235">.</span><span class="ident" id="5953236">Printf</span><span class="op" id="5953242">(</span><span class="string" id="5953243">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="5953262">,</span>&nbsp;<span class="ident" id="5953264">benchName</span><span class="op" id="5953273">,</span>&nbsp;<span class="ident" id="5953275">b</span><span class="op" id="5953276">.</span><span class="ident" id="5953277">output</span><span class="op" id="5953283">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953293">if</span>&nbsp;<span class="ident" id="5953296">p</span>&nbsp;<span class="op" id="5953298">:=</span>&nbsp;<span class="ident" id="5953301">runtime</span><span class="op" id="5953308">.</span><span class="ident" id="5953309">GOMAXPROCS</span><span class="op" id="5953319">(</span><span class="op" id="5953320">-</span><span class="num" id="5953321">1</span><span class="op" id="5953322">)</span><span class="op" id="5953323">;</span>&nbsp;<span class="ident" id="5953325">p</span>&nbsp;<span class="op" id="5953327">!=</span>&nbsp;<span class="ident" id="5953330">procs</span>&nbsp;<span class="op" id="5953336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953342">fmt</span><span class="op" id="5953345">.</span><span class="ident" id="5953346">Fprintf</span><span class="op" id="5953353">(</span><span class="ident" id="5953354">os</span><span class="op" id="5953356">.</span><span class="ident" id="5953357">Stderr</span><span class="op" id="5953363">,</span>&nbsp;<span class="string" id="5953365">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="5953406">,</span>&nbsp;<span class="ident" id="5953408">benchName</span><span class="op" id="5953417">,</span>&nbsp;<span class="ident" id="5953419">p</span><span class="op" id="5953420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953429">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953432">}</span><br>
<span class="lineno"></span><span class="op" id="5953434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5953437">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="5953513">func</span>&nbsp;<span class="op" id="5953518">(</span><span class="ident" id="5953519">b</span>&nbsp;<span class="op" id="5953521">*</span><span class="ident" id="5953522">B</span><span class="op" id="5953523">)</span>&nbsp;<span class="ident" id="5953525">trimOutput</span><span class="op" id="5953535">(</span><span class="op" id="5953536">)</span>&nbsp;<span class="op" id="5953538">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953541">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953613">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5953693">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953777">const</span>&nbsp;<span class="ident" id="5953783">maxNewlines</span>&nbsp;<span class="op" id="5953795">=</span>&nbsp;<span class="num" id="5953797">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953801">for</span>&nbsp;<span class="ident" id="5953805">nlCount</span><span class="op" id="5953812">,</span>&nbsp;<span class="ident" id="5953814">j</span>&nbsp;<span class="op" id="5953816">:=</span>&nbsp;<span class="num" id="5953819">0</span><span class="op" id="5953820">,</span>&nbsp;<span class="num" id="5953822">0</span><span class="op" id="5953823">;</span>&nbsp;<span class="ident" id="5953825">j</span>&nbsp;<span class="op" id="5953827">&lt;</span>&nbsp;<span class="builtinfunc" id="5953829">len</span><span class="op" id="5953832">(</span><span class="ident" id="5953833">b</span><span class="op" id="5953834">.</span><span class="ident" id="5953835">output</span><span class="op" id="5953841">)</span><span class="op" id="5953842">;</span>&nbsp;<span class="ident" id="5953844">j</span><span class="op" id="5953845">++</span>&nbsp;<span class="op" id="5953848">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953852">if</span>&nbsp;<span class="ident" id="5953855">b</span><span class="op" id="5953856">.</span><span class="ident" id="5953857">output</span><span class="op" id="5953863">[</span><span class="ident" id="5953864">j</span><span class="op" id="5953865">]</span>&nbsp;<span class="op" id="5953867">==</span>&nbsp;<span class="string" id="5953870">&#39;\n&#39;</span>&nbsp;<span class="op" id="5953875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953880">nlCount</span><span class="op" id="5953887">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953893">if</span>&nbsp;<span class="ident" id="5953896">nlCount</span>&nbsp;<span class="op" id="5953904">&gt;=</span>&nbsp;<span class="ident" id="5953907">maxNewlines</span>&nbsp;<span class="op" id="5953919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953925">b</span><span class="op" id="5953926">.</span><span class="ident" id="5953927">output</span>&nbsp;<span class="op" id="5953934">=</span>&nbsp;<span class="builtinfunc" id="5953936">append</span><span class="op" id="5953942">(</span><span class="ident" id="5953943">b</span><span class="op" id="5953944">.</span><span class="ident" id="5953945">output</span><span class="op" id="5953951">[</span><span class="op" id="5953952">:</span><span class="ident" id="5953953">j</span><span class="op" id="5953954">]</span><span class="op" id="5953955">,</span>&nbsp;<span class="string" id="5953957">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="5953987">...</span><span class="op" id="5953990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953996">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954012">}</span><br>
<span class="lineno"></span><span class="op" id="5954014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="5954017">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="5954081">type</span>&nbsp;<span class="ident" id="5954086">PB</span>&nbsp;<span class="keyword" id="5954089">struct</span>&nbsp;<span class="op" id="5954096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954099">globalN</span>&nbsp;<span class="op" id="5954107">*</span><span class="ident" id="5954108">uint64</span>&nbsp;<span class="comment" id="5954115">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954174">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5954182">uint64</span>&nbsp;&nbsp;<span class="comment" id="5954190">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954244">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5954252">uint64</span>&nbsp;&nbsp;<span class="comment" id="5954260">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954299">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954307">uint64</span>&nbsp;&nbsp;<span class="comment" id="5954315">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="5954362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5954365">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="5954427">func</span>&nbsp;<span class="op" id="5954432">(</span><span class="ident" id="5954433">pb</span>&nbsp;<span class="op" id="5954436">*</span><span class="ident" id="5954437">PB</span><span class="op" id="5954439">)</span>&nbsp;<span class="ident" id="5954441">Next</span><span class="op" id="5954445">(</span><span class="op" id="5954446">)</span>&nbsp;<span class="builtintype" id="5954448">bool</span>&nbsp;<span class="op" id="5954453">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954456">if</span>&nbsp;<span class="ident" id="5954459">pb</span><span class="op" id="5954461">.</span><span class="ident" id="5954462">cache</span>&nbsp;<span class="op" id="5954468">==</span>&nbsp;<span class="num" id="5954471">0</span>&nbsp;<span class="op" id="5954473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954477">n</span>&nbsp;<span class="op" id="5954479">:=</span>&nbsp;<span class="ident" id="5954482">atomic</span><span class="op" id="5954488">.</span><span class="ident" id="5954489">AddUint64</span><span class="op" id="5954498">(</span><span class="ident" id="5954499">pb</span><span class="op" id="5954501">.</span><span class="ident" id="5954502">globalN</span><span class="op" id="5954509">,</span>&nbsp;<span class="ident" id="5954511">pb</span><span class="op" id="5954513">.</span><span class="ident" id="5954514">grain</span><span class="op" id="5954519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954523">if</span>&nbsp;<span class="ident" id="5954526">n</span>&nbsp;<span class="op" id="5954528">&lt;=</span>&nbsp;<span class="ident" id="5954531">pb</span><span class="op" id="5954533">.</span><span class="ident" id="5954534">bN</span>&nbsp;<span class="op" id="5954537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954542">pb</span><span class="op" id="5954544">.</span><span class="ident" id="5954545">cache</span>&nbsp;<span class="op" id="5954551">=</span>&nbsp;<span class="ident" id="5954553">pb</span><span class="op" id="5954555">.</span><span class="ident" id="5954556">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954564">}</span>&nbsp;<span class="keyword" id="5954566">else</span>&nbsp;<span class="keyword" id="5954571">if</span>&nbsp;<span class="ident" id="5954574">n</span>&nbsp;<span class="op" id="5954576">&lt;</span>&nbsp;<span class="ident" id="5954578">pb</span><span class="op" id="5954580">.</span><span class="ident" id="5954581">bN</span><span class="op" id="5954583">+</span><span class="ident" id="5954584">pb</span><span class="op" id="5954586">.</span><span class="ident" id="5954587">grain</span>&nbsp;<span class="op" id="5954593">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954598">pb</span><span class="op" id="5954600">.</span><span class="ident" id="5954601">cache</span>&nbsp;<span class="op" id="5954607">=</span>&nbsp;<span class="ident" id="5954609">pb</span><span class="op" id="5954611">.</span><span class="ident" id="5954612">bN</span>&nbsp;<span class="op" id="5954615">+</span>&nbsp;<span class="ident" id="5954617">pb</span><span class="op" id="5954619">.</span><span class="ident" id="5954620">grain</span>&nbsp;<span class="op" id="5954626">-</span>&nbsp;<span class="ident" id="5954628">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954632">}</span>&nbsp;<span class="keyword" id="5954634">else</span>&nbsp;<span class="op" id="5954639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954644">return</span>&nbsp;<span class="builtintype" id="5954651">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954662">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954665">pb</span><span class="op" id="5954667">.</span><span class="ident" id="5954668">cache</span><span class="op" id="5954673">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954677">return</span>&nbsp;<span class="builtintype" id="5954684">true</span><br>
<span class="lineno"></span><span class="op" id="5954689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5954692">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="5954737">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="5954814">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5954894">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="5954963">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="5955022">//</span><br>
<span class="lineno">385</span><span class="comment" id="5955025">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5955098">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5955169">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="5955242">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="5955278">func</span>&nbsp;<span class="op" id="5955283">(</span><span class="ident" id="5955284">b</span>&nbsp;<span class="op" id="5955286">*</span><span class="ident" id="5955287">B</span><span class="op" id="5955288">)</span>&nbsp;<span class="ident" id="5955290">RunParallel</span><span class="op" id="5955301">(</span><span class="ident" id="5955302">body</span>&nbsp;<span class="keyword" id="5955307">func</span><span class="op" id="5955311">(</span><span class="op" id="5955312">*</span><span class="ident" id="5955313">PB</span><span class="op" id="5955315">)</span><span class="op" id="5955316">)</span>&nbsp;<span class="op" id="5955318">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955321">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100µs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955389">//&nbsp;100µs&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955458">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955486">grain</span>&nbsp;<span class="op" id="5955492">:=</span>&nbsp;<span class="ident" id="5955495">uint64</span><span class="op" id="5955501">(</span><span class="num" id="5955502">0</span><span class="op" id="5955503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955506">if</span>&nbsp;<span class="ident" id="5955509">b</span><span class="op" id="5955510">.</span><span class="ident" id="5955511">previousN</span>&nbsp;<span class="op" id="5955521">&gt;</span>&nbsp;<span class="num" id="5955523">0</span>&nbsp;<span class="op" id="5955525">&amp;&amp;</span>&nbsp;<span class="ident" id="5955528">b</span><span class="op" id="5955529">.</span><span class="ident" id="5955530">previousDuration</span>&nbsp;<span class="op" id="5955547">&gt;</span>&nbsp;<span class="num" id="5955549">0</span>&nbsp;<span class="op" id="5955551">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955555">grain</span>&nbsp;<span class="op" id="5955561">=</span>&nbsp;<span class="num" id="5955563">1e5</span>&nbsp;<span class="op" id="5955567">*</span>&nbsp;<span class="ident" id="5955569">uint64</span><span class="op" id="5955575">(</span><span class="ident" id="5955576">b</span><span class="op" id="5955577">.</span><span class="ident" id="5955578">previousN</span><span class="op" id="5955587">)</span>&nbsp;<span class="op" id="5955589">/</span>&nbsp;<span class="ident" id="5955591">uint64</span><span class="op" id="5955597">(</span><span class="ident" id="5955598">b</span><span class="op" id="5955599">.</span><span class="ident" id="5955600">previousDuration</span><span class="op" id="5955616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955622">if</span>&nbsp;<span class="ident" id="5955625">grain</span>&nbsp;<span class="op" id="5955631">&lt;</span>&nbsp;<span class="num" id="5955633">1</span>&nbsp;<span class="op" id="5955635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955639">grain</span>&nbsp;<span class="op" id="5955645">=</span>&nbsp;<span class="num" id="5955647">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955650">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955653">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955723">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100µs/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955778">if</span>&nbsp;<span class="ident" id="5955781">grain</span>&nbsp;<span class="op" id="5955787">&gt;</span>&nbsp;<span class="num" id="5955789">1e4</span>&nbsp;<span class="op" id="5955793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955797">grain</span>&nbsp;<span class="op" id="5955803">=</span>&nbsp;<span class="num" id="5955805">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955810">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955814">n</span>&nbsp;<span class="op" id="5955816">:=</span>&nbsp;<span class="ident" id="5955819">uint64</span><span class="op" id="5955825">(</span><span class="num" id="5955826">0</span><span class="op" id="5955827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955830">numProcs</span>&nbsp;<span class="op" id="5955839">:=</span>&nbsp;<span class="ident" id="5955842">b</span><span class="op" id="5955843">.</span><span class="ident" id="5955844">parallelism</span>&nbsp;<span class="op" id="5955856">*</span>&nbsp;<span class="ident" id="5955858">runtime</span><span class="op" id="5955865">.</span><span class="ident" id="5955866">GOMAXPROCS</span><span class="op" id="5955876">(</span><span class="num" id="5955877">0</span><span class="op" id="5955878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955881">var</span>&nbsp;<span class="ident" id="5955885">wg</span>&nbsp;<span class="ident" id="5955888">sync</span><span class="op" id="5955892">.</span><span class="ident" id="5955893">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955904">wg</span><span class="op" id="5955906">.</span><span class="ident" id="5955907">Add</span><span class="op" id="5955910">(</span><span class="ident" id="5955911">numProcs</span><span class="op" id="5955919">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955922">for</span>&nbsp;<span class="ident" id="5955926">p</span>&nbsp;<span class="op" id="5955928">:=</span>&nbsp;<span class="num" id="5955931">0</span><span class="op" id="5955932">;</span>&nbsp;<span class="ident" id="5955934">p</span>&nbsp;<span class="op" id="5955936">&lt;</span>&nbsp;<span class="ident" id="5955938">numProcs</span><span class="op" id="5955946">;</span>&nbsp;<span class="ident" id="5955948">p</span><span class="op" id="5955949">++</span>&nbsp;<span class="op" id="5955952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955956">go</span>&nbsp;<span class="keyword" id="5955959">func</span><span class="op" id="5955963">(</span><span class="op" id="5955964">)</span>&nbsp;<span class="op" id="5955966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955971">defer</span>&nbsp;<span class="ident" id="5955977">wg</span><span class="op" id="5955979">.</span><span class="ident" id="5955980">Done</span><span class="op" id="5955984">(</span><span class="op" id="5955985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955990">pb</span>&nbsp;<span class="op" id="5955993">:=</span>&nbsp;<span class="op" id="5955996">&amp;</span><span class="ident" id="5955997">PB</span><span class="op" id="5955999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956005">globalN</span><span class="op" id="5956012">:</span>&nbsp;<span class="op" id="5956014">&amp;</span><span class="ident" id="5956015">n</span><span class="op" id="5956016">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956022">grain</span><span class="op" id="5956027">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5956031">grain</span><span class="op" id="5956036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956042">bN</span><span class="op" id="5956044">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956051">uint64</span><span class="op" id="5956057">(</span><span class="ident" id="5956058">b</span><span class="op" id="5956059">.</span><span class="ident" id="5956060">N</span><span class="op" id="5956061">)</span><span class="op" id="5956062">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956072">body</span><span class="op" id="5956076">(</span><span class="ident" id="5956077">pb</span><span class="op" id="5956079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956083">}</span><span class="op" id="5956084">(</span><span class="op" id="5956085">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956091">wg</span><span class="op" id="5956093">.</span><span class="ident" id="5956094">Wait</span><span class="op" id="5956098">(</span><span class="op" id="5956099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956102">if</span>&nbsp;<span class="ident" id="5956105">n</span>&nbsp;<span class="op" id="5956107">&lt;=</span>&nbsp;<span class="ident" id="5956110">uint64</span><span class="op" id="5956116">(</span><span class="ident" id="5956117">b</span><span class="op" id="5956118">.</span><span class="ident" id="5956119">N</span><span class="op" id="5956120">)</span>&nbsp;<span class="op" id="5956122">&amp;&amp;</span>&nbsp;<span class="op" id="5956125">!</span><span class="ident" id="5956126">b</span><span class="op" id="5956127">.</span><span class="ident" id="5956128">Failed</span><span class="op" id="5956134">(</span><span class="op" id="5956135">)</span>&nbsp;<span class="op" id="5956137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956141">b</span><span class="op" id="5956142">.</span><span class="ident" id="5956143">Fatal</span><span class="op" id="5956148">(</span><span class="string" id="5956149">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="5956202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956205">}</span><br>
<span class="lineno">425</span><span class="op" id="5956207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5956210">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="5956295">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="5956372">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="5956427">func</span>&nbsp;<span class="op" id="5956432">(</span><span class="ident" id="5956433">b</span>&nbsp;<span class="op" id="5956435">*</span><span class="ident" id="5956436">B</span><span class="op" id="5956437">)</span>&nbsp;<span class="ident" id="5956439">SetParallelism</span><span class="op" id="5956453">(</span><span class="ident" id="5956454">p</span>&nbsp;<span class="builtintype" id="5956456">int</span><span class="op" id="5956459">)</span>&nbsp;<span class="op" id="5956461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956464">if</span>&nbsp;<span class="ident" id="5956467">p</span>&nbsp;<span class="op" id="5956469">&gt;=</span>&nbsp;<span class="num" id="5956472">1</span>&nbsp;<span class="op" id="5956474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956478">b</span><span class="op" id="5956479">.</span><span class="ident" id="5956480">parallelism</span>&nbsp;<span class="op" id="5956492">=</span>&nbsp;<span class="ident" id="5956494">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956497">}</span><br>
<span class="lineno"></span><span class="op" id="5956499">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="5956502">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="5956565">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5956625">func</span>&nbsp;<span class="ident" id="5956630">Benchmark</span><span class="op" id="5956639">(</span><span class="ident" id="5956640">f</span>&nbsp;<span class="keyword" id="5956642">func</span><span class="op" id="5956646">(</span><span class="ident" id="5956647">b</span>&nbsp;<span class="op" id="5956649">*</span><span class="ident" id="5956650">B</span><span class="op" id="5956651">)</span><span class="op" id="5956652">)</span>&nbsp;<span class="ident" id="5956654">BenchmarkResult</span>&nbsp;<span class="op" id="5956670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956673">b</span>&nbsp;<span class="op" id="5956675">:=</span>&nbsp;<span class="op" id="5956678">&amp;</span><span class="ident" id="5956679">B</span><span class="op" id="5956680">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956684">common</span><span class="op" id="5956690">:</span>&nbsp;<span class="ident" id="5956692">common</span><span class="op" id="5956698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956703">signal</span><span class="op" id="5956709">:</span>&nbsp;<span class="builtinfunc" id="5956711">make</span><span class="op" id="5956715">(</span><span class="keyword" id="5956716">chan</span>&nbsp;<span class="keyword" id="5956721">interface</span><span class="op" id="5956730">{</span><span class="op" id="5956731">}</span><span class="op" id="5956732">)</span><span class="op" id="5956733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956737">}</span><span class="op" id="5956738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956742">benchmark</span><span class="op" id="5956751">:</span>&nbsp;<span class="ident" id="5956753">InternalBenchmark</span><span class="op" id="5956770">{</span><span class="string" id="5956771">&#34;&#34;</span><span class="op" id="5956773">,</span>&nbsp;<span class="ident" id="5956775">f</span><span class="op" id="5956776">}</span><span class="op" id="5956777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956780">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956783">return</span>&nbsp;<span class="ident" id="5956790">b</span><span class="op" id="5956791">.</span><span class="ident" id="5956792">run</span><span class="op" id="5956795">(</span><span class="op" id="5956796">)</span><br>
<span class="lineno"></span><span class="op" id="5956798">}</span>
</div>
</body>
</html>
