<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2968304">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2968359">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2968413">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2968464">package</span>&nbsp;<span class="ident" id="2968472">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2968481">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="2968558">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2968608">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="2968676">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="2968753">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="2968788">type</span>&nbsp;<span class="ident" id="2968793">stringFinder</span>&nbsp;<span class="keyword" id="2968806">struct</span>&nbsp;<span class="op" id="2968813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968816">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2968881">pattern</span>&nbsp;<span class="builtintype" id="2968889">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968898">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968972">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969046">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969082">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969086">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969158">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969231">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2969276">badCharSkip</span>&nbsp;<span class="op" id="2969288">[</span><span class="num" id="2969289">256</span><span class="op" id="2969292">]</span><span class="builtintype" id="2969293">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969299">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969375">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969447">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969489">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969493">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969565">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969639">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969709">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969782">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969847">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969882">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969886">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969961">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970029">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970103">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970169">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970237">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970307">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970378">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970451">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970508">goodSuffixSkip</span>&nbsp;<span class="op" id="2970523">[</span><span class="op" id="2970524">]</span><span class="builtintype" id="2970525">int</span><br>
<span class="lineno"></span><span class="op" id="2970529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2970532">func</span>&nbsp;<span class="ident" id="2970537">makeStringFinder</span><span class="op" id="2970553">(</span><span class="ident" id="2970554">pattern</span>&nbsp;<span class="builtintype" id="2970562">string</span><span class="op" id="2970568">)</span>&nbsp;<span class="op" id="2970570">*</span><span class="ident" id="2970571">stringFinder</span>&nbsp;<span class="op" id="2970584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970587">f</span>&nbsp;<span class="op" id="2970589">:=</span>&nbsp;<span class="op" id="2970592">&amp;</span><span class="ident" id="2970593">stringFinder</span><span class="op" id="2970605">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970609">pattern</span><span class="op" id="2970616">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2970625">pattern</span><span class="op" id="2970632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970636">goodSuffixSkip</span><span class="op" id="2970650">:</span>&nbsp;<span class="builtinfunc" id="2970652">make</span><span class="op" id="2970656">(</span><span class="op" id="2970657">[</span><span class="op" id="2970658">]</span><span class="builtintype" id="2970659">int</span><span class="op" id="2970662">,</span>&nbsp;<span class="builtinfunc" id="2970664">len</span><span class="op" id="2970667">(</span><span class="ident" id="2970668">pattern</span><span class="op" id="2970675">)</span><span class="op" id="2970676">)</span><span class="op" id="2970677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2970680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970683">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970743">last</span>&nbsp;<span class="op" id="2970748">:=</span>&nbsp;<span class="builtinfunc" id="2970751">len</span><span class="op" id="2970754">(</span><span class="ident" id="2970755">pattern</span><span class="op" id="2970762">)</span>&nbsp;<span class="op" id="2970764">-</span>&nbsp;<span class="num" id="2970766">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970770">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970801">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970861">for</span>&nbsp;<span class="ident" id="2970865">i</span>&nbsp;<span class="op" id="2970867">:=</span>&nbsp;<span class="keyword" id="2970870">range</span>&nbsp;<span class="ident" id="2970876">f</span><span class="op" id="2970877">.</span><span class="ident" id="2970878">badCharSkip</span>&nbsp;<span class="op" id="2970890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970894">f</span><span class="op" id="2970895">.</span><span class="ident" id="2970896">badCharSkip</span><span class="op" id="2970907">[</span><span class="ident" id="2970908">i</span><span class="op" id="2970909">]</span>&nbsp;<span class="op" id="2970911">=</span>&nbsp;<span class="builtinfunc" id="2970913">len</span><span class="op" id="2970916">(</span><span class="ident" id="2970917">pattern</span><span class="op" id="2970924">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2970927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970930">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2971003">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2971078">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971119">for</span>&nbsp;<span class="ident" id="2971123">i</span>&nbsp;<span class="op" id="2971125">:=</span>&nbsp;<span class="num" id="2971128">0</span><span class="op" id="2971129">;</span>&nbsp;<span class="ident" id="2971131">i</span>&nbsp;<span class="op" id="2971133">&lt;</span>&nbsp;<span class="ident" id="2971135">last</span><span class="op" id="2971139">;</span>&nbsp;<span class="ident" id="2971141">i</span><span class="op" id="2971142">++</span>&nbsp;<span class="op" id="2971145">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971149">f</span><span class="op" id="2971150">.</span><span class="ident" id="2971151">badCharSkip</span><span class="op" id="2971162">[</span><span class="ident" id="2971163">pattern</span><span class="op" id="2971170">[</span><span class="ident" id="2971171">i</span><span class="op" id="2971172">]</span><span class="op" id="2971173">]</span>&nbsp;<span class="op" id="2971175">=</span>&nbsp;<span class="ident" id="2971177">last</span>&nbsp;<span class="op" id="2971182">-</span>&nbsp;<span class="ident" id="2971184">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2971191">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2971220">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2971294">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971307">lastPrefix</span>&nbsp;<span class="op" id="2971318">:=</span>&nbsp;<span class="ident" id="2971321">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971327">for</span>&nbsp;<span class="ident" id="2971331">i</span>&nbsp;<span class="op" id="2971333">:=</span>&nbsp;<span class="ident" id="2971336">last</span><span class="op" id="2971340">;</span>&nbsp;<span class="ident" id="2971342">i</span>&nbsp;<span class="op" id="2971344">&gt;=</span>&nbsp;<span class="num" id="2971347">0</span><span class="op" id="2971348">;</span>&nbsp;<span class="ident" id="2971350">i</span><span class="op" id="2971351">--</span>&nbsp;<span class="op" id="2971354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971358">if</span>&nbsp;<span class="ident" id="2971361">HasPrefix</span><span class="op" id="2971370">(</span><span class="ident" id="2971371">pattern</span><span class="op" id="2971378">,</span>&nbsp;<span class="ident" id="2971380">pattern</span><span class="op" id="2971387">[</span><span class="ident" id="2971388">i</span><span class="op" id="2971389">+</span><span class="num" id="2971390">1</span><span class="op" id="2971391">:</span><span class="op" id="2971392">]</span><span class="op" id="2971393">)</span>&nbsp;<span class="op" id="2971395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971400">lastPrefix</span>&nbsp;<span class="op" id="2971411">=</span>&nbsp;<span class="ident" id="2971413">i</span>&nbsp;<span class="op" id="2971415">+</span>&nbsp;<span class="num" id="2971417">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2971425">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971484">f</span><span class="op" id="2971485">.</span><span class="ident" id="2971486">goodSuffixSkip</span><span class="op" id="2971500">[</span><span class="ident" id="2971501">i</span><span class="op" id="2971502">]</span>&nbsp;<span class="op" id="2971504">=</span>&nbsp;<span class="ident" id="2971506">lastPrefix</span>&nbsp;<span class="op" id="2971517">+</span>&nbsp;<span class="ident" id="2971519">last</span>&nbsp;<span class="op" id="2971524">-</span>&nbsp;<span class="ident" id="2971526">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2971532">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971607">for</span>&nbsp;<span class="ident" id="2971611">i</span>&nbsp;<span class="op" id="2971613">:=</span>&nbsp;<span class="num" id="2971616">0</span><span class="op" id="2971617">;</span>&nbsp;<span class="ident" id="2971619">i</span>&nbsp;<span class="op" id="2971621">&lt;</span>&nbsp;<span class="ident" id="2971623">last</span><span class="op" id="2971627">;</span>&nbsp;<span class="ident" id="2971629">i</span><span class="op" id="2971630">++</span>&nbsp;<span class="op" id="2971633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971637">lenSuffix</span>&nbsp;<span class="op" id="2971647">:=</span>&nbsp;<span class="ident" id="2971650">longestCommonSuffix</span><span class="op" id="2971669">(</span><span class="ident" id="2971670">pattern</span><span class="op" id="2971677">,</span>&nbsp;<span class="ident" id="2971679">pattern</span><span class="op" id="2971686">[</span><span class="num" id="2971687">1</span><span class="op" id="2971688">:</span><span class="ident" id="2971689">i</span><span class="op" id="2971690">+</span><span class="num" id="2971691">1</span><span class="op" id="2971692">]</span><span class="op" id="2971693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971697">if</span>&nbsp;<span class="ident" id="2971700">pattern</span><span class="op" id="2971707">[</span><span class="ident" id="2971708">i</span><span class="op" id="2971709">-</span><span class="ident" id="2971710">lenSuffix</span><span class="op" id="2971719">]</span>&nbsp;<span class="op" id="2971721">!=</span>&nbsp;<span class="ident" id="2971724">pattern</span><span class="op" id="2971731">[</span><span class="ident" id="2971732">last</span><span class="op" id="2971736">-</span><span class="ident" id="2971737">lenSuffix</span><span class="op" id="2971746">]</span>&nbsp;<span class="op" id="2971748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2971753">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971812">f</span><span class="op" id="2971813">.</span><span class="ident" id="2971814">goodSuffixSkip</span><span class="op" id="2971828">[</span><span class="ident" id="2971829">last</span><span class="op" id="2971833">-</span><span class="ident" id="2971834">lenSuffix</span><span class="op" id="2971843">]</span>&nbsp;<span class="op" id="2971845">=</span>&nbsp;<span class="ident" id="2971847">lenSuffix</span>&nbsp;<span class="op" id="2971857">+</span>&nbsp;<span class="ident" id="2971859">last</span>&nbsp;<span class="op" id="2971864">-</span>&nbsp;<span class="ident" id="2971866">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971877">return</span>&nbsp;<span class="ident" id="2971884">f</span><br>
<span class="lineno"></span><span class="op" id="2971886">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2971889">func</span>&nbsp;<span class="ident" id="2971894">longestCommonSuffix</span><span class="op" id="2971913">(</span><span class="ident" id="2971914">a</span><span class="op" id="2971915">,</span>&nbsp;<span class="ident" id="2971917">b</span>&nbsp;<span class="builtintype" id="2971919">string</span><span class="op" id="2971925">)</span>&nbsp;<span class="op" id="2971927">(</span><span class="ident" id="2971928">i</span>&nbsp;<span class="builtintype" id="2971930">int</span><span class="op" id="2971933">)</span>&nbsp;<span class="op" id="2971935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971938">for</span>&nbsp;<span class="op" id="2971942">;</span>&nbsp;<span class="ident" id="2971944">i</span>&nbsp;<span class="op" id="2971946">&lt;</span>&nbsp;<span class="builtinfunc" id="2971948">len</span><span class="op" id="2971951">(</span><span class="ident" id="2971952">a</span><span class="op" id="2971953">)</span>&nbsp;<span class="op" id="2971955">&amp;&amp;</span>&nbsp;<span class="ident" id="2971958">i</span>&nbsp;<span class="op" id="2971960">&lt;</span>&nbsp;<span class="builtinfunc" id="2971962">len</span><span class="op" id="2971965">(</span><span class="ident" id="2971966">b</span><span class="op" id="2971967">)</span><span class="op" id="2971968">;</span>&nbsp;<span class="ident" id="2971970">i</span><span class="op" id="2971971">++</span>&nbsp;<span class="op" id="2971974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971978">if</span>&nbsp;<span class="ident" id="2971981">a</span><span class="op" id="2971982">[</span><span class="builtinfunc" id="2971983">len</span><span class="op" id="2971986">(</span><span class="ident" id="2971987">a</span><span class="op" id="2971988">)</span><span class="op" id="2971989">-</span><span class="num" id="2971990">1</span><span class="op" id="2971991">-</span><span class="ident" id="2971992">i</span><span class="op" id="2971993">]</span>&nbsp;<span class="op" id="2971995">!=</span>&nbsp;<span class="ident" id="2971998">b</span><span class="op" id="2971999">[</span><span class="builtinfunc" id="2972000">len</span><span class="op" id="2972003">(</span><span class="ident" id="2972004">b</span><span class="op" id="2972005">)</span><span class="op" id="2972006">-</span><span class="num" id="2972007">1</span><span class="op" id="2972008">-</span><span class="ident" id="2972009">i</span><span class="op" id="2972010">]</span>&nbsp;<span class="op" id="2972012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972017">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2972025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2972028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972031">return</span><br>
<span class="lineno"></span><span class="op" id="2972038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2972041">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2972118">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2972162">func</span>&nbsp;<span class="op" id="2972167">(</span><span class="ident" id="2972168">f</span>&nbsp;<span class="op" id="2972170">*</span><span class="ident" id="2972171">stringFinder</span><span class="op" id="2972183">)</span>&nbsp;<span class="ident" id="2972185">next</span><span class="op" id="2972189">(</span><span class="ident" id="2972190">text</span>&nbsp;<span class="builtintype" id="2972195">string</span><span class="op" id="2972201">)</span>&nbsp;<span class="builtintype" id="2972203">int</span>&nbsp;<span class="op" id="2972207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972210">i</span>&nbsp;<span class="op" id="2972212">:=</span>&nbsp;<span class="builtinfunc" id="2972215">len</span><span class="op" id="2972218">(</span><span class="ident" id="2972219">f</span><span class="op" id="2972220">.</span><span class="ident" id="2972221">pattern</span><span class="op" id="2972228">)</span>&nbsp;<span class="op" id="2972230">-</span>&nbsp;<span class="num" id="2972232">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972235">for</span>&nbsp;<span class="ident" id="2972239">i</span>&nbsp;<span class="op" id="2972241">&lt;</span>&nbsp;<span class="builtinfunc" id="2972243">len</span><span class="op" id="2972246">(</span><span class="ident" id="2972247">text</span><span class="op" id="2972251">)</span>&nbsp;<span class="op" id="2972253">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2972257">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972331">j</span>&nbsp;<span class="op" id="2972333">:=</span>&nbsp;<span class="builtinfunc" id="2972336">len</span><span class="op" id="2972339">(</span><span class="ident" id="2972340">f</span><span class="op" id="2972341">.</span><span class="ident" id="2972342">pattern</span><span class="op" id="2972349">)</span>&nbsp;<span class="op" id="2972351">-</span>&nbsp;<span class="num" id="2972353">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972357">for</span>&nbsp;<span class="ident" id="2972361">j</span>&nbsp;<span class="op" id="2972363">&gt;=</span>&nbsp;<span class="num" id="2972366">0</span>&nbsp;<span class="op" id="2972368">&amp;&amp;</span>&nbsp;<span class="ident" id="2972371">text</span><span class="op" id="2972375">[</span><span class="ident" id="2972376">i</span><span class="op" id="2972377">]</span>&nbsp;<span class="op" id="2972379">==</span>&nbsp;<span class="ident" id="2972382">f</span><span class="op" id="2972383">.</span><span class="ident" id="2972384">pattern</span><span class="op" id="2972391">[</span><span class="ident" id="2972392">j</span><span class="op" id="2972393">]</span>&nbsp;<span class="op" id="2972395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972400">i</span><span class="op" id="2972401">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972407">j</span><span class="op" id="2972408">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2972413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972417">if</span>&nbsp;<span class="ident" id="2972420">j</span>&nbsp;<span class="op" id="2972422">&lt;</span>&nbsp;<span class="num" id="2972424">0</span>&nbsp;<span class="op" id="2972426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972431">return</span>&nbsp;<span class="ident" id="2972438">i</span>&nbsp;<span class="op" id="2972440">+</span>&nbsp;<span class="num" id="2972442">1</span>&nbsp;<span class="comment" id="2972444">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2972455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972459">i</span>&nbsp;<span class="op" id="2972461">+=</span>&nbsp;<span class="ident" id="2972464">max</span><span class="op" id="2972467">(</span><span class="ident" id="2972468">f</span><span class="op" id="2972469">.</span><span class="ident" id="2972470">badCharSkip</span><span class="op" id="2972481">[</span><span class="ident" id="2972482">text</span><span class="op" id="2972486">[</span><span class="ident" id="2972487">i</span><span class="op" id="2972488">]</span><span class="op" id="2972489">]</span><span class="op" id="2972490">,</span>&nbsp;<span class="ident" id="2972492">f</span><span class="op" id="2972493">.</span><span class="ident" id="2972494">goodSuffixSkip</span><span class="op" id="2972508">[</span><span class="ident" id="2972509">j</span><span class="op" id="2972510">]</span><span class="op" id="2972511">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2972514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972517">return</span>&nbsp;<span class="op" id="2972524">-</span><span class="num" id="2972525">1</span><br>
<span class="lineno"></span><span class="op" id="2972527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2972530">func</span>&nbsp;<span class="ident" id="2972535">max</span><span class="op" id="2972538">(</span><span class="ident" id="2972539">a</span><span class="op" id="2972540">,</span>&nbsp;<span class="ident" id="2972542">b</span>&nbsp;<span class="builtintype" id="2972544">int</span><span class="op" id="2972547">)</span>&nbsp;<span class="builtintype" id="2972549">int</span>&nbsp;<span class="op" id="2972553">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972556">if</span>&nbsp;<span class="ident" id="2972559">a</span>&nbsp;<span class="op" id="2972561">&gt;</span>&nbsp;<span class="ident" id="2972563">b</span>&nbsp;<span class="op" id="2972565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972569">return</span>&nbsp;<span class="ident" id="2972576">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2972579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972582">return</span>&nbsp;<span class="ident" id="2972589">b</span><br>
<span class="lineno"></span><span class="op" id="2972591">}</span>
</div>
</body>
</html>
