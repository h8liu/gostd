<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2969521">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2969576">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2969630">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2969681">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2969746">//&nbsp;Read&nbsp;system&nbsp;DNS&nbsp;config&nbsp;from&nbsp;/etc/resolv.conf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2969795">package</span>&nbsp;<span class="ident" id="2969803">net</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2969808">type</span>&nbsp;<span class="ident" id="2969813">dnsConfig</span>&nbsp;<span class="keyword" id="2969823">struct</span>&nbsp;<span class="op" id="2969830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2969833">servers</span>&nbsp;&nbsp;<span class="op" id="2969842">[</span><span class="op" id="2969843">]</span><span class="builtintype" id="2969844">string</span>&nbsp;<span class="comment" id="2969851">//&nbsp;servers&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2969870">search</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2969879">[</span><span class="op" id="2969880">]</span><span class="builtintype" id="2969881">string</span>&nbsp;<span class="comment" id="2969888">//&nbsp;suffixes&nbsp;to&nbsp;append&nbsp;to&nbsp;local&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2969925">ndots</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2969934">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2969943">//&nbsp;number&nbsp;of&nbsp;dots&nbsp;in&nbsp;name&nbsp;to&nbsp;trigger&nbsp;absolute&nbsp;lookup</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2969997">timeout</span>&nbsp;&nbsp;<span class="builtintype" id="2970006">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2970015">//&nbsp;seconds&nbsp;before&nbsp;giving&nbsp;up&nbsp;on&nbsp;packet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970054">attempts</span>&nbsp;<span class="builtintype" id="2970063">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2970072">//&nbsp;lost&nbsp;packets&nbsp;before&nbsp;giving&nbsp;up&nbsp;on&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970116">rotate</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2970125">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2970134">//&nbsp;round&nbsp;robin&nbsp;among&nbsp;servers</span><br>
<span class="lineno"></span><span class="op" id="2970163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2970166">//&nbsp;See&nbsp;resolv.conf(5)&nbsp;on&nbsp;a&nbsp;Linux&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="2970208">//&nbsp;TODO(rsc):&nbsp;Supposed&nbsp;to&nbsp;call&nbsp;uname()&nbsp;and&nbsp;chop&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="2970270">//&nbsp;of&nbsp;the&nbsp;host&nbsp;name&nbsp;to&nbsp;get&nbsp;the&nbsp;default&nbsp;search&nbsp;domain.</span><br>
<span class="lineno"></span><span class="keyword" id="2970324">func</span>&nbsp;<span class="ident" id="2970329">dnsReadConfig</span><span class="op" id="2970342">(</span><span class="ident" id="2970343">filename</span>&nbsp;<span class="builtintype" id="2970352">string</span><span class="op" id="2970358">)</span>&nbsp;<span class="op" id="2970360">(</span><span class="op" id="2970361">*</span><span class="ident" id="2970362">dnsConfig</span><span class="op" id="2970371">,</span>&nbsp;<span class="builtintype" id="2970373">error</span><span class="op" id="2970378">)</span>&nbsp;<span class="op" id="2970380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970383">file</span><span class="op" id="2970387">,</span>&nbsp;<span class="ident" id="2970389">err</span>&nbsp;<span class="op" id="2970393">:=</span>&nbsp;<span class="ident" id="2970396">open</span><span class="op" id="2970400">(</span><span class="ident" id="2970401">filename</span><span class="op" id="2970409">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970412">if</span>&nbsp;<span class="ident" id="2970415">err</span>&nbsp;<span class="op" id="2970419">!=</span>&nbsp;<span class="ident" id="2970422">nil</span>&nbsp;<span class="op" id="2970426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970430">return</span>&nbsp;<span class="ident" id="2970437">nil</span><span class="op" id="2970440">,</span>&nbsp;<span class="op" id="2970442">&amp;</span><span class="ident" id="2970443">DNSConfigError</span><span class="op" id="2970457">{</span><span class="ident" id="2970458">err</span><span class="op" id="2970461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2970464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970467">defer</span>&nbsp;<span class="ident" id="2970473">file</span><span class="op" id="2970477">.</span><span class="builtinfunc" id="2970478">close</span><span class="op" id="2970483">(</span><span class="op" id="2970484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970487">conf</span>&nbsp;<span class="op" id="2970492">:=</span>&nbsp;<span class="op" id="2970495">&amp;</span><span class="ident" id="2970496">dnsConfig</span><span class="op" id="2970505">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970509">ndots</span><span class="op" id="2970514">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="2970519">1</span><span class="op" id="2970520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970524">timeout</span><span class="op" id="2970531">:</span>&nbsp;&nbsp;<span class="num" id="2970534">5</span><span class="op" id="2970535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970539">attempts</span><span class="op" id="2970547">:</span>&nbsp;<span class="num" id="2970549">2</span><span class="op" id="2970550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2970553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970556">for</span>&nbsp;<span class="ident" id="2970560">line</span><span class="op" id="2970564">,</span>&nbsp;<span class="ident" id="2970566">ok</span>&nbsp;<span class="op" id="2970569">:=</span>&nbsp;<span class="ident" id="2970572">file</span><span class="op" id="2970576">.</span><span class="ident" id="2970577">readLine</span><span class="op" id="2970585">(</span><span class="op" id="2970586">)</span><span class="op" id="2970587">;</span>&nbsp;<span class="ident" id="2970589">ok</span><span class="op" id="2970591">;</span>&nbsp;<span class="ident" id="2970593">line</span><span class="op" id="2970597">,</span>&nbsp;<span class="ident" id="2970599">ok</span>&nbsp;<span class="op" id="2970602">=</span>&nbsp;<span class="ident" id="2970604">file</span><span class="op" id="2970608">.</span><span class="ident" id="2970609">readLine</span><span class="op" id="2970617">(</span><span class="op" id="2970618">)</span>&nbsp;<span class="op" id="2970620">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970624">f</span>&nbsp;<span class="op" id="2970626">:=</span>&nbsp;<span class="ident" id="2970629">getFields</span><span class="op" id="2970638">(</span><span class="ident" id="2970639">line</span><span class="op" id="2970643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970647">if</span>&nbsp;<span class="builtinfunc" id="2970650">len</span><span class="op" id="2970653">(</span><span class="ident" id="2970654">f</span><span class="op" id="2970655">)</span>&nbsp;<span class="op" id="2970657">&lt;</span>&nbsp;<span class="num" id="2970659">1</span>&nbsp;<span class="op" id="2970661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970666">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2970677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970681">switch</span>&nbsp;<span class="ident" id="2970688">f</span><span class="op" id="2970689">[</span><span class="num" id="2970690">0</span><span class="op" id="2970691">]</span>&nbsp;<span class="op" id="2970693">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970697">case</span>&nbsp;<span class="string" id="2970702">&#34;nameserver&#34;</span><span class="op" id="2970714">:</span>&nbsp;<span class="comment" id="2970716">//&nbsp;add&nbsp;one&nbsp;name&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970742">if</span>&nbsp;<span class="builtinfunc" id="2970745">len</span><span class="op" id="2970748">(</span><span class="ident" id="2970749">f</span><span class="op" id="2970750">)</span>&nbsp;<span class="op" id="2970752">&gt;</span>&nbsp;<span class="num" id="2970754">1</span>&nbsp;<span class="op" id="2970756">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2970759">len</span><span class="op" id="2970762">(</span><span class="ident" id="2970763">conf</span><span class="op" id="2970767">.</span><span class="ident" id="2970768">servers</span><span class="op" id="2970775">)</span>&nbsp;<span class="op" id="2970777">&lt;</span>&nbsp;<span class="num" id="2970779">3</span>&nbsp;<span class="op" id="2970781">{</span>&nbsp;<span class="comment" id="2970783">//&nbsp;small,&nbsp;but&nbsp;the&nbsp;standard&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970820">//&nbsp;One&nbsp;more&nbsp;check:&nbsp;make&nbsp;sure&nbsp;server&nbsp;name&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970868">//&nbsp;just&nbsp;an&nbsp;IP&nbsp;address.&nbsp;&nbsp;Otherwise&nbsp;we&nbsp;need&nbsp;DNS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2970918">//&nbsp;to&nbsp;look&nbsp;it&nbsp;up.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970940">if</span>&nbsp;<span class="ident" id="2970943">parseIPv4</span><span class="op" id="2970952">(</span><span class="ident" id="2970953">f</span><span class="op" id="2970954">[</span><span class="num" id="2970955">1</span><span class="op" id="2970956">]</span><span class="op" id="2970957">)</span>&nbsp;<span class="op" id="2970959">!=</span>&nbsp;<span class="ident" id="2970962">nil</span>&nbsp;<span class="op" id="2970966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970973">conf</span><span class="op" id="2970977">.</span><span class="ident" id="2970978">servers</span>&nbsp;<span class="op" id="2970986">=</span>&nbsp;<span class="builtinfunc" id="2970988">append</span><span class="op" id="2970994">(</span><span class="ident" id="2970995">conf</span><span class="op" id="2970999">.</span><span class="ident" id="2971000">servers</span><span class="op" id="2971007">,</span>&nbsp;<span class="ident" id="2971009">f</span><span class="op" id="2971010">[</span><span class="num" id="2971011">1</span><span class="op" id="2971012">]</span><span class="op" id="2971013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971019">}</span>&nbsp;<span class="keyword" id="2971021">else</span>&nbsp;<span class="keyword" id="2971026">if</span>&nbsp;<span class="ident" id="2971029">ip</span><span class="op" id="2971031">,</span>&nbsp;<span class="ident" id="2971033">_</span>&nbsp;<span class="op" id="2971035">:=</span>&nbsp;<span class="ident" id="2971038">parseIPv6</span><span class="op" id="2971047">(</span><span class="ident" id="2971048">f</span><span class="op" id="2971049">[</span><span class="num" id="2971050">1</span><span class="op" id="2971051">]</span><span class="op" id="2971052">,</span>&nbsp;<span class="builtintype" id="2971054">true</span><span class="op" id="2971058">)</span><span class="op" id="2971059">;</span>&nbsp;<span class="ident" id="2971061">ip</span>&nbsp;<span class="op" id="2971064">!=</span>&nbsp;<span class="ident" id="2971067">nil</span>&nbsp;<span class="op" id="2971071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971078">conf</span><span class="op" id="2971082">.</span><span class="ident" id="2971083">servers</span>&nbsp;<span class="op" id="2971091">=</span>&nbsp;<span class="builtinfunc" id="2971093">append</span><span class="op" id="2971099">(</span><span class="ident" id="2971100">conf</span><span class="op" id="2971104">.</span><span class="ident" id="2971105">servers</span><span class="op" id="2971112">,</span>&nbsp;<span class="ident" id="2971114">f</span><span class="op" id="2971115">[</span><span class="num" id="2971116">1</span><span class="op" id="2971117">]</span><span class="op" id="2971118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971124">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971134">case</span>&nbsp;<span class="string" id="2971139">&#34;domain&#34;</span><span class="op" id="2971147">:</span>&nbsp;<span class="comment" id="2971149">//&nbsp;set&nbsp;search&nbsp;path&nbsp;to&nbsp;just&nbsp;this&nbsp;domain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971191">if</span>&nbsp;<span class="builtinfunc" id="2971194">len</span><span class="op" id="2971197">(</span><span class="ident" id="2971198">f</span><span class="op" id="2971199">)</span>&nbsp;<span class="op" id="2971201">&gt;</span>&nbsp;<span class="num" id="2971203">1</span>&nbsp;<span class="op" id="2971205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971211">conf</span><span class="op" id="2971215">.</span><span class="ident" id="2971216">search</span>&nbsp;<span class="op" id="2971223">=</span>&nbsp;<span class="op" id="2971225">[</span><span class="op" id="2971226">]</span><span class="builtintype" id="2971227">string</span><span class="op" id="2971233">{</span><span class="ident" id="2971234">f</span><span class="op" id="2971235">[</span><span class="num" id="2971236">1</span><span class="op" id="2971237">]</span><span class="op" id="2971238">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971248">case</span>&nbsp;<span class="string" id="2971253">&#34;search&#34;</span><span class="op" id="2971261">:</span>&nbsp;<span class="comment" id="2971263">//&nbsp;set&nbsp;search&nbsp;path&nbsp;to&nbsp;given&nbsp;servers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971302">conf</span><span class="op" id="2971306">.</span><span class="ident" id="2971307">search</span>&nbsp;<span class="op" id="2971314">=</span>&nbsp;<span class="builtinfunc" id="2971316">make</span><span class="op" id="2971320">(</span><span class="op" id="2971321">[</span><span class="op" id="2971322">]</span><span class="builtintype" id="2971323">string</span><span class="op" id="2971329">,</span>&nbsp;<span class="builtinfunc" id="2971331">len</span><span class="op" id="2971334">(</span><span class="ident" id="2971335">f</span><span class="op" id="2971336">)</span><span class="op" id="2971337">-</span><span class="num" id="2971338">1</span><span class="op" id="2971339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971344">for</span>&nbsp;<span class="ident" id="2971348">i</span>&nbsp;<span class="op" id="2971350">:=</span>&nbsp;<span class="num" id="2971353">0</span><span class="op" id="2971354">;</span>&nbsp;<span class="ident" id="2971356">i</span>&nbsp;<span class="op" id="2971358">&lt;</span>&nbsp;<span class="builtinfunc" id="2971360">len</span><span class="op" id="2971363">(</span><span class="ident" id="2971364">conf</span><span class="op" id="2971368">.</span><span class="ident" id="2971369">search</span><span class="op" id="2971375">)</span><span class="op" id="2971376">;</span>&nbsp;<span class="ident" id="2971378">i</span><span class="op" id="2971379">++</span>&nbsp;<span class="op" id="2971382">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971388">conf</span><span class="op" id="2971392">.</span><span class="ident" id="2971393">search</span><span class="op" id="2971399">[</span><span class="ident" id="2971400">i</span><span class="op" id="2971401">]</span>&nbsp;<span class="op" id="2971403">=</span>&nbsp;<span class="ident" id="2971405">f</span><span class="op" id="2971406">[</span><span class="ident" id="2971407">i</span><span class="op" id="2971408">+</span><span class="num" id="2971409">1</span><span class="op" id="2971410">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971420">case</span>&nbsp;<span class="string" id="2971425">&#34;options&#34;</span><span class="op" id="2971434">:</span>&nbsp;<span class="comment" id="2971436">//&nbsp;magic&nbsp;options</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971456">for</span>&nbsp;<span class="ident" id="2971460">i</span>&nbsp;<span class="op" id="2971462">:=</span>&nbsp;<span class="num" id="2971465">1</span><span class="op" id="2971466">;</span>&nbsp;<span class="ident" id="2971468">i</span>&nbsp;<span class="op" id="2971470">&lt;</span>&nbsp;<span class="builtinfunc" id="2971472">len</span><span class="op" id="2971475">(</span><span class="ident" id="2971476">f</span><span class="op" id="2971477">)</span><span class="op" id="2971478">;</span>&nbsp;<span class="ident" id="2971480">i</span><span class="op" id="2971481">++</span>&nbsp;<span class="op" id="2971484">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971490">s</span>&nbsp;<span class="op" id="2971492">:=</span>&nbsp;<span class="ident" id="2971495">f</span><span class="op" id="2971496">[</span><span class="ident" id="2971497">i</span><span class="op" id="2971498">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971504">switch</span>&nbsp;<span class="op" id="2971511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971517">case</span>&nbsp;<span class="ident" id="2971522">hasPrefix</span><span class="op" id="2971531">(</span><span class="ident" id="2971532">s</span><span class="op" id="2971533">,</span>&nbsp;<span class="string" id="2971535">&#34;ndots:&#34;</span><span class="op" id="2971543">)</span><span class="op" id="2971544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971551">n</span><span class="op" id="2971552">,</span>&nbsp;<span class="ident" id="2971554">_</span><span class="op" id="2971555">,</span>&nbsp;<span class="ident" id="2971557">_</span>&nbsp;<span class="op" id="2971559">:=</span>&nbsp;<span class="ident" id="2971562">dtoi</span><span class="op" id="2971566">(</span><span class="ident" id="2971567">s</span><span class="op" id="2971568">,</span>&nbsp;<span class="num" id="2971570">6</span><span class="op" id="2971571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971578">if</span>&nbsp;<span class="ident" id="2971581">n</span>&nbsp;<span class="op" id="2971583">&lt;</span>&nbsp;<span class="num" id="2971585">1</span>&nbsp;<span class="op" id="2971587">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971595">n</span>&nbsp;<span class="op" id="2971597">=</span>&nbsp;<span class="num" id="2971599">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971613">conf</span><span class="op" id="2971617">.</span><span class="ident" id="2971618">ndots</span>&nbsp;<span class="op" id="2971624">=</span>&nbsp;<span class="ident" id="2971626">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971632">case</span>&nbsp;<span class="ident" id="2971637">hasPrefix</span><span class="op" id="2971646">(</span><span class="ident" id="2971647">s</span><span class="op" id="2971648">,</span>&nbsp;<span class="string" id="2971650">&#34;timeout:&#34;</span><span class="op" id="2971660">)</span><span class="op" id="2971661">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971668">n</span><span class="op" id="2971669">,</span>&nbsp;<span class="ident" id="2971671">_</span><span class="op" id="2971672">,</span>&nbsp;<span class="ident" id="2971674">_</span>&nbsp;<span class="op" id="2971676">:=</span>&nbsp;<span class="ident" id="2971679">dtoi</span><span class="op" id="2971683">(</span><span class="ident" id="2971684">s</span><span class="op" id="2971685">,</span>&nbsp;<span class="num" id="2971687">8</span><span class="op" id="2971688">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971695">if</span>&nbsp;<span class="ident" id="2971698">n</span>&nbsp;<span class="op" id="2971700">&lt;</span>&nbsp;<span class="num" id="2971702">1</span>&nbsp;<span class="op" id="2971704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971712">n</span>&nbsp;<span class="op" id="2971714">=</span>&nbsp;<span class="num" id="2971716">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971730">conf</span><span class="op" id="2971734">.</span><span class="ident" id="2971735">timeout</span>&nbsp;<span class="op" id="2971743">=</span>&nbsp;<span class="ident" id="2971745">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971751">case</span>&nbsp;<span class="ident" id="2971756">hasPrefix</span><span class="op" id="2971765">(</span><span class="ident" id="2971766">s</span><span class="op" id="2971767">,</span>&nbsp;<span class="string" id="2971769">&#34;attempts:&#34;</span><span class="op" id="2971780">)</span><span class="op" id="2971781">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971788">n</span><span class="op" id="2971789">,</span>&nbsp;<span class="ident" id="2971791">_</span><span class="op" id="2971792">,</span>&nbsp;<span class="ident" id="2971794">_</span>&nbsp;<span class="op" id="2971796">:=</span>&nbsp;<span class="ident" id="2971799">dtoi</span><span class="op" id="2971803">(</span><span class="ident" id="2971804">s</span><span class="op" id="2971805">,</span>&nbsp;<span class="num" id="2971807">9</span><span class="op" id="2971808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971815">if</span>&nbsp;<span class="ident" id="2971818">n</span>&nbsp;<span class="op" id="2971820">&lt;</span>&nbsp;<span class="num" id="2971822">1</span>&nbsp;<span class="op" id="2971824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971832">n</span>&nbsp;<span class="op" id="2971834">=</span>&nbsp;<span class="num" id="2971836">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971850">conf</span><span class="op" id="2971854">.</span><span class="ident" id="2971855">attempts</span>&nbsp;<span class="op" id="2971864">=</span>&nbsp;<span class="ident" id="2971866">n</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971872">case</span>&nbsp;<span class="ident" id="2971877">s</span>&nbsp;<span class="op" id="2971879">==</span>&nbsp;<span class="string" id="2971882">&#34;rotate&#34;</span><span class="op" id="2971890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2971897">conf</span><span class="op" id="2971901">.</span><span class="ident" id="2971902">rotate</span>&nbsp;<span class="op" id="2971909">=</span>&nbsp;<span class="builtintype" id="2971911">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971929">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971935">return</span>&nbsp;<span class="ident" id="2971942">conf</span><span class="op" id="2971946">,</span>&nbsp;<span class="ident" id="2971948">nil</span><br>
<span class="lineno"></span><span class="op" id="2971952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2971955">func</span>&nbsp;<span class="ident" id="2971960">hasPrefix</span><span class="op" id="2971969">(</span><span class="ident" id="2971970">s</span><span class="op" id="2971971">,</span>&nbsp;<span class="ident" id="2971973">prefix</span>&nbsp;<span class="builtintype" id="2971980">string</span><span class="op" id="2971986">)</span>&nbsp;<span class="builtintype" id="2971988">bool</span>&nbsp;<span class="op" id="2971993">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971996">return</span>&nbsp;<span class="builtinfunc" id="2972003">len</span><span class="op" id="2972006">(</span><span class="ident" id="2972007">s</span><span class="op" id="2972008">)</span>&nbsp;<span class="op" id="2972010">&gt;=</span>&nbsp;<span class="builtinfunc" id="2972013">len</span><span class="op" id="2972016">(</span><span class="ident" id="2972017">prefix</span><span class="op" id="2972023">)</span>&nbsp;<span class="op" id="2972025">&amp;&amp;</span>&nbsp;<span class="ident" id="2972028">s</span><span class="op" id="2972029">[</span><span class="op" id="2972030">:</span><span class="builtinfunc" id="2972031">len</span><span class="op" id="2972034">(</span><span class="ident" id="2972035">prefix</span><span class="op" id="2972041">)</span><span class="op" id="2972042">]</span>&nbsp;<span class="op" id="2972044">==</span>&nbsp;<span class="ident" id="2972047">prefix</span><br>
<span class="lineno"></span><span class="op" id="2972054">}</span>
</div>
</body>
</html>
