<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6016392">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6016447">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6016501">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6016552">package</span>&nbsp;<span class="ident" id="6016560">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6016565">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="6016584">//&nbsp;&nbsp;&nbsp;-&nbsp;pax&nbsp;extensions</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6016607">import</span>&nbsp;<span class="op" id="6016614">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016617">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016626">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016636">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016642">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016655">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016661">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016672">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6016683">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6016690">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6016693">var</span>&nbsp;<span class="op" id="6016697">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016700">ErrHeader</span>&nbsp;<span class="op" id="6016710">=</span>&nbsp;<span class="ident" id="6016712">errors</span><span class="op" id="6016718">.</span><span class="ident" id="6016719">New</span><span class="op" id="6016722">(</span><span class="string" id="6016723">&#34;archive/tar:&nbsp;invalid&nbsp;tar&nbsp;header&#34;</span><span class="op" id="6016756">)</span><br>
<span class="lineno"></span><span class="op" id="6016758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6016761">const</span>&nbsp;<span class="ident" id="6016767">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="6016788">=</span>&nbsp;<span class="num" id="6016790">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6016793">//&nbsp;A&nbsp;Reader&nbsp;provides&nbsp;sequential&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="6016866">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="6016916">//&nbsp;The&nbsp;Next&nbsp;method&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;file&nbsp;in&nbsp;the&nbsp;archive&nbsp;(including&nbsp;the&nbsp;first),</span><br>
<span class="lineno">30</span><span class="comment" id="6016999">//&nbsp;and&nbsp;then&nbsp;it&nbsp;can&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;io.Reader&nbsp;to&nbsp;access&nbsp;the&nbsp;file&#39;s&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6017072">type</span>&nbsp;<span class="ident" id="6017077">Reader</span>&nbsp;<span class="keyword" id="6017084">struct</span>&nbsp;<span class="op" id="6017091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017094">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6017102">io</span><span class="op" id="6017104">.</span><span class="ident" id="6017105">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017113">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6017121">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017128">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6017136">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6017152">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;(ignored)&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017209">curr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6017217">numBytesReader</span>&nbsp;&nbsp;<span class="comment" id="6017233">//&nbsp;reader&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017267">hdrBuff</span>&nbsp;<span class="op" id="6017275">[</span><span class="ident" id="6017276">blockSize</span><span class="op" id="6017285">]</span><span class="builtintype" id="6017286">byte</span>&nbsp;<span class="comment" id="6017291">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;readHeader</span><br>
<span class="lineno"></span><span class="op" id="6017322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6017325">//&nbsp;A&nbsp;numBytesReader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;with&nbsp;a&nbsp;numBytes&nbsp;method,&nbsp;returning&nbsp;the&nbsp;number</span><br>
<span class="lineno">40</span><span class="comment" id="6017406">//&nbsp;of&nbsp;bytes&nbsp;remaining&nbsp;in&nbsp;the&nbsp;underlying&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6017460">type</span>&nbsp;<span class="ident" id="6017465">numBytesReader</span>&nbsp;<span class="keyword" id="6017480">interface</span>&nbsp;<span class="op" id="6017490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017493">io</span><span class="op" id="6017495">.</span><span class="ident" id="6017496">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017504">numBytes</span><span class="op" id="6017512">(</span><span class="op" id="6017513">)</span>&nbsp;<span class="ident" id="6017515">int64</span><br>
<span class="lineno"></span><span class="op" id="6017521">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6017524">//&nbsp;A&nbsp;regFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6017605">type</span>&nbsp;<span class="ident" id="6017610">regFileReader</span>&nbsp;<span class="keyword" id="6017624">struct</span>&nbsp;<span class="op" id="6017631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017634">r</span>&nbsp;&nbsp;<span class="ident" id="6017637">io</span><span class="op" id="6017639">.</span><span class="ident" id="6017640">Reader</span>&nbsp;<span class="comment" id="6017647">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017669">nb</span>&nbsp;<span class="ident" id="6017672">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6017682">//&nbsp;number&nbsp;of&nbsp;unread&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">50</span><span class="op" id="6017731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6017734">//&nbsp;A&nbsp;sparseFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;sparse&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6017825">type</span>&nbsp;<span class="ident" id="6017830">sparseFileReader</span>&nbsp;<span class="keyword" id="6017847">struct</span>&nbsp;<span class="op" id="6017854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017857">rfr</span>&nbsp;<span class="op" id="6017861">*</span><span class="ident" id="6017862">regFileReader</span>&nbsp;<span class="comment" id="6017876">//&nbsp;reads&nbsp;the&nbsp;sparse-encoded&nbsp;file&nbsp;data</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017915">sp</span>&nbsp;&nbsp;<span class="op" id="6017919">[</span><span class="op" id="6017920">]</span><span class="ident" id="6017921">sparseEntry</span>&nbsp;&nbsp;<span class="comment" id="6017934">//&nbsp;the&nbsp;sparse&nbsp;map&nbsp;for&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017966">pos</span>&nbsp;<span class="ident" id="6017970">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6017985">//&nbsp;keeps&nbsp;track&nbsp;of&nbsp;file&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018018">tot</span>&nbsp;<span class="ident" id="6018022">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6018037">//&nbsp;total&nbsp;size&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="6018063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6018066">//&nbsp;Keywords&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;files&nbsp;in&nbsp;a&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="6018124">const</span>&nbsp;<span class="op" id="6018130">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018133">paxGNUSparseNumBlocks</span>&nbsp;<span class="op" id="6018155">=</span>&nbsp;<span class="string" id="6018157">&#34;GNU.sparse.numblocks&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018181">paxGNUSparseOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018203">=</span>&nbsp;<span class="string" id="6018205">&#34;GNU.sparse.offset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018226">paxGNUSparseNumBytes</span>&nbsp;&nbsp;<span class="op" id="6018248">=</span>&nbsp;<span class="string" id="6018250">&#34;GNU.sparse.numbytes&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018273">paxGNUSparseMap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018295">=</span>&nbsp;<span class="string" id="6018297">&#34;GNU.sparse.map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018315">paxGNUSparseName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018337">=</span>&nbsp;<span class="string" id="6018339">&#34;GNU.sparse.name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018358">paxGNUSparseMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018380">=</span>&nbsp;<span class="string" id="6018382">&#34;GNU.sparse.major&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018402">paxGNUSparseMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018424">=</span>&nbsp;<span class="string" id="6018426">&#34;GNU.sparse.minor&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018446">paxGNUSparseSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018468">=</span>&nbsp;<span class="string" id="6018470">&#34;GNU.sparse.size&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018489">paxGNUSparseRealSize</span>&nbsp;&nbsp;<span class="op" id="6018511">=</span>&nbsp;<span class="string" id="6018513">&#34;GNU.sparse.realsize&#34;</span><br>
<span class="lineno"></span><span class="op" id="6018535">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6018538">//&nbsp;Keywords&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;headers</span><br>
<span class="lineno"></span><span class="keyword" id="6018577">const</span>&nbsp;<span class="op" id="6018583">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018586">oldGNUSparseMainHeaderOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018629">=</span>&nbsp;<span class="num" id="6018631">386</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018636">oldGNUSparseMainHeaderIsExtendedOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018679">=</span>&nbsp;<span class="num" id="6018681">482</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018686">oldGNUSparseMainHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018729">=</span>&nbsp;<span class="num" id="6018731">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018734">oldGNUSparseExtendedHeaderIsExtendedOffset</span>&nbsp;<span class="op" id="6018777">=</span>&nbsp;<span class="num" id="6018779">504</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018784">oldGNUSparseExtendedHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018827">=</span>&nbsp;<span class="num" id="6018829">21</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018833">oldGNUSparseOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018876">=</span>&nbsp;<span class="num" id="6018878">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018882">oldGNUSparseNumBytesSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018925">=</span>&nbsp;<span class="num" id="6018927">12</span><br>
<span class="lineno"></span><span class="op" id="6018930">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6018933">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno">85</span><span class="keyword" id="6018983">func</span>&nbsp;<span class="ident" id="6018988">NewReader</span><span class="op" id="6018997">(</span><span class="ident" id="6018998">r</span>&nbsp;<span class="ident" id="6019000">io</span><span class="op" id="6019002">.</span><span class="ident" id="6019003">Reader</span><span class="op" id="6019009">)</span>&nbsp;<span class="op" id="6019011">*</span><span class="ident" id="6019012">Reader</span>&nbsp;<span class="op" id="6019019">{</span>&nbsp;<span class="keyword" id="6019021">return</span>&nbsp;<span class="op" id="6019028">&amp;</span><span class="ident" id="6019029">Reader</span><span class="op" id="6019035">{</span><span class="ident" id="6019036">r</span><span class="op" id="6019037">:</span>&nbsp;<span class="ident" id="6019039">r</span><span class="op" id="6019040">}</span>&nbsp;<span class="op" id="6019042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6019045">//&nbsp;Next&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6019100">func</span>&nbsp;<span class="op" id="6019105">(</span><span class="ident" id="6019106">tr</span>&nbsp;<span class="op" id="6019109">*</span><span class="ident" id="6019110">Reader</span><span class="op" id="6019116">)</span>&nbsp;<span class="ident" id="6019118">Next</span><span class="op" id="6019122">(</span><span class="op" id="6019123">)</span>&nbsp;<span class="op" id="6019125">(</span><span class="op" id="6019126">*</span><span class="ident" id="6019127">Header</span><span class="op" id="6019133">,</span>&nbsp;<span class="builtintype" id="6019135">error</span><span class="op" id="6019140">)</span>&nbsp;<span class="op" id="6019142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019145">var</span>&nbsp;<span class="ident" id="6019149">hdr</span>&nbsp;<span class="op" id="6019153">*</span><span class="ident" id="6019154">Header</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019162">if</span>&nbsp;<span class="ident" id="6019165">tr</span><span class="op" id="6019167">.</span><span class="ident" id="6019168">err</span>&nbsp;<span class="op" id="6019172">==</span>&nbsp;<span class="ident" id="6019175">nil</span>&nbsp;<span class="op" id="6019179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019183">tr</span><span class="op" id="6019185">.</span><span class="ident" id="6019186">skipUnread</span><span class="op" id="6019196">(</span><span class="op" id="6019197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019203">if</span>&nbsp;<span class="ident" id="6019206">tr</span><span class="op" id="6019208">.</span><span class="ident" id="6019209">err</span>&nbsp;<span class="op" id="6019213">!=</span>&nbsp;<span class="ident" id="6019216">nil</span>&nbsp;<span class="op" id="6019220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019224">return</span>&nbsp;<span class="ident" id="6019231">hdr</span><span class="op" id="6019234">,</span>&nbsp;<span class="ident" id="6019236">tr</span><span class="op" id="6019238">.</span><span class="ident" id="6019239">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019247">hdr</span>&nbsp;<span class="op" id="6019251">=</span>&nbsp;<span class="ident" id="6019253">tr</span><span class="op" id="6019255">.</span><span class="ident" id="6019256">readHeader</span><span class="op" id="6019266">(</span><span class="op" id="6019267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019270">if</span>&nbsp;<span class="ident" id="6019273">hdr</span>&nbsp;<span class="op" id="6019277">==</span>&nbsp;<span class="ident" id="6019280">nil</span>&nbsp;<span class="op" id="6019284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019288">return</span>&nbsp;<span class="ident" id="6019295">hdr</span><span class="op" id="6019298">,</span>&nbsp;<span class="ident" id="6019300">tr</span><span class="op" id="6019302">.</span><span class="ident" id="6019303">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019308">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019311">//&nbsp;Check&nbsp;for&nbsp;PAX/GNU&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019341">switch</span>&nbsp;<span class="ident" id="6019348">hdr</span><span class="op" id="6019351">.</span><span class="ident" id="6019352">Typeflag</span>&nbsp;<span class="op" id="6019361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019364">case</span>&nbsp;<span class="ident" id="6019369">TypeXHeader</span><span class="op" id="6019380">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019384">//&nbsp;&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019410">headers</span><span class="op" id="6019417">,</span>&nbsp;<span class="ident" id="6019419">err</span>&nbsp;<span class="op" id="6019423">:=</span>&nbsp;<span class="ident" id="6019426">parsePAX</span><span class="op" id="6019434">(</span><span class="ident" id="6019435">tr</span><span class="op" id="6019437">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019441">if</span>&nbsp;<span class="ident" id="6019444">err</span>&nbsp;<span class="op" id="6019448">!=</span>&nbsp;<span class="ident" id="6019451">nil</span>&nbsp;<span class="op" id="6019455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019460">return</span>&nbsp;<span class="ident" id="6019467">nil</span><span class="op" id="6019470">,</span>&nbsp;<span class="ident" id="6019472">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019482">//&nbsp;We&nbsp;actually&nbsp;read&nbsp;the&nbsp;whole&nbsp;file,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019520">//&nbsp;but&nbsp;this&nbsp;skips&nbsp;alignment&nbsp;padding</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019558">tr</span><span class="op" id="6019560">.</span><span class="ident" id="6019561">skipUnread</span><span class="op" id="6019571">(</span><span class="op" id="6019572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019576">hdr</span>&nbsp;<span class="op" id="6019580">=</span>&nbsp;<span class="ident" id="6019582">tr</span><span class="op" id="6019584">.</span><span class="ident" id="6019585">readHeader</span><span class="op" id="6019595">(</span><span class="op" id="6019596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019600">mergePAX</span><span class="op" id="6019608">(</span><span class="ident" id="6019609">hdr</span><span class="op" id="6019612">,</span>&nbsp;<span class="ident" id="6019614">headers</span><span class="op" id="6019621">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019626">//&nbsp;Check&nbsp;for&nbsp;a&nbsp;PAX&nbsp;format&nbsp;sparse&nbsp;file</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019666">sp</span><span class="op" id="6019668">,</span>&nbsp;<span class="ident" id="6019670">err</span>&nbsp;<span class="op" id="6019674">:=</span>&nbsp;<span class="ident" id="6019677">tr</span><span class="op" id="6019679">.</span><span class="ident" id="6019680">checkForGNUSparsePAXHeaders</span><span class="op" id="6019707">(</span><span class="ident" id="6019708">hdr</span><span class="op" id="6019711">,</span>&nbsp;<span class="ident" id="6019713">headers</span><span class="op" id="6019720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019724">if</span>&nbsp;<span class="ident" id="6019727">err</span>&nbsp;<span class="op" id="6019731">!=</span>&nbsp;<span class="ident" id="6019734">nil</span>&nbsp;<span class="op" id="6019738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019743">tr</span><span class="op" id="6019745">.</span><span class="ident" id="6019746">err</span>&nbsp;<span class="op" id="6019750">=</span>&nbsp;<span class="ident" id="6019752">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019759">return</span>&nbsp;<span class="ident" id="6019766">nil</span><span class="op" id="6019769">,</span>&nbsp;<span class="ident" id="6019771">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019777">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019781">if</span>&nbsp;<span class="ident" id="6019784">sp</span>&nbsp;<span class="op" id="6019787">!=</span>&nbsp;<span class="ident" id="6019790">nil</span>&nbsp;<span class="op" id="6019794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019799">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019851">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader&nbsp;to&nbsp;a&nbsp;sparse&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019910">tr</span><span class="op" id="6019912">.</span><span class="ident" id="6019913">curr</span>&nbsp;<span class="op" id="6019918">=</span>&nbsp;<span class="op" id="6019920">&amp;</span><span class="ident" id="6019921">sparseFileReader</span><span class="op" id="6019937">{</span><span class="ident" id="6019938">rfr</span><span class="op" id="6019941">:</span>&nbsp;<span class="ident" id="6019943">tr</span><span class="op" id="6019945">.</span><span class="ident" id="6019946">curr</span><span class="op" id="6019950">.</span><span class="op" id="6019951">(</span><span class="op" id="6019952">*</span><span class="ident" id="6019953">regFileReader</span><span class="op" id="6019966">)</span><span class="op" id="6019967">,</span>&nbsp;<span class="ident" id="6019969">sp</span><span class="op" id="6019971">:</span>&nbsp;<span class="ident" id="6019973">sp</span><span class="op" id="6019975">,</span>&nbsp;<span class="ident" id="6019977">tot</span><span class="op" id="6019980">:</span>&nbsp;<span class="ident" id="6019982">hdr</span><span class="op" id="6019985">.</span><span class="ident" id="6019986">Size</span><span class="op" id="6019990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019994">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019998">return</span>&nbsp;<span class="ident" id="6020005">hdr</span><span class="op" id="6020008">,</span>&nbsp;<span class="ident" id="6020010">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020015">case</span>&nbsp;<span class="ident" id="6020020">TypeGNULongName</span><span class="op" id="6020035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020039">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;name&nbsp;header.&nbsp;Its&nbsp;contents&nbsp;are&nbsp;the&nbsp;real&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020113">realname</span><span class="op" id="6020121">,</span>&nbsp;<span class="ident" id="6020123">err</span>&nbsp;<span class="op" id="6020127">:=</span>&nbsp;<span class="ident" id="6020130">ioutil</span><span class="op" id="6020136">.</span><span class="ident" id="6020137">ReadAll</span><span class="op" id="6020144">(</span><span class="ident" id="6020145">tr</span><span class="op" id="6020147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020151">if</span>&nbsp;<span class="ident" id="6020154">err</span>&nbsp;<span class="op" id="6020158">!=</span>&nbsp;<span class="ident" id="6020161">nil</span>&nbsp;<span class="op" id="6020165">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020170">return</span>&nbsp;<span class="ident" id="6020177">nil</span><span class="op" id="6020180">,</span>&nbsp;<span class="ident" id="6020182">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020192">hdr</span><span class="op" id="6020195">,</span>&nbsp;<span class="ident" id="6020197">err</span>&nbsp;<span class="op" id="6020201">:=</span>&nbsp;<span class="ident" id="6020204">tr</span><span class="op" id="6020206">.</span><span class="ident" id="6020207">Next</span><span class="op" id="6020211">(</span><span class="op" id="6020212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020216">hdr</span><span class="op" id="6020219">.</span><span class="ident" id="6020220">Name</span>&nbsp;<span class="op" id="6020225">=</span>&nbsp;<span class="ident" id="6020227">cString</span><span class="op" id="6020234">(</span><span class="ident" id="6020235">realname</span><span class="op" id="6020243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020247">return</span>&nbsp;<span class="ident" id="6020254">hdr</span><span class="op" id="6020257">,</span>&nbsp;<span class="ident" id="6020259">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020264">case</span>&nbsp;<span class="ident" id="6020269">TypeGNULongLink</span><span class="op" id="6020284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020288">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;link&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020325">realname</span><span class="op" id="6020333">,</span>&nbsp;<span class="ident" id="6020335">err</span>&nbsp;<span class="op" id="6020339">:=</span>&nbsp;<span class="ident" id="6020342">ioutil</span><span class="op" id="6020348">.</span><span class="ident" id="6020349">ReadAll</span><span class="op" id="6020356">(</span><span class="ident" id="6020357">tr</span><span class="op" id="6020359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020363">if</span>&nbsp;<span class="ident" id="6020366">err</span>&nbsp;<span class="op" id="6020370">!=</span>&nbsp;<span class="ident" id="6020373">nil</span>&nbsp;<span class="op" id="6020377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020382">return</span>&nbsp;<span class="ident" id="6020389">nil</span><span class="op" id="6020392">,</span>&nbsp;<span class="ident" id="6020394">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020404">hdr</span><span class="op" id="6020407">,</span>&nbsp;<span class="ident" id="6020409">err</span>&nbsp;<span class="op" id="6020413">:=</span>&nbsp;<span class="ident" id="6020416">tr</span><span class="op" id="6020418">.</span><span class="ident" id="6020419">Next</span><span class="op" id="6020423">(</span><span class="op" id="6020424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020428">hdr</span><span class="op" id="6020431">.</span><span class="ident" id="6020432">Linkname</span>&nbsp;<span class="op" id="6020441">=</span>&nbsp;<span class="ident" id="6020443">cString</span><span class="op" id="6020450">(</span><span class="ident" id="6020451">realname</span><span class="op" id="6020459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020463">return</span>&nbsp;<span class="ident" id="6020470">hdr</span><span class="op" id="6020473">,</span>&nbsp;<span class="ident" id="6020475">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020480">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020483">return</span>&nbsp;<span class="ident" id="6020490">hdr</span><span class="op" id="6020493">,</span>&nbsp;<span class="ident" id="6020495">tr</span><span class="op" id="6020497">.</span><span class="ident" id="6020498">err</span><br>
<span class="lineno"></span><span class="op" id="6020502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6020505">//&nbsp;checkForGNUSparsePAXHeaders&nbsp;checks&nbsp;the&nbsp;PAX&nbsp;headers&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;headers.&nbsp;If&nbsp;they&nbsp;are&nbsp;found,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="6020607">//&nbsp;this&nbsp;function&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;and&nbsp;returns&nbsp;it.&nbsp;Unknown&nbsp;sparse&nbsp;formats&nbsp;are&nbsp;ignored,&nbsp;causing&nbsp;the&nbsp;file&nbsp;to</span><br>
<span class="lineno">150</span><span class="comment" id="6020717">//&nbsp;be&nbsp;treated&nbsp;as&nbsp;a&nbsp;regular&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6020750">func</span>&nbsp;<span class="op" id="6020755">(</span><span class="ident" id="6020756">tr</span>&nbsp;<span class="op" id="6020759">*</span><span class="ident" id="6020760">Reader</span><span class="op" id="6020766">)</span>&nbsp;<span class="ident" id="6020768">checkForGNUSparsePAXHeaders</span><span class="op" id="6020795">(</span><span class="ident" id="6020796">hdr</span>&nbsp;<span class="op" id="6020800">*</span><span class="ident" id="6020801">Header</span><span class="op" id="6020807">,</span>&nbsp;<span class="ident" id="6020809">headers</span>&nbsp;<span class="keyword" id="6020817">map</span><span class="op" id="6020820">[</span><span class="builtintype" id="6020821">string</span><span class="op" id="6020827">]</span><span class="builtintype" id="6020828">string</span><span class="op" id="6020834">)</span>&nbsp;<span class="op" id="6020836">(</span><span class="op" id="6020837">[</span><span class="op" id="6020838">]</span><span class="ident" id="6020839">sparseEntry</span><span class="op" id="6020850">,</span>&nbsp;<span class="builtintype" id="6020852">error</span><span class="op" id="6020857">)</span>&nbsp;<span class="op" id="6020859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020862">var</span>&nbsp;<span class="ident" id="6020866">sparseFormat</span>&nbsp;<span class="builtintype" id="6020879">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020888">//&nbsp;Check&nbsp;for&nbsp;sparse&nbsp;format&nbsp;indicators</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020927">major</span><span class="op" id="6020932">,</span>&nbsp;<span class="ident" id="6020934">majorOk</span>&nbsp;<span class="op" id="6020942">:=</span>&nbsp;<span class="ident" id="6020945">headers</span><span class="op" id="6020952">[</span><span class="ident" id="6020953">paxGNUSparseMajor</span><span class="op" id="6020970">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020973">minor</span><span class="op" id="6020978">,</span>&nbsp;<span class="ident" id="6020980">minorOk</span>&nbsp;<span class="op" id="6020988">:=</span>&nbsp;<span class="ident" id="6020991">headers</span><span class="op" id="6020998">[</span><span class="ident" id="6020999">paxGNUSparseMinor</span><span class="op" id="6021016">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021019">sparseName</span><span class="op" id="6021029">,</span>&nbsp;<span class="ident" id="6021031">sparseNameOk</span>&nbsp;<span class="op" id="6021044">:=</span>&nbsp;<span class="ident" id="6021047">headers</span><span class="op" id="6021054">[</span><span class="ident" id="6021055">paxGNUSparseName</span><span class="op" id="6021071">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021074">_</span><span class="op" id="6021075">,</span>&nbsp;<span class="ident" id="6021077">sparseMapOk</span>&nbsp;<span class="op" id="6021089">:=</span>&nbsp;<span class="ident" id="6021092">headers</span><span class="op" id="6021099">[</span><span class="ident" id="6021100">paxGNUSparseMap</span><span class="op" id="6021115">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021118">sparseSize</span><span class="op" id="6021128">,</span>&nbsp;<span class="ident" id="6021130">sparseSizeOk</span>&nbsp;<span class="op" id="6021143">:=</span>&nbsp;<span class="ident" id="6021146">headers</span><span class="op" id="6021153">[</span><span class="ident" id="6021154">paxGNUSparseSize</span><span class="op" id="6021170">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021173">sparseRealSize</span><span class="op" id="6021187">,</span>&nbsp;<span class="ident" id="6021189">sparseRealSizeOk</span>&nbsp;<span class="op" id="6021206">:=</span>&nbsp;<span class="ident" id="6021209">headers</span><span class="op" id="6021216">[</span><span class="ident" id="6021217">paxGNUSparseRealSize</span><span class="op" id="6021237">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021241">//&nbsp;Identify&nbsp;which,&nbsp;if&nbsp;any,&nbsp;sparse&nbsp;format&nbsp;applies&nbsp;from&nbsp;which&nbsp;PAX&nbsp;headers&nbsp;are&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021322">if</span>&nbsp;<span class="ident" id="6021325">majorOk</span>&nbsp;<span class="op" id="6021333">&amp;&amp;</span>&nbsp;<span class="ident" id="6021336">minorOk</span>&nbsp;<span class="op" id="6021344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021348">sparseFormat</span>&nbsp;<span class="op" id="6021361">=</span>&nbsp;<span class="ident" id="6021363">major</span>&nbsp;<span class="op" id="6021369">+</span>&nbsp;<span class="string" id="6021371">&#34;.&#34;</span>&nbsp;<span class="op" id="6021375">+</span>&nbsp;<span class="ident" id="6021377">minor</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021384">}</span>&nbsp;<span class="keyword" id="6021386">else</span>&nbsp;<span class="keyword" id="6021391">if</span>&nbsp;<span class="ident" id="6021394">sparseNameOk</span>&nbsp;<span class="op" id="6021407">&amp;&amp;</span>&nbsp;<span class="ident" id="6021410">sparseMapOk</span>&nbsp;<span class="op" id="6021422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021426">sparseFormat</span>&nbsp;<span class="op" id="6021439">=</span>&nbsp;<span class="string" id="6021441">&#34;0.1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021448">}</span>&nbsp;<span class="keyword" id="6021450">else</span>&nbsp;<span class="keyword" id="6021455">if</span>&nbsp;<span class="ident" id="6021458">sparseSizeOk</span>&nbsp;<span class="op" id="6021471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021475">sparseFormat</span>&nbsp;<span class="op" id="6021488">=</span>&nbsp;<span class="string" id="6021490">&#34;0.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021497">}</span>&nbsp;<span class="keyword" id="6021499">else</span>&nbsp;<span class="op" id="6021504">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021508">//&nbsp;Not&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021547">return</span>&nbsp;<span class="ident" id="6021554">nil</span><span class="op" id="6021557">,</span>&nbsp;<span class="ident" id="6021559">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021568">//&nbsp;Check&nbsp;for&nbsp;unknown&nbsp;sparse&nbsp;format</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021604">if</span>&nbsp;<span class="ident" id="6021607">sparseFormat</span>&nbsp;<span class="op" id="6021620">!=</span>&nbsp;<span class="string" id="6021623">&#34;0.0&#34;</span>&nbsp;<span class="op" id="6021629">&amp;&amp;</span>&nbsp;<span class="ident" id="6021632">sparseFormat</span>&nbsp;<span class="op" id="6021645">!=</span>&nbsp;<span class="string" id="6021648">&#34;0.1&#34;</span>&nbsp;<span class="op" id="6021654">&amp;&amp;</span>&nbsp;<span class="ident" id="6021657">sparseFormat</span>&nbsp;<span class="op" id="6021670">!=</span>&nbsp;<span class="string" id="6021673">&#34;1.0&#34;</span>&nbsp;<span class="op" id="6021679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021683">return</span>&nbsp;<span class="ident" id="6021690">nil</span><span class="op" id="6021693">,</span>&nbsp;<span class="ident" id="6021695">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021704">//&nbsp;Update&nbsp;hdr&nbsp;from&nbsp;GNU&nbsp;sparse&nbsp;PAX&nbsp;headers</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021747">if</span>&nbsp;<span class="ident" id="6021750">sparseNameOk</span>&nbsp;<span class="op" id="6021763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021767">hdr</span><span class="op" id="6021770">.</span><span class="ident" id="6021771">Name</span>&nbsp;<span class="op" id="6021776">=</span>&nbsp;<span class="ident" id="6021778">sparseName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021793">if</span>&nbsp;<span class="ident" id="6021796">sparseSizeOk</span>&nbsp;<span class="op" id="6021809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021813">realSize</span><span class="op" id="6021821">,</span>&nbsp;<span class="ident" id="6021823">err</span>&nbsp;<span class="op" id="6021827">:=</span>&nbsp;<span class="ident" id="6021830">strconv</span><span class="op" id="6021837">.</span><span class="ident" id="6021838">ParseInt</span><span class="op" id="6021846">(</span><span class="ident" id="6021847">sparseSize</span><span class="op" id="6021857">,</span>&nbsp;<span class="num" id="6021859">10</span><span class="op" id="6021861">,</span>&nbsp;<span class="num" id="6021863">0</span><span class="op" id="6021864">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021868">if</span>&nbsp;<span class="ident" id="6021871">err</span>&nbsp;<span class="op" id="6021875">!=</span>&nbsp;<span class="ident" id="6021878">nil</span>&nbsp;<span class="op" id="6021882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021887">return</span>&nbsp;<span class="ident" id="6021894">nil</span><span class="op" id="6021897">,</span>&nbsp;<span class="ident" id="6021899">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021915">hdr</span><span class="op" id="6021918">.</span><span class="ident" id="6021919">Size</span>&nbsp;<span class="op" id="6021924">=</span>&nbsp;<span class="ident" id="6021926">realSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021936">}</span>&nbsp;<span class="keyword" id="6021938">else</span>&nbsp;<span class="keyword" id="6021943">if</span>&nbsp;<span class="ident" id="6021946">sparseRealSizeOk</span>&nbsp;<span class="op" id="6021963">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021967">realSize</span><span class="op" id="6021975">,</span>&nbsp;<span class="ident" id="6021977">err</span>&nbsp;<span class="op" id="6021981">:=</span>&nbsp;<span class="ident" id="6021984">strconv</span><span class="op" id="6021991">.</span><span class="ident" id="6021992">ParseInt</span><span class="op" id="6022000">(</span><span class="ident" id="6022001">sparseRealSize</span><span class="op" id="6022015">,</span>&nbsp;<span class="num" id="6022017">10</span><span class="op" id="6022019">,</span>&nbsp;<span class="num" id="6022021">0</span><span class="op" id="6022022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022026">if</span>&nbsp;<span class="ident" id="6022029">err</span>&nbsp;<span class="op" id="6022033">!=</span>&nbsp;<span class="ident" id="6022036">nil</span>&nbsp;<span class="op" id="6022040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022045">return</span>&nbsp;<span class="ident" id="6022052">nil</span><span class="op" id="6022055">,</span>&nbsp;<span class="ident" id="6022057">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022073">hdr</span><span class="op" id="6022076">.</span><span class="ident" id="6022077">Size</span>&nbsp;<span class="op" id="6022082">=</span>&nbsp;<span class="ident" id="6022084">realSize</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022098">//&nbsp;Set&nbsp;up&nbsp;the&nbsp;sparse&nbsp;map,&nbsp;according&nbsp;to&nbsp;the&nbsp;particular&nbsp;sparse&nbsp;format&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022174">var</span>&nbsp;<span class="ident" id="6022178">sp</span>&nbsp;<span class="op" id="6022181">[</span><span class="op" id="6022182">]</span><span class="ident" id="6022183">sparseEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022196">var</span>&nbsp;<span class="ident" id="6022200">err</span>&nbsp;<span class="builtintype" id="6022204">error</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022211">switch</span>&nbsp;<span class="ident" id="6022218">sparseFormat</span>&nbsp;<span class="op" id="6022231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022234">case</span>&nbsp;<span class="string" id="6022239">&#34;0.0&#34;</span><span class="op" id="6022244">,</span>&nbsp;<span class="string" id="6022246">&#34;0.1&#34;</span><span class="op" id="6022251">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022255">sp</span><span class="op" id="6022257">,</span>&nbsp;<span class="ident" id="6022259">err</span>&nbsp;<span class="op" id="6022263">=</span>&nbsp;<span class="ident" id="6022265">readGNUSparseMap0x1</span><span class="op" id="6022284">(</span><span class="ident" id="6022285">headers</span><span class="op" id="6022292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022295">case</span>&nbsp;<span class="string" id="6022300">&#34;1.0&#34;</span><span class="op" id="6022305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022309">sp</span><span class="op" id="6022311">,</span>&nbsp;<span class="ident" id="6022313">err</span>&nbsp;<span class="op" id="6022317">=</span>&nbsp;<span class="ident" id="6022319">readGNUSparseMap1x0</span><span class="op" id="6022338">(</span><span class="ident" id="6022339">tr</span><span class="op" id="6022341">.</span><span class="ident" id="6022342">curr</span><span class="op" id="6022346">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022352">return</span>&nbsp;<span class="ident" id="6022359">sp</span><span class="op" id="6022361">,</span>&nbsp;<span class="ident" id="6022363">err</span><br>
<span class="lineno"></span><span class="op" id="6022367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6022370">//&nbsp;mergePAX&nbsp;merges&nbsp;well&nbsp;known&nbsp;headers&nbsp;according&nbsp;to&nbsp;PAX&nbsp;standard.</span><br>
<span class="lineno">210</span><span class="comment" id="6022435">//&nbsp;In&nbsp;general&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;those&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="6022491">//&nbsp;in&nbsp;the&nbsp;header&nbsp;struct&nbsp;overwrite&nbsp;those&nbsp;found&nbsp;in&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6022551">//&nbsp;struct&nbsp;with&nbsp;higher&nbsp;precision&nbsp;or&nbsp;longer&nbsp;values.&nbsp;Esp.&nbsp;useful</span><br>
<span class="lineno"></span><span class="comment" id="6022613">//&nbsp;for&nbsp;name&nbsp;and&nbsp;linkname&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="6022646">func</span>&nbsp;<span class="ident" id="6022651">mergePAX</span><span class="op" id="6022659">(</span><span class="ident" id="6022660">hdr</span>&nbsp;<span class="op" id="6022664">*</span><span class="ident" id="6022665">Header</span><span class="op" id="6022671">,</span>&nbsp;<span class="ident" id="6022673">headers</span>&nbsp;<span class="keyword" id="6022681">map</span><span class="op" id="6022684">[</span><span class="builtintype" id="6022685">string</span><span class="op" id="6022691">]</span><span class="builtintype" id="6022692">string</span><span class="op" id="6022698">)</span>&nbsp;<span class="builtintype" id="6022700">error</span>&nbsp;<span class="op" id="6022706">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022709">for</span>&nbsp;<span class="ident" id="6022713">k</span><span class="op" id="6022714">,</span>&nbsp;<span class="ident" id="6022716">v</span>&nbsp;<span class="op" id="6022718">:=</span>&nbsp;<span class="keyword" id="6022721">range</span>&nbsp;<span class="ident" id="6022727">headers</span>&nbsp;<span class="op" id="6022735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022739">switch</span>&nbsp;<span class="ident" id="6022746">k</span>&nbsp;<span class="op" id="6022748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022752">case</span>&nbsp;<span class="ident" id="6022757">paxPath</span><span class="op" id="6022764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022769">hdr</span><span class="op" id="6022772">.</span><span class="ident" id="6022773">Name</span>&nbsp;<span class="op" id="6022778">=</span>&nbsp;<span class="ident" id="6022780">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022784">case</span>&nbsp;<span class="ident" id="6022789">paxLinkpath</span><span class="op" id="6022800">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022805">hdr</span><span class="op" id="6022808">.</span><span class="ident" id="6022809">Linkname</span>&nbsp;<span class="op" id="6022818">=</span>&nbsp;<span class="ident" id="6022820">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022824">case</span>&nbsp;<span class="ident" id="6022829">paxGname</span><span class="op" id="6022837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022842">hdr</span><span class="op" id="6022845">.</span><span class="ident" id="6022846">Gname</span>&nbsp;<span class="op" id="6022852">=</span>&nbsp;<span class="ident" id="6022854">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022858">case</span>&nbsp;<span class="ident" id="6022863">paxUname</span><span class="op" id="6022871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022876">hdr</span><span class="op" id="6022879">.</span><span class="ident" id="6022880">Uname</span>&nbsp;<span class="op" id="6022886">=</span>&nbsp;<span class="ident" id="6022888">v</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022892">case</span>&nbsp;<span class="ident" id="6022897">paxUid</span><span class="op" id="6022903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022908">uid</span><span class="op" id="6022911">,</span>&nbsp;<span class="ident" id="6022913">err</span>&nbsp;<span class="op" id="6022917">:=</span>&nbsp;<span class="ident" id="6022920">strconv</span><span class="op" id="6022927">.</span><span class="ident" id="6022928">ParseInt</span><span class="op" id="6022936">(</span><span class="ident" id="6022937">v</span><span class="op" id="6022938">,</span>&nbsp;<span class="num" id="6022940">10</span><span class="op" id="6022942">,</span>&nbsp;<span class="num" id="6022944">0</span><span class="op" id="6022945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022950">if</span>&nbsp;<span class="ident" id="6022953">err</span>&nbsp;<span class="op" id="6022957">!=</span>&nbsp;<span class="ident" id="6022960">nil</span>&nbsp;<span class="op" id="6022964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022970">return</span>&nbsp;<span class="ident" id="6022977">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022984">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022989">hdr</span><span class="op" id="6022992">.</span><span class="ident" id="6022993">Uid</span>&nbsp;<span class="op" id="6022997">=</span>&nbsp;<span class="builtintype" id="6022999">int</span><span class="op" id="6023002">(</span><span class="ident" id="6023003">uid</span><span class="op" id="6023006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023010">case</span>&nbsp;<span class="ident" id="6023015">paxGid</span><span class="op" id="6023021">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023026">gid</span><span class="op" id="6023029">,</span>&nbsp;<span class="ident" id="6023031">err</span>&nbsp;<span class="op" id="6023035">:=</span>&nbsp;<span class="ident" id="6023038">strconv</span><span class="op" id="6023045">.</span><span class="ident" id="6023046">ParseInt</span><span class="op" id="6023054">(</span><span class="ident" id="6023055">v</span><span class="op" id="6023056">,</span>&nbsp;<span class="num" id="6023058">10</span><span class="op" id="6023060">,</span>&nbsp;<span class="num" id="6023062">0</span><span class="op" id="6023063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023068">if</span>&nbsp;<span class="ident" id="6023071">err</span>&nbsp;<span class="op" id="6023075">!=</span>&nbsp;<span class="ident" id="6023078">nil</span>&nbsp;<span class="op" id="6023082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023088">return</span>&nbsp;<span class="ident" id="6023095">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023107">hdr</span><span class="op" id="6023110">.</span><span class="ident" id="6023111">Gid</span>&nbsp;<span class="op" id="6023115">=</span>&nbsp;<span class="builtintype" id="6023117">int</span><span class="op" id="6023120">(</span><span class="ident" id="6023121">gid</span><span class="op" id="6023124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023128">case</span>&nbsp;<span class="ident" id="6023133">paxAtime</span><span class="op" id="6023141">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023146">t</span><span class="op" id="6023147">,</span>&nbsp;<span class="ident" id="6023149">err</span>&nbsp;<span class="op" id="6023153">:=</span>&nbsp;<span class="ident" id="6023156">parsePAXTime</span><span class="op" id="6023168">(</span><span class="ident" id="6023169">v</span><span class="op" id="6023170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023175">if</span>&nbsp;<span class="ident" id="6023178">err</span>&nbsp;<span class="op" id="6023182">!=</span>&nbsp;<span class="ident" id="6023185">nil</span>&nbsp;<span class="op" id="6023189">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023195">return</span>&nbsp;<span class="ident" id="6023202">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023214">hdr</span><span class="op" id="6023217">.</span><span class="ident" id="6023218">AccessTime</span>&nbsp;<span class="op" id="6023229">=</span>&nbsp;<span class="ident" id="6023231">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023235">case</span>&nbsp;<span class="ident" id="6023240">paxMtime</span><span class="op" id="6023248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023253">t</span><span class="op" id="6023254">,</span>&nbsp;<span class="ident" id="6023256">err</span>&nbsp;<span class="op" id="6023260">:=</span>&nbsp;<span class="ident" id="6023263">parsePAXTime</span><span class="op" id="6023275">(</span><span class="ident" id="6023276">v</span><span class="op" id="6023277">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023282">if</span>&nbsp;<span class="ident" id="6023285">err</span>&nbsp;<span class="op" id="6023289">!=</span>&nbsp;<span class="ident" id="6023292">nil</span>&nbsp;<span class="op" id="6023296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023302">return</span>&nbsp;<span class="ident" id="6023309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023321">hdr</span><span class="op" id="6023324">.</span><span class="ident" id="6023325">ModTime</span>&nbsp;<span class="op" id="6023333">=</span>&nbsp;<span class="ident" id="6023335">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023339">case</span>&nbsp;<span class="ident" id="6023344">paxCtime</span><span class="op" id="6023352">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023357">t</span><span class="op" id="6023358">,</span>&nbsp;<span class="ident" id="6023360">err</span>&nbsp;<span class="op" id="6023364">:=</span>&nbsp;<span class="ident" id="6023367">parsePAXTime</span><span class="op" id="6023379">(</span><span class="ident" id="6023380">v</span><span class="op" id="6023381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023386">if</span>&nbsp;<span class="ident" id="6023389">err</span>&nbsp;<span class="op" id="6023393">!=</span>&nbsp;<span class="ident" id="6023396">nil</span>&nbsp;<span class="op" id="6023400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023406">return</span>&nbsp;<span class="ident" id="6023413">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023425">hdr</span><span class="op" id="6023428">.</span><span class="ident" id="6023429">ChangeTime</span>&nbsp;<span class="op" id="6023440">=</span>&nbsp;<span class="ident" id="6023442">t</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023446">case</span>&nbsp;<span class="ident" id="6023451">paxSize</span><span class="op" id="6023458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023463">size</span><span class="op" id="6023467">,</span>&nbsp;<span class="ident" id="6023469">err</span>&nbsp;<span class="op" id="6023473">:=</span>&nbsp;<span class="ident" id="6023476">strconv</span><span class="op" id="6023483">.</span><span class="ident" id="6023484">ParseInt</span><span class="op" id="6023492">(</span><span class="ident" id="6023493">v</span><span class="op" id="6023494">,</span>&nbsp;<span class="num" id="6023496">10</span><span class="op" id="6023498">,</span>&nbsp;<span class="num" id="6023500">0</span><span class="op" id="6023501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023506">if</span>&nbsp;<span class="ident" id="6023509">err</span>&nbsp;<span class="op" id="6023513">!=</span>&nbsp;<span class="ident" id="6023516">nil</span>&nbsp;<span class="op" id="6023520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023526">return</span>&nbsp;<span class="ident" id="6023533">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023540">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023545">hdr</span><span class="op" id="6023548">.</span><span class="ident" id="6023549">Size</span>&nbsp;<span class="op" id="6023554">=</span>&nbsp;<span class="ident" id="6023556">int64</span><span class="op" id="6023561">(</span><span class="ident" id="6023562">size</span><span class="op" id="6023566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023570">default</span><span class="op" id="6023577">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023582">if</span>&nbsp;<span class="ident" id="6023585">strings</span><span class="op" id="6023592">.</span><span class="ident" id="6023593">HasPrefix</span><span class="op" id="6023602">(</span><span class="ident" id="6023603">k</span><span class="op" id="6023604">,</span>&nbsp;<span class="ident" id="6023606">paxXattr</span><span class="op" id="6023614">)</span>&nbsp;<span class="op" id="6023616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023622">if</span>&nbsp;<span class="ident" id="6023625">hdr</span><span class="op" id="6023628">.</span><span class="ident" id="6023629">Xattrs</span>&nbsp;<span class="op" id="6023636">==</span>&nbsp;<span class="ident" id="6023639">nil</span>&nbsp;<span class="op" id="6023643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023650">hdr</span><span class="op" id="6023653">.</span><span class="ident" id="6023654">Xattrs</span>&nbsp;<span class="op" id="6023661">=</span>&nbsp;<span class="builtinfunc" id="6023663">make</span><span class="op" id="6023667">(</span><span class="keyword" id="6023668">map</span><span class="op" id="6023671">[</span><span class="builtintype" id="6023672">string</span><span class="op" id="6023678">]</span><span class="builtintype" id="6023679">string</span><span class="op" id="6023685">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023697">hdr</span><span class="op" id="6023700">.</span><span class="ident" id="6023701">Xattrs</span><span class="op" id="6023707">[</span><span class="ident" id="6023708">k</span><span class="op" id="6023709">[</span><span class="builtinfunc" id="6023710">len</span><span class="op" id="6023713">(</span><span class="ident" id="6023714">paxXattr</span><span class="op" id="6023722">)</span><span class="op" id="6023723">:</span><span class="op" id="6023724">]</span><span class="op" id="6023725">]</span>&nbsp;<span class="op" id="6023727">=</span>&nbsp;<span class="ident" id="6023729">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023741">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023744">return</span>&nbsp;<span class="ident" id="6023751">nil</span><br>
<span class="lineno"></span><span class="op" id="6023755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6023758">//&nbsp;parsePAXTime&nbsp;takes&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;%d.%d&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6023823">//&nbsp;the&nbsp;PAX&nbsp;specification.</span><br>
<span class="lineno">275</span><span class="keyword" id="6023849">func</span>&nbsp;<span class="ident" id="6023854">parsePAXTime</span><span class="op" id="6023866">(</span><span class="ident" id="6023867">t</span>&nbsp;<span class="builtintype" id="6023869">string</span><span class="op" id="6023875">)</span>&nbsp;<span class="op" id="6023877">(</span><span class="ident" id="6023878">time</span><span class="op" id="6023882">.</span><span class="ident" id="6023883">Time</span><span class="op" id="6023887">,</span>&nbsp;<span class="builtintype" id="6023889">error</span><span class="op" id="6023894">)</span>&nbsp;<span class="op" id="6023896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023899">buf</span>&nbsp;<span class="op" id="6023903">:=</span>&nbsp;<span class="op" id="6023906">[</span><span class="op" id="6023907">]</span><span class="builtintype" id="6023908">byte</span><span class="op" id="6023912">(</span><span class="ident" id="6023913">t</span><span class="op" id="6023914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023917">pos</span>&nbsp;<span class="op" id="6023921">:=</span>&nbsp;<span class="ident" id="6023924">bytes</span><span class="op" id="6023929">.</span><span class="ident" id="6023930">IndexByte</span><span class="op" id="6023939">(</span><span class="ident" id="6023940">buf</span><span class="op" id="6023943">,</span>&nbsp;<span class="string" id="6023945">&#39;.&#39;</span><span class="op" id="6023948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023951">var</span>&nbsp;<span class="ident" id="6023955">seconds</span><span class="op" id="6023962">,</span>&nbsp;<span class="ident" id="6023964">nanoseconds</span>&nbsp;<span class="ident" id="6023976">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023983">var</span>&nbsp;<span class="ident" id="6023987">err</span>&nbsp;<span class="builtintype" id="6023991">error</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023998">if</span>&nbsp;<span class="ident" id="6024001">pos</span>&nbsp;<span class="op" id="6024005">==</span>&nbsp;<span class="op" id="6024008">-</span><span class="num" id="6024009">1</span>&nbsp;<span class="op" id="6024011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024015">seconds</span><span class="op" id="6024022">,</span>&nbsp;<span class="ident" id="6024024">err</span>&nbsp;<span class="op" id="6024028">=</span>&nbsp;<span class="ident" id="6024030">strconv</span><span class="op" id="6024037">.</span><span class="ident" id="6024038">ParseInt</span><span class="op" id="6024046">(</span><span class="ident" id="6024047">t</span><span class="op" id="6024048">,</span>&nbsp;<span class="num" id="6024050">10</span><span class="op" id="6024052">,</span>&nbsp;<span class="num" id="6024054">0</span><span class="op" id="6024055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024059">if</span>&nbsp;<span class="ident" id="6024062">err</span>&nbsp;<span class="op" id="6024066">!=</span>&nbsp;<span class="ident" id="6024069">nil</span>&nbsp;<span class="op" id="6024073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024078">return</span>&nbsp;<span class="ident" id="6024085">time</span><span class="op" id="6024089">.</span><span class="ident" id="6024090">Time</span><span class="op" id="6024094">{</span><span class="op" id="6024095">}</span><span class="op" id="6024096">,</span>&nbsp;<span class="ident" id="6024098">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024104">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024107">}</span>&nbsp;<span class="keyword" id="6024109">else</span>&nbsp;<span class="op" id="6024114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024118">seconds</span><span class="op" id="6024125">,</span>&nbsp;<span class="ident" id="6024127">err</span>&nbsp;<span class="op" id="6024131">=</span>&nbsp;<span class="ident" id="6024133">strconv</span><span class="op" id="6024140">.</span><span class="ident" id="6024141">ParseInt</span><span class="op" id="6024149">(</span><span class="builtintype" id="6024150">string</span><span class="op" id="6024156">(</span><span class="ident" id="6024157">buf</span><span class="op" id="6024160">[</span><span class="op" id="6024161">:</span><span class="ident" id="6024162">pos</span><span class="op" id="6024165">]</span><span class="op" id="6024166">)</span><span class="op" id="6024167">,</span>&nbsp;<span class="num" id="6024169">10</span><span class="op" id="6024171">,</span>&nbsp;<span class="num" id="6024173">0</span><span class="op" id="6024174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024178">if</span>&nbsp;<span class="ident" id="6024181">err</span>&nbsp;<span class="op" id="6024185">!=</span>&nbsp;<span class="ident" id="6024188">nil</span>&nbsp;<span class="op" id="6024192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024197">return</span>&nbsp;<span class="ident" id="6024204">time</span><span class="op" id="6024208">.</span><span class="ident" id="6024209">Time</span><span class="op" id="6024213">{</span><span class="op" id="6024214">}</span><span class="op" id="6024215">,</span>&nbsp;<span class="ident" id="6024217">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024223">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024227">nano_buf</span>&nbsp;<span class="op" id="6024236">:=</span>&nbsp;<span class="builtintype" id="6024239">string</span><span class="op" id="6024245">(</span><span class="ident" id="6024246">buf</span><span class="op" id="6024249">[</span><span class="ident" id="6024250">pos</span><span class="op" id="6024253">+</span><span class="num" id="6024254">1</span><span class="op" id="6024255">:</span><span class="op" id="6024256">]</span><span class="op" id="6024257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024261">//&nbsp;Pad&nbsp;as&nbsp;needed&nbsp;before&nbsp;converting&nbsp;to&nbsp;a&nbsp;decimal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024312">//&nbsp;For&nbsp;example&nbsp;.030&nbsp;-&gt;&nbsp;.030000000&nbsp;-&gt;&nbsp;30000000&nbsp;nanoseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024372">if</span>&nbsp;<span class="builtinfunc" id="6024375">len</span><span class="op" id="6024378">(</span><span class="ident" id="6024379">nano_buf</span><span class="op" id="6024387">)</span>&nbsp;<span class="op" id="6024389">&lt;</span>&nbsp;<span class="ident" id="6024391">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="6024412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024417">//&nbsp;Right&nbsp;pad</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024433">nano_buf</span>&nbsp;<span class="op" id="6024442">+=</span>&nbsp;<span class="ident" id="6024445">strings</span><span class="op" id="6024452">.</span><span class="ident" id="6024453">Repeat</span><span class="op" id="6024459">(</span><span class="string" id="6024460">&#34;0&#34;</span><span class="op" id="6024463">,</span>&nbsp;<span class="ident" id="6024465">maxNanoSecondIntSize</span><span class="op" id="6024485">-</span><span class="builtinfunc" id="6024486">len</span><span class="op" id="6024489">(</span><span class="ident" id="6024490">nano_buf</span><span class="op" id="6024498">)</span><span class="op" id="6024499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024503">}</span>&nbsp;<span class="keyword" id="6024505">else</span>&nbsp;<span class="keyword" id="6024510">if</span>&nbsp;<span class="builtinfunc" id="6024513">len</span><span class="op" id="6024516">(</span><span class="ident" id="6024517">nano_buf</span><span class="op" id="6024525">)</span>&nbsp;<span class="op" id="6024527">&gt;</span>&nbsp;<span class="ident" id="6024529">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="6024550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024555">//&nbsp;Right&nbsp;truncate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024576">nano_buf</span>&nbsp;<span class="op" id="6024585">=</span>&nbsp;<span class="ident" id="6024587">nano_buf</span><span class="op" id="6024595">[</span><span class="op" id="6024596">:</span><span class="ident" id="6024597">maxNanoSecondIntSize</span><span class="op" id="6024617">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024621">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024625">nanoseconds</span><span class="op" id="6024636">,</span>&nbsp;<span class="ident" id="6024638">err</span>&nbsp;<span class="op" id="6024642">=</span>&nbsp;<span class="ident" id="6024644">strconv</span><span class="op" id="6024651">.</span><span class="ident" id="6024652">ParseInt</span><span class="op" id="6024660">(</span><span class="builtintype" id="6024661">string</span><span class="op" id="6024667">(</span><span class="ident" id="6024668">nano_buf</span><span class="op" id="6024676">)</span><span class="op" id="6024677">,</span>&nbsp;<span class="num" id="6024679">10</span><span class="op" id="6024681">,</span>&nbsp;<span class="num" id="6024683">0</span><span class="op" id="6024684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024688">if</span>&nbsp;<span class="ident" id="6024691">err</span>&nbsp;<span class="op" id="6024695">!=</span>&nbsp;<span class="ident" id="6024698">nil</span>&nbsp;<span class="op" id="6024702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024707">return</span>&nbsp;<span class="ident" id="6024714">time</span><span class="op" id="6024718">.</span><span class="ident" id="6024719">Time</span><span class="op" id="6024723">{</span><span class="op" id="6024724">}</span><span class="op" id="6024725">,</span>&nbsp;<span class="ident" id="6024727">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024736">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024739">ts</span>&nbsp;<span class="op" id="6024742">:=</span>&nbsp;<span class="ident" id="6024745">time</span><span class="op" id="6024749">.</span><span class="ident" id="6024750">Unix</span><span class="op" id="6024754">(</span><span class="ident" id="6024755">seconds</span><span class="op" id="6024762">,</span>&nbsp;<span class="ident" id="6024764">nanoseconds</span><span class="op" id="6024775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024778">return</span>&nbsp;<span class="ident" id="6024785">ts</span><span class="op" id="6024787">,</span>&nbsp;<span class="ident" id="6024789">nil</span><br>
<span class="lineno"></span><span class="op" id="6024793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6024796">//&nbsp;parsePAX&nbsp;parses&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno">310</span><span class="comment" id="6024828">//&nbsp;If&nbsp;an&nbsp;extended&nbsp;header&nbsp;(type&nbsp;&#39;x&#39;)&nbsp;is&nbsp;invalid,&nbsp;ErrHeader&nbsp;is&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="6024898">func</span>&nbsp;<span class="ident" id="6024903">parsePAX</span><span class="op" id="6024911">(</span><span class="ident" id="6024912">r</span>&nbsp;<span class="ident" id="6024914">io</span><span class="op" id="6024916">.</span><span class="ident" id="6024917">Reader</span><span class="op" id="6024923">)</span>&nbsp;<span class="op" id="6024925">(</span><span class="keyword" id="6024926">map</span><span class="op" id="6024929">[</span><span class="builtintype" id="6024930">string</span><span class="op" id="6024936">]</span><span class="builtintype" id="6024937">string</span><span class="op" id="6024943">,</span>&nbsp;<span class="builtintype" id="6024945">error</span><span class="op" id="6024950">)</span>&nbsp;<span class="op" id="6024952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024955">buf</span><span class="op" id="6024958">,</span>&nbsp;<span class="ident" id="6024960">err</span>&nbsp;<span class="op" id="6024964">:=</span>&nbsp;<span class="ident" id="6024967">ioutil</span><span class="op" id="6024973">.</span><span class="ident" id="6024974">ReadAll</span><span class="op" id="6024981">(</span><span class="ident" id="6024982">r</span><span class="op" id="6024983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024986">if</span>&nbsp;<span class="ident" id="6024989">err</span>&nbsp;<span class="op" id="6024993">!=</span>&nbsp;<span class="ident" id="6024996">nil</span>&nbsp;<span class="op" id="6025000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025004">return</span>&nbsp;<span class="ident" id="6025011">nil</span><span class="op" id="6025014">,</span>&nbsp;<span class="ident" id="6025016">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025025">//&nbsp;For&nbsp;GNU&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025068">//&nbsp;This&nbsp;function&nbsp;transforms&nbsp;the&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;headers&nbsp;into&nbsp;sparse&nbsp;format&nbsp;0.1&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025159">var</span>&nbsp;<span class="ident" id="6025163">sparseMap</span>&nbsp;<span class="ident" id="6025173">bytes</span><span class="op" id="6025178">.</span><span class="ident" id="6025179">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025188">headers</span>&nbsp;<span class="op" id="6025196">:=</span>&nbsp;<span class="builtinfunc" id="6025199">make</span><span class="op" id="6025203">(</span><span class="keyword" id="6025204">map</span><span class="op" id="6025207">[</span><span class="builtintype" id="6025208">string</span><span class="op" id="6025214">]</span><span class="builtintype" id="6025215">string</span><span class="op" id="6025221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025224">//&nbsp;Each&nbsp;record&nbsp;is&nbsp;constructed&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025258">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;%d&nbsp;%s=%s\n&#34;,&nbsp;length,&nbsp;keyword,&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025303">for</span>&nbsp;<span class="builtinfunc" id="6025307">len</span><span class="op" id="6025310">(</span><span class="ident" id="6025311">buf</span><span class="op" id="6025314">)</span>&nbsp;<span class="op" id="6025316">&gt;</span>&nbsp;<span class="num" id="6025318">0</span>&nbsp;<span class="op" id="6025320">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025324">//&nbsp;or&nbsp;the&nbsp;header&nbsp;was&nbsp;empty&nbsp;to&nbsp;start&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025368">var</span>&nbsp;<span class="ident" id="6025372">sp</span>&nbsp;<span class="builtintype" id="6025375">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025381">//&nbsp;The&nbsp;size&nbsp;field&nbsp;ends&nbsp;at&nbsp;the&nbsp;first&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025426">sp</span>&nbsp;<span class="op" id="6025429">=</span>&nbsp;<span class="ident" id="6025431">bytes</span><span class="op" id="6025436">.</span><span class="ident" id="6025437">IndexByte</span><span class="op" id="6025446">(</span><span class="ident" id="6025447">buf</span><span class="op" id="6025450">,</span>&nbsp;<span class="string" id="6025452">&#39;&nbsp;&#39;</span><span class="op" id="6025455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025459">if</span>&nbsp;<span class="ident" id="6025462">sp</span>&nbsp;<span class="op" id="6025465">==</span>&nbsp;<span class="op" id="6025468">-</span><span class="num" id="6025469">1</span>&nbsp;<span class="op" id="6025471">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025476">return</span>&nbsp;<span class="ident" id="6025483">nil</span><span class="op" id="6025486">,</span>&nbsp;<span class="ident" id="6025488">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025504">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;token&nbsp;as&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025553">n</span><span class="op" id="6025554">,</span>&nbsp;<span class="ident" id="6025556">err</span>&nbsp;<span class="op" id="6025560">:=</span>&nbsp;<span class="ident" id="6025563">strconv</span><span class="op" id="6025570">.</span><span class="ident" id="6025571">ParseInt</span><span class="op" id="6025579">(</span><span class="builtintype" id="6025580">string</span><span class="op" id="6025586">(</span><span class="ident" id="6025587">buf</span><span class="op" id="6025590">[</span><span class="op" id="6025591">:</span><span class="ident" id="6025592">sp</span><span class="op" id="6025594">]</span><span class="op" id="6025595">)</span><span class="op" id="6025596">,</span>&nbsp;<span class="num" id="6025598">10</span><span class="op" id="6025600">,</span>&nbsp;<span class="num" id="6025602">0</span><span class="op" id="6025603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025607">if</span>&nbsp;<span class="ident" id="6025610">err</span>&nbsp;<span class="op" id="6025614">!=</span>&nbsp;<span class="ident" id="6025617">nil</span>&nbsp;<span class="op" id="6025621">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025626">return</span>&nbsp;<span class="ident" id="6025633">nil</span><span class="op" id="6025636">,</span>&nbsp;<span class="ident" id="6025638">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025654">//&nbsp;Extract&nbsp;everything&nbsp;between&nbsp;the&nbsp;decimal&nbsp;and&nbsp;the&nbsp;n&nbsp;-1&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025718">//&nbsp;beginning&nbsp;to&nbsp;eat&nbsp;the&nbsp;&#39;&nbsp;&#39;,&nbsp;-1&nbsp;on&nbsp;the&nbsp;end&nbsp;to&nbsp;skip&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025784">var</span>&nbsp;<span class="ident" id="6025788">record</span>&nbsp;<span class="op" id="6025795">[</span><span class="op" id="6025796">]</span><span class="builtintype" id="6025797">byte</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025804">record</span><span class="op" id="6025810">,</span>&nbsp;<span class="ident" id="6025812">buf</span>&nbsp;<span class="op" id="6025816">=</span>&nbsp;<span class="ident" id="6025818">buf</span><span class="op" id="6025821">[</span><span class="ident" id="6025822">sp</span><span class="op" id="6025824">+</span><span class="num" id="6025825">1</span><span class="op" id="6025826">:</span><span class="ident" id="6025827">n</span><span class="op" id="6025828">-</span><span class="num" id="6025829">1</span><span class="op" id="6025830">]</span><span class="op" id="6025831">,</span>&nbsp;<span class="ident" id="6025833">buf</span><span class="op" id="6025836">[</span><span class="ident" id="6025837">n</span><span class="op" id="6025838">:</span><span class="op" id="6025839">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025843">//&nbsp;The&nbsp;first&nbsp;equals&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025907">//&nbsp;Everything&nbsp;else&nbsp;is&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025938">eq</span>&nbsp;<span class="op" id="6025941">:=</span>&nbsp;<span class="ident" id="6025944">bytes</span><span class="op" id="6025949">.</span><span class="ident" id="6025950">IndexByte</span><span class="op" id="6025959">(</span><span class="ident" id="6025960">record</span><span class="op" id="6025966">,</span>&nbsp;<span class="string" id="6025968">&#39;=&#39;</span><span class="op" id="6025971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025975">if</span>&nbsp;<span class="ident" id="6025978">eq</span>&nbsp;<span class="op" id="6025981">==</span>&nbsp;<span class="op" id="6025984">-</span><span class="num" id="6025985">1</span>&nbsp;<span class="op" id="6025987">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025992">return</span>&nbsp;<span class="ident" id="6025999">nil</span><span class="op" id="6026002">,</span>&nbsp;<span class="ident" id="6026004">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026020">key</span><span class="op" id="6026023">,</span>&nbsp;<span class="ident" id="6026025">value</span>&nbsp;<span class="op" id="6026031">:=</span>&nbsp;<span class="ident" id="6026034">record</span><span class="op" id="6026040">[</span><span class="op" id="6026041">:</span><span class="ident" id="6026042">eq</span><span class="op" id="6026044">]</span><span class="op" id="6026045">,</span>&nbsp;<span class="ident" id="6026047">record</span><span class="op" id="6026053">[</span><span class="ident" id="6026054">eq</span><span class="op" id="6026056">+</span><span class="num" id="6026057">1</span><span class="op" id="6026058">:</span><span class="op" id="6026059">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026064">keyStr</span>&nbsp;<span class="op" id="6026071">:=</span>&nbsp;<span class="builtintype" id="6026074">string</span><span class="op" id="6026080">(</span><span class="ident" id="6026081">key</span><span class="op" id="6026084">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026088">if</span>&nbsp;<span class="ident" id="6026091">keyStr</span>&nbsp;<span class="op" id="6026098">==</span>&nbsp;<span class="ident" id="6026101">paxGNUSparseOffset</span>&nbsp;<span class="op" id="6026120">||</span>&nbsp;<span class="ident" id="6026123">keyStr</span>&nbsp;<span class="op" id="6026130">==</span>&nbsp;<span class="ident" id="6026133">paxGNUSparseNumBytes</span>&nbsp;<span class="op" id="6026154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026159">//&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;special&nbsp;key.&nbsp;Write&nbsp;to&nbsp;sparseMap&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026253">sparseMap</span><span class="op" id="6026262">.</span><span class="ident" id="6026263">Write</span><span class="op" id="6026268">(</span><span class="ident" id="6026269">value</span><span class="op" id="6026274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026279">sparseMap</span><span class="op" id="6026288">.</span><span class="ident" id="6026289">Write</span><span class="op" id="6026294">(</span><span class="op" id="6026295">[</span><span class="op" id="6026296">]</span><span class="builtintype" id="6026297">byte</span><span class="op" id="6026301">{</span><span class="string" id="6026302">&#39;,&#39;</span><span class="op" id="6026305">}</span><span class="op" id="6026306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026310">}</span>&nbsp;<span class="keyword" id="6026312">else</span>&nbsp;<span class="op" id="6026317">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026322">//&nbsp;Normal&nbsp;key.&nbsp;Set&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026374">headers</span><span class="op" id="6026381">[</span><span class="ident" id="6026382">keyStr</span><span class="op" id="6026388">]</span>&nbsp;<span class="op" id="6026390">=</span>&nbsp;<span class="builtintype" id="6026392">string</span><span class="op" id="6026398">(</span><span class="ident" id="6026399">value</span><span class="op" id="6026404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026414">if</span>&nbsp;<span class="ident" id="6026417">sparseMap</span><span class="op" id="6026426">.</span><span class="ident" id="6026427">Len</span><span class="op" id="6026430">(</span><span class="op" id="6026431">)</span>&nbsp;<span class="op" id="6026433">!=</span>&nbsp;<span class="num" id="6026436">0</span>&nbsp;<span class="op" id="6026438">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026442">//&nbsp;Add&nbsp;sparse&nbsp;info&nbsp;to&nbsp;headers,&nbsp;chopping&nbsp;off&nbsp;the&nbsp;extra&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026504">sparseMap</span><span class="op" id="6026513">.</span><span class="ident" id="6026514">Truncate</span><span class="op" id="6026522">(</span><span class="ident" id="6026523">sparseMap</span><span class="op" id="6026532">.</span><span class="ident" id="6026533">Len</span><span class="op" id="6026536">(</span><span class="op" id="6026537">)</span>&nbsp;<span class="op" id="6026539">-</span>&nbsp;<span class="num" id="6026541">1</span><span class="op" id="6026542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026546">headers</span><span class="op" id="6026553">[</span><span class="ident" id="6026554">paxGNUSparseMap</span><span class="op" id="6026569">]</span>&nbsp;<span class="op" id="6026571">=</span>&nbsp;<span class="ident" id="6026573">sparseMap</span><span class="op" id="6026582">.</span><span class="ident" id="6026583">String</span><span class="op" id="6026589">(</span><span class="op" id="6026590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026596">return</span>&nbsp;<span class="ident" id="6026603">headers</span><span class="op" id="6026610">,</span>&nbsp;<span class="ident" id="6026612">nil</span><br>
<span class="lineno">365</span><span class="op" id="6026616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6026619">//&nbsp;cString&nbsp;parses&nbsp;bytes&nbsp;as&nbsp;a&nbsp;NUL-terminated&nbsp;C-style&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="6026679">//&nbsp;If&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;is&nbsp;not&nbsp;found&nbsp;then&nbsp;the&nbsp;whole&nbsp;slice&nbsp;is&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="6026755">func</span>&nbsp;<span class="ident" id="6026760">cString</span><span class="op" id="6026767">(</span><span class="ident" id="6026768">b</span>&nbsp;<span class="op" id="6026770">[</span><span class="op" id="6026771">]</span><span class="builtintype" id="6026772">byte</span><span class="op" id="6026776">)</span>&nbsp;<span class="builtintype" id="6026778">string</span>&nbsp;<span class="op" id="6026785">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026788">n</span>&nbsp;<span class="op" id="6026790">:=</span>&nbsp;<span class="num" id="6026793">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026796">for</span>&nbsp;<span class="ident" id="6026800">n</span>&nbsp;<span class="op" id="6026802">&lt;</span>&nbsp;<span class="builtinfunc" id="6026804">len</span><span class="op" id="6026807">(</span><span class="ident" id="6026808">b</span><span class="op" id="6026809">)</span>&nbsp;<span class="op" id="6026811">&amp;&amp;</span>&nbsp;<span class="ident" id="6026814">b</span><span class="op" id="6026815">[</span><span class="ident" id="6026816">n</span><span class="op" id="6026817">]</span>&nbsp;<span class="op" id="6026819">!=</span>&nbsp;<span class="num" id="6026822">0</span>&nbsp;<span class="op" id="6026824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026828">n</span><span class="op" id="6026829">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026836">return</span>&nbsp;<span class="builtintype" id="6026843">string</span><span class="op" id="6026849">(</span><span class="ident" id="6026850">b</span><span class="op" id="6026851">[</span><span class="num" id="6026852">0</span><span class="op" id="6026853">:</span><span class="ident" id="6026854">n</span><span class="op" id="6026855">]</span><span class="op" id="6026856">)</span><br>
<span class="lineno">375</span><span class="op" id="6026858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6026861">func</span>&nbsp;<span class="op" id="6026866">(</span><span class="ident" id="6026867">tr</span>&nbsp;<span class="op" id="6026870">*</span><span class="ident" id="6026871">Reader</span><span class="op" id="6026877">)</span>&nbsp;<span class="ident" id="6026879">octal</span><span class="op" id="6026884">(</span><span class="ident" id="6026885">b</span>&nbsp;<span class="op" id="6026887">[</span><span class="op" id="6026888">]</span><span class="builtintype" id="6026889">byte</span><span class="op" id="6026893">)</span>&nbsp;<span class="ident" id="6026895">int64</span>&nbsp;<span class="op" id="6026901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026904">//&nbsp;Check&nbsp;for&nbsp;binary&nbsp;format&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026939">if</span>&nbsp;<span class="builtinfunc" id="6026942">len</span><span class="op" id="6026945">(</span><span class="ident" id="6026946">b</span><span class="op" id="6026947">)</span>&nbsp;<span class="op" id="6026949">&gt;</span>&nbsp;<span class="num" id="6026951">0</span>&nbsp;<span class="op" id="6026953">&amp;&amp;</span>&nbsp;<span class="ident" id="6026956">b</span><span class="op" id="6026957">[</span><span class="num" id="6026958">0</span><span class="op" id="6026959">]</span><span class="op" id="6026960">&amp;</span><span class="num" id="6026961">0x80</span>&nbsp;<span class="op" id="6026966">!=</span>&nbsp;<span class="num" id="6026969">0</span>&nbsp;<span class="op" id="6026971">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026975">var</span>&nbsp;<span class="ident" id="6026979">x</span>&nbsp;<span class="ident" id="6026981">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026989">for</span>&nbsp;<span class="ident" id="6026993">i</span><span class="op" id="6026994">,</span>&nbsp;<span class="ident" id="6026996">c</span>&nbsp;<span class="op" id="6026998">:=</span>&nbsp;<span class="keyword" id="6027001">range</span>&nbsp;<span class="ident" id="6027007">b</span>&nbsp;<span class="op" id="6027009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027014">if</span>&nbsp;<span class="ident" id="6027017">i</span>&nbsp;<span class="op" id="6027019">==</span>&nbsp;<span class="num" id="6027022">0</span>&nbsp;<span class="op" id="6027024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027030">c</span>&nbsp;<span class="op" id="6027032">&amp;=</span>&nbsp;<span class="num" id="6027035">0x7f</span>&nbsp;<span class="comment" id="6027040">//&nbsp;ignore&nbsp;signal&nbsp;bit&nbsp;in&nbsp;first&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027078">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027083">x</span>&nbsp;<span class="op" id="6027085">=</span>&nbsp;<span class="ident" id="6027087">x</span><span class="op" id="6027088">&lt;&lt;</span><span class="num" id="6027090">8</span>&nbsp;<span class="op" id="6027092">|</span>&nbsp;<span class="ident" id="6027094">int64</span><span class="op" id="6027099">(</span><span class="ident" id="6027100">c</span><span class="op" id="6027101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027109">return</span>&nbsp;<span class="ident" id="6027116">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027123">//&nbsp;Because&nbsp;unused&nbsp;fields&nbsp;are&nbsp;filled&nbsp;with&nbsp;NULs,&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027179">//&nbsp;to&nbsp;skip&nbsp;leading&nbsp;NULs.&nbsp;Fields&nbsp;may&nbsp;also&nbsp;be&nbsp;padded&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027236">//&nbsp;spaces&nbsp;or&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027256">//&nbsp;So&nbsp;we&nbsp;remove&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;NULs&nbsp;and&nbsp;spaces&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027313">//&nbsp;be&nbsp;sure.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027326">b</span>&nbsp;<span class="op" id="6027328">=</span>&nbsp;<span class="ident" id="6027330">bytes</span><span class="op" id="6027335">.</span><span class="ident" id="6027336">Trim</span><span class="op" id="6027340">(</span><span class="ident" id="6027341">b</span><span class="op" id="6027342">,</span>&nbsp;<span class="string" id="6027344">&#34;&nbsp;\x00&#34;</span><span class="op" id="6027351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027355">if</span>&nbsp;<span class="builtinfunc" id="6027358">len</span><span class="op" id="6027361">(</span><span class="ident" id="6027362">b</span><span class="op" id="6027363">)</span>&nbsp;<span class="op" id="6027365">==</span>&nbsp;<span class="num" id="6027368">0</span>&nbsp;<span class="op" id="6027370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027374">return</span>&nbsp;<span class="num" id="6027381">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027384">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027387">x</span><span class="op" id="6027388">,</span>&nbsp;<span class="ident" id="6027390">err</span>&nbsp;<span class="op" id="6027394">:=</span>&nbsp;<span class="ident" id="6027397">strconv</span><span class="op" id="6027404">.</span><span class="ident" id="6027405">ParseUint</span><span class="op" id="6027414">(</span><span class="ident" id="6027415">cString</span><span class="op" id="6027422">(</span><span class="ident" id="6027423">b</span><span class="op" id="6027424">)</span><span class="op" id="6027425">,</span>&nbsp;<span class="num" id="6027427">8</span><span class="op" id="6027428">,</span>&nbsp;<span class="num" id="6027430">64</span><span class="op" id="6027432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027435">if</span>&nbsp;<span class="ident" id="6027438">err</span>&nbsp;<span class="op" id="6027442">!=</span>&nbsp;<span class="ident" id="6027445">nil</span>&nbsp;<span class="op" id="6027449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027453">tr</span><span class="op" id="6027455">.</span><span class="ident" id="6027456">err</span>&nbsp;<span class="op" id="6027460">=</span>&nbsp;<span class="ident" id="6027462">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027470">return</span>&nbsp;<span class="ident" id="6027477">int64</span><span class="op" id="6027482">(</span><span class="ident" id="6027483">x</span><span class="op" id="6027484">)</span><br>
<span class="lineno">405</span><span class="op" id="6027486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6027489">//&nbsp;skipUnread&nbsp;skips&nbsp;any&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;the&nbsp;existing&nbsp;file&nbsp;entry,&nbsp;as&nbsp;well&nbsp;as&nbsp;any&nbsp;alignment&nbsp;padding.</span><br>
<span class="lineno"></span><span class="keyword" id="6027588">func</span>&nbsp;<span class="op" id="6027593">(</span><span class="ident" id="6027594">tr</span>&nbsp;<span class="op" id="6027597">*</span><span class="ident" id="6027598">Reader</span><span class="op" id="6027604">)</span>&nbsp;<span class="ident" id="6027606">skipUnread</span><span class="op" id="6027616">(</span><span class="op" id="6027617">)</span>&nbsp;<span class="op" id="6027619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027622">nr</span>&nbsp;<span class="op" id="6027625">:=</span>&nbsp;<span class="ident" id="6027628">tr</span><span class="op" id="6027630">.</span><span class="ident" id="6027631">numBytes</span><span class="op" id="6027639">(</span><span class="op" id="6027640">)</span>&nbsp;<span class="op" id="6027642">+</span>&nbsp;<span class="ident" id="6027644">tr</span><span class="op" id="6027646">.</span><span class="ident" id="6027647">pad</span>&nbsp;<span class="comment" id="6027651">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;skip</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027679">tr</span><span class="op" id="6027681">.</span><span class="ident" id="6027682">curr</span><span class="op" id="6027686">,</span>&nbsp;<span class="ident" id="6027688">tr</span><span class="op" id="6027690">.</span><span class="ident" id="6027691">pad</span>&nbsp;<span class="op" id="6027695">=</span>&nbsp;<span class="ident" id="6027697">nil</span><span class="op" id="6027700">,</span>&nbsp;<span class="num" id="6027702">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027705">if</span>&nbsp;<span class="ident" id="6027708">sr</span><span class="op" id="6027710">,</span>&nbsp;<span class="ident" id="6027712">ok</span>&nbsp;<span class="op" id="6027715">:=</span>&nbsp;<span class="ident" id="6027718">tr</span><span class="op" id="6027720">.</span><span class="ident" id="6027721">r</span><span class="op" id="6027722">.</span><span class="op" id="6027723">(</span><span class="ident" id="6027724">io</span><span class="op" id="6027726">.</span><span class="ident" id="6027727">Seeker</span><span class="op" id="6027733">)</span><span class="op" id="6027734">;</span>&nbsp;<span class="ident" id="6027736">ok</span>&nbsp;<span class="op" id="6027739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027743">if</span>&nbsp;<span class="ident" id="6027746">_</span><span class="op" id="6027747">,</span>&nbsp;<span class="ident" id="6027749">err</span>&nbsp;<span class="op" id="6027753">:=</span>&nbsp;<span class="ident" id="6027756">sr</span><span class="op" id="6027758">.</span><span class="ident" id="6027759">Seek</span><span class="op" id="6027763">(</span><span class="ident" id="6027764">nr</span><span class="op" id="6027766">,</span>&nbsp;<span class="ident" id="6027768">os</span><span class="op" id="6027770">.</span><span class="ident" id="6027771">SEEK_CUR</span><span class="op" id="6027779">)</span><span class="op" id="6027780">;</span>&nbsp;<span class="ident" id="6027782">err</span>&nbsp;<span class="op" id="6027786">==</span>&nbsp;<span class="ident" id="6027789">nil</span>&nbsp;<span class="op" id="6027793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027798">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027807">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027813">_</span><span class="op" id="6027814">,</span>&nbsp;<span class="ident" id="6027816">tr</span><span class="op" id="6027818">.</span><span class="ident" id="6027819">err</span>&nbsp;<span class="op" id="6027823">=</span>&nbsp;<span class="ident" id="6027825">io</span><span class="op" id="6027827">.</span><span class="ident" id="6027828">CopyN</span><span class="op" id="6027833">(</span><span class="ident" id="6027834">ioutil</span><span class="op" id="6027840">.</span><span class="ident" id="6027841">Discard</span><span class="op" id="6027848">,</span>&nbsp;<span class="ident" id="6027850">tr</span><span class="op" id="6027852">.</span><span class="ident" id="6027853">r</span><span class="op" id="6027854">,</span>&nbsp;<span class="ident" id="6027856">nr</span><span class="op" id="6027858">)</span><br>
<span class="lineno"></span><span class="op" id="6027860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6027863">func</span>&nbsp;<span class="op" id="6027868">(</span><span class="ident" id="6027869">tr</span>&nbsp;<span class="op" id="6027872">*</span><span class="ident" id="6027873">Reader</span><span class="op" id="6027879">)</span>&nbsp;<span class="ident" id="6027881">verifyChecksum</span><span class="op" id="6027895">(</span><span class="ident" id="6027896">header</span>&nbsp;<span class="op" id="6027903">[</span><span class="op" id="6027904">]</span><span class="builtintype" id="6027905">byte</span><span class="op" id="6027909">)</span>&nbsp;<span class="builtintype" id="6027911">bool</span>&nbsp;<span class="op" id="6027916">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027919">if</span>&nbsp;<span class="ident" id="6027922">tr</span><span class="op" id="6027924">.</span><span class="ident" id="6027925">err</span>&nbsp;<span class="op" id="6027929">!=</span>&nbsp;<span class="ident" id="6027932">nil</span>&nbsp;<span class="op" id="6027936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027940">return</span>&nbsp;<span class="ident" id="6027947">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027958">given</span>&nbsp;<span class="op" id="6027964">:=</span>&nbsp;<span class="ident" id="6027967">tr</span><span class="op" id="6027969">.</span><span class="ident" id="6027970">octal</span><span class="op" id="6027975">(</span><span class="ident" id="6027976">header</span><span class="op" id="6027982">[</span><span class="num" id="6027983">148</span><span class="op" id="6027986">:</span><span class="num" id="6027987">156</span><span class="op" id="6027990">]</span><span class="op" id="6027991">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027994">unsigned</span><span class="op" id="6028002">,</span>&nbsp;<span class="ident" id="6028004">signed</span>&nbsp;<span class="op" id="6028011">:=</span>&nbsp;<span class="ident" id="6028014">checksum</span><span class="op" id="6028022">(</span><span class="ident" id="6028023">header</span><span class="op" id="6028029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028032">return</span>&nbsp;<span class="ident" id="6028039">given</span>&nbsp;<span class="op" id="6028045">==</span>&nbsp;<span class="ident" id="6028048">unsigned</span>&nbsp;<span class="op" id="6028057">||</span>&nbsp;<span class="ident" id="6028060">given</span>&nbsp;<span class="op" id="6028066">==</span>&nbsp;<span class="ident" id="6028069">signed</span><br>
<span class="lineno"></span><span class="op" id="6028076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6028079">func</span>&nbsp;<span class="op" id="6028084">(</span><span class="ident" id="6028085">tr</span>&nbsp;<span class="op" id="6028088">*</span><span class="ident" id="6028089">Reader</span><span class="op" id="6028095">)</span>&nbsp;<span class="ident" id="6028097">readHeader</span><span class="op" id="6028107">(</span><span class="op" id="6028108">)</span>&nbsp;<span class="op" id="6028110">*</span><span class="ident" id="6028111">Header</span>&nbsp;<span class="op" id="6028118">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028121">header</span>&nbsp;<span class="op" id="6028128">:=</span>&nbsp;<span class="ident" id="6028131">tr</span><span class="op" id="6028133">.</span><span class="ident" id="6028134">hdrBuff</span><span class="op" id="6028141">[</span><span class="op" id="6028142">:</span><span class="op" id="6028143">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6028146">copy</span><span class="op" id="6028150">(</span><span class="ident" id="6028151">header</span><span class="op" id="6028157">,</span>&nbsp;<span class="ident" id="6028159">zeroBlock</span><span class="op" id="6028168">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028172">if</span>&nbsp;<span class="ident" id="6028175">_</span><span class="op" id="6028176">,</span>&nbsp;<span class="ident" id="6028178">tr</span><span class="op" id="6028180">.</span><span class="ident" id="6028181">err</span>&nbsp;<span class="op" id="6028185">=</span>&nbsp;<span class="ident" id="6028187">io</span><span class="op" id="6028189">.</span><span class="ident" id="6028190">ReadFull</span><span class="op" id="6028198">(</span><span class="ident" id="6028199">tr</span><span class="op" id="6028201">.</span><span class="ident" id="6028202">r</span><span class="op" id="6028203">,</span>&nbsp;<span class="ident" id="6028205">header</span><span class="op" id="6028211">)</span><span class="op" id="6028212">;</span>&nbsp;<span class="ident" id="6028214">tr</span><span class="op" id="6028216">.</span><span class="ident" id="6028217">err</span>&nbsp;<span class="op" id="6028221">!=</span>&nbsp;<span class="ident" id="6028224">nil</span>&nbsp;<span class="op" id="6028228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028232">return</span>&nbsp;<span class="ident" id="6028239">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028248">//&nbsp;Two&nbsp;blocks&nbsp;of&nbsp;zero&nbsp;bytes&nbsp;marks&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028307">if</span>&nbsp;<span class="ident" id="6028310">bytes</span><span class="op" id="6028315">.</span><span class="ident" id="6028316">Equal</span><span class="op" id="6028321">(</span><span class="ident" id="6028322">header</span><span class="op" id="6028328">,</span>&nbsp;<span class="ident" id="6028330">zeroBlock</span><span class="op" id="6028339">[</span><span class="num" id="6028340">0</span><span class="op" id="6028341">:</span><span class="ident" id="6028342">blockSize</span><span class="op" id="6028351">]</span><span class="op" id="6028352">)</span>&nbsp;<span class="op" id="6028354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028358">if</span>&nbsp;<span class="ident" id="6028361">_</span><span class="op" id="6028362">,</span>&nbsp;<span class="ident" id="6028364">tr</span><span class="op" id="6028366">.</span><span class="ident" id="6028367">err</span>&nbsp;<span class="op" id="6028371">=</span>&nbsp;<span class="ident" id="6028373">io</span><span class="op" id="6028375">.</span><span class="ident" id="6028376">ReadFull</span><span class="op" id="6028384">(</span><span class="ident" id="6028385">tr</span><span class="op" id="6028387">.</span><span class="ident" id="6028388">r</span><span class="op" id="6028389">,</span>&nbsp;<span class="ident" id="6028391">header</span><span class="op" id="6028397">)</span><span class="op" id="6028398">;</span>&nbsp;<span class="ident" id="6028400">tr</span><span class="op" id="6028402">.</span><span class="ident" id="6028403">err</span>&nbsp;<span class="op" id="6028407">!=</span>&nbsp;<span class="ident" id="6028410">nil</span>&nbsp;<span class="op" id="6028414">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028419">return</span>&nbsp;<span class="ident" id="6028426">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028436">if</span>&nbsp;<span class="ident" id="6028439">bytes</span><span class="op" id="6028444">.</span><span class="ident" id="6028445">Equal</span><span class="op" id="6028450">(</span><span class="ident" id="6028451">header</span><span class="op" id="6028457">,</span>&nbsp;<span class="ident" id="6028459">zeroBlock</span><span class="op" id="6028468">[</span><span class="num" id="6028469">0</span><span class="op" id="6028470">:</span><span class="ident" id="6028471">blockSize</span><span class="op" id="6028480">]</span><span class="op" id="6028481">)</span>&nbsp;<span class="op" id="6028483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028488">tr</span><span class="op" id="6028490">.</span><span class="ident" id="6028491">err</span>&nbsp;<span class="op" id="6028495">=</span>&nbsp;<span class="ident" id="6028497">io</span><span class="op" id="6028499">.</span><span class="ident" id="6028500">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028506">}</span>&nbsp;<span class="keyword" id="6028508">else</span>&nbsp;<span class="op" id="6028513">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028518">tr</span><span class="op" id="6028520">.</span><span class="ident" id="6028521">err</span>&nbsp;<span class="op" id="6028525">=</span>&nbsp;<span class="ident" id="6028527">ErrHeader</span>&nbsp;<span class="comment" id="6028537">//&nbsp;zero&nbsp;block&nbsp;and&nbsp;then&nbsp;non-zero&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028581">return</span>&nbsp;<span class="ident" id="6028588">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028597">if</span>&nbsp;<span class="op" id="6028600">!</span><span class="ident" id="6028601">tr</span><span class="op" id="6028603">.</span><span class="ident" id="6028604">verifyChecksum</span><span class="op" id="6028618">(</span><span class="ident" id="6028619">header</span><span class="op" id="6028625">)</span>&nbsp;<span class="op" id="6028627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028631">tr</span><span class="op" id="6028633">.</span><span class="ident" id="6028634">err</span>&nbsp;<span class="op" id="6028638">=</span>&nbsp;<span class="ident" id="6028640">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028652">return</span>&nbsp;<span class="ident" id="6028659">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028668">//&nbsp;Unpack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028679">hdr</span>&nbsp;<span class="op" id="6028683">:=</span>&nbsp;<span class="builtinfunc" id="6028686">new</span><span class="op" id="6028689">(</span><span class="ident" id="6028690">Header</span><span class="op" id="6028696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028699">s</span>&nbsp;<span class="op" id="6028701">:=</span>&nbsp;<span class="ident" id="6028704">slicer</span><span class="op" id="6028710">(</span><span class="ident" id="6028711">header</span><span class="op" id="6028717">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028721">hdr</span><span class="op" id="6028724">.</span><span class="ident" id="6028725">Name</span>&nbsp;<span class="op" id="6028730">=</span>&nbsp;<span class="ident" id="6028732">cString</span><span class="op" id="6028739">(</span><span class="ident" id="6028740">s</span><span class="op" id="6028741">.</span><span class="ident" id="6028742">next</span><span class="op" id="6028746">(</span><span class="num" id="6028747">100</span><span class="op" id="6028750">)</span><span class="op" id="6028751">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028754">hdr</span><span class="op" id="6028757">.</span><span class="ident" id="6028758">Mode</span>&nbsp;<span class="op" id="6028763">=</span>&nbsp;<span class="ident" id="6028765">tr</span><span class="op" id="6028767">.</span><span class="ident" id="6028768">octal</span><span class="op" id="6028773">(</span><span class="ident" id="6028774">s</span><span class="op" id="6028775">.</span><span class="ident" id="6028776">next</span><span class="op" id="6028780">(</span><span class="num" id="6028781">8</span><span class="op" id="6028782">)</span><span class="op" id="6028783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028786">hdr</span><span class="op" id="6028789">.</span><span class="ident" id="6028790">Uid</span>&nbsp;<span class="op" id="6028794">=</span>&nbsp;<span class="builtintype" id="6028796">int</span><span class="op" id="6028799">(</span><span class="ident" id="6028800">tr</span><span class="op" id="6028802">.</span><span class="ident" id="6028803">octal</span><span class="op" id="6028808">(</span><span class="ident" id="6028809">s</span><span class="op" id="6028810">.</span><span class="ident" id="6028811">next</span><span class="op" id="6028815">(</span><span class="num" id="6028816">8</span><span class="op" id="6028817">)</span><span class="op" id="6028818">)</span><span class="op" id="6028819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028822">hdr</span><span class="op" id="6028825">.</span><span class="ident" id="6028826">Gid</span>&nbsp;<span class="op" id="6028830">=</span>&nbsp;<span class="builtintype" id="6028832">int</span><span class="op" id="6028835">(</span><span class="ident" id="6028836">tr</span><span class="op" id="6028838">.</span><span class="ident" id="6028839">octal</span><span class="op" id="6028844">(</span><span class="ident" id="6028845">s</span><span class="op" id="6028846">.</span><span class="ident" id="6028847">next</span><span class="op" id="6028851">(</span><span class="num" id="6028852">8</span><span class="op" id="6028853">)</span><span class="op" id="6028854">)</span><span class="op" id="6028855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028858">hdr</span><span class="op" id="6028861">.</span><span class="ident" id="6028862">Size</span>&nbsp;<span class="op" id="6028867">=</span>&nbsp;<span class="ident" id="6028869">tr</span><span class="op" id="6028871">.</span><span class="ident" id="6028872">octal</span><span class="op" id="6028877">(</span><span class="ident" id="6028878">s</span><span class="op" id="6028879">.</span><span class="ident" id="6028880">next</span><span class="op" id="6028884">(</span><span class="num" id="6028885">12</span><span class="op" id="6028887">)</span><span class="op" id="6028888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028891">hdr</span><span class="op" id="6028894">.</span><span class="ident" id="6028895">ModTime</span>&nbsp;<span class="op" id="6028903">=</span>&nbsp;<span class="ident" id="6028905">time</span><span class="op" id="6028909">.</span><span class="ident" id="6028910">Unix</span><span class="op" id="6028914">(</span><span class="ident" id="6028915">tr</span><span class="op" id="6028917">.</span><span class="ident" id="6028918">octal</span><span class="op" id="6028923">(</span><span class="ident" id="6028924">s</span><span class="op" id="6028925">.</span><span class="ident" id="6028926">next</span><span class="op" id="6028930">(</span><span class="num" id="6028931">12</span><span class="op" id="6028933">)</span><span class="op" id="6028934">)</span><span class="op" id="6028935">,</span>&nbsp;<span class="num" id="6028937">0</span><span class="op" id="6028938">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028941">s</span><span class="op" id="6028942">.</span><span class="ident" id="6028943">next</span><span class="op" id="6028947">(</span><span class="num" id="6028948">8</span><span class="op" id="6028949">)</span>&nbsp;<span class="comment" id="6028951">//&nbsp;chksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028962">hdr</span><span class="op" id="6028965">.</span><span class="ident" id="6028966">Typeflag</span>&nbsp;<span class="op" id="6028975">=</span>&nbsp;<span class="ident" id="6028977">s</span><span class="op" id="6028978">.</span><span class="ident" id="6028979">next</span><span class="op" id="6028983">(</span><span class="num" id="6028984">1</span><span class="op" id="6028985">)</span><span class="op" id="6028986">[</span><span class="num" id="6028987">0</span><span class="op" id="6028988">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028991">hdr</span><span class="op" id="6028994">.</span><span class="ident" id="6028995">Linkname</span>&nbsp;<span class="op" id="6029004">=</span>&nbsp;<span class="ident" id="6029006">cString</span><span class="op" id="6029013">(</span><span class="ident" id="6029014">s</span><span class="op" id="6029015">.</span><span class="ident" id="6029016">next</span><span class="op" id="6029020">(</span><span class="num" id="6029021">100</span><span class="op" id="6029024">)</span><span class="op" id="6029025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6029029">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;header&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;magic.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6029092">//&nbsp;The&nbsp;original&nbsp;(v7)&nbsp;version&nbsp;of&nbsp;tar&nbsp;had&nbsp;no&nbsp;explicit&nbsp;magic&nbsp;field,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6029158">//&nbsp;so&nbsp;its&nbsp;magic&nbsp;bytes,&nbsp;like&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;block,&nbsp;are&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029220">magic</span>&nbsp;<span class="op" id="6029226">:=</span>&nbsp;<span class="builtintype" id="6029229">string</span><span class="op" id="6029235">(</span><span class="ident" id="6029236">s</span><span class="op" id="6029237">.</span><span class="ident" id="6029238">next</span><span class="op" id="6029242">(</span><span class="num" id="6029243">8</span><span class="op" id="6029244">)</span><span class="op" id="6029245">)</span>&nbsp;<span class="comment" id="6029247">//&nbsp;contains&nbsp;version&nbsp;field&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029283">var</span>&nbsp;<span class="ident" id="6029287">format</span>&nbsp;<span class="builtintype" id="6029294">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029302">switch</span>&nbsp;<span class="op" id="6029309">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029312">case</span>&nbsp;<span class="ident" id="6029317">magic</span><span class="op" id="6029322">[</span><span class="op" id="6029323">:</span><span class="num" id="6029324">6</span><span class="op" id="6029325">]</span>&nbsp;<span class="op" id="6029327">==</span>&nbsp;<span class="string" id="6029330">&#34;ustar\x00&#34;</span><span class="op" id="6029341">:</span>&nbsp;<span class="comment" id="6029343">//&nbsp;POSIX&nbsp;tar&nbsp;(1003.1-1988)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029372">if</span>&nbsp;<span class="builtintype" id="6029375">string</span><span class="op" id="6029381">(</span><span class="ident" id="6029382">header</span><span class="op" id="6029388">[</span><span class="num" id="6029389">508</span><span class="op" id="6029392">:</span><span class="num" id="6029393">512</span><span class="op" id="6029396">]</span><span class="op" id="6029397">)</span>&nbsp;<span class="op" id="6029399">==</span>&nbsp;<span class="string" id="6029402">&#34;tar\x00&#34;</span>&nbsp;<span class="op" id="6029412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029417">format</span>&nbsp;<span class="op" id="6029424">=</span>&nbsp;<span class="string" id="6029426">&#34;star&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029435">}</span>&nbsp;<span class="keyword" id="6029437">else</span>&nbsp;<span class="op" id="6029442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029447">format</span>&nbsp;<span class="op" id="6029454">=</span>&nbsp;<span class="string" id="6029456">&#34;posix&#34;</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029469">case</span>&nbsp;<span class="ident" id="6029474">magic</span>&nbsp;<span class="op" id="6029480">==</span>&nbsp;<span class="string" id="6029483">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="6029496">:</span>&nbsp;<span class="comment" id="6029498">//&nbsp;old&nbsp;GNU&nbsp;tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029515">format</span>&nbsp;<span class="op" id="6029522">=</span>&nbsp;<span class="string" id="6029524">&#34;gnu&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029535">switch</span>&nbsp;<span class="ident" id="6029542">format</span>&nbsp;<span class="op" id="6029549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029552">case</span>&nbsp;<span class="string" id="6029557">&#34;posix&#34;</span><span class="op" id="6029564">,</span>&nbsp;<span class="string" id="6029566">&#34;gnu&#34;</span><span class="op" id="6029571">,</span>&nbsp;<span class="string" id="6029573">&#34;star&#34;</span><span class="op" id="6029579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029583">hdr</span><span class="op" id="6029586">.</span><span class="ident" id="6029587">Uname</span>&nbsp;<span class="op" id="6029593">=</span>&nbsp;<span class="ident" id="6029595">cString</span><span class="op" id="6029602">(</span><span class="ident" id="6029603">s</span><span class="op" id="6029604">.</span><span class="ident" id="6029605">next</span><span class="op" id="6029609">(</span><span class="num" id="6029610">32</span><span class="op" id="6029612">)</span><span class="op" id="6029613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029617">hdr</span><span class="op" id="6029620">.</span><span class="ident" id="6029621">Gname</span>&nbsp;<span class="op" id="6029627">=</span>&nbsp;<span class="ident" id="6029629">cString</span><span class="op" id="6029636">(</span><span class="ident" id="6029637">s</span><span class="op" id="6029638">.</span><span class="ident" id="6029639">next</span><span class="op" id="6029643">(</span><span class="num" id="6029644">32</span><span class="op" id="6029646">)</span><span class="op" id="6029647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029651">devmajor</span>&nbsp;<span class="op" id="6029660">:=</span>&nbsp;<span class="ident" id="6029663">s</span><span class="op" id="6029664">.</span><span class="ident" id="6029665">next</span><span class="op" id="6029669">(</span><span class="num" id="6029670">8</span><span class="op" id="6029671">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029675">devminor</span>&nbsp;<span class="op" id="6029684">:=</span>&nbsp;<span class="ident" id="6029687">s</span><span class="op" id="6029688">.</span><span class="ident" id="6029689">next</span><span class="op" id="6029693">(</span><span class="num" id="6029694">8</span><span class="op" id="6029695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029699">if</span>&nbsp;<span class="ident" id="6029702">hdr</span><span class="op" id="6029705">.</span><span class="ident" id="6029706">Typeflag</span>&nbsp;<span class="op" id="6029715">==</span>&nbsp;<span class="ident" id="6029718">TypeChar</span>&nbsp;<span class="op" id="6029727">||</span>&nbsp;<span class="ident" id="6029730">hdr</span><span class="op" id="6029733">.</span><span class="ident" id="6029734">Typeflag</span>&nbsp;<span class="op" id="6029743">==</span>&nbsp;<span class="ident" id="6029746">TypeBlock</span>&nbsp;<span class="op" id="6029756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029761">hdr</span><span class="op" id="6029764">.</span><span class="ident" id="6029765">Devmajor</span>&nbsp;<span class="op" id="6029774">=</span>&nbsp;<span class="ident" id="6029776">tr</span><span class="op" id="6029778">.</span><span class="ident" id="6029779">octal</span><span class="op" id="6029784">(</span><span class="ident" id="6029785">devmajor</span><span class="op" id="6029793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029798">hdr</span><span class="op" id="6029801">.</span><span class="ident" id="6029802">Devminor</span>&nbsp;<span class="op" id="6029811">=</span>&nbsp;<span class="ident" id="6029813">tr</span><span class="op" id="6029815">.</span><span class="ident" id="6029816">octal</span><span class="op" id="6029821">(</span><span class="ident" id="6029822">devminor</span><span class="op" id="6029830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029834">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029838">var</span>&nbsp;<span class="ident" id="6029842">prefix</span>&nbsp;<span class="builtintype" id="6029849">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029858">switch</span>&nbsp;<span class="ident" id="6029865">format</span>&nbsp;<span class="op" id="6029872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029876">case</span>&nbsp;<span class="string" id="6029881">&#34;posix&#34;</span><span class="op" id="6029888">,</span>&nbsp;<span class="string" id="6029890">&#34;gnu&#34;</span><span class="op" id="6029895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029900">prefix</span>&nbsp;<span class="op" id="6029907">=</span>&nbsp;<span class="ident" id="6029909">cString</span><span class="op" id="6029916">(</span><span class="ident" id="6029917">s</span><span class="op" id="6029918">.</span><span class="ident" id="6029919">next</span><span class="op" id="6029923">(</span><span class="num" id="6029924">155</span><span class="op" id="6029927">)</span><span class="op" id="6029928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029932">case</span>&nbsp;<span class="string" id="6029937">&#34;star&#34;</span><span class="op" id="6029943">:</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029948">prefix</span>&nbsp;<span class="op" id="6029955">=</span>&nbsp;<span class="ident" id="6029957">cString</span><span class="op" id="6029964">(</span><span class="ident" id="6029965">s</span><span class="op" id="6029966">.</span><span class="ident" id="6029967">next</span><span class="op" id="6029971">(</span><span class="num" id="6029972">131</span><span class="op" id="6029975">)</span><span class="op" id="6029976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029981">hdr</span><span class="op" id="6029984">.</span><span class="ident" id="6029985">AccessTime</span>&nbsp;<span class="op" id="6029996">=</span>&nbsp;<span class="ident" id="6029998">time</span><span class="op" id="6030002">.</span><span class="ident" id="6030003">Unix</span><span class="op" id="6030007">(</span><span class="ident" id="6030008">tr</span><span class="op" id="6030010">.</span><span class="ident" id="6030011">octal</span><span class="op" id="6030016">(</span><span class="ident" id="6030017">s</span><span class="op" id="6030018">.</span><span class="ident" id="6030019">next</span><span class="op" id="6030023">(</span><span class="num" id="6030024">12</span><span class="op" id="6030026">)</span><span class="op" id="6030027">)</span><span class="op" id="6030028">,</span>&nbsp;<span class="num" id="6030030">0</span><span class="op" id="6030031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030036">hdr</span><span class="op" id="6030039">.</span><span class="ident" id="6030040">ChangeTime</span>&nbsp;<span class="op" id="6030051">=</span>&nbsp;<span class="ident" id="6030053">time</span><span class="op" id="6030057">.</span><span class="ident" id="6030058">Unix</span><span class="op" id="6030062">(</span><span class="ident" id="6030063">tr</span><span class="op" id="6030065">.</span><span class="ident" id="6030066">octal</span><span class="op" id="6030071">(</span><span class="ident" id="6030072">s</span><span class="op" id="6030073">.</span><span class="ident" id="6030074">next</span><span class="op" id="6030078">(</span><span class="num" id="6030079">12</span><span class="op" id="6030081">)</span><span class="op" id="6030082">)</span><span class="op" id="6030083">,</span>&nbsp;<span class="num" id="6030085">0</span><span class="op" id="6030086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030094">if</span>&nbsp;<span class="builtinfunc" id="6030097">len</span><span class="op" id="6030100">(</span><span class="ident" id="6030101">prefix</span><span class="op" id="6030107">)</span>&nbsp;<span class="op" id="6030109">&gt;</span>&nbsp;<span class="num" id="6030111">0</span>&nbsp;<span class="op" id="6030113">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030118">hdr</span><span class="op" id="6030121">.</span><span class="ident" id="6030122">Name</span>&nbsp;<span class="op" id="6030127">=</span>&nbsp;<span class="ident" id="6030129">prefix</span>&nbsp;<span class="op" id="6030136">+</span>&nbsp;<span class="string" id="6030138">&#34;/&#34;</span>&nbsp;<span class="op" id="6030142">+</span>&nbsp;<span class="ident" id="6030144">hdr</span><span class="op" id="6030147">.</span><span class="ident" id="6030148">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030162">if</span>&nbsp;<span class="ident" id="6030165">tr</span><span class="op" id="6030167">.</span><span class="ident" id="6030168">err</span>&nbsp;<span class="op" id="6030172">!=</span>&nbsp;<span class="ident" id="6030175">nil</span>&nbsp;<span class="op" id="6030179">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030183">tr</span><span class="op" id="6030185">.</span><span class="ident" id="6030186">err</span>&nbsp;<span class="op" id="6030190">=</span>&nbsp;<span class="ident" id="6030192">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030204">return</span>&nbsp;<span class="ident" id="6030211">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030220">//&nbsp;Maximum&nbsp;value&nbsp;of&nbsp;hdr.Size&nbsp;is&nbsp;64&nbsp;GB&nbsp;(12&nbsp;octal&nbsp;digits),</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030278">//&nbsp;so&nbsp;there&#39;s&nbsp;no&nbsp;risk&nbsp;of&nbsp;int64&nbsp;overflowing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030323">nb</span>&nbsp;<span class="op" id="6030326">:=</span>&nbsp;<span class="ident" id="6030329">int64</span><span class="op" id="6030334">(</span><span class="ident" id="6030335">hdr</span><span class="op" id="6030338">.</span><span class="ident" id="6030339">Size</span><span class="op" id="6030343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030346">tr</span><span class="op" id="6030348">.</span><span class="ident" id="6030349">pad</span>&nbsp;<span class="op" id="6030353">=</span>&nbsp;<span class="op" id="6030355">-</span><span class="ident" id="6030356">nb</span>&nbsp;<span class="op" id="6030359">&amp;</span>&nbsp;<span class="op" id="6030361">(</span><span class="ident" id="6030362">blockSize</span>&nbsp;<span class="op" id="6030372">-</span>&nbsp;<span class="num" id="6030374">1</span><span class="op" id="6030375">)</span>&nbsp;<span class="comment" id="6030377">//&nbsp;blockSize&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;two</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030410">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030443">tr</span><span class="op" id="6030445">.</span><span class="ident" id="6030446">curr</span>&nbsp;<span class="op" id="6030451">=</span>&nbsp;<span class="op" id="6030453">&amp;</span><span class="ident" id="6030454">regFileReader</span><span class="op" id="6030467">{</span><span class="ident" id="6030468">r</span><span class="op" id="6030469">:</span>&nbsp;<span class="ident" id="6030471">tr</span><span class="op" id="6030473">.</span><span class="ident" id="6030474">r</span><span class="op" id="6030475">,</span>&nbsp;<span class="ident" id="6030477">nb</span><span class="op" id="6030479">:</span>&nbsp;<span class="ident" id="6030481">nb</span><span class="op" id="6030483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030487">//&nbsp;Check&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030530">if</span>&nbsp;<span class="ident" id="6030533">hdr</span><span class="op" id="6030536">.</span><span class="ident" id="6030537">Typeflag</span>&nbsp;<span class="op" id="6030546">==</span>&nbsp;<span class="ident" id="6030549">TypeGNUSparse</span>&nbsp;<span class="op" id="6030563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030567">//&nbsp;Get&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030603">hdr</span><span class="op" id="6030606">.</span><span class="ident" id="6030607">Size</span>&nbsp;<span class="op" id="6030612">=</span>&nbsp;<span class="ident" id="6030614">tr</span><span class="op" id="6030616">.</span><span class="ident" id="6030617">octal</span><span class="op" id="6030622">(</span><span class="ident" id="6030623">header</span><span class="op" id="6030629">[</span><span class="num" id="6030630">483</span><span class="op" id="6030633">:</span><span class="num" id="6030634">495</span><span class="op" id="6030637">]</span><span class="op" id="6030638">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030643">//&nbsp;Read&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030669">sp</span>&nbsp;<span class="op" id="6030672">:=</span>&nbsp;<span class="ident" id="6030675">tr</span><span class="op" id="6030677">.</span><span class="ident" id="6030678">readOldGNUSparseMap</span><span class="op" id="6030697">(</span><span class="ident" id="6030698">header</span><span class="op" id="6030704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030708">if</span>&nbsp;<span class="ident" id="6030711">tr</span><span class="op" id="6030713">.</span><span class="ident" id="6030714">err</span>&nbsp;<span class="op" id="6030718">!=</span>&nbsp;<span class="ident" id="6030721">nil</span>&nbsp;<span class="op" id="6030725">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030730">return</span>&nbsp;<span class="ident" id="6030737">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030747">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;GNU&nbsp;sparse&nbsp;file.&nbsp;Update&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030819">tr</span><span class="op" id="6030821">.</span><span class="ident" id="6030822">curr</span>&nbsp;<span class="op" id="6030827">=</span>&nbsp;<span class="op" id="6030829">&amp;</span><span class="ident" id="6030830">sparseFileReader</span><span class="op" id="6030846">{</span><span class="ident" id="6030847">rfr</span><span class="op" id="6030850">:</span>&nbsp;<span class="ident" id="6030852">tr</span><span class="op" id="6030854">.</span><span class="ident" id="6030855">curr</span><span class="op" id="6030859">.</span><span class="op" id="6030860">(</span><span class="op" id="6030861">*</span><span class="ident" id="6030862">regFileReader</span><span class="op" id="6030875">)</span><span class="op" id="6030876">,</span>&nbsp;<span class="ident" id="6030878">sp</span><span class="op" id="6030880">:</span>&nbsp;<span class="ident" id="6030882">sp</span><span class="op" id="6030884">,</span>&nbsp;<span class="ident" id="6030886">tot</span><span class="op" id="6030889">:</span>&nbsp;<span class="ident" id="6030891">hdr</span><span class="op" id="6030894">.</span><span class="ident" id="6030895">Size</span><span class="op" id="6030899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030902">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030906">return</span>&nbsp;<span class="ident" id="6030913">hdr</span><br>
<span class="lineno"></span><span class="op" id="6030917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6030920">//&nbsp;A&nbsp;sparseEntry&nbsp;holds&nbsp;a&nbsp;single&nbsp;entry&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&#39;s&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">540</span><span class="comment" id="6030989">//&nbsp;A&nbsp;sparse&nbsp;entry&nbsp;indicates&nbsp;the&nbsp;offset&nbsp;and&nbsp;size&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6031059">//&nbsp;block&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6031077">type</span>&nbsp;<span class="ident" id="6031082">sparseEntry</span>&nbsp;<span class="keyword" id="6031094">struct</span>&nbsp;<span class="op" id="6031101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031104">offset</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6031113">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031120">numBytes</span>&nbsp;<span class="ident" id="6031129">int64</span><br>
<span class="lineno">545</span><span class="op" id="6031135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6031138">//&nbsp;readOldGNUSparseMap&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;the&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="6031222">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;tar&nbsp;header&nbsp;if&nbsp;it&#39;s&nbsp;small&nbsp;enough.&nbsp;If&nbsp;it&#39;s&nbsp;larger&nbsp;than&nbsp;four&nbsp;entries,</span><br>
<span class="lineno"></span><span class="comment" id="6031324">//&nbsp;then&nbsp;one&nbsp;or&nbsp;more&nbsp;extension&nbsp;headers&nbsp;are&nbsp;used&nbsp;to&nbsp;store&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">550</span><span class="keyword" id="6031408">func</span>&nbsp;<span class="op" id="6031413">(</span><span class="ident" id="6031414">tr</span>&nbsp;<span class="op" id="6031417">*</span><span class="ident" id="6031418">Reader</span><span class="op" id="6031424">)</span>&nbsp;<span class="ident" id="6031426">readOldGNUSparseMap</span><span class="op" id="6031445">(</span><span class="ident" id="6031446">header</span>&nbsp;<span class="op" id="6031453">[</span><span class="op" id="6031454">]</span><span class="builtintype" id="6031455">byte</span><span class="op" id="6031459">)</span>&nbsp;<span class="op" id="6031461">[</span><span class="op" id="6031462">]</span><span class="ident" id="6031463">sparseEntry</span>&nbsp;<span class="op" id="6031475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031478">isExtended</span>&nbsp;<span class="op" id="6031489">:=</span>&nbsp;<span class="ident" id="6031492">header</span><span class="op" id="6031498">[</span><span class="ident" id="6031499">oldGNUSparseMainHeaderIsExtendedOffset</span><span class="op" id="6031537">]</span>&nbsp;<span class="op" id="6031539">!=</span>&nbsp;<span class="num" id="6031542">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031545">spCap</span>&nbsp;<span class="op" id="6031551">:=</span>&nbsp;<span class="ident" id="6031554">oldGNUSparseMainHeaderNumEntries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031588">if</span>&nbsp;<span class="ident" id="6031591">isExtended</span>&nbsp;<span class="op" id="6031602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031606">spCap</span>&nbsp;<span class="op" id="6031612">+=</span>&nbsp;<span class="ident" id="6031615">oldGNUSparseExtendedHeaderNumEntries</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6031653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031656">sp</span>&nbsp;<span class="op" id="6031659">:=</span>&nbsp;<span class="builtinfunc" id="6031662">make</span><span class="op" id="6031666">(</span><span class="op" id="6031667">[</span><span class="op" id="6031668">]</span><span class="ident" id="6031669">sparseEntry</span><span class="op" id="6031680">,</span>&nbsp;<span class="num" id="6031682">0</span><span class="op" id="6031683">,</span>&nbsp;<span class="ident" id="6031685">spCap</span><span class="op" id="6031690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031693">s</span>&nbsp;<span class="op" id="6031695">:=</span>&nbsp;<span class="ident" id="6031698">slicer</span><span class="op" id="6031704">(</span><span class="ident" id="6031705">header</span><span class="op" id="6031711">[</span><span class="ident" id="6031712">oldGNUSparseMainHeaderOffset</span><span class="op" id="6031740">:</span><span class="op" id="6031741">]</span><span class="op" id="6031742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031746">//&nbsp;Read&nbsp;the&nbsp;four&nbsp;entries&nbsp;from&nbsp;the&nbsp;main&nbsp;tar&nbsp;header</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031797">for</span>&nbsp;<span class="ident" id="6031801">i</span>&nbsp;<span class="op" id="6031803">:=</span>&nbsp;<span class="num" id="6031806">0</span><span class="op" id="6031807">;</span>&nbsp;<span class="ident" id="6031809">i</span>&nbsp;<span class="op" id="6031811">&lt;</span>&nbsp;<span class="ident" id="6031813">oldGNUSparseMainHeaderNumEntries</span><span class="op" id="6031845">;</span>&nbsp;<span class="ident" id="6031847">i</span><span class="op" id="6031848">++</span>&nbsp;<span class="op" id="6031851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031855">offset</span>&nbsp;<span class="op" id="6031862">:=</span>&nbsp;<span class="ident" id="6031865">tr</span><span class="op" id="6031867">.</span><span class="ident" id="6031868">octal</span><span class="op" id="6031873">(</span><span class="ident" id="6031874">s</span><span class="op" id="6031875">.</span><span class="ident" id="6031876">next</span><span class="op" id="6031880">(</span><span class="ident" id="6031881">oldGNUSparseOffsetSize</span><span class="op" id="6031903">)</span><span class="op" id="6031904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031908">numBytes</span>&nbsp;<span class="op" id="6031917">:=</span>&nbsp;<span class="ident" id="6031920">tr</span><span class="op" id="6031922">.</span><span class="ident" id="6031923">octal</span><span class="op" id="6031928">(</span><span class="ident" id="6031929">s</span><span class="op" id="6031930">.</span><span class="ident" id="6031931">next</span><span class="op" id="6031935">(</span><span class="ident" id="6031936">oldGNUSparseNumBytesSize</span><span class="op" id="6031960">)</span><span class="op" id="6031961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031965">if</span>&nbsp;<span class="ident" id="6031968">tr</span><span class="op" id="6031970">.</span><span class="ident" id="6031971">err</span>&nbsp;<span class="op" id="6031975">!=</span>&nbsp;<span class="ident" id="6031978">nil</span>&nbsp;<span class="op" id="6031982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031987">tr</span><span class="op" id="6031989">.</span><span class="ident" id="6031990">err</span>&nbsp;<span class="op" id="6031994">=</span>&nbsp;<span class="ident" id="6031996">ErrHeader</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032009">return</span>&nbsp;<span class="ident" id="6032016">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032026">if</span>&nbsp;<span class="ident" id="6032029">offset</span>&nbsp;<span class="op" id="6032036">==</span>&nbsp;<span class="num" id="6032039">0</span>&nbsp;<span class="op" id="6032041">&amp;&amp;</span>&nbsp;<span class="ident" id="6032044">numBytes</span>&nbsp;<span class="op" id="6032053">==</span>&nbsp;<span class="num" id="6032056">0</span>&nbsp;<span class="op" id="6032058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032063">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032071">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032075">sp</span>&nbsp;<span class="op" id="6032078">=</span>&nbsp;<span class="builtinfunc" id="6032080">append</span><span class="op" id="6032086">(</span><span class="ident" id="6032087">sp</span><span class="op" id="6032089">,</span>&nbsp;<span class="ident" id="6032091">sparseEntry</span><span class="op" id="6032102">{</span><span class="ident" id="6032103">offset</span><span class="op" id="6032109">:</span>&nbsp;<span class="ident" id="6032111">offset</span><span class="op" id="6032117">,</span>&nbsp;<span class="ident" id="6032119">numBytes</span><span class="op" id="6032127">:</span>&nbsp;<span class="ident" id="6032129">numBytes</span><span class="op" id="6032137">}</span><span class="op" id="6032138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032145">for</span>&nbsp;<span class="ident" id="6032149">isExtended</span>&nbsp;<span class="op" id="6032160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032164">//&nbsp;There&nbsp;are&nbsp;more&nbsp;entries.&nbsp;Read&nbsp;an&nbsp;extension&nbsp;header&nbsp;and&nbsp;parse&nbsp;its&nbsp;entries.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032241">sparseHeader</span>&nbsp;<span class="op" id="6032254">:=</span>&nbsp;<span class="builtinfunc" id="6032257">make</span><span class="op" id="6032261">(</span><span class="op" id="6032262">[</span><span class="op" id="6032263">]</span><span class="builtintype" id="6032264">byte</span><span class="op" id="6032268">,</span>&nbsp;<span class="ident" id="6032270">blockSize</span><span class="op" id="6032279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032283">if</span>&nbsp;<span class="ident" id="6032286">_</span><span class="op" id="6032287">,</span>&nbsp;<span class="ident" id="6032289">tr</span><span class="op" id="6032291">.</span><span class="ident" id="6032292">err</span>&nbsp;<span class="op" id="6032296">=</span>&nbsp;<span class="ident" id="6032298">io</span><span class="op" id="6032300">.</span><span class="ident" id="6032301">ReadFull</span><span class="op" id="6032309">(</span><span class="ident" id="6032310">tr</span><span class="op" id="6032312">.</span><span class="ident" id="6032313">r</span><span class="op" id="6032314">,</span>&nbsp;<span class="ident" id="6032316">sparseHeader</span><span class="op" id="6032328">)</span><span class="op" id="6032329">;</span>&nbsp;<span class="ident" id="6032331">tr</span><span class="op" id="6032333">.</span><span class="ident" id="6032334">err</span>&nbsp;<span class="op" id="6032338">!=</span>&nbsp;<span class="ident" id="6032341">nil</span>&nbsp;<span class="op" id="6032345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032350">return</span>&nbsp;<span class="ident" id="6032357">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032367">isExtended</span>&nbsp;<span class="op" id="6032378">=</span>&nbsp;<span class="ident" id="6032380">sparseHeader</span><span class="op" id="6032392">[</span><span class="ident" id="6032393">oldGNUSparseExtendedHeaderIsExtendedOffset</span><span class="op" id="6032435">]</span>&nbsp;<span class="op" id="6032437">!=</span>&nbsp;<span class="num" id="6032440">0</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032444">s</span>&nbsp;<span class="op" id="6032446">=</span>&nbsp;<span class="ident" id="6032448">slicer</span><span class="op" id="6032454">(</span><span class="ident" id="6032455">sparseHeader</span><span class="op" id="6032467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032471">for</span>&nbsp;<span class="ident" id="6032475">i</span>&nbsp;<span class="op" id="6032477">:=</span>&nbsp;<span class="num" id="6032480">0</span><span class="op" id="6032481">;</span>&nbsp;<span class="ident" id="6032483">i</span>&nbsp;<span class="op" id="6032485">&lt;</span>&nbsp;<span class="ident" id="6032487">oldGNUSparseExtendedHeaderNumEntries</span><span class="op" id="6032523">;</span>&nbsp;<span class="ident" id="6032525">i</span><span class="op" id="6032526">++</span>&nbsp;<span class="op" id="6032529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032534">offset</span>&nbsp;<span class="op" id="6032541">:=</span>&nbsp;<span class="ident" id="6032544">tr</span><span class="op" id="6032546">.</span><span class="ident" id="6032547">octal</span><span class="op" id="6032552">(</span><span class="ident" id="6032553">s</span><span class="op" id="6032554">.</span><span class="ident" id="6032555">next</span><span class="op" id="6032559">(</span><span class="ident" id="6032560">oldGNUSparseOffsetSize</span><span class="op" id="6032582">)</span><span class="op" id="6032583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032588">numBytes</span>&nbsp;<span class="op" id="6032597">:=</span>&nbsp;<span class="ident" id="6032600">tr</span><span class="op" id="6032602">.</span><span class="ident" id="6032603">octal</span><span class="op" id="6032608">(</span><span class="ident" id="6032609">s</span><span class="op" id="6032610">.</span><span class="ident" id="6032611">next</span><span class="op" id="6032615">(</span><span class="ident" id="6032616">oldGNUSparseNumBytesSize</span><span class="op" id="6032640">)</span><span class="op" id="6032641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032646">if</span>&nbsp;<span class="ident" id="6032649">tr</span><span class="op" id="6032651">.</span><span class="ident" id="6032652">err</span>&nbsp;<span class="op" id="6032656">!=</span>&nbsp;<span class="ident" id="6032659">nil</span>&nbsp;<span class="op" id="6032663">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032669">tr</span><span class="op" id="6032671">.</span><span class="ident" id="6032672">err</span>&nbsp;<span class="op" id="6032676">=</span>&nbsp;<span class="ident" id="6032678">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032692">return</span>&nbsp;<span class="ident" id="6032699">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032711">if</span>&nbsp;<span class="ident" id="6032714">offset</span>&nbsp;<span class="op" id="6032721">==</span>&nbsp;<span class="num" id="6032724">0</span>&nbsp;<span class="op" id="6032726">&amp;&amp;</span>&nbsp;<span class="ident" id="6032729">numBytes</span>&nbsp;<span class="op" id="6032738">==</span>&nbsp;<span class="num" id="6032741">0</span>&nbsp;<span class="op" id="6032743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032749">break</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032763">sp</span>&nbsp;<span class="op" id="6032766">=</span>&nbsp;<span class="builtinfunc" id="6032768">append</span><span class="op" id="6032774">(</span><span class="ident" id="6032775">sp</span><span class="op" id="6032777">,</span>&nbsp;<span class="ident" id="6032779">sparseEntry</span><span class="op" id="6032790">{</span><span class="ident" id="6032791">offset</span><span class="op" id="6032797">:</span>&nbsp;<span class="ident" id="6032799">offset</span><span class="op" id="6032805">,</span>&nbsp;<span class="ident" id="6032807">numBytes</span><span class="op" id="6032815">:</span>&nbsp;<span class="ident" id="6032817">numBytes</span><span class="op" id="6032825">}</span><span class="op" id="6032826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032836">return</span>&nbsp;<span class="ident" id="6032843">sp</span><br>
<span class="lineno">595</span><span class="op" id="6032846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6032849">//&nbsp;readGNUSparseMap1x0&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;1.0.</span><br>
<span class="lineno"></span><span class="comment" id="6032943">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;just&nbsp;before&nbsp;the&nbsp;file&nbsp;data&nbsp;and&nbsp;padded&nbsp;out&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="6033043">func</span>&nbsp;<span class="ident" id="6033048">readGNUSparseMap1x0</span><span class="op" id="6033067">(</span><span class="ident" id="6033068">r</span>&nbsp;<span class="ident" id="6033070">io</span><span class="op" id="6033072">.</span><span class="ident" id="6033073">Reader</span><span class="op" id="6033079">)</span>&nbsp;<span class="op" id="6033081">(</span><span class="op" id="6033082">[</span><span class="op" id="6033083">]</span><span class="ident" id="6033084">sparseEntry</span><span class="op" id="6033095">,</span>&nbsp;<span class="builtintype" id="6033097">error</span><span class="op" id="6033102">)</span>&nbsp;<span class="op" id="6033104">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033107">buf</span>&nbsp;<span class="op" id="6033111">:=</span>&nbsp;<span class="builtinfunc" id="6033114">make</span><span class="op" id="6033118">(</span><span class="op" id="6033119">[</span><span class="op" id="6033120">]</span><span class="builtintype" id="6033121">byte</span><span class="op" id="6033125">,</span>&nbsp;<span class="num" id="6033127">2</span><span class="op" id="6033128">*</span><span class="ident" id="6033129">blockSize</span><span class="op" id="6033138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033141">sparseHeader</span>&nbsp;<span class="op" id="6033154">:=</span>&nbsp;<span class="ident" id="6033157">buf</span><span class="op" id="6033160">[</span><span class="op" id="6033161">:</span><span class="ident" id="6033162">blockSize</span><span class="op" id="6033171">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6033175">//&nbsp;readDecimal&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;to&nbsp;read&nbsp;a&nbsp;decimal&nbsp;integer&nbsp;from&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6033258">//&nbsp;while&nbsp;making&nbsp;sure&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;file&nbsp;in&nbsp;blocks&nbsp;of&nbsp;size&nbsp;blockSize</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033330">readDecimal</span>&nbsp;<span class="op" id="6033342">:=</span>&nbsp;<span class="keyword" id="6033345">func</span><span class="op" id="6033349">(</span><span class="op" id="6033350">)</span>&nbsp;<span class="op" id="6033352">(</span><span class="ident" id="6033353">int64</span><span class="op" id="6033358">,</span>&nbsp;<span class="builtintype" id="6033360">error</span><span class="op" id="6033365">)</span>&nbsp;<span class="op" id="6033367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6033371">//&nbsp;Look&nbsp;for&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033393">nl</span>&nbsp;<span class="op" id="6033396">:=</span>&nbsp;<span class="ident" id="6033399">bytes</span><span class="op" id="6033404">.</span><span class="ident" id="6033405">IndexByte</span><span class="op" id="6033414">(</span><span class="ident" id="6033415">sparseHeader</span><span class="op" id="6033427">,</span>&nbsp;<span class="string" id="6033429">&#39;\n&#39;</span><span class="op" id="6033433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033437">if</span>&nbsp;<span class="ident" id="6033440">nl</span>&nbsp;<span class="op" id="6033443">==</span>&nbsp;<span class="op" id="6033446">-</span><span class="num" id="6033447">1</span>&nbsp;<span class="op" id="6033449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033454">if</span>&nbsp;<span class="builtinfunc" id="6033457">len</span><span class="op" id="6033460">(</span><span class="ident" id="6033461">sparseHeader</span><span class="op" id="6033473">)</span>&nbsp;<span class="op" id="6033475">&gt;=</span>&nbsp;<span class="ident" id="6033478">blockSize</span>&nbsp;<span class="op" id="6033488">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6033494">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033518">return</span>&nbsp;<span class="num" id="6033525">0</span><span class="op" id="6033526">,</span>&nbsp;<span class="ident" id="6033528">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033546">oldLen</span>&nbsp;<span class="op" id="6033553">:=</span>&nbsp;<span class="builtinfunc" id="6033556">len</span><span class="op" id="6033559">(</span><span class="ident" id="6033560">sparseHeader</span><span class="op" id="6033572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033577">newLen</span>&nbsp;<span class="op" id="6033584">:=</span>&nbsp;<span class="ident" id="6033587">oldLen</span>&nbsp;<span class="op" id="6033594">+</span>&nbsp;<span class="ident" id="6033596">blockSize</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033609">if</span>&nbsp;<span class="builtinfunc" id="6033612">cap</span><span class="op" id="6033615">(</span><span class="ident" id="6033616">sparseHeader</span><span class="op" id="6033628">)</span>&nbsp;<span class="op" id="6033630">&lt;</span>&nbsp;<span class="ident" id="6033632">newLen</span>&nbsp;<span class="op" id="6033639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6033645">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;the&nbsp;next&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6033717">copy</span><span class="op" id="6033721">(</span><span class="ident" id="6033722">buf</span><span class="op" id="6033725">,</span>&nbsp;<span class="ident" id="6033727">sparseHeader</span><span class="op" id="6033739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033745">sparseHeader</span>&nbsp;<span class="op" id="6033758">=</span>&nbsp;<span class="ident" id="6033760">buf</span><span class="op" id="6033763">[</span><span class="op" id="6033764">:</span><span class="ident" id="6033765">newLen</span><span class="op" id="6033771">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033776">}</span>&nbsp;<span class="keyword" id="6033778">else</span>&nbsp;<span class="op" id="6033783">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6033789">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;and&nbsp;we&nbsp;can&nbsp;just&nbsp;reslice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033841">sparseHeader</span>&nbsp;<span class="op" id="6033854">=</span>&nbsp;<span class="ident" id="6033856">sparseHeader</span><span class="op" id="6033868">[</span><span class="op" id="6033869">:</span><span class="ident" id="6033870">newLen</span><span class="op" id="6033876">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6033887">//&nbsp;Now&nbsp;that&nbsp;sparseHeader&nbsp;is&nbsp;large&nbsp;enough,&nbsp;read&nbsp;next&nbsp;block</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033948">if</span>&nbsp;<span class="ident" id="6033951">_</span><span class="op" id="6033952">,</span>&nbsp;<span class="ident" id="6033954">err</span>&nbsp;<span class="op" id="6033958">:=</span>&nbsp;<span class="ident" id="6033961">io</span><span class="op" id="6033963">.</span><span class="ident" id="6033964">ReadFull</span><span class="op" id="6033972">(</span><span class="ident" id="6033973">r</span><span class="op" id="6033974">,</span>&nbsp;<span class="ident" id="6033976">sparseHeader</span><span class="op" id="6033988">[</span><span class="ident" id="6033989">oldLen</span><span class="op" id="6033995">:</span><span class="ident" id="6033996">newLen</span><span class="op" id="6034002">]</span><span class="op" id="6034003">)</span><span class="op" id="6034004">;</span>&nbsp;<span class="ident" id="6034006">err</span>&nbsp;<span class="op" id="6034010">!=</span>&nbsp;<span class="ident" id="6034013">nil</span>&nbsp;<span class="op" id="6034017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034023">return</span>&nbsp;<span class="num" id="6034030">0</span><span class="op" id="6034031">,</span>&nbsp;<span class="ident" id="6034033">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034046">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;newline&nbsp;in&nbsp;the&nbsp;new&nbsp;data</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034087">nl</span>&nbsp;<span class="op" id="6034090">=</span>&nbsp;<span class="ident" id="6034092">bytes</span><span class="op" id="6034097">.</span><span class="ident" id="6034098">IndexByte</span><span class="op" id="6034107">(</span><span class="ident" id="6034108">sparseHeader</span><span class="op" id="6034120">[</span><span class="ident" id="6034121">oldLen</span><span class="op" id="6034127">:</span><span class="ident" id="6034128">newLen</span><span class="op" id="6034134">]</span><span class="op" id="6034135">,</span>&nbsp;<span class="string" id="6034137">&#39;\n&#39;</span><span class="op" id="6034141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034146">if</span>&nbsp;<span class="ident" id="6034149">nl</span>&nbsp;<span class="op" id="6034152">==</span>&nbsp;<span class="op" id="6034155">-</span><span class="num" id="6034156">1</span>&nbsp;<span class="op" id="6034158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034164">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034188">return</span>&nbsp;<span class="num" id="6034195">0</span><span class="op" id="6034196">,</span>&nbsp;<span class="ident" id="6034198">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034211">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034216">nl</span>&nbsp;<span class="op" id="6034219">+=</span>&nbsp;<span class="ident" id="6034222">oldLen</span>&nbsp;<span class="comment" id="6034229">//&nbsp;We&nbsp;want&nbsp;the&nbsp;position&nbsp;from&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034278">//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;found&nbsp;a&nbsp;newline,&nbsp;read&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034329">n</span><span class="op" id="6034330">,</span>&nbsp;<span class="ident" id="6034332">err</span>&nbsp;<span class="op" id="6034336">:=</span>&nbsp;<span class="ident" id="6034339">strconv</span><span class="op" id="6034346">.</span><span class="ident" id="6034347">ParseInt</span><span class="op" id="6034355">(</span><span class="builtintype" id="6034356">string</span><span class="op" id="6034362">(</span><span class="ident" id="6034363">sparseHeader</span><span class="op" id="6034375">[</span><span class="op" id="6034376">:</span><span class="ident" id="6034377">nl</span><span class="op" id="6034379">]</span><span class="op" id="6034380">)</span><span class="op" id="6034381">,</span>&nbsp;<span class="num" id="6034383">10</span><span class="op" id="6034385">,</span>&nbsp;<span class="num" id="6034387">0</span><span class="op" id="6034388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034392">if</span>&nbsp;<span class="ident" id="6034395">err</span>&nbsp;<span class="op" id="6034399">!=</span>&nbsp;<span class="ident" id="6034402">nil</span>&nbsp;<span class="op" id="6034406">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034411">return</span>&nbsp;<span class="num" id="6034418">0</span><span class="op" id="6034419">,</span>&nbsp;<span class="ident" id="6034421">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034438">//&nbsp;Update&nbsp;sparseHeader&nbsp;to&nbsp;consume&nbsp;this&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034486">sparseHeader</span>&nbsp;<span class="op" id="6034499">=</span>&nbsp;<span class="ident" id="6034501">sparseHeader</span><span class="op" id="6034513">[</span><span class="ident" id="6034514">nl</span><span class="op" id="6034516">+</span><span class="num" id="6034517">1</span><span class="op" id="6034518">:</span><span class="op" id="6034519">]</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034523">return</span>&nbsp;<span class="ident" id="6034530">n</span><span class="op" id="6034531">,</span>&nbsp;<span class="ident" id="6034533">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034542">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034567">if</span>&nbsp;<span class="ident" id="6034570">_</span><span class="op" id="6034571">,</span>&nbsp;<span class="ident" id="6034573">err</span>&nbsp;<span class="op" id="6034577">:=</span>&nbsp;<span class="ident" id="6034580">io</span><span class="op" id="6034582">.</span><span class="ident" id="6034583">ReadFull</span><span class="op" id="6034591">(</span><span class="ident" id="6034592">r</span><span class="op" id="6034593">,</span>&nbsp;<span class="ident" id="6034595">sparseHeader</span><span class="op" id="6034607">)</span><span class="op" id="6034608">;</span>&nbsp;<span class="ident" id="6034610">err</span>&nbsp;<span class="op" id="6034614">!=</span>&nbsp;<span class="ident" id="6034617">nil</span>&nbsp;<span class="op" id="6034621">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034625">return</span>&nbsp;<span class="ident" id="6034632">nil</span><span class="op" id="6034635">,</span>&nbsp;<span class="ident" id="6034637">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034646">//&nbsp;The&nbsp;first&nbsp;line&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034696">numEntries</span><span class="op" id="6034706">,</span>&nbsp;<span class="ident" id="6034708">err</span>&nbsp;<span class="op" id="6034712">:=</span>&nbsp;<span class="ident" id="6034715">readDecimal</span><span class="op" id="6034726">(</span><span class="op" id="6034727">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034730">if</span>&nbsp;<span class="ident" id="6034733">err</span>&nbsp;<span class="op" id="6034737">!=</span>&nbsp;<span class="ident" id="6034740">nil</span>&nbsp;<span class="op" id="6034744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034748">return</span>&nbsp;<span class="ident" id="6034755">nil</span><span class="op" id="6034758">,</span>&nbsp;<span class="ident" id="6034760">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034769">//&nbsp;Read&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034794">sp</span>&nbsp;<span class="op" id="6034797">:=</span>&nbsp;<span class="builtinfunc" id="6034800">make</span><span class="op" id="6034804">(</span><span class="op" id="6034805">[</span><span class="op" id="6034806">]</span><span class="ident" id="6034807">sparseEntry</span><span class="op" id="6034818">,</span>&nbsp;<span class="num" id="6034820">0</span><span class="op" id="6034821">,</span>&nbsp;<span class="ident" id="6034823">numEntries</span><span class="op" id="6034833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034836">for</span>&nbsp;<span class="ident" id="6034840">i</span>&nbsp;<span class="op" id="6034842">:=</span>&nbsp;<span class="ident" id="6034845">int64</span><span class="op" id="6034850">(</span><span class="num" id="6034851">0</span><span class="op" id="6034852">)</span><span class="op" id="6034853">;</span>&nbsp;<span class="ident" id="6034855">i</span>&nbsp;<span class="op" id="6034857">&lt;</span>&nbsp;<span class="ident" id="6034859">numEntries</span><span class="op" id="6034869">;</span>&nbsp;<span class="ident" id="6034871">i</span><span class="op" id="6034872">++</span>&nbsp;<span class="op" id="6034875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034879">//&nbsp;Read&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034900">offset</span><span class="op" id="6034906">,</span>&nbsp;<span class="ident" id="6034908">err</span>&nbsp;<span class="op" id="6034912">:=</span>&nbsp;<span class="ident" id="6034915">readDecimal</span><span class="op" id="6034926">(</span><span class="op" id="6034927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034931">if</span>&nbsp;<span class="ident" id="6034934">err</span>&nbsp;<span class="op" id="6034938">!=</span>&nbsp;<span class="ident" id="6034941">nil</span>&nbsp;<span class="op" id="6034945">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034950">return</span>&nbsp;<span class="ident" id="6034957">nil</span><span class="op" id="6034960">,</span>&nbsp;<span class="ident" id="6034962">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034972">//&nbsp;Read&nbsp;numBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034991">numBytes</span><span class="op" id="6034999">,</span>&nbsp;<span class="ident" id="6035001">err</span>&nbsp;<span class="op" id="6035005">:=</span>&nbsp;<span class="ident" id="6035008">readDecimal</span><span class="op" id="6035019">(</span><span class="op" id="6035020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035024">if</span>&nbsp;<span class="ident" id="6035027">err</span>&nbsp;<span class="op" id="6035031">!=</span>&nbsp;<span class="ident" id="6035034">nil</span>&nbsp;<span class="op" id="6035038">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035043">return</span>&nbsp;<span class="ident" id="6035050">nil</span><span class="op" id="6035053">,</span>&nbsp;<span class="ident" id="6035055">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035066">sp</span>&nbsp;<span class="op" id="6035069">=</span>&nbsp;<span class="builtinfunc" id="6035071">append</span><span class="op" id="6035077">(</span><span class="ident" id="6035078">sp</span><span class="op" id="6035080">,</span>&nbsp;<span class="ident" id="6035082">sparseEntry</span><span class="op" id="6035093">{</span><span class="ident" id="6035094">offset</span><span class="op" id="6035100">:</span>&nbsp;<span class="ident" id="6035102">offset</span><span class="op" id="6035108">,</span>&nbsp;<span class="ident" id="6035110">numBytes</span><span class="op" id="6035118">:</span>&nbsp;<span class="ident" id="6035120">numBytes</span><span class="op" id="6035128">}</span><span class="op" id="6035129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035132">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035136">return</span>&nbsp;<span class="ident" id="6035143">sp</span><span class="op" id="6035145">,</span>&nbsp;<span class="ident" id="6035147">nil</span><br>
<span class="lineno"></span><span class="op" id="6035151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6035154">//&nbsp;readGNUSparseMap0x1&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;0.1.</span><br>
<span class="lineno">680</span><span class="comment" id="6035248">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="6035296">func</span>&nbsp;<span class="ident" id="6035301">readGNUSparseMap0x1</span><span class="op" id="6035320">(</span><span class="ident" id="6035321">headers</span>&nbsp;<span class="keyword" id="6035329">map</span><span class="op" id="6035332">[</span><span class="builtintype" id="6035333">string</span><span class="op" id="6035339">]</span><span class="builtintype" id="6035340">string</span><span class="op" id="6035346">)</span>&nbsp;<span class="op" id="6035348">(</span><span class="op" id="6035349">[</span><span class="op" id="6035350">]</span><span class="ident" id="6035351">sparseEntry</span><span class="op" id="6035362">,</span>&nbsp;<span class="builtintype" id="6035364">error</span><span class="op" id="6035369">)</span>&nbsp;<span class="op" id="6035371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035374">//&nbsp;Get&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035400">numEntriesStr</span><span class="op" id="6035413">,</span>&nbsp;<span class="ident" id="6035415">ok</span>&nbsp;<span class="op" id="6035418">:=</span>&nbsp;<span class="ident" id="6035421">headers</span><span class="op" id="6035428">[</span><span class="ident" id="6035429">paxGNUSparseNumBlocks</span><span class="op" id="6035450">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035453">if</span>&nbsp;<span class="op" id="6035456">!</span><span class="ident" id="6035457">ok</span>&nbsp;<span class="op" id="6035460">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035464">return</span>&nbsp;<span class="ident" id="6035471">nil</span><span class="op" id="6035474">,</span>&nbsp;<span class="ident" id="6035476">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035490">numEntries</span><span class="op" id="6035500">,</span>&nbsp;<span class="ident" id="6035502">err</span>&nbsp;<span class="op" id="6035506">:=</span>&nbsp;<span class="ident" id="6035509">strconv</span><span class="op" id="6035516">.</span><span class="ident" id="6035517">ParseInt</span><span class="op" id="6035525">(</span><span class="ident" id="6035526">numEntriesStr</span><span class="op" id="6035539">,</span>&nbsp;<span class="num" id="6035541">10</span><span class="op" id="6035543">,</span>&nbsp;<span class="num" id="6035545">0</span><span class="op" id="6035546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035549">if</span>&nbsp;<span class="ident" id="6035552">err</span>&nbsp;<span class="op" id="6035556">!=</span>&nbsp;<span class="ident" id="6035559">nil</span>&nbsp;<span class="op" id="6035563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035567">return</span>&nbsp;<span class="ident" id="6035574">nil</span><span class="op" id="6035577">,</span>&nbsp;<span class="ident" id="6035579">ErrHeader</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035594">sparseMap</span>&nbsp;<span class="op" id="6035604">:=</span>&nbsp;<span class="ident" id="6035607">strings</span><span class="op" id="6035614">.</span><span class="ident" id="6035615">Split</span><span class="op" id="6035620">(</span><span class="ident" id="6035621">headers</span><span class="op" id="6035628">[</span><span class="ident" id="6035629">paxGNUSparseMap</span><span class="op" id="6035644">]</span><span class="op" id="6035645">,</span>&nbsp;<span class="string" id="6035647">&#34;,&#34;</span><span class="op" id="6035650">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035654">//&nbsp;There&nbsp;should&nbsp;be&nbsp;two&nbsp;numbers&nbsp;in&nbsp;sparseMap&nbsp;for&nbsp;each&nbsp;entry</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035714">if</span>&nbsp;<span class="ident" id="6035717">int64</span><span class="op" id="6035722">(</span><span class="builtinfunc" id="6035723">len</span><span class="op" id="6035726">(</span><span class="ident" id="6035727">sparseMap</span><span class="op" id="6035736">)</span><span class="op" id="6035737">)</span>&nbsp;<span class="op" id="6035739">!=</span>&nbsp;<span class="num" id="6035742">2</span><span class="op" id="6035743">*</span><span class="ident" id="6035744">numEntries</span>&nbsp;<span class="op" id="6035755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035759">return</span>&nbsp;<span class="ident" id="6035766">nil</span><span class="op" id="6035769">,</span>&nbsp;<span class="ident" id="6035771">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035786">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;entries&nbsp;in&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035833">sp</span>&nbsp;<span class="op" id="6035836">:=</span>&nbsp;<span class="builtinfunc" id="6035839">make</span><span class="op" id="6035843">(</span><span class="op" id="6035844">[</span><span class="op" id="6035845">]</span><span class="ident" id="6035846">sparseEntry</span><span class="op" id="6035857">,</span>&nbsp;<span class="num" id="6035859">0</span><span class="op" id="6035860">,</span>&nbsp;<span class="ident" id="6035862">numEntries</span><span class="op" id="6035872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035875">for</span>&nbsp;<span class="ident" id="6035879">i</span>&nbsp;<span class="op" id="6035881">:=</span>&nbsp;<span class="ident" id="6035884">int64</span><span class="op" id="6035889">(</span><span class="num" id="6035890">0</span><span class="op" id="6035891">)</span><span class="op" id="6035892">;</span>&nbsp;<span class="ident" id="6035894">i</span>&nbsp;<span class="op" id="6035896">&lt;</span>&nbsp;<span class="ident" id="6035898">numEntries</span><span class="op" id="6035908">;</span>&nbsp;<span class="ident" id="6035910">i</span><span class="op" id="6035911">++</span>&nbsp;<span class="op" id="6035914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035918">offset</span><span class="op" id="6035924">,</span>&nbsp;<span class="ident" id="6035926">err</span>&nbsp;<span class="op" id="6035930">:=</span>&nbsp;<span class="ident" id="6035933">strconv</span><span class="op" id="6035940">.</span><span class="ident" id="6035941">ParseInt</span><span class="op" id="6035949">(</span><span class="ident" id="6035950">sparseMap</span><span class="op" id="6035959">[</span><span class="num" id="6035960">2</span><span class="op" id="6035961">*</span><span class="ident" id="6035962">i</span><span class="op" id="6035963">]</span><span class="op" id="6035964">,</span>&nbsp;<span class="num" id="6035966">10</span><span class="op" id="6035968">,</span>&nbsp;<span class="num" id="6035970">0</span><span class="op" id="6035971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035975">if</span>&nbsp;<span class="ident" id="6035978">err</span>&nbsp;<span class="op" id="6035982">!=</span>&nbsp;<span class="ident" id="6035985">nil</span>&nbsp;<span class="op" id="6035989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035994">return</span>&nbsp;<span class="ident" id="6036001">nil</span><span class="op" id="6036004">,</span>&nbsp;<span class="ident" id="6036006">ErrHeader</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036022">numBytes</span><span class="op" id="6036030">,</span>&nbsp;<span class="ident" id="6036032">err</span>&nbsp;<span class="op" id="6036036">:=</span>&nbsp;<span class="ident" id="6036039">strconv</span><span class="op" id="6036046">.</span><span class="ident" id="6036047">ParseInt</span><span class="op" id="6036055">(</span><span class="ident" id="6036056">sparseMap</span><span class="op" id="6036065">[</span><span class="num" id="6036066">2</span><span class="op" id="6036067">*</span><span class="ident" id="6036068">i</span><span class="op" id="6036069">+</span><span class="num" id="6036070">1</span><span class="op" id="6036071">]</span><span class="op" id="6036072">,</span>&nbsp;<span class="num" id="6036074">10</span><span class="op" id="6036076">,</span>&nbsp;<span class="num" id="6036078">0</span><span class="op" id="6036079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036083">if</span>&nbsp;<span class="ident" id="6036086">err</span>&nbsp;<span class="op" id="6036090">!=</span>&nbsp;<span class="ident" id="6036093">nil</span>&nbsp;<span class="op" id="6036097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036102">return</span>&nbsp;<span class="ident" id="6036109">nil</span><span class="op" id="6036112">,</span>&nbsp;<span class="ident" id="6036114">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036126">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036130">sp</span>&nbsp;<span class="op" id="6036133">=</span>&nbsp;<span class="builtinfunc" id="6036135">append</span><span class="op" id="6036141">(</span><span class="ident" id="6036142">sp</span><span class="op" id="6036144">,</span>&nbsp;<span class="ident" id="6036146">sparseEntry</span><span class="op" id="6036157">{</span><span class="ident" id="6036158">offset</span><span class="op" id="6036164">:</span>&nbsp;<span class="ident" id="6036166">offset</span><span class="op" id="6036172">,</span>&nbsp;<span class="ident" id="6036174">numBytes</span><span class="op" id="6036182">:</span>&nbsp;<span class="ident" id="6036184">numBytes</span><span class="op" id="6036192">}</span><span class="op" id="6036193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036200">return</span>&nbsp;<span class="ident" id="6036207">sp</span><span class="op" id="6036209">,</span>&nbsp;<span class="ident" id="6036211">nil</span><br>
<span class="lineno"></span><span class="op" id="6036215">}</span><br>
<span class="lineno">715</span><br>
<span class="lineno"></span><span class="comment" id="6036218">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;current&nbsp;file&#39;s&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="6036299">//&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;or&nbsp;0&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;current&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6036356">func</span>&nbsp;<span class="op" id="6036361">(</span><span class="ident" id="6036362">tr</span>&nbsp;<span class="op" id="6036365">*</span><span class="ident" id="6036366">Reader</span><span class="op" id="6036372">)</span>&nbsp;<span class="ident" id="6036374">numBytes</span><span class="op" id="6036382">(</span><span class="op" id="6036383">)</span>&nbsp;<span class="ident" id="6036385">int64</span>&nbsp;<span class="op" id="6036391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036394">if</span>&nbsp;<span class="ident" id="6036397">tr</span><span class="op" id="6036399">.</span><span class="ident" id="6036400">curr</span>&nbsp;<span class="op" id="6036405">==</span>&nbsp;<span class="ident" id="6036408">nil</span>&nbsp;<span class="op" id="6036412">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6036416">//&nbsp;No&nbsp;current&nbsp;file,&nbsp;so&nbsp;no&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036450">return</span>&nbsp;<span class="num" id="6036457">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036463">return</span>&nbsp;<span class="ident" id="6036470">tr</span><span class="op" id="6036472">.</span><span class="ident" id="6036473">curr</span><span class="op" id="6036477">.</span><span class="ident" id="6036478">numBytes</span><span class="op" id="6036486">(</span><span class="op" id="6036487">)</span><br>
<span class="lineno"></span><span class="op" id="6036489">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="6036492">//&nbsp;Read&nbsp;reads&nbsp;from&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="6036549">//&nbsp;It&nbsp;returns&nbsp;0,&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;entry,</span><br>
<span class="lineno"></span><span class="comment" id="6036612">//&nbsp;until&nbsp;Next&nbsp;is&nbsp;called&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;next&nbsp;entry.</span><br>
<span class="lineno"></span><span class="keyword" id="6036666">func</span>&nbsp;<span class="op" id="6036671">(</span><span class="ident" id="6036672">tr</span>&nbsp;<span class="op" id="6036675">*</span><span class="ident" id="6036676">Reader</span><span class="op" id="6036682">)</span>&nbsp;<span class="ident" id="6036684">Read</span><span class="op" id="6036688">(</span><span class="ident" id="6036689">b</span>&nbsp;<span class="op" id="6036691">[</span><span class="op" id="6036692">]</span><span class="builtintype" id="6036693">byte</span><span class="op" id="6036697">)</span>&nbsp;<span class="op" id="6036699">(</span><span class="ident" id="6036700">n</span>&nbsp;<span class="builtintype" id="6036702">int</span><span class="op" id="6036705">,</span>&nbsp;<span class="ident" id="6036707">err</span>&nbsp;<span class="builtintype" id="6036711">error</span><span class="op" id="6036716">)</span>&nbsp;<span class="op" id="6036718">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036721">if</span>&nbsp;<span class="ident" id="6036724">tr</span><span class="op" id="6036726">.</span><span class="ident" id="6036727">curr</span>&nbsp;<span class="op" id="6036732">==</span>&nbsp;<span class="ident" id="6036735">nil</span>&nbsp;<span class="op" id="6036739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036743">return</span>&nbsp;<span class="num" id="6036750">0</span><span class="op" id="6036751">,</span>&nbsp;<span class="ident" id="6036753">io</span><span class="op" id="6036755">.</span><span class="ident" id="6036756">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036764">n</span><span class="op" id="6036765">,</span>&nbsp;<span class="ident" id="6036767">err</span>&nbsp;<span class="op" id="6036771">=</span>&nbsp;<span class="ident" id="6036773">tr</span><span class="op" id="6036775">.</span><span class="ident" id="6036776">curr</span><span class="op" id="6036780">.</span><span class="ident" id="6036781">Read</span><span class="op" id="6036785">(</span><span class="ident" id="6036786">b</span><span class="op" id="6036787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036790">if</span>&nbsp;<span class="ident" id="6036793">err</span>&nbsp;<span class="op" id="6036797">!=</span>&nbsp;<span class="ident" id="6036800">nil</span>&nbsp;<span class="op" id="6036804">&amp;&amp;</span>&nbsp;<span class="ident" id="6036807">err</span>&nbsp;<span class="op" id="6036811">!=</span>&nbsp;<span class="ident" id="6036814">io</span><span class="op" id="6036816">.</span><span class="ident" id="6036817">EOF</span>&nbsp;<span class="op" id="6036821">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036825">tr</span><span class="op" id="6036827">.</span><span class="ident" id="6036828">err</span>&nbsp;<span class="op" id="6036832">=</span>&nbsp;<span class="ident" id="6036834">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036842">return</span><br>
<span class="lineno"></span><span class="op" id="6036849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="6036852">func</span>&nbsp;<span class="op" id="6036857">(</span><span class="ident" id="6036858">rfr</span>&nbsp;<span class="op" id="6036862">*</span><span class="ident" id="6036863">regFileReader</span><span class="op" id="6036876">)</span>&nbsp;<span class="ident" id="6036878">Read</span><span class="op" id="6036882">(</span><span class="ident" id="6036883">b</span>&nbsp;<span class="op" id="6036885">[</span><span class="op" id="6036886">]</span><span class="builtintype" id="6036887">byte</span><span class="op" id="6036891">)</span>&nbsp;<span class="op" id="6036893">(</span><span class="ident" id="6036894">n</span>&nbsp;<span class="builtintype" id="6036896">int</span><span class="op" id="6036899">,</span>&nbsp;<span class="ident" id="6036901">err</span>&nbsp;<span class="builtintype" id="6036905">error</span><span class="op" id="6036910">)</span>&nbsp;<span class="op" id="6036912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036915">if</span>&nbsp;<span class="ident" id="6036918">rfr</span><span class="op" id="6036921">.</span><span class="ident" id="6036922">nb</span>&nbsp;<span class="op" id="6036925">==</span>&nbsp;<span class="num" id="6036928">0</span>&nbsp;<span class="op" id="6036930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6036934">//&nbsp;file&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036953">return</span>&nbsp;<span class="num" id="6036960">0</span><span class="op" id="6036961">,</span>&nbsp;<span class="ident" id="6036963">io</span><span class="op" id="6036965">.</span><span class="ident" id="6036966">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036971">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036974">if</span>&nbsp;<span class="ident" id="6036977">int64</span><span class="op" id="6036982">(</span><span class="builtinfunc" id="6036983">len</span><span class="op" id="6036986">(</span><span class="ident" id="6036987">b</span><span class="op" id="6036988">)</span><span class="op" id="6036989">)</span>&nbsp;<span class="op" id="6036991">&gt;</span>&nbsp;<span class="ident" id="6036993">rfr</span><span class="op" id="6036996">.</span><span class="ident" id="6036997">nb</span>&nbsp;<span class="op" id="6037000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037004">b</span>&nbsp;<span class="op" id="6037006">=</span>&nbsp;<span class="ident" id="6037008">b</span><span class="op" id="6037009">[</span><span class="num" id="6037010">0</span><span class="op" id="6037011">:</span><span class="ident" id="6037012">rfr</span><span class="op" id="6037015">.</span><span class="ident" id="6037016">nb</span><span class="op" id="6037018">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6037021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037024">n</span><span class="op" id="6037025">,</span>&nbsp;<span class="ident" id="6037027">err</span>&nbsp;<span class="op" id="6037031">=</span>&nbsp;<span class="ident" id="6037033">rfr</span><span class="op" id="6037036">.</span><span class="ident" id="6037037">r</span><span class="op" id="6037038">.</span><span class="ident" id="6037039">Read</span><span class="op" id="6037043">(</span><span class="ident" id="6037044">b</span><span class="op" id="6037045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037048">rfr</span><span class="op" id="6037051">.</span><span class="ident" id="6037052">nb</span>&nbsp;<span class="op" id="6037055">-=</span>&nbsp;<span class="ident" id="6037058">int64</span><span class="op" id="6037063">(</span><span class="ident" id="6037064">n</span><span class="op" id="6037065">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037069">if</span>&nbsp;<span class="ident" id="6037072">err</span>&nbsp;<span class="op" id="6037076">==</span>&nbsp;<span class="ident" id="6037079">io</span><span class="op" id="6037081">.</span><span class="ident" id="6037082">EOF</span>&nbsp;<span class="op" id="6037086">&amp;&amp;</span>&nbsp;<span class="ident" id="6037089">rfr</span><span class="op" id="6037092">.</span><span class="ident" id="6037093">nb</span>&nbsp;<span class="op" id="6037096">&gt;</span>&nbsp;<span class="num" id="6037098">0</span>&nbsp;<span class="op" id="6037100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037104">err</span>&nbsp;<span class="op" id="6037108">=</span>&nbsp;<span class="ident" id="6037110">io</span><span class="op" id="6037112">.</span><span class="ident" id="6037113">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6037131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037134">return</span><br>
<span class="lineno">755</span><span class="op" id="6037141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6037144">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6037236">func</span>&nbsp;<span class="op" id="6037241">(</span><span class="ident" id="6037242">rfr</span>&nbsp;<span class="op" id="6037246">*</span><span class="ident" id="6037247">regFileReader</span><span class="op" id="6037260">)</span>&nbsp;<span class="ident" id="6037262">numBytes</span><span class="op" id="6037270">(</span><span class="op" id="6037271">)</span>&nbsp;<span class="ident" id="6037273">int64</span>&nbsp;<span class="op" id="6037279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037282">return</span>&nbsp;<span class="ident" id="6037289">rfr</span><span class="op" id="6037292">.</span><span class="ident" id="6037293">nb</span><br>
<span class="lineno">760</span><span class="op" id="6037296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6037299">//&nbsp;readHole&nbsp;reads&nbsp;a&nbsp;sparse&nbsp;file&nbsp;hole&nbsp;ending&nbsp;at&nbsp;offset&nbsp;toOffset</span><br>
<span class="lineno"></span><span class="keyword" id="6037362">func</span>&nbsp;<span class="op" id="6037367">(</span><span class="ident" id="6037368">sfr</span>&nbsp;<span class="op" id="6037372">*</span><span class="ident" id="6037373">sparseFileReader</span><span class="op" id="6037389">)</span>&nbsp;<span class="ident" id="6037391">readHole</span><span class="op" id="6037399">(</span><span class="ident" id="6037400">b</span>&nbsp;<span class="op" id="6037402">[</span><span class="op" id="6037403">]</span><span class="builtintype" id="6037404">byte</span><span class="op" id="6037408">,</span>&nbsp;<span class="ident" id="6037410">toOffset</span>&nbsp;<span class="ident" id="6037419">int64</span><span class="op" id="6037424">)</span>&nbsp;<span class="builtintype" id="6037426">int</span>&nbsp;<span class="op" id="6037430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037433">n64</span>&nbsp;<span class="op" id="6037437">:=</span>&nbsp;<span class="ident" id="6037440">toOffset</span>&nbsp;<span class="op" id="6037449">-</span>&nbsp;<span class="ident" id="6037451">sfr</span><span class="op" id="6037454">.</span><span class="ident" id="6037455">pos</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037460">if</span>&nbsp;<span class="ident" id="6037463">n64</span>&nbsp;<span class="op" id="6037467">&gt;</span>&nbsp;<span class="ident" id="6037469">int64</span><span class="op" id="6037474">(</span><span class="builtinfunc" id="6037475">len</span><span class="op" id="6037478">(</span><span class="ident" id="6037479">b</span><span class="op" id="6037480">)</span><span class="op" id="6037481">)</span>&nbsp;<span class="op" id="6037483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037487">n64</span>&nbsp;<span class="op" id="6037491">=</span>&nbsp;<span class="ident" id="6037493">int64</span><span class="op" id="6037498">(</span><span class="builtinfunc" id="6037499">len</span><span class="op" id="6037502">(</span><span class="ident" id="6037503">b</span><span class="op" id="6037504">)</span><span class="op" id="6037505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6037508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037511">n</span>&nbsp;<span class="op" id="6037513">:=</span>&nbsp;<span class="builtintype" id="6037516">int</span><span class="op" id="6037519">(</span><span class="ident" id="6037520">n64</span><span class="op" id="6037523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037526">for</span>&nbsp;<span class="ident" id="6037530">i</span>&nbsp;<span class="op" id="6037532">:=</span>&nbsp;<span class="num" id="6037535">0</span><span class="op" id="6037536">;</span>&nbsp;<span class="ident" id="6037538">i</span>&nbsp;<span class="op" id="6037540">&lt;</span>&nbsp;<span class="ident" id="6037542">n</span><span class="op" id="6037543">;</span>&nbsp;<span class="ident" id="6037545">i</span><span class="op" id="6037546">++</span>&nbsp;<span class="op" id="6037549">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037553">b</span><span class="op" id="6037554">[</span><span class="ident" id="6037555">i</span><span class="op" id="6037556">]</span>&nbsp;<span class="op" id="6037558">=</span>&nbsp;<span class="num" id="6037560">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6037563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037566">sfr</span><span class="op" id="6037569">.</span><span class="ident" id="6037570">pos</span>&nbsp;<span class="op" id="6037574">+=</span>&nbsp;<span class="ident" id="6037577">n64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037582">return</span>&nbsp;<span class="ident" id="6037589">n</span><br>
<span class="lineno"></span><span class="op" id="6037591">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="6037594">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;file&nbsp;data&nbsp;in&nbsp;expanded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="6037647">func</span>&nbsp;<span class="op" id="6037652">(</span><span class="ident" id="6037653">sfr</span>&nbsp;<span class="op" id="6037657">*</span><span class="ident" id="6037658">sparseFileReader</span><span class="op" id="6037674">)</span>&nbsp;<span class="ident" id="6037676">Read</span><span class="op" id="6037680">(</span><span class="ident" id="6037681">b</span>&nbsp;<span class="op" id="6037683">[</span><span class="op" id="6037684">]</span><span class="builtintype" id="6037685">byte</span><span class="op" id="6037689">)</span>&nbsp;<span class="op" id="6037691">(</span><span class="ident" id="6037692">n</span>&nbsp;<span class="builtintype" id="6037694">int</span><span class="op" id="6037697">,</span>&nbsp;<span class="ident" id="6037699">err</span>&nbsp;<span class="builtintype" id="6037703">error</span><span class="op" id="6037708">)</span>&nbsp;<span class="op" id="6037710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037713">if</span>&nbsp;<span class="builtinfunc" id="6037716">len</span><span class="op" id="6037719">(</span><span class="ident" id="6037720">sfr</span><span class="op" id="6037723">.</span><span class="ident" id="6037724">sp</span><span class="op" id="6037726">)</span>&nbsp;<span class="op" id="6037728">==</span>&nbsp;<span class="num" id="6037731">0</span>&nbsp;<span class="op" id="6037733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6037737">//&nbsp;No&nbsp;more&nbsp;data&nbsp;fragments&nbsp;to&nbsp;read&nbsp;from.</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037779">if</span>&nbsp;<span class="ident" id="6037782">sfr</span><span class="op" id="6037785">.</span><span class="ident" id="6037786">pos</span>&nbsp;<span class="op" id="6037790">&lt;</span>&nbsp;<span class="ident" id="6037792">sfr</span><span class="op" id="6037795">.</span><span class="ident" id="6037796">tot</span>&nbsp;<span class="op" id="6037800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6037805">//&nbsp;We&#39;re&nbsp;in&nbsp;the&nbsp;last&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037834">n</span>&nbsp;<span class="op" id="6037836">=</span>&nbsp;<span class="ident" id="6037838">sfr</span><span class="op" id="6037841">.</span><span class="ident" id="6037842">readHole</span><span class="op" id="6037850">(</span><span class="ident" id="6037851">b</span><span class="op" id="6037852">,</span>&nbsp;<span class="ident" id="6037854">sfr</span><span class="op" id="6037857">.</span><span class="ident" id="6037858">tot</span><span class="op" id="6037861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037866">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6037875">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6037879">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037924">return</span>&nbsp;<span class="num" id="6037931">0</span><span class="op" id="6037932">,</span>&nbsp;<span class="ident" id="6037934">io</span><span class="op" id="6037936">.</span><span class="ident" id="6037937">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6037942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6037945">if</span>&nbsp;<span class="ident" id="6037948">sfr</span><span class="op" id="6037951">.</span><span class="ident" id="6037952">pos</span>&nbsp;<span class="op" id="6037956">&lt;</span>&nbsp;<span class="ident" id="6037958">sfr</span><span class="op" id="6037961">.</span><span class="ident" id="6037962">sp</span><span class="op" id="6037964">[</span><span class="num" id="6037965">0</span><span class="op" id="6037966">]</span><span class="op" id="6037967">.</span><span class="ident" id="6037968">offset</span>&nbsp;<span class="op" id="6037975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6037979">//&nbsp;We&#39;re&nbsp;in&nbsp;a&nbsp;hole</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038000">n</span>&nbsp;<span class="op" id="6038002">=</span>&nbsp;<span class="ident" id="6038004">sfr</span><span class="op" id="6038007">.</span><span class="ident" id="6038008">readHole</span><span class="op" id="6038016">(</span><span class="ident" id="6038017">b</span><span class="op" id="6038018">,</span>&nbsp;<span class="ident" id="6038020">sfr</span><span class="op" id="6038023">.</span><span class="ident" id="6038024">sp</span><span class="op" id="6038026">[</span><span class="num" id="6038027">0</span><span class="op" id="6038028">]</span><span class="op" id="6038029">.</span><span class="ident" id="6038030">offset</span><span class="op" id="6038036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038040">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6038048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6038052">//&nbsp;We&#39;re&nbsp;not&nbsp;in&nbsp;a&nbsp;hole,&nbsp;so&nbsp;we&#39;ll&nbsp;read&nbsp;from&nbsp;the&nbsp;next&nbsp;data&nbsp;fragment</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038119">posInFragment</span>&nbsp;<span class="op" id="6038133">:=</span>&nbsp;<span class="ident" id="6038136">sfr</span><span class="op" id="6038139">.</span><span class="ident" id="6038140">pos</span>&nbsp;<span class="op" id="6038144">-</span>&nbsp;<span class="ident" id="6038146">sfr</span><span class="op" id="6038149">.</span><span class="ident" id="6038150">sp</span><span class="op" id="6038152">[</span><span class="num" id="6038153">0</span><span class="op" id="6038154">]</span><span class="op" id="6038155">.</span><span class="ident" id="6038156">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038164">bytesLeft</span>&nbsp;<span class="op" id="6038174">:=</span>&nbsp;<span class="ident" id="6038177">sfr</span><span class="op" id="6038180">.</span><span class="ident" id="6038181">sp</span><span class="op" id="6038183">[</span><span class="num" id="6038184">0</span><span class="op" id="6038185">]</span><span class="op" id="6038186">.</span><span class="ident" id="6038187">numBytes</span>&nbsp;<span class="op" id="6038196">-</span>&nbsp;<span class="ident" id="6038198">posInFragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038213">if</span>&nbsp;<span class="ident" id="6038216">int64</span><span class="op" id="6038221">(</span><span class="builtinfunc" id="6038222">len</span><span class="op" id="6038225">(</span><span class="ident" id="6038226">b</span><span class="op" id="6038227">)</span><span class="op" id="6038228">)</span>&nbsp;<span class="op" id="6038230">&gt;</span>&nbsp;<span class="ident" id="6038232">bytesLeft</span>&nbsp;<span class="op" id="6038242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038246">b</span>&nbsp;<span class="op" id="6038248">=</span>&nbsp;<span class="ident" id="6038250">b</span><span class="op" id="6038251">[</span><span class="num" id="6038252">0</span><span class="op" id="6038253">:</span><span class="ident" id="6038254">bytesLeft</span><span class="op" id="6038263">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6038266">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038270">n</span><span class="op" id="6038271">,</span>&nbsp;<span class="ident" id="6038273">err</span>&nbsp;<span class="op" id="6038277">=</span>&nbsp;<span class="ident" id="6038279">sfr</span><span class="op" id="6038282">.</span><span class="ident" id="6038283">rfr</span><span class="op" id="6038286">.</span><span class="ident" id="6038287">Read</span><span class="op" id="6038291">(</span><span class="ident" id="6038292">b</span><span class="op" id="6038293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038296">sfr</span><span class="op" id="6038299">.</span><span class="ident" id="6038300">pos</span>&nbsp;<span class="op" id="6038304">+=</span>&nbsp;<span class="ident" id="6038307">int64</span><span class="op" id="6038312">(</span><span class="ident" id="6038313">n</span><span class="op" id="6038314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038318">if</span>&nbsp;<span class="ident" id="6038321">int64</span><span class="op" id="6038326">(</span><span class="ident" id="6038327">n</span><span class="op" id="6038328">)</span>&nbsp;<span class="op" id="6038330">==</span>&nbsp;<span class="ident" id="6038333">bytesLeft</span>&nbsp;<span class="op" id="6038343">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6038347">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038382">sfr</span><span class="op" id="6038385">.</span><span class="ident" id="6038386">sp</span>&nbsp;<span class="op" id="6038389">=</span>&nbsp;<span class="ident" id="6038391">sfr</span><span class="op" id="6038394">.</span><span class="ident" id="6038395">sp</span><span class="op" id="6038397">[</span><span class="num" id="6038398">1</span><span class="op" id="6038399">:</span><span class="op" id="6038400">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6038403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038407">if</span>&nbsp;<span class="ident" id="6038410">err</span>&nbsp;<span class="op" id="6038414">==</span>&nbsp;<span class="ident" id="6038417">io</span><span class="op" id="6038419">.</span><span class="ident" id="6038420">EOF</span>&nbsp;<span class="op" id="6038424">&amp;&amp;</span>&nbsp;<span class="ident" id="6038427">sfr</span><span class="op" id="6038430">.</span><span class="ident" id="6038431">pos</span>&nbsp;<span class="op" id="6038435">&lt;</span>&nbsp;<span class="ident" id="6038437">sfr</span><span class="op" id="6038440">.</span><span class="ident" id="6038441">tot</span>&nbsp;<span class="op" id="6038445">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6038449">//&nbsp;We&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;last&nbsp;fragment&#39;s&nbsp;data,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;final&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038527">err</span>&nbsp;<span class="op" id="6038531">=</span>&nbsp;<span class="ident" id="6038533">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6038538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038541">return</span><br>
<span class="lineno"></span><span class="op" id="6038548">}</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="6038551">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;sparse&nbsp;file&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="6038625">//&nbsp;sparse-encoded&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6038668">func</span>&nbsp;<span class="op" id="6038673">(</span><span class="ident" id="6038674">sfr</span>&nbsp;<span class="op" id="6038678">*</span><span class="ident" id="6038679">sparseFileReader</span><span class="op" id="6038695">)</span>&nbsp;<span class="ident" id="6038697">numBytes</span><span class="op" id="6038705">(</span><span class="op" id="6038706">)</span>&nbsp;<span class="ident" id="6038708">int64</span>&nbsp;<span class="op" id="6038714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038717">return</span>&nbsp;<span class="ident" id="6038724">sfr</span><span class="op" id="6038727">.</span><span class="ident" id="6038728">rfr</span><span class="op" id="6038731">.</span><span class="ident" id="6038732">nb</span><br>
<span class="lineno">820</span><span class="op" id="6038735">}</span>
</div>
</body>
</html>
