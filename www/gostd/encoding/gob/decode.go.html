<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html" class="current">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4844862">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4844917">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4844971">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4845022">//go:generate&nbsp;go&nbsp;run&nbsp;decgen.go&nbsp;-output&nbsp;dec_helpers.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4845077">package</span>&nbsp;<span class="ident" id="4845085">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4845090">import</span>&nbsp;<span class="op" id="4845097">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4845100">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4845112">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4845122">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4845128">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4845136">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4845146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4845149">var</span>&nbsp;<span class="op" id="4845153">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845156">errBadUint</span>&nbsp;<span class="op" id="4845167">=</span>&nbsp;<span class="ident" id="4845169">errors</span><span class="op" id="4845175">.</span><span class="ident" id="4845176">New</span><span class="op" id="4845179">(</span><span class="string" id="4845180">&#34;gob:&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="4845224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845227">errBadType</span>&nbsp;<span class="op" id="4845238">=</span>&nbsp;<span class="ident" id="4845240">errors</span><span class="op" id="4845246">.</span><span class="ident" id="4845247">New</span><span class="op" id="4845250">(</span><span class="string" id="4845251">&#34;gob:&nbsp;unknown&nbsp;type&nbsp;id&nbsp;or&nbsp;corrupted&nbsp;data&#34;</span><span class="op" id="4845291">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845294">errRange</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4845305">=</span>&nbsp;<span class="ident" id="4845307">errors</span><span class="op" id="4845313">.</span><span class="ident" id="4845314">New</span><span class="op" id="4845317">(</span><span class="string" id="4845318">&#34;gob:&nbsp;bad&nbsp;data:&nbsp;field&nbsp;numbers&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="4845362">)</span><br>
<span class="lineno"></span><span class="op" id="4845364">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4845367">type</span>&nbsp;<span class="ident" id="4845372">decHelper</span>&nbsp;<span class="keyword" id="4845382">func</span><span class="op" id="4845386">(</span><span class="ident" id="4845387">state</span>&nbsp;<span class="op" id="4845393">*</span><span class="ident" id="4845394">decoderState</span><span class="op" id="4845406">,</span>&nbsp;<span class="ident" id="4845408">v</span>&nbsp;<span class="ident" id="4845410">reflect</span><span class="op" id="4845417">.</span><span class="ident" id="4845418">Value</span><span class="op" id="4845423">,</span>&nbsp;<span class="ident" id="4845425">length</span>&nbsp;<span class="builtintype" id="4845432">int</span><span class="op" id="4845435">,</span>&nbsp;<span class="ident" id="4845437">ovfl</span>&nbsp;<span class="builtintype" id="4845442">error</span><span class="op" id="4845447">)</span>&nbsp;<span class="builtintype" id="4845449">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4845455">//&nbsp;decoderState&nbsp;is&nbsp;the&nbsp;execution&nbsp;state&nbsp;of&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;decoder.&nbsp;A&nbsp;new&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="4845537">//&nbsp;is&nbsp;created&nbsp;for&nbsp;nested&nbsp;objects.</span><br>
<span class="lineno"></span><span class="keyword" id="4845571">type</span>&nbsp;<span class="ident" id="4845576">decoderState</span>&nbsp;<span class="keyword" id="4845589">struct</span>&nbsp;<span class="op" id="4845596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845599">dec</span>&nbsp;<span class="op" id="4845603">*</span><span class="ident" id="4845604">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845613">//&nbsp;The&nbsp;buffer&nbsp;is&nbsp;stored&nbsp;with&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;replaced</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845691">//&nbsp;if&nbsp;we&nbsp;load&nbsp;a&nbsp;type&nbsp;during&nbsp;decode&nbsp;(when&nbsp;reading&nbsp;an&nbsp;interface&nbsp;value).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845762">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4845771">*</span><span class="ident" id="4845772">decBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845783">fieldnum</span>&nbsp;<span class="builtintype" id="4845792">int</span>&nbsp;<span class="comment" id="4845796">//&nbsp;the&nbsp;last&nbsp;field&nbsp;number&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845828">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4845837">[</span><span class="op" id="4845838">]</span><span class="builtintype" id="4845839">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845845">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4845854">*</span><span class="ident" id="4845855">decoderState</span>&nbsp;<span class="comment" id="4845868">//&nbsp;for&nbsp;free&nbsp;list</span><br>
<span class="lineno">35</span><span class="op" id="4845885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4845888">//&nbsp;decBuffer&nbsp;is&nbsp;an&nbsp;extremely&nbsp;simple,&nbsp;fast&nbsp;implementation&nbsp;of&nbsp;a&nbsp;read-only&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="4845973">//&nbsp;It&nbsp;is&nbsp;initialized&nbsp;by&nbsp;calling&nbsp;Size&nbsp;and&nbsp;then&nbsp;copying&nbsp;the&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;Bytes().</span><br>
<span class="lineno"></span><span class="keyword" id="4846072">type</span>&nbsp;<span class="ident" id="4846077">decBuffer</span>&nbsp;<span class="keyword" id="4846087">struct</span>&nbsp;<span class="op" id="4846094">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846097">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4846104">[</span><span class="op" id="4846105">]</span><span class="builtintype" id="4846106">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846112">offset</span>&nbsp;<span class="builtintype" id="4846119">int</span>&nbsp;<span class="comment" id="4846123">//&nbsp;Read&nbsp;offset.</span><br>
<span class="lineno"></span><span class="op" id="4846139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4846142">func</span>&nbsp;<span class="op" id="4846147">(</span><span class="ident" id="4846148">d</span>&nbsp;<span class="op" id="4846150">*</span><span class="ident" id="4846151">decBuffer</span><span class="op" id="4846160">)</span>&nbsp;<span class="ident" id="4846162">Read</span><span class="op" id="4846166">(</span><span class="ident" id="4846167">p</span>&nbsp;<span class="op" id="4846169">[</span><span class="op" id="4846170">]</span><span class="builtintype" id="4846171">byte</span><span class="op" id="4846175">)</span>&nbsp;<span class="op" id="4846177">(</span><span class="builtintype" id="4846178">int</span><span class="op" id="4846181">,</span>&nbsp;<span class="builtintype" id="4846183">error</span><span class="op" id="4846188">)</span>&nbsp;<span class="op" id="4846190">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846193">n</span>&nbsp;<span class="op" id="4846195">:=</span>&nbsp;<span class="builtinfunc" id="4846198">copy</span><span class="op" id="4846202">(</span><span class="ident" id="4846203">p</span><span class="op" id="4846204">,</span>&nbsp;<span class="ident" id="4846206">d</span><span class="op" id="4846207">.</span><span class="ident" id="4846208">data</span><span class="op" id="4846212">[</span><span class="ident" id="4846213">d</span><span class="op" id="4846214">.</span><span class="ident" id="4846215">offset</span><span class="op" id="4846221">:</span><span class="op" id="4846222">]</span><span class="op" id="4846223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846226">if</span>&nbsp;<span class="ident" id="4846229">n</span>&nbsp;<span class="op" id="4846231">==</span>&nbsp;<span class="num" id="4846234">0</span>&nbsp;<span class="op" id="4846236">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4846239">len</span><span class="op" id="4846242">(</span><span class="ident" id="4846243">p</span><span class="op" id="4846244">)</span>&nbsp;<span class="op" id="4846246">!=</span>&nbsp;<span class="num" id="4846249">0</span>&nbsp;<span class="op" id="4846251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846255">return</span>&nbsp;<span class="num" id="4846262">0</span><span class="op" id="4846263">,</span>&nbsp;<span class="ident" id="4846265">io</span><span class="op" id="4846267">.</span><span class="ident" id="4846268">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4846273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846276">d</span><span class="op" id="4846277">.</span><span class="ident" id="4846278">offset</span>&nbsp;<span class="op" id="4846285">+=</span>&nbsp;<span class="ident" id="4846288">n</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846291">return</span>&nbsp;<span class="ident" id="4846298">n</span><span class="op" id="4846299">,</span>&nbsp;<span class="ident" id="4846301">nil</span><br>
<span class="lineno"></span><span class="op" id="4846305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4846308">func</span>&nbsp;<span class="op" id="4846313">(</span><span class="ident" id="4846314">d</span>&nbsp;<span class="op" id="4846316">*</span><span class="ident" id="4846317">decBuffer</span><span class="op" id="4846326">)</span>&nbsp;<span class="ident" id="4846328">Drop</span><span class="op" id="4846332">(</span><span class="ident" id="4846333">n</span>&nbsp;<span class="builtintype" id="4846335">int</span><span class="op" id="4846338">)</span>&nbsp;<span class="op" id="4846340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846343">if</span>&nbsp;<span class="ident" id="4846346">n</span>&nbsp;<span class="op" id="4846348">&gt;</span>&nbsp;<span class="ident" id="4846350">d</span><span class="op" id="4846351">.</span><span class="ident" id="4846352">Len</span><span class="op" id="4846355">(</span><span class="op" id="4846356">)</span>&nbsp;<span class="op" id="4846358">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4846362">panic</span><span class="op" id="4846367">(</span><span class="string" id="4846368">&#34;drop&#34;</span><span class="op" id="4846374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4846377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846380">d</span><span class="op" id="4846381">.</span><span class="ident" id="4846382">offset</span>&nbsp;<span class="op" id="4846389">+=</span>&nbsp;<span class="ident" id="4846392">n</span><br>
<span class="lineno"></span><span class="op" id="4846394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4846397">//&nbsp;Size&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;exactly&nbsp;n&nbsp;bytes,&nbsp;so&nbsp;d.Bytes()&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4846460">//&nbsp;return&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n.&nbsp;Existing&nbsp;data&nbsp;is&nbsp;first&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4846525">func</span>&nbsp;<span class="op" id="4846530">(</span><span class="ident" id="4846531">d</span>&nbsp;<span class="op" id="4846533">*</span><span class="ident" id="4846534">decBuffer</span><span class="op" id="4846543">)</span>&nbsp;<span class="ident" id="4846545">Size</span><span class="op" id="4846549">(</span><span class="ident" id="4846550">n</span>&nbsp;<span class="builtintype" id="4846552">int</span><span class="op" id="4846555">)</span>&nbsp;<span class="op" id="4846557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846560">d</span><span class="op" id="4846561">.</span><span class="ident" id="4846562">Reset</span><span class="op" id="4846567">(</span><span class="op" id="4846568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846571">if</span>&nbsp;<span class="builtinfunc" id="4846574">cap</span><span class="op" id="4846577">(</span><span class="ident" id="4846578">d</span><span class="op" id="4846579">.</span><span class="ident" id="4846580">data</span><span class="op" id="4846584">)</span>&nbsp;<span class="op" id="4846586">&lt;</span>&nbsp;<span class="ident" id="4846588">n</span>&nbsp;<span class="op" id="4846590">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846594">d</span><span class="op" id="4846595">.</span><span class="ident" id="4846596">data</span>&nbsp;<span class="op" id="4846601">=</span>&nbsp;<span class="builtinfunc" id="4846603">make</span><span class="op" id="4846607">(</span><span class="op" id="4846608">[</span><span class="op" id="4846609">]</span><span class="builtintype" id="4846610">byte</span><span class="op" id="4846614">,</span>&nbsp;<span class="ident" id="4846616">n</span><span class="op" id="4846617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4846620">}</span>&nbsp;<span class="keyword" id="4846622">else</span>&nbsp;<span class="op" id="4846627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846631">d</span><span class="op" id="4846632">.</span><span class="ident" id="4846633">data</span>&nbsp;<span class="op" id="4846638">=</span>&nbsp;<span class="ident" id="4846640">d</span><span class="op" id="4846641">.</span><span class="ident" id="4846642">data</span><span class="op" id="4846646">[</span><span class="num" id="4846647">0</span><span class="op" id="4846648">:</span><span class="ident" id="4846649">n</span><span class="op" id="4846650">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4846653">}</span><br>
<span class="lineno"></span><span class="op" id="4846655">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4846658">func</span>&nbsp;<span class="op" id="4846663">(</span><span class="ident" id="4846664">d</span>&nbsp;<span class="op" id="4846666">*</span><span class="ident" id="4846667">decBuffer</span><span class="op" id="4846676">)</span>&nbsp;<span class="ident" id="4846678">ReadByte</span><span class="op" id="4846686">(</span><span class="op" id="4846687">)</span>&nbsp;<span class="op" id="4846689">(</span><span class="builtintype" id="4846690">byte</span><span class="op" id="4846694">,</span>&nbsp;<span class="builtintype" id="4846696">error</span><span class="op" id="4846701">)</span>&nbsp;<span class="op" id="4846703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846706">if</span>&nbsp;<span class="ident" id="4846709">d</span><span class="op" id="4846710">.</span><span class="ident" id="4846711">offset</span>&nbsp;<span class="op" id="4846718">&gt;=</span>&nbsp;<span class="builtinfunc" id="4846721">len</span><span class="op" id="4846724">(</span><span class="ident" id="4846725">d</span><span class="op" id="4846726">.</span><span class="ident" id="4846727">data</span><span class="op" id="4846731">)</span>&nbsp;<span class="op" id="4846733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846737">return</span>&nbsp;<span class="num" id="4846744">0</span><span class="op" id="4846745">,</span>&nbsp;<span class="ident" id="4846747">io</span><span class="op" id="4846749">.</span><span class="ident" id="4846750">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4846755">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846758">c</span>&nbsp;<span class="op" id="4846760">:=</span>&nbsp;<span class="ident" id="4846763">d</span><span class="op" id="4846764">.</span><span class="ident" id="4846765">data</span><span class="op" id="4846769">[</span><span class="ident" id="4846770">d</span><span class="op" id="4846771">.</span><span class="ident" id="4846772">offset</span><span class="op" id="4846778">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846781">d</span><span class="op" id="4846782">.</span><span class="ident" id="4846783">offset</span><span class="op" id="4846789">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846793">return</span>&nbsp;<span class="ident" id="4846800">c</span><span class="op" id="4846801">,</span>&nbsp;<span class="ident" id="4846803">nil</span><br>
<span class="lineno"></span><span class="op" id="4846807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4846810">func</span>&nbsp;<span class="op" id="4846815">(</span><span class="ident" id="4846816">d</span>&nbsp;<span class="op" id="4846818">*</span><span class="ident" id="4846819">decBuffer</span><span class="op" id="4846828">)</span>&nbsp;<span class="ident" id="4846830">Len</span><span class="op" id="4846833">(</span><span class="op" id="4846834">)</span>&nbsp;<span class="builtintype" id="4846836">int</span>&nbsp;<span class="op" id="4846840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846843">return</span>&nbsp;<span class="builtinfunc" id="4846850">len</span><span class="op" id="4846853">(</span><span class="ident" id="4846854">d</span><span class="op" id="4846855">.</span><span class="ident" id="4846856">data</span><span class="op" id="4846860">)</span>&nbsp;<span class="op" id="4846862">-</span>&nbsp;<span class="ident" id="4846864">d</span><span class="op" id="4846865">.</span><span class="ident" id="4846866">offset</span><br>
<span class="lineno"></span><span class="op" id="4846873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4846876">func</span>&nbsp;<span class="op" id="4846881">(</span><span class="ident" id="4846882">d</span>&nbsp;<span class="op" id="4846884">*</span><span class="ident" id="4846885">decBuffer</span><span class="op" id="4846894">)</span>&nbsp;<span class="ident" id="4846896">Bytes</span><span class="op" id="4846901">(</span><span class="op" id="4846902">)</span>&nbsp;<span class="op" id="4846904">[</span><span class="op" id="4846905">]</span><span class="builtintype" id="4846906">byte</span>&nbsp;<span class="op" id="4846911">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846914">return</span>&nbsp;<span class="ident" id="4846921">d</span><span class="op" id="4846922">.</span><span class="ident" id="4846923">data</span><span class="op" id="4846927">[</span><span class="ident" id="4846928">d</span><span class="op" id="4846929">.</span><span class="ident" id="4846930">offset</span><span class="op" id="4846936">:</span><span class="op" id="4846937">]</span><br>
<span class="lineno"></span><span class="op" id="4846939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4846942">func</span>&nbsp;<span class="op" id="4846947">(</span><span class="ident" id="4846948">d</span>&nbsp;<span class="op" id="4846950">*</span><span class="ident" id="4846951">decBuffer</span><span class="op" id="4846960">)</span>&nbsp;<span class="ident" id="4846962">Reset</span><span class="op" id="4846967">(</span><span class="op" id="4846968">)</span>&nbsp;<span class="op" id="4846970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846973">d</span><span class="op" id="4846974">.</span><span class="ident" id="4846975">data</span>&nbsp;<span class="op" id="4846980">=</span>&nbsp;<span class="ident" id="4846982">d</span><span class="op" id="4846983">.</span><span class="ident" id="4846984">data</span><span class="op" id="4846988">[</span><span class="num" id="4846989">0</span><span class="op" id="4846990">:</span><span class="num" id="4846991">0</span><span class="op" id="4846992">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846995">d</span><span class="op" id="4846996">.</span><span class="ident" id="4846997">offset</span>&nbsp;<span class="op" id="4847004">=</span>&nbsp;<span class="num" id="4847006">0</span><br>
<span class="lineno"></span><span class="op" id="4847008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4847011">//&nbsp;We&nbsp;pass&nbsp;the&nbsp;bytes.Buffer&nbsp;separately&nbsp;for&nbsp;easier&nbsp;testing&nbsp;of&nbsp;the&nbsp;infrastructure</span><br>
<span class="lineno"></span><span class="comment" id="4847091">//&nbsp;without&nbsp;requiring&nbsp;a&nbsp;full&nbsp;Decoder.</span><br>
<span class="lineno">95</span><span class="keyword" id="4847128">func</span>&nbsp;<span class="op" id="4847133">(</span><span class="ident" id="4847134">dec</span>&nbsp;<span class="op" id="4847138">*</span><span class="ident" id="4847139">Decoder</span><span class="op" id="4847146">)</span>&nbsp;<span class="ident" id="4847148">newDecoderState</span><span class="op" id="4847163">(</span><span class="ident" id="4847164">buf</span>&nbsp;<span class="op" id="4847168">*</span><span class="ident" id="4847169">decBuffer</span><span class="op" id="4847178">)</span>&nbsp;<span class="op" id="4847180">*</span><span class="ident" id="4847181">decoderState</span>&nbsp;<span class="op" id="4847194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847197">d</span>&nbsp;<span class="op" id="4847199">:=</span>&nbsp;<span class="ident" id="4847202">dec</span><span class="op" id="4847205">.</span><span class="ident" id="4847206">freeList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847216">if</span>&nbsp;<span class="ident" id="4847219">d</span>&nbsp;<span class="op" id="4847221">==</span>&nbsp;<span class="ident" id="4847224">nil</span>&nbsp;<span class="op" id="4847228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847232">d</span>&nbsp;<span class="op" id="4847234">=</span>&nbsp;<span class="builtinfunc" id="4847236">new</span><span class="op" id="4847239">(</span><span class="ident" id="4847240">decoderState</span><span class="op" id="4847252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847256">d</span><span class="op" id="4847257">.</span><span class="ident" id="4847258">dec</span>&nbsp;<span class="op" id="4847262">=</span>&nbsp;<span class="ident" id="4847264">dec</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847270">d</span><span class="op" id="4847271">.</span><span class="ident" id="4847272">buf</span>&nbsp;<span class="op" id="4847276">=</span>&nbsp;<span class="builtinfunc" id="4847278">make</span><span class="op" id="4847282">(</span><span class="op" id="4847283">[</span><span class="op" id="4847284">]</span><span class="builtintype" id="4847285">byte</span><span class="op" id="4847289">,</span>&nbsp;<span class="ident" id="4847291">uint64Size</span><span class="op" id="4847301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847304">}</span>&nbsp;<span class="keyword" id="4847306">else</span>&nbsp;<span class="op" id="4847311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847315">dec</span><span class="op" id="4847318">.</span><span class="ident" id="4847319">freeList</span>&nbsp;<span class="op" id="4847328">=</span>&nbsp;<span class="ident" id="4847330">d</span><span class="op" id="4847331">.</span><span class="ident" id="4847332">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847341">d</span><span class="op" id="4847342">.</span><span class="ident" id="4847343">b</span>&nbsp;<span class="op" id="4847345">=</span>&nbsp;<span class="ident" id="4847347">buf</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847352">return</span>&nbsp;<span class="ident" id="4847359">d</span><br>
<span class="lineno"></span><span class="op" id="4847361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4847364">func</span>&nbsp;<span class="op" id="4847369">(</span><span class="ident" id="4847370">dec</span>&nbsp;<span class="op" id="4847374">*</span><span class="ident" id="4847375">Decoder</span><span class="op" id="4847382">)</span>&nbsp;<span class="ident" id="4847384">freeDecoderState</span><span class="op" id="4847400">(</span><span class="ident" id="4847401">d</span>&nbsp;<span class="op" id="4847403">*</span><span class="ident" id="4847404">decoderState</span><span class="op" id="4847416">)</span>&nbsp;<span class="op" id="4847418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847421">d</span><span class="op" id="4847422">.</span><span class="ident" id="4847423">next</span>&nbsp;<span class="op" id="4847428">=</span>&nbsp;<span class="ident" id="4847430">dec</span><span class="op" id="4847433">.</span><span class="ident" id="4847434">freeList</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847444">dec</span><span class="op" id="4847447">.</span><span class="ident" id="4847448">freeList</span>&nbsp;<span class="op" id="4847457">=</span>&nbsp;<span class="ident" id="4847459">d</span><br>
<span class="lineno"></span><span class="op" id="4847461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4847464">func</span>&nbsp;<span class="ident" id="4847469">overflow</span><span class="op" id="4847477">(</span><span class="ident" id="4847478">name</span>&nbsp;<span class="builtintype" id="4847483">string</span><span class="op" id="4847489">)</span>&nbsp;<span class="builtintype" id="4847491">error</span>&nbsp;<span class="op" id="4847497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847500">return</span>&nbsp;<span class="ident" id="4847507">errors</span><span class="op" id="4847513">.</span><span class="ident" id="4847514">New</span><span class="op" id="4847517">(</span><span class="string" id="4847518">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="4847532">+</span>&nbsp;<span class="ident" id="4847534">name</span>&nbsp;<span class="op" id="4847539">+</span>&nbsp;<span class="string" id="4847541">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="4847557">)</span><br>
<span class="lineno">115</span><span class="op" id="4847559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4847562">//&nbsp;decodeUintReader&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="4847635">//&nbsp;Used&nbsp;only&nbsp;by&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;read&nbsp;the&nbsp;message&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4847691">func</span>&nbsp;<span class="ident" id="4847696">decodeUintReader</span><span class="op" id="4847712">(</span><span class="ident" id="4847713">r</span>&nbsp;<span class="ident" id="4847715">io</span><span class="op" id="4847717">.</span><span class="ident" id="4847718">Reader</span><span class="op" id="4847724">,</span>&nbsp;<span class="ident" id="4847726">buf</span>&nbsp;<span class="op" id="4847730">[</span><span class="op" id="4847731">]</span><span class="builtintype" id="4847732">byte</span><span class="op" id="4847736">)</span>&nbsp;<span class="op" id="4847738">(</span><span class="ident" id="4847739">x</span>&nbsp;<span class="ident" id="4847741">uint64</span><span class="op" id="4847747">,</span>&nbsp;<span class="ident" id="4847749">width</span>&nbsp;<span class="builtintype" id="4847755">int</span><span class="op" id="4847758">,</span>&nbsp;<span class="ident" id="4847760">err</span>&nbsp;<span class="builtintype" id="4847764">error</span><span class="op" id="4847769">)</span>&nbsp;<span class="op" id="4847771">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847774">width</span>&nbsp;<span class="op" id="4847780">=</span>&nbsp;<span class="num" id="4847782">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847785">n</span><span class="op" id="4847786">,</span>&nbsp;<span class="ident" id="4847788">err</span>&nbsp;<span class="op" id="4847792">:=</span>&nbsp;<span class="ident" id="4847795">io</span><span class="op" id="4847797">.</span><span class="ident" id="4847798">ReadFull</span><span class="op" id="4847806">(</span><span class="ident" id="4847807">r</span><span class="op" id="4847808">,</span>&nbsp;<span class="ident" id="4847810">buf</span><span class="op" id="4847813">[</span><span class="num" id="4847814">0</span><span class="op" id="4847815">:</span><span class="ident" id="4847816">width</span><span class="op" id="4847821">]</span><span class="op" id="4847822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847825">if</span>&nbsp;<span class="ident" id="4847828">n</span>&nbsp;<span class="op" id="4847830">==</span>&nbsp;<span class="num" id="4847833">0</span>&nbsp;<span class="op" id="4847835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847839">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847847">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847850">b</span>&nbsp;<span class="op" id="4847852">:=</span>&nbsp;<span class="ident" id="4847855">buf</span><span class="op" id="4847858">[</span><span class="num" id="4847859">0</span><span class="op" id="4847860">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847863">if</span>&nbsp;<span class="ident" id="4847866">b</span>&nbsp;<span class="op" id="4847868">&lt;=</span>&nbsp;<span class="num" id="4847871">0x7f</span>&nbsp;<span class="op" id="4847876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847880">return</span>&nbsp;<span class="ident" id="4847887">uint64</span><span class="op" id="4847893">(</span><span class="ident" id="4847894">b</span><span class="op" id="4847895">)</span><span class="op" id="4847896">,</span>&nbsp;<span class="ident" id="4847898">width</span><span class="op" id="4847903">,</span>&nbsp;<span class="ident" id="4847905">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847913">n</span>&nbsp;<span class="op" id="4847915">=</span>&nbsp;<span class="op" id="4847917">-</span><span class="builtintype" id="4847918">int</span><span class="op" id="4847921">(</span><span class="builtintype" id="4847922">int8</span><span class="op" id="4847926">(</span><span class="ident" id="4847927">b</span><span class="op" id="4847928">)</span><span class="op" id="4847929">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847932">if</span>&nbsp;<span class="ident" id="4847935">n</span>&nbsp;<span class="op" id="4847937">&gt;</span>&nbsp;<span class="ident" id="4847939">uint64Size</span>&nbsp;<span class="op" id="4847950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847954">err</span>&nbsp;<span class="op" id="4847958">=</span>&nbsp;<span class="ident" id="4847960">errBadUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847973">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847984">width</span><span class="op" id="4847989">,</span>&nbsp;<span class="ident" id="4847991">err</span>&nbsp;<span class="op" id="4847995">=</span>&nbsp;<span class="ident" id="4847997">io</span><span class="op" id="4847999">.</span><span class="ident" id="4848000">ReadFull</span><span class="op" id="4848008">(</span><span class="ident" id="4848009">r</span><span class="op" id="4848010">,</span>&nbsp;<span class="ident" id="4848012">buf</span><span class="op" id="4848015">[</span><span class="num" id="4848016">0</span><span class="op" id="4848017">:</span><span class="ident" id="4848018">n</span><span class="op" id="4848019">]</span><span class="op" id="4848020">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848023">if</span>&nbsp;<span class="ident" id="4848026">err</span>&nbsp;<span class="op" id="4848030">!=</span>&nbsp;<span class="ident" id="4848033">nil</span>&nbsp;<span class="op" id="4848037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848041">if</span>&nbsp;<span class="ident" id="4848044">err</span>&nbsp;<span class="op" id="4848048">==</span>&nbsp;<span class="ident" id="4848051">io</span><span class="op" id="4848053">.</span><span class="ident" id="4848054">EOF</span>&nbsp;<span class="op" id="4848058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848063">err</span>&nbsp;<span class="op" id="4848067">=</span>&nbsp;<span class="ident" id="4848069">io</span><span class="op" id="4848071">.</span><span class="ident" id="4848072">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848095">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4848106">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848172">for</span>&nbsp;<span class="ident" id="4848176">_</span><span class="op" id="4848177">,</span>&nbsp;<span class="ident" id="4848179">b</span>&nbsp;<span class="op" id="4848181">:=</span>&nbsp;<span class="keyword" id="4848184">range</span>&nbsp;<span class="ident" id="4848190">buf</span><span class="op" id="4848193">[</span><span class="num" id="4848194">0</span><span class="op" id="4848195">:</span><span class="ident" id="4848196">width</span><span class="op" id="4848201">]</span>&nbsp;<span class="op" id="4848203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848207">x</span>&nbsp;<span class="op" id="4848209">=</span>&nbsp;<span class="ident" id="4848211">x</span><span class="op" id="4848212">&lt;&lt;</span><span class="num" id="4848214">8</span>&nbsp;<span class="op" id="4848216">|</span>&nbsp;<span class="ident" id="4848218">uint64</span><span class="op" id="4848224">(</span><span class="ident" id="4848225">b</span><span class="op" id="4848226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848229">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848232">width</span><span class="op" id="4848237">++</span>&nbsp;<span class="comment" id="4848240">//&nbsp;+1&nbsp;for&nbsp;length&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848263">return</span><br>
<span class="lineno"></span><span class="op" id="4848270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4848273">//&nbsp;decodeUint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno">150</span><span class="comment" id="4848335">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="4848367">func</span>&nbsp;<span class="op" id="4848372">(</span><span class="ident" id="4848373">state</span>&nbsp;<span class="op" id="4848379">*</span><span class="ident" id="4848380">decoderState</span><span class="op" id="4848392">)</span>&nbsp;<span class="ident" id="4848394">decodeUint</span><span class="op" id="4848404">(</span><span class="op" id="4848405">)</span>&nbsp;<span class="op" id="4848407">(</span><span class="ident" id="4848408">x</span>&nbsp;<span class="ident" id="4848410">uint64</span><span class="op" id="4848416">)</span>&nbsp;<span class="op" id="4848418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848421">b</span><span class="op" id="4848422">,</span>&nbsp;<span class="ident" id="4848424">err</span>&nbsp;<span class="op" id="4848428">:=</span>&nbsp;<span class="ident" id="4848431">state</span><span class="op" id="4848436">.</span><span class="ident" id="4848437">b</span><span class="op" id="4848438">.</span><span class="ident" id="4848439">ReadByte</span><span class="op" id="4848447">(</span><span class="op" id="4848448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848451">if</span>&nbsp;<span class="ident" id="4848454">err</span>&nbsp;<span class="op" id="4848458">!=</span>&nbsp;<span class="ident" id="4848461">nil</span>&nbsp;<span class="op" id="4848465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848469">error_</span><span class="op" id="4848475">(</span><span class="ident" id="4848476">err</span><span class="op" id="4848479">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848485">if</span>&nbsp;<span class="ident" id="4848488">b</span>&nbsp;<span class="op" id="4848490">&lt;=</span>&nbsp;<span class="num" id="4848493">0x7f</span>&nbsp;<span class="op" id="4848498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848502">return</span>&nbsp;<span class="ident" id="4848509">uint64</span><span class="op" id="4848515">(</span><span class="ident" id="4848516">b</span><span class="op" id="4848517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848523">n</span>&nbsp;<span class="op" id="4848525">:=</span>&nbsp;<span class="op" id="4848528">-</span><span class="builtintype" id="4848529">int</span><span class="op" id="4848532">(</span><span class="builtintype" id="4848533">int8</span><span class="op" id="4848537">(</span><span class="ident" id="4848538">b</span><span class="op" id="4848539">)</span><span class="op" id="4848540">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848543">if</span>&nbsp;<span class="ident" id="4848546">n</span>&nbsp;<span class="op" id="4848548">&gt;</span>&nbsp;<span class="ident" id="4848550">uint64Size</span>&nbsp;<span class="op" id="4848561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848565">error_</span><span class="op" id="4848571">(</span><span class="ident" id="4848572">errBadUint</span><span class="op" id="4848582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848588">width</span><span class="op" id="4848593">,</span>&nbsp;<span class="ident" id="4848595">err</span>&nbsp;<span class="op" id="4848599">:=</span>&nbsp;<span class="ident" id="4848602">state</span><span class="op" id="4848607">.</span><span class="ident" id="4848608">b</span><span class="op" id="4848609">.</span><span class="ident" id="4848610">Read</span><span class="op" id="4848614">(</span><span class="ident" id="4848615">state</span><span class="op" id="4848620">.</span><span class="ident" id="4848621">buf</span><span class="op" id="4848624">[</span><span class="num" id="4848625">0</span><span class="op" id="4848626">:</span><span class="ident" id="4848627">n</span><span class="op" id="4848628">]</span><span class="op" id="4848629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848632">if</span>&nbsp;<span class="ident" id="4848635">err</span>&nbsp;<span class="op" id="4848639">!=</span>&nbsp;<span class="ident" id="4848642">nil</span>&nbsp;<span class="op" id="4848646">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848650">error_</span><span class="op" id="4848656">(</span><span class="ident" id="4848657">err</span><span class="op" id="4848660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4848666">//&nbsp;Don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;error;&nbsp;it&#39;s&nbsp;safe&nbsp;to&nbsp;loop&nbsp;regardless.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4848727">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848793">for</span>&nbsp;<span class="ident" id="4848797">_</span><span class="op" id="4848798">,</span>&nbsp;<span class="ident" id="4848800">b</span>&nbsp;<span class="op" id="4848802">:=</span>&nbsp;<span class="keyword" id="4848805">range</span>&nbsp;<span class="ident" id="4848811">state</span><span class="op" id="4848816">.</span><span class="ident" id="4848817">buf</span><span class="op" id="4848820">[</span><span class="num" id="4848821">0</span><span class="op" id="4848822">:</span><span class="ident" id="4848823">width</span><span class="op" id="4848828">]</span>&nbsp;<span class="op" id="4848830">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848834">x</span>&nbsp;<span class="op" id="4848836">=</span>&nbsp;<span class="ident" id="4848838">x</span><span class="op" id="4848839">&lt;&lt;</span><span class="num" id="4848841">8</span>&nbsp;<span class="op" id="4848843">|</span>&nbsp;<span class="ident" id="4848845">uint64</span><span class="op" id="4848851">(</span><span class="ident" id="4848852">b</span><span class="op" id="4848853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848859">return</span>&nbsp;<span class="ident" id="4848866">x</span><br>
<span class="lineno"></span><span class="op" id="4848868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="4848871">//&nbsp;decodeInt&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno"></span><span class="comment" id="4848930">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="4848962">func</span>&nbsp;<span class="op" id="4848967">(</span><span class="ident" id="4848968">state</span>&nbsp;<span class="op" id="4848974">*</span><span class="ident" id="4848975">decoderState</span><span class="op" id="4848987">)</span>&nbsp;<span class="ident" id="4848989">decodeInt</span><span class="op" id="4848998">(</span><span class="op" id="4848999">)</span>&nbsp;<span class="ident" id="4849001">int64</span>&nbsp;<span class="op" id="4849007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849010">x</span>&nbsp;<span class="op" id="4849012">:=</span>&nbsp;<span class="ident" id="4849015">state</span><span class="op" id="4849020">.</span><span class="ident" id="4849021">decodeUint</span><span class="op" id="4849031">(</span><span class="op" id="4849032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4849035">if</span>&nbsp;<span class="ident" id="4849038">x</span><span class="op" id="4849039">&amp;</span><span class="num" id="4849040">1</span>&nbsp;<span class="op" id="4849042">!=</span>&nbsp;<span class="num" id="4849045">0</span>&nbsp;<span class="op" id="4849047">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4849051">return</span>&nbsp;<span class="op" id="4849058">^</span><span class="ident" id="4849059">int64</span><span class="op" id="4849064">(</span><span class="ident" id="4849065">x</span>&nbsp;<span class="op" id="4849067">&gt;&gt;</span>&nbsp;<span class="num" id="4849070">1</span><span class="op" id="4849071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4849074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4849077">return</span>&nbsp;<span class="ident" id="4849084">int64</span><span class="op" id="4849089">(</span><span class="ident" id="4849090">x</span>&nbsp;<span class="op" id="4849092">&gt;&gt;</span>&nbsp;<span class="num" id="4849095">1</span><span class="op" id="4849096">)</span><br>
<span class="lineno"></span><span class="op" id="4849098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="4849101">//&nbsp;decOp&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;a&nbsp;decoding&nbsp;operator&nbsp;for&nbsp;a&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4849168">type</span>&nbsp;<span class="ident" id="4849173">decOp</span>&nbsp;<span class="keyword" id="4849179">func</span><span class="op" id="4849183">(</span><span class="ident" id="4849184">i</span>&nbsp;<span class="op" id="4849186">*</span><span class="ident" id="4849187">decInstr</span><span class="op" id="4849195">,</span>&nbsp;<span class="ident" id="4849197">state</span>&nbsp;<span class="op" id="4849203">*</span><span class="ident" id="4849204">decoderState</span><span class="op" id="4849216">,</span>&nbsp;<span class="ident" id="4849218">v</span>&nbsp;<span class="ident" id="4849220">reflect</span><span class="op" id="4849227">.</span><span class="ident" id="4849228">Value</span><span class="op" id="4849233">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4849236">//&nbsp;The&nbsp;&#39;instructions&#39;&nbsp;of&nbsp;the&nbsp;decoding&nbsp;machine</span><br>
<span class="lineno"></span><span class="keyword" id="4849282">type</span>&nbsp;<span class="ident" id="4849287">decInstr</span>&nbsp;<span class="keyword" id="4849296">struct</span>&nbsp;<span class="op" id="4849303">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849306">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4849312">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849319">field</span>&nbsp;<span class="builtintype" id="4849325">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4849331">//&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;wire&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849365">index</span>&nbsp;<span class="op" id="4849371">[</span><span class="op" id="4849372">]</span><span class="builtintype" id="4849373">int</span>&nbsp;<span class="comment" id="4849377">//&nbsp;field&nbsp;access&nbsp;indices&nbsp;for&nbsp;destination&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849423">ovfl</span>&nbsp;&nbsp;<span class="builtintype" id="4849429">error</span>&nbsp;<span class="comment" id="4849435">//&nbsp;error&nbsp;message&nbsp;for&nbsp;overflow/underflow&nbsp;(for&nbsp;arrays,&nbsp;of&nbsp;the&nbsp;elements)</span><br>
<span class="lineno"></span><span class="op" id="4849505">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4849508">//&nbsp;ignoreUint&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4849565">func</span>&nbsp;<span class="ident" id="4849570">ignoreUint</span><span class="op" id="4849580">(</span><span class="ident" id="4849581">i</span>&nbsp;<span class="op" id="4849583">*</span><span class="ident" id="4849584">decInstr</span><span class="op" id="4849592">,</span>&nbsp;<span class="ident" id="4849594">state</span>&nbsp;<span class="op" id="4849600">*</span><span class="ident" id="4849601">decoderState</span><span class="op" id="4849613">,</span>&nbsp;<span class="ident" id="4849615">v</span>&nbsp;<span class="ident" id="4849617">reflect</span><span class="op" id="4849624">.</span><span class="ident" id="4849625">Value</span><span class="op" id="4849630">)</span>&nbsp;<span class="op" id="4849632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849635">state</span><span class="op" id="4849640">.</span><span class="ident" id="4849641">decodeUint</span><span class="op" id="4849651">(</span><span class="op" id="4849652">)</span><br>
<span class="lineno"></span><span class="op" id="4849654">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="4849657">//&nbsp;ignoreTwoUints&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;to&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="4849736">//&nbsp;complex&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4849755">func</span>&nbsp;<span class="ident" id="4849760">ignoreTwoUints</span><span class="op" id="4849774">(</span><span class="ident" id="4849775">i</span>&nbsp;<span class="op" id="4849777">*</span><span class="ident" id="4849778">decInstr</span><span class="op" id="4849786">,</span>&nbsp;<span class="ident" id="4849788">state</span>&nbsp;<span class="op" id="4849794">*</span><span class="ident" id="4849795">decoderState</span><span class="op" id="4849807">,</span>&nbsp;<span class="ident" id="4849809">v</span>&nbsp;<span class="ident" id="4849811">reflect</span><span class="op" id="4849818">.</span><span class="ident" id="4849819">Value</span><span class="op" id="4849824">)</span>&nbsp;<span class="op" id="4849826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849829">state</span><span class="op" id="4849834">.</span><span class="ident" id="4849835">decodeUint</span><span class="op" id="4849845">(</span><span class="op" id="4849846">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849849">state</span><span class="op" id="4849854">.</span><span class="ident" id="4849855">decodeUint</span><span class="op" id="4849865">(</span><span class="op" id="4849866">)</span><br>
<span class="lineno"></span><span class="op" id="4849868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4849871">//&nbsp;Since&nbsp;the&nbsp;encoder&nbsp;writes&nbsp;no&nbsp;zeros,&nbsp;if&nbsp;we&nbsp;arrive&nbsp;at&nbsp;a&nbsp;decoder&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4849943">//&nbsp;a&nbsp;value&nbsp;to&nbsp;extract&nbsp;and&nbsp;store.&nbsp;&nbsp;The&nbsp;field&nbsp;number&nbsp;has&nbsp;already&nbsp;been&nbsp;read</span><br>
<span class="lineno">210</span><span class="comment" id="4850016">//&nbsp;(it&#39;s&nbsp;how&nbsp;we&nbsp;knew&nbsp;to&nbsp;call&nbsp;this&nbsp;decoder).</span><br>
<span class="lineno"></span><span class="comment" id="4850060">//&nbsp;Each&nbsp;decoder&nbsp;is&nbsp;responsible&nbsp;for&nbsp;handling&nbsp;any&nbsp;indirections&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4850132">//&nbsp;with&nbsp;the&nbsp;data&nbsp;structure.&nbsp;&nbsp;If&nbsp;any&nbsp;pointer&nbsp;so&nbsp;reached&nbsp;is&nbsp;nil,&nbsp;allocation&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4850211">//&nbsp;be&nbsp;done.</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="4850224">//&nbsp;decAlloc&nbsp;takes&nbsp;a&nbsp;value&nbsp;and&nbsp;returns&nbsp;a&nbsp;settable&nbsp;value&nbsp;that&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="4850288">//&nbsp;be&nbsp;assigned&nbsp;to.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer,&nbsp;decAlloc&nbsp;guarantees&nbsp;it&nbsp;points&nbsp;to&nbsp;storage.</span><br>
<span class="lineno"></span><span class="comment" id="4850376">//&nbsp;The&nbsp;callers&nbsp;to&nbsp;the&nbsp;individual&nbsp;decoders&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;used&nbsp;decAlloc.</span><br>
<span class="lineno"></span><span class="comment" id="4850454">//&nbsp;The&nbsp;individual&nbsp;decoders&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4850499">func</span>&nbsp;<span class="ident" id="4850504">decAlloc</span><span class="op" id="4850512">(</span><span class="ident" id="4850513">v</span>&nbsp;<span class="ident" id="4850515">reflect</span><span class="op" id="4850522">.</span><span class="ident" id="4850523">Value</span><span class="op" id="4850528">)</span>&nbsp;<span class="ident" id="4850530">reflect</span><span class="op" id="4850537">.</span><span class="ident" id="4850538">Value</span>&nbsp;<span class="op" id="4850544">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4850547">for</span>&nbsp;<span class="ident" id="4850551">v</span><span class="op" id="4850552">.</span><span class="ident" id="4850553">Kind</span><span class="op" id="4850557">(</span><span class="op" id="4850558">)</span>&nbsp;<span class="op" id="4850560">==</span>&nbsp;<span class="ident" id="4850563">reflect</span><span class="op" id="4850570">.</span><span class="ident" id="4850571">Ptr</span>&nbsp;<span class="op" id="4850575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4850579">if</span>&nbsp;<span class="ident" id="4850582">v</span><span class="op" id="4850583">.</span><span class="ident" id="4850584">IsNil</span><span class="op" id="4850589">(</span><span class="op" id="4850590">)</span>&nbsp;<span class="op" id="4850592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850597">v</span><span class="op" id="4850598">.</span><span class="ident" id="4850599">Set</span><span class="op" id="4850602">(</span><span class="ident" id="4850603">reflect</span><span class="op" id="4850610">.</span><span class="ident" id="4850611">New</span><span class="op" id="4850614">(</span><span class="ident" id="4850615">v</span><span class="op" id="4850616">.</span><span class="ident" id="4850617">Type</span><span class="op" id="4850621">(</span><span class="op" id="4850622">)</span><span class="op" id="4850623">.</span><span class="ident" id="4850624">Elem</span><span class="op" id="4850628">(</span><span class="op" id="4850629">)</span><span class="op" id="4850630">)</span><span class="op" id="4850631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4850635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850639">v</span>&nbsp;<span class="op" id="4850641">=</span>&nbsp;<span class="ident" id="4850643">v</span><span class="op" id="4850644">.</span><span class="ident" id="4850645">Elem</span><span class="op" id="4850649">(</span><span class="op" id="4850650">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4850653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4850656">return</span>&nbsp;<span class="ident" id="4850663">v</span><br>
<span class="lineno"></span><span class="op" id="4850665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4850668">//&nbsp;decBool&nbsp;decodes&nbsp;a&nbsp;uint&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;boolean&nbsp;in&nbsp;value.</span><br>
<span class="lineno">230</span><span class="keyword" id="4850731">func</span>&nbsp;<span class="ident" id="4850736">decBool</span><span class="op" id="4850743">(</span><span class="ident" id="4850744">i</span>&nbsp;<span class="op" id="4850746">*</span><span class="ident" id="4850747">decInstr</span><span class="op" id="4850755">,</span>&nbsp;<span class="ident" id="4850757">state</span>&nbsp;<span class="op" id="4850763">*</span><span class="ident" id="4850764">decoderState</span><span class="op" id="4850776">,</span>&nbsp;<span class="ident" id="4850778">value</span>&nbsp;<span class="ident" id="4850784">reflect</span><span class="op" id="4850791">.</span><span class="ident" id="4850792">Value</span><span class="op" id="4850797">)</span>&nbsp;<span class="op" id="4850799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850802">value</span><span class="op" id="4850807">.</span><span class="ident" id="4850808">SetBool</span><span class="op" id="4850815">(</span><span class="ident" id="4850816">state</span><span class="op" id="4850821">.</span><span class="ident" id="4850822">decodeUint</span><span class="op" id="4850832">(</span><span class="op" id="4850833">)</span>&nbsp;<span class="op" id="4850835">!=</span>&nbsp;<span class="num" id="4850838">0</span><span class="op" id="4850839">)</span><br>
<span class="lineno"></span><span class="op" id="4850841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4850844">//&nbsp;decInt8&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int8&nbsp;in&nbsp;value.</span><br>
<span class="lineno">235</span><span class="keyword" id="4850909">func</span>&nbsp;<span class="ident" id="4850914">decInt8</span><span class="op" id="4850921">(</span><span class="ident" id="4850922">i</span>&nbsp;<span class="op" id="4850924">*</span><span class="ident" id="4850925">decInstr</span><span class="op" id="4850933">,</span>&nbsp;<span class="ident" id="4850935">state</span>&nbsp;<span class="op" id="4850941">*</span><span class="ident" id="4850942">decoderState</span><span class="op" id="4850954">,</span>&nbsp;<span class="ident" id="4850956">value</span>&nbsp;<span class="ident" id="4850962">reflect</span><span class="op" id="4850969">.</span><span class="ident" id="4850970">Value</span><span class="op" id="4850975">)</span>&nbsp;<span class="op" id="4850977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850980">v</span>&nbsp;<span class="op" id="4850982">:=</span>&nbsp;<span class="ident" id="4850985">state</span><span class="op" id="4850990">.</span><span class="ident" id="4850991">decodeInt</span><span class="op" id="4851000">(</span><span class="op" id="4851001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4851004">if</span>&nbsp;<span class="ident" id="4851007">v</span>&nbsp;<span class="op" id="4851009">&lt;</span>&nbsp;<span class="ident" id="4851011">math</span><span class="op" id="4851015">.</span><span class="ident" id="4851016">MinInt8</span>&nbsp;<span class="op" id="4851024">||</span>&nbsp;<span class="ident" id="4851027">math</span><span class="op" id="4851031">.</span><span class="ident" id="4851032">MaxInt8</span>&nbsp;<span class="op" id="4851040">&lt;</span>&nbsp;<span class="ident" id="4851042">v</span>&nbsp;<span class="op" id="4851044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851048">error_</span><span class="op" id="4851054">(</span><span class="ident" id="4851055">i</span><span class="op" id="4851056">.</span><span class="ident" id="4851057">ovfl</span><span class="op" id="4851061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851064">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851067">value</span><span class="op" id="4851072">.</span><span class="ident" id="4851073">SetInt</span><span class="op" id="4851079">(</span><span class="ident" id="4851080">v</span><span class="op" id="4851081">)</span><br>
<span class="lineno"></span><span class="op" id="4851083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4851086">//&nbsp;decUint8&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint8&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4851161">func</span>&nbsp;<span class="ident" id="4851166">decUint8</span><span class="op" id="4851174">(</span><span class="ident" id="4851175">i</span>&nbsp;<span class="op" id="4851177">*</span><span class="ident" id="4851178">decInstr</span><span class="op" id="4851186">,</span>&nbsp;<span class="ident" id="4851188">state</span>&nbsp;<span class="op" id="4851194">*</span><span class="ident" id="4851195">decoderState</span><span class="op" id="4851207">,</span>&nbsp;<span class="ident" id="4851209">value</span>&nbsp;<span class="ident" id="4851215">reflect</span><span class="op" id="4851222">.</span><span class="ident" id="4851223">Value</span><span class="op" id="4851228">)</span>&nbsp;<span class="op" id="4851230">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851233">v</span>&nbsp;<span class="op" id="4851235">:=</span>&nbsp;<span class="ident" id="4851238">state</span><span class="op" id="4851243">.</span><span class="ident" id="4851244">decodeUint</span><span class="op" id="4851254">(</span><span class="op" id="4851255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4851258">if</span>&nbsp;<span class="ident" id="4851261">math</span><span class="op" id="4851265">.</span><span class="ident" id="4851266">MaxUint8</span>&nbsp;<span class="op" id="4851275">&lt;</span>&nbsp;<span class="ident" id="4851277">v</span>&nbsp;<span class="op" id="4851279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851283">error_</span><span class="op" id="4851289">(</span><span class="ident" id="4851290">i</span><span class="op" id="4851291">.</span><span class="ident" id="4851292">ovfl</span><span class="op" id="4851296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851302">value</span><span class="op" id="4851307">.</span><span class="ident" id="4851308">SetUint</span><span class="op" id="4851315">(</span><span class="ident" id="4851316">v</span><span class="op" id="4851317">)</span><br>
<span class="lineno">250</span><span class="op" id="4851319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4851322">//&nbsp;decInt16&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4851389">func</span>&nbsp;<span class="ident" id="4851394">decInt16</span><span class="op" id="4851402">(</span><span class="ident" id="4851403">i</span>&nbsp;<span class="op" id="4851405">*</span><span class="ident" id="4851406">decInstr</span><span class="op" id="4851414">,</span>&nbsp;<span class="ident" id="4851416">state</span>&nbsp;<span class="op" id="4851422">*</span><span class="ident" id="4851423">decoderState</span><span class="op" id="4851435">,</span>&nbsp;<span class="ident" id="4851437">value</span>&nbsp;<span class="ident" id="4851443">reflect</span><span class="op" id="4851450">.</span><span class="ident" id="4851451">Value</span><span class="op" id="4851456">)</span>&nbsp;<span class="op" id="4851458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851461">v</span>&nbsp;<span class="op" id="4851463">:=</span>&nbsp;<span class="ident" id="4851466">state</span><span class="op" id="4851471">.</span><span class="ident" id="4851472">decodeInt</span><span class="op" id="4851481">(</span><span class="op" id="4851482">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4851485">if</span>&nbsp;<span class="ident" id="4851488">v</span>&nbsp;<span class="op" id="4851490">&lt;</span>&nbsp;<span class="ident" id="4851492">math</span><span class="op" id="4851496">.</span><span class="ident" id="4851497">MinInt16</span>&nbsp;<span class="op" id="4851506">||</span>&nbsp;<span class="ident" id="4851509">math</span><span class="op" id="4851513">.</span><span class="ident" id="4851514">MaxInt16</span>&nbsp;<span class="op" id="4851523">&lt;</span>&nbsp;<span class="ident" id="4851525">v</span>&nbsp;<span class="op" id="4851527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851531">error_</span><span class="op" id="4851537">(</span><span class="ident" id="4851538">i</span><span class="op" id="4851539">.</span><span class="ident" id="4851540">ovfl</span><span class="op" id="4851544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851550">value</span><span class="op" id="4851555">.</span><span class="ident" id="4851556">SetInt</span><span class="op" id="4851562">(</span><span class="ident" id="4851563">v</span><span class="op" id="4851564">)</span><br>
<span class="lineno"></span><span class="op" id="4851566">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="4851569">//&nbsp;decUint16&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4851646">func</span>&nbsp;<span class="ident" id="4851651">decUint16</span><span class="op" id="4851660">(</span><span class="ident" id="4851661">i</span>&nbsp;<span class="op" id="4851663">*</span><span class="ident" id="4851664">decInstr</span><span class="op" id="4851672">,</span>&nbsp;<span class="ident" id="4851674">state</span>&nbsp;<span class="op" id="4851680">*</span><span class="ident" id="4851681">decoderState</span><span class="op" id="4851693">,</span>&nbsp;<span class="ident" id="4851695">value</span>&nbsp;<span class="ident" id="4851701">reflect</span><span class="op" id="4851708">.</span><span class="ident" id="4851709">Value</span><span class="op" id="4851714">)</span>&nbsp;<span class="op" id="4851716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851719">v</span>&nbsp;<span class="op" id="4851721">:=</span>&nbsp;<span class="ident" id="4851724">state</span><span class="op" id="4851729">.</span><span class="ident" id="4851730">decodeUint</span><span class="op" id="4851740">(</span><span class="op" id="4851741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4851744">if</span>&nbsp;<span class="ident" id="4851747">math</span><span class="op" id="4851751">.</span><span class="ident" id="4851752">MaxUint16</span>&nbsp;<span class="op" id="4851762">&lt;</span>&nbsp;<span class="ident" id="4851764">v</span>&nbsp;<span class="op" id="4851766">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851770">error_</span><span class="op" id="4851776">(</span><span class="ident" id="4851777">i</span><span class="op" id="4851778">.</span><span class="ident" id="4851779">ovfl</span><span class="op" id="4851783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851789">value</span><span class="op" id="4851794">.</span><span class="ident" id="4851795">SetUint</span><span class="op" id="4851802">(</span><span class="ident" id="4851803">v</span><span class="op" id="4851804">)</span><br>
<span class="lineno"></span><span class="op" id="4851806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4851809">//&nbsp;decInt32&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int32&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4851876">func</span>&nbsp;<span class="ident" id="4851881">decInt32</span><span class="op" id="4851889">(</span><span class="ident" id="4851890">i</span>&nbsp;<span class="op" id="4851892">*</span><span class="ident" id="4851893">decInstr</span><span class="op" id="4851901">,</span>&nbsp;<span class="ident" id="4851903">state</span>&nbsp;<span class="op" id="4851909">*</span><span class="ident" id="4851910">decoderState</span><span class="op" id="4851922">,</span>&nbsp;<span class="ident" id="4851924">value</span>&nbsp;<span class="ident" id="4851930">reflect</span><span class="op" id="4851937">.</span><span class="ident" id="4851938">Value</span><span class="op" id="4851943">)</span>&nbsp;<span class="op" id="4851945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851948">v</span>&nbsp;<span class="op" id="4851950">:=</span>&nbsp;<span class="ident" id="4851953">state</span><span class="op" id="4851958">.</span><span class="ident" id="4851959">decodeInt</span><span class="op" id="4851968">(</span><span class="op" id="4851969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4851972">if</span>&nbsp;<span class="ident" id="4851975">v</span>&nbsp;<span class="op" id="4851977">&lt;</span>&nbsp;<span class="ident" id="4851979">math</span><span class="op" id="4851983">.</span><span class="ident" id="4851984">MinInt32</span>&nbsp;<span class="op" id="4851993">||</span>&nbsp;<span class="ident" id="4851996">math</span><span class="op" id="4852000">.</span><span class="ident" id="4852001">MaxInt32</span>&nbsp;<span class="op" id="4852010">&lt;</span>&nbsp;<span class="ident" id="4852012">v</span>&nbsp;<span class="op" id="4852014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852018">error_</span><span class="op" id="4852024">(</span><span class="ident" id="4852025">i</span><span class="op" id="4852026">.</span><span class="ident" id="4852027">ovfl</span><span class="op" id="4852031">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4852034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852037">value</span><span class="op" id="4852042">.</span><span class="ident" id="4852043">SetInt</span><span class="op" id="4852049">(</span><span class="ident" id="4852050">v</span><span class="op" id="4852051">)</span><br>
<span class="lineno"></span><span class="op" id="4852053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4852056">//&nbsp;decUint32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint32&nbsp;in&nbsp;value.</span><br>
<span class="lineno">280</span><span class="keyword" id="4852133">func</span>&nbsp;<span class="ident" id="4852138">decUint32</span><span class="op" id="4852147">(</span><span class="ident" id="4852148">i</span>&nbsp;<span class="op" id="4852150">*</span><span class="ident" id="4852151">decInstr</span><span class="op" id="4852159">,</span>&nbsp;<span class="ident" id="4852161">state</span>&nbsp;<span class="op" id="4852167">*</span><span class="ident" id="4852168">decoderState</span><span class="op" id="4852180">,</span>&nbsp;<span class="ident" id="4852182">value</span>&nbsp;<span class="ident" id="4852188">reflect</span><span class="op" id="4852195">.</span><span class="ident" id="4852196">Value</span><span class="op" id="4852201">)</span>&nbsp;<span class="op" id="4852203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852206">v</span>&nbsp;<span class="op" id="4852208">:=</span>&nbsp;<span class="ident" id="4852211">state</span><span class="op" id="4852216">.</span><span class="ident" id="4852217">decodeUint</span><span class="op" id="4852227">(</span><span class="op" id="4852228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852231">if</span>&nbsp;<span class="ident" id="4852234">math</span><span class="op" id="4852238">.</span><span class="ident" id="4852239">MaxUint32</span>&nbsp;<span class="op" id="4852249">&lt;</span>&nbsp;<span class="ident" id="4852251">v</span>&nbsp;<span class="op" id="4852253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852257">error_</span><span class="op" id="4852263">(</span><span class="ident" id="4852264">i</span><span class="op" id="4852265">.</span><span class="ident" id="4852266">ovfl</span><span class="op" id="4852270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4852273">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852276">value</span><span class="op" id="4852281">.</span><span class="ident" id="4852282">SetUint</span><span class="op" id="4852289">(</span><span class="ident" id="4852290">v</span><span class="op" id="4852291">)</span><br>
<span class="lineno"></span><span class="op" id="4852293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4852296">//&nbsp;decInt64&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4852363">func</span>&nbsp;<span class="ident" id="4852368">decInt64</span><span class="op" id="4852376">(</span><span class="ident" id="4852377">i</span>&nbsp;<span class="op" id="4852379">*</span><span class="ident" id="4852380">decInstr</span><span class="op" id="4852388">,</span>&nbsp;<span class="ident" id="4852390">state</span>&nbsp;<span class="op" id="4852396">*</span><span class="ident" id="4852397">decoderState</span><span class="op" id="4852409">,</span>&nbsp;<span class="ident" id="4852411">value</span>&nbsp;<span class="ident" id="4852417">reflect</span><span class="op" id="4852424">.</span><span class="ident" id="4852425">Value</span><span class="op" id="4852430">)</span>&nbsp;<span class="op" id="4852432">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852435">v</span>&nbsp;<span class="op" id="4852437">:=</span>&nbsp;<span class="ident" id="4852440">state</span><span class="op" id="4852445">.</span><span class="ident" id="4852446">decodeInt</span><span class="op" id="4852455">(</span><span class="op" id="4852456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852459">value</span><span class="op" id="4852464">.</span><span class="ident" id="4852465">SetInt</span><span class="op" id="4852471">(</span><span class="ident" id="4852472">v</span><span class="op" id="4852473">)</span><br>
<span class="lineno"></span><span class="op" id="4852475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4852478">//&nbsp;decUint64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64&nbsp;in&nbsp;value.</span><br>
<span class="lineno">295</span><span class="keyword" id="4852555">func</span>&nbsp;<span class="ident" id="4852560">decUint64</span><span class="op" id="4852569">(</span><span class="ident" id="4852570">i</span>&nbsp;<span class="op" id="4852572">*</span><span class="ident" id="4852573">decInstr</span><span class="op" id="4852581">,</span>&nbsp;<span class="ident" id="4852583">state</span>&nbsp;<span class="op" id="4852589">*</span><span class="ident" id="4852590">decoderState</span><span class="op" id="4852602">,</span>&nbsp;<span class="ident" id="4852604">value</span>&nbsp;<span class="ident" id="4852610">reflect</span><span class="op" id="4852617">.</span><span class="ident" id="4852618">Value</span><span class="op" id="4852623">)</span>&nbsp;<span class="op" id="4852625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852628">v</span>&nbsp;<span class="op" id="4852630">:=</span>&nbsp;<span class="ident" id="4852633">state</span><span class="op" id="4852638">.</span><span class="ident" id="4852639">decodeUint</span><span class="op" id="4852649">(</span><span class="op" id="4852650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852653">value</span><span class="op" id="4852658">.</span><span class="ident" id="4852659">SetUint</span><span class="op" id="4852666">(</span><span class="ident" id="4852667">v</span><span class="op" id="4852668">)</span><br>
<span class="lineno"></span><span class="op" id="4852670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="4852673">//&nbsp;Floating-point&nbsp;numbers&nbsp;are&nbsp;transmitted&nbsp;as&nbsp;uint64s&nbsp;holding&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4852743">//&nbsp;of&nbsp;the&nbsp;underlying&nbsp;representation.&nbsp;&nbsp;They&nbsp;are&nbsp;sent&nbsp;byte-reversed,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4852815">//&nbsp;the&nbsp;exponent&nbsp;end&nbsp;coming&nbsp;out&nbsp;first,&nbsp;so&nbsp;integer&nbsp;floating&nbsp;point&nbsp;numbers</span><br>
<span class="lineno"></span><span class="comment" id="4852887">//&nbsp;(for&nbsp;example)&nbsp;transmit&nbsp;more&nbsp;compactly.&nbsp;&nbsp;This&nbsp;routine&nbsp;does&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4852952">//&nbsp;unswizzling.</span><br>
<span class="lineno">305</span><span class="keyword" id="4852968">func</span>&nbsp;<span class="ident" id="4852973">float64FromBits</span><span class="op" id="4852988">(</span><span class="ident" id="4852989">u</span>&nbsp;<span class="ident" id="4852991">uint64</span><span class="op" id="4852997">)</span>&nbsp;<span class="builtintype" id="4852999">float64</span>&nbsp;<span class="op" id="4853007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853010">var</span>&nbsp;<span class="ident" id="4853014">v</span>&nbsp;<span class="ident" id="4853016">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853024">for</span>&nbsp;<span class="ident" id="4853028">i</span>&nbsp;<span class="op" id="4853030">:=</span>&nbsp;<span class="num" id="4853033">0</span><span class="op" id="4853034">;</span>&nbsp;<span class="ident" id="4853036">i</span>&nbsp;<span class="op" id="4853038">&lt;</span>&nbsp;<span class="num" id="4853040">8</span><span class="op" id="4853041">;</span>&nbsp;<span class="ident" id="4853043">i</span><span class="op" id="4853044">++</span>&nbsp;<span class="op" id="4853047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853051">v</span>&nbsp;<span class="op" id="4853053">&lt;&lt;=</span>&nbsp;<span class="num" id="4853057">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853061">v</span>&nbsp;<span class="op" id="4853063">|=</span>&nbsp;<span class="ident" id="4853066">u</span>&nbsp;<span class="op" id="4853068">&amp;</span>&nbsp;<span class="num" id="4853070">0xFF</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853077">u</span>&nbsp;<span class="op" id="4853079">&gt;&gt;=</span>&nbsp;<span class="num" id="4853083">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4853086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853089">return</span>&nbsp;<span class="ident" id="4853096">math</span><span class="op" id="4853100">.</span><span class="ident" id="4853101">Float64frombits</span><span class="op" id="4853116">(</span><span class="ident" id="4853117">v</span><span class="op" id="4853118">)</span><br>
<span class="lineno"></span><span class="op" id="4853120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="4853123">//&nbsp;float32FromBits&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4853208">//&nbsp;number,&nbsp;and&nbsp;returns&nbsp;it.&nbsp;It&#39;s&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;float32&nbsp;and&nbsp;complex64.</span><br>
<span class="lineno"></span><span class="comment" id="4853285">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;float64&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;reflection&nbsp;needs,&nbsp;but&nbsp;its&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4853362">//&nbsp;value&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;accurately&nbsp;representable&nbsp;in&nbsp;a&nbsp;float32.</span><br>
<span class="lineno"></span><span class="keyword" id="4853425">func</span>&nbsp;<span class="ident" id="4853430">float32FromBits</span><span class="op" id="4853445">(</span><span class="ident" id="4853446">u</span>&nbsp;<span class="ident" id="4853448">uint64</span><span class="op" id="4853454">,</span>&nbsp;<span class="ident" id="4853456">ovfl</span>&nbsp;<span class="builtintype" id="4853461">error</span><span class="op" id="4853466">)</span>&nbsp;<span class="builtintype" id="4853468">float64</span>&nbsp;<span class="op" id="4853476">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853479">v</span>&nbsp;<span class="op" id="4853481">:=</span>&nbsp;<span class="ident" id="4853484">float64FromBits</span><span class="op" id="4853499">(</span><span class="ident" id="4853500">u</span><span class="op" id="4853501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853504">av</span>&nbsp;<span class="op" id="4853507">:=</span>&nbsp;<span class="ident" id="4853510">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853513">if</span>&nbsp;<span class="ident" id="4853516">av</span>&nbsp;<span class="op" id="4853519">&lt;</span>&nbsp;<span class="num" id="4853521">0</span>&nbsp;<span class="op" id="4853523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853527">av</span>&nbsp;<span class="op" id="4853530">=</span>&nbsp;<span class="op" id="4853532">-</span><span class="ident" id="4853533">av</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4853537">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4853540">//&nbsp;+Inf&nbsp;is&nbsp;OK&nbsp;in&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;floats.&nbsp;&nbsp;Underflow&nbsp;is&nbsp;always&nbsp;OK.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853611">if</span>&nbsp;<span class="ident" id="4853614">math</span><span class="op" id="4853618">.</span><span class="ident" id="4853619">MaxFloat32</span>&nbsp;<span class="op" id="4853630">&lt;</span>&nbsp;<span class="ident" id="4853632">av</span>&nbsp;<span class="op" id="4853635">&amp;&amp;</span>&nbsp;<span class="ident" id="4853638">av</span>&nbsp;<span class="op" id="4853641">&lt;=</span>&nbsp;<span class="ident" id="4853644">math</span><span class="op" id="4853648">.</span><span class="ident" id="4853649">MaxFloat64</span>&nbsp;<span class="op" id="4853660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853664">error_</span><span class="op" id="4853670">(</span><span class="ident" id="4853671">ovfl</span><span class="op" id="4853675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4853678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853681">return</span>&nbsp;<span class="ident" id="4853688">v</span><br>
<span class="lineno">330</span><span class="op" id="4853690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4853693">//&nbsp;decFloat32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4853773">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4853808">func</span>&nbsp;<span class="ident" id="4853813">decFloat32</span><span class="op" id="4853823">(</span><span class="ident" id="4853824">i</span>&nbsp;<span class="op" id="4853826">*</span><span class="ident" id="4853827">decInstr</span><span class="op" id="4853835">,</span>&nbsp;<span class="ident" id="4853837">state</span>&nbsp;<span class="op" id="4853843">*</span><span class="ident" id="4853844">decoderState</span><span class="op" id="4853856">,</span>&nbsp;<span class="ident" id="4853858">value</span>&nbsp;<span class="ident" id="4853864">reflect</span><span class="op" id="4853871">.</span><span class="ident" id="4853872">Value</span><span class="op" id="4853877">)</span>&nbsp;<span class="op" id="4853879">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853882">value</span><span class="op" id="4853887">.</span><span class="ident" id="4853888">SetFloat</span><span class="op" id="4853896">(</span><span class="ident" id="4853897">float32FromBits</span><span class="op" id="4853912">(</span><span class="ident" id="4853913">state</span><span class="op" id="4853918">.</span><span class="ident" id="4853919">decodeUint</span><span class="op" id="4853929">(</span><span class="op" id="4853930">)</span><span class="op" id="4853931">,</span>&nbsp;<span class="ident" id="4853933">i</span><span class="op" id="4853934">.</span><span class="ident" id="4853935">ovfl</span><span class="op" id="4853939">)</span><span class="op" id="4853940">)</span><br>
<span class="lineno"></span><span class="op" id="4853942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4853945">//&nbsp;decFloat64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;64-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4854025">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">340</span><span class="keyword" id="4854060">func</span>&nbsp;<span class="ident" id="4854065">decFloat64</span><span class="op" id="4854075">(</span><span class="ident" id="4854076">i</span>&nbsp;<span class="op" id="4854078">*</span><span class="ident" id="4854079">decInstr</span><span class="op" id="4854087">,</span>&nbsp;<span class="ident" id="4854089">state</span>&nbsp;<span class="op" id="4854095">*</span><span class="ident" id="4854096">decoderState</span><span class="op" id="4854108">,</span>&nbsp;<span class="ident" id="4854110">value</span>&nbsp;<span class="ident" id="4854116">reflect</span><span class="op" id="4854123">.</span><span class="ident" id="4854124">Value</span><span class="op" id="4854129">)</span>&nbsp;<span class="op" id="4854131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854134">value</span><span class="op" id="4854139">.</span><span class="ident" id="4854140">SetFloat</span><span class="op" id="4854148">(</span><span class="ident" id="4854149">float64FromBits</span><span class="op" id="4854164">(</span><span class="ident" id="4854165">state</span><span class="op" id="4854170">.</span><span class="ident" id="4854171">decodeUint</span><span class="op" id="4854181">(</span><span class="op" id="4854182">)</span><span class="op" id="4854183">)</span><span class="op" id="4854184">)</span><br>
<span class="lineno"></span><span class="op" id="4854186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4854189">//&nbsp;decComplex64&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno">345</span><span class="comment" id="4854259">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4854335">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4854365">func</span>&nbsp;<span class="ident" id="4854370">decComplex64</span><span class="op" id="4854382">(</span><span class="ident" id="4854383">i</span>&nbsp;<span class="op" id="4854385">*</span><span class="ident" id="4854386">decInstr</span><span class="op" id="4854394">,</span>&nbsp;<span class="ident" id="4854396">state</span>&nbsp;<span class="op" id="4854402">*</span><span class="ident" id="4854403">decoderState</span><span class="op" id="4854415">,</span>&nbsp;<span class="ident" id="4854417">value</span>&nbsp;<span class="ident" id="4854423">reflect</span><span class="op" id="4854430">.</span><span class="ident" id="4854431">Value</span><span class="op" id="4854436">)</span>&nbsp;<span class="op" id="4854438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4854441">real</span>&nbsp;<span class="op" id="4854446">:=</span>&nbsp;<span class="ident" id="4854449">float32FromBits</span><span class="op" id="4854464">(</span><span class="ident" id="4854465">state</span><span class="op" id="4854470">.</span><span class="ident" id="4854471">decodeUint</span><span class="op" id="4854481">(</span><span class="op" id="4854482">)</span><span class="op" id="4854483">,</span>&nbsp;<span class="ident" id="4854485">i</span><span class="op" id="4854486">.</span><span class="ident" id="4854487">ovfl</span><span class="op" id="4854491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4854494">imag</span>&nbsp;<span class="op" id="4854499">:=</span>&nbsp;<span class="ident" id="4854502">float32FromBits</span><span class="op" id="4854517">(</span><span class="ident" id="4854518">state</span><span class="op" id="4854523">.</span><span class="ident" id="4854524">decodeUint</span><span class="op" id="4854534">(</span><span class="op" id="4854535">)</span><span class="op" id="4854536">,</span>&nbsp;<span class="ident" id="4854538">i</span><span class="op" id="4854539">.</span><span class="ident" id="4854540">ovfl</span><span class="op" id="4854544">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854547">value</span><span class="op" id="4854552">.</span><span class="ident" id="4854553">SetComplex</span><span class="op" id="4854563">(</span><span class="builtinfunc" id="4854564">complex</span><span class="op" id="4854571">(</span><span class="builtinfunc" id="4854572">real</span><span class="op" id="4854576">,</span>&nbsp;<span class="builtinfunc" id="4854578">imag</span><span class="op" id="4854582">)</span><span class="op" id="4854583">)</span><br>
<span class="lineno"></span><span class="op" id="4854585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4854588">//&nbsp;decComplex128&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4854659">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex128&nbsp;in&nbsp;value.</span><br>
<span class="lineno">355</span><span class="comment" id="4854736">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4854766">func</span>&nbsp;<span class="ident" id="4854771">decComplex128</span><span class="op" id="4854784">(</span><span class="ident" id="4854785">i</span>&nbsp;<span class="op" id="4854787">*</span><span class="ident" id="4854788">decInstr</span><span class="op" id="4854796">,</span>&nbsp;<span class="ident" id="4854798">state</span>&nbsp;<span class="op" id="4854804">*</span><span class="ident" id="4854805">decoderState</span><span class="op" id="4854817">,</span>&nbsp;<span class="ident" id="4854819">value</span>&nbsp;<span class="ident" id="4854825">reflect</span><span class="op" id="4854832">.</span><span class="ident" id="4854833">Value</span><span class="op" id="4854838">)</span>&nbsp;<span class="op" id="4854840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4854843">real</span>&nbsp;<span class="op" id="4854848">:=</span>&nbsp;<span class="ident" id="4854851">float64FromBits</span><span class="op" id="4854866">(</span><span class="ident" id="4854867">state</span><span class="op" id="4854872">.</span><span class="ident" id="4854873">decodeUint</span><span class="op" id="4854883">(</span><span class="op" id="4854884">)</span><span class="op" id="4854885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4854888">imag</span>&nbsp;<span class="op" id="4854893">:=</span>&nbsp;<span class="ident" id="4854896">float64FromBits</span><span class="op" id="4854911">(</span><span class="ident" id="4854912">state</span><span class="op" id="4854917">.</span><span class="ident" id="4854918">decodeUint</span><span class="op" id="4854928">(</span><span class="op" id="4854929">)</span><span class="op" id="4854930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854933">value</span><span class="op" id="4854938">.</span><span class="ident" id="4854939">SetComplex</span><span class="op" id="4854949">(</span><span class="builtinfunc" id="4854950">complex</span><span class="op" id="4854957">(</span><span class="builtinfunc" id="4854958">real</span><span class="op" id="4854962">,</span>&nbsp;<span class="builtinfunc" id="4854964">imag</span><span class="op" id="4854968">)</span><span class="op" id="4854969">)</span><br>
<span class="lineno">360</span><span class="op" id="4854971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4854974">//&nbsp;decUint8Slice&nbsp;decodes&nbsp;a&nbsp;byte&nbsp;slice&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;slice&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="4855047">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4855071">//&nbsp;uint8&nbsp;slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">365</span><span class="keyword" id="4855147">func</span>&nbsp;<span class="ident" id="4855152">decUint8Slice</span><span class="op" id="4855165">(</span><span class="ident" id="4855166">i</span>&nbsp;<span class="op" id="4855168">*</span><span class="ident" id="4855169">decInstr</span><span class="op" id="4855177">,</span>&nbsp;<span class="ident" id="4855179">state</span>&nbsp;<span class="op" id="4855185">*</span><span class="ident" id="4855186">decoderState</span><span class="op" id="4855198">,</span>&nbsp;<span class="ident" id="4855200">value</span>&nbsp;<span class="ident" id="4855206">reflect</span><span class="op" id="4855213">.</span><span class="ident" id="4855214">Value</span><span class="op" id="4855219">)</span>&nbsp;<span class="op" id="4855221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855224">u</span>&nbsp;<span class="op" id="4855226">:=</span>&nbsp;<span class="ident" id="4855229">state</span><span class="op" id="4855234">.</span><span class="ident" id="4855235">decodeUint</span><span class="op" id="4855245">(</span><span class="op" id="4855246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855249">n</span>&nbsp;<span class="op" id="4855251">:=</span>&nbsp;<span class="builtintype" id="4855254">int</span><span class="op" id="4855257">(</span><span class="ident" id="4855258">u</span><span class="op" id="4855259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855262">if</span>&nbsp;<span class="ident" id="4855265">n</span>&nbsp;<span class="op" id="4855267">&lt;</span>&nbsp;<span class="num" id="4855269">0</span>&nbsp;<span class="op" id="4855271">||</span>&nbsp;<span class="ident" id="4855274">uint64</span><span class="op" id="4855280">(</span><span class="ident" id="4855281">n</span><span class="op" id="4855282">)</span>&nbsp;<span class="op" id="4855284">!=</span>&nbsp;<span class="ident" id="4855287">u</span>&nbsp;<span class="op" id="4855289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855293">errorf</span><span class="op" id="4855299">(</span><span class="string" id="4855300">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="4855344">,</span>&nbsp;<span class="ident" id="4855346">value</span><span class="op" id="4855351">.</span><span class="ident" id="4855352">Type</span><span class="op" id="4855356">(</span><span class="op" id="4855357">)</span><span class="op" id="4855358">,</span>&nbsp;<span class="ident" id="4855360">u</span><span class="op" id="4855361">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855367">if</span>&nbsp;<span class="ident" id="4855370">n</span>&nbsp;<span class="op" id="4855372">&gt;</span>&nbsp;<span class="ident" id="4855374">state</span><span class="op" id="4855379">.</span><span class="ident" id="4855380">b</span><span class="op" id="4855381">.</span><span class="ident" id="4855382">Len</span><span class="op" id="4855385">(</span><span class="op" id="4855386">)</span>&nbsp;<span class="op" id="4855388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855392">errorf</span><span class="op" id="4855398">(</span><span class="string" id="4855399">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="4855432">,</span>&nbsp;<span class="ident" id="4855434">value</span><span class="op" id="4855439">.</span><span class="ident" id="4855440">Type</span><span class="op" id="4855444">(</span><span class="op" id="4855445">)</span><span class="op" id="4855446">,</span>&nbsp;<span class="ident" id="4855448">n</span><span class="op" id="4855449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855455">if</span>&nbsp;<span class="ident" id="4855458">n</span>&nbsp;<span class="op" id="4855460">&gt;</span>&nbsp;<span class="ident" id="4855462">tooBig</span>&nbsp;<span class="op" id="4855469">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855473">errorf</span><span class="op" id="4855479">(</span><span class="string" id="4855480">&#34;byte&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&#34;</span><span class="op" id="4855504">,</span>&nbsp;<span class="ident" id="4855506">n</span><span class="op" id="4855507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855513">if</span>&nbsp;<span class="ident" id="4855516">value</span><span class="op" id="4855521">.</span><span class="ident" id="4855522">Cap</span><span class="op" id="4855525">(</span><span class="op" id="4855526">)</span>&nbsp;<span class="op" id="4855528">&lt;</span>&nbsp;<span class="ident" id="4855530">n</span>&nbsp;<span class="op" id="4855532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855536">value</span><span class="op" id="4855541">.</span><span class="ident" id="4855542">Set</span><span class="op" id="4855545">(</span><span class="ident" id="4855546">reflect</span><span class="op" id="4855553">.</span><span class="ident" id="4855554">MakeSlice</span><span class="op" id="4855563">(</span><span class="ident" id="4855564">value</span><span class="op" id="4855569">.</span><span class="ident" id="4855570">Type</span><span class="op" id="4855574">(</span><span class="op" id="4855575">)</span><span class="op" id="4855576">,</span>&nbsp;<span class="ident" id="4855578">n</span><span class="op" id="4855579">,</span>&nbsp;<span class="ident" id="4855581">n</span><span class="op" id="4855582">)</span><span class="op" id="4855583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855586">}</span>&nbsp;<span class="keyword" id="4855588">else</span>&nbsp;<span class="op" id="4855593">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855597">value</span><span class="op" id="4855602">.</span><span class="ident" id="4855603">Set</span><span class="op" id="4855606">(</span><span class="ident" id="4855607">value</span><span class="op" id="4855612">.</span><span class="ident" id="4855613">Slice</span><span class="op" id="4855618">(</span><span class="num" id="4855619">0</span><span class="op" id="4855620">,</span>&nbsp;<span class="ident" id="4855622">n</span><span class="op" id="4855623">)</span><span class="op" id="4855624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855630">if</span>&nbsp;<span class="ident" id="4855633">_</span><span class="op" id="4855634">,</span>&nbsp;<span class="ident" id="4855636">err</span>&nbsp;<span class="op" id="4855640">:=</span>&nbsp;<span class="ident" id="4855643">state</span><span class="op" id="4855648">.</span><span class="ident" id="4855649">b</span><span class="op" id="4855650">.</span><span class="ident" id="4855651">Read</span><span class="op" id="4855655">(</span><span class="ident" id="4855656">value</span><span class="op" id="4855661">.</span><span class="ident" id="4855662">Bytes</span><span class="op" id="4855667">(</span><span class="op" id="4855668">)</span><span class="op" id="4855669">)</span><span class="op" id="4855670">;</span>&nbsp;<span class="ident" id="4855672">err</span>&nbsp;<span class="op" id="4855676">!=</span>&nbsp;<span class="ident" id="4855679">nil</span>&nbsp;<span class="op" id="4855683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855687">errorf</span><span class="op" id="4855693">(</span><span class="string" id="4855694">&#34;error&nbsp;decoding&nbsp;[]byte:&nbsp;%s&#34;</span><span class="op" id="4855721">,</span>&nbsp;<span class="ident" id="4855723">err</span><span class="op" id="4855726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855729">}</span><br>
<span class="lineno">385</span><span class="op" id="4855731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4855734">//&nbsp;decString&nbsp;decodes&nbsp;byte&nbsp;array&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;string&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="4855802">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4855826">//&nbsp;Strings&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">390</span><span class="keyword" id="4855897">func</span>&nbsp;<span class="ident" id="4855902">decString</span><span class="op" id="4855911">(</span><span class="ident" id="4855912">i</span>&nbsp;<span class="op" id="4855914">*</span><span class="ident" id="4855915">decInstr</span><span class="op" id="4855923">,</span>&nbsp;<span class="ident" id="4855925">state</span>&nbsp;<span class="op" id="4855931">*</span><span class="ident" id="4855932">decoderState</span><span class="op" id="4855944">,</span>&nbsp;<span class="ident" id="4855946">value</span>&nbsp;<span class="ident" id="4855952">reflect</span><span class="op" id="4855959">.</span><span class="ident" id="4855960">Value</span><span class="op" id="4855965">)</span>&nbsp;<span class="op" id="4855967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855970">u</span>&nbsp;<span class="op" id="4855972">:=</span>&nbsp;<span class="ident" id="4855975">state</span><span class="op" id="4855980">.</span><span class="ident" id="4855981">decodeUint</span><span class="op" id="4855991">(</span><span class="op" id="4855992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855995">n</span>&nbsp;<span class="op" id="4855997">:=</span>&nbsp;<span class="builtintype" id="4856000">int</span><span class="op" id="4856003">(</span><span class="ident" id="4856004">u</span><span class="op" id="4856005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856008">if</span>&nbsp;<span class="ident" id="4856011">n</span>&nbsp;<span class="op" id="4856013">&lt;</span>&nbsp;<span class="num" id="4856015">0</span>&nbsp;<span class="op" id="4856017">||</span>&nbsp;<span class="ident" id="4856020">uint64</span><span class="op" id="4856026">(</span><span class="ident" id="4856027">n</span><span class="op" id="4856028">)</span>&nbsp;<span class="op" id="4856030">!=</span>&nbsp;<span class="ident" id="4856033">u</span>&nbsp;<span class="op" id="4856035">||</span>&nbsp;<span class="ident" id="4856038">n</span>&nbsp;<span class="op" id="4856040">&gt;</span>&nbsp;<span class="ident" id="4856042">state</span><span class="op" id="4856047">.</span><span class="ident" id="4856048">b</span><span class="op" id="4856049">.</span><span class="ident" id="4856050">Len</span><span class="op" id="4856053">(</span><span class="op" id="4856054">)</span>&nbsp;<span class="op" id="4856056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856060">errorf</span><span class="op" id="4856066">(</span><span class="string" id="4856067">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="4856111">,</span>&nbsp;<span class="ident" id="4856113">value</span><span class="op" id="4856118">.</span><span class="ident" id="4856119">Type</span><span class="op" id="4856123">(</span><span class="op" id="4856124">)</span><span class="op" id="4856125">,</span>&nbsp;<span class="ident" id="4856127">u</span><span class="op" id="4856128">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856134">if</span>&nbsp;<span class="ident" id="4856137">n</span>&nbsp;<span class="op" id="4856139">&gt;</span>&nbsp;<span class="ident" id="4856141">state</span><span class="op" id="4856146">.</span><span class="ident" id="4856147">b</span><span class="op" id="4856148">.</span><span class="ident" id="4856149">Len</span><span class="op" id="4856152">(</span><span class="op" id="4856153">)</span>&nbsp;<span class="op" id="4856155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856159">errorf</span><span class="op" id="4856165">(</span><span class="string" id="4856166">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="4856199">,</span>&nbsp;<span class="ident" id="4856201">value</span><span class="op" id="4856206">.</span><span class="ident" id="4856207">Type</span><span class="op" id="4856211">(</span><span class="op" id="4856212">)</span><span class="op" id="4856213">,</span>&nbsp;<span class="ident" id="4856215">n</span><span class="op" id="4856216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4856222">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856241">data</span>&nbsp;<span class="op" id="4856246">:=</span>&nbsp;<span class="builtinfunc" id="4856249">make</span><span class="op" id="4856253">(</span><span class="op" id="4856254">[</span><span class="op" id="4856255">]</span><span class="builtintype" id="4856256">byte</span><span class="op" id="4856260">,</span>&nbsp;<span class="ident" id="4856262">n</span><span class="op" id="4856263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856266">if</span>&nbsp;<span class="ident" id="4856269">_</span><span class="op" id="4856270">,</span>&nbsp;<span class="ident" id="4856272">err</span>&nbsp;<span class="op" id="4856276">:=</span>&nbsp;<span class="ident" id="4856279">state</span><span class="op" id="4856284">.</span><span class="ident" id="4856285">b</span><span class="op" id="4856286">.</span><span class="ident" id="4856287">Read</span><span class="op" id="4856291">(</span><span class="ident" id="4856292">data</span><span class="op" id="4856296">)</span><span class="op" id="4856297">;</span>&nbsp;<span class="ident" id="4856299">err</span>&nbsp;<span class="op" id="4856303">!=</span>&nbsp;<span class="ident" id="4856306">nil</span>&nbsp;<span class="op" id="4856310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856314">errorf</span><span class="op" id="4856320">(</span><span class="string" id="4856321">&#34;error&nbsp;decoding&nbsp;string:&nbsp;%s&#34;</span><span class="op" id="4856348">,</span>&nbsp;<span class="ident" id="4856350">err</span><span class="op" id="4856353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856359">value</span><span class="op" id="4856364">.</span><span class="ident" id="4856365">SetString</span><span class="op" id="4856374">(</span><span class="builtintype" id="4856375">string</span><span class="op" id="4856381">(</span><span class="ident" id="4856382">data</span><span class="op" id="4856386">)</span><span class="op" id="4856387">)</span><br>
<span class="lineno">405</span><span class="op" id="4856389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4856392">//&nbsp;ignoreUint8Array&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;byte&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4856476">func</span>&nbsp;<span class="ident" id="4856481">ignoreUint8Array</span><span class="op" id="4856497">(</span><span class="ident" id="4856498">i</span>&nbsp;<span class="op" id="4856500">*</span><span class="ident" id="4856501">decInstr</span><span class="op" id="4856509">,</span>&nbsp;<span class="ident" id="4856511">state</span>&nbsp;<span class="op" id="4856517">*</span><span class="ident" id="4856518">decoderState</span><span class="op" id="4856530">,</span>&nbsp;<span class="ident" id="4856532">value</span>&nbsp;<span class="ident" id="4856538">reflect</span><span class="op" id="4856545">.</span><span class="ident" id="4856546">Value</span><span class="op" id="4856551">)</span>&nbsp;<span class="op" id="4856553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856556">b</span>&nbsp;<span class="op" id="4856558">:=</span>&nbsp;<span class="builtinfunc" id="4856561">make</span><span class="op" id="4856565">(</span><span class="op" id="4856566">[</span><span class="op" id="4856567">]</span><span class="builtintype" id="4856568">byte</span><span class="op" id="4856572">,</span>&nbsp;<span class="ident" id="4856574">state</span><span class="op" id="4856579">.</span><span class="ident" id="4856580">decodeUint</span><span class="op" id="4856590">(</span><span class="op" id="4856591">)</span><span class="op" id="4856592">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856595">state</span><span class="op" id="4856600">.</span><span class="ident" id="4856601">b</span><span class="op" id="4856602">.</span><span class="ident" id="4856603">Read</span><span class="op" id="4856607">(</span><span class="ident" id="4856608">b</span><span class="op" id="4856609">)</span><br>
<span class="lineno"></span><span class="op" id="4856611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4856614">//&nbsp;Execution&nbsp;engine</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="4856635">//&nbsp;The&nbsp;encoder&nbsp;engine&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;instructions&nbsp;indexed&nbsp;by&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="4856725">//&nbsp;decoder.&nbsp;&nbsp;It&nbsp;is&nbsp;executed&nbsp;with&nbsp;random&nbsp;access&nbsp;according&nbsp;to&nbsp;field&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword" id="4856799">type</span>&nbsp;<span class="ident" id="4856804">decEngine</span>&nbsp;<span class="keyword" id="4856814">struct</span>&nbsp;<span class="op" id="4856821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856824">instr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4856833">[</span><span class="op" id="4856834">]</span><span class="ident" id="4856835">decInstr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856845">numInstr</span>&nbsp;<span class="builtintype" id="4856854">int</span>&nbsp;<span class="comment" id="4856858">//&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;instructions</span><br>
<span class="lineno">420</span><span class="op" id="4856895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4856898">//&nbsp;decodeSingle&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;value&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4856985">//&nbsp;Such&nbsp;values&nbsp;are&nbsp;preceded&nbsp;by&nbsp;a&nbsp;zero,&nbsp;making&nbsp;them&nbsp;have&nbsp;the&nbsp;memory&nbsp;layout&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4857064">//&nbsp;struct&nbsp;field&nbsp;(although&nbsp;with&nbsp;an&nbsp;illegal&nbsp;field&nbsp;number).</span><br>
<span class="lineno">425</span><span class="keyword" id="4857121">func</span>&nbsp;<span class="op" id="4857126">(</span><span class="ident" id="4857127">dec</span>&nbsp;<span class="op" id="4857131">*</span><span class="ident" id="4857132">Decoder</span><span class="op" id="4857139">)</span>&nbsp;<span class="ident" id="4857141">decodeSingle</span><span class="op" id="4857153">(</span><span class="ident" id="4857154">engine</span>&nbsp;<span class="op" id="4857161">*</span><span class="ident" id="4857162">decEngine</span><span class="op" id="4857171">,</span>&nbsp;<span class="ident" id="4857173">ut</span>&nbsp;<span class="op" id="4857176">*</span><span class="ident" id="4857177">userTypeInfo</span><span class="op" id="4857189">,</span>&nbsp;<span class="ident" id="4857191">value</span>&nbsp;<span class="ident" id="4857197">reflect</span><span class="op" id="4857204">.</span><span class="ident" id="4857205">Value</span><span class="op" id="4857210">)</span>&nbsp;<span class="op" id="4857212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857215">state</span>&nbsp;<span class="op" id="4857221">:=</span>&nbsp;<span class="ident" id="4857224">dec</span><span class="op" id="4857227">.</span><span class="ident" id="4857228">newDecoderState</span><span class="op" id="4857243">(</span><span class="op" id="4857244">&amp;</span><span class="ident" id="4857245">dec</span><span class="op" id="4857248">.</span><span class="ident" id="4857249">buf</span><span class="op" id="4857252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857255">defer</span>&nbsp;<span class="ident" id="4857261">dec</span><span class="op" id="4857264">.</span><span class="ident" id="4857265">freeDecoderState</span><span class="op" id="4857281">(</span><span class="ident" id="4857282">state</span><span class="op" id="4857287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857290">state</span><span class="op" id="4857295">.</span><span class="ident" id="4857296">fieldnum</span>&nbsp;<span class="op" id="4857305">=</span>&nbsp;<span class="ident" id="4857307">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857323">if</span>&nbsp;<span class="ident" id="4857326">state</span><span class="op" id="4857331">.</span><span class="ident" id="4857332">decodeUint</span><span class="op" id="4857342">(</span><span class="op" id="4857343">)</span>&nbsp;<span class="op" id="4857345">!=</span>&nbsp;<span class="num" id="4857348">0</span>&nbsp;<span class="op" id="4857350">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857354">errorf</span><span class="op" id="4857360">(</span><span class="string" id="4857361">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="4857415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857421">instr</span>&nbsp;<span class="op" id="4857427">:=</span>&nbsp;<span class="op" id="4857430">&amp;</span><span class="ident" id="4857431">engine</span><span class="op" id="4857437">.</span><span class="ident" id="4857438">instr</span><span class="op" id="4857443">[</span><span class="ident" id="4857444">singletonField</span><span class="op" id="4857458">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857461">instr</span><span class="op" id="4857466">.</span><span class="ident" id="4857467">op</span><span class="op" id="4857469">(</span><span class="ident" id="4857470">instr</span><span class="op" id="4857475">,</span>&nbsp;<span class="ident" id="4857477">state</span><span class="op" id="4857482">,</span>&nbsp;<span class="ident" id="4857484">value</span><span class="op" id="4857489">)</span><br>
<span class="lineno"></span><span class="op" id="4857491">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="4857494">//&nbsp;decodeStruct&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4857561">//&nbsp;Indir&nbsp;is&nbsp;for&nbsp;the&nbsp;value,&nbsp;not&nbsp;the&nbsp;type.&nbsp;&nbsp;At&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call&nbsp;it&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="4857634">//&nbsp;differ&nbsp;from&nbsp;ut.indir,&nbsp;which&nbsp;was&nbsp;computed&nbsp;when&nbsp;the&nbsp;engine&nbsp;was&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="4857705">//&nbsp;This&nbsp;state&nbsp;cannot&nbsp;arise&nbsp;for&nbsp;decodeSingle,&nbsp;which&nbsp;is&nbsp;called&nbsp;directly</span><br>
<span class="lineno">440</span><span class="comment" id="4857775">//&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;value,&nbsp;not&nbsp;from&nbsp;the&nbsp;innards&nbsp;of&nbsp;an&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="4857836">func</span>&nbsp;<span class="op" id="4857841">(</span><span class="ident" id="4857842">dec</span>&nbsp;<span class="op" id="4857846">*</span><span class="ident" id="4857847">Decoder</span><span class="op" id="4857854">)</span>&nbsp;<span class="ident" id="4857856">decodeStruct</span><span class="op" id="4857868">(</span><span class="ident" id="4857869">engine</span>&nbsp;<span class="op" id="4857876">*</span><span class="ident" id="4857877">decEngine</span><span class="op" id="4857886">,</span>&nbsp;<span class="ident" id="4857888">ut</span>&nbsp;<span class="op" id="4857891">*</span><span class="ident" id="4857892">userTypeInfo</span><span class="op" id="4857904">,</span>&nbsp;<span class="ident" id="4857906">value</span>&nbsp;<span class="ident" id="4857912">reflect</span><span class="op" id="4857919">.</span><span class="ident" id="4857920">Value</span><span class="op" id="4857925">)</span>&nbsp;<span class="op" id="4857927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857930">state</span>&nbsp;<span class="op" id="4857936">:=</span>&nbsp;<span class="ident" id="4857939">dec</span><span class="op" id="4857942">.</span><span class="ident" id="4857943">newDecoderState</span><span class="op" id="4857958">(</span><span class="op" id="4857959">&amp;</span><span class="ident" id="4857960">dec</span><span class="op" id="4857963">.</span><span class="ident" id="4857964">buf</span><span class="op" id="4857967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857970">defer</span>&nbsp;<span class="ident" id="4857976">dec</span><span class="op" id="4857979">.</span><span class="ident" id="4857980">freeDecoderState</span><span class="op" id="4857996">(</span><span class="ident" id="4857997">state</span><span class="op" id="4858002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858005">state</span><span class="op" id="4858010">.</span><span class="ident" id="4858011">fieldnum</span>&nbsp;<span class="op" id="4858020">=</span>&nbsp;<span class="op" id="4858022">-</span><span class="num" id="4858023">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858026">for</span>&nbsp;<span class="ident" id="4858030">state</span><span class="op" id="4858035">.</span><span class="ident" id="4858036">b</span><span class="op" id="4858037">.</span><span class="ident" id="4858038">Len</span><span class="op" id="4858041">(</span><span class="op" id="4858042">)</span>&nbsp;<span class="op" id="4858044">&gt;</span>&nbsp;<span class="num" id="4858046">0</span>&nbsp;<span class="op" id="4858048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858052">delta</span>&nbsp;<span class="op" id="4858058">:=</span>&nbsp;<span class="builtintype" id="4858061">int</span><span class="op" id="4858064">(</span><span class="ident" id="4858065">state</span><span class="op" id="4858070">.</span><span class="ident" id="4858071">decodeUint</span><span class="op" id="4858081">(</span><span class="op" id="4858082">)</span><span class="op" id="4858083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858087">if</span>&nbsp;<span class="ident" id="4858090">delta</span>&nbsp;<span class="op" id="4858096">&lt;</span>&nbsp;<span class="num" id="4858098">0</span>&nbsp;<span class="op" id="4858100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858105">errorf</span><span class="op" id="4858111">(</span><span class="string" id="4858112">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="4858152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858156">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858160">if</span>&nbsp;<span class="ident" id="4858163">delta</span>&nbsp;<span class="op" id="4858169">==</span>&nbsp;<span class="num" id="4858172">0</span>&nbsp;<span class="op" id="4858174">{</span>&nbsp;<span class="comment" id="4858176">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858223">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858235">fieldnum</span>&nbsp;<span class="op" id="4858244">:=</span>&nbsp;<span class="ident" id="4858247">state</span><span class="op" id="4858252">.</span><span class="ident" id="4858253">fieldnum</span>&nbsp;<span class="op" id="4858262">+</span>&nbsp;<span class="ident" id="4858264">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858272">if</span>&nbsp;<span class="ident" id="4858275">fieldnum</span>&nbsp;<span class="op" id="4858284">&gt;=</span>&nbsp;<span class="builtinfunc" id="4858287">len</span><span class="op" id="4858290">(</span><span class="ident" id="4858291">engine</span><span class="op" id="4858297">.</span><span class="ident" id="4858298">instr</span><span class="op" id="4858303">)</span>&nbsp;<span class="op" id="4858305">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858310">error_</span><span class="op" id="4858316">(</span><span class="ident" id="4858317">errRange</span><span class="op" id="4858325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858330">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858342">instr</span>&nbsp;<span class="op" id="4858348">:=</span>&nbsp;<span class="op" id="4858351">&amp;</span><span class="ident" id="4858352">engine</span><span class="op" id="4858358">.</span><span class="ident" id="4858359">instr</span><span class="op" id="4858364">[</span><span class="ident" id="4858365">fieldnum</span><span class="op" id="4858373">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858377">var</span>&nbsp;<span class="ident" id="4858381">field</span>&nbsp;<span class="ident" id="4858387">reflect</span><span class="op" id="4858394">.</span><span class="ident" id="4858395">Value</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858403">if</span>&nbsp;<span class="ident" id="4858406">instr</span><span class="op" id="4858411">.</span><span class="ident" id="4858412">index</span>&nbsp;<span class="op" id="4858418">!=</span>&nbsp;<span class="ident" id="4858421">nil</span>&nbsp;<span class="op" id="4858425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4858430">//&nbsp;Otherwise&nbsp;the&nbsp;field&nbsp;is&nbsp;unknown&nbsp;to&nbsp;us&nbsp;and&nbsp;instr.op&nbsp;is&nbsp;an&nbsp;ignore&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858503">field</span>&nbsp;<span class="op" id="4858509">=</span>&nbsp;<span class="ident" id="4858511">value</span><span class="op" id="4858516">.</span><span class="ident" id="4858517">FieldByIndex</span><span class="op" id="4858529">(</span><span class="ident" id="4858530">instr</span><span class="op" id="4858535">.</span><span class="ident" id="4858536">index</span><span class="op" id="4858541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858546">if</span>&nbsp;<span class="ident" id="4858549">field</span><span class="op" id="4858554">.</span><span class="ident" id="4858555">Kind</span><span class="op" id="4858559">(</span><span class="op" id="4858560">)</span>&nbsp;<span class="op" id="4858562">==</span>&nbsp;<span class="ident" id="4858565">reflect</span><span class="op" id="4858572">.</span><span class="ident" id="4858573">Ptr</span>&nbsp;<span class="op" id="4858577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858583">field</span>&nbsp;<span class="op" id="4858589">=</span>&nbsp;<span class="ident" id="4858591">decAlloc</span><span class="op" id="4858599">(</span><span class="ident" id="4858600">field</span><span class="op" id="4858605">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858618">instr</span><span class="op" id="4858623">.</span><span class="ident" id="4858624">op</span><span class="op" id="4858626">(</span><span class="ident" id="4858627">instr</span><span class="op" id="4858632">,</span>&nbsp;<span class="ident" id="4858634">state</span><span class="op" id="4858639">,</span>&nbsp;<span class="ident" id="4858641">field</span><span class="op" id="4858646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858650">state</span><span class="op" id="4858655">.</span><span class="ident" id="4858656">fieldnum</span>&nbsp;<span class="op" id="4858665">=</span>&nbsp;<span class="ident" id="4858667">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858677">}</span><br>
<span class="lineno">470</span><span class="op" id="4858679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4858682">var</span>&nbsp;<span class="ident" id="4858686">noValue</span>&nbsp;<span class="ident" id="4858694">reflect</span><span class="op" id="4858701">.</span><span class="ident" id="4858702">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4858709">//&nbsp;ignoreStruct&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;struct&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">475</span><span class="keyword" id="4858777">func</span>&nbsp;<span class="op" id="4858782">(</span><span class="ident" id="4858783">dec</span>&nbsp;<span class="op" id="4858787">*</span><span class="ident" id="4858788">Decoder</span><span class="op" id="4858795">)</span>&nbsp;<span class="ident" id="4858797">ignoreStruct</span><span class="op" id="4858809">(</span><span class="ident" id="4858810">engine</span>&nbsp;<span class="op" id="4858817">*</span><span class="ident" id="4858818">decEngine</span><span class="op" id="4858827">)</span>&nbsp;<span class="op" id="4858829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858832">state</span>&nbsp;<span class="op" id="4858838">:=</span>&nbsp;<span class="ident" id="4858841">dec</span><span class="op" id="4858844">.</span><span class="ident" id="4858845">newDecoderState</span><span class="op" id="4858860">(</span><span class="op" id="4858861">&amp;</span><span class="ident" id="4858862">dec</span><span class="op" id="4858865">.</span><span class="ident" id="4858866">buf</span><span class="op" id="4858869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858872">defer</span>&nbsp;<span class="ident" id="4858878">dec</span><span class="op" id="4858881">.</span><span class="ident" id="4858882">freeDecoderState</span><span class="op" id="4858898">(</span><span class="ident" id="4858899">state</span><span class="op" id="4858904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858907">state</span><span class="op" id="4858912">.</span><span class="ident" id="4858913">fieldnum</span>&nbsp;<span class="op" id="4858922">=</span>&nbsp;<span class="op" id="4858924">-</span><span class="num" id="4858925">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858928">for</span>&nbsp;<span class="ident" id="4858932">state</span><span class="op" id="4858937">.</span><span class="ident" id="4858938">b</span><span class="op" id="4858939">.</span><span class="ident" id="4858940">Len</span><span class="op" id="4858943">(</span><span class="op" id="4858944">)</span>&nbsp;<span class="op" id="4858946">&gt;</span>&nbsp;<span class="num" id="4858948">0</span>&nbsp;<span class="op" id="4858950">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858954">delta</span>&nbsp;<span class="op" id="4858960">:=</span>&nbsp;<span class="builtintype" id="4858963">int</span><span class="op" id="4858966">(</span><span class="ident" id="4858967">state</span><span class="op" id="4858972">.</span><span class="ident" id="4858973">decodeUint</span><span class="op" id="4858983">(</span><span class="op" id="4858984">)</span><span class="op" id="4858985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858989">if</span>&nbsp;<span class="ident" id="4858992">delta</span>&nbsp;<span class="op" id="4858998">&lt;</span>&nbsp;<span class="num" id="4859000">0</span>&nbsp;<span class="op" id="4859002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859007">errorf</span><span class="op" id="4859013">(</span><span class="string" id="4859014">&#34;ignore&nbsp;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="4859061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859069">if</span>&nbsp;<span class="ident" id="4859072">delta</span>&nbsp;<span class="op" id="4859078">==</span>&nbsp;<span class="num" id="4859081">0</span>&nbsp;<span class="op" id="4859083">{</span>&nbsp;<span class="comment" id="4859085">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859132">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859144">fieldnum</span>&nbsp;<span class="op" id="4859153">:=</span>&nbsp;<span class="ident" id="4859156">state</span><span class="op" id="4859161">.</span><span class="ident" id="4859162">fieldnum</span>&nbsp;<span class="op" id="4859171">+</span>&nbsp;<span class="ident" id="4859173">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859181">if</span>&nbsp;<span class="ident" id="4859184">fieldnum</span>&nbsp;<span class="op" id="4859193">&gt;=</span>&nbsp;<span class="builtinfunc" id="4859196">len</span><span class="op" id="4859199">(</span><span class="ident" id="4859200">engine</span><span class="op" id="4859206">.</span><span class="ident" id="4859207">instr</span><span class="op" id="4859212">)</span>&nbsp;<span class="op" id="4859214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859219">error_</span><span class="op" id="4859225">(</span><span class="ident" id="4859226">errRange</span><span class="op" id="4859234">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859242">instr</span>&nbsp;<span class="op" id="4859248">:=</span>&nbsp;<span class="op" id="4859251">&amp;</span><span class="ident" id="4859252">engine</span><span class="op" id="4859258">.</span><span class="ident" id="4859259">instr</span><span class="op" id="4859264">[</span><span class="ident" id="4859265">fieldnum</span><span class="op" id="4859273">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859277">instr</span><span class="op" id="4859282">.</span><span class="ident" id="4859283">op</span><span class="op" id="4859285">(</span><span class="ident" id="4859286">instr</span><span class="op" id="4859291">,</span>&nbsp;<span class="ident" id="4859293">state</span><span class="op" id="4859298">,</span>&nbsp;<span class="ident" id="4859300">noValue</span><span class="op" id="4859307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859311">state</span><span class="op" id="4859316">.</span><span class="ident" id="4859317">fieldnum</span>&nbsp;<span class="op" id="4859326">=</span>&nbsp;<span class="ident" id="4859328">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859338">}</span><br>
<span class="lineno">495</span><span class="op" id="4859340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4859343">//&nbsp;ignoreSingle&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;top-level&nbsp;non-struct&nbsp;value&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="4859418">//&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;when&nbsp;calling&nbsp;Decode&nbsp;with&nbsp;a&nbsp;nil&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4859482">func</span>&nbsp;<span class="op" id="4859487">(</span><span class="ident" id="4859488">dec</span>&nbsp;<span class="op" id="4859492">*</span><span class="ident" id="4859493">Decoder</span><span class="op" id="4859500">)</span>&nbsp;<span class="ident" id="4859502">ignoreSingle</span><span class="op" id="4859514">(</span><span class="ident" id="4859515">engine</span>&nbsp;<span class="op" id="4859522">*</span><span class="ident" id="4859523">decEngine</span><span class="op" id="4859532">)</span>&nbsp;<span class="op" id="4859534">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859537">state</span>&nbsp;<span class="op" id="4859543">:=</span>&nbsp;<span class="ident" id="4859546">dec</span><span class="op" id="4859549">.</span><span class="ident" id="4859550">newDecoderState</span><span class="op" id="4859565">(</span><span class="op" id="4859566">&amp;</span><span class="ident" id="4859567">dec</span><span class="op" id="4859570">.</span><span class="ident" id="4859571">buf</span><span class="op" id="4859574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859577">defer</span>&nbsp;<span class="ident" id="4859583">dec</span><span class="op" id="4859586">.</span><span class="ident" id="4859587">freeDecoderState</span><span class="op" id="4859603">(</span><span class="ident" id="4859604">state</span><span class="op" id="4859609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859612">state</span><span class="op" id="4859617">.</span><span class="ident" id="4859618">fieldnum</span>&nbsp;<span class="op" id="4859627">=</span>&nbsp;<span class="ident" id="4859629">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859645">delta</span>&nbsp;<span class="op" id="4859651">:=</span>&nbsp;<span class="builtintype" id="4859654">int</span><span class="op" id="4859657">(</span><span class="ident" id="4859658">state</span><span class="op" id="4859663">.</span><span class="ident" id="4859664">decodeUint</span><span class="op" id="4859674">(</span><span class="op" id="4859675">)</span><span class="op" id="4859676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859679">if</span>&nbsp;<span class="ident" id="4859682">delta</span>&nbsp;<span class="op" id="4859688">!=</span>&nbsp;<span class="num" id="4859691">0</span>&nbsp;<span class="op" id="4859693">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859697">errorf</span><span class="op" id="4859703">(</span><span class="string" id="4859704">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="4859758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859764">instr</span>&nbsp;<span class="op" id="4859770">:=</span>&nbsp;<span class="op" id="4859773">&amp;</span><span class="ident" id="4859774">engine</span><span class="op" id="4859780">.</span><span class="ident" id="4859781">instr</span><span class="op" id="4859786">[</span><span class="ident" id="4859787">singletonField</span><span class="op" id="4859801">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859804">instr</span><span class="op" id="4859809">.</span><span class="ident" id="4859810">op</span><span class="op" id="4859812">(</span><span class="ident" id="4859813">instr</span><span class="op" id="4859818">,</span>&nbsp;<span class="ident" id="4859820">state</span><span class="op" id="4859825">,</span>&nbsp;<span class="ident" id="4859827">noValue</span><span class="op" id="4859834">)</span><br>
<span class="lineno"></span><span class="op" id="4859836">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="4859839">//&nbsp;decodeArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;decoding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="4859906">func</span>&nbsp;<span class="op" id="4859911">(</span><span class="ident" id="4859912">dec</span>&nbsp;<span class="op" id="4859916">*</span><span class="ident" id="4859917">Decoder</span><span class="op" id="4859924">)</span>&nbsp;<span class="ident" id="4859926">decodeArrayHelper</span><span class="op" id="4859943">(</span><span class="ident" id="4859944">state</span>&nbsp;<span class="op" id="4859950">*</span><span class="ident" id="4859951">decoderState</span><span class="op" id="4859963">,</span>&nbsp;<span class="ident" id="4859965">value</span>&nbsp;<span class="ident" id="4859971">reflect</span><span class="op" id="4859978">.</span><span class="ident" id="4859979">Value</span><span class="op" id="4859984">,</span>&nbsp;<span class="ident" id="4859986">elemOp</span>&nbsp;<span class="ident" id="4859993">decOp</span><span class="op" id="4859998">,</span>&nbsp;<span class="ident" id="4860000">length</span>&nbsp;<span class="builtintype" id="4860007">int</span><span class="op" id="4860010">,</span>&nbsp;<span class="ident" id="4860012">ovfl</span>&nbsp;<span class="builtintype" id="4860017">error</span><span class="op" id="4860022">,</span>&nbsp;<span class="ident" id="4860024">helper</span>&nbsp;<span class="ident" id="4860031">decHelper</span><span class="op" id="4860040">)</span>&nbsp;<span class="op" id="4860042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860045">if</span>&nbsp;<span class="ident" id="4860048">helper</span>&nbsp;<span class="op" id="4860055">!=</span>&nbsp;<span class="ident" id="4860058">nil</span>&nbsp;<span class="op" id="4860062">&amp;&amp;</span>&nbsp;<span class="ident" id="4860065">helper</span><span class="op" id="4860071">(</span><span class="ident" id="4860072">state</span><span class="op" id="4860077">,</span>&nbsp;<span class="ident" id="4860079">value</span><span class="op" id="4860084">,</span>&nbsp;<span class="ident" id="4860086">length</span><span class="op" id="4860092">,</span>&nbsp;<span class="ident" id="4860094">ovfl</span><span class="op" id="4860098">)</span>&nbsp;<span class="op" id="4860100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860104">return</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4860112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860115">instr</span>&nbsp;<span class="op" id="4860121">:=</span>&nbsp;<span class="op" id="4860124">&amp;</span><span class="ident" id="4860125">decInstr</span><span class="op" id="4860133">{</span><span class="ident" id="4860134">elemOp</span><span class="op" id="4860140">,</span>&nbsp;<span class="num" id="4860142">0</span><span class="op" id="4860143">,</span>&nbsp;<span class="ident" id="4860145">nil</span><span class="op" id="4860148">,</span>&nbsp;<span class="ident" id="4860150">ovfl</span><span class="op" id="4860154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860157">isPtr</span>&nbsp;<span class="op" id="4860163">:=</span>&nbsp;<span class="ident" id="4860166">value</span><span class="op" id="4860171">.</span><span class="ident" id="4860172">Type</span><span class="op" id="4860176">(</span><span class="op" id="4860177">)</span><span class="op" id="4860178">.</span><span class="ident" id="4860179">Elem</span><span class="op" id="4860183">(</span><span class="op" id="4860184">)</span><span class="op" id="4860185">.</span><span class="ident" id="4860186">Kind</span><span class="op" id="4860190">(</span><span class="op" id="4860191">)</span>&nbsp;<span class="op" id="4860193">==</span>&nbsp;<span class="ident" id="4860196">reflect</span><span class="op" id="4860203">.</span><span class="ident" id="4860204">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860209">for</span>&nbsp;<span class="ident" id="4860213">i</span>&nbsp;<span class="op" id="4860215">:=</span>&nbsp;<span class="num" id="4860218">0</span><span class="op" id="4860219">;</span>&nbsp;<span class="ident" id="4860221">i</span>&nbsp;<span class="op" id="4860223">&lt;</span>&nbsp;<span class="ident" id="4860225">length</span><span class="op" id="4860231">;</span>&nbsp;<span class="ident" id="4860233">i</span><span class="op" id="4860234">++</span>&nbsp;<span class="op" id="4860237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860241">if</span>&nbsp;<span class="ident" id="4860244">state</span><span class="op" id="4860249">.</span><span class="ident" id="4860250">b</span><span class="op" id="4860251">.</span><span class="ident" id="4860252">Len</span><span class="op" id="4860255">(</span><span class="op" id="4860256">)</span>&nbsp;<span class="op" id="4860258">==</span>&nbsp;<span class="num" id="4860261">0</span>&nbsp;<span class="op" id="4860263">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860268">errorf</span><span class="op" id="4860274">(</span><span class="string" id="4860275">&#34;decoding&nbsp;array&nbsp;or&nbsp;slice:&nbsp;length&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;elements)&#34;</span><span class="op" id="4860341">,</span>&nbsp;<span class="ident" id="4860343">length</span><span class="op" id="4860349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4860353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860357">v</span>&nbsp;<span class="op" id="4860359">:=</span>&nbsp;<span class="ident" id="4860362">value</span><span class="op" id="4860367">.</span><span class="ident" id="4860368">Index</span><span class="op" id="4860373">(</span><span class="ident" id="4860374">i</span><span class="op" id="4860375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860379">if</span>&nbsp;<span class="ident" id="4860382">isPtr</span>&nbsp;<span class="op" id="4860388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860393">v</span>&nbsp;<span class="op" id="4860395">=</span>&nbsp;<span class="ident" id="4860397">decAlloc</span><span class="op" id="4860405">(</span><span class="ident" id="4860406">v</span><span class="op" id="4860407">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4860411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860415">elemOp</span><span class="op" id="4860421">(</span><span class="ident" id="4860422">instr</span><span class="op" id="4860427">,</span>&nbsp;<span class="ident" id="4860429">state</span><span class="op" id="4860434">,</span>&nbsp;<span class="ident" id="4860436">v</span><span class="op" id="4860437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4860440">}</span><br>
<span class="lineno"></span><span class="op" id="4860442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="4860445">//&nbsp;decodeArray&nbsp;decodes&nbsp;an&nbsp;array&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4860501">//&nbsp;The&nbsp;length&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;preceding&nbsp;the&nbsp;elements.&nbsp;&nbsp;Even&nbsp;though&nbsp;the&nbsp;length&nbsp;is&nbsp;redundant</span><br>
<span class="lineno"></span><span class="comment" id="4860599">//&nbsp;(it&#39;s&nbsp;part&nbsp;of&nbsp;the&nbsp;type),&nbsp;it&#39;s&nbsp;a&nbsp;useful&nbsp;check&nbsp;and&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4860680">func</span>&nbsp;<span class="op" id="4860685">(</span><span class="ident" id="4860686">dec</span>&nbsp;<span class="op" id="4860690">*</span><span class="ident" id="4860691">Decoder</span><span class="op" id="4860698">)</span>&nbsp;<span class="ident" id="4860700">decodeArray</span><span class="op" id="4860711">(</span><span class="ident" id="4860712">atyp</span>&nbsp;<span class="ident" id="4860717">reflect</span><span class="op" id="4860724">.</span><span class="ident" id="4860725">Type</span><span class="op" id="4860729">,</span>&nbsp;<span class="ident" id="4860731">state</span>&nbsp;<span class="op" id="4860737">*</span><span class="ident" id="4860738">decoderState</span><span class="op" id="4860750">,</span>&nbsp;<span class="ident" id="4860752">value</span>&nbsp;<span class="ident" id="4860758">reflect</span><span class="op" id="4860765">.</span><span class="ident" id="4860766">Value</span><span class="op" id="4860771">,</span>&nbsp;<span class="ident" id="4860773">elemOp</span>&nbsp;<span class="ident" id="4860780">decOp</span><span class="op" id="4860785">,</span>&nbsp;<span class="ident" id="4860787">length</span>&nbsp;<span class="builtintype" id="4860794">int</span><span class="op" id="4860797">,</span>&nbsp;<span class="ident" id="4860799">ovfl</span>&nbsp;<span class="builtintype" id="4860804">error</span><span class="op" id="4860809">,</span>&nbsp;<span class="ident" id="4860811">helper</span>&nbsp;<span class="ident" id="4860818">decHelper</span><span class="op" id="4860827">)</span>&nbsp;<span class="op" id="4860829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860832">if</span>&nbsp;<span class="ident" id="4860835">n</span>&nbsp;<span class="op" id="4860837">:=</span>&nbsp;<span class="ident" id="4860840">state</span><span class="op" id="4860845">.</span><span class="ident" id="4860846">decodeUint</span><span class="op" id="4860856">(</span><span class="op" id="4860857">)</span><span class="op" id="4860858">;</span>&nbsp;<span class="ident" id="4860860">n</span>&nbsp;<span class="op" id="4860862">!=</span>&nbsp;<span class="ident" id="4860865">uint64</span><span class="op" id="4860871">(</span><span class="ident" id="4860872">length</span><span class="op" id="4860878">)</span>&nbsp;<span class="op" id="4860880">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860884">errorf</span><span class="op" id="4860890">(</span><span class="string" id="4860891">&#34;length&nbsp;mismatch&nbsp;in&nbsp;decodeArray&#34;</span><span class="op" id="4860923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4860926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860929">dec</span><span class="op" id="4860932">.</span><span class="ident" id="4860933">decodeArrayHelper</span><span class="op" id="4860950">(</span><span class="ident" id="4860951">state</span><span class="op" id="4860956">,</span>&nbsp;<span class="ident" id="4860958">value</span><span class="op" id="4860963">,</span>&nbsp;<span class="ident" id="4860965">elemOp</span><span class="op" id="4860971">,</span>&nbsp;<span class="ident" id="4860973">length</span><span class="op" id="4860979">,</span>&nbsp;<span class="ident" id="4860981">ovfl</span><span class="op" id="4860985">,</span>&nbsp;<span class="ident" id="4860987">helper</span><span class="op" id="4860993">)</span><br>
<span class="lineno"></span><span class="op" id="4860995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="4860998">//&nbsp;decodeIntoValue&nbsp;is&nbsp;a&nbsp;helper&nbsp;for&nbsp;map&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4861047">func</span>&nbsp;<span class="ident" id="4861052">decodeIntoValue</span><span class="op" id="4861067">(</span><span class="ident" id="4861068">state</span>&nbsp;<span class="op" id="4861074">*</span><span class="ident" id="4861075">decoderState</span><span class="op" id="4861087">,</span>&nbsp;<span class="ident" id="4861089">op</span>&nbsp;<span class="ident" id="4861092">decOp</span><span class="op" id="4861097">,</span>&nbsp;<span class="ident" id="4861099">isPtr</span>&nbsp;<span class="builtintype" id="4861105">bool</span><span class="op" id="4861109">,</span>&nbsp;<span class="ident" id="4861111">value</span>&nbsp;<span class="ident" id="4861117">reflect</span><span class="op" id="4861124">.</span><span class="ident" id="4861125">Value</span><span class="op" id="4861130">,</span>&nbsp;<span class="ident" id="4861132">ovfl</span>&nbsp;<span class="builtintype" id="4861137">error</span><span class="op" id="4861142">)</span>&nbsp;<span class="ident" id="4861144">reflect</span><span class="op" id="4861151">.</span><span class="ident" id="4861152">Value</span>&nbsp;<span class="op" id="4861158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861161">instr</span>&nbsp;<span class="op" id="4861167">:=</span>&nbsp;<span class="op" id="4861170">&amp;</span><span class="ident" id="4861171">decInstr</span><span class="op" id="4861179">{</span><span class="ident" id="4861180">op</span><span class="op" id="4861182">,</span>&nbsp;<span class="num" id="4861184">0</span><span class="op" id="4861185">,</span>&nbsp;<span class="ident" id="4861187">nil</span><span class="op" id="4861190">,</span>&nbsp;<span class="ident" id="4861192">ovfl</span><span class="op" id="4861196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861199">v</span>&nbsp;<span class="op" id="4861201">:=</span>&nbsp;<span class="ident" id="4861204">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861211">if</span>&nbsp;<span class="ident" id="4861214">isPtr</span>&nbsp;<span class="op" id="4861220">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861224">v</span>&nbsp;<span class="op" id="4861226">=</span>&nbsp;<span class="ident" id="4861228">decAlloc</span><span class="op" id="4861236">(</span><span class="ident" id="4861237">value</span><span class="op" id="4861242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4861245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861248">op</span><span class="op" id="4861250">(</span><span class="ident" id="4861251">instr</span><span class="op" id="4861256">,</span>&nbsp;<span class="ident" id="4861258">state</span><span class="op" id="4861263">,</span>&nbsp;<span class="ident" id="4861265">v</span><span class="op" id="4861266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861269">return</span>&nbsp;<span class="ident" id="4861276">value</span><br>
<span class="lineno"></span><span class="op" id="4861282">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="4861285">//&nbsp;decodeMap&nbsp;decodes&nbsp;a&nbsp;map&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4861336">//&nbsp;Maps&nbsp;are&nbsp;encoded&nbsp;as&nbsp;a&nbsp;length&nbsp;followed&nbsp;by&nbsp;key:value&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="4861397">//&nbsp;Because&nbsp;the&nbsp;internals&nbsp;of&nbsp;maps&nbsp;are&nbsp;not&nbsp;visible&nbsp;to&nbsp;us,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4861461">//&nbsp;use&nbsp;reflection&nbsp;rather&nbsp;than&nbsp;pointer&nbsp;magic.</span><br>
<span class="lineno">555</span><span class="keyword" id="4861506">func</span>&nbsp;<span class="op" id="4861511">(</span><span class="ident" id="4861512">dec</span>&nbsp;<span class="op" id="4861516">*</span><span class="ident" id="4861517">Decoder</span><span class="op" id="4861524">)</span>&nbsp;<span class="ident" id="4861526">decodeMap</span><span class="op" id="4861535">(</span><span class="ident" id="4861536">mtyp</span>&nbsp;<span class="ident" id="4861541">reflect</span><span class="op" id="4861548">.</span><span class="ident" id="4861549">Type</span><span class="op" id="4861553">,</span>&nbsp;<span class="ident" id="4861555">state</span>&nbsp;<span class="op" id="4861561">*</span><span class="ident" id="4861562">decoderState</span><span class="op" id="4861574">,</span>&nbsp;<span class="ident" id="4861576">value</span>&nbsp;<span class="ident" id="4861582">reflect</span><span class="op" id="4861589">.</span><span class="ident" id="4861590">Value</span><span class="op" id="4861595">,</span>&nbsp;<span class="ident" id="4861597">keyOp</span><span class="op" id="4861602">,</span>&nbsp;<span class="ident" id="4861604">elemOp</span>&nbsp;<span class="ident" id="4861611">decOp</span><span class="op" id="4861616">,</span>&nbsp;<span class="ident" id="4861618">ovfl</span>&nbsp;<span class="builtintype" id="4861623">error</span><span class="op" id="4861628">)</span>&nbsp;<span class="op" id="4861630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861633">if</span>&nbsp;<span class="ident" id="4861636">value</span><span class="op" id="4861641">.</span><span class="ident" id="4861642">IsNil</span><span class="op" id="4861647">(</span><span class="op" id="4861648">)</span>&nbsp;<span class="op" id="4861650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4861654">//&nbsp;Allocate&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861673">value</span><span class="op" id="4861678">.</span><span class="ident" id="4861679">Set</span><span class="op" id="4861682">(</span><span class="ident" id="4861683">reflect</span><span class="op" id="4861690">.</span><span class="ident" id="4861691">MakeMap</span><span class="op" id="4861698">(</span><span class="ident" id="4861699">mtyp</span><span class="op" id="4861703">)</span><span class="op" id="4861704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4861707">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861710">n</span>&nbsp;<span class="op" id="4861712">:=</span>&nbsp;<span class="builtintype" id="4861715">int</span><span class="op" id="4861718">(</span><span class="ident" id="4861719">state</span><span class="op" id="4861724">.</span><span class="ident" id="4861725">decodeUint</span><span class="op" id="4861735">(</span><span class="op" id="4861736">)</span><span class="op" id="4861737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861740">keyIsPtr</span>&nbsp;<span class="op" id="4861749">:=</span>&nbsp;<span class="ident" id="4861752">mtyp</span><span class="op" id="4861756">.</span><span class="ident" id="4861757">Key</span><span class="op" id="4861760">(</span><span class="op" id="4861761">)</span><span class="op" id="4861762">.</span><span class="ident" id="4861763">Kind</span><span class="op" id="4861767">(</span><span class="op" id="4861768">)</span>&nbsp;<span class="op" id="4861770">==</span>&nbsp;<span class="ident" id="4861773">reflect</span><span class="op" id="4861780">.</span><span class="ident" id="4861781">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861786">elemIsPtr</span>&nbsp;<span class="op" id="4861796">:=</span>&nbsp;<span class="ident" id="4861799">mtyp</span><span class="op" id="4861803">.</span><span class="ident" id="4861804">Elem</span><span class="op" id="4861808">(</span><span class="op" id="4861809">)</span><span class="op" id="4861810">.</span><span class="ident" id="4861811">Kind</span><span class="op" id="4861815">(</span><span class="op" id="4861816">)</span>&nbsp;<span class="op" id="4861818">==</span>&nbsp;<span class="ident" id="4861821">reflect</span><span class="op" id="4861828">.</span><span class="ident" id="4861829">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861834">for</span>&nbsp;<span class="ident" id="4861838">i</span>&nbsp;<span class="op" id="4861840">:=</span>&nbsp;<span class="num" id="4861843">0</span><span class="op" id="4861844">;</span>&nbsp;<span class="ident" id="4861846">i</span>&nbsp;<span class="op" id="4861848">&lt;</span>&nbsp;<span class="ident" id="4861850">n</span><span class="op" id="4861851">;</span>&nbsp;<span class="ident" id="4861853">i</span><span class="op" id="4861854">++</span>&nbsp;<span class="op" id="4861857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861861">key</span>&nbsp;<span class="op" id="4861865">:=</span>&nbsp;<span class="ident" id="4861868">decodeIntoValue</span><span class="op" id="4861883">(</span><span class="ident" id="4861884">state</span><span class="op" id="4861889">,</span>&nbsp;<span class="ident" id="4861891">keyOp</span><span class="op" id="4861896">,</span>&nbsp;<span class="ident" id="4861898">keyIsPtr</span><span class="op" id="4861906">,</span>&nbsp;<span class="ident" id="4861908">allocValue</span><span class="op" id="4861918">(</span><span class="ident" id="4861919">mtyp</span><span class="op" id="4861923">.</span><span class="ident" id="4861924">Key</span><span class="op" id="4861927">(</span><span class="op" id="4861928">)</span><span class="op" id="4861929">)</span><span class="op" id="4861930">,</span>&nbsp;<span class="ident" id="4861932">ovfl</span><span class="op" id="4861936">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861940">elem</span>&nbsp;<span class="op" id="4861945">:=</span>&nbsp;<span class="ident" id="4861948">decodeIntoValue</span><span class="op" id="4861963">(</span><span class="ident" id="4861964">state</span><span class="op" id="4861969">,</span>&nbsp;<span class="ident" id="4861971">elemOp</span><span class="op" id="4861977">,</span>&nbsp;<span class="ident" id="4861979">elemIsPtr</span><span class="op" id="4861988">,</span>&nbsp;<span class="ident" id="4861990">allocValue</span><span class="op" id="4862000">(</span><span class="ident" id="4862001">mtyp</span><span class="op" id="4862005">.</span><span class="ident" id="4862006">Elem</span><span class="op" id="4862010">(</span><span class="op" id="4862011">)</span><span class="op" id="4862012">)</span><span class="op" id="4862013">,</span>&nbsp;<span class="ident" id="4862015">ovfl</span><span class="op" id="4862019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862023">value</span><span class="op" id="4862028">.</span><span class="ident" id="4862029">SetMapIndex</span><span class="op" id="4862040">(</span><span class="ident" id="4862041">key</span><span class="op" id="4862044">,</span>&nbsp;<span class="ident" id="4862046">elem</span><span class="op" id="4862050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4862053">}</span><br>
<span class="lineno"></span><span class="op" id="4862055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="4862058">//&nbsp;ignoreArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;discarding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="4862127">func</span>&nbsp;<span class="op" id="4862132">(</span><span class="ident" id="4862133">dec</span>&nbsp;<span class="op" id="4862137">*</span><span class="ident" id="4862138">Decoder</span><span class="op" id="4862145">)</span>&nbsp;<span class="ident" id="4862147">ignoreArrayHelper</span><span class="op" id="4862164">(</span><span class="ident" id="4862165">state</span>&nbsp;<span class="op" id="4862171">*</span><span class="ident" id="4862172">decoderState</span><span class="op" id="4862184">,</span>&nbsp;<span class="ident" id="4862186">elemOp</span>&nbsp;<span class="ident" id="4862193">decOp</span><span class="op" id="4862198">,</span>&nbsp;<span class="ident" id="4862200">length</span>&nbsp;<span class="builtintype" id="4862207">int</span><span class="op" id="4862210">)</span>&nbsp;<span class="op" id="4862212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862215">instr</span>&nbsp;<span class="op" id="4862221">:=</span>&nbsp;<span class="op" id="4862224">&amp;</span><span class="ident" id="4862225">decInstr</span><span class="op" id="4862233">{</span><span class="ident" id="4862234">elemOp</span><span class="op" id="4862240">,</span>&nbsp;<span class="num" id="4862242">0</span><span class="op" id="4862243">,</span>&nbsp;<span class="ident" id="4862245">nil</span><span class="op" id="4862248">,</span>&nbsp;<span class="ident" id="4862250">errors</span><span class="op" id="4862256">.</span><span class="ident" id="4862257">New</span><span class="op" id="4862260">(</span><span class="string" id="4862261">&#34;no&nbsp;error&#34;</span><span class="op" id="4862271">)</span><span class="op" id="4862272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862275">for</span>&nbsp;<span class="ident" id="4862279">i</span>&nbsp;<span class="op" id="4862281">:=</span>&nbsp;<span class="num" id="4862284">0</span><span class="op" id="4862285">;</span>&nbsp;<span class="ident" id="4862287">i</span>&nbsp;<span class="op" id="4862289">&lt;</span>&nbsp;<span class="ident" id="4862291">length</span><span class="op" id="4862297">;</span>&nbsp;<span class="ident" id="4862299">i</span><span class="op" id="4862300">++</span>&nbsp;<span class="op" id="4862303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862307">elemOp</span><span class="op" id="4862313">(</span><span class="ident" id="4862314">instr</span><span class="op" id="4862319">,</span>&nbsp;<span class="ident" id="4862321">state</span><span class="op" id="4862326">,</span>&nbsp;<span class="ident" id="4862328">noValue</span><span class="op" id="4862335">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4862338">}</span><br>
<span class="lineno"></span><span class="op" id="4862340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4862343">//&nbsp;ignoreArray&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;array&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4862416">func</span>&nbsp;<span class="op" id="4862421">(</span><span class="ident" id="4862422">dec</span>&nbsp;<span class="op" id="4862426">*</span><span class="ident" id="4862427">Decoder</span><span class="op" id="4862434">)</span>&nbsp;<span class="ident" id="4862436">ignoreArray</span><span class="op" id="4862447">(</span><span class="ident" id="4862448">state</span>&nbsp;<span class="op" id="4862454">*</span><span class="ident" id="4862455">decoderState</span><span class="op" id="4862467">,</span>&nbsp;<span class="ident" id="4862469">elemOp</span>&nbsp;<span class="ident" id="4862476">decOp</span><span class="op" id="4862481">,</span>&nbsp;<span class="ident" id="4862483">length</span>&nbsp;<span class="builtintype" id="4862490">int</span><span class="op" id="4862493">)</span>&nbsp;<span class="op" id="4862495">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862498">if</span>&nbsp;<span class="ident" id="4862501">n</span>&nbsp;<span class="op" id="4862503">:=</span>&nbsp;<span class="ident" id="4862506">state</span><span class="op" id="4862511">.</span><span class="ident" id="4862512">decodeUint</span><span class="op" id="4862522">(</span><span class="op" id="4862523">)</span><span class="op" id="4862524">;</span>&nbsp;<span class="ident" id="4862526">n</span>&nbsp;<span class="op" id="4862528">!=</span>&nbsp;<span class="ident" id="4862531">uint64</span><span class="op" id="4862537">(</span><span class="ident" id="4862538">length</span><span class="op" id="4862544">)</span>&nbsp;<span class="op" id="4862546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862550">errorf</span><span class="op" id="4862556">(</span><span class="string" id="4862557">&#34;length&nbsp;mismatch&nbsp;in&nbsp;ignoreArray&#34;</span><span class="op" id="4862589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4862592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862595">dec</span><span class="op" id="4862598">.</span><span class="ident" id="4862599">ignoreArrayHelper</span><span class="op" id="4862616">(</span><span class="ident" id="4862617">state</span><span class="op" id="4862622">,</span>&nbsp;<span class="ident" id="4862624">elemOp</span><span class="op" id="4862630">,</span>&nbsp;<span class="ident" id="4862632">length</span><span class="op" id="4862638">)</span><br>
<span class="lineno"></span><span class="op" id="4862640">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="comment" id="4862643">//&nbsp;ignoreMap&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;map&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4862711">func</span>&nbsp;<span class="op" id="4862716">(</span><span class="ident" id="4862717">dec</span>&nbsp;<span class="op" id="4862721">*</span><span class="ident" id="4862722">Decoder</span><span class="op" id="4862729">)</span>&nbsp;<span class="ident" id="4862731">ignoreMap</span><span class="op" id="4862740">(</span><span class="ident" id="4862741">state</span>&nbsp;<span class="op" id="4862747">*</span><span class="ident" id="4862748">decoderState</span><span class="op" id="4862760">,</span>&nbsp;<span class="ident" id="4862762">keyOp</span><span class="op" id="4862767">,</span>&nbsp;<span class="ident" id="4862769">elemOp</span>&nbsp;<span class="ident" id="4862776">decOp</span><span class="op" id="4862781">)</span>&nbsp;<span class="op" id="4862783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862786">n</span>&nbsp;<span class="op" id="4862788">:=</span>&nbsp;<span class="builtintype" id="4862791">int</span><span class="op" id="4862794">(</span><span class="ident" id="4862795">state</span><span class="op" id="4862800">.</span><span class="ident" id="4862801">decodeUint</span><span class="op" id="4862811">(</span><span class="op" id="4862812">)</span><span class="op" id="4862813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862816">keyInstr</span>&nbsp;<span class="op" id="4862825">:=</span>&nbsp;<span class="op" id="4862828">&amp;</span><span class="ident" id="4862829">decInstr</span><span class="op" id="4862837">{</span><span class="ident" id="4862838">keyOp</span><span class="op" id="4862843">,</span>&nbsp;<span class="num" id="4862845">0</span><span class="op" id="4862846">,</span>&nbsp;<span class="ident" id="4862848">nil</span><span class="op" id="4862851">,</span>&nbsp;<span class="ident" id="4862853">errors</span><span class="op" id="4862859">.</span><span class="ident" id="4862860">New</span><span class="op" id="4862863">(</span><span class="string" id="4862864">&#34;no&nbsp;error&#34;</span><span class="op" id="4862874">)</span><span class="op" id="4862875">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862878">elemInstr</span>&nbsp;<span class="op" id="4862888">:=</span>&nbsp;<span class="op" id="4862891">&amp;</span><span class="ident" id="4862892">decInstr</span><span class="op" id="4862900">{</span><span class="ident" id="4862901">elemOp</span><span class="op" id="4862907">,</span>&nbsp;<span class="num" id="4862909">0</span><span class="op" id="4862910">,</span>&nbsp;<span class="ident" id="4862912">nil</span><span class="op" id="4862915">,</span>&nbsp;<span class="ident" id="4862917">errors</span><span class="op" id="4862923">.</span><span class="ident" id="4862924">New</span><span class="op" id="4862927">(</span><span class="string" id="4862928">&#34;no&nbsp;error&#34;</span><span class="op" id="4862938">)</span><span class="op" id="4862939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862942">for</span>&nbsp;<span class="ident" id="4862946">i</span>&nbsp;<span class="op" id="4862948">:=</span>&nbsp;<span class="num" id="4862951">0</span><span class="op" id="4862952">;</span>&nbsp;<span class="ident" id="4862954">i</span>&nbsp;<span class="op" id="4862956">&lt;</span>&nbsp;<span class="ident" id="4862958">n</span><span class="op" id="4862959">;</span>&nbsp;<span class="ident" id="4862961">i</span><span class="op" id="4862962">++</span>&nbsp;<span class="op" id="4862965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862969">keyOp</span><span class="op" id="4862974">(</span><span class="ident" id="4862975">keyInstr</span><span class="op" id="4862983">,</span>&nbsp;<span class="ident" id="4862985">state</span><span class="op" id="4862990">,</span>&nbsp;<span class="ident" id="4862992">noValue</span><span class="op" id="4862999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863003">elemOp</span><span class="op" id="4863009">(</span><span class="ident" id="4863010">elemInstr</span><span class="op" id="4863019">,</span>&nbsp;<span class="ident" id="4863021">state</span><span class="op" id="4863026">,</span>&nbsp;<span class="ident" id="4863028">noValue</span><span class="op" id="4863035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863038">}</span><br>
<span class="lineno">595</span><span class="op" id="4863040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4863043">//&nbsp;decodeSlice&nbsp;decodes&nbsp;a&nbsp;slice&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4863098">//&nbsp;Slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;length&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="4863168">func</span>&nbsp;<span class="op" id="4863173">(</span><span class="ident" id="4863174">dec</span>&nbsp;<span class="op" id="4863178">*</span><span class="ident" id="4863179">Decoder</span><span class="op" id="4863186">)</span>&nbsp;<span class="ident" id="4863188">decodeSlice</span><span class="op" id="4863199">(</span><span class="ident" id="4863200">state</span>&nbsp;<span class="op" id="4863206">*</span><span class="ident" id="4863207">decoderState</span><span class="op" id="4863219">,</span>&nbsp;<span class="ident" id="4863221">value</span>&nbsp;<span class="ident" id="4863227">reflect</span><span class="op" id="4863234">.</span><span class="ident" id="4863235">Value</span><span class="op" id="4863240">,</span>&nbsp;<span class="ident" id="4863242">elemOp</span>&nbsp;<span class="ident" id="4863249">decOp</span><span class="op" id="4863254">,</span>&nbsp;<span class="ident" id="4863256">ovfl</span>&nbsp;<span class="builtintype" id="4863261">error</span><span class="op" id="4863266">,</span>&nbsp;<span class="ident" id="4863268">helper</span>&nbsp;<span class="ident" id="4863275">decHelper</span><span class="op" id="4863284">)</span>&nbsp;<span class="op" id="4863286">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863289">u</span>&nbsp;<span class="op" id="4863291">:=</span>&nbsp;<span class="ident" id="4863294">state</span><span class="op" id="4863299">.</span><span class="ident" id="4863300">decodeUint</span><span class="op" id="4863310">(</span><span class="op" id="4863311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863314">typ</span>&nbsp;<span class="op" id="4863318">:=</span>&nbsp;<span class="ident" id="4863321">value</span><span class="op" id="4863326">.</span><span class="ident" id="4863327">Type</span><span class="op" id="4863331">(</span><span class="op" id="4863332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863335">size</span>&nbsp;<span class="op" id="4863340">:=</span>&nbsp;<span class="ident" id="4863343">uint64</span><span class="op" id="4863349">(</span><span class="ident" id="4863350">typ</span><span class="op" id="4863353">.</span><span class="ident" id="4863354">Elem</span><span class="op" id="4863358">(</span><span class="op" id="4863359">)</span><span class="op" id="4863360">.</span><span class="ident" id="4863361">Size</span><span class="op" id="4863365">(</span><span class="op" id="4863366">)</span><span class="op" id="4863367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863370">nBytes</span>&nbsp;<span class="op" id="4863377">:=</span>&nbsp;<span class="ident" id="4863380">u</span>&nbsp;<span class="op" id="4863382">*</span>&nbsp;<span class="ident" id="4863384">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863390">n</span>&nbsp;<span class="op" id="4863392">:=</span>&nbsp;<span class="builtintype" id="4863395">int</span><span class="op" id="4863398">(</span><span class="ident" id="4863399">u</span><span class="op" id="4863400">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4863403">//&nbsp;Take&nbsp;care&nbsp;with&nbsp;overflow&nbsp;in&nbsp;this&nbsp;calculation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863452">if</span>&nbsp;<span class="ident" id="4863455">n</span>&nbsp;<span class="op" id="4863457">&lt;</span>&nbsp;<span class="num" id="4863459">0</span>&nbsp;<span class="op" id="4863461">||</span>&nbsp;<span class="ident" id="4863464">uint64</span><span class="op" id="4863470">(</span><span class="ident" id="4863471">n</span><span class="op" id="4863472">)</span>&nbsp;<span class="op" id="4863474">!=</span>&nbsp;<span class="ident" id="4863477">u</span>&nbsp;<span class="op" id="4863479">||</span>&nbsp;<span class="ident" id="4863482">nBytes</span>&nbsp;<span class="op" id="4863489">&gt;</span>&nbsp;<span class="ident" id="4863491">tooBig</span>&nbsp;<span class="op" id="4863498">||</span>&nbsp;<span class="op" id="4863501">(</span><span class="ident" id="4863502">size</span>&nbsp;<span class="op" id="4863507">&gt;</span>&nbsp;<span class="num" id="4863509">0</span>&nbsp;<span class="op" id="4863511">&amp;&amp;</span>&nbsp;<span class="ident" id="4863514">nBytes</span><span class="op" id="4863520">/</span><span class="ident" id="4863521">size</span>&nbsp;<span class="op" id="4863526">!=</span>&nbsp;<span class="ident" id="4863529">u</span><span class="op" id="4863530">)</span>&nbsp;<span class="op" id="4863532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4863536">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;n&nbsp;against&nbsp;buffer&nbsp;length&nbsp;here&nbsp;because&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4863609">//&nbsp;of&nbsp;interfaces,&nbsp;there&nbsp;will&nbsp;be&nbsp;buffer&nbsp;reloads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863659">errorf</span><span class="op" id="4863665">(</span><span class="string" id="4863666">&#34;%s&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&nbsp;elements&nbsp;of&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="4863709">,</span>&nbsp;<span class="ident" id="4863711">typ</span><span class="op" id="4863714">.</span><span class="ident" id="4863715">Elem</span><span class="op" id="4863719">(</span><span class="op" id="4863720">)</span><span class="op" id="4863721">,</span>&nbsp;<span class="ident" id="4863723">u</span><span class="op" id="4863724">,</span>&nbsp;<span class="ident" id="4863726">size</span><span class="op" id="4863730">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863736">if</span>&nbsp;<span class="ident" id="4863739">value</span><span class="op" id="4863744">.</span><span class="ident" id="4863745">Cap</span><span class="op" id="4863748">(</span><span class="op" id="4863749">)</span>&nbsp;<span class="op" id="4863751">&lt;</span>&nbsp;<span class="ident" id="4863753">n</span>&nbsp;<span class="op" id="4863755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863759">value</span><span class="op" id="4863764">.</span><span class="ident" id="4863765">Set</span><span class="op" id="4863768">(</span><span class="ident" id="4863769">reflect</span><span class="op" id="4863776">.</span><span class="ident" id="4863777">MakeSlice</span><span class="op" id="4863786">(</span><span class="ident" id="4863787">typ</span><span class="op" id="4863790">,</span>&nbsp;<span class="ident" id="4863792">n</span><span class="op" id="4863793">,</span>&nbsp;<span class="ident" id="4863795">n</span><span class="op" id="4863796">)</span><span class="op" id="4863797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863800">}</span>&nbsp;<span class="keyword" id="4863802">else</span>&nbsp;<span class="op" id="4863807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863811">value</span><span class="op" id="4863816">.</span><span class="ident" id="4863817">Set</span><span class="op" id="4863820">(</span><span class="ident" id="4863821">value</span><span class="op" id="4863826">.</span><span class="ident" id="4863827">Slice</span><span class="op" id="4863832">(</span><span class="num" id="4863833">0</span><span class="op" id="4863834">,</span>&nbsp;<span class="ident" id="4863836">n</span><span class="op" id="4863837">)</span><span class="op" id="4863838">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863844">dec</span><span class="op" id="4863847">.</span><span class="ident" id="4863848">decodeArrayHelper</span><span class="op" id="4863865">(</span><span class="ident" id="4863866">state</span><span class="op" id="4863871">,</span>&nbsp;<span class="ident" id="4863873">value</span><span class="op" id="4863878">,</span>&nbsp;<span class="ident" id="4863880">elemOp</span><span class="op" id="4863886">,</span>&nbsp;<span class="ident" id="4863888">n</span><span class="op" id="4863889">,</span>&nbsp;<span class="ident" id="4863891">ovfl</span><span class="op" id="4863895">,</span>&nbsp;<span class="ident" id="4863897">helper</span><span class="op" id="4863903">)</span><br>
<span class="lineno"></span><span class="op" id="4863905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4863908">//&nbsp;ignoreSlice&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">620</span><span class="keyword" id="4863982">func</span>&nbsp;<span class="op" id="4863987">(</span><span class="ident" id="4863988">dec</span>&nbsp;<span class="op" id="4863992">*</span><span class="ident" id="4863993">Decoder</span><span class="op" id="4864000">)</span>&nbsp;<span class="ident" id="4864002">ignoreSlice</span><span class="op" id="4864013">(</span><span class="ident" id="4864014">state</span>&nbsp;<span class="op" id="4864020">*</span><span class="ident" id="4864021">decoderState</span><span class="op" id="4864033">,</span>&nbsp;<span class="ident" id="4864035">elemOp</span>&nbsp;<span class="ident" id="4864042">decOp</span><span class="op" id="4864047">)</span>&nbsp;<span class="op" id="4864049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864052">dec</span><span class="op" id="4864055">.</span><span class="ident" id="4864056">ignoreArrayHelper</span><span class="op" id="4864073">(</span><span class="ident" id="4864074">state</span><span class="op" id="4864079">,</span>&nbsp;<span class="ident" id="4864081">elemOp</span><span class="op" id="4864087">,</span>&nbsp;<span class="builtintype" id="4864089">int</span><span class="op" id="4864092">(</span><span class="ident" id="4864093">state</span><span class="op" id="4864098">.</span><span class="ident" id="4864099">decodeUint</span><span class="op" id="4864109">(</span><span class="op" id="4864110">)</span><span class="op" id="4864111">)</span><span class="op" id="4864112">)</span><br>
<span class="lineno"></span><span class="op" id="4864114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4864117">//&nbsp;decodeInterface&nbsp;decodes&nbsp;an&nbsp;interface&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">625</span><span class="comment" id="4864187">//&nbsp;Interfaces&nbsp;are&nbsp;encoded&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;concrete&nbsp;type&nbsp;followed&nbsp;by&nbsp;a&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4864265">//&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;empty,&nbsp;the&nbsp;value&nbsp;is&nbsp;nil&nbsp;and&nbsp;no&nbsp;value&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="4864329">func</span>&nbsp;<span class="op" id="4864334">(</span><span class="ident" id="4864335">dec</span>&nbsp;<span class="op" id="4864339">*</span><span class="ident" id="4864340">Decoder</span><span class="op" id="4864347">)</span>&nbsp;<span class="ident" id="4864349">decodeInterface</span><span class="op" id="4864364">(</span><span class="ident" id="4864365">ityp</span>&nbsp;<span class="ident" id="4864370">reflect</span><span class="op" id="4864377">.</span><span class="ident" id="4864378">Type</span><span class="op" id="4864382">,</span>&nbsp;<span class="ident" id="4864384">state</span>&nbsp;<span class="op" id="4864390">*</span><span class="ident" id="4864391">decoderState</span><span class="op" id="4864403">,</span>&nbsp;<span class="ident" id="4864405">value</span>&nbsp;<span class="ident" id="4864411">reflect</span><span class="op" id="4864418">.</span><span class="ident" id="4864419">Value</span><span class="op" id="4864424">)</span>&nbsp;<span class="op" id="4864426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4864429">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864469">nr</span>&nbsp;<span class="op" id="4864472">:=</span>&nbsp;<span class="ident" id="4864475">state</span><span class="op" id="4864480">.</span><span class="ident" id="4864481">decodeUint</span><span class="op" id="4864491">(</span><span class="op" id="4864492">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864495">if</span>&nbsp;<span class="ident" id="4864498">nr</span>&nbsp;<span class="op" id="4864501">&lt;</span>&nbsp;<span class="num" id="4864503">0</span>&nbsp;<span class="op" id="4864505">||</span>&nbsp;<span class="ident" id="4864508">nr</span>&nbsp;<span class="op" id="4864511">&gt;</span>&nbsp;<span class="num" id="4864513">1</span><span class="op" id="4864514">&lt;&lt;</span><span class="num" id="4864516">31</span>&nbsp;<span class="op" id="4864519">{</span>&nbsp;<span class="comment" id="4864521">//&nbsp;zero&nbsp;is&nbsp;permissible&nbsp;for&nbsp;anonymous&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864566">errorf</span><span class="op" id="4864572">(</span><span class="string" id="4864573">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d&#34;</span><span class="op" id="4864602">,</span>&nbsp;<span class="ident" id="4864604">nr</span><span class="op" id="4864606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864612">if</span>&nbsp;<span class="ident" id="4864615">nr</span>&nbsp;<span class="op" id="4864618">&gt;</span>&nbsp;<span class="ident" id="4864620">uint64</span><span class="op" id="4864626">(</span><span class="ident" id="4864627">state</span><span class="op" id="4864632">.</span><span class="ident" id="4864633">b</span><span class="op" id="4864634">.</span><span class="ident" id="4864635">Len</span><span class="op" id="4864638">(</span><span class="op" id="4864639">)</span><span class="op" id="4864640">)</span>&nbsp;<span class="op" id="4864642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864646">errorf</span><span class="op" id="4864652">(</span><span class="string" id="4864653">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d:&nbsp;exceeds&nbsp;input&nbsp;size&#34;</span><span class="op" id="4864702">,</span>&nbsp;<span class="ident" id="4864704">nr</span><span class="op" id="4864706">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864712">b</span>&nbsp;<span class="op" id="4864714">:=</span>&nbsp;<span class="builtinfunc" id="4864717">make</span><span class="op" id="4864721">(</span><span class="op" id="4864722">[</span><span class="op" id="4864723">]</span><span class="builtintype" id="4864724">byte</span><span class="op" id="4864728">,</span>&nbsp;<span class="ident" id="4864730">nr</span><span class="op" id="4864732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864735">state</span><span class="op" id="4864740">.</span><span class="ident" id="4864741">b</span><span class="op" id="4864742">.</span><span class="ident" id="4864743">Read</span><span class="op" id="4864747">(</span><span class="ident" id="4864748">b</span><span class="op" id="4864749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864752">name</span>&nbsp;<span class="op" id="4864757">:=</span>&nbsp;<span class="builtintype" id="4864760">string</span><span class="op" id="4864766">(</span><span class="ident" id="4864767">b</span><span class="op" id="4864768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4864771">//&nbsp;Allocate&nbsp;the&nbsp;destination&nbsp;interface&nbsp;value.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864817">if</span>&nbsp;<span class="ident" id="4864820">name</span>&nbsp;<span class="op" id="4864825">==</span>&nbsp;<span class="string" id="4864828">&#34;&#34;</span>&nbsp;<span class="op" id="4864831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4864835">//&nbsp;Copy&nbsp;the&nbsp;nil&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864884">value</span><span class="op" id="4864889">.</span><span class="ident" id="4864890">Set</span><span class="op" id="4864893">(</span><span class="ident" id="4864894">reflect</span><span class="op" id="4864901">.</span><span class="ident" id="4864902">Zero</span><span class="op" id="4864906">(</span><span class="ident" id="4864907">value</span><span class="op" id="4864912">.</span><span class="ident" id="4864913">Type</span><span class="op" id="4864917">(</span><span class="op" id="4864918">)</span><span class="op" id="4864919">)</span><span class="op" id="4864920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864924">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864932">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864935">if</span>&nbsp;<span class="builtinfunc" id="4864938">len</span><span class="op" id="4864941">(</span><span class="ident" id="4864942">name</span><span class="op" id="4864946">)</span>&nbsp;<span class="op" id="4864948">&gt;</span>&nbsp;<span class="num" id="4864950">1024</span>&nbsp;<span class="op" id="4864955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864959">errorf</span><span class="op" id="4864965">(</span><span class="string" id="4864966">&#34;name&nbsp;too&nbsp;long&nbsp;(%d&nbsp;bytes):&nbsp;%.20q...&#34;</span><span class="op" id="4865002">,</span>&nbsp;<span class="builtinfunc" id="4865004">len</span><span class="op" id="4865007">(</span><span class="ident" id="4865008">name</span><span class="op" id="4865012">)</span><span class="op" id="4865013">,</span>&nbsp;<span class="ident" id="4865015">name</span><span class="op" id="4865019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865025">//&nbsp;The&nbsp;concrete&nbsp;type&nbsp;must&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865067">registerLock</span><span class="op" id="4865079">.</span><span class="ident" id="4865080">RLock</span><span class="op" id="4865085">(</span><span class="op" id="4865086">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865089">typ</span><span class="op" id="4865092">,</span>&nbsp;<span class="ident" id="4865094">ok</span>&nbsp;<span class="op" id="4865097">:=</span>&nbsp;<span class="ident" id="4865100">nameToConcreteType</span><span class="op" id="4865118">[</span><span class="ident" id="4865119">name</span><span class="op" id="4865123">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865126">registerLock</span><span class="op" id="4865138">.</span><span class="ident" id="4865139">RUnlock</span><span class="op" id="4865146">(</span><span class="op" id="4865147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865150">if</span>&nbsp;<span class="op" id="4865153">!</span><span class="ident" id="4865154">ok</span>&nbsp;<span class="op" id="4865157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865161">errorf</span><span class="op" id="4865167">(</span><span class="string" id="4865168">&#34;name&nbsp;not&nbsp;registered&nbsp;for&nbsp;interface:&nbsp;%q&#34;</span><span class="op" id="4865207">,</span>&nbsp;<span class="ident" id="4865209">name</span><span class="op" id="4865213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865216">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865219">//&nbsp;Read&nbsp;the&nbsp;type&nbsp;id&nbsp;of&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865263">concreteId</span>&nbsp;<span class="op" id="4865274">:=</span>&nbsp;<span class="ident" id="4865277">dec</span><span class="op" id="4865280">.</span><span class="ident" id="4865281">decodeTypeSequence</span><span class="op" id="4865299">(</span><span class="builtintype" id="4865300">true</span><span class="op" id="4865304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865307">if</span>&nbsp;<span class="ident" id="4865310">concreteId</span>&nbsp;<span class="op" id="4865321">&lt;</span>&nbsp;<span class="num" id="4865323">0</span>&nbsp;<span class="op" id="4865325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865329">error_</span><span class="op" id="4865335">(</span><span class="ident" id="4865336">dec</span><span class="op" id="4865339">.</span><span class="ident" id="4865340">err</span><span class="op" id="4865343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865346">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865349">//&nbsp;Byte&nbsp;count&nbsp;of&nbsp;value&nbsp;is&nbsp;next;&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;it&nbsp;is&nbsp;(it&#39;s&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865419">//&nbsp;in&nbsp;case&nbsp;we&nbsp;want&nbsp;to&nbsp;ignore&nbsp;the&nbsp;value&nbsp;by&nbsp;skipping&nbsp;it&nbsp;completely).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865487">state</span><span class="op" id="4865492">.</span><span class="ident" id="4865493">decodeUint</span><span class="op" id="4865503">(</span><span class="op" id="4865504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865507">//&nbsp;Read&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865536">v</span>&nbsp;<span class="op" id="4865538">:=</span>&nbsp;<span class="ident" id="4865541">allocValue</span><span class="op" id="4865551">(</span><span class="ident" id="4865552">typ</span><span class="op" id="4865555">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865558">dec</span><span class="op" id="4865561">.</span><span class="ident" id="4865562">decodeValue</span><span class="op" id="4865573">(</span><span class="ident" id="4865574">concreteId</span><span class="op" id="4865584">,</span>&nbsp;<span class="ident" id="4865586">v</span><span class="op" id="4865587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865590">if</span>&nbsp;<span class="ident" id="4865593">dec</span><span class="op" id="4865596">.</span><span class="ident" id="4865597">err</span>&nbsp;<span class="op" id="4865601">!=</span>&nbsp;<span class="ident" id="4865604">nil</span>&nbsp;<span class="op" id="4865608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865612">error_</span><span class="op" id="4865618">(</span><span class="ident" id="4865619">dec</span><span class="op" id="4865622">.</span><span class="ident" id="4865623">err</span><span class="op" id="4865626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865632">//&nbsp;Assign&nbsp;the&nbsp;concrete&nbsp;value&nbsp;to&nbsp;the&nbsp;interface.</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865680">//&nbsp;Tread&nbsp;carefully;&nbsp;it&nbsp;might&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865737">if</span>&nbsp;<span class="op" id="4865740">!</span><span class="ident" id="4865741">typ</span><span class="op" id="4865744">.</span><span class="ident" id="4865745">AssignableTo</span><span class="op" id="4865757">(</span><span class="ident" id="4865758">ityp</span><span class="op" id="4865762">)</span>&nbsp;<span class="op" id="4865764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865768">errorf</span><span class="op" id="4865774">(</span><span class="string" id="4865775">&#34;%s&nbsp;is&nbsp;not&nbsp;assignable&nbsp;to&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4865808">,</span>&nbsp;<span class="ident" id="4865810">typ</span><span class="op" id="4865813">,</span>&nbsp;<span class="ident" id="4865815">ityp</span><span class="op" id="4865819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865825">//&nbsp;Copy&nbsp;the&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865869">value</span><span class="op" id="4865874">.</span><span class="ident" id="4865875">Set</span><span class="op" id="4865878">(</span><span class="ident" id="4865879">v</span><span class="op" id="4865880">)</span><br>
<span class="lineno"></span><span class="op" id="4865882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4865885">//&nbsp;ignoreInterface&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;interface&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4865966">func</span>&nbsp;<span class="op" id="4865971">(</span><span class="ident" id="4865972">dec</span>&nbsp;<span class="op" id="4865976">*</span><span class="ident" id="4865977">Decoder</span><span class="op" id="4865984">)</span>&nbsp;<span class="ident" id="4865986">ignoreInterface</span><span class="op" id="4866001">(</span><span class="ident" id="4866002">state</span>&nbsp;<span class="op" id="4866008">*</span><span class="ident" id="4866009">decoderState</span><span class="op" id="4866021">)</span>&nbsp;<span class="op" id="4866023">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4866026">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866066">b</span>&nbsp;<span class="op" id="4866068">:=</span>&nbsp;<span class="builtinfunc" id="4866071">make</span><span class="op" id="4866075">(</span><span class="op" id="4866076">[</span><span class="op" id="4866077">]</span><span class="builtintype" id="4866078">byte</span><span class="op" id="4866082">,</span>&nbsp;<span class="ident" id="4866084">state</span><span class="op" id="4866089">.</span><span class="ident" id="4866090">decodeUint</span><span class="op" id="4866100">(</span><span class="op" id="4866101">)</span><span class="op" id="4866102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866105">_</span><span class="op" id="4866106">,</span>&nbsp;<span class="ident" id="4866108">err</span>&nbsp;<span class="op" id="4866112">:=</span>&nbsp;<span class="ident" id="4866115">state</span><span class="op" id="4866120">.</span><span class="ident" id="4866121">b</span><span class="op" id="4866122">.</span><span class="ident" id="4866123">Read</span><span class="op" id="4866127">(</span><span class="ident" id="4866128">b</span><span class="op" id="4866129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866132">if</span>&nbsp;<span class="ident" id="4866135">err</span>&nbsp;<span class="op" id="4866139">!=</span>&nbsp;<span class="ident" id="4866142">nil</span>&nbsp;<span class="op" id="4866146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866150">error_</span><span class="op" id="4866156">(</span><span class="ident" id="4866157">err</span><span class="op" id="4866160">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866166">id</span>&nbsp;<span class="op" id="4866169">:=</span>&nbsp;<span class="ident" id="4866172">dec</span><span class="op" id="4866175">.</span><span class="ident" id="4866176">decodeTypeSequence</span><span class="op" id="4866194">(</span><span class="builtintype" id="4866195">true</span><span class="op" id="4866199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866202">if</span>&nbsp;<span class="ident" id="4866205">id</span>&nbsp;<span class="op" id="4866208">&lt;</span>&nbsp;<span class="num" id="4866210">0</span>&nbsp;<span class="op" id="4866212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866216">error_</span><span class="op" id="4866222">(</span><span class="ident" id="4866223">dec</span><span class="op" id="4866226">.</span><span class="ident" id="4866227">err</span><span class="op" id="4866230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866233">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4866236">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;decoder&nbsp;buffer&nbsp;contains&nbsp;a&nbsp;delimited&nbsp;value.&nbsp;Just&nbsp;toss&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866316">state</span><span class="op" id="4866321">.</span><span class="ident" id="4866322">b</span><span class="op" id="4866323">.</span><span class="ident" id="4866324">Drop</span><span class="op" id="4866328">(</span><span class="builtintype" id="4866329">int</span><span class="op" id="4866332">(</span><span class="ident" id="4866333">state</span><span class="op" id="4866338">.</span><span class="ident" id="4866339">decodeUint</span><span class="op" id="4866349">(</span><span class="op" id="4866350">)</span><span class="op" id="4866351">)</span><span class="op" id="4866352">)</span><br>
<span class="lineno"></span><span class="op" id="4866354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4866357">//&nbsp;decodeGobDecoder&nbsp;decodes&nbsp;something&nbsp;implementing&nbsp;the&nbsp;GobDecoder&nbsp;interface.</span><br>
<span class="lineno">695</span><span class="comment" id="4866434">//&nbsp;The&nbsp;data&nbsp;is&nbsp;encoded&nbsp;as&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4866474">func</span>&nbsp;<span class="op" id="4866479">(</span><span class="ident" id="4866480">dec</span>&nbsp;<span class="op" id="4866484">*</span><span class="ident" id="4866485">Decoder</span><span class="op" id="4866492">)</span>&nbsp;<span class="ident" id="4866494">decodeGobDecoder</span><span class="op" id="4866510">(</span><span class="ident" id="4866511">ut</span>&nbsp;<span class="op" id="4866514">*</span><span class="ident" id="4866515">userTypeInfo</span><span class="op" id="4866527">,</span>&nbsp;<span class="ident" id="4866529">state</span>&nbsp;<span class="op" id="4866535">*</span><span class="ident" id="4866536">decoderState</span><span class="op" id="4866548">,</span>&nbsp;<span class="ident" id="4866550">value</span>&nbsp;<span class="ident" id="4866556">reflect</span><span class="op" id="4866563">.</span><span class="ident" id="4866564">Value</span><span class="op" id="4866569">)</span>&nbsp;<span class="op" id="4866571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4866574">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866608">b</span>&nbsp;<span class="op" id="4866610">:=</span>&nbsp;<span class="builtinfunc" id="4866613">make</span><span class="op" id="4866617">(</span><span class="op" id="4866618">[</span><span class="op" id="4866619">]</span><span class="builtintype" id="4866620">byte</span><span class="op" id="4866624">,</span>&nbsp;<span class="ident" id="4866626">state</span><span class="op" id="4866631">.</span><span class="ident" id="4866632">decodeUint</span><span class="op" id="4866642">(</span><span class="op" id="4866643">)</span><span class="op" id="4866644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866647">_</span><span class="op" id="4866648">,</span>&nbsp;<span class="ident" id="4866650">err</span>&nbsp;<span class="op" id="4866654">:=</span>&nbsp;<span class="ident" id="4866657">state</span><span class="op" id="4866662">.</span><span class="ident" id="4866663">b</span><span class="op" id="4866664">.</span><span class="ident" id="4866665">Read</span><span class="op" id="4866669">(</span><span class="ident" id="4866670">b</span><span class="op" id="4866671">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866674">if</span>&nbsp;<span class="ident" id="4866677">err</span>&nbsp;<span class="op" id="4866681">!=</span>&nbsp;<span class="ident" id="4866684">nil</span>&nbsp;<span class="op" id="4866688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866692">error_</span><span class="op" id="4866698">(</span><span class="ident" id="4866699">err</span><span class="op" id="4866702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4866708">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;one&nbsp;of&nbsp;these.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866739">switch</span>&nbsp;<span class="ident" id="4866746">ut</span><span class="op" id="4866748">.</span><span class="ident" id="4866749">externalDec</span>&nbsp;<span class="op" id="4866761">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866764">case</span>&nbsp;<span class="ident" id="4866769">xGob</span><span class="op" id="4866773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866777">err</span>&nbsp;<span class="op" id="4866781">=</span>&nbsp;<span class="ident" id="4866783">value</span><span class="op" id="4866788">.</span><span class="ident" id="4866789">Interface</span><span class="op" id="4866798">(</span><span class="op" id="4866799">)</span><span class="op" id="4866800">.</span><span class="op" id="4866801">(</span><span class="ident" id="4866802">GobDecoder</span><span class="op" id="4866812">)</span><span class="op" id="4866813">.</span><span class="ident" id="4866814">GobDecode</span><span class="op" id="4866823">(</span><span class="ident" id="4866824">b</span><span class="op" id="4866825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866828">case</span>&nbsp;<span class="ident" id="4866833">xBinary</span><span class="op" id="4866840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866844">err</span>&nbsp;<span class="op" id="4866848">=</span>&nbsp;<span class="ident" id="4866850">value</span><span class="op" id="4866855">.</span><span class="ident" id="4866856">Interface</span><span class="op" id="4866865">(</span><span class="op" id="4866866">)</span><span class="op" id="4866867">.</span><span class="op" id="4866868">(</span><span class="ident" id="4866869">encoding</span><span class="op" id="4866877">.</span><span class="ident" id="4866878">BinaryUnmarshaler</span><span class="op" id="4866895">)</span><span class="op" id="4866896">.</span><span class="ident" id="4866897">UnmarshalBinary</span><span class="op" id="4866912">(</span><span class="ident" id="4866913">b</span><span class="op" id="4866914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866917">case</span>&nbsp;<span class="ident" id="4866922">xText</span><span class="op" id="4866927">:</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866931">err</span>&nbsp;<span class="op" id="4866935">=</span>&nbsp;<span class="ident" id="4866937">value</span><span class="op" id="4866942">.</span><span class="ident" id="4866943">Interface</span><span class="op" id="4866952">(</span><span class="op" id="4866953">)</span><span class="op" id="4866954">.</span><span class="op" id="4866955">(</span><span class="ident" id="4866956">encoding</span><span class="op" id="4866964">.</span><span class="ident" id="4866965">TextUnmarshaler</span><span class="op" id="4866980">)</span><span class="op" id="4866981">.</span><span class="ident" id="4866982">UnmarshalText</span><span class="op" id="4866995">(</span><span class="ident" id="4866996">b</span><span class="op" id="4866997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4867000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867003">if</span>&nbsp;<span class="ident" id="4867006">err</span>&nbsp;<span class="op" id="4867010">!=</span>&nbsp;<span class="ident" id="4867013">nil</span>&nbsp;<span class="op" id="4867017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867021">error_</span><span class="op" id="4867027">(</span><span class="ident" id="4867028">err</span><span class="op" id="4867031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4867034">}</span><br>
<span class="lineno">715</span><span class="op" id="4867036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4867039">//&nbsp;ignoreGobDecoder&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;GobDecoder&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4867121">func</span>&nbsp;<span class="op" id="4867126">(</span><span class="ident" id="4867127">dec</span>&nbsp;<span class="op" id="4867131">*</span><span class="ident" id="4867132">Decoder</span><span class="op" id="4867139">)</span>&nbsp;<span class="ident" id="4867141">ignoreGobDecoder</span><span class="op" id="4867157">(</span><span class="ident" id="4867158">state</span>&nbsp;<span class="op" id="4867164">*</span><span class="ident" id="4867165">decoderState</span><span class="op" id="4867177">)</span>&nbsp;<span class="op" id="4867179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4867182">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867216">b</span>&nbsp;<span class="op" id="4867218">:=</span>&nbsp;<span class="builtinfunc" id="4867221">make</span><span class="op" id="4867225">(</span><span class="op" id="4867226">[</span><span class="op" id="4867227">]</span><span class="builtintype" id="4867228">byte</span><span class="op" id="4867232">,</span>&nbsp;<span class="ident" id="4867234">state</span><span class="op" id="4867239">.</span><span class="ident" id="4867240">decodeUint</span><span class="op" id="4867250">(</span><span class="op" id="4867251">)</span><span class="op" id="4867252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867255">_</span><span class="op" id="4867256">,</span>&nbsp;<span class="ident" id="4867258">err</span>&nbsp;<span class="op" id="4867262">:=</span>&nbsp;<span class="ident" id="4867265">state</span><span class="op" id="4867270">.</span><span class="ident" id="4867271">b</span><span class="op" id="4867272">.</span><span class="ident" id="4867273">Read</span><span class="op" id="4867277">(</span><span class="ident" id="4867278">b</span><span class="op" id="4867279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867282">if</span>&nbsp;<span class="ident" id="4867285">err</span>&nbsp;<span class="op" id="4867289">!=</span>&nbsp;<span class="ident" id="4867292">nil</span>&nbsp;<span class="op" id="4867296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867300">error_</span><span class="op" id="4867306">(</span><span class="ident" id="4867307">err</span><span class="op" id="4867310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4867313">}</span><br>
<span class="lineno">725</span><span class="op" id="4867315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4867318">//&nbsp;Index&nbsp;by&nbsp;Go&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4867340">var</span>&nbsp;<span class="ident" id="4867344">decOpTable</span>&nbsp;<span class="op" id="4867355">=</span>&nbsp;<span class="op" id="4867357">[</span><span class="op" id="4867358">...</span><span class="op" id="4867361">]</span><span class="ident" id="4867362">decOp</span><span class="op" id="4867367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867370">reflect</span><span class="op" id="4867377">.</span><span class="ident" id="4867378">Bool</span><span class="op" id="4867382">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867390">decBool</span><span class="op" id="4867397">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867400">reflect</span><span class="op" id="4867407">.</span><span class="ident" id="4867408">Int8</span><span class="op" id="4867412">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867420">decInt8</span><span class="op" id="4867427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867430">reflect</span><span class="op" id="4867437">.</span><span class="ident" id="4867438">Int16</span><span class="op" id="4867443">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867450">decInt16</span><span class="op" id="4867458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867461">reflect</span><span class="op" id="4867468">.</span><span class="ident" id="4867469">Int32</span><span class="op" id="4867474">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867481">decInt32</span><span class="op" id="4867489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867492">reflect</span><span class="op" id="4867499">.</span><span class="ident" id="4867500">Int64</span><span class="op" id="4867505">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867512">decInt64</span><span class="op" id="4867520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867523">reflect</span><span class="op" id="4867530">.</span><span class="ident" id="4867531">Uint8</span><span class="op" id="4867536">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867543">decUint8</span><span class="op" id="4867551">,</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867554">reflect</span><span class="op" id="4867561">.</span><span class="ident" id="4867562">Uint16</span><span class="op" id="4867568">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867574">decUint16</span><span class="op" id="4867583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867586">reflect</span><span class="op" id="4867593">.</span><span class="ident" id="4867594">Uint32</span><span class="op" id="4867600">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867606">decUint32</span><span class="op" id="4867615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867618">reflect</span><span class="op" id="4867625">.</span><span class="ident" id="4867626">Uint64</span><span class="op" id="4867632">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867638">decUint64</span><span class="op" id="4867647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867650">reflect</span><span class="op" id="4867657">.</span><span class="ident" id="4867658">Float32</span><span class="op" id="4867665">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867670">decFloat32</span><span class="op" id="4867680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867683">reflect</span><span class="op" id="4867690">.</span><span class="ident" id="4867691">Float64</span><span class="op" id="4867698">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867703">decFloat64</span><span class="op" id="4867713">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867716">reflect</span><span class="op" id="4867723">.</span><span class="ident" id="4867724">Complex64</span><span class="op" id="4867733">:</span>&nbsp;&nbsp;<span class="ident" id="4867736">decComplex64</span><span class="op" id="4867748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867751">reflect</span><span class="op" id="4867758">.</span><span class="ident" id="4867759">Complex128</span><span class="op" id="4867769">:</span>&nbsp;<span class="ident" id="4867771">decComplex128</span><span class="op" id="4867784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867787">reflect</span><span class="op" id="4867794">.</span><span class="ident" id="4867795">String</span><span class="op" id="4867801">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867807">decString</span><span class="op" id="4867816">,</span><br>
<span class="lineno"></span><span class="op" id="4867818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="4867821">//&nbsp;Indexed&nbsp;by&nbsp;gob&nbsp;types.&nbsp;&nbsp;tComplex&nbsp;will&nbsp;be&nbsp;added&nbsp;during&nbsp;type.init().</span><br>
<span class="lineno"></span><span class="keyword" id="4867890">var</span>&nbsp;<span class="ident" id="4867894">decIgnoreOpMap</span>&nbsp;<span class="op" id="4867909">=</span>&nbsp;<span class="keyword" id="4867911">map</span><span class="op" id="4867914">[</span><span class="ident" id="4867915">typeId</span><span class="op" id="4867921">]</span><span class="ident" id="4867922">decOp</span><span class="op" id="4867927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867930">tBool</span><span class="op" id="4867935">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867940">ignoreUint</span><span class="op" id="4867950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867953">tInt</span><span class="op" id="4867957">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867963">ignoreUint</span><span class="op" id="4867973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867976">tUint</span><span class="op" id="4867981">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4867986">ignoreUint</span><span class="op" id="4867996">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867999">tFloat</span><span class="op" id="4868005">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4868009">ignoreUint</span><span class="op" id="4868019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868022">tBytes</span><span class="op" id="4868028">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4868032">ignoreUint8Array</span><span class="op" id="4868048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868051">tString</span><span class="op" id="4868058">:</span>&nbsp;&nbsp;<span class="ident" id="4868061">ignoreUint8Array</span><span class="op" id="4868077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868080">tComplex</span><span class="op" id="4868088">:</span>&nbsp;<span class="ident" id="4868090">ignoreTwoUints</span><span class="op" id="4868104">,</span><br>
<span class="lineno"></span><span class="op" id="4868106">}</span><br>
<span class="lineno">755</span><br>
<span class="lineno"></span><span class="comment" id="4868109">//&nbsp;decOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;the&nbsp;base&nbsp;type&nbsp;under&nbsp;rt&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4868176">//&nbsp;the&nbsp;indirection&nbsp;count&nbsp;to&nbsp;reach&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4868214">func</span>&nbsp;<span class="op" id="4868219">(</span><span class="ident" id="4868220">dec</span>&nbsp;<span class="op" id="4868224">*</span><span class="ident" id="4868225">Decoder</span><span class="op" id="4868232">)</span>&nbsp;<span class="ident" id="4868234">decOpFor</span><span class="op" id="4868242">(</span><span class="ident" id="4868243">wireId</span>&nbsp;<span class="ident" id="4868250">typeId</span><span class="op" id="4868256">,</span>&nbsp;<span class="ident" id="4868258">rt</span>&nbsp;<span class="ident" id="4868261">reflect</span><span class="op" id="4868268">.</span><span class="ident" id="4868269">Type</span><span class="op" id="4868273">,</span>&nbsp;<span class="ident" id="4868275">name</span>&nbsp;<span class="builtintype" id="4868280">string</span><span class="op" id="4868286">,</span>&nbsp;<span class="ident" id="4868288">inProgress</span>&nbsp;<span class="keyword" id="4868299">map</span><span class="op" id="4868302">[</span><span class="ident" id="4868303">reflect</span><span class="op" id="4868310">.</span><span class="ident" id="4868311">Type</span><span class="op" id="4868315">]</span><span class="op" id="4868316">*</span><span class="ident" id="4868317">decOp</span><span class="op" id="4868322">)</span>&nbsp;<span class="op" id="4868324">*</span><span class="ident" id="4868325">decOp</span>&nbsp;<span class="op" id="4868331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868334">ut</span>&nbsp;<span class="op" id="4868337">:=</span>&nbsp;<span class="ident" id="4868340">userType</span><span class="op" id="4868348">(</span><span class="ident" id="4868349">rt</span><span class="op" id="4868351">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868354">//&nbsp;If&nbsp;the&nbsp;type&nbsp;implements&nbsp;GobEncoder,&nbsp;we&nbsp;handle&nbsp;it&nbsp;without&nbsp;further&nbsp;processing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868434">if</span>&nbsp;<span class="ident" id="4868437">ut</span><span class="op" id="4868439">.</span><span class="ident" id="4868440">externalDec</span>&nbsp;<span class="op" id="4868452">!=</span>&nbsp;<span class="num" id="4868455">0</span>&nbsp;<span class="op" id="4868457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868461">return</span>&nbsp;<span class="ident" id="4868468">dec</span><span class="op" id="4868471">.</span><span class="ident" id="4868472">gobDecodeOpFor</span><span class="op" id="4868486">(</span><span class="ident" id="4868487">ut</span><span class="op" id="4868489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4868492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868496">//&nbsp;If&nbsp;this&nbsp;type&nbsp;is&nbsp;already&nbsp;in&nbsp;progress,&nbsp;it&#39;s&nbsp;a&nbsp;recursive&nbsp;type&nbsp;(e.g.&nbsp;map[string]*T).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868581">//&nbsp;Return&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;op&nbsp;we&#39;re&nbsp;already&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868638">if</span>&nbsp;<span class="ident" id="4868641">opPtr</span>&nbsp;<span class="op" id="4868647">:=</span>&nbsp;<span class="ident" id="4868650">inProgress</span><span class="op" id="4868660">[</span><span class="ident" id="4868661">rt</span><span class="op" id="4868663">]</span><span class="op" id="4868664">;</span>&nbsp;<span class="ident" id="4868666">opPtr</span>&nbsp;<span class="op" id="4868672">!=</span>&nbsp;<span class="ident" id="4868675">nil</span>&nbsp;<span class="op" id="4868679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868683">return</span>&nbsp;<span class="ident" id="4868690">opPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4868697">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868700">typ</span>&nbsp;<span class="op" id="4868704">:=</span>&nbsp;<span class="ident" id="4868707">ut</span><span class="op" id="4868709">.</span><span class="ident" id="4868710">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868716">var</span>&nbsp;<span class="ident" id="4868720">op</span>&nbsp;<span class="ident" id="4868723">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868730">k</span>&nbsp;<span class="op" id="4868732">:=</span>&nbsp;<span class="ident" id="4868735">typ</span><span class="op" id="4868738">.</span><span class="ident" id="4868739">Kind</span><span class="op" id="4868743">(</span><span class="op" id="4868744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868747">if</span>&nbsp;<span class="builtintype" id="4868750">int</span><span class="op" id="4868753">(</span><span class="ident" id="4868754">k</span><span class="op" id="4868755">)</span>&nbsp;<span class="op" id="4868757">&lt;</span>&nbsp;<span class="builtinfunc" id="4868759">len</span><span class="op" id="4868762">(</span><span class="ident" id="4868763">decOpTable</span><span class="op" id="4868773">)</span>&nbsp;<span class="op" id="4868775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868779">op</span>&nbsp;<span class="op" id="4868782">=</span>&nbsp;<span class="ident" id="4868784">decOpTable</span><span class="op" id="4868794">[</span><span class="ident" id="4868795">k</span><span class="op" id="4868796">]</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4868799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868802">if</span>&nbsp;<span class="ident" id="4868805">op</span>&nbsp;<span class="op" id="4868808">==</span>&nbsp;<span class="ident" id="4868811">nil</span>&nbsp;<span class="op" id="4868815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868819">inProgress</span><span class="op" id="4868829">[</span><span class="ident" id="4868830">rt</span><span class="op" id="4868832">]</span>&nbsp;<span class="op" id="4868834">=</span>&nbsp;<span class="op" id="4868836">&amp;</span><span class="ident" id="4868837">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868842">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868861">switch</span>&nbsp;<span class="ident" id="4868868">t</span>&nbsp;<span class="op" id="4868870">:=</span>&nbsp;<span class="ident" id="4868873">typ</span><span class="op" id="4868876">;</span>&nbsp;<span class="ident" id="4868878">t</span><span class="op" id="4868879">.</span><span class="ident" id="4868880">Kind</span><span class="op" id="4868884">(</span><span class="op" id="4868885">)</span>&nbsp;<span class="op" id="4868887">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868891">case</span>&nbsp;<span class="ident" id="4868896">reflect</span><span class="op" id="4868903">.</span><span class="ident" id="4868904">Array</span><span class="op" id="4868909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868914">name</span>&nbsp;<span class="op" id="4868919">=</span>&nbsp;<span class="string" id="4868921">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="4868935">+</span>&nbsp;<span class="ident" id="4868937">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868945">elemId</span>&nbsp;<span class="op" id="4868952">:=</span>&nbsp;<span class="ident" id="4868955">dec</span><span class="op" id="4868958">.</span><span class="ident" id="4868959">wireType</span><span class="op" id="4868967">[</span><span class="ident" id="4868968">wireId</span><span class="op" id="4868974">]</span><span class="op" id="4868975">.</span><span class="ident" id="4868976">ArrayT</span><span class="op" id="4868982">.</span><span class="ident" id="4868983">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868991">elemOp</span>&nbsp;<span class="op" id="4868998">:=</span>&nbsp;<span class="ident" id="4869001">dec</span><span class="op" id="4869004">.</span><span class="ident" id="4869005">decOpFor</span><span class="op" id="4869013">(</span><span class="ident" id="4869014">elemId</span><span class="op" id="4869020">,</span>&nbsp;<span class="ident" id="4869022">t</span><span class="op" id="4869023">.</span><span class="ident" id="4869024">Elem</span><span class="op" id="4869028">(</span><span class="op" id="4869029">)</span><span class="op" id="4869030">,</span>&nbsp;<span class="ident" id="4869032">name</span><span class="op" id="4869036">,</span>&nbsp;<span class="ident" id="4869038">inProgress</span><span class="op" id="4869048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869053">ovfl</span>&nbsp;<span class="op" id="4869058">:=</span>&nbsp;<span class="ident" id="4869061">overflow</span><span class="op" id="4869069">(</span><span class="ident" id="4869070">name</span><span class="op" id="4869074">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869079">helper</span>&nbsp;<span class="op" id="4869086">:=</span>&nbsp;<span class="ident" id="4869089">decArrayHelper</span><span class="op" id="4869103">[</span><span class="ident" id="4869104">t</span><span class="op" id="4869105">.</span><span class="ident" id="4869106">Elem</span><span class="op" id="4869110">(</span><span class="op" id="4869111">)</span><span class="op" id="4869112">.</span><span class="ident" id="4869113">Kind</span><span class="op" id="4869117">(</span><span class="op" id="4869118">)</span><span class="op" id="4869119">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869124">op</span>&nbsp;<span class="op" id="4869127">=</span>&nbsp;<span class="keyword" id="4869129">func</span><span class="op" id="4869133">(</span><span class="ident" id="4869134">i</span>&nbsp;<span class="op" id="4869136">*</span><span class="ident" id="4869137">decInstr</span><span class="op" id="4869145">,</span>&nbsp;<span class="ident" id="4869147">state</span>&nbsp;<span class="op" id="4869153">*</span><span class="ident" id="4869154">decoderState</span><span class="op" id="4869166">,</span>&nbsp;<span class="ident" id="4869168">value</span>&nbsp;<span class="ident" id="4869174">reflect</span><span class="op" id="4869181">.</span><span class="ident" id="4869182">Value</span><span class="op" id="4869187">)</span>&nbsp;<span class="op" id="4869189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869195">state</span><span class="op" id="4869200">.</span><span class="ident" id="4869201">dec</span><span class="op" id="4869204">.</span><span class="ident" id="4869205">decodeArray</span><span class="op" id="4869216">(</span><span class="ident" id="4869217">t</span><span class="op" id="4869218">,</span>&nbsp;<span class="ident" id="4869220">state</span><span class="op" id="4869225">,</span>&nbsp;<span class="ident" id="4869227">value</span><span class="op" id="4869232">,</span>&nbsp;<span class="op" id="4869234">*</span><span class="ident" id="4869235">elemOp</span><span class="op" id="4869241">,</span>&nbsp;<span class="ident" id="4869243">t</span><span class="op" id="4869244">.</span><span class="ident" id="4869245">Len</span><span class="op" id="4869248">(</span><span class="op" id="4869249">)</span><span class="op" id="4869250">,</span>&nbsp;<span class="ident" id="4869252">ovfl</span><span class="op" id="4869256">,</span>&nbsp;<span class="ident" id="4869258">helper</span><span class="op" id="4869264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4869269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4869274">case</span>&nbsp;<span class="ident" id="4869279">reflect</span><span class="op" id="4869286">.</span><span class="ident" id="4869287">Map</span><span class="op" id="4869290">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869295">keyId</span>&nbsp;<span class="op" id="4869301">:=</span>&nbsp;<span class="ident" id="4869304">dec</span><span class="op" id="4869307">.</span><span class="ident" id="4869308">wireType</span><span class="op" id="4869316">[</span><span class="ident" id="4869317">wireId</span><span class="op" id="4869323">]</span><span class="op" id="4869324">.</span><span class="ident" id="4869325">MapT</span><span class="op" id="4869329">.</span><span class="ident" id="4869330">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869337">elemId</span>&nbsp;<span class="op" id="4869344">:=</span>&nbsp;<span class="ident" id="4869347">dec</span><span class="op" id="4869350">.</span><span class="ident" id="4869351">wireType</span><span class="op" id="4869359">[</span><span class="ident" id="4869360">wireId</span><span class="op" id="4869366">]</span><span class="op" id="4869367">.</span><span class="ident" id="4869368">MapT</span><span class="op" id="4869372">.</span><span class="ident" id="4869373">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869381">keyOp</span>&nbsp;<span class="op" id="4869387">:=</span>&nbsp;<span class="ident" id="4869390">dec</span><span class="op" id="4869393">.</span><span class="ident" id="4869394">decOpFor</span><span class="op" id="4869402">(</span><span class="ident" id="4869403">keyId</span><span class="op" id="4869408">,</span>&nbsp;<span class="ident" id="4869410">t</span><span class="op" id="4869411">.</span><span class="ident" id="4869412">Key</span><span class="op" id="4869415">(</span><span class="op" id="4869416">)</span><span class="op" id="4869417">,</span>&nbsp;<span class="string" id="4869419">&#34;key&nbsp;of&nbsp;&#34;</span><span class="op" id="4869428">+</span><span class="ident" id="4869429">name</span><span class="op" id="4869433">,</span>&nbsp;<span class="ident" id="4869435">inProgress</span><span class="op" id="4869445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869450">elemOp</span>&nbsp;<span class="op" id="4869457">:=</span>&nbsp;<span class="ident" id="4869460">dec</span><span class="op" id="4869463">.</span><span class="ident" id="4869464">decOpFor</span><span class="op" id="4869472">(</span><span class="ident" id="4869473">elemId</span><span class="op" id="4869479">,</span>&nbsp;<span class="ident" id="4869481">t</span><span class="op" id="4869482">.</span><span class="ident" id="4869483">Elem</span><span class="op" id="4869487">(</span><span class="op" id="4869488">)</span><span class="op" id="4869489">,</span>&nbsp;<span class="string" id="4869491">&#34;element&nbsp;of&nbsp;&#34;</span><span class="op" id="4869504">+</span><span class="ident" id="4869505">name</span><span class="op" id="4869509">,</span>&nbsp;<span class="ident" id="4869511">inProgress</span><span class="op" id="4869521">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869526">ovfl</span>&nbsp;<span class="op" id="4869531">:=</span>&nbsp;<span class="ident" id="4869534">overflow</span><span class="op" id="4869542">(</span><span class="ident" id="4869543">name</span><span class="op" id="4869547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869552">op</span>&nbsp;<span class="op" id="4869555">=</span>&nbsp;<span class="keyword" id="4869557">func</span><span class="op" id="4869561">(</span><span class="ident" id="4869562">i</span>&nbsp;<span class="op" id="4869564">*</span><span class="ident" id="4869565">decInstr</span><span class="op" id="4869573">,</span>&nbsp;<span class="ident" id="4869575">state</span>&nbsp;<span class="op" id="4869581">*</span><span class="ident" id="4869582">decoderState</span><span class="op" id="4869594">,</span>&nbsp;<span class="ident" id="4869596">value</span>&nbsp;<span class="ident" id="4869602">reflect</span><span class="op" id="4869609">.</span><span class="ident" id="4869610">Value</span><span class="op" id="4869615">)</span>&nbsp;<span class="op" id="4869617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869623">state</span><span class="op" id="4869628">.</span><span class="ident" id="4869629">dec</span><span class="op" id="4869632">.</span><span class="ident" id="4869633">decodeMap</span><span class="op" id="4869642">(</span><span class="ident" id="4869643">t</span><span class="op" id="4869644">,</span>&nbsp;<span class="ident" id="4869646">state</span><span class="op" id="4869651">,</span>&nbsp;<span class="ident" id="4869653">value</span><span class="op" id="4869658">,</span>&nbsp;<span class="op" id="4869660">*</span><span class="ident" id="4869661">keyOp</span><span class="op" id="4869666">,</span>&nbsp;<span class="op" id="4869668">*</span><span class="ident" id="4869669">elemOp</span><span class="op" id="4869675">,</span>&nbsp;<span class="ident" id="4869677">ovfl</span><span class="op" id="4869681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4869686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4869691">case</span>&nbsp;<span class="ident" id="4869696">reflect</span><span class="op" id="4869703">.</span><span class="ident" id="4869704">Slice</span><span class="op" id="4869709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869714">name</span>&nbsp;<span class="op" id="4869719">=</span>&nbsp;<span class="string" id="4869721">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="4869735">+</span>&nbsp;<span class="ident" id="4869737">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4869745">if</span>&nbsp;<span class="ident" id="4869748">t</span><span class="op" id="4869749">.</span><span class="ident" id="4869750">Elem</span><span class="op" id="4869754">(</span><span class="op" id="4869755">)</span><span class="op" id="4869756">.</span><span class="ident" id="4869757">Kind</span><span class="op" id="4869761">(</span><span class="op" id="4869762">)</span>&nbsp;<span class="op" id="4869764">==</span>&nbsp;<span class="ident" id="4869767">reflect</span><span class="op" id="4869774">.</span><span class="ident" id="4869775">Uint8</span>&nbsp;<span class="op" id="4869781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869787">op</span>&nbsp;<span class="op" id="4869790">=</span>&nbsp;<span class="ident" id="4869792">decUint8Slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4869810">break</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4869819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4869824">var</span>&nbsp;<span class="ident" id="4869828">elemId</span>&nbsp;<span class="ident" id="4869835">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4869845">if</span>&nbsp;<span class="ident" id="4869848">tt</span><span class="op" id="4869850">,</span>&nbsp;<span class="ident" id="4869852">ok</span>&nbsp;<span class="op" id="4869855">:=</span>&nbsp;<span class="ident" id="4869858">builtinIdToType</span><span class="op" id="4869873">[</span><span class="ident" id="4869874">wireId</span><span class="op" id="4869880">]</span><span class="op" id="4869881">;</span>&nbsp;<span class="ident" id="4869883">ok</span>&nbsp;<span class="op" id="4869886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869892">elemId</span>&nbsp;<span class="op" id="4869899">=</span>&nbsp;<span class="ident" id="4869901">tt</span><span class="op" id="4869903">.</span><span class="op" id="4869904">(</span><span class="op" id="4869905">*</span><span class="ident" id="4869906">sliceType</span><span class="op" id="4869915">)</span><span class="op" id="4869916">.</span><span class="ident" id="4869917">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4869925">}</span>&nbsp;<span class="keyword" id="4869927">else</span>&nbsp;<span class="op" id="4869932">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869938">elemId</span>&nbsp;<span class="op" id="4869945">=</span>&nbsp;<span class="ident" id="4869947">dec</span><span class="op" id="4869950">.</span><span class="ident" id="4869951">wireType</span><span class="op" id="4869959">[</span><span class="ident" id="4869960">wireId</span><span class="op" id="4869966">]</span><span class="op" id="4869967">.</span><span class="ident" id="4869968">SliceT</span><span class="op" id="4869974">.</span><span class="ident" id="4869975">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4869983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869988">elemOp</span>&nbsp;<span class="op" id="4869995">:=</span>&nbsp;<span class="ident" id="4869998">dec</span><span class="op" id="4870001">.</span><span class="ident" id="4870002">decOpFor</span><span class="op" id="4870010">(</span><span class="ident" id="4870011">elemId</span><span class="op" id="4870017">,</span>&nbsp;<span class="ident" id="4870019">t</span><span class="op" id="4870020">.</span><span class="ident" id="4870021">Elem</span><span class="op" id="4870025">(</span><span class="op" id="4870026">)</span><span class="op" id="4870027">,</span>&nbsp;<span class="ident" id="4870029">name</span><span class="op" id="4870033">,</span>&nbsp;<span class="ident" id="4870035">inProgress</span><span class="op" id="4870045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4870050">ovfl</span>&nbsp;<span class="op" id="4870055">:=</span>&nbsp;<span class="ident" id="4870058">overflow</span><span class="op" id="4870066">(</span><span class="ident" id="4870067">name</span><span class="op" id="4870071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4870076">helper</span>&nbsp;<span class="op" id="4870083">:=</span>&nbsp;<span class="ident" id="4870086">decSliceHelper</span><span class="op" id="4870100">[</span><span class="ident" id="4870101">t</span><span class="op" id="4870102">.</span><span class="ident" id="4870103">Elem</span><span class="op" id="4870107">(</span><span class="op" id="4870108">)</span><span class="op" id="4870109">.</span><span class="ident" id="4870110">Kind</span><span class="op" id="4870114">(</span><span class="op" id="4870115">)</span><span class="op" id="4870116">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4870121">op</span>&nbsp;<span class="op" id="4870124">=</span>&nbsp;<span class="keyword" id="4870126">func</span><span class="op" id="4870130">(</span><span class="ident" id="4870131">i</span>&nbsp;<span class="op" id="4870133">*</span><span class="ident" id="4870134">decInstr</span><span class="op" id="4870142">,</span>&nbsp;<span class="ident" id="4870144">state</span>&nbsp;<span class="op" id="4870150">*</span><span class="ident" id="4870151">decoderState</span><span class="op" id="4870163">,</span>&nbsp;<span class="ident" id="4870165">value</span>&nbsp;<span class="ident" id="4870171">reflect</span><span class="op" id="4870178">.</span><span class="ident" id="4870179">Value</span><span class="op" id="4870184">)</span>&nbsp;<span class="op" id="4870186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4870192">state</span><span class="op" id="4870197">.</span><span class="ident" id="4870198">dec</span><span class="op" id="4870201">.</span><span class="ident" id="4870202">decodeSlice</span><span class="op" id="4870213">(</span><span class="ident" id="4870214">state</span><span class="op" id="4870219">,</span>&nbsp;<span class="ident" id="4870221">value</span><span class="op" id="4870226">,</span>&nbsp;<span class="op" id="4870228">*</span><span class="ident" id="4870229">elemOp</span><span class="op" id="4870235">,</span>&nbsp;<span class="ident" id="4870237">ovfl</span><span class="op" id="4870241">,</span>&nbsp;<span class="ident" id="4870243">helper</span><span class="op" id="4870249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4870254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4870259">case</span>&nbsp;<span class="ident" id="4870264">reflect</span><span class="op" id="4870271">.</span><span class="ident" id="4870272">Struct</span><span class="op" id="4870278">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4870283">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4870358">ut</span>&nbsp;<span class="op" id="4870361">:=</span>&nbsp;<span class="ident" id="4870364">userType</span><span class="op" id="4870372">(</span><span class="ident" id="4870373">typ</span><span class="op" id="4870376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4870381">enginePtr</span><span class="op" id="4870390">,</span>&nbsp;<span class="ident" id="4870392">err</span>&nbsp;<span class="op" id="4870396">:=</span>&nbsp;<span class="ident" id="4870399">dec</span><span class="op" id="4870402">.</span><span class="ident" id="4870403">getDecEnginePtr</span><span class="op" id="4870418">(</span><span class="ident" id="4870419">wireId</span><span class="op" id="4870425">,</span>&nbsp;<span class="ident" id="4870427">ut</span><span class="op" id="4870429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4870434">if</span>&nbsp;<span class="ident" id="4870437">err</span>&nbsp;<span class="op" id="4870441">!=</span>&nbsp;<span class="ident" id="4870444">nil</span>&nbsp;<span class="op" id="4870448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4870454">error_</span><span class="op" id="4870460">(</span><span class="ident" id="4870461">err</span><span class="op" id="4870464">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4870469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4870474">op</span>&nbsp;<span class="op" id="4870477">=</span>&nbsp;<span class="keyword" id="4870479">func</span><span class="op" id="4870483">(</span><span class="ident" id="4870484">i</span>&nbsp;<span class="op" id="4870486">*</span><span class="ident" id="4870487">decInstr</span><span class="op" id="4870495">,</span>&nbsp;<span class="ident" id="4870497">state</span>&nbsp;<span class="op" id="4870503">*</span><span class="ident" id="4870504">decoderState</span><span class="op" id="4870516">,</span>&nbsp;<span class="ident" id="4870518">value</span>&nbsp;<span class="ident" id="4870524">reflect</span><span class="op" id="4870531">.</span><span class="ident" id="4870532">Value</span><span class="op" id="4870537">)</span>&nbsp;<span class="op" id="4870539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4870545">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4870622">dec</span><span class="op" id="4870625">.</span><span class="ident" id="4870626">decodeStruct</span><span class="op" id="4870638">(</span><span class="op" id="4870639">*</span><span class="ident" id="4870640">enginePtr</span><span class="op" id="4870649">,</span>&nbsp;<span class="ident" id="4870651">ut</span><span class="op" id="4870653">,</span>&nbsp;<span class="ident" id="4870655">value</span><span class="op" id="4870660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4870665">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4870669">case</span>&nbsp;<span class="ident" id="4870674">reflect</span><span class="op" id="4870681">.</span><span class="ident" id="4870682">Interface</span><span class="op" id="4870691">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4870696">op</span>&nbsp;<span class="op" id="4870699">=</span>&nbsp;<span class="keyword" id="4870701">func</span><span class="op" id="4870705">(</span><span class="ident" id="4870706">i</span>&nbsp;<span class="op" id="4870708">*</span><span class="ident" id="4870709">decInstr</span><span class="op" id="4870717">,</span>&nbsp;<span class="ident" id="4870719">state</span>&nbsp;<span class="op" id="4870725">*</span><span class="ident" id="4870726">decoderState</span><span class="op" id="4870738">,</span>&nbsp;<span class="ident" id="4870740">value</span>&nbsp;<span class="ident" id="4870746">reflect</span><span class="op" id="4870753">.</span><span class="ident" id="4870754">Value</span><span class="op" id="4870759">)</span>&nbsp;<span class="op" id="4870761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4870767">state</span><span class="op" id="4870772">.</span><span class="ident" id="4870773">dec</span><span class="op" id="4870776">.</span><span class="ident" id="4870777">decodeInterface</span><span class="op" id="4870792">(</span><span class="ident" id="4870793">t</span><span class="op" id="4870794">,</span>&nbsp;<span class="ident" id="4870796">state</span><span class="op" id="4870801">,</span>&nbsp;<span class="ident" id="4870803">value</span><span class="op" id="4870808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4870813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4870817">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4870820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4870823">if</span>&nbsp;<span class="ident" id="4870826">op</span>&nbsp;<span class="op" id="4870829">==</span>&nbsp;<span class="ident" id="4870832">nil</span>&nbsp;<span class="op" id="4870836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4870840">errorf</span><span class="op" id="4870846">(</span><span class="string" id="4870847">&#34;decode&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4870876">,</span>&nbsp;<span class="ident" id="4870878">rt</span><span class="op" id="4870880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4870883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4870886">return</span>&nbsp;<span class="op" id="4870893">&amp;</span><span class="ident" id="4870894">op</span><br>
<span class="lineno">840</span><span class="op" id="4870897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4870900">//&nbsp;decIgnoreOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;a&nbsp;field&nbsp;that&nbsp;has&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4870979">func</span>&nbsp;<span class="op" id="4870984">(</span><span class="ident" id="4870985">dec</span>&nbsp;<span class="op" id="4870989">*</span><span class="ident" id="4870990">Decoder</span><span class="op" id="4870997">)</span>&nbsp;<span class="ident" id="4870999">decIgnoreOpFor</span><span class="op" id="4871013">(</span><span class="ident" id="4871014">wireId</span>&nbsp;<span class="ident" id="4871021">typeId</span><span class="op" id="4871027">)</span>&nbsp;<span class="ident" id="4871029">decOp</span>&nbsp;<span class="op" id="4871035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871038">op</span><span class="op" id="4871040">,</span>&nbsp;<span class="ident" id="4871042">ok</span>&nbsp;<span class="op" id="4871045">:=</span>&nbsp;<span class="ident" id="4871048">decIgnoreOpMap</span><span class="op" id="4871062">[</span><span class="ident" id="4871063">wireId</span><span class="op" id="4871069">]</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4871072">if</span>&nbsp;<span class="op" id="4871075">!</span><span class="ident" id="4871076">ok</span>&nbsp;<span class="op" id="4871079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4871083">if</span>&nbsp;<span class="ident" id="4871086">wireId</span>&nbsp;<span class="op" id="4871093">==</span>&nbsp;<span class="ident" id="4871096">tInterface</span>&nbsp;<span class="op" id="4871107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4871112">//&nbsp;Special&nbsp;case&nbsp;because&nbsp;it&#39;s&nbsp;a&nbsp;method:&nbsp;the&nbsp;ignored&nbsp;item&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4871177">//&nbsp;define&nbsp;types&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;record&nbsp;their&nbsp;state&nbsp;in&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871246">op</span>&nbsp;<span class="op" id="4871249">=</span>&nbsp;<span class="keyword" id="4871251">func</span><span class="op" id="4871255">(</span><span class="ident" id="4871256">i</span>&nbsp;<span class="op" id="4871258">*</span><span class="ident" id="4871259">decInstr</span><span class="op" id="4871267">,</span>&nbsp;<span class="ident" id="4871269">state</span>&nbsp;<span class="op" id="4871275">*</span><span class="ident" id="4871276">decoderState</span><span class="op" id="4871288">,</span>&nbsp;<span class="ident" id="4871290">value</span>&nbsp;<span class="ident" id="4871296">reflect</span><span class="op" id="4871303">.</span><span class="ident" id="4871304">Value</span><span class="op" id="4871309">)</span>&nbsp;<span class="op" id="4871311">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871317">state</span><span class="op" id="4871322">.</span><span class="ident" id="4871323">dec</span><span class="op" id="4871326">.</span><span class="ident" id="4871327">ignoreInterface</span><span class="op" id="4871342">(</span><span class="ident" id="4871343">state</span><span class="op" id="4871348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4871353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4871358">return</span>&nbsp;<span class="ident" id="4871365">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4871370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4871374">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871393">wire</span>&nbsp;<span class="op" id="4871398">:=</span>&nbsp;<span class="ident" id="4871401">dec</span><span class="op" id="4871404">.</span><span class="ident" id="4871405">wireType</span><span class="op" id="4871413">[</span><span class="ident" id="4871414">wireId</span><span class="op" id="4871420">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4871424">switch</span>&nbsp;<span class="op" id="4871431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4871435">case</span>&nbsp;<span class="ident" id="4871440">wire</span>&nbsp;<span class="op" id="4871445">==</span>&nbsp;<span class="ident" id="4871448">nil</span><span class="op" id="4871451">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871456">errorf</span><span class="op" id="4871462">(</span><span class="string" id="4871463">&#34;bad&nbsp;data:&nbsp;undefined&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4871492">,</span>&nbsp;<span class="ident" id="4871494">wireId</span><span class="op" id="4871500">.</span><span class="builtintype" id="4871501">string</span><span class="op" id="4871507">(</span><span class="op" id="4871508">)</span><span class="op" id="4871509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4871513">case</span>&nbsp;<span class="ident" id="4871518">wire</span><span class="op" id="4871522">.</span><span class="ident" id="4871523">ArrayT</span>&nbsp;<span class="op" id="4871530">!=</span>&nbsp;<span class="ident" id="4871533">nil</span><span class="op" id="4871536">:</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871541">elemId</span>&nbsp;<span class="op" id="4871548">:=</span>&nbsp;<span class="ident" id="4871551">wire</span><span class="op" id="4871555">.</span><span class="ident" id="4871556">ArrayT</span><span class="op" id="4871562">.</span><span class="ident" id="4871563">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871571">elemOp</span>&nbsp;<span class="op" id="4871578">:=</span>&nbsp;<span class="ident" id="4871581">dec</span><span class="op" id="4871584">.</span><span class="ident" id="4871585">decIgnoreOpFor</span><span class="op" id="4871599">(</span><span class="ident" id="4871600">elemId</span><span class="op" id="4871606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871611">op</span>&nbsp;<span class="op" id="4871614">=</span>&nbsp;<span class="keyword" id="4871616">func</span><span class="op" id="4871620">(</span><span class="ident" id="4871621">i</span>&nbsp;<span class="op" id="4871623">*</span><span class="ident" id="4871624">decInstr</span><span class="op" id="4871632">,</span>&nbsp;<span class="ident" id="4871634">state</span>&nbsp;<span class="op" id="4871640">*</span><span class="ident" id="4871641">decoderState</span><span class="op" id="4871653">,</span>&nbsp;<span class="ident" id="4871655">value</span>&nbsp;<span class="ident" id="4871661">reflect</span><span class="op" id="4871668">.</span><span class="ident" id="4871669">Value</span><span class="op" id="4871674">)</span>&nbsp;<span class="op" id="4871676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871682">state</span><span class="op" id="4871687">.</span><span class="ident" id="4871688">dec</span><span class="op" id="4871691">.</span><span class="ident" id="4871692">ignoreArray</span><span class="op" id="4871703">(</span><span class="ident" id="4871704">state</span><span class="op" id="4871709">,</span>&nbsp;<span class="ident" id="4871711">elemOp</span><span class="op" id="4871717">,</span>&nbsp;<span class="ident" id="4871719">wire</span><span class="op" id="4871723">.</span><span class="ident" id="4871724">ArrayT</span><span class="op" id="4871730">.</span><span class="ident" id="4871731">Len</span><span class="op" id="4871734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4871739">}</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4871744">case</span>&nbsp;<span class="ident" id="4871749">wire</span><span class="op" id="4871753">.</span><span class="ident" id="4871754">MapT</span>&nbsp;<span class="op" id="4871759">!=</span>&nbsp;<span class="ident" id="4871762">nil</span><span class="op" id="4871765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871770">keyId</span>&nbsp;<span class="op" id="4871776">:=</span>&nbsp;<span class="ident" id="4871779">dec</span><span class="op" id="4871782">.</span><span class="ident" id="4871783">wireType</span><span class="op" id="4871791">[</span><span class="ident" id="4871792">wireId</span><span class="op" id="4871798">]</span><span class="op" id="4871799">.</span><span class="ident" id="4871800">MapT</span><span class="op" id="4871804">.</span><span class="ident" id="4871805">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871812">elemId</span>&nbsp;<span class="op" id="4871819">:=</span>&nbsp;<span class="ident" id="4871822">dec</span><span class="op" id="4871825">.</span><span class="ident" id="4871826">wireType</span><span class="op" id="4871834">[</span><span class="ident" id="4871835">wireId</span><span class="op" id="4871841">]</span><span class="op" id="4871842">.</span><span class="ident" id="4871843">MapT</span><span class="op" id="4871847">.</span><span class="ident" id="4871848">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871856">keyOp</span>&nbsp;<span class="op" id="4871862">:=</span>&nbsp;<span class="ident" id="4871865">dec</span><span class="op" id="4871868">.</span><span class="ident" id="4871869">decIgnoreOpFor</span><span class="op" id="4871883">(</span><span class="ident" id="4871884">keyId</span><span class="op" id="4871889">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871894">elemOp</span>&nbsp;<span class="op" id="4871901">:=</span>&nbsp;<span class="ident" id="4871904">dec</span><span class="op" id="4871907">.</span><span class="ident" id="4871908">decIgnoreOpFor</span><span class="op" id="4871922">(</span><span class="ident" id="4871923">elemId</span><span class="op" id="4871929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4871934">op</span>&nbsp;<span class="op" id="4871937">=</span>&nbsp;<span class="keyword" id="4871939">func</span><span class="op" id="4871943">(</span><span class="ident" id="4871944">i</span>&nbsp;<span class="op" id="4871946">*</span><span class="ident" id="4871947">decInstr</span><span class="op" id="4871955">,</span>&nbsp;<span class="ident" id="4871957">state</span>&nbsp;<span class="op" id="4871963">*</span><span class="ident" id="4871964">decoderState</span><span class="op" id="4871976">,</span>&nbsp;<span class="ident" id="4871978">value</span>&nbsp;<span class="ident" id="4871984">reflect</span><span class="op" id="4871991">.</span><span class="ident" id="4871992">Value</span><span class="op" id="4871997">)</span>&nbsp;<span class="op" id="4871999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4872005">state</span><span class="op" id="4872010">.</span><span class="ident" id="4872011">dec</span><span class="op" id="4872014">.</span><span class="ident" id="4872015">ignoreMap</span><span class="op" id="4872024">(</span><span class="ident" id="4872025">state</span><span class="op" id="4872030">,</span>&nbsp;<span class="ident" id="4872032">keyOp</span><span class="op" id="4872037">,</span>&nbsp;<span class="ident" id="4872039">elemOp</span><span class="op" id="4872045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4872050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4872055">case</span>&nbsp;<span class="ident" id="4872060">wire</span><span class="op" id="4872064">.</span><span class="ident" id="4872065">SliceT</span>&nbsp;<span class="op" id="4872072">!=</span>&nbsp;<span class="ident" id="4872075">nil</span><span class="op" id="4872078">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4872083">elemId</span>&nbsp;<span class="op" id="4872090">:=</span>&nbsp;<span class="ident" id="4872093">wire</span><span class="op" id="4872097">.</span><span class="ident" id="4872098">SliceT</span><span class="op" id="4872104">.</span><span class="ident" id="4872105">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4872113">elemOp</span>&nbsp;<span class="op" id="4872120">:=</span>&nbsp;<span class="ident" id="4872123">dec</span><span class="op" id="4872126">.</span><span class="ident" id="4872127">decIgnoreOpFor</span><span class="op" id="4872141">(</span><span class="ident" id="4872142">elemId</span><span class="op" id="4872148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4872153">op</span>&nbsp;<span class="op" id="4872156">=</span>&nbsp;<span class="keyword" id="4872158">func</span><span class="op" id="4872162">(</span><span class="ident" id="4872163">i</span>&nbsp;<span class="op" id="4872165">*</span><span class="ident" id="4872166">decInstr</span><span class="op" id="4872174">,</span>&nbsp;<span class="ident" id="4872176">state</span>&nbsp;<span class="op" id="4872182">*</span><span class="ident" id="4872183">decoderState</span><span class="op" id="4872195">,</span>&nbsp;<span class="ident" id="4872197">value</span>&nbsp;<span class="ident" id="4872203">reflect</span><span class="op" id="4872210">.</span><span class="ident" id="4872211">Value</span><span class="op" id="4872216">)</span>&nbsp;<span class="op" id="4872218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4872224">state</span><span class="op" id="4872229">.</span><span class="ident" id="4872230">dec</span><span class="op" id="4872233">.</span><span class="ident" id="4872234">ignoreSlice</span><span class="op" id="4872245">(</span><span class="ident" id="4872246">state</span><span class="op" id="4872251">,</span>&nbsp;<span class="ident" id="4872253">elemOp</span><span class="op" id="4872259">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4872264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4872269">case</span>&nbsp;<span class="ident" id="4872274">wire</span><span class="op" id="4872278">.</span><span class="ident" id="4872279">StructT</span>&nbsp;<span class="op" id="4872287">!=</span>&nbsp;<span class="ident" id="4872290">nil</span><span class="op" id="4872293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4872298">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4872373">enginePtr</span><span class="op" id="4872382">,</span>&nbsp;<span class="ident" id="4872384">err</span>&nbsp;<span class="op" id="4872388">:=</span>&nbsp;<span class="ident" id="4872391">dec</span><span class="op" id="4872394">.</span><span class="ident" id="4872395">getIgnoreEnginePtr</span><span class="op" id="4872413">(</span><span class="ident" id="4872414">wireId</span><span class="op" id="4872420">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4872425">if</span>&nbsp;<span class="ident" id="4872428">err</span>&nbsp;<span class="op" id="4872432">!=</span>&nbsp;<span class="ident" id="4872435">nil</span>&nbsp;<span class="op" id="4872439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4872445">error_</span><span class="op" id="4872451">(</span><span class="ident" id="4872452">err</span><span class="op" id="4872455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4872460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4872465">op</span>&nbsp;<span class="op" id="4872468">=</span>&nbsp;<span class="keyword" id="4872470">func</span><span class="op" id="4872474">(</span><span class="ident" id="4872475">i</span>&nbsp;<span class="op" id="4872477">*</span><span class="ident" id="4872478">decInstr</span><span class="op" id="4872486">,</span>&nbsp;<span class="ident" id="4872488">state</span>&nbsp;<span class="op" id="4872494">*</span><span class="ident" id="4872495">decoderState</span><span class="op" id="4872507">,</span>&nbsp;<span class="ident" id="4872509">value</span>&nbsp;<span class="ident" id="4872515">reflect</span><span class="op" id="4872522">.</span><span class="ident" id="4872523">Value</span><span class="op" id="4872528">)</span>&nbsp;<span class="op" id="4872530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4872536">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4872612">state</span><span class="op" id="4872617">.</span><span class="ident" id="4872618">dec</span><span class="op" id="4872621">.</span><span class="ident" id="4872622">ignoreStruct</span><span class="op" id="4872634">(</span><span class="op" id="4872635">*</span><span class="ident" id="4872636">enginePtr</span><span class="op" id="4872645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4872650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4872655">case</span>&nbsp;<span class="ident" id="4872660">wire</span><span class="op" id="4872664">.</span><span class="ident" id="4872665">GobEncoderT</span>&nbsp;<span class="op" id="4872677">!=</span>&nbsp;<span class="ident" id="4872680">nil</span><span class="op" id="4872683">,</span>&nbsp;<span class="ident" id="4872685">wire</span><span class="op" id="4872689">.</span><span class="ident" id="4872690">BinaryMarshalerT</span>&nbsp;<span class="op" id="4872707">!=</span>&nbsp;<span class="ident" id="4872710">nil</span><span class="op" id="4872713">,</span>&nbsp;<span class="ident" id="4872715">wire</span><span class="op" id="4872719">.</span><span class="ident" id="4872720">TextMarshalerT</span>&nbsp;<span class="op" id="4872735">!=</span>&nbsp;<span class="ident" id="4872738">nil</span><span class="op" id="4872741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4872746">op</span>&nbsp;<span class="op" id="4872749">=</span>&nbsp;<span class="keyword" id="4872751">func</span><span class="op" id="4872755">(</span><span class="ident" id="4872756">i</span>&nbsp;<span class="op" id="4872758">*</span><span class="ident" id="4872759">decInstr</span><span class="op" id="4872767">,</span>&nbsp;<span class="ident" id="4872769">state</span>&nbsp;<span class="op" id="4872775">*</span><span class="ident" id="4872776">decoderState</span><span class="op" id="4872788">,</span>&nbsp;<span class="ident" id="4872790">value</span>&nbsp;<span class="ident" id="4872796">reflect</span><span class="op" id="4872803">.</span><span class="ident" id="4872804">Value</span><span class="op" id="4872809">)</span>&nbsp;<span class="op" id="4872811">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4872817">state</span><span class="op" id="4872822">.</span><span class="ident" id="4872823">dec</span><span class="op" id="4872826">.</span><span class="ident" id="4872827">ignoreGobDecoder</span><span class="op" id="4872843">(</span><span class="ident" id="4872844">state</span><span class="op" id="4872849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4872854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4872858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4872861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4872864">if</span>&nbsp;<span class="ident" id="4872867">op</span>&nbsp;<span class="op" id="4872870">==</span>&nbsp;<span class="ident" id="4872873">nil</span>&nbsp;<span class="op" id="4872877">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4872881">errorf</span><span class="op" id="4872887">(</span><span class="string" id="4872888">&#34;bad&nbsp;data:&nbsp;ignore&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4872927">,</span>&nbsp;<span class="ident" id="4872929">wireId</span><span class="op" id="4872935">.</span><span class="builtintype" id="4872936">string</span><span class="op" id="4872942">(</span><span class="op" id="4872943">)</span><span class="op" id="4872944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4872947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4872950">return</span>&nbsp;<span class="ident" id="4872957">op</span><br>
<span class="lineno"></span><span class="op" id="4872960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="4872963">//&nbsp;gobDecodeOpFor&nbsp;returns&nbsp;the&nbsp;op&nbsp;for&nbsp;a&nbsp;type&nbsp;that&nbsp;is&nbsp;known&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="4873034">//&nbsp;GobDecoder.</span><br>
<span class="lineno"></span><span class="keyword" id="4873049">func</span>&nbsp;<span class="op" id="4873054">(</span><span class="ident" id="4873055">dec</span>&nbsp;<span class="op" id="4873059">*</span><span class="ident" id="4873060">Decoder</span><span class="op" id="4873067">)</span>&nbsp;<span class="ident" id="4873069">gobDecodeOpFor</span><span class="op" id="4873083">(</span><span class="ident" id="4873084">ut</span>&nbsp;<span class="op" id="4873087">*</span><span class="ident" id="4873088">userTypeInfo</span><span class="op" id="4873100">)</span>&nbsp;<span class="op" id="4873102">*</span><span class="ident" id="4873103">decOp</span>&nbsp;<span class="op" id="4873109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4873112">rcvrType</span>&nbsp;<span class="op" id="4873121">:=</span>&nbsp;<span class="ident" id="4873124">ut</span><span class="op" id="4873126">.</span><span class="ident" id="4873127">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4873133">if</span>&nbsp;<span class="ident" id="4873136">ut</span><span class="op" id="4873138">.</span><span class="ident" id="4873139">decIndir</span>&nbsp;<span class="op" id="4873148">==</span>&nbsp;<span class="op" id="4873151">-</span><span class="num" id="4873152">1</span>&nbsp;<span class="op" id="4873154">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4873158">rcvrType</span>&nbsp;<span class="op" id="4873167">=</span>&nbsp;<span class="ident" id="4873169">reflect</span><span class="op" id="4873176">.</span><span class="ident" id="4873177">PtrTo</span><span class="op" id="4873182">(</span><span class="ident" id="4873183">rcvrType</span><span class="op" id="4873191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4873194">}</span>&nbsp;<span class="keyword" id="4873196">else</span>&nbsp;<span class="keyword" id="4873201">if</span>&nbsp;<span class="ident" id="4873204">ut</span><span class="op" id="4873206">.</span><span class="ident" id="4873207">decIndir</span>&nbsp;<span class="op" id="4873216">&gt;</span>&nbsp;<span class="num" id="4873218">0</span>&nbsp;<span class="op" id="4873220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4873224">for</span>&nbsp;<span class="ident" id="4873228">i</span>&nbsp;<span class="op" id="4873230">:=</span>&nbsp;<span class="builtintype" id="4873233">int8</span><span class="op" id="4873237">(</span><span class="num" id="4873238">0</span><span class="op" id="4873239">)</span><span class="op" id="4873240">;</span>&nbsp;<span class="ident" id="4873242">i</span>&nbsp;<span class="op" id="4873244">&lt;</span>&nbsp;<span class="ident" id="4873246">ut</span><span class="op" id="4873248">.</span><span class="ident" id="4873249">decIndir</span><span class="op" id="4873257">;</span>&nbsp;<span class="ident" id="4873259">i</span><span class="op" id="4873260">++</span>&nbsp;<span class="op" id="4873263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4873268">rcvrType</span>&nbsp;<span class="op" id="4873277">=</span>&nbsp;<span class="ident" id="4873279">rcvrType</span><span class="op" id="4873287">.</span><span class="ident" id="4873288">Elem</span><span class="op" id="4873292">(</span><span class="op" id="4873293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4873297">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4873300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4873303">var</span>&nbsp;<span class="ident" id="4873307">op</span>&nbsp;<span class="ident" id="4873310">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4873317">op</span>&nbsp;<span class="op" id="4873320">=</span>&nbsp;<span class="keyword" id="4873322">func</span><span class="op" id="4873326">(</span><span class="ident" id="4873327">i</span>&nbsp;<span class="op" id="4873329">*</span><span class="ident" id="4873330">decInstr</span><span class="op" id="4873338">,</span>&nbsp;<span class="ident" id="4873340">state</span>&nbsp;<span class="op" id="4873346">*</span><span class="ident" id="4873347">decoderState</span><span class="op" id="4873359">,</span>&nbsp;<span class="ident" id="4873361">value</span>&nbsp;<span class="ident" id="4873367">reflect</span><span class="op" id="4873374">.</span><span class="ident" id="4873375">Value</span><span class="op" id="4873380">)</span>&nbsp;<span class="op" id="4873382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4873386">//&nbsp;We&nbsp;now&nbsp;have&nbsp;the&nbsp;base&nbsp;type.&nbsp;We&nbsp;need&nbsp;its&nbsp;address&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4873468">if</span>&nbsp;<span class="ident" id="4873471">value</span><span class="op" id="4873476">.</span><span class="ident" id="4873477">Kind</span><span class="op" id="4873481">(</span><span class="op" id="4873482">)</span>&nbsp;<span class="op" id="4873484">!=</span>&nbsp;<span class="ident" id="4873487">reflect</span><span class="op" id="4873494">.</span><span class="ident" id="4873495">Ptr</span>&nbsp;<span class="op" id="4873499">&amp;&amp;</span>&nbsp;<span class="ident" id="4873502">rcvrType</span><span class="op" id="4873510">.</span><span class="ident" id="4873511">Kind</span><span class="op" id="4873515">(</span><span class="op" id="4873516">)</span>&nbsp;<span class="op" id="4873518">==</span>&nbsp;<span class="ident" id="4873521">reflect</span><span class="op" id="4873528">.</span><span class="ident" id="4873529">Ptr</span>&nbsp;<span class="op" id="4873533">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4873538">value</span>&nbsp;<span class="op" id="4873544">=</span>&nbsp;<span class="ident" id="4873546">value</span><span class="op" id="4873551">.</span><span class="ident" id="4873552">Addr</span><span class="op" id="4873556">(</span><span class="op" id="4873557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4873561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4873565">state</span><span class="op" id="4873570">.</span><span class="ident" id="4873571">dec</span><span class="op" id="4873574">.</span><span class="ident" id="4873575">decodeGobDecoder</span><span class="op" id="4873591">(</span><span class="ident" id="4873592">ut</span><span class="op" id="4873594">,</span>&nbsp;<span class="ident" id="4873596">state</span><span class="op" id="4873601">,</span>&nbsp;<span class="ident" id="4873603">value</span><span class="op" id="4873608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4873611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4873614">return</span>&nbsp;<span class="op" id="4873621">&amp;</span><span class="ident" id="4873622">op</span><br>
<span class="lineno">925</span><span class="op" id="4873625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4873628">//&nbsp;compatibleType&nbsp;asks:&nbsp;Are&nbsp;these&nbsp;two&nbsp;gob&nbsp;Types&nbsp;compatible?</span><br>
<span class="lineno"></span><span class="comment" id="4873688">//&nbsp;Answers&nbsp;the&nbsp;question&nbsp;for&nbsp;basic&nbsp;types,&nbsp;arrays,&nbsp;maps&nbsp;and&nbsp;slices,&nbsp;plus</span><br>
<span class="lineno"></span><span class="comment" id="4873759">//&nbsp;GobEncoder/Decoder&nbsp;pairs.</span><br>
<span class="lineno">930</span><span class="comment" id="4873788">//&nbsp;Structs&nbsp;are&nbsp;considered&nbsp;ok;&nbsp;fields&nbsp;will&nbsp;be&nbsp;checked&nbsp;later.</span><br>
<span class="lineno"></span><span class="keyword" id="4873848">func</span>&nbsp;<span class="op" id="4873853">(</span><span class="ident" id="4873854">dec</span>&nbsp;<span class="op" id="4873858">*</span><span class="ident" id="4873859">Decoder</span><span class="op" id="4873866">)</span>&nbsp;<span class="ident" id="4873868">compatibleType</span><span class="op" id="4873882">(</span><span class="ident" id="4873883">fr</span>&nbsp;<span class="ident" id="4873886">reflect</span><span class="op" id="4873893">.</span><span class="ident" id="4873894">Type</span><span class="op" id="4873898">,</span>&nbsp;<span class="ident" id="4873900">fw</span>&nbsp;<span class="ident" id="4873903">typeId</span><span class="op" id="4873909">,</span>&nbsp;<span class="ident" id="4873911">inProgress</span>&nbsp;<span class="keyword" id="4873922">map</span><span class="op" id="4873925">[</span><span class="ident" id="4873926">reflect</span><span class="op" id="4873933">.</span><span class="ident" id="4873934">Type</span><span class="op" id="4873938">]</span><span class="ident" id="4873939">typeId</span><span class="op" id="4873945">)</span>&nbsp;<span class="builtintype" id="4873947">bool</span>&nbsp;<span class="op" id="4873952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4873955">if</span>&nbsp;<span class="ident" id="4873958">rhs</span><span class="op" id="4873961">,</span>&nbsp;<span class="ident" id="4873963">ok</span>&nbsp;<span class="op" id="4873966">:=</span>&nbsp;<span class="ident" id="4873969">inProgress</span><span class="op" id="4873979">[</span><span class="ident" id="4873980">fr</span><span class="op" id="4873982">]</span><span class="op" id="4873983">;</span>&nbsp;<span class="ident" id="4873985">ok</span>&nbsp;<span class="op" id="4873988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4873992">return</span>&nbsp;<span class="ident" id="4873999">rhs</span>&nbsp;<span class="op" id="4874003">==</span>&nbsp;<span class="ident" id="4874006">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4874010">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4874013">inProgress</span><span class="op" id="4874023">[</span><span class="ident" id="4874024">fr</span><span class="op" id="4874026">]</span>&nbsp;<span class="op" id="4874028">=</span>&nbsp;<span class="ident" id="4874030">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4874034">ut</span>&nbsp;<span class="op" id="4874037">:=</span>&nbsp;<span class="ident" id="4874040">userType</span><span class="op" id="4874048">(</span><span class="ident" id="4874049">fr</span><span class="op" id="4874051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4874054">wire</span><span class="op" id="4874058">,</span>&nbsp;<span class="ident" id="4874060">ok</span>&nbsp;<span class="op" id="4874063">:=</span>&nbsp;<span class="ident" id="4874066">dec</span><span class="op" id="4874069">.</span><span class="ident" id="4874070">wireType</span><span class="op" id="4874078">[</span><span class="ident" id="4874079">fw</span><span class="op" id="4874081">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4874084">//&nbsp;If&nbsp;wire&nbsp;was&nbsp;encoded&nbsp;with&nbsp;an&nbsp;encoding&nbsp;method,&nbsp;fr&nbsp;must&nbsp;have&nbsp;that&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4874159">//&nbsp;And&nbsp;if&nbsp;not,&nbsp;it&nbsp;must&nbsp;not.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4874188">//&nbsp;At&nbsp;most&nbsp;one&nbsp;of&nbsp;the&nbsp;booleans&nbsp;in&nbsp;ut&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4874234">//&nbsp;We&nbsp;could&nbsp;possibly&nbsp;relax&nbsp;this&nbsp;constraint&nbsp;in&nbsp;the&nbsp;future&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4874304">//&nbsp;choose&nbsp;the&nbsp;decoding&nbsp;method&nbsp;using&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;wireType.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4874367">//&nbsp;The&nbsp;parentheses&nbsp;look&nbsp;odd&nbsp;but&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874413">if</span>&nbsp;<span class="op" id="4874416">(</span><span class="ident" id="4874417">ut</span><span class="op" id="4874419">.</span><span class="ident" id="4874420">externalDec</span>&nbsp;<span class="op" id="4874432">==</span>&nbsp;<span class="ident" id="4874435">xGob</span><span class="op" id="4874439">)</span>&nbsp;<span class="op" id="4874441">!=</span>&nbsp;<span class="op" id="4874444">(</span><span class="ident" id="4874445">ok</span>&nbsp;<span class="op" id="4874448">&amp;&amp;</span>&nbsp;<span class="ident" id="4874451">wire</span><span class="op" id="4874455">.</span><span class="ident" id="4874456">GobEncoderT</span>&nbsp;<span class="op" id="4874468">!=</span>&nbsp;<span class="ident" id="4874471">nil</span><span class="op" id="4874474">)</span>&nbsp;<span class="op" id="4874476">||</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4874481">(</span><span class="ident" id="4874482">ut</span><span class="op" id="4874484">.</span><span class="ident" id="4874485">externalDec</span>&nbsp;<span class="op" id="4874497">==</span>&nbsp;<span class="ident" id="4874500">xBinary</span><span class="op" id="4874507">)</span>&nbsp;<span class="op" id="4874509">!=</span>&nbsp;<span class="op" id="4874512">(</span><span class="ident" id="4874513">ok</span>&nbsp;<span class="op" id="4874516">&amp;&amp;</span>&nbsp;<span class="ident" id="4874519">wire</span><span class="op" id="4874523">.</span><span class="ident" id="4874524">BinaryMarshalerT</span>&nbsp;<span class="op" id="4874541">!=</span>&nbsp;<span class="ident" id="4874544">nil</span><span class="op" id="4874547">)</span>&nbsp;<span class="op" id="4874549">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4874554">(</span><span class="ident" id="4874555">ut</span><span class="op" id="4874557">.</span><span class="ident" id="4874558">externalDec</span>&nbsp;<span class="op" id="4874570">==</span>&nbsp;<span class="ident" id="4874573">xText</span><span class="op" id="4874578">)</span>&nbsp;<span class="op" id="4874580">!=</span>&nbsp;<span class="op" id="4874583">(</span><span class="ident" id="4874584">ok</span>&nbsp;<span class="op" id="4874587">&amp;&amp;</span>&nbsp;<span class="ident" id="4874590">wire</span><span class="op" id="4874594">.</span><span class="ident" id="4874595">TextMarshalerT</span>&nbsp;<span class="op" id="4874610">!=</span>&nbsp;<span class="ident" id="4874613">nil</span><span class="op" id="4874616">)</span>&nbsp;<span class="op" id="4874618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874622">return</span>&nbsp;<span class="builtintype" id="4874629">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4874636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874639">if</span>&nbsp;<span class="ident" id="4874642">ut</span><span class="op" id="4874644">.</span><span class="ident" id="4874645">externalDec</span>&nbsp;<span class="op" id="4874657">!=</span>&nbsp;<span class="num" id="4874660">0</span>&nbsp;<span class="op" id="4874662">{</span>&nbsp;<span class="comment" id="4874664">//&nbsp;This&nbsp;test&nbsp;trumps&nbsp;all&nbsp;others.</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874698">return</span>&nbsp;<span class="builtintype" id="4874705">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4874711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874714">switch</span>&nbsp;<span class="ident" id="4874721">t</span>&nbsp;<span class="op" id="4874723">:=</span>&nbsp;<span class="ident" id="4874726">ut</span><span class="op" id="4874728">.</span><span class="ident" id="4874729">base</span><span class="op" id="4874733">;</span>&nbsp;<span class="ident" id="4874735">t</span><span class="op" id="4874736">.</span><span class="ident" id="4874737">Kind</span><span class="op" id="4874741">(</span><span class="op" id="4874742">)</span>&nbsp;<span class="op" id="4874744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874747">default</span><span class="op" id="4874754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4874758">//&nbsp;chan,&nbsp;etc:&nbsp;cannot&nbsp;handle.</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874789">return</span>&nbsp;<span class="builtintype" id="4874796">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874803">case</span>&nbsp;<span class="ident" id="4874808">reflect</span><span class="op" id="4874815">.</span><span class="ident" id="4874816">Bool</span><span class="op" id="4874820">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874824">return</span>&nbsp;<span class="ident" id="4874831">fw</span>&nbsp;<span class="op" id="4874834">==</span>&nbsp;<span class="ident" id="4874837">tBool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874844">case</span>&nbsp;<span class="ident" id="4874849">reflect</span><span class="op" id="4874856">.</span><span class="ident" id="4874857">Int</span><span class="op" id="4874860">,</span>&nbsp;<span class="ident" id="4874862">reflect</span><span class="op" id="4874869">.</span><span class="ident" id="4874870">Int8</span><span class="op" id="4874874">,</span>&nbsp;<span class="ident" id="4874876">reflect</span><span class="op" id="4874883">.</span><span class="ident" id="4874884">Int16</span><span class="op" id="4874889">,</span>&nbsp;<span class="ident" id="4874891">reflect</span><span class="op" id="4874898">.</span><span class="ident" id="4874899">Int32</span><span class="op" id="4874904">,</span>&nbsp;<span class="ident" id="4874906">reflect</span><span class="op" id="4874913">.</span><span class="ident" id="4874914">Int64</span><span class="op" id="4874919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874923">return</span>&nbsp;<span class="ident" id="4874930">fw</span>&nbsp;<span class="op" id="4874933">==</span>&nbsp;<span class="ident" id="4874936">tInt</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4874942">case</span>&nbsp;<span class="ident" id="4874947">reflect</span><span class="op" id="4874954">.</span><span class="ident" id="4874955">Uint</span><span class="op" id="4874959">,</span>&nbsp;<span class="ident" id="4874961">reflect</span><span class="op" id="4874968">.</span><span class="ident" id="4874969">Uint8</span><span class="op" id="4874974">,</span>&nbsp;<span class="ident" id="4874976">reflect</span><span class="op" id="4874983">.</span><span class="ident" id="4874984">Uint16</span><span class="op" id="4874990">,</span>&nbsp;<span class="ident" id="4874992">reflect</span><span class="op" id="4874999">.</span><span class="ident" id="4875000">Uint32</span><span class="op" id="4875006">,</span>&nbsp;<span class="ident" id="4875008">reflect</span><span class="op" id="4875015">.</span><span class="ident" id="4875016">Uint64</span><span class="op" id="4875022">,</span>&nbsp;<span class="ident" id="4875024">reflect</span><span class="op" id="4875031">.</span><span class="ident" id="4875032">Uintptr</span><span class="op" id="4875039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875043">return</span>&nbsp;<span class="ident" id="4875050">fw</span>&nbsp;<span class="op" id="4875053">==</span>&nbsp;<span class="ident" id="4875056">tUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875063">case</span>&nbsp;<span class="ident" id="4875068">reflect</span><span class="op" id="4875075">.</span><span class="ident" id="4875076">Float32</span><span class="op" id="4875083">,</span>&nbsp;<span class="ident" id="4875085">reflect</span><span class="op" id="4875092">.</span><span class="ident" id="4875093">Float64</span><span class="op" id="4875100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875104">return</span>&nbsp;<span class="ident" id="4875111">fw</span>&nbsp;<span class="op" id="4875114">==</span>&nbsp;<span class="ident" id="4875117">tFloat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875125">case</span>&nbsp;<span class="ident" id="4875130">reflect</span><span class="op" id="4875137">.</span><span class="ident" id="4875138">Complex64</span><span class="op" id="4875147">,</span>&nbsp;<span class="ident" id="4875149">reflect</span><span class="op" id="4875156">.</span><span class="ident" id="4875157">Complex128</span><span class="op" id="4875167">:</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875171">return</span>&nbsp;<span class="ident" id="4875178">fw</span>&nbsp;<span class="op" id="4875181">==</span>&nbsp;<span class="ident" id="4875184">tComplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875194">case</span>&nbsp;<span class="ident" id="4875199">reflect</span><span class="op" id="4875206">.</span><span class="ident" id="4875207">String</span><span class="op" id="4875213">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875217">return</span>&nbsp;<span class="ident" id="4875224">fw</span>&nbsp;<span class="op" id="4875227">==</span>&nbsp;<span class="ident" id="4875230">tString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875239">case</span>&nbsp;<span class="ident" id="4875244">reflect</span><span class="op" id="4875251">.</span><span class="ident" id="4875252">Interface</span><span class="op" id="4875261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875265">return</span>&nbsp;<span class="ident" id="4875272">fw</span>&nbsp;<span class="op" id="4875275">==</span>&nbsp;<span class="ident" id="4875278">tInterface</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875290">case</span>&nbsp;<span class="ident" id="4875295">reflect</span><span class="op" id="4875302">.</span><span class="ident" id="4875303">Array</span><span class="op" id="4875308">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875312">if</span>&nbsp;<span class="op" id="4875315">!</span><span class="ident" id="4875316">ok</span>&nbsp;<span class="op" id="4875319">||</span>&nbsp;<span class="ident" id="4875322">wire</span><span class="op" id="4875326">.</span><span class="ident" id="4875327">ArrayT</span>&nbsp;<span class="op" id="4875334">==</span>&nbsp;<span class="ident" id="4875337">nil</span>&nbsp;<span class="op" id="4875341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875346">return</span>&nbsp;<span class="builtintype" id="4875353">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4875361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875365">array</span>&nbsp;<span class="op" id="4875371">:=</span>&nbsp;<span class="ident" id="4875374">wire</span><span class="op" id="4875378">.</span><span class="ident" id="4875379">ArrayT</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875388">return</span>&nbsp;<span class="ident" id="4875395">t</span><span class="op" id="4875396">.</span><span class="ident" id="4875397">Len</span><span class="op" id="4875400">(</span><span class="op" id="4875401">)</span>&nbsp;<span class="op" id="4875403">==</span>&nbsp;<span class="ident" id="4875406">array</span><span class="op" id="4875411">.</span><span class="ident" id="4875412">Len</span>&nbsp;<span class="op" id="4875416">&amp;&amp;</span>&nbsp;<span class="ident" id="4875419">dec</span><span class="op" id="4875422">.</span><span class="ident" id="4875423">compatibleType</span><span class="op" id="4875437">(</span><span class="ident" id="4875438">t</span><span class="op" id="4875439">.</span><span class="ident" id="4875440">Elem</span><span class="op" id="4875444">(</span><span class="op" id="4875445">)</span><span class="op" id="4875446">,</span>&nbsp;<span class="ident" id="4875448">array</span><span class="op" id="4875453">.</span><span class="ident" id="4875454">Elem</span><span class="op" id="4875458">,</span>&nbsp;<span class="ident" id="4875460">inProgress</span><span class="op" id="4875470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875473">case</span>&nbsp;<span class="ident" id="4875478">reflect</span><span class="op" id="4875485">.</span><span class="ident" id="4875486">Map</span><span class="op" id="4875489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875493">if</span>&nbsp;<span class="op" id="4875496">!</span><span class="ident" id="4875497">ok</span>&nbsp;<span class="op" id="4875500">||</span>&nbsp;<span class="ident" id="4875503">wire</span><span class="op" id="4875507">.</span><span class="ident" id="4875508">MapT</span>&nbsp;<span class="op" id="4875513">==</span>&nbsp;<span class="ident" id="4875516">nil</span>&nbsp;<span class="op" id="4875520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875525">return</span>&nbsp;<span class="builtintype" id="4875532">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4875540">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875544">MapType</span>&nbsp;<span class="op" id="4875552">:=</span>&nbsp;<span class="ident" id="4875555">wire</span><span class="op" id="4875559">.</span><span class="ident" id="4875560">MapT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875567">return</span>&nbsp;<span class="ident" id="4875574">dec</span><span class="op" id="4875577">.</span><span class="ident" id="4875578">compatibleType</span><span class="op" id="4875592">(</span><span class="ident" id="4875593">t</span><span class="op" id="4875594">.</span><span class="ident" id="4875595">Key</span><span class="op" id="4875598">(</span><span class="op" id="4875599">)</span><span class="op" id="4875600">,</span>&nbsp;<span class="ident" id="4875602">MapType</span><span class="op" id="4875609">.</span><span class="ident" id="4875610">Key</span><span class="op" id="4875613">,</span>&nbsp;<span class="ident" id="4875615">inProgress</span><span class="op" id="4875625">)</span>&nbsp;<span class="op" id="4875627">&amp;&amp;</span>&nbsp;<span class="ident" id="4875630">dec</span><span class="op" id="4875633">.</span><span class="ident" id="4875634">compatibleType</span><span class="op" id="4875648">(</span><span class="ident" id="4875649">t</span><span class="op" id="4875650">.</span><span class="ident" id="4875651">Elem</span><span class="op" id="4875655">(</span><span class="op" id="4875656">)</span><span class="op" id="4875657">,</span>&nbsp;<span class="ident" id="4875659">MapType</span><span class="op" id="4875666">.</span><span class="ident" id="4875667">Elem</span><span class="op" id="4875671">,</span>&nbsp;<span class="ident" id="4875673">inProgress</span><span class="op" id="4875683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875686">case</span>&nbsp;<span class="ident" id="4875691">reflect</span><span class="op" id="4875698">.</span><span class="ident" id="4875699">Slice</span><span class="op" id="4875704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4875708">//&nbsp;Is&nbsp;it&nbsp;an&nbsp;array&nbsp;of&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875738">if</span>&nbsp;<span class="ident" id="4875741">t</span><span class="op" id="4875742">.</span><span class="ident" id="4875743">Elem</span><span class="op" id="4875747">(</span><span class="op" id="4875748">)</span><span class="op" id="4875749">.</span><span class="ident" id="4875750">Kind</span><span class="op" id="4875754">(</span><span class="op" id="4875755">)</span>&nbsp;<span class="op" id="4875757">==</span>&nbsp;<span class="ident" id="4875760">reflect</span><span class="op" id="4875767">.</span><span class="ident" id="4875768">Uint8</span>&nbsp;<span class="op" id="4875774">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875779">return</span>&nbsp;<span class="ident" id="4875786">fw</span>&nbsp;<span class="op" id="4875789">==</span>&nbsp;<span class="ident" id="4875792">tBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4875801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4875805">//&nbsp;Extract&nbsp;and&nbsp;compare&nbsp;element&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875845">var</span>&nbsp;<span class="ident" id="4875849">sw</span>&nbsp;<span class="op" id="4875852">*</span><span class="ident" id="4875853">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4875865">if</span>&nbsp;<span class="ident" id="4875868">tt</span><span class="op" id="4875870">,</span>&nbsp;<span class="ident" id="4875872">ok</span>&nbsp;<span class="op" id="4875875">:=</span>&nbsp;<span class="ident" id="4875878">builtinIdToType</span><span class="op" id="4875893">[</span><span class="ident" id="4875894">fw</span><span class="op" id="4875896">]</span><span class="op" id="4875897">;</span>&nbsp;<span class="ident" id="4875899">ok</span>&nbsp;<span class="op" id="4875902">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875907">sw</span><span class="op" id="4875909">,</span>&nbsp;<span class="ident" id="4875911">_</span>&nbsp;<span class="op" id="4875913">=</span>&nbsp;<span class="ident" id="4875915">tt</span><span class="op" id="4875917">.</span><span class="op" id="4875918">(</span><span class="op" id="4875919">*</span><span class="ident" id="4875920">sliceType</span><span class="op" id="4875929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4875933">}</span>&nbsp;<span class="keyword" id="4875935">else</span>&nbsp;<span class="keyword" id="4875940">if</span>&nbsp;<span class="ident" id="4875943">wire</span>&nbsp;<span class="op" id="4875948">!=</span>&nbsp;<span class="ident" id="4875951">nil</span>&nbsp;<span class="op" id="4875955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875960">sw</span>&nbsp;<span class="op" id="4875963">=</span>&nbsp;<span class="ident" id="4875965">wire</span><span class="op" id="4875969">.</span><span class="ident" id="4875970">SliceT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4875979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4875983">elem</span>&nbsp;<span class="op" id="4875988">:=</span>&nbsp;<span class="ident" id="4875991">userType</span><span class="op" id="4875999">(</span><span class="ident" id="4876000">t</span><span class="op" id="4876001">.</span><span class="ident" id="4876002">Elem</span><span class="op" id="4876006">(</span><span class="op" id="4876007">)</span><span class="op" id="4876008">)</span><span class="op" id="4876009">.</span><span class="ident" id="4876010">base</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876017">return</span>&nbsp;<span class="ident" id="4876024">sw</span>&nbsp;<span class="op" id="4876027">!=</span>&nbsp;<span class="ident" id="4876030">nil</span>&nbsp;<span class="op" id="4876034">&amp;&amp;</span>&nbsp;<span class="ident" id="4876037">dec</span><span class="op" id="4876040">.</span><span class="ident" id="4876041">compatibleType</span><span class="op" id="4876055">(</span><span class="ident" id="4876056">elem</span><span class="op" id="4876060">,</span>&nbsp;<span class="ident" id="4876062">sw</span><span class="op" id="4876064">.</span><span class="ident" id="4876065">Elem</span><span class="op" id="4876069">,</span>&nbsp;<span class="ident" id="4876071">inProgress</span><span class="op" id="4876081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876084">case</span>&nbsp;<span class="ident" id="4876089">reflect</span><span class="op" id="4876096">.</span><span class="ident" id="4876097">Struct</span><span class="op" id="4876103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876107">return</span>&nbsp;<span class="builtintype" id="4876114">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4876120">}</span><br>
<span class="lineno"></span><span class="op" id="4876122">}</span><br>
<span class="lineno">1000</span><br>
<span class="lineno"></span><span class="comment" id="4876125">//&nbsp;typeString&nbsp;returns&nbsp;a&nbsp;human-readable&nbsp;description&nbsp;of&nbsp;the&nbsp;type&nbsp;identified&nbsp;by&nbsp;remoteId.</span><br>
<span class="lineno"></span><span class="keyword" id="4876212">func</span>&nbsp;<span class="op" id="4876217">(</span><span class="ident" id="4876218">dec</span>&nbsp;<span class="op" id="4876222">*</span><span class="ident" id="4876223">Decoder</span><span class="op" id="4876230">)</span>&nbsp;<span class="ident" id="4876232">typeString</span><span class="op" id="4876242">(</span><span class="ident" id="4876243">remoteId</span>&nbsp;<span class="ident" id="4876252">typeId</span><span class="op" id="4876258">)</span>&nbsp;<span class="builtintype" id="4876260">string</span>&nbsp;<span class="op" id="4876267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876270">if</span>&nbsp;<span class="ident" id="4876273">t</span>&nbsp;<span class="op" id="4876275">:=</span>&nbsp;<span class="ident" id="4876278">idToType</span><span class="op" id="4876286">[</span><span class="ident" id="4876287">remoteId</span><span class="op" id="4876295">]</span><span class="op" id="4876296">;</span>&nbsp;<span class="ident" id="4876298">t</span>&nbsp;<span class="op" id="4876300">!=</span>&nbsp;<span class="ident" id="4876303">nil</span>&nbsp;<span class="op" id="4876307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4876311">//&nbsp;globally&nbsp;known&nbsp;type.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876337">return</span>&nbsp;<span class="ident" id="4876344">t</span><span class="op" id="4876345">.</span><span class="builtintype" id="4876346">string</span><span class="op" id="4876352">(</span><span class="op" id="4876353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4876356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876359">return</span>&nbsp;<span class="ident" id="4876366">dec</span><span class="op" id="4876369">.</span><span class="ident" id="4876370">wireType</span><span class="op" id="4876378">[</span><span class="ident" id="4876379">remoteId</span><span class="op" id="4876387">]</span><span class="op" id="4876388">.</span><span class="builtintype" id="4876389">string</span><span class="op" id="4876395">(</span><span class="op" id="4876396">)</span><br>
<span class="lineno"></span><span class="op" id="4876398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="4876401">//&nbsp;compileSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value,&nbsp;including</span><br>
<span class="lineno"></span><span class="comment" id="4876490">//&nbsp;GobDecoders.</span><br>
<span class="lineno"></span><span class="keyword" id="4876506">func</span>&nbsp;<span class="op" id="4876511">(</span><span class="ident" id="4876512">dec</span>&nbsp;<span class="op" id="4876516">*</span><span class="ident" id="4876517">Decoder</span><span class="op" id="4876524">)</span>&nbsp;<span class="ident" id="4876526">compileSingle</span><span class="op" id="4876539">(</span><span class="ident" id="4876540">remoteId</span>&nbsp;<span class="ident" id="4876549">typeId</span><span class="op" id="4876555">,</span>&nbsp;<span class="ident" id="4876557">ut</span>&nbsp;<span class="op" id="4876560">*</span><span class="ident" id="4876561">userTypeInfo</span><span class="op" id="4876573">)</span>&nbsp;<span class="op" id="4876575">(</span><span class="ident" id="4876576">engine</span>&nbsp;<span class="op" id="4876583">*</span><span class="ident" id="4876584">decEngine</span><span class="op" id="4876593">,</span>&nbsp;<span class="ident" id="4876595">err</span>&nbsp;<span class="builtintype" id="4876599">error</span><span class="op" id="4876604">)</span>&nbsp;<span class="op" id="4876606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876609">rt</span>&nbsp;<span class="op" id="4876612">:=</span>&nbsp;<span class="ident" id="4876615">ut</span><span class="op" id="4876617">.</span><span class="ident" id="4876618">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876624">engine</span>&nbsp;<span class="op" id="4876631">=</span>&nbsp;<span class="builtinfunc" id="4876633">new</span><span class="op" id="4876636">(</span><span class="ident" id="4876637">decEngine</span><span class="op" id="4876646">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876649">engine</span><span class="op" id="4876655">.</span><span class="ident" id="4876656">instr</span>&nbsp;<span class="op" id="4876662">=</span>&nbsp;<span class="builtinfunc" id="4876664">make</span><span class="op" id="4876668">(</span><span class="op" id="4876669">[</span><span class="op" id="4876670">]</span><span class="ident" id="4876671">decInstr</span><span class="op" id="4876679">,</span>&nbsp;<span class="num" id="4876681">1</span><span class="op" id="4876682">)</span>&nbsp;<span class="comment" id="4876684">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876697">name</span>&nbsp;<span class="op" id="4876702">:=</span>&nbsp;<span class="ident" id="4876705">rt</span><span class="op" id="4876707">.</span><span class="ident" id="4876708">String</span><span class="op" id="4876714">(</span><span class="op" id="4876715">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4876732">//&nbsp;best&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876751">if</span>&nbsp;<span class="op" id="4876754">!</span><span class="ident" id="4876755">dec</span><span class="op" id="4876758">.</span><span class="ident" id="4876759">compatibleType</span><span class="op" id="4876773">(</span><span class="ident" id="4876774">rt</span><span class="op" id="4876776">,</span>&nbsp;<span class="ident" id="4876778">remoteId</span><span class="op" id="4876786">,</span>&nbsp;<span class="builtinfunc" id="4876788">make</span><span class="op" id="4876792">(</span><span class="keyword" id="4876793">map</span><span class="op" id="4876796">[</span><span class="ident" id="4876797">reflect</span><span class="op" id="4876804">.</span><span class="ident" id="4876805">Type</span><span class="op" id="4876809">]</span><span class="ident" id="4876810">typeId</span><span class="op" id="4876816">)</span><span class="op" id="4876817">)</span>&nbsp;<span class="op" id="4876819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4876823">remoteType</span>&nbsp;<span class="op" id="4876834">:=</span>&nbsp;<span class="ident" id="4876837">dec</span><span class="op" id="4876840">.</span><span class="ident" id="4876841">typeString</span><span class="op" id="4876851">(</span><span class="ident" id="4876852">remoteId</span><span class="op" id="4876860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4876864">//&nbsp;Common&nbsp;confusing&nbsp;case:&nbsp;local&nbsp;interface&nbsp;type,&nbsp;remote&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4876936">if</span>&nbsp;<span class="ident" id="4876939">ut</span><span class="op" id="4876941">.</span><span class="ident" id="4876942">base</span><span class="op" id="4876946">.</span><span class="ident" id="4876947">Kind</span><span class="op" id="4876951">(</span><span class="op" id="4876952">)</span>&nbsp;<span class="op" id="4876954">==</span>&nbsp;<span class="ident" id="4876957">reflect</span><span class="op" id="4876964">.</span><span class="ident" id="4876965">Interface</span>&nbsp;<span class="op" id="4876975">&amp;&amp;</span>&nbsp;<span class="ident" id="4876978">remoteId</span>&nbsp;<span class="op" id="4876987">!=</span>&nbsp;<span class="ident" id="4876990">tInterface</span>&nbsp;<span class="op" id="4877001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877006">return</span>&nbsp;<span class="ident" id="4877013">nil</span><span class="op" id="4877016">,</span>&nbsp;<span class="ident" id="4877018">errors</span><span class="op" id="4877024">.</span><span class="ident" id="4877025">New</span><span class="op" id="4877028">(</span><span class="string" id="4877029">&#34;gob:&nbsp;local&nbsp;interface&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4877058">+</span>&nbsp;<span class="ident" id="4877060">name</span>&nbsp;<span class="op" id="4877065">+</span>&nbsp;<span class="string" id="4877067">&#34;&nbsp;can&nbsp;only&nbsp;be&nbsp;decoded&nbsp;from&nbsp;remote&nbsp;interface&nbsp;type;&nbsp;received&nbsp;concrete&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4877142">+</span>&nbsp;<span class="ident" id="4877144">remoteType</span><span class="op" id="4877154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4877158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877162">return</span>&nbsp;<span class="ident" id="4877169">nil</span><span class="op" id="4877172">,</span>&nbsp;<span class="ident" id="4877174">errors</span><span class="op" id="4877180">.</span><span class="ident" id="4877181">New</span><span class="op" id="4877184">(</span><span class="string" id="4877185">&#34;gob:&nbsp;decoding&nbsp;into&nbsp;local&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4877218">+</span>&nbsp;<span class="ident" id="4877220">name</span>&nbsp;<span class="op" id="4877225">+</span>&nbsp;<span class="string" id="4877227">&#34;,&nbsp;received&nbsp;remote&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4877253">+</span>&nbsp;<span class="ident" id="4877255">remoteType</span><span class="op" id="4877265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4877268">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877271">op</span>&nbsp;<span class="op" id="4877274">:=</span>&nbsp;<span class="ident" id="4877277">dec</span><span class="op" id="4877280">.</span><span class="ident" id="4877281">decOpFor</span><span class="op" id="4877289">(</span><span class="ident" id="4877290">remoteId</span><span class="op" id="4877298">,</span>&nbsp;<span class="ident" id="4877300">rt</span><span class="op" id="4877302">,</span>&nbsp;<span class="ident" id="4877304">name</span><span class="op" id="4877308">,</span>&nbsp;<span class="builtinfunc" id="4877310">make</span><span class="op" id="4877314">(</span><span class="keyword" id="4877315">map</span><span class="op" id="4877318">[</span><span class="ident" id="4877319">reflect</span><span class="op" id="4877326">.</span><span class="ident" id="4877327">Type</span><span class="op" id="4877331">]</span><span class="op" id="4877332">*</span><span class="ident" id="4877333">decOp</span><span class="op" id="4877338">)</span><span class="op" id="4877339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877342">ovfl</span>&nbsp;<span class="op" id="4877347">:=</span>&nbsp;<span class="ident" id="4877350">errors</span><span class="op" id="4877356">.</span><span class="ident" id="4877357">New</span><span class="op" id="4877360">(</span><span class="string" id="4877361">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="4877375">+</span>&nbsp;<span class="ident" id="4877377">name</span>&nbsp;<span class="op" id="4877382">+</span>&nbsp;<span class="string" id="4877384">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="4877400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877403">engine</span><span class="op" id="4877409">.</span><span class="ident" id="4877410">instr</span><span class="op" id="4877415">[</span><span class="ident" id="4877416">singletonField</span><span class="op" id="4877430">]</span>&nbsp;<span class="op" id="4877432">=</span>&nbsp;<span class="ident" id="4877434">decInstr</span><span class="op" id="4877442">{</span><span class="op" id="4877443">*</span><span class="ident" id="4877444">op</span><span class="op" id="4877446">,</span>&nbsp;<span class="ident" id="4877448">singletonField</span><span class="op" id="4877462">,</span>&nbsp;<span class="ident" id="4877464">nil</span><span class="op" id="4877467">,</span>&nbsp;<span class="ident" id="4877469">ovfl</span><span class="op" id="4877473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877476">engine</span><span class="op" id="4877482">.</span><span class="ident" id="4877483">numInstr</span>&nbsp;<span class="op" id="4877492">=</span>&nbsp;<span class="num" id="4877494">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877497">return</span><br>
<span class="lineno">1030</span><span class="op" id="4877504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4877507">//&nbsp;compileIgnoreSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value&nbsp;that&nbsp;will&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4877615">func</span>&nbsp;<span class="op" id="4877620">(</span><span class="ident" id="4877621">dec</span>&nbsp;<span class="op" id="4877625">*</span><span class="ident" id="4877626">Decoder</span><span class="op" id="4877633">)</span>&nbsp;<span class="ident" id="4877635">compileIgnoreSingle</span><span class="op" id="4877654">(</span><span class="ident" id="4877655">remoteId</span>&nbsp;<span class="ident" id="4877664">typeId</span><span class="op" id="4877670">)</span>&nbsp;<span class="op" id="4877672">(</span><span class="ident" id="4877673">engine</span>&nbsp;<span class="op" id="4877680">*</span><span class="ident" id="4877681">decEngine</span><span class="op" id="4877690">,</span>&nbsp;<span class="ident" id="4877692">err</span>&nbsp;<span class="builtintype" id="4877696">error</span><span class="op" id="4877701">)</span>&nbsp;<span class="op" id="4877703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877706">engine</span>&nbsp;<span class="op" id="4877713">=</span>&nbsp;<span class="builtinfunc" id="4877715">new</span><span class="op" id="4877718">(</span><span class="ident" id="4877719">decEngine</span><span class="op" id="4877728">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877731">engine</span><span class="op" id="4877737">.</span><span class="ident" id="4877738">instr</span>&nbsp;<span class="op" id="4877744">=</span>&nbsp;<span class="builtinfunc" id="4877746">make</span><span class="op" id="4877750">(</span><span class="op" id="4877751">[</span><span class="op" id="4877752">]</span><span class="ident" id="4877753">decInstr</span><span class="op" id="4877761">,</span>&nbsp;<span class="num" id="4877763">1</span><span class="op" id="4877764">)</span>&nbsp;<span class="comment" id="4877766">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877779">op</span>&nbsp;<span class="op" id="4877782">:=</span>&nbsp;<span class="ident" id="4877785">dec</span><span class="op" id="4877788">.</span><span class="ident" id="4877789">decIgnoreOpFor</span><span class="op" id="4877803">(</span><span class="ident" id="4877804">remoteId</span><span class="op" id="4877812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877815">ovfl</span>&nbsp;<span class="op" id="4877820">:=</span>&nbsp;<span class="ident" id="4877823">overflow</span><span class="op" id="4877831">(</span><span class="ident" id="4877832">dec</span><span class="op" id="4877835">.</span><span class="ident" id="4877836">typeString</span><span class="op" id="4877846">(</span><span class="ident" id="4877847">remoteId</span><span class="op" id="4877855">)</span><span class="op" id="4877856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877859">engine</span><span class="op" id="4877865">.</span><span class="ident" id="4877866">instr</span><span class="op" id="4877871">[</span><span class="num" id="4877872">0</span><span class="op" id="4877873">]</span>&nbsp;<span class="op" id="4877875">=</span>&nbsp;<span class="ident" id="4877877">decInstr</span><span class="op" id="4877885">{</span><span class="ident" id="4877886">op</span><span class="op" id="4877888">,</span>&nbsp;<span class="num" id="4877890">0</span><span class="op" id="4877891">,</span>&nbsp;<span class="ident" id="4877893">nil</span><span class="op" id="4877896">,</span>&nbsp;<span class="ident" id="4877898">ovfl</span><span class="op" id="4877902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877905">engine</span><span class="op" id="4877911">.</span><span class="ident" id="4877912">numInstr</span>&nbsp;<span class="op" id="4877921">=</span>&nbsp;<span class="num" id="4877923">1</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4877926">return</span><br>
<span class="lineno"></span><span class="op" id="4877933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4877936">//&nbsp;compileDec&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;value.&nbsp;&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;a&nbsp;struct,</span><br>
<span class="lineno"></span><span class="comment" id="4878022">//&nbsp;it&nbsp;calls&nbsp;out&nbsp;to&nbsp;compileSingle.</span><br>
<span class="lineno">1045</span><span class="keyword" id="4878056">func</span>&nbsp;<span class="op" id="4878061">(</span><span class="ident" id="4878062">dec</span>&nbsp;<span class="op" id="4878066">*</span><span class="ident" id="4878067">Decoder</span><span class="op" id="4878074">)</span>&nbsp;<span class="ident" id="4878076">compileDec</span><span class="op" id="4878086">(</span><span class="ident" id="4878087">remoteId</span>&nbsp;<span class="ident" id="4878096">typeId</span><span class="op" id="4878102">,</span>&nbsp;<span class="ident" id="4878104">ut</span>&nbsp;<span class="op" id="4878107">*</span><span class="ident" id="4878108">userTypeInfo</span><span class="op" id="4878120">)</span>&nbsp;<span class="op" id="4878122">(</span><span class="ident" id="4878123">engine</span>&nbsp;<span class="op" id="4878130">*</span><span class="ident" id="4878131">decEngine</span><span class="op" id="4878140">,</span>&nbsp;<span class="ident" id="4878142">err</span>&nbsp;<span class="builtintype" id="4878146">error</span><span class="op" id="4878151">)</span>&nbsp;<span class="op" id="4878153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878156">rt</span>&nbsp;<span class="op" id="4878159">:=</span>&nbsp;<span class="ident" id="4878162">ut</span><span class="op" id="4878164">.</span><span class="ident" id="4878165">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878171">srt</span>&nbsp;<span class="op" id="4878175">:=</span>&nbsp;<span class="ident" id="4878178">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4878182">if</span>&nbsp;<span class="ident" id="4878185">srt</span><span class="op" id="4878188">.</span><span class="ident" id="4878189">Kind</span><span class="op" id="4878193">(</span><span class="op" id="4878194">)</span>&nbsp;<span class="op" id="4878196">!=</span>&nbsp;<span class="ident" id="4878199">reflect</span><span class="op" id="4878206">.</span><span class="ident" id="4878207">Struct</span>&nbsp;<span class="op" id="4878214">||</span>&nbsp;<span class="ident" id="4878217">ut</span><span class="op" id="4878219">.</span><span class="ident" id="4878220">externalDec</span>&nbsp;<span class="op" id="4878232">!=</span>&nbsp;<span class="num" id="4878235">0</span>&nbsp;<span class="op" id="4878237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4878241">return</span>&nbsp;<span class="ident" id="4878248">dec</span><span class="op" id="4878251">.</span><span class="ident" id="4878252">compileSingle</span><span class="op" id="4878265">(</span><span class="ident" id="4878266">remoteId</span><span class="op" id="4878274">,</span>&nbsp;<span class="ident" id="4878276">ut</span><span class="op" id="4878278">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4878281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4878284">var</span>&nbsp;<span class="ident" id="4878288">wireStruct</span>&nbsp;<span class="op" id="4878299">*</span><span class="ident" id="4878300">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4878312">//&nbsp;Builtin&nbsp;types&nbsp;can&nbsp;come&nbsp;from&nbsp;global&nbsp;pool;&nbsp;the&nbsp;rest&nbsp;must&nbsp;be&nbsp;defined&nbsp;by&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4878398">//&nbsp;Also&nbsp;we&nbsp;know&nbsp;we&#39;re&nbsp;decoding&nbsp;a&nbsp;struct&nbsp;now,&nbsp;so&nbsp;the&nbsp;client&nbsp;must&nbsp;have&nbsp;sent&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4878478">if</span>&nbsp;<span class="ident" id="4878481">t</span><span class="op" id="4878482">,</span>&nbsp;<span class="ident" id="4878484">ok</span>&nbsp;<span class="op" id="4878487">:=</span>&nbsp;<span class="ident" id="4878490">builtinIdToType</span><span class="op" id="4878505">[</span><span class="ident" id="4878506">remoteId</span><span class="op" id="4878514">]</span><span class="op" id="4878515">;</span>&nbsp;<span class="ident" id="4878517">ok</span>&nbsp;<span class="op" id="4878520">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878524">wireStruct</span><span class="op" id="4878534">,</span>&nbsp;<span class="ident" id="4878536">_</span>&nbsp;<span class="op" id="4878538">=</span>&nbsp;<span class="ident" id="4878540">t</span><span class="op" id="4878541">.</span><span class="op" id="4878542">(</span><span class="op" id="4878543">*</span><span class="ident" id="4878544">structType</span><span class="op" id="4878554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4878557">}</span>&nbsp;<span class="keyword" id="4878559">else</span>&nbsp;<span class="op" id="4878564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878568">wire</span>&nbsp;<span class="op" id="4878573">:=</span>&nbsp;<span class="ident" id="4878576">dec</span><span class="op" id="4878579">.</span><span class="ident" id="4878580">wireType</span><span class="op" id="4878588">[</span><span class="ident" id="4878589">remoteId</span><span class="op" id="4878597">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4878601">if</span>&nbsp;<span class="ident" id="4878604">wire</span>&nbsp;<span class="op" id="4878609">==</span>&nbsp;<span class="ident" id="4878612">nil</span>&nbsp;<span class="op" id="4878616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878621">error_</span><span class="op" id="4878627">(</span><span class="ident" id="4878628">errBadType</span><span class="op" id="4878638">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4878642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878646">wireStruct</span>&nbsp;<span class="op" id="4878657">=</span>&nbsp;<span class="ident" id="4878659">wire</span><span class="op" id="4878663">.</span><span class="ident" id="4878664">StructT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4878673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4878676">if</span>&nbsp;<span class="ident" id="4878679">wireStruct</span>&nbsp;<span class="op" id="4878690">==</span>&nbsp;<span class="ident" id="4878693">nil</span>&nbsp;<span class="op" id="4878697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878701">errorf</span><span class="op" id="4878707">(</span><span class="string" id="4878708">&#34;type&nbsp;mismatch&nbsp;in&nbsp;decoder:&nbsp;want&nbsp;struct&nbsp;type&nbsp;%s;&nbsp;got&nbsp;non-struct&#34;</span><span class="op" id="4878771">,</span>&nbsp;<span class="ident" id="4878773">rt</span><span class="op" id="4878775">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4878778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878781">engine</span>&nbsp;<span class="op" id="4878788">=</span>&nbsp;<span class="builtinfunc" id="4878790">new</span><span class="op" id="4878793">(</span><span class="ident" id="4878794">decEngine</span><span class="op" id="4878803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878806">engine</span><span class="op" id="4878812">.</span><span class="ident" id="4878813">instr</span>&nbsp;<span class="op" id="4878819">=</span>&nbsp;<span class="builtinfunc" id="4878821">make</span><span class="op" id="4878825">(</span><span class="op" id="4878826">[</span><span class="op" id="4878827">]</span><span class="ident" id="4878828">decInstr</span><span class="op" id="4878836">,</span>&nbsp;<span class="builtinfunc" id="4878838">len</span><span class="op" id="4878841">(</span><span class="ident" id="4878842">wireStruct</span><span class="op" id="4878852">.</span><span class="ident" id="4878853">Field</span><span class="op" id="4878858">)</span><span class="op" id="4878859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878862">seen</span>&nbsp;<span class="op" id="4878867">:=</span>&nbsp;<span class="builtinfunc" id="4878870">make</span><span class="op" id="4878874">(</span><span class="keyword" id="4878875">map</span><span class="op" id="4878878">[</span><span class="ident" id="4878879">reflect</span><span class="op" id="4878886">.</span><span class="ident" id="4878887">Type</span><span class="op" id="4878891">]</span><span class="op" id="4878892">*</span><span class="ident" id="4878893">decOp</span><span class="op" id="4878898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4878901">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;wire&nbsp;type.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4878944">for</span>&nbsp;<span class="ident" id="4878948">fieldnum</span>&nbsp;<span class="op" id="4878957">:=</span>&nbsp;<span class="num" id="4878960">0</span><span class="op" id="4878961">;</span>&nbsp;<span class="ident" id="4878963">fieldnum</span>&nbsp;<span class="op" id="4878972">&lt;</span>&nbsp;<span class="builtinfunc" id="4878974">len</span><span class="op" id="4878977">(</span><span class="ident" id="4878978">wireStruct</span><span class="op" id="4878988">.</span><span class="ident" id="4878989">Field</span><span class="op" id="4878994">)</span><span class="op" id="4878995">;</span>&nbsp;<span class="ident" id="4878997">fieldnum</span><span class="op" id="4879005">++</span>&nbsp;<span class="op" id="4879008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4879012">wireField</span>&nbsp;<span class="op" id="4879022">:=</span>&nbsp;<span class="ident" id="4879025">wireStruct</span><span class="op" id="4879035">.</span><span class="ident" id="4879036">Field</span><span class="op" id="4879041">[</span><span class="ident" id="4879042">fieldnum</span><span class="op" id="4879050">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4879054">if</span>&nbsp;<span class="ident" id="4879057">wireField</span><span class="op" id="4879066">.</span><span class="ident" id="4879067">Name</span>&nbsp;<span class="op" id="4879072">==</span>&nbsp;<span class="string" id="4879075">&#34;&#34;</span>&nbsp;<span class="op" id="4879078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4879083">errorf</span><span class="op" id="4879089">(</span><span class="string" id="4879090">&#34;empty&nbsp;name&nbsp;for&nbsp;remote&nbsp;field&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4879130">,</span>&nbsp;<span class="ident" id="4879132">wireStruct</span><span class="op" id="4879142">.</span><span class="ident" id="4879143">Name</span><span class="op" id="4879147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4879151">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4879155">ovfl</span>&nbsp;<span class="op" id="4879160">:=</span>&nbsp;<span class="ident" id="4879163">overflow</span><span class="op" id="4879171">(</span><span class="ident" id="4879172">wireField</span><span class="op" id="4879181">.</span><span class="ident" id="4879182">Name</span><span class="op" id="4879186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879190">//&nbsp;Find&nbsp;the&nbsp;field&nbsp;of&nbsp;the&nbsp;local&nbsp;type&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4879248">localField</span><span class="op" id="4879258">,</span>&nbsp;<span class="ident" id="4879260">present</span>&nbsp;<span class="op" id="4879268">:=</span>&nbsp;<span class="ident" id="4879271">srt</span><span class="op" id="4879274">.</span><span class="ident" id="4879275">FieldByName</span><span class="op" id="4879286">(</span><span class="ident" id="4879287">wireField</span><span class="op" id="4879296">.</span><span class="ident" id="4879297">Name</span><span class="op" id="4879301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879305">//&nbsp;TODO(r):&nbsp;anonymous&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4879335">if</span>&nbsp;<span class="op" id="4879338">!</span><span class="ident" id="4879339">present</span>&nbsp;<span class="op" id="4879347">||</span>&nbsp;<span class="op" id="4879350">!</span><span class="ident" id="4879351">isExported</span><span class="op" id="4879361">(</span><span class="ident" id="4879362">wireField</span><span class="op" id="4879371">.</span><span class="ident" id="4879372">Name</span><span class="op" id="4879376">)</span>&nbsp;<span class="op" id="4879378">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4879383">op</span>&nbsp;<span class="op" id="4879386">:=</span>&nbsp;<span class="ident" id="4879389">dec</span><span class="op" id="4879392">.</span><span class="ident" id="4879393">decIgnoreOpFor</span><span class="op" id="4879407">(</span><span class="ident" id="4879408">wireField</span><span class="op" id="4879417">.</span><span class="ident" id="4879418">Id</span><span class="op" id="4879420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4879425">engine</span><span class="op" id="4879431">.</span><span class="ident" id="4879432">instr</span><span class="op" id="4879437">[</span><span class="ident" id="4879438">fieldnum</span><span class="op" id="4879446">]</span>&nbsp;<span class="op" id="4879448">=</span>&nbsp;<span class="ident" id="4879450">decInstr</span><span class="op" id="4879458">{</span><span class="ident" id="4879459">op</span><span class="op" id="4879461">,</span>&nbsp;<span class="ident" id="4879463">fieldnum</span><span class="op" id="4879471">,</span>&nbsp;<span class="ident" id="4879473">nil</span><span class="op" id="4879476">,</span>&nbsp;<span class="ident" id="4879478">ovfl</span><span class="op" id="4879482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4879487">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4879498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4879502">if</span>&nbsp;<span class="op" id="4879505">!</span><span class="ident" id="4879506">dec</span><span class="op" id="4879509">.</span><span class="ident" id="4879510">compatibleType</span><span class="op" id="4879524">(</span><span class="ident" id="4879525">localField</span><span class="op" id="4879535">.</span><span class="ident" id="4879536">Type</span><span class="op" id="4879540">,</span>&nbsp;<span class="ident" id="4879542">wireField</span><span class="op" id="4879551">.</span><span class="ident" id="4879552">Id</span><span class="op" id="4879554">,</span>&nbsp;<span class="builtinfunc" id="4879556">make</span><span class="op" id="4879560">(</span><span class="keyword" id="4879561">map</span><span class="op" id="4879564">[</span><span class="ident" id="4879565">reflect</span><span class="op" id="4879572">.</span><span class="ident" id="4879573">Type</span><span class="op" id="4879577">]</span><span class="ident" id="4879578">typeId</span><span class="op" id="4879584">)</span><span class="op" id="4879585">)</span>&nbsp;<span class="op" id="4879587">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4879592">errorf</span><span class="op" id="4879598">(</span><span class="string" id="4879599">&#34;wrong&nbsp;type&nbsp;(%s)&nbsp;for&nbsp;received&nbsp;field&nbsp;%s.%s&#34;</span><span class="op" id="4879641">,</span>&nbsp;<span class="ident" id="4879643">localField</span><span class="op" id="4879653">.</span><span class="ident" id="4879654">Type</span><span class="op" id="4879658">,</span>&nbsp;<span class="ident" id="4879660">wireStruct</span><span class="op" id="4879670">.</span><span class="ident" id="4879671">Name</span><span class="op" id="4879675">,</span>&nbsp;<span class="ident" id="4879677">wireField</span><span class="op" id="4879686">.</span><span class="ident" id="4879687">Name</span><span class="op" id="4879691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4879695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4879699">op</span>&nbsp;<span class="op" id="4879702">:=</span>&nbsp;<span class="ident" id="4879705">dec</span><span class="op" id="4879708">.</span><span class="ident" id="4879709">decOpFor</span><span class="op" id="4879717">(</span><span class="ident" id="4879718">wireField</span><span class="op" id="4879727">.</span><span class="ident" id="4879728">Id</span><span class="op" id="4879730">,</span>&nbsp;<span class="ident" id="4879732">localField</span><span class="op" id="4879742">.</span><span class="ident" id="4879743">Type</span><span class="op" id="4879747">,</span>&nbsp;<span class="ident" id="4879749">localField</span><span class="op" id="4879759">.</span><span class="ident" id="4879760">Name</span><span class="op" id="4879764">,</span>&nbsp;<span class="ident" id="4879766">seen</span><span class="op" id="4879770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4879774">engine</span><span class="op" id="4879780">.</span><span class="ident" id="4879781">instr</span><span class="op" id="4879786">[</span><span class="ident" id="4879787">fieldnum</span><span class="op" id="4879795">]</span>&nbsp;<span class="op" id="4879797">=</span>&nbsp;<span class="ident" id="4879799">decInstr</span><span class="op" id="4879807">{</span><span class="op" id="4879808">*</span><span class="ident" id="4879809">op</span><span class="op" id="4879811">,</span>&nbsp;<span class="ident" id="4879813">fieldnum</span><span class="op" id="4879821">,</span>&nbsp;<span class="ident" id="4879823">localField</span><span class="op" id="4879833">.</span><span class="ident" id="4879834">Index</span><span class="op" id="4879839">,</span>&nbsp;<span class="ident" id="4879841">ovfl</span><span class="op" id="4879845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4879849">engine</span><span class="op" id="4879855">.</span><span class="ident" id="4879856">numInstr</span><span class="op" id="4879864">++</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4879868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4879871">return</span><br>
<span class="lineno"></span><span class="op" id="4879878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4879881">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type.</span><br>
<span class="lineno">1095</span><span class="keyword" id="4879943">func</span>&nbsp;<span class="op" id="4879948">(</span><span class="ident" id="4879949">dec</span>&nbsp;<span class="op" id="4879953">*</span><span class="ident" id="4879954">Decoder</span><span class="op" id="4879961">)</span>&nbsp;<span class="ident" id="4879963">getDecEnginePtr</span><span class="op" id="4879978">(</span><span class="ident" id="4879979">remoteId</span>&nbsp;<span class="ident" id="4879988">typeId</span><span class="op" id="4879994">,</span>&nbsp;<span class="ident" id="4879996">ut</span>&nbsp;<span class="op" id="4879999">*</span><span class="ident" id="4880000">userTypeInfo</span><span class="op" id="4880012">)</span>&nbsp;<span class="op" id="4880014">(</span><span class="ident" id="4880015">enginePtr</span>&nbsp;<span class="op" id="4880025">*</span><span class="op" id="4880026">*</span><span class="ident" id="4880027">decEngine</span><span class="op" id="4880036">,</span>&nbsp;<span class="ident" id="4880038">err</span>&nbsp;<span class="builtintype" id="4880042">error</span><span class="op" id="4880047">)</span>&nbsp;<span class="op" id="4880049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4880052">rt</span>&nbsp;<span class="op" id="4880055">:=</span>&nbsp;<span class="ident" id="4880058">ut</span><span class="op" id="4880060">.</span><span class="ident" id="4880061">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4880067">decoderMap</span><span class="op" id="4880077">,</span>&nbsp;<span class="ident" id="4880079">ok</span>&nbsp;<span class="op" id="4880082">:=</span>&nbsp;<span class="ident" id="4880085">dec</span><span class="op" id="4880088">.</span><span class="ident" id="4880089">decoderCache</span><span class="op" id="4880101">[</span><span class="ident" id="4880102">rt</span><span class="op" id="4880104">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4880107">if</span>&nbsp;<span class="op" id="4880110">!</span><span class="ident" id="4880111">ok</span>&nbsp;<span class="op" id="4880114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4880118">decoderMap</span>&nbsp;<span class="op" id="4880129">=</span>&nbsp;<span class="builtinfunc" id="4880131">make</span><span class="op" id="4880135">(</span><span class="keyword" id="4880136">map</span><span class="op" id="4880139">[</span><span class="ident" id="4880140">typeId</span><span class="op" id="4880146">]</span><span class="op" id="4880147">*</span><span class="op" id="4880148">*</span><span class="ident" id="4880149">decEngine</span><span class="op" id="4880158">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4880162">dec</span><span class="op" id="4880165">.</span><span class="ident" id="4880166">decoderCache</span><span class="op" id="4880178">[</span><span class="ident" id="4880179">rt</span><span class="op" id="4880181">]</span>&nbsp;<span class="op" id="4880183">=</span>&nbsp;<span class="ident" id="4880185">decoderMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4880197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4880200">if</span>&nbsp;<span class="ident" id="4880203">enginePtr</span><span class="op" id="4880212">,</span>&nbsp;<span class="ident" id="4880214">ok</span>&nbsp;<span class="op" id="4880217">=</span>&nbsp;<span class="ident" id="4880219">decoderMap</span><span class="op" id="4880229">[</span><span class="ident" id="4880230">remoteId</span><span class="op" id="4880238">]</span><span class="op" id="4880239">;</span>&nbsp;<span class="op" id="4880241">!</span><span class="ident" id="4880242">ok</span>&nbsp;<span class="op" id="4880245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880249">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4880328">enginePtr</span>&nbsp;<span class="op" id="4880338">=</span>&nbsp;<span class="builtinfunc" id="4880340">new</span><span class="op" id="4880343">(</span><span class="op" id="4880344">*</span><span class="ident" id="4880345">decEngine</span><span class="op" id="4880354">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4880358">decoderMap</span><span class="op" id="4880368">[</span><span class="ident" id="4880369">remoteId</span><span class="op" id="4880377">]</span>&nbsp;<span class="op" id="4880379">=</span>&nbsp;<span class="ident" id="4880381">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4880393">*</span><span class="ident" id="4880394">enginePtr</span><span class="op" id="4880403">,</span>&nbsp;<span class="ident" id="4880405">err</span>&nbsp;<span class="op" id="4880409">=</span>&nbsp;<span class="ident" id="4880411">dec</span><span class="op" id="4880414">.</span><span class="ident" id="4880415">compileDec</span><span class="op" id="4880425">(</span><span class="ident" id="4880426">remoteId</span><span class="op" id="4880434">,</span>&nbsp;<span class="ident" id="4880436">ut</span><span class="op" id="4880438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4880442">if</span>&nbsp;<span class="ident" id="4880445">err</span>&nbsp;<span class="op" id="4880449">!=</span>&nbsp;<span class="ident" id="4880452">nil</span>&nbsp;<span class="op" id="4880456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4880461">delete</span><span class="op" id="4880467">(</span><span class="ident" id="4880468">decoderMap</span><span class="op" id="4880478">,</span>&nbsp;<span class="ident" id="4880480">remoteId</span><span class="op" id="4880488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4880492">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4880495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4880498">return</span><br>
<span class="lineno"></span><span class="op" id="4880505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4880508">//&nbsp;emptyStruct&nbsp;is&nbsp;the&nbsp;type&nbsp;we&nbsp;compile&nbsp;into&nbsp;when&nbsp;ignoring&nbsp;a&nbsp;struct&nbsp;value.</span><br>
<span class="lineno">1115</span><span class="keyword" id="4880581">type</span>&nbsp;<span class="ident" id="4880586">emptyStruct</span>&nbsp;<span class="keyword" id="4880598">struct</span><span class="op" id="4880604">{</span><span class="op" id="4880605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4880608">var</span>&nbsp;<span class="ident" id="4880612">emptyStructType</span>&nbsp;<span class="op" id="4880628">=</span>&nbsp;<span class="ident" id="4880630">reflect</span><span class="op" id="4880637">.</span><span class="ident" id="4880638">TypeOf</span><span class="op" id="4880644">(</span><span class="ident" id="4880645">emptyStruct</span><span class="op" id="4880656">{</span><span class="op" id="4880657">}</span><span class="op" id="4880658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4880661">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;to&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">1120</span><span class="keyword" id="4880757">func</span>&nbsp;<span class="op" id="4880762">(</span><span class="ident" id="4880763">dec</span>&nbsp;<span class="op" id="4880767">*</span><span class="ident" id="4880768">Decoder</span><span class="op" id="4880775">)</span>&nbsp;<span class="ident" id="4880777">getIgnoreEnginePtr</span><span class="op" id="4880795">(</span><span class="ident" id="4880796">wireId</span>&nbsp;<span class="ident" id="4880803">typeId</span><span class="op" id="4880809">)</span>&nbsp;<span class="op" id="4880811">(</span><span class="ident" id="4880812">enginePtr</span>&nbsp;<span class="op" id="4880822">*</span><span class="op" id="4880823">*</span><span class="ident" id="4880824">decEngine</span><span class="op" id="4880833">,</span>&nbsp;<span class="ident" id="4880835">err</span>&nbsp;<span class="builtintype" id="4880839">error</span><span class="op" id="4880844">)</span>&nbsp;<span class="op" id="4880846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4880849">var</span>&nbsp;<span class="ident" id="4880853">ok</span>&nbsp;<span class="builtintype" id="4880856">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4880862">if</span>&nbsp;<span class="ident" id="4880865">enginePtr</span><span class="op" id="4880874">,</span>&nbsp;<span class="ident" id="4880876">ok</span>&nbsp;<span class="op" id="4880879">=</span>&nbsp;<span class="ident" id="4880881">dec</span><span class="op" id="4880884">.</span><span class="ident" id="4880885">ignorerCache</span><span class="op" id="4880897">[</span><span class="ident" id="4880898">wireId</span><span class="op" id="4880904">]</span><span class="op" id="4880905">;</span>&nbsp;<span class="op" id="4880907">!</span><span class="ident" id="4880908">ok</span>&nbsp;<span class="op" id="4880911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880915">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4880994">enginePtr</span>&nbsp;<span class="op" id="4881004">=</span>&nbsp;<span class="builtinfunc" id="4881006">new</span><span class="op" id="4881009">(</span><span class="op" id="4881010">*</span><span class="ident" id="4881011">decEngine</span><span class="op" id="4881020">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881024">dec</span><span class="op" id="4881027">.</span><span class="ident" id="4881028">ignorerCache</span><span class="op" id="4881040">[</span><span class="ident" id="4881041">wireId</span><span class="op" id="4881047">]</span>&nbsp;<span class="op" id="4881049">=</span>&nbsp;<span class="ident" id="4881051">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881063">wire</span>&nbsp;<span class="op" id="4881068">:=</span>&nbsp;<span class="ident" id="4881071">dec</span><span class="op" id="4881074">.</span><span class="ident" id="4881075">wireType</span><span class="op" id="4881083">[</span><span class="ident" id="4881084">wireId</span><span class="op" id="4881090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881094">if</span>&nbsp;<span class="ident" id="4881097">wire</span>&nbsp;<span class="op" id="4881102">!=</span>&nbsp;<span class="ident" id="4881105">nil</span>&nbsp;<span class="op" id="4881109">&amp;&amp;</span>&nbsp;<span class="ident" id="4881112">wire</span><span class="op" id="4881116">.</span><span class="ident" id="4881117">StructT</span>&nbsp;<span class="op" id="4881125">!=</span>&nbsp;<span class="ident" id="4881128">nil</span>&nbsp;<span class="op" id="4881132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881137">*</span><span class="ident" id="4881138">enginePtr</span><span class="op" id="4881147">,</span>&nbsp;<span class="ident" id="4881149">err</span>&nbsp;<span class="op" id="4881153">=</span>&nbsp;<span class="ident" id="4881155">dec</span><span class="op" id="4881158">.</span><span class="ident" id="4881159">compileDec</span><span class="op" id="4881169">(</span><span class="ident" id="4881170">wireId</span><span class="op" id="4881176">,</span>&nbsp;<span class="ident" id="4881178">userType</span><span class="op" id="4881186">(</span><span class="ident" id="4881187">emptyStructType</span><span class="op" id="4881202">)</span><span class="op" id="4881203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881207">}</span>&nbsp;<span class="keyword" id="4881209">else</span>&nbsp;<span class="op" id="4881214">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881219">*</span><span class="ident" id="4881220">enginePtr</span><span class="op" id="4881229">,</span>&nbsp;<span class="ident" id="4881231">err</span>&nbsp;<span class="op" id="4881235">=</span>&nbsp;<span class="ident" id="4881237">dec</span><span class="op" id="4881240">.</span><span class="ident" id="4881241">compileIgnoreSingle</span><span class="op" id="4881260">(</span><span class="ident" id="4881261">wireId</span><span class="op" id="4881267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881275">if</span>&nbsp;<span class="ident" id="4881278">err</span>&nbsp;<span class="op" id="4881282">!=</span>&nbsp;<span class="ident" id="4881285">nil</span>&nbsp;<span class="op" id="4881289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4881294">delete</span><span class="op" id="4881300">(</span><span class="ident" id="4881301">dec</span><span class="op" id="4881304">.</span><span class="ident" id="4881305">ignorerCache</span><span class="op" id="4881317">,</span>&nbsp;<span class="ident" id="4881319">wireId</span><span class="op" id="4881325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881329">}</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881335">return</span><br>
<span class="lineno"></span><span class="op" id="4881342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4881345">//&nbsp;decodeValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">1140</span><span class="keyword" id="4881429">func</span>&nbsp;<span class="op" id="4881434">(</span><span class="ident" id="4881435">dec</span>&nbsp;<span class="op" id="4881439">*</span><span class="ident" id="4881440">Decoder</span><span class="op" id="4881447">)</span>&nbsp;<span class="ident" id="4881449">decodeValue</span><span class="op" id="4881460">(</span><span class="ident" id="4881461">wireId</span>&nbsp;<span class="ident" id="4881468">typeId</span><span class="op" id="4881474">,</span>&nbsp;<span class="ident" id="4881476">value</span>&nbsp;<span class="ident" id="4881482">reflect</span><span class="op" id="4881489">.</span><span class="ident" id="4881490">Value</span><span class="op" id="4881495">)</span>&nbsp;<span class="op" id="4881497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881500">defer</span>&nbsp;<span class="ident" id="4881506">catchError</span><span class="op" id="4881516">(</span><span class="op" id="4881517">&amp;</span><span class="ident" id="4881518">dec</span><span class="op" id="4881521">.</span><span class="ident" id="4881522">err</span><span class="op" id="4881525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881528">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;nil,&nbsp;it&nbsp;means&nbsp;we&nbsp;should&nbsp;just&nbsp;ignore&nbsp;this&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881595">if</span>&nbsp;<span class="op" id="4881598">!</span><span class="ident" id="4881599">value</span><span class="op" id="4881604">.</span><span class="ident" id="4881605">IsValid</span><span class="op" id="4881612">(</span><span class="op" id="4881613">)</span>&nbsp;<span class="op" id="4881615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881619">dec</span><span class="op" id="4881622">.</span><span class="ident" id="4881623">decodeIgnoredValue</span><span class="op" id="4881641">(</span><span class="ident" id="4881642">wireId</span><span class="op" id="4881648">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881652">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881663">//&nbsp;Dereference&nbsp;down&nbsp;to&nbsp;the&nbsp;underlying&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881708">ut</span>&nbsp;<span class="op" id="4881711">:=</span>&nbsp;<span class="ident" id="4881714">userType</span><span class="op" id="4881722">(</span><span class="ident" id="4881723">value</span><span class="op" id="4881728">.</span><span class="ident" id="4881729">Type</span><span class="op" id="4881733">(</span><span class="op" id="4881734">)</span><span class="op" id="4881735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881738">base</span>&nbsp;<span class="op" id="4881743">:=</span>&nbsp;<span class="ident" id="4881746">ut</span><span class="op" id="4881748">.</span><span class="ident" id="4881749">base</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881755">var</span>&nbsp;<span class="ident" id="4881759">enginePtr</span>&nbsp;<span class="op" id="4881769">*</span><span class="op" id="4881770">*</span><span class="ident" id="4881771">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881782">enginePtr</span><span class="op" id="4881791">,</span>&nbsp;<span class="ident" id="4881793">dec</span><span class="op" id="4881796">.</span><span class="ident" id="4881797">err</span>&nbsp;<span class="op" id="4881801">=</span>&nbsp;<span class="ident" id="4881803">dec</span><span class="op" id="4881806">.</span><span class="ident" id="4881807">getDecEnginePtr</span><span class="op" id="4881822">(</span><span class="ident" id="4881823">wireId</span><span class="op" id="4881829">,</span>&nbsp;<span class="ident" id="4881831">ut</span><span class="op" id="4881833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881836">if</span>&nbsp;<span class="ident" id="4881839">dec</span><span class="op" id="4881842">.</span><span class="ident" id="4881843">err</span>&nbsp;<span class="op" id="4881847">!=</span>&nbsp;<span class="ident" id="4881850">nil</span>&nbsp;<span class="op" id="4881854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881858">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4881866">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881869">value</span>&nbsp;<span class="op" id="4881875">=</span>&nbsp;<span class="ident" id="4881877">decAlloc</span><span class="op" id="4881885">(</span><span class="ident" id="4881886">value</span><span class="op" id="4881891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881894">engine</span>&nbsp;<span class="op" id="4881901">:=</span>&nbsp;<span class="op" id="4881904">*</span><span class="ident" id="4881905">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881916">if</span>&nbsp;<span class="ident" id="4881919">st</span>&nbsp;<span class="op" id="4881922">:=</span>&nbsp;<span class="ident" id="4881925">base</span><span class="op" id="4881929">;</span>&nbsp;<span class="ident" id="4881931">st</span><span class="op" id="4881933">.</span><span class="ident" id="4881934">Kind</span><span class="op" id="4881938">(</span><span class="op" id="4881939">)</span>&nbsp;<span class="op" id="4881941">==</span>&nbsp;<span class="ident" id="4881944">reflect</span><span class="op" id="4881951">.</span><span class="ident" id="4881952">Struct</span>&nbsp;<span class="op" id="4881959">&amp;&amp;</span>&nbsp;<span class="ident" id="4881962">ut</span><span class="op" id="4881964">.</span><span class="ident" id="4881965">externalDec</span>&nbsp;<span class="op" id="4881977">==</span>&nbsp;<span class="num" id="4881980">0</span>&nbsp;<span class="op" id="4881982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4881986">if</span>&nbsp;<span class="ident" id="4881989">engine</span><span class="op" id="4881995">.</span><span class="ident" id="4881996">numInstr</span>&nbsp;<span class="op" id="4882005">==</span>&nbsp;<span class="num" id="4882008">0</span>&nbsp;<span class="op" id="4882010">&amp;&amp;</span>&nbsp;<span class="ident" id="4882013">st</span><span class="op" id="4882015">.</span><span class="ident" id="4882016">NumField</span><span class="op" id="4882024">(</span><span class="op" id="4882025">)</span>&nbsp;<span class="op" id="4882027">&gt;</span>&nbsp;<span class="num" id="4882029">0</span>&nbsp;<span class="op" id="4882031">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882037">dec</span><span class="op" id="4882040">.</span><span class="ident" id="4882041">wireType</span><span class="op" id="4882049">[</span><span class="ident" id="4882050">wireId</span><span class="op" id="4882056">]</span>&nbsp;<span class="op" id="4882058">!=</span>&nbsp;<span class="ident" id="4882061">nil</span>&nbsp;<span class="op" id="4882065">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4882068">len</span><span class="op" id="4882071">(</span><span class="ident" id="4882072">dec</span><span class="op" id="4882075">.</span><span class="ident" id="4882076">wireType</span><span class="op" id="4882084">[</span><span class="ident" id="4882085">wireId</span><span class="op" id="4882091">]</span><span class="op" id="4882092">.</span><span class="ident" id="4882093">StructT</span><span class="op" id="4882100">.</span><span class="ident" id="4882101">Field</span><span class="op" id="4882106">)</span>&nbsp;<span class="op" id="4882108">&gt;</span>&nbsp;<span class="num" id="4882110">0</span>&nbsp;<span class="op" id="4882112">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882117">name</span>&nbsp;<span class="op" id="4882122">:=</span>&nbsp;<span class="ident" id="4882125">base</span><span class="op" id="4882129">.</span><span class="ident" id="4882130">Name</span><span class="op" id="4882134">(</span><span class="op" id="4882135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882140">errorf</span><span class="op" id="4882146">(</span><span class="string" id="4882147">&#34;type&nbsp;mismatch:&nbsp;no&nbsp;fields&nbsp;matched&nbsp;compiling&nbsp;decoder&nbsp;for&nbsp;%s&#34;</span><span class="op" id="4882206">,</span>&nbsp;<span class="ident" id="4882208">name</span><span class="op" id="4882212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4882216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882220">dec</span><span class="op" id="4882223">.</span><span class="ident" id="4882224">decodeStruct</span><span class="op" id="4882236">(</span><span class="ident" id="4882237">engine</span><span class="op" id="4882243">,</span>&nbsp;<span class="ident" id="4882245">ut</span><span class="op" id="4882247">,</span>&nbsp;<span class="ident" id="4882249">value</span><span class="op" id="4882254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4882257">}</span>&nbsp;<span class="keyword" id="4882259">else</span>&nbsp;<span class="op" id="4882264">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882268">dec</span><span class="op" id="4882271">.</span><span class="ident" id="4882272">decodeSingle</span><span class="op" id="4882284">(</span><span class="ident" id="4882285">engine</span><span class="op" id="4882291">,</span>&nbsp;<span class="ident" id="4882293">ut</span><span class="op" id="4882295">,</span>&nbsp;<span class="ident" id="4882297">value</span><span class="op" id="4882302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4882305">}</span><br>
<span class="lineno"></span><span class="op" id="4882307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4882310">//&nbsp;decodeIgnoredValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;and&nbsp;discards&nbsp;it.</span><br>
<span class="lineno">1170</span><span class="keyword" id="4882416">func</span>&nbsp;<span class="op" id="4882421">(</span><span class="ident" id="4882422">dec</span>&nbsp;<span class="op" id="4882426">*</span><span class="ident" id="4882427">Decoder</span><span class="op" id="4882434">)</span>&nbsp;<span class="ident" id="4882436">decodeIgnoredValue</span><span class="op" id="4882454">(</span><span class="ident" id="4882455">wireId</span>&nbsp;<span class="ident" id="4882462">typeId</span><span class="op" id="4882468">)</span>&nbsp;<span class="op" id="4882470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882473">var</span>&nbsp;<span class="ident" id="4882477">enginePtr</span>&nbsp;<span class="op" id="4882487">*</span><span class="op" id="4882488">*</span><span class="ident" id="4882489">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882500">enginePtr</span><span class="op" id="4882509">,</span>&nbsp;<span class="ident" id="4882511">dec</span><span class="op" id="4882514">.</span><span class="ident" id="4882515">err</span>&nbsp;<span class="op" id="4882519">=</span>&nbsp;<span class="ident" id="4882521">dec</span><span class="op" id="4882524">.</span><span class="ident" id="4882525">getIgnoreEnginePtr</span><span class="op" id="4882543">(</span><span class="ident" id="4882544">wireId</span><span class="op" id="4882550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882553">if</span>&nbsp;<span class="ident" id="4882556">dec</span><span class="op" id="4882559">.</span><span class="ident" id="4882560">err</span>&nbsp;<span class="op" id="4882564">!=</span>&nbsp;<span class="ident" id="4882567">nil</span>&nbsp;<span class="op" id="4882571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882575">return</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4882583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882586">wire</span>&nbsp;<span class="op" id="4882591">:=</span>&nbsp;<span class="ident" id="4882594">dec</span><span class="op" id="4882597">.</span><span class="ident" id="4882598">wireType</span><span class="op" id="4882606">[</span><span class="ident" id="4882607">wireId</span><span class="op" id="4882613">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882616">if</span>&nbsp;<span class="ident" id="4882619">wire</span>&nbsp;<span class="op" id="4882624">!=</span>&nbsp;<span class="ident" id="4882627">nil</span>&nbsp;<span class="op" id="4882631">&amp;&amp;</span>&nbsp;<span class="ident" id="4882634">wire</span><span class="op" id="4882638">.</span><span class="ident" id="4882639">StructT</span>&nbsp;<span class="op" id="4882647">!=</span>&nbsp;<span class="ident" id="4882650">nil</span>&nbsp;<span class="op" id="4882654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882658">dec</span><span class="op" id="4882661">.</span><span class="ident" id="4882662">ignoreStruct</span><span class="op" id="4882674">(</span><span class="op" id="4882675">*</span><span class="ident" id="4882676">enginePtr</span><span class="op" id="4882685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4882688">}</span>&nbsp;<span class="keyword" id="4882690">else</span>&nbsp;<span class="op" id="4882695">{</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882699">dec</span><span class="op" id="4882702">.</span><span class="ident" id="4882703">ignoreSingle</span><span class="op" id="4882715">(</span><span class="op" id="4882716">*</span><span class="ident" id="4882717">enginePtr</span><span class="op" id="4882726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4882729">}</span><br>
<span class="lineno"></span><span class="op" id="4882731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4882734">func</span>&nbsp;<span class="ident" id="4882739">init</span><span class="op" id="4882743">(</span><span class="op" id="4882744">)</span>&nbsp;<span class="op" id="4882746">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882749">var</span>&nbsp;<span class="ident" id="4882753">iop</span><span class="op" id="4882756">,</span>&nbsp;<span class="ident" id="4882758">uop</span>&nbsp;<span class="ident" id="4882762">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882769">switch</span>&nbsp;<span class="ident" id="4882776">reflect</span><span class="op" id="4882783">.</span><span class="ident" id="4882784">TypeOf</span><span class="op" id="4882790">(</span><span class="builtintype" id="4882791">int</span><span class="op" id="4882794">(</span><span class="num" id="4882795">0</span><span class="op" id="4882796">)</span><span class="op" id="4882797">)</span><span class="op" id="4882798">.</span><span class="ident" id="4882799">Bits</span><span class="op" id="4882803">(</span><span class="op" id="4882804">)</span>&nbsp;<span class="op" id="4882806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882809">case</span>&nbsp;<span class="num" id="4882814">32</span><span class="op" id="4882816">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882820">iop</span>&nbsp;<span class="op" id="4882824">=</span>&nbsp;<span class="ident" id="4882826">decInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882837">uop</span>&nbsp;<span class="op" id="4882841">=</span>&nbsp;<span class="ident" id="4882843">decUint32</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882854">case</span>&nbsp;<span class="num" id="4882859">64</span><span class="op" id="4882861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882865">iop</span>&nbsp;<span class="op" id="4882869">=</span>&nbsp;<span class="ident" id="4882871">decInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882882">uop</span>&nbsp;<span class="op" id="4882886">=</span>&nbsp;<span class="ident" id="4882888">decUint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4882899">default</span><span class="op" id="4882906">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4882910">panic</span><span class="op" id="4882915">(</span><span class="string" id="4882916">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;int/uint&#34;</span><span class="op" id="4882947">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4882950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882953">decOpTable</span><span class="op" id="4882963">[</span><span class="ident" id="4882964">reflect</span><span class="op" id="4882971">.</span><span class="ident" id="4882972">Int</span><span class="op" id="4882975">]</span>&nbsp;<span class="op" id="4882977">=</span>&nbsp;<span class="ident" id="4882979">iop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882984">decOpTable</span><span class="op" id="4882994">[</span><span class="ident" id="4882995">reflect</span><span class="op" id="4883002">.</span><span class="ident" id="4883003">Uint</span><span class="op" id="4883007">]</span>&nbsp;<span class="op" id="4883009">=</span>&nbsp;<span class="ident" id="4883011">uop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883017">//&nbsp;Finally&nbsp;uintptr</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883037">switch</span>&nbsp;<span class="ident" id="4883044">reflect</span><span class="op" id="4883051">.</span><span class="ident" id="4883052">TypeOf</span><span class="op" id="4883058">(</span><span class="builtintype" id="4883059">uintptr</span><span class="op" id="4883066">(</span><span class="num" id="4883067">0</span><span class="op" id="4883068">)</span><span class="op" id="4883069">)</span><span class="op" id="4883070">.</span><span class="ident" id="4883071">Bits</span><span class="op" id="4883075">(</span><span class="op" id="4883076">)</span>&nbsp;<span class="op" id="4883078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883081">case</span>&nbsp;<span class="num" id="4883086">32</span><span class="op" id="4883088">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883092">uop</span>&nbsp;<span class="op" id="4883096">=</span>&nbsp;<span class="ident" id="4883098">decUint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883109">case</span>&nbsp;<span class="num" id="4883114">64</span><span class="op" id="4883116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883120">uop</span>&nbsp;<span class="op" id="4883124">=</span>&nbsp;<span class="ident" id="4883126">decUint64</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883137">default</span><span class="op" id="4883144">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4883148">panic</span><span class="op" id="4883153">(</span><span class="string" id="4883154">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;uintptr&#34;</span><span class="op" id="4883184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4883187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883190">decOpTable</span><span class="op" id="4883200">[</span><span class="ident" id="4883201">reflect</span><span class="op" id="4883208">.</span><span class="ident" id="4883209">Uintptr</span><span class="op" id="4883216">]</span>&nbsp;<span class="op" id="4883218">=</span>&nbsp;<span class="ident" id="4883220">uop</span><br>
<span class="lineno"></span><span class="op" id="4883224">}</span><br>
<span class="lineno">1210</span><br>
<span class="lineno"></span><span class="comment" id="4883227">//&nbsp;Gob&nbsp;depends&nbsp;on&nbsp;being&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="4883276">//&nbsp;of&nbsp;zeroed&nbsp;Values&nbsp;it&nbsp;creates,&nbsp;so&nbsp;use&nbsp;this&nbsp;wrapper&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4883336">//&nbsp;of&nbsp;the&nbsp;standard&nbsp;reflect.Zero.</span><br>
<span class="lineno"></span><span class="comment" id="4883369">//&nbsp;Each&nbsp;call&nbsp;allocates&nbsp;once.</span><br>
<span class="lineno">1215</span><span class="keyword" id="4883398">func</span>&nbsp;<span class="ident" id="4883403">allocValue</span><span class="op" id="4883413">(</span><span class="ident" id="4883414">t</span>&nbsp;<span class="ident" id="4883416">reflect</span><span class="op" id="4883423">.</span><span class="ident" id="4883424">Type</span><span class="op" id="4883428">)</span>&nbsp;<span class="ident" id="4883430">reflect</span><span class="op" id="4883437">.</span><span class="ident" id="4883438">Value</span>&nbsp;<span class="op" id="4883444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883447">return</span>&nbsp;<span class="ident" id="4883454">reflect</span><span class="op" id="4883461">.</span><span class="ident" id="4883462">New</span><span class="op" id="4883465">(</span><span class="ident" id="4883466">t</span><span class="op" id="4883467">)</span><span class="op" id="4883468">.</span><span class="ident" id="4883469">Elem</span><span class="op" id="4883473">(</span><span class="op" id="4883474">)</span><br>
<span class="lineno"></span><span class="op" id="4883476">}</span>
</div>
</body>
</html>
