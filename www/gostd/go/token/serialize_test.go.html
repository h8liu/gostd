<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7254233">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7254288">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7254342">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7254393">package</span>&nbsp;<span class="ident" id="7254401">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7254408">import</span>&nbsp;<span class="op" id="7254415">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7254418">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7254427">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7254443">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7254450">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7254460">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7254463">//&nbsp;equal&nbsp;returns&nbsp;nil&nbsp;if&nbsp;p&nbsp;and&nbsp;q&nbsp;describe&nbsp;the&nbsp;same&nbsp;file&nbsp;set;</span><br>
<span class="lineno">15</span><span class="comment" id="7254523">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;discrepancy.</span><br>
<span class="lineno"></span><span class="keyword" id="7254584">func</span>&nbsp;<span class="ident" id="7254589">equal</span><span class="op" id="7254594">(</span><span class="ident" id="7254595">p</span><span class="op" id="7254596">,</span>&nbsp;<span class="ident" id="7254598">q</span>&nbsp;<span class="op" id="7254600">*</span><span class="ident" id="7254601">FileSet</span><span class="op" id="7254608">)</span>&nbsp;<span class="builtintype" id="7254610">error</span>&nbsp;<span class="op" id="7254616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7254619">if</span>&nbsp;<span class="ident" id="7254622">p</span>&nbsp;<span class="op" id="7254624">==</span>&nbsp;<span class="ident" id="7254627">q</span>&nbsp;<span class="op" id="7254629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7254633">//&nbsp;avoid&nbsp;deadlock&nbsp;if&nbsp;p&nbsp;==&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7254663">return</span>&nbsp;<span class="ident" id="7254670">nil</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7254675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7254679">//&nbsp;not&nbsp;strictly&nbsp;needed&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7254716">p</span><span class="op" id="7254717">.</span><span class="ident" id="7254718">mutex</span><span class="op" id="7254723">.</span><span class="ident" id="7254724">Lock</span><span class="op" id="7254728">(</span><span class="op" id="7254729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7254732">q</span><span class="op" id="7254733">.</span><span class="ident" id="7254734">mutex</span><span class="op" id="7254739">.</span><span class="ident" id="7254740">Lock</span><span class="op" id="7254744">(</span><span class="op" id="7254745">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7254748">defer</span>&nbsp;<span class="ident" id="7254754">q</span><span class="op" id="7254755">.</span><span class="ident" id="7254756">mutex</span><span class="op" id="7254761">.</span><span class="ident" id="7254762">Unlock</span><span class="op" id="7254768">(</span><span class="op" id="7254769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7254772">defer</span>&nbsp;<span class="ident" id="7254778">p</span><span class="op" id="7254779">.</span><span class="ident" id="7254780">mutex</span><span class="op" id="7254785">.</span><span class="ident" id="7254786">Unlock</span><span class="op" id="7254792">(</span><span class="op" id="7254793">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7254797">if</span>&nbsp;<span class="ident" id="7254800">p</span><span class="op" id="7254801">.</span><span class="ident" id="7254802">base</span>&nbsp;<span class="op" id="7254807">!=</span>&nbsp;<span class="ident" id="7254810">q</span><span class="op" id="7254811">.</span><span class="ident" id="7254812">base</span>&nbsp;<span class="op" id="7254817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7254821">return</span>&nbsp;<span class="ident" id="7254828">fmt</span><span class="op" id="7254831">.</span><span class="ident" id="7254832">Errorf</span><span class="op" id="7254838">(</span><span class="string" id="7254839">&#34;different&nbsp;bases:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7254866">,</span>&nbsp;<span class="ident" id="7254868">p</span><span class="op" id="7254869">.</span><span class="ident" id="7254870">base</span><span class="op" id="7254874">,</span>&nbsp;<span class="ident" id="7254876">q</span><span class="op" id="7254877">.</span><span class="ident" id="7254878">base</span><span class="op" id="7254882">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7254885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7254889">if</span>&nbsp;<span class="builtinfunc" id="7254892">len</span><span class="op" id="7254895">(</span><span class="ident" id="7254896">p</span><span class="op" id="7254897">.</span><span class="ident" id="7254898">files</span><span class="op" id="7254903">)</span>&nbsp;<span class="op" id="7254905">!=</span>&nbsp;<span class="builtinfunc" id="7254908">len</span><span class="op" id="7254911">(</span><span class="ident" id="7254912">q</span><span class="op" id="7254913">.</span><span class="ident" id="7254914">files</span><span class="op" id="7254919">)</span>&nbsp;<span class="op" id="7254921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7254925">return</span>&nbsp;<span class="ident" id="7254932">fmt</span><span class="op" id="7254935">.</span><span class="ident" id="7254936">Errorf</span><span class="op" id="7254942">(</span><span class="string" id="7254943">&#34;different&nbsp;number&nbsp;of&nbsp;files:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7254980">,</span>&nbsp;<span class="builtinfunc" id="7254982">len</span><span class="op" id="7254985">(</span><span class="ident" id="7254986">p</span><span class="op" id="7254987">.</span><span class="ident" id="7254988">files</span><span class="op" id="7254993">)</span><span class="op" id="7254994">,</span>&nbsp;<span class="builtinfunc" id="7254996">len</span><span class="op" id="7254999">(</span><span class="ident" id="7255000">q</span><span class="op" id="7255001">.</span><span class="ident" id="7255002">files</span><span class="op" id="7255007">)</span><span class="op" id="7255008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7255011">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255015">for</span>&nbsp;<span class="ident" id="7255019">i</span><span class="op" id="7255020">,</span>&nbsp;<span class="ident" id="7255022">f</span>&nbsp;<span class="op" id="7255024">:=</span>&nbsp;<span class="keyword" id="7255027">range</span>&nbsp;<span class="ident" id="7255033">p</span><span class="op" id="7255034">.</span><span class="ident" id="7255035">files</span>&nbsp;<span class="op" id="7255041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7255045">g</span>&nbsp;<span class="op" id="7255047">:=</span>&nbsp;<span class="ident" id="7255050">q</span><span class="op" id="7255051">.</span><span class="ident" id="7255052">files</span><span class="op" id="7255057">[</span><span class="ident" id="7255058">i</span><span class="op" id="7255059">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255063">if</span>&nbsp;<span class="ident" id="7255066">f</span><span class="op" id="7255067">.</span><span class="ident" id="7255068">set</span>&nbsp;<span class="op" id="7255072">!=</span>&nbsp;<span class="ident" id="7255075">p</span>&nbsp;<span class="op" id="7255077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255082">return</span>&nbsp;<span class="ident" id="7255089">fmt</span><span class="op" id="7255092">.</span><span class="ident" id="7255093">Errorf</span><span class="op" id="7255099">(</span><span class="string" id="7255100">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7255122">,</span>&nbsp;<span class="ident" id="7255124">f</span><span class="op" id="7255125">.</span><span class="ident" id="7255126">name</span><span class="op" id="7255130">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7255134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255138">if</span>&nbsp;<span class="ident" id="7255141">g</span><span class="op" id="7255142">.</span><span class="ident" id="7255143">set</span>&nbsp;<span class="op" id="7255147">!=</span>&nbsp;<span class="ident" id="7255150">q</span>&nbsp;<span class="op" id="7255152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255157">return</span>&nbsp;<span class="ident" id="7255164">fmt</span><span class="op" id="7255167">.</span><span class="ident" id="7255168">Errorf</span><span class="op" id="7255174">(</span><span class="string" id="7255175">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7255197">,</span>&nbsp;<span class="ident" id="7255199">g</span><span class="op" id="7255200">.</span><span class="ident" id="7255201">name</span><span class="op" id="7255205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7255209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255213">if</span>&nbsp;<span class="ident" id="7255216">f</span><span class="op" id="7255217">.</span><span class="ident" id="7255218">name</span>&nbsp;<span class="op" id="7255223">!=</span>&nbsp;<span class="ident" id="7255226">g</span><span class="op" id="7255227">.</span><span class="ident" id="7255228">name</span>&nbsp;<span class="op" id="7255233">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255238">return</span>&nbsp;<span class="ident" id="7255245">fmt</span><span class="op" id="7255248">.</span><span class="ident" id="7255249">Errorf</span><span class="op" id="7255255">(</span><span class="string" id="7255256">&#34;different&nbsp;filenames:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="7255287">,</span>&nbsp;<span class="ident" id="7255289">f</span><span class="op" id="7255290">.</span><span class="ident" id="7255291">name</span><span class="op" id="7255295">,</span>&nbsp;<span class="ident" id="7255297">g</span><span class="op" id="7255298">.</span><span class="ident" id="7255299">name</span><span class="op" id="7255303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7255307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255311">if</span>&nbsp;<span class="ident" id="7255314">f</span><span class="op" id="7255315">.</span><span class="ident" id="7255316">base</span>&nbsp;<span class="op" id="7255321">!=</span>&nbsp;<span class="ident" id="7255324">g</span><span class="op" id="7255325">.</span><span class="ident" id="7255326">base</span>&nbsp;<span class="op" id="7255331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255336">return</span>&nbsp;<span class="ident" id="7255343">fmt</span><span class="op" id="7255346">.</span><span class="ident" id="7255347">Errorf</span><span class="op" id="7255353">(</span><span class="string" id="7255354">&#34;different&nbsp;base&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7255387">,</span>&nbsp;<span class="ident" id="7255389">f</span><span class="op" id="7255390">.</span><span class="ident" id="7255391">name</span><span class="op" id="7255395">,</span>&nbsp;<span class="ident" id="7255397">f</span><span class="op" id="7255398">.</span><span class="ident" id="7255399">base</span><span class="op" id="7255403">,</span>&nbsp;<span class="ident" id="7255405">g</span><span class="op" id="7255406">.</span><span class="ident" id="7255407">base</span><span class="op" id="7255411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7255415">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255419">if</span>&nbsp;<span class="ident" id="7255422">f</span><span class="op" id="7255423">.</span><span class="ident" id="7255424">size</span>&nbsp;<span class="op" id="7255429">!=</span>&nbsp;<span class="ident" id="7255432">g</span><span class="op" id="7255433">.</span><span class="ident" id="7255434">size</span>&nbsp;<span class="op" id="7255439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255444">return</span>&nbsp;<span class="ident" id="7255451">fmt</span><span class="op" id="7255454">.</span><span class="ident" id="7255455">Errorf</span><span class="op" id="7255461">(</span><span class="string" id="7255462">&#34;different&nbsp;size&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7255495">,</span>&nbsp;<span class="ident" id="7255497">f</span><span class="op" id="7255498">.</span><span class="ident" id="7255499">name</span><span class="op" id="7255503">,</span>&nbsp;<span class="ident" id="7255505">f</span><span class="op" id="7255506">.</span><span class="ident" id="7255507">size</span><span class="op" id="7255511">,</span>&nbsp;<span class="ident" id="7255513">g</span><span class="op" id="7255514">.</span><span class="ident" id="7255515">size</span><span class="op" id="7255519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7255523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255527">for</span>&nbsp;<span class="ident" id="7255531">j</span><span class="op" id="7255532">,</span>&nbsp;<span class="ident" id="7255534">l</span>&nbsp;<span class="op" id="7255536">:=</span>&nbsp;<span class="keyword" id="7255539">range</span>&nbsp;<span class="ident" id="7255545">f</span><span class="op" id="7255546">.</span><span class="ident" id="7255547">lines</span>&nbsp;<span class="op" id="7255553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7255558">m</span>&nbsp;<span class="op" id="7255560">:=</span>&nbsp;<span class="ident" id="7255563">g</span><span class="op" id="7255564">.</span><span class="ident" id="7255565">lines</span><span class="op" id="7255570">[</span><span class="ident" id="7255571">j</span><span class="op" id="7255572">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255577">if</span>&nbsp;<span class="ident" id="7255580">l</span>&nbsp;<span class="op" id="7255582">!=</span>&nbsp;<span class="ident" id="7255585">m</span>&nbsp;<span class="op" id="7255587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255593">return</span>&nbsp;<span class="ident" id="7255600">fmt</span><span class="op" id="7255603">.</span><span class="ident" id="7255604">Errorf</span><span class="op" id="7255610">(</span><span class="string" id="7255611">&#34;different&nbsp;offsets&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7255637">,</span>&nbsp;<span class="ident" id="7255639">f</span><span class="op" id="7255640">.</span><span class="ident" id="7255641">name</span><span class="op" id="7255645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7255650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7255654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255658">for</span>&nbsp;<span class="ident" id="7255662">j</span><span class="op" id="7255663">,</span>&nbsp;<span class="ident" id="7255665">l</span>&nbsp;<span class="op" id="7255667">:=</span>&nbsp;<span class="keyword" id="7255670">range</span>&nbsp;<span class="ident" id="7255676">f</span><span class="op" id="7255677">.</span><span class="ident" id="7255678">infos</span>&nbsp;<span class="op" id="7255684">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7255689">m</span>&nbsp;<span class="op" id="7255691">:=</span>&nbsp;<span class="ident" id="7255694">g</span><span class="op" id="7255695">.</span><span class="ident" id="7255696">infos</span><span class="op" id="7255701">[</span><span class="ident" id="7255702">j</span><span class="op" id="7255703">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255708">if</span>&nbsp;<span class="ident" id="7255711">l</span><span class="op" id="7255712">.</span><span class="ident" id="7255713">Offset</span>&nbsp;<span class="op" id="7255720">!=</span>&nbsp;<span class="ident" id="7255723">m</span><span class="op" id="7255724">.</span><span class="ident" id="7255725">Offset</span>&nbsp;<span class="op" id="7255732">||</span>&nbsp;<span class="ident" id="7255735">l</span><span class="op" id="7255736">.</span><span class="ident" id="7255737">Filename</span>&nbsp;<span class="op" id="7255746">!=</span>&nbsp;<span class="ident" id="7255749">m</span><span class="op" id="7255750">.</span><span class="ident" id="7255751">Filename</span>&nbsp;<span class="op" id="7255760">||</span>&nbsp;<span class="ident" id="7255763">l</span><span class="op" id="7255764">.</span><span class="ident" id="7255765">Line</span>&nbsp;<span class="op" id="7255770">!=</span>&nbsp;<span class="ident" id="7255773">m</span><span class="op" id="7255774">.</span><span class="ident" id="7255775">Line</span>&nbsp;<span class="op" id="7255780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255786">return</span>&nbsp;<span class="ident" id="7255793">fmt</span><span class="op" id="7255796">.</span><span class="ident" id="7255797">Errorf</span><span class="op" id="7255803">(</span><span class="string" id="7255804">&#34;different&nbsp;infos&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7255828">,</span>&nbsp;<span class="ident" id="7255830">f</span><span class="op" id="7255831">.</span><span class="ident" id="7255832">name</span><span class="op" id="7255836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7255841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7255845">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7255848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7255852">//&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;about&nbsp;.last&nbsp;-&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255902">return</span>&nbsp;<span class="ident" id="7255909">nil</span><br>
<span class="lineno"></span><span class="op" id="7255913">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7255916">func</span>&nbsp;<span class="ident" id="7255921">checkSerialize</span><span class="op" id="7255935">(</span><span class="ident" id="7255936">t</span>&nbsp;<span class="op" id="7255938">*</span><span class="ident" id="7255939">testing</span><span class="op" id="7255946">.</span><span class="ident" id="7255947">T</span><span class="op" id="7255948">,</span>&nbsp;<span class="ident" id="7255950">p</span>&nbsp;<span class="op" id="7255952">*</span><span class="ident" id="7255953">FileSet</span><span class="op" id="7255960">)</span>&nbsp;<span class="op" id="7255962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7255965">var</span>&nbsp;<span class="ident" id="7255969">buf</span>&nbsp;<span class="ident" id="7255973">bytes</span><span class="op" id="7255978">.</span><span class="ident" id="7255979">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7255987">encode</span>&nbsp;<span class="op" id="7255994">:=</span>&nbsp;<span class="keyword" id="7255997">func</span><span class="op" id="7256001">(</span><span class="ident" id="7256002">x</span>&nbsp;<span class="keyword" id="7256004">interface</span><span class="op" id="7256013">{</span><span class="op" id="7256014">}</span><span class="op" id="7256015">)</span>&nbsp;<span class="builtintype" id="7256017">error</span>&nbsp;<span class="op" id="7256023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7256027">return</span>&nbsp;<span class="ident" id="7256034">gob</span><span class="op" id="7256037">.</span><span class="ident" id="7256038">NewEncoder</span><span class="op" id="7256048">(</span><span class="op" id="7256049">&amp;</span><span class="ident" id="7256050">buf</span><span class="op" id="7256053">)</span><span class="op" id="7256054">.</span><span class="ident" id="7256055">Encode</span><span class="op" id="7256061">(</span><span class="ident" id="7256062">x</span><span class="op" id="7256063">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7256066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7256069">if</span>&nbsp;<span class="ident" id="7256072">err</span>&nbsp;<span class="op" id="7256076">:=</span>&nbsp;<span class="ident" id="7256079">p</span><span class="op" id="7256080">.</span><span class="ident" id="7256081">Write</span><span class="op" id="7256086">(</span><span class="ident" id="7256087">encode</span><span class="op" id="7256093">)</span><span class="op" id="7256094">;</span>&nbsp;<span class="ident" id="7256096">err</span>&nbsp;<span class="op" id="7256100">!=</span>&nbsp;<span class="ident" id="7256103">nil</span>&nbsp;<span class="op" id="7256107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256111">t</span><span class="op" id="7256112">.</span><span class="ident" id="7256113">Errorf</span><span class="op" id="7256119">(</span><span class="string" id="7256120">&#34;writing&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7256148">,</span>&nbsp;<span class="ident" id="7256150">err</span><span class="op" id="7256153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7256157">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7256165">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256168">q</span>&nbsp;<span class="op" id="7256170">:=</span>&nbsp;<span class="ident" id="7256173">NewFileSet</span><span class="op" id="7256183">(</span><span class="op" id="7256184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256187">decode</span>&nbsp;<span class="op" id="7256194">:=</span>&nbsp;<span class="keyword" id="7256197">func</span><span class="op" id="7256201">(</span><span class="ident" id="7256202">x</span>&nbsp;<span class="keyword" id="7256204">interface</span><span class="op" id="7256213">{</span><span class="op" id="7256214">}</span><span class="op" id="7256215">)</span>&nbsp;<span class="builtintype" id="7256217">error</span>&nbsp;<span class="op" id="7256223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7256227">return</span>&nbsp;<span class="ident" id="7256234">gob</span><span class="op" id="7256237">.</span><span class="ident" id="7256238">NewDecoder</span><span class="op" id="7256248">(</span><span class="op" id="7256249">&amp;</span><span class="ident" id="7256250">buf</span><span class="op" id="7256253">)</span><span class="op" id="7256254">.</span><span class="ident" id="7256255">Decode</span><span class="op" id="7256261">(</span><span class="ident" id="7256262">x</span><span class="op" id="7256263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7256266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7256269">if</span>&nbsp;<span class="ident" id="7256272">err</span>&nbsp;<span class="op" id="7256276">:=</span>&nbsp;<span class="ident" id="7256279">q</span><span class="op" id="7256280">.</span><span class="ident" id="7256281">Read</span><span class="op" id="7256285">(</span><span class="ident" id="7256286">decode</span><span class="op" id="7256292">)</span><span class="op" id="7256293">;</span>&nbsp;<span class="ident" id="7256295">err</span>&nbsp;<span class="op" id="7256299">!=</span>&nbsp;<span class="ident" id="7256302">nil</span>&nbsp;<span class="op" id="7256306">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256310">t</span><span class="op" id="7256311">.</span><span class="ident" id="7256312">Errorf</span><span class="op" id="7256318">(</span><span class="string" id="7256319">&#34;reading&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7256347">,</span>&nbsp;<span class="ident" id="7256349">err</span><span class="op" id="7256352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7256356">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7256364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7256367">if</span>&nbsp;<span class="ident" id="7256370">err</span>&nbsp;<span class="op" id="7256374">:=</span>&nbsp;<span class="ident" id="7256377">equal</span><span class="op" id="7256382">(</span><span class="ident" id="7256383">p</span><span class="op" id="7256384">,</span>&nbsp;<span class="ident" id="7256386">q</span><span class="op" id="7256387">)</span><span class="op" id="7256388">;</span>&nbsp;<span class="ident" id="7256390">err</span>&nbsp;<span class="op" id="7256394">!=</span>&nbsp;<span class="ident" id="7256397">nil</span>&nbsp;<span class="op" id="7256401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256405">t</span><span class="op" id="7256406">.</span><span class="ident" id="7256407">Errorf</span><span class="op" id="7256413">(</span><span class="string" id="7256414">&#34;filesets&nbsp;not&nbsp;identical:&nbsp;%s&#34;</span><span class="op" id="7256442">,</span>&nbsp;<span class="ident" id="7256444">err</span><span class="op" id="7256447">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7256450">}</span><br>
<span class="lineno"></span><span class="op" id="7256452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7256455">func</span>&nbsp;<span class="ident" id="7256460">TestSerialization</span><span class="op" id="7256477">(</span><span class="ident" id="7256478">t</span>&nbsp;<span class="op" id="7256480">*</span><span class="ident" id="7256481">testing</span><span class="op" id="7256488">.</span><span class="ident" id="7256489">T</span><span class="op" id="7256490">)</span>&nbsp;<span class="op" id="7256492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256495">p</span>&nbsp;<span class="op" id="7256497">:=</span>&nbsp;<span class="ident" id="7256500">NewFileSet</span><span class="op" id="7256510">(</span><span class="op" id="7256511">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256514">checkSerialize</span><span class="op" id="7256528">(</span><span class="ident" id="7256529">t</span><span class="op" id="7256530">,</span>&nbsp;<span class="ident" id="7256532">p</span><span class="op" id="7256533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7256536">//&nbsp;add&nbsp;some&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7256555">for</span>&nbsp;<span class="ident" id="7256559">i</span>&nbsp;<span class="op" id="7256561">:=</span>&nbsp;<span class="num" id="7256564">0</span><span class="op" id="7256565">;</span>&nbsp;<span class="ident" id="7256567">i</span>&nbsp;<span class="op" id="7256569">&lt;</span>&nbsp;<span class="num" id="7256571">10</span><span class="op" id="7256573">;</span>&nbsp;<span class="ident" id="7256575">i</span><span class="op" id="7256576">++</span>&nbsp;<span class="op" id="7256579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256583">f</span>&nbsp;<span class="op" id="7256585">:=</span>&nbsp;<span class="ident" id="7256588">p</span><span class="op" id="7256589">.</span><span class="ident" id="7256590">AddFile</span><span class="op" id="7256597">(</span><span class="ident" id="7256598">fmt</span><span class="op" id="7256601">.</span><span class="ident" id="7256602">Sprintf</span><span class="op" id="7256609">(</span><span class="string" id="7256610">&#34;file%d&#34;</span><span class="op" id="7256618">,</span>&nbsp;<span class="ident" id="7256620">i</span><span class="op" id="7256621">)</span><span class="op" id="7256622">,</span>&nbsp;<span class="ident" id="7256624">p</span><span class="op" id="7256625">.</span><span class="ident" id="7256626">Base</span><span class="op" id="7256630">(</span><span class="op" id="7256631">)</span><span class="op" id="7256632">+</span><span class="ident" id="7256633">i</span><span class="op" id="7256634">,</span>&nbsp;<span class="ident" id="7256636">i</span><span class="op" id="7256637">*</span><span class="num" id="7256638">100</span><span class="op" id="7256641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256645">checkSerialize</span><span class="op" id="7256659">(</span><span class="ident" id="7256660">t</span><span class="op" id="7256661">,</span>&nbsp;<span class="ident" id="7256663">p</span><span class="op" id="7256664">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7256668">//&nbsp;add&nbsp;some&nbsp;lines&nbsp;and&nbsp;alternative&nbsp;file&nbsp;infos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256715">line</span>&nbsp;<span class="op" id="7256720">:=</span>&nbsp;<span class="num" id="7256723">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7256730">for</span>&nbsp;<span class="ident" id="7256734">offs</span>&nbsp;<span class="op" id="7256739">:=</span>&nbsp;<span class="num" id="7256742">0</span><span class="op" id="7256743">;</span>&nbsp;<span class="ident" id="7256745">offs</span>&nbsp;<span class="op" id="7256750">&lt;</span>&nbsp;<span class="ident" id="7256752">f</span><span class="op" id="7256753">.</span><span class="ident" id="7256754">Size</span><span class="op" id="7256758">(</span><span class="op" id="7256759">)</span><span class="op" id="7256760">;</span>&nbsp;<span class="ident" id="7256762">offs</span>&nbsp;<span class="op" id="7256767">+=</span>&nbsp;<span class="num" id="7256770">40</span>&nbsp;<span class="op" id="7256773">+</span>&nbsp;<span class="ident" id="7256775">i</span>&nbsp;<span class="op" id="7256777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256782">f</span><span class="op" id="7256783">.</span><span class="ident" id="7256784">AddLine</span><span class="op" id="7256791">(</span><span class="ident" id="7256792">offs</span><span class="op" id="7256796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7256801">if</span>&nbsp;<span class="ident" id="7256804">offs</span><span class="op" id="7256808">%</span><span class="num" id="7256809">7</span>&nbsp;<span class="op" id="7256811">==</span>&nbsp;<span class="num" id="7256814">0</span>&nbsp;<span class="op" id="7256816">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256822">f</span><span class="op" id="7256823">.</span><span class="ident" id="7256824">AddLineInfo</span><span class="op" id="7256835">(</span><span class="ident" id="7256836">offs</span><span class="op" id="7256840">,</span>&nbsp;<span class="ident" id="7256842">fmt</span><span class="op" id="7256845">.</span><span class="ident" id="7256846">Sprintf</span><span class="op" id="7256853">(</span><span class="string" id="7256854">&#34;file%d&#34;</span><span class="op" id="7256862">,</span>&nbsp;<span class="ident" id="7256864">offs</span><span class="op" id="7256868">)</span><span class="op" id="7256869">,</span>&nbsp;<span class="ident" id="7256871">line</span><span class="op" id="7256875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256881">line</span>&nbsp;<span class="op" id="7256886">+=</span>&nbsp;<span class="num" id="7256889">33</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7256895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7256899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7256903">checkSerialize</span><span class="op" id="7256917">(</span><span class="ident" id="7256918">t</span><span class="op" id="7256919">,</span>&nbsp;<span class="ident" id="7256921">p</span><span class="op" id="7256922">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7256925">}</span><br>
<span class="lineno"></span><span class="op" id="7256927">}</span>
</div>
</body>
</html>
