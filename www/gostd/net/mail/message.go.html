<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5754526">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5754581">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5754635">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5754686">/*<br>
<span class="lineno"></span>Package&nbsp;mail&nbsp;implements&nbsp;parsing&nbsp;of&nbsp;mail&nbsp;messages.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>For&nbsp;the&nbsp;most&nbsp;part,&nbsp;this&nbsp;package&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;5322.<br>
<span class="lineno"></span>Notable&nbsp;divergences:<br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp*&nbsp;Obsolete&nbsp;address&nbsp;formats&nbsp;are&nbsp;not&nbsp;parsed,&nbsp;including&nbsp;addresses&nbsp;with<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;embedded&nbsp;route&nbsp;information.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp*&nbsp;Group&nbsp;addresses&nbsp;are&nbsp;not&nbsp;parsed.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp*&nbsp;The&nbsp;full&nbsp;range&nbsp;of&nbsp;spacing&nbsp;(the&nbsp;CFWS&nbsp;syntax&nbsp;element)&nbsp;is&nbsp;not&nbsp;supported,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;such&nbsp;as&nbsp;breaking&nbsp;addresses&nbsp;across&nbsp;lines.<br>
<span class="lineno">15</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="5755093">package</span>&nbsp;<span class="ident" id="5755101">mail</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5755107">import</span>&nbsp;<span class="op" id="5755114">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755117">&#34;bufio&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755126">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755135">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755154">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755164">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755171">&#34;io&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755177">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755190">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755197">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755214">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755225">&#34;strings&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755236">&#34;time&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5755244">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5755254">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5755257">var</span>&nbsp;<span class="ident" id="5755261">debug</span>&nbsp;<span class="op" id="5755267">=</span>&nbsp;<span class="ident" id="5755269">debugT</span><span class="op" id="5755275">(</span><span class="builtintype" id="5755276">false</span><span class="op" id="5755281">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="5755284">type</span>&nbsp;<span class="ident" id="5755289">debugT</span>&nbsp;<span class="builtintype" id="5755296">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5755302">func</span>&nbsp;<span class="op" id="5755307">(</span><span class="ident" id="5755308">d</span>&nbsp;<span class="ident" id="5755310">debugT</span><span class="op" id="5755316">)</span>&nbsp;<span class="ident" id="5755318">Printf</span><span class="op" id="5755324">(</span><span class="ident" id="5755325">format</span>&nbsp;<span class="builtintype" id="5755332">string</span><span class="op" id="5755338">,</span>&nbsp;<span class="ident" id="5755340">args</span>&nbsp;<span class="op" id="5755345">...</span><span class="keyword" id="5755348">interface</span><span class="op" id="5755357">{</span><span class="op" id="5755358">}</span><span class="op" id="5755359">)</span>&nbsp;<span class="op" id="5755361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755364">if</span>&nbsp;<span class="ident" id="5755367">d</span>&nbsp;<span class="op" id="5755369">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755373">log</span><span class="op" id="5755376">.</span><span class="ident" id="5755377">Printf</span><span class="op" id="5755383">(</span><span class="ident" id="5755384">format</span><span class="op" id="5755390">,</span>&nbsp;<span class="ident" id="5755392">args</span><span class="op" id="5755396">...</span><span class="op" id="5755399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755402">}</span><br>
<span class="lineno"></span><span class="op" id="5755404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5755407">//&nbsp;A&nbsp;Message&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;mail&nbsp;message.</span><br>
<span class="lineno">45</span><span class="keyword" id="5755454">type</span>&nbsp;<span class="ident" id="5755459">Message</span>&nbsp;<span class="keyword" id="5755467">struct</span>&nbsp;<span class="op" id="5755474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755477">Header</span>&nbsp;<span class="ident" id="5755484">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755492">Body</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5755499">io</span><span class="op" id="5755501">.</span><span class="ident" id="5755502">Reader</span><br>
<span class="lineno"></span><span class="op" id="5755509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5755512">//&nbsp;ReadMessage&nbsp;reads&nbsp;a&nbsp;message&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5755551">//&nbsp;The&nbsp;headers&nbsp;are&nbsp;parsed,&nbsp;and&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;message&nbsp;will&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="5755624">//&nbsp;for&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5755647">func</span>&nbsp;<span class="ident" id="5755652">ReadMessage</span><span class="op" id="5755663">(</span><span class="ident" id="5755664">r</span>&nbsp;<span class="ident" id="5755666">io</span><span class="op" id="5755668">.</span><span class="ident" id="5755669">Reader</span><span class="op" id="5755675">)</span>&nbsp;<span class="op" id="5755677">(</span><span class="ident" id="5755678">msg</span>&nbsp;<span class="op" id="5755682">*</span><span class="ident" id="5755683">Message</span><span class="op" id="5755690">,</span>&nbsp;<span class="ident" id="5755692">err</span>&nbsp;<span class="builtintype" id="5755696">error</span><span class="op" id="5755701">)</span>&nbsp;<span class="op" id="5755703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755706">tp</span>&nbsp;<span class="op" id="5755709">:=</span>&nbsp;<span class="ident" id="5755712">textproto</span><span class="op" id="5755721">.</span><span class="ident" id="5755722">NewReader</span><span class="op" id="5755731">(</span><span class="ident" id="5755732">bufio</span><span class="op" id="5755737">.</span><span class="ident" id="5755738">NewReader</span><span class="op" id="5755747">(</span><span class="ident" id="5755748">r</span><span class="op" id="5755749">)</span><span class="op" id="5755750">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755754">hdr</span><span class="op" id="5755757">,</span>&nbsp;<span class="ident" id="5755759">err</span>&nbsp;<span class="op" id="5755763">:=</span>&nbsp;<span class="ident" id="5755766">tp</span><span class="op" id="5755768">.</span><span class="ident" id="5755769">ReadMIMEHeader</span><span class="op" id="5755783">(</span><span class="op" id="5755784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755787">if</span>&nbsp;<span class="ident" id="5755790">err</span>&nbsp;<span class="op" id="5755794">!=</span>&nbsp;<span class="ident" id="5755797">nil</span>&nbsp;<span class="op" id="5755801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755805">return</span>&nbsp;<span class="ident" id="5755812">nil</span><span class="op" id="5755815">,</span>&nbsp;<span class="ident" id="5755817">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755822">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755826">return</span>&nbsp;<span class="op" id="5755833">&amp;</span><span class="ident" id="5755834">Message</span><span class="op" id="5755841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755845">Header</span><span class="op" id="5755851">:</span>&nbsp;<span class="ident" id="5755853">Header</span><span class="op" id="5755859">(</span><span class="ident" id="5755860">hdr</span><span class="op" id="5755863">)</span><span class="op" id="5755864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755868">Body</span><span class="op" id="5755872">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5755876">tp</span><span class="op" id="5755878">.</span><span class="ident" id="5755879">R</span><span class="op" id="5755880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755883">}</span><span class="op" id="5755884">,</span>&nbsp;<span class="ident" id="5755886">nil</span><br>
<span class="lineno">65</span><span class="op" id="5755890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5755893">//&nbsp;Layouts&nbsp;suitable&nbsp;for&nbsp;passing&nbsp;to&nbsp;time.Parse.</span><br>
<span class="lineno"></span><span class="comment" id="5755940">//&nbsp;These&nbsp;are&nbsp;tried&nbsp;in&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5755969">var</span>&nbsp;<span class="ident" id="5755973">dateLayouts</span>&nbsp;<span class="op" id="5755985">[</span><span class="op" id="5755986">]</span><span class="builtintype" id="5755987">string</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5755995">func</span>&nbsp;<span class="ident" id="5756000">init</span><span class="op" id="5756004">(</span><span class="op" id="5756005">)</span>&nbsp;<span class="op" id="5756007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756010">//&nbsp;Generate&nbsp;layouts&nbsp;based&nbsp;on&nbsp;RFC&nbsp;5322,&nbsp;section&nbsp;3.3.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756064">dows</span>&nbsp;<span class="op" id="5756069">:=</span>&nbsp;<span class="op" id="5756072">[</span><span class="op" id="5756073">...</span><span class="op" id="5756076">]</span><span class="builtintype" id="5756077">string</span><span class="op" id="5756083">{</span><span class="string" id="5756084">&#34;&#34;</span><span class="op" id="5756086">,</span>&nbsp;<span class="string" id="5756088">&#34;Mon,&nbsp;&#34;</span><span class="op" id="5756095">}</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5756099">//&nbsp;day-of-week</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756115">days</span>&nbsp;<span class="op" id="5756120">:=</span>&nbsp;<span class="op" id="5756123">[</span><span class="op" id="5756124">...</span><span class="op" id="5756127">]</span><span class="builtintype" id="5756128">string</span><span class="op" id="5756134">{</span><span class="string" id="5756135">&#34;2&#34;</span><span class="op" id="5756138">,</span>&nbsp;<span class="string" id="5756140">&#34;02&#34;</span><span class="op" id="5756144">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5756150">//&nbsp;day&nbsp;=&nbsp;1*2DIGIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756169">years</span>&nbsp;<span class="op" id="5756175">:=</span>&nbsp;<span class="op" id="5756178">[</span><span class="op" id="5756179">...</span><span class="op" id="5756182">]</span><span class="builtintype" id="5756183">string</span><span class="op" id="5756189">{</span><span class="string" id="5756190">&#34;2006&#34;</span><span class="op" id="5756196">,</span>&nbsp;<span class="string" id="5756198">&#34;06&#34;</span><span class="op" id="5756202">}</span>&nbsp;<span class="comment" id="5756204">//&nbsp;year&nbsp;=&nbsp;4*DIGIT&nbsp;/&nbsp;2*DIGIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756233">seconds</span>&nbsp;<span class="op" id="5756241">:=</span>&nbsp;<span class="op" id="5756244">[</span><span class="op" id="5756245">...</span><span class="op" id="5756248">]</span><span class="builtintype" id="5756249">string</span><span class="op" id="5756255">{</span><span class="string" id="5756256">&#34;:05&#34;</span><span class="op" id="5756261">,</span>&nbsp;<span class="string" id="5756263">&#34;&#34;</span><span class="op" id="5756265">}</span>&nbsp;&nbsp;<span class="comment" id="5756268">//&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756279">//&nbsp;&#34;-0700&nbsp;(MST)&#34;&nbsp;is&nbsp;not&nbsp;in&nbsp;RFC&nbsp;5322,&nbsp;but&nbsp;is&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756332">zones</span>&nbsp;<span class="op" id="5756338">:=</span>&nbsp;<span class="op" id="5756341">[</span><span class="op" id="5756342">...</span><span class="op" id="5756345">]</span><span class="builtintype" id="5756346">string</span><span class="op" id="5756352">{</span><span class="string" id="5756353">&#34;-0700&#34;</span><span class="op" id="5756360">,</span>&nbsp;<span class="string" id="5756362">&#34;MST&#34;</span><span class="op" id="5756367">,</span>&nbsp;<span class="string" id="5756369">&#34;-0700&nbsp;(MST)&#34;</span><span class="op" id="5756382">}</span>&nbsp;<span class="comment" id="5756384">//&nbsp;zone&nbsp;=&nbsp;((&#34;+&#34;&nbsp;/&nbsp;&#34;-&#34;)&nbsp;4DIGIT)&nbsp;/&nbsp;&#34;GMT&#34;&nbsp;/&nbsp;...</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756431">for</span>&nbsp;<span class="ident" id="5756435">_</span><span class="op" id="5756436">,</span>&nbsp;<span class="ident" id="5756438">dow</span>&nbsp;<span class="op" id="5756442">:=</span>&nbsp;<span class="keyword" id="5756445">range</span>&nbsp;<span class="ident" id="5756451">dows</span>&nbsp;<span class="op" id="5756456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756460">for</span>&nbsp;<span class="ident" id="5756464">_</span><span class="op" id="5756465">,</span>&nbsp;<span class="ident" id="5756467">day</span>&nbsp;<span class="op" id="5756471">:=</span>&nbsp;<span class="keyword" id="5756474">range</span>&nbsp;<span class="ident" id="5756480">days</span>&nbsp;<span class="op" id="5756485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756490">for</span>&nbsp;<span class="ident" id="5756494">_</span><span class="op" id="5756495">,</span>&nbsp;<span class="ident" id="5756497">year</span>&nbsp;<span class="op" id="5756502">:=</span>&nbsp;<span class="keyword" id="5756505">range</span>&nbsp;<span class="ident" id="5756511">years</span>&nbsp;<span class="op" id="5756517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756523">for</span>&nbsp;<span class="ident" id="5756527">_</span><span class="op" id="5756528">,</span>&nbsp;<span class="ident" id="5756530">second</span>&nbsp;<span class="op" id="5756537">:=</span>&nbsp;<span class="keyword" id="5756540">range</span>&nbsp;<span class="ident" id="5756546">seconds</span>&nbsp;<span class="op" id="5756554">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756561">for</span>&nbsp;<span class="ident" id="5756565">_</span><span class="op" id="5756566">,</span>&nbsp;<span class="ident" id="5756568">zone</span>&nbsp;<span class="op" id="5756573">:=</span>&nbsp;<span class="keyword" id="5756576">range</span>&nbsp;<span class="ident" id="5756582">zones</span>&nbsp;<span class="op" id="5756588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756596">s</span>&nbsp;<span class="op" id="5756598">:=</span>&nbsp;<span class="ident" id="5756601">dow</span>&nbsp;<span class="op" id="5756605">+</span>&nbsp;<span class="ident" id="5756607">day</span>&nbsp;<span class="op" id="5756611">+</span>&nbsp;<span class="string" id="5756613">&#34;&nbsp;Jan&nbsp;&#34;</span>&nbsp;<span class="op" id="5756621">+</span>&nbsp;<span class="ident" id="5756623">year</span>&nbsp;<span class="op" id="5756628">+</span>&nbsp;<span class="string" id="5756630">&#34;&nbsp;15:04&#34;</span>&nbsp;<span class="op" id="5756639">+</span>&nbsp;<span class="ident" id="5756641">second</span>&nbsp;<span class="op" id="5756648">+</span>&nbsp;<span class="string" id="5756650">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5756654">+</span>&nbsp;<span class="ident" id="5756656">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756667">dateLayouts</span>&nbsp;<span class="op" id="5756679">=</span>&nbsp;<span class="builtinfunc" id="5756681">append</span><span class="op" id="5756687">(</span><span class="ident" id="5756688">dateLayouts</span><span class="op" id="5756699">,</span>&nbsp;<span class="ident" id="5756701">s</span><span class="op" id="5756702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756715">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756727">}</span><br>
<span class="lineno"></span><span class="op" id="5756729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5756732">func</span>&nbsp;<span class="ident" id="5756737">parseDate</span><span class="op" id="5756746">(</span><span class="ident" id="5756747">date</span>&nbsp;<span class="builtintype" id="5756752">string</span><span class="op" id="5756758">)</span>&nbsp;<span class="op" id="5756760">(</span><span class="ident" id="5756761">time</span><span class="op" id="5756765">.</span><span class="ident" id="5756766">Time</span><span class="op" id="5756770">,</span>&nbsp;<span class="builtintype" id="5756772">error</span><span class="op" id="5756777">)</span>&nbsp;<span class="op" id="5756779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756782">for</span>&nbsp;<span class="ident" id="5756786">_</span><span class="op" id="5756787">,</span>&nbsp;<span class="ident" id="5756789">layout</span>&nbsp;<span class="op" id="5756796">:=</span>&nbsp;<span class="keyword" id="5756799">range</span>&nbsp;<span class="ident" id="5756805">dateLayouts</span>&nbsp;<span class="op" id="5756817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756821">t</span><span class="op" id="5756822">,</span>&nbsp;<span class="ident" id="5756824">err</span>&nbsp;<span class="op" id="5756828">:=</span>&nbsp;<span class="ident" id="5756831">time</span><span class="op" id="5756835">.</span><span class="ident" id="5756836">Parse</span><span class="op" id="5756841">(</span><span class="ident" id="5756842">layout</span><span class="op" id="5756848">,</span>&nbsp;<span class="ident" id="5756850">date</span><span class="op" id="5756854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756858">if</span>&nbsp;<span class="ident" id="5756861">err</span>&nbsp;<span class="op" id="5756865">==</span>&nbsp;<span class="ident" id="5756868">nil</span>&nbsp;<span class="op" id="5756872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756877">return</span>&nbsp;<span class="ident" id="5756884">t</span><span class="op" id="5756885">,</span>&nbsp;<span class="ident" id="5756887">nil</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756899">return</span>&nbsp;<span class="ident" id="5756906">time</span><span class="op" id="5756910">.</span><span class="ident" id="5756911">Time</span><span class="op" id="5756915">{</span><span class="op" id="5756916">}</span><span class="op" id="5756917">,</span>&nbsp;<span class="ident" id="5756919">errors</span><span class="op" id="5756925">.</span><span class="ident" id="5756926">New</span><span class="op" id="5756929">(</span><span class="string" id="5756930">&#34;mail:&nbsp;header&nbsp;could&nbsp;not&nbsp;be&nbsp;parsed&#34;</span><span class="op" id="5756964">)</span><br>
<span class="lineno"></span><span class="op" id="5756966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5756969">//&nbsp;A&nbsp;Header&nbsp;represents&nbsp;the&nbsp;key-value&nbsp;pairs&nbsp;in&nbsp;a&nbsp;mail&nbsp;message&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5757038">type</span>&nbsp;<span class="ident" id="5757043">Header</span>&nbsp;<span class="keyword" id="5757050">map</span><span class="op" id="5757053">[</span><span class="builtintype" id="5757054">string</span><span class="op" id="5757060">]</span><span class="op" id="5757061">[</span><span class="op" id="5757062">]</span><span class="builtintype" id="5757063">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5757071">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="5757130">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno">110</span><span class="keyword" id="5757197">func</span>&nbsp;<span class="op" id="5757202">(</span><span class="ident" id="5757203">h</span>&nbsp;<span class="ident" id="5757205">Header</span><span class="op" id="5757211">)</span>&nbsp;<span class="ident" id="5757213">Get</span><span class="op" id="5757216">(</span><span class="ident" id="5757217">key</span>&nbsp;<span class="builtintype" id="5757221">string</span><span class="op" id="5757227">)</span>&nbsp;<span class="builtintype" id="5757229">string</span>&nbsp;<span class="op" id="5757236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757239">return</span>&nbsp;<span class="ident" id="5757246">textproto</span><span class="op" id="5757255">.</span><span class="ident" id="5757256">MIMEHeader</span><span class="op" id="5757266">(</span><span class="ident" id="5757267">h</span><span class="op" id="5757268">)</span><span class="op" id="5757269">.</span><span class="ident" id="5757270">Get</span><span class="op" id="5757273">(</span><span class="ident" id="5757274">key</span><span class="op" id="5757277">)</span><br>
<span class="lineno"></span><span class="op" id="5757279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5757282">var</span>&nbsp;<span class="ident" id="5757286">ErrHeaderNotPresent</span>&nbsp;<span class="op" id="5757306">=</span>&nbsp;<span class="ident" id="5757308">errors</span><span class="op" id="5757314">.</span><span class="ident" id="5757315">New</span><span class="op" id="5757318">(</span><span class="string" id="5757319">&#34;mail:&nbsp;header&nbsp;not&nbsp;in&nbsp;message&#34;</span><span class="op" id="5757348">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="5757351">//&nbsp;Date&nbsp;parses&nbsp;the&nbsp;Date&nbsp;header&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="5757389">func</span>&nbsp;<span class="op" id="5757394">(</span><span class="ident" id="5757395">h</span>&nbsp;<span class="ident" id="5757397">Header</span><span class="op" id="5757403">)</span>&nbsp;<span class="ident" id="5757405">Date</span><span class="op" id="5757409">(</span><span class="op" id="5757410">)</span>&nbsp;<span class="op" id="5757412">(</span><span class="ident" id="5757413">time</span><span class="op" id="5757417">.</span><span class="ident" id="5757418">Time</span><span class="op" id="5757422">,</span>&nbsp;<span class="builtintype" id="5757424">error</span><span class="op" id="5757429">)</span>&nbsp;<span class="op" id="5757431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757434">hdr</span>&nbsp;<span class="op" id="5757438">:=</span>&nbsp;<span class="ident" id="5757441">h</span><span class="op" id="5757442">.</span><span class="ident" id="5757443">Get</span><span class="op" id="5757446">(</span><span class="string" id="5757447">&#34;Date&#34;</span><span class="op" id="5757453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757456">if</span>&nbsp;<span class="ident" id="5757459">hdr</span>&nbsp;<span class="op" id="5757463">==</span>&nbsp;<span class="string" id="5757466">&#34;&#34;</span>&nbsp;<span class="op" id="5757469">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757473">return</span>&nbsp;<span class="ident" id="5757480">time</span><span class="op" id="5757484">.</span><span class="ident" id="5757485">Time</span><span class="op" id="5757489">{</span><span class="op" id="5757490">}</span><span class="op" id="5757491">,</span>&nbsp;<span class="ident" id="5757493">ErrHeaderNotPresent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757517">return</span>&nbsp;<span class="ident" id="5757524">parseDate</span><span class="op" id="5757533">(</span><span class="ident" id="5757534">hdr</span><span class="op" id="5757537">)</span><br>
<span class="lineno"></span><span class="op" id="5757539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5757542">//&nbsp;AddressList&nbsp;parses&nbsp;the&nbsp;named&nbsp;header&nbsp;field&nbsp;as&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="5757611">func</span>&nbsp;<span class="op" id="5757616">(</span><span class="ident" id="5757617">h</span>&nbsp;<span class="ident" id="5757619">Header</span><span class="op" id="5757625">)</span>&nbsp;<span class="ident" id="5757627">AddressList</span><span class="op" id="5757638">(</span><span class="ident" id="5757639">key</span>&nbsp;<span class="builtintype" id="5757643">string</span><span class="op" id="5757649">)</span>&nbsp;<span class="op" id="5757651">(</span><span class="op" id="5757652">[</span><span class="op" id="5757653">]</span><span class="op" id="5757654">*</span><span class="ident" id="5757655">Address</span><span class="op" id="5757662">,</span>&nbsp;<span class="builtintype" id="5757664">error</span><span class="op" id="5757669">)</span>&nbsp;<span class="op" id="5757671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757674">hdr</span>&nbsp;<span class="op" id="5757678">:=</span>&nbsp;<span class="ident" id="5757681">h</span><span class="op" id="5757682">.</span><span class="ident" id="5757683">Get</span><span class="op" id="5757686">(</span><span class="ident" id="5757687">key</span><span class="op" id="5757690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757693">if</span>&nbsp;<span class="ident" id="5757696">hdr</span>&nbsp;<span class="op" id="5757700">==</span>&nbsp;<span class="string" id="5757703">&#34;&#34;</span>&nbsp;<span class="op" id="5757706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757710">return</span>&nbsp;<span class="ident" id="5757717">nil</span><span class="op" id="5757720">,</span>&nbsp;<span class="ident" id="5757722">ErrHeaderNotPresent</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757746">return</span>&nbsp;<span class="ident" id="5757753">ParseAddressList</span><span class="op" id="5757769">(</span><span class="ident" id="5757770">hdr</span><span class="op" id="5757773">)</span><br>
<span class="lineno"></span><span class="op" id="5757775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5757778">//&nbsp;Address&nbsp;represents&nbsp;a&nbsp;single&nbsp;mail&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="5757823">//&nbsp;An&nbsp;address&nbsp;such&nbsp;as&nbsp;&#34;Barry&nbsp;Gibbs&nbsp;&lt;bg@example.com&gt;&#34;&nbsp;is&nbsp;represented</span><br>
<span class="lineno"></span><span class="comment" id="5757891">//&nbsp;as&nbsp;Address{Name:&nbsp;&#34;Barry&nbsp;Gibbs&#34;,&nbsp;Address:&nbsp;&#34;bg@example.com&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="5757954">type</span>&nbsp;<span class="ident" id="5757959">Address</span>&nbsp;<span class="keyword" id="5757967">struct</span>&nbsp;<span class="op" id="5757974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757977">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5757985">string</span>&nbsp;<span class="comment" id="5757992">//&nbsp;Proper&nbsp;name;&nbsp;may&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758023">Address</span>&nbsp;<span class="builtintype" id="5758031">string</span>&nbsp;<span class="comment" id="5758038">//&nbsp;user@domain</span><br>
<span class="lineno">140</span><span class="op" id="5758053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5758056">//&nbsp;Parses&nbsp;a&nbsp;single&nbsp;RFC&nbsp;5322&nbsp;address,&nbsp;e.g.&nbsp;&#34;Barry&nbsp;Gibbs&nbsp;&lt;bg@example.com&gt;&#34;</span><br>
<span class="lineno"></span><span class="keyword" id="5758129">func</span>&nbsp;<span class="ident" id="5758134">ParseAddress</span><span class="op" id="5758146">(</span><span class="ident" id="5758147">address</span>&nbsp;<span class="builtintype" id="5758155">string</span><span class="op" id="5758161">)</span>&nbsp;<span class="op" id="5758163">(</span><span class="op" id="5758164">*</span><span class="ident" id="5758165">Address</span><span class="op" id="5758172">,</span>&nbsp;<span class="builtintype" id="5758174">error</span><span class="op" id="5758179">)</span>&nbsp;<span class="op" id="5758181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758184">return</span>&nbsp;<span class="ident" id="5758191">newAddrParser</span><span class="op" id="5758204">(</span><span class="ident" id="5758205">address</span><span class="op" id="5758212">)</span><span class="op" id="5758213">.</span><span class="ident" id="5758214">parseAddress</span><span class="op" id="5758226">(</span><span class="op" id="5758227">)</span><br>
<span class="lineno">145</span><span class="op" id="5758229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5758232">//&nbsp;ParseAddressList&nbsp;parses&nbsp;the&nbsp;given&nbsp;string&nbsp;as&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="5758300">func</span>&nbsp;<span class="ident" id="5758305">ParseAddressList</span><span class="op" id="5758321">(</span><span class="ident" id="5758322">list</span>&nbsp;<span class="builtintype" id="5758327">string</span><span class="op" id="5758333">)</span>&nbsp;<span class="op" id="5758335">(</span><span class="op" id="5758336">[</span><span class="op" id="5758337">]</span><span class="op" id="5758338">*</span><span class="ident" id="5758339">Address</span><span class="op" id="5758346">,</span>&nbsp;<span class="builtintype" id="5758348">error</span><span class="op" id="5758353">)</span>&nbsp;<span class="op" id="5758355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758358">return</span>&nbsp;<span class="ident" id="5758365">newAddrParser</span><span class="op" id="5758378">(</span><span class="ident" id="5758379">list</span><span class="op" id="5758383">)</span><span class="op" id="5758384">.</span><span class="ident" id="5758385">parseAddressList</span><span class="op" id="5758401">(</span><span class="op" id="5758402">)</span><br>
<span class="lineno">150</span><span class="op" id="5758404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5758407">//&nbsp;String&nbsp;formats&nbsp;the&nbsp;address&nbsp;as&nbsp;a&nbsp;valid&nbsp;RFC&nbsp;5322&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="5758466">//&nbsp;If&nbsp;the&nbsp;address&#39;s&nbsp;name&nbsp;contains&nbsp;non-ASCII&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="5758521">//&nbsp;the&nbsp;name&nbsp;will&nbsp;be&nbsp;rendered&nbsp;according&nbsp;to&nbsp;RFC&nbsp;2047.</span><br>
<span class="lineno">155</span><span class="keyword" id="5758573">func</span>&nbsp;<span class="op" id="5758578">(</span><span class="ident" id="5758579">a</span>&nbsp;<span class="op" id="5758581">*</span><span class="ident" id="5758582">Address</span><span class="op" id="5758589">)</span>&nbsp;<span class="ident" id="5758591">String</span><span class="op" id="5758597">(</span><span class="op" id="5758598">)</span>&nbsp;<span class="builtintype" id="5758600">string</span>&nbsp;<span class="op" id="5758607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758610">s</span>&nbsp;<span class="op" id="5758612">:=</span>&nbsp;<span class="string" id="5758615">&#34;&lt;&#34;</span>&nbsp;<span class="op" id="5758619">+</span>&nbsp;<span class="ident" id="5758621">a</span><span class="op" id="5758622">.</span><span class="ident" id="5758623">Address</span>&nbsp;<span class="op" id="5758631">+</span>&nbsp;<span class="string" id="5758633">&#34;&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758638">if</span>&nbsp;<span class="ident" id="5758641">a</span><span class="op" id="5758642">.</span><span class="ident" id="5758643">Name</span>&nbsp;<span class="op" id="5758648">==</span>&nbsp;<span class="string" id="5758651">&#34;&#34;</span>&nbsp;<span class="op" id="5758654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758658">return</span>&nbsp;<span class="ident" id="5758665">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758668">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758671">//&nbsp;If&nbsp;every&nbsp;character&nbsp;is&nbsp;printable&nbsp;ASCII,&nbsp;quoting&nbsp;is&nbsp;simple.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758733">allPrintable</span>&nbsp;<span class="op" id="5758746">:=</span>&nbsp;<span class="builtintype" id="5758749">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758755">for</span>&nbsp;<span class="ident" id="5758759">i</span>&nbsp;<span class="op" id="5758761">:=</span>&nbsp;<span class="num" id="5758764">0</span><span class="op" id="5758765">;</span>&nbsp;<span class="ident" id="5758767">i</span>&nbsp;<span class="op" id="5758769">&lt;</span>&nbsp;<span class="builtinfunc" id="5758771">len</span><span class="op" id="5758774">(</span><span class="ident" id="5758775">a</span><span class="op" id="5758776">.</span><span class="ident" id="5758777">Name</span><span class="op" id="5758781">)</span><span class="op" id="5758782">;</span>&nbsp;<span class="ident" id="5758784">i</span><span class="op" id="5758785">++</span>&nbsp;<span class="op" id="5758788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758792">//&nbsp;isWSP&nbsp;here&nbsp;should&nbsp;actually&nbsp;be&nbsp;isFWS,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758834">//&nbsp;but&nbsp;we&nbsp;don&#39;t&nbsp;support&nbsp;folding&nbsp;yet.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758873">if</span>&nbsp;<span class="op" id="5758876">!</span><span class="ident" id="5758877">isVchar</span><span class="op" id="5758884">(</span><span class="ident" id="5758885">a</span><span class="op" id="5758886">.</span><span class="ident" id="5758887">Name</span><span class="op" id="5758891">[</span><span class="ident" id="5758892">i</span><span class="op" id="5758893">]</span><span class="op" id="5758894">)</span>&nbsp;<span class="op" id="5758896">&amp;&amp;</span>&nbsp;<span class="op" id="5758899">!</span><span class="ident" id="5758900">isWSP</span><span class="op" id="5758905">(</span><span class="ident" id="5758906">a</span><span class="op" id="5758907">.</span><span class="ident" id="5758908">Name</span><span class="op" id="5758912">[</span><span class="ident" id="5758913">i</span><span class="op" id="5758914">]</span><span class="op" id="5758915">)</span>&nbsp;<span class="op" id="5758917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758922">allPrintable</span>&nbsp;<span class="op" id="5758935">=</span>&nbsp;<span class="builtintype" id="5758937">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758946">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758957">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758960">if</span>&nbsp;<span class="ident" id="5758963">allPrintable</span>&nbsp;<span class="op" id="5758976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758980">b</span>&nbsp;<span class="op" id="5758982">:=</span>&nbsp;<span class="ident" id="5758985">bytes</span><span class="op" id="5758990">.</span><span class="ident" id="5758991">NewBufferString</span><span class="op" id="5759006">(</span><span class="string" id="5759007">`&#34;`</span><span class="op" id="5759010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759014">for</span>&nbsp;<span class="ident" id="5759018">i</span>&nbsp;<span class="op" id="5759020">:=</span>&nbsp;<span class="num" id="5759023">0</span><span class="op" id="5759024">;</span>&nbsp;<span class="ident" id="5759026">i</span>&nbsp;<span class="op" id="5759028">&lt;</span>&nbsp;<span class="builtinfunc" id="5759030">len</span><span class="op" id="5759033">(</span><span class="ident" id="5759034">a</span><span class="op" id="5759035">.</span><span class="ident" id="5759036">Name</span><span class="op" id="5759040">)</span><span class="op" id="5759041">;</span>&nbsp;<span class="ident" id="5759043">i</span><span class="op" id="5759044">++</span>&nbsp;<span class="op" id="5759047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759052">if</span>&nbsp;<span class="op" id="5759055">!</span><span class="ident" id="5759056">isQtext</span><span class="op" id="5759063">(</span><span class="ident" id="5759064">a</span><span class="op" id="5759065">.</span><span class="ident" id="5759066">Name</span><span class="op" id="5759070">[</span><span class="ident" id="5759071">i</span><span class="op" id="5759072">]</span><span class="op" id="5759073">)</span>&nbsp;<span class="op" id="5759075">&amp;&amp;</span>&nbsp;<span class="op" id="5759078">!</span><span class="ident" id="5759079">isWSP</span><span class="op" id="5759084">(</span><span class="ident" id="5759085">a</span><span class="op" id="5759086">.</span><span class="ident" id="5759087">Name</span><span class="op" id="5759091">[</span><span class="ident" id="5759092">i</span><span class="op" id="5759093">]</span><span class="op" id="5759094">)</span>&nbsp;<span class="op" id="5759096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759102">b</span><span class="op" id="5759103">.</span><span class="ident" id="5759104">WriteByte</span><span class="op" id="5759113">(</span><span class="string" id="5759114">&#39;\\&#39;</span><span class="op" id="5759118">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759128">b</span><span class="op" id="5759129">.</span><span class="ident" id="5759130">WriteByte</span><span class="op" id="5759139">(</span><span class="ident" id="5759140">a</span><span class="op" id="5759141">.</span><span class="ident" id="5759142">Name</span><span class="op" id="5759146">[</span><span class="ident" id="5759147">i</span><span class="op" id="5759148">]</span><span class="op" id="5759149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759157">b</span><span class="op" id="5759158">.</span><span class="ident" id="5759159">WriteString</span><span class="op" id="5759170">(</span><span class="string" id="5759171">`&#34;&nbsp;`</span><span class="op" id="5759175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759179">b</span><span class="op" id="5759180">.</span><span class="ident" id="5759181">WriteString</span><span class="op" id="5759192">(</span><span class="ident" id="5759193">s</span><span class="op" id="5759194">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759198">return</span>&nbsp;<span class="ident" id="5759205">b</span><span class="op" id="5759206">.</span><span class="ident" id="5759207">String</span><span class="op" id="5759213">(</span><span class="op" id="5759214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759221">//&nbsp;UTF-8&nbsp;&#34;Q&#34;&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759244">b</span>&nbsp;<span class="op" id="5759246">:=</span>&nbsp;<span class="ident" id="5759249">bytes</span><span class="op" id="5759254">.</span><span class="ident" id="5759255">NewBufferString</span><span class="op" id="5759270">(</span><span class="string" id="5759271">&#34;=?utf-8?q?&#34;</span><span class="op" id="5759283">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759286">for</span>&nbsp;<span class="ident" id="5759290">i</span>&nbsp;<span class="op" id="5759292">:=</span>&nbsp;<span class="num" id="5759295">0</span><span class="op" id="5759296">;</span>&nbsp;<span class="ident" id="5759298">i</span>&nbsp;<span class="op" id="5759300">&lt;</span>&nbsp;<span class="builtinfunc" id="5759302">len</span><span class="op" id="5759305">(</span><span class="ident" id="5759306">a</span><span class="op" id="5759307">.</span><span class="ident" id="5759308">Name</span><span class="op" id="5759312">)</span><span class="op" id="5759313">;</span>&nbsp;<span class="ident" id="5759315">i</span><span class="op" id="5759316">++</span>&nbsp;<span class="op" id="5759319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759323">switch</span>&nbsp;<span class="ident" id="5759330">c</span>&nbsp;<span class="op" id="5759332">:=</span>&nbsp;<span class="ident" id="5759335">a</span><span class="op" id="5759336">.</span><span class="ident" id="5759337">Name</span><span class="op" id="5759341">[</span><span class="ident" id="5759342">i</span><span class="op" id="5759343">]</span><span class="op" id="5759344">;</span>&nbsp;<span class="op" id="5759346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759350">case</span>&nbsp;<span class="ident" id="5759355">c</span>&nbsp;<span class="op" id="5759357">==</span>&nbsp;<span class="string" id="5759360">&#39;&nbsp;&#39;</span><span class="op" id="5759363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759368">b</span><span class="op" id="5759369">.</span><span class="ident" id="5759370">WriteByte</span><span class="op" id="5759379">(</span><span class="string" id="5759380">&#39;_&#39;</span><span class="op" id="5759383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759387">case</span>&nbsp;<span class="ident" id="5759392">isVchar</span><span class="op" id="5759399">(</span><span class="ident" id="5759400">c</span><span class="op" id="5759401">)</span>&nbsp;<span class="op" id="5759403">&amp;&amp;</span>&nbsp;<span class="ident" id="5759406">c</span>&nbsp;<span class="op" id="5759408">!=</span>&nbsp;<span class="string" id="5759411">&#39;=&#39;</span>&nbsp;<span class="op" id="5759415">&amp;&amp;</span>&nbsp;<span class="ident" id="5759418">c</span>&nbsp;<span class="op" id="5759420">!=</span>&nbsp;<span class="string" id="5759423">&#39;?&#39;</span>&nbsp;<span class="op" id="5759427">&amp;&amp;</span>&nbsp;<span class="ident" id="5759430">c</span>&nbsp;<span class="op" id="5759432">!=</span>&nbsp;<span class="string" id="5759435">&#39;_&#39;</span><span class="op" id="5759438">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759443">b</span><span class="op" id="5759444">.</span><span class="ident" id="5759445">WriteByte</span><span class="op" id="5759454">(</span><span class="ident" id="5759455">c</span><span class="op" id="5759456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759460">default</span><span class="op" id="5759467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759472">fmt</span><span class="op" id="5759475">.</span><span class="ident" id="5759476">Fprintf</span><span class="op" id="5759483">(</span><span class="ident" id="5759484">b</span><span class="op" id="5759485">,</span>&nbsp;<span class="string" id="5759487">&#34;=%02X&#34;</span><span class="op" id="5759494">,</span>&nbsp;<span class="ident" id="5759496">c</span><span class="op" id="5759497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759504">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759507">b</span><span class="op" id="5759508">.</span><span class="ident" id="5759509">WriteString</span><span class="op" id="5759520">(</span><span class="string" id="5759521">&#34;?=&nbsp;&#34;</span><span class="op" id="5759526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759529">b</span><span class="op" id="5759530">.</span><span class="ident" id="5759531">WriteString</span><span class="op" id="5759542">(</span><span class="ident" id="5759543">s</span><span class="op" id="5759544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759547">return</span>&nbsp;<span class="ident" id="5759554">b</span><span class="op" id="5759555">.</span><span class="ident" id="5759556">String</span><span class="op" id="5759562">(</span><span class="op" id="5759563">)</span><br>
<span class="lineno"></span><span class="op" id="5759565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="keyword" id="5759568">type</span>&nbsp;<span class="ident" id="5759573">addrParser</span>&nbsp;<span class="op" id="5759584">[</span><span class="op" id="5759585">]</span><span class="builtintype" id="5759586">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5759592">func</span>&nbsp;<span class="ident" id="5759597">newAddrParser</span><span class="op" id="5759610">(</span><span class="ident" id="5759611">s</span>&nbsp;<span class="builtintype" id="5759613">string</span><span class="op" id="5759619">)</span>&nbsp;<span class="op" id="5759621">*</span><span class="ident" id="5759622">addrParser</span>&nbsp;<span class="op" id="5759633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759636">p</span>&nbsp;<span class="op" id="5759638">:=</span>&nbsp;<span class="ident" id="5759641">addrParser</span><span class="op" id="5759651">(</span><span class="ident" id="5759652">s</span><span class="op" id="5759653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759656">return</span>&nbsp;<span class="op" id="5759663">&amp;</span><span class="ident" id="5759664">p</span><br>
<span class="lineno">205</span><span class="op" id="5759666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5759669">func</span>&nbsp;<span class="op" id="5759674">(</span><span class="ident" id="5759675">p</span>&nbsp;<span class="op" id="5759677">*</span><span class="ident" id="5759678">addrParser</span><span class="op" id="5759688">)</span>&nbsp;<span class="ident" id="5759690">parseAddressList</span><span class="op" id="5759706">(</span><span class="op" id="5759707">)</span>&nbsp;<span class="op" id="5759709">(</span><span class="op" id="5759710">[</span><span class="op" id="5759711">]</span><span class="op" id="5759712">*</span><span class="ident" id="5759713">Address</span><span class="op" id="5759720">,</span>&nbsp;<span class="builtintype" id="5759722">error</span><span class="op" id="5759727">)</span>&nbsp;<span class="op" id="5759729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759732">var</span>&nbsp;<span class="ident" id="5759736">list</span>&nbsp;<span class="op" id="5759741">[</span><span class="op" id="5759742">]</span><span class="op" id="5759743">*</span><span class="ident" id="5759744">Address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759753">for</span>&nbsp;<span class="op" id="5759757">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759761">p</span><span class="op" id="5759762">.</span><span class="ident" id="5759763">skipSpace</span><span class="op" id="5759772">(</span><span class="op" id="5759773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759777">addr</span><span class="op" id="5759781">,</span>&nbsp;<span class="ident" id="5759783">err</span>&nbsp;<span class="op" id="5759787">:=</span>&nbsp;<span class="ident" id="5759790">p</span><span class="op" id="5759791">.</span><span class="ident" id="5759792">parseAddress</span><span class="op" id="5759804">(</span><span class="op" id="5759805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759809">if</span>&nbsp;<span class="ident" id="5759812">err</span>&nbsp;<span class="op" id="5759816">!=</span>&nbsp;<span class="ident" id="5759819">nil</span>&nbsp;<span class="op" id="5759823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759828">return</span>&nbsp;<span class="ident" id="5759835">nil</span><span class="op" id="5759838">,</span>&nbsp;<span class="ident" id="5759840">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759846">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759850">list</span>&nbsp;<span class="op" id="5759855">=</span>&nbsp;<span class="builtinfunc" id="5759857">append</span><span class="op" id="5759863">(</span><span class="ident" id="5759864">list</span><span class="op" id="5759868">,</span>&nbsp;<span class="ident" id="5759870">addr</span><span class="op" id="5759874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759879">p</span><span class="op" id="5759880">.</span><span class="ident" id="5759881">skipSpace</span><span class="op" id="5759890">(</span><span class="op" id="5759891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759895">if</span>&nbsp;<span class="ident" id="5759898">p</span><span class="op" id="5759899">.</span><span class="ident" id="5759900">empty</span><span class="op" id="5759905">(</span><span class="op" id="5759906">)</span>&nbsp;<span class="op" id="5759908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759913">break</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759925">if</span>&nbsp;<span class="op" id="5759928">!</span><span class="ident" id="5759929">p</span><span class="op" id="5759930">.</span><span class="ident" id="5759931">consume</span><span class="op" id="5759938">(</span><span class="string" id="5759939">&#39;,&#39;</span><span class="op" id="5759942">)</span>&nbsp;<span class="op" id="5759944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759949">return</span>&nbsp;<span class="ident" id="5759956">nil</span><span class="op" id="5759959">,</span>&nbsp;<span class="ident" id="5759961">errors</span><span class="op" id="5759967">.</span><span class="ident" id="5759968">New</span><span class="op" id="5759971">(</span><span class="string" id="5759972">&#34;mail:&nbsp;expected&nbsp;comma&#34;</span><span class="op" id="5759994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760001">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760004">return</span>&nbsp;<span class="ident" id="5760011">list</span><span class="op" id="5760015">,</span>&nbsp;<span class="ident" id="5760017">nil</span><br>
<span class="lineno"></span><span class="op" id="5760021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5760024">//&nbsp;parseAddress&nbsp;parses&nbsp;a&nbsp;single&nbsp;RFC&nbsp;5322&nbsp;address&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5760092">func</span>&nbsp;<span class="op" id="5760097">(</span><span class="ident" id="5760098">p</span>&nbsp;<span class="op" id="5760100">*</span><span class="ident" id="5760101">addrParser</span><span class="op" id="5760111">)</span>&nbsp;<span class="ident" id="5760113">parseAddress</span><span class="op" id="5760125">(</span><span class="op" id="5760126">)</span>&nbsp;<span class="op" id="5760128">(</span><span class="ident" id="5760129">addr</span>&nbsp;<span class="op" id="5760134">*</span><span class="ident" id="5760135">Address</span><span class="op" id="5760142">,</span>&nbsp;<span class="ident" id="5760144">err</span>&nbsp;<span class="builtintype" id="5760148">error</span><span class="op" id="5760153">)</span>&nbsp;<span class="op" id="5760155">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760158">debug</span><span class="op" id="5760163">.</span><span class="ident" id="5760164">Printf</span><span class="op" id="5760170">(</span><span class="string" id="5760171">&#34;parseAddress:&nbsp;%q&#34;</span><span class="op" id="5760189">,</span>&nbsp;<span class="op" id="5760191">*</span><span class="ident" id="5760192">p</span><span class="op" id="5760193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760196">p</span><span class="op" id="5760197">.</span><span class="ident" id="5760198">skipSpace</span><span class="op" id="5760207">(</span><span class="op" id="5760208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760211">if</span>&nbsp;<span class="ident" id="5760214">p</span><span class="op" id="5760215">.</span><span class="ident" id="5760216">empty</span><span class="op" id="5760221">(</span><span class="op" id="5760222">)</span>&nbsp;<span class="op" id="5760224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760228">return</span>&nbsp;<span class="ident" id="5760235">nil</span><span class="op" id="5760238">,</span>&nbsp;<span class="ident" id="5760240">errors</span><span class="op" id="5760246">.</span><span class="ident" id="5760247">New</span><span class="op" id="5760250">(</span><span class="string" id="5760251">&#34;mail:&nbsp;no&nbsp;address&#34;</span><span class="op" id="5760269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760272">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760276">//&nbsp;address&nbsp;=&nbsp;name-addr&nbsp;/&nbsp;addr-spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760312">//&nbsp;TODO(dsymonds):&nbsp;Support&nbsp;parsing&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760364">//&nbsp;addr-spec&nbsp;has&nbsp;a&nbsp;more&nbsp;restricted&nbsp;grammar&nbsp;than&nbsp;name-addr,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760424">//&nbsp;so&nbsp;try&nbsp;parsing&nbsp;it&nbsp;first,&nbsp;and&nbsp;fallback&nbsp;to&nbsp;name-addr.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760480">//&nbsp;TODO(dsymonds):&nbsp;Is&nbsp;this&nbsp;really&nbsp;correct?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760524">spec</span><span class="op" id="5760528">,</span>&nbsp;<span class="ident" id="5760530">err</span>&nbsp;<span class="op" id="5760534">:=</span>&nbsp;<span class="ident" id="5760537">p</span><span class="op" id="5760538">.</span><span class="ident" id="5760539">consumeAddrSpec</span><span class="op" id="5760554">(</span><span class="op" id="5760555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760558">if</span>&nbsp;<span class="ident" id="5760561">err</span>&nbsp;<span class="op" id="5760565">==</span>&nbsp;<span class="ident" id="5760568">nil</span>&nbsp;<span class="op" id="5760572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760576">return</span>&nbsp;<span class="op" id="5760583">&amp;</span><span class="ident" id="5760584">Address</span><span class="op" id="5760591">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760596">Address</span><span class="op" id="5760603">:</span>&nbsp;<span class="ident" id="5760605">spec</span><span class="op" id="5760609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760613">}</span><span class="op" id="5760614">,</span>&nbsp;<span class="ident" id="5760616">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760624">debug</span><span class="op" id="5760629">.</span><span class="ident" id="5760630">Printf</span><span class="op" id="5760636">(</span><span class="string" id="5760637">&#34;parseAddress:&nbsp;not&nbsp;an&nbsp;addr-spec:&nbsp;%v&#34;</span><span class="op" id="5760673">,</span>&nbsp;<span class="ident" id="5760675">err</span><span class="op" id="5760678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760681">debug</span><span class="op" id="5760686">.</span><span class="ident" id="5760687">Printf</span><span class="op" id="5760693">(</span><span class="string" id="5760694">&#34;parseAddress:&nbsp;state&nbsp;is&nbsp;now&nbsp;%q&#34;</span><span class="op" id="5760725">,</span>&nbsp;<span class="op" id="5760727">*</span><span class="ident" id="5760728">p</span><span class="op" id="5760729">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760733">//&nbsp;display-name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760750">var</span>&nbsp;<span class="ident" id="5760754">displayName</span>&nbsp;<span class="builtintype" id="5760766">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760774">if</span>&nbsp;<span class="ident" id="5760777">p</span><span class="op" id="5760778">.</span><span class="ident" id="5760779">peek</span><span class="op" id="5760783">(</span><span class="op" id="5760784">)</span>&nbsp;<span class="op" id="5760786">!=</span>&nbsp;<span class="string" id="5760789">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5760793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760797">displayName</span><span class="op" id="5760808">,</span>&nbsp;<span class="ident" id="5760810">err</span>&nbsp;<span class="op" id="5760814">=</span>&nbsp;<span class="ident" id="5760816">p</span><span class="op" id="5760817">.</span><span class="ident" id="5760818">consumePhrase</span><span class="op" id="5760831">(</span><span class="op" id="5760832">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760836">if</span>&nbsp;<span class="ident" id="5760839">err</span>&nbsp;<span class="op" id="5760843">!=</span>&nbsp;<span class="ident" id="5760846">nil</span>&nbsp;<span class="op" id="5760850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760855">return</span>&nbsp;<span class="ident" id="5760862">nil</span><span class="op" id="5760865">,</span>&nbsp;<span class="ident" id="5760867">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760879">debug</span><span class="op" id="5760884">.</span><span class="ident" id="5760885">Printf</span><span class="op" id="5760891">(</span><span class="string" id="5760892">&#34;parseAddress:&nbsp;displayName=%q&#34;</span><span class="op" id="5760922">,</span>&nbsp;<span class="ident" id="5760924">displayName</span><span class="op" id="5760935">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5760939">//&nbsp;angle-addr&nbsp;=&nbsp;&#34;&lt;&#34;&nbsp;addr-spec&nbsp;&#34;&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760974">p</span><span class="op" id="5760975">.</span><span class="ident" id="5760976">skipSpace</span><span class="op" id="5760985">(</span><span class="op" id="5760986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760989">if</span>&nbsp;<span class="op" id="5760992">!</span><span class="ident" id="5760993">p</span><span class="op" id="5760994">.</span><span class="ident" id="5760995">consume</span><span class="op" id="5761002">(</span><span class="string" id="5761003">&#39;&lt;&#39;</span><span class="op" id="5761006">)</span>&nbsp;<span class="op" id="5761008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761012">return</span>&nbsp;<span class="ident" id="5761019">nil</span><span class="op" id="5761022">,</span>&nbsp;<span class="ident" id="5761024">errors</span><span class="op" id="5761030">.</span><span class="ident" id="5761031">New</span><span class="op" id="5761034">(</span><span class="string" id="5761035">&#34;mail:&nbsp;no&nbsp;angle-addr&#34;</span><span class="op" id="5761056">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761062">spec</span><span class="op" id="5761066">,</span>&nbsp;<span class="ident" id="5761068">err</span>&nbsp;<span class="op" id="5761072">=</span>&nbsp;<span class="ident" id="5761074">p</span><span class="op" id="5761075">.</span><span class="ident" id="5761076">consumeAddrSpec</span><span class="op" id="5761091">(</span><span class="op" id="5761092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761095">if</span>&nbsp;<span class="ident" id="5761098">err</span>&nbsp;<span class="op" id="5761102">!=</span>&nbsp;<span class="ident" id="5761105">nil</span>&nbsp;<span class="op" id="5761109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761113">return</span>&nbsp;<span class="ident" id="5761120">nil</span><span class="op" id="5761123">,</span>&nbsp;<span class="ident" id="5761125">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761130">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761133">if</span>&nbsp;<span class="op" id="5761136">!</span><span class="ident" id="5761137">p</span><span class="op" id="5761138">.</span><span class="ident" id="5761139">consume</span><span class="op" id="5761146">(</span><span class="string" id="5761147">&#39;&gt;&#39;</span><span class="op" id="5761150">)</span>&nbsp;<span class="op" id="5761152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761156">return</span>&nbsp;<span class="ident" id="5761163">nil</span><span class="op" id="5761166">,</span>&nbsp;<span class="ident" id="5761168">errors</span><span class="op" id="5761174">.</span><span class="ident" id="5761175">New</span><span class="op" id="5761178">(</span><span class="string" id="5761179">&#34;mail:&nbsp;unclosed&nbsp;angle-addr&#34;</span><span class="op" id="5761206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761212">debug</span><span class="op" id="5761217">.</span><span class="ident" id="5761218">Printf</span><span class="op" id="5761224">(</span><span class="string" id="5761225">&#34;parseAddress:&nbsp;spec=%q&#34;</span><span class="op" id="5761248">,</span>&nbsp;<span class="ident" id="5761250">spec</span><span class="op" id="5761254">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761258">return</span>&nbsp;<span class="op" id="5761265">&amp;</span><span class="ident" id="5761266">Address</span><span class="op" id="5761273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761277">Name</span><span class="op" id="5761281">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761286">displayName</span><span class="op" id="5761297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761301">Address</span><span class="op" id="5761308">:</span>&nbsp;<span class="ident" id="5761310">spec</span><span class="op" id="5761314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761317">}</span><span class="op" id="5761318">,</span>&nbsp;<span class="ident" id="5761320">nil</span><br>
<span class="lineno"></span><span class="op" id="5761324">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="5761327">//&nbsp;consumeAddrSpec&nbsp;parses&nbsp;a&nbsp;single&nbsp;RFC&nbsp;5322&nbsp;addr-spec&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5761400">func</span>&nbsp;<span class="op" id="5761405">(</span><span class="ident" id="5761406">p</span>&nbsp;<span class="op" id="5761408">*</span><span class="ident" id="5761409">addrParser</span><span class="op" id="5761419">)</span>&nbsp;<span class="ident" id="5761421">consumeAddrSpec</span><span class="op" id="5761436">(</span><span class="op" id="5761437">)</span>&nbsp;<span class="op" id="5761439">(</span><span class="ident" id="5761440">spec</span>&nbsp;<span class="builtintype" id="5761445">string</span><span class="op" id="5761451">,</span>&nbsp;<span class="ident" id="5761453">err</span>&nbsp;<span class="builtintype" id="5761457">error</span><span class="op" id="5761462">)</span>&nbsp;<span class="op" id="5761464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761467">debug</span><span class="op" id="5761472">.</span><span class="ident" id="5761473">Printf</span><span class="op" id="5761479">(</span><span class="string" id="5761480">&#34;consumeAddrSpec:&nbsp;%q&#34;</span><span class="op" id="5761501">,</span>&nbsp;<span class="op" id="5761503">*</span><span class="ident" id="5761504">p</span><span class="op" id="5761505">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761509">orig</span>&nbsp;<span class="op" id="5761514">:=</span>&nbsp;<span class="op" id="5761517">*</span><span class="ident" id="5761518">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761521">defer</span>&nbsp;<span class="keyword" id="5761527">func</span><span class="op" id="5761531">(</span><span class="op" id="5761532">)</span>&nbsp;<span class="op" id="5761534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761538">if</span>&nbsp;<span class="ident" id="5761541">err</span>&nbsp;<span class="op" id="5761545">!=</span>&nbsp;<span class="ident" id="5761548">nil</span>&nbsp;<span class="op" id="5761552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761557">*</span><span class="ident" id="5761558">p</span>&nbsp;<span class="op" id="5761560">=</span>&nbsp;<span class="ident" id="5761562">orig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761569">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761572">}</span><span class="op" id="5761573">(</span><span class="op" id="5761574">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761578">//&nbsp;local-part&nbsp;=&nbsp;dot-atom&nbsp;/&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761620">var</span>&nbsp;<span class="ident" id="5761624">localPart</span>&nbsp;<span class="builtintype" id="5761634">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761642">p</span><span class="op" id="5761643">.</span><span class="ident" id="5761644">skipSpace</span><span class="op" id="5761653">(</span><span class="op" id="5761654">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761657">if</span>&nbsp;<span class="ident" id="5761660">p</span><span class="op" id="5761661">.</span><span class="ident" id="5761662">empty</span><span class="op" id="5761667">(</span><span class="op" id="5761668">)</span>&nbsp;<span class="op" id="5761670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761674">return</span>&nbsp;<span class="string" id="5761681">&#34;&#34;</span><span class="op" id="5761683">,</span>&nbsp;<span class="ident" id="5761685">errors</span><span class="op" id="5761691">.</span><span class="ident" id="5761692">New</span><span class="op" id="5761695">(</span><span class="string" id="5761696">&#34;mail:&nbsp;no&nbsp;addr-spec&#34;</span><span class="op" id="5761716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761722">if</span>&nbsp;<span class="ident" id="5761725">p</span><span class="op" id="5761726">.</span><span class="ident" id="5761727">peek</span><span class="op" id="5761731">(</span><span class="op" id="5761732">)</span>&nbsp;<span class="op" id="5761734">==</span>&nbsp;<span class="string" id="5761737">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="5761741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761745">//&nbsp;quoted-string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761764">debug</span><span class="op" id="5761769">.</span><span class="ident" id="5761770">Printf</span><span class="op" id="5761776">(</span><span class="string" id="5761777">&#34;consumeAddrSpec:&nbsp;parsing&nbsp;quoted-string&#34;</span><span class="op" id="5761817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761821">localPart</span><span class="op" id="5761830">,</span>&nbsp;<span class="ident" id="5761832">err</span>&nbsp;<span class="op" id="5761836">=</span>&nbsp;<span class="ident" id="5761838">p</span><span class="op" id="5761839">.</span><span class="ident" id="5761840">consumeQuotedString</span><span class="op" id="5761859">(</span><span class="op" id="5761860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761863">}</span>&nbsp;<span class="keyword" id="5761865">else</span>&nbsp;<span class="op" id="5761870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761874">//&nbsp;dot-atom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761888">debug</span><span class="op" id="5761893">.</span><span class="ident" id="5761894">Printf</span><span class="op" id="5761900">(</span><span class="string" id="5761901">&#34;consumeAddrSpec:&nbsp;parsing&nbsp;dot-atom&#34;</span><span class="op" id="5761936">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761940">localPart</span><span class="op" id="5761949">,</span>&nbsp;<span class="ident" id="5761951">err</span>&nbsp;<span class="op" id="5761955">=</span>&nbsp;<span class="ident" id="5761957">p</span><span class="op" id="5761958">.</span><span class="ident" id="5761959">consumeAtom</span><span class="op" id="5761970">(</span><span class="builtintype" id="5761971">true</span><span class="op" id="5761975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761981">if</span>&nbsp;<span class="ident" id="5761984">err</span>&nbsp;<span class="op" id="5761988">!=</span>&nbsp;<span class="ident" id="5761991">nil</span>&nbsp;<span class="op" id="5761995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761999">debug</span><span class="op" id="5762004">.</span><span class="ident" id="5762005">Printf</span><span class="op" id="5762011">(</span><span class="string" id="5762012">&#34;consumeAddrSpec:&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="5762041">,</span>&nbsp;<span class="ident" id="5762043">err</span><span class="op" id="5762046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762050">return</span>&nbsp;<span class="string" id="5762057">&#34;&#34;</span><span class="op" id="5762059">,</span>&nbsp;<span class="ident" id="5762061">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762070">if</span>&nbsp;<span class="op" id="5762073">!</span><span class="ident" id="5762074">p</span><span class="op" id="5762075">.</span><span class="ident" id="5762076">consume</span><span class="op" id="5762083">(</span><span class="string" id="5762084">&#39;@&#39;</span><span class="op" id="5762087">)</span>&nbsp;<span class="op" id="5762089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762093">return</span>&nbsp;<span class="string" id="5762100">&#34;&#34;</span><span class="op" id="5762102">,</span>&nbsp;<span class="ident" id="5762104">errors</span><span class="op" id="5762110">.</span><span class="ident" id="5762111">New</span><span class="op" id="5762114">(</span><span class="string" id="5762115">&#34;mail:&nbsp;missing&nbsp;@&nbsp;in&nbsp;addr-spec&#34;</span><span class="op" id="5762145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762148">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762152">//&nbsp;domain&nbsp;=&nbsp;dot-atom&nbsp;/&nbsp;domain-literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762191">var</span>&nbsp;<span class="ident" id="5762195">domain</span>&nbsp;<span class="builtintype" id="5762202">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762210">p</span><span class="op" id="5762211">.</span><span class="ident" id="5762212">skipSpace</span><span class="op" id="5762221">(</span><span class="op" id="5762222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762225">if</span>&nbsp;<span class="ident" id="5762228">p</span><span class="op" id="5762229">.</span><span class="ident" id="5762230">empty</span><span class="op" id="5762235">(</span><span class="op" id="5762236">)</span>&nbsp;<span class="op" id="5762238">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762242">return</span>&nbsp;<span class="string" id="5762249">&#34;&#34;</span><span class="op" id="5762251">,</span>&nbsp;<span class="ident" id="5762253">errors</span><span class="op" id="5762259">.</span><span class="ident" id="5762260">New</span><span class="op" id="5762263">(</span><span class="string" id="5762264">&#34;mail:&nbsp;no&nbsp;domain&nbsp;in&nbsp;addr-spec&#34;</span><span class="op" id="5762294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762300">//&nbsp;TODO(dsymonds):&nbsp;Handle&nbsp;domain-literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762342">domain</span><span class="op" id="5762348">,</span>&nbsp;<span class="ident" id="5762350">err</span>&nbsp;<span class="op" id="5762354">=</span>&nbsp;<span class="ident" id="5762356">p</span><span class="op" id="5762357">.</span><span class="ident" id="5762358">consumeAtom</span><span class="op" id="5762369">(</span><span class="builtintype" id="5762370">true</span><span class="op" id="5762374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762377">if</span>&nbsp;<span class="ident" id="5762380">err</span>&nbsp;<span class="op" id="5762384">!=</span>&nbsp;<span class="ident" id="5762387">nil</span>&nbsp;<span class="op" id="5762391">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762395">return</span>&nbsp;<span class="string" id="5762402">&#34;&#34;</span><span class="op" id="5762404">,</span>&nbsp;<span class="ident" id="5762406">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762415">return</span>&nbsp;<span class="ident" id="5762422">localPart</span>&nbsp;<span class="op" id="5762432">+</span>&nbsp;<span class="string" id="5762434">&#34;@&#34;</span>&nbsp;<span class="op" id="5762438">+</span>&nbsp;<span class="ident" id="5762440">domain</span><span class="op" id="5762446">,</span>&nbsp;<span class="ident" id="5762448">nil</span><br>
<span class="lineno"></span><span class="op" id="5762452">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="5762455">//&nbsp;consumePhrase&nbsp;parses&nbsp;the&nbsp;RFC&nbsp;5322&nbsp;phrase&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5762518">func</span>&nbsp;<span class="op" id="5762523">(</span><span class="ident" id="5762524">p</span>&nbsp;<span class="op" id="5762526">*</span><span class="ident" id="5762527">addrParser</span><span class="op" id="5762537">)</span>&nbsp;<span class="ident" id="5762539">consumePhrase</span><span class="op" id="5762552">(</span><span class="op" id="5762553">)</span>&nbsp;<span class="op" id="5762555">(</span><span class="ident" id="5762556">phrase</span>&nbsp;<span class="builtintype" id="5762563">string</span><span class="op" id="5762569">,</span>&nbsp;<span class="ident" id="5762571">err</span>&nbsp;<span class="builtintype" id="5762575">error</span><span class="op" id="5762580">)</span>&nbsp;<span class="op" id="5762582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762585">debug</span><span class="op" id="5762590">.</span><span class="ident" id="5762591">Printf</span><span class="op" id="5762597">(</span><span class="string" id="5762598">&#34;consumePhrase:&nbsp;[%s]&#34;</span><span class="op" id="5762619">,</span>&nbsp;<span class="op" id="5762621">*</span><span class="ident" id="5762622">p</span><span class="op" id="5762623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762626">//&nbsp;phrase&nbsp;=&nbsp;1*word</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762646">var</span>&nbsp;<span class="ident" id="5762650">words</span>&nbsp;<span class="op" id="5762656">[</span><span class="op" id="5762657">]</span><span class="builtintype" id="5762658">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762666">for</span>&nbsp;<span class="op" id="5762670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762674">//&nbsp;word&nbsp;=&nbsp;atom&nbsp;/&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762707">var</span>&nbsp;<span class="ident" id="5762711">word</span>&nbsp;<span class="builtintype" id="5762716">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762725">p</span><span class="op" id="5762726">.</span><span class="ident" id="5762727">skipSpace</span><span class="op" id="5762736">(</span><span class="op" id="5762737">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762741">if</span>&nbsp;<span class="ident" id="5762744">p</span><span class="op" id="5762745">.</span><span class="ident" id="5762746">empty</span><span class="op" id="5762751">(</span><span class="op" id="5762752">)</span>&nbsp;<span class="op" id="5762754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762759">return</span>&nbsp;<span class="string" id="5762766">&#34;&#34;</span><span class="op" id="5762768">,</span>&nbsp;<span class="ident" id="5762770">errors</span><span class="op" id="5762776">.</span><span class="ident" id="5762777">New</span><span class="op" id="5762780">(</span><span class="string" id="5762781">&#34;mail:&nbsp;missing&nbsp;phrase&#34;</span><span class="op" id="5762803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762811">if</span>&nbsp;<span class="ident" id="5762814">p</span><span class="op" id="5762815">.</span><span class="ident" id="5762816">peek</span><span class="op" id="5762820">(</span><span class="op" id="5762821">)</span>&nbsp;<span class="op" id="5762823">==</span>&nbsp;<span class="string" id="5762826">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="5762830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762835">//&nbsp;quoted-string</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762855">word</span><span class="op" id="5762859">,</span>&nbsp;<span class="ident" id="5762861">err</span>&nbsp;<span class="op" id="5762865">=</span>&nbsp;<span class="ident" id="5762867">p</span><span class="op" id="5762868">.</span><span class="ident" id="5762869">consumeQuotedString</span><span class="op" id="5762888">(</span><span class="op" id="5762889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762893">}</span>&nbsp;<span class="keyword" id="5762895">else</span>&nbsp;<span class="op" id="5762900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762905">//&nbsp;atom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762916">//&nbsp;We&nbsp;actually&nbsp;parse&nbsp;dot-atom&nbsp;here&nbsp;to&nbsp;be&nbsp;more&nbsp;permissive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5762976">//&nbsp;than&nbsp;what&nbsp;RFC&nbsp;5322&nbsp;specifies.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763012">word</span><span class="op" id="5763016">,</span>&nbsp;<span class="ident" id="5763018">err</span>&nbsp;<span class="op" id="5763022">=</span>&nbsp;<span class="ident" id="5763024">p</span><span class="op" id="5763025">.</span><span class="ident" id="5763026">consumeAtom</span><span class="op" id="5763037">(</span><span class="builtintype" id="5763038">true</span><span class="op" id="5763042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763051">//&nbsp;RFC&nbsp;2047&nbsp;encoded-word&nbsp;starts&nbsp;with&nbsp;=?,&nbsp;ends&nbsp;with&nbsp;?=,&nbsp;and&nbsp;has&nbsp;two&nbsp;other&nbsp;?s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763130">if</span>&nbsp;<span class="ident" id="5763133">err</span>&nbsp;<span class="op" id="5763137">==</span>&nbsp;<span class="ident" id="5763140">nil</span>&nbsp;<span class="op" id="5763144">&amp;&amp;</span>&nbsp;<span class="ident" id="5763147">strings</span><span class="op" id="5763154">.</span><span class="ident" id="5763155">HasPrefix</span><span class="op" id="5763164">(</span><span class="ident" id="5763165">word</span><span class="op" id="5763169">,</span>&nbsp;<span class="string" id="5763171">&#34;=?&#34;</span><span class="op" id="5763175">)</span>&nbsp;<span class="op" id="5763177">&amp;&amp;</span>&nbsp;<span class="ident" id="5763180">strings</span><span class="op" id="5763187">.</span><span class="ident" id="5763188">HasSuffix</span><span class="op" id="5763197">(</span><span class="ident" id="5763198">word</span><span class="op" id="5763202">,</span>&nbsp;<span class="string" id="5763204">&#34;?=&#34;</span><span class="op" id="5763208">)</span>&nbsp;<span class="op" id="5763210">&amp;&amp;</span>&nbsp;<span class="ident" id="5763213">strings</span><span class="op" id="5763220">.</span><span class="ident" id="5763221">Count</span><span class="op" id="5763226">(</span><span class="ident" id="5763227">word</span><span class="op" id="5763231">,</span>&nbsp;<span class="string" id="5763233">&#34;?&#34;</span><span class="op" id="5763236">)</span>&nbsp;<span class="op" id="5763238">==</span>&nbsp;<span class="num" id="5763241">4</span>&nbsp;<span class="op" id="5763243">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763248">word</span><span class="op" id="5763252">,</span>&nbsp;<span class="ident" id="5763254">err</span>&nbsp;<span class="op" id="5763258">=</span>&nbsp;<span class="ident" id="5763260">decodeRFC2047Word</span><span class="op" id="5763277">(</span><span class="ident" id="5763278">word</span><span class="op" id="5763282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763291">if</span>&nbsp;<span class="ident" id="5763294">err</span>&nbsp;<span class="op" id="5763298">!=</span>&nbsp;<span class="ident" id="5763301">nil</span>&nbsp;<span class="op" id="5763305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763310">break</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763322">debug</span><span class="op" id="5763327">.</span><span class="ident" id="5763328">Printf</span><span class="op" id="5763334">(</span><span class="string" id="5763335">&#34;consumePhrase:&nbsp;consumed&nbsp;%q&#34;</span><span class="op" id="5763363">,</span>&nbsp;<span class="ident" id="5763365">word</span><span class="op" id="5763369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763373">words</span>&nbsp;<span class="op" id="5763379">=</span>&nbsp;<span class="builtinfunc" id="5763381">append</span><span class="op" id="5763387">(</span><span class="ident" id="5763388">words</span><span class="op" id="5763393">,</span>&nbsp;<span class="ident" id="5763395">word</span><span class="op" id="5763399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763405">//&nbsp;Ignore&nbsp;any&nbsp;error&nbsp;if&nbsp;we&nbsp;got&nbsp;at&nbsp;least&nbsp;one&nbsp;word.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763455">if</span>&nbsp;<span class="ident" id="5763458">err</span>&nbsp;<span class="op" id="5763462">!=</span>&nbsp;<span class="ident" id="5763465">nil</span>&nbsp;<span class="op" id="5763469">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5763472">len</span><span class="op" id="5763475">(</span><span class="ident" id="5763476">words</span><span class="op" id="5763481">)</span>&nbsp;<span class="op" id="5763483">==</span>&nbsp;<span class="num" id="5763486">0</span>&nbsp;<span class="op" id="5763488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763492">debug</span><span class="op" id="5763497">.</span><span class="ident" id="5763498">Printf</span><span class="op" id="5763504">(</span><span class="string" id="5763505">&#34;consumePhrase:&nbsp;hit&nbsp;err:&nbsp;%v&#34;</span><span class="op" id="5763533">,</span>&nbsp;<span class="ident" id="5763535">err</span><span class="op" id="5763538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763542">return</span>&nbsp;<span class="string" id="5763549">&#34;&#34;</span><span class="op" id="5763551">,</span>&nbsp;<span class="ident" id="5763553">fmt</span><span class="op" id="5763556">.</span><span class="ident" id="5763557">Errorf</span><span class="op" id="5763563">(</span><span class="string" id="5763564">&#34;mail:&nbsp;missing&nbsp;word&nbsp;in&nbsp;phrase:&nbsp;%v&#34;</span><span class="op" id="5763598">,</span>&nbsp;<span class="ident" id="5763600">err</span><span class="op" id="5763603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763609">phrase</span>&nbsp;<span class="op" id="5763616">=</span>&nbsp;<span class="ident" id="5763618">strings</span><span class="op" id="5763625">.</span><span class="ident" id="5763626">Join</span><span class="op" id="5763630">(</span><span class="ident" id="5763631">words</span><span class="op" id="5763636">,</span>&nbsp;<span class="string" id="5763638">&#34;&nbsp;&#34;</span><span class="op" id="5763641">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763644">return</span>&nbsp;<span class="ident" id="5763651">phrase</span><span class="op" id="5763657">,</span>&nbsp;<span class="ident" id="5763659">nil</span><br>
<span class="lineno"></span><span class="op" id="5763663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5763666">//&nbsp;consumeQuotedString&nbsp;parses&nbsp;the&nbsp;quoted&nbsp;string&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5763733">func</span>&nbsp;<span class="op" id="5763738">(</span><span class="ident" id="5763739">p</span>&nbsp;<span class="op" id="5763741">*</span><span class="ident" id="5763742">addrParser</span><span class="op" id="5763752">)</span>&nbsp;<span class="ident" id="5763754">consumeQuotedString</span><span class="op" id="5763773">(</span><span class="op" id="5763774">)</span>&nbsp;<span class="op" id="5763776">(</span><span class="ident" id="5763777">qs</span>&nbsp;<span class="builtintype" id="5763780">string</span><span class="op" id="5763786">,</span>&nbsp;<span class="ident" id="5763788">err</span>&nbsp;<span class="builtintype" id="5763792">error</span><span class="op" id="5763797">)</span>&nbsp;<span class="op" id="5763799">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763802">//&nbsp;Assume&nbsp;first&nbsp;byte&nbsp;is&nbsp;&#39;&#34;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763832">i</span>&nbsp;<span class="op" id="5763834">:=</span>&nbsp;<span class="num" id="5763837">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763840">qsb</span>&nbsp;<span class="op" id="5763844">:=</span>&nbsp;<span class="builtinfunc" id="5763847">make</span><span class="op" id="5763851">(</span><span class="op" id="5763852">[</span><span class="op" id="5763853">]</span><span class="builtintype" id="5763854">byte</span><span class="op" id="5763858">,</span>&nbsp;<span class="num" id="5763860">0</span><span class="op" id="5763861">,</span>&nbsp;<span class="num" id="5763863">10</span><span class="op" id="5763865">)</span><br>
<span class="lineno"></span><span class="ident" id="5763867">Loop</span><span class="op" id="5763871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763874">for</span>&nbsp;<span class="op" id="5763878">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763882">if</span>&nbsp;<span class="ident" id="5763885">i</span>&nbsp;<span class="op" id="5763887">&gt;=</span>&nbsp;<span class="ident" id="5763890">p</span><span class="op" id="5763891">.</span><span class="builtinfunc" id="5763892">len</span><span class="op" id="5763895">(</span><span class="op" id="5763896">)</span>&nbsp;<span class="op" id="5763898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763903">return</span>&nbsp;<span class="string" id="5763910">&#34;&#34;</span><span class="op" id="5763912">,</span>&nbsp;<span class="ident" id="5763914">errors</span><span class="op" id="5763920">.</span><span class="ident" id="5763921">New</span><span class="op" id="5763924">(</span><span class="string" id="5763925">&#34;mail:&nbsp;unclosed&nbsp;quoted-string&#34;</span><span class="op" id="5763955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763963">switch</span>&nbsp;<span class="ident" id="5763970">c</span>&nbsp;<span class="op" id="5763972">:=</span>&nbsp;<span class="op" id="5763975">(</span><span class="op" id="5763976">*</span><span class="ident" id="5763977">p</span><span class="op" id="5763978">)</span><span class="op" id="5763979">[</span><span class="ident" id="5763980">i</span><span class="op" id="5763981">]</span><span class="op" id="5763982">;</span>&nbsp;<span class="op" id="5763984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763988">case</span>&nbsp;<span class="ident" id="5763993">c</span>&nbsp;<span class="op" id="5763995">==</span>&nbsp;<span class="string" id="5763998">&#39;&#34;&#39;</span><span class="op" id="5764001">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764006">break</span>&nbsp;<span class="ident" id="5764012">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764019">case</span>&nbsp;<span class="ident" id="5764024">c</span>&nbsp;<span class="op" id="5764026">==</span>&nbsp;<span class="string" id="5764029">&#39;\\&#39;</span><span class="op" id="5764033">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764038">if</span>&nbsp;<span class="ident" id="5764041">i</span><span class="op" id="5764042">+</span><span class="num" id="5764043">1</span>&nbsp;<span class="op" id="5764045">==</span>&nbsp;<span class="ident" id="5764048">p</span><span class="op" id="5764049">.</span><span class="builtinfunc" id="5764050">len</span><span class="op" id="5764053">(</span><span class="op" id="5764054">)</span>&nbsp;<span class="op" id="5764056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764062">return</span>&nbsp;<span class="string" id="5764069">&#34;&#34;</span><span class="op" id="5764071">,</span>&nbsp;<span class="ident" id="5764073">errors</span><span class="op" id="5764079">.</span><span class="ident" id="5764080">New</span><span class="op" id="5764083">(</span><span class="string" id="5764084">&#34;mail:&nbsp;unclosed&nbsp;quoted-string&#34;</span><span class="op" id="5764114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764119">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764124">qsb</span>&nbsp;<span class="op" id="5764128">=</span>&nbsp;<span class="builtinfunc" id="5764130">append</span><span class="op" id="5764136">(</span><span class="ident" id="5764137">qsb</span><span class="op" id="5764140">,</span>&nbsp;<span class="op" id="5764142">(</span><span class="op" id="5764143">*</span><span class="ident" id="5764144">p</span><span class="op" id="5764145">)</span><span class="op" id="5764146">[</span><span class="ident" id="5764147">i</span><span class="op" id="5764148">+</span><span class="num" id="5764149">1</span><span class="op" id="5764150">]</span><span class="op" id="5764151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764156">i</span>&nbsp;<span class="op" id="5764158">+=</span>&nbsp;<span class="num" id="5764161">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764165">case</span>&nbsp;<span class="ident" id="5764170">isQtext</span><span class="op" id="5764177">(</span><span class="ident" id="5764178">c</span><span class="op" id="5764179">)</span><span class="op" id="5764180">,</span>&nbsp;<span class="ident" id="5764182">c</span>&nbsp;<span class="op" id="5764184">==</span>&nbsp;<span class="string" id="5764187">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5764191">||</span>&nbsp;<span class="ident" id="5764194">c</span>&nbsp;<span class="op" id="5764196">==</span>&nbsp;<span class="string" id="5764199">&#39;\t&#39;</span><span class="op" id="5764203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764208">//&nbsp;qtext&nbsp;(printable&nbsp;US-ASCII&nbsp;excluding&nbsp;&#34;&nbsp;and&nbsp;\),&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764263">//&nbsp;FWS&nbsp;(almost;&nbsp;we&#39;re&nbsp;ignoring&nbsp;CRLF)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764303">qsb</span>&nbsp;<span class="op" id="5764307">=</span>&nbsp;<span class="builtinfunc" id="5764309">append</span><span class="op" id="5764315">(</span><span class="ident" id="5764316">qsb</span><span class="op" id="5764319">,</span>&nbsp;<span class="ident" id="5764321">c</span><span class="op" id="5764322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764327">i</span><span class="op" id="5764328">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764333">default</span><span class="op" id="5764340">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764345">return</span>&nbsp;<span class="string" id="5764352">&#34;&#34;</span><span class="op" id="5764354">,</span>&nbsp;<span class="ident" id="5764356">fmt</span><span class="op" id="5764359">.</span><span class="ident" id="5764360">Errorf</span><span class="op" id="5764366">(</span><span class="string" id="5764367">&#34;mail:&nbsp;bad&nbsp;character&nbsp;in&nbsp;quoted-string:&nbsp;%q&#34;</span><span class="op" id="5764409">,</span>&nbsp;<span class="ident" id="5764411">c</span><span class="op" id="5764412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764416">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764422">*</span><span class="ident" id="5764423">p</span>&nbsp;<span class="op" id="5764425">=</span>&nbsp;<span class="op" id="5764427">(</span><span class="op" id="5764428">*</span><span class="ident" id="5764429">p</span><span class="op" id="5764430">)</span><span class="op" id="5764431">[</span><span class="ident" id="5764432">i</span><span class="op" id="5764433">+</span><span class="num" id="5764434">1</span><span class="op" id="5764435">:</span><span class="op" id="5764436">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764439">return</span>&nbsp;<span class="builtintype" id="5764446">string</span><span class="op" id="5764452">(</span><span class="ident" id="5764453">qsb</span><span class="op" id="5764456">)</span><span class="op" id="5764457">,</span>&nbsp;<span class="ident" id="5764459">nil</span><br>
<span class="lineno"></span><span class="op" id="5764463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="5764466">//&nbsp;consumeAtom&nbsp;parses&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;atom&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5764524">//&nbsp;If&nbsp;dot&nbsp;is&nbsp;true,&nbsp;consumeAtom&nbsp;parses&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;dot-atom&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="5764592">func</span>&nbsp;<span class="op" id="5764597">(</span><span class="ident" id="5764598">p</span>&nbsp;<span class="op" id="5764600">*</span><span class="ident" id="5764601">addrParser</span><span class="op" id="5764611">)</span>&nbsp;<span class="ident" id="5764613">consumeAtom</span><span class="op" id="5764624">(</span><span class="ident" id="5764625">dot</span>&nbsp;<span class="builtintype" id="5764629">bool</span><span class="op" id="5764633">)</span>&nbsp;<span class="op" id="5764635">(</span><span class="ident" id="5764636">atom</span>&nbsp;<span class="builtintype" id="5764641">string</span><span class="op" id="5764647">,</span>&nbsp;<span class="ident" id="5764649">err</span>&nbsp;<span class="builtintype" id="5764653">error</span><span class="op" id="5764658">)</span>&nbsp;<span class="op" id="5764660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764663">if</span>&nbsp;<span class="op" id="5764666">!</span><span class="ident" id="5764667">isAtext</span><span class="op" id="5764674">(</span><span class="ident" id="5764675">p</span><span class="op" id="5764676">.</span><span class="ident" id="5764677">peek</span><span class="op" id="5764681">(</span><span class="op" id="5764682">)</span><span class="op" id="5764683">,</span>&nbsp;<span class="builtintype" id="5764685">false</span><span class="op" id="5764690">)</span>&nbsp;<span class="op" id="5764692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764696">return</span>&nbsp;<span class="string" id="5764703">&#34;&#34;</span><span class="op" id="5764705">,</span>&nbsp;<span class="ident" id="5764707">errors</span><span class="op" id="5764713">.</span><span class="ident" id="5764714">New</span><span class="op" id="5764717">(</span><span class="string" id="5764718">&#34;mail:&nbsp;invalid&nbsp;string&#34;</span><span class="op" id="5764740">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764746">i</span>&nbsp;<span class="op" id="5764748">:=</span>&nbsp;<span class="num" id="5764751">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764754">for</span>&nbsp;<span class="op" id="5764758">;</span>&nbsp;<span class="ident" id="5764760">i</span>&nbsp;<span class="op" id="5764762">&lt;</span>&nbsp;<span class="ident" id="5764764">p</span><span class="op" id="5764765">.</span><span class="builtinfunc" id="5764766">len</span><span class="op" id="5764769">(</span><span class="op" id="5764770">)</span>&nbsp;<span class="op" id="5764772">&amp;&amp;</span>&nbsp;<span class="ident" id="5764775">isAtext</span><span class="op" id="5764782">(</span><span class="op" id="5764783">(</span><span class="op" id="5764784">*</span><span class="ident" id="5764785">p</span><span class="op" id="5764786">)</span><span class="op" id="5764787">[</span><span class="ident" id="5764788">i</span><span class="op" id="5764789">]</span><span class="op" id="5764790">,</span>&nbsp;<span class="ident" id="5764792">dot</span><span class="op" id="5764795">)</span><span class="op" id="5764796">;</span>&nbsp;<span class="ident" id="5764798">i</span><span class="op" id="5764799">++</span>&nbsp;<span class="op" id="5764802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764808">atom</span><span class="op" id="5764812">,</span>&nbsp;<span class="op" id="5764814">*</span><span class="ident" id="5764815">p</span>&nbsp;<span class="op" id="5764817">=</span>&nbsp;<span class="builtintype" id="5764819">string</span><span class="op" id="5764825">(</span><span class="op" id="5764826">(</span><span class="op" id="5764827">*</span><span class="ident" id="5764828">p</span><span class="op" id="5764829">)</span><span class="op" id="5764830">[</span><span class="op" id="5764831">:</span><span class="ident" id="5764832">i</span><span class="op" id="5764833">]</span><span class="op" id="5764834">)</span><span class="op" id="5764835">,</span>&nbsp;<span class="op" id="5764837">(</span><span class="op" id="5764838">*</span><span class="ident" id="5764839">p</span><span class="op" id="5764840">)</span><span class="op" id="5764841">[</span><span class="ident" id="5764842">i</span><span class="op" id="5764843">:</span><span class="op" id="5764844">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764847">return</span>&nbsp;<span class="ident" id="5764854">atom</span><span class="op" id="5764858">,</span>&nbsp;<span class="ident" id="5764860">nil</span><br>
<span class="lineno"></span><span class="op" id="5764864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5764867">func</span>&nbsp;<span class="op" id="5764872">(</span><span class="ident" id="5764873">p</span>&nbsp;<span class="op" id="5764875">*</span><span class="ident" id="5764876">addrParser</span><span class="op" id="5764886">)</span>&nbsp;<span class="ident" id="5764888">consume</span><span class="op" id="5764895">(</span><span class="ident" id="5764896">c</span>&nbsp;<span class="builtintype" id="5764898">byte</span><span class="op" id="5764902">)</span>&nbsp;<span class="builtintype" id="5764904">bool</span>&nbsp;<span class="op" id="5764909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764912">if</span>&nbsp;<span class="ident" id="5764915">p</span><span class="op" id="5764916">.</span><span class="ident" id="5764917">empty</span><span class="op" id="5764922">(</span><span class="op" id="5764923">)</span>&nbsp;<span class="op" id="5764925">||</span>&nbsp;<span class="ident" id="5764928">p</span><span class="op" id="5764929">.</span><span class="ident" id="5764930">peek</span><span class="op" id="5764934">(</span><span class="op" id="5764935">)</span>&nbsp;<span class="op" id="5764937">!=</span>&nbsp;<span class="ident" id="5764940">c</span>&nbsp;<span class="op" id="5764942">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764946">return</span>&nbsp;<span class="builtintype" id="5764953">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764963">*</span><span class="ident" id="5764964">p</span>&nbsp;<span class="op" id="5764966">=</span>&nbsp;<span class="op" id="5764968">(</span><span class="op" id="5764969">*</span><span class="ident" id="5764970">p</span><span class="op" id="5764971">)</span><span class="op" id="5764972">[</span><span class="num" id="5764973">1</span><span class="op" id="5764974">:</span><span class="op" id="5764975">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764978">return</span>&nbsp;<span class="builtintype" id="5764985">true</span><br>
<span class="lineno"></span><span class="op" id="5764990">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="5764993">//&nbsp;skipSpace&nbsp;skips&nbsp;the&nbsp;leading&nbsp;space&nbsp;and&nbsp;tab&nbsp;characters.</span><br>
<span class="lineno"></span><span class="keyword" id="5765050">func</span>&nbsp;<span class="op" id="5765055">(</span><span class="ident" id="5765056">p</span>&nbsp;<span class="op" id="5765058">*</span><span class="ident" id="5765059">addrParser</span><span class="op" id="5765069">)</span>&nbsp;<span class="ident" id="5765071">skipSpace</span><span class="op" id="5765080">(</span><span class="op" id="5765081">)</span>&nbsp;<span class="op" id="5765083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765086">*</span><span class="ident" id="5765087">p</span>&nbsp;<span class="op" id="5765089">=</span>&nbsp;<span class="ident" id="5765091">bytes</span><span class="op" id="5765096">.</span><span class="ident" id="5765097">TrimLeft</span><span class="op" id="5765105">(</span><span class="op" id="5765106">*</span><span class="ident" id="5765107">p</span><span class="op" id="5765108">,</span>&nbsp;<span class="string" id="5765110">&#34;&nbsp;\t&#34;</span><span class="op" id="5765115">)</span><br>
<span class="lineno"></span><span class="op" id="5765117">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span><span class="keyword" id="5765120">func</span>&nbsp;<span class="op" id="5765125">(</span><span class="ident" id="5765126">p</span>&nbsp;<span class="op" id="5765128">*</span><span class="ident" id="5765129">addrParser</span><span class="op" id="5765139">)</span>&nbsp;<span class="ident" id="5765141">peek</span><span class="op" id="5765145">(</span><span class="op" id="5765146">)</span>&nbsp;<span class="builtintype" id="5765148">byte</span>&nbsp;<span class="op" id="5765153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765156">return</span>&nbsp;<span class="op" id="5765163">(</span><span class="op" id="5765164">*</span><span class="ident" id="5765165">p</span><span class="op" id="5765166">)</span><span class="op" id="5765167">[</span><span class="num" id="5765168">0</span><span class="op" id="5765169">]</span><br>
<span class="lineno"></span><span class="op" id="5765171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="5765174">func</span>&nbsp;<span class="op" id="5765179">(</span><span class="ident" id="5765180">p</span>&nbsp;<span class="op" id="5765182">*</span><span class="ident" id="5765183">addrParser</span><span class="op" id="5765193">)</span>&nbsp;<span class="ident" id="5765195">empty</span><span class="op" id="5765200">(</span><span class="op" id="5765201">)</span>&nbsp;<span class="builtintype" id="5765203">bool</span>&nbsp;<span class="op" id="5765208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765211">return</span>&nbsp;<span class="ident" id="5765218">p</span><span class="op" id="5765219">.</span><span class="builtinfunc" id="5765220">len</span><span class="op" id="5765223">(</span><span class="op" id="5765224">)</span>&nbsp;<span class="op" id="5765226">==</span>&nbsp;<span class="num" id="5765229">0</span><br>
<span class="lineno"></span><span class="op" id="5765231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5765234">func</span>&nbsp;<span class="op" id="5765239">(</span><span class="ident" id="5765240">p</span>&nbsp;<span class="op" id="5765242">*</span><span class="ident" id="5765243">addrParser</span><span class="op" id="5765253">)</span>&nbsp;<span class="builtinfunc" id="5765255">len</span><span class="op" id="5765258">(</span><span class="op" id="5765259">)</span>&nbsp;<span class="builtintype" id="5765261">int</span>&nbsp;<span class="op" id="5765265">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765268">return</span>&nbsp;<span class="builtinfunc" id="5765275">len</span><span class="op" id="5765278">(</span><span class="op" id="5765279">*</span><span class="ident" id="5765280">p</span><span class="op" id="5765281">)</span><br>
<span class="lineno"></span><span class="op" id="5765283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5765286">func</span>&nbsp;<span class="ident" id="5765291">decodeRFC2047Word</span><span class="op" id="5765308">(</span><span class="ident" id="5765309">s</span>&nbsp;<span class="builtintype" id="5765311">string</span><span class="op" id="5765317">)</span>&nbsp;<span class="op" id="5765319">(</span><span class="builtintype" id="5765320">string</span><span class="op" id="5765326">,</span>&nbsp;<span class="builtintype" id="5765328">error</span><span class="op" id="5765333">)</span>&nbsp;<span class="op" id="5765335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765338">fields</span>&nbsp;<span class="op" id="5765345">:=</span>&nbsp;<span class="ident" id="5765348">strings</span><span class="op" id="5765355">.</span><span class="ident" id="5765356">Split</span><span class="op" id="5765361">(</span><span class="ident" id="5765362">s</span><span class="op" id="5765363">,</span>&nbsp;<span class="string" id="5765365">&#34;?&#34;</span><span class="op" id="5765368">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765371">if</span>&nbsp;<span class="builtinfunc" id="5765374">len</span><span class="op" id="5765377">(</span><span class="ident" id="5765378">fields</span><span class="op" id="5765384">)</span>&nbsp;<span class="op" id="5765386">!=</span>&nbsp;<span class="num" id="5765389">5</span>&nbsp;<span class="op" id="5765391">||</span>&nbsp;<span class="ident" id="5765394">fields</span><span class="op" id="5765400">[</span><span class="num" id="5765401">0</span><span class="op" id="5765402">]</span>&nbsp;<span class="op" id="5765404">!=</span>&nbsp;<span class="string" id="5765407">&#34;=&#34;</span>&nbsp;<span class="op" id="5765411">||</span>&nbsp;<span class="ident" id="5765414">fields</span><span class="op" id="5765420">[</span><span class="num" id="5765421">4</span><span class="op" id="5765422">]</span>&nbsp;<span class="op" id="5765424">!=</span>&nbsp;<span class="string" id="5765427">&#34;=&#34;</span>&nbsp;<span class="op" id="5765431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765435">return</span>&nbsp;<span class="string" id="5765442">&#34;&#34;</span><span class="op" id="5765444">,</span>&nbsp;<span class="ident" id="5765446">errors</span><span class="op" id="5765452">.</span><span class="ident" id="5765453">New</span><span class="op" id="5765456">(</span><span class="string" id="5765457">&#34;address&nbsp;not&nbsp;RFC&nbsp;2047&nbsp;encoded&#34;</span><span class="op" id="5765487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765493">charset</span><span class="op" id="5765500">,</span>&nbsp;<span class="ident" id="5765502">enc</span>&nbsp;<span class="op" id="5765506">:=</span>&nbsp;<span class="ident" id="5765509">strings</span><span class="op" id="5765516">.</span><span class="ident" id="5765517">ToLower</span><span class="op" id="5765524">(</span><span class="ident" id="5765525">fields</span><span class="op" id="5765531">[</span><span class="num" id="5765532">1</span><span class="op" id="5765533">]</span><span class="op" id="5765534">)</span><span class="op" id="5765535">,</span>&nbsp;<span class="ident" id="5765537">strings</span><span class="op" id="5765544">.</span><span class="ident" id="5765545">ToLower</span><span class="op" id="5765552">(</span><span class="ident" id="5765553">fields</span><span class="op" id="5765559">[</span><span class="num" id="5765560">2</span><span class="op" id="5765561">]</span><span class="op" id="5765562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765565">if</span>&nbsp;<span class="ident" id="5765568">charset</span>&nbsp;<span class="op" id="5765576">!=</span>&nbsp;<span class="string" id="5765579">&#34;us-ascii&#34;</span>&nbsp;<span class="op" id="5765590">&amp;&amp;</span>&nbsp;<span class="ident" id="5765593">charset</span>&nbsp;<span class="op" id="5765601">!=</span>&nbsp;<span class="string" id="5765604">&#34;iso-8859-1&#34;</span>&nbsp;<span class="op" id="5765617">&amp;&amp;</span>&nbsp;<span class="ident" id="5765620">charset</span>&nbsp;<span class="op" id="5765628">!=</span>&nbsp;<span class="string" id="5765631">&#34;utf-8&#34;</span>&nbsp;<span class="op" id="5765639">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765643">return</span>&nbsp;<span class="string" id="5765650">&#34;&#34;</span><span class="op" id="5765652">,</span>&nbsp;<span class="ident" id="5765654">fmt</span><span class="op" id="5765657">.</span><span class="ident" id="5765658">Errorf</span><span class="op" id="5765664">(</span><span class="string" id="5765665">&#34;charset&nbsp;not&nbsp;supported:&nbsp;%q&#34;</span><span class="op" id="5765692">,</span>&nbsp;<span class="ident" id="5765694">charset</span><span class="op" id="5765701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765708">in</span>&nbsp;<span class="op" id="5765711">:=</span>&nbsp;<span class="ident" id="5765714">bytes</span><span class="op" id="5765719">.</span><span class="ident" id="5765720">NewBufferString</span><span class="op" id="5765735">(</span><span class="ident" id="5765736">fields</span><span class="op" id="5765742">[</span><span class="num" id="5765743">3</span><span class="op" id="5765744">]</span><span class="op" id="5765745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765748">var</span>&nbsp;<span class="ident" id="5765752">r</span>&nbsp;<span class="ident" id="5765754">io</span><span class="op" id="5765756">.</span><span class="ident" id="5765757">Reader</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765765">switch</span>&nbsp;<span class="ident" id="5765772">enc</span>&nbsp;<span class="op" id="5765776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765779">case</span>&nbsp;<span class="string" id="5765784">&#34;b&#34;</span><span class="op" id="5765787">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765791">r</span>&nbsp;<span class="op" id="5765793">=</span>&nbsp;<span class="ident" id="5765795">base64</span><span class="op" id="5765801">.</span><span class="ident" id="5765802">NewDecoder</span><span class="op" id="5765812">(</span><span class="ident" id="5765813">base64</span><span class="op" id="5765819">.</span><span class="ident" id="5765820">StdEncoding</span><span class="op" id="5765831">,</span>&nbsp;<span class="ident" id="5765833">in</span><span class="op" id="5765835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765838">case</span>&nbsp;<span class="string" id="5765843">&#34;q&#34;</span><span class="op" id="5765846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765850">r</span>&nbsp;<span class="op" id="5765852">=</span>&nbsp;<span class="ident" id="5765854">qDecoder</span><span class="op" id="5765862">{</span><span class="ident" id="5765863">r</span><span class="op" id="5765864">:</span>&nbsp;<span class="ident" id="5765866">in</span><span class="op" id="5765868">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765871">default</span><span class="op" id="5765878">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765882">return</span>&nbsp;<span class="string" id="5765889">&#34;&#34;</span><span class="op" id="5765891">,</span>&nbsp;<span class="ident" id="5765893">fmt</span><span class="op" id="5765896">.</span><span class="ident" id="5765897">Errorf</span><span class="op" id="5765903">(</span><span class="string" id="5765904">&#34;RFC&nbsp;2047&nbsp;encoding&nbsp;not&nbsp;supported:&nbsp;%q&#34;</span><span class="op" id="5765941">,</span>&nbsp;<span class="ident" id="5765943">enc</span><span class="op" id="5765946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765953">dec</span><span class="op" id="5765956">,</span>&nbsp;<span class="ident" id="5765958">err</span>&nbsp;<span class="op" id="5765962">:=</span>&nbsp;<span class="ident" id="5765965">ioutil</span><span class="op" id="5765971">.</span><span class="ident" id="5765972">ReadAll</span><span class="op" id="5765979">(</span><span class="ident" id="5765980">r</span><span class="op" id="5765981">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765984">if</span>&nbsp;<span class="ident" id="5765987">err</span>&nbsp;<span class="op" id="5765991">!=</span>&nbsp;<span class="ident" id="5765994">nil</span>&nbsp;<span class="op" id="5765998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766002">return</span>&nbsp;<span class="string" id="5766009">&#34;&#34;</span><span class="op" id="5766011">,</span>&nbsp;<span class="ident" id="5766013">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766022">switch</span>&nbsp;<span class="ident" id="5766029">charset</span>&nbsp;<span class="op" id="5766037">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766040">case</span>&nbsp;<span class="string" id="5766045">&#34;us-ascii&#34;</span><span class="op" id="5766055">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766059">b</span>&nbsp;<span class="op" id="5766061">:=</span>&nbsp;<span class="builtinfunc" id="5766064">new</span><span class="op" id="5766067">(</span><span class="ident" id="5766068">bytes</span><span class="op" id="5766073">.</span><span class="ident" id="5766074">Buffer</span><span class="op" id="5766080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766084">for</span>&nbsp;<span class="ident" id="5766088">_</span><span class="op" id="5766089">,</span>&nbsp;<span class="ident" id="5766091">c</span>&nbsp;<span class="op" id="5766093">:=</span>&nbsp;<span class="keyword" id="5766096">range</span>&nbsp;<span class="ident" id="5766102">dec</span>&nbsp;<span class="op" id="5766106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766111">if</span>&nbsp;<span class="ident" id="5766114">c</span>&nbsp;<span class="op" id="5766116">&gt;=</span>&nbsp;<span class="num" id="5766119">0x80</span>&nbsp;<span class="op" id="5766124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766130">b</span><span class="op" id="5766131">.</span><span class="ident" id="5766132">WriteRune</span><span class="op" id="5766141">(</span><span class="ident" id="5766142">unicode</span><span class="op" id="5766149">.</span><span class="ident" id="5766150">ReplacementChar</span><span class="op" id="5766165">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766170">}</span>&nbsp;<span class="keyword" id="5766172">else</span>&nbsp;<span class="op" id="5766177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766183">b</span><span class="op" id="5766184">.</span><span class="ident" id="5766185">WriteRune</span><span class="op" id="5766194">(</span><span class="builtintype" id="5766195">rune</span><span class="op" id="5766199">(</span><span class="ident" id="5766200">c</span><span class="op" id="5766201">)</span><span class="op" id="5766202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766215">return</span>&nbsp;<span class="ident" id="5766222">b</span><span class="op" id="5766223">.</span><span class="ident" id="5766224">String</span><span class="op" id="5766230">(</span><span class="op" id="5766231">)</span><span class="op" id="5766232">,</span>&nbsp;<span class="ident" id="5766234">nil</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766239">case</span>&nbsp;<span class="string" id="5766244">&#34;iso-8859-1&#34;</span><span class="op" id="5766256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766260">b</span>&nbsp;<span class="op" id="5766262">:=</span>&nbsp;<span class="builtinfunc" id="5766265">new</span><span class="op" id="5766268">(</span><span class="ident" id="5766269">bytes</span><span class="op" id="5766274">.</span><span class="ident" id="5766275">Buffer</span><span class="op" id="5766281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766285">for</span>&nbsp;<span class="ident" id="5766289">_</span><span class="op" id="5766290">,</span>&nbsp;<span class="ident" id="5766292">c</span>&nbsp;<span class="op" id="5766294">:=</span>&nbsp;<span class="keyword" id="5766297">range</span>&nbsp;<span class="ident" id="5766303">dec</span>&nbsp;<span class="op" id="5766307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766312">b</span><span class="op" id="5766313">.</span><span class="ident" id="5766314">WriteRune</span><span class="op" id="5766323">(</span><span class="builtintype" id="5766324">rune</span><span class="op" id="5766328">(</span><span class="ident" id="5766329">c</span><span class="op" id="5766330">)</span><span class="op" id="5766331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766335">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766339">return</span>&nbsp;<span class="ident" id="5766346">b</span><span class="op" id="5766347">.</span><span class="ident" id="5766348">String</span><span class="op" id="5766354">(</span><span class="op" id="5766355">)</span><span class="op" id="5766356">,</span>&nbsp;<span class="ident" id="5766358">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766363">case</span>&nbsp;<span class="string" id="5766368">&#34;utf-8&#34;</span><span class="op" id="5766375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766379">return</span>&nbsp;<span class="builtintype" id="5766386">string</span><span class="op" id="5766392">(</span><span class="ident" id="5766393">dec</span><span class="op" id="5766396">)</span><span class="op" id="5766397">,</span>&nbsp;<span class="ident" id="5766399">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5766407">panic</span><span class="op" id="5766412">(</span><span class="string" id="5766413">&#34;unreachable&#34;</span><span class="op" id="5766426">)</span><br>
<span class="lineno">490</span><span class="op" id="5766428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5766431">type</span>&nbsp;<span class="ident" id="5766436">qDecoder</span>&nbsp;<span class="keyword" id="5766445">struct</span>&nbsp;<span class="op" id="5766452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766455">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5766463">io</span><span class="op" id="5766465">.</span><span class="ident" id="5766466">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766474">scratch</span>&nbsp;<span class="op" id="5766482">[</span><span class="num" id="5766483">2</span><span class="op" id="5766484">]</span><span class="builtintype" id="5766485">byte</span><br>
<span class="lineno">495</span><span class="op" id="5766490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5766493">func</span>&nbsp;<span class="op" id="5766498">(</span><span class="ident" id="5766499">qd</span>&nbsp;<span class="ident" id="5766502">qDecoder</span><span class="op" id="5766510">)</span>&nbsp;<span class="ident" id="5766512">Read</span><span class="op" id="5766516">(</span><span class="ident" id="5766517">p</span>&nbsp;<span class="op" id="5766519">[</span><span class="op" id="5766520">]</span><span class="builtintype" id="5766521">byte</span><span class="op" id="5766525">)</span>&nbsp;<span class="op" id="5766527">(</span><span class="ident" id="5766528">n</span>&nbsp;<span class="builtintype" id="5766530">int</span><span class="op" id="5766533">,</span>&nbsp;<span class="ident" id="5766535">err</span>&nbsp;<span class="builtintype" id="5766539">error</span><span class="op" id="5766544">)</span>&nbsp;<span class="op" id="5766546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5766549">//&nbsp;This&nbsp;method&nbsp;writes&nbsp;at&nbsp;most&nbsp;one&nbsp;byte&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766597">if</span>&nbsp;<span class="builtinfunc" id="5766600">len</span><span class="op" id="5766603">(</span><span class="ident" id="5766604">p</span><span class="op" id="5766605">)</span>&nbsp;<span class="op" id="5766607">==</span>&nbsp;<span class="num" id="5766610">0</span>&nbsp;<span class="op" id="5766612">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766616">return</span>&nbsp;<span class="num" id="5766623">0</span><span class="op" id="5766624">,</span>&nbsp;<span class="ident" id="5766626">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766634">if</span>&nbsp;<span class="ident" id="5766637">_</span><span class="op" id="5766638">,</span>&nbsp;<span class="ident" id="5766640">err</span>&nbsp;<span class="op" id="5766644">:=</span>&nbsp;<span class="ident" id="5766647">qd</span><span class="op" id="5766649">.</span><span class="ident" id="5766650">r</span><span class="op" id="5766651">.</span><span class="ident" id="5766652">Read</span><span class="op" id="5766656">(</span><span class="ident" id="5766657">qd</span><span class="op" id="5766659">.</span><span class="ident" id="5766660">scratch</span><span class="op" id="5766667">[</span><span class="op" id="5766668">:</span><span class="num" id="5766669">1</span><span class="op" id="5766670">]</span><span class="op" id="5766671">)</span><span class="op" id="5766672">;</span>&nbsp;<span class="ident" id="5766674">err</span>&nbsp;<span class="op" id="5766678">!=</span>&nbsp;<span class="ident" id="5766681">nil</span>&nbsp;<span class="op" id="5766685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766689">return</span>&nbsp;<span class="num" id="5766696">0</span><span class="op" id="5766697">,</span>&nbsp;<span class="ident" id="5766699">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766704">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766707">switch</span>&nbsp;<span class="ident" id="5766714">c</span>&nbsp;<span class="op" id="5766716">:=</span>&nbsp;<span class="ident" id="5766719">qd</span><span class="op" id="5766721">.</span><span class="ident" id="5766722">scratch</span><span class="op" id="5766729">[</span><span class="num" id="5766730">0</span><span class="op" id="5766731">]</span><span class="op" id="5766732">;</span>&nbsp;<span class="op" id="5766734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766737">case</span>&nbsp;<span class="ident" id="5766742">c</span>&nbsp;<span class="op" id="5766744">==</span>&nbsp;<span class="string" id="5766747">&#39;=&#39;</span><span class="op" id="5766750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766754">if</span>&nbsp;<span class="ident" id="5766757">_</span><span class="op" id="5766758">,</span>&nbsp;<span class="ident" id="5766760">err</span>&nbsp;<span class="op" id="5766764">:=</span>&nbsp;<span class="ident" id="5766767">io</span><span class="op" id="5766769">.</span><span class="ident" id="5766770">ReadFull</span><span class="op" id="5766778">(</span><span class="ident" id="5766779">qd</span><span class="op" id="5766781">.</span><span class="ident" id="5766782">r</span><span class="op" id="5766783">,</span>&nbsp;<span class="ident" id="5766785">qd</span><span class="op" id="5766787">.</span><span class="ident" id="5766788">scratch</span><span class="op" id="5766795">[</span><span class="op" id="5766796">:</span><span class="num" id="5766797">2</span><span class="op" id="5766798">]</span><span class="op" id="5766799">)</span><span class="op" id="5766800">;</span>&nbsp;<span class="ident" id="5766802">err</span>&nbsp;<span class="op" id="5766806">!=</span>&nbsp;<span class="ident" id="5766809">nil</span>&nbsp;<span class="op" id="5766813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766818">return</span>&nbsp;<span class="num" id="5766825">0</span><span class="op" id="5766826">,</span>&nbsp;<span class="ident" id="5766828">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766834">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766838">x</span><span class="op" id="5766839">,</span>&nbsp;<span class="ident" id="5766841">err</span>&nbsp;<span class="op" id="5766845">:=</span>&nbsp;<span class="ident" id="5766848">strconv</span><span class="op" id="5766855">.</span><span class="ident" id="5766856">ParseInt</span><span class="op" id="5766864">(</span><span class="builtintype" id="5766865">string</span><span class="op" id="5766871">(</span><span class="ident" id="5766872">qd</span><span class="op" id="5766874">.</span><span class="ident" id="5766875">scratch</span><span class="op" id="5766882">[</span><span class="op" id="5766883">:</span><span class="num" id="5766884">2</span><span class="op" id="5766885">]</span><span class="op" id="5766886">)</span><span class="op" id="5766887">,</span>&nbsp;<span class="num" id="5766889">16</span><span class="op" id="5766891">,</span>&nbsp;<span class="num" id="5766893">64</span><span class="op" id="5766895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766899">if</span>&nbsp;<span class="ident" id="5766902">err</span>&nbsp;<span class="op" id="5766906">!=</span>&nbsp;<span class="ident" id="5766909">nil</span>&nbsp;<span class="op" id="5766913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766918">return</span>&nbsp;<span class="num" id="5766925">0</span><span class="op" id="5766926">,</span>&nbsp;<span class="ident" id="5766928">fmt</span><span class="op" id="5766931">.</span><span class="ident" id="5766932">Errorf</span><span class="op" id="5766938">(</span><span class="string" id="5766939">&#34;mail:&nbsp;invalid&nbsp;RFC&nbsp;2047&nbsp;encoding:&nbsp;%q&#34;</span><span class="op" id="5766976">,</span>&nbsp;<span class="ident" id="5766978">qd</span><span class="op" id="5766980">.</span><span class="ident" id="5766981">scratch</span><span class="op" id="5766988">[</span><span class="op" id="5766989">:</span><span class="num" id="5766990">2</span><span class="op" id="5766991">]</span><span class="op" id="5766992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767000">p</span><span class="op" id="5767001">[</span><span class="num" id="5767002">0</span><span class="op" id="5767003">]</span>&nbsp;<span class="op" id="5767005">=</span>&nbsp;<span class="builtintype" id="5767007">byte</span><span class="op" id="5767011">(</span><span class="ident" id="5767012">x</span><span class="op" id="5767013">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767016">case</span>&nbsp;<span class="ident" id="5767021">c</span>&nbsp;<span class="op" id="5767023">==</span>&nbsp;<span class="string" id="5767026">&#39;_&#39;</span><span class="op" id="5767029">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767033">p</span><span class="op" id="5767034">[</span><span class="num" id="5767035">0</span><span class="op" id="5767036">]</span>&nbsp;<span class="op" id="5767038">=</span>&nbsp;<span class="string" id="5767040">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767045">default</span><span class="op" id="5767052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767056">p</span><span class="op" id="5767057">[</span><span class="num" id="5767058">0</span><span class="op" id="5767059">]</span>&nbsp;<span class="op" id="5767061">=</span>&nbsp;<span class="ident" id="5767063">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767066">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767069">return</span>&nbsp;<span class="num" id="5767076">1</span><span class="op" id="5767077">,</span>&nbsp;<span class="ident" id="5767079">nil</span><br>
<span class="lineno"></span><span class="op" id="5767083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5767086">var</span>&nbsp;<span class="ident" id="5767090">atextChars</span>&nbsp;<span class="op" id="5767101">=</span>&nbsp;<span class="op" id="5767103">[</span><span class="op" id="5767104">]</span><span class="builtintype" id="5767105">byte</span><span class="op" id="5767109">(</span><span class="string" id="5767110">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span>&nbsp;<span class="op" id="5767139">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5767142">&#34;abcdefghijklmnopqrstuvwxyz&#34;</span>&nbsp;<span class="op" id="5767171">+</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5767174">&#34;0123456789&#34;</span>&nbsp;<span class="op" id="5767187">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5767190">&#34;!#$%&amp;&#39;*+-/=?^_`{|}~&#34;</span><span class="op" id="5767211">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5767214">//&nbsp;isAtext&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;atext&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="5767275">//&nbsp;If&nbsp;dot&nbsp;is&nbsp;true,&nbsp;period&nbsp;is&nbsp;included.</span><br>
<span class="lineno">530</span><span class="keyword" id="5767314">func</span>&nbsp;<span class="ident" id="5767319">isAtext</span><span class="op" id="5767326">(</span><span class="ident" id="5767327">c</span>&nbsp;<span class="builtintype" id="5767329">byte</span><span class="op" id="5767333">,</span>&nbsp;<span class="ident" id="5767335">dot</span>&nbsp;<span class="builtintype" id="5767339">bool</span><span class="op" id="5767343">)</span>&nbsp;<span class="builtintype" id="5767345">bool</span>&nbsp;<span class="op" id="5767350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767353">if</span>&nbsp;<span class="ident" id="5767356">dot</span>&nbsp;<span class="op" id="5767360">&amp;&amp;</span>&nbsp;<span class="ident" id="5767363">c</span>&nbsp;<span class="op" id="5767365">==</span>&nbsp;<span class="string" id="5767368">&#39;.&#39;</span>&nbsp;<span class="op" id="5767372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767376">return</span>&nbsp;<span class="builtintype" id="5767383">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767392">return</span>&nbsp;<span class="ident" id="5767399">bytes</span><span class="op" id="5767404">.</span><span class="ident" id="5767405">IndexByte</span><span class="op" id="5767414">(</span><span class="ident" id="5767415">atextChars</span><span class="op" id="5767425">,</span>&nbsp;<span class="ident" id="5767427">c</span><span class="op" id="5767428">)</span>&nbsp;<span class="op" id="5767430">&gt;=</span>&nbsp;<span class="num" id="5767433">0</span><br>
<span class="lineno">535</span><span class="op" id="5767435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5767438">//&nbsp;isQtext&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;qtext&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="5767499">func</span>&nbsp;<span class="ident" id="5767504">isQtext</span><span class="op" id="5767511">(</span><span class="ident" id="5767512">c</span>&nbsp;<span class="builtintype" id="5767514">byte</span><span class="op" id="5767518">)</span>&nbsp;<span class="builtintype" id="5767520">bool</span>&nbsp;<span class="op" id="5767525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767528">//&nbsp;Printable&nbsp;US-ASCII,&nbsp;excluding&nbsp;backslash&nbsp;or&nbsp;quote.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767582">if</span>&nbsp;<span class="ident" id="5767585">c</span>&nbsp;<span class="op" id="5767587">==</span>&nbsp;<span class="string" id="5767590">&#39;\\&#39;</span>&nbsp;<span class="op" id="5767595">||</span>&nbsp;<span class="ident" id="5767598">c</span>&nbsp;<span class="op" id="5767600">==</span>&nbsp;<span class="string" id="5767603">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="5767607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767611">return</span>&nbsp;<span class="builtintype" id="5767618">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767628">return</span>&nbsp;<span class="string" id="5767635">&#39;!&#39;</span>&nbsp;<span class="op" id="5767639">&lt;=</span>&nbsp;<span class="ident" id="5767642">c</span>&nbsp;<span class="op" id="5767644">&amp;&amp;</span>&nbsp;<span class="ident" id="5767647">c</span>&nbsp;<span class="op" id="5767649">&lt;=</span>&nbsp;<span class="string" id="5767652">&#39;~&#39;</span><br>
<span class="lineno"></span><span class="op" id="5767656">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="5767659">//&nbsp;isVchar&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;VCHAR&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="5767720">func</span>&nbsp;<span class="ident" id="5767725">isVchar</span><span class="op" id="5767732">(</span><span class="ident" id="5767733">c</span>&nbsp;<span class="builtintype" id="5767735">byte</span><span class="op" id="5767739">)</span>&nbsp;<span class="builtintype" id="5767741">bool</span>&nbsp;<span class="op" id="5767746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5767749">//&nbsp;Visible&nbsp;(printing)&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767784">return</span>&nbsp;<span class="string" id="5767791">&#39;!&#39;</span>&nbsp;<span class="op" id="5767795">&lt;=</span>&nbsp;<span class="ident" id="5767798">c</span>&nbsp;<span class="op" id="5767800">&amp;&amp;</span>&nbsp;<span class="ident" id="5767803">c</span>&nbsp;<span class="op" id="5767805">&lt;=</span>&nbsp;<span class="string" id="5767808">&#39;~&#39;</span><br>
<span class="lineno">550</span><span class="op" id="5767812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5767815">//&nbsp;isWSP&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;a&nbsp;WSP&nbsp;(white&nbsp;space).</span><br>
<span class="lineno"></span><span class="comment" id="5767866">//&nbsp;WSP&nbsp;is&nbsp;a&nbsp;space&nbsp;or&nbsp;horizontal&nbsp;tab&nbsp;(RFC5234&nbsp;Appendix&nbsp;B).</span><br>
<span class="lineno"></span><span class="keyword" id="5767924">func</span>&nbsp;<span class="ident" id="5767929">isWSP</span><span class="op" id="5767934">(</span><span class="ident" id="5767935">c</span>&nbsp;<span class="builtintype" id="5767937">byte</span><span class="op" id="5767941">)</span>&nbsp;<span class="builtintype" id="5767943">bool</span>&nbsp;<span class="op" id="5767948">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767951">return</span>&nbsp;<span class="ident" id="5767958">c</span>&nbsp;<span class="op" id="5767960">==</span>&nbsp;<span class="string" id="5767963">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5767967">||</span>&nbsp;<span class="ident" id="5767970">c</span>&nbsp;<span class="op" id="5767972">==</span>&nbsp;<span class="string" id="5767975">&#39;\t&#39;</span><br>
<span class="lineno"></span><span class="op" id="5767980">}</span>
</div>
</body>
</html>
