<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6489706">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6489761">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6489815">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6489866">//&nbsp;Package&nbsp;cookiejar&nbsp;implements&nbsp;an&nbsp;in-memory&nbsp;RFC&nbsp;6265-compliant&nbsp;http.CookieJar.</span><br>
<span class="lineno"></span><span class="keyword" id="6489946">package</span>&nbsp;<span class="ident" id="6489954">cookiejar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6489965">import</span>&nbsp;<span class="op" id="6489972">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6489975">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6489985">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6489992">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6489999">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6490011">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6490022">&#34;sort&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6490030">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6490041">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6490049">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6490056">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="6490059">//&nbsp;PublicSuffixList&nbsp;provides&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;a&nbsp;domain.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="6490132">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;example.com&#34;&nbsp;is&nbsp;&#34;com&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6490187">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;foo1.foo2.foo3.co.uk&#34;&nbsp;is&nbsp;&#34;co.uk&#34;,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6490257">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;bar.pvt.k12.ma.us&#34;&nbsp;is&nbsp;&#34;pvt.k12.ma.us&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="6490328">//</span><br>
<span class="lineno">25</span><span class="comment" id="6490331">//&nbsp;Implementations&nbsp;of&nbsp;PublicSuffixList&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6490405">//&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="6490429">//</span><br>
<span class="lineno"></span><span class="comment" id="6490432">//&nbsp;An&nbsp;implementation&nbsp;that&nbsp;always&nbsp;returns&nbsp;&#34;&#34;&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6490507">//&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.com&nbsp;can</span><br>
<span class="lineno">30</span><span class="comment" id="6490586">//&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;bar.com.</span><br>
<span class="lineno"></span><span class="comment" id="6490615">//</span><br>
<span class="lineno"></span><span class="comment" id="6490618">//&nbsp;A&nbsp;public&nbsp;suffix&nbsp;list&nbsp;implementation&nbsp;is&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="6490675">//&nbsp;golang.org/x/net/publicsuffix.</span><br>
<span class="lineno"></span><span class="keyword" id="6490709">type</span>&nbsp;<span class="ident" id="6490714">PublicSuffixList</span>&nbsp;<span class="keyword" id="6490731">interface</span>&nbsp;<span class="op" id="6490741">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6490744">//&nbsp;PublicSuffix&nbsp;returns&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6490798">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6490802">//&nbsp;TODO:&nbsp;specify&nbsp;which&nbsp;of&nbsp;the&nbsp;caller&nbsp;and&nbsp;callee&nbsp;is&nbsp;responsible&nbsp;for&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6490873">//&nbsp;addresses,&nbsp;for&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;dots,&nbsp;for&nbsp;case&nbsp;sensitivity,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6490945">//&nbsp;for&nbsp;IDN/Punycode.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6490967">PublicSuffix</span><span class="op" id="6490979">(</span><span class="ident" id="6490980">domain</span>&nbsp;<span class="builtintype" id="6490987">string</span><span class="op" id="6490993">)</span>&nbsp;<span class="builtintype" id="6490995">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491004">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;source&nbsp;of&nbsp;this&nbsp;public&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491073">//&nbsp;list.&nbsp;The&nbsp;description&nbsp;will&nbsp;typically&nbsp;contain&nbsp;something&nbsp;like&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491144">//&nbsp;stamp&nbsp;or&nbsp;version&nbsp;number.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491173">String</span><span class="op" id="6491179">(</span><span class="op" id="6491180">)</span>&nbsp;<span class="builtintype" id="6491182">string</span><br>
<span class="lineno"></span><span class="op" id="6491189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6491192">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;options&nbsp;for&nbsp;creating&nbsp;a&nbsp;new&nbsp;Jar.</span><br>
<span class="lineno"></span><span class="keyword" id="6491243">type</span>&nbsp;<span class="ident" id="6491248">Options</span>&nbsp;<span class="keyword" id="6491256">struct</span>&nbsp;<span class="op" id="6491263">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491266">//&nbsp;PublicSuffixList&nbsp;is&nbsp;the&nbsp;public&nbsp;suffix&nbsp;list&nbsp;that&nbsp;determines&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491337">//&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;a&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491387">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491391">//&nbsp;A&nbsp;nil&nbsp;value&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491460">//&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.co.uk&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491533">//&nbsp;for&nbsp;bar.co.uk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491552">PublicSuffixList</span>&nbsp;<span class="ident" id="6491569">PublicSuffixList</span><br>
<span class="lineno"></span><span class="op" id="6491586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6491589">//&nbsp;Jar&nbsp;implements&nbsp;the&nbsp;http.CookieJar&nbsp;interface&nbsp;from&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno">60</span><span class="keyword" id="6491663">type</span>&nbsp;<span class="ident" id="6491668">Jar</span>&nbsp;<span class="keyword" id="6491672">struct</span>&nbsp;<span class="op" id="6491679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491682">psList</span>&nbsp;<span class="ident" id="6491689">PublicSuffixList</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491708">//&nbsp;mu&nbsp;locks&nbsp;the&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491743">mu</span>&nbsp;<span class="ident" id="6491746">sync</span><span class="op" id="6491750">.</span><span class="ident" id="6491751">Mutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491759">//&nbsp;entries&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;entries,&nbsp;keyed&nbsp;by&nbsp;their&nbsp;eTLD+1&nbsp;and&nbsp;subkeyed&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491830">//&nbsp;their&nbsp;name/domain/path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491858">entries</span>&nbsp;<span class="keyword" id="6491866">map</span><span class="op" id="6491869">[</span><span class="builtintype" id="6491870">string</span><span class="op" id="6491876">]</span><span class="keyword" id="6491877">map</span><span class="op" id="6491880">[</span><span class="builtintype" id="6491881">string</span><span class="op" id="6491887">]</span><span class="ident" id="6491888">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491896">//&nbsp;nextSeqNum&nbsp;is&nbsp;the&nbsp;next&nbsp;sequence&nbsp;number&nbsp;assigned&nbsp;to&nbsp;a&nbsp;new&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6491964">//&nbsp;created&nbsp;SetCookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6491988">nextSeqNum</span>&nbsp;<span class="ident" id="6491999">uint64</span><br>
<span class="lineno"></span><span class="op" id="6492006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="6492009">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;cookie&nbsp;jar.&nbsp;A&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="6492081">//&nbsp;Options.</span><br>
<span class="lineno"></span><span class="keyword" id="6492093">func</span>&nbsp;<span class="ident" id="6492098">New</span><span class="op" id="6492101">(</span><span class="ident" id="6492102">o</span>&nbsp;<span class="op" id="6492104">*</span><span class="ident" id="6492105">Options</span><span class="op" id="6492112">)</span>&nbsp;<span class="op" id="6492114">(</span><span class="op" id="6492115">*</span><span class="ident" id="6492116">Jar</span><span class="op" id="6492119">,</span>&nbsp;<span class="builtintype" id="6492121">error</span><span class="op" id="6492126">)</span>&nbsp;<span class="op" id="6492128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492131">jar</span>&nbsp;<span class="op" id="6492135">:=</span>&nbsp;<span class="op" id="6492138">&amp;</span><span class="ident" id="6492139">Jar</span><span class="op" id="6492142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492146">entries</span><span class="op" id="6492153">:</span>&nbsp;<span class="builtinfunc" id="6492155">make</span><span class="op" id="6492159">(</span><span class="keyword" id="6492160">map</span><span class="op" id="6492163">[</span><span class="builtintype" id="6492164">string</span><span class="op" id="6492170">]</span><span class="keyword" id="6492171">map</span><span class="op" id="6492174">[</span><span class="builtintype" id="6492175">string</span><span class="op" id="6492181">]</span><span class="ident" id="6492182">entry</span><span class="op" id="6492187">)</span><span class="op" id="6492188">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6492191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6492194">if</span>&nbsp;<span class="ident" id="6492197">o</span>&nbsp;<span class="op" id="6492199">!=</span>&nbsp;<span class="ident" id="6492202">nil</span>&nbsp;<span class="op" id="6492206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492210">jar</span><span class="op" id="6492213">.</span><span class="ident" id="6492214">psList</span>&nbsp;<span class="op" id="6492221">=</span>&nbsp;<span class="ident" id="6492223">o</span><span class="op" id="6492224">.</span><span class="ident" id="6492225">PublicSuffixList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6492243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6492246">return</span>&nbsp;<span class="ident" id="6492253">jar</span><span class="op" id="6492256">,</span>&nbsp;<span class="ident" id="6492258">nil</span><br>
<span class="lineno">85</span><span class="op" id="6492262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6492265">//&nbsp;entry&nbsp;is&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;a&nbsp;cookie.</span><br>
<span class="lineno"></span><span class="comment" id="6492318">//</span><br>
<span class="lineno"></span><span class="comment" id="6492321">//&nbsp;This&nbsp;struct&nbsp;type&nbsp;is&nbsp;not&nbsp;used&nbsp;outside&nbsp;of&nbsp;this&nbsp;package&nbsp;per&nbsp;se,&nbsp;but&nbsp;the&nbsp;exported</span><br>
<span class="lineno">90</span><span class="comment" id="6492402">//&nbsp;fields&nbsp;are&nbsp;those&nbsp;of&nbsp;RFC&nbsp;6265.</span><br>
<span class="lineno"></span><span class="keyword" id="6492435">type</span>&nbsp;<span class="ident" id="6492440">entry</span>&nbsp;<span class="keyword" id="6492446">struct</span>&nbsp;<span class="op" id="6492453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492456">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6492467">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492475">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6492486">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492494">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6492505">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492513">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6492524">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492532">Secure</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6492543">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492549">HttpOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6492560">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492566">Persistent</span>&nbsp;<span class="builtintype" id="6492577">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492583">HostOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6492594">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492600">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6492611">time</span><span class="op" id="6492615">.</span><span class="ident" id="6492616">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492622">Creation</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6492633">time</span><span class="op" id="6492637">.</span><span class="ident" id="6492638">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492644">LastAccess</span>&nbsp;<span class="ident" id="6492655">time</span><span class="op" id="6492659">.</span><span class="ident" id="6492660">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6492667">//&nbsp;seqNum&nbsp;is&nbsp;a&nbsp;sequence&nbsp;number&nbsp;so&nbsp;that&nbsp;Cookies&nbsp;returns&nbsp;cookies&nbsp;in&nbsp;a</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6492736">//&nbsp;deterministic&nbsp;order,&nbsp;even&nbsp;for&nbsp;cookies&nbsp;that&nbsp;have&nbsp;equal&nbsp;Path&nbsp;length&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6492810">//&nbsp;equal&nbsp;Creation&nbsp;time.&nbsp;This&nbsp;simplifies&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6492860">seqNum</span>&nbsp;<span class="ident" id="6492867">uint64</span><br>
<span class="lineno"></span><span class="op" id="6492874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6492877">//&nbsp;Id&nbsp;returns&nbsp;the&nbsp;domain;path;name&nbsp;triple&nbsp;of&nbsp;e&nbsp;as&nbsp;an&nbsp;id.</span><br>
<span class="lineno"></span><span class="keyword" id="6492934">func</span>&nbsp;<span class="op" id="6492939">(</span><span class="ident" id="6492940">e</span>&nbsp;<span class="op" id="6492942">*</span><span class="ident" id="6492943">entry</span><span class="op" id="6492948">)</span>&nbsp;<span class="ident" id="6492950">id</span><span class="op" id="6492952">(</span><span class="op" id="6492953">)</span>&nbsp;<span class="builtintype" id="6492955">string</span>&nbsp;<span class="op" id="6492962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6492965">return</span>&nbsp;<span class="ident" id="6492972">fmt</span><span class="op" id="6492975">.</span><span class="ident" id="6492976">Sprintf</span><span class="op" id="6492983">(</span><span class="string" id="6492984">&#34;%s;%s;%s&#34;</span><span class="op" id="6492994">,</span>&nbsp;<span class="ident" id="6492996">e</span><span class="op" id="6492997">.</span><span class="ident" id="6492998">Domain</span><span class="op" id="6493004">,</span>&nbsp;<span class="ident" id="6493006">e</span><span class="op" id="6493007">.</span><span class="ident" id="6493008">Path</span><span class="op" id="6493012">,</span>&nbsp;<span class="ident" id="6493014">e</span><span class="op" id="6493015">.</span><span class="ident" id="6493016">Name</span><span class="op" id="6493020">)</span><br>
<span class="lineno"></span><span class="op" id="6493022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="6493025">//&nbsp;shouldSend&nbsp;determines&nbsp;whether&nbsp;e&#39;s&nbsp;cookie&nbsp;qualifies&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6493099">//&nbsp;request&nbsp;to&nbsp;host/path.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;check&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6493174">//&nbsp;cookie&nbsp;is&nbsp;expired.</span><br>
<span class="lineno"></span><span class="keyword" id="6493196">func</span>&nbsp;<span class="op" id="6493201">(</span><span class="ident" id="6493202">e</span>&nbsp;<span class="op" id="6493204">*</span><span class="ident" id="6493205">entry</span><span class="op" id="6493210">)</span>&nbsp;<span class="ident" id="6493212">shouldSend</span><span class="op" id="6493222">(</span><span class="ident" id="6493223">https</span>&nbsp;<span class="builtintype" id="6493229">bool</span><span class="op" id="6493233">,</span>&nbsp;<span class="ident" id="6493235">host</span><span class="op" id="6493239">,</span>&nbsp;<span class="ident" id="6493241">path</span>&nbsp;<span class="builtintype" id="6493246">string</span><span class="op" id="6493252">)</span>&nbsp;<span class="builtintype" id="6493254">bool</span>&nbsp;<span class="op" id="6493259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493262">return</span>&nbsp;<span class="ident" id="6493269">e</span><span class="op" id="6493270">.</span><span class="ident" id="6493271">domainMatch</span><span class="op" id="6493282">(</span><span class="ident" id="6493283">host</span><span class="op" id="6493287">)</span>&nbsp;<span class="op" id="6493289">&amp;&amp;</span>&nbsp;<span class="ident" id="6493292">e</span><span class="op" id="6493293">.</span><span class="ident" id="6493294">pathMatch</span><span class="op" id="6493303">(</span><span class="ident" id="6493304">path</span><span class="op" id="6493308">)</span>&nbsp;<span class="op" id="6493310">&amp;&amp;</span>&nbsp;<span class="op" id="6493313">(</span><span class="ident" id="6493314">https</span>&nbsp;<span class="op" id="6493320">||</span>&nbsp;<span class="op" id="6493323">!</span><span class="ident" id="6493324">e</span><span class="op" id="6493325">.</span><span class="ident" id="6493326">Secure</span><span class="op" id="6493332">)</span><br>
<span class="lineno">120</span><span class="op" id="6493334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6493337">//&nbsp;domainMatch&nbsp;implements&nbsp;&#34;domain-match&#34;&nbsp;of&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.3.</span><br>
<span class="lineno"></span><span class="keyword" id="6493405">func</span>&nbsp;<span class="op" id="6493410">(</span><span class="ident" id="6493411">e</span>&nbsp;<span class="op" id="6493413">*</span><span class="ident" id="6493414">entry</span><span class="op" id="6493419">)</span>&nbsp;<span class="ident" id="6493421">domainMatch</span><span class="op" id="6493432">(</span><span class="ident" id="6493433">host</span>&nbsp;<span class="builtintype" id="6493438">string</span><span class="op" id="6493444">)</span>&nbsp;<span class="builtintype" id="6493446">bool</span>&nbsp;<span class="op" id="6493451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493454">if</span>&nbsp;<span class="ident" id="6493457">e</span><span class="op" id="6493458">.</span><span class="ident" id="6493459">Domain</span>&nbsp;<span class="op" id="6493466">==</span>&nbsp;<span class="ident" id="6493469">host</span>&nbsp;<span class="op" id="6493474">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493478">return</span>&nbsp;<span class="builtintype" id="6493485">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6493491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493494">return</span>&nbsp;<span class="op" id="6493501">!</span><span class="ident" id="6493502">e</span><span class="op" id="6493503">.</span><span class="ident" id="6493504">HostOnly</span>&nbsp;<span class="op" id="6493513">&amp;&amp;</span>&nbsp;<span class="ident" id="6493516">hasDotSuffix</span><span class="op" id="6493528">(</span><span class="ident" id="6493529">host</span><span class="op" id="6493533">,</span>&nbsp;<span class="ident" id="6493535">e</span><span class="op" id="6493536">.</span><span class="ident" id="6493537">Domain</span><span class="op" id="6493543">)</span><br>
<span class="lineno"></span><span class="op" id="6493545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6493548">//&nbsp;pathMatch&nbsp;implements&nbsp;&#34;path-match&#34;&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="6493622">func</span>&nbsp;<span class="op" id="6493627">(</span><span class="ident" id="6493628">e</span>&nbsp;<span class="op" id="6493630">*</span><span class="ident" id="6493631">entry</span><span class="op" id="6493636">)</span>&nbsp;<span class="ident" id="6493638">pathMatch</span><span class="op" id="6493647">(</span><span class="ident" id="6493648">requestPath</span>&nbsp;<span class="builtintype" id="6493660">string</span><span class="op" id="6493666">)</span>&nbsp;<span class="builtintype" id="6493668">bool</span>&nbsp;<span class="op" id="6493673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493676">if</span>&nbsp;<span class="ident" id="6493679">requestPath</span>&nbsp;<span class="op" id="6493691">==</span>&nbsp;<span class="ident" id="6493694">e</span><span class="op" id="6493695">.</span><span class="ident" id="6493696">Path</span>&nbsp;<span class="op" id="6493701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493705">return</span>&nbsp;<span class="builtintype" id="6493712">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6493718">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493721">if</span>&nbsp;<span class="ident" id="6493724">strings</span><span class="op" id="6493731">.</span><span class="ident" id="6493732">HasPrefix</span><span class="op" id="6493741">(</span><span class="ident" id="6493742">requestPath</span><span class="op" id="6493753">,</span>&nbsp;<span class="ident" id="6493755">e</span><span class="op" id="6493756">.</span><span class="ident" id="6493757">Path</span><span class="op" id="6493761">)</span>&nbsp;<span class="op" id="6493763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493767">if</span>&nbsp;<span class="ident" id="6493770">e</span><span class="op" id="6493771">.</span><span class="ident" id="6493772">Path</span><span class="op" id="6493776">[</span><span class="builtinfunc" id="6493777">len</span><span class="op" id="6493780">(</span><span class="ident" id="6493781">e</span><span class="op" id="6493782">.</span><span class="ident" id="6493783">Path</span><span class="op" id="6493787">)</span><span class="op" id="6493788">-</span><span class="num" id="6493789">1</span><span class="op" id="6493790">]</span>&nbsp;<span class="op" id="6493792">==</span>&nbsp;<span class="string" id="6493795">&#39;/&#39;</span>&nbsp;<span class="op" id="6493799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493804">return</span>&nbsp;<span class="builtintype" id="6493811">true</span>&nbsp;<span class="comment" id="6493816">//&nbsp;The&nbsp;&#34;/any/&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6493859">}</span>&nbsp;<span class="keyword" id="6493861">else</span>&nbsp;<span class="keyword" id="6493866">if</span>&nbsp;<span class="ident" id="6493869">requestPath</span><span class="op" id="6493880">[</span><span class="builtinfunc" id="6493881">len</span><span class="op" id="6493884">(</span><span class="ident" id="6493885">e</span><span class="op" id="6493886">.</span><span class="ident" id="6493887">Path</span><span class="op" id="6493891">)</span><span class="op" id="6493892">]</span>&nbsp;<span class="op" id="6493894">==</span>&nbsp;<span class="string" id="6493897">&#39;/&#39;</span>&nbsp;<span class="op" id="6493901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493906">return</span>&nbsp;<span class="builtintype" id="6493913">true</span>&nbsp;<span class="comment" id="6493918">//&nbsp;The&nbsp;&#34;/any&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6493960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6493963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493966">return</span>&nbsp;<span class="builtintype" id="6493973">false</span><br>
<span class="lineno"></span><span class="op" id="6493979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="6493982">//&nbsp;hasDotSuffix&nbsp;reports&nbsp;whether&nbsp;s&nbsp;ends&nbsp;in&nbsp;&#34;.&#34;+suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="6494036">func</span>&nbsp;<span class="ident" id="6494041">hasDotSuffix</span><span class="op" id="6494053">(</span><span class="ident" id="6494054">s</span><span class="op" id="6494055">,</span>&nbsp;<span class="ident" id="6494057">suffix</span>&nbsp;<span class="builtintype" id="6494064">string</span><span class="op" id="6494070">)</span>&nbsp;<span class="builtintype" id="6494072">bool</span>&nbsp;<span class="op" id="6494077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494080">return</span>&nbsp;<span class="builtinfunc" id="6494087">len</span><span class="op" id="6494090">(</span><span class="ident" id="6494091">s</span><span class="op" id="6494092">)</span>&nbsp;<span class="op" id="6494094">&gt;</span>&nbsp;<span class="builtinfunc" id="6494096">len</span><span class="op" id="6494099">(</span><span class="ident" id="6494100">suffix</span><span class="op" id="6494106">)</span>&nbsp;<span class="op" id="6494108">&amp;&amp;</span>&nbsp;<span class="ident" id="6494111">s</span><span class="op" id="6494112">[</span><span class="builtinfunc" id="6494113">len</span><span class="op" id="6494116">(</span><span class="ident" id="6494117">s</span><span class="op" id="6494118">)</span><span class="op" id="6494119">-</span><span class="builtinfunc" id="6494120">len</span><span class="op" id="6494123">(</span><span class="ident" id="6494124">suffix</span><span class="op" id="6494130">)</span><span class="op" id="6494131">-</span><span class="num" id="6494132">1</span><span class="op" id="6494133">]</span>&nbsp;<span class="op" id="6494135">==</span>&nbsp;<span class="string" id="6494138">&#39;.&#39;</span>&nbsp;<span class="op" id="6494142">&amp;&amp;</span>&nbsp;<span class="ident" id="6494145">s</span><span class="op" id="6494146">[</span><span class="builtinfunc" id="6494147">len</span><span class="op" id="6494150">(</span><span class="ident" id="6494151">s</span><span class="op" id="6494152">)</span><span class="op" id="6494153">-</span><span class="builtinfunc" id="6494154">len</span><span class="op" id="6494157">(</span><span class="ident" id="6494158">suffix</span><span class="op" id="6494164">)</span><span class="op" id="6494165">:</span><span class="op" id="6494166">]</span>&nbsp;<span class="op" id="6494168">==</span>&nbsp;<span class="ident" id="6494171">suffix</span><br>
<span class="lineno"></span><span class="op" id="6494178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6494181">//&nbsp;byPathLength&nbsp;is&nbsp;a&nbsp;[]entry&nbsp;sort.Interface&nbsp;that&nbsp;sorts&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265</span><br>
<span class="lineno"></span><span class="comment" id="6494258">//&nbsp;section&nbsp;5.4&nbsp;point&nbsp;2:&nbsp;by&nbsp;longest&nbsp;path&nbsp;and&nbsp;then&nbsp;by&nbsp;earliest&nbsp;creation&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6494334">type</span>&nbsp;<span class="ident" id="6494339">byPathLength</span>&nbsp;<span class="op" id="6494352">[</span><span class="op" id="6494353">]</span><span class="ident" id="6494354">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6494361">func</span>&nbsp;<span class="op" id="6494366">(</span><span class="ident" id="6494367">s</span>&nbsp;<span class="ident" id="6494369">byPathLength</span><span class="op" id="6494381">)</span>&nbsp;<span class="ident" id="6494383">Len</span><span class="op" id="6494386">(</span><span class="op" id="6494387">)</span>&nbsp;<span class="builtintype" id="6494389">int</span>&nbsp;<span class="op" id="6494393">{</span>&nbsp;<span class="keyword" id="6494395">return</span>&nbsp;<span class="builtinfunc" id="6494402">len</span><span class="op" id="6494405">(</span><span class="ident" id="6494406">s</span><span class="op" id="6494407">)</span>&nbsp;<span class="op" id="6494409">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="6494412">func</span>&nbsp;<span class="op" id="6494417">(</span><span class="ident" id="6494418">s</span>&nbsp;<span class="ident" id="6494420">byPathLength</span><span class="op" id="6494432">)</span>&nbsp;<span class="ident" id="6494434">Less</span><span class="op" id="6494438">(</span><span class="ident" id="6494439">i</span><span class="op" id="6494440">,</span>&nbsp;<span class="ident" id="6494442">j</span>&nbsp;<span class="builtintype" id="6494444">int</span><span class="op" id="6494447">)</span>&nbsp;<span class="builtintype" id="6494449">bool</span>&nbsp;<span class="op" id="6494454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494457">if</span>&nbsp;<span class="builtinfunc" id="6494460">len</span><span class="op" id="6494463">(</span><span class="ident" id="6494464">s</span><span class="op" id="6494465">[</span><span class="ident" id="6494466">i</span><span class="op" id="6494467">]</span><span class="op" id="6494468">.</span><span class="ident" id="6494469">Path</span><span class="op" id="6494473">)</span>&nbsp;<span class="op" id="6494475">!=</span>&nbsp;<span class="builtinfunc" id="6494478">len</span><span class="op" id="6494481">(</span><span class="ident" id="6494482">s</span><span class="op" id="6494483">[</span><span class="ident" id="6494484">j</span><span class="op" id="6494485">]</span><span class="op" id="6494486">.</span><span class="ident" id="6494487">Path</span><span class="op" id="6494491">)</span>&nbsp;<span class="op" id="6494493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494497">return</span>&nbsp;<span class="builtinfunc" id="6494504">len</span><span class="op" id="6494507">(</span><span class="ident" id="6494508">s</span><span class="op" id="6494509">[</span><span class="ident" id="6494510">i</span><span class="op" id="6494511">]</span><span class="op" id="6494512">.</span><span class="ident" id="6494513">Path</span><span class="op" id="6494517">)</span>&nbsp;<span class="op" id="6494519">&gt;</span>&nbsp;<span class="builtinfunc" id="6494521">len</span><span class="op" id="6494524">(</span><span class="ident" id="6494525">s</span><span class="op" id="6494526">[</span><span class="ident" id="6494527">j</span><span class="op" id="6494528">]</span><span class="op" id="6494529">.</span><span class="ident" id="6494530">Path</span><span class="op" id="6494534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6494537">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494540">if</span>&nbsp;<span class="op" id="6494543">!</span><span class="ident" id="6494544">s</span><span class="op" id="6494545">[</span><span class="ident" id="6494546">i</span><span class="op" id="6494547">]</span><span class="op" id="6494548">.</span><span class="ident" id="6494549">Creation</span><span class="op" id="6494557">.</span><span class="ident" id="6494558">Equal</span><span class="op" id="6494563">(</span><span class="ident" id="6494564">s</span><span class="op" id="6494565">[</span><span class="ident" id="6494566">j</span><span class="op" id="6494567">]</span><span class="op" id="6494568">.</span><span class="ident" id="6494569">Creation</span><span class="op" id="6494577">)</span>&nbsp;<span class="op" id="6494579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494583">return</span>&nbsp;<span class="ident" id="6494590">s</span><span class="op" id="6494591">[</span><span class="ident" id="6494592">i</span><span class="op" id="6494593">]</span><span class="op" id="6494594">.</span><span class="ident" id="6494595">Creation</span><span class="op" id="6494603">.</span><span class="ident" id="6494604">Before</span><span class="op" id="6494610">(</span><span class="ident" id="6494611">s</span><span class="op" id="6494612">[</span><span class="ident" id="6494613">j</span><span class="op" id="6494614">]</span><span class="op" id="6494615">.</span><span class="ident" id="6494616">Creation</span><span class="op" id="6494624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6494627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494630">return</span>&nbsp;<span class="ident" id="6494637">s</span><span class="op" id="6494638">[</span><span class="ident" id="6494639">i</span><span class="op" id="6494640">]</span><span class="op" id="6494641">.</span><span class="ident" id="6494642">seqNum</span>&nbsp;<span class="op" id="6494649">&lt;</span>&nbsp;<span class="ident" id="6494651">s</span><span class="op" id="6494652">[</span><span class="ident" id="6494653">j</span><span class="op" id="6494654">]</span><span class="op" id="6494655">.</span><span class="ident" id="6494656">seqNum</span><br>
<span class="lineno"></span><span class="op" id="6494663">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6494666">func</span>&nbsp;<span class="op" id="6494671">(</span><span class="ident" id="6494672">s</span>&nbsp;<span class="ident" id="6494674">byPathLength</span><span class="op" id="6494686">)</span>&nbsp;<span class="ident" id="6494688">Swap</span><span class="op" id="6494692">(</span><span class="ident" id="6494693">i</span><span class="op" id="6494694">,</span>&nbsp;<span class="ident" id="6494696">j</span>&nbsp;<span class="builtintype" id="6494698">int</span><span class="op" id="6494701">)</span>&nbsp;<span class="op" id="6494703">{</span>&nbsp;<span class="ident" id="6494705">s</span><span class="op" id="6494706">[</span><span class="ident" id="6494707">i</span><span class="op" id="6494708">]</span><span class="op" id="6494709">,</span>&nbsp;<span class="ident" id="6494711">s</span><span class="op" id="6494712">[</span><span class="ident" id="6494713">j</span><span class="op" id="6494714">]</span>&nbsp;<span class="op" id="6494716">=</span>&nbsp;<span class="ident" id="6494718">s</span><span class="op" id="6494719">[</span><span class="ident" id="6494720">j</span><span class="op" id="6494721">]</span><span class="op" id="6494722">,</span>&nbsp;<span class="ident" id="6494724">s</span><span class="op" id="6494725">[</span><span class="ident" id="6494726">i</span><span class="op" id="6494727">]</span>&nbsp;<span class="op" id="6494729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6494732">//&nbsp;Cookies&nbsp;implements&nbsp;the&nbsp;Cookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6494806">//</span><br>
<span class="lineno">170</span><span class="comment" id="6494809">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno"></span><span class="keyword" id="6494880">func</span>&nbsp;<span class="op" id="6494885">(</span><span class="ident" id="6494886">j</span>&nbsp;<span class="op" id="6494888">*</span><span class="ident" id="6494889">Jar</span><span class="op" id="6494892">)</span>&nbsp;<span class="ident" id="6494894">Cookies</span><span class="op" id="6494901">(</span><span class="ident" id="6494902">u</span>&nbsp;<span class="op" id="6494904">*</span><span class="ident" id="6494905">url</span><span class="op" id="6494908">.</span><span class="ident" id="6494909">URL</span><span class="op" id="6494912">)</span>&nbsp;<span class="op" id="6494914">(</span><span class="ident" id="6494915">cookies</span>&nbsp;<span class="op" id="6494923">[</span><span class="op" id="6494924">]</span><span class="op" id="6494925">*</span><span class="ident" id="6494926">http</span><span class="op" id="6494930">.</span><span class="ident" id="6494931">Cookie</span><span class="op" id="6494937">)</span>&nbsp;<span class="op" id="6494939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494942">return</span>&nbsp;<span class="ident" id="6494949">j</span><span class="op" id="6494950">.</span><span class="ident" id="6494951">cookies</span><span class="op" id="6494958">(</span><span class="ident" id="6494959">u</span><span class="op" id="6494960">,</span>&nbsp;<span class="ident" id="6494962">time</span><span class="op" id="6494966">.</span><span class="ident" id="6494967">Now</span><span class="op" id="6494970">(</span><span class="op" id="6494971">)</span><span class="op" id="6494972">)</span><br>
<span class="lineno"></span><span class="op" id="6494974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6494977">//&nbsp;cookies&nbsp;is&nbsp;like&nbsp;Cookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;a&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="6495047">func</span>&nbsp;<span class="op" id="6495052">(</span><span class="ident" id="6495053">j</span>&nbsp;<span class="op" id="6495055">*</span><span class="ident" id="6495056">Jar</span><span class="op" id="6495059">)</span>&nbsp;<span class="ident" id="6495061">cookies</span><span class="op" id="6495068">(</span><span class="ident" id="6495069">u</span>&nbsp;<span class="op" id="6495071">*</span><span class="ident" id="6495072">url</span><span class="op" id="6495075">.</span><span class="ident" id="6495076">URL</span><span class="op" id="6495079">,</span>&nbsp;<span class="ident" id="6495081">now</span>&nbsp;<span class="ident" id="6495085">time</span><span class="op" id="6495089">.</span><span class="ident" id="6495090">Time</span><span class="op" id="6495094">)</span>&nbsp;<span class="op" id="6495096">(</span><span class="ident" id="6495097">cookies</span>&nbsp;<span class="op" id="6495105">[</span><span class="op" id="6495106">]</span><span class="op" id="6495107">*</span><span class="ident" id="6495108">http</span><span class="op" id="6495112">.</span><span class="ident" id="6495113">Cookie</span><span class="op" id="6495119">)</span>&nbsp;<span class="op" id="6495121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495124">if</span>&nbsp;<span class="ident" id="6495127">u</span><span class="op" id="6495128">.</span><span class="ident" id="6495129">Scheme</span>&nbsp;<span class="op" id="6495136">!=</span>&nbsp;<span class="string" id="6495139">&#34;http&#34;</span>&nbsp;<span class="op" id="6495146">&amp;&amp;</span>&nbsp;<span class="ident" id="6495149">u</span><span class="op" id="6495150">.</span><span class="ident" id="6495151">Scheme</span>&nbsp;<span class="op" id="6495158">!=</span>&nbsp;<span class="string" id="6495161">&#34;https&#34;</span>&nbsp;<span class="op" id="6495169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495173">return</span>&nbsp;<span class="ident" id="6495180">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495189">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495192">host</span><span class="op" id="6495196">,</span>&nbsp;<span class="ident" id="6495198">err</span>&nbsp;<span class="op" id="6495202">:=</span>&nbsp;<span class="ident" id="6495205">canonicalHost</span><span class="op" id="6495218">(</span><span class="ident" id="6495219">u</span><span class="op" id="6495220">.</span><span class="ident" id="6495221">Host</span><span class="op" id="6495225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495228">if</span>&nbsp;<span class="ident" id="6495231">err</span>&nbsp;<span class="op" id="6495235">!=</span>&nbsp;<span class="ident" id="6495238">nil</span>&nbsp;<span class="op" id="6495242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495246">return</span>&nbsp;<span class="ident" id="6495253">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495265">key</span>&nbsp;<span class="op" id="6495269">:=</span>&nbsp;<span class="ident" id="6495272">jarKey</span><span class="op" id="6495278">(</span><span class="ident" id="6495279">host</span><span class="op" id="6495283">,</span>&nbsp;<span class="ident" id="6495285">j</span><span class="op" id="6495286">.</span><span class="ident" id="6495287">psList</span><span class="op" id="6495293">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495297">j</span><span class="op" id="6495298">.</span><span class="ident" id="6495299">mu</span><span class="op" id="6495301">.</span><span class="ident" id="6495302">Lock</span><span class="op" id="6495306">(</span><span class="op" id="6495307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495310">defer</span>&nbsp;<span class="ident" id="6495316">j</span><span class="op" id="6495317">.</span><span class="ident" id="6495318">mu</span><span class="op" id="6495320">.</span><span class="ident" id="6495321">Unlock</span><span class="op" id="6495327">(</span><span class="op" id="6495328">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495332">submap</span>&nbsp;<span class="op" id="6495339">:=</span>&nbsp;<span class="ident" id="6495342">j</span><span class="op" id="6495343">.</span><span class="ident" id="6495344">entries</span><span class="op" id="6495351">[</span><span class="ident" id="6495352">key</span><span class="op" id="6495355">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495358">if</span>&nbsp;<span class="ident" id="6495361">submap</span>&nbsp;<span class="op" id="6495368">==</span>&nbsp;<span class="ident" id="6495371">nil</span>&nbsp;<span class="op" id="6495375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495379">return</span>&nbsp;<span class="ident" id="6495386">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495399">https</span>&nbsp;<span class="op" id="6495405">:=</span>&nbsp;<span class="ident" id="6495408">u</span><span class="op" id="6495409">.</span><span class="ident" id="6495410">Scheme</span>&nbsp;<span class="op" id="6495417">==</span>&nbsp;<span class="string" id="6495420">&#34;https&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495429">path</span>&nbsp;<span class="op" id="6495434">:=</span>&nbsp;<span class="ident" id="6495437">u</span><span class="op" id="6495438">.</span><span class="ident" id="6495439">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495445">if</span>&nbsp;<span class="ident" id="6495448">path</span>&nbsp;<span class="op" id="6495453">==</span>&nbsp;<span class="string" id="6495456">&#34;&#34;</span>&nbsp;<span class="op" id="6495459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495463">path</span>&nbsp;<span class="op" id="6495468">=</span>&nbsp;<span class="string" id="6495470">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495479">modified</span>&nbsp;<span class="op" id="6495488">:=</span>&nbsp;<span class="builtintype" id="6495491">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495498">var</span>&nbsp;<span class="ident" id="6495502">selected</span>&nbsp;<span class="op" id="6495511">[</span><span class="op" id="6495512">]</span><span class="ident" id="6495513">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495520">for</span>&nbsp;<span class="ident" id="6495524">id</span><span class="op" id="6495526">,</span>&nbsp;<span class="ident" id="6495528">e</span>&nbsp;<span class="op" id="6495530">:=</span>&nbsp;<span class="keyword" id="6495533">range</span>&nbsp;<span class="ident" id="6495539">submap</span>&nbsp;<span class="op" id="6495546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495550">if</span>&nbsp;<span class="ident" id="6495553">e</span><span class="op" id="6495554">.</span><span class="ident" id="6495555">Persistent</span>&nbsp;<span class="op" id="6495566">&amp;&amp;</span>&nbsp;<span class="op" id="6495569">!</span><span class="ident" id="6495570">e</span><span class="op" id="6495571">.</span><span class="ident" id="6495572">Expires</span><span class="op" id="6495579">.</span><span class="ident" id="6495580">After</span><span class="op" id="6495585">(</span><span class="ident" id="6495586">now</span><span class="op" id="6495589">)</span>&nbsp;<span class="op" id="6495591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6495596">delete</span><span class="op" id="6495602">(</span><span class="ident" id="6495603">submap</span><span class="op" id="6495609">,</span>&nbsp;<span class="ident" id="6495611">id</span><span class="op" id="6495613">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495618">modified</span>&nbsp;<span class="op" id="6495627">=</span>&nbsp;<span class="builtintype" id="6495629">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495637">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495652">if</span>&nbsp;<span class="op" id="6495655">!</span><span class="ident" id="6495656">e</span><span class="op" id="6495657">.</span><span class="ident" id="6495658">shouldSend</span><span class="op" id="6495668">(</span><span class="ident" id="6495669">https</span><span class="op" id="6495674">,</span>&nbsp;<span class="ident" id="6495676">host</span><span class="op" id="6495680">,</span>&nbsp;<span class="ident" id="6495682">path</span><span class="op" id="6495686">)</span>&nbsp;<span class="op" id="6495688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495693">continue</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495708">e</span><span class="op" id="6495709">.</span><span class="ident" id="6495710">LastAccess</span>&nbsp;<span class="op" id="6495721">=</span>&nbsp;<span class="ident" id="6495723">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495729">submap</span><span class="op" id="6495735">[</span><span class="ident" id="6495736">id</span><span class="op" id="6495738">]</span>&nbsp;<span class="op" id="6495740">=</span>&nbsp;<span class="ident" id="6495742">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495746">selected</span>&nbsp;<span class="op" id="6495755">=</span>&nbsp;<span class="builtinfunc" id="6495757">append</span><span class="op" id="6495763">(</span><span class="ident" id="6495764">selected</span><span class="op" id="6495772">,</span>&nbsp;<span class="ident" id="6495774">e</span><span class="op" id="6495775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495779">modified</span>&nbsp;<span class="op" id="6495788">=</span>&nbsp;<span class="builtintype" id="6495790">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495799">if</span>&nbsp;<span class="ident" id="6495802">modified</span>&nbsp;<span class="op" id="6495811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495815">if</span>&nbsp;<span class="builtinfunc" id="6495818">len</span><span class="op" id="6495821">(</span><span class="ident" id="6495822">submap</span><span class="op" id="6495828">)</span>&nbsp;<span class="op" id="6495830">==</span>&nbsp;<span class="num" id="6495833">0</span>&nbsp;<span class="op" id="6495835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6495840">delete</span><span class="op" id="6495846">(</span><span class="ident" id="6495847">j</span><span class="op" id="6495848">.</span><span class="ident" id="6495849">entries</span><span class="op" id="6495856">,</span>&nbsp;<span class="ident" id="6495858">key</span><span class="op" id="6495861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495865">}</span>&nbsp;<span class="keyword" id="6495867">else</span>&nbsp;<span class="op" id="6495872">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495877">j</span><span class="op" id="6495878">.</span><span class="ident" id="6495879">entries</span><span class="op" id="6495886">[</span><span class="ident" id="6495887">key</span><span class="op" id="6495890">]</span>&nbsp;<span class="op" id="6495892">=</span>&nbsp;<span class="ident" id="6495894">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495910">sort</span><span class="op" id="6495914">.</span><span class="ident" id="6495915">Sort</span><span class="op" id="6495919">(</span><span class="ident" id="6495920">byPathLength</span><span class="op" id="6495932">(</span><span class="ident" id="6495933">selected</span><span class="op" id="6495941">)</span><span class="op" id="6495942">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495945">for</span>&nbsp;<span class="ident" id="6495949">_</span><span class="op" id="6495950">,</span>&nbsp;<span class="ident" id="6495952">e</span>&nbsp;<span class="op" id="6495954">:=</span>&nbsp;<span class="keyword" id="6495957">range</span>&nbsp;<span class="ident" id="6495963">selected</span>&nbsp;<span class="op" id="6495972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495976">cookies</span>&nbsp;<span class="op" id="6495984">=</span>&nbsp;<span class="builtinfunc" id="6495986">append</span><span class="op" id="6495992">(</span><span class="ident" id="6495993">cookies</span><span class="op" id="6496000">,</span>&nbsp;<span class="op" id="6496002">&amp;</span><span class="ident" id="6496003">http</span><span class="op" id="6496007">.</span><span class="ident" id="6496008">Cookie</span><span class="op" id="6496014">{</span><span class="ident" id="6496015">Name</span><span class="op" id="6496019">:</span>&nbsp;<span class="ident" id="6496021">e</span><span class="op" id="6496022">.</span><span class="ident" id="6496023">Name</span><span class="op" id="6496027">,</span>&nbsp;<span class="ident" id="6496029">Value</span><span class="op" id="6496034">:</span>&nbsp;<span class="ident" id="6496036">e</span><span class="op" id="6496037">.</span><span class="ident" id="6496038">Value</span><span class="op" id="6496043">}</span><span class="op" id="6496044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6496047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496051">return</span>&nbsp;<span class="ident" id="6496058">cookies</span><br>
<span class="lineno">230</span><span class="op" id="6496066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6496069">//&nbsp;SetCookies&nbsp;implements&nbsp;the&nbsp;SetCookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6496149">//</span><br>
<span class="lineno"></span><span class="comment" id="6496152">//&nbsp;It&nbsp;does&nbsp;nothing&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno">235</span><span class="keyword" id="6496213">func</span>&nbsp;<span class="op" id="6496218">(</span><span class="ident" id="6496219">j</span>&nbsp;<span class="op" id="6496221">*</span><span class="ident" id="6496222">Jar</span><span class="op" id="6496225">)</span>&nbsp;<span class="ident" id="6496227">SetCookies</span><span class="op" id="6496237">(</span><span class="ident" id="6496238">u</span>&nbsp;<span class="op" id="6496240">*</span><span class="ident" id="6496241">url</span><span class="op" id="6496244">.</span><span class="ident" id="6496245">URL</span><span class="op" id="6496248">,</span>&nbsp;<span class="ident" id="6496250">cookies</span>&nbsp;<span class="op" id="6496258">[</span><span class="op" id="6496259">]</span><span class="op" id="6496260">*</span><span class="ident" id="6496261">http</span><span class="op" id="6496265">.</span><span class="ident" id="6496266">Cookie</span><span class="op" id="6496272">)</span>&nbsp;<span class="op" id="6496274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496277">j</span><span class="op" id="6496278">.</span><span class="ident" id="6496279">setCookies</span><span class="op" id="6496289">(</span><span class="ident" id="6496290">u</span><span class="op" id="6496291">,</span>&nbsp;<span class="ident" id="6496293">cookies</span><span class="op" id="6496300">,</span>&nbsp;<span class="ident" id="6496302">time</span><span class="op" id="6496306">.</span><span class="ident" id="6496307">Now</span><span class="op" id="6496310">(</span><span class="op" id="6496311">)</span><span class="op" id="6496312">)</span><br>
<span class="lineno"></span><span class="op" id="6496314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6496317">//&nbsp;setCookies&nbsp;is&nbsp;like&nbsp;SetCookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;parameter.</span><br>
<span class="lineno">240</span><span class="keyword" id="6496391">func</span>&nbsp;<span class="op" id="6496396">(</span><span class="ident" id="6496397">j</span>&nbsp;<span class="op" id="6496399">*</span><span class="ident" id="6496400">Jar</span><span class="op" id="6496403">)</span>&nbsp;<span class="ident" id="6496405">setCookies</span><span class="op" id="6496415">(</span><span class="ident" id="6496416">u</span>&nbsp;<span class="op" id="6496418">*</span><span class="ident" id="6496419">url</span><span class="op" id="6496422">.</span><span class="ident" id="6496423">URL</span><span class="op" id="6496426">,</span>&nbsp;<span class="ident" id="6496428">cookies</span>&nbsp;<span class="op" id="6496436">[</span><span class="op" id="6496437">]</span><span class="op" id="6496438">*</span><span class="ident" id="6496439">http</span><span class="op" id="6496443">.</span><span class="ident" id="6496444">Cookie</span><span class="op" id="6496450">,</span>&nbsp;<span class="ident" id="6496452">now</span>&nbsp;<span class="ident" id="6496456">time</span><span class="op" id="6496460">.</span><span class="ident" id="6496461">Time</span><span class="op" id="6496465">)</span>&nbsp;<span class="op" id="6496467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496470">if</span>&nbsp;<span class="builtinfunc" id="6496473">len</span><span class="op" id="6496476">(</span><span class="ident" id="6496477">cookies</span><span class="op" id="6496484">)</span>&nbsp;<span class="op" id="6496486">==</span>&nbsp;<span class="num" id="6496489">0</span>&nbsp;<span class="op" id="6496491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496495">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6496503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496506">if</span>&nbsp;<span class="ident" id="6496509">u</span><span class="op" id="6496510">.</span><span class="ident" id="6496511">Scheme</span>&nbsp;<span class="op" id="6496518">!=</span>&nbsp;<span class="string" id="6496521">&#34;http&#34;</span>&nbsp;<span class="op" id="6496528">&amp;&amp;</span>&nbsp;<span class="ident" id="6496531">u</span><span class="op" id="6496532">.</span><span class="ident" id="6496533">Scheme</span>&nbsp;<span class="op" id="6496540">!=</span>&nbsp;<span class="string" id="6496543">&#34;https&#34;</span>&nbsp;<span class="op" id="6496551">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496555">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6496563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496566">host</span><span class="op" id="6496570">,</span>&nbsp;<span class="ident" id="6496572">err</span>&nbsp;<span class="op" id="6496576">:=</span>&nbsp;<span class="ident" id="6496579">canonicalHost</span><span class="op" id="6496592">(</span><span class="ident" id="6496593">u</span><span class="op" id="6496594">.</span><span class="ident" id="6496595">Host</span><span class="op" id="6496599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496602">if</span>&nbsp;<span class="ident" id="6496605">err</span>&nbsp;<span class="op" id="6496609">!=</span>&nbsp;<span class="ident" id="6496612">nil</span>&nbsp;<span class="op" id="6496616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496620">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6496628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496631">key</span>&nbsp;<span class="op" id="6496635">:=</span>&nbsp;<span class="ident" id="6496638">jarKey</span><span class="op" id="6496644">(</span><span class="ident" id="6496645">host</span><span class="op" id="6496649">,</span>&nbsp;<span class="ident" id="6496651">j</span><span class="op" id="6496652">.</span><span class="ident" id="6496653">psList</span><span class="op" id="6496659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496662">defPath</span>&nbsp;<span class="op" id="6496670">:=</span>&nbsp;<span class="ident" id="6496673">defaultPath</span><span class="op" id="6496684">(</span><span class="ident" id="6496685">u</span><span class="op" id="6496686">.</span><span class="ident" id="6496687">Path</span><span class="op" id="6496691">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496695">j</span><span class="op" id="6496696">.</span><span class="ident" id="6496697">mu</span><span class="op" id="6496699">.</span><span class="ident" id="6496700">Lock</span><span class="op" id="6496704">(</span><span class="op" id="6496705">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496708">defer</span>&nbsp;<span class="ident" id="6496714">j</span><span class="op" id="6496715">.</span><span class="ident" id="6496716">mu</span><span class="op" id="6496718">.</span><span class="ident" id="6496719">Unlock</span><span class="op" id="6496725">(</span><span class="op" id="6496726">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496730">submap</span>&nbsp;<span class="op" id="6496737">:=</span>&nbsp;<span class="ident" id="6496740">j</span><span class="op" id="6496741">.</span><span class="ident" id="6496742">entries</span><span class="op" id="6496749">[</span><span class="ident" id="6496750">key</span><span class="op" id="6496753">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496757">modified</span>&nbsp;<span class="op" id="6496766">:=</span>&nbsp;<span class="builtintype" id="6496769">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496776">for</span>&nbsp;<span class="ident" id="6496780">_</span><span class="op" id="6496781">,</span>&nbsp;<span class="ident" id="6496783">cookie</span>&nbsp;<span class="op" id="6496790">:=</span>&nbsp;<span class="keyword" id="6496793">range</span>&nbsp;<span class="ident" id="6496799">cookies</span>&nbsp;<span class="op" id="6496807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496811">e</span><span class="op" id="6496812">,</span>&nbsp;<span class="ident" id="6496814">remove</span><span class="op" id="6496820">,</span>&nbsp;<span class="ident" id="6496822">err</span>&nbsp;<span class="op" id="6496826">:=</span>&nbsp;<span class="ident" id="6496829">j</span><span class="op" id="6496830">.</span><span class="ident" id="6496831">newEntry</span><span class="op" id="6496839">(</span><span class="ident" id="6496840">cookie</span><span class="op" id="6496846">,</span>&nbsp;<span class="ident" id="6496848">now</span><span class="op" id="6496851">,</span>&nbsp;<span class="ident" id="6496853">defPath</span><span class="op" id="6496860">,</span>&nbsp;<span class="ident" id="6496862">host</span><span class="op" id="6496866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496870">if</span>&nbsp;<span class="ident" id="6496873">err</span>&nbsp;<span class="op" id="6496877">!=</span>&nbsp;<span class="ident" id="6496880">nil</span>&nbsp;<span class="op" id="6496884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496889">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6496900">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496904">id</span>&nbsp;<span class="op" id="6496907">:=</span>&nbsp;<span class="ident" id="6496910">e</span><span class="op" id="6496911">.</span><span class="ident" id="6496912">id</span><span class="op" id="6496914">(</span><span class="op" id="6496915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496919">if</span>&nbsp;<span class="ident" id="6496922">remove</span>&nbsp;<span class="op" id="6496929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496934">if</span>&nbsp;<span class="ident" id="6496937">submap</span>&nbsp;<span class="op" id="6496944">!=</span>&nbsp;<span class="ident" id="6496947">nil</span>&nbsp;<span class="op" id="6496951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496957">if</span>&nbsp;<span class="ident" id="6496960">_</span><span class="op" id="6496961">,</span>&nbsp;<span class="ident" id="6496963">ok</span>&nbsp;<span class="op" id="6496966">:=</span>&nbsp;<span class="ident" id="6496969">submap</span><span class="op" id="6496975">[</span><span class="ident" id="6496976">id</span><span class="op" id="6496978">]</span><span class="op" id="6496979">;</span>&nbsp;<span class="ident" id="6496981">ok</span>&nbsp;<span class="op" id="6496984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6496991">delete</span><span class="op" id="6496997">(</span><span class="ident" id="6496998">submap</span><span class="op" id="6497004">,</span>&nbsp;<span class="ident" id="6497006">id</span><span class="op" id="6497008">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497015">modified</span>&nbsp;<span class="op" id="6497024">=</span>&nbsp;<span class="builtintype" id="6497026">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497045">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497056">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497060">if</span>&nbsp;<span class="ident" id="6497063">submap</span>&nbsp;<span class="op" id="6497070">==</span>&nbsp;<span class="ident" id="6497073">nil</span>&nbsp;<span class="op" id="6497077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497082">submap</span>&nbsp;<span class="op" id="6497089">=</span>&nbsp;<span class="builtinfunc" id="6497091">make</span><span class="op" id="6497095">(</span><span class="keyword" id="6497096">map</span><span class="op" id="6497099">[</span><span class="builtintype" id="6497100">string</span><span class="op" id="6497106">]</span><span class="ident" id="6497107">entry</span><span class="op" id="6497112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497121">if</span>&nbsp;<span class="ident" id="6497124">old</span><span class="op" id="6497127">,</span>&nbsp;<span class="ident" id="6497129">ok</span>&nbsp;<span class="op" id="6497132">:=</span>&nbsp;<span class="ident" id="6497135">submap</span><span class="op" id="6497141">[</span><span class="ident" id="6497142">id</span><span class="op" id="6497144">]</span><span class="op" id="6497145">;</span>&nbsp;<span class="ident" id="6497147">ok</span>&nbsp;<span class="op" id="6497150">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497155">e</span><span class="op" id="6497156">.</span><span class="ident" id="6497157">Creation</span>&nbsp;<span class="op" id="6497166">=</span>&nbsp;<span class="ident" id="6497168">old</span><span class="op" id="6497171">.</span><span class="ident" id="6497172">Creation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497184">e</span><span class="op" id="6497185">.</span><span class="ident" id="6497186">seqNum</span>&nbsp;<span class="op" id="6497193">=</span>&nbsp;<span class="ident" id="6497195">old</span><span class="op" id="6497198">.</span><span class="ident" id="6497199">seqNum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497208">}</span>&nbsp;<span class="keyword" id="6497210">else</span>&nbsp;<span class="op" id="6497215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497220">e</span><span class="op" id="6497221">.</span><span class="ident" id="6497222">Creation</span>&nbsp;<span class="op" id="6497231">=</span>&nbsp;<span class="ident" id="6497233">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497240">e</span><span class="op" id="6497241">.</span><span class="ident" id="6497242">seqNum</span>&nbsp;<span class="op" id="6497249">=</span>&nbsp;<span class="ident" id="6497251">j</span><span class="op" id="6497252">.</span><span class="ident" id="6497253">nextSeqNum</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497267">j</span><span class="op" id="6497268">.</span><span class="ident" id="6497269">nextSeqNum</span><span class="op" id="6497279">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497288">e</span><span class="op" id="6497289">.</span><span class="ident" id="6497290">LastAccess</span>&nbsp;<span class="op" id="6497301">=</span>&nbsp;<span class="ident" id="6497303">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497309">submap</span><span class="op" id="6497315">[</span><span class="ident" id="6497316">id</span><span class="op" id="6497318">]</span>&nbsp;<span class="op" id="6497320">=</span>&nbsp;<span class="ident" id="6497322">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497326">modified</span>&nbsp;<span class="op" id="6497335">=</span>&nbsp;<span class="builtintype" id="6497337">true</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497347">if</span>&nbsp;<span class="ident" id="6497350">modified</span>&nbsp;<span class="op" id="6497359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497363">if</span>&nbsp;<span class="builtinfunc" id="6497366">len</span><span class="op" id="6497369">(</span><span class="ident" id="6497370">submap</span><span class="op" id="6497376">)</span>&nbsp;<span class="op" id="6497378">==</span>&nbsp;<span class="num" id="6497381">0</span>&nbsp;<span class="op" id="6497383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6497388">delete</span><span class="op" id="6497394">(</span><span class="ident" id="6497395">j</span><span class="op" id="6497396">.</span><span class="ident" id="6497397">entries</span><span class="op" id="6497404">,</span>&nbsp;<span class="ident" id="6497406">key</span><span class="op" id="6497409">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497413">}</span>&nbsp;<span class="keyword" id="6497415">else</span>&nbsp;<span class="op" id="6497420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497425">j</span><span class="op" id="6497426">.</span><span class="ident" id="6497427">entries</span><span class="op" id="6497434">[</span><span class="ident" id="6497435">key</span><span class="op" id="6497438">]</span>&nbsp;<span class="op" id="6497440">=</span>&nbsp;<span class="ident" id="6497442">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497454">}</span><br>
<span class="lineno"></span><span class="op" id="6497456">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="6497459">//&nbsp;canonicalHost&nbsp;strips&nbsp;port&nbsp;from&nbsp;host&nbsp;if&nbsp;present&nbsp;and&nbsp;returns&nbsp;the&nbsp;canonicalized</span><br>
<span class="lineno"></span><span class="comment" id="6497539">//&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="6497553">func</span>&nbsp;<span class="ident" id="6497558">canonicalHost</span><span class="op" id="6497571">(</span><span class="ident" id="6497572">host</span>&nbsp;<span class="builtintype" id="6497577">string</span><span class="op" id="6497583">)</span>&nbsp;<span class="op" id="6497585">(</span><span class="builtintype" id="6497586">string</span><span class="op" id="6497592">,</span>&nbsp;<span class="builtintype" id="6497594">error</span><span class="op" id="6497599">)</span>&nbsp;<span class="op" id="6497601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497604">var</span>&nbsp;<span class="ident" id="6497608">err</span>&nbsp;<span class="builtintype" id="6497612">error</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497619">host</span>&nbsp;<span class="op" id="6497624">=</span>&nbsp;<span class="ident" id="6497626">strings</span><span class="op" id="6497633">.</span><span class="ident" id="6497634">ToLower</span><span class="op" id="6497641">(</span><span class="ident" id="6497642">host</span><span class="op" id="6497646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497649">if</span>&nbsp;<span class="ident" id="6497652">hasPort</span><span class="op" id="6497659">(</span><span class="ident" id="6497660">host</span><span class="op" id="6497664">)</span>&nbsp;<span class="op" id="6497666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497670">host</span><span class="op" id="6497674">,</span>&nbsp;<span class="ident" id="6497676">_</span><span class="op" id="6497677">,</span>&nbsp;<span class="ident" id="6497679">err</span>&nbsp;<span class="op" id="6497683">=</span>&nbsp;<span class="ident" id="6497685">net</span><span class="op" id="6497688">.</span><span class="ident" id="6497689">SplitHostPort</span><span class="op" id="6497702">(</span><span class="ident" id="6497703">host</span><span class="op" id="6497707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497711">if</span>&nbsp;<span class="ident" id="6497714">err</span>&nbsp;<span class="op" id="6497718">!=</span>&nbsp;<span class="ident" id="6497721">nil</span>&nbsp;<span class="op" id="6497725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497730">return</span>&nbsp;<span class="string" id="6497737">&#34;&#34;</span><span class="op" id="6497739">,</span>&nbsp;<span class="ident" id="6497741">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497753">if</span>&nbsp;<span class="ident" id="6497756">strings</span><span class="op" id="6497763">.</span><span class="ident" id="6497764">HasSuffix</span><span class="op" id="6497773">(</span><span class="ident" id="6497774">host</span><span class="op" id="6497778">,</span>&nbsp;<span class="string" id="6497780">&#34;.&#34;</span><span class="op" id="6497783">)</span>&nbsp;<span class="op" id="6497785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6497789">//&nbsp;Strip&nbsp;trailing&nbsp;dot&nbsp;from&nbsp;fully&nbsp;qualified&nbsp;domain&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497848">host</span>&nbsp;<span class="op" id="6497853">=</span>&nbsp;<span class="ident" id="6497855">host</span><span class="op" id="6497859">[</span><span class="op" id="6497860">:</span><span class="builtinfunc" id="6497861">len</span><span class="op" id="6497864">(</span><span class="ident" id="6497865">host</span><span class="op" id="6497869">)</span><span class="op" id="6497870">-</span><span class="num" id="6497871">1</span><span class="op" id="6497872">]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497878">return</span>&nbsp;<span class="ident" id="6497885">toASCII</span><span class="op" id="6497892">(</span><span class="ident" id="6497893">host</span><span class="op" id="6497897">)</span><br>
<span class="lineno"></span><span class="op" id="6497899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6497902">//&nbsp;hasPort&nbsp;reports&nbsp;whether&nbsp;host&nbsp;contains&nbsp;a&nbsp;port&nbsp;number.&nbsp;host&nbsp;may&nbsp;be&nbsp;a&nbsp;host</span><br>
<span class="lineno">320</span><span class="comment" id="6497977">//&nbsp;name,&nbsp;an&nbsp;IPv4&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6498014">func</span>&nbsp;<span class="ident" id="6498019">hasPort</span><span class="op" id="6498026">(</span><span class="ident" id="6498027">host</span>&nbsp;<span class="builtintype" id="6498032">string</span><span class="op" id="6498038">)</span>&nbsp;<span class="builtintype" id="6498040">bool</span>&nbsp;<span class="op" id="6498045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498048">colons</span>&nbsp;<span class="op" id="6498055">:=</span>&nbsp;<span class="ident" id="6498058">strings</span><span class="op" id="6498065">.</span><span class="ident" id="6498066">Count</span><span class="op" id="6498071">(</span><span class="ident" id="6498072">host</span><span class="op" id="6498076">,</span>&nbsp;<span class="string" id="6498078">&#34;:&#34;</span><span class="op" id="6498081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498084">if</span>&nbsp;<span class="ident" id="6498087">colons</span>&nbsp;<span class="op" id="6498094">==</span>&nbsp;<span class="num" id="6498097">0</span>&nbsp;<span class="op" id="6498099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498103">return</span>&nbsp;<span class="builtintype" id="6498110">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498120">if</span>&nbsp;<span class="ident" id="6498123">colons</span>&nbsp;<span class="op" id="6498130">==</span>&nbsp;<span class="num" id="6498133">1</span>&nbsp;<span class="op" id="6498135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498139">return</span>&nbsp;<span class="builtintype" id="6498146">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498155">return</span>&nbsp;<span class="ident" id="6498162">host</span><span class="op" id="6498166">[</span><span class="num" id="6498167">0</span><span class="op" id="6498168">]</span>&nbsp;<span class="op" id="6498170">==</span>&nbsp;<span class="string" id="6498173">&#39;[&#39;</span>&nbsp;<span class="op" id="6498177">&amp;&amp;</span>&nbsp;<span class="ident" id="6498180">strings</span><span class="op" id="6498187">.</span><span class="ident" id="6498188">Contains</span><span class="op" id="6498196">(</span><span class="ident" id="6498197">host</span><span class="op" id="6498201">,</span>&nbsp;<span class="string" id="6498203">&#34;]:&#34;</span><span class="op" id="6498207">)</span><br>
<span class="lineno">330</span><span class="op" id="6498209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6498212">//&nbsp;jarKey&nbsp;returns&nbsp;the&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;a&nbsp;jar.</span><br>
<span class="lineno"></span><span class="keyword" id="6498256">func</span>&nbsp;<span class="ident" id="6498261">jarKey</span><span class="op" id="6498267">(</span><span class="ident" id="6498268">host</span>&nbsp;<span class="builtintype" id="6498273">string</span><span class="op" id="6498279">,</span>&nbsp;<span class="ident" id="6498281">psl</span>&nbsp;<span class="ident" id="6498285">PublicSuffixList</span><span class="op" id="6498301">)</span>&nbsp;<span class="builtintype" id="6498303">string</span>&nbsp;<span class="op" id="6498310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498313">if</span>&nbsp;<span class="ident" id="6498316">isIP</span><span class="op" id="6498320">(</span><span class="ident" id="6498321">host</span><span class="op" id="6498325">)</span>&nbsp;<span class="op" id="6498327">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498331">return</span>&nbsp;<span class="ident" id="6498338">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498348">var</span>&nbsp;<span class="ident" id="6498352">i</span>&nbsp;<span class="builtintype" id="6498354">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498359">if</span>&nbsp;<span class="ident" id="6498362">psl</span>&nbsp;<span class="op" id="6498366">==</span>&nbsp;<span class="ident" id="6498369">nil</span>&nbsp;<span class="op" id="6498373">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498377">i</span>&nbsp;<span class="op" id="6498379">=</span>&nbsp;<span class="ident" id="6498381">strings</span><span class="op" id="6498388">.</span><span class="ident" id="6498389">LastIndex</span><span class="op" id="6498398">(</span><span class="ident" id="6498399">host</span><span class="op" id="6498403">,</span>&nbsp;<span class="string" id="6498405">&#34;.&#34;</span><span class="op" id="6498408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498412">if</span>&nbsp;<span class="ident" id="6498415">i</span>&nbsp;<span class="op" id="6498417">==</span>&nbsp;<span class="op" id="6498420">-</span><span class="num" id="6498421">1</span>&nbsp;<span class="op" id="6498423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498428">return</span>&nbsp;<span class="ident" id="6498435">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498445">}</span>&nbsp;<span class="keyword" id="6498447">else</span>&nbsp;<span class="op" id="6498452">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498456">suffix</span>&nbsp;<span class="op" id="6498463">:=</span>&nbsp;<span class="ident" id="6498466">psl</span><span class="op" id="6498469">.</span><span class="ident" id="6498470">PublicSuffix</span><span class="op" id="6498482">(</span><span class="ident" id="6498483">host</span><span class="op" id="6498487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498491">if</span>&nbsp;<span class="ident" id="6498494">suffix</span>&nbsp;<span class="op" id="6498501">==</span>&nbsp;<span class="ident" id="6498504">host</span>&nbsp;<span class="op" id="6498509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498514">return</span>&nbsp;<span class="ident" id="6498521">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498532">i</span>&nbsp;<span class="op" id="6498534">=</span>&nbsp;<span class="builtinfunc" id="6498536">len</span><span class="op" id="6498539">(</span><span class="ident" id="6498540">host</span><span class="op" id="6498544">)</span>&nbsp;<span class="op" id="6498546">-</span>&nbsp;<span class="builtinfunc" id="6498548">len</span><span class="op" id="6498551">(</span><span class="ident" id="6498552">suffix</span><span class="op" id="6498558">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498562">if</span>&nbsp;<span class="ident" id="6498565">i</span>&nbsp;<span class="op" id="6498567">&lt;=</span>&nbsp;<span class="num" id="6498570">0</span>&nbsp;<span class="op" id="6498572">||</span>&nbsp;<span class="ident" id="6498575">host</span><span class="op" id="6498579">[</span><span class="ident" id="6498580">i</span><span class="op" id="6498581">-</span><span class="num" id="6498582">1</span><span class="op" id="6498583">]</span>&nbsp;<span class="op" id="6498585">!=</span>&nbsp;<span class="string" id="6498588">&#39;.&#39;</span>&nbsp;<span class="op" id="6498592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498597">//&nbsp;The&nbsp;provided&nbsp;public&nbsp;suffix&nbsp;list&nbsp;psl&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498650">//&nbsp;Storing&nbsp;cookies&nbsp;under&nbsp;host&nbsp;is&nbsp;a&nbsp;safe&nbsp;stopgap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498702">return</span>&nbsp;<span class="ident" id="6498709">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498716">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498722">prevDot</span>&nbsp;<span class="op" id="6498730">:=</span>&nbsp;<span class="ident" id="6498733">strings</span><span class="op" id="6498740">.</span><span class="ident" id="6498741">LastIndex</span><span class="op" id="6498750">(</span><span class="ident" id="6498751">host</span><span class="op" id="6498755">[</span><span class="op" id="6498756">:</span><span class="ident" id="6498757">i</span><span class="op" id="6498758">-</span><span class="num" id="6498759">1</span><span class="op" id="6498760">]</span><span class="op" id="6498761">,</span>&nbsp;<span class="string" id="6498763">&#34;.&#34;</span><span class="op" id="6498766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498769">return</span>&nbsp;<span class="ident" id="6498776">host</span><span class="op" id="6498780">[</span><span class="ident" id="6498781">prevDot</span><span class="op" id="6498788">+</span><span class="num" id="6498789">1</span><span class="op" id="6498790">:</span><span class="op" id="6498791">]</span><br>
<span class="lineno"></span><span class="op" id="6498793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="6498796">//&nbsp;isIP&nbsp;reports&nbsp;whether&nbsp;host&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6498843">func</span>&nbsp;<span class="ident" id="6498848">isIP</span><span class="op" id="6498852">(</span><span class="ident" id="6498853">host</span>&nbsp;<span class="builtintype" id="6498858">string</span><span class="op" id="6498864">)</span>&nbsp;<span class="builtintype" id="6498866">bool</span>&nbsp;<span class="op" id="6498871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498874">return</span>&nbsp;<span class="ident" id="6498881">net</span><span class="op" id="6498884">.</span><span class="ident" id="6498885">ParseIP</span><span class="op" id="6498892">(</span><span class="ident" id="6498893">host</span><span class="op" id="6498897">)</span>&nbsp;<span class="op" id="6498899">!=</span>&nbsp;<span class="ident" id="6498902">nil</span><br>
<span class="lineno"></span><span class="op" id="6498906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="6498909">//&nbsp;defaultPath&nbsp;returns&nbsp;the&nbsp;directory&nbsp;part&nbsp;of&nbsp;an&nbsp;URL&#39;s&nbsp;path&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6498981">//&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="6499008">func</span>&nbsp;<span class="ident" id="6499013">defaultPath</span><span class="op" id="6499024">(</span><span class="ident" id="6499025">path</span>&nbsp;<span class="builtintype" id="6499030">string</span><span class="op" id="6499036">)</span>&nbsp;<span class="builtintype" id="6499038">string</span>&nbsp;<span class="op" id="6499045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499048">if</span>&nbsp;<span class="builtinfunc" id="6499051">len</span><span class="op" id="6499054">(</span><span class="ident" id="6499055">path</span><span class="op" id="6499059">)</span>&nbsp;<span class="op" id="6499061">==</span>&nbsp;<span class="num" id="6499064">0</span>&nbsp;<span class="op" id="6499066">||</span>&nbsp;<span class="ident" id="6499069">path</span><span class="op" id="6499073">[</span><span class="num" id="6499074">0</span><span class="op" id="6499075">]</span>&nbsp;<span class="op" id="6499077">!=</span>&nbsp;<span class="string" id="6499080">&#39;/&#39;</span>&nbsp;<span class="op" id="6499084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499088">return</span>&nbsp;<span class="string" id="6499095">&#34;/&#34;</span>&nbsp;<span class="comment" id="6499099">//&nbsp;Path&nbsp;is&nbsp;empty&nbsp;or&nbsp;malformed.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499135">i</span>&nbsp;<span class="op" id="6499137">:=</span>&nbsp;<span class="ident" id="6499140">strings</span><span class="op" id="6499147">.</span><span class="ident" id="6499148">LastIndex</span><span class="op" id="6499157">(</span><span class="ident" id="6499158">path</span><span class="op" id="6499162">,</span>&nbsp;<span class="string" id="6499164">&#34;/&#34;</span><span class="op" id="6499167">)</span>&nbsp;<span class="comment" id="6499169">//&nbsp;Path&nbsp;starts&nbsp;with&nbsp;&#34;/&#34;,&nbsp;so&nbsp;i&nbsp;!=&nbsp;-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499207">if</span>&nbsp;<span class="ident" id="6499210">i</span>&nbsp;<span class="op" id="6499212">==</span>&nbsp;<span class="num" id="6499215">0</span>&nbsp;<span class="op" id="6499217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499221">return</span>&nbsp;<span class="string" id="6499228">&#34;/&#34;</span>&nbsp;<span class="comment" id="6499232">//&nbsp;Path&nbsp;has&nbsp;the&nbsp;form&nbsp;&#34;/abc&#34;.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499265">return</span>&nbsp;<span class="ident" id="6499272">path</span><span class="op" id="6499276">[</span><span class="op" id="6499277">:</span><span class="ident" id="6499278">i</span><span class="op" id="6499279">]</span>&nbsp;<span class="comment" id="6499281">//&nbsp;Path&nbsp;is&nbsp;either&nbsp;of&nbsp;form&nbsp;&#34;/abc/xyz&#34;&nbsp;or&nbsp;&#34;/abc/xyz/&#34;.</span><br>
<span class="lineno"></span><span class="op" id="6499334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6499337">//&nbsp;newEntry&nbsp;creates&nbsp;an&nbsp;entry&nbsp;from&nbsp;a&nbsp;http.Cookie&nbsp;c.&nbsp;now&nbsp;is&nbsp;the&nbsp;current&nbsp;time&nbsp;and</span><br>
<span class="lineno">380</span><span class="comment" id="6499416">//&nbsp;is&nbsp;compared&nbsp;to&nbsp;c.Expires&nbsp;to&nbsp;determine&nbsp;deletion&nbsp;of&nbsp;c.&nbsp;defPath&nbsp;and&nbsp;host&nbsp;are&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6499497">//&nbsp;default-path&nbsp;and&nbsp;the&nbsp;canonical&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;URL&nbsp;c&nbsp;was&nbsp;received&nbsp;from.</span><br>
<span class="lineno"></span><span class="comment" id="6499573">//</span><br>
<span class="lineno"></span><span class="comment" id="6499576">//&nbsp;remove&nbsp;records&nbsp;whether&nbsp;the&nbsp;jar&nbsp;should&nbsp;delete&nbsp;this&nbsp;cookie,&nbsp;as&nbsp;it&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="6499655">//&nbsp;expired&nbsp;with&nbsp;respect&nbsp;to&nbsp;now.&nbsp;In&nbsp;this&nbsp;case,&nbsp;e&nbsp;may&nbsp;be&nbsp;incomplete,&nbsp;but&nbsp;it&nbsp;will</span><br>
<span class="lineno">385</span><span class="comment" id="6499734">//&nbsp;be&nbsp;valid&nbsp;to&nbsp;call&nbsp;e.id&nbsp;(which&nbsp;depends&nbsp;on&nbsp;e&#39;s&nbsp;Name,&nbsp;Domain&nbsp;and&nbsp;Path).</span><br>
<span class="lineno"></span><span class="comment" id="6499805">//</span><br>
<span class="lineno"></span><span class="comment" id="6499808">//&nbsp;A&nbsp;malformed&nbsp;c.Domain&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="6499857">func</span>&nbsp;<span class="op" id="6499862">(</span><span class="ident" id="6499863">j</span>&nbsp;<span class="op" id="6499865">*</span><span class="ident" id="6499866">Jar</span><span class="op" id="6499869">)</span>&nbsp;<span class="ident" id="6499871">newEntry</span><span class="op" id="6499879">(</span><span class="ident" id="6499880">c</span>&nbsp;<span class="op" id="6499882">*</span><span class="ident" id="6499883">http</span><span class="op" id="6499887">.</span><span class="ident" id="6499888">Cookie</span><span class="op" id="6499894">,</span>&nbsp;<span class="ident" id="6499896">now</span>&nbsp;<span class="ident" id="6499900">time</span><span class="op" id="6499904">.</span><span class="ident" id="6499905">Time</span><span class="op" id="6499909">,</span>&nbsp;<span class="ident" id="6499911">defPath</span><span class="op" id="6499918">,</span>&nbsp;<span class="ident" id="6499920">host</span>&nbsp;<span class="builtintype" id="6499925">string</span><span class="op" id="6499931">)</span>&nbsp;<span class="op" id="6499933">(</span><span class="ident" id="6499934">e</span>&nbsp;<span class="ident" id="6499936">entry</span><span class="op" id="6499941">,</span>&nbsp;<span class="ident" id="6499943">remove</span>&nbsp;<span class="builtintype" id="6499950">bool</span><span class="op" id="6499954">,</span>&nbsp;<span class="ident" id="6499956">err</span>&nbsp;<span class="builtintype" id="6499960">error</span><span class="op" id="6499965">)</span>&nbsp;<span class="op" id="6499967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499970">e</span><span class="op" id="6499971">.</span><span class="ident" id="6499972">Name</span>&nbsp;<span class="op" id="6499977">=</span>&nbsp;<span class="ident" id="6499979">c</span><span class="op" id="6499980">.</span><span class="ident" id="6499981">Name</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499988">if</span>&nbsp;<span class="ident" id="6499991">c</span><span class="op" id="6499992">.</span><span class="ident" id="6499993">Path</span>&nbsp;<span class="op" id="6499998">==</span>&nbsp;<span class="string" id="6500001">&#34;&#34;</span>&nbsp;<span class="op" id="6500004">||</span>&nbsp;<span class="ident" id="6500007">c</span><span class="op" id="6500008">.</span><span class="ident" id="6500009">Path</span><span class="op" id="6500013">[</span><span class="num" id="6500014">0</span><span class="op" id="6500015">]</span>&nbsp;<span class="op" id="6500017">!=</span>&nbsp;<span class="string" id="6500020">&#39;/&#39;</span>&nbsp;<span class="op" id="6500024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500028">e</span><span class="op" id="6500029">.</span><span class="ident" id="6500030">Path</span>&nbsp;<span class="op" id="6500035">=</span>&nbsp;<span class="ident" id="6500037">defPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6500046">}</span>&nbsp;<span class="keyword" id="6500048">else</span>&nbsp;<span class="op" id="6500053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500057">e</span><span class="op" id="6500058">.</span><span class="ident" id="6500059">Path</span>&nbsp;<span class="op" id="6500064">=</span>&nbsp;<span class="ident" id="6500066">c</span><span class="op" id="6500067">.</span><span class="ident" id="6500068">Path</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6500074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500078">e</span><span class="op" id="6500079">.</span><span class="ident" id="6500080">Domain</span><span class="op" id="6500086">,</span>&nbsp;<span class="ident" id="6500088">e</span><span class="op" id="6500089">.</span><span class="ident" id="6500090">HostOnly</span><span class="op" id="6500098">,</span>&nbsp;<span class="ident" id="6500100">err</span>&nbsp;<span class="op" id="6500104">=</span>&nbsp;<span class="ident" id="6500106">j</span><span class="op" id="6500107">.</span><span class="ident" id="6500108">domainAndType</span><span class="op" id="6500121">(</span><span class="ident" id="6500122">host</span><span class="op" id="6500126">,</span>&nbsp;<span class="ident" id="6500128">c</span><span class="op" id="6500129">.</span><span class="ident" id="6500130">Domain</span><span class="op" id="6500136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6500139">if</span>&nbsp;<span class="ident" id="6500142">err</span>&nbsp;<span class="op" id="6500146">!=</span>&nbsp;<span class="ident" id="6500149">nil</span>&nbsp;<span class="op" id="6500153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6500157">return</span>&nbsp;<span class="ident" id="6500164">e</span><span class="op" id="6500165">,</span>&nbsp;<span class="builtintype" id="6500167">false</span><span class="op" id="6500172">,</span>&nbsp;<span class="ident" id="6500174">err</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6500179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6500183">//&nbsp;MaxAge&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;Expires.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6500225">if</span>&nbsp;<span class="ident" id="6500228">c</span><span class="op" id="6500229">.</span><span class="ident" id="6500230">MaxAge</span>&nbsp;<span class="op" id="6500237">&lt;</span>&nbsp;<span class="num" id="6500239">0</span>&nbsp;<span class="op" id="6500241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6500245">return</span>&nbsp;<span class="ident" id="6500252">e</span><span class="op" id="6500253">,</span>&nbsp;<span class="builtintype" id="6500255">true</span><span class="op" id="6500259">,</span>&nbsp;<span class="ident" id="6500261">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6500266">}</span>&nbsp;<span class="keyword" id="6500268">else</span>&nbsp;<span class="keyword" id="6500273">if</span>&nbsp;<span class="ident" id="6500276">c</span><span class="op" id="6500277">.</span><span class="ident" id="6500278">MaxAge</span>&nbsp;<span class="op" id="6500285">&gt;</span>&nbsp;<span class="num" id="6500287">0</span>&nbsp;<span class="op" id="6500289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500293">e</span><span class="op" id="6500294">.</span><span class="ident" id="6500295">Expires</span>&nbsp;<span class="op" id="6500303">=</span>&nbsp;<span class="ident" id="6500305">now</span><span class="op" id="6500308">.</span><span class="ident" id="6500309">Add</span><span class="op" id="6500312">(</span><span class="ident" id="6500313">time</span><span class="op" id="6500317">.</span><span class="ident" id="6500318">Duration</span><span class="op" id="6500326">(</span><span class="ident" id="6500327">c</span><span class="op" id="6500328">.</span><span class="ident" id="6500329">MaxAge</span><span class="op" id="6500335">)</span>&nbsp;<span class="op" id="6500337">*</span>&nbsp;<span class="ident" id="6500339">time</span><span class="op" id="6500343">.</span><span class="ident" id="6500344">Second</span><span class="op" id="6500350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500354">e</span><span class="op" id="6500355">.</span><span class="ident" id="6500356">Persistent</span>&nbsp;<span class="op" id="6500367">=</span>&nbsp;<span class="builtintype" id="6500369">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6500375">}</span>&nbsp;<span class="keyword" id="6500377">else</span>&nbsp;<span class="op" id="6500382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6500386">if</span>&nbsp;<span class="ident" id="6500389">c</span><span class="op" id="6500390">.</span><span class="ident" id="6500391">Expires</span><span class="op" id="6500398">.</span><span class="ident" id="6500399">IsZero</span><span class="op" id="6500405">(</span><span class="op" id="6500406">)</span>&nbsp;<span class="op" id="6500408">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500413">e</span><span class="op" id="6500414">.</span><span class="ident" id="6500415">Expires</span>&nbsp;<span class="op" id="6500423">=</span>&nbsp;<span class="ident" id="6500425">endOfTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500438">e</span><span class="op" id="6500439">.</span><span class="ident" id="6500440">Persistent</span>&nbsp;<span class="op" id="6500451">=</span>&nbsp;<span class="builtintype" id="6500453">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6500461">}</span>&nbsp;<span class="keyword" id="6500463">else</span>&nbsp;<span class="op" id="6500468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6500473">if</span>&nbsp;<span class="op" id="6500476">!</span><span class="ident" id="6500477">c</span><span class="op" id="6500478">.</span><span class="ident" id="6500479">Expires</span><span class="op" id="6500486">.</span><span class="ident" id="6500487">After</span><span class="op" id="6500492">(</span><span class="ident" id="6500493">now</span><span class="op" id="6500496">)</span>&nbsp;<span class="op" id="6500498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6500504">return</span>&nbsp;<span class="ident" id="6500511">e</span><span class="op" id="6500512">,</span>&nbsp;<span class="builtintype" id="6500514">true</span><span class="op" id="6500518">,</span>&nbsp;<span class="ident" id="6500520">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6500527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500532">e</span><span class="op" id="6500533">.</span><span class="ident" id="6500534">Expires</span>&nbsp;<span class="op" id="6500542">=</span>&nbsp;<span class="ident" id="6500544">c</span><span class="op" id="6500545">.</span><span class="ident" id="6500546">Expires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500557">e</span><span class="op" id="6500558">.</span><span class="ident" id="6500559">Persistent</span>&nbsp;<span class="op" id="6500570">=</span>&nbsp;<span class="builtintype" id="6500572">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6500579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6500582">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500586">e</span><span class="op" id="6500587">.</span><span class="ident" id="6500588">Value</span>&nbsp;<span class="op" id="6500594">=</span>&nbsp;<span class="ident" id="6500596">c</span><span class="op" id="6500597">.</span><span class="ident" id="6500598">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500605">e</span><span class="op" id="6500606">.</span><span class="ident" id="6500607">Secure</span>&nbsp;<span class="op" id="6500614">=</span>&nbsp;<span class="ident" id="6500616">c</span><span class="op" id="6500617">.</span><span class="ident" id="6500618">Secure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500626">e</span><span class="op" id="6500627">.</span><span class="ident" id="6500628">HttpOnly</span>&nbsp;<span class="op" id="6500637">=</span>&nbsp;<span class="ident" id="6500639">c</span><span class="op" id="6500640">.</span><span class="ident" id="6500641">HttpOnly</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6500652">return</span>&nbsp;<span class="ident" id="6500659">e</span><span class="op" id="6500660">,</span>&nbsp;<span class="builtintype" id="6500662">false</span><span class="op" id="6500667">,</span>&nbsp;<span class="ident" id="6500669">nil</span><br>
<span class="lineno"></span><span class="op" id="6500673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6500676">var</span>&nbsp;<span class="op" id="6500680">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500683">errIllegalDomain</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6500702">=</span>&nbsp;<span class="ident" id="6500704">errors</span><span class="op" id="6500710">.</span><span class="ident" id="6500711">New</span><span class="op" id="6500714">(</span><span class="string" id="6500715">&#34;cookiejar:&nbsp;illegal&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="6500759">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500762">errMalformedDomain</span>&nbsp;<span class="op" id="6500781">=</span>&nbsp;<span class="ident" id="6500783">errors</span><span class="op" id="6500789">.</span><span class="ident" id="6500790">New</span><span class="op" id="6500793">(</span><span class="string" id="6500794">&#34;cookiejar:&nbsp;malformed&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="6500840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500843">errNoHostname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500862">=</span>&nbsp;<span class="ident" id="6500864">errors</span><span class="op" id="6500870">.</span><span class="ident" id="6500871">New</span><span class="op" id="6500874">(</span><span class="string" id="6500875">&#34;cookiejar:&nbsp;no&nbsp;host&nbsp;name&nbsp;available&nbsp;(IP&nbsp;only)&#34;</span><span class="op" id="6500920">)</span><br>
<span class="lineno"></span><span class="op" id="6500922">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6500925">//&nbsp;endOfTime&nbsp;is&nbsp;the&nbsp;time&nbsp;when&nbsp;session&nbsp;(non-persistent)&nbsp;cookies&nbsp;expire.</span><br>
<span class="lineno">435</span><span class="comment" id="6500996">//&nbsp;This&nbsp;instant&nbsp;is&nbsp;representable&nbsp;in&nbsp;most&nbsp;date/time&nbsp;formats&nbsp;(not&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="6501065">//&nbsp;Go&#39;s&nbsp;time.Time)&nbsp;and&nbsp;should&nbsp;be&nbsp;far&nbsp;enough&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="6501124">var</span>&nbsp;<span class="ident" id="6501128">endOfTime</span>&nbsp;<span class="op" id="6501138">=</span>&nbsp;<span class="ident" id="6501140">time</span><span class="op" id="6501144">.</span><span class="ident" id="6501145">Date</span><span class="op" id="6501149">(</span><span class="num" id="6501150">9999</span><span class="op" id="6501154">,</span>&nbsp;<span class="num" id="6501156">12</span><span class="op" id="6501158">,</span>&nbsp;<span class="num" id="6501160">31</span><span class="op" id="6501162">,</span>&nbsp;<span class="num" id="6501164">23</span><span class="op" id="6501166">,</span>&nbsp;<span class="num" id="6501168">59</span><span class="op" id="6501170">,</span>&nbsp;<span class="num" id="6501172">59</span><span class="op" id="6501174">,</span>&nbsp;<span class="num" id="6501176">0</span><span class="op" id="6501177">,</span>&nbsp;<span class="ident" id="6501179">time</span><span class="op" id="6501183">.</span><span class="ident" id="6501184">UTC</span><span class="op" id="6501187">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6501190">//&nbsp;domainAndType&nbsp;determines&nbsp;the&nbsp;cookie&#39;s&nbsp;domain&nbsp;and&nbsp;hostOnly&nbsp;attribute.</span><br>
<span class="lineno">440</span><span class="keyword" id="6501262">func</span>&nbsp;<span class="op" id="6501267">(</span><span class="ident" id="6501268">j</span>&nbsp;<span class="op" id="6501270">*</span><span class="ident" id="6501271">Jar</span><span class="op" id="6501274">)</span>&nbsp;<span class="ident" id="6501276">domainAndType</span><span class="op" id="6501289">(</span><span class="ident" id="6501290">host</span><span class="op" id="6501294">,</span>&nbsp;<span class="ident" id="6501296">domain</span>&nbsp;<span class="builtintype" id="6501303">string</span><span class="op" id="6501309">)</span>&nbsp;<span class="op" id="6501311">(</span><span class="builtintype" id="6501312">string</span><span class="op" id="6501318">,</span>&nbsp;<span class="builtintype" id="6501320">bool</span><span class="op" id="6501324">,</span>&nbsp;<span class="builtintype" id="6501326">error</span><span class="op" id="6501331">)</span>&nbsp;<span class="op" id="6501333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6501336">if</span>&nbsp;<span class="ident" id="6501339">domain</span>&nbsp;<span class="op" id="6501346">==</span>&nbsp;<span class="string" id="6501349">&#34;&#34;</span>&nbsp;<span class="op" id="6501352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6501356">//&nbsp;No&nbsp;domain&nbsp;attribute&nbsp;in&nbsp;the&nbsp;SetCookie&nbsp;header&nbsp;indicates&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6501417">//&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6501435">return</span>&nbsp;<span class="ident" id="6501442">host</span><span class="op" id="6501446">,</span>&nbsp;<span class="builtintype" id="6501448">true</span><span class="op" id="6501452">,</span>&nbsp;<span class="ident" id="6501454">nil</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6501459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6501463">if</span>&nbsp;<span class="ident" id="6501466">isIP</span><span class="op" id="6501470">(</span><span class="ident" id="6501471">host</span><span class="op" id="6501475">)</span>&nbsp;<span class="op" id="6501477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6501481">//&nbsp;According&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;domain-matching&nbsp;includes&nbsp;not&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6501543">//&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6501563">//&nbsp;TODO:&nbsp;This&nbsp;might&nbsp;be&nbsp;relaxed&nbsp;as&nbsp;in&nbsp;common&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6501619">return</span>&nbsp;<span class="string" id="6501626">&#34;&#34;</span><span class="op" id="6501628">,</span>&nbsp;<span class="builtintype" id="6501630">false</span><span class="op" id="6501635">,</span>&nbsp;<span class="ident" id="6501637">errNoHostname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6501652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6501656">//&nbsp;From&nbsp;here&nbsp;on:&nbsp;If&nbsp;the&nbsp;cookie&nbsp;is&nbsp;valid,&nbsp;it&nbsp;is&nbsp;a&nbsp;domain&nbsp;cookie&nbsp;(with</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6501726">//&nbsp;the&nbsp;one&nbsp;exception&nbsp;of&nbsp;a&nbsp;public&nbsp;suffix&nbsp;below).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6501775">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6501807">if</span>&nbsp;<span class="ident" id="6501810">domain</span><span class="op" id="6501816">[</span><span class="num" id="6501817">0</span><span class="op" id="6501818">]</span>&nbsp;<span class="op" id="6501820">==</span>&nbsp;<span class="string" id="6501823">&#39;.&#39;</span>&nbsp;<span class="op" id="6501827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6501831">domain</span>&nbsp;<span class="op" id="6501838">=</span>&nbsp;<span class="ident" id="6501840">domain</span><span class="op" id="6501846">[</span><span class="num" id="6501847">1</span><span class="op" id="6501848">:</span><span class="op" id="6501849">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6501852">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6501856">if</span>&nbsp;<span class="builtinfunc" id="6501859">len</span><span class="op" id="6501862">(</span><span class="ident" id="6501863">domain</span><span class="op" id="6501869">)</span>&nbsp;<span class="op" id="6501871">==</span>&nbsp;<span class="num" id="6501874">0</span>&nbsp;<span class="op" id="6501876">||</span>&nbsp;<span class="ident" id="6501879">domain</span><span class="op" id="6501885">[</span><span class="num" id="6501886">0</span><span class="op" id="6501887">]</span>&nbsp;<span class="op" id="6501889">==</span>&nbsp;<span class="string" id="6501892">&#39;.&#39;</span>&nbsp;<span class="op" id="6501896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6501900">//&nbsp;Received&nbsp;either&nbsp;&#34;Domain=.&#34;&nbsp;or&nbsp;&#34;Domain=..some.thing&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6501958">//&nbsp;both&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6501981">return</span>&nbsp;<span class="string" id="6501988">&#34;&#34;</span><span class="op" id="6501990">,</span>&nbsp;<span class="builtintype" id="6501992">false</span><span class="op" id="6501997">,</span>&nbsp;<span class="ident" id="6501999">errMalformedDomain</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6502019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6502022">domain</span>&nbsp;<span class="op" id="6502029">=</span>&nbsp;<span class="ident" id="6502031">strings</span><span class="op" id="6502038">.</span><span class="ident" id="6502039">ToLower</span><span class="op" id="6502046">(</span><span class="ident" id="6502047">domain</span><span class="op" id="6502053">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6502057">if</span>&nbsp;<span class="ident" id="6502060">domain</span><span class="op" id="6502066">[</span><span class="builtinfunc" id="6502067">len</span><span class="op" id="6502070">(</span><span class="ident" id="6502071">domain</span><span class="op" id="6502077">)</span><span class="op" id="6502078">-</span><span class="num" id="6502079">1</span><span class="op" id="6502080">]</span>&nbsp;<span class="op" id="6502082">==</span>&nbsp;<span class="string" id="6502085">&#39;.&#39;</span>&nbsp;<span class="op" id="6502089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6502093">//&nbsp;We&nbsp;received&nbsp;stuff&nbsp;like&nbsp;&#34;Domain=www.example.com.&#34;.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6502148">//&nbsp;Browsers&nbsp;do&nbsp;handle&nbsp;such&nbsp;stuff&nbsp;(actually&nbsp;differently)&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6502210">//&nbsp;RFC&nbsp;6265&nbsp;seems&nbsp;to&nbsp;be&nbsp;clear&nbsp;here&nbsp;(e.g.&nbsp;section&nbsp;4.1.2.3)&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6502273">//&nbsp;requiring&nbsp;a&nbsp;reject.&nbsp;&nbsp;4.1.2.3&nbsp;is&nbsp;not&nbsp;normative,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6502329">//&nbsp;&#34;Domain&nbsp;Matching&#34;&nbsp;(5.1.3)&nbsp;and&nbsp;&#34;Canonicalized&nbsp;Host&nbsp;Names&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6502391">//&nbsp;(5.1.2)&nbsp;are.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6502409">return</span>&nbsp;<span class="string" id="6502416">&#34;&#34;</span><span class="op" id="6502418">,</span>&nbsp;<span class="builtintype" id="6502420">false</span><span class="op" id="6502425">,</span>&nbsp;<span class="ident" id="6502427">errMalformedDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6502447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6502451">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.3&nbsp;#5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6502484">if</span>&nbsp;<span class="ident" id="6502487">j</span><span class="op" id="6502488">.</span><span class="ident" id="6502489">psList</span>&nbsp;<span class="op" id="6502496">!=</span>&nbsp;<span class="ident" id="6502499">nil</span>&nbsp;<span class="op" id="6502503">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6502507">if</span>&nbsp;<span class="ident" id="6502510">ps</span>&nbsp;<span class="op" id="6502513">:=</span>&nbsp;<span class="ident" id="6502516">j</span><span class="op" id="6502517">.</span><span class="ident" id="6502518">psList</span><span class="op" id="6502524">.</span><span class="ident" id="6502525">PublicSuffix</span><span class="op" id="6502537">(</span><span class="ident" id="6502538">domain</span><span class="op" id="6502544">)</span><span class="op" id="6502545">;</span>&nbsp;<span class="ident" id="6502547">ps</span>&nbsp;<span class="op" id="6502550">!=</span>&nbsp;<span class="string" id="6502553">&#34;&#34;</span>&nbsp;<span class="op" id="6502556">&amp;&amp;</span>&nbsp;<span class="op" id="6502559">!</span><span class="ident" id="6502560">hasDotSuffix</span><span class="op" id="6502572">(</span><span class="ident" id="6502573">domain</span><span class="op" id="6502579">,</span>&nbsp;<span class="ident" id="6502581">ps</span><span class="op" id="6502583">)</span>&nbsp;<span class="op" id="6502585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6502590">if</span>&nbsp;<span class="ident" id="6502593">host</span>&nbsp;<span class="op" id="6502598">==</span>&nbsp;<span class="ident" id="6502601">domain</span>&nbsp;<span class="op" id="6502608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6502614">//&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;exception&nbsp;in&nbsp;which&nbsp;a&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6502665">//&nbsp;with&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;is&nbsp;a&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6502714">return</span>&nbsp;<span class="ident" id="6502721">host</span><span class="op" id="6502725">,</span>&nbsp;<span class="builtintype" id="6502727">true</span><span class="op" id="6502731">,</span>&nbsp;<span class="ident" id="6502733">nil</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6502740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6502745">return</span>&nbsp;<span class="string" id="6502752">&#34;&#34;</span><span class="op" id="6502754">,</span>&nbsp;<span class="builtintype" id="6502756">false</span><span class="op" id="6502761">,</span>&nbsp;<span class="ident" id="6502763">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6502782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6502785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6502789">//&nbsp;The&nbsp;domain&nbsp;must&nbsp;domain-match&nbsp;host:&nbsp;www.mycompany.com&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6502853">//&nbsp;set&nbsp;cookies&nbsp;for&nbsp;.ourcompetitors.com.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6502894">if</span>&nbsp;<span class="ident" id="6502897">host</span>&nbsp;<span class="op" id="6502902">!=</span>&nbsp;<span class="ident" id="6502905">domain</span>&nbsp;<span class="op" id="6502912">&amp;&amp;</span>&nbsp;<span class="op" id="6502915">!</span><span class="ident" id="6502916">hasDotSuffix</span><span class="op" id="6502928">(</span><span class="ident" id="6502929">host</span><span class="op" id="6502933">,</span>&nbsp;<span class="ident" id="6502935">domain</span><span class="op" id="6502941">)</span>&nbsp;<span class="op" id="6502943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6502947">return</span>&nbsp;<span class="string" id="6502954">&#34;&#34;</span><span class="op" id="6502956">,</span>&nbsp;<span class="builtintype" id="6502958">false</span><span class="op" id="6502963">,</span>&nbsp;<span class="ident" id="6502965">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6502983">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6502987">return</span>&nbsp;<span class="ident" id="6502994">domain</span><span class="op" id="6503000">,</span>&nbsp;<span class="builtintype" id="6503002">false</span><span class="op" id="6503007">,</span>&nbsp;<span class="ident" id="6503009">nil</span><br>
<span class="lineno"></span><span class="op" id="6503013">}</span>
</div>
</body>
</html>
