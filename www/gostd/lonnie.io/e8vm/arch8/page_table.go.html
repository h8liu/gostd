<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3583224">package</span>&nbsp;<span class="ident" id="3583232">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3583239">//&nbsp;PageTable&nbsp;describes&nbsp;a&nbsp;page&nbsp;table&nbsp;in&nbsp;a&nbsp;physical&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="3583297">//&nbsp;It&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;translate&nbsp;a&nbsp;virtual&nbsp;memory&nbsp;address&nbsp;into&nbsp;a&nbsp;physical</span><br>
<span class="lineno">5</span><span class="comment" id="3583369">//&nbsp;memory&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3583388">type</span>&nbsp;<span class="ident" id="3583393">pageTable</span>&nbsp;<span class="keyword" id="3583403">struct</span>&nbsp;<span class="op" id="3583410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3583413">mem</span>&nbsp;&nbsp;<span class="op" id="3583418">*</span><span class="ident" id="3583419">phyMemory</span>&nbsp;<span class="comment" id="3583429">//&nbsp;the&nbsp;physical&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3583453">root</span>&nbsp;<span class="builtintype" id="3583458">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3583469">//&nbsp;root&nbsp;address</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3583487">//&nbsp;last&nbsp;translation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3583508">pte1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3583517">ptEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3583526">pte2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3583535">ptEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3583544">pte1Addr</span>&nbsp;<span class="builtintype" id="3583553">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3583561">pte2Addr</span>&nbsp;<span class="builtintype" id="3583570">uint32</span><br>
<span class="lineno">15</span><span class="op" id="3583577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3583580">//&nbsp;NewPageTable&nbsp;creates&nbsp;a&nbsp;new&nbsp;page&nbsp;table&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="3583630">//&nbsp;The&nbsp;page&nbsp;table&nbsp;is&nbsp;saved&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="3583666">//&nbsp;If&nbsp;addr&nbsp;is&nbsp;not&nbsp;page&nbsp;size&nbsp;aligned,&nbsp;it&nbsp;is&nbsp;aligned&nbsp;down.</span><br>
<span class="lineno">20</span><span class="keyword" id="3583723">func</span>&nbsp;<span class="ident" id="3583728">newPageTable</span><span class="op" id="3583740">(</span><span class="ident" id="3583741">m</span>&nbsp;<span class="op" id="3583743">*</span><span class="ident" id="3583744">phyMemory</span><span class="op" id="3583753">,</span>&nbsp;<span class="ident" id="3583755">addr</span>&nbsp;<span class="builtintype" id="3583760">uint32</span><span class="op" id="3583766">)</span>&nbsp;<span class="op" id="3583768">*</span><span class="ident" id="3583769">pageTable</span>&nbsp;<span class="op" id="3583779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3583782">addr</span>&nbsp;<span class="op" id="3583787">-=</span>&nbsp;<span class="ident" id="3583790">addr</span>&nbsp;<span class="op" id="3583795">%</span>&nbsp;<span class="ident" id="3583797">PageSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3583807">ret</span>&nbsp;<span class="op" id="3583811">:=</span>&nbsp;<span class="builtinfunc" id="3583814">new</span><span class="op" id="3583817">(</span><span class="ident" id="3583818">pageTable</span><span class="op" id="3583827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3583830">ret</span><span class="op" id="3583833">.</span><span class="ident" id="3583834">mem</span>&nbsp;<span class="op" id="3583838">=</span>&nbsp;<span class="ident" id="3583840">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3583843">ret</span><span class="op" id="3583846">.</span><span class="ident" id="3583847">root</span>&nbsp;<span class="op" id="3583852">=</span>&nbsp;<span class="ident" id="3583854">addr</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3583861">return</span>&nbsp;<span class="ident" id="3583868">ret</span><br>
<span class="lineno"></span><span class="op" id="3583872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3583875">//&nbsp;bit&nbsp;[31:12]&nbsp;-&gt;&nbsp;a&nbsp;page&nbsp;pointer</span><br>
<span class="lineno">30</span><span class="comment" id="3583908">//</span><br>
<span class="lineno"></span><span class="comment" id="3583911">//&nbsp;bit&nbsp;3:&nbsp;dirty&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="3583931">//&nbsp;bit&nbsp;2:&nbsp;use&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="3583949">//&nbsp;bit&nbsp;1:&nbsp;readonly&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="3583972">//&nbsp;bit&nbsp;0:&nbsp;valid&nbsp;bit</span><br>
<span class="lineno">35</span><span class="keyword" id="3583992">type</span>&nbsp;<span class="ident" id="3583997">ptEntry</span>&nbsp;<span class="builtintype" id="3584005">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3584013">const</span>&nbsp;<span class="op" id="3584019">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3584022">pteValid</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3584034">=</span>&nbsp;<span class="num" id="3584036">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3584039">pteReadonly</span>&nbsp;<span class="op" id="3584051">=</span>&nbsp;<span class="num" id="3584053">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3584056">pteUse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3584068">=</span>&nbsp;<span class="num" id="3584070">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3584073">pteDirty</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3584085">=</span>&nbsp;<span class="num" id="3584087">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3584090">pteUser</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3584102">=</span>&nbsp;<span class="num" id="3584104">4</span><br>
<span class="lineno"></span><span class="op" id="3584106">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="3584109">const</span>&nbsp;<span class="ident" id="3584115">u32one</span>&nbsp;<span class="builtintype" id="3584122">uint32</span>&nbsp;<span class="op" id="3584129">=</span>&nbsp;<span class="num" id="3584131">0x1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3584136">func</span>&nbsp;<span class="op" id="3584141">(</span><span class="ident" id="3584142">pte</span>&nbsp;<span class="ident" id="3584146">ptEntry</span><span class="op" id="3584153">)</span>&nbsp;<span class="ident" id="3584155">testBit</span><span class="op" id="3584162">(</span><span class="ident" id="3584163">n</span>&nbsp;<span class="builtintype" id="3584165">uint</span><span class="op" id="3584169">)</span>&nbsp;<span class="builtintype" id="3584171">bool</span>&nbsp;<span class="op" id="3584176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3584179">return</span>&nbsp;<span class="op" id="3584186">(</span><span class="builtintype" id="3584187">uint32</span><span class="op" id="3584193">(</span><span class="ident" id="3584194">pte</span><span class="op" id="3584197">)</span>&nbsp;<span class="op" id="3584199">&amp;</span>&nbsp;<span class="op" id="3584201">(</span><span class="ident" id="3584202">u32one</span>&nbsp;<span class="op" id="3584209">&lt;&lt;</span>&nbsp;<span class="ident" id="3584212">n</span><span class="op" id="3584213">)</span><span class="op" id="3584214">)</span>&nbsp;<span class="op" id="3584216">!=</span>&nbsp;<span class="num" id="3584219">0</span><br>
<span class="lineno"></span><span class="op" id="3584221">}</span><br>
<span class="lineno">50</span><span class="keyword" id="3584223">func</span>&nbsp;<span class="op" id="3584228">(</span><span class="ident" id="3584229">pte</span>&nbsp;<span class="op" id="3584233">*</span><span class="ident" id="3584234">ptEntry</span><span class="op" id="3584241">)</span>&nbsp;<span class="ident" id="3584243">setBit</span><span class="op" id="3584249">(</span><span class="ident" id="3584250">n</span>&nbsp;<span class="builtintype" id="3584252">uint</span><span class="op" id="3584256">)</span>&nbsp;<span class="op" id="3584258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3584261">*</span><span class="ident" id="3584262">pte</span>&nbsp;<span class="op" id="3584266">=</span>&nbsp;<span class="ident" id="3584268">ptEntry</span><span class="op" id="3584275">(</span><span class="builtintype" id="3584276">uint32</span><span class="op" id="3584282">(</span><span class="op" id="3584283">*</span><span class="ident" id="3584284">pte</span><span class="op" id="3584287">)</span>&nbsp;<span class="op" id="3584289">|</span>&nbsp;<span class="op" id="3584291">(</span><span class="ident" id="3584292">u32one</span>&nbsp;<span class="op" id="3584299">&lt;&lt;</span>&nbsp;<span class="ident" id="3584302">n</span><span class="op" id="3584303">)</span><span class="op" id="3584304">)</span><br>
<span class="lineno"></span><span class="op" id="3584306">}</span><br>
<span class="lineno"></span><span class="keyword" id="3584308">func</span>&nbsp;<span class="op" id="3584313">(</span><span class="ident" id="3584314">pte</span>&nbsp;<span class="ident" id="3584318">ptEntry</span><span class="op" id="3584325">)</span>&nbsp;<span class="ident" id="3584327">pn</span><span class="op" id="3584329">(</span><span class="op" id="3584330">)</span>&nbsp;<span class="builtintype" id="3584332">uint32</span>&nbsp;<span class="op" id="3584339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3584342">return</span>&nbsp;<span class="builtintype" id="3584349">uint32</span><span class="op" id="3584355">(</span><span class="ident" id="3584356">pte</span>&nbsp;<span class="op" id="3584360">/</span>&nbsp;<span class="ident" id="3584362">PageSize</span><span class="op" id="3584370">)</span><br>
<span class="lineno">55</span><span class="op" id="3584372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3584375">func</span>&nbsp;<span class="op" id="3584380">(</span><span class="ident" id="3584381">pte</span>&nbsp;<span class="ident" id="3584385">ptEntry</span><span class="op" id="3584392">)</span>&nbsp;<span class="ident" id="3584394">test</span><span class="op" id="3584398">(</span><span class="ident" id="3584399">addr</span>&nbsp;<span class="builtintype" id="3584404">uint32</span><span class="op" id="3584410">,</span>&nbsp;<span class="ident" id="3584412">ring</span>&nbsp;<span class="builtintype" id="3584417">byte</span><span class="op" id="3584421">)</span>&nbsp;<span class="op" id="3584423">*</span><span class="ident" id="3584424">Excep</span>&nbsp;<span class="op" id="3584430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3584433">if</span>&nbsp;<span class="op" id="3584436">!</span><span class="ident" id="3584437">pte</span><span class="op" id="3584440">.</span><span class="ident" id="3584441">testBit</span><span class="op" id="3584448">(</span><span class="ident" id="3584449">pteValid</span><span class="op" id="3584457">)</span>&nbsp;<span class="op" id="3584459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3584463">return</span>&nbsp;<span class="ident" id="3584470">newPageFault</span><span class="op" id="3584482">(</span><span class="ident" id="3584483">addr</span><span class="op" id="3584487">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3584490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3584493">if</span>&nbsp;<span class="ident" id="3584496">ring</span>&nbsp;<span class="op" id="3584501">&gt;</span>&nbsp;<span class="num" id="3584503">0</span>&nbsp;<span class="op" id="3584505">&amp;&amp;</span>&nbsp;<span class="op" id="3584508">!</span><span class="ident" id="3584509">pte</span><span class="op" id="3584512">.</span><span class="ident" id="3584513">testBit</span><span class="op" id="3584520">(</span><span class="ident" id="3584521">pteUser</span><span class="op" id="3584528">)</span>&nbsp;<span class="op" id="3584530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3584534">return</span>&nbsp;<span class="ident" id="3584541">newPageFault</span><span class="op" id="3584553">(</span><span class="ident" id="3584554">addr</span><span class="op" id="3584558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3584561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3584564">return</span>&nbsp;<span class="ident" id="3584571">nil</span><br>
<span class="lineno">65</span><span class="op" id="3584575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3584578">//&nbsp;Translate&nbsp;transalate&nbsp;a&nbsp;virutal&nbsp;address&nbsp;into&nbsp;physical&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3584643">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;translation&nbsp;fails</span><br>
<span class="lineno"></span><span class="keyword" id="3584691">func</span>&nbsp;<span class="op" id="3584696">(</span><span class="ident" id="3584697">pt</span>&nbsp;<span class="op" id="3584700">*</span><span class="ident" id="3584701">pageTable</span><span class="op" id="3584710">)</span>&nbsp;<span class="ident" id="3584712">Translate</span><span class="op" id="3584721">(</span><span class="ident" id="3584722">addr</span>&nbsp;<span class="builtintype" id="3584727">uint32</span><span class="op" id="3584733">,</span>&nbsp;<span class="ident" id="3584735">ring</span>&nbsp;<span class="builtintype" id="3584740">byte</span><span class="op" id="3584744">)</span>&nbsp;<span class="op" id="3584746">(</span><span class="builtintype" id="3584747">uint32</span><span class="op" id="3584753">,</span>&nbsp;<span class="op" id="3584755">*</span><span class="ident" id="3584756">Excep</span><span class="op" id="3584761">)</span>&nbsp;<span class="op" id="3584763">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3584766">vpn</span>&nbsp;<span class="op" id="3584770">:=</span>&nbsp;<span class="ident" id="3584773">addr</span>&nbsp;<span class="op" id="3584778">/</span>&nbsp;<span class="ident" id="3584780">PageSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3584790">off</span>&nbsp;<span class="op" id="3584794">:=</span>&nbsp;<span class="ident" id="3584797">addr</span>&nbsp;<span class="op" id="3584802">%</span>&nbsp;<span class="ident" id="3584804">PageSize</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3584815">index1</span>&nbsp;<span class="op" id="3584822">:=</span>&nbsp;<span class="ident" id="3584825">vpn</span>&nbsp;<span class="op" id="3584829">/</span>&nbsp;<span class="num" id="3584831">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3584837">index2</span>&nbsp;<span class="op" id="3584844">:=</span>&nbsp;<span class="ident" id="3584847">vpn</span>&nbsp;<span class="op" id="3584851">%</span>&nbsp;<span class="num" id="3584853">1024</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3584860">//&nbsp;first&nbsp;level&nbsp;page&nbsp;table&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3584893">pt</span><span class="op" id="3584895">.</span><span class="ident" id="3584896">pte1Addr</span>&nbsp;<span class="op" id="3584905">=</span>&nbsp;<span class="ident" id="3584907">pt</span><span class="op" id="3584909">.</span><span class="ident" id="3584910">root</span>&nbsp;<span class="op" id="3584915">+</span>&nbsp;<span class="ident" id="3584917">index1</span><span class="op" id="3584923">*</span><span class="num" id="3584924">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3584927">w</span><span class="op" id="3584928">,</span>&nbsp;<span class="ident" id="3584930">e</span>&nbsp;<span class="op" id="3584932">:=</span>&nbsp;<span class="ident" id="3584935">pt</span><span class="op" id="3584937">.</span><span class="ident" id="3584938">mem</span><span class="op" id="3584941">.</span><span class="ident" id="3584942">ReadWord</span><span class="op" id="3584950">(</span><span class="ident" id="3584951">pt</span><span class="op" id="3584953">.</span><span class="ident" id="3584954">pte1Addr</span><span class="op" id="3584962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3584965">if</span>&nbsp;<span class="ident" id="3584968">e</span>&nbsp;<span class="op" id="3584970">!=</span>&nbsp;<span class="ident" id="3584973">nil</span>&nbsp;<span class="op" id="3584977">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3584981">return</span>&nbsp;<span class="num" id="3584988">0</span><span class="op" id="3584989">,</span>&nbsp;<span class="ident" id="3584991">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3584994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3584997">pt</span><span class="op" id="3584999">.</span><span class="ident" id="3585000">pte1</span>&nbsp;<span class="op" id="3585005">=</span>&nbsp;<span class="ident" id="3585007">ptEntry</span><span class="op" id="3585014">(</span><span class="ident" id="3585015">w</span><span class="op" id="3585016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585019">e</span>&nbsp;<span class="op" id="3585021">=</span>&nbsp;<span class="ident" id="3585023">pt</span><span class="op" id="3585025">.</span><span class="ident" id="3585026">pte1</span><span class="op" id="3585030">.</span><span class="ident" id="3585031">test</span><span class="op" id="3585035">(</span><span class="ident" id="3585036">addr</span><span class="op" id="3585040">,</span>&nbsp;<span class="ident" id="3585042">ring</span><span class="op" id="3585046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585049">if</span>&nbsp;<span class="ident" id="3585052">e</span>&nbsp;<span class="op" id="3585054">!=</span>&nbsp;<span class="ident" id="3585057">nil</span>&nbsp;<span class="op" id="3585061">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585065">return</span>&nbsp;<span class="num" id="3585072">0</span><span class="op" id="3585073">,</span>&nbsp;<span class="ident" id="3585075">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3585078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585082">pn1</span>&nbsp;<span class="op" id="3585086">:=</span>&nbsp;<span class="ident" id="3585089">pt</span><span class="op" id="3585091">.</span><span class="ident" id="3585092">pte1</span><span class="op" id="3585096">.</span><span class="ident" id="3585097">pn</span><span class="op" id="3585099">(</span><span class="op" id="3585100">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585104">pt</span><span class="op" id="3585106">.</span><span class="ident" id="3585107">pte2Addr</span>&nbsp;<span class="op" id="3585116">=</span>&nbsp;<span class="ident" id="3585118">pn1</span><span class="op" id="3585121">*</span><span class="ident" id="3585122">PageSize</span>&nbsp;<span class="op" id="3585131">+</span>&nbsp;<span class="ident" id="3585133">index2</span><span class="op" id="3585139">*</span><span class="num" id="3585140">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585143">w</span><span class="op" id="3585144">,</span>&nbsp;<span class="ident" id="3585146">e</span>&nbsp;<span class="op" id="3585148">=</span>&nbsp;<span class="ident" id="3585150">pt</span><span class="op" id="3585152">.</span><span class="ident" id="3585153">mem</span><span class="op" id="3585156">.</span><span class="ident" id="3585157">ReadWord</span><span class="op" id="3585165">(</span><span class="ident" id="3585166">pt</span><span class="op" id="3585168">.</span><span class="ident" id="3585169">pte2Addr</span><span class="op" id="3585177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585180">if</span>&nbsp;<span class="ident" id="3585183">e</span>&nbsp;<span class="op" id="3585185">!=</span>&nbsp;<span class="ident" id="3585188">nil</span>&nbsp;<span class="op" id="3585192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585196">return</span>&nbsp;<span class="num" id="3585203">0</span><span class="op" id="3585204">,</span>&nbsp;<span class="ident" id="3585206">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3585209">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585212">pt</span><span class="op" id="3585214">.</span><span class="ident" id="3585215">pte2</span>&nbsp;<span class="op" id="3585220">=</span>&nbsp;<span class="ident" id="3585222">ptEntry</span><span class="op" id="3585229">(</span><span class="ident" id="3585230">w</span><span class="op" id="3585231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585234">e</span>&nbsp;<span class="op" id="3585236">=</span>&nbsp;<span class="ident" id="3585238">pt</span><span class="op" id="3585240">.</span><span class="ident" id="3585241">pte2</span><span class="op" id="3585245">.</span><span class="ident" id="3585246">test</span><span class="op" id="3585250">(</span><span class="ident" id="3585251">addr</span><span class="op" id="3585255">,</span>&nbsp;<span class="ident" id="3585257">ring</span><span class="op" id="3585261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585264">if</span>&nbsp;<span class="ident" id="3585267">e</span>&nbsp;<span class="op" id="3585269">!=</span>&nbsp;<span class="ident" id="3585272">nil</span>&nbsp;<span class="op" id="3585276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585280">return</span>&nbsp;<span class="num" id="3585287">0</span><span class="op" id="3585288">,</span>&nbsp;<span class="ident" id="3585290">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3585293">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585297">ppn</span>&nbsp;<span class="op" id="3585301">:=</span>&nbsp;<span class="ident" id="3585304">pt</span><span class="op" id="3585306">.</span><span class="ident" id="3585307">pte2</span><span class="op" id="3585311">.</span><span class="ident" id="3585312">pn</span><span class="op" id="3585314">(</span><span class="op" id="3585315">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585319">return</span>&nbsp;<span class="ident" id="3585326">ppn</span><span class="op" id="3585329">*</span><span class="ident" id="3585330">PageSize</span>&nbsp;<span class="op" id="3585339">+</span>&nbsp;<span class="ident" id="3585341">off</span><span class="op" id="3585344">,</span>&nbsp;<span class="ident" id="3585346">nil</span><br>
<span class="lineno"></span><span class="op" id="3585350">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="3585353">func</span>&nbsp;<span class="op" id="3585358">(</span><span class="ident" id="3585359">pt</span>&nbsp;<span class="op" id="3585362">*</span><span class="ident" id="3585363">pageTable</span><span class="op" id="3585372">)</span>&nbsp;<span class="ident" id="3585374">updatePte</span><span class="op" id="3585383">(</span><span class="op" id="3585384">)</span>&nbsp;<span class="op" id="3585386">*</span><span class="ident" id="3585387">Excep</span>&nbsp;<span class="op" id="3585393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585396">e</span>&nbsp;<span class="op" id="3585398">:=</span>&nbsp;<span class="ident" id="3585401">pt</span><span class="op" id="3585403">.</span><span class="ident" id="3585404">mem</span><span class="op" id="3585407">.</span><span class="ident" id="3585408">WriteWord</span><span class="op" id="3585417">(</span><span class="ident" id="3585418">pt</span><span class="op" id="3585420">.</span><span class="ident" id="3585421">pte1Addr</span><span class="op" id="3585429">,</span>&nbsp;<span class="builtintype" id="3585431">uint32</span><span class="op" id="3585437">(</span><span class="ident" id="3585438">pt</span><span class="op" id="3585440">.</span><span class="ident" id="3585441">pte1</span><span class="op" id="3585445">)</span><span class="op" id="3585446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585449">if</span>&nbsp;<span class="ident" id="3585452">e</span>&nbsp;<span class="op" id="3585454">!=</span>&nbsp;<span class="ident" id="3585457">nil</span>&nbsp;<span class="op" id="3585461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585465">return</span>&nbsp;<span class="ident" id="3585472">e</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3585475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585479">e</span>&nbsp;<span class="op" id="3585481">=</span>&nbsp;<span class="ident" id="3585483">pt</span><span class="op" id="3585485">.</span><span class="ident" id="3585486">mem</span><span class="op" id="3585489">.</span><span class="ident" id="3585490">WriteWord</span><span class="op" id="3585499">(</span><span class="ident" id="3585500">pt</span><span class="op" id="3585502">.</span><span class="ident" id="3585503">pte2Addr</span><span class="op" id="3585511">,</span>&nbsp;<span class="builtintype" id="3585513">uint32</span><span class="op" id="3585519">(</span><span class="ident" id="3585520">pt</span><span class="op" id="3585522">.</span><span class="ident" id="3585523">pte2</span><span class="op" id="3585527">)</span><span class="op" id="3585528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585531">if</span>&nbsp;<span class="ident" id="3585534">e</span>&nbsp;<span class="op" id="3585536">!=</span>&nbsp;<span class="ident" id="3585539">nil</span>&nbsp;<span class="op" id="3585543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585547">return</span>&nbsp;<span class="ident" id="3585554">e</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3585557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585561">return</span>&nbsp;<span class="ident" id="3585568">nil</span><br>
<span class="lineno"></span><span class="op" id="3585572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="3585575">//&nbsp;TranslateRead&nbsp;translates&nbsp;the&nbsp;address&nbsp;and&nbsp;sets&nbsp;the&nbsp;use&nbsp;bit.</span><br>
<span class="lineno"></span><span class="keyword" id="3585637">func</span>&nbsp;<span class="op" id="3585642">(</span><span class="ident" id="3585643">pt</span>&nbsp;<span class="op" id="3585646">*</span><span class="ident" id="3585647">pageTable</span><span class="op" id="3585656">)</span>&nbsp;<span class="ident" id="3585658">TranslateRead</span><span class="op" id="3585671">(</span><span class="ident" id="3585672">addr</span>&nbsp;<span class="builtintype" id="3585677">uint32</span><span class="op" id="3585683">,</span>&nbsp;<span class="ident" id="3585685">ring</span>&nbsp;<span class="builtintype" id="3585690">byte</span><span class="op" id="3585694">)</span>&nbsp;<span class="op" id="3585696">(</span><span class="builtintype" id="3585697">uint32</span><span class="op" id="3585703">,</span>&nbsp;<span class="op" id="3585705">*</span><span class="ident" id="3585706">Excep</span><span class="op" id="3585711">)</span>&nbsp;<span class="op" id="3585713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585716">ret</span><span class="op" id="3585719">,</span>&nbsp;<span class="ident" id="3585721">e</span>&nbsp;<span class="op" id="3585723">:=</span>&nbsp;<span class="ident" id="3585726">pt</span><span class="op" id="3585728">.</span><span class="ident" id="3585729">Translate</span><span class="op" id="3585738">(</span><span class="ident" id="3585739">addr</span><span class="op" id="3585743">,</span>&nbsp;<span class="ident" id="3585745">ring</span><span class="op" id="3585749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585752">if</span>&nbsp;<span class="ident" id="3585755">e</span>&nbsp;<span class="op" id="3585757">!=</span>&nbsp;<span class="ident" id="3585760">nil</span>&nbsp;<span class="op" id="3585764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585768">return</span>&nbsp;<span class="num" id="3585775">0</span><span class="op" id="3585776">,</span>&nbsp;<span class="ident" id="3585778">e</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3585781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585785">pt</span><span class="op" id="3585787">.</span><span class="ident" id="3585788">pte1</span><span class="op" id="3585792">.</span><span class="ident" id="3585793">setBit</span><span class="op" id="3585799">(</span><span class="ident" id="3585800">pteUse</span><span class="op" id="3585806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585809">pt</span><span class="op" id="3585811">.</span><span class="ident" id="3585812">pte2</span><span class="op" id="3585816">.</span><span class="ident" id="3585817">setBit</span><span class="op" id="3585823">(</span><span class="ident" id="3585824">pteUse</span><span class="op" id="3585830">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585834">e</span>&nbsp;<span class="op" id="3585836">=</span>&nbsp;<span class="ident" id="3585838">pt</span><span class="op" id="3585840">.</span><span class="ident" id="3585841">updatePte</span><span class="op" id="3585850">(</span><span class="op" id="3585851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585854">if</span>&nbsp;<span class="ident" id="3585857">e</span>&nbsp;<span class="op" id="3585859">!=</span>&nbsp;<span class="ident" id="3585862">nil</span>&nbsp;<span class="op" id="3585866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585870">return</span>&nbsp;<span class="num" id="3585877">0</span><span class="op" id="3585878">,</span>&nbsp;<span class="ident" id="3585880">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3585883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3585887">return</span>&nbsp;<span class="ident" id="3585894">ret</span><span class="op" id="3585897">,</span>&nbsp;<span class="ident" id="3585899">nil</span><br>
<span class="lineno"></span><span class="op" id="3585903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3585906">//&nbsp;TranslateWrite&nbsp;translates&nbsp;the&nbsp;address&nbsp;and&nbsp;sets&nbsp;the&nbsp;use&nbsp;and&nbsp;dirty&nbsp;bit</span><br>
<span class="lineno"></span><span class="keyword" id="3585978">func</span>&nbsp;<span class="op" id="3585983">(</span><span class="ident" id="3585984">pt</span>&nbsp;<span class="op" id="3585987">*</span><span class="ident" id="3585988">pageTable</span><span class="op" id="3585997">)</span>&nbsp;<span class="ident" id="3585999">TranslateWrite</span><span class="op" id="3586013">(</span><span class="ident" id="3586014">addr</span>&nbsp;<span class="builtintype" id="3586019">uint32</span><span class="op" id="3586025">,</span>&nbsp;<span class="ident" id="3586027">ring</span>&nbsp;<span class="builtintype" id="3586032">byte</span><span class="op" id="3586036">)</span>&nbsp;<span class="op" id="3586038">(</span><span class="builtintype" id="3586039">uint32</span><span class="op" id="3586045">,</span>&nbsp;<span class="op" id="3586047">*</span><span class="ident" id="3586048">Excep</span><span class="op" id="3586053">)</span>&nbsp;<span class="op" id="3586055">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586058">ret</span><span class="op" id="3586061">,</span>&nbsp;<span class="ident" id="3586063">e</span>&nbsp;<span class="op" id="3586065">:=</span>&nbsp;<span class="ident" id="3586068">pt</span><span class="op" id="3586070">.</span><span class="ident" id="3586071">Translate</span><span class="op" id="3586080">(</span><span class="ident" id="3586081">addr</span><span class="op" id="3586085">,</span>&nbsp;<span class="ident" id="3586087">ring</span><span class="op" id="3586091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586094">if</span>&nbsp;<span class="ident" id="3586097">e</span>&nbsp;<span class="op" id="3586099">!=</span>&nbsp;<span class="ident" id="3586102">nil</span>&nbsp;<span class="op" id="3586106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586110">return</span>&nbsp;<span class="num" id="3586117">0</span><span class="op" id="3586118">,</span>&nbsp;<span class="ident" id="3586120">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586127">if</span>&nbsp;<span class="ident" id="3586130">pt</span><span class="op" id="3586132">.</span><span class="ident" id="3586133">pte1</span><span class="op" id="3586137">.</span><span class="ident" id="3586138">testBit</span><span class="op" id="3586145">(</span><span class="ident" id="3586146">pteReadonly</span><span class="op" id="3586157">)</span>&nbsp;<span class="op" id="3586159">||</span>&nbsp;<span class="ident" id="3586162">pt</span><span class="op" id="3586164">.</span><span class="ident" id="3586165">pte2</span><span class="op" id="3586169">.</span><span class="ident" id="3586170">testBit</span><span class="op" id="3586177">(</span><span class="ident" id="3586178">pteReadonly</span><span class="op" id="3586189">)</span>&nbsp;<span class="op" id="3586191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586195">return</span>&nbsp;<span class="num" id="3586202">0</span><span class="op" id="3586203">,</span>&nbsp;<span class="ident" id="3586205">newPageReadonly</span><span class="op" id="3586220">(</span><span class="ident" id="3586221">addr</span><span class="op" id="3586225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586232">pt</span><span class="op" id="3586234">.</span><span class="ident" id="3586235">pte1</span><span class="op" id="3586239">.</span><span class="ident" id="3586240">setBit</span><span class="op" id="3586246">(</span><span class="ident" id="3586247">pteUse</span><span class="op" id="3586253">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586256">pt</span><span class="op" id="3586258">.</span><span class="ident" id="3586259">pte1</span><span class="op" id="3586263">.</span><span class="ident" id="3586264">setBit</span><span class="op" id="3586270">(</span><span class="ident" id="3586271">pteDirty</span><span class="op" id="3586279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586282">pt</span><span class="op" id="3586284">.</span><span class="ident" id="3586285">pte2</span><span class="op" id="3586289">.</span><span class="ident" id="3586290">setBit</span><span class="op" id="3586296">(</span><span class="ident" id="3586297">pteUse</span><span class="op" id="3586303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586306">pt</span><span class="op" id="3586308">.</span><span class="ident" id="3586309">pte2</span><span class="op" id="3586313">.</span><span class="ident" id="3586314">setBit</span><span class="op" id="3586320">(</span><span class="ident" id="3586321">pteDirty</span><span class="op" id="3586329">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586333">e</span>&nbsp;<span class="op" id="3586335">=</span>&nbsp;<span class="ident" id="3586337">pt</span><span class="op" id="3586339">.</span><span class="ident" id="3586340">updatePte</span><span class="op" id="3586349">(</span><span class="op" id="3586350">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586353">if</span>&nbsp;<span class="ident" id="3586356">e</span>&nbsp;<span class="op" id="3586358">!=</span>&nbsp;<span class="ident" id="3586361">nil</span>&nbsp;<span class="op" id="3586365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586369">return</span>&nbsp;<span class="num" id="3586376">0</span><span class="op" id="3586377">,</span>&nbsp;<span class="ident" id="3586379">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586386">return</span>&nbsp;<span class="ident" id="3586393">ret</span><span class="op" id="3586396">,</span>&nbsp;<span class="ident" id="3586398">nil</span><br>
<span class="lineno">160</span><span class="op" id="3586402">}</span>
</div>
</body>
</html>
