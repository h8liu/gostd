<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1518521">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1518576">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1518630">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1518681">package</span>&nbsp;<span class="ident" id="1518689">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1518698">import</span>&nbsp;<span class="op" id="1518705">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1518708">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1518717">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1518720">func</span>&nbsp;<span class="ident" id="1518725">mapaccess1_fast32</span><span class="op" id="1518742">(</span><span class="ident" id="1518743">t</span>&nbsp;<span class="op" id="1518745">*</span><span class="ident" id="1518746">maptype</span><span class="op" id="1518753">,</span>&nbsp;<span class="ident" id="1518755">h</span>&nbsp;<span class="op" id="1518757">*</span><span class="ident" id="1518758">hmap</span><span class="op" id="1518762">,</span>&nbsp;<span class="ident" id="1518764">key</span>&nbsp;<span class="builtintype" id="1518768">uint32</span><span class="op" id="1518774">)</span>&nbsp;<span class="ident" id="1518776">unsafe</span><span class="op" id="1518782">.</span><span class="ident" id="1518783">Pointer</span>&nbsp;<span class="op" id="1518791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1518794">if</span>&nbsp;<span class="ident" id="1518797">raceenabled</span>&nbsp;<span class="op" id="1518809">&amp;&amp;</span>&nbsp;<span class="ident" id="1518812">h</span>&nbsp;<span class="op" id="1518814">!=</span>&nbsp;<span class="ident" id="1518817">nil</span>&nbsp;<span class="op" id="1518821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1518825">callerpc</span>&nbsp;<span class="op" id="1518834">:=</span>&nbsp;<span class="ident" id="1518837">getcallerpc</span><span class="op" id="1518848">(</span><span class="ident" id="1518849">unsafe</span><span class="op" id="1518855">.</span><span class="ident" id="1518856">Pointer</span><span class="op" id="1518863">(</span><span class="op" id="1518864">&amp;</span><span class="ident" id="1518865">t</span><span class="op" id="1518866">)</span><span class="op" id="1518867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1518871">racereadpc</span><span class="op" id="1518881">(</span><span class="ident" id="1518882">unsafe</span><span class="op" id="1518888">.</span><span class="ident" id="1518889">Pointer</span><span class="op" id="1518896">(</span><span class="ident" id="1518897">h</span><span class="op" id="1518898">)</span><span class="op" id="1518899">,</span>&nbsp;<span class="ident" id="1518901">callerpc</span><span class="op" id="1518909">,</span>&nbsp;<span class="ident" id="1518911">funcPC</span><span class="op" id="1518917">(</span><span class="ident" id="1518918">mapaccess1_fast32</span><span class="op" id="1518935">)</span><span class="op" id="1518936">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1518939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1518942">if</span>&nbsp;<span class="ident" id="1518945">h</span>&nbsp;<span class="op" id="1518947">==</span>&nbsp;<span class="ident" id="1518950">nil</span>&nbsp;<span class="op" id="1518954">||</span>&nbsp;<span class="ident" id="1518957">h</span><span class="op" id="1518958">.</span><span class="ident" id="1518959">count</span>&nbsp;<span class="op" id="1518965">==</span>&nbsp;<span class="num" id="1518968">0</span>&nbsp;<span class="op" id="1518970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1518974">return</span>&nbsp;<span class="ident" id="1518981">unsafe</span><span class="op" id="1518987">.</span><span class="ident" id="1518988">Pointer</span><span class="op" id="1518995">(</span><span class="ident" id="1518996">t</span><span class="op" id="1518997">.</span><span class="ident" id="1518998">elem</span><span class="op" id="1519002">.</span><span class="ident" id="1519003">zero</span><span class="op" id="1519007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1519010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519013">var</span>&nbsp;<span class="ident" id="1519017">b</span>&nbsp;<span class="op" id="1519019">*</span><span class="ident" id="1519020">bmap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519026">if</span>&nbsp;<span class="ident" id="1519029">h</span><span class="op" id="1519030">.</span><span class="ident" id="1519031">B</span>&nbsp;<span class="op" id="1519033">==</span>&nbsp;<span class="num" id="1519036">0</span>&nbsp;<span class="op" id="1519038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1519042">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1519083">b</span>&nbsp;<span class="op" id="1519085">=</span>&nbsp;<span class="op" id="1519087">(</span><span class="op" id="1519088">*</span><span class="ident" id="1519089">bmap</span><span class="op" id="1519093">)</span><span class="op" id="1519094">(</span><span class="ident" id="1519095">h</span><span class="op" id="1519096">.</span><span class="ident" id="1519097">buckets</span><span class="op" id="1519104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1519107">}</span>&nbsp;<span class="keyword" id="1519109">else</span>&nbsp;<span class="op" id="1519114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1519118">hash</span>&nbsp;<span class="op" id="1519123">:=</span>&nbsp;<span class="ident" id="1519126">goalg</span><span class="op" id="1519131">(</span><span class="ident" id="1519132">t</span><span class="op" id="1519133">.</span><span class="ident" id="1519134">key</span><span class="op" id="1519137">.</span><span class="ident" id="1519138">alg</span><span class="op" id="1519141">)</span><span class="op" id="1519142">.</span><span class="ident" id="1519143">hash</span><span class="op" id="1519147">(</span><span class="ident" id="1519148">noescape</span><span class="op" id="1519156">(</span><span class="ident" id="1519157">unsafe</span><span class="op" id="1519163">.</span><span class="ident" id="1519164">Pointer</span><span class="op" id="1519171">(</span><span class="op" id="1519172">&amp;</span><span class="ident" id="1519173">key</span><span class="op" id="1519176">)</span><span class="op" id="1519177">)</span><span class="op" id="1519178">,</span>&nbsp;<span class="num" id="1519180">4</span><span class="op" id="1519181">,</span>&nbsp;<span class="builtintype" id="1519183">uintptr</span><span class="op" id="1519190">(</span><span class="ident" id="1519191">h</span><span class="op" id="1519192">.</span><span class="ident" id="1519193">hash0</span><span class="op" id="1519198">)</span><span class="op" id="1519199">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1519203">m</span>&nbsp;<span class="op" id="1519205">:=</span>&nbsp;<span class="builtintype" id="1519208">uintptr</span><span class="op" id="1519215">(</span><span class="num" id="1519216">1</span><span class="op" id="1519217">)</span><span class="op" id="1519218">&lt;&lt;</span><span class="ident" id="1519220">h</span><span class="op" id="1519221">.</span><span class="ident" id="1519222">B</span>&nbsp;<span class="op" id="1519224">-</span>&nbsp;<span class="num" id="1519226">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1519230">b</span>&nbsp;<span class="op" id="1519232">=</span>&nbsp;<span class="op" id="1519234">(</span><span class="op" id="1519235">*</span><span class="ident" id="1519236">bmap</span><span class="op" id="1519240">)</span><span class="op" id="1519241">(</span><span class="ident" id="1519242">add</span><span class="op" id="1519245">(</span><span class="ident" id="1519246">h</span><span class="op" id="1519247">.</span><span class="ident" id="1519248">buckets</span><span class="op" id="1519255">,</span>&nbsp;<span class="op" id="1519257">(</span><span class="ident" id="1519258">hash</span><span class="op" id="1519262">&amp;</span><span class="ident" id="1519263">m</span><span class="op" id="1519264">)</span><span class="op" id="1519265">*</span><span class="builtintype" id="1519266">uintptr</span><span class="op" id="1519273">(</span><span class="ident" id="1519274">t</span><span class="op" id="1519275">.</span><span class="ident" id="1519276">bucketsize</span><span class="op" id="1519286">)</span><span class="op" id="1519287">)</span><span class="op" id="1519288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519292">if</span>&nbsp;<span class="ident" id="1519295">c</span>&nbsp;<span class="op" id="1519297">:=</span>&nbsp;<span class="ident" id="1519300">h</span><span class="op" id="1519301">.</span><span class="ident" id="1519302">oldbuckets</span><span class="op" id="1519312">;</span>&nbsp;<span class="ident" id="1519314">c</span>&nbsp;<span class="op" id="1519316">!=</span>&nbsp;<span class="ident" id="1519319">nil</span>&nbsp;<span class="op" id="1519323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1519328">oldb</span>&nbsp;<span class="op" id="1519333">:=</span>&nbsp;<span class="op" id="1519336">(</span><span class="op" id="1519337">*</span><span class="ident" id="1519338">bmap</span><span class="op" id="1519342">)</span><span class="op" id="1519343">(</span><span class="ident" id="1519344">add</span><span class="op" id="1519347">(</span><span class="ident" id="1519348">c</span><span class="op" id="1519349">,</span>&nbsp;<span class="op" id="1519351">(</span><span class="ident" id="1519352">hash</span><span class="op" id="1519356">&amp;</span><span class="op" id="1519357">(</span><span class="ident" id="1519358">m</span><span class="op" id="1519359">&gt;&gt;</span><span class="num" id="1519361">1</span><span class="op" id="1519362">)</span><span class="op" id="1519363">)</span><span class="op" id="1519364">*</span><span class="builtintype" id="1519365">uintptr</span><span class="op" id="1519372">(</span><span class="ident" id="1519373">t</span><span class="op" id="1519374">.</span><span class="ident" id="1519375">bucketsize</span><span class="op" id="1519385">)</span><span class="op" id="1519386">)</span><span class="op" id="1519387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519392">if</span>&nbsp;<span class="op" id="1519395">!</span><span class="ident" id="1519396">evacuated</span><span class="op" id="1519405">(</span><span class="ident" id="1519406">oldb</span><span class="op" id="1519410">)</span>&nbsp;<span class="op" id="1519412">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1519418">b</span>&nbsp;<span class="op" id="1519420">=</span>&nbsp;<span class="ident" id="1519422">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1519430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1519434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1519437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519440">for</span>&nbsp;<span class="op" id="1519444">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519448">for</span>&nbsp;<span class="ident" id="1519452">i</span>&nbsp;<span class="op" id="1519454">:=</span>&nbsp;<span class="builtintype" id="1519457">uintptr</span><span class="op" id="1519464">(</span><span class="num" id="1519465">0</span><span class="op" id="1519466">)</span><span class="op" id="1519467">;</span>&nbsp;<span class="ident" id="1519469">i</span>&nbsp;<span class="op" id="1519471">&lt;</span>&nbsp;<span class="ident" id="1519473">bucketCnt</span><span class="op" id="1519482">;</span>&nbsp;<span class="ident" id="1519484">i</span><span class="op" id="1519485">++</span>&nbsp;<span class="op" id="1519488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1519493">k</span>&nbsp;<span class="op" id="1519495">:=</span>&nbsp;<span class="op" id="1519498">*</span><span class="op" id="1519499">(</span><span class="op" id="1519500">(</span><span class="op" id="1519501">*</span><span class="builtintype" id="1519502">uint32</span><span class="op" id="1519508">)</span><span class="op" id="1519509">(</span><span class="ident" id="1519510">add</span><span class="op" id="1519513">(</span><span class="ident" id="1519514">unsafe</span><span class="op" id="1519520">.</span><span class="ident" id="1519521">Pointer</span><span class="op" id="1519528">(</span><span class="ident" id="1519529">b</span><span class="op" id="1519530">)</span><span class="op" id="1519531">,</span>&nbsp;<span class="ident" id="1519533">dataOffset</span><span class="op" id="1519543">+</span><span class="ident" id="1519544">i</span><span class="op" id="1519545">*</span><span class="num" id="1519546">4</span><span class="op" id="1519547">)</span><span class="op" id="1519548">)</span><span class="op" id="1519549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519554">if</span>&nbsp;<span class="ident" id="1519557">k</span>&nbsp;<span class="op" id="1519559">!=</span>&nbsp;<span class="ident" id="1519562">key</span>&nbsp;<span class="op" id="1519566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519572">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1519584">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1519589">x</span>&nbsp;<span class="op" id="1519591">:=</span>&nbsp;<span class="op" id="1519594">*</span><span class="op" id="1519595">(</span><span class="op" id="1519596">(</span><span class="op" id="1519597">*</span><span class="builtintype" id="1519598">uint8</span><span class="op" id="1519603">)</span><span class="op" id="1519604">(</span><span class="ident" id="1519605">add</span><span class="op" id="1519608">(</span><span class="ident" id="1519609">unsafe</span><span class="op" id="1519615">.</span><span class="ident" id="1519616">Pointer</span><span class="op" id="1519623">(</span><span class="ident" id="1519624">b</span><span class="op" id="1519625">)</span><span class="op" id="1519626">,</span>&nbsp;<span class="ident" id="1519628">i</span><span class="op" id="1519629">)</span><span class="op" id="1519630">)</span><span class="op" id="1519631">)</span>&nbsp;<span class="comment" id="1519633">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519677">if</span>&nbsp;<span class="ident" id="1519680">x</span>&nbsp;<span class="op" id="1519682">==</span>&nbsp;<span class="ident" id="1519685">empty</span>&nbsp;<span class="op" id="1519691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519697">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1519709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519714">return</span>&nbsp;<span class="ident" id="1519721">add</span><span class="op" id="1519724">(</span><span class="ident" id="1519725">unsafe</span><span class="op" id="1519731">.</span><span class="ident" id="1519732">Pointer</span><span class="op" id="1519739">(</span><span class="ident" id="1519740">b</span><span class="op" id="1519741">)</span><span class="op" id="1519742">,</span>&nbsp;<span class="ident" id="1519744">dataOffset</span><span class="op" id="1519754">+</span><span class="ident" id="1519755">bucketCnt</span><span class="op" id="1519764">*</span><span class="num" id="1519765">4</span><span class="op" id="1519766">+</span><span class="ident" id="1519767">i</span><span class="op" id="1519768">*</span><span class="builtintype" id="1519769">uintptr</span><span class="op" id="1519776">(</span><span class="ident" id="1519777">t</span><span class="op" id="1519778">.</span><span class="ident" id="1519779">valuesize</span><span class="op" id="1519788">)</span><span class="op" id="1519789">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1519793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1519797">b</span>&nbsp;<span class="op" id="1519799">=</span>&nbsp;<span class="ident" id="1519801">b</span><span class="op" id="1519802">.</span><span class="ident" id="1519803">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519814">if</span>&nbsp;<span class="ident" id="1519817">b</span>&nbsp;<span class="op" id="1519819">==</span>&nbsp;<span class="ident" id="1519822">nil</span>&nbsp;<span class="op" id="1519826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519831">return</span>&nbsp;<span class="ident" id="1519838">unsafe</span><span class="op" id="1519844">.</span><span class="ident" id="1519845">Pointer</span><span class="op" id="1519852">(</span><span class="ident" id="1519853">t</span><span class="op" id="1519854">.</span><span class="ident" id="1519855">elem</span><span class="op" id="1519859">.</span><span class="ident" id="1519860">zero</span><span class="op" id="1519864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1519868">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1519871">}</span><br>
<span class="lineno"></span><span class="op" id="1519873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1519876">func</span>&nbsp;<span class="ident" id="1519881">mapaccess2_fast32</span><span class="op" id="1519898">(</span><span class="ident" id="1519899">t</span>&nbsp;<span class="op" id="1519901">*</span><span class="ident" id="1519902">maptype</span><span class="op" id="1519909">,</span>&nbsp;<span class="ident" id="1519911">h</span>&nbsp;<span class="op" id="1519913">*</span><span class="ident" id="1519914">hmap</span><span class="op" id="1519918">,</span>&nbsp;<span class="ident" id="1519920">key</span>&nbsp;<span class="builtintype" id="1519924">uint32</span><span class="op" id="1519930">)</span>&nbsp;<span class="op" id="1519932">(</span><span class="ident" id="1519933">unsafe</span><span class="op" id="1519939">.</span><span class="ident" id="1519940">Pointer</span><span class="op" id="1519947">,</span>&nbsp;<span class="builtintype" id="1519949">bool</span><span class="op" id="1519953">)</span>&nbsp;<span class="op" id="1519955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1519958">if</span>&nbsp;<span class="ident" id="1519961">raceenabled</span>&nbsp;<span class="op" id="1519973">&amp;&amp;</span>&nbsp;<span class="ident" id="1519976">h</span>&nbsp;<span class="op" id="1519978">!=</span>&nbsp;<span class="ident" id="1519981">nil</span>&nbsp;<span class="op" id="1519985">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1519989">callerpc</span>&nbsp;<span class="op" id="1519998">:=</span>&nbsp;<span class="ident" id="1520001">getcallerpc</span><span class="op" id="1520012">(</span><span class="ident" id="1520013">unsafe</span><span class="op" id="1520019">.</span><span class="ident" id="1520020">Pointer</span><span class="op" id="1520027">(</span><span class="op" id="1520028">&amp;</span><span class="ident" id="1520029">t</span><span class="op" id="1520030">)</span><span class="op" id="1520031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1520035">racereadpc</span><span class="op" id="1520045">(</span><span class="ident" id="1520046">unsafe</span><span class="op" id="1520052">.</span><span class="ident" id="1520053">Pointer</span><span class="op" id="1520060">(</span><span class="ident" id="1520061">h</span><span class="op" id="1520062">)</span><span class="op" id="1520063">,</span>&nbsp;<span class="ident" id="1520065">callerpc</span><span class="op" id="1520073">,</span>&nbsp;<span class="ident" id="1520075">funcPC</span><span class="op" id="1520081">(</span><span class="ident" id="1520082">mapaccess2_fast32</span><span class="op" id="1520099">)</span><span class="op" id="1520100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1520103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520106">if</span>&nbsp;<span class="ident" id="1520109">h</span>&nbsp;<span class="op" id="1520111">==</span>&nbsp;<span class="ident" id="1520114">nil</span>&nbsp;<span class="op" id="1520118">||</span>&nbsp;<span class="ident" id="1520121">h</span><span class="op" id="1520122">.</span><span class="ident" id="1520123">count</span>&nbsp;<span class="op" id="1520129">==</span>&nbsp;<span class="num" id="1520132">0</span>&nbsp;<span class="op" id="1520134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520138">return</span>&nbsp;<span class="ident" id="1520145">unsafe</span><span class="op" id="1520151">.</span><span class="ident" id="1520152">Pointer</span><span class="op" id="1520159">(</span><span class="ident" id="1520160">t</span><span class="op" id="1520161">.</span><span class="ident" id="1520162">elem</span><span class="op" id="1520166">.</span><span class="ident" id="1520167">zero</span><span class="op" id="1520171">)</span><span class="op" id="1520172">,</span>&nbsp;<span class="builtintype" id="1520174">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1520181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520184">var</span>&nbsp;<span class="ident" id="1520188">b</span>&nbsp;<span class="op" id="1520190">*</span><span class="ident" id="1520191">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520197">if</span>&nbsp;<span class="ident" id="1520200">h</span><span class="op" id="1520201">.</span><span class="ident" id="1520202">B</span>&nbsp;<span class="op" id="1520204">==</span>&nbsp;<span class="num" id="1520207">0</span>&nbsp;<span class="op" id="1520209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1520213">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1520254">b</span>&nbsp;<span class="op" id="1520256">=</span>&nbsp;<span class="op" id="1520258">(</span><span class="op" id="1520259">*</span><span class="ident" id="1520260">bmap</span><span class="op" id="1520264">)</span><span class="op" id="1520265">(</span><span class="ident" id="1520266">h</span><span class="op" id="1520267">.</span><span class="ident" id="1520268">buckets</span><span class="op" id="1520275">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1520278">}</span>&nbsp;<span class="keyword" id="1520280">else</span>&nbsp;<span class="op" id="1520285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1520289">hash</span>&nbsp;<span class="op" id="1520294">:=</span>&nbsp;<span class="ident" id="1520297">goalg</span><span class="op" id="1520302">(</span><span class="ident" id="1520303">t</span><span class="op" id="1520304">.</span><span class="ident" id="1520305">key</span><span class="op" id="1520308">.</span><span class="ident" id="1520309">alg</span><span class="op" id="1520312">)</span><span class="op" id="1520313">.</span><span class="ident" id="1520314">hash</span><span class="op" id="1520318">(</span><span class="ident" id="1520319">noescape</span><span class="op" id="1520327">(</span><span class="ident" id="1520328">unsafe</span><span class="op" id="1520334">.</span><span class="ident" id="1520335">Pointer</span><span class="op" id="1520342">(</span><span class="op" id="1520343">&amp;</span><span class="ident" id="1520344">key</span><span class="op" id="1520347">)</span><span class="op" id="1520348">)</span><span class="op" id="1520349">,</span>&nbsp;<span class="num" id="1520351">4</span><span class="op" id="1520352">,</span>&nbsp;<span class="builtintype" id="1520354">uintptr</span><span class="op" id="1520361">(</span><span class="ident" id="1520362">h</span><span class="op" id="1520363">.</span><span class="ident" id="1520364">hash0</span><span class="op" id="1520369">)</span><span class="op" id="1520370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1520374">m</span>&nbsp;<span class="op" id="1520376">:=</span>&nbsp;<span class="builtintype" id="1520379">uintptr</span><span class="op" id="1520386">(</span><span class="num" id="1520387">1</span><span class="op" id="1520388">)</span><span class="op" id="1520389">&lt;&lt;</span><span class="ident" id="1520391">h</span><span class="op" id="1520392">.</span><span class="ident" id="1520393">B</span>&nbsp;<span class="op" id="1520395">-</span>&nbsp;<span class="num" id="1520397">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1520401">b</span>&nbsp;<span class="op" id="1520403">=</span>&nbsp;<span class="op" id="1520405">(</span><span class="op" id="1520406">*</span><span class="ident" id="1520407">bmap</span><span class="op" id="1520411">)</span><span class="op" id="1520412">(</span><span class="ident" id="1520413">add</span><span class="op" id="1520416">(</span><span class="ident" id="1520417">h</span><span class="op" id="1520418">.</span><span class="ident" id="1520419">buckets</span><span class="op" id="1520426">,</span>&nbsp;<span class="op" id="1520428">(</span><span class="ident" id="1520429">hash</span><span class="op" id="1520433">&amp;</span><span class="ident" id="1520434">m</span><span class="op" id="1520435">)</span><span class="op" id="1520436">*</span><span class="builtintype" id="1520437">uintptr</span><span class="op" id="1520444">(</span><span class="ident" id="1520445">t</span><span class="op" id="1520446">.</span><span class="ident" id="1520447">bucketsize</span><span class="op" id="1520457">)</span><span class="op" id="1520458">)</span><span class="op" id="1520459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520463">if</span>&nbsp;<span class="ident" id="1520466">c</span>&nbsp;<span class="op" id="1520468">:=</span>&nbsp;<span class="ident" id="1520471">h</span><span class="op" id="1520472">.</span><span class="ident" id="1520473">oldbuckets</span><span class="op" id="1520483">;</span>&nbsp;<span class="ident" id="1520485">c</span>&nbsp;<span class="op" id="1520487">!=</span>&nbsp;<span class="ident" id="1520490">nil</span>&nbsp;<span class="op" id="1520494">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1520499">oldb</span>&nbsp;<span class="op" id="1520504">:=</span>&nbsp;<span class="op" id="1520507">(</span><span class="op" id="1520508">*</span><span class="ident" id="1520509">bmap</span><span class="op" id="1520513">)</span><span class="op" id="1520514">(</span><span class="ident" id="1520515">add</span><span class="op" id="1520518">(</span><span class="ident" id="1520519">c</span><span class="op" id="1520520">,</span>&nbsp;<span class="op" id="1520522">(</span><span class="ident" id="1520523">hash</span><span class="op" id="1520527">&amp;</span><span class="op" id="1520528">(</span><span class="ident" id="1520529">m</span><span class="op" id="1520530">&gt;&gt;</span><span class="num" id="1520532">1</span><span class="op" id="1520533">)</span><span class="op" id="1520534">)</span><span class="op" id="1520535">*</span><span class="builtintype" id="1520536">uintptr</span><span class="op" id="1520543">(</span><span class="ident" id="1520544">t</span><span class="op" id="1520545">.</span><span class="ident" id="1520546">bucketsize</span><span class="op" id="1520556">)</span><span class="op" id="1520557">)</span><span class="op" id="1520558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520563">if</span>&nbsp;<span class="op" id="1520566">!</span><span class="ident" id="1520567">evacuated</span><span class="op" id="1520576">(</span><span class="ident" id="1520577">oldb</span><span class="op" id="1520581">)</span>&nbsp;<span class="op" id="1520583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1520589">b</span>&nbsp;<span class="op" id="1520591">=</span>&nbsp;<span class="ident" id="1520593">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1520601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1520605">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1520608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520611">for</span>&nbsp;<span class="op" id="1520615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520619">for</span>&nbsp;<span class="ident" id="1520623">i</span>&nbsp;<span class="op" id="1520625">:=</span>&nbsp;<span class="builtintype" id="1520628">uintptr</span><span class="op" id="1520635">(</span><span class="num" id="1520636">0</span><span class="op" id="1520637">)</span><span class="op" id="1520638">;</span>&nbsp;<span class="ident" id="1520640">i</span>&nbsp;<span class="op" id="1520642">&lt;</span>&nbsp;<span class="ident" id="1520644">bucketCnt</span><span class="op" id="1520653">;</span>&nbsp;<span class="ident" id="1520655">i</span><span class="op" id="1520656">++</span>&nbsp;<span class="op" id="1520659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1520664">k</span>&nbsp;<span class="op" id="1520666">:=</span>&nbsp;<span class="op" id="1520669">*</span><span class="op" id="1520670">(</span><span class="op" id="1520671">(</span><span class="op" id="1520672">*</span><span class="builtintype" id="1520673">uint32</span><span class="op" id="1520679">)</span><span class="op" id="1520680">(</span><span class="ident" id="1520681">add</span><span class="op" id="1520684">(</span><span class="ident" id="1520685">unsafe</span><span class="op" id="1520691">.</span><span class="ident" id="1520692">Pointer</span><span class="op" id="1520699">(</span><span class="ident" id="1520700">b</span><span class="op" id="1520701">)</span><span class="op" id="1520702">,</span>&nbsp;<span class="ident" id="1520704">dataOffset</span><span class="op" id="1520714">+</span><span class="ident" id="1520715">i</span><span class="op" id="1520716">*</span><span class="num" id="1520717">4</span><span class="op" id="1520718">)</span><span class="op" id="1520719">)</span><span class="op" id="1520720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520725">if</span>&nbsp;<span class="ident" id="1520728">k</span>&nbsp;<span class="op" id="1520730">!=</span>&nbsp;<span class="ident" id="1520733">key</span>&nbsp;<span class="op" id="1520737">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520743">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1520755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1520760">x</span>&nbsp;<span class="op" id="1520762">:=</span>&nbsp;<span class="op" id="1520765">*</span><span class="op" id="1520766">(</span><span class="op" id="1520767">(</span><span class="op" id="1520768">*</span><span class="builtintype" id="1520769">uint8</span><span class="op" id="1520774">)</span><span class="op" id="1520775">(</span><span class="ident" id="1520776">add</span><span class="op" id="1520779">(</span><span class="ident" id="1520780">unsafe</span><span class="op" id="1520786">.</span><span class="ident" id="1520787">Pointer</span><span class="op" id="1520794">(</span><span class="ident" id="1520795">b</span><span class="op" id="1520796">)</span><span class="op" id="1520797">,</span>&nbsp;<span class="ident" id="1520799">i</span><span class="op" id="1520800">)</span><span class="op" id="1520801">)</span><span class="op" id="1520802">)</span>&nbsp;<span class="comment" id="1520804">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520848">if</span>&nbsp;<span class="ident" id="1520851">x</span>&nbsp;<span class="op" id="1520853">==</span>&nbsp;<span class="ident" id="1520856">empty</span>&nbsp;<span class="op" id="1520862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520868">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1520880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520885">return</span>&nbsp;<span class="ident" id="1520892">add</span><span class="op" id="1520895">(</span><span class="ident" id="1520896">unsafe</span><span class="op" id="1520902">.</span><span class="ident" id="1520903">Pointer</span><span class="op" id="1520910">(</span><span class="ident" id="1520911">b</span><span class="op" id="1520912">)</span><span class="op" id="1520913">,</span>&nbsp;<span class="ident" id="1520915">dataOffset</span><span class="op" id="1520925">+</span><span class="ident" id="1520926">bucketCnt</span><span class="op" id="1520935">*</span><span class="num" id="1520936">4</span><span class="op" id="1520937">+</span><span class="ident" id="1520938">i</span><span class="op" id="1520939">*</span><span class="builtintype" id="1520940">uintptr</span><span class="op" id="1520947">(</span><span class="ident" id="1520948">t</span><span class="op" id="1520949">.</span><span class="ident" id="1520950">valuesize</span><span class="op" id="1520959">)</span><span class="op" id="1520960">)</span><span class="op" id="1520961">,</span>&nbsp;<span class="builtintype" id="1520963">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1520970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1520974">b</span>&nbsp;<span class="op" id="1520976">=</span>&nbsp;<span class="ident" id="1520978">b</span><span class="op" id="1520979">.</span><span class="ident" id="1520980">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1520991">if</span>&nbsp;<span class="ident" id="1520994">b</span>&nbsp;<span class="op" id="1520996">==</span>&nbsp;<span class="ident" id="1520999">nil</span>&nbsp;<span class="op" id="1521003">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1521008">return</span>&nbsp;<span class="ident" id="1521015">unsafe</span><span class="op" id="1521021">.</span><span class="ident" id="1521022">Pointer</span><span class="op" id="1521029">(</span><span class="ident" id="1521030">t</span><span class="op" id="1521031">.</span><span class="ident" id="1521032">elem</span><span class="op" id="1521036">.</span><span class="ident" id="1521037">zero</span><span class="op" id="1521041">)</span><span class="op" id="1521042">,</span>&nbsp;<span class="builtintype" id="1521044">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1521052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1521055">}</span><br>
<span class="lineno"></span><span class="op" id="1521057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="1521060">func</span>&nbsp;<span class="ident" id="1521065">mapaccess1_fast64</span><span class="op" id="1521082">(</span><span class="ident" id="1521083">t</span>&nbsp;<span class="op" id="1521085">*</span><span class="ident" id="1521086">maptype</span><span class="op" id="1521093">,</span>&nbsp;<span class="ident" id="1521095">h</span>&nbsp;<span class="op" id="1521097">*</span><span class="ident" id="1521098">hmap</span><span class="op" id="1521102">,</span>&nbsp;<span class="ident" id="1521104">key</span>&nbsp;<span class="ident" id="1521108">uint64</span><span class="op" id="1521114">)</span>&nbsp;<span class="ident" id="1521116">unsafe</span><span class="op" id="1521122">.</span><span class="ident" id="1521123">Pointer</span>&nbsp;<span class="op" id="1521131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1521134">if</span>&nbsp;<span class="ident" id="1521137">raceenabled</span>&nbsp;<span class="op" id="1521149">&amp;&amp;</span>&nbsp;<span class="ident" id="1521152">h</span>&nbsp;<span class="op" id="1521154">!=</span>&nbsp;<span class="ident" id="1521157">nil</span>&nbsp;<span class="op" id="1521161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1521165">callerpc</span>&nbsp;<span class="op" id="1521174">:=</span>&nbsp;<span class="ident" id="1521177">getcallerpc</span><span class="op" id="1521188">(</span><span class="ident" id="1521189">unsafe</span><span class="op" id="1521195">.</span><span class="ident" id="1521196">Pointer</span><span class="op" id="1521203">(</span><span class="op" id="1521204">&amp;</span><span class="ident" id="1521205">t</span><span class="op" id="1521206">)</span><span class="op" id="1521207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1521211">racereadpc</span><span class="op" id="1521221">(</span><span class="ident" id="1521222">unsafe</span><span class="op" id="1521228">.</span><span class="ident" id="1521229">Pointer</span><span class="op" id="1521236">(</span><span class="ident" id="1521237">h</span><span class="op" id="1521238">)</span><span class="op" id="1521239">,</span>&nbsp;<span class="ident" id="1521241">callerpc</span><span class="op" id="1521249">,</span>&nbsp;<span class="ident" id="1521251">funcPC</span><span class="op" id="1521257">(</span><span class="ident" id="1521258">mapaccess1_fast64</span><span class="op" id="1521275">)</span><span class="op" id="1521276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1521279">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1521282">if</span>&nbsp;<span class="ident" id="1521285">h</span>&nbsp;<span class="op" id="1521287">==</span>&nbsp;<span class="ident" id="1521290">nil</span>&nbsp;<span class="op" id="1521294">||</span>&nbsp;<span class="ident" id="1521297">h</span><span class="op" id="1521298">.</span><span class="ident" id="1521299">count</span>&nbsp;<span class="op" id="1521305">==</span>&nbsp;<span class="num" id="1521308">0</span>&nbsp;<span class="op" id="1521310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1521314">return</span>&nbsp;<span class="ident" id="1521321">unsafe</span><span class="op" id="1521327">.</span><span class="ident" id="1521328">Pointer</span><span class="op" id="1521335">(</span><span class="ident" id="1521336">t</span><span class="op" id="1521337">.</span><span class="ident" id="1521338">elem</span><span class="op" id="1521342">.</span><span class="ident" id="1521343">zero</span><span class="op" id="1521347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1521350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1521353">var</span>&nbsp;<span class="ident" id="1521357">b</span>&nbsp;<span class="op" id="1521359">*</span><span class="ident" id="1521360">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1521366">if</span>&nbsp;<span class="ident" id="1521369">h</span><span class="op" id="1521370">.</span><span class="ident" id="1521371">B</span>&nbsp;<span class="op" id="1521373">==</span>&nbsp;<span class="num" id="1521376">0</span>&nbsp;<span class="op" id="1521378">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1521382">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1521423">b</span>&nbsp;<span class="op" id="1521425">=</span>&nbsp;<span class="op" id="1521427">(</span><span class="op" id="1521428">*</span><span class="ident" id="1521429">bmap</span><span class="op" id="1521433">)</span><span class="op" id="1521434">(</span><span class="ident" id="1521435">h</span><span class="op" id="1521436">.</span><span class="ident" id="1521437">buckets</span><span class="op" id="1521444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1521447">}</span>&nbsp;<span class="keyword" id="1521449">else</span>&nbsp;<span class="op" id="1521454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1521458">hash</span>&nbsp;<span class="op" id="1521463">:=</span>&nbsp;<span class="ident" id="1521466">goalg</span><span class="op" id="1521471">(</span><span class="ident" id="1521472">t</span><span class="op" id="1521473">.</span><span class="ident" id="1521474">key</span><span class="op" id="1521477">.</span><span class="ident" id="1521478">alg</span><span class="op" id="1521481">)</span><span class="op" id="1521482">.</span><span class="ident" id="1521483">hash</span><span class="op" id="1521487">(</span><span class="ident" id="1521488">noescape</span><span class="op" id="1521496">(</span><span class="ident" id="1521497">unsafe</span><span class="op" id="1521503">.</span><span class="ident" id="1521504">Pointer</span><span class="op" id="1521511">(</span><span class="op" id="1521512">&amp;</span><span class="ident" id="1521513">key</span><span class="op" id="1521516">)</span><span class="op" id="1521517">)</span><span class="op" id="1521518">,</span>&nbsp;<span class="num" id="1521520">8</span><span class="op" id="1521521">,</span>&nbsp;<span class="builtintype" id="1521523">uintptr</span><span class="op" id="1521530">(</span><span class="ident" id="1521531">h</span><span class="op" id="1521532">.</span><span class="ident" id="1521533">hash0</span><span class="op" id="1521538">)</span><span class="op" id="1521539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1521543">m</span>&nbsp;<span class="op" id="1521545">:=</span>&nbsp;<span class="builtintype" id="1521548">uintptr</span><span class="op" id="1521555">(</span><span class="num" id="1521556">1</span><span class="op" id="1521557">)</span><span class="op" id="1521558">&lt;&lt;</span><span class="ident" id="1521560">h</span><span class="op" id="1521561">.</span><span class="ident" id="1521562">B</span>&nbsp;<span class="op" id="1521564">-</span>&nbsp;<span class="num" id="1521566">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1521570">b</span>&nbsp;<span class="op" id="1521572">=</span>&nbsp;<span class="op" id="1521574">(</span><span class="op" id="1521575">*</span><span class="ident" id="1521576">bmap</span><span class="op" id="1521580">)</span><span class="op" id="1521581">(</span><span class="ident" id="1521582">add</span><span class="op" id="1521585">(</span><span class="ident" id="1521586">h</span><span class="op" id="1521587">.</span><span class="ident" id="1521588">buckets</span><span class="op" id="1521595">,</span>&nbsp;<span class="op" id="1521597">(</span><span class="ident" id="1521598">hash</span><span class="op" id="1521602">&amp;</span><span class="ident" id="1521603">m</span><span class="op" id="1521604">)</span><span class="op" id="1521605">*</span><span class="builtintype" id="1521606">uintptr</span><span class="op" id="1521613">(</span><span class="ident" id="1521614">t</span><span class="op" id="1521615">.</span><span class="ident" id="1521616">bucketsize</span><span class="op" id="1521626">)</span><span class="op" id="1521627">)</span><span class="op" id="1521628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1521632">if</span>&nbsp;<span class="ident" id="1521635">c</span>&nbsp;<span class="op" id="1521637">:=</span>&nbsp;<span class="ident" id="1521640">h</span><span class="op" id="1521641">.</span><span class="ident" id="1521642">oldbuckets</span><span class="op" id="1521652">;</span>&nbsp;<span class="ident" id="1521654">c</span>&nbsp;<span class="op" id="1521656">!=</span>&nbsp;<span class="ident" id="1521659">nil</span>&nbsp;<span class="op" id="1521663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1521668">oldb</span>&nbsp;<span class="op" id="1521673">:=</span>&nbsp;<span class="op" id="1521676">(</span><span class="op" id="1521677">*</span><span class="ident" id="1521678">bmap</span><span class="op" id="1521682">)</span><span class="op" id="1521683">(</span><span class="ident" id="1521684">add</span><span class="op" id="1521687">(</span><span class="ident" id="1521688">c</span><span class="op" id="1521689">,</span>&nbsp;<span class="op" id="1521691">(</span><span class="ident" id="1521692">hash</span><span class="op" id="1521696">&amp;</span><span class="op" id="1521697">(</span><span class="ident" id="1521698">m</span><span class="op" id="1521699">&gt;&gt;</span><span class="num" id="1521701">1</span><span class="op" id="1521702">)</span><span class="op" id="1521703">)</span><span class="op" id="1521704">*</span><span class="builtintype" id="1521705">uintptr</span><span class="op" id="1521712">(</span><span class="ident" id="1521713">t</span><span class="op" id="1521714">.</span><span class="ident" id="1521715">bucketsize</span><span class="op" id="1521725">)</span><span class="op" id="1521726">)</span><span class="op" id="1521727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1521732">if</span>&nbsp;<span class="op" id="1521735">!</span><span class="ident" id="1521736">evacuated</span><span class="op" id="1521745">(</span><span class="ident" id="1521746">oldb</span><span class="op" id="1521750">)</span>&nbsp;<span class="op" id="1521752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1521758">b</span>&nbsp;<span class="op" id="1521760">=</span>&nbsp;<span class="ident" id="1521762">oldb</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1521770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1521774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1521777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1521780">for</span>&nbsp;<span class="op" id="1521784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1521788">for</span>&nbsp;<span class="ident" id="1521792">i</span>&nbsp;<span class="op" id="1521794">:=</span>&nbsp;<span class="builtintype" id="1521797">uintptr</span><span class="op" id="1521804">(</span><span class="num" id="1521805">0</span><span class="op" id="1521806">)</span><span class="op" id="1521807">;</span>&nbsp;<span class="ident" id="1521809">i</span>&nbsp;<span class="op" id="1521811">&lt;</span>&nbsp;<span class="ident" id="1521813">bucketCnt</span><span class="op" id="1521822">;</span>&nbsp;<span class="ident" id="1521824">i</span><span class="op" id="1521825">++</span>&nbsp;<span class="op" id="1521828">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1521833">k</span>&nbsp;<span class="op" id="1521835">:=</span>&nbsp;<span class="op" id="1521838">*</span><span class="op" id="1521839">(</span><span class="op" id="1521840">(</span><span class="op" id="1521841">*</span><span class="ident" id="1521842">uint64</span><span class="op" id="1521848">)</span><span class="op" id="1521849">(</span><span class="ident" id="1521850">add</span><span class="op" id="1521853">(</span><span class="ident" id="1521854">unsafe</span><span class="op" id="1521860">.</span><span class="ident" id="1521861">Pointer</span><span class="op" id="1521868">(</span><span class="ident" id="1521869">b</span><span class="op" id="1521870">)</span><span class="op" id="1521871">,</span>&nbsp;<span class="ident" id="1521873">dataOffset</span><span class="op" id="1521883">+</span><span class="ident" id="1521884">i</span><span class="op" id="1521885">*</span><span class="num" id="1521886">8</span><span class="op" id="1521887">)</span><span class="op" id="1521888">)</span><span class="op" id="1521889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1521894">if</span>&nbsp;<span class="ident" id="1521897">k</span>&nbsp;<span class="op" id="1521899">!=</span>&nbsp;<span class="ident" id="1521902">key</span>&nbsp;<span class="op" id="1521906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1521912">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1521924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1521929">x</span>&nbsp;<span class="op" id="1521931">:=</span>&nbsp;<span class="op" id="1521934">*</span><span class="op" id="1521935">(</span><span class="op" id="1521936">(</span><span class="op" id="1521937">*</span><span class="builtintype" id="1521938">uint8</span><span class="op" id="1521943">)</span><span class="op" id="1521944">(</span><span class="ident" id="1521945">add</span><span class="op" id="1521948">(</span><span class="ident" id="1521949">unsafe</span><span class="op" id="1521955">.</span><span class="ident" id="1521956">Pointer</span><span class="op" id="1521963">(</span><span class="ident" id="1521964">b</span><span class="op" id="1521965">)</span><span class="op" id="1521966">,</span>&nbsp;<span class="ident" id="1521968">i</span><span class="op" id="1521969">)</span><span class="op" id="1521970">)</span><span class="op" id="1521971">)</span>&nbsp;<span class="comment" id="1521973">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522017">if</span>&nbsp;<span class="ident" id="1522020">x</span>&nbsp;<span class="op" id="1522022">==</span>&nbsp;<span class="ident" id="1522025">empty</span>&nbsp;<span class="op" id="1522031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522037">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1522049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522054">return</span>&nbsp;<span class="ident" id="1522061">add</span><span class="op" id="1522064">(</span><span class="ident" id="1522065">unsafe</span><span class="op" id="1522071">.</span><span class="ident" id="1522072">Pointer</span><span class="op" id="1522079">(</span><span class="ident" id="1522080">b</span><span class="op" id="1522081">)</span><span class="op" id="1522082">,</span>&nbsp;<span class="ident" id="1522084">dataOffset</span><span class="op" id="1522094">+</span><span class="ident" id="1522095">bucketCnt</span><span class="op" id="1522104">*</span><span class="num" id="1522105">8</span><span class="op" id="1522106">+</span><span class="ident" id="1522107">i</span><span class="op" id="1522108">*</span><span class="builtintype" id="1522109">uintptr</span><span class="op" id="1522116">(</span><span class="ident" id="1522117">t</span><span class="op" id="1522118">.</span><span class="ident" id="1522119">valuesize</span><span class="op" id="1522128">)</span><span class="op" id="1522129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1522133">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1522137">b</span>&nbsp;<span class="op" id="1522139">=</span>&nbsp;<span class="ident" id="1522141">b</span><span class="op" id="1522142">.</span><span class="ident" id="1522143">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522154">if</span>&nbsp;<span class="ident" id="1522157">b</span>&nbsp;<span class="op" id="1522159">==</span>&nbsp;<span class="ident" id="1522162">nil</span>&nbsp;<span class="op" id="1522166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522171">return</span>&nbsp;<span class="ident" id="1522178">unsafe</span><span class="op" id="1522184">.</span><span class="ident" id="1522185">Pointer</span><span class="op" id="1522192">(</span><span class="ident" id="1522193">t</span><span class="op" id="1522194">.</span><span class="ident" id="1522195">elem</span><span class="op" id="1522199">.</span><span class="ident" id="1522200">zero</span><span class="op" id="1522204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1522208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1522211">}</span><br>
<span class="lineno">135</span><span class="op" id="1522213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1522216">func</span>&nbsp;<span class="ident" id="1522221">mapaccess2_fast64</span><span class="op" id="1522238">(</span><span class="ident" id="1522239">t</span>&nbsp;<span class="op" id="1522241">*</span><span class="ident" id="1522242">maptype</span><span class="op" id="1522249">,</span>&nbsp;<span class="ident" id="1522251">h</span>&nbsp;<span class="op" id="1522253">*</span><span class="ident" id="1522254">hmap</span><span class="op" id="1522258">,</span>&nbsp;<span class="ident" id="1522260">key</span>&nbsp;<span class="ident" id="1522264">uint64</span><span class="op" id="1522270">)</span>&nbsp;<span class="op" id="1522272">(</span><span class="ident" id="1522273">unsafe</span><span class="op" id="1522279">.</span><span class="ident" id="1522280">Pointer</span><span class="op" id="1522287">,</span>&nbsp;<span class="builtintype" id="1522289">bool</span><span class="op" id="1522293">)</span>&nbsp;<span class="op" id="1522295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522298">if</span>&nbsp;<span class="ident" id="1522301">raceenabled</span>&nbsp;<span class="op" id="1522313">&amp;&amp;</span>&nbsp;<span class="ident" id="1522316">h</span>&nbsp;<span class="op" id="1522318">!=</span>&nbsp;<span class="ident" id="1522321">nil</span>&nbsp;<span class="op" id="1522325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1522329">callerpc</span>&nbsp;<span class="op" id="1522338">:=</span>&nbsp;<span class="ident" id="1522341">getcallerpc</span><span class="op" id="1522352">(</span><span class="ident" id="1522353">unsafe</span><span class="op" id="1522359">.</span><span class="ident" id="1522360">Pointer</span><span class="op" id="1522367">(</span><span class="op" id="1522368">&amp;</span><span class="ident" id="1522369">t</span><span class="op" id="1522370">)</span><span class="op" id="1522371">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1522375">racereadpc</span><span class="op" id="1522385">(</span><span class="ident" id="1522386">unsafe</span><span class="op" id="1522392">.</span><span class="ident" id="1522393">Pointer</span><span class="op" id="1522400">(</span><span class="ident" id="1522401">h</span><span class="op" id="1522402">)</span><span class="op" id="1522403">,</span>&nbsp;<span class="ident" id="1522405">callerpc</span><span class="op" id="1522413">,</span>&nbsp;<span class="ident" id="1522415">funcPC</span><span class="op" id="1522421">(</span><span class="ident" id="1522422">mapaccess2_fast64</span><span class="op" id="1522439">)</span><span class="op" id="1522440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1522443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522446">if</span>&nbsp;<span class="ident" id="1522449">h</span>&nbsp;<span class="op" id="1522451">==</span>&nbsp;<span class="ident" id="1522454">nil</span>&nbsp;<span class="op" id="1522458">||</span>&nbsp;<span class="ident" id="1522461">h</span><span class="op" id="1522462">.</span><span class="ident" id="1522463">count</span>&nbsp;<span class="op" id="1522469">==</span>&nbsp;<span class="num" id="1522472">0</span>&nbsp;<span class="op" id="1522474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522478">return</span>&nbsp;<span class="ident" id="1522485">unsafe</span><span class="op" id="1522491">.</span><span class="ident" id="1522492">Pointer</span><span class="op" id="1522499">(</span><span class="ident" id="1522500">t</span><span class="op" id="1522501">.</span><span class="ident" id="1522502">elem</span><span class="op" id="1522506">.</span><span class="ident" id="1522507">zero</span><span class="op" id="1522511">)</span><span class="op" id="1522512">,</span>&nbsp;<span class="builtintype" id="1522514">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1522521">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522524">var</span>&nbsp;<span class="ident" id="1522528">b</span>&nbsp;<span class="op" id="1522530">*</span><span class="ident" id="1522531">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522537">if</span>&nbsp;<span class="ident" id="1522540">h</span><span class="op" id="1522541">.</span><span class="ident" id="1522542">B</span>&nbsp;<span class="op" id="1522544">==</span>&nbsp;<span class="num" id="1522547">0</span>&nbsp;<span class="op" id="1522549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1522553">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1522594">b</span>&nbsp;<span class="op" id="1522596">=</span>&nbsp;<span class="op" id="1522598">(</span><span class="op" id="1522599">*</span><span class="ident" id="1522600">bmap</span><span class="op" id="1522604">)</span><span class="op" id="1522605">(</span><span class="ident" id="1522606">h</span><span class="op" id="1522607">.</span><span class="ident" id="1522608">buckets</span><span class="op" id="1522615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1522618">}</span>&nbsp;<span class="keyword" id="1522620">else</span>&nbsp;<span class="op" id="1522625">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1522629">hash</span>&nbsp;<span class="op" id="1522634">:=</span>&nbsp;<span class="ident" id="1522637">goalg</span><span class="op" id="1522642">(</span><span class="ident" id="1522643">t</span><span class="op" id="1522644">.</span><span class="ident" id="1522645">key</span><span class="op" id="1522648">.</span><span class="ident" id="1522649">alg</span><span class="op" id="1522652">)</span><span class="op" id="1522653">.</span><span class="ident" id="1522654">hash</span><span class="op" id="1522658">(</span><span class="ident" id="1522659">noescape</span><span class="op" id="1522667">(</span><span class="ident" id="1522668">unsafe</span><span class="op" id="1522674">.</span><span class="ident" id="1522675">Pointer</span><span class="op" id="1522682">(</span><span class="op" id="1522683">&amp;</span><span class="ident" id="1522684">key</span><span class="op" id="1522687">)</span><span class="op" id="1522688">)</span><span class="op" id="1522689">,</span>&nbsp;<span class="num" id="1522691">8</span><span class="op" id="1522692">,</span>&nbsp;<span class="builtintype" id="1522694">uintptr</span><span class="op" id="1522701">(</span><span class="ident" id="1522702">h</span><span class="op" id="1522703">.</span><span class="ident" id="1522704">hash0</span><span class="op" id="1522709">)</span><span class="op" id="1522710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1522714">m</span>&nbsp;<span class="op" id="1522716">:=</span>&nbsp;<span class="builtintype" id="1522719">uintptr</span><span class="op" id="1522726">(</span><span class="num" id="1522727">1</span><span class="op" id="1522728">)</span><span class="op" id="1522729">&lt;&lt;</span><span class="ident" id="1522731">h</span><span class="op" id="1522732">.</span><span class="ident" id="1522733">B</span>&nbsp;<span class="op" id="1522735">-</span>&nbsp;<span class="num" id="1522737">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1522741">b</span>&nbsp;<span class="op" id="1522743">=</span>&nbsp;<span class="op" id="1522745">(</span><span class="op" id="1522746">*</span><span class="ident" id="1522747">bmap</span><span class="op" id="1522751">)</span><span class="op" id="1522752">(</span><span class="ident" id="1522753">add</span><span class="op" id="1522756">(</span><span class="ident" id="1522757">h</span><span class="op" id="1522758">.</span><span class="ident" id="1522759">buckets</span><span class="op" id="1522766">,</span>&nbsp;<span class="op" id="1522768">(</span><span class="ident" id="1522769">hash</span><span class="op" id="1522773">&amp;</span><span class="ident" id="1522774">m</span><span class="op" id="1522775">)</span><span class="op" id="1522776">*</span><span class="builtintype" id="1522777">uintptr</span><span class="op" id="1522784">(</span><span class="ident" id="1522785">t</span><span class="op" id="1522786">.</span><span class="ident" id="1522787">bucketsize</span><span class="op" id="1522797">)</span><span class="op" id="1522798">)</span><span class="op" id="1522799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522803">if</span>&nbsp;<span class="ident" id="1522806">c</span>&nbsp;<span class="op" id="1522808">:=</span>&nbsp;<span class="ident" id="1522811">h</span><span class="op" id="1522812">.</span><span class="ident" id="1522813">oldbuckets</span><span class="op" id="1522823">;</span>&nbsp;<span class="ident" id="1522825">c</span>&nbsp;<span class="op" id="1522827">!=</span>&nbsp;<span class="ident" id="1522830">nil</span>&nbsp;<span class="op" id="1522834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1522839">oldb</span>&nbsp;<span class="op" id="1522844">:=</span>&nbsp;<span class="op" id="1522847">(</span><span class="op" id="1522848">*</span><span class="ident" id="1522849">bmap</span><span class="op" id="1522853">)</span><span class="op" id="1522854">(</span><span class="ident" id="1522855">add</span><span class="op" id="1522858">(</span><span class="ident" id="1522859">c</span><span class="op" id="1522860">,</span>&nbsp;<span class="op" id="1522862">(</span><span class="ident" id="1522863">hash</span><span class="op" id="1522867">&amp;</span><span class="op" id="1522868">(</span><span class="ident" id="1522869">m</span><span class="op" id="1522870">&gt;&gt;</span><span class="num" id="1522872">1</span><span class="op" id="1522873">)</span><span class="op" id="1522874">)</span><span class="op" id="1522875">*</span><span class="builtintype" id="1522876">uintptr</span><span class="op" id="1522883">(</span><span class="ident" id="1522884">t</span><span class="op" id="1522885">.</span><span class="ident" id="1522886">bucketsize</span><span class="op" id="1522896">)</span><span class="op" id="1522897">)</span><span class="op" id="1522898">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522903">if</span>&nbsp;<span class="op" id="1522906">!</span><span class="ident" id="1522907">evacuated</span><span class="op" id="1522916">(</span><span class="ident" id="1522917">oldb</span><span class="op" id="1522921">)</span>&nbsp;<span class="op" id="1522923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1522929">b</span>&nbsp;<span class="op" id="1522931">=</span>&nbsp;<span class="ident" id="1522933">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1522941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1522945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1522948">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522951">for</span>&nbsp;<span class="op" id="1522955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1522959">for</span>&nbsp;<span class="ident" id="1522963">i</span>&nbsp;<span class="op" id="1522965">:=</span>&nbsp;<span class="builtintype" id="1522968">uintptr</span><span class="op" id="1522975">(</span><span class="num" id="1522976">0</span><span class="op" id="1522977">)</span><span class="op" id="1522978">;</span>&nbsp;<span class="ident" id="1522980">i</span>&nbsp;<span class="op" id="1522982">&lt;</span>&nbsp;<span class="ident" id="1522984">bucketCnt</span><span class="op" id="1522993">;</span>&nbsp;<span class="ident" id="1522995">i</span><span class="op" id="1522996">++</span>&nbsp;<span class="op" id="1522999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1523004">k</span>&nbsp;<span class="op" id="1523006">:=</span>&nbsp;<span class="op" id="1523009">*</span><span class="op" id="1523010">(</span><span class="op" id="1523011">(</span><span class="op" id="1523012">*</span><span class="ident" id="1523013">uint64</span><span class="op" id="1523019">)</span><span class="op" id="1523020">(</span><span class="ident" id="1523021">add</span><span class="op" id="1523024">(</span><span class="ident" id="1523025">unsafe</span><span class="op" id="1523031">.</span><span class="ident" id="1523032">Pointer</span><span class="op" id="1523039">(</span><span class="ident" id="1523040">b</span><span class="op" id="1523041">)</span><span class="op" id="1523042">,</span>&nbsp;<span class="ident" id="1523044">dataOffset</span><span class="op" id="1523054">+</span><span class="ident" id="1523055">i</span><span class="op" id="1523056">*</span><span class="num" id="1523057">8</span><span class="op" id="1523058">)</span><span class="op" id="1523059">)</span><span class="op" id="1523060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1523065">if</span>&nbsp;<span class="ident" id="1523068">k</span>&nbsp;<span class="op" id="1523070">!=</span>&nbsp;<span class="ident" id="1523073">key</span>&nbsp;<span class="op" id="1523077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1523083">continue</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1523095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1523100">x</span>&nbsp;<span class="op" id="1523102">:=</span>&nbsp;<span class="op" id="1523105">*</span><span class="op" id="1523106">(</span><span class="op" id="1523107">(</span><span class="op" id="1523108">*</span><span class="builtintype" id="1523109">uint8</span><span class="op" id="1523114">)</span><span class="op" id="1523115">(</span><span class="ident" id="1523116">add</span><span class="op" id="1523119">(</span><span class="ident" id="1523120">unsafe</span><span class="op" id="1523126">.</span><span class="ident" id="1523127">Pointer</span><span class="op" id="1523134">(</span><span class="ident" id="1523135">b</span><span class="op" id="1523136">)</span><span class="op" id="1523137">,</span>&nbsp;<span class="ident" id="1523139">i</span><span class="op" id="1523140">)</span><span class="op" id="1523141">)</span><span class="op" id="1523142">)</span>&nbsp;<span class="comment" id="1523144">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1523188">if</span>&nbsp;<span class="ident" id="1523191">x</span>&nbsp;<span class="op" id="1523193">==</span>&nbsp;<span class="ident" id="1523196">empty</span>&nbsp;<span class="op" id="1523202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1523208">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1523220">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1523225">return</span>&nbsp;<span class="ident" id="1523232">add</span><span class="op" id="1523235">(</span><span class="ident" id="1523236">unsafe</span><span class="op" id="1523242">.</span><span class="ident" id="1523243">Pointer</span><span class="op" id="1523250">(</span><span class="ident" id="1523251">b</span><span class="op" id="1523252">)</span><span class="op" id="1523253">,</span>&nbsp;<span class="ident" id="1523255">dataOffset</span><span class="op" id="1523265">+</span><span class="ident" id="1523266">bucketCnt</span><span class="op" id="1523275">*</span><span class="num" id="1523276">8</span><span class="op" id="1523277">+</span><span class="ident" id="1523278">i</span><span class="op" id="1523279">*</span><span class="builtintype" id="1523280">uintptr</span><span class="op" id="1523287">(</span><span class="ident" id="1523288">t</span><span class="op" id="1523289">.</span><span class="ident" id="1523290">valuesize</span><span class="op" id="1523299">)</span><span class="op" id="1523300">)</span><span class="op" id="1523301">,</span>&nbsp;<span class="builtintype" id="1523303">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1523310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1523314">b</span>&nbsp;<span class="op" id="1523316">=</span>&nbsp;<span class="ident" id="1523318">b</span><span class="op" id="1523319">.</span><span class="ident" id="1523320">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1523331">if</span>&nbsp;<span class="ident" id="1523334">b</span>&nbsp;<span class="op" id="1523336">==</span>&nbsp;<span class="ident" id="1523339">nil</span>&nbsp;<span class="op" id="1523343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1523348">return</span>&nbsp;<span class="ident" id="1523355">unsafe</span><span class="op" id="1523361">.</span><span class="ident" id="1523362">Pointer</span><span class="op" id="1523369">(</span><span class="ident" id="1523370">t</span><span class="op" id="1523371">.</span><span class="ident" id="1523372">elem</span><span class="op" id="1523376">.</span><span class="ident" id="1523377">zero</span><span class="op" id="1523381">)</span><span class="op" id="1523382">,</span>&nbsp;<span class="builtintype" id="1523384">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1523392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1523395">}</span><br>
<span class="lineno"></span><span class="op" id="1523397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1523400">func</span>&nbsp;<span class="ident" id="1523405">mapaccess1_faststr</span><span class="op" id="1523423">(</span><span class="ident" id="1523424">t</span>&nbsp;<span class="op" id="1523426">*</span><span class="ident" id="1523427">maptype</span><span class="op" id="1523434">,</span>&nbsp;<span class="ident" id="1523436">h</span>&nbsp;<span class="op" id="1523438">*</span><span class="ident" id="1523439">hmap</span><span class="op" id="1523443">,</span>&nbsp;<span class="ident" id="1523445">ky</span>&nbsp;<span class="builtintype" id="1523448">string</span><span class="op" id="1523454">)</span>&nbsp;<span class="ident" id="1523456">unsafe</span><span class="op" id="1523462">.</span><span class="ident" id="1523463">Pointer</span>&nbsp;<span class="op" id="1523471">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1523474">if</span>&nbsp;<span class="ident" id="1523477">raceenabled</span>&nbsp;<span class="op" id="1523489">&amp;&amp;</span>&nbsp;<span class="ident" id="1523492">h</span>&nbsp;<span class="op" id="1523494">!=</span>&nbsp;<span class="ident" id="1523497">nil</span>&nbsp;<span class="op" id="1523501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1523505">callerpc</span>&nbsp;<span class="op" id="1523514">:=</span>&nbsp;<span class="ident" id="1523517">getcallerpc</span><span class="op" id="1523528">(</span><span class="ident" id="1523529">unsafe</span><span class="op" id="1523535">.</span><span class="ident" id="1523536">Pointer</span><span class="op" id="1523543">(</span><span class="op" id="1523544">&amp;</span><span class="ident" id="1523545">t</span><span class="op" id="1523546">)</span><span class="op" id="1523547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1523551">racereadpc</span><span class="op" id="1523561">(</span><span class="ident" id="1523562">unsafe</span><span class="op" id="1523568">.</span><span class="ident" id="1523569">Pointer</span><span class="op" id="1523576">(</span><span class="ident" id="1523577">h</span><span class="op" id="1523578">)</span><span class="op" id="1523579">,</span>&nbsp;<span class="ident" id="1523581">callerpc</span><span class="op" id="1523589">,</span>&nbsp;<span class="ident" id="1523591">funcPC</span><span class="op" id="1523597">(</span><span class="ident" id="1523598">mapaccess1_faststr</span><span class="op" id="1523616">)</span><span class="op" id="1523617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1523620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1523623">if</span>&nbsp;<span class="ident" id="1523626">h</span>&nbsp;<span class="op" id="1523628">==</span>&nbsp;<span class="ident" id="1523631">nil</span>&nbsp;<span class="op" id="1523635">||</span>&nbsp;<span class="ident" id="1523638">h</span><span class="op" id="1523639">.</span><span class="ident" id="1523640">count</span>&nbsp;<span class="op" id="1523646">==</span>&nbsp;<span class="num" id="1523649">0</span>&nbsp;<span class="op" id="1523651">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1523655">return</span>&nbsp;<span class="ident" id="1523662">unsafe</span><span class="op" id="1523668">.</span><span class="ident" id="1523669">Pointer</span><span class="op" id="1523676">(</span><span class="ident" id="1523677">t</span><span class="op" id="1523678">.</span><span class="ident" id="1523679">elem</span><span class="op" id="1523683">.</span><span class="ident" id="1523684">zero</span><span class="op" id="1523688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1523691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1523694">key</span>&nbsp;<span class="op" id="1523698">:=</span>&nbsp;<span class="op" id="1523701">(</span><span class="op" id="1523702">*</span><span class="ident" id="1523703">stringStruct</span><span class="op" id="1523715">)</span><span class="op" id="1523716">(</span><span class="ident" id="1523717">unsafe</span><span class="op" id="1523723">.</span><span class="ident" id="1523724">Pointer</span><span class="op" id="1523731">(</span><span class="op" id="1523732">&amp;</span><span class="ident" id="1523733">ky</span><span class="op" id="1523735">)</span><span class="op" id="1523736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1523739">if</span>&nbsp;<span class="ident" id="1523742">h</span><span class="op" id="1523743">.</span><span class="ident" id="1523744">B</span>&nbsp;<span class="op" id="1523746">==</span>&nbsp;<span class="num" id="1523749">0</span>&nbsp;<span class="op" id="1523751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1523755">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1523778">b</span>&nbsp;<span class="op" id="1523780">:=</span>&nbsp;<span class="op" id="1523783">(</span><span class="op" id="1523784">*</span><span class="ident" id="1523785">bmap</span><span class="op" id="1523789">)</span><span class="op" id="1523790">(</span><span class="ident" id="1523791">h</span><span class="op" id="1523792">.</span><span class="ident" id="1523793">buckets</span><span class="op" id="1523800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1523804">if</span>&nbsp;<span class="ident" id="1523807">key</span><span class="op" id="1523810">.</span><span class="builtinfunc" id="1523811">len</span>&nbsp;<span class="op" id="1523815">&lt;</span>&nbsp;<span class="num" id="1523817">32</span>&nbsp;<span class="op" id="1523820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1523825">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1523874">for</span>&nbsp;<span class="ident" id="1523878">i</span>&nbsp;<span class="op" id="1523880">:=</span>&nbsp;<span class="builtintype" id="1523883">uintptr</span><span class="op" id="1523890">(</span><span class="num" id="1523891">0</span><span class="op" id="1523892">)</span><span class="op" id="1523893">;</span>&nbsp;<span class="ident" id="1523895">i</span>&nbsp;<span class="op" id="1523897">&lt;</span>&nbsp;<span class="ident" id="1523899">bucketCnt</span><span class="op" id="1523908">;</span>&nbsp;<span class="ident" id="1523910">i</span><span class="op" id="1523911">++</span>&nbsp;<span class="op" id="1523914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1523920">x</span>&nbsp;<span class="op" id="1523922">:=</span>&nbsp;<span class="op" id="1523925">*</span><span class="op" id="1523926">(</span><span class="op" id="1523927">(</span><span class="op" id="1523928">*</span><span class="builtintype" id="1523929">uint8</span><span class="op" id="1523934">)</span><span class="op" id="1523935">(</span><span class="ident" id="1523936">add</span><span class="op" id="1523939">(</span><span class="ident" id="1523940">unsafe</span><span class="op" id="1523946">.</span><span class="ident" id="1523947">Pointer</span><span class="op" id="1523954">(</span><span class="ident" id="1523955">b</span><span class="op" id="1523956">)</span><span class="op" id="1523957">,</span>&nbsp;<span class="ident" id="1523959">i</span><span class="op" id="1523960">)</span><span class="op" id="1523961">)</span><span class="op" id="1523962">)</span>&nbsp;<span class="comment" id="1523964">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524009">if</span>&nbsp;<span class="ident" id="1524012">x</span>&nbsp;<span class="op" id="1524014">==</span>&nbsp;<span class="ident" id="1524017">empty</span>&nbsp;<span class="op" id="1524023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524030">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1524043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1524049">k</span>&nbsp;<span class="op" id="1524051">:=</span>&nbsp;<span class="op" id="1524054">(</span><span class="op" id="1524055">*</span><span class="ident" id="1524056">stringStruct</span><span class="op" id="1524068">)</span><span class="op" id="1524069">(</span><span class="ident" id="1524070">add</span><span class="op" id="1524073">(</span><span class="ident" id="1524074">unsafe</span><span class="op" id="1524080">.</span><span class="ident" id="1524081">Pointer</span><span class="op" id="1524088">(</span><span class="ident" id="1524089">b</span><span class="op" id="1524090">)</span><span class="op" id="1524091">,</span>&nbsp;<span class="ident" id="1524093">dataOffset</span><span class="op" id="1524103">+</span><span class="ident" id="1524104">i</span><span class="op" id="1524105">*</span><span class="num" id="1524106">2</span><span class="op" id="1524107">*</span><span class="ident" id="1524108">ptrSize</span><span class="op" id="1524115">)</span><span class="op" id="1524116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524122">if</span>&nbsp;<span class="ident" id="1524125">k</span><span class="op" id="1524126">.</span><span class="builtinfunc" id="1524127">len</span>&nbsp;<span class="op" id="1524131">!=</span>&nbsp;<span class="ident" id="1524134">key</span><span class="op" id="1524137">.</span><span class="builtinfunc" id="1524138">len</span>&nbsp;<span class="op" id="1524142">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524149">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1524162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524168">if</span>&nbsp;<span class="ident" id="1524171">k</span><span class="op" id="1524172">.</span><span class="ident" id="1524173">str</span>&nbsp;<span class="op" id="1524177">==</span>&nbsp;<span class="ident" id="1524180">key</span><span class="op" id="1524183">.</span><span class="ident" id="1524184">str</span>&nbsp;<span class="op" id="1524188">||</span>&nbsp;<span class="ident" id="1524191">memeq</span><span class="op" id="1524196">(</span><span class="ident" id="1524197">k</span><span class="op" id="1524198">.</span><span class="ident" id="1524199">str</span><span class="op" id="1524202">,</span>&nbsp;<span class="ident" id="1524204">key</span><span class="op" id="1524207">.</span><span class="ident" id="1524208">str</span><span class="op" id="1524211">,</span>&nbsp;<span class="builtintype" id="1524213">uintptr</span><span class="op" id="1524220">(</span><span class="ident" id="1524221">key</span><span class="op" id="1524224">.</span><span class="builtinfunc" id="1524225">len</span><span class="op" id="1524228">)</span><span class="op" id="1524229">)</span>&nbsp;<span class="op" id="1524231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524238">return</span>&nbsp;<span class="ident" id="1524245">add</span><span class="op" id="1524248">(</span><span class="ident" id="1524249">unsafe</span><span class="op" id="1524255">.</span><span class="ident" id="1524256">Pointer</span><span class="op" id="1524263">(</span><span class="ident" id="1524264">b</span><span class="op" id="1524265">)</span><span class="op" id="1524266">,</span>&nbsp;<span class="ident" id="1524268">dataOffset</span><span class="op" id="1524278">+</span><span class="ident" id="1524279">bucketCnt</span><span class="op" id="1524288">*</span><span class="num" id="1524289">2</span><span class="op" id="1524290">*</span><span class="ident" id="1524291">ptrSize</span><span class="op" id="1524298">+</span><span class="ident" id="1524299">i</span><span class="op" id="1524300">*</span><span class="builtintype" id="1524301">uintptr</span><span class="op" id="1524308">(</span><span class="ident" id="1524309">t</span><span class="op" id="1524310">.</span><span class="ident" id="1524311">valuesize</span><span class="op" id="1524320">)</span><span class="op" id="1524321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1524327">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1524332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524337">return</span>&nbsp;<span class="ident" id="1524344">unsafe</span><span class="op" id="1524350">.</span><span class="ident" id="1524351">Pointer</span><span class="op" id="1524358">(</span><span class="ident" id="1524359">t</span><span class="op" id="1524360">.</span><span class="ident" id="1524361">elem</span><span class="op" id="1524365">.</span><span class="ident" id="1524366">zero</span><span class="op" id="1524370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1524374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1524378">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1524439">keymaybe</span>&nbsp;<span class="op" id="1524448">:=</span>&nbsp;<span class="builtintype" id="1524451">uintptr</span><span class="op" id="1524458">(</span><span class="ident" id="1524459">bucketCnt</span><span class="op" id="1524468">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524472">for</span>&nbsp;<span class="ident" id="1524476">i</span>&nbsp;<span class="op" id="1524478">:=</span>&nbsp;<span class="builtintype" id="1524481">uintptr</span><span class="op" id="1524488">(</span><span class="num" id="1524489">0</span><span class="op" id="1524490">)</span><span class="op" id="1524491">;</span>&nbsp;<span class="ident" id="1524493">i</span>&nbsp;<span class="op" id="1524495">&lt;</span>&nbsp;<span class="ident" id="1524497">bucketCnt</span><span class="op" id="1524506">;</span>&nbsp;<span class="ident" id="1524508">i</span><span class="op" id="1524509">++</span>&nbsp;<span class="op" id="1524512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1524517">x</span>&nbsp;<span class="op" id="1524519">:=</span>&nbsp;<span class="op" id="1524522">*</span><span class="op" id="1524523">(</span><span class="op" id="1524524">(</span><span class="op" id="1524525">*</span><span class="builtintype" id="1524526">uint8</span><span class="op" id="1524531">)</span><span class="op" id="1524532">(</span><span class="ident" id="1524533">add</span><span class="op" id="1524536">(</span><span class="ident" id="1524537">unsafe</span><span class="op" id="1524543">.</span><span class="ident" id="1524544">Pointer</span><span class="op" id="1524551">(</span><span class="ident" id="1524552">b</span><span class="op" id="1524553">)</span><span class="op" id="1524554">,</span>&nbsp;<span class="ident" id="1524556">i</span><span class="op" id="1524557">)</span><span class="op" id="1524558">)</span><span class="op" id="1524559">)</span>&nbsp;<span class="comment" id="1524561">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524605">if</span>&nbsp;<span class="ident" id="1524608">x</span>&nbsp;<span class="op" id="1524610">==</span>&nbsp;<span class="ident" id="1524613">empty</span>&nbsp;<span class="op" id="1524619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524625">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1524637">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1524642">k</span>&nbsp;<span class="op" id="1524644">:=</span>&nbsp;<span class="op" id="1524647">(</span><span class="op" id="1524648">*</span><span class="ident" id="1524649">stringStruct</span><span class="op" id="1524661">)</span><span class="op" id="1524662">(</span><span class="ident" id="1524663">add</span><span class="op" id="1524666">(</span><span class="ident" id="1524667">unsafe</span><span class="op" id="1524673">.</span><span class="ident" id="1524674">Pointer</span><span class="op" id="1524681">(</span><span class="ident" id="1524682">b</span><span class="op" id="1524683">)</span><span class="op" id="1524684">,</span>&nbsp;<span class="ident" id="1524686">dataOffset</span><span class="op" id="1524696">+</span><span class="ident" id="1524697">i</span><span class="op" id="1524698">*</span><span class="num" id="1524699">2</span><span class="op" id="1524700">*</span><span class="ident" id="1524701">ptrSize</span><span class="op" id="1524708">)</span><span class="op" id="1524709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524714">if</span>&nbsp;<span class="ident" id="1524717">k</span><span class="op" id="1524718">.</span><span class="builtinfunc" id="1524719">len</span>&nbsp;<span class="op" id="1524723">!=</span>&nbsp;<span class="ident" id="1524726">key</span><span class="op" id="1524729">.</span><span class="builtinfunc" id="1524730">len</span>&nbsp;<span class="op" id="1524734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524740">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1524752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524757">if</span>&nbsp;<span class="ident" id="1524760">k</span><span class="op" id="1524761">.</span><span class="ident" id="1524762">str</span>&nbsp;<span class="op" id="1524766">==</span>&nbsp;<span class="ident" id="1524769">key</span><span class="op" id="1524772">.</span><span class="ident" id="1524773">str</span>&nbsp;<span class="op" id="1524777">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1524783">return</span>&nbsp;<span class="ident" id="1524790">add</span><span class="op" id="1524793">(</span><span class="ident" id="1524794">unsafe</span><span class="op" id="1524800">.</span><span class="ident" id="1524801">Pointer</span><span class="op" id="1524808">(</span><span class="ident" id="1524809">b</span><span class="op" id="1524810">)</span><span class="op" id="1524811">,</span>&nbsp;<span class="ident" id="1524813">dataOffset</span><span class="op" id="1524823">+</span><span class="ident" id="1524824">bucketCnt</span><span class="op" id="1524833">*</span><span class="num" id="1524834">2</span><span class="op" id="1524835">*</span><span class="ident" id="1524836">ptrSize</span><span class="op" id="1524843">+</span><span class="ident" id="1524844">i</span><span class="op" id="1524845">*</span><span class="builtintype" id="1524846">uintptr</span><span class="op" id="1524853">(</span><span class="ident" id="1524854">t</span><span class="op" id="1524855">.</span><span class="ident" id="1524856">valuesize</span><span class="op" id="1524865">)</span><span class="op" id="1524866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1524871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1524876">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1524902">//&nbsp;TODO:&nbsp;on&nbsp;amd64/386&nbsp;at&nbsp;least,&nbsp;make&nbsp;this&nbsp;compile&nbsp;to&nbsp;one&nbsp;4-byte&nbsp;comparison&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1524991">//&nbsp;four&nbsp;1-byte&nbsp;comparisons.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1525022">if</span>&nbsp;<span class="op" id="1525025">*</span><span class="op" id="1525026">(</span><span class="op" id="1525027">(</span><span class="op" id="1525028">*</span><span class="op" id="1525029">[</span><span class="num" id="1525030">4</span><span class="op" id="1525031">]</span><span class="builtintype" id="1525032">byte</span><span class="op" id="1525036">)</span><span class="op" id="1525037">(</span><span class="ident" id="1525038">key</span><span class="op" id="1525041">.</span><span class="ident" id="1525042">str</span><span class="op" id="1525045">)</span><span class="op" id="1525046">)</span>&nbsp;<span class="op" id="1525048">!=</span>&nbsp;<span class="op" id="1525051">*</span><span class="op" id="1525052">(</span><span class="op" id="1525053">(</span><span class="op" id="1525054">*</span><span class="op" id="1525055">[</span><span class="num" id="1525056">4</span><span class="op" id="1525057">]</span><span class="builtintype" id="1525058">byte</span><span class="op" id="1525062">)</span><span class="op" id="1525063">(</span><span class="ident" id="1525064">k</span><span class="op" id="1525065">.</span><span class="ident" id="1525066">str</span><span class="op" id="1525069">)</span><span class="op" id="1525070">)</span>&nbsp;<span class="op" id="1525072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1525078">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1525090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1525095">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1525120">if</span>&nbsp;<span class="op" id="1525123">*</span><span class="op" id="1525124">(</span><span class="op" id="1525125">(</span><span class="op" id="1525126">*</span><span class="op" id="1525127">[</span><span class="num" id="1525128">4</span><span class="op" id="1525129">]</span><span class="builtintype" id="1525130">byte</span><span class="op" id="1525134">)</span><span class="op" id="1525135">(</span><span class="ident" id="1525136">add</span><span class="op" id="1525139">(</span><span class="ident" id="1525140">key</span><span class="op" id="1525143">.</span><span class="ident" id="1525144">str</span><span class="op" id="1525147">,</span>&nbsp;<span class="builtintype" id="1525149">uintptr</span><span class="op" id="1525156">(</span><span class="ident" id="1525157">key</span><span class="op" id="1525160">.</span><span class="builtinfunc" id="1525161">len</span><span class="op" id="1525164">)</span><span class="op" id="1525165">-</span><span class="num" id="1525166">4</span><span class="op" id="1525167">)</span><span class="op" id="1525168">)</span><span class="op" id="1525169">)</span>&nbsp;<span class="op" id="1525171">!=</span>&nbsp;<span class="op" id="1525174">*</span><span class="op" id="1525175">(</span><span class="op" id="1525176">(</span><span class="op" id="1525177">*</span><span class="op" id="1525178">[</span><span class="num" id="1525179">4</span><span class="op" id="1525180">]</span><span class="builtintype" id="1525181">byte</span><span class="op" id="1525185">)</span><span class="op" id="1525186">(</span><span class="ident" id="1525187">add</span><span class="op" id="1525190">(</span><span class="ident" id="1525191">k</span><span class="op" id="1525192">.</span><span class="ident" id="1525193">str</span><span class="op" id="1525196">,</span>&nbsp;<span class="builtintype" id="1525198">uintptr</span><span class="op" id="1525205">(</span><span class="ident" id="1525206">key</span><span class="op" id="1525209">.</span><span class="builtinfunc" id="1525210">len</span><span class="op" id="1525213">)</span><span class="op" id="1525214">-</span><span class="num" id="1525215">4</span><span class="op" id="1525216">)</span><span class="op" id="1525217">)</span><span class="op" id="1525218">)</span>&nbsp;<span class="op" id="1525220">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1525226">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1525238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1525243">if</span>&nbsp;<span class="ident" id="1525246">keymaybe</span>&nbsp;<span class="op" id="1525255">!=</span>&nbsp;<span class="ident" id="1525258">bucketCnt</span>&nbsp;<span class="op" id="1525268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1525274">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1525344">goto</span>&nbsp;<span class="ident" id="1525349">dohash</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1525359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1525364">keymaybe</span>&nbsp;<span class="op" id="1525373">=</span>&nbsp;<span class="ident" id="1525375">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1525379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1525383">if</span>&nbsp;<span class="ident" id="1525386">keymaybe</span>&nbsp;<span class="op" id="1525395">!=</span>&nbsp;<span class="ident" id="1525398">bucketCnt</span>&nbsp;<span class="op" id="1525408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1525413">k</span>&nbsp;<span class="op" id="1525415">:=</span>&nbsp;<span class="op" id="1525418">(</span><span class="op" id="1525419">*</span><span class="ident" id="1525420">stringStruct</span><span class="op" id="1525432">)</span><span class="op" id="1525433">(</span><span class="ident" id="1525434">add</span><span class="op" id="1525437">(</span><span class="ident" id="1525438">unsafe</span><span class="op" id="1525444">.</span><span class="ident" id="1525445">Pointer</span><span class="op" id="1525452">(</span><span class="ident" id="1525453">b</span><span class="op" id="1525454">)</span><span class="op" id="1525455">,</span>&nbsp;<span class="ident" id="1525457">dataOffset</span><span class="op" id="1525467">+</span><span class="ident" id="1525468">keymaybe</span><span class="op" id="1525476">*</span><span class="num" id="1525477">2</span><span class="op" id="1525478">*</span><span class="ident" id="1525479">ptrSize</span><span class="op" id="1525486">)</span><span class="op" id="1525487">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1525492">if</span>&nbsp;<span class="ident" id="1525495">memeq</span><span class="op" id="1525500">(</span><span class="ident" id="1525501">k</span><span class="op" id="1525502">.</span><span class="ident" id="1525503">str</span><span class="op" id="1525506">,</span>&nbsp;<span class="ident" id="1525508">key</span><span class="op" id="1525511">.</span><span class="ident" id="1525512">str</span><span class="op" id="1525515">,</span>&nbsp;<span class="builtintype" id="1525517">uintptr</span><span class="op" id="1525524">(</span><span class="ident" id="1525525">key</span><span class="op" id="1525528">.</span><span class="builtinfunc" id="1525529">len</span><span class="op" id="1525532">)</span><span class="op" id="1525533">)</span>&nbsp;<span class="op" id="1525535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1525541">return</span>&nbsp;<span class="ident" id="1525548">add</span><span class="op" id="1525551">(</span><span class="ident" id="1525552">unsafe</span><span class="op" id="1525558">.</span><span class="ident" id="1525559">Pointer</span><span class="op" id="1525566">(</span><span class="ident" id="1525567">b</span><span class="op" id="1525568">)</span><span class="op" id="1525569">,</span>&nbsp;<span class="ident" id="1525571">dataOffset</span><span class="op" id="1525581">+</span><span class="ident" id="1525582">bucketCnt</span><span class="op" id="1525591">*</span><span class="num" id="1525592">2</span><span class="op" id="1525593">*</span><span class="ident" id="1525594">ptrSize</span><span class="op" id="1525601">+</span><span class="ident" id="1525602">keymaybe</span><span class="op" id="1525610">*</span><span class="builtintype" id="1525611">uintptr</span><span class="op" id="1525618">(</span><span class="ident" id="1525619">t</span><span class="op" id="1525620">.</span><span class="ident" id="1525621">valuesize</span><span class="op" id="1525630">)</span><span class="op" id="1525631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1525636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1525640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1525644">return</span>&nbsp;<span class="ident" id="1525651">unsafe</span><span class="op" id="1525657">.</span><span class="ident" id="1525658">Pointer</span><span class="op" id="1525665">(</span><span class="ident" id="1525666">t</span><span class="op" id="1525667">.</span><span class="ident" id="1525668">elem</span><span class="op" id="1525672">.</span><span class="ident" id="1525673">zero</span><span class="op" id="1525677">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1525680">}</span><br>
<span class="lineno"></span><span class="ident" id="1525682">dohash</span><span class="op" id="1525688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1525691">hash</span>&nbsp;<span class="op" id="1525696">:=</span>&nbsp;<span class="ident" id="1525699">goalg</span><span class="op" id="1525704">(</span><span class="ident" id="1525705">t</span><span class="op" id="1525706">.</span><span class="ident" id="1525707">key</span><span class="op" id="1525710">.</span><span class="ident" id="1525711">alg</span><span class="op" id="1525714">)</span><span class="op" id="1525715">.</span><span class="ident" id="1525716">hash</span><span class="op" id="1525720">(</span><span class="ident" id="1525721">noescape</span><span class="op" id="1525729">(</span><span class="ident" id="1525730">unsafe</span><span class="op" id="1525736">.</span><span class="ident" id="1525737">Pointer</span><span class="op" id="1525744">(</span><span class="op" id="1525745">&amp;</span><span class="ident" id="1525746">ky</span><span class="op" id="1525748">)</span><span class="op" id="1525749">)</span><span class="op" id="1525750">,</span>&nbsp;<span class="num" id="1525752">2</span><span class="op" id="1525753">*</span><span class="ident" id="1525754">ptrSize</span><span class="op" id="1525761">,</span>&nbsp;<span class="builtintype" id="1525763">uintptr</span><span class="op" id="1525770">(</span><span class="ident" id="1525771">h</span><span class="op" id="1525772">.</span><span class="ident" id="1525773">hash0</span><span class="op" id="1525778">)</span><span class="op" id="1525779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1525782">m</span>&nbsp;<span class="op" id="1525784">:=</span>&nbsp;<span class="builtintype" id="1525787">uintptr</span><span class="op" id="1525794">(</span><span class="num" id="1525795">1</span><span class="op" id="1525796">)</span><span class="op" id="1525797">&lt;&lt;</span><span class="ident" id="1525799">h</span><span class="op" id="1525800">.</span><span class="ident" id="1525801">B</span>&nbsp;<span class="op" id="1525803">-</span>&nbsp;<span class="num" id="1525805">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1525808">b</span>&nbsp;<span class="op" id="1525810">:=</span>&nbsp;<span class="op" id="1525813">(</span><span class="op" id="1525814">*</span><span class="ident" id="1525815">bmap</span><span class="op" id="1525819">)</span><span class="op" id="1525820">(</span><span class="ident" id="1525821">add</span><span class="op" id="1525824">(</span><span class="ident" id="1525825">h</span><span class="op" id="1525826">.</span><span class="ident" id="1525827">buckets</span><span class="op" id="1525834">,</span>&nbsp;<span class="op" id="1525836">(</span><span class="ident" id="1525837">hash</span><span class="op" id="1525841">&amp;</span><span class="ident" id="1525842">m</span><span class="op" id="1525843">)</span><span class="op" id="1525844">*</span><span class="builtintype" id="1525845">uintptr</span><span class="op" id="1525852">(</span><span class="ident" id="1525853">t</span><span class="op" id="1525854">.</span><span class="ident" id="1525855">bucketsize</span><span class="op" id="1525865">)</span><span class="op" id="1525866">)</span><span class="op" id="1525867">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1525870">if</span>&nbsp;<span class="ident" id="1525873">c</span>&nbsp;<span class="op" id="1525875">:=</span>&nbsp;<span class="ident" id="1525878">h</span><span class="op" id="1525879">.</span><span class="ident" id="1525880">oldbuckets</span><span class="op" id="1525890">;</span>&nbsp;<span class="ident" id="1525892">c</span>&nbsp;<span class="op" id="1525894">!=</span>&nbsp;<span class="ident" id="1525897">nil</span>&nbsp;<span class="op" id="1525901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1525905">oldb</span>&nbsp;<span class="op" id="1525910">:=</span>&nbsp;<span class="op" id="1525913">(</span><span class="op" id="1525914">*</span><span class="ident" id="1525915">bmap</span><span class="op" id="1525919">)</span><span class="op" id="1525920">(</span><span class="ident" id="1525921">add</span><span class="op" id="1525924">(</span><span class="ident" id="1525925">c</span><span class="op" id="1525926">,</span>&nbsp;<span class="op" id="1525928">(</span><span class="ident" id="1525929">hash</span><span class="op" id="1525933">&amp;</span><span class="op" id="1525934">(</span><span class="ident" id="1525935">m</span><span class="op" id="1525936">&gt;&gt;</span><span class="num" id="1525938">1</span><span class="op" id="1525939">)</span><span class="op" id="1525940">)</span><span class="op" id="1525941">*</span><span class="builtintype" id="1525942">uintptr</span><span class="op" id="1525949">(</span><span class="ident" id="1525950">t</span><span class="op" id="1525951">.</span><span class="ident" id="1525952">bucketsize</span><span class="op" id="1525962">)</span><span class="op" id="1525963">)</span><span class="op" id="1525964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1525968">if</span>&nbsp;<span class="op" id="1525971">!</span><span class="ident" id="1525972">evacuated</span><span class="op" id="1525981">(</span><span class="ident" id="1525982">oldb</span><span class="op" id="1525986">)</span>&nbsp;<span class="op" id="1525988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1525993">b</span>&nbsp;<span class="op" id="1525995">=</span>&nbsp;<span class="ident" id="1525997">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1526004">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1526007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1526010">top</span>&nbsp;<span class="op" id="1526014">:=</span>&nbsp;<span class="builtintype" id="1526017">uint8</span><span class="op" id="1526022">(</span><span class="ident" id="1526023">hash</span>&nbsp;<span class="op" id="1526028">&gt;&gt;</span>&nbsp;<span class="op" id="1526031">(</span><span class="ident" id="1526032">ptrSize</span><span class="op" id="1526039">*</span><span class="num" id="1526040">8</span>&nbsp;<span class="op" id="1526042">-</span>&nbsp;<span class="num" id="1526044">8</span><span class="op" id="1526045">)</span><span class="op" id="1526046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526049">if</span>&nbsp;<span class="ident" id="1526052">top</span>&nbsp;<span class="op" id="1526056">&lt;</span>&nbsp;<span class="ident" id="1526058">minTopHash</span>&nbsp;<span class="op" id="1526069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1526073">top</span>&nbsp;<span class="op" id="1526077">+=</span>&nbsp;<span class="ident" id="1526080">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1526092">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526095">for</span>&nbsp;<span class="op" id="1526099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526103">for</span>&nbsp;<span class="ident" id="1526107">i</span>&nbsp;<span class="op" id="1526109">:=</span>&nbsp;<span class="builtintype" id="1526112">uintptr</span><span class="op" id="1526119">(</span><span class="num" id="1526120">0</span><span class="op" id="1526121">)</span><span class="op" id="1526122">;</span>&nbsp;<span class="ident" id="1526124">i</span>&nbsp;<span class="op" id="1526126">&lt;</span>&nbsp;<span class="ident" id="1526128">bucketCnt</span><span class="op" id="1526137">;</span>&nbsp;<span class="ident" id="1526139">i</span><span class="op" id="1526140">++</span>&nbsp;<span class="op" id="1526143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1526148">x</span>&nbsp;<span class="op" id="1526150">:=</span>&nbsp;<span class="op" id="1526153">*</span><span class="op" id="1526154">(</span><span class="op" id="1526155">(</span><span class="op" id="1526156">*</span><span class="builtintype" id="1526157">uint8</span><span class="op" id="1526162">)</span><span class="op" id="1526163">(</span><span class="ident" id="1526164">add</span><span class="op" id="1526167">(</span><span class="ident" id="1526168">unsafe</span><span class="op" id="1526174">.</span><span class="ident" id="1526175">Pointer</span><span class="op" id="1526182">(</span><span class="ident" id="1526183">b</span><span class="op" id="1526184">)</span><span class="op" id="1526185">,</span>&nbsp;<span class="ident" id="1526187">i</span><span class="op" id="1526188">)</span><span class="op" id="1526189">)</span><span class="op" id="1526190">)</span>&nbsp;<span class="comment" id="1526192">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526236">if</span>&nbsp;<span class="ident" id="1526239">x</span>&nbsp;<span class="op" id="1526241">!=</span>&nbsp;<span class="ident" id="1526244">top</span>&nbsp;<span class="op" id="1526248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526254">continue</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1526266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1526271">k</span>&nbsp;<span class="op" id="1526273">:=</span>&nbsp;<span class="op" id="1526276">(</span><span class="op" id="1526277">*</span><span class="ident" id="1526278">stringStruct</span><span class="op" id="1526290">)</span><span class="op" id="1526291">(</span><span class="ident" id="1526292">add</span><span class="op" id="1526295">(</span><span class="ident" id="1526296">unsafe</span><span class="op" id="1526302">.</span><span class="ident" id="1526303">Pointer</span><span class="op" id="1526310">(</span><span class="ident" id="1526311">b</span><span class="op" id="1526312">)</span><span class="op" id="1526313">,</span>&nbsp;<span class="ident" id="1526315">dataOffset</span><span class="op" id="1526325">+</span><span class="ident" id="1526326">i</span><span class="op" id="1526327">*</span><span class="num" id="1526328">2</span><span class="op" id="1526329">*</span><span class="ident" id="1526330">ptrSize</span><span class="op" id="1526337">)</span><span class="op" id="1526338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526343">if</span>&nbsp;<span class="ident" id="1526346">k</span><span class="op" id="1526347">.</span><span class="builtinfunc" id="1526348">len</span>&nbsp;<span class="op" id="1526352">!=</span>&nbsp;<span class="ident" id="1526355">key</span><span class="op" id="1526358">.</span><span class="builtinfunc" id="1526359">len</span>&nbsp;<span class="op" id="1526363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526369">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1526381">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526386">if</span>&nbsp;<span class="ident" id="1526389">k</span><span class="op" id="1526390">.</span><span class="ident" id="1526391">str</span>&nbsp;<span class="op" id="1526395">==</span>&nbsp;<span class="ident" id="1526398">key</span><span class="op" id="1526401">.</span><span class="ident" id="1526402">str</span>&nbsp;<span class="op" id="1526406">||</span>&nbsp;<span class="ident" id="1526409">memeq</span><span class="op" id="1526414">(</span><span class="ident" id="1526415">k</span><span class="op" id="1526416">.</span><span class="ident" id="1526417">str</span><span class="op" id="1526420">,</span>&nbsp;<span class="ident" id="1526422">key</span><span class="op" id="1526425">.</span><span class="ident" id="1526426">str</span><span class="op" id="1526429">,</span>&nbsp;<span class="builtintype" id="1526431">uintptr</span><span class="op" id="1526438">(</span><span class="ident" id="1526439">key</span><span class="op" id="1526442">.</span><span class="builtinfunc" id="1526443">len</span><span class="op" id="1526446">)</span><span class="op" id="1526447">)</span>&nbsp;<span class="op" id="1526449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526455">return</span>&nbsp;<span class="ident" id="1526462">add</span><span class="op" id="1526465">(</span><span class="ident" id="1526466">unsafe</span><span class="op" id="1526472">.</span><span class="ident" id="1526473">Pointer</span><span class="op" id="1526480">(</span><span class="ident" id="1526481">b</span><span class="op" id="1526482">)</span><span class="op" id="1526483">,</span>&nbsp;<span class="ident" id="1526485">dataOffset</span><span class="op" id="1526495">+</span><span class="ident" id="1526496">bucketCnt</span><span class="op" id="1526505">*</span><span class="num" id="1526506">2</span><span class="op" id="1526507">*</span><span class="ident" id="1526508">ptrSize</span><span class="op" id="1526515">+</span><span class="ident" id="1526516">i</span><span class="op" id="1526517">*</span><span class="builtintype" id="1526518">uintptr</span><span class="op" id="1526525">(</span><span class="ident" id="1526526">t</span><span class="op" id="1526527">.</span><span class="ident" id="1526528">valuesize</span><span class="op" id="1526537">)</span><span class="op" id="1526538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1526543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1526547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1526551">b</span>&nbsp;<span class="op" id="1526553">=</span>&nbsp;<span class="ident" id="1526555">b</span><span class="op" id="1526556">.</span><span class="ident" id="1526557">overflow</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526568">if</span>&nbsp;<span class="ident" id="1526571">b</span>&nbsp;<span class="op" id="1526573">==</span>&nbsp;<span class="ident" id="1526576">nil</span>&nbsp;<span class="op" id="1526580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526585">return</span>&nbsp;<span class="ident" id="1526592">unsafe</span><span class="op" id="1526598">.</span><span class="ident" id="1526599">Pointer</span><span class="op" id="1526606">(</span><span class="ident" id="1526607">t</span><span class="op" id="1526608">.</span><span class="ident" id="1526609">elem</span><span class="op" id="1526613">.</span><span class="ident" id="1526614">zero</span><span class="op" id="1526618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1526622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1526625">}</span><br>
<span class="lineno"></span><span class="op" id="1526627">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="1526630">func</span>&nbsp;<span class="ident" id="1526635">mapaccess2_faststr</span><span class="op" id="1526653">(</span><span class="ident" id="1526654">t</span>&nbsp;<span class="op" id="1526656">*</span><span class="ident" id="1526657">maptype</span><span class="op" id="1526664">,</span>&nbsp;<span class="ident" id="1526666">h</span>&nbsp;<span class="op" id="1526668">*</span><span class="ident" id="1526669">hmap</span><span class="op" id="1526673">,</span>&nbsp;<span class="ident" id="1526675">ky</span>&nbsp;<span class="builtintype" id="1526678">string</span><span class="op" id="1526684">)</span>&nbsp;<span class="op" id="1526686">(</span><span class="ident" id="1526687">unsafe</span><span class="op" id="1526693">.</span><span class="ident" id="1526694">Pointer</span><span class="op" id="1526701">,</span>&nbsp;<span class="builtintype" id="1526703">bool</span><span class="op" id="1526707">)</span>&nbsp;<span class="op" id="1526709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526712">if</span>&nbsp;<span class="ident" id="1526715">raceenabled</span>&nbsp;<span class="op" id="1526727">&amp;&amp;</span>&nbsp;<span class="ident" id="1526730">h</span>&nbsp;<span class="op" id="1526732">!=</span>&nbsp;<span class="ident" id="1526735">nil</span>&nbsp;<span class="op" id="1526739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1526743">callerpc</span>&nbsp;<span class="op" id="1526752">:=</span>&nbsp;<span class="ident" id="1526755">getcallerpc</span><span class="op" id="1526766">(</span><span class="ident" id="1526767">unsafe</span><span class="op" id="1526773">.</span><span class="ident" id="1526774">Pointer</span><span class="op" id="1526781">(</span><span class="op" id="1526782">&amp;</span><span class="ident" id="1526783">t</span><span class="op" id="1526784">)</span><span class="op" id="1526785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1526789">racereadpc</span><span class="op" id="1526799">(</span><span class="ident" id="1526800">unsafe</span><span class="op" id="1526806">.</span><span class="ident" id="1526807">Pointer</span><span class="op" id="1526814">(</span><span class="ident" id="1526815">h</span><span class="op" id="1526816">)</span><span class="op" id="1526817">,</span>&nbsp;<span class="ident" id="1526819">callerpc</span><span class="op" id="1526827">,</span>&nbsp;<span class="ident" id="1526829">funcPC</span><span class="op" id="1526835">(</span><span class="ident" id="1526836">mapaccess2_faststr</span><span class="op" id="1526854">)</span><span class="op" id="1526855">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1526858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526861">if</span>&nbsp;<span class="ident" id="1526864">h</span>&nbsp;<span class="op" id="1526866">==</span>&nbsp;<span class="ident" id="1526869">nil</span>&nbsp;<span class="op" id="1526873">||</span>&nbsp;<span class="ident" id="1526876">h</span><span class="op" id="1526877">.</span><span class="ident" id="1526878">count</span>&nbsp;<span class="op" id="1526884">==</span>&nbsp;<span class="num" id="1526887">0</span>&nbsp;<span class="op" id="1526889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526893">return</span>&nbsp;<span class="ident" id="1526900">unsafe</span><span class="op" id="1526906">.</span><span class="ident" id="1526907">Pointer</span><span class="op" id="1526914">(</span><span class="ident" id="1526915">t</span><span class="op" id="1526916">.</span><span class="ident" id="1526917">elem</span><span class="op" id="1526921">.</span><span class="ident" id="1526922">zero</span><span class="op" id="1526926">)</span><span class="op" id="1526927">,</span>&nbsp;<span class="builtintype" id="1526929">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1526936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1526939">key</span>&nbsp;<span class="op" id="1526943">:=</span>&nbsp;<span class="op" id="1526946">(</span><span class="op" id="1526947">*</span><span class="ident" id="1526948">stringStruct</span><span class="op" id="1526960">)</span><span class="op" id="1526961">(</span><span class="ident" id="1526962">unsafe</span><span class="op" id="1526968">.</span><span class="ident" id="1526969">Pointer</span><span class="op" id="1526976">(</span><span class="op" id="1526977">&amp;</span><span class="ident" id="1526978">ky</span><span class="op" id="1526980">)</span><span class="op" id="1526981">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1526984">if</span>&nbsp;<span class="ident" id="1526987">h</span><span class="op" id="1526988">.</span><span class="ident" id="1526989">B</span>&nbsp;<span class="op" id="1526991">==</span>&nbsp;<span class="num" id="1526994">0</span>&nbsp;<span class="op" id="1526996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1527000">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1527023">b</span>&nbsp;<span class="op" id="1527025">:=</span>&nbsp;<span class="op" id="1527028">(</span><span class="op" id="1527029">*</span><span class="ident" id="1527030">bmap</span><span class="op" id="1527034">)</span><span class="op" id="1527035">(</span><span class="ident" id="1527036">h</span><span class="op" id="1527037">.</span><span class="ident" id="1527038">buckets</span><span class="op" id="1527045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527049">if</span>&nbsp;<span class="ident" id="1527052">key</span><span class="op" id="1527055">.</span><span class="builtinfunc" id="1527056">len</span>&nbsp;<span class="op" id="1527060">&lt;</span>&nbsp;<span class="num" id="1527062">32</span>&nbsp;<span class="op" id="1527065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1527070">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527119">for</span>&nbsp;<span class="ident" id="1527123">i</span>&nbsp;<span class="op" id="1527125">:=</span>&nbsp;<span class="builtintype" id="1527128">uintptr</span><span class="op" id="1527135">(</span><span class="num" id="1527136">0</span><span class="op" id="1527137">)</span><span class="op" id="1527138">;</span>&nbsp;<span class="ident" id="1527140">i</span>&nbsp;<span class="op" id="1527142">&lt;</span>&nbsp;<span class="ident" id="1527144">bucketCnt</span><span class="op" id="1527153">;</span>&nbsp;<span class="ident" id="1527155">i</span><span class="op" id="1527156">++</span>&nbsp;<span class="op" id="1527159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1527165">x</span>&nbsp;<span class="op" id="1527167">:=</span>&nbsp;<span class="op" id="1527170">*</span><span class="op" id="1527171">(</span><span class="op" id="1527172">(</span><span class="op" id="1527173">*</span><span class="builtintype" id="1527174">uint8</span><span class="op" id="1527179">)</span><span class="op" id="1527180">(</span><span class="ident" id="1527181">add</span><span class="op" id="1527184">(</span><span class="ident" id="1527185">unsafe</span><span class="op" id="1527191">.</span><span class="ident" id="1527192">Pointer</span><span class="op" id="1527199">(</span><span class="ident" id="1527200">b</span><span class="op" id="1527201">)</span><span class="op" id="1527202">,</span>&nbsp;<span class="ident" id="1527204">i</span><span class="op" id="1527205">)</span><span class="op" id="1527206">)</span><span class="op" id="1527207">)</span>&nbsp;<span class="comment" id="1527209">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527254">if</span>&nbsp;<span class="ident" id="1527257">x</span>&nbsp;<span class="op" id="1527259">==</span>&nbsp;<span class="ident" id="1527262">empty</span>&nbsp;<span class="op" id="1527268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527275">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1527288">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1527294">k</span>&nbsp;<span class="op" id="1527296">:=</span>&nbsp;<span class="op" id="1527299">(</span><span class="op" id="1527300">*</span><span class="ident" id="1527301">stringStruct</span><span class="op" id="1527313">)</span><span class="op" id="1527314">(</span><span class="ident" id="1527315">add</span><span class="op" id="1527318">(</span><span class="ident" id="1527319">unsafe</span><span class="op" id="1527325">.</span><span class="ident" id="1527326">Pointer</span><span class="op" id="1527333">(</span><span class="ident" id="1527334">b</span><span class="op" id="1527335">)</span><span class="op" id="1527336">,</span>&nbsp;<span class="ident" id="1527338">dataOffset</span><span class="op" id="1527348">+</span><span class="ident" id="1527349">i</span><span class="op" id="1527350">*</span><span class="num" id="1527351">2</span><span class="op" id="1527352">*</span><span class="ident" id="1527353">ptrSize</span><span class="op" id="1527360">)</span><span class="op" id="1527361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527367">if</span>&nbsp;<span class="ident" id="1527370">k</span><span class="op" id="1527371">.</span><span class="builtinfunc" id="1527372">len</span>&nbsp;<span class="op" id="1527376">!=</span>&nbsp;<span class="ident" id="1527379">key</span><span class="op" id="1527382">.</span><span class="builtinfunc" id="1527383">len</span>&nbsp;<span class="op" id="1527387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527394">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1527407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527413">if</span>&nbsp;<span class="ident" id="1527416">k</span><span class="op" id="1527417">.</span><span class="ident" id="1527418">str</span>&nbsp;<span class="op" id="1527422">==</span>&nbsp;<span class="ident" id="1527425">key</span><span class="op" id="1527428">.</span><span class="ident" id="1527429">str</span>&nbsp;<span class="op" id="1527433">||</span>&nbsp;<span class="ident" id="1527436">memeq</span><span class="op" id="1527441">(</span><span class="ident" id="1527442">k</span><span class="op" id="1527443">.</span><span class="ident" id="1527444">str</span><span class="op" id="1527447">,</span>&nbsp;<span class="ident" id="1527449">key</span><span class="op" id="1527452">.</span><span class="ident" id="1527453">str</span><span class="op" id="1527456">,</span>&nbsp;<span class="builtintype" id="1527458">uintptr</span><span class="op" id="1527465">(</span><span class="ident" id="1527466">key</span><span class="op" id="1527469">.</span><span class="builtinfunc" id="1527470">len</span><span class="op" id="1527473">)</span><span class="op" id="1527474">)</span>&nbsp;<span class="op" id="1527476">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527483">return</span>&nbsp;<span class="ident" id="1527490">add</span><span class="op" id="1527493">(</span><span class="ident" id="1527494">unsafe</span><span class="op" id="1527500">.</span><span class="ident" id="1527501">Pointer</span><span class="op" id="1527508">(</span><span class="ident" id="1527509">b</span><span class="op" id="1527510">)</span><span class="op" id="1527511">,</span>&nbsp;<span class="ident" id="1527513">dataOffset</span><span class="op" id="1527523">+</span><span class="ident" id="1527524">bucketCnt</span><span class="op" id="1527533">*</span><span class="num" id="1527534">2</span><span class="op" id="1527535">*</span><span class="ident" id="1527536">ptrSize</span><span class="op" id="1527543">+</span><span class="ident" id="1527544">i</span><span class="op" id="1527545">*</span><span class="builtintype" id="1527546">uintptr</span><span class="op" id="1527553">(</span><span class="ident" id="1527554">t</span><span class="op" id="1527555">.</span><span class="ident" id="1527556">valuesize</span><span class="op" id="1527565">)</span><span class="op" id="1527566">)</span><span class="op" id="1527567">,</span>&nbsp;<span class="builtintype" id="1527569">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1527578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1527583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527588">return</span>&nbsp;<span class="ident" id="1527595">unsafe</span><span class="op" id="1527601">.</span><span class="ident" id="1527602">Pointer</span><span class="op" id="1527609">(</span><span class="ident" id="1527610">t</span><span class="op" id="1527611">.</span><span class="ident" id="1527612">elem</span><span class="op" id="1527616">.</span><span class="ident" id="1527617">zero</span><span class="op" id="1527621">)</span><span class="op" id="1527622">,</span>&nbsp;<span class="builtintype" id="1527624">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1527632">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1527636">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1527697">keymaybe</span>&nbsp;<span class="op" id="1527706">:=</span>&nbsp;<span class="builtintype" id="1527709">uintptr</span><span class="op" id="1527716">(</span><span class="ident" id="1527717">bucketCnt</span><span class="op" id="1527726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527730">for</span>&nbsp;<span class="ident" id="1527734">i</span>&nbsp;<span class="op" id="1527736">:=</span>&nbsp;<span class="builtintype" id="1527739">uintptr</span><span class="op" id="1527746">(</span><span class="num" id="1527747">0</span><span class="op" id="1527748">)</span><span class="op" id="1527749">;</span>&nbsp;<span class="ident" id="1527751">i</span>&nbsp;<span class="op" id="1527753">&lt;</span>&nbsp;<span class="ident" id="1527755">bucketCnt</span><span class="op" id="1527764">;</span>&nbsp;<span class="ident" id="1527766">i</span><span class="op" id="1527767">++</span>&nbsp;<span class="op" id="1527770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1527775">x</span>&nbsp;<span class="op" id="1527777">:=</span>&nbsp;<span class="op" id="1527780">*</span><span class="op" id="1527781">(</span><span class="op" id="1527782">(</span><span class="op" id="1527783">*</span><span class="builtintype" id="1527784">uint8</span><span class="op" id="1527789">)</span><span class="op" id="1527790">(</span><span class="ident" id="1527791">add</span><span class="op" id="1527794">(</span><span class="ident" id="1527795">unsafe</span><span class="op" id="1527801">.</span><span class="ident" id="1527802">Pointer</span><span class="op" id="1527809">(</span><span class="ident" id="1527810">b</span><span class="op" id="1527811">)</span><span class="op" id="1527812">,</span>&nbsp;<span class="ident" id="1527814">i</span><span class="op" id="1527815">)</span><span class="op" id="1527816">)</span><span class="op" id="1527817">)</span>&nbsp;<span class="comment" id="1527819">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527863">if</span>&nbsp;<span class="ident" id="1527866">x</span>&nbsp;<span class="op" id="1527868">==</span>&nbsp;<span class="ident" id="1527871">empty</span>&nbsp;<span class="op" id="1527877">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527883">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1527895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1527900">k</span>&nbsp;<span class="op" id="1527902">:=</span>&nbsp;<span class="op" id="1527905">(</span><span class="op" id="1527906">*</span><span class="ident" id="1527907">stringStruct</span><span class="op" id="1527919">)</span><span class="op" id="1527920">(</span><span class="ident" id="1527921">add</span><span class="op" id="1527924">(</span><span class="ident" id="1527925">unsafe</span><span class="op" id="1527931">.</span><span class="ident" id="1527932">Pointer</span><span class="op" id="1527939">(</span><span class="ident" id="1527940">b</span><span class="op" id="1527941">)</span><span class="op" id="1527942">,</span>&nbsp;<span class="ident" id="1527944">dataOffset</span><span class="op" id="1527954">+</span><span class="ident" id="1527955">i</span><span class="op" id="1527956">*</span><span class="num" id="1527957">2</span><span class="op" id="1527958">*</span><span class="ident" id="1527959">ptrSize</span><span class="op" id="1527966">)</span><span class="op" id="1527967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527972">if</span>&nbsp;<span class="ident" id="1527975">k</span><span class="op" id="1527976">.</span><span class="builtinfunc" id="1527977">len</span>&nbsp;<span class="op" id="1527981">!=</span>&nbsp;<span class="ident" id="1527984">key</span><span class="op" id="1527987">.</span><span class="builtinfunc" id="1527988">len</span>&nbsp;<span class="op" id="1527992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1527998">continue</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1528010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1528015">if</span>&nbsp;<span class="ident" id="1528018">k</span><span class="op" id="1528019">.</span><span class="ident" id="1528020">str</span>&nbsp;<span class="op" id="1528024">==</span>&nbsp;<span class="ident" id="1528027">key</span><span class="op" id="1528030">.</span><span class="ident" id="1528031">str</span>&nbsp;<span class="op" id="1528035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1528041">return</span>&nbsp;<span class="ident" id="1528048">add</span><span class="op" id="1528051">(</span><span class="ident" id="1528052">unsafe</span><span class="op" id="1528058">.</span><span class="ident" id="1528059">Pointer</span><span class="op" id="1528066">(</span><span class="ident" id="1528067">b</span><span class="op" id="1528068">)</span><span class="op" id="1528069">,</span>&nbsp;<span class="ident" id="1528071">dataOffset</span><span class="op" id="1528081">+</span><span class="ident" id="1528082">bucketCnt</span><span class="op" id="1528091">*</span><span class="num" id="1528092">2</span><span class="op" id="1528093">*</span><span class="ident" id="1528094">ptrSize</span><span class="op" id="1528101">+</span><span class="ident" id="1528102">i</span><span class="op" id="1528103">*</span><span class="builtintype" id="1528104">uintptr</span><span class="op" id="1528111">(</span><span class="ident" id="1528112">t</span><span class="op" id="1528113">.</span><span class="ident" id="1528114">valuesize</span><span class="op" id="1528123">)</span><span class="op" id="1528124">)</span><span class="op" id="1528125">,</span>&nbsp;<span class="builtintype" id="1528127">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1528135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1528140">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1528166">if</span>&nbsp;<span class="op" id="1528169">*</span><span class="op" id="1528170">(</span><span class="op" id="1528171">(</span><span class="op" id="1528172">*</span><span class="op" id="1528173">[</span><span class="num" id="1528174">4</span><span class="op" id="1528175">]</span><span class="builtintype" id="1528176">byte</span><span class="op" id="1528180">)</span><span class="op" id="1528181">(</span><span class="ident" id="1528182">key</span><span class="op" id="1528185">.</span><span class="ident" id="1528186">str</span><span class="op" id="1528189">)</span><span class="op" id="1528190">)</span>&nbsp;<span class="op" id="1528192">!=</span>&nbsp;<span class="op" id="1528195">*</span><span class="op" id="1528196">(</span><span class="op" id="1528197">(</span><span class="op" id="1528198">*</span><span class="op" id="1528199">[</span><span class="num" id="1528200">4</span><span class="op" id="1528201">]</span><span class="builtintype" id="1528202">byte</span><span class="op" id="1528206">)</span><span class="op" id="1528207">(</span><span class="ident" id="1528208">k</span><span class="op" id="1528209">.</span><span class="ident" id="1528210">str</span><span class="op" id="1528213">)</span><span class="op" id="1528214">)</span>&nbsp;<span class="op" id="1528216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1528222">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1528234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1528239">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1528264">if</span>&nbsp;<span class="op" id="1528267">*</span><span class="op" id="1528268">(</span><span class="op" id="1528269">(</span><span class="op" id="1528270">*</span><span class="op" id="1528271">[</span><span class="num" id="1528272">4</span><span class="op" id="1528273">]</span><span class="builtintype" id="1528274">byte</span><span class="op" id="1528278">)</span><span class="op" id="1528279">(</span><span class="ident" id="1528280">add</span><span class="op" id="1528283">(</span><span class="ident" id="1528284">key</span><span class="op" id="1528287">.</span><span class="ident" id="1528288">str</span><span class="op" id="1528291">,</span>&nbsp;<span class="builtintype" id="1528293">uintptr</span><span class="op" id="1528300">(</span><span class="ident" id="1528301">key</span><span class="op" id="1528304">.</span><span class="builtinfunc" id="1528305">len</span><span class="op" id="1528308">)</span><span class="op" id="1528309">-</span><span class="num" id="1528310">4</span><span class="op" id="1528311">)</span><span class="op" id="1528312">)</span><span class="op" id="1528313">)</span>&nbsp;<span class="op" id="1528315">!=</span>&nbsp;<span class="op" id="1528318">*</span><span class="op" id="1528319">(</span><span class="op" id="1528320">(</span><span class="op" id="1528321">*</span><span class="op" id="1528322">[</span><span class="num" id="1528323">4</span><span class="op" id="1528324">]</span><span class="builtintype" id="1528325">byte</span><span class="op" id="1528329">)</span><span class="op" id="1528330">(</span><span class="ident" id="1528331">add</span><span class="op" id="1528334">(</span><span class="ident" id="1528335">k</span><span class="op" id="1528336">.</span><span class="ident" id="1528337">str</span><span class="op" id="1528340">,</span>&nbsp;<span class="builtintype" id="1528342">uintptr</span><span class="op" id="1528349">(</span><span class="ident" id="1528350">key</span><span class="op" id="1528353">.</span><span class="builtinfunc" id="1528354">len</span><span class="op" id="1528357">)</span><span class="op" id="1528358">-</span><span class="num" id="1528359">4</span><span class="op" id="1528360">)</span><span class="op" id="1528361">)</span><span class="op" id="1528362">)</span>&nbsp;<span class="op" id="1528364">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1528370">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1528382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1528387">if</span>&nbsp;<span class="ident" id="1528390">keymaybe</span>&nbsp;<span class="op" id="1528399">!=</span>&nbsp;<span class="ident" id="1528402">bucketCnt</span>&nbsp;<span class="op" id="1528412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1528418">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1528488">goto</span>&nbsp;<span class="ident" id="1528493">dohash</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1528503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1528508">keymaybe</span>&nbsp;<span class="op" id="1528517">=</span>&nbsp;<span class="ident" id="1528519">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1528523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1528527">if</span>&nbsp;<span class="ident" id="1528530">keymaybe</span>&nbsp;<span class="op" id="1528539">!=</span>&nbsp;<span class="ident" id="1528542">bucketCnt</span>&nbsp;<span class="op" id="1528552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1528557">k</span>&nbsp;<span class="op" id="1528559">:=</span>&nbsp;<span class="op" id="1528562">(</span><span class="op" id="1528563">*</span><span class="ident" id="1528564">stringStruct</span><span class="op" id="1528576">)</span><span class="op" id="1528577">(</span><span class="ident" id="1528578">add</span><span class="op" id="1528581">(</span><span class="ident" id="1528582">unsafe</span><span class="op" id="1528588">.</span><span class="ident" id="1528589">Pointer</span><span class="op" id="1528596">(</span><span class="ident" id="1528597">b</span><span class="op" id="1528598">)</span><span class="op" id="1528599">,</span>&nbsp;<span class="ident" id="1528601">dataOffset</span><span class="op" id="1528611">+</span><span class="ident" id="1528612">keymaybe</span><span class="op" id="1528620">*</span><span class="num" id="1528621">2</span><span class="op" id="1528622">*</span><span class="ident" id="1528623">ptrSize</span><span class="op" id="1528630">)</span><span class="op" id="1528631">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1528636">if</span>&nbsp;<span class="ident" id="1528639">memeq</span><span class="op" id="1528644">(</span><span class="ident" id="1528645">k</span><span class="op" id="1528646">.</span><span class="ident" id="1528647">str</span><span class="op" id="1528650">,</span>&nbsp;<span class="ident" id="1528652">key</span><span class="op" id="1528655">.</span><span class="ident" id="1528656">str</span><span class="op" id="1528659">,</span>&nbsp;<span class="builtintype" id="1528661">uintptr</span><span class="op" id="1528668">(</span><span class="ident" id="1528669">key</span><span class="op" id="1528672">.</span><span class="builtinfunc" id="1528673">len</span><span class="op" id="1528676">)</span><span class="op" id="1528677">)</span>&nbsp;<span class="op" id="1528679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1528685">return</span>&nbsp;<span class="ident" id="1528692">add</span><span class="op" id="1528695">(</span><span class="ident" id="1528696">unsafe</span><span class="op" id="1528702">.</span><span class="ident" id="1528703">Pointer</span><span class="op" id="1528710">(</span><span class="ident" id="1528711">b</span><span class="op" id="1528712">)</span><span class="op" id="1528713">,</span>&nbsp;<span class="ident" id="1528715">dataOffset</span><span class="op" id="1528725">+</span><span class="ident" id="1528726">bucketCnt</span><span class="op" id="1528735">*</span><span class="num" id="1528736">2</span><span class="op" id="1528737">*</span><span class="ident" id="1528738">ptrSize</span><span class="op" id="1528745">+</span><span class="ident" id="1528746">keymaybe</span><span class="op" id="1528754">*</span><span class="builtintype" id="1528755">uintptr</span><span class="op" id="1528762">(</span><span class="ident" id="1528763">t</span><span class="op" id="1528764">.</span><span class="ident" id="1528765">valuesize</span><span class="op" id="1528774">)</span><span class="op" id="1528775">)</span><span class="op" id="1528776">,</span>&nbsp;<span class="builtintype" id="1528778">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1528786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1528790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1528794">return</span>&nbsp;<span class="ident" id="1528801">unsafe</span><span class="op" id="1528807">.</span><span class="ident" id="1528808">Pointer</span><span class="op" id="1528815">(</span><span class="ident" id="1528816">t</span><span class="op" id="1528817">.</span><span class="ident" id="1528818">elem</span><span class="op" id="1528822">.</span><span class="ident" id="1528823">zero</span><span class="op" id="1528827">)</span><span class="op" id="1528828">,</span>&nbsp;<span class="builtintype" id="1528830">false</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1528837">}</span><br>
<span class="lineno"></span><span class="ident" id="1528839">dohash</span><span class="op" id="1528845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1528848">hash</span>&nbsp;<span class="op" id="1528853">:=</span>&nbsp;<span class="ident" id="1528856">goalg</span><span class="op" id="1528861">(</span><span class="ident" id="1528862">t</span><span class="op" id="1528863">.</span><span class="ident" id="1528864">key</span><span class="op" id="1528867">.</span><span class="ident" id="1528868">alg</span><span class="op" id="1528871">)</span><span class="op" id="1528872">.</span><span class="ident" id="1528873">hash</span><span class="op" id="1528877">(</span><span class="ident" id="1528878">noescape</span><span class="op" id="1528886">(</span><span class="ident" id="1528887">unsafe</span><span class="op" id="1528893">.</span><span class="ident" id="1528894">Pointer</span><span class="op" id="1528901">(</span><span class="op" id="1528902">&amp;</span><span class="ident" id="1528903">ky</span><span class="op" id="1528905">)</span><span class="op" id="1528906">)</span><span class="op" id="1528907">,</span>&nbsp;<span class="num" id="1528909">2</span><span class="op" id="1528910">*</span><span class="ident" id="1528911">ptrSize</span><span class="op" id="1528918">,</span>&nbsp;<span class="builtintype" id="1528920">uintptr</span><span class="op" id="1528927">(</span><span class="ident" id="1528928">h</span><span class="op" id="1528929">.</span><span class="ident" id="1528930">hash0</span><span class="op" id="1528935">)</span><span class="op" id="1528936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1528939">m</span>&nbsp;<span class="op" id="1528941">:=</span>&nbsp;<span class="builtintype" id="1528944">uintptr</span><span class="op" id="1528951">(</span><span class="num" id="1528952">1</span><span class="op" id="1528953">)</span><span class="op" id="1528954">&lt;&lt;</span><span class="ident" id="1528956">h</span><span class="op" id="1528957">.</span><span class="ident" id="1528958">B</span>&nbsp;<span class="op" id="1528960">-</span>&nbsp;<span class="num" id="1528962">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1528965">b</span>&nbsp;<span class="op" id="1528967">:=</span>&nbsp;<span class="op" id="1528970">(</span><span class="op" id="1528971">*</span><span class="ident" id="1528972">bmap</span><span class="op" id="1528976">)</span><span class="op" id="1528977">(</span><span class="ident" id="1528978">add</span><span class="op" id="1528981">(</span><span class="ident" id="1528982">h</span><span class="op" id="1528983">.</span><span class="ident" id="1528984">buckets</span><span class="op" id="1528991">,</span>&nbsp;<span class="op" id="1528993">(</span><span class="ident" id="1528994">hash</span><span class="op" id="1528998">&amp;</span><span class="ident" id="1528999">m</span><span class="op" id="1529000">)</span><span class="op" id="1529001">*</span><span class="builtintype" id="1529002">uintptr</span><span class="op" id="1529009">(</span><span class="ident" id="1529010">t</span><span class="op" id="1529011">.</span><span class="ident" id="1529012">bucketsize</span><span class="op" id="1529022">)</span><span class="op" id="1529023">)</span><span class="op" id="1529024">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1529027">if</span>&nbsp;<span class="ident" id="1529030">c</span>&nbsp;<span class="op" id="1529032">:=</span>&nbsp;<span class="ident" id="1529035">h</span><span class="op" id="1529036">.</span><span class="ident" id="1529037">oldbuckets</span><span class="op" id="1529047">;</span>&nbsp;<span class="ident" id="1529049">c</span>&nbsp;<span class="op" id="1529051">!=</span>&nbsp;<span class="ident" id="1529054">nil</span>&nbsp;<span class="op" id="1529058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1529062">oldb</span>&nbsp;<span class="op" id="1529067">:=</span>&nbsp;<span class="op" id="1529070">(</span><span class="op" id="1529071">*</span><span class="ident" id="1529072">bmap</span><span class="op" id="1529076">)</span><span class="op" id="1529077">(</span><span class="ident" id="1529078">add</span><span class="op" id="1529081">(</span><span class="ident" id="1529082">c</span><span class="op" id="1529083">,</span>&nbsp;<span class="op" id="1529085">(</span><span class="ident" id="1529086">hash</span><span class="op" id="1529090">&amp;</span><span class="op" id="1529091">(</span><span class="ident" id="1529092">m</span><span class="op" id="1529093">&gt;&gt;</span><span class="num" id="1529095">1</span><span class="op" id="1529096">)</span><span class="op" id="1529097">)</span><span class="op" id="1529098">*</span><span class="builtintype" id="1529099">uintptr</span><span class="op" id="1529106">(</span><span class="ident" id="1529107">t</span><span class="op" id="1529108">.</span><span class="ident" id="1529109">bucketsize</span><span class="op" id="1529119">)</span><span class="op" id="1529120">)</span><span class="op" id="1529121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1529125">if</span>&nbsp;<span class="op" id="1529128">!</span><span class="ident" id="1529129">evacuated</span><span class="op" id="1529138">(</span><span class="ident" id="1529139">oldb</span><span class="op" id="1529143">)</span>&nbsp;<span class="op" id="1529145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1529150">b</span>&nbsp;<span class="op" id="1529152">=</span>&nbsp;<span class="ident" id="1529154">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1529161">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1529164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1529167">top</span>&nbsp;<span class="op" id="1529171">:=</span>&nbsp;<span class="builtintype" id="1529174">uint8</span><span class="op" id="1529179">(</span><span class="ident" id="1529180">hash</span>&nbsp;<span class="op" id="1529185">&gt;&gt;</span>&nbsp;<span class="op" id="1529188">(</span><span class="ident" id="1529189">ptrSize</span><span class="op" id="1529196">*</span><span class="num" id="1529197">8</span>&nbsp;<span class="op" id="1529199">-</span>&nbsp;<span class="num" id="1529201">8</span><span class="op" id="1529202">)</span><span class="op" id="1529203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1529206">if</span>&nbsp;<span class="ident" id="1529209">top</span>&nbsp;<span class="op" id="1529213">&lt;</span>&nbsp;<span class="ident" id="1529215">minTopHash</span>&nbsp;<span class="op" id="1529226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1529230">top</span>&nbsp;<span class="op" id="1529234">+=</span>&nbsp;<span class="ident" id="1529237">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1529249">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1529252">for</span>&nbsp;<span class="op" id="1529256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1529260">for</span>&nbsp;<span class="ident" id="1529264">i</span>&nbsp;<span class="op" id="1529266">:=</span>&nbsp;<span class="builtintype" id="1529269">uintptr</span><span class="op" id="1529276">(</span><span class="num" id="1529277">0</span><span class="op" id="1529278">)</span><span class="op" id="1529279">;</span>&nbsp;<span class="ident" id="1529281">i</span>&nbsp;<span class="op" id="1529283">&lt;</span>&nbsp;<span class="ident" id="1529285">bucketCnt</span><span class="op" id="1529294">;</span>&nbsp;<span class="ident" id="1529296">i</span><span class="op" id="1529297">++</span>&nbsp;<span class="op" id="1529300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1529305">x</span>&nbsp;<span class="op" id="1529307">:=</span>&nbsp;<span class="op" id="1529310">*</span><span class="op" id="1529311">(</span><span class="op" id="1529312">(</span><span class="op" id="1529313">*</span><span class="builtintype" id="1529314">uint8</span><span class="op" id="1529319">)</span><span class="op" id="1529320">(</span><span class="ident" id="1529321">add</span><span class="op" id="1529324">(</span><span class="ident" id="1529325">unsafe</span><span class="op" id="1529331">.</span><span class="ident" id="1529332">Pointer</span><span class="op" id="1529339">(</span><span class="ident" id="1529340">b</span><span class="op" id="1529341">)</span><span class="op" id="1529342">,</span>&nbsp;<span class="ident" id="1529344">i</span><span class="op" id="1529345">)</span><span class="op" id="1529346">)</span><span class="op" id="1529347">)</span>&nbsp;<span class="comment" id="1529349">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1529393">if</span>&nbsp;<span class="ident" id="1529396">x</span>&nbsp;<span class="op" id="1529398">!=</span>&nbsp;<span class="ident" id="1529401">top</span>&nbsp;<span class="op" id="1529405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1529411">continue</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1529423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1529428">k</span>&nbsp;<span class="op" id="1529430">:=</span>&nbsp;<span class="op" id="1529433">(</span><span class="op" id="1529434">*</span><span class="ident" id="1529435">stringStruct</span><span class="op" id="1529447">)</span><span class="op" id="1529448">(</span><span class="ident" id="1529449">add</span><span class="op" id="1529452">(</span><span class="ident" id="1529453">unsafe</span><span class="op" id="1529459">.</span><span class="ident" id="1529460">Pointer</span><span class="op" id="1529467">(</span><span class="ident" id="1529468">b</span><span class="op" id="1529469">)</span><span class="op" id="1529470">,</span>&nbsp;<span class="ident" id="1529472">dataOffset</span><span class="op" id="1529482">+</span><span class="ident" id="1529483">i</span><span class="op" id="1529484">*</span><span class="num" id="1529485">2</span><span class="op" id="1529486">*</span><span class="ident" id="1529487">ptrSize</span><span class="op" id="1529494">)</span><span class="op" id="1529495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1529500">if</span>&nbsp;<span class="ident" id="1529503">k</span><span class="op" id="1529504">.</span><span class="builtinfunc" id="1529505">len</span>&nbsp;<span class="op" id="1529509">!=</span>&nbsp;<span class="ident" id="1529512">key</span><span class="op" id="1529515">.</span><span class="builtinfunc" id="1529516">len</span>&nbsp;<span class="op" id="1529520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1529526">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1529538">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1529543">if</span>&nbsp;<span class="ident" id="1529546">k</span><span class="op" id="1529547">.</span><span class="ident" id="1529548">str</span>&nbsp;<span class="op" id="1529552">==</span>&nbsp;<span class="ident" id="1529555">key</span><span class="op" id="1529558">.</span><span class="ident" id="1529559">str</span>&nbsp;<span class="op" id="1529563">||</span>&nbsp;<span class="ident" id="1529566">memeq</span><span class="op" id="1529571">(</span><span class="ident" id="1529572">k</span><span class="op" id="1529573">.</span><span class="ident" id="1529574">str</span><span class="op" id="1529577">,</span>&nbsp;<span class="ident" id="1529579">key</span><span class="op" id="1529582">.</span><span class="ident" id="1529583">str</span><span class="op" id="1529586">,</span>&nbsp;<span class="builtintype" id="1529588">uintptr</span><span class="op" id="1529595">(</span><span class="ident" id="1529596">key</span><span class="op" id="1529599">.</span><span class="builtinfunc" id="1529600">len</span><span class="op" id="1529603">)</span><span class="op" id="1529604">)</span>&nbsp;<span class="op" id="1529606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1529612">return</span>&nbsp;<span class="ident" id="1529619">add</span><span class="op" id="1529622">(</span><span class="ident" id="1529623">unsafe</span><span class="op" id="1529629">.</span><span class="ident" id="1529630">Pointer</span><span class="op" id="1529637">(</span><span class="ident" id="1529638">b</span><span class="op" id="1529639">)</span><span class="op" id="1529640">,</span>&nbsp;<span class="ident" id="1529642">dataOffset</span><span class="op" id="1529652">+</span><span class="ident" id="1529653">bucketCnt</span><span class="op" id="1529662">*</span><span class="num" id="1529663">2</span><span class="op" id="1529664">*</span><span class="ident" id="1529665">ptrSize</span><span class="op" id="1529672">+</span><span class="ident" id="1529673">i</span><span class="op" id="1529674">*</span><span class="builtintype" id="1529675">uintptr</span><span class="op" id="1529682">(</span><span class="ident" id="1529683">t</span><span class="op" id="1529684">.</span><span class="ident" id="1529685">valuesize</span><span class="op" id="1529694">)</span><span class="op" id="1529695">)</span><span class="op" id="1529696">,</span>&nbsp;<span class="builtintype" id="1529698">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1529706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1529710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1529714">b</span>&nbsp;<span class="op" id="1529716">=</span>&nbsp;<span class="ident" id="1529718">b</span><span class="op" id="1529719">.</span><span class="ident" id="1529720">overflow</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1529731">if</span>&nbsp;<span class="ident" id="1529734">b</span>&nbsp;<span class="op" id="1529736">==</span>&nbsp;<span class="ident" id="1529739">nil</span>&nbsp;<span class="op" id="1529743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1529748">return</span>&nbsp;<span class="ident" id="1529755">unsafe</span><span class="op" id="1529761">.</span><span class="ident" id="1529762">Pointer</span><span class="op" id="1529769">(</span><span class="ident" id="1529770">t</span><span class="op" id="1529771">.</span><span class="ident" id="1529772">elem</span><span class="op" id="1529776">.</span><span class="ident" id="1529777">zero</span><span class="op" id="1529781">)</span><span class="op" id="1529782">,</span>&nbsp;<span class="builtintype" id="1529784">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1529792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1529795">}</span><br>
<span class="lineno"></span><span class="op" id="1529797">}</span>
</div>
</body>
</html>
