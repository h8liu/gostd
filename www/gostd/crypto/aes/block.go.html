<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html" class="current">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3983101">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3983156">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3983210">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3983261">//&nbsp;This&nbsp;Go&nbsp;implementation&nbsp;is&nbsp;derived&nbsp;in&nbsp;part&nbsp;from&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="3983325">//&nbsp;ANSI&nbsp;C&nbsp;implementation,&nbsp;which&nbsp;carries&nbsp;the&nbsp;following&nbsp;notice:</span><br>
<span class="lineno"></span><span class="comment" id="3983387">//</span><br>
<span class="lineno"></span><span class="comment" id="3983390">//&nbsp;&nbsp;&nbsp;&nbsp;rijndael-alg-fst.c</span><br>
<span class="lineno"></span><span class="comment" id="3983412">//</span><br>
<span class="lineno">10</span><span class="comment" id="3983415">//&nbsp;&nbsp;&nbsp;&nbsp;@version&nbsp;3.0&nbsp;(December&nbsp;2000)</span><br>
<span class="lineno"></span><span class="comment" id="3983447">//</span><br>
<span class="lineno"></span><span class="comment" id="3983450">//&nbsp;&nbsp;&nbsp;&nbsp;Optimised&nbsp;ANSI&nbsp;C&nbsp;code&nbsp;for&nbsp;the&nbsp;Rijndael&nbsp;cipher&nbsp;(now&nbsp;AES)</span><br>
<span class="lineno"></span><span class="comment" id="3983509">//</span><br>
<span class="lineno"></span><span class="comment" id="3983512">//&nbsp;&nbsp;&nbsp;&nbsp;@author&nbsp;Vincent&nbsp;Rijmen&nbsp;&lt;vincent.rijmen@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno">15</span><span class="comment" id="3983575">//&nbsp;&nbsp;&nbsp;&nbsp;@author&nbsp;Antoon&nbsp;Bosselaers&nbsp;&lt;antoon.bosselaers@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3983644">//&nbsp;&nbsp;&nbsp;&nbsp;@author&nbsp;Paulo&nbsp;Barreto&nbsp;&lt;paulo.barreto@terra.com.br&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3983698">//</span><br>
<span class="lineno"></span><span class="comment" id="3983701">//&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;code&nbsp;is&nbsp;hereby&nbsp;placed&nbsp;in&nbsp;the&nbsp;public&nbsp;domain.</span><br>
<span class="lineno"></span><span class="comment" id="3983753">//</span><br>
<span class="lineno">20</span><span class="comment" id="3983756">//&nbsp;&nbsp;&nbsp;&nbsp;THIS&nbsp;SOFTWARE&nbsp;IS&nbsp;PROVIDED&nbsp;BY&nbsp;THE&nbsp;AUTHORS&nbsp;&#39;&#39;AS&nbsp;IS&#39;&#39;&nbsp;AND&nbsp;ANY&nbsp;EXPRESS</span><br>
<span class="lineno"></span><span class="comment" id="3983826">//&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;IMPLIED&nbsp;WARRANTIES,&nbsp;INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;THE&nbsp;IMPLIED</span><br>
<span class="lineno"></span><span class="comment" id="3983895">//&nbsp;&nbsp;&nbsp;&nbsp;WARRANTIES&nbsp;OF&nbsp;MERCHANTABILITY&nbsp;AND&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE</span><br>
<span class="lineno"></span><span class="comment" id="3983965">//&nbsp;&nbsp;&nbsp;&nbsp;ARE&nbsp;DISCLAIMED.&nbsp;&nbsp;IN&nbsp;NO&nbsp;EVENT&nbsp;SHALL&nbsp;THE&nbsp;AUTHORS&nbsp;OR&nbsp;CONTRIBUTORS&nbsp;BE</span><br>
<span class="lineno"></span><span class="comment" id="3984034">//&nbsp;&nbsp;&nbsp;&nbsp;LIABLE&nbsp;FOR&nbsp;ANY&nbsp;DIRECT,&nbsp;INDIRECT,&nbsp;INCIDENTAL,&nbsp;SPECIAL,&nbsp;EXEMPLARY,&nbsp;OR</span><br>
<span class="lineno">25</span><span class="comment" id="3984105">//&nbsp;&nbsp;&nbsp;&nbsp;CONSEQUENTIAL&nbsp;DAMAGES&nbsp;(INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;PROCUREMENT&nbsp;OF</span><br>
<span class="lineno"></span><span class="comment" id="3984177">//&nbsp;&nbsp;&nbsp;&nbsp;SUBSTITUTE&nbsp;GOODS&nbsp;OR&nbsp;SERVICES;&nbsp;LOSS&nbsp;OF&nbsp;USE,&nbsp;DATA,&nbsp;OR&nbsp;PROFITS;&nbsp;OR</span><br>
<span class="lineno"></span><span class="comment" id="3984244">//&nbsp;&nbsp;&nbsp;&nbsp;BUSINESS&nbsp;INTERRUPTION)&nbsp;HOWEVER&nbsp;CAUSED&nbsp;AND&nbsp;ON&nbsp;ANY&nbsp;THEORY&nbsp;OF&nbsp;LIABILITY,</span><br>
<span class="lineno"></span><span class="comment" id="3984317">//&nbsp;&nbsp;&nbsp;&nbsp;WHETHER&nbsp;IN&nbsp;CONTRACT,&nbsp;STRICT&nbsp;LIABILITY,&nbsp;OR&nbsp;TORT&nbsp;(INCLUDING&nbsp;NEGLIGENCE</span><br>
<span class="lineno"></span><span class="comment" id="3984389">//&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;OTHERWISE)&nbsp;ARISING&nbsp;IN&nbsp;ANY&nbsp;WAY&nbsp;OUT&nbsp;OF&nbsp;THE&nbsp;USE&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE,</span><br>
<span class="lineno">30</span><span class="comment" id="3984458">//&nbsp;&nbsp;&nbsp;&nbsp;EVEN&nbsp;IF&nbsp;ADVISED&nbsp;OF&nbsp;THE&nbsp;POSSIBILITY&nbsp;OF&nbsp;SUCH&nbsp;DAMAGE.</span><br>
<span class="lineno"></span><span class="comment" id="3984512">//</span><br>
<span class="lineno"></span><span class="comment" id="3984515">//&nbsp;See&nbsp;FIPS&nbsp;197&nbsp;for&nbsp;specification,&nbsp;and&nbsp;see&nbsp;Daemen&nbsp;and&nbsp;Rijmen&#39;s&nbsp;Rijndael&nbsp;submission</span><br>
<span class="lineno"></span><span class="comment" id="3984598">//&nbsp;for&nbsp;implementation&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3984629">//&nbsp;&nbsp;&nbsp;&nbsp;http://www.csrc.nist.gov/publications/fips/fips197/fips-197.pdf</span><br>
<span class="lineno">35</span><span class="comment" id="3984696">//&nbsp;&nbsp;&nbsp;&nbsp;http://csrc.nist.gov/archive/aes/rijndael/Rijndael-ammended.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3984764">package</span>&nbsp;<span class="ident" id="3984772">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3984777">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">40</span><span class="keyword" id="3984844">func</span>&nbsp;<span class="ident" id="3984849">encryptBlockGo</span><span class="op" id="3984863">(</span><span class="ident" id="3984864">xk</span>&nbsp;<span class="op" id="3984867">[</span><span class="op" id="3984868">]</span><span class="builtintype" id="3984869">uint32</span><span class="op" id="3984875">,</span>&nbsp;<span class="ident" id="3984877">dst</span><span class="op" id="3984880">,</span>&nbsp;<span class="ident" id="3984882">src</span>&nbsp;<span class="op" id="3984886">[</span><span class="op" id="3984887">]</span><span class="builtintype" id="3984888">byte</span><span class="op" id="3984892">)</span>&nbsp;<span class="op" id="3984894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3984897">var</span>&nbsp;<span class="ident" id="3984901">s0</span><span class="op" id="3984903">,</span>&nbsp;<span class="ident" id="3984905">s1</span><span class="op" id="3984907">,</span>&nbsp;<span class="ident" id="3984909">s2</span><span class="op" id="3984911">,</span>&nbsp;<span class="ident" id="3984913">s3</span><span class="op" id="3984915">,</span>&nbsp;<span class="ident" id="3984917">t0</span><span class="op" id="3984919">,</span>&nbsp;<span class="ident" id="3984921">t1</span><span class="op" id="3984923">,</span>&nbsp;<span class="ident" id="3984925">t2</span><span class="op" id="3984927">,</span>&nbsp;<span class="ident" id="3984929">t3</span>&nbsp;<span class="builtintype" id="3984932">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3984941">s0</span>&nbsp;<span class="op" id="3984944">=</span>&nbsp;<span class="builtintype" id="3984946">uint32</span><span class="op" id="3984952">(</span><span class="ident" id="3984953">src</span><span class="op" id="3984956">[</span><span class="num" id="3984957">0</span><span class="op" id="3984958">]</span><span class="op" id="3984959">)</span><span class="op" id="3984960">&lt;&lt;</span><span class="num" id="3984962">24</span>&nbsp;<span class="op" id="3984965">|</span>&nbsp;<span class="builtintype" id="3984967">uint32</span><span class="op" id="3984973">(</span><span class="ident" id="3984974">src</span><span class="op" id="3984977">[</span><span class="num" id="3984978">1</span><span class="op" id="3984979">]</span><span class="op" id="3984980">)</span><span class="op" id="3984981">&lt;&lt;</span><span class="num" id="3984983">16</span>&nbsp;<span class="op" id="3984986">|</span>&nbsp;<span class="builtintype" id="3984988">uint32</span><span class="op" id="3984994">(</span><span class="ident" id="3984995">src</span><span class="op" id="3984998">[</span><span class="num" id="3984999">2</span><span class="op" id="3985000">]</span><span class="op" id="3985001">)</span><span class="op" id="3985002">&lt;&lt;</span><span class="num" id="3985004">8</span>&nbsp;<span class="op" id="3985006">|</span>&nbsp;<span class="builtintype" id="3985008">uint32</span><span class="op" id="3985014">(</span><span class="ident" id="3985015">src</span><span class="op" id="3985018">[</span><span class="num" id="3985019">3</span><span class="op" id="3985020">]</span><span class="op" id="3985021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985024">s1</span>&nbsp;<span class="op" id="3985027">=</span>&nbsp;<span class="builtintype" id="3985029">uint32</span><span class="op" id="3985035">(</span><span class="ident" id="3985036">src</span><span class="op" id="3985039">[</span><span class="num" id="3985040">4</span><span class="op" id="3985041">]</span><span class="op" id="3985042">)</span><span class="op" id="3985043">&lt;&lt;</span><span class="num" id="3985045">24</span>&nbsp;<span class="op" id="3985048">|</span>&nbsp;<span class="builtintype" id="3985050">uint32</span><span class="op" id="3985056">(</span><span class="ident" id="3985057">src</span><span class="op" id="3985060">[</span><span class="num" id="3985061">5</span><span class="op" id="3985062">]</span><span class="op" id="3985063">)</span><span class="op" id="3985064">&lt;&lt;</span><span class="num" id="3985066">16</span>&nbsp;<span class="op" id="3985069">|</span>&nbsp;<span class="builtintype" id="3985071">uint32</span><span class="op" id="3985077">(</span><span class="ident" id="3985078">src</span><span class="op" id="3985081">[</span><span class="num" id="3985082">6</span><span class="op" id="3985083">]</span><span class="op" id="3985084">)</span><span class="op" id="3985085">&lt;&lt;</span><span class="num" id="3985087">8</span>&nbsp;<span class="op" id="3985089">|</span>&nbsp;<span class="builtintype" id="3985091">uint32</span><span class="op" id="3985097">(</span><span class="ident" id="3985098">src</span><span class="op" id="3985101">[</span><span class="num" id="3985102">7</span><span class="op" id="3985103">]</span><span class="op" id="3985104">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985107">s2</span>&nbsp;<span class="op" id="3985110">=</span>&nbsp;<span class="builtintype" id="3985112">uint32</span><span class="op" id="3985118">(</span><span class="ident" id="3985119">src</span><span class="op" id="3985122">[</span><span class="num" id="3985123">8</span><span class="op" id="3985124">]</span><span class="op" id="3985125">)</span><span class="op" id="3985126">&lt;&lt;</span><span class="num" id="3985128">24</span>&nbsp;<span class="op" id="3985131">|</span>&nbsp;<span class="builtintype" id="3985133">uint32</span><span class="op" id="3985139">(</span><span class="ident" id="3985140">src</span><span class="op" id="3985143">[</span><span class="num" id="3985144">9</span><span class="op" id="3985145">]</span><span class="op" id="3985146">)</span><span class="op" id="3985147">&lt;&lt;</span><span class="num" id="3985149">16</span>&nbsp;<span class="op" id="3985152">|</span>&nbsp;<span class="builtintype" id="3985154">uint32</span><span class="op" id="3985160">(</span><span class="ident" id="3985161">src</span><span class="op" id="3985164">[</span><span class="num" id="3985165">10</span><span class="op" id="3985167">]</span><span class="op" id="3985168">)</span><span class="op" id="3985169">&lt;&lt;</span><span class="num" id="3985171">8</span>&nbsp;<span class="op" id="3985173">|</span>&nbsp;<span class="builtintype" id="3985175">uint32</span><span class="op" id="3985181">(</span><span class="ident" id="3985182">src</span><span class="op" id="3985185">[</span><span class="num" id="3985186">11</span><span class="op" id="3985188">]</span><span class="op" id="3985189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985192">s3</span>&nbsp;<span class="op" id="3985195">=</span>&nbsp;<span class="builtintype" id="3985197">uint32</span><span class="op" id="3985203">(</span><span class="ident" id="3985204">src</span><span class="op" id="3985207">[</span><span class="num" id="3985208">12</span><span class="op" id="3985210">]</span><span class="op" id="3985211">)</span><span class="op" id="3985212">&lt;&lt;</span><span class="num" id="3985214">24</span>&nbsp;<span class="op" id="3985217">|</span>&nbsp;<span class="builtintype" id="3985219">uint32</span><span class="op" id="3985225">(</span><span class="ident" id="3985226">src</span><span class="op" id="3985229">[</span><span class="num" id="3985230">13</span><span class="op" id="3985232">]</span><span class="op" id="3985233">)</span><span class="op" id="3985234">&lt;&lt;</span><span class="num" id="3985236">16</span>&nbsp;<span class="op" id="3985239">|</span>&nbsp;<span class="builtintype" id="3985241">uint32</span><span class="op" id="3985247">(</span><span class="ident" id="3985248">src</span><span class="op" id="3985251">[</span><span class="num" id="3985252">14</span><span class="op" id="3985254">]</span><span class="op" id="3985255">)</span><span class="op" id="3985256">&lt;&lt;</span><span class="num" id="3985258">8</span>&nbsp;<span class="op" id="3985260">|</span>&nbsp;<span class="builtintype" id="3985262">uint32</span><span class="op" id="3985268">(</span><span class="ident" id="3985269">src</span><span class="op" id="3985272">[</span><span class="num" id="3985273">15</span><span class="op" id="3985275">]</span><span class="op" id="3985276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3985280">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985322">s0</span>&nbsp;<span class="op" id="3985325">^=</span>&nbsp;<span class="ident" id="3985328">xk</span><span class="op" id="3985330">[</span><span class="num" id="3985331">0</span><span class="op" id="3985332">]</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985335">s1</span>&nbsp;<span class="op" id="3985338">^=</span>&nbsp;<span class="ident" id="3985341">xk</span><span class="op" id="3985343">[</span><span class="num" id="3985344">1</span><span class="op" id="3985345">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985348">s2</span>&nbsp;<span class="op" id="3985351">^=</span>&nbsp;<span class="ident" id="3985354">xk</span><span class="op" id="3985356">[</span><span class="num" id="3985357">2</span><span class="op" id="3985358">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985361">s3</span>&nbsp;<span class="op" id="3985364">^=</span>&nbsp;<span class="ident" id="3985367">xk</span><span class="op" id="3985369">[</span><span class="num" id="3985370">3</span><span class="op" id="3985371">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3985375">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3985415">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985470">nr</span>&nbsp;<span class="op" id="3985473">:=</span>&nbsp;<span class="builtinfunc" id="3985476">len</span><span class="op" id="3985479">(</span><span class="ident" id="3985480">xk</span><span class="op" id="3985482">)</span><span class="op" id="3985483">/</span><span class="num" id="3985484">4</span>&nbsp;<span class="op" id="3985486">-</span>&nbsp;<span class="num" id="3985488">2</span>&nbsp;<span class="comment" id="3985490">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985525">k</span>&nbsp;<span class="op" id="3985527">:=</span>&nbsp;<span class="num" id="3985530">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3985533">for</span>&nbsp;<span class="ident" id="3985537">r</span>&nbsp;<span class="op" id="3985539">:=</span>&nbsp;<span class="num" id="3985542">0</span><span class="op" id="3985543">;</span>&nbsp;<span class="ident" id="3985545">r</span>&nbsp;<span class="op" id="3985547">&lt;</span>&nbsp;<span class="ident" id="3985549">nr</span><span class="op" id="3985551">;</span>&nbsp;<span class="ident" id="3985553">r</span><span class="op" id="3985554">++</span>&nbsp;<span class="op" id="3985557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985561">t0</span>&nbsp;<span class="op" id="3985564">=</span>&nbsp;<span class="ident" id="3985566">xk</span><span class="op" id="3985568">[</span><span class="ident" id="3985569">k</span><span class="op" id="3985570">+</span><span class="num" id="3985571">0</span><span class="op" id="3985572">]</span>&nbsp;<span class="op" id="3985574">^</span>&nbsp;<span class="ident" id="3985576">te0</span><span class="op" id="3985579">[</span><span class="builtintype" id="3985580">uint8</span><span class="op" id="3985585">(</span><span class="ident" id="3985586">s0</span><span class="op" id="3985588">&gt;&gt;</span><span class="num" id="3985590">24</span><span class="op" id="3985592">)</span><span class="op" id="3985593">]</span>&nbsp;<span class="op" id="3985595">^</span>&nbsp;<span class="ident" id="3985597">te1</span><span class="op" id="3985600">[</span><span class="builtintype" id="3985601">uint8</span><span class="op" id="3985606">(</span><span class="ident" id="3985607">s1</span><span class="op" id="3985609">&gt;&gt;</span><span class="num" id="3985611">16</span><span class="op" id="3985613">)</span><span class="op" id="3985614">]</span>&nbsp;<span class="op" id="3985616">^</span>&nbsp;<span class="ident" id="3985618">te2</span><span class="op" id="3985621">[</span><span class="builtintype" id="3985622">uint8</span><span class="op" id="3985627">(</span><span class="ident" id="3985628">s2</span><span class="op" id="3985630">&gt;&gt;</span><span class="num" id="3985632">8</span><span class="op" id="3985633">)</span><span class="op" id="3985634">]</span>&nbsp;<span class="op" id="3985636">^</span>&nbsp;<span class="ident" id="3985638">te3</span><span class="op" id="3985641">[</span><span class="builtintype" id="3985642">uint8</span><span class="op" id="3985647">(</span><span class="ident" id="3985648">s3</span><span class="op" id="3985650">)</span><span class="op" id="3985651">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985655">t1</span>&nbsp;<span class="op" id="3985658">=</span>&nbsp;<span class="ident" id="3985660">xk</span><span class="op" id="3985662">[</span><span class="ident" id="3985663">k</span><span class="op" id="3985664">+</span><span class="num" id="3985665">1</span><span class="op" id="3985666">]</span>&nbsp;<span class="op" id="3985668">^</span>&nbsp;<span class="ident" id="3985670">te0</span><span class="op" id="3985673">[</span><span class="builtintype" id="3985674">uint8</span><span class="op" id="3985679">(</span><span class="ident" id="3985680">s1</span><span class="op" id="3985682">&gt;&gt;</span><span class="num" id="3985684">24</span><span class="op" id="3985686">)</span><span class="op" id="3985687">]</span>&nbsp;<span class="op" id="3985689">^</span>&nbsp;<span class="ident" id="3985691">te1</span><span class="op" id="3985694">[</span><span class="builtintype" id="3985695">uint8</span><span class="op" id="3985700">(</span><span class="ident" id="3985701">s2</span><span class="op" id="3985703">&gt;&gt;</span><span class="num" id="3985705">16</span><span class="op" id="3985707">)</span><span class="op" id="3985708">]</span>&nbsp;<span class="op" id="3985710">^</span>&nbsp;<span class="ident" id="3985712">te2</span><span class="op" id="3985715">[</span><span class="builtintype" id="3985716">uint8</span><span class="op" id="3985721">(</span><span class="ident" id="3985722">s3</span><span class="op" id="3985724">&gt;&gt;</span><span class="num" id="3985726">8</span><span class="op" id="3985727">)</span><span class="op" id="3985728">]</span>&nbsp;<span class="op" id="3985730">^</span>&nbsp;<span class="ident" id="3985732">te3</span><span class="op" id="3985735">[</span><span class="builtintype" id="3985736">uint8</span><span class="op" id="3985741">(</span><span class="ident" id="3985742">s0</span><span class="op" id="3985744">)</span><span class="op" id="3985745">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985749">t2</span>&nbsp;<span class="op" id="3985752">=</span>&nbsp;<span class="ident" id="3985754">xk</span><span class="op" id="3985756">[</span><span class="ident" id="3985757">k</span><span class="op" id="3985758">+</span><span class="num" id="3985759">2</span><span class="op" id="3985760">]</span>&nbsp;<span class="op" id="3985762">^</span>&nbsp;<span class="ident" id="3985764">te0</span><span class="op" id="3985767">[</span><span class="builtintype" id="3985768">uint8</span><span class="op" id="3985773">(</span><span class="ident" id="3985774">s2</span><span class="op" id="3985776">&gt;&gt;</span><span class="num" id="3985778">24</span><span class="op" id="3985780">)</span><span class="op" id="3985781">]</span>&nbsp;<span class="op" id="3985783">^</span>&nbsp;<span class="ident" id="3985785">te1</span><span class="op" id="3985788">[</span><span class="builtintype" id="3985789">uint8</span><span class="op" id="3985794">(</span><span class="ident" id="3985795">s3</span><span class="op" id="3985797">&gt;&gt;</span><span class="num" id="3985799">16</span><span class="op" id="3985801">)</span><span class="op" id="3985802">]</span>&nbsp;<span class="op" id="3985804">^</span>&nbsp;<span class="ident" id="3985806">te2</span><span class="op" id="3985809">[</span><span class="builtintype" id="3985810">uint8</span><span class="op" id="3985815">(</span><span class="ident" id="3985816">s0</span><span class="op" id="3985818">&gt;&gt;</span><span class="num" id="3985820">8</span><span class="op" id="3985821">)</span><span class="op" id="3985822">]</span>&nbsp;<span class="op" id="3985824">^</span>&nbsp;<span class="ident" id="3985826">te3</span><span class="op" id="3985829">[</span><span class="builtintype" id="3985830">uint8</span><span class="op" id="3985835">(</span><span class="ident" id="3985836">s1</span><span class="op" id="3985838">)</span><span class="op" id="3985839">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985843">t3</span>&nbsp;<span class="op" id="3985846">=</span>&nbsp;<span class="ident" id="3985848">xk</span><span class="op" id="3985850">[</span><span class="ident" id="3985851">k</span><span class="op" id="3985852">+</span><span class="num" id="3985853">3</span><span class="op" id="3985854">]</span>&nbsp;<span class="op" id="3985856">^</span>&nbsp;<span class="ident" id="3985858">te0</span><span class="op" id="3985861">[</span><span class="builtintype" id="3985862">uint8</span><span class="op" id="3985867">(</span><span class="ident" id="3985868">s3</span><span class="op" id="3985870">&gt;&gt;</span><span class="num" id="3985872">24</span><span class="op" id="3985874">)</span><span class="op" id="3985875">]</span>&nbsp;<span class="op" id="3985877">^</span>&nbsp;<span class="ident" id="3985879">te1</span><span class="op" id="3985882">[</span><span class="builtintype" id="3985883">uint8</span><span class="op" id="3985888">(</span><span class="ident" id="3985889">s0</span><span class="op" id="3985891">&gt;&gt;</span><span class="num" id="3985893">16</span><span class="op" id="3985895">)</span><span class="op" id="3985896">]</span>&nbsp;<span class="op" id="3985898">^</span>&nbsp;<span class="ident" id="3985900">te2</span><span class="op" id="3985903">[</span><span class="builtintype" id="3985904">uint8</span><span class="op" id="3985909">(</span><span class="ident" id="3985910">s1</span><span class="op" id="3985912">&gt;&gt;</span><span class="num" id="3985914">8</span><span class="op" id="3985915">)</span><span class="op" id="3985916">]</span>&nbsp;<span class="op" id="3985918">^</span>&nbsp;<span class="ident" id="3985920">te3</span><span class="op" id="3985923">[</span><span class="builtintype" id="3985924">uint8</span><span class="op" id="3985929">(</span><span class="ident" id="3985930">s2</span><span class="op" id="3985932">)</span><span class="op" id="3985933">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985937">k</span>&nbsp;<span class="op" id="3985939">+=</span>&nbsp;<span class="num" id="3985942">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3985946">s0</span><span class="op" id="3985948">,</span>&nbsp;<span class="ident" id="3985950">s1</span><span class="op" id="3985952">,</span>&nbsp;<span class="ident" id="3985954">s2</span><span class="op" id="3985956">,</span>&nbsp;<span class="ident" id="3985958">s3</span>&nbsp;<span class="op" id="3985961">=</span>&nbsp;<span class="ident" id="3985963">t0</span><span class="op" id="3985965">,</span>&nbsp;<span class="ident" id="3985967">t1</span><span class="op" id="3985969">,</span>&nbsp;<span class="ident" id="3985971">t2</span><span class="op" id="3985973">,</span>&nbsp;<span class="ident" id="3985975">t3</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3985979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3985983">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986046">s0</span>&nbsp;<span class="op" id="3986049">=</span>&nbsp;<span class="builtintype" id="3986051">uint32</span><span class="op" id="3986057">(</span><span class="ident" id="3986058">sbox0</span><span class="op" id="3986063">[</span><span class="ident" id="3986064">t0</span><span class="op" id="3986066">&gt;&gt;</span><span class="num" id="3986068">24</span><span class="op" id="3986070">]</span><span class="op" id="3986071">)</span><span class="op" id="3986072">&lt;&lt;</span><span class="num" id="3986074">24</span>&nbsp;<span class="op" id="3986077">|</span>&nbsp;<span class="builtintype" id="3986079">uint32</span><span class="op" id="3986085">(</span><span class="ident" id="3986086">sbox0</span><span class="op" id="3986091">[</span><span class="ident" id="3986092">t1</span><span class="op" id="3986094">&gt;&gt;</span><span class="num" id="3986096">16</span><span class="op" id="3986098">&amp;</span><span class="num" id="3986099">0xff</span><span class="op" id="3986103">]</span><span class="op" id="3986104">)</span><span class="op" id="3986105">&lt;&lt;</span><span class="num" id="3986107">16</span>&nbsp;<span class="op" id="3986110">|</span>&nbsp;<span class="builtintype" id="3986112">uint32</span><span class="op" id="3986118">(</span><span class="ident" id="3986119">sbox0</span><span class="op" id="3986124">[</span><span class="ident" id="3986125">t2</span><span class="op" id="3986127">&gt;&gt;</span><span class="num" id="3986129">8</span><span class="op" id="3986130">&amp;</span><span class="num" id="3986131">0xff</span><span class="op" id="3986135">]</span><span class="op" id="3986136">)</span><span class="op" id="3986137">&lt;&lt;</span><span class="num" id="3986139">8</span>&nbsp;<span class="op" id="3986141">|</span>&nbsp;<span class="builtintype" id="3986143">uint32</span><span class="op" id="3986149">(</span><span class="ident" id="3986150">sbox0</span><span class="op" id="3986155">[</span><span class="ident" id="3986156">t3</span><span class="op" id="3986158">&amp;</span><span class="num" id="3986159">0xff</span><span class="op" id="3986163">]</span><span class="op" id="3986164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986167">s1</span>&nbsp;<span class="op" id="3986170">=</span>&nbsp;<span class="builtintype" id="3986172">uint32</span><span class="op" id="3986178">(</span><span class="ident" id="3986179">sbox0</span><span class="op" id="3986184">[</span><span class="ident" id="3986185">t1</span><span class="op" id="3986187">&gt;&gt;</span><span class="num" id="3986189">24</span><span class="op" id="3986191">]</span><span class="op" id="3986192">)</span><span class="op" id="3986193">&lt;&lt;</span><span class="num" id="3986195">24</span>&nbsp;<span class="op" id="3986198">|</span>&nbsp;<span class="builtintype" id="3986200">uint32</span><span class="op" id="3986206">(</span><span class="ident" id="3986207">sbox0</span><span class="op" id="3986212">[</span><span class="ident" id="3986213">t2</span><span class="op" id="3986215">&gt;&gt;</span><span class="num" id="3986217">16</span><span class="op" id="3986219">&amp;</span><span class="num" id="3986220">0xff</span><span class="op" id="3986224">]</span><span class="op" id="3986225">)</span><span class="op" id="3986226">&lt;&lt;</span><span class="num" id="3986228">16</span>&nbsp;<span class="op" id="3986231">|</span>&nbsp;<span class="builtintype" id="3986233">uint32</span><span class="op" id="3986239">(</span><span class="ident" id="3986240">sbox0</span><span class="op" id="3986245">[</span><span class="ident" id="3986246">t3</span><span class="op" id="3986248">&gt;&gt;</span><span class="num" id="3986250">8</span><span class="op" id="3986251">&amp;</span><span class="num" id="3986252">0xff</span><span class="op" id="3986256">]</span><span class="op" id="3986257">)</span><span class="op" id="3986258">&lt;&lt;</span><span class="num" id="3986260">8</span>&nbsp;<span class="op" id="3986262">|</span>&nbsp;<span class="builtintype" id="3986264">uint32</span><span class="op" id="3986270">(</span><span class="ident" id="3986271">sbox0</span><span class="op" id="3986276">[</span><span class="ident" id="3986277">t0</span><span class="op" id="3986279">&amp;</span><span class="num" id="3986280">0xff</span><span class="op" id="3986284">]</span><span class="op" id="3986285">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986288">s2</span>&nbsp;<span class="op" id="3986291">=</span>&nbsp;<span class="builtintype" id="3986293">uint32</span><span class="op" id="3986299">(</span><span class="ident" id="3986300">sbox0</span><span class="op" id="3986305">[</span><span class="ident" id="3986306">t2</span><span class="op" id="3986308">&gt;&gt;</span><span class="num" id="3986310">24</span><span class="op" id="3986312">]</span><span class="op" id="3986313">)</span><span class="op" id="3986314">&lt;&lt;</span><span class="num" id="3986316">24</span>&nbsp;<span class="op" id="3986319">|</span>&nbsp;<span class="builtintype" id="3986321">uint32</span><span class="op" id="3986327">(</span><span class="ident" id="3986328">sbox0</span><span class="op" id="3986333">[</span><span class="ident" id="3986334">t3</span><span class="op" id="3986336">&gt;&gt;</span><span class="num" id="3986338">16</span><span class="op" id="3986340">&amp;</span><span class="num" id="3986341">0xff</span><span class="op" id="3986345">]</span><span class="op" id="3986346">)</span><span class="op" id="3986347">&lt;&lt;</span><span class="num" id="3986349">16</span>&nbsp;<span class="op" id="3986352">|</span>&nbsp;<span class="builtintype" id="3986354">uint32</span><span class="op" id="3986360">(</span><span class="ident" id="3986361">sbox0</span><span class="op" id="3986366">[</span><span class="ident" id="3986367">t0</span><span class="op" id="3986369">&gt;&gt;</span><span class="num" id="3986371">8</span><span class="op" id="3986372">&amp;</span><span class="num" id="3986373">0xff</span><span class="op" id="3986377">]</span><span class="op" id="3986378">)</span><span class="op" id="3986379">&lt;&lt;</span><span class="num" id="3986381">8</span>&nbsp;<span class="op" id="3986383">|</span>&nbsp;<span class="builtintype" id="3986385">uint32</span><span class="op" id="3986391">(</span><span class="ident" id="3986392">sbox0</span><span class="op" id="3986397">[</span><span class="ident" id="3986398">t1</span><span class="op" id="3986400">&amp;</span><span class="num" id="3986401">0xff</span><span class="op" id="3986405">]</span><span class="op" id="3986406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986409">s3</span>&nbsp;<span class="op" id="3986412">=</span>&nbsp;<span class="builtintype" id="3986414">uint32</span><span class="op" id="3986420">(</span><span class="ident" id="3986421">sbox0</span><span class="op" id="3986426">[</span><span class="ident" id="3986427">t3</span><span class="op" id="3986429">&gt;&gt;</span><span class="num" id="3986431">24</span><span class="op" id="3986433">]</span><span class="op" id="3986434">)</span><span class="op" id="3986435">&lt;&lt;</span><span class="num" id="3986437">24</span>&nbsp;<span class="op" id="3986440">|</span>&nbsp;<span class="builtintype" id="3986442">uint32</span><span class="op" id="3986448">(</span><span class="ident" id="3986449">sbox0</span><span class="op" id="3986454">[</span><span class="ident" id="3986455">t0</span><span class="op" id="3986457">&gt;&gt;</span><span class="num" id="3986459">16</span><span class="op" id="3986461">&amp;</span><span class="num" id="3986462">0xff</span><span class="op" id="3986466">]</span><span class="op" id="3986467">)</span><span class="op" id="3986468">&lt;&lt;</span><span class="num" id="3986470">16</span>&nbsp;<span class="op" id="3986473">|</span>&nbsp;<span class="builtintype" id="3986475">uint32</span><span class="op" id="3986481">(</span><span class="ident" id="3986482">sbox0</span><span class="op" id="3986487">[</span><span class="ident" id="3986488">t1</span><span class="op" id="3986490">&gt;&gt;</span><span class="num" id="3986492">8</span><span class="op" id="3986493">&amp;</span><span class="num" id="3986494">0xff</span><span class="op" id="3986498">]</span><span class="op" id="3986499">)</span><span class="op" id="3986500">&lt;&lt;</span><span class="num" id="3986502">8</span>&nbsp;<span class="op" id="3986504">|</span>&nbsp;<span class="builtintype" id="3986506">uint32</span><span class="op" id="3986512">(</span><span class="ident" id="3986513">sbox0</span><span class="op" id="3986518">[</span><span class="ident" id="3986519">t2</span><span class="op" id="3986521">&amp;</span><span class="num" id="3986522">0xff</span><span class="op" id="3986526">]</span><span class="op" id="3986527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986531">s0</span>&nbsp;<span class="op" id="3986534">^=</span>&nbsp;<span class="ident" id="3986537">xk</span><span class="op" id="3986539">[</span><span class="ident" id="3986540">k</span><span class="op" id="3986541">+</span><span class="num" id="3986542">0</span><span class="op" id="3986543">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986546">s1</span>&nbsp;<span class="op" id="3986549">^=</span>&nbsp;<span class="ident" id="3986552">xk</span><span class="op" id="3986554">[</span><span class="ident" id="3986555">k</span><span class="op" id="3986556">+</span><span class="num" id="3986557">1</span><span class="op" id="3986558">]</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986561">s2</span>&nbsp;<span class="op" id="3986564">^=</span>&nbsp;<span class="ident" id="3986567">xk</span><span class="op" id="3986569">[</span><span class="ident" id="3986570">k</span><span class="op" id="3986571">+</span><span class="num" id="3986572">2</span><span class="op" id="3986573">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986576">s3</span>&nbsp;<span class="op" id="3986579">^=</span>&nbsp;<span class="ident" id="3986582">xk</span><span class="op" id="3986584">[</span><span class="ident" id="3986585">k</span><span class="op" id="3986586">+</span><span class="num" id="3986587">3</span><span class="op" id="3986588">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986592">dst</span><span class="op" id="3986595">[</span><span class="num" id="3986596">0</span><span class="op" id="3986597">]</span><span class="op" id="3986598">,</span>&nbsp;<span class="ident" id="3986600">dst</span><span class="op" id="3986603">[</span><span class="num" id="3986604">1</span><span class="op" id="3986605">]</span><span class="op" id="3986606">,</span>&nbsp;<span class="ident" id="3986608">dst</span><span class="op" id="3986611">[</span><span class="num" id="3986612">2</span><span class="op" id="3986613">]</span><span class="op" id="3986614">,</span>&nbsp;<span class="ident" id="3986616">dst</span><span class="op" id="3986619">[</span><span class="num" id="3986620">3</span><span class="op" id="3986621">]</span>&nbsp;<span class="op" id="3986623">=</span>&nbsp;<span class="builtintype" id="3986625">byte</span><span class="op" id="3986629">(</span><span class="ident" id="3986630">s0</span><span class="op" id="3986632">&gt;&gt;</span><span class="num" id="3986634">24</span><span class="op" id="3986636">)</span><span class="op" id="3986637">,</span>&nbsp;<span class="builtintype" id="3986639">byte</span><span class="op" id="3986643">(</span><span class="ident" id="3986644">s0</span><span class="op" id="3986646">&gt;&gt;</span><span class="num" id="3986648">16</span><span class="op" id="3986650">)</span><span class="op" id="3986651">,</span>&nbsp;<span class="builtintype" id="3986653">byte</span><span class="op" id="3986657">(</span><span class="ident" id="3986658">s0</span><span class="op" id="3986660">&gt;&gt;</span><span class="num" id="3986662">8</span><span class="op" id="3986663">)</span><span class="op" id="3986664">,</span>&nbsp;<span class="builtintype" id="3986666">byte</span><span class="op" id="3986670">(</span><span class="ident" id="3986671">s0</span><span class="op" id="3986673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986676">dst</span><span class="op" id="3986679">[</span><span class="num" id="3986680">4</span><span class="op" id="3986681">]</span><span class="op" id="3986682">,</span>&nbsp;<span class="ident" id="3986684">dst</span><span class="op" id="3986687">[</span><span class="num" id="3986688">5</span><span class="op" id="3986689">]</span><span class="op" id="3986690">,</span>&nbsp;<span class="ident" id="3986692">dst</span><span class="op" id="3986695">[</span><span class="num" id="3986696">6</span><span class="op" id="3986697">]</span><span class="op" id="3986698">,</span>&nbsp;<span class="ident" id="3986700">dst</span><span class="op" id="3986703">[</span><span class="num" id="3986704">7</span><span class="op" id="3986705">]</span>&nbsp;<span class="op" id="3986707">=</span>&nbsp;<span class="builtintype" id="3986709">byte</span><span class="op" id="3986713">(</span><span class="ident" id="3986714">s1</span><span class="op" id="3986716">&gt;&gt;</span><span class="num" id="3986718">24</span><span class="op" id="3986720">)</span><span class="op" id="3986721">,</span>&nbsp;<span class="builtintype" id="3986723">byte</span><span class="op" id="3986727">(</span><span class="ident" id="3986728">s1</span><span class="op" id="3986730">&gt;&gt;</span><span class="num" id="3986732">16</span><span class="op" id="3986734">)</span><span class="op" id="3986735">,</span>&nbsp;<span class="builtintype" id="3986737">byte</span><span class="op" id="3986741">(</span><span class="ident" id="3986742">s1</span><span class="op" id="3986744">&gt;&gt;</span><span class="num" id="3986746">8</span><span class="op" id="3986747">)</span><span class="op" id="3986748">,</span>&nbsp;<span class="builtintype" id="3986750">byte</span><span class="op" id="3986754">(</span><span class="ident" id="3986755">s1</span><span class="op" id="3986757">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986760">dst</span><span class="op" id="3986763">[</span><span class="num" id="3986764">8</span><span class="op" id="3986765">]</span><span class="op" id="3986766">,</span>&nbsp;<span class="ident" id="3986768">dst</span><span class="op" id="3986771">[</span><span class="num" id="3986772">9</span><span class="op" id="3986773">]</span><span class="op" id="3986774">,</span>&nbsp;<span class="ident" id="3986776">dst</span><span class="op" id="3986779">[</span><span class="num" id="3986780">10</span><span class="op" id="3986782">]</span><span class="op" id="3986783">,</span>&nbsp;<span class="ident" id="3986785">dst</span><span class="op" id="3986788">[</span><span class="num" id="3986789">11</span><span class="op" id="3986791">]</span>&nbsp;<span class="op" id="3986793">=</span>&nbsp;<span class="builtintype" id="3986795">byte</span><span class="op" id="3986799">(</span><span class="ident" id="3986800">s2</span><span class="op" id="3986802">&gt;&gt;</span><span class="num" id="3986804">24</span><span class="op" id="3986806">)</span><span class="op" id="3986807">,</span>&nbsp;<span class="builtintype" id="3986809">byte</span><span class="op" id="3986813">(</span><span class="ident" id="3986814">s2</span><span class="op" id="3986816">&gt;&gt;</span><span class="num" id="3986818">16</span><span class="op" id="3986820">)</span><span class="op" id="3986821">,</span>&nbsp;<span class="builtintype" id="3986823">byte</span><span class="op" id="3986827">(</span><span class="ident" id="3986828">s2</span><span class="op" id="3986830">&gt;&gt;</span><span class="num" id="3986832">8</span><span class="op" id="3986833">)</span><span class="op" id="3986834">,</span>&nbsp;<span class="builtintype" id="3986836">byte</span><span class="op" id="3986840">(</span><span class="ident" id="3986841">s2</span><span class="op" id="3986843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3986846">dst</span><span class="op" id="3986849">[</span><span class="num" id="3986850">12</span><span class="op" id="3986852">]</span><span class="op" id="3986853">,</span>&nbsp;<span class="ident" id="3986855">dst</span><span class="op" id="3986858">[</span><span class="num" id="3986859">13</span><span class="op" id="3986861">]</span><span class="op" id="3986862">,</span>&nbsp;<span class="ident" id="3986864">dst</span><span class="op" id="3986867">[</span><span class="num" id="3986868">14</span><span class="op" id="3986870">]</span><span class="op" id="3986871">,</span>&nbsp;<span class="ident" id="3986873">dst</span><span class="op" id="3986876">[</span><span class="num" id="3986877">15</span><span class="op" id="3986879">]</span>&nbsp;<span class="op" id="3986881">=</span>&nbsp;<span class="builtintype" id="3986883">byte</span><span class="op" id="3986887">(</span><span class="ident" id="3986888">s3</span><span class="op" id="3986890">&gt;&gt;</span><span class="num" id="3986892">24</span><span class="op" id="3986894">)</span><span class="op" id="3986895">,</span>&nbsp;<span class="builtintype" id="3986897">byte</span><span class="op" id="3986901">(</span><span class="ident" id="3986902">s3</span><span class="op" id="3986904">&gt;&gt;</span><span class="num" id="3986906">16</span><span class="op" id="3986908">)</span><span class="op" id="3986909">,</span>&nbsp;<span class="builtintype" id="3986911">byte</span><span class="op" id="3986915">(</span><span class="ident" id="3986916">s3</span><span class="op" id="3986918">&gt;&gt;</span><span class="num" id="3986920">8</span><span class="op" id="3986921">)</span><span class="op" id="3986922">,</span>&nbsp;<span class="builtintype" id="3986924">byte</span><span class="op" id="3986928">(</span><span class="ident" id="3986929">s3</span><span class="op" id="3986931">)</span><br>
<span class="lineno"></span><span class="op" id="3986933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3986936">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">85</span><span class="keyword" id="3987003">func</span>&nbsp;<span class="ident" id="3987008">decryptBlockGo</span><span class="op" id="3987022">(</span><span class="ident" id="3987023">xk</span>&nbsp;<span class="op" id="3987026">[</span><span class="op" id="3987027">]</span><span class="builtintype" id="3987028">uint32</span><span class="op" id="3987034">,</span>&nbsp;<span class="ident" id="3987036">dst</span><span class="op" id="3987039">,</span>&nbsp;<span class="ident" id="3987041">src</span>&nbsp;<span class="op" id="3987045">[</span><span class="op" id="3987046">]</span><span class="builtintype" id="3987047">byte</span><span class="op" id="3987051">)</span>&nbsp;<span class="op" id="3987053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3987056">var</span>&nbsp;<span class="ident" id="3987060">s0</span><span class="op" id="3987062">,</span>&nbsp;<span class="ident" id="3987064">s1</span><span class="op" id="3987066">,</span>&nbsp;<span class="ident" id="3987068">s2</span><span class="op" id="3987070">,</span>&nbsp;<span class="ident" id="3987072">s3</span><span class="op" id="3987074">,</span>&nbsp;<span class="ident" id="3987076">t0</span><span class="op" id="3987078">,</span>&nbsp;<span class="ident" id="3987080">t1</span><span class="op" id="3987082">,</span>&nbsp;<span class="ident" id="3987084">t2</span><span class="op" id="3987086">,</span>&nbsp;<span class="ident" id="3987088">t3</span>&nbsp;<span class="builtintype" id="3987091">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3987100">s0</span>&nbsp;<span class="op" id="3987103">=</span>&nbsp;<span class="builtintype" id="3987105">uint32</span><span class="op" id="3987111">(</span><span class="ident" id="3987112">src</span><span class="op" id="3987115">[</span><span class="num" id="3987116">0</span><span class="op" id="3987117">]</span><span class="op" id="3987118">)</span><span class="op" id="3987119">&lt;&lt;</span><span class="num" id="3987121">24</span>&nbsp;<span class="op" id="3987124">|</span>&nbsp;<span class="builtintype" id="3987126">uint32</span><span class="op" id="3987132">(</span><span class="ident" id="3987133">src</span><span class="op" id="3987136">[</span><span class="num" id="3987137">1</span><span class="op" id="3987138">]</span><span class="op" id="3987139">)</span><span class="op" id="3987140">&lt;&lt;</span><span class="num" id="3987142">16</span>&nbsp;<span class="op" id="3987145">|</span>&nbsp;<span class="builtintype" id="3987147">uint32</span><span class="op" id="3987153">(</span><span class="ident" id="3987154">src</span><span class="op" id="3987157">[</span><span class="num" id="3987158">2</span><span class="op" id="3987159">]</span><span class="op" id="3987160">)</span><span class="op" id="3987161">&lt;&lt;</span><span class="num" id="3987163">8</span>&nbsp;<span class="op" id="3987165">|</span>&nbsp;<span class="builtintype" id="3987167">uint32</span><span class="op" id="3987173">(</span><span class="ident" id="3987174">src</span><span class="op" id="3987177">[</span><span class="num" id="3987178">3</span><span class="op" id="3987179">]</span><span class="op" id="3987180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3987183">s1</span>&nbsp;<span class="op" id="3987186">=</span>&nbsp;<span class="builtintype" id="3987188">uint32</span><span class="op" id="3987194">(</span><span class="ident" id="3987195">src</span><span class="op" id="3987198">[</span><span class="num" id="3987199">4</span><span class="op" id="3987200">]</span><span class="op" id="3987201">)</span><span class="op" id="3987202">&lt;&lt;</span><span class="num" id="3987204">24</span>&nbsp;<span class="op" id="3987207">|</span>&nbsp;<span class="builtintype" id="3987209">uint32</span><span class="op" id="3987215">(</span><span class="ident" id="3987216">src</span><span class="op" id="3987219">[</span><span class="num" id="3987220">5</span><span class="op" id="3987221">]</span><span class="op" id="3987222">)</span><span class="op" id="3987223">&lt;&lt;</span><span class="num" id="3987225">16</span>&nbsp;<span class="op" id="3987228">|</span>&nbsp;<span class="builtintype" id="3987230">uint32</span><span class="op" id="3987236">(</span><span class="ident" id="3987237">src</span><span class="op" id="3987240">[</span><span class="num" id="3987241">6</span><span class="op" id="3987242">]</span><span class="op" id="3987243">)</span><span class="op" id="3987244">&lt;&lt;</span><span class="num" id="3987246">8</span>&nbsp;<span class="op" id="3987248">|</span>&nbsp;<span class="builtintype" id="3987250">uint32</span><span class="op" id="3987256">(</span><span class="ident" id="3987257">src</span><span class="op" id="3987260">[</span><span class="num" id="3987261">7</span><span class="op" id="3987262">]</span><span class="op" id="3987263">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3987266">s2</span>&nbsp;<span class="op" id="3987269">=</span>&nbsp;<span class="builtintype" id="3987271">uint32</span><span class="op" id="3987277">(</span><span class="ident" id="3987278">src</span><span class="op" id="3987281">[</span><span class="num" id="3987282">8</span><span class="op" id="3987283">]</span><span class="op" id="3987284">)</span><span class="op" id="3987285">&lt;&lt;</span><span class="num" id="3987287">24</span>&nbsp;<span class="op" id="3987290">|</span>&nbsp;<span class="builtintype" id="3987292">uint32</span><span class="op" id="3987298">(</span><span class="ident" id="3987299">src</span><span class="op" id="3987302">[</span><span class="num" id="3987303">9</span><span class="op" id="3987304">]</span><span class="op" id="3987305">)</span><span class="op" id="3987306">&lt;&lt;</span><span class="num" id="3987308">16</span>&nbsp;<span class="op" id="3987311">|</span>&nbsp;<span class="builtintype" id="3987313">uint32</span><span class="op" id="3987319">(</span><span class="ident" id="3987320">src</span><span class="op" id="3987323">[</span><span class="num" id="3987324">10</span><span class="op" id="3987326">]</span><span class="op" id="3987327">)</span><span class="op" id="3987328">&lt;&lt;</span><span class="num" id="3987330">8</span>&nbsp;<span class="op" id="3987332">|</span>&nbsp;<span class="builtintype" id="3987334">uint32</span><span class="op" id="3987340">(</span><span class="ident" id="3987341">src</span><span class="op" id="3987344">[</span><span class="num" id="3987345">11</span><span class="op" id="3987347">]</span><span class="op" id="3987348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3987351">s3</span>&nbsp;<span class="op" id="3987354">=</span>&nbsp;<span class="builtintype" id="3987356">uint32</span><span class="op" id="3987362">(</span><span class="ident" id="3987363">src</span><span class="op" id="3987366">[</span><span class="num" id="3987367">12</span><span class="op" id="3987369">]</span><span class="op" id="3987370">)</span><span class="op" id="3987371">&lt;&lt;</span><span class="num" id="3987373">24</span>&nbsp;<span class="op" id="3987376">|</span>&nbsp;<span class="builtintype" id="3987378">uint32</span><span class="op" id="3987384">(</span><span class="ident" id="3987385">src</span><span class="op" id="3987388">[</span><span class="num" id="3987389">13</span><span class="op" id="3987391">]</span><span class="op" id="3987392">)</span><span class="op" id="3987393">&lt;&lt;</span><span class="num" id="3987395">16</span>&nbsp;<span class="op" id="3987398">|</span>&nbsp;<span class="builtintype" id="3987400">uint32</span><span class="op" id="3987406">(</span><span class="ident" id="3987407">src</span><span class="op" id="3987410">[</span><span class="num" id="3987411">14</span><span class="op" id="3987413">]</span><span class="op" id="3987414">)</span><span class="op" id="3987415">&lt;&lt;</span><span class="num" id="3987417">8</span>&nbsp;<span class="op" id="3987419">|</span>&nbsp;<span class="builtintype" id="3987421">uint32</span><span class="op" id="3987427">(</span><span class="ident" id="3987428">src</span><span class="op" id="3987431">[</span><span class="num" id="3987432">15</span><span class="op" id="3987434">]</span><span class="op" id="3987435">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3987439">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3987481">s0</span>&nbsp;<span class="op" id="3987484">^=</span>&nbsp;<span class="ident" id="3987487">xk</span><span class="op" id="3987489">[</span><span class="num" id="3987490">0</span><span class="op" id="3987491">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3987494">s1</span>&nbsp;<span class="op" id="3987497">^=</span>&nbsp;<span class="ident" id="3987500">xk</span><span class="op" id="3987502">[</span><span class="num" id="3987503">1</span><span class="op" id="3987504">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3987507">s2</span>&nbsp;<span class="op" id="3987510">^=</span>&nbsp;<span class="ident" id="3987513">xk</span><span class="op" id="3987515">[</span><span class="num" id="3987516">2</span><span class="op" id="3987517">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3987520">s3</span>&nbsp;<span class="op" id="3987523">^=</span>&nbsp;<span class="ident" id="3987526">xk</span><span class="op" id="3987528">[</span><span class="num" id="3987529">3</span><span class="op" id="3987530">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3987534">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3987574">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3987629">nr</span>&nbsp;<span class="op" id="3987632">:=</span>&nbsp;<span class="builtinfunc" id="3987635">len</span><span class="op" id="3987638">(</span><span class="ident" id="3987639">xk</span><span class="op" id="3987641">)</span><span class="op" id="3987642">/</span><span class="num" id="3987643">4</span>&nbsp;<span class="op" id="3987645">-</span>&nbsp;<span class="num" id="3987647">2</span>&nbsp;<span class="comment" id="3987649">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3987684">k</span>&nbsp;<span class="op" id="3987686">:=</span>&nbsp;<span class="num" id="3987689">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3987692">for</span>&nbsp;<span class="ident" id="3987696">r</span>&nbsp;<span class="op" id="3987698">:=</span>&nbsp;<span class="num" id="3987701">0</span><span class="op" id="3987702">;</span>&nbsp;<span class="ident" id="3987704">r</span>&nbsp;<span class="op" id="3987706">&lt;</span>&nbsp;<span class="ident" id="3987708">nr</span><span class="op" id="3987710">;</span>&nbsp;<span class="ident" id="3987712">r</span><span class="op" id="3987713">++</span>&nbsp;<span class="op" id="3987716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3987720">t0</span>&nbsp;<span class="op" id="3987723">=</span>&nbsp;<span class="ident" id="3987725">xk</span><span class="op" id="3987727">[</span><span class="ident" id="3987728">k</span><span class="op" id="3987729">+</span><span class="num" id="3987730">0</span><span class="op" id="3987731">]</span>&nbsp;<span class="op" id="3987733">^</span>&nbsp;<span class="ident" id="3987735">td0</span><span class="op" id="3987738">[</span><span class="builtintype" id="3987739">uint8</span><span class="op" id="3987744">(</span><span class="ident" id="3987745">s0</span><span class="op" id="3987747">&gt;&gt;</span><span class="num" id="3987749">24</span><span class="op" id="3987751">)</span><span class="op" id="3987752">]</span>&nbsp;<span class="op" id="3987754">^</span>&nbsp;<span class="ident" id="3987756">td1</span><span class="op" id="3987759">[</span><span class="builtintype" id="3987760">uint8</span><span class="op" id="3987765">(</span><span class="ident" id="3987766">s3</span><span class="op" id="3987768">&gt;&gt;</span><span class="num" id="3987770">16</span><span class="op" id="3987772">)</span><span class="op" id="3987773">]</span>&nbsp;<span class="op" id="3987775">^</span>&nbsp;<span class="ident" id="3987777">td2</span><span class="op" id="3987780">[</span><span class="builtintype" id="3987781">uint8</span><span class="op" id="3987786">(</span><span class="ident" id="3987787">s2</span><span class="op" id="3987789">&gt;&gt;</span><span class="num" id="3987791">8</span><span class="op" id="3987792">)</span><span class="op" id="3987793">]</span>&nbsp;<span class="op" id="3987795">^</span>&nbsp;<span class="ident" id="3987797">td3</span><span class="op" id="3987800">[</span><span class="builtintype" id="3987801">uint8</span><span class="op" id="3987806">(</span><span class="ident" id="3987807">s1</span><span class="op" id="3987809">)</span><span class="op" id="3987810">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3987814">t1</span>&nbsp;<span class="op" id="3987817">=</span>&nbsp;<span class="ident" id="3987819">xk</span><span class="op" id="3987821">[</span><span class="ident" id="3987822">k</span><span class="op" id="3987823">+</span><span class="num" id="3987824">1</span><span class="op" id="3987825">]</span>&nbsp;<span class="op" id="3987827">^</span>&nbsp;<span class="ident" id="3987829">td0</span><span class="op" id="3987832">[</span><span class="builtintype" id="3987833">uint8</span><span class="op" id="3987838">(</span><span class="ident" id="3987839">s1</span><span class="op" id="3987841">&gt;&gt;</span><span class="num" id="3987843">24</span><span class="op" id="3987845">)</span><span class="op" id="3987846">]</span>&nbsp;<span class="op" id="3987848">^</span>&nbsp;<span class="ident" id="3987850">td1</span><span class="op" id="3987853">[</span><span class="builtintype" id="3987854">uint8</span><span class="op" id="3987859">(</span><span class="ident" id="3987860">s0</span><span class="op" id="3987862">&gt;&gt;</span><span class="num" id="3987864">16</span><span class="op" id="3987866">)</span><span class="op" id="3987867">]</span>&nbsp;<span class="op" id="3987869">^</span>&nbsp;<span class="ident" id="3987871">td2</span><span class="op" id="3987874">[</span><span class="builtintype" id="3987875">uint8</span><span class="op" id="3987880">(</span><span class="ident" id="3987881">s3</span><span class="op" id="3987883">&gt;&gt;</span><span class="num" id="3987885">8</span><span class="op" id="3987886">)</span><span class="op" id="3987887">]</span>&nbsp;<span class="op" id="3987889">^</span>&nbsp;<span class="ident" id="3987891">td3</span><span class="op" id="3987894">[</span><span class="builtintype" id="3987895">uint8</span><span class="op" id="3987900">(</span><span class="ident" id="3987901">s2</span><span class="op" id="3987903">)</span><span class="op" id="3987904">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3987908">t2</span>&nbsp;<span class="op" id="3987911">=</span>&nbsp;<span class="ident" id="3987913">xk</span><span class="op" id="3987915">[</span><span class="ident" id="3987916">k</span><span class="op" id="3987917">+</span><span class="num" id="3987918">2</span><span class="op" id="3987919">]</span>&nbsp;<span class="op" id="3987921">^</span>&nbsp;<span class="ident" id="3987923">td0</span><span class="op" id="3987926">[</span><span class="builtintype" id="3987927">uint8</span><span class="op" id="3987932">(</span><span class="ident" id="3987933">s2</span><span class="op" id="3987935">&gt;&gt;</span><span class="num" id="3987937">24</span><span class="op" id="3987939">)</span><span class="op" id="3987940">]</span>&nbsp;<span class="op" id="3987942">^</span>&nbsp;<span class="ident" id="3987944">td1</span><span class="op" id="3987947">[</span><span class="builtintype" id="3987948">uint8</span><span class="op" id="3987953">(</span><span class="ident" id="3987954">s1</span><span class="op" id="3987956">&gt;&gt;</span><span class="num" id="3987958">16</span><span class="op" id="3987960">)</span><span class="op" id="3987961">]</span>&nbsp;<span class="op" id="3987963">^</span>&nbsp;<span class="ident" id="3987965">td2</span><span class="op" id="3987968">[</span><span class="builtintype" id="3987969">uint8</span><span class="op" id="3987974">(</span><span class="ident" id="3987975">s0</span><span class="op" id="3987977">&gt;&gt;</span><span class="num" id="3987979">8</span><span class="op" id="3987980">)</span><span class="op" id="3987981">]</span>&nbsp;<span class="op" id="3987983">^</span>&nbsp;<span class="ident" id="3987985">td3</span><span class="op" id="3987988">[</span><span class="builtintype" id="3987989">uint8</span><span class="op" id="3987994">(</span><span class="ident" id="3987995">s3</span><span class="op" id="3987997">)</span><span class="op" id="3987998">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988002">t3</span>&nbsp;<span class="op" id="3988005">=</span>&nbsp;<span class="ident" id="3988007">xk</span><span class="op" id="3988009">[</span><span class="ident" id="3988010">k</span><span class="op" id="3988011">+</span><span class="num" id="3988012">3</span><span class="op" id="3988013">]</span>&nbsp;<span class="op" id="3988015">^</span>&nbsp;<span class="ident" id="3988017">td0</span><span class="op" id="3988020">[</span><span class="builtintype" id="3988021">uint8</span><span class="op" id="3988026">(</span><span class="ident" id="3988027">s3</span><span class="op" id="3988029">&gt;&gt;</span><span class="num" id="3988031">24</span><span class="op" id="3988033">)</span><span class="op" id="3988034">]</span>&nbsp;<span class="op" id="3988036">^</span>&nbsp;<span class="ident" id="3988038">td1</span><span class="op" id="3988041">[</span><span class="builtintype" id="3988042">uint8</span><span class="op" id="3988047">(</span><span class="ident" id="3988048">s2</span><span class="op" id="3988050">&gt;&gt;</span><span class="num" id="3988052">16</span><span class="op" id="3988054">)</span><span class="op" id="3988055">]</span>&nbsp;<span class="op" id="3988057">^</span>&nbsp;<span class="ident" id="3988059">td2</span><span class="op" id="3988062">[</span><span class="builtintype" id="3988063">uint8</span><span class="op" id="3988068">(</span><span class="ident" id="3988069">s1</span><span class="op" id="3988071">&gt;&gt;</span><span class="num" id="3988073">8</span><span class="op" id="3988074">)</span><span class="op" id="3988075">]</span>&nbsp;<span class="op" id="3988077">^</span>&nbsp;<span class="ident" id="3988079">td3</span><span class="op" id="3988082">[</span><span class="builtintype" id="3988083">uint8</span><span class="op" id="3988088">(</span><span class="ident" id="3988089">s0</span><span class="op" id="3988091">)</span><span class="op" id="3988092">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988096">k</span>&nbsp;<span class="op" id="3988098">+=</span>&nbsp;<span class="num" id="3988101">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988105">s0</span><span class="op" id="3988107">,</span>&nbsp;<span class="ident" id="3988109">s1</span><span class="op" id="3988111">,</span>&nbsp;<span class="ident" id="3988113">s2</span><span class="op" id="3988115">,</span>&nbsp;<span class="ident" id="3988117">s3</span>&nbsp;<span class="op" id="3988120">=</span>&nbsp;<span class="ident" id="3988122">t0</span><span class="op" id="3988124">,</span>&nbsp;<span class="ident" id="3988126">t1</span><span class="op" id="3988128">,</span>&nbsp;<span class="ident" id="3988130">t2</span><span class="op" id="3988132">,</span>&nbsp;<span class="ident" id="3988134">t3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3988138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3988142">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988205">s0</span>&nbsp;<span class="op" id="3988208">=</span>&nbsp;<span class="builtintype" id="3988210">uint32</span><span class="op" id="3988216">(</span><span class="ident" id="3988217">sbox1</span><span class="op" id="3988222">[</span><span class="ident" id="3988223">t0</span><span class="op" id="3988225">&gt;&gt;</span><span class="num" id="3988227">24</span><span class="op" id="3988229">]</span><span class="op" id="3988230">)</span><span class="op" id="3988231">&lt;&lt;</span><span class="num" id="3988233">24</span>&nbsp;<span class="op" id="3988236">|</span>&nbsp;<span class="builtintype" id="3988238">uint32</span><span class="op" id="3988244">(</span><span class="ident" id="3988245">sbox1</span><span class="op" id="3988250">[</span><span class="ident" id="3988251">t3</span><span class="op" id="3988253">&gt;&gt;</span><span class="num" id="3988255">16</span><span class="op" id="3988257">&amp;</span><span class="num" id="3988258">0xff</span><span class="op" id="3988262">]</span><span class="op" id="3988263">)</span><span class="op" id="3988264">&lt;&lt;</span><span class="num" id="3988266">16</span>&nbsp;<span class="op" id="3988269">|</span>&nbsp;<span class="builtintype" id="3988271">uint32</span><span class="op" id="3988277">(</span><span class="ident" id="3988278">sbox1</span><span class="op" id="3988283">[</span><span class="ident" id="3988284">t2</span><span class="op" id="3988286">&gt;&gt;</span><span class="num" id="3988288">8</span><span class="op" id="3988289">&amp;</span><span class="num" id="3988290">0xff</span><span class="op" id="3988294">]</span><span class="op" id="3988295">)</span><span class="op" id="3988296">&lt;&lt;</span><span class="num" id="3988298">8</span>&nbsp;<span class="op" id="3988300">|</span>&nbsp;<span class="builtintype" id="3988302">uint32</span><span class="op" id="3988308">(</span><span class="ident" id="3988309">sbox1</span><span class="op" id="3988314">[</span><span class="ident" id="3988315">t1</span><span class="op" id="3988317">&amp;</span><span class="num" id="3988318">0xff</span><span class="op" id="3988322">]</span><span class="op" id="3988323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988326">s1</span>&nbsp;<span class="op" id="3988329">=</span>&nbsp;<span class="builtintype" id="3988331">uint32</span><span class="op" id="3988337">(</span><span class="ident" id="3988338">sbox1</span><span class="op" id="3988343">[</span><span class="ident" id="3988344">t1</span><span class="op" id="3988346">&gt;&gt;</span><span class="num" id="3988348">24</span><span class="op" id="3988350">]</span><span class="op" id="3988351">)</span><span class="op" id="3988352">&lt;&lt;</span><span class="num" id="3988354">24</span>&nbsp;<span class="op" id="3988357">|</span>&nbsp;<span class="builtintype" id="3988359">uint32</span><span class="op" id="3988365">(</span><span class="ident" id="3988366">sbox1</span><span class="op" id="3988371">[</span><span class="ident" id="3988372">t0</span><span class="op" id="3988374">&gt;&gt;</span><span class="num" id="3988376">16</span><span class="op" id="3988378">&amp;</span><span class="num" id="3988379">0xff</span><span class="op" id="3988383">]</span><span class="op" id="3988384">)</span><span class="op" id="3988385">&lt;&lt;</span><span class="num" id="3988387">16</span>&nbsp;<span class="op" id="3988390">|</span>&nbsp;<span class="builtintype" id="3988392">uint32</span><span class="op" id="3988398">(</span><span class="ident" id="3988399">sbox1</span><span class="op" id="3988404">[</span><span class="ident" id="3988405">t3</span><span class="op" id="3988407">&gt;&gt;</span><span class="num" id="3988409">8</span><span class="op" id="3988410">&amp;</span><span class="num" id="3988411">0xff</span><span class="op" id="3988415">]</span><span class="op" id="3988416">)</span><span class="op" id="3988417">&lt;&lt;</span><span class="num" id="3988419">8</span>&nbsp;<span class="op" id="3988421">|</span>&nbsp;<span class="builtintype" id="3988423">uint32</span><span class="op" id="3988429">(</span><span class="ident" id="3988430">sbox1</span><span class="op" id="3988435">[</span><span class="ident" id="3988436">t2</span><span class="op" id="3988438">&amp;</span><span class="num" id="3988439">0xff</span><span class="op" id="3988443">]</span><span class="op" id="3988444">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988447">s2</span>&nbsp;<span class="op" id="3988450">=</span>&nbsp;<span class="builtintype" id="3988452">uint32</span><span class="op" id="3988458">(</span><span class="ident" id="3988459">sbox1</span><span class="op" id="3988464">[</span><span class="ident" id="3988465">t2</span><span class="op" id="3988467">&gt;&gt;</span><span class="num" id="3988469">24</span><span class="op" id="3988471">]</span><span class="op" id="3988472">)</span><span class="op" id="3988473">&lt;&lt;</span><span class="num" id="3988475">24</span>&nbsp;<span class="op" id="3988478">|</span>&nbsp;<span class="builtintype" id="3988480">uint32</span><span class="op" id="3988486">(</span><span class="ident" id="3988487">sbox1</span><span class="op" id="3988492">[</span><span class="ident" id="3988493">t1</span><span class="op" id="3988495">&gt;&gt;</span><span class="num" id="3988497">16</span><span class="op" id="3988499">&amp;</span><span class="num" id="3988500">0xff</span><span class="op" id="3988504">]</span><span class="op" id="3988505">)</span><span class="op" id="3988506">&lt;&lt;</span><span class="num" id="3988508">16</span>&nbsp;<span class="op" id="3988511">|</span>&nbsp;<span class="builtintype" id="3988513">uint32</span><span class="op" id="3988519">(</span><span class="ident" id="3988520">sbox1</span><span class="op" id="3988525">[</span><span class="ident" id="3988526">t0</span><span class="op" id="3988528">&gt;&gt;</span><span class="num" id="3988530">8</span><span class="op" id="3988531">&amp;</span><span class="num" id="3988532">0xff</span><span class="op" id="3988536">]</span><span class="op" id="3988537">)</span><span class="op" id="3988538">&lt;&lt;</span><span class="num" id="3988540">8</span>&nbsp;<span class="op" id="3988542">|</span>&nbsp;<span class="builtintype" id="3988544">uint32</span><span class="op" id="3988550">(</span><span class="ident" id="3988551">sbox1</span><span class="op" id="3988556">[</span><span class="ident" id="3988557">t3</span><span class="op" id="3988559">&amp;</span><span class="num" id="3988560">0xff</span><span class="op" id="3988564">]</span><span class="op" id="3988565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988568">s3</span>&nbsp;<span class="op" id="3988571">=</span>&nbsp;<span class="builtintype" id="3988573">uint32</span><span class="op" id="3988579">(</span><span class="ident" id="3988580">sbox1</span><span class="op" id="3988585">[</span><span class="ident" id="3988586">t3</span><span class="op" id="3988588">&gt;&gt;</span><span class="num" id="3988590">24</span><span class="op" id="3988592">]</span><span class="op" id="3988593">)</span><span class="op" id="3988594">&lt;&lt;</span><span class="num" id="3988596">24</span>&nbsp;<span class="op" id="3988599">|</span>&nbsp;<span class="builtintype" id="3988601">uint32</span><span class="op" id="3988607">(</span><span class="ident" id="3988608">sbox1</span><span class="op" id="3988613">[</span><span class="ident" id="3988614">t2</span><span class="op" id="3988616">&gt;&gt;</span><span class="num" id="3988618">16</span><span class="op" id="3988620">&amp;</span><span class="num" id="3988621">0xff</span><span class="op" id="3988625">]</span><span class="op" id="3988626">)</span><span class="op" id="3988627">&lt;&lt;</span><span class="num" id="3988629">16</span>&nbsp;<span class="op" id="3988632">|</span>&nbsp;<span class="builtintype" id="3988634">uint32</span><span class="op" id="3988640">(</span><span class="ident" id="3988641">sbox1</span><span class="op" id="3988646">[</span><span class="ident" id="3988647">t1</span><span class="op" id="3988649">&gt;&gt;</span><span class="num" id="3988651">8</span><span class="op" id="3988652">&amp;</span><span class="num" id="3988653">0xff</span><span class="op" id="3988657">]</span><span class="op" id="3988658">)</span><span class="op" id="3988659">&lt;&lt;</span><span class="num" id="3988661">8</span>&nbsp;<span class="op" id="3988663">|</span>&nbsp;<span class="builtintype" id="3988665">uint32</span><span class="op" id="3988671">(</span><span class="ident" id="3988672">sbox1</span><span class="op" id="3988677">[</span><span class="ident" id="3988678">t0</span><span class="op" id="3988680">&amp;</span><span class="num" id="3988681">0xff</span><span class="op" id="3988685">]</span><span class="op" id="3988686">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988690">s0</span>&nbsp;<span class="op" id="3988693">^=</span>&nbsp;<span class="ident" id="3988696">xk</span><span class="op" id="3988698">[</span><span class="ident" id="3988699">k</span><span class="op" id="3988700">+</span><span class="num" id="3988701">0</span><span class="op" id="3988702">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988705">s1</span>&nbsp;<span class="op" id="3988708">^=</span>&nbsp;<span class="ident" id="3988711">xk</span><span class="op" id="3988713">[</span><span class="ident" id="3988714">k</span><span class="op" id="3988715">+</span><span class="num" id="3988716">1</span><span class="op" id="3988717">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988720">s2</span>&nbsp;<span class="op" id="3988723">^=</span>&nbsp;<span class="ident" id="3988726">xk</span><span class="op" id="3988728">[</span><span class="ident" id="3988729">k</span><span class="op" id="3988730">+</span><span class="num" id="3988731">2</span><span class="op" id="3988732">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988735">s3</span>&nbsp;<span class="op" id="3988738">^=</span>&nbsp;<span class="ident" id="3988741">xk</span><span class="op" id="3988743">[</span><span class="ident" id="3988744">k</span><span class="op" id="3988745">+</span><span class="num" id="3988746">3</span><span class="op" id="3988747">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988751">dst</span><span class="op" id="3988754">[</span><span class="num" id="3988755">0</span><span class="op" id="3988756">]</span><span class="op" id="3988757">,</span>&nbsp;<span class="ident" id="3988759">dst</span><span class="op" id="3988762">[</span><span class="num" id="3988763">1</span><span class="op" id="3988764">]</span><span class="op" id="3988765">,</span>&nbsp;<span class="ident" id="3988767">dst</span><span class="op" id="3988770">[</span><span class="num" id="3988771">2</span><span class="op" id="3988772">]</span><span class="op" id="3988773">,</span>&nbsp;<span class="ident" id="3988775">dst</span><span class="op" id="3988778">[</span><span class="num" id="3988779">3</span><span class="op" id="3988780">]</span>&nbsp;<span class="op" id="3988782">=</span>&nbsp;<span class="builtintype" id="3988784">byte</span><span class="op" id="3988788">(</span><span class="ident" id="3988789">s0</span><span class="op" id="3988791">&gt;&gt;</span><span class="num" id="3988793">24</span><span class="op" id="3988795">)</span><span class="op" id="3988796">,</span>&nbsp;<span class="builtintype" id="3988798">byte</span><span class="op" id="3988802">(</span><span class="ident" id="3988803">s0</span><span class="op" id="3988805">&gt;&gt;</span><span class="num" id="3988807">16</span><span class="op" id="3988809">)</span><span class="op" id="3988810">,</span>&nbsp;<span class="builtintype" id="3988812">byte</span><span class="op" id="3988816">(</span><span class="ident" id="3988817">s0</span><span class="op" id="3988819">&gt;&gt;</span><span class="num" id="3988821">8</span><span class="op" id="3988822">)</span><span class="op" id="3988823">,</span>&nbsp;<span class="builtintype" id="3988825">byte</span><span class="op" id="3988829">(</span><span class="ident" id="3988830">s0</span><span class="op" id="3988832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988835">dst</span><span class="op" id="3988838">[</span><span class="num" id="3988839">4</span><span class="op" id="3988840">]</span><span class="op" id="3988841">,</span>&nbsp;<span class="ident" id="3988843">dst</span><span class="op" id="3988846">[</span><span class="num" id="3988847">5</span><span class="op" id="3988848">]</span><span class="op" id="3988849">,</span>&nbsp;<span class="ident" id="3988851">dst</span><span class="op" id="3988854">[</span><span class="num" id="3988855">6</span><span class="op" id="3988856">]</span><span class="op" id="3988857">,</span>&nbsp;<span class="ident" id="3988859">dst</span><span class="op" id="3988862">[</span><span class="num" id="3988863">7</span><span class="op" id="3988864">]</span>&nbsp;<span class="op" id="3988866">=</span>&nbsp;<span class="builtintype" id="3988868">byte</span><span class="op" id="3988872">(</span><span class="ident" id="3988873">s1</span><span class="op" id="3988875">&gt;&gt;</span><span class="num" id="3988877">24</span><span class="op" id="3988879">)</span><span class="op" id="3988880">,</span>&nbsp;<span class="builtintype" id="3988882">byte</span><span class="op" id="3988886">(</span><span class="ident" id="3988887">s1</span><span class="op" id="3988889">&gt;&gt;</span><span class="num" id="3988891">16</span><span class="op" id="3988893">)</span><span class="op" id="3988894">,</span>&nbsp;<span class="builtintype" id="3988896">byte</span><span class="op" id="3988900">(</span><span class="ident" id="3988901">s1</span><span class="op" id="3988903">&gt;&gt;</span><span class="num" id="3988905">8</span><span class="op" id="3988906">)</span><span class="op" id="3988907">,</span>&nbsp;<span class="builtintype" id="3988909">byte</span><span class="op" id="3988913">(</span><span class="ident" id="3988914">s1</span><span class="op" id="3988916">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3988919">dst</span><span class="op" id="3988922">[</span><span class="num" id="3988923">8</span><span class="op" id="3988924">]</span><span class="op" id="3988925">,</span>&nbsp;<span class="ident" id="3988927">dst</span><span class="op" id="3988930">[</span><span class="num" id="3988931">9</span><span class="op" id="3988932">]</span><span class="op" id="3988933">,</span>&nbsp;<span class="ident" id="3988935">dst</span><span class="op" id="3988938">[</span><span class="num" id="3988939">10</span><span class="op" id="3988941">]</span><span class="op" id="3988942">,</span>&nbsp;<span class="ident" id="3988944">dst</span><span class="op" id="3988947">[</span><span class="num" id="3988948">11</span><span class="op" id="3988950">]</span>&nbsp;<span class="op" id="3988952">=</span>&nbsp;<span class="builtintype" id="3988954">byte</span><span class="op" id="3988958">(</span><span class="ident" id="3988959">s2</span><span class="op" id="3988961">&gt;&gt;</span><span class="num" id="3988963">24</span><span class="op" id="3988965">)</span><span class="op" id="3988966">,</span>&nbsp;<span class="builtintype" id="3988968">byte</span><span class="op" id="3988972">(</span><span class="ident" id="3988973">s2</span><span class="op" id="3988975">&gt;&gt;</span><span class="num" id="3988977">16</span><span class="op" id="3988979">)</span><span class="op" id="3988980">,</span>&nbsp;<span class="builtintype" id="3988982">byte</span><span class="op" id="3988986">(</span><span class="ident" id="3988987">s2</span><span class="op" id="3988989">&gt;&gt;</span><span class="num" id="3988991">8</span><span class="op" id="3988992">)</span><span class="op" id="3988993">,</span>&nbsp;<span class="builtintype" id="3988995">byte</span><span class="op" id="3988999">(</span><span class="ident" id="3989000">s2</span><span class="op" id="3989002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3989005">dst</span><span class="op" id="3989008">[</span><span class="num" id="3989009">12</span><span class="op" id="3989011">]</span><span class="op" id="3989012">,</span>&nbsp;<span class="ident" id="3989014">dst</span><span class="op" id="3989017">[</span><span class="num" id="3989018">13</span><span class="op" id="3989020">]</span><span class="op" id="3989021">,</span>&nbsp;<span class="ident" id="3989023">dst</span><span class="op" id="3989026">[</span><span class="num" id="3989027">14</span><span class="op" id="3989029">]</span><span class="op" id="3989030">,</span>&nbsp;<span class="ident" id="3989032">dst</span><span class="op" id="3989035">[</span><span class="num" id="3989036">15</span><span class="op" id="3989038">]</span>&nbsp;<span class="op" id="3989040">=</span>&nbsp;<span class="builtintype" id="3989042">byte</span><span class="op" id="3989046">(</span><span class="ident" id="3989047">s3</span><span class="op" id="3989049">&gt;&gt;</span><span class="num" id="3989051">24</span><span class="op" id="3989053">)</span><span class="op" id="3989054">,</span>&nbsp;<span class="builtintype" id="3989056">byte</span><span class="op" id="3989060">(</span><span class="ident" id="3989061">s3</span><span class="op" id="3989063">&gt;&gt;</span><span class="num" id="3989065">16</span><span class="op" id="3989067">)</span><span class="op" id="3989068">,</span>&nbsp;<span class="builtintype" id="3989070">byte</span><span class="op" id="3989074">(</span><span class="ident" id="3989075">s3</span><span class="op" id="3989077">&gt;&gt;</span><span class="num" id="3989079">8</span><span class="op" id="3989080">)</span><span class="op" id="3989081">,</span>&nbsp;<span class="builtintype" id="3989083">byte</span><span class="op" id="3989087">(</span><span class="ident" id="3989088">s3</span><span class="op" id="3989090">)</span><br>
<span class="lineno"></span><span class="op" id="3989092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3989095">//&nbsp;Apply&nbsp;sbox0&nbsp;to&nbsp;each&nbsp;byte&nbsp;in&nbsp;w.</span><br>
<span class="lineno">130</span><span class="keyword" id="3989129">func</span>&nbsp;<span class="ident" id="3989134">subw</span><span class="op" id="3989138">(</span><span class="ident" id="3989139">w</span>&nbsp;<span class="builtintype" id="3989141">uint32</span><span class="op" id="3989147">)</span>&nbsp;<span class="builtintype" id="3989149">uint32</span>&nbsp;<span class="op" id="3989156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3989159">return</span>&nbsp;<span class="builtintype" id="3989166">uint32</span><span class="op" id="3989172">(</span><span class="ident" id="3989173">sbox0</span><span class="op" id="3989178">[</span><span class="ident" id="3989179">w</span><span class="op" id="3989180">&gt;&gt;</span><span class="num" id="3989182">24</span><span class="op" id="3989184">]</span><span class="op" id="3989185">)</span><span class="op" id="3989186">&lt;&lt;</span><span class="num" id="3989188">24</span>&nbsp;<span class="op" id="3989191">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3989195">uint32</span><span class="op" id="3989201">(</span><span class="ident" id="3989202">sbox0</span><span class="op" id="3989207">[</span><span class="ident" id="3989208">w</span><span class="op" id="3989209">&gt;&gt;</span><span class="num" id="3989211">16</span><span class="op" id="3989213">&amp;</span><span class="num" id="3989214">0xff</span><span class="op" id="3989218">]</span><span class="op" id="3989219">)</span><span class="op" id="3989220">&lt;&lt;</span><span class="num" id="3989222">16</span>&nbsp;<span class="op" id="3989225">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3989229">uint32</span><span class="op" id="3989235">(</span><span class="ident" id="3989236">sbox0</span><span class="op" id="3989241">[</span><span class="ident" id="3989242">w</span><span class="op" id="3989243">&gt;&gt;</span><span class="num" id="3989245">8</span><span class="op" id="3989246">&amp;</span><span class="num" id="3989247">0xff</span><span class="op" id="3989251">]</span><span class="op" id="3989252">)</span><span class="op" id="3989253">&lt;&lt;</span><span class="num" id="3989255">8</span>&nbsp;<span class="op" id="3989257">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3989261">uint32</span><span class="op" id="3989267">(</span><span class="ident" id="3989268">sbox0</span><span class="op" id="3989273">[</span><span class="ident" id="3989274">w</span><span class="op" id="3989275">&amp;</span><span class="num" id="3989276">0xff</span><span class="op" id="3989280">]</span><span class="op" id="3989281">)</span><br>
<span class="lineno">135</span><span class="op" id="3989283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3989286">//&nbsp;Rotate</span><br>
<span class="lineno"></span><span class="keyword" id="3989296">func</span>&nbsp;<span class="ident" id="3989301">rotw</span><span class="op" id="3989305">(</span><span class="ident" id="3989306">w</span>&nbsp;<span class="builtintype" id="3989308">uint32</span><span class="op" id="3989314">)</span>&nbsp;<span class="builtintype" id="3989316">uint32</span>&nbsp;<span class="op" id="3989323">{</span>&nbsp;<span class="keyword" id="3989325">return</span>&nbsp;<span class="ident" id="3989332">w</span><span class="op" id="3989333">&lt;&lt;</span><span class="num" id="3989335">8</span>&nbsp;<span class="op" id="3989337">|</span>&nbsp;<span class="ident" id="3989339">w</span><span class="op" id="3989340">&gt;&gt;</span><span class="num" id="3989342">24</span>&nbsp;<span class="op" id="3989345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3989348">//&nbsp;Key&nbsp;expansion&nbsp;algorithm.&nbsp;&nbsp;See&nbsp;FIPS-197,&nbsp;Figure&nbsp;11.</span><br>
<span class="lineno"></span><span class="comment" id="3989402">//&nbsp;Their&nbsp;rcon[i]&nbsp;is&nbsp;our&nbsp;powx[i-1]&nbsp;&lt;&lt;&nbsp;24.</span><br>
<span class="lineno"></span><span class="keyword" id="3989443">func</span>&nbsp;<span class="ident" id="3989448">expandKeyGo</span><span class="op" id="3989459">(</span><span class="ident" id="3989460">key</span>&nbsp;<span class="op" id="3989464">[</span><span class="op" id="3989465">]</span><span class="builtintype" id="3989466">byte</span><span class="op" id="3989470">,</span>&nbsp;<span class="ident" id="3989472">enc</span><span class="op" id="3989475">,</span>&nbsp;<span class="ident" id="3989477">dec</span>&nbsp;<span class="op" id="3989481">[</span><span class="op" id="3989482">]</span><span class="builtintype" id="3989483">uint32</span><span class="op" id="3989489">)</span>&nbsp;<span class="op" id="3989491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3989494">//&nbsp;Encryption&nbsp;key&nbsp;setup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3989520">var</span>&nbsp;<span class="ident" id="3989524">i</span>&nbsp;<span class="builtintype" id="3989526">int</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3989531">nk</span>&nbsp;<span class="op" id="3989534">:=</span>&nbsp;<span class="builtinfunc" id="3989537">len</span><span class="op" id="3989540">(</span><span class="ident" id="3989541">key</span><span class="op" id="3989544">)</span>&nbsp;<span class="op" id="3989546">/</span>&nbsp;<span class="num" id="3989548">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3989551">for</span>&nbsp;<span class="ident" id="3989555">i</span>&nbsp;<span class="op" id="3989557">=</span>&nbsp;<span class="num" id="3989559">0</span><span class="op" id="3989560">;</span>&nbsp;<span class="ident" id="3989562">i</span>&nbsp;<span class="op" id="3989564">&lt;</span>&nbsp;<span class="ident" id="3989566">nk</span><span class="op" id="3989568">;</span>&nbsp;<span class="ident" id="3989570">i</span><span class="op" id="3989571">++</span>&nbsp;<span class="op" id="3989574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3989578">enc</span><span class="op" id="3989581">[</span><span class="ident" id="3989582">i</span><span class="op" id="3989583">]</span>&nbsp;<span class="op" id="3989585">=</span>&nbsp;<span class="builtintype" id="3989587">uint32</span><span class="op" id="3989593">(</span><span class="ident" id="3989594">key</span><span class="op" id="3989597">[</span><span class="num" id="3989598">4</span><span class="op" id="3989599">*</span><span class="ident" id="3989600">i</span><span class="op" id="3989601">]</span><span class="op" id="3989602">)</span><span class="op" id="3989603">&lt;&lt;</span><span class="num" id="3989605">24</span>&nbsp;<span class="op" id="3989608">|</span>&nbsp;<span class="builtintype" id="3989610">uint32</span><span class="op" id="3989616">(</span><span class="ident" id="3989617">key</span><span class="op" id="3989620">[</span><span class="num" id="3989621">4</span><span class="op" id="3989622">*</span><span class="ident" id="3989623">i</span><span class="op" id="3989624">+</span><span class="num" id="3989625">1</span><span class="op" id="3989626">]</span><span class="op" id="3989627">)</span><span class="op" id="3989628">&lt;&lt;</span><span class="num" id="3989630">16</span>&nbsp;<span class="op" id="3989633">|</span>&nbsp;<span class="builtintype" id="3989635">uint32</span><span class="op" id="3989641">(</span><span class="ident" id="3989642">key</span><span class="op" id="3989645">[</span><span class="num" id="3989646">4</span><span class="op" id="3989647">*</span><span class="ident" id="3989648">i</span><span class="op" id="3989649">+</span><span class="num" id="3989650">2</span><span class="op" id="3989651">]</span><span class="op" id="3989652">)</span><span class="op" id="3989653">&lt;&lt;</span><span class="num" id="3989655">8</span>&nbsp;<span class="op" id="3989657">|</span>&nbsp;<span class="builtintype" id="3989659">uint32</span><span class="op" id="3989665">(</span><span class="ident" id="3989666">key</span><span class="op" id="3989669">[</span><span class="num" id="3989670">4</span><span class="op" id="3989671">*</span><span class="ident" id="3989672">i</span><span class="op" id="3989673">+</span><span class="num" id="3989674">3</span><span class="op" id="3989675">]</span><span class="op" id="3989676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3989679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3989682">for</span>&nbsp;<span class="op" id="3989686">;</span>&nbsp;<span class="ident" id="3989688">i</span>&nbsp;<span class="op" id="3989690">&lt;</span>&nbsp;<span class="builtinfunc" id="3989692">len</span><span class="op" id="3989695">(</span><span class="ident" id="3989696">enc</span><span class="op" id="3989699">)</span><span class="op" id="3989700">;</span>&nbsp;<span class="ident" id="3989702">i</span><span class="op" id="3989703">++</span>&nbsp;<span class="op" id="3989706">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3989710">t</span>&nbsp;<span class="op" id="3989712">:=</span>&nbsp;<span class="ident" id="3989715">enc</span><span class="op" id="3989718">[</span><span class="ident" id="3989719">i</span><span class="op" id="3989720">-</span><span class="num" id="3989721">1</span><span class="op" id="3989722">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3989726">if</span>&nbsp;<span class="ident" id="3989729">i</span><span class="op" id="3989730">%</span><span class="ident" id="3989731">nk</span>&nbsp;<span class="op" id="3989734">==</span>&nbsp;<span class="num" id="3989737">0</span>&nbsp;<span class="op" id="3989739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3989744">t</span>&nbsp;<span class="op" id="3989746">=</span>&nbsp;<span class="ident" id="3989748">subw</span><span class="op" id="3989752">(</span><span class="ident" id="3989753">rotw</span><span class="op" id="3989757">(</span><span class="ident" id="3989758">t</span><span class="op" id="3989759">)</span><span class="op" id="3989760">)</span>&nbsp;<span class="op" id="3989762">^</span>&nbsp;<span class="op" id="3989764">(</span><span class="builtintype" id="3989765">uint32</span><span class="op" id="3989771">(</span><span class="ident" id="3989772">powx</span><span class="op" id="3989776">[</span><span class="ident" id="3989777">i</span><span class="op" id="3989778">/</span><span class="ident" id="3989779">nk</span><span class="op" id="3989781">-</span><span class="num" id="3989782">1</span><span class="op" id="3989783">]</span><span class="op" id="3989784">)</span>&nbsp;<span class="op" id="3989786">&lt;&lt;</span>&nbsp;<span class="num" id="3989789">24</span><span class="op" id="3989791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3989795">}</span>&nbsp;<span class="keyword" id="3989797">else</span>&nbsp;<span class="keyword" id="3989802">if</span>&nbsp;<span class="ident" id="3989805">nk</span>&nbsp;<span class="op" id="3989808">&gt;</span>&nbsp;<span class="num" id="3989810">6</span>&nbsp;<span class="op" id="3989812">&amp;&amp;</span>&nbsp;<span class="ident" id="3989815">i</span><span class="op" id="3989816">%</span><span class="ident" id="3989817">nk</span>&nbsp;<span class="op" id="3989820">==</span>&nbsp;<span class="num" id="3989823">4</span>&nbsp;<span class="op" id="3989825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3989830">t</span>&nbsp;<span class="op" id="3989832">=</span>&nbsp;<span class="ident" id="3989834">subw</span><span class="op" id="3989838">(</span><span class="ident" id="3989839">t</span><span class="op" id="3989840">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3989844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3989848">enc</span><span class="op" id="3989851">[</span><span class="ident" id="3989852">i</span><span class="op" id="3989853">]</span>&nbsp;<span class="op" id="3989855">=</span>&nbsp;<span class="ident" id="3989857">enc</span><span class="op" id="3989860">[</span><span class="ident" id="3989861">i</span><span class="op" id="3989862">-</span><span class="ident" id="3989863">nk</span><span class="op" id="3989865">]</span>&nbsp;<span class="op" id="3989867">^</span>&nbsp;<span class="ident" id="3989869">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3989872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3989876">//&nbsp;Derive&nbsp;decryption&nbsp;key&nbsp;from&nbsp;encryption&nbsp;key.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3989923">//&nbsp;Reverse&nbsp;the&nbsp;4-word&nbsp;round&nbsp;key&nbsp;sets&nbsp;from&nbsp;enc&nbsp;to&nbsp;produce&nbsp;dec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3989986">//&nbsp;All&nbsp;sets&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;get&nbsp;the&nbsp;MixColumn&nbsp;transform&nbsp;applied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3990059">if</span>&nbsp;<span class="ident" id="3990062">dec</span>&nbsp;<span class="op" id="3990066">==</span>&nbsp;<span class="builtintype" id="3990069">nil</span>&nbsp;<span class="op" id="3990073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3990077">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3990085">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3990088">n</span>&nbsp;<span class="op" id="3990090">:=</span>&nbsp;<span class="builtinfunc" id="3990093">len</span><span class="op" id="3990096">(</span><span class="ident" id="3990097">enc</span><span class="op" id="3990100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3990103">for</span>&nbsp;<span class="ident" id="3990107">i</span>&nbsp;<span class="op" id="3990109">:=</span>&nbsp;<span class="num" id="3990112">0</span><span class="op" id="3990113">;</span>&nbsp;<span class="ident" id="3990115">i</span>&nbsp;<span class="op" id="3990117">&lt;</span>&nbsp;<span class="ident" id="3990119">n</span><span class="op" id="3990120">;</span>&nbsp;<span class="ident" id="3990122">i</span>&nbsp;<span class="op" id="3990124">+=</span>&nbsp;<span class="num" id="3990127">4</span>&nbsp;<span class="op" id="3990129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3990133">ei</span>&nbsp;<span class="op" id="3990136">:=</span>&nbsp;<span class="ident" id="3990139">n</span>&nbsp;<span class="op" id="3990141">-</span>&nbsp;<span class="ident" id="3990143">i</span>&nbsp;<span class="op" id="3990145">-</span>&nbsp;<span class="num" id="3990147">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3990151">for</span>&nbsp;<span class="ident" id="3990155">j</span>&nbsp;<span class="op" id="3990157">:=</span>&nbsp;<span class="num" id="3990160">0</span><span class="op" id="3990161">;</span>&nbsp;<span class="ident" id="3990163">j</span>&nbsp;<span class="op" id="3990165">&lt;</span>&nbsp;<span class="num" id="3990167">4</span><span class="op" id="3990168">;</span>&nbsp;<span class="ident" id="3990170">j</span><span class="op" id="3990171">++</span>&nbsp;<span class="op" id="3990174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3990179">x</span>&nbsp;<span class="op" id="3990181">:=</span>&nbsp;<span class="ident" id="3990184">enc</span><span class="op" id="3990187">[</span><span class="ident" id="3990188">ei</span><span class="op" id="3990190">+</span><span class="ident" id="3990191">j</span><span class="op" id="3990192">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3990197">if</span>&nbsp;<span class="ident" id="3990200">i</span>&nbsp;<span class="op" id="3990202">&gt;</span>&nbsp;<span class="num" id="3990204">0</span>&nbsp;<span class="op" id="3990206">&amp;&amp;</span>&nbsp;<span class="ident" id="3990209">i</span><span class="op" id="3990210">+</span><span class="num" id="3990211">4</span>&nbsp;<span class="op" id="3990213">&lt;</span>&nbsp;<span class="ident" id="3990215">n</span>&nbsp;<span class="op" id="3990217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3990223">x</span>&nbsp;<span class="op" id="3990225">=</span>&nbsp;<span class="ident" id="3990227">td0</span><span class="op" id="3990230">[</span><span class="ident" id="3990231">sbox0</span><span class="op" id="3990236">[</span><span class="ident" id="3990237">x</span><span class="op" id="3990238">&gt;&gt;</span><span class="num" id="3990240">24</span><span class="op" id="3990242">]</span><span class="op" id="3990243">]</span>&nbsp;<span class="op" id="3990245">^</span>&nbsp;<span class="ident" id="3990247">td1</span><span class="op" id="3990250">[</span><span class="ident" id="3990251">sbox0</span><span class="op" id="3990256">[</span><span class="ident" id="3990257">x</span><span class="op" id="3990258">&gt;&gt;</span><span class="num" id="3990260">16</span><span class="op" id="3990262">&amp;</span><span class="num" id="3990263">0xff</span><span class="op" id="3990267">]</span><span class="op" id="3990268">]</span>&nbsp;<span class="op" id="3990270">^</span>&nbsp;<span class="ident" id="3990272">td2</span><span class="op" id="3990275">[</span><span class="ident" id="3990276">sbox0</span><span class="op" id="3990281">[</span><span class="ident" id="3990282">x</span><span class="op" id="3990283">&gt;&gt;</span><span class="num" id="3990285">8</span><span class="op" id="3990286">&amp;</span><span class="num" id="3990287">0xff</span><span class="op" id="3990291">]</span><span class="op" id="3990292">]</span>&nbsp;<span class="op" id="3990294">^</span>&nbsp;<span class="ident" id="3990296">td3</span><span class="op" id="3990299">[</span><span class="ident" id="3990300">sbox0</span><span class="op" id="3990305">[</span><span class="ident" id="3990306">x</span><span class="op" id="3990307">&amp;</span><span class="num" id="3990308">0xff</span><span class="op" id="3990312">]</span><span class="op" id="3990313">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3990318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3990323">dec</span><span class="op" id="3990326">[</span><span class="ident" id="3990327">i</span><span class="op" id="3990328">+</span><span class="ident" id="3990329">j</span><span class="op" id="3990330">]</span>&nbsp;<span class="op" id="3990332">=</span>&nbsp;<span class="ident" id="3990334">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3990338">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3990341">}</span><br>
<span class="lineno"></span><span class="op" id="3990343">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
