<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/asn1</h2>
<ul>
<li><a href="/gostd/encoding/asn1/asn1.go.html">asn1.go</a></li>
<li><a href="/gostd/encoding/asn1/asn1_test.go.html">asn1_test.go</a></li>
<li><a href="/gostd/encoding/asn1/common.go.html">common.go</a></li>
<li><a href="/gostd/encoding/asn1/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/asn1/marshal_test.go.html">marshal_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3893524">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3893579">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3893633">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3893684">package</span>&nbsp;<span class="ident" id="3893692">asn1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3893698">import</span>&nbsp;<span class="op" id="3893705">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3893708">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3893717">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3893727">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3893734">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3893740">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3893752">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3893763">&#34;time&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3893771">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3893786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3893789">//&nbsp;A&nbsp;forkableWriter&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;buffer&nbsp;that&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3893844">//&nbsp;&#39;forked&#39;&nbsp;to&nbsp;create&nbsp;new&nbsp;forkableWriters&nbsp;that&nbsp;bracket&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="3893903">//&nbsp;original.&nbsp;&nbsp;After</span><br>
<span class="lineno"></span><span class="comment" id="3893923">//&nbsp;&nbsp;&nbsp;&nbsp;pre,&nbsp;post&nbsp;:=&nbsp;w.fork();</span><br>
<span class="lineno"></span><span class="comment" id="3893952">//&nbsp;the&nbsp;overall&nbsp;sequence&nbsp;of&nbsp;bytes&nbsp;represented&nbsp;is&nbsp;logically&nbsp;w+pre+post.</span><br>
<span class="lineno"></span><span class="keyword" id="3894022">type</span>&nbsp;<span class="ident" id="3894027">forkableWriter</span>&nbsp;<span class="keyword" id="3894042">struct</span>&nbsp;<span class="op" id="3894049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894052">*</span><span class="ident" id="3894053">bytes</span><span class="op" id="3894058">.</span><span class="ident" id="3894059">Buffer</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894067">pre</span><span class="op" id="3894070">,</span>&nbsp;<span class="ident" id="3894072">post</span>&nbsp;<span class="op" id="3894077">*</span><span class="ident" id="3894078">forkableWriter</span><br>
<span class="lineno"></span><span class="op" id="3894093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3894096">func</span>&nbsp;<span class="ident" id="3894101">newForkableWriter</span><span class="op" id="3894118">(</span><span class="op" id="3894119">)</span>&nbsp;<span class="op" id="3894121">*</span><span class="ident" id="3894122">forkableWriter</span>&nbsp;<span class="op" id="3894137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894140">return</span>&nbsp;<span class="op" id="3894147">&amp;</span><span class="ident" id="3894148">forkableWriter</span><span class="op" id="3894162">{</span><span class="builtinfunc" id="3894163">new</span><span class="op" id="3894166">(</span><span class="ident" id="3894167">bytes</span><span class="op" id="3894172">.</span><span class="ident" id="3894173">Buffer</span><span class="op" id="3894179">)</span><span class="op" id="3894180">,</span>&nbsp;<span class="ident" id="3894182">nil</span><span class="op" id="3894185">,</span>&nbsp;<span class="ident" id="3894187">nil</span><span class="op" id="3894190">}</span><br>
<span class="lineno">30</span><span class="op" id="3894192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3894195">func</span>&nbsp;<span class="op" id="3894200">(</span><span class="ident" id="3894201">f</span>&nbsp;<span class="op" id="3894203">*</span><span class="ident" id="3894204">forkableWriter</span><span class="op" id="3894218">)</span>&nbsp;<span class="ident" id="3894220">fork</span><span class="op" id="3894224">(</span><span class="op" id="3894225">)</span>&nbsp;<span class="op" id="3894227">(</span><span class="ident" id="3894228">pre</span><span class="op" id="3894231">,</span>&nbsp;<span class="ident" id="3894233">post</span>&nbsp;<span class="op" id="3894238">*</span><span class="ident" id="3894239">forkableWriter</span><span class="op" id="3894253">)</span>&nbsp;<span class="op" id="3894255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894258">if</span>&nbsp;<span class="ident" id="3894261">f</span><span class="op" id="3894262">.</span><span class="ident" id="3894263">pre</span>&nbsp;<span class="op" id="3894267">!=</span>&nbsp;<span class="ident" id="3894270">nil</span>&nbsp;<span class="op" id="3894274">||</span>&nbsp;<span class="ident" id="3894277">f</span><span class="op" id="3894278">.</span><span class="ident" id="3894279">post</span>&nbsp;<span class="op" id="3894284">!=</span>&nbsp;<span class="ident" id="3894287">nil</span>&nbsp;<span class="op" id="3894291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3894295">panic</span><span class="op" id="3894300">(</span><span class="string" id="3894301">&#34;have&nbsp;already&nbsp;forked&#34;</span><span class="op" id="3894322">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894328">f</span><span class="op" id="3894329">.</span><span class="ident" id="3894330">pre</span>&nbsp;<span class="op" id="3894334">=</span>&nbsp;<span class="ident" id="3894336">newForkableWriter</span><span class="op" id="3894353">(</span><span class="op" id="3894354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894357">f</span><span class="op" id="3894358">.</span><span class="ident" id="3894359">post</span>&nbsp;<span class="op" id="3894364">=</span>&nbsp;<span class="ident" id="3894366">newForkableWriter</span><span class="op" id="3894383">(</span><span class="op" id="3894384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894387">return</span>&nbsp;<span class="ident" id="3894394">f</span><span class="op" id="3894395">.</span><span class="ident" id="3894396">pre</span><span class="op" id="3894399">,</span>&nbsp;<span class="ident" id="3894401">f</span><span class="op" id="3894402">.</span><span class="ident" id="3894403">post</span><br>
<span class="lineno"></span><span class="op" id="3894408">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3894411">func</span>&nbsp;<span class="op" id="3894416">(</span><span class="ident" id="3894417">f</span>&nbsp;<span class="op" id="3894419">*</span><span class="ident" id="3894420">forkableWriter</span><span class="op" id="3894434">)</span>&nbsp;<span class="ident" id="3894436">Len</span><span class="op" id="3894439">(</span><span class="op" id="3894440">)</span>&nbsp;<span class="op" id="3894442">(</span><span class="ident" id="3894443">l</span>&nbsp;<span class="builtintype" id="3894445">int</span><span class="op" id="3894448">)</span>&nbsp;<span class="op" id="3894450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894453">l</span>&nbsp;<span class="op" id="3894455">+=</span>&nbsp;<span class="ident" id="3894458">f</span><span class="op" id="3894459">.</span><span class="ident" id="3894460">Buffer</span><span class="op" id="3894466">.</span><span class="ident" id="3894467">Len</span><span class="op" id="3894470">(</span><span class="op" id="3894471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894474">if</span>&nbsp;<span class="ident" id="3894477">f</span><span class="op" id="3894478">.</span><span class="ident" id="3894479">pre</span>&nbsp;<span class="op" id="3894483">!=</span>&nbsp;<span class="ident" id="3894486">nil</span>&nbsp;<span class="op" id="3894490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894494">l</span>&nbsp;<span class="op" id="3894496">+=</span>&nbsp;<span class="ident" id="3894499">f</span><span class="op" id="3894500">.</span><span class="ident" id="3894501">pre</span><span class="op" id="3894504">.</span><span class="ident" id="3894505">Len</span><span class="op" id="3894508">(</span><span class="op" id="3894509">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894515">if</span>&nbsp;<span class="ident" id="3894518">f</span><span class="op" id="3894519">.</span><span class="ident" id="3894520">post</span>&nbsp;<span class="op" id="3894525">!=</span>&nbsp;<span class="ident" id="3894528">nil</span>&nbsp;<span class="op" id="3894532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894536">l</span>&nbsp;<span class="op" id="3894538">+=</span>&nbsp;<span class="ident" id="3894541">f</span><span class="op" id="3894542">.</span><span class="ident" id="3894543">post</span><span class="op" id="3894547">.</span><span class="ident" id="3894548">Len</span><span class="op" id="3894551">(</span><span class="op" id="3894552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894558">return</span><br>
<span class="lineno">50</span><span class="op" id="3894565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3894568">func</span>&nbsp;<span class="op" id="3894573">(</span><span class="ident" id="3894574">f</span>&nbsp;<span class="op" id="3894576">*</span><span class="ident" id="3894577">forkableWriter</span><span class="op" id="3894591">)</span>&nbsp;<span class="ident" id="3894593">writeTo</span><span class="op" id="3894600">(</span><span class="ident" id="3894601">out</span>&nbsp;<span class="ident" id="3894605">io</span><span class="op" id="3894607">.</span><span class="ident" id="3894608">Writer</span><span class="op" id="3894614">)</span>&nbsp;<span class="op" id="3894616">(</span><span class="ident" id="3894617">n</span>&nbsp;<span class="builtintype" id="3894619">int</span><span class="op" id="3894622">,</span>&nbsp;<span class="ident" id="3894624">err</span>&nbsp;<span class="builtintype" id="3894628">error</span><span class="op" id="3894633">)</span>&nbsp;<span class="op" id="3894635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894638">n</span><span class="op" id="3894639">,</span>&nbsp;<span class="ident" id="3894641">err</span>&nbsp;<span class="op" id="3894645">=</span>&nbsp;<span class="ident" id="3894647">out</span><span class="op" id="3894650">.</span><span class="ident" id="3894651">Write</span><span class="op" id="3894656">(</span><span class="ident" id="3894657">f</span><span class="op" id="3894658">.</span><span class="ident" id="3894659">Bytes</span><span class="op" id="3894664">(</span><span class="op" id="3894665">)</span><span class="op" id="3894666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894669">if</span>&nbsp;<span class="ident" id="3894672">err</span>&nbsp;<span class="op" id="3894676">!=</span>&nbsp;<span class="ident" id="3894679">nil</span>&nbsp;<span class="op" id="3894683">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894687">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894699">var</span>&nbsp;<span class="ident" id="3894703">nn</span>&nbsp;<span class="builtintype" id="3894706">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894712">if</span>&nbsp;<span class="ident" id="3894715">f</span><span class="op" id="3894716">.</span><span class="ident" id="3894717">pre</span>&nbsp;<span class="op" id="3894721">!=</span>&nbsp;<span class="ident" id="3894724">nil</span>&nbsp;<span class="op" id="3894728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894732">nn</span><span class="op" id="3894734">,</span>&nbsp;<span class="ident" id="3894736">err</span>&nbsp;<span class="op" id="3894740">=</span>&nbsp;<span class="ident" id="3894742">f</span><span class="op" id="3894743">.</span><span class="ident" id="3894744">pre</span><span class="op" id="3894747">.</span><span class="ident" id="3894748">writeTo</span><span class="op" id="3894755">(</span><span class="ident" id="3894756">out</span><span class="op" id="3894759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894763">n</span>&nbsp;<span class="op" id="3894765">+=</span>&nbsp;<span class="ident" id="3894768">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894773">if</span>&nbsp;<span class="ident" id="3894776">err</span>&nbsp;<span class="op" id="3894780">!=</span>&nbsp;<span class="ident" id="3894783">nil</span>&nbsp;<span class="op" id="3894787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894792">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894808">if</span>&nbsp;<span class="ident" id="3894811">f</span><span class="op" id="3894812">.</span><span class="ident" id="3894813">post</span>&nbsp;<span class="op" id="3894818">!=</span>&nbsp;<span class="ident" id="3894821">nil</span>&nbsp;<span class="op" id="3894825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894829">nn</span><span class="op" id="3894831">,</span>&nbsp;<span class="ident" id="3894833">err</span>&nbsp;<span class="op" id="3894837">=</span>&nbsp;<span class="ident" id="3894839">f</span><span class="op" id="3894840">.</span><span class="ident" id="3894841">post</span><span class="op" id="3894845">.</span><span class="ident" id="3894846">writeTo</span><span class="op" id="3894853">(</span><span class="ident" id="3894854">out</span><span class="op" id="3894857">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894861">n</span>&nbsp;<span class="op" id="3894863">+=</span>&nbsp;<span class="ident" id="3894866">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894873">return</span><br>
<span class="lineno"></span><span class="op" id="3894880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="3894883">func</span>&nbsp;<span class="ident" id="3894888">marshalBase128Int</span><span class="op" id="3894905">(</span><span class="ident" id="3894906">out</span>&nbsp;<span class="op" id="3894910">*</span><span class="ident" id="3894911">forkableWriter</span><span class="op" id="3894925">,</span>&nbsp;<span class="ident" id="3894927">n</span>&nbsp;<span class="ident" id="3894929">int64</span><span class="op" id="3894934">)</span>&nbsp;<span class="op" id="3894936">(</span><span class="ident" id="3894937">err</span>&nbsp;<span class="builtintype" id="3894941">error</span><span class="op" id="3894946">)</span>&nbsp;<span class="op" id="3894948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894951">if</span>&nbsp;<span class="ident" id="3894954">n</span>&nbsp;<span class="op" id="3894956">==</span>&nbsp;<span class="num" id="3894959">0</span>&nbsp;<span class="op" id="3894961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894965">err</span>&nbsp;<span class="op" id="3894969">=</span>&nbsp;<span class="ident" id="3894971">out</span><span class="op" id="3894974">.</span><span class="ident" id="3894975">WriteByte</span><span class="op" id="3894984">(</span><span class="num" id="3894985">0</span><span class="op" id="3894986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894990">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894998">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895002">l</span>&nbsp;<span class="op" id="3895004">:=</span>&nbsp;<span class="num" id="3895007">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895010">for</span>&nbsp;<span class="ident" id="3895014">i</span>&nbsp;<span class="op" id="3895016">:=</span>&nbsp;<span class="ident" id="3895019">n</span><span class="op" id="3895020">;</span>&nbsp;<span class="ident" id="3895022">i</span>&nbsp;<span class="op" id="3895024">&gt;</span>&nbsp;<span class="num" id="3895026">0</span><span class="op" id="3895027">;</span>&nbsp;<span class="ident" id="3895029">i</span>&nbsp;<span class="op" id="3895031">&gt;&gt;=</span>&nbsp;<span class="num" id="3895035">7</span>&nbsp;<span class="op" id="3895037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895041">l</span><span class="op" id="3895042">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895046">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895050">for</span>&nbsp;<span class="ident" id="3895054">i</span>&nbsp;<span class="op" id="3895056">:=</span>&nbsp;<span class="ident" id="3895059">l</span>&nbsp;<span class="op" id="3895061">-</span>&nbsp;<span class="num" id="3895063">1</span><span class="op" id="3895064">;</span>&nbsp;<span class="ident" id="3895066">i</span>&nbsp;<span class="op" id="3895068">&gt;=</span>&nbsp;<span class="num" id="3895071">0</span><span class="op" id="3895072">;</span>&nbsp;<span class="ident" id="3895074">i</span><span class="op" id="3895075">--</span>&nbsp;<span class="op" id="3895078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895082">o</span>&nbsp;<span class="op" id="3895084">:=</span>&nbsp;<span class="builtintype" id="3895087">byte</span><span class="op" id="3895091">(</span><span class="ident" id="3895092">n</span>&nbsp;<span class="op" id="3895094">&gt;&gt;</span>&nbsp;<span class="builtintype" id="3895097">uint</span><span class="op" id="3895101">(</span><span class="ident" id="3895102">i</span><span class="op" id="3895103">*</span><span class="num" id="3895104">7</span><span class="op" id="3895105">)</span><span class="op" id="3895106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895110">o</span>&nbsp;<span class="op" id="3895112">&amp;=</span>&nbsp;<span class="num" id="3895115">0x7f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895122">if</span>&nbsp;<span class="ident" id="3895125">i</span>&nbsp;<span class="op" id="3895127">!=</span>&nbsp;<span class="num" id="3895130">0</span>&nbsp;<span class="op" id="3895132">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895137">o</span>&nbsp;<span class="op" id="3895139">|=</span>&nbsp;<span class="num" id="3895142">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895153">err</span>&nbsp;<span class="op" id="3895157">=</span>&nbsp;<span class="ident" id="3895159">out</span><span class="op" id="3895162">.</span><span class="ident" id="3895163">WriteByte</span><span class="op" id="3895172">(</span><span class="ident" id="3895173">o</span><span class="op" id="3895174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895178">if</span>&nbsp;<span class="ident" id="3895181">err</span>&nbsp;<span class="op" id="3895185">!=</span>&nbsp;<span class="ident" id="3895188">nil</span>&nbsp;<span class="op" id="3895192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895197">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895213">return</span>&nbsp;<span class="ident" id="3895220">nil</span><br>
<span class="lineno"></span><span class="op" id="3895224">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="3895227">func</span>&nbsp;<span class="ident" id="3895232">marshalInt64</span><span class="op" id="3895244">(</span><span class="ident" id="3895245">out</span>&nbsp;<span class="op" id="3895249">*</span><span class="ident" id="3895250">forkableWriter</span><span class="op" id="3895264">,</span>&nbsp;<span class="ident" id="3895266">i</span>&nbsp;<span class="ident" id="3895268">int64</span><span class="op" id="3895273">)</span>&nbsp;<span class="op" id="3895275">(</span><span class="ident" id="3895276">err</span>&nbsp;<span class="builtintype" id="3895280">error</span><span class="op" id="3895285">)</span>&nbsp;<span class="op" id="3895287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895290">n</span>&nbsp;<span class="op" id="3895292">:=</span>&nbsp;<span class="ident" id="3895295">int64Length</span><span class="op" id="3895306">(</span><span class="ident" id="3895307">i</span><span class="op" id="3895308">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895312">for</span>&nbsp;<span class="op" id="3895316">;</span>&nbsp;<span class="ident" id="3895318">n</span>&nbsp;<span class="op" id="3895320">&gt;</span>&nbsp;<span class="num" id="3895322">0</span><span class="op" id="3895323">;</span>&nbsp;<span class="ident" id="3895325">n</span><span class="op" id="3895326">--</span>&nbsp;<span class="op" id="3895329">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895333">err</span>&nbsp;<span class="op" id="3895337">=</span>&nbsp;<span class="ident" id="3895339">out</span><span class="op" id="3895342">.</span><span class="ident" id="3895343">WriteByte</span><span class="op" id="3895352">(</span><span class="builtintype" id="3895353">byte</span><span class="op" id="3895357">(</span><span class="ident" id="3895358">i</span>&nbsp;<span class="op" id="3895360">&gt;&gt;</span>&nbsp;<span class="builtintype" id="3895363">uint</span><span class="op" id="3895367">(</span><span class="op" id="3895368">(</span><span class="ident" id="3895369">n</span><span class="op" id="3895370">-</span><span class="num" id="3895371">1</span><span class="op" id="3895372">)</span><span class="op" id="3895373">*</span><span class="num" id="3895374">8</span><span class="op" id="3895375">)</span><span class="op" id="3895376">)</span><span class="op" id="3895377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895381">if</span>&nbsp;<span class="ident" id="3895384">err</span>&nbsp;<span class="op" id="3895388">!=</span>&nbsp;<span class="ident" id="3895391">nil</span>&nbsp;<span class="op" id="3895395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895400">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895412">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895416">return</span>&nbsp;<span class="ident" id="3895423">nil</span><br>
<span class="lineno"></span><span class="op" id="3895427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3895430">func</span>&nbsp;<span class="ident" id="3895435">int64Length</span><span class="op" id="3895446">(</span><span class="ident" id="3895447">i</span>&nbsp;<span class="ident" id="3895449">int64</span><span class="op" id="3895454">)</span>&nbsp;<span class="op" id="3895456">(</span><span class="ident" id="3895457">numBytes</span>&nbsp;<span class="builtintype" id="3895466">int</span><span class="op" id="3895469">)</span>&nbsp;<span class="op" id="3895471">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895474">numBytes</span>&nbsp;<span class="op" id="3895483">=</span>&nbsp;<span class="num" id="3895485">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895489">for</span>&nbsp;<span class="ident" id="3895493">i</span>&nbsp;<span class="op" id="3895495">&gt;</span>&nbsp;<span class="num" id="3895497">127</span>&nbsp;<span class="op" id="3895501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895505">numBytes</span><span class="op" id="3895513">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895518">i</span>&nbsp;<span class="op" id="3895520">&gt;&gt;=</span>&nbsp;<span class="num" id="3895524">8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895531">for</span>&nbsp;<span class="ident" id="3895535">i</span>&nbsp;<span class="op" id="3895537">&lt;</span>&nbsp;<span class="op" id="3895539">-</span><span class="num" id="3895540">128</span>&nbsp;<span class="op" id="3895544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895548">numBytes</span><span class="op" id="3895556">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895561">i</span>&nbsp;<span class="op" id="3895563">&gt;&gt;=</span>&nbsp;<span class="num" id="3895567">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3895570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895574">return</span><br>
<span class="lineno"></span><span class="op" id="3895581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="3895584">func</span>&nbsp;<span class="ident" id="3895589">marshalBigInt</span><span class="op" id="3895602">(</span><span class="ident" id="3895603">out</span>&nbsp;<span class="op" id="3895607">*</span><span class="ident" id="3895608">forkableWriter</span><span class="op" id="3895622">,</span>&nbsp;<span class="ident" id="3895624">n</span>&nbsp;<span class="op" id="3895626">*</span><span class="ident" id="3895627">big</span><span class="op" id="3895630">.</span><span class="ident" id="3895631">Int</span><span class="op" id="3895634">)</span>&nbsp;<span class="op" id="3895636">(</span><span class="ident" id="3895637">err</span>&nbsp;<span class="builtintype" id="3895641">error</span><span class="op" id="3895646">)</span>&nbsp;<span class="op" id="3895648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895651">if</span>&nbsp;<span class="ident" id="3895654">n</span><span class="op" id="3895655">.</span><span class="ident" id="3895656">Sign</span><span class="op" id="3895660">(</span><span class="op" id="3895661">)</span>&nbsp;<span class="op" id="3895663">&lt;</span>&nbsp;<span class="num" id="3895665">0</span>&nbsp;<span class="op" id="3895667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3895671">//&nbsp;A&nbsp;negative&nbsp;number&nbsp;has&nbsp;to&nbsp;be&nbsp;converted&nbsp;to&nbsp;two&#39;s-complement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3895734">//&nbsp;form.&nbsp;So&nbsp;we&#39;ll&nbsp;subtract&nbsp;1&nbsp;and&nbsp;invert.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3895784">//&nbsp;most-significant-bit&nbsp;isn&#39;t&nbsp;set&nbsp;then&nbsp;we&#39;ll&nbsp;need&nbsp;to&nbsp;pad&nbsp;the</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3895847">//&nbsp;beginning&nbsp;with&nbsp;0xff&nbsp;in&nbsp;order&nbsp;to&nbsp;keep&nbsp;the&nbsp;number&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895910">nMinus1</span>&nbsp;<span class="op" id="3895918">:=</span>&nbsp;<span class="builtinfunc" id="3895921">new</span><span class="op" id="3895924">(</span><span class="ident" id="3895925">big</span><span class="op" id="3895928">.</span><span class="ident" id="3895929">Int</span><span class="op" id="3895932">)</span><span class="op" id="3895933">.</span><span class="ident" id="3895934">Neg</span><span class="op" id="3895937">(</span><span class="ident" id="3895938">n</span><span class="op" id="3895939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895943">nMinus1</span><span class="op" id="3895950">.</span><span class="ident" id="3895951">Sub</span><span class="op" id="3895954">(</span><span class="ident" id="3895955">nMinus1</span><span class="op" id="3895962">,</span>&nbsp;<span class="ident" id="3895964">bigOne</span><span class="op" id="3895970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895974">bytes</span>&nbsp;<span class="op" id="3895980">:=</span>&nbsp;<span class="ident" id="3895983">nMinus1</span><span class="op" id="3895990">.</span><span class="ident" id="3895991">Bytes</span><span class="op" id="3895996">(</span><span class="op" id="3895997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896001">for</span>&nbsp;<span class="ident" id="3896005">i</span>&nbsp;<span class="op" id="3896007">:=</span>&nbsp;<span class="keyword" id="3896010">range</span>&nbsp;<span class="ident" id="3896016">bytes</span>&nbsp;<span class="op" id="3896022">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896027">bytes</span><span class="op" id="3896032">[</span><span class="ident" id="3896033">i</span><span class="op" id="3896034">]</span>&nbsp;<span class="op" id="3896036">^=</span>&nbsp;<span class="num" id="3896039">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896050">if</span>&nbsp;<span class="builtinfunc" id="3896053">len</span><span class="op" id="3896056">(</span><span class="ident" id="3896057">bytes</span><span class="op" id="3896062">)</span>&nbsp;<span class="op" id="3896064">==</span>&nbsp;<span class="num" id="3896067">0</span>&nbsp;<span class="op" id="3896069">||</span>&nbsp;<span class="ident" id="3896072">bytes</span><span class="op" id="3896077">[</span><span class="num" id="3896078">0</span><span class="op" id="3896079">]</span><span class="op" id="3896080">&amp;</span><span class="num" id="3896081">0x80</span>&nbsp;<span class="op" id="3896086">==</span>&nbsp;<span class="num" id="3896089">0</span>&nbsp;<span class="op" id="3896091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896096">err</span>&nbsp;<span class="op" id="3896100">=</span>&nbsp;<span class="ident" id="3896102">out</span><span class="op" id="3896105">.</span><span class="ident" id="3896106">WriteByte</span><span class="op" id="3896115">(</span><span class="num" id="3896116">0xff</span><span class="op" id="3896120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896125">if</span>&nbsp;<span class="ident" id="3896128">err</span>&nbsp;<span class="op" id="3896132">!=</span>&nbsp;<span class="ident" id="3896135">nil</span>&nbsp;<span class="op" id="3896139">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896145">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896163">_</span><span class="op" id="3896164">,</span>&nbsp;<span class="ident" id="3896166">err</span>&nbsp;<span class="op" id="3896170">=</span>&nbsp;<span class="ident" id="3896172">out</span><span class="op" id="3896175">.</span><span class="ident" id="3896176">Write</span><span class="op" id="3896181">(</span><span class="ident" id="3896182">bytes</span><span class="op" id="3896187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896190">}</span>&nbsp;<span class="keyword" id="3896192">else</span>&nbsp;<span class="keyword" id="3896197">if</span>&nbsp;<span class="ident" id="3896200">n</span><span class="op" id="3896201">.</span><span class="ident" id="3896202">Sign</span><span class="op" id="3896206">(</span><span class="op" id="3896207">)</span>&nbsp;<span class="op" id="3896209">==</span>&nbsp;<span class="num" id="3896212">0</span>&nbsp;<span class="op" id="3896214">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3896218">//&nbsp;Zero&nbsp;is&nbsp;written&nbsp;as&nbsp;a&nbsp;single&nbsp;0&nbsp;zero&nbsp;rather&nbsp;than&nbsp;no&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896280">err</span>&nbsp;<span class="op" id="3896284">=</span>&nbsp;<span class="ident" id="3896286">out</span><span class="op" id="3896289">.</span><span class="ident" id="3896290">WriteByte</span><span class="op" id="3896299">(</span><span class="num" id="3896300">0x00</span><span class="op" id="3896304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896307">}</span>&nbsp;<span class="keyword" id="3896309">else</span>&nbsp;<span class="op" id="3896314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896318">bytes</span>&nbsp;<span class="op" id="3896324">:=</span>&nbsp;<span class="ident" id="3896327">n</span><span class="op" id="3896328">.</span><span class="ident" id="3896329">Bytes</span><span class="op" id="3896334">(</span><span class="op" id="3896335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896339">if</span>&nbsp;<span class="builtinfunc" id="3896342">len</span><span class="op" id="3896345">(</span><span class="ident" id="3896346">bytes</span><span class="op" id="3896351">)</span>&nbsp;<span class="op" id="3896353">&gt;</span>&nbsp;<span class="num" id="3896355">0</span>&nbsp;<span class="op" id="3896357">&amp;&amp;</span>&nbsp;<span class="ident" id="3896360">bytes</span><span class="op" id="3896365">[</span><span class="num" id="3896366">0</span><span class="op" id="3896367">]</span><span class="op" id="3896368">&amp;</span><span class="num" id="3896369">0x80</span>&nbsp;<span class="op" id="3896374">!=</span>&nbsp;<span class="num" id="3896377">0</span>&nbsp;<span class="op" id="3896379">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3896384">//&nbsp;We&#39;ll&nbsp;have&nbsp;to&nbsp;pad&nbsp;this&nbsp;with&nbsp;0x00&nbsp;in&nbsp;order&nbsp;to&nbsp;stop&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3896443">//&nbsp;looking&nbsp;like&nbsp;a&nbsp;negative&nbsp;number.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896481">err</span>&nbsp;<span class="op" id="3896485">=</span>&nbsp;<span class="ident" id="3896487">out</span><span class="op" id="3896490">.</span><span class="ident" id="3896491">WriteByte</span><span class="op" id="3896500">(</span><span class="num" id="3896501">0</span><span class="op" id="3896502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896507">if</span>&nbsp;<span class="ident" id="3896510">err</span>&nbsp;<span class="op" id="3896514">!=</span>&nbsp;<span class="ident" id="3896517">nil</span>&nbsp;<span class="op" id="3896521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896527">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896545">_</span><span class="op" id="3896546">,</span>&nbsp;<span class="ident" id="3896548">err</span>&nbsp;<span class="op" id="3896552">=</span>&nbsp;<span class="ident" id="3896554">out</span><span class="op" id="3896557">.</span><span class="ident" id="3896558">Write</span><span class="op" id="3896563">(</span><span class="ident" id="3896564">bytes</span><span class="op" id="3896569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896575">return</span><br>
<span class="lineno">165</span><span class="op" id="3896582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3896585">func</span>&nbsp;<span class="ident" id="3896590">marshalLength</span><span class="op" id="3896603">(</span><span class="ident" id="3896604">out</span>&nbsp;<span class="op" id="3896608">*</span><span class="ident" id="3896609">forkableWriter</span><span class="op" id="3896623">,</span>&nbsp;<span class="ident" id="3896625">i</span>&nbsp;<span class="builtintype" id="3896627">int</span><span class="op" id="3896630">)</span>&nbsp;<span class="op" id="3896632">(</span><span class="ident" id="3896633">err</span>&nbsp;<span class="builtintype" id="3896637">error</span><span class="op" id="3896642">)</span>&nbsp;<span class="op" id="3896644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896647">n</span>&nbsp;<span class="op" id="3896649">:=</span>&nbsp;<span class="ident" id="3896652">lengthLength</span><span class="op" id="3896664">(</span><span class="ident" id="3896665">i</span><span class="op" id="3896666">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896670">for</span>&nbsp;<span class="op" id="3896674">;</span>&nbsp;<span class="ident" id="3896676">n</span>&nbsp;<span class="op" id="3896678">&gt;</span>&nbsp;<span class="num" id="3896680">0</span><span class="op" id="3896681">;</span>&nbsp;<span class="ident" id="3896683">n</span><span class="op" id="3896684">--</span>&nbsp;<span class="op" id="3896687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896691">err</span>&nbsp;<span class="op" id="3896695">=</span>&nbsp;<span class="ident" id="3896697">out</span><span class="op" id="3896700">.</span><span class="ident" id="3896701">WriteByte</span><span class="op" id="3896710">(</span><span class="builtintype" id="3896711">byte</span><span class="op" id="3896715">(</span><span class="ident" id="3896716">i</span>&nbsp;<span class="op" id="3896718">&gt;&gt;</span>&nbsp;<span class="builtintype" id="3896721">uint</span><span class="op" id="3896725">(</span><span class="op" id="3896726">(</span><span class="ident" id="3896727">n</span><span class="op" id="3896728">-</span><span class="num" id="3896729">1</span><span class="op" id="3896730">)</span><span class="op" id="3896731">*</span><span class="num" id="3896732">8</span><span class="op" id="3896733">)</span><span class="op" id="3896734">)</span><span class="op" id="3896735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896739">if</span>&nbsp;<span class="ident" id="3896742">err</span>&nbsp;<span class="op" id="3896746">!=</span>&nbsp;<span class="ident" id="3896749">nil</span>&nbsp;<span class="op" id="3896753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896758">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896767">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896774">return</span>&nbsp;<span class="ident" id="3896781">nil</span><br>
<span class="lineno"></span><span class="op" id="3896785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="3896788">func</span>&nbsp;<span class="ident" id="3896793">lengthLength</span><span class="op" id="3896805">(</span><span class="ident" id="3896806">i</span>&nbsp;<span class="builtintype" id="3896808">int</span><span class="op" id="3896811">)</span>&nbsp;<span class="op" id="3896813">(</span><span class="ident" id="3896814">numBytes</span>&nbsp;<span class="builtintype" id="3896823">int</span><span class="op" id="3896826">)</span>&nbsp;<span class="op" id="3896828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896831">numBytes</span>&nbsp;<span class="op" id="3896840">=</span>&nbsp;<span class="num" id="3896842">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896845">for</span>&nbsp;<span class="ident" id="3896849">i</span>&nbsp;<span class="op" id="3896851">&gt;</span>&nbsp;<span class="num" id="3896853">255</span>&nbsp;<span class="op" id="3896857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896861">numBytes</span><span class="op" id="3896869">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896874">i</span>&nbsp;<span class="op" id="3896876">&gt;&gt;=</span>&nbsp;<span class="num" id="3896880">8</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896886">return</span><br>
<span class="lineno"></span><span class="op" id="3896893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3896896">func</span>&nbsp;<span class="ident" id="3896901">marshalTagAndLength</span><span class="op" id="3896920">(</span><span class="ident" id="3896921">out</span>&nbsp;<span class="op" id="3896925">*</span><span class="ident" id="3896926">forkableWriter</span><span class="op" id="3896940">,</span>&nbsp;<span class="ident" id="3896942">t</span>&nbsp;<span class="ident" id="3896944">tagAndLength</span><span class="op" id="3896956">)</span>&nbsp;<span class="op" id="3896958">(</span><span class="ident" id="3896959">err</span>&nbsp;<span class="builtintype" id="3896963">error</span><span class="op" id="3896968">)</span>&nbsp;<span class="op" id="3896970">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896973">b</span>&nbsp;<span class="op" id="3896975">:=</span>&nbsp;<span class="builtintype" id="3896978">uint8</span><span class="op" id="3896983">(</span><span class="ident" id="3896984">t</span><span class="op" id="3896985">.</span><span class="ident" id="3896986">class</span><span class="op" id="3896991">)</span>&nbsp;<span class="op" id="3896993">&lt;&lt;</span>&nbsp;<span class="num" id="3896996">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896999">if</span>&nbsp;<span class="ident" id="3897002">t</span><span class="op" id="3897003">.</span><span class="ident" id="3897004">isCompound</span>&nbsp;<span class="op" id="3897015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897019">b</span>&nbsp;<span class="op" id="3897021">|=</span>&nbsp;<span class="num" id="3897024">0x20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897033">if</span>&nbsp;<span class="ident" id="3897036">t</span><span class="op" id="3897037">.</span><span class="ident" id="3897038">tag</span>&nbsp;<span class="op" id="3897042">&gt;=</span>&nbsp;<span class="num" id="3897045">31</span>&nbsp;<span class="op" id="3897048">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897052">b</span>&nbsp;<span class="op" id="3897054">|=</span>&nbsp;<span class="num" id="3897057">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897064">err</span>&nbsp;<span class="op" id="3897068">=</span>&nbsp;<span class="ident" id="3897070">out</span><span class="op" id="3897073">.</span><span class="ident" id="3897074">WriteByte</span><span class="op" id="3897083">(</span><span class="ident" id="3897084">b</span><span class="op" id="3897085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897089">if</span>&nbsp;<span class="ident" id="3897092">err</span>&nbsp;<span class="op" id="3897096">!=</span>&nbsp;<span class="ident" id="3897099">nil</span>&nbsp;<span class="op" id="3897103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897108">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897117">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897121">err</span>&nbsp;<span class="op" id="3897125">=</span>&nbsp;<span class="ident" id="3897127">marshalBase128Int</span><span class="op" id="3897144">(</span><span class="ident" id="3897145">out</span><span class="op" id="3897148">,</span>&nbsp;<span class="ident" id="3897150">int64</span><span class="op" id="3897155">(</span><span class="ident" id="3897156">t</span><span class="op" id="3897157">.</span><span class="ident" id="3897158">tag</span><span class="op" id="3897161">)</span><span class="op" id="3897162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897166">if</span>&nbsp;<span class="ident" id="3897169">err</span>&nbsp;<span class="op" id="3897173">!=</span>&nbsp;<span class="ident" id="3897176">nil</span>&nbsp;<span class="op" id="3897180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897185">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897197">}</span>&nbsp;<span class="keyword" id="3897199">else</span>&nbsp;<span class="op" id="3897204">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897208">b</span>&nbsp;<span class="op" id="3897210">|=</span>&nbsp;<span class="builtintype" id="3897213">uint8</span><span class="op" id="3897218">(</span><span class="ident" id="3897219">t</span><span class="op" id="3897220">.</span><span class="ident" id="3897221">tag</span><span class="op" id="3897224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897228">err</span>&nbsp;<span class="op" id="3897232">=</span>&nbsp;<span class="ident" id="3897234">out</span><span class="op" id="3897237">.</span><span class="ident" id="3897238">WriteByte</span><span class="op" id="3897247">(</span><span class="ident" id="3897248">b</span><span class="op" id="3897249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897253">if</span>&nbsp;<span class="ident" id="3897256">err</span>&nbsp;<span class="op" id="3897260">!=</span>&nbsp;<span class="ident" id="3897263">nil</span>&nbsp;<span class="op" id="3897267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897272">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897281">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897288">if</span>&nbsp;<span class="ident" id="3897291">t</span><span class="op" id="3897292">.</span><span class="ident" id="3897293">length</span>&nbsp;<span class="op" id="3897300">&gt;=</span>&nbsp;<span class="num" id="3897303">128</span>&nbsp;<span class="op" id="3897307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897311">l</span>&nbsp;<span class="op" id="3897313">:=</span>&nbsp;<span class="ident" id="3897316">lengthLength</span><span class="op" id="3897328">(</span><span class="ident" id="3897329">t</span><span class="op" id="3897330">.</span><span class="ident" id="3897331">length</span><span class="op" id="3897337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897341">err</span>&nbsp;<span class="op" id="3897345">=</span>&nbsp;<span class="ident" id="3897347">out</span><span class="op" id="3897350">.</span><span class="ident" id="3897351">WriteByte</span><span class="op" id="3897360">(</span><span class="num" id="3897361">0x80</span>&nbsp;<span class="op" id="3897366">|</span>&nbsp;<span class="builtintype" id="3897368">byte</span><span class="op" id="3897372">(</span><span class="ident" id="3897373">l</span><span class="op" id="3897374">)</span><span class="op" id="3897375">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897379">if</span>&nbsp;<span class="ident" id="3897382">err</span>&nbsp;<span class="op" id="3897386">!=</span>&nbsp;<span class="ident" id="3897389">nil</span>&nbsp;<span class="op" id="3897393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897398">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897411">err</span>&nbsp;<span class="op" id="3897415">=</span>&nbsp;<span class="ident" id="3897417">marshalLength</span><span class="op" id="3897430">(</span><span class="ident" id="3897431">out</span><span class="op" id="3897434">,</span>&nbsp;<span class="ident" id="3897436">t</span><span class="op" id="3897437">.</span><span class="ident" id="3897438">length</span><span class="op" id="3897444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897448">if</span>&nbsp;<span class="ident" id="3897451">err</span>&nbsp;<span class="op" id="3897455">!=</span>&nbsp;<span class="ident" id="3897458">nil</span>&nbsp;<span class="op" id="3897462">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897467">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897479">}</span>&nbsp;<span class="keyword" id="3897481">else</span>&nbsp;<span class="op" id="3897486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897490">err</span>&nbsp;<span class="op" id="3897494">=</span>&nbsp;<span class="ident" id="3897496">out</span><span class="op" id="3897499">.</span><span class="ident" id="3897500">WriteByte</span><span class="op" id="3897509">(</span><span class="builtintype" id="3897510">byte</span><span class="op" id="3897514">(</span><span class="ident" id="3897515">t</span><span class="op" id="3897516">.</span><span class="ident" id="3897517">length</span><span class="op" id="3897523">)</span><span class="op" id="3897524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897528">if</span>&nbsp;<span class="ident" id="3897531">err</span>&nbsp;<span class="op" id="3897535">!=</span>&nbsp;<span class="ident" id="3897538">nil</span>&nbsp;<span class="op" id="3897542">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897547">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897563">return</span>&nbsp;<span class="ident" id="3897570">nil</span><br>
<span class="lineno">230</span><span class="op" id="3897574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3897577">func</span>&nbsp;<span class="ident" id="3897582">marshalBitString</span><span class="op" id="3897598">(</span><span class="ident" id="3897599">out</span>&nbsp;<span class="op" id="3897603">*</span><span class="ident" id="3897604">forkableWriter</span><span class="op" id="3897618">,</span>&nbsp;<span class="ident" id="3897620">b</span>&nbsp;<span class="ident" id="3897622">BitString</span><span class="op" id="3897631">)</span>&nbsp;<span class="op" id="3897633">(</span><span class="ident" id="3897634">err</span>&nbsp;<span class="builtintype" id="3897638">error</span><span class="op" id="3897643">)</span>&nbsp;<span class="op" id="3897645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897648">paddingBits</span>&nbsp;<span class="op" id="3897660">:=</span>&nbsp;<span class="builtintype" id="3897663">byte</span><span class="op" id="3897667">(</span><span class="op" id="3897668">(</span><span class="num" id="3897669">8</span>&nbsp;<span class="op" id="3897671">-</span>&nbsp;<span class="ident" id="3897673">b</span><span class="op" id="3897674">.</span><span class="ident" id="3897675">BitLength</span><span class="op" id="3897684">%</span><span class="num" id="3897685">8</span><span class="op" id="3897686">)</span>&nbsp;<span class="op" id="3897688">%</span>&nbsp;<span class="num" id="3897690">8</span><span class="op" id="3897691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897694">err</span>&nbsp;<span class="op" id="3897698">=</span>&nbsp;<span class="ident" id="3897700">out</span><span class="op" id="3897703">.</span><span class="ident" id="3897704">WriteByte</span><span class="op" id="3897713">(</span><span class="ident" id="3897714">paddingBits</span><span class="op" id="3897725">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897728">if</span>&nbsp;<span class="ident" id="3897731">err</span>&nbsp;<span class="op" id="3897735">!=</span>&nbsp;<span class="ident" id="3897738">nil</span>&nbsp;<span class="op" id="3897742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897746">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897757">_</span><span class="op" id="3897758">,</span>&nbsp;<span class="ident" id="3897760">err</span>&nbsp;<span class="op" id="3897764">=</span>&nbsp;<span class="ident" id="3897766">out</span><span class="op" id="3897769">.</span><span class="ident" id="3897770">Write</span><span class="op" id="3897775">(</span><span class="ident" id="3897776">b</span><span class="op" id="3897777">.</span><span class="ident" id="3897778">Bytes</span><span class="op" id="3897783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897786">return</span><br>
<span class="lineno">240</span><span class="op" id="3897793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3897796">func</span>&nbsp;<span class="ident" id="3897801">marshalObjectIdentifier</span><span class="op" id="3897824">(</span><span class="ident" id="3897825">out</span>&nbsp;<span class="op" id="3897829">*</span><span class="ident" id="3897830">forkableWriter</span><span class="op" id="3897844">,</span>&nbsp;<span class="ident" id="3897846">oid</span>&nbsp;<span class="op" id="3897850">[</span><span class="op" id="3897851">]</span><span class="builtintype" id="3897852">int</span><span class="op" id="3897855">)</span>&nbsp;<span class="op" id="3897857">(</span><span class="ident" id="3897858">err</span>&nbsp;<span class="builtintype" id="3897862">error</span><span class="op" id="3897867">)</span>&nbsp;<span class="op" id="3897869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897872">if</span>&nbsp;<span class="builtinfunc" id="3897875">len</span><span class="op" id="3897878">(</span><span class="ident" id="3897879">oid</span><span class="op" id="3897882">)</span>&nbsp;<span class="op" id="3897884">&lt;</span>&nbsp;<span class="num" id="3897886">2</span>&nbsp;<span class="op" id="3897888">||</span>&nbsp;<span class="ident" id="3897891">oid</span><span class="op" id="3897894">[</span><span class="num" id="3897895">0</span><span class="op" id="3897896">]</span>&nbsp;<span class="op" id="3897898">&gt;</span>&nbsp;<span class="num" id="3897900">2</span>&nbsp;<span class="op" id="3897902">||</span>&nbsp;<span class="op" id="3897905">(</span><span class="ident" id="3897906">oid</span><span class="op" id="3897909">[</span><span class="num" id="3897910">0</span><span class="op" id="3897911">]</span>&nbsp;<span class="op" id="3897913">&lt;</span>&nbsp;<span class="num" id="3897915">2</span>&nbsp;<span class="op" id="3897917">&amp;&amp;</span>&nbsp;<span class="ident" id="3897920">oid</span><span class="op" id="3897923">[</span><span class="num" id="3897924">1</span><span class="op" id="3897925">]</span>&nbsp;<span class="op" id="3897927">&gt;=</span>&nbsp;<span class="num" id="3897930">40</span><span class="op" id="3897932">)</span>&nbsp;<span class="op" id="3897934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897938">return</span>&nbsp;<span class="ident" id="3897945">StructuralError</span><span class="op" id="3897960">{</span><span class="string" id="3897961">&#34;invalid&nbsp;object&nbsp;identifier&#34;</span><span class="op" id="3897988">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897995">err</span>&nbsp;<span class="op" id="3897999">=</span>&nbsp;<span class="ident" id="3898001">marshalBase128Int</span><span class="op" id="3898018">(</span><span class="ident" id="3898019">out</span><span class="op" id="3898022">,</span>&nbsp;<span class="ident" id="3898024">int64</span><span class="op" id="3898029">(</span><span class="ident" id="3898030">oid</span><span class="op" id="3898033">[</span><span class="num" id="3898034">0</span><span class="op" id="3898035">]</span><span class="op" id="3898036">*</span><span class="num" id="3898037">40</span><span class="op" id="3898039">+</span><span class="ident" id="3898040">oid</span><span class="op" id="3898043">[</span><span class="num" id="3898044">1</span><span class="op" id="3898045">]</span><span class="op" id="3898046">)</span><span class="op" id="3898047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898050">if</span>&nbsp;<span class="ident" id="3898053">err</span>&nbsp;<span class="op" id="3898057">!=</span>&nbsp;<span class="ident" id="3898060">nil</span>&nbsp;<span class="op" id="3898064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898068">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898079">for</span>&nbsp;<span class="ident" id="3898083">i</span>&nbsp;<span class="op" id="3898085">:=</span>&nbsp;<span class="num" id="3898088">2</span><span class="op" id="3898089">;</span>&nbsp;<span class="ident" id="3898091">i</span>&nbsp;<span class="op" id="3898093">&lt;</span>&nbsp;<span class="builtinfunc" id="3898095">len</span><span class="op" id="3898098">(</span><span class="ident" id="3898099">oid</span><span class="op" id="3898102">)</span><span class="op" id="3898103">;</span>&nbsp;<span class="ident" id="3898105">i</span><span class="op" id="3898106">++</span>&nbsp;<span class="op" id="3898109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898113">err</span>&nbsp;<span class="op" id="3898117">=</span>&nbsp;<span class="ident" id="3898119">marshalBase128Int</span><span class="op" id="3898136">(</span><span class="ident" id="3898137">out</span><span class="op" id="3898140">,</span>&nbsp;<span class="ident" id="3898142">int64</span><span class="op" id="3898147">(</span><span class="ident" id="3898148">oid</span><span class="op" id="3898151">[</span><span class="ident" id="3898152">i</span><span class="op" id="3898153">]</span><span class="op" id="3898154">)</span><span class="op" id="3898155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898159">if</span>&nbsp;<span class="ident" id="3898162">err</span>&nbsp;<span class="op" id="3898166">!=</span>&nbsp;<span class="ident" id="3898169">nil</span>&nbsp;<span class="op" id="3898173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898178">return</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898194">return</span><br>
<span class="lineno"></span><span class="op" id="3898201">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="3898204">func</span>&nbsp;<span class="ident" id="3898209">marshalPrintableString</span><span class="op" id="3898231">(</span><span class="ident" id="3898232">out</span>&nbsp;<span class="op" id="3898236">*</span><span class="ident" id="3898237">forkableWriter</span><span class="op" id="3898251">,</span>&nbsp;<span class="ident" id="3898253">s</span>&nbsp;<span class="builtintype" id="3898255">string</span><span class="op" id="3898261">)</span>&nbsp;<span class="op" id="3898263">(</span><span class="ident" id="3898264">err</span>&nbsp;<span class="builtintype" id="3898268">error</span><span class="op" id="3898273">)</span>&nbsp;<span class="op" id="3898275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898278">b</span>&nbsp;<span class="op" id="3898280">:=</span>&nbsp;<span class="op" id="3898283">[</span><span class="op" id="3898284">]</span><span class="builtintype" id="3898285">byte</span><span class="op" id="3898289">(</span><span class="ident" id="3898290">s</span><span class="op" id="3898291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898294">for</span>&nbsp;<span class="ident" id="3898298">_</span><span class="op" id="3898299">,</span>&nbsp;<span class="ident" id="3898301">c</span>&nbsp;<span class="op" id="3898303">:=</span>&nbsp;<span class="keyword" id="3898306">range</span>&nbsp;<span class="ident" id="3898312">b</span>&nbsp;<span class="op" id="3898314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898318">if</span>&nbsp;<span class="op" id="3898321">!</span><span class="ident" id="3898322">isPrintable</span><span class="op" id="3898333">(</span><span class="ident" id="3898334">c</span><span class="op" id="3898335">)</span>&nbsp;<span class="op" id="3898337">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898342">return</span>&nbsp;<span class="ident" id="3898349">StructuralError</span><span class="op" id="3898364">{</span><span class="string" id="3898365">&#34;PrintableString&nbsp;contains&nbsp;invalid&nbsp;character&#34;</span><span class="op" id="3898409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898420">_</span><span class="op" id="3898421">,</span>&nbsp;<span class="ident" id="3898423">err</span>&nbsp;<span class="op" id="3898427">=</span>&nbsp;<span class="ident" id="3898429">out</span><span class="op" id="3898432">.</span><span class="ident" id="3898433">Write</span><span class="op" id="3898438">(</span><span class="ident" id="3898439">b</span><span class="op" id="3898440">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898443">return</span><br>
<span class="lineno"></span><span class="op" id="3898450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3898453">func</span>&nbsp;<span class="ident" id="3898458">marshalIA5String</span><span class="op" id="3898474">(</span><span class="ident" id="3898475">out</span>&nbsp;<span class="op" id="3898479">*</span><span class="ident" id="3898480">forkableWriter</span><span class="op" id="3898494">,</span>&nbsp;<span class="ident" id="3898496">s</span>&nbsp;<span class="builtintype" id="3898498">string</span><span class="op" id="3898504">)</span>&nbsp;<span class="op" id="3898506">(</span><span class="ident" id="3898507">err</span>&nbsp;<span class="builtintype" id="3898511">error</span><span class="op" id="3898516">)</span>&nbsp;<span class="op" id="3898518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898521">b</span>&nbsp;<span class="op" id="3898523">:=</span>&nbsp;<span class="op" id="3898526">[</span><span class="op" id="3898527">]</span><span class="builtintype" id="3898528">byte</span><span class="op" id="3898532">(</span><span class="ident" id="3898533">s</span><span class="op" id="3898534">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898537">for</span>&nbsp;<span class="ident" id="3898541">_</span><span class="op" id="3898542">,</span>&nbsp;<span class="ident" id="3898544">c</span>&nbsp;<span class="op" id="3898546">:=</span>&nbsp;<span class="keyword" id="3898549">range</span>&nbsp;<span class="ident" id="3898555">b</span>&nbsp;<span class="op" id="3898557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898561">if</span>&nbsp;<span class="ident" id="3898564">c</span>&nbsp;<span class="op" id="3898566">&gt;</span>&nbsp;<span class="num" id="3898568">127</span>&nbsp;<span class="op" id="3898572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898577">return</span>&nbsp;<span class="ident" id="3898584">StructuralError</span><span class="op" id="3898599">{</span><span class="string" id="3898600">&#34;IA5String&nbsp;contains&nbsp;invalid&nbsp;character&#34;</span><span class="op" id="3898638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898645">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898649">_</span><span class="op" id="3898650">,</span>&nbsp;<span class="ident" id="3898652">err</span>&nbsp;<span class="op" id="3898656">=</span>&nbsp;<span class="ident" id="3898658">out</span><span class="op" id="3898661">.</span><span class="ident" id="3898662">Write</span><span class="op" id="3898667">(</span><span class="ident" id="3898668">b</span><span class="op" id="3898669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898672">return</span><br>
<span class="lineno"></span><span class="op" id="3898679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="3898682">func</span>&nbsp;<span class="ident" id="3898687">marshalUTF8String</span><span class="op" id="3898704">(</span><span class="ident" id="3898705">out</span>&nbsp;<span class="op" id="3898709">*</span><span class="ident" id="3898710">forkableWriter</span><span class="op" id="3898724">,</span>&nbsp;<span class="ident" id="3898726">s</span>&nbsp;<span class="builtintype" id="3898728">string</span><span class="op" id="3898734">)</span>&nbsp;<span class="op" id="3898736">(</span><span class="ident" id="3898737">err</span>&nbsp;<span class="builtintype" id="3898741">error</span><span class="op" id="3898746">)</span>&nbsp;<span class="op" id="3898748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898751">_</span><span class="op" id="3898752">,</span>&nbsp;<span class="ident" id="3898754">err</span>&nbsp;<span class="op" id="3898758">=</span>&nbsp;<span class="ident" id="3898760">out</span><span class="op" id="3898763">.</span><span class="ident" id="3898764">Write</span><span class="op" id="3898769">(</span><span class="op" id="3898770">[</span><span class="op" id="3898771">]</span><span class="builtintype" id="3898772">byte</span><span class="op" id="3898776">(</span><span class="ident" id="3898777">s</span><span class="op" id="3898778">)</span><span class="op" id="3898779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898782">return</span><br>
<span class="lineno"></span><span class="op" id="3898789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="3898792">func</span>&nbsp;<span class="ident" id="3898797">marshalTwoDigits</span><span class="op" id="3898813">(</span><span class="ident" id="3898814">out</span>&nbsp;<span class="op" id="3898818">*</span><span class="ident" id="3898819">forkableWriter</span><span class="op" id="3898833">,</span>&nbsp;<span class="ident" id="3898835">v</span>&nbsp;<span class="builtintype" id="3898837">int</span><span class="op" id="3898840">)</span>&nbsp;<span class="op" id="3898842">(</span><span class="ident" id="3898843">err</span>&nbsp;<span class="builtintype" id="3898847">error</span><span class="op" id="3898852">)</span>&nbsp;<span class="op" id="3898854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898857">err</span>&nbsp;<span class="op" id="3898861">=</span>&nbsp;<span class="ident" id="3898863">out</span><span class="op" id="3898866">.</span><span class="ident" id="3898867">WriteByte</span><span class="op" id="3898876">(</span><span class="builtintype" id="3898877">byte</span><span class="op" id="3898881">(</span><span class="string" id="3898882">&#39;0&#39;</span>&nbsp;<span class="op" id="3898886">+</span>&nbsp;<span class="op" id="3898888">(</span><span class="ident" id="3898889">v</span><span class="op" id="3898890">/</span><span class="num" id="3898891">10</span><span class="op" id="3898893">)</span><span class="op" id="3898894">%</span><span class="num" id="3898895">10</span><span class="op" id="3898897">)</span><span class="op" id="3898898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898901">if</span>&nbsp;<span class="ident" id="3898904">err</span>&nbsp;<span class="op" id="3898908">!=</span>&nbsp;<span class="ident" id="3898911">nil</span>&nbsp;<span class="op" id="3898915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898919">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898927">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898930">return</span>&nbsp;<span class="ident" id="3898937">out</span><span class="op" id="3898940">.</span><span class="ident" id="3898941">WriteByte</span><span class="op" id="3898950">(</span><span class="builtintype" id="3898951">byte</span><span class="op" id="3898955">(</span><span class="string" id="3898956">&#39;0&#39;</span>&nbsp;<span class="op" id="3898960">+</span>&nbsp;<span class="ident" id="3898962">v</span><span class="op" id="3898963">%</span><span class="num" id="3898964">10</span><span class="op" id="3898966">)</span><span class="op" id="3898967">)</span><br>
<span class="lineno"></span><span class="op" id="3898969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3898972">func</span>&nbsp;<span class="ident" id="3898977">marshalFourDigits</span><span class="op" id="3898994">(</span><span class="ident" id="3898995">out</span>&nbsp;<span class="op" id="3898999">*</span><span class="ident" id="3899000">forkableWriter</span><span class="op" id="3899014">,</span>&nbsp;<span class="ident" id="3899016">v</span>&nbsp;<span class="builtintype" id="3899018">int</span><span class="op" id="3899021">)</span>&nbsp;<span class="op" id="3899023">(</span><span class="ident" id="3899024">err</span>&nbsp;<span class="builtintype" id="3899028">error</span><span class="op" id="3899033">)</span>&nbsp;<span class="op" id="3899035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899038">var</span>&nbsp;<span class="ident" id="3899042">bytes</span>&nbsp;<span class="op" id="3899048">[</span><span class="num" id="3899049">4</span><span class="op" id="3899050">]</span><span class="builtintype" id="3899051">byte</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899057">for</span>&nbsp;<span class="ident" id="3899061">i</span>&nbsp;<span class="op" id="3899063">:=</span>&nbsp;<span class="keyword" id="3899066">range</span>&nbsp;<span class="ident" id="3899072">bytes</span>&nbsp;<span class="op" id="3899078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899082">bytes</span><span class="op" id="3899087">[</span><span class="num" id="3899088">3</span><span class="op" id="3899089">-</span><span class="ident" id="3899090">i</span><span class="op" id="3899091">]</span>&nbsp;<span class="op" id="3899093">=</span>&nbsp;<span class="string" id="3899095">&#39;0&#39;</span>&nbsp;<span class="op" id="3899099">+</span>&nbsp;<span class="builtintype" id="3899101">byte</span><span class="op" id="3899105">(</span><span class="ident" id="3899106">v</span><span class="op" id="3899107">%</span><span class="num" id="3899108">10</span><span class="op" id="3899110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899114">v</span>&nbsp;<span class="op" id="3899116">/=</span>&nbsp;<span class="num" id="3899119">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899126">_</span><span class="op" id="3899127">,</span>&nbsp;<span class="ident" id="3899129">err</span>&nbsp;<span class="op" id="3899133">=</span>&nbsp;<span class="ident" id="3899135">out</span><span class="op" id="3899138">.</span><span class="ident" id="3899139">Write</span><span class="op" id="3899144">(</span><span class="ident" id="3899145">bytes</span><span class="op" id="3899150">[</span><span class="op" id="3899151">:</span><span class="op" id="3899152">]</span><span class="op" id="3899153">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899156">return</span><br>
<span class="lineno"></span><span class="op" id="3899163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3899166">func</span>&nbsp;<span class="ident" id="3899171">outsideUTCRange</span><span class="op" id="3899186">(</span><span class="ident" id="3899187">t</span>&nbsp;<span class="ident" id="3899189">time</span><span class="op" id="3899193">.</span><span class="ident" id="3899194">Time</span><span class="op" id="3899198">)</span>&nbsp;<span class="builtintype" id="3899200">bool</span>&nbsp;<span class="op" id="3899205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899208">year</span>&nbsp;<span class="op" id="3899213">:=</span>&nbsp;<span class="ident" id="3899216">t</span><span class="op" id="3899217">.</span><span class="ident" id="3899218">Year</span><span class="op" id="3899222">(</span><span class="op" id="3899223">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899226">return</span>&nbsp;<span class="ident" id="3899233">year</span>&nbsp;<span class="op" id="3899238">&lt;</span>&nbsp;<span class="num" id="3899240">1950</span>&nbsp;<span class="op" id="3899245">||</span>&nbsp;<span class="ident" id="3899248">year</span>&nbsp;<span class="op" id="3899253">&gt;=</span>&nbsp;<span class="num" id="3899256">2050</span><br>
<span class="lineno"></span><span class="op" id="3899261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3899264">func</span>&nbsp;<span class="ident" id="3899269">marshalUTCTime</span><span class="op" id="3899283">(</span><span class="ident" id="3899284">out</span>&nbsp;<span class="op" id="3899288">*</span><span class="ident" id="3899289">forkableWriter</span><span class="op" id="3899303">,</span>&nbsp;<span class="ident" id="3899305">t</span>&nbsp;<span class="ident" id="3899307">time</span><span class="op" id="3899311">.</span><span class="ident" id="3899312">Time</span><span class="op" id="3899316">)</span>&nbsp;<span class="op" id="3899318">(</span><span class="ident" id="3899319">err</span>&nbsp;<span class="builtintype" id="3899323">error</span><span class="op" id="3899328">)</span>&nbsp;<span class="op" id="3899330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899333">year</span>&nbsp;<span class="op" id="3899338">:=</span>&nbsp;<span class="ident" id="3899341">t</span><span class="op" id="3899342">.</span><span class="ident" id="3899343">Year</span><span class="op" id="3899347">(</span><span class="op" id="3899348">)</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899352">switch</span>&nbsp;<span class="op" id="3899359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899362">case</span>&nbsp;<span class="num" id="3899367">1950</span>&nbsp;<span class="op" id="3899372">&lt;=</span>&nbsp;<span class="ident" id="3899375">year</span>&nbsp;<span class="op" id="3899380">&amp;&amp;</span>&nbsp;<span class="ident" id="3899383">year</span>&nbsp;<span class="op" id="3899388">&lt;</span>&nbsp;<span class="num" id="3899390">2000</span><span class="op" id="3899394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899398">err</span>&nbsp;<span class="op" id="3899402">=</span>&nbsp;<span class="ident" id="3899404">marshalTwoDigits</span><span class="op" id="3899420">(</span><span class="ident" id="3899421">out</span><span class="op" id="3899424">,</span>&nbsp;<span class="builtintype" id="3899426">int</span><span class="op" id="3899429">(</span><span class="ident" id="3899430">year</span><span class="op" id="3899434">-</span><span class="num" id="3899435">1900</span><span class="op" id="3899439">)</span><span class="op" id="3899440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899443">case</span>&nbsp;<span class="num" id="3899448">2000</span>&nbsp;<span class="op" id="3899453">&lt;=</span>&nbsp;<span class="ident" id="3899456">year</span>&nbsp;<span class="op" id="3899461">&amp;&amp;</span>&nbsp;<span class="ident" id="3899464">year</span>&nbsp;<span class="op" id="3899469">&lt;</span>&nbsp;<span class="num" id="3899471">2050</span><span class="op" id="3899475">:</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899479">err</span>&nbsp;<span class="op" id="3899483">=</span>&nbsp;<span class="ident" id="3899485">marshalTwoDigits</span><span class="op" id="3899501">(</span><span class="ident" id="3899502">out</span><span class="op" id="3899505">,</span>&nbsp;<span class="builtintype" id="3899507">int</span><span class="op" id="3899510">(</span><span class="ident" id="3899511">year</span><span class="op" id="3899515">-</span><span class="num" id="3899516">2000</span><span class="op" id="3899520">)</span><span class="op" id="3899521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899524">default</span><span class="op" id="3899531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899535">return</span>&nbsp;<span class="ident" id="3899542">StructuralError</span><span class="op" id="3899557">{</span><span class="string" id="3899558">&#34;cannot&nbsp;represent&nbsp;time&nbsp;as&nbsp;UTCTime&#34;</span><span class="op" id="3899592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899598">if</span>&nbsp;<span class="ident" id="3899601">err</span>&nbsp;<span class="op" id="3899605">!=</span>&nbsp;<span class="ident" id="3899608">nil</span>&nbsp;<span class="op" id="3899612">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899616">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899628">return</span>&nbsp;<span class="ident" id="3899635">marshalTimeCommon</span><span class="op" id="3899652">(</span><span class="ident" id="3899653">out</span><span class="op" id="3899656">,</span>&nbsp;<span class="ident" id="3899658">t</span><span class="op" id="3899659">)</span><br>
<span class="lineno"></span><span class="op" id="3899661">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="3899664">func</span>&nbsp;<span class="ident" id="3899669">marshalGeneralizedTime</span><span class="op" id="3899691">(</span><span class="ident" id="3899692">out</span>&nbsp;<span class="op" id="3899696">*</span><span class="ident" id="3899697">forkableWriter</span><span class="op" id="3899711">,</span>&nbsp;<span class="ident" id="3899713">t</span>&nbsp;<span class="ident" id="3899715">time</span><span class="op" id="3899719">.</span><span class="ident" id="3899720">Time</span><span class="op" id="3899724">)</span>&nbsp;<span class="op" id="3899726">(</span><span class="ident" id="3899727">err</span>&nbsp;<span class="builtintype" id="3899731">error</span><span class="op" id="3899736">)</span>&nbsp;<span class="op" id="3899738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899741">year</span>&nbsp;<span class="op" id="3899746">:=</span>&nbsp;<span class="ident" id="3899749">t</span><span class="op" id="3899750">.</span><span class="ident" id="3899751">Year</span><span class="op" id="3899755">(</span><span class="op" id="3899756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899759">if</span>&nbsp;<span class="ident" id="3899762">year</span>&nbsp;<span class="op" id="3899767">&lt;</span>&nbsp;<span class="num" id="3899769">0</span>&nbsp;<span class="op" id="3899771">||</span>&nbsp;<span class="ident" id="3899774">year</span>&nbsp;<span class="op" id="3899779">&gt;</span>&nbsp;<span class="num" id="3899781">9999</span>&nbsp;<span class="op" id="3899786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899790">return</span>&nbsp;<span class="ident" id="3899797">StructuralError</span><span class="op" id="3899812">{</span><span class="string" id="3899813">&#34;cannot&nbsp;represent&nbsp;time&nbsp;as&nbsp;GeneralizedTime&#34;</span><span class="op" id="3899855">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899861">if</span>&nbsp;<span class="ident" id="3899864">err</span>&nbsp;<span class="op" id="3899868">=</span>&nbsp;<span class="ident" id="3899870">marshalFourDigits</span><span class="op" id="3899887">(</span><span class="ident" id="3899888">out</span><span class="op" id="3899891">,</span>&nbsp;<span class="ident" id="3899893">year</span><span class="op" id="3899897">)</span><span class="op" id="3899898">;</span>&nbsp;<span class="ident" id="3899900">err</span>&nbsp;<span class="op" id="3899904">!=</span>&nbsp;<span class="ident" id="3899907">nil</span>&nbsp;<span class="op" id="3899911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899915">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899927">return</span>&nbsp;<span class="ident" id="3899934">marshalTimeCommon</span><span class="op" id="3899951">(</span><span class="ident" id="3899952">out</span><span class="op" id="3899955">,</span>&nbsp;<span class="ident" id="3899957">t</span><span class="op" id="3899958">)</span><br>
<span class="lineno"></span><span class="op" id="3899960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3899963">func</span>&nbsp;<span class="ident" id="3899968">marshalTimeCommon</span><span class="op" id="3899985">(</span><span class="ident" id="3899986">out</span>&nbsp;<span class="op" id="3899990">*</span><span class="ident" id="3899991">forkableWriter</span><span class="op" id="3900005">,</span>&nbsp;<span class="ident" id="3900007">t</span>&nbsp;<span class="ident" id="3900009">time</span><span class="op" id="3900013">.</span><span class="ident" id="3900014">Time</span><span class="op" id="3900018">)</span>&nbsp;<span class="op" id="3900020">(</span><span class="ident" id="3900021">err</span>&nbsp;<span class="builtintype" id="3900025">error</span><span class="op" id="3900030">)</span>&nbsp;<span class="op" id="3900032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900035">_</span><span class="op" id="3900036">,</span>&nbsp;<span class="ident" id="3900038">month</span><span class="op" id="3900043">,</span>&nbsp;<span class="ident" id="3900045">day</span>&nbsp;<span class="op" id="3900049">:=</span>&nbsp;<span class="ident" id="3900052">t</span><span class="op" id="3900053">.</span><span class="ident" id="3900054">Date</span><span class="op" id="3900058">(</span><span class="op" id="3900059">)</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900063">err</span>&nbsp;<span class="op" id="3900067">=</span>&nbsp;<span class="ident" id="3900069">marshalTwoDigits</span><span class="op" id="3900085">(</span><span class="ident" id="3900086">out</span><span class="op" id="3900089">,</span>&nbsp;<span class="builtintype" id="3900091">int</span><span class="op" id="3900094">(</span><span class="ident" id="3900095">month</span><span class="op" id="3900100">)</span><span class="op" id="3900101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900104">if</span>&nbsp;<span class="ident" id="3900107">err</span>&nbsp;<span class="op" id="3900111">!=</span>&nbsp;<span class="ident" id="3900114">nil</span>&nbsp;<span class="op" id="3900118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900122">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900130">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900134">err</span>&nbsp;<span class="op" id="3900138">=</span>&nbsp;<span class="ident" id="3900140">marshalTwoDigits</span><span class="op" id="3900156">(</span><span class="ident" id="3900157">out</span><span class="op" id="3900160">,</span>&nbsp;<span class="ident" id="3900162">day</span><span class="op" id="3900165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900168">if</span>&nbsp;<span class="ident" id="3900171">err</span>&nbsp;<span class="op" id="3900175">!=</span>&nbsp;<span class="ident" id="3900178">nil</span>&nbsp;<span class="op" id="3900182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900186">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900194">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900198">hour</span><span class="op" id="3900202">,</span>&nbsp;<span class="ident" id="3900204">min</span><span class="op" id="3900207">,</span>&nbsp;<span class="ident" id="3900209">sec</span>&nbsp;<span class="op" id="3900213">:=</span>&nbsp;<span class="ident" id="3900216">t</span><span class="op" id="3900217">.</span><span class="ident" id="3900218">Clock</span><span class="op" id="3900223">(</span><span class="op" id="3900224">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900228">err</span>&nbsp;<span class="op" id="3900232">=</span>&nbsp;<span class="ident" id="3900234">marshalTwoDigits</span><span class="op" id="3900250">(</span><span class="ident" id="3900251">out</span><span class="op" id="3900254">,</span>&nbsp;<span class="ident" id="3900256">hour</span><span class="op" id="3900260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900263">if</span>&nbsp;<span class="ident" id="3900266">err</span>&nbsp;<span class="op" id="3900270">!=</span>&nbsp;<span class="ident" id="3900273">nil</span>&nbsp;<span class="op" id="3900277">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900281">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900293">err</span>&nbsp;<span class="op" id="3900297">=</span>&nbsp;<span class="ident" id="3900299">marshalTwoDigits</span><span class="op" id="3900315">(</span><span class="ident" id="3900316">out</span><span class="op" id="3900319">,</span>&nbsp;<span class="ident" id="3900321">min</span><span class="op" id="3900324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900327">if</span>&nbsp;<span class="ident" id="3900330">err</span>&nbsp;<span class="op" id="3900334">!=</span>&nbsp;<span class="ident" id="3900337">nil</span>&nbsp;<span class="op" id="3900341">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900345">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900357">err</span>&nbsp;<span class="op" id="3900361">=</span>&nbsp;<span class="ident" id="3900363">marshalTwoDigits</span><span class="op" id="3900379">(</span><span class="ident" id="3900380">out</span><span class="op" id="3900383">,</span>&nbsp;<span class="ident" id="3900385">sec</span><span class="op" id="3900388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900391">if</span>&nbsp;<span class="ident" id="3900394">err</span>&nbsp;<span class="op" id="3900398">!=</span>&nbsp;<span class="ident" id="3900401">nil</span>&nbsp;<span class="op" id="3900405">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900409">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900421">_</span><span class="op" id="3900422">,</span>&nbsp;<span class="ident" id="3900424">offset</span>&nbsp;<span class="op" id="3900431">:=</span>&nbsp;<span class="ident" id="3900434">t</span><span class="op" id="3900435">.</span><span class="ident" id="3900436">Zone</span><span class="op" id="3900440">(</span><span class="op" id="3900441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900445">switch</span>&nbsp;<span class="op" id="3900452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900455">case</span>&nbsp;<span class="ident" id="3900460">offset</span><span class="op" id="3900466">/</span><span class="num" id="3900467">60</span>&nbsp;<span class="op" id="3900470">==</span>&nbsp;<span class="num" id="3900473">0</span><span class="op" id="3900474">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900478">err</span>&nbsp;<span class="op" id="3900482">=</span>&nbsp;<span class="ident" id="3900484">out</span><span class="op" id="3900487">.</span><span class="ident" id="3900488">WriteByte</span><span class="op" id="3900497">(</span><span class="string" id="3900498">&#39;Z&#39;</span><span class="op" id="3900501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900505">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900513">case</span>&nbsp;<span class="ident" id="3900518">offset</span>&nbsp;<span class="op" id="3900525">&gt;</span>&nbsp;<span class="num" id="3900527">0</span><span class="op" id="3900528">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900532">err</span>&nbsp;<span class="op" id="3900536">=</span>&nbsp;<span class="ident" id="3900538">out</span><span class="op" id="3900541">.</span><span class="ident" id="3900542">WriteByte</span><span class="op" id="3900551">(</span><span class="string" id="3900552">&#39;+&#39;</span><span class="op" id="3900555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900558">case</span>&nbsp;<span class="ident" id="3900563">offset</span>&nbsp;<span class="op" id="3900570">&lt;</span>&nbsp;<span class="num" id="3900572">0</span><span class="op" id="3900573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900577">err</span>&nbsp;<span class="op" id="3900581">=</span>&nbsp;<span class="ident" id="3900583">out</span><span class="op" id="3900586">.</span><span class="ident" id="3900587">WriteByte</span><span class="op" id="3900596">(</span><span class="string" id="3900597">&#39;-&#39;</span><span class="op" id="3900600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900607">if</span>&nbsp;<span class="ident" id="3900610">err</span>&nbsp;<span class="op" id="3900614">!=</span>&nbsp;<span class="ident" id="3900617">nil</span>&nbsp;<span class="op" id="3900621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900625">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900637">offsetMinutes</span>&nbsp;<span class="op" id="3900651">:=</span>&nbsp;<span class="ident" id="3900654">offset</span>&nbsp;<span class="op" id="3900661">/</span>&nbsp;<span class="num" id="3900663">60</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900667">if</span>&nbsp;<span class="ident" id="3900670">offsetMinutes</span>&nbsp;<span class="op" id="3900684">&lt;</span>&nbsp;<span class="num" id="3900686">0</span>&nbsp;<span class="op" id="3900688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900692">offsetMinutes</span>&nbsp;<span class="op" id="3900706">=</span>&nbsp;<span class="op" id="3900708">-</span><span class="ident" id="3900709">offsetMinutes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900728">err</span>&nbsp;<span class="op" id="3900732">=</span>&nbsp;<span class="ident" id="3900734">marshalTwoDigits</span><span class="op" id="3900750">(</span><span class="ident" id="3900751">out</span><span class="op" id="3900754">,</span>&nbsp;<span class="ident" id="3900756">offsetMinutes</span><span class="op" id="3900769">/</span><span class="num" id="3900770">60</span><span class="op" id="3900772">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900775">if</span>&nbsp;<span class="ident" id="3900778">err</span>&nbsp;<span class="op" id="3900782">!=</span>&nbsp;<span class="ident" id="3900785">nil</span>&nbsp;<span class="op" id="3900789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900793">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900805">err</span>&nbsp;<span class="op" id="3900809">=</span>&nbsp;<span class="ident" id="3900811">marshalTwoDigits</span><span class="op" id="3900827">(</span><span class="ident" id="3900828">out</span><span class="op" id="3900831">,</span>&nbsp;<span class="ident" id="3900833">offsetMinutes</span><span class="op" id="3900846">%</span><span class="num" id="3900847">60</span><span class="op" id="3900849">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900852">return</span><br>
<span class="lineno"></span><span class="op" id="3900859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3900862">func</span>&nbsp;<span class="ident" id="3900867">stripTagAndLength</span><span class="op" id="3900884">(</span><span class="ident" id="3900885">in</span>&nbsp;<span class="op" id="3900888">[</span><span class="op" id="3900889">]</span><span class="builtintype" id="3900890">byte</span><span class="op" id="3900894">)</span>&nbsp;<span class="op" id="3900896">[</span><span class="op" id="3900897">]</span><span class="builtintype" id="3900898">byte</span>&nbsp;<span class="op" id="3900903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900906">_</span><span class="op" id="3900907">,</span>&nbsp;<span class="ident" id="3900909">offset</span><span class="op" id="3900915">,</span>&nbsp;<span class="ident" id="3900917">err</span>&nbsp;<span class="op" id="3900921">:=</span>&nbsp;<span class="ident" id="3900924">parseTagAndLength</span><span class="op" id="3900941">(</span><span class="ident" id="3900942">in</span><span class="op" id="3900944">,</span>&nbsp;<span class="num" id="3900946">0</span><span class="op" id="3900947">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900950">if</span>&nbsp;<span class="ident" id="3900953">err</span>&nbsp;<span class="op" id="3900957">!=</span>&nbsp;<span class="ident" id="3900960">nil</span>&nbsp;<span class="op" id="3900964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900968">return</span>&nbsp;<span class="ident" id="3900975">in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900982">return</span>&nbsp;<span class="ident" id="3900989">in</span><span class="op" id="3900991">[</span><span class="ident" id="3900992">offset</span><span class="op" id="3900998">:</span><span class="op" id="3900999">]</span><br>
<span class="lineno"></span><span class="op" id="3901001">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span><span class="keyword" id="3901004">func</span>&nbsp;<span class="ident" id="3901009">marshalBody</span><span class="op" id="3901020">(</span><span class="ident" id="3901021">out</span>&nbsp;<span class="op" id="3901025">*</span><span class="ident" id="3901026">forkableWriter</span><span class="op" id="3901040">,</span>&nbsp;<span class="ident" id="3901042">value</span>&nbsp;<span class="ident" id="3901048">reflect</span><span class="op" id="3901055">.</span><span class="ident" id="3901056">Value</span><span class="op" id="3901061">,</span>&nbsp;<span class="ident" id="3901063">params</span>&nbsp;<span class="ident" id="3901070">fieldParameters</span><span class="op" id="3901085">)</span>&nbsp;<span class="op" id="3901087">(</span><span class="ident" id="3901088">err</span>&nbsp;<span class="builtintype" id="3901092">error</span><span class="op" id="3901097">)</span>&nbsp;<span class="op" id="3901099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901102">switch</span>&nbsp;<span class="ident" id="3901109">value</span><span class="op" id="3901114">.</span><span class="ident" id="3901115">Type</span><span class="op" id="3901119">(</span><span class="op" id="3901120">)</span>&nbsp;<span class="op" id="3901122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901125">case</span>&nbsp;<span class="ident" id="3901130">timeType</span><span class="op" id="3901138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901142">t</span>&nbsp;<span class="op" id="3901144">:=</span>&nbsp;<span class="ident" id="3901147">value</span><span class="op" id="3901152">.</span><span class="ident" id="3901153">Interface</span><span class="op" id="3901162">(</span><span class="op" id="3901163">)</span><span class="op" id="3901164">.</span><span class="op" id="3901165">(</span><span class="ident" id="3901166">time</span><span class="op" id="3901170">.</span><span class="ident" id="3901171">Time</span><span class="op" id="3901175">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901179">if</span>&nbsp;<span class="ident" id="3901182">outsideUTCRange</span><span class="op" id="3901197">(</span><span class="ident" id="3901198">t</span><span class="op" id="3901199">)</span>&nbsp;<span class="op" id="3901201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901206">return</span>&nbsp;<span class="ident" id="3901213">marshalGeneralizedTime</span><span class="op" id="3901235">(</span><span class="ident" id="3901236">out</span><span class="op" id="3901239">,</span>&nbsp;<span class="ident" id="3901241">t</span><span class="op" id="3901242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901246">}</span>&nbsp;<span class="keyword" id="3901248">else</span>&nbsp;<span class="op" id="3901253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901258">return</span>&nbsp;<span class="ident" id="3901265">marshalUTCTime</span><span class="op" id="3901279">(</span><span class="ident" id="3901280">out</span><span class="op" id="3901283">,</span>&nbsp;<span class="ident" id="3901285">t</span><span class="op" id="3901286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901290">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901293">case</span>&nbsp;<span class="ident" id="3901298">bitStringType</span><span class="op" id="3901311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901315">return</span>&nbsp;<span class="ident" id="3901322">marshalBitString</span><span class="op" id="3901338">(</span><span class="ident" id="3901339">out</span><span class="op" id="3901342">,</span>&nbsp;<span class="ident" id="3901344">value</span><span class="op" id="3901349">.</span><span class="ident" id="3901350">Interface</span><span class="op" id="3901359">(</span><span class="op" id="3901360">)</span><span class="op" id="3901361">.</span><span class="op" id="3901362">(</span><span class="ident" id="3901363">BitString</span><span class="op" id="3901372">)</span><span class="op" id="3901373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901376">case</span>&nbsp;<span class="ident" id="3901381">objectIdentifierType</span><span class="op" id="3901401">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901405">return</span>&nbsp;<span class="ident" id="3901412">marshalObjectIdentifier</span><span class="op" id="3901435">(</span><span class="ident" id="3901436">out</span><span class="op" id="3901439">,</span>&nbsp;<span class="ident" id="3901441">value</span><span class="op" id="3901446">.</span><span class="ident" id="3901447">Interface</span><span class="op" id="3901456">(</span><span class="op" id="3901457">)</span><span class="op" id="3901458">.</span><span class="op" id="3901459">(</span><span class="ident" id="3901460">ObjectIdentifier</span><span class="op" id="3901476">)</span><span class="op" id="3901477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901480">case</span>&nbsp;<span class="ident" id="3901485">bigIntType</span><span class="op" id="3901495">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901499">return</span>&nbsp;<span class="ident" id="3901506">marshalBigInt</span><span class="op" id="3901519">(</span><span class="ident" id="3901520">out</span><span class="op" id="3901523">,</span>&nbsp;<span class="ident" id="3901525">value</span><span class="op" id="3901530">.</span><span class="ident" id="3901531">Interface</span><span class="op" id="3901540">(</span><span class="op" id="3901541">)</span><span class="op" id="3901542">.</span><span class="op" id="3901543">(</span><span class="op" id="3901544">*</span><span class="ident" id="3901545">big</span><span class="op" id="3901548">.</span><span class="ident" id="3901549">Int</span><span class="op" id="3901552">)</span><span class="op" id="3901553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901560">switch</span>&nbsp;<span class="ident" id="3901567">v</span>&nbsp;<span class="op" id="3901569">:=</span>&nbsp;<span class="ident" id="3901572">value</span><span class="op" id="3901577">;</span>&nbsp;<span class="ident" id="3901579">v</span><span class="op" id="3901580">.</span><span class="ident" id="3901581">Kind</span><span class="op" id="3901585">(</span><span class="op" id="3901586">)</span>&nbsp;<span class="op" id="3901588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901591">case</span>&nbsp;<span class="ident" id="3901596">reflect</span><span class="op" id="3901603">.</span><span class="ident" id="3901604">Bool</span><span class="op" id="3901608">:</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901612">if</span>&nbsp;<span class="ident" id="3901615">v</span><span class="op" id="3901616">.</span><span class="ident" id="3901617">Bool</span><span class="op" id="3901621">(</span><span class="op" id="3901622">)</span>&nbsp;<span class="op" id="3901624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901629">return</span>&nbsp;<span class="ident" id="3901636">out</span><span class="op" id="3901639">.</span><span class="ident" id="3901640">WriteByte</span><span class="op" id="3901649">(</span><span class="num" id="3901650">255</span><span class="op" id="3901653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901657">}</span>&nbsp;<span class="keyword" id="3901659">else</span>&nbsp;<span class="op" id="3901664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901669">return</span>&nbsp;<span class="ident" id="3901676">out</span><span class="op" id="3901679">.</span><span class="ident" id="3901680">WriteByte</span><span class="op" id="3901689">(</span><span class="num" id="3901690">0</span><span class="op" id="3901691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901695">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901698">case</span>&nbsp;<span class="ident" id="3901703">reflect</span><span class="op" id="3901710">.</span><span class="ident" id="3901711">Int</span><span class="op" id="3901714">,</span>&nbsp;<span class="ident" id="3901716">reflect</span><span class="op" id="3901723">.</span><span class="ident" id="3901724">Int8</span><span class="op" id="3901728">,</span>&nbsp;<span class="ident" id="3901730">reflect</span><span class="op" id="3901737">.</span><span class="ident" id="3901738">Int16</span><span class="op" id="3901743">,</span>&nbsp;<span class="ident" id="3901745">reflect</span><span class="op" id="3901752">.</span><span class="ident" id="3901753">Int32</span><span class="op" id="3901758">,</span>&nbsp;<span class="ident" id="3901760">reflect</span><span class="op" id="3901767">.</span><span class="ident" id="3901768">Int64</span><span class="op" id="3901773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901777">return</span>&nbsp;<span class="ident" id="3901784">marshalInt64</span><span class="op" id="3901796">(</span><span class="ident" id="3901797">out</span><span class="op" id="3901800">,</span>&nbsp;<span class="ident" id="3901802">int64</span><span class="op" id="3901807">(</span><span class="ident" id="3901808">v</span><span class="op" id="3901809">.</span><span class="ident" id="3901810">Int</span><span class="op" id="3901813">(</span><span class="op" id="3901814">)</span><span class="op" id="3901815">)</span><span class="op" id="3901816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901819">case</span>&nbsp;<span class="ident" id="3901824">reflect</span><span class="op" id="3901831">.</span><span class="ident" id="3901832">Struct</span><span class="op" id="3901838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901842">t</span>&nbsp;<span class="op" id="3901844">:=</span>&nbsp;<span class="ident" id="3901847">v</span><span class="op" id="3901848">.</span><span class="ident" id="3901849">Type</span><span class="op" id="3901853">(</span><span class="op" id="3901854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901859">startingField</span>&nbsp;<span class="op" id="3901873">:=</span>&nbsp;<span class="num" id="3901876">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3901881">//&nbsp;If&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;the&nbsp;structure&nbsp;is&nbsp;a&nbsp;non-empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3901939">//&nbsp;RawContents,&nbsp;then&nbsp;we&nbsp;don&#39;t&nbsp;bother&nbsp;serializing&nbsp;the&nbsp;rest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902000">if</span>&nbsp;<span class="ident" id="3902003">t</span><span class="op" id="3902004">.</span><span class="ident" id="3902005">NumField</span><span class="op" id="3902013">(</span><span class="op" id="3902014">)</span>&nbsp;<span class="op" id="3902016">&gt;</span>&nbsp;<span class="num" id="3902018">0</span>&nbsp;<span class="op" id="3902020">&amp;&amp;</span>&nbsp;<span class="ident" id="3902023">t</span><span class="op" id="3902024">.</span><span class="ident" id="3902025">Field</span><span class="op" id="3902030">(</span><span class="num" id="3902031">0</span><span class="op" id="3902032">)</span><span class="op" id="3902033">.</span><span class="ident" id="3902034">Type</span>&nbsp;<span class="op" id="3902039">==</span>&nbsp;<span class="ident" id="3902042">rawContentsType</span>&nbsp;<span class="op" id="3902058">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902063">s</span>&nbsp;<span class="op" id="3902065">:=</span>&nbsp;<span class="ident" id="3902068">v</span><span class="op" id="3902069">.</span><span class="ident" id="3902070">Field</span><span class="op" id="3902075">(</span><span class="num" id="3902076">0</span><span class="op" id="3902077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902082">if</span>&nbsp;<span class="ident" id="3902085">s</span><span class="op" id="3902086">.</span><span class="ident" id="3902087">Len</span><span class="op" id="3902090">(</span><span class="op" id="3902091">)</span>&nbsp;<span class="op" id="3902093">&gt;</span>&nbsp;<span class="num" id="3902095">0</span>&nbsp;<span class="op" id="3902097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902103">bytes</span>&nbsp;<span class="op" id="3902109">:=</span>&nbsp;<span class="builtinfunc" id="3902112">make</span><span class="op" id="3902116">(</span><span class="op" id="3902117">[</span><span class="op" id="3902118">]</span><span class="builtintype" id="3902119">byte</span><span class="op" id="3902123">,</span>&nbsp;<span class="ident" id="3902125">s</span><span class="op" id="3902126">.</span><span class="ident" id="3902127">Len</span><span class="op" id="3902130">(</span><span class="op" id="3902131">)</span><span class="op" id="3902132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902138">for</span>&nbsp;<span class="ident" id="3902142">i</span>&nbsp;<span class="op" id="3902144">:=</span>&nbsp;<span class="num" id="3902147">0</span><span class="op" id="3902148">;</span>&nbsp;<span class="ident" id="3902150">i</span>&nbsp;<span class="op" id="3902152">&lt;</span>&nbsp;<span class="ident" id="3902154">s</span><span class="op" id="3902155">.</span><span class="ident" id="3902156">Len</span><span class="op" id="3902159">(</span><span class="op" id="3902160">)</span><span class="op" id="3902161">;</span>&nbsp;<span class="ident" id="3902163">i</span><span class="op" id="3902164">++</span>&nbsp;<span class="op" id="3902167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902174">bytes</span><span class="op" id="3902179">[</span><span class="ident" id="3902180">i</span><span class="op" id="3902181">]</span>&nbsp;<span class="op" id="3902183">=</span>&nbsp;<span class="builtintype" id="3902185">uint8</span><span class="op" id="3902190">(</span><span class="ident" id="3902191">s</span><span class="op" id="3902192">.</span><span class="ident" id="3902193">Index</span><span class="op" id="3902198">(</span><span class="ident" id="3902199">i</span><span class="op" id="3902200">)</span><span class="op" id="3902201">.</span><span class="ident" id="3902202">Uint</span><span class="op" id="3902206">(</span><span class="op" id="3902207">)</span><span class="op" id="3902208">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3902214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3902220">/*&nbsp;The&nbsp;RawContents&nbsp;will&nbsp;contain&nbsp;the&nbsp;tag&nbsp;and<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;length&nbsp;fields&nbsp;but&nbsp;we&#39;ll&nbsp;also&nbsp;be&nbsp;writing<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;those&nbsp;ourselves,&nbsp;so&nbsp;we&nbsp;strip&nbsp;them&nbsp;out&nbsp;of<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;bytes&nbsp;*/</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902379">_</span><span class="op" id="3902380">,</span>&nbsp;<span class="ident" id="3902382">err</span>&nbsp;<span class="op" id="3902386">=</span>&nbsp;<span class="ident" id="3902388">out</span><span class="op" id="3902391">.</span><span class="ident" id="3902392">Write</span><span class="op" id="3902397">(</span><span class="ident" id="3902398">stripTagAndLength</span><span class="op" id="3902415">(</span><span class="ident" id="3902416">bytes</span><span class="op" id="3902421">)</span><span class="op" id="3902422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902428">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3902438">}</span>&nbsp;<span class="keyword" id="3902440">else</span>&nbsp;<span class="op" id="3902445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902451">startingField</span>&nbsp;<span class="op" id="3902465">=</span>&nbsp;<span class="num" id="3902467">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3902472">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3902476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902481">for</span>&nbsp;<span class="ident" id="3902485">i</span>&nbsp;<span class="op" id="3902487">:=</span>&nbsp;<span class="ident" id="3902490">startingField</span><span class="op" id="3902503">;</span>&nbsp;<span class="ident" id="3902505">i</span>&nbsp;<span class="op" id="3902507">&lt;</span>&nbsp;<span class="ident" id="3902509">t</span><span class="op" id="3902510">.</span><span class="ident" id="3902511">NumField</span><span class="op" id="3902519">(</span><span class="op" id="3902520">)</span><span class="op" id="3902521">;</span>&nbsp;<span class="ident" id="3902523">i</span><span class="op" id="3902524">++</span>&nbsp;<span class="op" id="3902527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902532">var</span>&nbsp;<span class="ident" id="3902536">pre</span>&nbsp;<span class="op" id="3902540">*</span><span class="ident" id="3902541">forkableWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902559">pre</span><span class="op" id="3902562">,</span>&nbsp;<span class="ident" id="3902564">out</span>&nbsp;<span class="op" id="3902568">=</span>&nbsp;<span class="ident" id="3902570">out</span><span class="op" id="3902573">.</span><span class="ident" id="3902574">fork</span><span class="op" id="3902578">(</span><span class="op" id="3902579">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902584">err</span>&nbsp;<span class="op" id="3902588">=</span>&nbsp;<span class="ident" id="3902590">marshalField</span><span class="op" id="3902602">(</span><span class="ident" id="3902603">pre</span><span class="op" id="3902606">,</span>&nbsp;<span class="ident" id="3902608">v</span><span class="op" id="3902609">.</span><span class="ident" id="3902610">Field</span><span class="op" id="3902615">(</span><span class="ident" id="3902616">i</span><span class="op" id="3902617">)</span><span class="op" id="3902618">,</span>&nbsp;<span class="ident" id="3902620">parseFieldParameters</span><span class="op" id="3902640">(</span><span class="ident" id="3902641">t</span><span class="op" id="3902642">.</span><span class="ident" id="3902643">Field</span><span class="op" id="3902648">(</span><span class="ident" id="3902649">i</span><span class="op" id="3902650">)</span><span class="op" id="3902651">.</span><span class="ident" id="3902652">Tag</span><span class="op" id="3902655">.</span><span class="ident" id="3902656">Get</span><span class="op" id="3902659">(</span><span class="string" id="3902660">&#34;asn1&#34;</span><span class="op" id="3902666">)</span><span class="op" id="3902667">)</span><span class="op" id="3902668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902673">if</span>&nbsp;<span class="ident" id="3902676">err</span>&nbsp;<span class="op" id="3902680">!=</span>&nbsp;<span class="ident" id="3902683">nil</span>&nbsp;<span class="op" id="3902687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902693">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3902703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3902707">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902711">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902719">case</span>&nbsp;<span class="ident" id="3902724">reflect</span><span class="op" id="3902731">.</span><span class="ident" id="3902732">Slice</span><span class="op" id="3902737">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902741">sliceType</span>&nbsp;<span class="op" id="3902751">:=</span>&nbsp;<span class="ident" id="3902754">v</span><span class="op" id="3902755">.</span><span class="ident" id="3902756">Type</span><span class="op" id="3902760">(</span><span class="op" id="3902761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902765">if</span>&nbsp;<span class="ident" id="3902768">sliceType</span><span class="op" id="3902777">.</span><span class="ident" id="3902778">Elem</span><span class="op" id="3902782">(</span><span class="op" id="3902783">)</span><span class="op" id="3902784">.</span><span class="ident" id="3902785">Kind</span><span class="op" id="3902789">(</span><span class="op" id="3902790">)</span>&nbsp;<span class="op" id="3902792">==</span>&nbsp;<span class="ident" id="3902795">reflect</span><span class="op" id="3902802">.</span><span class="ident" id="3902803">Uint8</span>&nbsp;<span class="op" id="3902809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902814">bytes</span>&nbsp;<span class="op" id="3902820">:=</span>&nbsp;<span class="builtinfunc" id="3902823">make</span><span class="op" id="3902827">(</span><span class="op" id="3902828">[</span><span class="op" id="3902829">]</span><span class="builtintype" id="3902830">byte</span><span class="op" id="3902834">,</span>&nbsp;<span class="ident" id="3902836">v</span><span class="op" id="3902837">.</span><span class="ident" id="3902838">Len</span><span class="op" id="3902841">(</span><span class="op" id="3902842">)</span><span class="op" id="3902843">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902848">for</span>&nbsp;<span class="ident" id="3902852">i</span>&nbsp;<span class="op" id="3902854">:=</span>&nbsp;<span class="num" id="3902857">0</span><span class="op" id="3902858">;</span>&nbsp;<span class="ident" id="3902860">i</span>&nbsp;<span class="op" id="3902862">&lt;</span>&nbsp;<span class="ident" id="3902864">v</span><span class="op" id="3902865">.</span><span class="ident" id="3902866">Len</span><span class="op" id="3902869">(</span><span class="op" id="3902870">)</span><span class="op" id="3902871">;</span>&nbsp;<span class="ident" id="3902873">i</span><span class="op" id="3902874">++</span>&nbsp;<span class="op" id="3902877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902883">bytes</span><span class="op" id="3902888">[</span><span class="ident" id="3902889">i</span><span class="op" id="3902890">]</span>&nbsp;<span class="op" id="3902892">=</span>&nbsp;<span class="builtintype" id="3902894">uint8</span><span class="op" id="3902899">(</span><span class="ident" id="3902900">v</span><span class="op" id="3902901">.</span><span class="ident" id="3902902">Index</span><span class="op" id="3902907">(</span><span class="ident" id="3902908">i</span><span class="op" id="3902909">)</span><span class="op" id="3902910">.</span><span class="ident" id="3902911">Uint</span><span class="op" id="3902915">(</span><span class="op" id="3902916">)</span><span class="op" id="3902917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3902922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902927">_</span><span class="op" id="3902928">,</span>&nbsp;<span class="ident" id="3902930">err</span>&nbsp;<span class="op" id="3902934">=</span>&nbsp;<span class="ident" id="3902936">out</span><span class="op" id="3902939">.</span><span class="ident" id="3902940">Write</span><span class="op" id="3902945">(</span><span class="ident" id="3902946">bytes</span><span class="op" id="3902951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902956">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3902965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902970">var</span>&nbsp;<span class="ident" id="3902974">fp</span>&nbsp;<span class="ident" id="3902977">fieldParameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902995">for</span>&nbsp;<span class="ident" id="3902999">i</span>&nbsp;<span class="op" id="3903001">:=</span>&nbsp;<span class="num" id="3903004">0</span><span class="op" id="3903005">;</span>&nbsp;<span class="ident" id="3903007">i</span>&nbsp;<span class="op" id="3903009">&lt;</span>&nbsp;<span class="ident" id="3903011">v</span><span class="op" id="3903012">.</span><span class="ident" id="3903013">Len</span><span class="op" id="3903016">(</span><span class="op" id="3903017">)</span><span class="op" id="3903018">;</span>&nbsp;<span class="ident" id="3903020">i</span><span class="op" id="3903021">++</span>&nbsp;<span class="op" id="3903024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903029">var</span>&nbsp;<span class="ident" id="3903033">pre</span>&nbsp;<span class="op" id="3903037">*</span><span class="ident" id="3903038">forkableWriter</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903056">pre</span><span class="op" id="3903059">,</span>&nbsp;<span class="ident" id="3903061">out</span>&nbsp;<span class="op" id="3903065">=</span>&nbsp;<span class="ident" id="3903067">out</span><span class="op" id="3903070">.</span><span class="ident" id="3903071">fork</span><span class="op" id="3903075">(</span><span class="op" id="3903076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903081">err</span>&nbsp;<span class="op" id="3903085">=</span>&nbsp;<span class="ident" id="3903087">marshalField</span><span class="op" id="3903099">(</span><span class="ident" id="3903100">pre</span><span class="op" id="3903103">,</span>&nbsp;<span class="ident" id="3903105">v</span><span class="op" id="3903106">.</span><span class="ident" id="3903107">Index</span><span class="op" id="3903112">(</span><span class="ident" id="3903113">i</span><span class="op" id="3903114">)</span><span class="op" id="3903115">,</span>&nbsp;<span class="ident" id="3903117">fp</span><span class="op" id="3903119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903124">if</span>&nbsp;<span class="ident" id="3903127">err</span>&nbsp;<span class="op" id="3903131">!=</span>&nbsp;<span class="ident" id="3903134">nil</span>&nbsp;<span class="op" id="3903138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903144">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3903154">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3903158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903162">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903170">case</span>&nbsp;<span class="ident" id="3903175">reflect</span><span class="op" id="3903182">.</span><span class="ident" id="3903183">String</span><span class="op" id="3903189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903193">switch</span>&nbsp;<span class="ident" id="3903200">params</span><span class="op" id="3903206">.</span><span class="ident" id="3903207">stringType</span>&nbsp;<span class="op" id="3903218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903222">case</span>&nbsp;<span class="ident" id="3903227">tagIA5String</span><span class="op" id="3903239">:</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903244">return</span>&nbsp;<span class="ident" id="3903251">marshalIA5String</span><span class="op" id="3903267">(</span><span class="ident" id="3903268">out</span><span class="op" id="3903271">,</span>&nbsp;<span class="ident" id="3903273">v</span><span class="op" id="3903274">.</span><span class="ident" id="3903275">String</span><span class="op" id="3903281">(</span><span class="op" id="3903282">)</span><span class="op" id="3903283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903287">case</span>&nbsp;<span class="ident" id="3903292">tagPrintableString</span><span class="op" id="3903310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903315">return</span>&nbsp;<span class="ident" id="3903322">marshalPrintableString</span><span class="op" id="3903344">(</span><span class="ident" id="3903345">out</span><span class="op" id="3903348">,</span>&nbsp;<span class="ident" id="3903350">v</span><span class="op" id="3903351">.</span><span class="ident" id="3903352">String</span><span class="op" id="3903358">(</span><span class="op" id="3903359">)</span><span class="op" id="3903360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903364">default</span><span class="op" id="3903371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903376">return</span>&nbsp;<span class="ident" id="3903383">marshalUTF8String</span><span class="op" id="3903400">(</span><span class="ident" id="3903401">out</span><span class="op" id="3903404">,</span>&nbsp;<span class="ident" id="3903406">v</span><span class="op" id="3903407">.</span><span class="ident" id="3903408">String</span><span class="op" id="3903414">(</span><span class="op" id="3903415">)</span><span class="op" id="3903416">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3903420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3903423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903427">return</span>&nbsp;<span class="ident" id="3903434">StructuralError</span><span class="op" id="3903449">{</span><span class="string" id="3903450">&#34;unknown&nbsp;Go&nbsp;type&#34;</span><span class="op" id="3903467">}</span><br>
<span class="lineno"></span><span class="op" id="3903469">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="keyword" id="3903472">func</span>&nbsp;<span class="ident" id="3903477">marshalField</span><span class="op" id="3903489">(</span><span class="ident" id="3903490">out</span>&nbsp;<span class="op" id="3903494">*</span><span class="ident" id="3903495">forkableWriter</span><span class="op" id="3903509">,</span>&nbsp;<span class="ident" id="3903511">v</span>&nbsp;<span class="ident" id="3903513">reflect</span><span class="op" id="3903520">.</span><span class="ident" id="3903521">Value</span><span class="op" id="3903526">,</span>&nbsp;<span class="ident" id="3903528">params</span>&nbsp;<span class="ident" id="3903535">fieldParameters</span><span class="op" id="3903550">)</span>&nbsp;<span class="op" id="3903552">(</span><span class="ident" id="3903553">err</span>&nbsp;<span class="builtintype" id="3903557">error</span><span class="op" id="3903562">)</span>&nbsp;<span class="op" id="3903564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3903567">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;an&nbsp;interface{}&nbsp;then&nbsp;recurse&nbsp;into&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903624">if</span>&nbsp;<span class="ident" id="3903627">v</span><span class="op" id="3903628">.</span><span class="ident" id="3903629">Kind</span><span class="op" id="3903633">(</span><span class="op" id="3903634">)</span>&nbsp;<span class="op" id="3903636">==</span>&nbsp;<span class="ident" id="3903639">reflect</span><span class="op" id="3903646">.</span><span class="ident" id="3903647">Interface</span>&nbsp;<span class="op" id="3903657">&amp;&amp;</span>&nbsp;<span class="ident" id="3903660">v</span><span class="op" id="3903661">.</span><span class="ident" id="3903662">Type</span><span class="op" id="3903666">(</span><span class="op" id="3903667">)</span><span class="op" id="3903668">.</span><span class="ident" id="3903669">NumMethod</span><span class="op" id="3903678">(</span><span class="op" id="3903679">)</span>&nbsp;<span class="op" id="3903681">==</span>&nbsp;<span class="num" id="3903684">0</span>&nbsp;<span class="op" id="3903686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903690">return</span>&nbsp;<span class="ident" id="3903697">marshalField</span><span class="op" id="3903709">(</span><span class="ident" id="3903710">out</span><span class="op" id="3903713">,</span>&nbsp;<span class="ident" id="3903715">v</span><span class="op" id="3903716">.</span><span class="ident" id="3903717">Elem</span><span class="op" id="3903721">(</span><span class="op" id="3903722">)</span><span class="op" id="3903723">,</span>&nbsp;<span class="ident" id="3903725">params</span><span class="op" id="3903731">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3903734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903738">if</span>&nbsp;<span class="ident" id="3903741">v</span><span class="op" id="3903742">.</span><span class="ident" id="3903743">Kind</span><span class="op" id="3903747">(</span><span class="op" id="3903748">)</span>&nbsp;<span class="op" id="3903750">==</span>&nbsp;<span class="ident" id="3903753">reflect</span><span class="op" id="3903760">.</span><span class="ident" id="3903761">Slice</span>&nbsp;<span class="op" id="3903767">&amp;&amp;</span>&nbsp;<span class="ident" id="3903770">v</span><span class="op" id="3903771">.</span><span class="ident" id="3903772">Len</span><span class="op" id="3903775">(</span><span class="op" id="3903776">)</span>&nbsp;<span class="op" id="3903778">==</span>&nbsp;<span class="num" id="3903781">0</span>&nbsp;<span class="op" id="3903783">&amp;&amp;</span>&nbsp;<span class="ident" id="3903786">params</span><span class="op" id="3903792">.</span><span class="ident" id="3903793">omitEmpty</span>&nbsp;<span class="op" id="3903803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903807">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3903815">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903819">if</span>&nbsp;<span class="ident" id="3903822">params</span><span class="op" id="3903828">.</span><span class="ident" id="3903829">optional</span>&nbsp;<span class="op" id="3903838">&amp;&amp;</span>&nbsp;<span class="ident" id="3903841">params</span><span class="op" id="3903847">.</span><span class="ident" id="3903848">defaultValue</span>&nbsp;<span class="op" id="3903861">!=</span>&nbsp;<span class="ident" id="3903864">nil</span>&nbsp;<span class="op" id="3903868">&amp;&amp;</span>&nbsp;<span class="ident" id="3903871">canHaveDefaultValue</span><span class="op" id="3903890">(</span><span class="ident" id="3903891">v</span><span class="op" id="3903892">.</span><span class="ident" id="3903893">Kind</span><span class="op" id="3903897">(</span><span class="op" id="3903898">)</span><span class="op" id="3903899">)</span>&nbsp;<span class="op" id="3903901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903905">defaultValue</span>&nbsp;<span class="op" id="3903918">:=</span>&nbsp;<span class="ident" id="3903921">reflect</span><span class="op" id="3903928">.</span><span class="ident" id="3903929">New</span><span class="op" id="3903932">(</span><span class="ident" id="3903933">v</span><span class="op" id="3903934">.</span><span class="ident" id="3903935">Type</span><span class="op" id="3903939">(</span><span class="op" id="3903940">)</span><span class="op" id="3903941">)</span><span class="op" id="3903942">.</span><span class="ident" id="3903943">Elem</span><span class="op" id="3903947">(</span><span class="op" id="3903948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903952">defaultValue</span><span class="op" id="3903964">.</span><span class="ident" id="3903965">SetInt</span><span class="op" id="3903971">(</span><span class="op" id="3903972">*</span><span class="ident" id="3903973">params</span><span class="op" id="3903979">.</span><span class="ident" id="3903980">defaultValue</span><span class="op" id="3903992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903997">if</span>&nbsp;<span class="ident" id="3904000">reflect</span><span class="op" id="3904007">.</span><span class="ident" id="3904008">DeepEqual</span><span class="op" id="3904017">(</span><span class="ident" id="3904018">v</span><span class="op" id="3904019">.</span><span class="ident" id="3904020">Interface</span><span class="op" id="3904029">(</span><span class="op" id="3904030">)</span><span class="op" id="3904031">,</span>&nbsp;<span class="ident" id="3904033">defaultValue</span><span class="op" id="3904045">.</span><span class="ident" id="3904046">Interface</span><span class="op" id="3904055">(</span><span class="op" id="3904056">)</span><span class="op" id="3904057">)</span>&nbsp;<span class="op" id="3904059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904064">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3904080">//&nbsp;If&nbsp;no&nbsp;default&nbsp;value&nbsp;is&nbsp;given&nbsp;then&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;the&nbsp;type&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3904149">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;the&nbsp;default&nbsp;value.&nbsp;This&nbsp;isn&#39;t&nbsp;obviously&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3904219">//&nbsp;behaviour,&nbsp;but&nbsp;it&#39;s&nbsp;what&nbsp;Go&nbsp;has&nbsp;traditionally&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904275">if</span>&nbsp;<span class="ident" id="3904278">params</span><span class="op" id="3904284">.</span><span class="ident" id="3904285">optional</span>&nbsp;<span class="op" id="3904294">&amp;&amp;</span>&nbsp;<span class="ident" id="3904297">params</span><span class="op" id="3904303">.</span><span class="ident" id="3904304">defaultValue</span>&nbsp;<span class="op" id="3904317">==</span>&nbsp;<span class="ident" id="3904320">nil</span>&nbsp;<span class="op" id="3904324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904328">if</span>&nbsp;<span class="ident" id="3904331">reflect</span><span class="op" id="3904338">.</span><span class="ident" id="3904339">DeepEqual</span><span class="op" id="3904348">(</span><span class="ident" id="3904349">v</span><span class="op" id="3904350">.</span><span class="ident" id="3904351">Interface</span><span class="op" id="3904360">(</span><span class="op" id="3904361">)</span><span class="op" id="3904362">,</span>&nbsp;<span class="ident" id="3904364">reflect</span><span class="op" id="3904371">.</span><span class="ident" id="3904372">Zero</span><span class="op" id="3904376">(</span><span class="ident" id="3904377">v</span><span class="op" id="3904378">.</span><span class="ident" id="3904379">Type</span><span class="op" id="3904383">(</span><span class="op" id="3904384">)</span><span class="op" id="3904385">)</span><span class="op" id="3904386">.</span><span class="ident" id="3904387">Interface</span><span class="op" id="3904396">(</span><span class="op" id="3904397">)</span><span class="op" id="3904398">)</span>&nbsp;<span class="op" id="3904400">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904405">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904421">if</span>&nbsp;<span class="ident" id="3904424">v</span><span class="op" id="3904425">.</span><span class="ident" id="3904426">Type</span><span class="op" id="3904430">(</span><span class="op" id="3904431">)</span>&nbsp;<span class="op" id="3904433">==</span>&nbsp;<span class="ident" id="3904436">rawValueType</span>&nbsp;<span class="op" id="3904449">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3904453">rv</span>&nbsp;<span class="op" id="3904456">:=</span>&nbsp;<span class="ident" id="3904459">v</span><span class="op" id="3904460">.</span><span class="ident" id="3904461">Interface</span><span class="op" id="3904470">(</span><span class="op" id="3904471">)</span><span class="op" id="3904472">.</span><span class="op" id="3904473">(</span><span class="ident" id="3904474">RawValue</span><span class="op" id="3904482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904486">if</span>&nbsp;<span class="builtinfunc" id="3904489">len</span><span class="op" id="3904492">(</span><span class="ident" id="3904493">rv</span><span class="op" id="3904495">.</span><span class="ident" id="3904496">FullBytes</span><span class="op" id="3904505">)</span>&nbsp;<span class="op" id="3904507">!=</span>&nbsp;<span class="num" id="3904510">0</span>&nbsp;<span class="op" id="3904512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3904517">_</span><span class="op" id="3904518">,</span>&nbsp;<span class="ident" id="3904520">err</span>&nbsp;<span class="op" id="3904524">=</span>&nbsp;<span class="ident" id="3904526">out</span><span class="op" id="3904529">.</span><span class="ident" id="3904530">Write</span><span class="op" id="3904535">(</span><span class="ident" id="3904536">rv</span><span class="op" id="3904538">.</span><span class="ident" id="3904539">FullBytes</span><span class="op" id="3904548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904552">}</span>&nbsp;<span class="keyword" id="3904554">else</span>&nbsp;<span class="op" id="3904559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3904564">err</span>&nbsp;<span class="op" id="3904568">=</span>&nbsp;<span class="ident" id="3904570">marshalTagAndLength</span><span class="op" id="3904589">(</span><span class="ident" id="3904590">out</span><span class="op" id="3904593">,</span>&nbsp;<span class="ident" id="3904595">tagAndLength</span><span class="op" id="3904607">{</span><span class="ident" id="3904608">rv</span><span class="op" id="3904610">.</span><span class="ident" id="3904611">Class</span><span class="op" id="3904616">,</span>&nbsp;<span class="ident" id="3904618">rv</span><span class="op" id="3904620">.</span><span class="ident" id="3904621">Tag</span><span class="op" id="3904624">,</span>&nbsp;<span class="builtinfunc" id="3904626">len</span><span class="op" id="3904629">(</span><span class="ident" id="3904630">rv</span><span class="op" id="3904632">.</span><span class="ident" id="3904633">Bytes</span><span class="op" id="3904638">)</span><span class="op" id="3904639">,</span>&nbsp;<span class="ident" id="3904641">rv</span><span class="op" id="3904643">.</span><span class="ident" id="3904644">IsCompound</span><span class="op" id="3904654">}</span><span class="op" id="3904655">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904660">if</span>&nbsp;<span class="ident" id="3904663">err</span>&nbsp;<span class="op" id="3904667">!=</span>&nbsp;<span class="ident" id="3904670">nil</span>&nbsp;<span class="op" id="3904674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904680">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3904695">_</span><span class="op" id="3904696">,</span>&nbsp;<span class="ident" id="3904698">err</span>&nbsp;<span class="op" id="3904702">=</span>&nbsp;<span class="ident" id="3904704">out</span><span class="op" id="3904707">.</span><span class="ident" id="3904708">Write</span><span class="op" id="3904713">(</span><span class="ident" id="3904714">rv</span><span class="op" id="3904716">.</span><span class="ident" id="3904717">Bytes</span><span class="op" id="3904722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904726">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904730">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3904742">tag</span><span class="op" id="3904745">,</span>&nbsp;<span class="ident" id="3904747">isCompound</span><span class="op" id="3904757">,</span>&nbsp;<span class="ident" id="3904759">ok</span>&nbsp;<span class="op" id="3904762">:=</span>&nbsp;<span class="ident" id="3904765">getUniversalType</span><span class="op" id="3904781">(</span><span class="ident" id="3904782">v</span><span class="op" id="3904783">.</span><span class="ident" id="3904784">Type</span><span class="op" id="3904788">(</span><span class="op" id="3904789">)</span><span class="op" id="3904790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904793">if</span>&nbsp;<span class="op" id="3904796">!</span><span class="ident" id="3904797">ok</span>&nbsp;<span class="op" id="3904800">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3904804">err</span>&nbsp;<span class="op" id="3904808">=</span>&nbsp;<span class="ident" id="3904810">StructuralError</span><span class="op" id="3904825">{</span><span class="ident" id="3904826">fmt</span><span class="op" id="3904829">.</span><span class="ident" id="3904830">Sprintf</span><span class="op" id="3904837">(</span><span class="string" id="3904838">&#34;unknown&nbsp;Go&nbsp;type:&nbsp;%v&#34;</span><span class="op" id="3904859">,</span>&nbsp;<span class="ident" id="3904861">v</span><span class="op" id="3904862">.</span><span class="ident" id="3904863">Type</span><span class="op" id="3904867">(</span><span class="op" id="3904868">)</span><span class="op" id="3904869">)</span><span class="op" id="3904870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904874">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3904885">class</span>&nbsp;<span class="op" id="3904891">:=</span>&nbsp;<span class="ident" id="3904894">classUniversal</span><br>
<span class="lineno"></span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904911">if</span>&nbsp;<span class="ident" id="3904914">params</span><span class="op" id="3904920">.</span><span class="ident" id="3904921">stringType</span>&nbsp;<span class="op" id="3904932">!=</span>&nbsp;<span class="num" id="3904935">0</span>&nbsp;<span class="op" id="3904937">&amp;&amp;</span>&nbsp;<span class="ident" id="3904940">tag</span>&nbsp;<span class="op" id="3904944">!=</span>&nbsp;<span class="ident" id="3904947">tagPrintableString</span>&nbsp;<span class="op" id="3904966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904970">return</span>&nbsp;<span class="ident" id="3904977">StructuralError</span><span class="op" id="3904992">{</span><span class="string" id="3904993">&#34;explicit&nbsp;string&nbsp;type&nbsp;given&nbsp;to&nbsp;non-string&nbsp;member&#34;</span><span class="op" id="3905042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905049">switch</span>&nbsp;<span class="ident" id="3905056">tag</span>&nbsp;<span class="op" id="3905060">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905063">case</span>&nbsp;<span class="ident" id="3905068">tagPrintableString</span><span class="op" id="3905086">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905090">if</span>&nbsp;<span class="ident" id="3905093">params</span><span class="op" id="3905099">.</span><span class="ident" id="3905100">stringType</span>&nbsp;<span class="op" id="3905111">==</span>&nbsp;<span class="num" id="3905114">0</span>&nbsp;<span class="op" id="3905116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3905121">//&nbsp;This&nbsp;is&nbsp;a&nbsp;string&nbsp;without&nbsp;an&nbsp;explicit&nbsp;string&nbsp;type.&nbsp;We&#39;ll&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3905187">//&nbsp;a&nbsp;PrintableString&nbsp;if&nbsp;the&nbsp;character&nbsp;set&nbsp;in&nbsp;the&nbsp;string&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3905249">//&nbsp;sufficiently&nbsp;limited,&nbsp;otherwise&nbsp;we&#39;ll&nbsp;use&nbsp;a&nbsp;UTF8String.</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905311">for</span>&nbsp;<span class="ident" id="3905315">_</span><span class="op" id="3905316">,</span>&nbsp;<span class="ident" id="3905318">r</span>&nbsp;<span class="op" id="3905320">:=</span>&nbsp;<span class="keyword" id="3905323">range</span>&nbsp;<span class="ident" id="3905329">v</span><span class="op" id="3905330">.</span><span class="ident" id="3905331">String</span><span class="op" id="3905337">(</span><span class="op" id="3905338">)</span>&nbsp;<span class="op" id="3905340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905346">if</span>&nbsp;<span class="ident" id="3905349">r</span>&nbsp;<span class="op" id="3905351">&gt;=</span>&nbsp;<span class="ident" id="3905354">utf8</span><span class="op" id="3905358">.</span><span class="ident" id="3905359">RuneSelf</span>&nbsp;<span class="op" id="3905368">||</span>&nbsp;<span class="op" id="3905371">!</span><span class="ident" id="3905372">isPrintable</span><span class="op" id="3905383">(</span><span class="builtintype" id="3905384">byte</span><span class="op" id="3905388">(</span><span class="ident" id="3905389">r</span><span class="op" id="3905390">)</span><span class="op" id="3905391">)</span>&nbsp;<span class="op" id="3905393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905400">if</span>&nbsp;<span class="op" id="3905403">!</span><span class="ident" id="3905404">utf8</span><span class="op" id="3905408">.</span><span class="ident" id="3905409">ValidString</span><span class="op" id="3905420">(</span><span class="ident" id="3905421">v</span><span class="op" id="3905422">.</span><span class="ident" id="3905423">String</span><span class="op" id="3905429">(</span><span class="op" id="3905430">)</span><span class="op" id="3905431">)</span>&nbsp;<span class="op" id="3905433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905441">return</span>&nbsp;<span class="ident" id="3905448">errors</span><span class="op" id="3905454">.</span><span class="ident" id="3905455">New</span><span class="op" id="3905458">(</span><span class="string" id="3905459">&#34;asn1:&nbsp;string&nbsp;not&nbsp;valid&nbsp;UTF-8&#34;</span><span class="op" id="3905489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905496">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905503">tag</span>&nbsp;<span class="op" id="3905507">=</span>&nbsp;<span class="ident" id="3905509">tagUTF8String</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905528">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905547">}</span>&nbsp;<span class="keyword" id="3905549">else</span>&nbsp;<span class="op" id="3905554">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905559">tag</span>&nbsp;<span class="op" id="3905563">=</span>&nbsp;<span class="ident" id="3905565">params</span><span class="op" id="3905571">.</span><span class="ident" id="3905572">stringType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905588">case</span>&nbsp;<span class="ident" id="3905593">tagUTCTime</span><span class="op" id="3905603">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905607">if</span>&nbsp;<span class="ident" id="3905610">outsideUTCRange</span><span class="op" id="3905625">(</span><span class="ident" id="3905626">v</span><span class="op" id="3905627">.</span><span class="ident" id="3905628">Interface</span><span class="op" id="3905637">(</span><span class="op" id="3905638">)</span><span class="op" id="3905639">.</span><span class="op" id="3905640">(</span><span class="ident" id="3905641">time</span><span class="op" id="3905645">.</span><span class="ident" id="3905646">Time</span><span class="op" id="3905650">)</span><span class="op" id="3905651">)</span>&nbsp;<span class="op" id="3905653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905658">tag</span>&nbsp;<span class="op" id="3905662">=</span>&nbsp;<span class="ident" id="3905664">tagGeneralizedTime</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905692">if</span>&nbsp;<span class="ident" id="3905695">params</span><span class="op" id="3905701">.</span><span class="ident" id="3905702">set</span>&nbsp;<span class="op" id="3905706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905710">if</span>&nbsp;<span class="ident" id="3905713">tag</span>&nbsp;<span class="op" id="3905717">!=</span>&nbsp;<span class="ident" id="3905720">tagSequence</span>&nbsp;<span class="op" id="3905732">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905737">return</span>&nbsp;<span class="ident" id="3905744">StructuralError</span><span class="op" id="3905759">{</span><span class="string" id="3905760">&#34;non&nbsp;sequence&nbsp;tagged&nbsp;as&nbsp;set&#34;</span><span class="op" id="3905788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905796">tag</span>&nbsp;<span class="op" id="3905800">=</span>&nbsp;<span class="ident" id="3905802">tagSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905814">tags</span><span class="op" id="3905818">,</span>&nbsp;<span class="ident" id="3905820">body</span>&nbsp;<span class="op" id="3905825">:=</span>&nbsp;<span class="ident" id="3905828">out</span><span class="op" id="3905831">.</span><span class="ident" id="3905832">fork</span><span class="op" id="3905836">(</span><span class="op" id="3905837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905841">err</span>&nbsp;<span class="op" id="3905845">=</span>&nbsp;<span class="ident" id="3905847">marshalBody</span><span class="op" id="3905858">(</span><span class="ident" id="3905859">body</span><span class="op" id="3905863">,</span>&nbsp;<span class="ident" id="3905865">v</span><span class="op" id="3905866">,</span>&nbsp;<span class="ident" id="3905868">params</span><span class="op" id="3905874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905877">if</span>&nbsp;<span class="ident" id="3905880">err</span>&nbsp;<span class="op" id="3905884">!=</span>&nbsp;<span class="ident" id="3905887">nil</span>&nbsp;<span class="op" id="3905891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905895">return</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905907">bodyLen</span>&nbsp;<span class="op" id="3905915">:=</span>&nbsp;<span class="ident" id="3905918">body</span><span class="op" id="3905922">.</span><span class="ident" id="3905923">Len</span><span class="op" id="3905926">(</span><span class="op" id="3905927">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905931">var</span>&nbsp;<span class="ident" id="3905935">explicitTag</span>&nbsp;<span class="op" id="3905947">*</span><span class="ident" id="3905948">forkableWriter</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905964">if</span>&nbsp;<span class="ident" id="3905967">params</span><span class="op" id="3905973">.</span><span class="ident" id="3905974">explicit</span>&nbsp;<span class="op" id="3905983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905987">explicitTag</span><span class="op" id="3905998">,</span>&nbsp;<span class="ident" id="3906000">tags</span>&nbsp;<span class="op" id="3906005">=</span>&nbsp;<span class="ident" id="3906007">tags</span><span class="op" id="3906011">.</span><span class="ident" id="3906012">fork</span><span class="op" id="3906016">(</span><span class="op" id="3906017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3906020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3906024">if</span>&nbsp;<span class="op" id="3906027">!</span><span class="ident" id="3906028">params</span><span class="op" id="3906034">.</span><span class="ident" id="3906035">explicit</span>&nbsp;<span class="op" id="3906044">&amp;&amp;</span>&nbsp;<span class="ident" id="3906047">params</span><span class="op" id="3906053">.</span><span class="ident" id="3906054">tag</span>&nbsp;<span class="op" id="3906058">!=</span>&nbsp;<span class="ident" id="3906061">nil</span>&nbsp;<span class="op" id="3906065">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3906069">//&nbsp;implicit&nbsp;tag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906088">tag</span>&nbsp;<span class="op" id="3906092">=</span>&nbsp;<span class="op" id="3906094">*</span><span class="ident" id="3906095">params</span><span class="op" id="3906101">.</span><span class="ident" id="3906102">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906108">class</span>&nbsp;<span class="op" id="3906114">=</span>&nbsp;<span class="ident" id="3906116">classContextSpecific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3906138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906142">err</span>&nbsp;<span class="op" id="3906146">=</span>&nbsp;<span class="ident" id="3906148">marshalTagAndLength</span><span class="op" id="3906167">(</span><span class="ident" id="3906168">tags</span><span class="op" id="3906172">,</span>&nbsp;<span class="ident" id="3906174">tagAndLength</span><span class="op" id="3906186">{</span><span class="ident" id="3906187">class</span><span class="op" id="3906192">,</span>&nbsp;<span class="ident" id="3906194">tag</span><span class="op" id="3906197">,</span>&nbsp;<span class="ident" id="3906199">bodyLen</span><span class="op" id="3906206">,</span>&nbsp;<span class="ident" id="3906208">isCompound</span><span class="op" id="3906218">}</span><span class="op" id="3906219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3906222">if</span>&nbsp;<span class="ident" id="3906225">err</span>&nbsp;<span class="op" id="3906229">!=</span>&nbsp;<span class="ident" id="3906232">nil</span>&nbsp;<span class="op" id="3906236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3906240">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3906248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3906252">if</span>&nbsp;<span class="ident" id="3906255">params</span><span class="op" id="3906261">.</span><span class="ident" id="3906262">explicit</span>&nbsp;<span class="op" id="3906271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906275">err</span>&nbsp;<span class="op" id="3906279">=</span>&nbsp;<span class="ident" id="3906281">marshalTagAndLength</span><span class="op" id="3906300">(</span><span class="ident" id="3906301">explicitTag</span><span class="op" id="3906312">,</span>&nbsp;<span class="ident" id="3906314">tagAndLength</span><span class="op" id="3906326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906331">class</span><span class="op" id="3906336">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906343">classContextSpecific</span><span class="op" id="3906363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906368">tag</span><span class="op" id="3906371">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3906380">*</span><span class="ident" id="3906381">params</span><span class="op" id="3906387">.</span><span class="ident" id="3906388">tag</span><span class="op" id="3906391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906396">length</span><span class="op" id="3906402">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3906408">bodyLen</span>&nbsp;<span class="op" id="3906416">+</span>&nbsp;<span class="ident" id="3906418">tags</span><span class="op" id="3906422">.</span><span class="ident" id="3906423">Len</span><span class="op" id="3906426">(</span><span class="op" id="3906427">)</span><span class="op" id="3906428">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906433">isCompound</span><span class="op" id="3906443">:</span>&nbsp;<span class="builtintype" id="3906445">true</span><span class="op" id="3906449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3906453">}</span><span class="op" id="3906454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3906457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3906461">return</span>&nbsp;<span class="ident" id="3906468">nil</span><br>
<span class="lineno">625</span><span class="op" id="3906472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3906475">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;ASN.1&nbsp;encoding&nbsp;of&nbsp;val.</span><br>
<span class="lineno"></span><span class="comment" id="3906521">//</span><br>
<span class="lineno"></span><span class="comment" id="3906524">//&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;struct&nbsp;tags&nbsp;recognised&nbsp;by&nbsp;Unmarshal,&nbsp;the&nbsp;following&nbsp;can&nbsp;be</span><br>
<span class="lineno">630</span><span class="comment" id="3906604">//&nbsp;used:</span><br>
<span class="lineno"></span><span class="comment" id="3906613">//</span><br>
<span class="lineno"></span><span class="comment" id="3906616">//&nbsp;&nbsp;&nbsp;&nbspia5:&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspcauses&nbsp;strings&nbsp;to&nbsp;be&nbsp;marshaled&nbsp;as&nbsp;ASN.1,&nbsp;IA5&nbsp;strings</span><br>
<span class="lineno"></span><span class="comment" id="3906678">//&nbsp;&nbsp;&nbsp;&nbspomitempty:&nbsp;&nbsp;&nbsp;&nbspcauses&nbsp;empty&nbsp;slices&nbsp;to&nbsp;be&nbsp;skipped</span><br>
<span class="lineno"></span><span class="comment" id="3906726">//&nbsp;&nbsp;&nbsp;&nbspprintable:&nbsp;&nbsp;&nbsp;&nbspcauses&nbsp;strings&nbsp;to&nbsp;be&nbsp;marshaled&nbsp;as&nbsp;ASN.1,&nbsp;PrintableString&nbsp;strings.</span><br>
<span class="lineno">635</span><span class="comment" id="3906806">//&nbsp;&nbsp;&nbsp;&nbsputf8:&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspcauses&nbsp;strings&nbsp;to&nbsp;be&nbsp;marshaled&nbsp;as&nbsp;ASN.1,&nbsp;UTF8&nbsp;strings</span><br>
<span class="lineno"></span><span class="keyword" id="3906870">func</span>&nbsp;<span class="ident" id="3906875">Marshal</span><span class="op" id="3906882">(</span><span class="ident" id="3906883">val</span>&nbsp;<span class="keyword" id="3906887">interface</span><span class="op" id="3906896">{</span><span class="op" id="3906897">}</span><span class="op" id="3906898">)</span>&nbsp;<span class="op" id="3906900">(</span><span class="op" id="3906901">[</span><span class="op" id="3906902">]</span><span class="builtintype" id="3906903">byte</span><span class="op" id="3906907">,</span>&nbsp;<span class="builtintype" id="3906909">error</span><span class="op" id="3906914">)</span>&nbsp;<span class="op" id="3906916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3906919">var</span>&nbsp;<span class="ident" id="3906923">out</span>&nbsp;<span class="ident" id="3906927">bytes</span><span class="op" id="3906932">.</span><span class="ident" id="3906933">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906941">v</span>&nbsp;<span class="op" id="3906943">:=</span>&nbsp;<span class="ident" id="3906946">reflect</span><span class="op" id="3906953">.</span><span class="ident" id="3906954">ValueOf</span><span class="op" id="3906961">(</span><span class="ident" id="3906962">val</span><span class="op" id="3906965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906968">f</span>&nbsp;<span class="op" id="3906970">:=</span>&nbsp;<span class="ident" id="3906973">newForkableWriter</span><span class="op" id="3906990">(</span><span class="op" id="3906991">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906994">err</span>&nbsp;<span class="op" id="3906998">:=</span>&nbsp;<span class="ident" id="3907001">marshalField</span><span class="op" id="3907013">(</span><span class="ident" id="3907014">f</span><span class="op" id="3907015">,</span>&nbsp;<span class="ident" id="3907017">v</span><span class="op" id="3907018">,</span>&nbsp;<span class="ident" id="3907020">fieldParameters</span><span class="op" id="3907035">{</span><span class="op" id="3907036">}</span><span class="op" id="3907037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3907040">if</span>&nbsp;<span class="ident" id="3907043">err</span>&nbsp;<span class="op" id="3907047">!=</span>&nbsp;<span class="ident" id="3907050">nil</span>&nbsp;<span class="op" id="3907054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3907058">return</span>&nbsp;<span class="ident" id="3907065">nil</span><span class="op" id="3907068">,</span>&nbsp;<span class="ident" id="3907070">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3907075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3907078">_</span><span class="op" id="3907079">,</span>&nbsp;<span class="ident" id="3907081">err</span>&nbsp;<span class="op" id="3907085">=</span>&nbsp;<span class="ident" id="3907087">f</span><span class="op" id="3907088">.</span><span class="ident" id="3907089">writeTo</span><span class="op" id="3907096">(</span><span class="op" id="3907097">&amp;</span><span class="ident" id="3907098">out</span><span class="op" id="3907101">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3907104">return</span>&nbsp;<span class="ident" id="3907111">out</span><span class="op" id="3907114">.</span><span class="ident" id="3907115">Bytes</span><span class="op" id="3907120">(</span><span class="op" id="3907121">)</span><span class="op" id="3907122">,</span>&nbsp;<span class="ident" id="3907124">nil</span><br>
<span class="lineno"></span><span class="op" id="3907128">}</span>
</div>
</body>
</html>
