<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html" class="current">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1638972">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1639027">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1639081">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1639132">package</span>&nbsp;<span class="ident" id="1639140">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1639148">import</span>&nbsp;<span class="op" id="1639155">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1639158">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1639167">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1639170">//&nbsp;A&nbsp;Value&nbsp;provides&nbsp;an&nbsp;atomic&nbsp;load&nbsp;and&nbsp;store&nbsp;of&nbsp;a&nbsp;consistently&nbsp;typed&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1639246">//&nbsp;Values&nbsp;can&nbsp;be&nbsp;created&nbsp;as&nbsp;part&nbsp;of&nbsp;other&nbsp;data&nbsp;structures.</span><br>
<span class="lineno"></span><span class="comment" id="1639305">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Value&nbsp;returns&nbsp;nil&nbsp;from&nbsp;Load.</span><br>
<span class="lineno"></span><span class="comment" id="1639358">//&nbsp;Once&nbsp;Store&nbsp;has&nbsp;been&nbsp;called,&nbsp;a&nbsp;Value&nbsp;must&nbsp;not&nbsp;be&nbsp;copied.</span><br>
<span class="lineno">15</span><span class="keyword" id="1639417">type</span>&nbsp;<span class="ident" id="1639422">Value</span>&nbsp;<span class="keyword" id="1639428">struct</span>&nbsp;<span class="op" id="1639435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639438">v</span>&nbsp;<span class="keyword" id="1639440">interface</span><span class="op" id="1639449">{</span><span class="op" id="1639450">}</span><br>
<span class="lineno"></span><span class="op" id="1639452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1639455">//&nbsp;ifaceWords&nbsp;is&nbsp;interface{}&nbsp;internal&nbsp;representation.</span><br>
<span class="lineno">20</span><span class="keyword" id="1639509">type</span>&nbsp;<span class="ident" id="1639514">ifaceWords</span>&nbsp;<span class="keyword" id="1639525">struct</span>&nbsp;<span class="op" id="1639532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639535">typ</span>&nbsp;&nbsp;<span class="ident" id="1639540">unsafe</span><span class="op" id="1639546">.</span><span class="ident" id="1639547">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639556">data</span>&nbsp;<span class="ident" id="1639561">unsafe</span><span class="op" id="1639567">.</span><span class="ident" id="1639568">Pointer</span><br>
<span class="lineno"></span><span class="op" id="1639576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1639579">//&nbsp;Load&nbsp;returns&nbsp;the&nbsp;value&nbsp;set&nbsp;by&nbsp;the&nbsp;most&nbsp;recent&nbsp;Store.</span><br>
<span class="lineno"></span><span class="comment" id="1639635">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;there&nbsp;has&nbsp;been&nbsp;no&nbsp;call&nbsp;to&nbsp;Store&nbsp;for&nbsp;this&nbsp;Value.</span><br>
<span class="lineno"></span><span class="keyword" id="1639704">func</span>&nbsp;<span class="op" id="1639709">(</span><span class="ident" id="1639710">v</span>&nbsp;<span class="op" id="1639712">*</span><span class="ident" id="1639713">Value</span><span class="op" id="1639718">)</span>&nbsp;<span class="ident" id="1639720">Load</span><span class="op" id="1639724">(</span><span class="op" id="1639725">)</span>&nbsp;<span class="op" id="1639727">(</span><span class="ident" id="1639728">x</span>&nbsp;<span class="keyword" id="1639730">interface</span><span class="op" id="1639739">{</span><span class="op" id="1639740">}</span><span class="op" id="1639741">)</span>&nbsp;<span class="op" id="1639743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639746">vp</span>&nbsp;<span class="op" id="1639749">:=</span>&nbsp;<span class="op" id="1639752">(</span><span class="op" id="1639753">*</span><span class="ident" id="1639754">ifaceWords</span><span class="op" id="1639764">)</span><span class="op" id="1639765">(</span><span class="ident" id="1639766">unsafe</span><span class="op" id="1639772">.</span><span class="ident" id="1639773">Pointer</span><span class="op" id="1639780">(</span><span class="ident" id="1639781">v</span><span class="op" id="1639782">)</span><span class="op" id="1639783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639786">typ</span>&nbsp;<span class="op" id="1639790">:=</span>&nbsp;<span class="ident" id="1639793">LoadPointer</span><span class="op" id="1639804">(</span><span class="op" id="1639805">&amp;</span><span class="ident" id="1639806">vp</span><span class="op" id="1639808">.</span><span class="ident" id="1639809">typ</span><span class="op" id="1639812">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639815">if</span>&nbsp;<span class="ident" id="1639818">typ</span>&nbsp;<span class="op" id="1639822">==</span>&nbsp;<span class="ident" id="1639825">nil</span>&nbsp;<span class="op" id="1639829">||</span>&nbsp;<span class="builtintype" id="1639832">uintptr</span><span class="op" id="1639839">(</span><span class="ident" id="1639840">typ</span><span class="op" id="1639843">)</span>&nbsp;<span class="op" id="1639845">==</span>&nbsp;<span class="op" id="1639848">^</span><span class="builtintype" id="1639849">uintptr</span><span class="op" id="1639856">(</span><span class="num" id="1639857">0</span><span class="op" id="1639858">)</span>&nbsp;<span class="op" id="1639860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1639864">//&nbsp;First&nbsp;store&nbsp;not&nbsp;yet&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639900">return</span>&nbsp;<span class="ident" id="1639907">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639915">data</span>&nbsp;<span class="op" id="1639920">:=</span>&nbsp;<span class="ident" id="1639923">LoadPointer</span><span class="op" id="1639934">(</span><span class="op" id="1639935">&amp;</span><span class="ident" id="1639936">vp</span><span class="op" id="1639938">.</span><span class="ident" id="1639939">data</span><span class="op" id="1639943">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639946">xp</span>&nbsp;<span class="op" id="1639949">:=</span>&nbsp;<span class="op" id="1639952">(</span><span class="op" id="1639953">*</span><span class="ident" id="1639954">ifaceWords</span><span class="op" id="1639964">)</span><span class="op" id="1639965">(</span><span class="ident" id="1639966">unsafe</span><span class="op" id="1639972">.</span><span class="ident" id="1639973">Pointer</span><span class="op" id="1639980">(</span><span class="op" id="1639981">&amp;</span><span class="ident" id="1639982">x</span><span class="op" id="1639983">)</span><span class="op" id="1639984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639987">xp</span><span class="op" id="1639989">.</span><span class="ident" id="1639990">typ</span>&nbsp;<span class="op" id="1639994">=</span>&nbsp;<span class="ident" id="1639996">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640001">xp</span><span class="op" id="1640003">.</span><span class="ident" id="1640004">data</span>&nbsp;<span class="op" id="1640009">=</span>&nbsp;<span class="ident" id="1640011">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640017">return</span><br>
<span class="lineno"></span><span class="op" id="1640024">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="1640027">//&nbsp;Store&nbsp;sets&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;Value&nbsp;to&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1640070">//&nbsp;All&nbsp;calls&nbsp;to&nbsp;Store&nbsp;for&nbsp;a&nbsp;given&nbsp;Value&nbsp;must&nbsp;use&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="1640153">//&nbsp;Store&nbsp;of&nbsp;an&nbsp;inconsistent&nbsp;type&nbsp;panics,&nbsp;as&nbsp;does&nbsp;Store(nil).</span><br>
<span class="lineno"></span><span class="keyword" id="1640214">func</span>&nbsp;<span class="op" id="1640219">(</span><span class="ident" id="1640220">v</span>&nbsp;<span class="op" id="1640222">*</span><span class="ident" id="1640223">Value</span><span class="op" id="1640228">)</span>&nbsp;<span class="ident" id="1640230">Store</span><span class="op" id="1640235">(</span><span class="ident" id="1640236">x</span>&nbsp;<span class="keyword" id="1640238">interface</span><span class="op" id="1640247">{</span><span class="op" id="1640248">}</span><span class="op" id="1640249">)</span>&nbsp;<span class="op" id="1640251">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640254">if</span>&nbsp;<span class="ident" id="1640257">x</span>&nbsp;<span class="op" id="1640259">==</span>&nbsp;<span class="ident" id="1640262">nil</span>&nbsp;<span class="op" id="1640266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1640270">panic</span><span class="op" id="1640275">(</span><span class="string" id="1640276">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;nil&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1640320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640326">vp</span>&nbsp;<span class="op" id="1640329">:=</span>&nbsp;<span class="op" id="1640332">(</span><span class="op" id="1640333">*</span><span class="ident" id="1640334">ifaceWords</span><span class="op" id="1640344">)</span><span class="op" id="1640345">(</span><span class="ident" id="1640346">unsafe</span><span class="op" id="1640352">.</span><span class="ident" id="1640353">Pointer</span><span class="op" id="1640360">(</span><span class="ident" id="1640361">v</span><span class="op" id="1640362">)</span><span class="op" id="1640363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640366">xp</span>&nbsp;<span class="op" id="1640369">:=</span>&nbsp;<span class="op" id="1640372">(</span><span class="op" id="1640373">*</span><span class="ident" id="1640374">ifaceWords</span><span class="op" id="1640384">)</span><span class="op" id="1640385">(</span><span class="ident" id="1640386">unsafe</span><span class="op" id="1640392">.</span><span class="ident" id="1640393">Pointer</span><span class="op" id="1640400">(</span><span class="op" id="1640401">&amp;</span><span class="ident" id="1640402">x</span><span class="op" id="1640403">)</span><span class="op" id="1640404">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640407">for</span>&nbsp;<span class="op" id="1640411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640415">typ</span>&nbsp;<span class="op" id="1640419">:=</span>&nbsp;<span class="ident" id="1640422">LoadPointer</span><span class="op" id="1640433">(</span><span class="op" id="1640434">&amp;</span><span class="ident" id="1640435">vp</span><span class="op" id="1640437">.</span><span class="ident" id="1640438">typ</span><span class="op" id="1640441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640445">if</span>&nbsp;<span class="ident" id="1640448">typ</span>&nbsp;<span class="op" id="1640452">==</span>&nbsp;<span class="ident" id="1640455">nil</span>&nbsp;<span class="op" id="1640459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1640464">//&nbsp;Attempt&nbsp;to&nbsp;start&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1640500">//&nbsp;Disable&nbsp;preemption&nbsp;so&nbsp;that&nbsp;other&nbsp;goroutines&nbsp;can&nbsp;use</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1640558">//&nbsp;active&nbsp;spin&nbsp;wait&nbsp;to&nbsp;wait&nbsp;for&nbsp;completion;&nbsp;and&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1640617">//&nbsp;GC&nbsp;does&nbsp;not&nbsp;see&nbsp;the&nbsp;fake&nbsp;type&nbsp;accidentally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640667">runtime_procPin</span><span class="op" id="1640682">(</span><span class="op" id="1640683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640688">if</span>&nbsp;<span class="op" id="1640691">!</span><span class="ident" id="1640692">CompareAndSwapPointer</span><span class="op" id="1640713">(</span><span class="op" id="1640714">&amp;</span><span class="ident" id="1640715">vp</span><span class="op" id="1640717">.</span><span class="ident" id="1640718">typ</span><span class="op" id="1640721">,</span>&nbsp;<span class="ident" id="1640723">nil</span><span class="op" id="1640726">,</span>&nbsp;<span class="ident" id="1640728">unsafe</span><span class="op" id="1640734">.</span><span class="ident" id="1640735">Pointer</span><span class="op" id="1640742">(</span><span class="op" id="1640743">^</span><span class="builtintype" id="1640744">uintptr</span><span class="op" id="1640751">(</span><span class="num" id="1640752">0</span><span class="op" id="1640753">)</span><span class="op" id="1640754">)</span><span class="op" id="1640755">)</span>&nbsp;<span class="op" id="1640757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640763">runtime_procUnpin</span><span class="op" id="1640780">(</span><span class="op" id="1640781">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640787">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1640804">//&nbsp;Complete&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640832">StorePointer</span><span class="op" id="1640844">(</span><span class="op" id="1640845">&amp;</span><span class="ident" id="1640846">vp</span><span class="op" id="1640848">.</span><span class="ident" id="1640849">data</span><span class="op" id="1640853">,</span>&nbsp;<span class="ident" id="1640855">xp</span><span class="op" id="1640857">.</span><span class="ident" id="1640858">data</span><span class="op" id="1640862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640867">StorePointer</span><span class="op" id="1640879">(</span><span class="op" id="1640880">&amp;</span><span class="ident" id="1640881">vp</span><span class="op" id="1640883">.</span><span class="ident" id="1640884">typ</span><span class="op" id="1640887">,</span>&nbsp;<span class="ident" id="1640889">xp</span><span class="op" id="1640891">.</span><span class="ident" id="1640892">typ</span><span class="op" id="1640895">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640900">runtime_procUnpin</span><span class="op" id="1640917">(</span><span class="op" id="1640918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640923">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640936">if</span>&nbsp;<span class="builtintype" id="1640939">uintptr</span><span class="op" id="1640946">(</span><span class="ident" id="1640947">typ</span><span class="op" id="1640950">)</span>&nbsp;<span class="op" id="1640952">==</span>&nbsp;<span class="op" id="1640955">^</span><span class="builtintype" id="1640956">uintptr</span><span class="op" id="1640963">(</span><span class="num" id="1640964">0</span><span class="op" id="1640965">)</span>&nbsp;<span class="op" id="1640967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1640972">//&nbsp;First&nbsp;store&nbsp;in&nbsp;progress.&nbsp;Wait.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1641009">//&nbsp;Since&nbsp;we&nbsp;disable&nbsp;preemption&nbsp;around&nbsp;the&nbsp;first&nbsp;store,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1641067">//&nbsp;we&nbsp;can&nbsp;wait&nbsp;with&nbsp;active&nbsp;spinning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641107">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1641118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1641122">//&nbsp;First&nbsp;store&nbsp;completed.&nbsp;Check&nbsp;type&nbsp;and&nbsp;overwrite&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641181">if</span>&nbsp;<span class="ident" id="1641184">typ</span>&nbsp;<span class="op" id="1641188">!=</span>&nbsp;<span class="ident" id="1641191">xp</span><span class="op" id="1641193">.</span><span class="ident" id="1641194">typ</span>&nbsp;<span class="op" id="1641198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1641203">panic</span><span class="op" id="1641208">(</span><span class="string" id="1641209">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;inconsistently&nbsp;typed&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1641270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1641274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1641278">StorePointer</span><span class="op" id="1641290">(</span><span class="op" id="1641291">&amp;</span><span class="ident" id="1641292">vp</span><span class="op" id="1641294">.</span><span class="ident" id="1641295">data</span><span class="op" id="1641299">,</span>&nbsp;<span class="ident" id="1641301">xp</span><span class="op" id="1641303">.</span><span class="ident" id="1641304">data</span><span class="op" id="1641308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641312">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1641320">}</span><br>
<span class="lineno"></span><span class="op" id="1641322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1641325">//&nbsp;Disable/enable&nbsp;preemption,&nbsp;implemented&nbsp;in&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword" id="1641379">func</span>&nbsp;<span class="ident" id="1641384">runtime_procPin</span><span class="op" id="1641399">(</span><span class="op" id="1641400">)</span><br>
<span class="lineno">85</span><span class="keyword" id="1641402">func</span>&nbsp;<span class="ident" id="1641407">runtime_procUnpin</span><span class="op" id="1641424">(</span><span class="op" id="1641425">)</span>
</div>
</body>
</html>
