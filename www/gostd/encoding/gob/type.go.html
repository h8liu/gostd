<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3154138">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3154193">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3154247">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3154298">package</span>&nbsp;<span class="ident" id="3154306">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3154311">import</span>&nbsp;<span class="op" id="3154318">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3154321">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3154333">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3154343">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3154350">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3154356">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3154367">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3154375">&#34;sync/atomic&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3154390">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3154401">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3154416">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3154419">//&nbsp;userTypeInfo&nbsp;stores&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;a&nbsp;type&nbsp;the&nbsp;user&nbsp;has&nbsp;handed</span><br>
<span class="lineno">20</span><span class="comment" id="3154501">//&nbsp;to&nbsp;the&nbsp;package.&nbsp;&nbsp;It&#39;s&nbsp;computed&nbsp;once&nbsp;and&nbsp;stored&nbsp;in&nbsp;a&nbsp;map&nbsp;keyed&nbsp;by&nbsp;reflection</span><br>
<span class="lineno"></span><span class="comment" id="3154580">//&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="3154589">type</span>&nbsp;<span class="ident" id="3154594">userTypeInfo</span>&nbsp;<span class="keyword" id="3154607">struct</span>&nbsp;<span class="op" id="3154614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154617">user</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3154629">reflect</span><span class="op" id="3154636">.</span><span class="ident" id="3154637">Type</span>&nbsp;<span class="comment" id="3154642">//&nbsp;the&nbsp;type&nbsp;the&nbsp;user&nbsp;handed&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154674">base</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3154686">reflect</span><span class="op" id="3154693">.</span><span class="ident" id="3154694">Type</span>&nbsp;<span class="comment" id="3154699">//&nbsp;the&nbsp;base&nbsp;type&nbsp;after&nbsp;all&nbsp;indirections</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154740">indir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3154752">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3154765">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154815">externalEnc</span>&nbsp;<span class="builtintype" id="3154827">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3154840">//&nbsp;xGob,&nbsp;xBinary,&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154868">externalDec</span>&nbsp;<span class="builtintype" id="3154880">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3154893">//&nbsp;xGob,&nbsp;xBinary&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154920">encIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3154932">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3154945">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155016">decIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3155028">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3155041">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno">30</span><span class="op" id="3155111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3155114">//&nbsp;externalEncoding&nbsp;bits</span><br>
<span class="lineno"></span><span class="keyword" id="3155139">const</span>&nbsp;<span class="op" id="3155145">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155148">xGob</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3155156">=</span>&nbsp;<span class="num" id="3155158">1</span>&nbsp;<span class="op" id="3155160">+</span>&nbsp;<span class="ident" id="3155162">iota</span>&nbsp;<span class="comment" id="3155167">//&nbsp;GobEncoder&nbsp;or&nbsp;GobDecoder</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155196">xBinary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3155215">//&nbsp;encoding.BinaryMarshaler&nbsp;or&nbsp;encoding.BinaryUnmarshaler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155274">xText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3155293">//&nbsp;encoding.TextMarshaler&nbsp;or&nbsp;encoding.TextUnmarshaler</span><br>
<span class="lineno"></span><span class="op" id="3155347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3155350">var</span>&nbsp;<span class="op" id="3155354">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155357">//&nbsp;Protected&nbsp;by&nbsp;an&nbsp;RWMutex&nbsp;because&nbsp;we&nbsp;read&nbsp;it&nbsp;a&nbsp;lot&nbsp;and&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155420">//&nbsp;it&nbsp;only&nbsp;when&nbsp;we&nbsp;see&nbsp;a&nbsp;new&nbsp;type,&nbsp;typically&nbsp;when&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155482">userTypeLock</span>&nbsp;&nbsp;<span class="ident" id="3155496">sync</span><span class="op" id="3155500">.</span><span class="ident" id="3155501">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155510">userTypeCache</span>&nbsp;<span class="op" id="3155524">=</span>&nbsp;<span class="builtinfunc" id="3155526">make</span><span class="op" id="3155530">(</span><span class="keyword" id="3155531">map</span><span class="op" id="3155534">[</span><span class="ident" id="3155535">reflect</span><span class="op" id="3155542">.</span><span class="ident" id="3155543">Type</span><span class="op" id="3155547">]</span><span class="op" id="3155548">*</span><span class="ident" id="3155549">userTypeInfo</span><span class="op" id="3155561">)</span><br>
<span class="lineno"></span><span class="op" id="3155563">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3155566">//&nbsp;validType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="3155654">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;err&nbsp;will&nbsp;be&nbsp;non-nil.&nbsp;&nbsp;To&nbsp;be&nbsp;used&nbsp;when&nbsp;the&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="3155744">//&nbsp;is&nbsp;not&nbsp;set&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="3155762">func</span>&nbsp;<span class="ident" id="3155767">validUserType</span><span class="op" id="3155780">(</span><span class="ident" id="3155781">rt</span>&nbsp;<span class="ident" id="3155784">reflect</span><span class="op" id="3155791">.</span><span class="ident" id="3155792">Type</span><span class="op" id="3155796">)</span>&nbsp;<span class="op" id="3155798">(</span><span class="ident" id="3155799">ut</span>&nbsp;<span class="op" id="3155802">*</span><span class="ident" id="3155803">userTypeInfo</span><span class="op" id="3155815">,</span>&nbsp;<span class="ident" id="3155817">err</span>&nbsp;<span class="builtintype" id="3155821">error</span><span class="op" id="3155826">)</span>&nbsp;<span class="op" id="3155828">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155831">userTypeLock</span><span class="op" id="3155843">.</span><span class="ident" id="3155844">RLock</span><span class="op" id="3155849">(</span><span class="op" id="3155850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155853">ut</span>&nbsp;<span class="op" id="3155856">=</span>&nbsp;<span class="ident" id="3155858">userTypeCache</span><span class="op" id="3155871">[</span><span class="ident" id="3155872">rt</span><span class="op" id="3155874">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155877">userTypeLock</span><span class="op" id="3155889">.</span><span class="ident" id="3155890">RUnlock</span><span class="op" id="3155897">(</span><span class="op" id="3155898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155901">if</span>&nbsp;<span class="ident" id="3155904">ut</span>&nbsp;<span class="op" id="3155907">!=</span>&nbsp;<span class="ident" id="3155910">nil</span>&nbsp;<span class="op" id="3155914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155918">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155929">//&nbsp;Now&nbsp;set&nbsp;the&nbsp;value&nbsp;under&nbsp;the&nbsp;write&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155973">userTypeLock</span><span class="op" id="3155985">.</span><span class="ident" id="3155986">Lock</span><span class="op" id="3155990">(</span><span class="op" id="3155991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155994">defer</span>&nbsp;<span class="ident" id="3156000">userTypeLock</span><span class="op" id="3156012">.</span><span class="ident" id="3156013">Unlock</span><span class="op" id="3156019">(</span><span class="op" id="3156020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156023">if</span>&nbsp;<span class="ident" id="3156026">ut</span>&nbsp;<span class="op" id="3156029">=</span>&nbsp;<span class="ident" id="3156031">userTypeCache</span><span class="op" id="3156044">[</span><span class="ident" id="3156045">rt</span><span class="op" id="3156047">]</span><span class="op" id="3156048">;</span>&nbsp;<span class="ident" id="3156050">ut</span>&nbsp;<span class="op" id="3156053">!=</span>&nbsp;<span class="ident" id="3156056">nil</span>&nbsp;<span class="op" id="3156060">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156064">//&nbsp;Lost&nbsp;the&nbsp;race;&nbsp;not&nbsp;a&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156099">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156110">ut</span>&nbsp;<span class="op" id="3156113">=</span>&nbsp;<span class="builtinfunc" id="3156115">new</span><span class="op" id="3156118">(</span><span class="ident" id="3156119">userTypeInfo</span><span class="op" id="3156131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156134">ut</span><span class="op" id="3156136">.</span><span class="ident" id="3156137">base</span>&nbsp;<span class="op" id="3156142">=</span>&nbsp;<span class="ident" id="3156144">rt</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156148">ut</span><span class="op" id="3156150">.</span><span class="ident" id="3156151">user</span>&nbsp;<span class="op" id="3156156">=</span>&nbsp;<span class="ident" id="3156158">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156162">//&nbsp;A&nbsp;type&nbsp;that&nbsp;is&nbsp;just&nbsp;a&nbsp;cycle&nbsp;of&nbsp;pointers&nbsp;(such&nbsp;as&nbsp;type&nbsp;T&nbsp;*T)&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156233">//&nbsp;be&nbsp;represented&nbsp;in&nbsp;gobs,&nbsp;which&nbsp;need&nbsp;some&nbsp;concrete&nbsp;data.&nbsp;&nbsp;We&nbsp;use&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156302">//&nbsp;cycle&nbsp;detection&nbsp;algorithm&nbsp;from&nbsp;Knuth,&nbsp;Vol&nbsp;2,&nbsp;Section&nbsp;3.1,&nbsp;Ex&nbsp;6,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156370">//&nbsp;pp&nbsp;539-540.&nbsp;&nbsp;As&nbsp;we&nbsp;step&nbsp;through&nbsp;indirections,&nbsp;run&nbsp;another&nbsp;type&nbsp;at</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156440">//&nbsp;half&nbsp;speed.&nbsp;If&nbsp;they&nbsp;meet&nbsp;up,&nbsp;there&#39;s&nbsp;a&nbsp;cycle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156490">slowpoke</span>&nbsp;<span class="op" id="3156499">:=</span>&nbsp;<span class="ident" id="3156502">ut</span><span class="op" id="3156504">.</span><span class="ident" id="3156505">base</span>&nbsp;<span class="comment" id="3156510">//&nbsp;walks&nbsp;half&nbsp;as&nbsp;fast&nbsp;as&nbsp;ut.base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156544">for</span>&nbsp;<span class="op" id="3156548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156552">pt</span>&nbsp;<span class="op" id="3156555">:=</span>&nbsp;<span class="ident" id="3156558">ut</span><span class="op" id="3156560">.</span><span class="ident" id="3156561">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156568">if</span>&nbsp;<span class="ident" id="3156571">pt</span><span class="op" id="3156573">.</span><span class="ident" id="3156574">Kind</span><span class="op" id="3156578">(</span><span class="op" id="3156579">)</span>&nbsp;<span class="op" id="3156581">!=</span>&nbsp;<span class="ident" id="3156584">reflect</span><span class="op" id="3156591">.</span><span class="ident" id="3156592">Ptr</span>&nbsp;<span class="op" id="3156596">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156601">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156613">ut</span><span class="op" id="3156615">.</span><span class="ident" id="3156616">base</span>&nbsp;<span class="op" id="3156621">=</span>&nbsp;<span class="ident" id="3156623">pt</span><span class="op" id="3156625">.</span><span class="ident" id="3156626">Elem</span><span class="op" id="3156630">(</span><span class="op" id="3156631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156635">if</span>&nbsp;<span class="ident" id="3156638">ut</span><span class="op" id="3156640">.</span><span class="ident" id="3156641">base</span>&nbsp;<span class="op" id="3156646">==</span>&nbsp;<span class="ident" id="3156649">slowpoke</span>&nbsp;<span class="op" id="3156658">{</span>&nbsp;<span class="comment" id="3156660">//&nbsp;ut.base&nbsp;lapped&nbsp;slowpoke</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156690">//&nbsp;recursive&nbsp;pointer&nbsp;type.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156720">return</span>&nbsp;<span class="ident" id="3156727">nil</span><span class="op" id="3156730">,</span>&nbsp;<span class="ident" id="3156732">errors</span><span class="op" id="3156738">.</span><span class="ident" id="3156739">New</span><span class="op" id="3156742">(</span><span class="string" id="3156743">&#34;can&#39;t&nbsp;represent&nbsp;recursive&nbsp;pointer&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3156785">+</span>&nbsp;<span class="ident" id="3156787">ut</span><span class="op" id="3156789">.</span><span class="ident" id="3156790">base</span><span class="op" id="3156794">.</span><span class="ident" id="3156795">String</span><span class="op" id="3156801">(</span><span class="op" id="3156802">)</span><span class="op" id="3156803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156811">if</span>&nbsp;<span class="ident" id="3156814">ut</span><span class="op" id="3156816">.</span><span class="ident" id="3156817">indir</span><span class="op" id="3156822">%</span><span class="num" id="3156823">2</span>&nbsp;<span class="op" id="3156825">==</span>&nbsp;<span class="num" id="3156828">0</span>&nbsp;<span class="op" id="3156830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156835">slowpoke</span>&nbsp;<span class="op" id="3156844">=</span>&nbsp;<span class="ident" id="3156846">slowpoke</span><span class="op" id="3156854">.</span><span class="ident" id="3156855">Elem</span><span class="op" id="3156859">(</span><span class="op" id="3156860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156864">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156868">ut</span><span class="op" id="3156870">.</span><span class="ident" id="3156871">indir</span><span class="op" id="3156876">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156884">if</span>&nbsp;<span class="ident" id="3156887">ok</span><span class="op" id="3156889">,</span>&nbsp;<span class="ident" id="3156891">indir</span>&nbsp;<span class="op" id="3156897">:=</span>&nbsp;<span class="ident" id="3156900">implementsInterface</span><span class="op" id="3156919">(</span><span class="ident" id="3156920">ut</span><span class="op" id="3156922">.</span><span class="ident" id="3156923">user</span><span class="op" id="3156927">,</span>&nbsp;<span class="ident" id="3156929">gobEncoderInterfaceType</span><span class="op" id="3156952">)</span><span class="op" id="3156953">;</span>&nbsp;<span class="ident" id="3156955">ok</span>&nbsp;<span class="op" id="3156958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156962">ut</span><span class="op" id="3156964">.</span><span class="ident" id="3156965">externalEnc</span><span class="op" id="3156976">,</span>&nbsp;<span class="ident" id="3156978">ut</span><span class="op" id="3156980">.</span><span class="ident" id="3156981">encIndir</span>&nbsp;<span class="op" id="3156990">=</span>&nbsp;<span class="ident" id="3156992">xGob</span><span class="op" id="3156996">,</span>&nbsp;<span class="ident" id="3156998">indir</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157005">}</span>&nbsp;<span class="keyword" id="3157007">else</span>&nbsp;<span class="keyword" id="3157012">if</span>&nbsp;<span class="ident" id="3157015">ok</span><span class="op" id="3157017">,</span>&nbsp;<span class="ident" id="3157019">indir</span>&nbsp;<span class="op" id="3157025">:=</span>&nbsp;<span class="ident" id="3157028">implementsInterface</span><span class="op" id="3157047">(</span><span class="ident" id="3157048">ut</span><span class="op" id="3157050">.</span><span class="ident" id="3157051">user</span><span class="op" id="3157055">,</span>&nbsp;<span class="ident" id="3157057">binaryMarshalerInterfaceType</span><span class="op" id="3157085">)</span><span class="op" id="3157086">;</span>&nbsp;<span class="ident" id="3157088">ok</span>&nbsp;<span class="op" id="3157091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157095">ut</span><span class="op" id="3157097">.</span><span class="ident" id="3157098">externalEnc</span><span class="op" id="3157109">,</span>&nbsp;<span class="ident" id="3157111">ut</span><span class="op" id="3157113">.</span><span class="ident" id="3157114">encIndir</span>&nbsp;<span class="op" id="3157123">=</span>&nbsp;<span class="ident" id="3157125">xBinary</span><span class="op" id="3157132">,</span>&nbsp;<span class="ident" id="3157134">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157145">//&nbsp;NOTE(rsc):&nbsp;Would&nbsp;like&nbsp;to&nbsp;allow&nbsp;MarshalText&nbsp;here,&nbsp;but&nbsp;results&nbsp;in&nbsp;incompatibility</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157229">//&nbsp;with&nbsp;older&nbsp;encodings&nbsp;for&nbsp;net.IP.&nbsp;See&nbsp;golang.org/issue/6760.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157293">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textMarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157383">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalEnc,&nbsp;ut.encIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157431">//&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157438">if</span>&nbsp;<span class="ident" id="3157441">ok</span><span class="op" id="3157443">,</span>&nbsp;<span class="ident" id="3157445">indir</span>&nbsp;<span class="op" id="3157451">:=</span>&nbsp;<span class="ident" id="3157454">implementsInterface</span><span class="op" id="3157473">(</span><span class="ident" id="3157474">ut</span><span class="op" id="3157476">.</span><span class="ident" id="3157477">user</span><span class="op" id="3157481">,</span>&nbsp;<span class="ident" id="3157483">gobDecoderInterfaceType</span><span class="op" id="3157506">)</span><span class="op" id="3157507">;</span>&nbsp;<span class="ident" id="3157509">ok</span>&nbsp;<span class="op" id="3157512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157516">ut</span><span class="op" id="3157518">.</span><span class="ident" id="3157519">externalDec</span><span class="op" id="3157530">,</span>&nbsp;<span class="ident" id="3157532">ut</span><span class="op" id="3157534">.</span><span class="ident" id="3157535">decIndir</span>&nbsp;<span class="op" id="3157544">=</span>&nbsp;<span class="ident" id="3157546">xGob</span><span class="op" id="3157550">,</span>&nbsp;<span class="ident" id="3157552">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157559">}</span>&nbsp;<span class="keyword" id="3157561">else</span>&nbsp;<span class="keyword" id="3157566">if</span>&nbsp;<span class="ident" id="3157569">ok</span><span class="op" id="3157571">,</span>&nbsp;<span class="ident" id="3157573">indir</span>&nbsp;<span class="op" id="3157579">:=</span>&nbsp;<span class="ident" id="3157582">implementsInterface</span><span class="op" id="3157601">(</span><span class="ident" id="3157602">ut</span><span class="op" id="3157604">.</span><span class="ident" id="3157605">user</span><span class="op" id="3157609">,</span>&nbsp;<span class="ident" id="3157611">binaryUnmarshalerInterfaceType</span><span class="op" id="3157641">)</span><span class="op" id="3157642">;</span>&nbsp;<span class="ident" id="3157644">ok</span>&nbsp;<span class="op" id="3157647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157651">ut</span><span class="op" id="3157653">.</span><span class="ident" id="3157654">externalDec</span><span class="op" id="3157665">,</span>&nbsp;<span class="ident" id="3157667">ut</span><span class="op" id="3157669">.</span><span class="ident" id="3157670">decIndir</span>&nbsp;<span class="op" id="3157679">=</span>&nbsp;<span class="ident" id="3157681">xBinary</span><span class="op" id="3157688">,</span>&nbsp;<span class="ident" id="3157690">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157697">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157701">//&nbsp;See&nbsp;note&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157721">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textUnmarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157813">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalDec,&nbsp;ut.decIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157861">//&nbsp;}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157868">userTypeCache</span><span class="op" id="3157881">[</span><span class="ident" id="3157882">rt</span><span class="op" id="3157884">]</span>&nbsp;<span class="op" id="3157886">=</span>&nbsp;<span class="ident" id="3157888">ut</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157892">return</span><br>
<span class="lineno"></span><span class="op" id="3157899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3157902">var</span>&nbsp;<span class="op" id="3157906">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157909">gobEncoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3157940">=</span>&nbsp;<span class="ident" id="3157942">reflect</span><span class="op" id="3157949">.</span><span class="ident" id="3157950">TypeOf</span><span class="op" id="3157956">(</span><span class="op" id="3157957">(</span><span class="op" id="3157958">*</span><span class="ident" id="3157959">GobEncoder</span><span class="op" id="3157969">)</span><span class="op" id="3157970">(</span><span class="ident" id="3157971">nil</span><span class="op" id="3157974">)</span><span class="op" id="3157975">)</span><span class="op" id="3157976">.</span><span class="ident" id="3157977">Elem</span><span class="op" id="3157981">(</span><span class="op" id="3157982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157985">gobDecoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3158016">=</span>&nbsp;<span class="ident" id="3158018">reflect</span><span class="op" id="3158025">.</span><span class="ident" id="3158026">TypeOf</span><span class="op" id="3158032">(</span><span class="op" id="3158033">(</span><span class="op" id="3158034">*</span><span class="ident" id="3158035">GobDecoder</span><span class="op" id="3158045">)</span><span class="op" id="3158046">(</span><span class="ident" id="3158047">nil</span><span class="op" id="3158050">)</span><span class="op" id="3158051">)</span><span class="op" id="3158052">.</span><span class="ident" id="3158053">Elem</span><span class="op" id="3158057">(</span><span class="op" id="3158058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158061">binaryMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3158092">=</span>&nbsp;<span class="ident" id="3158094">reflect</span><span class="op" id="3158101">.</span><span class="ident" id="3158102">TypeOf</span><span class="op" id="3158108">(</span><span class="op" id="3158109">(</span><span class="op" id="3158110">*</span><span class="ident" id="3158111">encoding</span><span class="op" id="3158119">.</span><span class="ident" id="3158120">BinaryMarshaler</span><span class="op" id="3158135">)</span><span class="op" id="3158136">(</span><span class="ident" id="3158137">nil</span><span class="op" id="3158140">)</span><span class="op" id="3158141">)</span><span class="op" id="3158142">.</span><span class="ident" id="3158143">Elem</span><span class="op" id="3158147">(</span><span class="op" id="3158148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158151">binaryUnmarshalerInterfaceType</span>&nbsp;<span class="op" id="3158182">=</span>&nbsp;<span class="ident" id="3158184">reflect</span><span class="op" id="3158191">.</span><span class="ident" id="3158192">TypeOf</span><span class="op" id="3158198">(</span><span class="op" id="3158199">(</span><span class="op" id="3158200">*</span><span class="ident" id="3158201">encoding</span><span class="op" id="3158209">.</span><span class="ident" id="3158210">BinaryUnmarshaler</span><span class="op" id="3158227">)</span><span class="op" id="3158228">(</span><span class="ident" id="3158229">nil</span><span class="op" id="3158232">)</span><span class="op" id="3158233">)</span><span class="op" id="3158234">.</span><span class="ident" id="3158235">Elem</span><span class="op" id="3158239">(</span><span class="op" id="3158240">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158243">textMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3158274">=</span>&nbsp;<span class="ident" id="3158276">reflect</span><span class="op" id="3158283">.</span><span class="ident" id="3158284">TypeOf</span><span class="op" id="3158290">(</span><span class="op" id="3158291">(</span><span class="op" id="3158292">*</span><span class="ident" id="3158293">encoding</span><span class="op" id="3158301">.</span><span class="ident" id="3158302">TextMarshaler</span><span class="op" id="3158315">)</span><span class="op" id="3158316">(</span><span class="ident" id="3158317">nil</span><span class="op" id="3158320">)</span><span class="op" id="3158321">)</span><span class="op" id="3158322">.</span><span class="ident" id="3158323">Elem</span><span class="op" id="3158327">(</span><span class="op" id="3158328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158331">textUnmarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3158362">=</span>&nbsp;<span class="ident" id="3158364">reflect</span><span class="op" id="3158371">.</span><span class="ident" id="3158372">TypeOf</span><span class="op" id="3158378">(</span><span class="op" id="3158379">(</span><span class="op" id="3158380">*</span><span class="ident" id="3158381">encoding</span><span class="op" id="3158389">.</span><span class="ident" id="3158390">TextUnmarshaler</span><span class="op" id="3158405">)</span><span class="op" id="3158406">(</span><span class="ident" id="3158407">nil</span><span class="op" id="3158410">)</span><span class="op" id="3158411">)</span><span class="op" id="3158412">.</span><span class="ident" id="3158413">Elem</span><span class="op" id="3158417">(</span><span class="op" id="3158418">)</span><br>
<span class="lineno"></span><span class="op" id="3158420">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3158423">//&nbsp;implementsInterface&nbsp;reports&nbsp;whether&nbsp;the&nbsp;type&nbsp;implements&nbsp;the</span><br>
<span class="lineno">125</span><span class="comment" id="3158486">//&nbsp;gobEncoder/gobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="3158522">//&nbsp;It&nbsp;also&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;indirections&nbsp;required&nbsp;to&nbsp;get&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3158591">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="3158610">func</span>&nbsp;<span class="ident" id="3158615">implementsInterface</span><span class="op" id="3158634">(</span><span class="ident" id="3158635">typ</span><span class="op" id="3158638">,</span>&nbsp;<span class="ident" id="3158640">gobEncDecType</span>&nbsp;<span class="ident" id="3158654">reflect</span><span class="op" id="3158661">.</span><span class="ident" id="3158662">Type</span><span class="op" id="3158666">)</span>&nbsp;<span class="op" id="3158668">(</span><span class="ident" id="3158669">success</span>&nbsp;<span class="builtintype" id="3158677">bool</span><span class="op" id="3158681">,</span>&nbsp;<span class="ident" id="3158683">indir</span>&nbsp;<span class="builtintype" id="3158689">int8</span><span class="op" id="3158693">)</span>&nbsp;<span class="op" id="3158695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158698">if</span>&nbsp;<span class="ident" id="3158701">typ</span>&nbsp;<span class="op" id="3158705">==</span>&nbsp;<span class="ident" id="3158708">nil</span>&nbsp;<span class="op" id="3158712">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158716">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158727">rt</span>&nbsp;<span class="op" id="3158730">:=</span>&nbsp;<span class="ident" id="3158733">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3158738">//&nbsp;The&nbsp;type&nbsp;might&nbsp;be&nbsp;a&nbsp;pointer&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;keep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3158790">//&nbsp;dereferencing&nbsp;to&nbsp;the&nbsp;base&nbsp;type&nbsp;until&nbsp;we&nbsp;find&nbsp;an&nbsp;implementation.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158858">for</span>&nbsp;<span class="op" id="3158862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158866">if</span>&nbsp;<span class="ident" id="3158869">rt</span><span class="op" id="3158871">.</span><span class="ident" id="3158872">Implements</span><span class="op" id="3158882">(</span><span class="ident" id="3158883">gobEncDecType</span><span class="op" id="3158896">)</span>&nbsp;<span class="op" id="3158898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158903">return</span>&nbsp;<span class="builtintype" id="3158910">true</span><span class="op" id="3158914">,</span>&nbsp;<span class="ident" id="3158916">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158928">if</span>&nbsp;<span class="ident" id="3158931">p</span>&nbsp;<span class="op" id="3158933">:=</span>&nbsp;<span class="ident" id="3158936">rt</span><span class="op" id="3158938">;</span>&nbsp;<span class="ident" id="3158940">p</span><span class="op" id="3158941">.</span><span class="ident" id="3158942">Kind</span><span class="op" id="3158946">(</span><span class="op" id="3158947">)</span>&nbsp;<span class="op" id="3158949">==</span>&nbsp;<span class="ident" id="3158952">reflect</span><span class="op" id="3158959">.</span><span class="ident" id="3158960">Ptr</span>&nbsp;<span class="op" id="3158964">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158969">indir</span><span class="op" id="3158974">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158980">if</span>&nbsp;<span class="ident" id="3158983">indir</span>&nbsp;<span class="op" id="3158989">&gt;</span>&nbsp;<span class="num" id="3158991">100</span>&nbsp;<span class="op" id="3158995">{</span>&nbsp;<span class="comment" id="3158997">//&nbsp;insane&nbsp;number&nbsp;of&nbsp;indirections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159034">return</span>&nbsp;<span class="builtintype" id="3159041">false</span><span class="op" id="3159046">,</span>&nbsp;<span class="num" id="3159048">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159058">rt</span>&nbsp;<span class="op" id="3159061">=</span>&nbsp;<span class="ident" id="3159063">p</span><span class="op" id="3159064">.</span><span class="ident" id="3159065">Elem</span><span class="op" id="3159069">(</span><span class="op" id="3159070">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159075">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159090">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159100">//&nbsp;No&nbsp;luck&nbsp;yet,&nbsp;but&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;base&nbsp;type&nbsp;(non-pointer),&nbsp;the&nbsp;pointer&nbsp;might&nbsp;satisfy.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159186">if</span>&nbsp;<span class="ident" id="3159189">typ</span><span class="op" id="3159192">.</span><span class="ident" id="3159193">Kind</span><span class="op" id="3159197">(</span><span class="op" id="3159198">)</span>&nbsp;<span class="op" id="3159200">!=</span>&nbsp;<span class="ident" id="3159203">reflect</span><span class="op" id="3159210">.</span><span class="ident" id="3159211">Ptr</span>&nbsp;<span class="op" id="3159215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159219">//&nbsp;Not&nbsp;a&nbsp;pointer,&nbsp;but&nbsp;does&nbsp;the&nbsp;pointer&nbsp;work?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159266">if</span>&nbsp;<span class="ident" id="3159269">reflect</span><span class="op" id="3159276">.</span><span class="ident" id="3159277">PtrTo</span><span class="op" id="3159282">(</span><span class="ident" id="3159283">typ</span><span class="op" id="3159286">)</span><span class="op" id="3159287">.</span><span class="ident" id="3159288">Implements</span><span class="op" id="3159298">(</span><span class="ident" id="3159299">gobEncDecType</span><span class="op" id="3159312">)</span>&nbsp;<span class="op" id="3159314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159319">return</span>&nbsp;<span class="builtintype" id="3159326">true</span><span class="op" id="3159330">,</span>&nbsp;<span class="op" id="3159332">-</span><span class="num" id="3159333">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159337">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159343">return</span>&nbsp;<span class="builtintype" id="3159350">false</span><span class="op" id="3159355">,</span>&nbsp;<span class="num" id="3159357">0</span><br>
<span class="lineno"></span><span class="op" id="3159359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3159362">//&nbsp;userType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno">160</span><span class="comment" id="3159449">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;it&nbsp;calls&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="3159499">func</span>&nbsp;<span class="ident" id="3159504">userType</span><span class="op" id="3159512">(</span><span class="ident" id="3159513">rt</span>&nbsp;<span class="ident" id="3159516">reflect</span><span class="op" id="3159523">.</span><span class="ident" id="3159524">Type</span><span class="op" id="3159528">)</span>&nbsp;<span class="op" id="3159530">*</span><span class="ident" id="3159531">userTypeInfo</span>&nbsp;<span class="op" id="3159544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159547">ut</span><span class="op" id="3159549">,</span>&nbsp;<span class="ident" id="3159551">err</span>&nbsp;<span class="op" id="3159555">:=</span>&nbsp;<span class="ident" id="3159558">validUserType</span><span class="op" id="3159571">(</span><span class="ident" id="3159572">rt</span><span class="op" id="3159574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159577">if</span>&nbsp;<span class="ident" id="3159580">err</span>&nbsp;<span class="op" id="3159584">!=</span>&nbsp;<span class="ident" id="3159587">nil</span>&nbsp;<span class="op" id="3159591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159595">error_</span><span class="op" id="3159601">(</span><span class="ident" id="3159602">err</span><span class="op" id="3159605">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159611">return</span>&nbsp;<span class="ident" id="3159618">ut</span><br>
<span class="lineno"></span><span class="op" id="3159621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3159624">//&nbsp;A&nbsp;typeId&nbsp;represents&nbsp;a&nbsp;gob&nbsp;Type&nbsp;as&nbsp;an&nbsp;integer&nbsp;that&nbsp;can&nbsp;be&nbsp;passed&nbsp;on&nbsp;the&nbsp;wire.</span><br>
<span class="lineno">170</span><span class="comment" id="3159704">//&nbsp;Internally,&nbsp;typeIds&nbsp;are&nbsp;used&nbsp;as&nbsp;keys&nbsp;to&nbsp;a&nbsp;map&nbsp;to&nbsp;recover&nbsp;the&nbsp;underlying&nbsp;type&nbsp;info.</span><br>
<span class="lineno"></span><span class="keyword" id="3159790">type</span>&nbsp;<span class="ident" id="3159795">typeId</span>&nbsp;<span class="builtintype" id="3159802">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3159809">var</span>&nbsp;<span class="ident" id="3159813">nextId</span>&nbsp;<span class="ident" id="3159820">typeId</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3159833">//&nbsp;incremented&nbsp;for&nbsp;each&nbsp;new&nbsp;type&nbsp;we&nbsp;build</span><br>
<span class="lineno"></span><span class="keyword" id="3159875">var</span>&nbsp;<span class="ident" id="3159879">typeLock</span>&nbsp;<span class="ident" id="3159888">sync</span><span class="op" id="3159892">.</span><span class="ident" id="3159893">Mutex</span>&nbsp;<span class="comment" id="3159899">//&nbsp;set&nbsp;while&nbsp;building&nbsp;a&nbsp;type</span><br>
<span class="lineno">175</span><span class="keyword" id="3159928">const</span>&nbsp;<span class="ident" id="3159934">firstUserId</span>&nbsp;<span class="op" id="3159946">=</span>&nbsp;<span class="num" id="3159948">64</span>&nbsp;&nbsp;<span class="comment" id="3159952">//&nbsp;lowest&nbsp;id&nbsp;number&nbsp;granted&nbsp;to&nbsp;user</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3159989">type</span>&nbsp;<span class="ident" id="3159994">gobType</span>&nbsp;<span class="keyword" id="3160002">interface</span>&nbsp;<span class="op" id="3160012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160015">id</span><span class="op" id="3160017">(</span><span class="op" id="3160018">)</span>&nbsp;<span class="ident" id="3160020">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160028">setId</span><span class="op" id="3160033">(</span><span class="ident" id="3160034">id</span>&nbsp;<span class="ident" id="3160037">typeId</span><span class="op" id="3160043">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160046">name</span><span class="op" id="3160050">(</span><span class="op" id="3160051">)</span>&nbsp;<span class="builtintype" id="3160053">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3160061">string</span><span class="op" id="3160067">(</span><span class="op" id="3160068">)</span>&nbsp;<span class="builtintype" id="3160070">string</span>&nbsp;<span class="comment" id="3160077">//&nbsp;not&nbsp;public;&nbsp;only&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160112">safeString</span><span class="op" id="3160122">(</span><span class="ident" id="3160123">seen</span>&nbsp;<span class="keyword" id="3160128">map</span><span class="op" id="3160131">[</span><span class="ident" id="3160132">typeId</span><span class="op" id="3160138">]</span><span class="builtintype" id="3160139">bool</span><span class="op" id="3160143">)</span>&nbsp;<span class="builtintype" id="3160145">string</span><br>
<span class="lineno"></span><span class="op" id="3160152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="3160155">var</span>&nbsp;<span class="ident" id="3160159">types</span>&nbsp;<span class="op" id="3160165">=</span>&nbsp;<span class="builtinfunc" id="3160167">make</span><span class="op" id="3160171">(</span><span class="keyword" id="3160172">map</span><span class="op" id="3160175">[</span><span class="ident" id="3160176">reflect</span><span class="op" id="3160183">.</span><span class="ident" id="3160184">Type</span><span class="op" id="3160188">]</span><span class="ident" id="3160189">gobType</span><span class="op" id="3160196">)</span><br>
<span class="lineno"></span><span class="keyword" id="3160198">var</span>&nbsp;<span class="ident" id="3160202">idToType</span>&nbsp;<span class="op" id="3160211">=</span>&nbsp;<span class="builtinfunc" id="3160213">make</span><span class="op" id="3160217">(</span><span class="keyword" id="3160218">map</span><span class="op" id="3160221">[</span><span class="ident" id="3160222">typeId</span><span class="op" id="3160228">]</span><span class="ident" id="3160229">gobType</span><span class="op" id="3160236">)</span><br>
<span class="lineno"></span><span class="keyword" id="3160238">var</span>&nbsp;<span class="ident" id="3160242">builtinIdToType</span>&nbsp;<span class="keyword" id="3160258">map</span><span class="op" id="3160261">[</span><span class="ident" id="3160262">typeId</span><span class="op" id="3160268">]</span><span class="ident" id="3160269">gobType</span>&nbsp;<span class="comment" id="3160277">//&nbsp;set&nbsp;in&nbsp;init()&nbsp;after&nbsp;builtins&nbsp;are&nbsp;established</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3160326">func</span>&nbsp;<span class="ident" id="3160331">setTypeId</span><span class="op" id="3160340">(</span><span class="ident" id="3160341">typ</span>&nbsp;<span class="ident" id="3160345">gobType</span><span class="op" id="3160352">)</span>&nbsp;<span class="op" id="3160354">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3160357">//&nbsp;When&nbsp;building&nbsp;recursive&nbsp;types,&nbsp;someone&nbsp;may&nbsp;get&nbsp;there&nbsp;before&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160425">if</span>&nbsp;<span class="ident" id="3160428">typ</span><span class="op" id="3160431">.</span><span class="ident" id="3160432">id</span><span class="op" id="3160434">(</span><span class="op" id="3160435">)</span>&nbsp;<span class="op" id="3160437">!=</span>&nbsp;<span class="num" id="3160440">0</span>&nbsp;<span class="op" id="3160442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160446">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160457">nextId</span><span class="op" id="3160463">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160467">typ</span><span class="op" id="3160470">.</span><span class="ident" id="3160471">setId</span><span class="op" id="3160476">(</span><span class="ident" id="3160477">nextId</span><span class="op" id="3160483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160486">idToType</span><span class="op" id="3160494">[</span><span class="ident" id="3160495">nextId</span><span class="op" id="3160501">]</span>&nbsp;<span class="op" id="3160503">=</span>&nbsp;<span class="ident" id="3160505">typ</span><br>
<span class="lineno"></span><span class="op" id="3160509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3160512">func</span>&nbsp;<span class="op" id="3160517">(</span><span class="ident" id="3160518">t</span>&nbsp;<span class="ident" id="3160520">typeId</span><span class="op" id="3160526">)</span>&nbsp;<span class="ident" id="3160528">gobType</span><span class="op" id="3160535">(</span><span class="op" id="3160536">)</span>&nbsp;<span class="ident" id="3160538">gobType</span>&nbsp;<span class="op" id="3160546">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160549">if</span>&nbsp;<span class="ident" id="3160552">t</span>&nbsp;<span class="op" id="3160554">==</span>&nbsp;<span class="num" id="3160557">0</span>&nbsp;<span class="op" id="3160559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160563">return</span>&nbsp;<span class="ident" id="3160570">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160578">return</span>&nbsp;<span class="ident" id="3160585">idToType</span><span class="op" id="3160593">[</span><span class="ident" id="3160594">t</span><span class="op" id="3160595">]</span><br>
<span class="lineno"></span><span class="op" id="3160597">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="3160600">//&nbsp;string&nbsp;returns&nbsp;the&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno"></span><span class="keyword" id="3160684">func</span>&nbsp;<span class="op" id="3160689">(</span><span class="ident" id="3160690">t</span>&nbsp;<span class="ident" id="3160692">typeId</span><span class="op" id="3160698">)</span>&nbsp;<span class="builtintype" id="3160700">string</span><span class="op" id="3160706">(</span><span class="op" id="3160707">)</span>&nbsp;<span class="builtintype" id="3160709">string</span>&nbsp;<span class="op" id="3160716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160719">if</span>&nbsp;<span class="ident" id="3160722">t</span><span class="op" id="3160723">.</span><span class="ident" id="3160724">gobType</span><span class="op" id="3160731">(</span><span class="op" id="3160732">)</span>&nbsp;<span class="op" id="3160734">==</span>&nbsp;<span class="ident" id="3160737">nil</span>&nbsp;<span class="op" id="3160741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160745">return</span>&nbsp;<span class="string" id="3160752">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160764">return</span>&nbsp;<span class="ident" id="3160771">t</span><span class="op" id="3160772">.</span><span class="ident" id="3160773">gobType</span><span class="op" id="3160780">(</span><span class="op" id="3160781">)</span><span class="op" id="3160782">.</span><span class="builtintype" id="3160783">string</span><span class="op" id="3160789">(</span><span class="op" id="3160790">)</span><br>
<span class="lineno"></span><span class="op" id="3160792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3160795">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno">215</span><span class="keyword" id="3160860">func</span>&nbsp;<span class="op" id="3160865">(</span><span class="ident" id="3160866">t</span>&nbsp;<span class="ident" id="3160868">typeId</span><span class="op" id="3160874">)</span>&nbsp;<span class="ident" id="3160876">name</span><span class="op" id="3160880">(</span><span class="op" id="3160881">)</span>&nbsp;<span class="builtintype" id="3160883">string</span>&nbsp;<span class="op" id="3160890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160893">if</span>&nbsp;<span class="ident" id="3160896">t</span><span class="op" id="3160897">.</span><span class="ident" id="3160898">gobType</span><span class="op" id="3160905">(</span><span class="op" id="3160906">)</span>&nbsp;<span class="op" id="3160908">==</span>&nbsp;<span class="ident" id="3160911">nil</span>&nbsp;<span class="op" id="3160915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160919">return</span>&nbsp;<span class="string" id="3160926">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160938">return</span>&nbsp;<span class="ident" id="3160945">t</span><span class="op" id="3160946">.</span><span class="ident" id="3160947">gobType</span><span class="op" id="3160954">(</span><span class="op" id="3160955">)</span><span class="op" id="3160956">.</span><span class="ident" id="3160957">name</span><span class="op" id="3160961">(</span><span class="op" id="3160962">)</span><br>
<span class="lineno">220</span><span class="op" id="3160964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3160967">//&nbsp;CommonType&nbsp;holds&nbsp;elements&nbsp;of&nbsp;all&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="3161010">//&nbsp;It&nbsp;is&nbsp;a&nbsp;historical&nbsp;artifact,&nbsp;kept&nbsp;for&nbsp;binary&nbsp;compatibility&nbsp;and&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="3161085">//&nbsp;only&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;the&nbsp;package&#39;s&nbsp;encoding&nbsp;of&nbsp;type&nbsp;descriptors.&nbsp;It&nbsp;is</span><br>
<span class="lineno">225</span><span class="comment" id="3161162">//&nbsp;not&nbsp;intended&nbsp;for&nbsp;direct&nbsp;use&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="3161205">type</span>&nbsp;<span class="ident" id="3161210">CommonType</span>&nbsp;<span class="keyword" id="3161221">struct</span>&nbsp;<span class="op" id="3161228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161231">Name</span>&nbsp;<span class="builtintype" id="3161236">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161244">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3161249">typeId</span><br>
<span class="lineno"></span><span class="op" id="3161256">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="3161259">func</span>&nbsp;<span class="op" id="3161264">(</span><span class="ident" id="3161265">t</span>&nbsp;<span class="op" id="3161267">*</span><span class="ident" id="3161268">CommonType</span><span class="op" id="3161278">)</span>&nbsp;<span class="ident" id="3161280">id</span><span class="op" id="3161282">(</span><span class="op" id="3161283">)</span>&nbsp;<span class="ident" id="3161285">typeId</span>&nbsp;<span class="op" id="3161292">{</span>&nbsp;<span class="keyword" id="3161294">return</span>&nbsp;<span class="ident" id="3161301">t</span><span class="op" id="3161302">.</span><span class="ident" id="3161303">Id</span>&nbsp;<span class="op" id="3161306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3161309">func</span>&nbsp;<span class="op" id="3161314">(</span><span class="ident" id="3161315">t</span>&nbsp;<span class="op" id="3161317">*</span><span class="ident" id="3161318">CommonType</span><span class="op" id="3161328">)</span>&nbsp;<span class="ident" id="3161330">setId</span><span class="op" id="3161335">(</span><span class="ident" id="3161336">id</span>&nbsp;<span class="ident" id="3161339">typeId</span><span class="op" id="3161345">)</span>&nbsp;<span class="op" id="3161347">{</span>&nbsp;<span class="ident" id="3161349">t</span><span class="op" id="3161350">.</span><span class="ident" id="3161351">Id</span>&nbsp;<span class="op" id="3161354">=</span>&nbsp;<span class="ident" id="3161356">id</span>&nbsp;<span class="op" id="3161359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="3161362">func</span>&nbsp;<span class="op" id="3161367">(</span><span class="ident" id="3161368">t</span>&nbsp;<span class="op" id="3161370">*</span><span class="ident" id="3161371">CommonType</span><span class="op" id="3161381">)</span>&nbsp;<span class="builtintype" id="3161383">string</span><span class="op" id="3161389">(</span><span class="op" id="3161390">)</span>&nbsp;<span class="builtintype" id="3161392">string</span>&nbsp;<span class="op" id="3161399">{</span>&nbsp;<span class="keyword" id="3161401">return</span>&nbsp;<span class="ident" id="3161408">t</span><span class="op" id="3161409">.</span><span class="ident" id="3161410">Name</span>&nbsp;<span class="op" id="3161415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3161418">func</span>&nbsp;<span class="op" id="3161423">(</span><span class="ident" id="3161424">t</span>&nbsp;<span class="op" id="3161426">*</span><span class="ident" id="3161427">CommonType</span><span class="op" id="3161437">)</span>&nbsp;<span class="ident" id="3161439">safeString</span><span class="op" id="3161449">(</span><span class="ident" id="3161450">seen</span>&nbsp;<span class="keyword" id="3161455">map</span><span class="op" id="3161458">[</span><span class="ident" id="3161459">typeId</span><span class="op" id="3161465">]</span><span class="builtintype" id="3161466">bool</span><span class="op" id="3161470">)</span>&nbsp;<span class="builtintype" id="3161472">string</span>&nbsp;<span class="op" id="3161479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161482">return</span>&nbsp;<span class="ident" id="3161489">t</span><span class="op" id="3161490">.</span><span class="ident" id="3161491">Name</span><br>
<span class="lineno"></span><span class="op" id="3161496">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="3161499">func</span>&nbsp;<span class="op" id="3161504">(</span><span class="ident" id="3161505">t</span>&nbsp;<span class="op" id="3161507">*</span><span class="ident" id="3161508">CommonType</span><span class="op" id="3161518">)</span>&nbsp;<span class="ident" id="3161520">name</span><span class="op" id="3161524">(</span><span class="op" id="3161525">)</span>&nbsp;<span class="builtintype" id="3161527">string</span>&nbsp;<span class="op" id="3161534">{</span>&nbsp;<span class="keyword" id="3161536">return</span>&nbsp;<span class="ident" id="3161543">t</span><span class="op" id="3161544">.</span><span class="ident" id="3161545">Name</span>&nbsp;<span class="op" id="3161550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3161553">//&nbsp;Create&nbsp;and&nbsp;check&nbsp;predefined&nbsp;types</span><br>
<span class="lineno"></span><span class="comment" id="3161590">//&nbsp;The&nbsp;string&nbsp;for&nbsp;tBytes&nbsp;is&nbsp;&#34;bytes&#34;&nbsp;not&nbsp;&#34;[]byte&#34;&nbsp;to&nbsp;signify&nbsp;its&nbsp;specialness.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="3161668">var</span>&nbsp;<span class="op" id="3161672">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3161675">//&nbsp;Primordial&nbsp;types,&nbsp;needed&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3161727">//&nbsp;Always&nbsp;passed&nbsp;as&nbsp;pointers&nbsp;so&nbsp;the&nbsp;interface{}&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3161781">//&nbsp;goes&nbsp;through&nbsp;without&nbsp;losing&nbsp;its&nbsp;interfaceness.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161832">tBool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3161843">=</span>&nbsp;<span class="ident" id="3161845">bootstrapType</span><span class="op" id="3161858">(</span><span class="string" id="3161859">&#34;bool&#34;</span><span class="op" id="3161865">,</span>&nbsp;<span class="op" id="3161867">(</span><span class="op" id="3161868">*</span><span class="builtintype" id="3161869">bool</span><span class="op" id="3161873">)</span><span class="op" id="3161874">(</span><span class="ident" id="3161875">nil</span><span class="op" id="3161878">)</span><span class="op" id="3161879">,</span>&nbsp;<span class="num" id="3161881">1</span><span class="op" id="3161882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161885">tInt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3161896">=</span>&nbsp;<span class="ident" id="3161898">bootstrapType</span><span class="op" id="3161911">(</span><span class="string" id="3161912">&#34;int&#34;</span><span class="op" id="3161917">,</span>&nbsp;<span class="op" id="3161919">(</span><span class="op" id="3161920">*</span><span class="builtintype" id="3161921">int</span><span class="op" id="3161924">)</span><span class="op" id="3161925">(</span><span class="ident" id="3161926">nil</span><span class="op" id="3161929">)</span><span class="op" id="3161930">,</span>&nbsp;<span class="num" id="3161932">2</span><span class="op" id="3161933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161936">tUint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3161947">=</span>&nbsp;<span class="ident" id="3161949">bootstrapType</span><span class="op" id="3161962">(</span><span class="string" id="3161963">&#34;uint&#34;</span><span class="op" id="3161969">,</span>&nbsp;<span class="op" id="3161971">(</span><span class="op" id="3161972">*</span><span class="builtintype" id="3161973">uint</span><span class="op" id="3161977">)</span><span class="op" id="3161978">(</span><span class="ident" id="3161979">nil</span><span class="op" id="3161982">)</span><span class="op" id="3161983">,</span>&nbsp;<span class="num" id="3161985">3</span><span class="op" id="3161986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161989">tFloat</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3162000">=</span>&nbsp;<span class="ident" id="3162002">bootstrapType</span><span class="op" id="3162015">(</span><span class="string" id="3162016">&#34;float&#34;</span><span class="op" id="3162023">,</span>&nbsp;<span class="op" id="3162025">(</span><span class="op" id="3162026">*</span><span class="builtintype" id="3162027">float64</span><span class="op" id="3162034">)</span><span class="op" id="3162035">(</span><span class="ident" id="3162036">nil</span><span class="op" id="3162039">)</span><span class="op" id="3162040">,</span>&nbsp;<span class="num" id="3162042">4</span><span class="op" id="3162043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162046">tBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3162057">=</span>&nbsp;<span class="ident" id="3162059">bootstrapType</span><span class="op" id="3162072">(</span><span class="string" id="3162073">&#34;bytes&#34;</span><span class="op" id="3162080">,</span>&nbsp;<span class="op" id="3162082">(</span><span class="op" id="3162083">*</span><span class="op" id="3162084">[</span><span class="op" id="3162085">]</span><span class="builtintype" id="3162086">byte</span><span class="op" id="3162090">)</span><span class="op" id="3162091">(</span><span class="ident" id="3162092">nil</span><span class="op" id="3162095">)</span><span class="op" id="3162096">,</span>&nbsp;<span class="num" id="3162098">5</span><span class="op" id="3162099">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162102">tString</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3162113">=</span>&nbsp;<span class="ident" id="3162115">bootstrapType</span><span class="op" id="3162128">(</span><span class="string" id="3162129">&#34;string&#34;</span><span class="op" id="3162137">,</span>&nbsp;<span class="op" id="3162139">(</span><span class="op" id="3162140">*</span><span class="builtintype" id="3162141">string</span><span class="op" id="3162147">)</span><span class="op" id="3162148">(</span><span class="ident" id="3162149">nil</span><span class="op" id="3162152">)</span><span class="op" id="3162153">,</span>&nbsp;<span class="num" id="3162155">6</span><span class="op" id="3162156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162159">tComplex</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3162170">=</span>&nbsp;<span class="ident" id="3162172">bootstrapType</span><span class="op" id="3162185">(</span><span class="string" id="3162186">&#34;complex&#34;</span><span class="op" id="3162195">,</span>&nbsp;<span class="op" id="3162197">(</span><span class="op" id="3162198">*</span><span class="builtintype" id="3162199">complex128</span><span class="op" id="3162209">)</span><span class="op" id="3162210">(</span><span class="ident" id="3162211">nil</span><span class="op" id="3162214">)</span><span class="op" id="3162215">,</span>&nbsp;<span class="num" id="3162217">7</span><span class="op" id="3162218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162221">tInterface</span>&nbsp;<span class="op" id="3162232">=</span>&nbsp;<span class="ident" id="3162234">bootstrapType</span><span class="op" id="3162247">(</span><span class="string" id="3162248">&#34;interface&#34;</span><span class="op" id="3162259">,</span>&nbsp;<span class="op" id="3162261">(</span><span class="op" id="3162262">*</span><span class="keyword" id="3162263">interface</span><span class="op" id="3162272">{</span><span class="op" id="3162273">}</span><span class="op" id="3162274">)</span><span class="op" id="3162275">(</span><span class="ident" id="3162276">nil</span><span class="op" id="3162279">)</span><span class="op" id="3162280">,</span>&nbsp;<span class="num" id="3162282">8</span><span class="op" id="3162283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3162286">//&nbsp;Reserve&nbsp;some&nbsp;Ids&nbsp;for&nbsp;compatible&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162332">tReserved7</span>&nbsp;<span class="op" id="3162343">=</span>&nbsp;<span class="ident" id="3162345">bootstrapType</span><span class="op" id="3162358">(</span><span class="string" id="3162359">&#34;_reserved1&#34;</span><span class="op" id="3162371">,</span>&nbsp;<span class="op" id="3162373">(</span><span class="op" id="3162374">*</span><span class="keyword" id="3162375">struct</span><span class="op" id="3162381">{</span>&nbsp;<span class="ident" id="3162383">r7</span>&nbsp;<span class="builtintype" id="3162386">int</span>&nbsp;<span class="op" id="3162390">}</span><span class="op" id="3162391">)</span><span class="op" id="3162392">(</span><span class="ident" id="3162393">nil</span><span class="op" id="3162396">)</span><span class="op" id="3162397">,</span>&nbsp;<span class="num" id="3162399">9</span><span class="op" id="3162400">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162403">tReserved6</span>&nbsp;<span class="op" id="3162414">=</span>&nbsp;<span class="ident" id="3162416">bootstrapType</span><span class="op" id="3162429">(</span><span class="string" id="3162430">&#34;_reserved1&#34;</span><span class="op" id="3162442">,</span>&nbsp;<span class="op" id="3162444">(</span><span class="op" id="3162445">*</span><span class="keyword" id="3162446">struct</span><span class="op" id="3162452">{</span>&nbsp;<span class="ident" id="3162454">r6</span>&nbsp;<span class="builtintype" id="3162457">int</span>&nbsp;<span class="op" id="3162461">}</span><span class="op" id="3162462">)</span><span class="op" id="3162463">(</span><span class="ident" id="3162464">nil</span><span class="op" id="3162467">)</span><span class="op" id="3162468">,</span>&nbsp;<span class="num" id="3162470">10</span><span class="op" id="3162472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162475">tReserved5</span>&nbsp;<span class="op" id="3162486">=</span>&nbsp;<span class="ident" id="3162488">bootstrapType</span><span class="op" id="3162501">(</span><span class="string" id="3162502">&#34;_reserved1&#34;</span><span class="op" id="3162514">,</span>&nbsp;<span class="op" id="3162516">(</span><span class="op" id="3162517">*</span><span class="keyword" id="3162518">struct</span><span class="op" id="3162524">{</span>&nbsp;<span class="ident" id="3162526">r5</span>&nbsp;<span class="builtintype" id="3162529">int</span>&nbsp;<span class="op" id="3162533">}</span><span class="op" id="3162534">)</span><span class="op" id="3162535">(</span><span class="ident" id="3162536">nil</span><span class="op" id="3162539">)</span><span class="op" id="3162540">,</span>&nbsp;<span class="num" id="3162542">11</span><span class="op" id="3162544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162547">tReserved4</span>&nbsp;<span class="op" id="3162558">=</span>&nbsp;<span class="ident" id="3162560">bootstrapType</span><span class="op" id="3162573">(</span><span class="string" id="3162574">&#34;_reserved1&#34;</span><span class="op" id="3162586">,</span>&nbsp;<span class="op" id="3162588">(</span><span class="op" id="3162589">*</span><span class="keyword" id="3162590">struct</span><span class="op" id="3162596">{</span>&nbsp;<span class="ident" id="3162598">r4</span>&nbsp;<span class="builtintype" id="3162601">int</span>&nbsp;<span class="op" id="3162605">}</span><span class="op" id="3162606">)</span><span class="op" id="3162607">(</span><span class="ident" id="3162608">nil</span><span class="op" id="3162611">)</span><span class="op" id="3162612">,</span>&nbsp;<span class="num" id="3162614">12</span><span class="op" id="3162616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162619">tReserved3</span>&nbsp;<span class="op" id="3162630">=</span>&nbsp;<span class="ident" id="3162632">bootstrapType</span><span class="op" id="3162645">(</span><span class="string" id="3162646">&#34;_reserved1&#34;</span><span class="op" id="3162658">,</span>&nbsp;<span class="op" id="3162660">(</span><span class="op" id="3162661">*</span><span class="keyword" id="3162662">struct</span><span class="op" id="3162668">{</span>&nbsp;<span class="ident" id="3162670">r3</span>&nbsp;<span class="builtintype" id="3162673">int</span>&nbsp;<span class="op" id="3162677">}</span><span class="op" id="3162678">)</span><span class="op" id="3162679">(</span><span class="ident" id="3162680">nil</span><span class="op" id="3162683">)</span><span class="op" id="3162684">,</span>&nbsp;<span class="num" id="3162686">13</span><span class="op" id="3162688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162691">tReserved2</span>&nbsp;<span class="op" id="3162702">=</span>&nbsp;<span class="ident" id="3162704">bootstrapType</span><span class="op" id="3162717">(</span><span class="string" id="3162718">&#34;_reserved1&#34;</span><span class="op" id="3162730">,</span>&nbsp;<span class="op" id="3162732">(</span><span class="op" id="3162733">*</span><span class="keyword" id="3162734">struct</span><span class="op" id="3162740">{</span>&nbsp;<span class="ident" id="3162742">r2</span>&nbsp;<span class="builtintype" id="3162745">int</span>&nbsp;<span class="op" id="3162749">}</span><span class="op" id="3162750">)</span><span class="op" id="3162751">(</span><span class="ident" id="3162752">nil</span><span class="op" id="3162755">)</span><span class="op" id="3162756">,</span>&nbsp;<span class="num" id="3162758">14</span><span class="op" id="3162760">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162763">tReserved1</span>&nbsp;<span class="op" id="3162774">=</span>&nbsp;<span class="ident" id="3162776">bootstrapType</span><span class="op" id="3162789">(</span><span class="string" id="3162790">&#34;_reserved1&#34;</span><span class="op" id="3162802">,</span>&nbsp;<span class="op" id="3162804">(</span><span class="op" id="3162805">*</span><span class="keyword" id="3162806">struct</span><span class="op" id="3162812">{</span>&nbsp;<span class="ident" id="3162814">r1</span>&nbsp;<span class="builtintype" id="3162817">int</span>&nbsp;<span class="op" id="3162821">}</span><span class="op" id="3162822">)</span><span class="op" id="3162823">(</span><span class="ident" id="3162824">nil</span><span class="op" id="3162827">)</span><span class="op" id="3162828">,</span>&nbsp;<span class="num" id="3162830">15</span><span class="op" id="3162832">)</span><br>
<span class="lineno"></span><span class="op" id="3162834">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3162837">//&nbsp;Predefined&nbsp;because&nbsp;it&#39;s&nbsp;needed&nbsp;by&nbsp;the&nbsp;Decoder</span><br>
<span class="lineno"></span><span class="keyword" id="3162886">var</span>&nbsp;<span class="ident" id="3162890">tWireType</span>&nbsp;<span class="op" id="3162900">=</span>&nbsp;<span class="ident" id="3162902">mustGetTypeInfo</span><span class="op" id="3162917">(</span><span class="ident" id="3162918">reflect</span><span class="op" id="3162925">.</span><span class="ident" id="3162926">TypeOf</span><span class="op" id="3162932">(</span><span class="ident" id="3162933">wireType</span><span class="op" id="3162941">{</span><span class="op" id="3162942">}</span><span class="op" id="3162943">)</span><span class="op" id="3162944">)</span><span class="op" id="3162945">.</span><span class="ident" id="3162946">id</span><br>
<span class="lineno">270</span><span class="keyword" id="3162949">var</span>&nbsp;<span class="ident" id="3162953">wireTypeUserInfo</span>&nbsp;<span class="op" id="3162970">*</span><span class="ident" id="3162971">userTypeInfo</span>&nbsp;<span class="comment" id="3162984">//&nbsp;userTypeInfo&nbsp;of&nbsp;(*wireType)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3163016">func</span>&nbsp;<span class="ident" id="3163021">init</span><span class="op" id="3163025">(</span><span class="op" id="3163026">)</span>&nbsp;<span class="op" id="3163028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3163031">//&nbsp;Some&nbsp;magic&nbsp;numbers&nbsp;to&nbsp;make&nbsp;sure&nbsp;there&nbsp;are&nbsp;no&nbsp;surprises.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163091">checkId</span><span class="op" id="3163098">(</span><span class="num" id="3163099">16</span><span class="op" id="3163101">,</span>&nbsp;<span class="ident" id="3163103">tWireType</span><span class="op" id="3163112">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163115">checkId</span><span class="op" id="3163122">(</span><span class="num" id="3163123">17</span><span class="op" id="3163125">,</span>&nbsp;<span class="ident" id="3163127">mustGetTypeInfo</span><span class="op" id="3163142">(</span><span class="ident" id="3163143">reflect</span><span class="op" id="3163150">.</span><span class="ident" id="3163151">TypeOf</span><span class="op" id="3163157">(</span><span class="ident" id="3163158">arrayType</span><span class="op" id="3163167">{</span><span class="op" id="3163168">}</span><span class="op" id="3163169">)</span><span class="op" id="3163170">)</span><span class="op" id="3163171">.</span><span class="ident" id="3163172">id</span><span class="op" id="3163174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163177">checkId</span><span class="op" id="3163184">(</span><span class="num" id="3163185">18</span><span class="op" id="3163187">,</span>&nbsp;<span class="ident" id="3163189">mustGetTypeInfo</span><span class="op" id="3163204">(</span><span class="ident" id="3163205">reflect</span><span class="op" id="3163212">.</span><span class="ident" id="3163213">TypeOf</span><span class="op" id="3163219">(</span><span class="ident" id="3163220">CommonType</span><span class="op" id="3163230">{</span><span class="op" id="3163231">}</span><span class="op" id="3163232">)</span><span class="op" id="3163233">)</span><span class="op" id="3163234">.</span><span class="ident" id="3163235">id</span><span class="op" id="3163237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163240">checkId</span><span class="op" id="3163247">(</span><span class="num" id="3163248">19</span><span class="op" id="3163250">,</span>&nbsp;<span class="ident" id="3163252">mustGetTypeInfo</span><span class="op" id="3163267">(</span><span class="ident" id="3163268">reflect</span><span class="op" id="3163275">.</span><span class="ident" id="3163276">TypeOf</span><span class="op" id="3163282">(</span><span class="ident" id="3163283">sliceType</span><span class="op" id="3163292">{</span><span class="op" id="3163293">}</span><span class="op" id="3163294">)</span><span class="op" id="3163295">)</span><span class="op" id="3163296">.</span><span class="ident" id="3163297">id</span><span class="op" id="3163299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163302">checkId</span><span class="op" id="3163309">(</span><span class="num" id="3163310">20</span><span class="op" id="3163312">,</span>&nbsp;<span class="ident" id="3163314">mustGetTypeInfo</span><span class="op" id="3163329">(</span><span class="ident" id="3163330">reflect</span><span class="op" id="3163337">.</span><span class="ident" id="3163338">TypeOf</span><span class="op" id="3163344">(</span><span class="ident" id="3163345">structType</span><span class="op" id="3163355">{</span><span class="op" id="3163356">}</span><span class="op" id="3163357">)</span><span class="op" id="3163358">)</span><span class="op" id="3163359">.</span><span class="ident" id="3163360">id</span><span class="op" id="3163362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163365">checkId</span><span class="op" id="3163372">(</span><span class="num" id="3163373">21</span><span class="op" id="3163375">,</span>&nbsp;<span class="ident" id="3163377">mustGetTypeInfo</span><span class="op" id="3163392">(</span><span class="ident" id="3163393">reflect</span><span class="op" id="3163400">.</span><span class="ident" id="3163401">TypeOf</span><span class="op" id="3163407">(</span><span class="ident" id="3163408">fieldType</span><span class="op" id="3163417">{</span><span class="op" id="3163418">}</span><span class="op" id="3163419">)</span><span class="op" id="3163420">)</span><span class="op" id="3163421">.</span><span class="ident" id="3163422">id</span><span class="op" id="3163424">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163427">checkId</span><span class="op" id="3163434">(</span><span class="num" id="3163435">23</span><span class="op" id="3163437">,</span>&nbsp;<span class="ident" id="3163439">mustGetTypeInfo</span><span class="op" id="3163454">(</span><span class="ident" id="3163455">reflect</span><span class="op" id="3163462">.</span><span class="ident" id="3163463">TypeOf</span><span class="op" id="3163469">(</span><span class="ident" id="3163470">mapType</span><span class="op" id="3163477">{</span><span class="op" id="3163478">}</span><span class="op" id="3163479">)</span><span class="op" id="3163480">)</span><span class="op" id="3163481">.</span><span class="ident" id="3163482">id</span><span class="op" id="3163484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163488">builtinIdToType</span>&nbsp;<span class="op" id="3163504">=</span>&nbsp;<span class="builtinfunc" id="3163506">make</span><span class="op" id="3163510">(</span><span class="keyword" id="3163511">map</span><span class="op" id="3163514">[</span><span class="ident" id="3163515">typeId</span><span class="op" id="3163521">]</span><span class="ident" id="3163522">gobType</span><span class="op" id="3163529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163532">for</span>&nbsp;<span class="ident" id="3163536">k</span><span class="op" id="3163537">,</span>&nbsp;<span class="ident" id="3163539">v</span>&nbsp;<span class="op" id="3163541">:=</span>&nbsp;<span class="keyword" id="3163544">range</span>&nbsp;<span class="ident" id="3163550">idToType</span>&nbsp;<span class="op" id="3163559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163563">builtinIdToType</span><span class="op" id="3163578">[</span><span class="ident" id="3163579">k</span><span class="op" id="3163580">]</span>&nbsp;<span class="op" id="3163582">=</span>&nbsp;<span class="ident" id="3163584">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3163591">//&nbsp;Move&nbsp;the&nbsp;id&nbsp;space&nbsp;upwards&nbsp;to&nbsp;allow&nbsp;for&nbsp;growth&nbsp;in&nbsp;the&nbsp;predefined&nbsp;world</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3163665">//&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163702">if</span>&nbsp;<span class="ident" id="3163705">nextId</span>&nbsp;<span class="op" id="3163712">&gt;</span>&nbsp;<span class="ident" id="3163714">firstUserId</span>&nbsp;<span class="op" id="3163726">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3163730">panic</span><span class="op" id="3163735">(</span><span class="ident" id="3163736">fmt</span><span class="op" id="3163739">.</span><span class="ident" id="3163740">Sprintln</span><span class="op" id="3163748">(</span><span class="string" id="3163749">&#34;nextId&nbsp;too&nbsp;large:&#34;</span><span class="op" id="3163768">,</span>&nbsp;<span class="ident" id="3163770">nextId</span><span class="op" id="3163776">)</span><span class="op" id="3163777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163783">nextId</span>&nbsp;<span class="op" id="3163790">=</span>&nbsp;<span class="ident" id="3163792">firstUserId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163805">registerBasics</span><span class="op" id="3163819">(</span><span class="op" id="3163820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163823">wireTypeUserInfo</span>&nbsp;<span class="op" id="3163840">=</span>&nbsp;<span class="ident" id="3163842">userType</span><span class="op" id="3163850">(</span><span class="ident" id="3163851">reflect</span><span class="op" id="3163858">.</span><span class="ident" id="3163859">TypeOf</span><span class="op" id="3163865">(</span><span class="op" id="3163866">(</span><span class="op" id="3163867">*</span><span class="ident" id="3163868">wireType</span><span class="op" id="3163876">)</span><span class="op" id="3163877">(</span><span class="ident" id="3163878">nil</span><span class="op" id="3163881">)</span><span class="op" id="3163882">)</span><span class="op" id="3163883">)</span><br>
<span class="lineno">295</span><span class="op" id="3163885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3163888">//&nbsp;Array&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="3163902">type</span>&nbsp;<span class="ident" id="3163907">arrayType</span>&nbsp;<span class="keyword" id="3163917">struct</span>&nbsp;<span class="op" id="3163924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163927">CommonType</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163939">Elem</span>&nbsp;<span class="ident" id="3163944">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163952">Len</span>&nbsp;&nbsp;<span class="builtintype" id="3163957">int</span><br>
<span class="lineno"></span><span class="op" id="3163961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3163964">func</span>&nbsp;<span class="ident" id="3163969">newArrayType</span><span class="op" id="3163981">(</span><span class="ident" id="3163982">name</span>&nbsp;<span class="builtintype" id="3163987">string</span><span class="op" id="3163993">)</span>&nbsp;<span class="op" id="3163995">*</span><span class="ident" id="3163996">arrayType</span>&nbsp;<span class="op" id="3164006">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164009">a</span>&nbsp;<span class="op" id="3164011">:=</span>&nbsp;<span class="op" id="3164014">&amp;</span><span class="ident" id="3164015">arrayType</span><span class="op" id="3164024">{</span><span class="ident" id="3164025">CommonType</span><span class="op" id="3164035">{</span><span class="ident" id="3164036">Name</span><span class="op" id="3164040">:</span>&nbsp;<span class="ident" id="3164042">name</span><span class="op" id="3164046">}</span><span class="op" id="3164047">,</span>&nbsp;<span class="num" id="3164049">0</span><span class="op" id="3164050">,</span>&nbsp;<span class="num" id="3164052">0</span><span class="op" id="3164053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164056">return</span>&nbsp;<span class="ident" id="3164063">a</span><br>
<span class="lineno"></span><span class="op" id="3164065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3164068">func</span>&nbsp;<span class="op" id="3164073">(</span><span class="ident" id="3164074">a</span>&nbsp;<span class="op" id="3164076">*</span><span class="ident" id="3164077">arrayType</span><span class="op" id="3164086">)</span>&nbsp;<span class="ident" id="3164088">init</span><span class="op" id="3164092">(</span><span class="ident" id="3164093">elem</span>&nbsp;<span class="ident" id="3164098">gobType</span><span class="op" id="3164105">,</span>&nbsp;<span class="builtinfunc" id="3164107">len</span>&nbsp;<span class="builtintype" id="3164111">int</span><span class="op" id="3164114">)</span>&nbsp;<span class="op" id="3164116">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164119">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164194">setTypeId</span><span class="op" id="3164203">(</span><span class="ident" id="3164204">a</span><span class="op" id="3164205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164208">a</span><span class="op" id="3164209">.</span><span class="ident" id="3164210">Elem</span>&nbsp;<span class="op" id="3164215">=</span>&nbsp;<span class="ident" id="3164217">elem</span><span class="op" id="3164221">.</span><span class="ident" id="3164222">id</span><span class="op" id="3164224">(</span><span class="op" id="3164225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164228">a</span><span class="op" id="3164229">.</span><span class="ident" id="3164230">Len</span>&nbsp;<span class="op" id="3164234">=</span>&nbsp;<span class="builtinfunc" id="3164236">len</span><br>
<span class="lineno"></span><span class="op" id="3164240">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="3164243">func</span>&nbsp;<span class="op" id="3164248">(</span><span class="ident" id="3164249">a</span>&nbsp;<span class="op" id="3164251">*</span><span class="ident" id="3164252">arrayType</span><span class="op" id="3164261">)</span>&nbsp;<span class="ident" id="3164263">safeString</span><span class="op" id="3164273">(</span><span class="ident" id="3164274">seen</span>&nbsp;<span class="keyword" id="3164279">map</span><span class="op" id="3164282">[</span><span class="ident" id="3164283">typeId</span><span class="op" id="3164289">]</span><span class="builtintype" id="3164290">bool</span><span class="op" id="3164294">)</span>&nbsp;<span class="builtintype" id="3164296">string</span>&nbsp;<span class="op" id="3164303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164306">if</span>&nbsp;<span class="ident" id="3164309">seen</span><span class="op" id="3164313">[</span><span class="ident" id="3164314">a</span><span class="op" id="3164315">.</span><span class="ident" id="3164316">Id</span><span class="op" id="3164318">]</span>&nbsp;<span class="op" id="3164320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164324">return</span>&nbsp;<span class="ident" id="3164331">a</span><span class="op" id="3164332">.</span><span class="ident" id="3164333">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164339">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164342">seen</span><span class="op" id="3164346">[</span><span class="ident" id="3164347">a</span><span class="op" id="3164348">.</span><span class="ident" id="3164349">Id</span><span class="op" id="3164351">]</span>&nbsp;<span class="op" id="3164353">=</span>&nbsp;<span class="builtintype" id="3164355">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164361">return</span>&nbsp;<span class="ident" id="3164368">fmt</span><span class="op" id="3164371">.</span><span class="ident" id="3164372">Sprintf</span><span class="op" id="3164379">(</span><span class="string" id="3164380">&#34;[%d]%s&#34;</span><span class="op" id="3164388">,</span>&nbsp;<span class="ident" id="3164390">a</span><span class="op" id="3164391">.</span><span class="ident" id="3164392">Len</span><span class="op" id="3164395">,</span>&nbsp;<span class="ident" id="3164397">a</span><span class="op" id="3164398">.</span><span class="ident" id="3164399">Elem</span><span class="op" id="3164403">.</span><span class="ident" id="3164404">gobType</span><span class="op" id="3164411">(</span><span class="op" id="3164412">)</span><span class="op" id="3164413">.</span><span class="ident" id="3164414">safeString</span><span class="op" id="3164424">(</span><span class="ident" id="3164425">seen</span><span class="op" id="3164429">)</span><span class="op" id="3164430">)</span><br>
<span class="lineno"></span><span class="op" id="3164432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3164435">func</span>&nbsp;<span class="op" id="3164440">(</span><span class="ident" id="3164441">a</span>&nbsp;<span class="op" id="3164443">*</span><span class="ident" id="3164444">arrayType</span><span class="op" id="3164453">)</span>&nbsp;<span class="builtintype" id="3164455">string</span><span class="op" id="3164461">(</span><span class="op" id="3164462">)</span>&nbsp;<span class="builtintype" id="3164464">string</span>&nbsp;<span class="op" id="3164471">{</span>&nbsp;<span class="keyword" id="3164473">return</span>&nbsp;<span class="ident" id="3164480">a</span><span class="op" id="3164481">.</span><span class="ident" id="3164482">safeString</span><span class="op" id="3164492">(</span><span class="builtinfunc" id="3164493">make</span><span class="op" id="3164497">(</span><span class="keyword" id="3164498">map</span><span class="op" id="3164501">[</span><span class="ident" id="3164502">typeId</span><span class="op" id="3164508">]</span><span class="builtintype" id="3164509">bool</span><span class="op" id="3164513">)</span><span class="op" id="3164514">)</span>&nbsp;<span class="op" id="3164516">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="3164519">//&nbsp;GobEncoder&nbsp;type&nbsp;(something&nbsp;that&nbsp;implements&nbsp;the&nbsp;GobEncoder&nbsp;interface)</span><br>
<span class="lineno"></span><span class="keyword" id="3164591">type</span>&nbsp;<span class="ident" id="3164596">gobEncoderType</span>&nbsp;<span class="keyword" id="3164611">struct</span>&nbsp;<span class="op" id="3164618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164621">CommonType</span><br>
<span class="lineno"></span><span class="op" id="3164632">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="3164635">func</span>&nbsp;<span class="ident" id="3164640">newGobEncoderType</span><span class="op" id="3164657">(</span><span class="ident" id="3164658">name</span>&nbsp;<span class="builtintype" id="3164663">string</span><span class="op" id="3164669">)</span>&nbsp;<span class="op" id="3164671">*</span><span class="ident" id="3164672">gobEncoderType</span>&nbsp;<span class="op" id="3164687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164690">g</span>&nbsp;<span class="op" id="3164692">:=</span>&nbsp;<span class="op" id="3164695">&amp;</span><span class="ident" id="3164696">gobEncoderType</span><span class="op" id="3164710">{</span><span class="ident" id="3164711">CommonType</span><span class="op" id="3164721">{</span><span class="ident" id="3164722">Name</span><span class="op" id="3164726">:</span>&nbsp;<span class="ident" id="3164728">name</span><span class="op" id="3164732">}</span><span class="op" id="3164733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164736">setTypeId</span><span class="op" id="3164745">(</span><span class="ident" id="3164746">g</span><span class="op" id="3164747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164750">return</span>&nbsp;<span class="ident" id="3164757">g</span><br>
<span class="lineno">335</span><span class="op" id="3164759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3164762">func</span>&nbsp;<span class="op" id="3164767">(</span><span class="ident" id="3164768">g</span>&nbsp;<span class="op" id="3164770">*</span><span class="ident" id="3164771">gobEncoderType</span><span class="op" id="3164785">)</span>&nbsp;<span class="ident" id="3164787">safeString</span><span class="op" id="3164797">(</span><span class="ident" id="3164798">seen</span>&nbsp;<span class="keyword" id="3164803">map</span><span class="op" id="3164806">[</span><span class="ident" id="3164807">typeId</span><span class="op" id="3164813">]</span><span class="builtintype" id="3164814">bool</span><span class="op" id="3164818">)</span>&nbsp;<span class="builtintype" id="3164820">string</span>&nbsp;<span class="op" id="3164827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164830">return</span>&nbsp;<span class="ident" id="3164837">g</span><span class="op" id="3164838">.</span><span class="ident" id="3164839">Name</span><br>
<span class="lineno"></span><span class="op" id="3164844">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="3164847">func</span>&nbsp;<span class="op" id="3164852">(</span><span class="ident" id="3164853">g</span>&nbsp;<span class="op" id="3164855">*</span><span class="ident" id="3164856">gobEncoderType</span><span class="op" id="3164870">)</span>&nbsp;<span class="builtintype" id="3164872">string</span><span class="op" id="3164878">(</span><span class="op" id="3164879">)</span>&nbsp;<span class="builtintype" id="3164881">string</span>&nbsp;<span class="op" id="3164888">{</span>&nbsp;<span class="keyword" id="3164890">return</span>&nbsp;<span class="ident" id="3164897">g</span><span class="op" id="3164898">.</span><span class="ident" id="3164899">Name</span>&nbsp;<span class="op" id="3164904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3164907">//&nbsp;Map&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="3164919">type</span>&nbsp;<span class="ident" id="3164924">mapType</span>&nbsp;<span class="keyword" id="3164932">struct</span>&nbsp;<span class="op" id="3164939">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164942">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164954">Key</span>&nbsp;&nbsp;<span class="ident" id="3164959">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164967">Elem</span>&nbsp;<span class="ident" id="3164972">typeId</span><br>
<span class="lineno"></span><span class="op" id="3164979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="3164982">func</span>&nbsp;<span class="ident" id="3164987">newMapType</span><span class="op" id="3164997">(</span><span class="ident" id="3164998">name</span>&nbsp;<span class="builtintype" id="3165003">string</span><span class="op" id="3165009">)</span>&nbsp;<span class="op" id="3165011">*</span><span class="ident" id="3165012">mapType</span>&nbsp;<span class="op" id="3165020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165023">m</span>&nbsp;<span class="op" id="3165025">:=</span>&nbsp;<span class="op" id="3165028">&amp;</span><span class="ident" id="3165029">mapType</span><span class="op" id="3165036">{</span><span class="ident" id="3165037">CommonType</span><span class="op" id="3165047">{</span><span class="ident" id="3165048">Name</span><span class="op" id="3165052">:</span>&nbsp;<span class="ident" id="3165054">name</span><span class="op" id="3165058">}</span><span class="op" id="3165059">,</span>&nbsp;<span class="num" id="3165061">0</span><span class="op" id="3165062">,</span>&nbsp;<span class="num" id="3165064">0</span><span class="op" id="3165065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165068">return</span>&nbsp;<span class="ident" id="3165075">m</span><br>
<span class="lineno"></span><span class="op" id="3165077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="3165080">func</span>&nbsp;<span class="op" id="3165085">(</span><span class="ident" id="3165086">m</span>&nbsp;<span class="op" id="3165088">*</span><span class="ident" id="3165089">mapType</span><span class="op" id="3165096">)</span>&nbsp;<span class="ident" id="3165098">init</span><span class="op" id="3165102">(</span><span class="ident" id="3165103">key</span><span class="op" id="3165106">,</span>&nbsp;<span class="ident" id="3165108">elem</span>&nbsp;<span class="ident" id="3165113">gobType</span><span class="op" id="3165120">)</span>&nbsp;<span class="op" id="3165122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3165125">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165200">setTypeId</span><span class="op" id="3165209">(</span><span class="ident" id="3165210">m</span><span class="op" id="3165211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165214">m</span><span class="op" id="3165215">.</span><span class="ident" id="3165216">Key</span>&nbsp;<span class="op" id="3165220">=</span>&nbsp;<span class="ident" id="3165222">key</span><span class="op" id="3165225">.</span><span class="ident" id="3165226">id</span><span class="op" id="3165228">(</span><span class="op" id="3165229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165232">m</span><span class="op" id="3165233">.</span><span class="ident" id="3165234">Elem</span>&nbsp;<span class="op" id="3165239">=</span>&nbsp;<span class="ident" id="3165241">elem</span><span class="op" id="3165245">.</span><span class="ident" id="3165246">id</span><span class="op" id="3165248">(</span><span class="op" id="3165249">)</span><br>
<span class="lineno">360</span><span class="op" id="3165251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3165254">func</span>&nbsp;<span class="op" id="3165259">(</span><span class="ident" id="3165260">m</span>&nbsp;<span class="op" id="3165262">*</span><span class="ident" id="3165263">mapType</span><span class="op" id="3165270">)</span>&nbsp;<span class="ident" id="3165272">safeString</span><span class="op" id="3165282">(</span><span class="ident" id="3165283">seen</span>&nbsp;<span class="keyword" id="3165288">map</span><span class="op" id="3165291">[</span><span class="ident" id="3165292">typeId</span><span class="op" id="3165298">]</span><span class="builtintype" id="3165299">bool</span><span class="op" id="3165303">)</span>&nbsp;<span class="builtintype" id="3165305">string</span>&nbsp;<span class="op" id="3165312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165315">if</span>&nbsp;<span class="ident" id="3165318">seen</span><span class="op" id="3165322">[</span><span class="ident" id="3165323">m</span><span class="op" id="3165324">.</span><span class="ident" id="3165325">Id</span><span class="op" id="3165327">]</span>&nbsp;<span class="op" id="3165329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165333">return</span>&nbsp;<span class="ident" id="3165340">m</span><span class="op" id="3165341">.</span><span class="ident" id="3165342">Name</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165351">seen</span><span class="op" id="3165355">[</span><span class="ident" id="3165356">m</span><span class="op" id="3165357">.</span><span class="ident" id="3165358">Id</span><span class="op" id="3165360">]</span>&nbsp;<span class="op" id="3165362">=</span>&nbsp;<span class="builtintype" id="3165364">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165370">key</span>&nbsp;<span class="op" id="3165374">:=</span>&nbsp;<span class="ident" id="3165377">m</span><span class="op" id="3165378">.</span><span class="ident" id="3165379">Key</span><span class="op" id="3165382">.</span><span class="ident" id="3165383">gobType</span><span class="op" id="3165390">(</span><span class="op" id="3165391">)</span><span class="op" id="3165392">.</span><span class="ident" id="3165393">safeString</span><span class="op" id="3165403">(</span><span class="ident" id="3165404">seen</span><span class="op" id="3165408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165411">elem</span>&nbsp;<span class="op" id="3165416">:=</span>&nbsp;<span class="ident" id="3165419">m</span><span class="op" id="3165420">.</span><span class="ident" id="3165421">Elem</span><span class="op" id="3165425">.</span><span class="ident" id="3165426">gobType</span><span class="op" id="3165433">(</span><span class="op" id="3165434">)</span><span class="op" id="3165435">.</span><span class="ident" id="3165436">safeString</span><span class="op" id="3165446">(</span><span class="ident" id="3165447">seen</span><span class="op" id="3165451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165454">return</span>&nbsp;<span class="ident" id="3165461">fmt</span><span class="op" id="3165464">.</span><span class="ident" id="3165465">Sprintf</span><span class="op" id="3165472">(</span><span class="string" id="3165473">&#34;map[%s]%s&#34;</span><span class="op" id="3165484">,</span>&nbsp;<span class="ident" id="3165486">key</span><span class="op" id="3165489">,</span>&nbsp;<span class="ident" id="3165491">elem</span><span class="op" id="3165495">)</span><br>
<span class="lineno">370</span><span class="op" id="3165497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3165500">func</span>&nbsp;<span class="op" id="3165505">(</span><span class="ident" id="3165506">m</span>&nbsp;<span class="op" id="3165508">*</span><span class="ident" id="3165509">mapType</span><span class="op" id="3165516">)</span>&nbsp;<span class="builtintype" id="3165518">string</span><span class="op" id="3165524">(</span><span class="op" id="3165525">)</span>&nbsp;<span class="builtintype" id="3165527">string</span>&nbsp;<span class="op" id="3165534">{</span>&nbsp;<span class="keyword" id="3165536">return</span>&nbsp;<span class="ident" id="3165543">m</span><span class="op" id="3165544">.</span><span class="ident" id="3165545">safeString</span><span class="op" id="3165555">(</span><span class="builtinfunc" id="3165556">make</span><span class="op" id="3165560">(</span><span class="keyword" id="3165561">map</span><span class="op" id="3165564">[</span><span class="ident" id="3165565">typeId</span><span class="op" id="3165571">]</span><span class="builtintype" id="3165572">bool</span><span class="op" id="3165576">)</span><span class="op" id="3165577">)</span>&nbsp;<span class="op" id="3165579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3165582">//&nbsp;Slice&nbsp;type</span><br>
<span class="lineno">375</span><span class="keyword" id="3165596">type</span>&nbsp;<span class="ident" id="3165601">sliceType</span>&nbsp;<span class="keyword" id="3165611">struct</span>&nbsp;<span class="op" id="3165618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165621">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165633">Elem</span>&nbsp;<span class="ident" id="3165638">typeId</span><br>
<span class="lineno"></span><span class="op" id="3165645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="3165648">func</span>&nbsp;<span class="ident" id="3165653">newSliceType</span><span class="op" id="3165665">(</span><span class="ident" id="3165666">name</span>&nbsp;<span class="builtintype" id="3165671">string</span><span class="op" id="3165677">)</span>&nbsp;<span class="op" id="3165679">*</span><span class="ident" id="3165680">sliceType</span>&nbsp;<span class="op" id="3165690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165693">s</span>&nbsp;<span class="op" id="3165695">:=</span>&nbsp;<span class="op" id="3165698">&amp;</span><span class="ident" id="3165699">sliceType</span><span class="op" id="3165708">{</span><span class="ident" id="3165709">CommonType</span><span class="op" id="3165719">{</span><span class="ident" id="3165720">Name</span><span class="op" id="3165724">:</span>&nbsp;<span class="ident" id="3165726">name</span><span class="op" id="3165730">}</span><span class="op" id="3165731">,</span>&nbsp;<span class="num" id="3165733">0</span><span class="op" id="3165734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165737">return</span>&nbsp;<span class="ident" id="3165744">s</span><br>
<span class="lineno"></span><span class="op" id="3165746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="3165749">func</span>&nbsp;<span class="op" id="3165754">(</span><span class="ident" id="3165755">s</span>&nbsp;<span class="op" id="3165757">*</span><span class="ident" id="3165758">sliceType</span><span class="op" id="3165767">)</span>&nbsp;<span class="ident" id="3165769">init</span><span class="op" id="3165773">(</span><span class="ident" id="3165774">elem</span>&nbsp;<span class="ident" id="3165779">gobType</span><span class="op" id="3165786">)</span>&nbsp;<span class="op" id="3165788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3165791">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165866">setTypeId</span><span class="op" id="3165875">(</span><span class="ident" id="3165876">s</span><span class="op" id="3165877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3165880">//&nbsp;See&nbsp;the&nbsp;comments&nbsp;about&nbsp;ids&nbsp;in&nbsp;newTypeObject.&nbsp;Only&nbsp;slices&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3165945">//&nbsp;structs&nbsp;have&nbsp;mutual&nbsp;recursion.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165980">if</span>&nbsp;<span class="ident" id="3165983">elem</span><span class="op" id="3165987">.</span><span class="ident" id="3165988">id</span><span class="op" id="3165990">(</span><span class="op" id="3165991">)</span>&nbsp;<span class="op" id="3165993">==</span>&nbsp;<span class="num" id="3165996">0</span>&nbsp;<span class="op" id="3165998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166002">setTypeId</span><span class="op" id="3166011">(</span><span class="ident" id="3166012">elem</span><span class="op" id="3166016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166022">s</span><span class="op" id="3166023">.</span><span class="ident" id="3166024">Elem</span>&nbsp;<span class="op" id="3166029">=</span>&nbsp;<span class="ident" id="3166031">elem</span><span class="op" id="3166035">.</span><span class="ident" id="3166036">id</span><span class="op" id="3166038">(</span><span class="op" id="3166039">)</span><br>
<span class="lineno"></span><span class="op" id="3166041">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="3166044">func</span>&nbsp;<span class="op" id="3166049">(</span><span class="ident" id="3166050">s</span>&nbsp;<span class="op" id="3166052">*</span><span class="ident" id="3166053">sliceType</span><span class="op" id="3166062">)</span>&nbsp;<span class="ident" id="3166064">safeString</span><span class="op" id="3166074">(</span><span class="ident" id="3166075">seen</span>&nbsp;<span class="keyword" id="3166080">map</span><span class="op" id="3166083">[</span><span class="ident" id="3166084">typeId</span><span class="op" id="3166090">]</span><span class="builtintype" id="3166091">bool</span><span class="op" id="3166095">)</span>&nbsp;<span class="builtintype" id="3166097">string</span>&nbsp;<span class="op" id="3166104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166107">if</span>&nbsp;<span class="ident" id="3166110">seen</span><span class="op" id="3166114">[</span><span class="ident" id="3166115">s</span><span class="op" id="3166116">.</span><span class="ident" id="3166117">Id</span><span class="op" id="3166119">]</span>&nbsp;<span class="op" id="3166121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166125">return</span>&nbsp;<span class="ident" id="3166132">s</span><span class="op" id="3166133">.</span><span class="ident" id="3166134">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166140">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166143">seen</span><span class="op" id="3166147">[</span><span class="ident" id="3166148">s</span><span class="op" id="3166149">.</span><span class="ident" id="3166150">Id</span><span class="op" id="3166152">]</span>&nbsp;<span class="op" id="3166154">=</span>&nbsp;<span class="builtintype" id="3166156">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166162">return</span>&nbsp;<span class="ident" id="3166169">fmt</span><span class="op" id="3166172">.</span><span class="ident" id="3166173">Sprintf</span><span class="op" id="3166180">(</span><span class="string" id="3166181">&#34;[]%s&#34;</span><span class="op" id="3166187">,</span>&nbsp;<span class="ident" id="3166189">s</span><span class="op" id="3166190">.</span><span class="ident" id="3166191">Elem</span><span class="op" id="3166195">.</span><span class="ident" id="3166196">gobType</span><span class="op" id="3166203">(</span><span class="op" id="3166204">)</span><span class="op" id="3166205">.</span><span class="ident" id="3166206">safeString</span><span class="op" id="3166216">(</span><span class="ident" id="3166217">seen</span><span class="op" id="3166221">)</span><span class="op" id="3166222">)</span><br>
<span class="lineno"></span><span class="op" id="3166224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3166227">func</span>&nbsp;<span class="op" id="3166232">(</span><span class="ident" id="3166233">s</span>&nbsp;<span class="op" id="3166235">*</span><span class="ident" id="3166236">sliceType</span><span class="op" id="3166245">)</span>&nbsp;<span class="builtintype" id="3166247">string</span><span class="op" id="3166253">(</span><span class="op" id="3166254">)</span>&nbsp;<span class="builtintype" id="3166256">string</span>&nbsp;<span class="op" id="3166263">{</span>&nbsp;<span class="keyword" id="3166265">return</span>&nbsp;<span class="ident" id="3166272">s</span><span class="op" id="3166273">.</span><span class="ident" id="3166274">safeString</span><span class="op" id="3166284">(</span><span class="builtinfunc" id="3166285">make</span><span class="op" id="3166289">(</span><span class="keyword" id="3166290">map</span><span class="op" id="3166293">[</span><span class="ident" id="3166294">typeId</span><span class="op" id="3166300">]</span><span class="builtintype" id="3166301">bool</span><span class="op" id="3166305">)</span><span class="op" id="3166306">)</span>&nbsp;<span class="op" id="3166308">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3166311">//&nbsp;Struct&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="3166326">type</span>&nbsp;<span class="ident" id="3166331">fieldType</span>&nbsp;<span class="keyword" id="3166341">struct</span>&nbsp;<span class="op" id="3166348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166351">Name</span>&nbsp;<span class="builtintype" id="3166356">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166364">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3166369">typeId</span><br>
<span class="lineno">410</span><span class="op" id="3166376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3166379">type</span>&nbsp;<span class="ident" id="3166384">structType</span>&nbsp;<span class="keyword" id="3166395">struct</span>&nbsp;<span class="op" id="3166402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166405">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166417">Field</span>&nbsp;<span class="op" id="3166423">[</span><span class="op" id="3166424">]</span><span class="op" id="3166425">*</span><span class="ident" id="3166426">fieldType</span><br>
<span class="lineno">415</span><span class="op" id="3166436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3166439">func</span>&nbsp;<span class="op" id="3166444">(</span><span class="ident" id="3166445">s</span>&nbsp;<span class="op" id="3166447">*</span><span class="ident" id="3166448">structType</span><span class="op" id="3166458">)</span>&nbsp;<span class="ident" id="3166460">safeString</span><span class="op" id="3166470">(</span><span class="ident" id="3166471">seen</span>&nbsp;<span class="keyword" id="3166476">map</span><span class="op" id="3166479">[</span><span class="ident" id="3166480">typeId</span><span class="op" id="3166486">]</span><span class="builtintype" id="3166487">bool</span><span class="op" id="3166491">)</span>&nbsp;<span class="builtintype" id="3166493">string</span>&nbsp;<span class="op" id="3166500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166503">if</span>&nbsp;<span class="ident" id="3166506">s</span>&nbsp;<span class="op" id="3166508">==</span>&nbsp;<span class="ident" id="3166511">nil</span>&nbsp;<span class="op" id="3166515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166519">return</span>&nbsp;<span class="string" id="3166526">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166538">if</span>&nbsp;<span class="ident" id="3166541">_</span><span class="op" id="3166542">,</span>&nbsp;<span class="ident" id="3166544">ok</span>&nbsp;<span class="op" id="3166547">:=</span>&nbsp;<span class="ident" id="3166550">seen</span><span class="op" id="3166554">[</span><span class="ident" id="3166555">s</span><span class="op" id="3166556">.</span><span class="ident" id="3166557">Id</span><span class="op" id="3166559">]</span><span class="op" id="3166560">;</span>&nbsp;<span class="ident" id="3166562">ok</span>&nbsp;<span class="op" id="3166565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166569">return</span>&nbsp;<span class="ident" id="3166576">s</span><span class="op" id="3166577">.</span><span class="ident" id="3166578">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166587">seen</span><span class="op" id="3166591">[</span><span class="ident" id="3166592">s</span><span class="op" id="3166593">.</span><span class="ident" id="3166594">Id</span><span class="op" id="3166596">]</span>&nbsp;<span class="op" id="3166598">=</span>&nbsp;<span class="builtintype" id="3166600">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166606">str</span>&nbsp;<span class="op" id="3166610">:=</span>&nbsp;<span class="ident" id="3166613">s</span><span class="op" id="3166614">.</span><span class="ident" id="3166615">Name</span>&nbsp;<span class="op" id="3166620">+</span>&nbsp;<span class="string" id="3166622">&#34;&nbsp;=&nbsp;struct&nbsp;{&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166638">for</span>&nbsp;<span class="ident" id="3166642">_</span><span class="op" id="3166643">,</span>&nbsp;<span class="ident" id="3166645">f</span>&nbsp;<span class="op" id="3166647">:=</span>&nbsp;<span class="keyword" id="3166650">range</span>&nbsp;<span class="ident" id="3166656">s</span><span class="op" id="3166657">.</span><span class="ident" id="3166658">Field</span>&nbsp;<span class="op" id="3166664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166668">str</span>&nbsp;<span class="op" id="3166672">+=</span>&nbsp;<span class="ident" id="3166675">fmt</span><span class="op" id="3166678">.</span><span class="ident" id="3166679">Sprintf</span><span class="op" id="3166686">(</span><span class="string" id="3166687">&#34;%s&nbsp;%s;&nbsp;&#34;</span><span class="op" id="3166696">,</span>&nbsp;<span class="ident" id="3166698">f</span><span class="op" id="3166699">.</span><span class="ident" id="3166700">Name</span><span class="op" id="3166704">,</span>&nbsp;<span class="ident" id="3166706">f</span><span class="op" id="3166707">.</span><span class="ident" id="3166708">Id</span><span class="op" id="3166710">.</span><span class="ident" id="3166711">gobType</span><span class="op" id="3166718">(</span><span class="op" id="3166719">)</span><span class="op" id="3166720">.</span><span class="ident" id="3166721">safeString</span><span class="op" id="3166731">(</span><span class="ident" id="3166732">seen</span><span class="op" id="3166736">)</span><span class="op" id="3166737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166743">str</span>&nbsp;<span class="op" id="3166747">+=</span>&nbsp;<span class="string" id="3166750">&#34;}&#34;</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166755">return</span>&nbsp;<span class="ident" id="3166762">str</span><br>
<span class="lineno"></span><span class="op" id="3166766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3166769">func</span>&nbsp;<span class="op" id="3166774">(</span><span class="ident" id="3166775">s</span>&nbsp;<span class="op" id="3166777">*</span><span class="ident" id="3166778">structType</span><span class="op" id="3166788">)</span>&nbsp;<span class="builtintype" id="3166790">string</span><span class="op" id="3166796">(</span><span class="op" id="3166797">)</span>&nbsp;<span class="builtintype" id="3166799">string</span>&nbsp;<span class="op" id="3166806">{</span>&nbsp;<span class="keyword" id="3166808">return</span>&nbsp;<span class="ident" id="3166815">s</span><span class="op" id="3166816">.</span><span class="ident" id="3166817">safeString</span><span class="op" id="3166827">(</span><span class="builtinfunc" id="3166828">make</span><span class="op" id="3166832">(</span><span class="keyword" id="3166833">map</span><span class="op" id="3166836">[</span><span class="ident" id="3166837">typeId</span><span class="op" id="3166843">]</span><span class="builtintype" id="3166844">bool</span><span class="op" id="3166848">)</span><span class="op" id="3166849">)</span>&nbsp;<span class="op" id="3166851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="3166854">func</span>&nbsp;<span class="ident" id="3166859">newStructType</span><span class="op" id="3166872">(</span><span class="ident" id="3166873">name</span>&nbsp;<span class="builtintype" id="3166878">string</span><span class="op" id="3166884">)</span>&nbsp;<span class="op" id="3166886">*</span><span class="ident" id="3166887">structType</span>&nbsp;<span class="op" id="3166898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166901">s</span>&nbsp;<span class="op" id="3166903">:=</span>&nbsp;<span class="op" id="3166906">&amp;</span><span class="ident" id="3166907">structType</span><span class="op" id="3166917">{</span><span class="ident" id="3166918">CommonType</span><span class="op" id="3166928">{</span><span class="ident" id="3166929">Name</span><span class="op" id="3166933">:</span>&nbsp;<span class="ident" id="3166935">name</span><span class="op" id="3166939">}</span><span class="op" id="3166940">,</span>&nbsp;<span class="ident" id="3166942">nil</span><span class="op" id="3166945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166948">//&nbsp;For&nbsp;historical&nbsp;reasons&nbsp;we&nbsp;set&nbsp;the&nbsp;id&nbsp;here&nbsp;rather&nbsp;than&nbsp;init.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167012">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;newTypeObject&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167062">setTypeId</span><span class="op" id="3167071">(</span><span class="ident" id="3167072">s</span><span class="op" id="3167073">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167076">return</span>&nbsp;<span class="ident" id="3167083">s</span><br>
<span class="lineno"></span><span class="op" id="3167085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3167088">//&nbsp;newTypeObject&nbsp;allocates&nbsp;a&nbsp;gobType&nbsp;for&nbsp;the&nbsp;reflection&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="3167153">//&nbsp;Unless&nbsp;ut&nbsp;represents&nbsp;a&nbsp;GobEncoder,&nbsp;rt&nbsp;should&nbsp;be&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno">445</span><span class="comment" id="3167218">//&nbsp;of&nbsp;ut.</span><br>
<span class="lineno"></span><span class="comment" id="3167228">//&nbsp;This&nbsp;is&nbsp;only&nbsp;called&nbsp;from&nbsp;the&nbsp;encoding&nbsp;side.&nbsp;The&nbsp;decoding&nbsp;side</span><br>
<span class="lineno"></span><span class="comment" id="3167293">//&nbsp;works&nbsp;through&nbsp;typeIds&nbsp;and&nbsp;userTypeInfos&nbsp;alone.</span><br>
<span class="lineno"></span><span class="keyword" id="3167343">func</span>&nbsp;<span class="ident" id="3167348">newTypeObject</span><span class="op" id="3167361">(</span><span class="ident" id="3167362">name</span>&nbsp;<span class="builtintype" id="3167367">string</span><span class="op" id="3167373">,</span>&nbsp;<span class="ident" id="3167375">ut</span>&nbsp;<span class="op" id="3167378">*</span><span class="ident" id="3167379">userTypeInfo</span><span class="op" id="3167391">,</span>&nbsp;<span class="ident" id="3167393">rt</span>&nbsp;<span class="ident" id="3167396">reflect</span><span class="op" id="3167403">.</span><span class="ident" id="3167404">Type</span><span class="op" id="3167408">)</span>&nbsp;<span class="op" id="3167410">(</span><span class="ident" id="3167411">gobType</span><span class="op" id="3167418">,</span>&nbsp;<span class="builtintype" id="3167420">error</span><span class="op" id="3167425">)</span>&nbsp;<span class="op" id="3167427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167430">//&nbsp;Does&nbsp;this&nbsp;type&nbsp;implement&nbsp;GobEncoder?</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167471">if</span>&nbsp;<span class="ident" id="3167474">ut</span><span class="op" id="3167476">.</span><span class="ident" id="3167477">externalEnc</span>&nbsp;<span class="op" id="3167489">!=</span>&nbsp;<span class="num" id="3167492">0</span>&nbsp;<span class="op" id="3167494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167498">return</span>&nbsp;<span class="ident" id="3167505">newGobEncoderType</span><span class="op" id="3167522">(</span><span class="ident" id="3167523">name</span><span class="op" id="3167527">)</span><span class="op" id="3167528">,</span>&nbsp;<span class="ident" id="3167530">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167538">var</span>&nbsp;<span class="ident" id="3167542">err</span>&nbsp;<span class="builtintype" id="3167546">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167553">var</span>&nbsp;<span class="ident" id="3167557">type0</span><span class="op" id="3167562">,</span>&nbsp;<span class="ident" id="3167564">type1</span>&nbsp;<span class="ident" id="3167570">gobType</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167579">defer</span>&nbsp;<span class="keyword" id="3167585">func</span><span class="op" id="3167589">(</span><span class="op" id="3167590">)</span>&nbsp;<span class="op" id="3167592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167596">if</span>&nbsp;<span class="ident" id="3167599">err</span>&nbsp;<span class="op" id="3167603">!=</span>&nbsp;<span class="ident" id="3167606">nil</span>&nbsp;<span class="op" id="3167610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3167615">delete</span><span class="op" id="3167621">(</span><span class="ident" id="3167622">types</span><span class="op" id="3167627">,</span>&nbsp;<span class="ident" id="3167629">rt</span><span class="op" id="3167631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167638">}</span><span class="op" id="3167639">(</span><span class="op" id="3167640">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167643">//&nbsp;Install&nbsp;the&nbsp;top-level&nbsp;type&nbsp;before&nbsp;the&nbsp;subtypes&nbsp;(e.g.&nbsp;struct&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167714">//&nbsp;fields)&nbsp;so&nbsp;recursive&nbsp;types&nbsp;can&nbsp;be&nbsp;constructed&nbsp;safely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167772">switch</span>&nbsp;<span class="ident" id="3167779">t</span>&nbsp;<span class="op" id="3167781">:=</span>&nbsp;<span class="ident" id="3167784">rt</span><span class="op" id="3167786">;</span>&nbsp;<span class="ident" id="3167788">t</span><span class="op" id="3167789">.</span><span class="ident" id="3167790">Kind</span><span class="op" id="3167794">(</span><span class="op" id="3167795">)</span>&nbsp;<span class="op" id="3167797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167800">//&nbsp;All&nbsp;basic&nbsp;types&nbsp;are&nbsp;easy:&nbsp;they&nbsp;are&nbsp;predefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167851">case</span>&nbsp;<span class="ident" id="3167856">reflect</span><span class="op" id="3167863">.</span><span class="ident" id="3167864">Bool</span><span class="op" id="3167868">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167872">return</span>&nbsp;<span class="ident" id="3167879">tBool</span><span class="op" id="3167884">.</span><span class="ident" id="3167885">gobType</span><span class="op" id="3167892">(</span><span class="op" id="3167893">)</span><span class="op" id="3167894">,</span>&nbsp;<span class="ident" id="3167896">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167902">case</span>&nbsp;<span class="ident" id="3167907">reflect</span><span class="op" id="3167914">.</span><span class="ident" id="3167915">Int</span><span class="op" id="3167918">,</span>&nbsp;<span class="ident" id="3167920">reflect</span><span class="op" id="3167927">.</span><span class="ident" id="3167928">Int8</span><span class="op" id="3167932">,</span>&nbsp;<span class="ident" id="3167934">reflect</span><span class="op" id="3167941">.</span><span class="ident" id="3167942">Int16</span><span class="op" id="3167947">,</span>&nbsp;<span class="ident" id="3167949">reflect</span><span class="op" id="3167956">.</span><span class="ident" id="3167957">Int32</span><span class="op" id="3167962">,</span>&nbsp;<span class="ident" id="3167964">reflect</span><span class="op" id="3167971">.</span><span class="ident" id="3167972">Int64</span><span class="op" id="3167977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167981">return</span>&nbsp;<span class="ident" id="3167988">tInt</span><span class="op" id="3167992">.</span><span class="ident" id="3167993">gobType</span><span class="op" id="3168000">(</span><span class="op" id="3168001">)</span><span class="op" id="3168002">,</span>&nbsp;<span class="ident" id="3168004">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168010">case</span>&nbsp;<span class="ident" id="3168015">reflect</span><span class="op" id="3168022">.</span><span class="ident" id="3168023">Uint</span><span class="op" id="3168027">,</span>&nbsp;<span class="ident" id="3168029">reflect</span><span class="op" id="3168036">.</span><span class="ident" id="3168037">Uint8</span><span class="op" id="3168042">,</span>&nbsp;<span class="ident" id="3168044">reflect</span><span class="op" id="3168051">.</span><span class="ident" id="3168052">Uint16</span><span class="op" id="3168058">,</span>&nbsp;<span class="ident" id="3168060">reflect</span><span class="op" id="3168067">.</span><span class="ident" id="3168068">Uint32</span><span class="op" id="3168074">,</span>&nbsp;<span class="ident" id="3168076">reflect</span><span class="op" id="3168083">.</span><span class="ident" id="3168084">Uint64</span><span class="op" id="3168090">,</span>&nbsp;<span class="ident" id="3168092">reflect</span><span class="op" id="3168099">.</span><span class="ident" id="3168100">Uintptr</span><span class="op" id="3168107">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168111">return</span>&nbsp;<span class="ident" id="3168118">tUint</span><span class="op" id="3168123">.</span><span class="ident" id="3168124">gobType</span><span class="op" id="3168131">(</span><span class="op" id="3168132">)</span><span class="op" id="3168133">,</span>&nbsp;<span class="ident" id="3168135">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168141">case</span>&nbsp;<span class="ident" id="3168146">reflect</span><span class="op" id="3168153">.</span><span class="ident" id="3168154">Float32</span><span class="op" id="3168161">,</span>&nbsp;<span class="ident" id="3168163">reflect</span><span class="op" id="3168170">.</span><span class="ident" id="3168171">Float64</span><span class="op" id="3168178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168182">return</span>&nbsp;<span class="ident" id="3168189">tFloat</span><span class="op" id="3168195">.</span><span class="ident" id="3168196">gobType</span><span class="op" id="3168203">(</span><span class="op" id="3168204">)</span><span class="op" id="3168205">,</span>&nbsp;<span class="ident" id="3168207">nil</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168213">case</span>&nbsp;<span class="ident" id="3168218">reflect</span><span class="op" id="3168225">.</span><span class="ident" id="3168226">Complex64</span><span class="op" id="3168235">,</span>&nbsp;<span class="ident" id="3168237">reflect</span><span class="op" id="3168244">.</span><span class="ident" id="3168245">Complex128</span><span class="op" id="3168255">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168259">return</span>&nbsp;<span class="ident" id="3168266">tComplex</span><span class="op" id="3168274">.</span><span class="ident" id="3168275">gobType</span><span class="op" id="3168282">(</span><span class="op" id="3168283">)</span><span class="op" id="3168284">,</span>&nbsp;<span class="ident" id="3168286">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168292">case</span>&nbsp;<span class="ident" id="3168297">reflect</span><span class="op" id="3168304">.</span><span class="ident" id="3168305">String</span><span class="op" id="3168311">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168315">return</span>&nbsp;<span class="ident" id="3168322">tString</span><span class="op" id="3168329">.</span><span class="ident" id="3168330">gobType</span><span class="op" id="3168337">(</span><span class="op" id="3168338">)</span><span class="op" id="3168339">,</span>&nbsp;<span class="ident" id="3168341">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168347">case</span>&nbsp;<span class="ident" id="3168352">reflect</span><span class="op" id="3168359">.</span><span class="ident" id="3168360">Interface</span><span class="op" id="3168369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168373">return</span>&nbsp;<span class="ident" id="3168380">tInterface</span><span class="op" id="3168390">.</span><span class="ident" id="3168391">gobType</span><span class="op" id="3168398">(</span><span class="op" id="3168399">)</span><span class="op" id="3168400">,</span>&nbsp;<span class="ident" id="3168402">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168408">case</span>&nbsp;<span class="ident" id="3168413">reflect</span><span class="op" id="3168420">.</span><span class="ident" id="3168421">Array</span><span class="op" id="3168426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168430">at</span>&nbsp;<span class="op" id="3168433">:=</span>&nbsp;<span class="ident" id="3168436">newArrayType</span><span class="op" id="3168448">(</span><span class="ident" id="3168449">name</span><span class="op" id="3168453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168457">types</span><span class="op" id="3168462">[</span><span class="ident" id="3168463">rt</span><span class="op" id="3168465">]</span>&nbsp;<span class="op" id="3168467">=</span>&nbsp;<span class="ident" id="3168469">at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168474">type0</span><span class="op" id="3168479">,</span>&nbsp;<span class="ident" id="3168481">err</span>&nbsp;<span class="op" id="3168485">=</span>&nbsp;<span class="ident" id="3168487">getBaseType</span><span class="op" id="3168498">(</span><span class="string" id="3168499">&#34;&#34;</span><span class="op" id="3168501">,</span>&nbsp;<span class="ident" id="3168503">t</span><span class="op" id="3168504">.</span><span class="ident" id="3168505">Elem</span><span class="op" id="3168509">(</span><span class="op" id="3168510">)</span><span class="op" id="3168511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168515">if</span>&nbsp;<span class="ident" id="3168518">err</span>&nbsp;<span class="op" id="3168522">!=</span>&nbsp;<span class="ident" id="3168525">nil</span>&nbsp;<span class="op" id="3168529">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168534">return</span>&nbsp;<span class="ident" id="3168541">nil</span><span class="op" id="3168544">,</span>&nbsp;<span class="ident" id="3168546">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3168556">//&nbsp;Historical&nbsp;aside:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3168579">//&nbsp;For&nbsp;arrays,&nbsp;maps,&nbsp;and&nbsp;slices,&nbsp;we&nbsp;set&nbsp;the&nbsp;type&nbsp;id&nbsp;after&nbsp;the&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3168652">//&nbsp;are&nbsp;constructed.&nbsp;This&nbsp;is&nbsp;to&nbsp;retain&nbsp;the&nbsp;order&nbsp;of&nbsp;type&nbsp;id&nbsp;allocation&nbsp;after</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3168730">//&nbsp;a&nbsp;fix&nbsp;made&nbsp;to&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;which&nbsp;changed&nbsp;the&nbsp;order&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3168800">//&nbsp;which&nbsp;types&nbsp;are&nbsp;built.&nbsp;&nbsp;Delaying&nbsp;the&nbsp;setting&nbsp;in&nbsp;this&nbsp;way&nbsp;preserves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3168872">//&nbsp;type&nbsp;ids&nbsp;while&nbsp;allowing&nbsp;recursive&nbsp;types&nbsp;to&nbsp;be&nbsp;described.&nbsp;Structs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3168943">//&nbsp;done&nbsp;below,&nbsp;were&nbsp;already&nbsp;handling&nbsp;recursion&nbsp;correctly&nbsp;so&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3169010">//&nbsp;assign&nbsp;the&nbsp;top-level&nbsp;id&nbsp;before&nbsp;those&nbsp;of&nbsp;the&nbsp;field.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169066">at</span><span class="op" id="3169068">.</span><span class="ident" id="3169069">init</span><span class="op" id="3169073">(</span><span class="ident" id="3169074">type0</span><span class="op" id="3169079">,</span>&nbsp;<span class="ident" id="3169081">t</span><span class="op" id="3169082">.</span><span class="ident" id="3169083">Len</span><span class="op" id="3169086">(</span><span class="op" id="3169087">)</span><span class="op" id="3169088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169092">return</span>&nbsp;<span class="ident" id="3169099">at</span><span class="op" id="3169101">,</span>&nbsp;<span class="ident" id="3169103">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169109">case</span>&nbsp;<span class="ident" id="3169114">reflect</span><span class="op" id="3169121">.</span><span class="ident" id="3169122">Map</span><span class="op" id="3169125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169129">mt</span>&nbsp;<span class="op" id="3169132">:=</span>&nbsp;<span class="ident" id="3169135">newMapType</span><span class="op" id="3169145">(</span><span class="ident" id="3169146">name</span><span class="op" id="3169150">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169154">types</span><span class="op" id="3169159">[</span><span class="ident" id="3169160">rt</span><span class="op" id="3169162">]</span>&nbsp;<span class="op" id="3169164">=</span>&nbsp;<span class="ident" id="3169166">mt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169171">type0</span><span class="op" id="3169176">,</span>&nbsp;<span class="ident" id="3169178">err</span>&nbsp;<span class="op" id="3169182">=</span>&nbsp;<span class="ident" id="3169184">getBaseType</span><span class="op" id="3169195">(</span><span class="string" id="3169196">&#34;&#34;</span><span class="op" id="3169198">,</span>&nbsp;<span class="ident" id="3169200">t</span><span class="op" id="3169201">.</span><span class="ident" id="3169202">Key</span><span class="op" id="3169205">(</span><span class="op" id="3169206">)</span><span class="op" id="3169207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169211">if</span>&nbsp;<span class="ident" id="3169214">err</span>&nbsp;<span class="op" id="3169218">!=</span>&nbsp;<span class="ident" id="3169221">nil</span>&nbsp;<span class="op" id="3169225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169230">return</span>&nbsp;<span class="ident" id="3169237">nil</span><span class="op" id="3169240">,</span>&nbsp;<span class="ident" id="3169242">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169248">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169252">type1</span><span class="op" id="3169257">,</span>&nbsp;<span class="ident" id="3169259">err</span>&nbsp;<span class="op" id="3169263">=</span>&nbsp;<span class="ident" id="3169265">getBaseType</span><span class="op" id="3169276">(</span><span class="string" id="3169277">&#34;&#34;</span><span class="op" id="3169279">,</span>&nbsp;<span class="ident" id="3169281">t</span><span class="op" id="3169282">.</span><span class="ident" id="3169283">Elem</span><span class="op" id="3169287">(</span><span class="op" id="3169288">)</span><span class="op" id="3169289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169293">if</span>&nbsp;<span class="ident" id="3169296">err</span>&nbsp;<span class="op" id="3169300">!=</span>&nbsp;<span class="ident" id="3169303">nil</span>&nbsp;<span class="op" id="3169307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169312">return</span>&nbsp;<span class="ident" id="3169319">nil</span><span class="op" id="3169322">,</span>&nbsp;<span class="ident" id="3169324">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169334">mt</span><span class="op" id="3169336">.</span><span class="ident" id="3169337">init</span><span class="op" id="3169341">(</span><span class="ident" id="3169342">type0</span><span class="op" id="3169347">,</span>&nbsp;<span class="ident" id="3169349">type1</span><span class="op" id="3169354">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169358">return</span>&nbsp;<span class="ident" id="3169365">mt</span><span class="op" id="3169367">,</span>&nbsp;<span class="ident" id="3169369">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169375">case</span>&nbsp;<span class="ident" id="3169380">reflect</span><span class="op" id="3169387">.</span><span class="ident" id="3169388">Slice</span><span class="op" id="3169393">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3169397">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169438">if</span>&nbsp;<span class="ident" id="3169441">t</span><span class="op" id="3169442">.</span><span class="ident" id="3169443">Elem</span><span class="op" id="3169447">(</span><span class="op" id="3169448">)</span><span class="op" id="3169449">.</span><span class="ident" id="3169450">Kind</span><span class="op" id="3169454">(</span><span class="op" id="3169455">)</span>&nbsp;<span class="op" id="3169457">==</span>&nbsp;<span class="ident" id="3169460">reflect</span><span class="op" id="3169467">.</span><span class="ident" id="3169468">Uint8</span>&nbsp;<span class="op" id="3169474">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169479">return</span>&nbsp;<span class="ident" id="3169486">tBytes</span><span class="op" id="3169492">.</span><span class="ident" id="3169493">gobType</span><span class="op" id="3169500">(</span><span class="op" id="3169501">)</span><span class="op" id="3169502">,</span>&nbsp;<span class="ident" id="3169504">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169514">st</span>&nbsp;<span class="op" id="3169517">:=</span>&nbsp;<span class="ident" id="3169520">newSliceType</span><span class="op" id="3169532">(</span><span class="ident" id="3169533">name</span><span class="op" id="3169537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169541">types</span><span class="op" id="3169546">[</span><span class="ident" id="3169547">rt</span><span class="op" id="3169549">]</span>&nbsp;<span class="op" id="3169551">=</span>&nbsp;<span class="ident" id="3169553">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169558">type0</span><span class="op" id="3169563">,</span>&nbsp;<span class="ident" id="3169565">err</span>&nbsp;<span class="op" id="3169569">=</span>&nbsp;<span class="ident" id="3169571">getBaseType</span><span class="op" id="3169582">(</span><span class="ident" id="3169583">t</span><span class="op" id="3169584">.</span><span class="ident" id="3169585">Elem</span><span class="op" id="3169589">(</span><span class="op" id="3169590">)</span><span class="op" id="3169591">.</span><span class="ident" id="3169592">Name</span><span class="op" id="3169596">(</span><span class="op" id="3169597">)</span><span class="op" id="3169598">,</span>&nbsp;<span class="ident" id="3169600">t</span><span class="op" id="3169601">.</span><span class="ident" id="3169602">Elem</span><span class="op" id="3169606">(</span><span class="op" id="3169607">)</span><span class="op" id="3169608">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169612">if</span>&nbsp;<span class="ident" id="3169615">err</span>&nbsp;<span class="op" id="3169619">!=</span>&nbsp;<span class="ident" id="3169622">nil</span>&nbsp;<span class="op" id="3169626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169631">return</span>&nbsp;<span class="ident" id="3169638">nil</span><span class="op" id="3169641">,</span>&nbsp;<span class="ident" id="3169643">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169653">st</span><span class="op" id="3169655">.</span><span class="ident" id="3169656">init</span><span class="op" id="3169660">(</span><span class="ident" id="3169661">type0</span><span class="op" id="3169666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169670">return</span>&nbsp;<span class="ident" id="3169677">st</span><span class="op" id="3169679">,</span>&nbsp;<span class="ident" id="3169681">nil</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169687">case</span>&nbsp;<span class="ident" id="3169692">reflect</span><span class="op" id="3169699">.</span><span class="ident" id="3169700">Struct</span><span class="op" id="3169706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169710">st</span>&nbsp;<span class="op" id="3169713">:=</span>&nbsp;<span class="ident" id="3169716">newStructType</span><span class="op" id="3169729">(</span><span class="ident" id="3169730">name</span><span class="op" id="3169734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169738">types</span><span class="op" id="3169743">[</span><span class="ident" id="3169744">rt</span><span class="op" id="3169746">]</span>&nbsp;<span class="op" id="3169748">=</span>&nbsp;<span class="ident" id="3169750">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169755">idToType</span><span class="op" id="3169763">[</span><span class="ident" id="3169764">st</span><span class="op" id="3169766">.</span><span class="ident" id="3169767">id</span><span class="op" id="3169769">(</span><span class="op" id="3169770">)</span><span class="op" id="3169771">]</span>&nbsp;<span class="op" id="3169773">=</span>&nbsp;<span class="ident" id="3169775">st</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169780">for</span>&nbsp;<span class="ident" id="3169784">i</span>&nbsp;<span class="op" id="3169786">:=</span>&nbsp;<span class="num" id="3169789">0</span><span class="op" id="3169790">;</span>&nbsp;<span class="ident" id="3169792">i</span>&nbsp;<span class="op" id="3169794">&lt;</span>&nbsp;<span class="ident" id="3169796">t</span><span class="op" id="3169797">.</span><span class="ident" id="3169798">NumField</span><span class="op" id="3169806">(</span><span class="op" id="3169807">)</span><span class="op" id="3169808">;</span>&nbsp;<span class="ident" id="3169810">i</span><span class="op" id="3169811">++</span>&nbsp;<span class="op" id="3169814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169819">f</span>&nbsp;<span class="op" id="3169821">:=</span>&nbsp;<span class="ident" id="3169824">t</span><span class="op" id="3169825">.</span><span class="ident" id="3169826">Field</span><span class="op" id="3169831">(</span><span class="ident" id="3169832">i</span><span class="op" id="3169833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169838">if</span>&nbsp;<span class="op" id="3169841">!</span><span class="ident" id="3169842">isSent</span><span class="op" id="3169848">(</span><span class="op" id="3169849">&amp;</span><span class="ident" id="3169850">f</span><span class="op" id="3169851">)</span>&nbsp;<span class="op" id="3169853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169859">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169871">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169876">typ</span>&nbsp;<span class="op" id="3169880">:=</span>&nbsp;<span class="ident" id="3169883">userType</span><span class="op" id="3169891">(</span><span class="ident" id="3169892">f</span><span class="op" id="3169893">.</span><span class="ident" id="3169894">Type</span><span class="op" id="3169898">)</span><span class="op" id="3169899">.</span><span class="ident" id="3169900">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169908">tname</span>&nbsp;<span class="op" id="3169914">:=</span>&nbsp;<span class="ident" id="3169917">typ</span><span class="op" id="3169920">.</span><span class="ident" id="3169921">Name</span><span class="op" id="3169925">(</span><span class="op" id="3169926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169931">if</span>&nbsp;<span class="ident" id="3169934">tname</span>&nbsp;<span class="op" id="3169940">==</span>&nbsp;<span class="string" id="3169943">&#34;&#34;</span>&nbsp;<span class="op" id="3169946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169952">t</span>&nbsp;<span class="op" id="3169954">:=</span>&nbsp;<span class="ident" id="3169957">userType</span><span class="op" id="3169965">(</span><span class="ident" id="3169966">f</span><span class="op" id="3169967">.</span><span class="ident" id="3169968">Type</span><span class="op" id="3169972">)</span><span class="op" id="3169973">.</span><span class="ident" id="3169974">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169983">tname</span>&nbsp;<span class="op" id="3169989">=</span>&nbsp;<span class="ident" id="3169991">t</span><span class="op" id="3169992">.</span><span class="ident" id="3169993">String</span><span class="op" id="3169999">(</span><span class="op" id="3170000">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170010">gt</span><span class="op" id="3170012">,</span>&nbsp;<span class="ident" id="3170014">err</span>&nbsp;<span class="op" id="3170018">:=</span>&nbsp;<span class="ident" id="3170021">getBaseType</span><span class="op" id="3170032">(</span><span class="ident" id="3170033">tname</span><span class="op" id="3170038">,</span>&nbsp;<span class="ident" id="3170040">f</span><span class="op" id="3170041">.</span><span class="ident" id="3170042">Type</span><span class="op" id="3170046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170051">if</span>&nbsp;<span class="ident" id="3170054">err</span>&nbsp;<span class="op" id="3170058">!=</span>&nbsp;<span class="ident" id="3170061">nil</span>&nbsp;<span class="op" id="3170065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170071">return</span>&nbsp;<span class="ident" id="3170078">nil</span><span class="op" id="3170081">,</span>&nbsp;<span class="ident" id="3170083">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170090">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3170095">//&nbsp;Some&nbsp;mutually&nbsp;recursive&nbsp;types&nbsp;can&nbsp;cause&nbsp;us&nbsp;to&nbsp;be&nbsp;here&nbsp;while</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3170161">//&nbsp;still&nbsp;defining&nbsp;the&nbsp;element.&nbsp;Fix&nbsp;the&nbsp;element&nbsp;type&nbsp;id&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3170225">//&nbsp;We&nbsp;could&nbsp;do&nbsp;this&nbsp;more&nbsp;neatly&nbsp;by&nbsp;setting&nbsp;the&nbsp;id&nbsp;at&nbsp;the&nbsp;start&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3170294">//&nbsp;building&nbsp;every&nbsp;type,&nbsp;but&nbsp;that&nbsp;would&nbsp;break&nbsp;binary&nbsp;compatibility.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170364">if</span>&nbsp;<span class="ident" id="3170367">gt</span><span class="op" id="3170369">.</span><span class="ident" id="3170370">id</span><span class="op" id="3170372">(</span><span class="op" id="3170373">)</span>&nbsp;<span class="op" id="3170375">==</span>&nbsp;<span class="num" id="3170378">0</span>&nbsp;<span class="op" id="3170380">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170386">setTypeId</span><span class="op" id="3170395">(</span><span class="ident" id="3170396">gt</span><span class="op" id="3170398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170408">st</span><span class="op" id="3170410">.</span><span class="ident" id="3170411">Field</span>&nbsp;<span class="op" id="3170417">=</span>&nbsp;<span class="builtinfunc" id="3170419">append</span><span class="op" id="3170425">(</span><span class="ident" id="3170426">st</span><span class="op" id="3170428">.</span><span class="ident" id="3170429">Field</span><span class="op" id="3170434">,</span>&nbsp;<span class="op" id="3170436">&amp;</span><span class="ident" id="3170437">fieldType</span><span class="op" id="3170446">{</span><span class="ident" id="3170447">f</span><span class="op" id="3170448">.</span><span class="ident" id="3170449">Name</span><span class="op" id="3170453">,</span>&nbsp;<span class="ident" id="3170455">gt</span><span class="op" id="3170457">.</span><span class="ident" id="3170458">id</span><span class="op" id="3170460">(</span><span class="op" id="3170461">)</span><span class="op" id="3170462">}</span><span class="op" id="3170463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170471">return</span>&nbsp;<span class="ident" id="3170478">st</span><span class="op" id="3170480">,</span>&nbsp;<span class="ident" id="3170482">nil</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170488">default</span><span class="op" id="3170495">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170499">return</span>&nbsp;<span class="ident" id="3170506">nil</span><span class="op" id="3170509">,</span>&nbsp;<span class="ident" id="3170511">errors</span><span class="op" id="3170517">.</span><span class="ident" id="3170518">New</span><span class="op" id="3170521">(</span><span class="string" id="3170522">&#34;gob&nbsp;NewTypeObject&nbsp;can&#39;t&nbsp;handle&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="3170562">+</span>&nbsp;<span class="ident" id="3170564">rt</span><span class="op" id="3170566">.</span><span class="ident" id="3170567">String</span><span class="op" id="3170573">(</span><span class="op" id="3170574">)</span><span class="op" id="3170575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170578">}</span><br>
<span class="lineno"></span><span class="op" id="3170580">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="3170583">//&nbsp;isExported&nbsp;reports&nbsp;whether&nbsp;this&nbsp;is&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3170654">func</span>&nbsp;<span class="ident" id="3170659">isExported</span><span class="op" id="3170669">(</span><span class="ident" id="3170670">name</span>&nbsp;<span class="builtintype" id="3170675">string</span><span class="op" id="3170681">)</span>&nbsp;<span class="builtintype" id="3170683">bool</span>&nbsp;<span class="op" id="3170688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3170691">rune</span><span class="op" id="3170695">,</span>&nbsp;<span class="ident" id="3170697">_</span>&nbsp;<span class="op" id="3170699">:=</span>&nbsp;<span class="ident" id="3170702">utf8</span><span class="op" id="3170706">.</span><span class="ident" id="3170707">DecodeRuneInString</span><span class="op" id="3170725">(</span><span class="ident" id="3170726">name</span><span class="op" id="3170730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170733">return</span>&nbsp;<span class="ident" id="3170740">unicode</span><span class="op" id="3170747">.</span><span class="ident" id="3170748">IsUpper</span><span class="op" id="3170755">(</span><span class="builtintype" id="3170756">rune</span><span class="op" id="3170760">)</span><br>
<span class="lineno">570</span><span class="op" id="3170762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3170765">//&nbsp;isSent&nbsp;reports&nbsp;whether&nbsp;this&nbsp;struct&nbsp;field&nbsp;is&nbsp;to&nbsp;be&nbsp;transmitted.</span><br>
<span class="lineno"></span><span class="comment" id="3170831">//&nbsp;It&nbsp;will&nbsp;be&nbsp;transmitted&nbsp;only&nbsp;if&nbsp;it&nbsp;is&nbsp;exported&nbsp;and&nbsp;not&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="3170909">//&nbsp;or&nbsp;pointer&nbsp;to&nbsp;chan&nbsp;or&nbsp;func.</span><br>
<span class="lineno">575</span><span class="keyword" id="3170940">func</span>&nbsp;<span class="ident" id="3170945">isSent</span><span class="op" id="3170951">(</span><span class="ident" id="3170952">field</span>&nbsp;<span class="op" id="3170958">*</span><span class="ident" id="3170959">reflect</span><span class="op" id="3170966">.</span><span class="ident" id="3170967">StructField</span><span class="op" id="3170978">)</span>&nbsp;<span class="builtintype" id="3170980">bool</span>&nbsp;<span class="op" id="3170985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170988">if</span>&nbsp;<span class="op" id="3170991">!</span><span class="ident" id="3170992">isExported</span><span class="op" id="3171002">(</span><span class="ident" id="3171003">field</span><span class="op" id="3171008">.</span><span class="ident" id="3171009">Name</span><span class="op" id="3171013">)</span>&nbsp;<span class="op" id="3171015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171019">return</span>&nbsp;<span class="builtintype" id="3171026">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3171036">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;or&nbsp;pointer&nbsp;thereto,&nbsp;don&#39;t&nbsp;send&nbsp;it.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3171106">//&nbsp;That&nbsp;is,&nbsp;treat&nbsp;it&nbsp;like&nbsp;an&nbsp;unexported&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171154">typ</span>&nbsp;<span class="op" id="3171158">:=</span>&nbsp;<span class="ident" id="3171161">field</span><span class="op" id="3171166">.</span><span class="ident" id="3171167">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171173">for</span>&nbsp;<span class="ident" id="3171177">typ</span><span class="op" id="3171180">.</span><span class="ident" id="3171181">Kind</span><span class="op" id="3171185">(</span><span class="op" id="3171186">)</span>&nbsp;<span class="op" id="3171188">==</span>&nbsp;<span class="ident" id="3171191">reflect</span><span class="op" id="3171198">.</span><span class="ident" id="3171199">Ptr</span>&nbsp;<span class="op" id="3171203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171207">typ</span>&nbsp;<span class="op" id="3171211">=</span>&nbsp;<span class="ident" id="3171213">typ</span><span class="op" id="3171216">.</span><span class="ident" id="3171217">Elem</span><span class="op" id="3171221">(</span><span class="op" id="3171222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171225">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171228">if</span>&nbsp;<span class="ident" id="3171231">typ</span><span class="op" id="3171234">.</span><span class="ident" id="3171235">Kind</span><span class="op" id="3171239">(</span><span class="op" id="3171240">)</span>&nbsp;<span class="op" id="3171242">==</span>&nbsp;<span class="ident" id="3171245">reflect</span><span class="op" id="3171252">.</span><span class="ident" id="3171253">Chan</span>&nbsp;<span class="op" id="3171258">||</span>&nbsp;<span class="ident" id="3171261">typ</span><span class="op" id="3171264">.</span><span class="ident" id="3171265">Kind</span><span class="op" id="3171269">(</span><span class="op" id="3171270">)</span>&nbsp;<span class="op" id="3171272">==</span>&nbsp;<span class="ident" id="3171275">reflect</span><span class="op" id="3171282">.</span><span class="ident" id="3171283">Func</span>&nbsp;<span class="op" id="3171288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171292">return</span>&nbsp;<span class="builtintype" id="3171299">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171309">return</span>&nbsp;<span class="builtintype" id="3171316">true</span><br>
<span class="lineno"></span><span class="op" id="3171321">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="3171324">//&nbsp;getBaseType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type&#39;s&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="3171407">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="3171433">func</span>&nbsp;<span class="ident" id="3171438">getBaseType</span><span class="op" id="3171449">(</span><span class="ident" id="3171450">name</span>&nbsp;<span class="builtintype" id="3171455">string</span><span class="op" id="3171461">,</span>&nbsp;<span class="ident" id="3171463">rt</span>&nbsp;<span class="ident" id="3171466">reflect</span><span class="op" id="3171473">.</span><span class="ident" id="3171474">Type</span><span class="op" id="3171478">)</span>&nbsp;<span class="op" id="3171480">(</span><span class="ident" id="3171481">gobType</span><span class="op" id="3171488">,</span>&nbsp;<span class="builtintype" id="3171490">error</span><span class="op" id="3171495">)</span>&nbsp;<span class="op" id="3171497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171500">ut</span>&nbsp;<span class="op" id="3171503">:=</span>&nbsp;<span class="ident" id="3171506">userType</span><span class="op" id="3171514">(</span><span class="ident" id="3171515">rt</span><span class="op" id="3171517">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171520">return</span>&nbsp;<span class="ident" id="3171527">getType</span><span class="op" id="3171534">(</span><span class="ident" id="3171535">name</span><span class="op" id="3171539">,</span>&nbsp;<span class="ident" id="3171541">ut</span><span class="op" id="3171543">,</span>&nbsp;<span class="ident" id="3171545">ut</span><span class="op" id="3171547">.</span><span class="ident" id="3171548">base</span><span class="op" id="3171552">)</span><br>
<span class="lineno"></span><span class="op" id="3171554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3171557">//&nbsp;getType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type.</span><br>
<span class="lineno"></span><span class="comment" id="3171624">//&nbsp;Should&nbsp;be&nbsp;called&nbsp;only&nbsp;when&nbsp;handling&nbsp;GobEncoders/Decoders,</span><br>
<span class="lineno">600</span><span class="comment" id="3171685">//&nbsp;which&nbsp;may&nbsp;be&nbsp;pointers.&nbsp;&nbsp;All&nbsp;other&nbsp;types&nbsp;are&nbsp;handled&nbsp;through&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3171752">//&nbsp;base&nbsp;type,&nbsp;never&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="3171783">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="3171809">func</span>&nbsp;<span class="ident" id="3171814">getType</span><span class="op" id="3171821">(</span><span class="ident" id="3171822">name</span>&nbsp;<span class="builtintype" id="3171827">string</span><span class="op" id="3171833">,</span>&nbsp;<span class="ident" id="3171835">ut</span>&nbsp;<span class="op" id="3171838">*</span><span class="ident" id="3171839">userTypeInfo</span><span class="op" id="3171851">,</span>&nbsp;<span class="ident" id="3171853">rt</span>&nbsp;<span class="ident" id="3171856">reflect</span><span class="op" id="3171863">.</span><span class="ident" id="3171864">Type</span><span class="op" id="3171868">)</span>&nbsp;<span class="op" id="3171870">(</span><span class="ident" id="3171871">gobType</span><span class="op" id="3171878">,</span>&nbsp;<span class="builtintype" id="3171880">error</span><span class="op" id="3171885">)</span>&nbsp;<span class="op" id="3171887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171890">typ</span><span class="op" id="3171893">,</span>&nbsp;<span class="ident" id="3171895">present</span>&nbsp;<span class="op" id="3171903">:=</span>&nbsp;<span class="ident" id="3171906">types</span><span class="op" id="3171911">[</span><span class="ident" id="3171912">rt</span><span class="op" id="3171914">]</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171917">if</span>&nbsp;<span class="ident" id="3171920">present</span>&nbsp;<span class="op" id="3171928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171932">return</span>&nbsp;<span class="ident" id="3171939">typ</span><span class="op" id="3171942">,</span>&nbsp;<span class="ident" id="3171944">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171952">typ</span><span class="op" id="3171955">,</span>&nbsp;<span class="ident" id="3171957">err</span>&nbsp;<span class="op" id="3171961">:=</span>&nbsp;<span class="ident" id="3171964">newTypeObject</span><span class="op" id="3171977">(</span><span class="ident" id="3171978">name</span><span class="op" id="3171982">,</span>&nbsp;<span class="ident" id="3171984">ut</span><span class="op" id="3171986">,</span>&nbsp;<span class="ident" id="3171988">rt</span><span class="op" id="3171990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171993">if</span>&nbsp;<span class="ident" id="3171996">err</span>&nbsp;<span class="op" id="3172000">==</span>&nbsp;<span class="ident" id="3172003">nil</span>&nbsp;<span class="op" id="3172007">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172011">types</span><span class="op" id="3172016">[</span><span class="ident" id="3172017">rt</span><span class="op" id="3172019">]</span>&nbsp;<span class="op" id="3172021">=</span>&nbsp;<span class="ident" id="3172023">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172031">return</span>&nbsp;<span class="ident" id="3172038">typ</span><span class="op" id="3172041">,</span>&nbsp;<span class="ident" id="3172043">err</span><br>
<span class="lineno"></span><span class="op" id="3172047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="3172050">func</span>&nbsp;<span class="ident" id="3172055">checkId</span><span class="op" id="3172062">(</span><span class="ident" id="3172063">want</span><span class="op" id="3172067">,</span>&nbsp;<span class="ident" id="3172069">got</span>&nbsp;<span class="ident" id="3172073">typeId</span><span class="op" id="3172079">)</span>&nbsp;<span class="op" id="3172081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172084">if</span>&nbsp;<span class="ident" id="3172087">want</span>&nbsp;<span class="op" id="3172092">!=</span>&nbsp;<span class="ident" id="3172095">got</span>&nbsp;<span class="op" id="3172099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172103">fmt</span><span class="op" id="3172106">.</span><span class="ident" id="3172107">Fprintf</span><span class="op" id="3172114">(</span><span class="ident" id="3172115">os</span><span class="op" id="3172117">.</span><span class="ident" id="3172118">Stderr</span><span class="op" id="3172124">,</span>&nbsp;<span class="string" id="3172126">&#34;checkId:&nbsp;%d&nbsp;should&nbsp;be&nbsp;%d\n&#34;</span><span class="op" id="3172154">,</span>&nbsp;<span class="builtintype" id="3172156">int</span><span class="op" id="3172159">(</span><span class="ident" id="3172160">got</span><span class="op" id="3172163">)</span><span class="op" id="3172164">,</span>&nbsp;<span class="builtintype" id="3172166">int</span><span class="op" id="3172169">(</span><span class="ident" id="3172170">want</span><span class="op" id="3172174">)</span><span class="op" id="3172175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3172179">panic</span><span class="op" id="3172184">(</span><span class="string" id="3172185">&#34;bootstrap&nbsp;type&nbsp;wrong&nbsp;id:&nbsp;&#34;</span>&nbsp;<span class="op" id="3172213">+</span>&nbsp;<span class="ident" id="3172215">got</span><span class="op" id="3172218">.</span><span class="ident" id="3172219">name</span><span class="op" id="3172223">(</span><span class="op" id="3172224">)</span>&nbsp;<span class="op" id="3172226">+</span>&nbsp;<span class="string" id="3172228">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3172232">+</span>&nbsp;<span class="ident" id="3172234">got</span><span class="op" id="3172237">.</span><span class="builtintype" id="3172238">string</span><span class="op" id="3172244">(</span><span class="op" id="3172245">)</span>&nbsp;<span class="op" id="3172247">+</span>&nbsp;<span class="string" id="3172249">&#34;&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="3172257">+</span>&nbsp;<span class="ident" id="3172259">want</span><span class="op" id="3172263">.</span><span class="builtintype" id="3172264">string</span><span class="op" id="3172270">(</span><span class="op" id="3172271">)</span><span class="op" id="3172272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172275">}</span><br>
<span class="lineno">620</span><span class="op" id="3172277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3172280">//&nbsp;used&nbsp;for&nbsp;building&nbsp;the&nbsp;basic&nbsp;types;&nbsp;called&nbsp;only&nbsp;from&nbsp;init().&nbsp;&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="3172357">//&nbsp;interface&nbsp;always&nbsp;refers&nbsp;to&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="keyword" id="3172398">func</span>&nbsp;<span class="ident" id="3172403">bootstrapType</span><span class="op" id="3172416">(</span><span class="ident" id="3172417">name</span>&nbsp;<span class="builtintype" id="3172422">string</span><span class="op" id="3172428">,</span>&nbsp;<span class="ident" id="3172430">e</span>&nbsp;<span class="keyword" id="3172432">interface</span><span class="op" id="3172441">{</span><span class="op" id="3172442">}</span><span class="op" id="3172443">,</span>&nbsp;<span class="ident" id="3172445">expect</span>&nbsp;<span class="ident" id="3172452">typeId</span><span class="op" id="3172458">)</span>&nbsp;<span class="ident" id="3172460">typeId</span>&nbsp;<span class="op" id="3172467">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172470">rt</span>&nbsp;<span class="op" id="3172473">:=</span>&nbsp;<span class="ident" id="3172476">reflect</span><span class="op" id="3172483">.</span><span class="ident" id="3172484">TypeOf</span><span class="op" id="3172490">(</span><span class="ident" id="3172491">e</span><span class="op" id="3172492">)</span><span class="op" id="3172493">.</span><span class="ident" id="3172494">Elem</span><span class="op" id="3172498">(</span><span class="op" id="3172499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172502">_</span><span class="op" id="3172503">,</span>&nbsp;<span class="ident" id="3172505">present</span>&nbsp;<span class="op" id="3172513">:=</span>&nbsp;<span class="ident" id="3172516">types</span><span class="op" id="3172521">[</span><span class="ident" id="3172522">rt</span><span class="op" id="3172524">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172527">if</span>&nbsp;<span class="ident" id="3172530">present</span>&nbsp;<span class="op" id="3172538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3172542">panic</span><span class="op" id="3172547">(</span><span class="string" id="3172548">&#34;bootstrap&nbsp;type&nbsp;already&nbsp;present:&nbsp;&#34;</span>&nbsp;<span class="op" id="3172583">+</span>&nbsp;<span class="ident" id="3172585">name</span>&nbsp;<span class="op" id="3172590">+</span>&nbsp;<span class="string" id="3172592">&#34;,&nbsp;&#34;</span>&nbsp;<span class="op" id="3172597">+</span>&nbsp;<span class="ident" id="3172599">rt</span><span class="op" id="3172601">.</span><span class="ident" id="3172602">String</span><span class="op" id="3172608">(</span><span class="op" id="3172609">)</span><span class="op" id="3172610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172613">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172616">typ</span>&nbsp;<span class="op" id="3172620">:=</span>&nbsp;<span class="op" id="3172623">&amp;</span><span class="ident" id="3172624">CommonType</span><span class="op" id="3172634">{</span><span class="ident" id="3172635">Name</span><span class="op" id="3172639">:</span>&nbsp;<span class="ident" id="3172641">name</span><span class="op" id="3172645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172648">types</span><span class="op" id="3172653">[</span><span class="ident" id="3172654">rt</span><span class="op" id="3172656">]</span>&nbsp;<span class="op" id="3172658">=</span>&nbsp;<span class="ident" id="3172660">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172665">setTypeId</span><span class="op" id="3172674">(</span><span class="ident" id="3172675">typ</span><span class="op" id="3172678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172681">checkId</span><span class="op" id="3172688">(</span><span class="ident" id="3172689">expect</span><span class="op" id="3172695">,</span>&nbsp;<span class="ident" id="3172697">nextId</span><span class="op" id="3172703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172706">userType</span><span class="op" id="3172714">(</span><span class="ident" id="3172715">rt</span><span class="op" id="3172717">)</span>&nbsp;<span class="comment" id="3172719">//&nbsp;might&nbsp;as&nbsp;well&nbsp;cache&nbsp;it&nbsp;now</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172750">return</span>&nbsp;<span class="ident" id="3172757">nextId</span><br>
<span class="lineno"></span><span class="op" id="3172764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3172767">//&nbsp;Representation&nbsp;of&nbsp;the&nbsp;information&nbsp;we&nbsp;send&nbsp;and&nbsp;receive&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="3172841">//&nbsp;Each&nbsp;value&nbsp;we&nbsp;send&nbsp;is&nbsp;preceded&nbsp;by&nbsp;its&nbsp;type&nbsp;definition:&nbsp;an&nbsp;encoded&nbsp;int.</span><br>
<span class="lineno">640</span><span class="comment" id="3172915">//&nbsp;However,&nbsp;the&nbsp;very&nbsp;first&nbsp;time&nbsp;we&nbsp;send&nbsp;the&nbsp;value,&nbsp;we&nbsp;first&nbsp;send&nbsp;the&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="3172989">//&nbsp;(-id,&nbsp;wireType).</span><br>
<span class="lineno"></span><span class="comment" id="3173009">//&nbsp;For&nbsp;bootstrapping&nbsp;purposes,&nbsp;we&nbsp;assume&nbsp;that&nbsp;the&nbsp;recipient&nbsp;knows&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="3173079">//&nbsp;to&nbsp;decode&nbsp;a&nbsp;wireType;&nbsp;it&nbsp;is&nbsp;exactly&nbsp;the&nbsp;wireType&nbsp;struct&nbsp;here,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="3173156">//&nbsp;using&nbsp;the&nbsp;gob&nbsp;rules&nbsp;for&nbsp;sending&nbsp;a&nbsp;structure,&nbsp;except&nbsp;that&nbsp;we&nbsp;assume&nbsp;the</span><br>
<span class="lineno">645</span><span class="comment" id="3173230">//&nbsp;ids&nbsp;for&nbsp;wireType&nbsp;and&nbsp;structType&nbsp;etc.&nbsp;are&nbsp;known.&nbsp;&nbsp;The&nbsp;relevant&nbsp;pieces</span><br>
<span class="lineno"></span><span class="comment" id="3173302">//&nbsp;are&nbsp;built&nbsp;in&nbsp;encode.go&#39;s&nbsp;init()&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3173347">//&nbsp;To&nbsp;maintain&nbsp;binary&nbsp;compatibility,&nbsp;if&nbsp;you&nbsp;extend&nbsp;this&nbsp;type,&nbsp;always&nbsp;put</span><br>
<span class="lineno"></span><span class="comment" id="3173420">//&nbsp;the&nbsp;new&nbsp;fields&nbsp;last.</span><br>
<span class="lineno"></span><span class="keyword" id="3173444">type</span>&nbsp;<span class="ident" id="3173449">wireType</span>&nbsp;<span class="keyword" id="3173458">struct</span>&nbsp;<span class="op" id="3173465">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173468">ArrayT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3173485">*</span><span class="ident" id="3173486">arrayType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173497">SliceT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3173514">*</span><span class="ident" id="3173515">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173526">StructT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3173543">*</span><span class="ident" id="3173544">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173556">MapT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3173573">*</span><span class="ident" id="3173574">mapType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173583">GobEncoderT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3173600">*</span><span class="ident" id="3173601">gobEncoderType</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173617">BinaryMarshalerT</span>&nbsp;<span class="op" id="3173634">*</span><span class="ident" id="3173635">gobEncoderType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3173651">TextMarshalerT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3173668">*</span><span class="ident" id="3173669">gobEncoderType</span><br>
<span class="lineno"></span><span class="op" id="3173684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3173687">func</span>&nbsp;<span class="op" id="3173692">(</span><span class="ident" id="3173693">w</span>&nbsp;<span class="op" id="3173695">*</span><span class="ident" id="3173696">wireType</span><span class="op" id="3173704">)</span>&nbsp;<span class="builtintype" id="3173706">string</span><span class="op" id="3173712">(</span><span class="op" id="3173713">)</span>&nbsp;<span class="builtintype" id="3173715">string</span>&nbsp;<span class="op" id="3173722">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173725">const</span>&nbsp;<span class="ident" id="3173731">unknown</span>&nbsp;<span class="op" id="3173739">=</span>&nbsp;<span class="string" id="3173741">&#34;unknown&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173757">if</span>&nbsp;<span class="ident" id="3173760">w</span>&nbsp;<span class="op" id="3173762">==</span>&nbsp;<span class="ident" id="3173765">nil</span>&nbsp;<span class="op" id="3173769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173773">return</span>&nbsp;<span class="ident" id="3173780">unknown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3173789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173792">switch</span>&nbsp;<span class="op" id="3173799">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173802">case</span>&nbsp;<span class="ident" id="3173807">w</span><span class="op" id="3173808">.</span><span class="ident" id="3173809">ArrayT</span>&nbsp;<span class="op" id="3173816">!=</span>&nbsp;<span class="ident" id="3173819">nil</span><span class="op" id="3173822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173826">return</span>&nbsp;<span class="ident" id="3173833">w</span><span class="op" id="3173834">.</span><span class="ident" id="3173835">ArrayT</span><span class="op" id="3173841">.</span><span class="ident" id="3173842">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173848">case</span>&nbsp;<span class="ident" id="3173853">w</span><span class="op" id="3173854">.</span><span class="ident" id="3173855">SliceT</span>&nbsp;<span class="op" id="3173862">!=</span>&nbsp;<span class="ident" id="3173865">nil</span><span class="op" id="3173868">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173872">return</span>&nbsp;<span class="ident" id="3173879">w</span><span class="op" id="3173880">.</span><span class="ident" id="3173881">SliceT</span><span class="op" id="3173887">.</span><span class="ident" id="3173888">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173894">case</span>&nbsp;<span class="ident" id="3173899">w</span><span class="op" id="3173900">.</span><span class="ident" id="3173901">StructT</span>&nbsp;<span class="op" id="3173909">!=</span>&nbsp;<span class="ident" id="3173912">nil</span><span class="op" id="3173915">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173919">return</span>&nbsp;<span class="ident" id="3173926">w</span><span class="op" id="3173927">.</span><span class="ident" id="3173928">StructT</span><span class="op" id="3173935">.</span><span class="ident" id="3173936">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173942">case</span>&nbsp;<span class="ident" id="3173947">w</span><span class="op" id="3173948">.</span><span class="ident" id="3173949">MapT</span>&nbsp;<span class="op" id="3173954">!=</span>&nbsp;<span class="ident" id="3173957">nil</span><span class="op" id="3173960">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173964">return</span>&nbsp;<span class="ident" id="3173971">w</span><span class="op" id="3173972">.</span><span class="ident" id="3173973">MapT</span><span class="op" id="3173977">.</span><span class="ident" id="3173978">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3173984">case</span>&nbsp;<span class="ident" id="3173989">w</span><span class="op" id="3173990">.</span><span class="ident" id="3173991">GobEncoderT</span>&nbsp;<span class="op" id="3174003">!=</span>&nbsp;<span class="ident" id="3174006">nil</span><span class="op" id="3174009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174013">return</span>&nbsp;<span class="ident" id="3174020">w</span><span class="op" id="3174021">.</span><span class="ident" id="3174022">GobEncoderT</span><span class="op" id="3174033">.</span><span class="ident" id="3174034">Name</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174040">case</span>&nbsp;<span class="ident" id="3174045">w</span><span class="op" id="3174046">.</span><span class="ident" id="3174047">BinaryMarshalerT</span>&nbsp;<span class="op" id="3174064">!=</span>&nbsp;<span class="ident" id="3174067">nil</span><span class="op" id="3174070">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174074">return</span>&nbsp;<span class="ident" id="3174081">w</span><span class="op" id="3174082">.</span><span class="ident" id="3174083">BinaryMarshalerT</span><span class="op" id="3174099">.</span><span class="ident" id="3174100">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174106">case</span>&nbsp;<span class="ident" id="3174111">w</span><span class="op" id="3174112">.</span><span class="ident" id="3174113">TextMarshalerT</span>&nbsp;<span class="op" id="3174128">!=</span>&nbsp;<span class="ident" id="3174131">nil</span><span class="op" id="3174134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174138">return</span>&nbsp;<span class="ident" id="3174145">w</span><span class="op" id="3174146">.</span><span class="ident" id="3174147">TextMarshalerT</span><span class="op" id="3174161">.</span><span class="ident" id="3174162">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3174168">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174171">return</span>&nbsp;<span class="ident" id="3174178">unknown</span><br>
<span class="lineno"></span><span class="op" id="3174186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3174189">type</span>&nbsp;<span class="ident" id="3174194">typeInfo</span>&nbsp;<span class="keyword" id="3174203">struct</span>&nbsp;<span class="op" id="3174210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174213">id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3174221">typeId</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174229">encInit</span>&nbsp;<span class="ident" id="3174237">sync</span><span class="op" id="3174241">.</span><span class="ident" id="3174242">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3174250">//&nbsp;protects&nbsp;creation&nbsp;of&nbsp;encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174283">encoder</span>&nbsp;<span class="ident" id="3174291">atomic</span><span class="op" id="3174297">.</span><span class="ident" id="3174298">Value</span>&nbsp;<span class="comment" id="3174304">//&nbsp;*encEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174319">wire</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3174327">*</span><span class="ident" id="3174328">wireType</span><br>
<span class="lineno"></span><span class="op" id="3174337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span><span class="comment" id="3174340">//&nbsp;typeInfoMap&nbsp;is&nbsp;an&nbsp;atomic&nbsp;pointer&nbsp;to&nbsp;map[reflect.Type]*typeInfo.</span><br>
<span class="lineno"></span><span class="comment" id="3174407">//&nbsp;It&#39;s&nbsp;updated&nbsp;copy-on-write.&nbsp;Readers&nbsp;just&nbsp;do&nbsp;an&nbsp;atomic&nbsp;load</span><br>
<span class="lineno"></span><span class="comment" id="3174469">//&nbsp;to&nbsp;get&nbsp;the&nbsp;current&nbsp;version&nbsp;of&nbsp;the&nbsp;map.&nbsp;Writers&nbsp;make&nbsp;a&nbsp;full&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3174539">//&nbsp;the&nbsp;map&nbsp;and&nbsp;atomically&nbsp;update&nbsp;the&nbsp;pointer&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;new&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="3174609">//&nbsp;Under&nbsp;heavy&nbsp;read&nbsp;contention,&nbsp;this&nbsp;is&nbsp;significantly&nbsp;faster&nbsp;than&nbsp;a&nbsp;map</span><br>
<span class="lineno">695</span><span class="comment" id="3174681">//&nbsp;protected&nbsp;by&nbsp;a&nbsp;mutex.</span><br>
<span class="lineno"></span><span class="keyword" id="3174706">var</span>&nbsp;<span class="ident" id="3174710">typeInfoMap</span>&nbsp;<span class="ident" id="3174722">atomic</span><span class="op" id="3174728">.</span><span class="ident" id="3174729">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3174736">func</span>&nbsp;<span class="ident" id="3174741">lookupTypeInfo</span><span class="op" id="3174755">(</span><span class="ident" id="3174756">rt</span>&nbsp;<span class="ident" id="3174759">reflect</span><span class="op" id="3174766">.</span><span class="ident" id="3174767">Type</span><span class="op" id="3174771">)</span>&nbsp;<span class="op" id="3174773">*</span><span class="ident" id="3174774">typeInfo</span>&nbsp;<span class="op" id="3174783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174786">m</span><span class="op" id="3174787">,</span>&nbsp;<span class="ident" id="3174789">_</span>&nbsp;<span class="op" id="3174791">:=</span>&nbsp;<span class="ident" id="3174794">typeInfoMap</span><span class="op" id="3174805">.</span><span class="ident" id="3174806">Load</span><span class="op" id="3174810">(</span><span class="op" id="3174811">)</span><span class="op" id="3174812">.</span><span class="op" id="3174813">(</span><span class="keyword" id="3174814">map</span><span class="op" id="3174817">[</span><span class="ident" id="3174818">reflect</span><span class="op" id="3174825">.</span><span class="ident" id="3174826">Type</span><span class="op" id="3174830">]</span><span class="op" id="3174831">*</span><span class="ident" id="3174832">typeInfo</span><span class="op" id="3174840">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174843">return</span>&nbsp;<span class="ident" id="3174850">m</span><span class="op" id="3174851">[</span><span class="ident" id="3174852">rt</span><span class="op" id="3174854">]</span><br>
<span class="lineno"></span><span class="op" id="3174856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3174859">func</span>&nbsp;<span class="ident" id="3174864">getTypeInfo</span><span class="op" id="3174875">(</span><span class="ident" id="3174876">ut</span>&nbsp;<span class="op" id="3174879">*</span><span class="ident" id="3174880">userTypeInfo</span><span class="op" id="3174892">)</span>&nbsp;<span class="op" id="3174894">(</span><span class="op" id="3174895">*</span><span class="ident" id="3174896">typeInfo</span><span class="op" id="3174904">,</span>&nbsp;<span class="builtintype" id="3174906">error</span><span class="op" id="3174911">)</span>&nbsp;<span class="op" id="3174913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3174916">rt</span>&nbsp;<span class="op" id="3174919">:=</span>&nbsp;<span class="ident" id="3174922">ut</span><span class="op" id="3174924">.</span><span class="ident" id="3174925">base</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3174931">if</span>&nbsp;<span class="ident" id="3174934">ut</span><span class="op" id="3174936">.</span><span class="ident" id="3174937">externalEnc</span>&nbsp;<span class="op" id="3174949">!=</span>&nbsp;<span class="num" id="3174952">0</span>&nbsp;<span class="op" id="3174954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3174958">//&nbsp;We&nbsp;want&nbsp;the&nbsp;user&nbsp;type,&nbsp;not&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175005">rt</span>&nbsp;<span class="op" id="3175008">=</span>&nbsp;<span class="ident" id="3175010">ut</span><span class="op" id="3175012">.</span><span class="ident" id="3175013">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175022">if</span>&nbsp;<span class="ident" id="3175025">info</span>&nbsp;<span class="op" id="3175030">:=</span>&nbsp;<span class="ident" id="3175033">lookupTypeInfo</span><span class="op" id="3175047">(</span><span class="ident" id="3175048">rt</span><span class="op" id="3175050">)</span><span class="op" id="3175051">;</span>&nbsp;<span class="ident" id="3175053">info</span>&nbsp;<span class="op" id="3175058">!=</span>&nbsp;<span class="ident" id="3175061">nil</span>&nbsp;<span class="op" id="3175065">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175069">return</span>&nbsp;<span class="ident" id="3175076">info</span><span class="op" id="3175080">,</span>&nbsp;<span class="ident" id="3175082">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175090">return</span>&nbsp;<span class="ident" id="3175097">buildTypeInfo</span><span class="op" id="3175110">(</span><span class="ident" id="3175111">ut</span><span class="op" id="3175113">,</span>&nbsp;<span class="ident" id="3175115">rt</span><span class="op" id="3175117">)</span><br>
<span class="lineno"></span><span class="op" id="3175119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">715</span><span class="comment" id="3175122">//&nbsp;buildTypeInfo&nbsp;constructs&nbsp;the&nbsp;type&nbsp;information&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="3175184">//&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;type&nbsp;info&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="3175223">func</span>&nbsp;<span class="ident" id="3175228">buildTypeInfo</span><span class="op" id="3175241">(</span><span class="ident" id="3175242">ut</span>&nbsp;<span class="op" id="3175245">*</span><span class="ident" id="3175246">userTypeInfo</span><span class="op" id="3175258">,</span>&nbsp;<span class="ident" id="3175260">rt</span>&nbsp;<span class="ident" id="3175263">reflect</span><span class="op" id="3175270">.</span><span class="ident" id="3175271">Type</span><span class="op" id="3175275">)</span>&nbsp;<span class="op" id="3175277">(</span><span class="op" id="3175278">*</span><span class="ident" id="3175279">typeInfo</span><span class="op" id="3175287">,</span>&nbsp;<span class="builtintype" id="3175289">error</span><span class="op" id="3175294">)</span>&nbsp;<span class="op" id="3175296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175299">typeLock</span><span class="op" id="3175307">.</span><span class="ident" id="3175308">Lock</span><span class="op" id="3175312">(</span><span class="op" id="3175313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175316">defer</span>&nbsp;<span class="ident" id="3175322">typeLock</span><span class="op" id="3175330">.</span><span class="ident" id="3175331">Unlock</span><span class="op" id="3175337">(</span><span class="op" id="3175338">)</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175342">if</span>&nbsp;<span class="ident" id="3175345">info</span>&nbsp;<span class="op" id="3175350">:=</span>&nbsp;<span class="ident" id="3175353">lookupTypeInfo</span><span class="op" id="3175367">(</span><span class="ident" id="3175368">rt</span><span class="op" id="3175370">)</span><span class="op" id="3175371">;</span>&nbsp;<span class="ident" id="3175373">info</span>&nbsp;<span class="op" id="3175378">!=</span>&nbsp;<span class="ident" id="3175381">nil</span>&nbsp;<span class="op" id="3175385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175389">return</span>&nbsp;<span class="ident" id="3175396">info</span><span class="op" id="3175400">,</span>&nbsp;<span class="ident" id="3175402">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175411">gt</span><span class="op" id="3175413">,</span>&nbsp;<span class="ident" id="3175415">err</span>&nbsp;<span class="op" id="3175419">:=</span>&nbsp;<span class="ident" id="3175422">getBaseType</span><span class="op" id="3175433">(</span><span class="ident" id="3175434">rt</span><span class="op" id="3175436">.</span><span class="ident" id="3175437">Name</span><span class="op" id="3175441">(</span><span class="op" id="3175442">)</span><span class="op" id="3175443">,</span>&nbsp;<span class="ident" id="3175445">rt</span><span class="op" id="3175447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175450">if</span>&nbsp;<span class="ident" id="3175453">err</span>&nbsp;<span class="op" id="3175457">!=</span>&nbsp;<span class="ident" id="3175460">nil</span>&nbsp;<span class="op" id="3175464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175468">return</span>&nbsp;<span class="ident" id="3175475">nil</span><span class="op" id="3175478">,</span>&nbsp;<span class="ident" id="3175480">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175488">info</span>&nbsp;<span class="op" id="3175493">:=</span>&nbsp;<span class="op" id="3175496">&amp;</span><span class="ident" id="3175497">typeInfo</span><span class="op" id="3175505">{</span><span class="ident" id="3175506">id</span><span class="op" id="3175508">:</span>&nbsp;<span class="ident" id="3175510">gt</span><span class="op" id="3175512">.</span><span class="ident" id="3175513">id</span><span class="op" id="3175515">(</span><span class="op" id="3175516">)</span><span class="op" id="3175517">}</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175521">if</span>&nbsp;<span class="ident" id="3175524">ut</span><span class="op" id="3175526">.</span><span class="ident" id="3175527">externalEnc</span>&nbsp;<span class="op" id="3175539">!=</span>&nbsp;<span class="num" id="3175542">0</span>&nbsp;<span class="op" id="3175544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175548">userType</span><span class="op" id="3175556">,</span>&nbsp;<span class="ident" id="3175558">err</span>&nbsp;<span class="op" id="3175562">:=</span>&nbsp;<span class="ident" id="3175565">getType</span><span class="op" id="3175572">(</span><span class="ident" id="3175573">rt</span><span class="op" id="3175575">.</span><span class="ident" id="3175576">Name</span><span class="op" id="3175580">(</span><span class="op" id="3175581">)</span><span class="op" id="3175582">,</span>&nbsp;<span class="ident" id="3175584">ut</span><span class="op" id="3175586">,</span>&nbsp;<span class="ident" id="3175588">rt</span><span class="op" id="3175590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175594">if</span>&nbsp;<span class="ident" id="3175597">err</span>&nbsp;<span class="op" id="3175601">!=</span>&nbsp;<span class="ident" id="3175604">nil</span>&nbsp;<span class="op" id="3175608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175613">return</span>&nbsp;<span class="ident" id="3175620">nil</span><span class="op" id="3175623">,</span>&nbsp;<span class="ident" id="3175625">err</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175635">gt</span>&nbsp;<span class="op" id="3175638">:=</span>&nbsp;<span class="ident" id="3175641">userType</span><span class="op" id="3175649">.</span><span class="ident" id="3175650">id</span><span class="op" id="3175652">(</span><span class="op" id="3175653">)</span><span class="op" id="3175654">.</span><span class="ident" id="3175655">gobType</span><span class="op" id="3175662">(</span><span class="op" id="3175663">)</span><span class="op" id="3175664">.</span><span class="op" id="3175665">(</span><span class="op" id="3175666">*</span><span class="ident" id="3175667">gobEncoderType</span><span class="op" id="3175681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175685">switch</span>&nbsp;<span class="ident" id="3175692">ut</span><span class="op" id="3175694">.</span><span class="ident" id="3175695">externalEnc</span>&nbsp;<span class="op" id="3175707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175711">case</span>&nbsp;<span class="ident" id="3175716">xGob</span><span class="op" id="3175720">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175725">info</span><span class="op" id="3175729">.</span><span class="ident" id="3175730">wire</span>&nbsp;<span class="op" id="3175735">=</span>&nbsp;<span class="op" id="3175737">&amp;</span><span class="ident" id="3175738">wireType</span><span class="op" id="3175746">{</span><span class="ident" id="3175747">GobEncoderT</span><span class="op" id="3175758">:</span>&nbsp;<span class="ident" id="3175760">gt</span><span class="op" id="3175762">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175766">case</span>&nbsp;<span class="ident" id="3175771">xBinary</span><span class="op" id="3175778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175783">info</span><span class="op" id="3175787">.</span><span class="ident" id="3175788">wire</span>&nbsp;<span class="op" id="3175793">=</span>&nbsp;<span class="op" id="3175795">&amp;</span><span class="ident" id="3175796">wireType</span><span class="op" id="3175804">{</span><span class="ident" id="3175805">BinaryMarshalerT</span><span class="op" id="3175821">:</span>&nbsp;<span class="ident" id="3175823">gt</span><span class="op" id="3175825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175829">case</span>&nbsp;<span class="ident" id="3175834">xText</span><span class="op" id="3175839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175844">info</span><span class="op" id="3175848">.</span><span class="ident" id="3175849">wire</span>&nbsp;<span class="op" id="3175854">=</span>&nbsp;<span class="op" id="3175856">&amp;</span><span class="ident" id="3175857">wireType</span><span class="op" id="3175865">{</span><span class="ident" id="3175866">TextMarshalerT</span><span class="op" id="3175880">:</span>&nbsp;<span class="ident" id="3175882">gt</span><span class="op" id="3175884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175888">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175892">rt</span>&nbsp;<span class="op" id="3175895">=</span>&nbsp;<span class="ident" id="3175897">ut</span><span class="op" id="3175899">.</span><span class="ident" id="3175900">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3175906">}</span>&nbsp;<span class="keyword" id="3175908">else</span>&nbsp;<span class="op" id="3175913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175917">t</span>&nbsp;<span class="op" id="3175919">:=</span>&nbsp;<span class="ident" id="3175922">info</span><span class="op" id="3175926">.</span><span class="ident" id="3175927">id</span><span class="op" id="3175929">.</span><span class="ident" id="3175930">gobType</span><span class="op" id="3175937">(</span><span class="op" id="3175938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175942">switch</span>&nbsp;<span class="ident" id="3175949">typ</span>&nbsp;<span class="op" id="3175953">:=</span>&nbsp;<span class="ident" id="3175956">rt</span><span class="op" id="3175958">;</span>&nbsp;<span class="ident" id="3175960">typ</span><span class="op" id="3175963">.</span><span class="ident" id="3175964">Kind</span><span class="op" id="3175968">(</span><span class="op" id="3175969">)</span>&nbsp;<span class="op" id="3175971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3175975">case</span>&nbsp;<span class="ident" id="3175980">reflect</span><span class="op" id="3175987">.</span><span class="ident" id="3175988">Array</span><span class="op" id="3175993">:</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3175998">info</span><span class="op" id="3176002">.</span><span class="ident" id="3176003">wire</span>&nbsp;<span class="op" id="3176008">=</span>&nbsp;<span class="op" id="3176010">&amp;</span><span class="ident" id="3176011">wireType</span><span class="op" id="3176019">{</span><span class="ident" id="3176020">ArrayT</span><span class="op" id="3176026">:</span>&nbsp;<span class="ident" id="3176028">t</span><span class="op" id="3176029">.</span><span class="op" id="3176030">(</span><span class="op" id="3176031">*</span><span class="ident" id="3176032">arrayType</span><span class="op" id="3176041">)</span><span class="op" id="3176042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3176046">case</span>&nbsp;<span class="ident" id="3176051">reflect</span><span class="op" id="3176058">.</span><span class="ident" id="3176059">Map</span><span class="op" id="3176062">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3176067">info</span><span class="op" id="3176071">.</span><span class="ident" id="3176072">wire</span>&nbsp;<span class="op" id="3176077">=</span>&nbsp;<span class="op" id="3176079">&amp;</span><span class="ident" id="3176080">wireType</span><span class="op" id="3176088">{</span><span class="ident" id="3176089">MapT</span><span class="op" id="3176093">:</span>&nbsp;<span class="ident" id="3176095">t</span><span class="op" id="3176096">.</span><span class="op" id="3176097">(</span><span class="op" id="3176098">*</span><span class="ident" id="3176099">mapType</span><span class="op" id="3176106">)</span><span class="op" id="3176107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3176111">case</span>&nbsp;<span class="ident" id="3176116">reflect</span><span class="op" id="3176123">.</span><span class="ident" id="3176124">Slice</span><span class="op" id="3176129">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3176134">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;handled&nbsp;separately</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3176195">if</span>&nbsp;<span class="ident" id="3176198">typ</span><span class="op" id="3176201">.</span><span class="ident" id="3176202">Elem</span><span class="op" id="3176206">(</span><span class="op" id="3176207">)</span><span class="op" id="3176208">.</span><span class="ident" id="3176209">Kind</span><span class="op" id="3176213">(</span><span class="op" id="3176214">)</span>&nbsp;<span class="op" id="3176216">!=</span>&nbsp;<span class="ident" id="3176219">reflect</span><span class="op" id="3176226">.</span><span class="ident" id="3176227">Uint8</span>&nbsp;<span class="op" id="3176233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3176239">info</span><span class="op" id="3176243">.</span><span class="ident" id="3176244">wire</span>&nbsp;<span class="op" id="3176249">=</span>&nbsp;<span class="op" id="3176251">&amp;</span><span class="ident" id="3176252">wireType</span><span class="op" id="3176260">{</span><span class="ident" id="3176261">SliceT</span><span class="op" id="3176267">:</span>&nbsp;<span class="ident" id="3176269">t</span><span class="op" id="3176270">.</span><span class="op" id="3176271">(</span><span class="op" id="3176272">*</span><span class="ident" id="3176273">sliceType</span><span class="op" id="3176282">)</span><span class="op" id="3176283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3176288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3176292">case</span>&nbsp;<span class="ident" id="3176297">reflect</span><span class="op" id="3176304">.</span><span class="ident" id="3176305">Struct</span><span class="op" id="3176311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3176316">info</span><span class="op" id="3176320">.</span><span class="ident" id="3176321">wire</span>&nbsp;<span class="op" id="3176326">=</span>&nbsp;<span class="op" id="3176328">&amp;</span><span class="ident" id="3176329">wireType</span><span class="op" id="3176337">{</span><span class="ident" id="3176338">StructT</span><span class="op" id="3176345">:</span>&nbsp;<span class="ident" id="3176347">t</span><span class="op" id="3176348">.</span><span class="op" id="3176349">(</span><span class="op" id="3176350">*</span><span class="ident" id="3176351">structType</span><span class="op" id="3176361">)</span><span class="op" id="3176362">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3176366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3176369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3176373">//&nbsp;Create&nbsp;new&nbsp;map&nbsp;with&nbsp;old&nbsp;contents&nbsp;plus&nbsp;new&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3176426">newm</span>&nbsp;<span class="op" id="3176431">:=</span>&nbsp;<span class="builtinfunc" id="3176434">make</span><span class="op" id="3176438">(</span><span class="keyword" id="3176439">map</span><span class="op" id="3176442">[</span><span class="ident" id="3176443">reflect</span><span class="op" id="3176450">.</span><span class="ident" id="3176451">Type</span><span class="op" id="3176455">]</span><span class="op" id="3176456">*</span><span class="ident" id="3176457">typeInfo</span><span class="op" id="3176465">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3176468">m</span><span class="op" id="3176469">,</span>&nbsp;<span class="ident" id="3176471">_</span>&nbsp;<span class="op" id="3176473">:=</span>&nbsp;<span class="ident" id="3176476">typeInfoMap</span><span class="op" id="3176487">.</span><span class="ident" id="3176488">Load</span><span class="op" id="3176492">(</span><span class="op" id="3176493">)</span><span class="op" id="3176494">.</span><span class="op" id="3176495">(</span><span class="keyword" id="3176496">map</span><span class="op" id="3176499">[</span><span class="ident" id="3176500">reflect</span><span class="op" id="3176507">.</span><span class="ident" id="3176508">Type</span><span class="op" id="3176512">]</span><span class="op" id="3176513">*</span><span class="ident" id="3176514">typeInfo</span><span class="op" id="3176522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3176525">for</span>&nbsp;<span class="ident" id="3176529">k</span><span class="op" id="3176530">,</span>&nbsp;<span class="ident" id="3176532">v</span>&nbsp;<span class="op" id="3176534">:=</span>&nbsp;<span class="keyword" id="3176537">range</span>&nbsp;<span class="ident" id="3176543">m</span>&nbsp;<span class="op" id="3176545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3176549">newm</span><span class="op" id="3176553">[</span><span class="ident" id="3176554">k</span><span class="op" id="3176555">]</span>&nbsp;<span class="op" id="3176557">=</span>&nbsp;<span class="ident" id="3176559">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3176562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3176565">newm</span><span class="op" id="3176569">[</span><span class="ident" id="3176570">rt</span><span class="op" id="3176572">]</span>&nbsp;<span class="op" id="3176574">=</span>&nbsp;<span class="ident" id="3176576">info</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3176582">typeInfoMap</span><span class="op" id="3176593">.</span><span class="ident" id="3176594">Store</span><span class="op" id="3176599">(</span><span class="ident" id="3176600">newm</span><span class="op" id="3176604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3176607">return</span>&nbsp;<span class="ident" id="3176614">info</span><span class="op" id="3176618">,</span>&nbsp;<span class="ident" id="3176620">nil</span><br>
<span class="lineno"></span><span class="op" id="3176624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3176627">//&nbsp;Called&nbsp;only&nbsp;when&nbsp;a&nbsp;panic&nbsp;is&nbsp;acceptable&nbsp;and&nbsp;unexpected.</span><br>
<span class="lineno">775</span><span class="keyword" id="3176685">func</span>&nbsp;<span class="ident" id="3176690">mustGetTypeInfo</span><span class="op" id="3176705">(</span><span class="ident" id="3176706">rt</span>&nbsp;<span class="ident" id="3176709">reflect</span><span class="op" id="3176716">.</span><span class="ident" id="3176717">Type</span><span class="op" id="3176721">)</span>&nbsp;<span class="op" id="3176723">*</span><span class="ident" id="3176724">typeInfo</span>&nbsp;<span class="op" id="3176733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3176736">t</span><span class="op" id="3176737">,</span>&nbsp;<span class="ident" id="3176739">err</span>&nbsp;<span class="op" id="3176743">:=</span>&nbsp;<span class="ident" id="3176746">getTypeInfo</span><span class="op" id="3176757">(</span><span class="ident" id="3176758">userType</span><span class="op" id="3176766">(</span><span class="ident" id="3176767">rt</span><span class="op" id="3176769">)</span><span class="op" id="3176770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3176773">if</span>&nbsp;<span class="ident" id="3176776">err</span>&nbsp;<span class="op" id="3176780">!=</span>&nbsp;<span class="ident" id="3176783">nil</span>&nbsp;<span class="op" id="3176787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3176791">panic</span><span class="op" id="3176796">(</span><span class="string" id="3176797">&#34;getTypeInfo:&nbsp;&#34;</span>&nbsp;<span class="op" id="3176813">+</span>&nbsp;<span class="ident" id="3176815">err</span><span class="op" id="3176818">.</span><span class="ident" id="3176819">Error</span><span class="op" id="3176824">(</span><span class="op" id="3176825">)</span><span class="op" id="3176826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3176829">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3176832">return</span>&nbsp;<span class="ident" id="3176839">t</span><br>
<span class="lineno"></span><span class="op" id="3176841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3176844">//&nbsp;GobEncoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="3176913">//&nbsp;representation&nbsp;for&nbsp;encoding&nbsp;values&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder.</span><br>
<span class="lineno">785</span><span class="comment" id="3176985">//&nbsp;A&nbsp;type&nbsp;that&nbsp;implements&nbsp;GobEncoder&nbsp;and&nbsp;GobDecoder&nbsp;has&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="3177050">//&nbsp;control&nbsp;over&nbsp;the&nbsp;representation&nbsp;of&nbsp;its&nbsp;data&nbsp;and&nbsp;may&nbsp;therefore</span><br>
<span class="lineno"></span><span class="comment" id="3177115">//&nbsp;contain&nbsp;things&nbsp;such&nbsp;as&nbsp;private&nbsp;fields,&nbsp;channels,&nbsp;and&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="3177182">//&nbsp;which&nbsp;are&nbsp;not&nbsp;usually&nbsp;transmissible&nbsp;in&nbsp;gob&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="3177237">//</span><br>
<span class="lineno">790</span><span class="comment" id="3177240">//&nbsp;Note:&nbsp;Since&nbsp;gobs&nbsp;can&nbsp;be&nbsp;stored&nbsp;permanently,&nbsp;It&nbsp;is&nbsp;good&nbsp;design</span><br>
<span class="lineno"></span><span class="comment" id="3177305">//&nbsp;to&nbsp;guarantee&nbsp;the&nbsp;encoding&nbsp;used&nbsp;by&nbsp;a&nbsp;GobEncoder&nbsp;is&nbsp;stable&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3177372">//&nbsp;software&nbsp;evolves.&nbsp;&nbsp;For&nbsp;instance,&nbsp;it&nbsp;might&nbsp;make&nbsp;sense&nbsp;for&nbsp;GobEncode</span><br>
<span class="lineno"></span><span class="comment" id="3177442">//&nbsp;to&nbsp;include&nbsp;a&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3177490">type</span>&nbsp;<span class="ident" id="3177495">GobEncoder</span>&nbsp;<span class="keyword" id="3177506">interface</span>&nbsp;<span class="op" id="3177516">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3177519">//&nbsp;GobEncode&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;representing&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3177587">//&nbsp;receiver&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder,&nbsp;usually&nbsp;of&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3177654">//&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3177673">GobEncode</span><span class="op" id="3177682">(</span><span class="op" id="3177683">)</span>&nbsp;<span class="op" id="3177685">(</span><span class="op" id="3177686">[</span><span class="op" id="3177687">]</span><span class="builtintype" id="3177688">byte</span><span class="op" id="3177692">,</span>&nbsp;<span class="builtintype" id="3177694">error</span><span class="op" id="3177699">)</span><br>
<span class="lineno"></span><span class="op" id="3177701">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="3177704">//&nbsp;GobDecoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="3177773">//&nbsp;routine&nbsp;for&nbsp;decoding&nbsp;transmitted&nbsp;values&nbsp;sent&nbsp;by&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span><span class="keyword" id="3177838">type</span>&nbsp;<span class="ident" id="3177843">GobDecoder</span>&nbsp;<span class="keyword" id="3177854">interface</span>&nbsp;<span class="op" id="3177864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3177867">//&nbsp;GobDecode&nbsp;overwrites&nbsp;the&nbsp;receiver,&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer,</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3177931">//&nbsp;with&nbsp;the&nbsp;value&nbsp;represented&nbsp;by&nbsp;the&nbsp;byte&nbsp;slice,&nbsp;which&nbsp;was&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3177999">//&nbsp;by&nbsp;GobEncode,&nbsp;usually&nbsp;for&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178053">GobDecode</span><span class="op" id="3178062">(</span><span class="op" id="3178063">[</span><span class="op" id="3178064">]</span><span class="builtintype" id="3178065">byte</span><span class="op" id="3178069">)</span>&nbsp;<span class="builtintype" id="3178071">error</span><br>
<span class="lineno"></span><span class="op" id="3178077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="3178080">var</span>&nbsp;<span class="op" id="3178084">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178087">registerLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3178106">sync</span><span class="op" id="3178110">.</span><span class="ident" id="3178111">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178120">nameToConcreteType</span>&nbsp;<span class="op" id="3178139">=</span>&nbsp;<span class="builtinfunc" id="3178141">make</span><span class="op" id="3178145">(</span><span class="keyword" id="3178146">map</span><span class="op" id="3178149">[</span><span class="builtintype" id="3178150">string</span><span class="op" id="3178156">]</span><span class="ident" id="3178157">reflect</span><span class="op" id="3178164">.</span><span class="ident" id="3178165">Type</span><span class="op" id="3178169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178172">concreteTypeToName</span>&nbsp;<span class="op" id="3178191">=</span>&nbsp;<span class="builtinfunc" id="3178193">make</span><span class="op" id="3178197">(</span><span class="keyword" id="3178198">map</span><span class="op" id="3178201">[</span><span class="ident" id="3178202">reflect</span><span class="op" id="3178209">.</span><span class="ident" id="3178210">Type</span><span class="op" id="3178214">]</span><span class="builtintype" id="3178215">string</span><span class="op" id="3178221">)</span><br>
<span class="lineno"></span><span class="op" id="3178223">)</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="3178226">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;rather&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3178302">//&nbsp;type&#39;s&nbsp;default.</span><br>
<span class="lineno"></span><span class="keyword" id="3178321">func</span>&nbsp;<span class="ident" id="3178326">RegisterName</span><span class="op" id="3178338">(</span><span class="ident" id="3178339">name</span>&nbsp;<span class="builtintype" id="3178344">string</span><span class="op" id="3178350">,</span>&nbsp;<span class="ident" id="3178352">value</span>&nbsp;<span class="keyword" id="3178358">interface</span><span class="op" id="3178367">{</span><span class="op" id="3178368">}</span><span class="op" id="3178369">)</span>&nbsp;<span class="op" id="3178371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3178374">if</span>&nbsp;<span class="ident" id="3178377">name</span>&nbsp;<span class="op" id="3178382">==</span>&nbsp;<span class="string" id="3178385">&#34;&#34;</span>&nbsp;<span class="op" id="3178388">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3178392">//&nbsp;reserved&nbsp;for&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3178414">panic</span><span class="op" id="3178419">(</span><span class="string" id="3178420">&#34;attempt&nbsp;to&nbsp;register&nbsp;empty&nbsp;name&#34;</span><span class="op" id="3178452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3178455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178458">registerLock</span><span class="op" id="3178470">.</span><span class="ident" id="3178471">Lock</span><span class="op" id="3178475">(</span><span class="op" id="3178476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3178479">defer</span>&nbsp;<span class="ident" id="3178485">registerLock</span><span class="op" id="3178497">.</span><span class="ident" id="3178498">Unlock</span><span class="op" id="3178504">(</span><span class="op" id="3178505">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3178508">ut</span>&nbsp;<span class="op" id="3178511">:=</span>&nbsp;<span class="ident" id="3178514">userType</span><span class="op" id="3178522">(</span><span class="ident" id="3178523">reflect</span><span class="op" id="3178530">.</span><span class="ident" id="3178531">TypeOf</span><span class="op" id="3178537">(</span><span class="ident" id="3178538">value</span><span class="op" id="3178543">)</span><span class="op" id="3178544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3178547">//&nbsp;Check&nbsp;for&nbsp;incompatible&nbsp;duplicates.&nbsp;The&nbsp;name&nbsp;must&nbsp;refer&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3178613">//&nbsp;same&nbsp;user&nbsp;type,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3178649">if</span>&nbsp;<span class="ident" id="3178652">t</span><span class="op" id="3178653">,</span>&nbsp;<span class="ident" id="3178655">ok</span>&nbsp;<span class="op" id="3178658">:=</span>&nbsp;<span class="ident" id="3178661">nameToConcreteType</span><span class="op" id="3178679">[</span><span class="ident" id="3178680">name</span><span class="op" id="3178684">]</span><span class="op" id="3178685">;</span>&nbsp;<span class="ident" id="3178687">ok</span>&nbsp;<span class="op" id="3178690">&amp;&amp;</span>&nbsp;<span class="ident" id="3178693">t</span>&nbsp;<span class="op" id="3178695">!=</span>&nbsp;<span class="ident" id="3178698">ut</span><span class="op" id="3178700">.</span><span class="ident" id="3178701">user</span>&nbsp;<span class="op" id="3178706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3178710">panic</span><span class="op" id="3178715">(</span><span class="ident" id="3178716">fmt</span><span class="op" id="3178719">.</span><span class="ident" id="3178720">Sprintf</span><span class="op" id="3178727">(</span><span class="string" id="3178728">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;types&nbsp;for&nbsp;%q:&nbsp;%s&nbsp;!=&nbsp;%s&#34;</span><span class="op" id="3178779">,</span>&nbsp;<span class="ident" id="3178781">name</span><span class="op" id="3178785">,</span>&nbsp;<span class="ident" id="3178787">t</span><span class="op" id="3178788">,</span>&nbsp;<span class="ident" id="3178790">ut</span><span class="op" id="3178792">.</span><span class="ident" id="3178793">user</span><span class="op" id="3178797">)</span><span class="op" id="3178798">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3178801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3178804">if</span>&nbsp;<span class="ident" id="3178807">n</span><span class="op" id="3178808">,</span>&nbsp;<span class="ident" id="3178810">ok</span>&nbsp;<span class="op" id="3178813">:=</span>&nbsp;<span class="ident" id="3178816">concreteTypeToName</span><span class="op" id="3178834">[</span><span class="ident" id="3178835">ut</span><span class="op" id="3178837">.</span><span class="ident" id="3178838">base</span><span class="op" id="3178842">]</span><span class="op" id="3178843">;</span>&nbsp;<span class="ident" id="3178845">ok</span>&nbsp;<span class="op" id="3178848">&amp;&amp;</span>&nbsp;<span class="ident" id="3178851">n</span>&nbsp;<span class="op" id="3178853">!=</span>&nbsp;<span class="ident" id="3178856">name</span>&nbsp;<span class="op" id="3178861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3178865">panic</span><span class="op" id="3178870">(</span><span class="ident" id="3178871">fmt</span><span class="op" id="3178874">.</span><span class="ident" id="3178875">Sprintf</span><span class="op" id="3178882">(</span><span class="string" id="3178883">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;names&nbsp;for&nbsp;%s:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="3178934">,</span>&nbsp;<span class="ident" id="3178936">ut</span><span class="op" id="3178938">.</span><span class="ident" id="3178939">user</span><span class="op" id="3178943">,</span>&nbsp;<span class="ident" id="3178945">n</span><span class="op" id="3178946">,</span>&nbsp;<span class="ident" id="3178948">name</span><span class="op" id="3178952">)</span><span class="op" id="3178953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3178956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3178959">//&nbsp;Store&nbsp;the&nbsp;name&nbsp;and&nbsp;type&nbsp;provided&nbsp;by&nbsp;the&nbsp;user....</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179012">nameToConcreteType</span><span class="op" id="3179030">[</span><span class="ident" id="3179031">name</span><span class="op" id="3179035">]</span>&nbsp;<span class="op" id="3179037">=</span>&nbsp;<span class="ident" id="3179039">reflect</span><span class="op" id="3179046">.</span><span class="ident" id="3179047">TypeOf</span><span class="op" id="3179053">(</span><span class="ident" id="3179054">value</span><span class="op" id="3179059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3179062">//&nbsp;but&nbsp;the&nbsp;flattened&nbsp;type&nbsp;in&nbsp;the&nbsp;type&nbsp;table,&nbsp;since&nbsp;that&#39;s&nbsp;what&nbsp;decode&nbsp;needs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179140">concreteTypeToName</span><span class="op" id="3179158">[</span><span class="ident" id="3179159">ut</span><span class="op" id="3179161">.</span><span class="ident" id="3179162">base</span><span class="op" id="3179166">]</span>&nbsp;<span class="op" id="3179168">=</span>&nbsp;<span class="ident" id="3179170">name</span><br>
<span class="lineno"></span><span class="op" id="3179175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="3179178">//&nbsp;Register&nbsp;records&nbsp;a&nbsp;type,&nbsp;identified&nbsp;by&nbsp;a&nbsp;value&nbsp;for&nbsp;that&nbsp;type,&nbsp;under&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3179253">//&nbsp;internal&nbsp;type&nbsp;name.&nbsp;&nbsp;That&nbsp;name&nbsp;will&nbsp;identify&nbsp;the&nbsp;concrete&nbsp;type&nbsp;of&nbsp;a&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3179330">//&nbsp;sent&nbsp;or&nbsp;received&nbsp;as&nbsp;an&nbsp;interface&nbsp;variable.&nbsp;&nbsp;Only&nbsp;types&nbsp;that&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3179401">//&nbsp;transferred&nbsp;as&nbsp;implementations&nbsp;of&nbsp;interface&nbsp;values&nbsp;need&nbsp;to&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span><span class="comment" id="3179478">//&nbsp;Expecting&nbsp;to&nbsp;be&nbsp;used&nbsp;only&nbsp;during&nbsp;initialization,&nbsp;it&nbsp;panics&nbsp;if&nbsp;the&nbsp;mapping</span><br>
<span class="lineno">845</span><span class="comment" id="3179555">//&nbsp;between&nbsp;types&nbsp;and&nbsp;names&nbsp;is&nbsp;not&nbsp;a&nbsp;bijection.</span><br>
<span class="lineno"></span><span class="keyword" id="3179602">func</span>&nbsp;<span class="ident" id="3179607">Register</span><span class="op" id="3179615">(</span><span class="ident" id="3179616">value</span>&nbsp;<span class="keyword" id="3179622">interface</span><span class="op" id="3179631">{</span><span class="op" id="3179632">}</span><span class="op" id="3179633">)</span>&nbsp;<span class="op" id="3179635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3179638">//&nbsp;Default&nbsp;to&nbsp;printed&nbsp;representation&nbsp;for&nbsp;unnamed&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179694">rt</span>&nbsp;<span class="op" id="3179697">:=</span>&nbsp;<span class="ident" id="3179700">reflect</span><span class="op" id="3179707">.</span><span class="ident" id="3179708">TypeOf</span><span class="op" id="3179714">(</span><span class="ident" id="3179715">value</span><span class="op" id="3179720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179723">name</span>&nbsp;<span class="op" id="3179728">:=</span>&nbsp;<span class="ident" id="3179731">rt</span><span class="op" id="3179733">.</span><span class="ident" id="3179734">String</span><span class="op" id="3179740">(</span><span class="op" id="3179741">)</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3179745">//&nbsp;But&nbsp;for&nbsp;named&nbsp;types&nbsp;(or&nbsp;pointers&nbsp;to&nbsp;them),&nbsp;qualify&nbsp;with&nbsp;import&nbsp;path&nbsp;(but&nbsp;see&nbsp;inner&nbsp;comment).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3179842">//&nbsp;Dereference&nbsp;one&nbsp;pointer&nbsp;looking&nbsp;for&nbsp;a&nbsp;named&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179896">star</span>&nbsp;<span class="op" id="3179901">:=</span>&nbsp;<span class="string" id="3179904">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179908">if</span>&nbsp;<span class="ident" id="3179911">rt</span><span class="op" id="3179913">.</span><span class="ident" id="3179914">Name</span><span class="op" id="3179918">(</span><span class="op" id="3179919">)</span>&nbsp;<span class="op" id="3179921">==</span>&nbsp;<span class="string" id="3179924">&#34;&#34;</span>&nbsp;<span class="op" id="3179927">{</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3179931">if</span>&nbsp;<span class="ident" id="3179934">pt</span>&nbsp;<span class="op" id="3179937">:=</span>&nbsp;<span class="ident" id="3179940">rt</span><span class="op" id="3179942">;</span>&nbsp;<span class="ident" id="3179944">pt</span><span class="op" id="3179946">.</span><span class="ident" id="3179947">Kind</span><span class="op" id="3179951">(</span><span class="op" id="3179952">)</span>&nbsp;<span class="op" id="3179954">==</span>&nbsp;<span class="ident" id="3179957">reflect</span><span class="op" id="3179964">.</span><span class="ident" id="3179965">Ptr</span>&nbsp;<span class="op" id="3179969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3179974">star</span>&nbsp;<span class="op" id="3179979">=</span>&nbsp;<span class="string" id="3179981">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3179988">//&nbsp;NOTE:&nbsp;The&nbsp;following&nbsp;line&nbsp;should&nbsp;be&nbsp;rt&nbsp;=&nbsp;pt.Elem()&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180057">//&nbsp;what&nbsp;the&nbsp;comment&nbsp;above&nbsp;claims,&nbsp;but&nbsp;fixing&nbsp;it&nbsp;would&nbsp;break&nbsp;compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180134">//&nbsp;with&nbsp;existing&nbsp;gobs.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180160">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180166">//&nbsp;Given&nbsp;package&nbsp;p&nbsp;imported&nbsp;as&nbsp;&#34;full/p&#34;&nbsp;with&nbsp;these&nbsp;definitions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180233">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180253">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;T1&nbsp;struct&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180286">//&nbsp;this&nbsp;table&nbsp;shows&nbsp;the&nbsp;intended&nbsp;and&nbsp;actual&nbsp;strings&nbsp;used&nbsp;by&nbsp;gob&nbsp;to</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180356">//&nbsp;name&nbsp;the&nbsp;types:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180378">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180384">//&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Correct&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actual&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180433">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180439">//&nbsp;T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180484">//&nbsp;*T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p.T1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180525">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3180531">//&nbsp;The&nbsp;missing&nbsp;full&nbsp;path&nbsp;cannot&nbsp;be&nbsp;fixed&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;gob&nbsp;decoders.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180615">rt</span>&nbsp;<span class="op" id="3180618">=</span>&nbsp;<span class="ident" id="3180620">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3180625">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3180628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3180631">if</span>&nbsp;<span class="ident" id="3180634">rt</span><span class="op" id="3180636">.</span><span class="ident" id="3180637">Name</span><span class="op" id="3180641">(</span><span class="op" id="3180642">)</span>&nbsp;<span class="op" id="3180644">!=</span>&nbsp;<span class="string" id="3180647">&#34;&#34;</span>&nbsp;<span class="op" id="3180650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3180654">if</span>&nbsp;<span class="ident" id="3180657">rt</span><span class="op" id="3180659">.</span><span class="ident" id="3180660">PkgPath</span><span class="op" id="3180667">(</span><span class="op" id="3180668">)</span>&nbsp;<span class="op" id="3180670">==</span>&nbsp;<span class="string" id="3180673">&#34;&#34;</span>&nbsp;<span class="op" id="3180676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180681">name</span>&nbsp;<span class="op" id="3180686">=</span>&nbsp;<span class="ident" id="3180688">star</span>&nbsp;<span class="op" id="3180693">+</span>&nbsp;<span class="ident" id="3180695">rt</span><span class="op" id="3180697">.</span><span class="ident" id="3180698">Name</span><span class="op" id="3180702">(</span><span class="op" id="3180703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3180707">}</span>&nbsp;<span class="keyword" id="3180709">else</span>&nbsp;<span class="op" id="3180714">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180719">name</span>&nbsp;<span class="op" id="3180724">=</span>&nbsp;<span class="ident" id="3180726">star</span>&nbsp;<span class="op" id="3180731">+</span>&nbsp;<span class="ident" id="3180733">rt</span><span class="op" id="3180735">.</span><span class="ident" id="3180736">PkgPath</span><span class="op" id="3180743">(</span><span class="op" id="3180744">)</span>&nbsp;<span class="op" id="3180746">+</span>&nbsp;<span class="string" id="3180748">&#34;.&#34;</span>&nbsp;<span class="op" id="3180752">+</span>&nbsp;<span class="ident" id="3180754">rt</span><span class="op" id="3180756">.</span><span class="ident" id="3180757">Name</span><span class="op" id="3180761">(</span><span class="op" id="3180762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3180766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3180769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180773">RegisterName</span><span class="op" id="3180785">(</span><span class="ident" id="3180786">name</span><span class="op" id="3180790">,</span>&nbsp;<span class="ident" id="3180792">value</span><span class="op" id="3180797">)</span><br>
<span class="lineno">885</span><span class="op" id="3180799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3180802">func</span>&nbsp;<span class="ident" id="3180807">registerBasics</span><span class="op" id="3180821">(</span><span class="op" id="3180822">)</span>&nbsp;<span class="op" id="3180824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180827">Register</span><span class="op" id="3180835">(</span><span class="builtintype" id="3180836">int</span><span class="op" id="3180839">(</span><span class="num" id="3180840">0</span><span class="op" id="3180841">)</span><span class="op" id="3180842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180845">Register</span><span class="op" id="3180853">(</span><span class="builtintype" id="3180854">int8</span><span class="op" id="3180858">(</span><span class="num" id="3180859">0</span><span class="op" id="3180860">)</span><span class="op" id="3180861">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180864">Register</span><span class="op" id="3180872">(</span><span class="builtintype" id="3180873">int16</span><span class="op" id="3180878">(</span><span class="num" id="3180879">0</span><span class="op" id="3180880">)</span><span class="op" id="3180881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180884">Register</span><span class="op" id="3180892">(</span><span class="builtintype" id="3180893">int32</span><span class="op" id="3180898">(</span><span class="num" id="3180899">0</span><span class="op" id="3180900">)</span><span class="op" id="3180901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180904">Register</span><span class="op" id="3180912">(</span><span class="ident" id="3180913">int64</span><span class="op" id="3180918">(</span><span class="num" id="3180919">0</span><span class="op" id="3180920">)</span><span class="op" id="3180921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180924">Register</span><span class="op" id="3180932">(</span><span class="builtintype" id="3180933">uint</span><span class="op" id="3180937">(</span><span class="num" id="3180938">0</span><span class="op" id="3180939">)</span><span class="op" id="3180940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180943">Register</span><span class="op" id="3180951">(</span><span class="builtintype" id="3180952">uint8</span><span class="op" id="3180957">(</span><span class="num" id="3180958">0</span><span class="op" id="3180959">)</span><span class="op" id="3180960">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180963">Register</span><span class="op" id="3180971">(</span><span class="builtintype" id="3180972">uint16</span><span class="op" id="3180978">(</span><span class="num" id="3180979">0</span><span class="op" id="3180980">)</span><span class="op" id="3180981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3180984">Register</span><span class="op" id="3180992">(</span><span class="builtintype" id="3180993">uint32</span><span class="op" id="3180999">(</span><span class="num" id="3181000">0</span><span class="op" id="3181001">)</span><span class="op" id="3181002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181005">Register</span><span class="op" id="3181013">(</span><span class="ident" id="3181014">uint64</span><span class="op" id="3181020">(</span><span class="num" id="3181021">0</span><span class="op" id="3181022">)</span><span class="op" id="3181023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181026">Register</span><span class="op" id="3181034">(</span><span class="builtintype" id="3181035">float32</span><span class="op" id="3181042">(</span><span class="num" id="3181043">0</span><span class="op" id="3181044">)</span><span class="op" id="3181045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181048">Register</span><span class="op" id="3181056">(</span><span class="builtintype" id="3181057">float64</span><span class="op" id="3181064">(</span><span class="num" id="3181065">0</span><span class="op" id="3181066">)</span><span class="op" id="3181067">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181070">Register</span><span class="op" id="3181078">(</span><span class="builtintype" id="3181079">complex64</span><span class="op" id="3181088">(</span><span class="num" id="3181089">0i</span><span class="op" id="3181091">)</span><span class="op" id="3181092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181095">Register</span><span class="op" id="3181103">(</span><span class="builtintype" id="3181104">complex128</span><span class="op" id="3181114">(</span><span class="num" id="3181115">0i</span><span class="op" id="3181117">)</span><span class="op" id="3181118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181121">Register</span><span class="op" id="3181129">(</span><span class="builtintype" id="3181130">uintptr</span><span class="op" id="3181137">(</span><span class="num" id="3181138">0</span><span class="op" id="3181139">)</span><span class="op" id="3181140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181143">Register</span><span class="op" id="3181151">(</span><span class="builtintype" id="3181152">false</span><span class="op" id="3181157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181160">Register</span><span class="op" id="3181168">(</span><span class="string" id="3181169">&#34;&#34;</span><span class="op" id="3181171">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181174">Register</span><span class="op" id="3181182">(</span><span class="op" id="3181183">[</span><span class="op" id="3181184">]</span><span class="builtintype" id="3181185">byte</span><span class="op" id="3181189">(</span><span class="ident" id="3181190">nil</span><span class="op" id="3181193">)</span><span class="op" id="3181194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181197">Register</span><span class="op" id="3181205">(</span><span class="op" id="3181206">[</span><span class="op" id="3181207">]</span><span class="builtintype" id="3181208">int</span><span class="op" id="3181211">(</span><span class="ident" id="3181212">nil</span><span class="op" id="3181215">)</span><span class="op" id="3181216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181219">Register</span><span class="op" id="3181227">(</span><span class="op" id="3181228">[</span><span class="op" id="3181229">]</span><span class="builtintype" id="3181230">int8</span><span class="op" id="3181234">(</span><span class="ident" id="3181235">nil</span><span class="op" id="3181238">)</span><span class="op" id="3181239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181242">Register</span><span class="op" id="3181250">(</span><span class="op" id="3181251">[</span><span class="op" id="3181252">]</span><span class="builtintype" id="3181253">int16</span><span class="op" id="3181258">(</span><span class="ident" id="3181259">nil</span><span class="op" id="3181262">)</span><span class="op" id="3181263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181266">Register</span><span class="op" id="3181274">(</span><span class="op" id="3181275">[</span><span class="op" id="3181276">]</span><span class="builtintype" id="3181277">int32</span><span class="op" id="3181282">(</span><span class="ident" id="3181283">nil</span><span class="op" id="3181286">)</span><span class="op" id="3181287">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181290">Register</span><span class="op" id="3181298">(</span><span class="op" id="3181299">[</span><span class="op" id="3181300">]</span><span class="ident" id="3181301">int64</span><span class="op" id="3181306">(</span><span class="ident" id="3181307">nil</span><span class="op" id="3181310">)</span><span class="op" id="3181311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181314">Register</span><span class="op" id="3181322">(</span><span class="op" id="3181323">[</span><span class="op" id="3181324">]</span><span class="builtintype" id="3181325">uint</span><span class="op" id="3181329">(</span><span class="ident" id="3181330">nil</span><span class="op" id="3181333">)</span><span class="op" id="3181334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181337">Register</span><span class="op" id="3181345">(</span><span class="op" id="3181346">[</span><span class="op" id="3181347">]</span><span class="builtintype" id="3181348">uint8</span><span class="op" id="3181353">(</span><span class="ident" id="3181354">nil</span><span class="op" id="3181357">)</span><span class="op" id="3181358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181361">Register</span><span class="op" id="3181369">(</span><span class="op" id="3181370">[</span><span class="op" id="3181371">]</span><span class="builtintype" id="3181372">uint16</span><span class="op" id="3181378">(</span><span class="ident" id="3181379">nil</span><span class="op" id="3181382">)</span><span class="op" id="3181383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181386">Register</span><span class="op" id="3181394">(</span><span class="op" id="3181395">[</span><span class="op" id="3181396">]</span><span class="builtintype" id="3181397">uint32</span><span class="op" id="3181403">(</span><span class="ident" id="3181404">nil</span><span class="op" id="3181407">)</span><span class="op" id="3181408">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181411">Register</span><span class="op" id="3181419">(</span><span class="op" id="3181420">[</span><span class="op" id="3181421">]</span><span class="ident" id="3181422">uint64</span><span class="op" id="3181428">(</span><span class="ident" id="3181429">nil</span><span class="op" id="3181432">)</span><span class="op" id="3181433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181436">Register</span><span class="op" id="3181444">(</span><span class="op" id="3181445">[</span><span class="op" id="3181446">]</span><span class="builtintype" id="3181447">float32</span><span class="op" id="3181454">(</span><span class="ident" id="3181455">nil</span><span class="op" id="3181458">)</span><span class="op" id="3181459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181462">Register</span><span class="op" id="3181470">(</span><span class="op" id="3181471">[</span><span class="op" id="3181472">]</span><span class="builtintype" id="3181473">float64</span><span class="op" id="3181480">(</span><span class="ident" id="3181481">nil</span><span class="op" id="3181484">)</span><span class="op" id="3181485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181488">Register</span><span class="op" id="3181496">(</span><span class="op" id="3181497">[</span><span class="op" id="3181498">]</span><span class="builtintype" id="3181499">complex64</span><span class="op" id="3181508">(</span><span class="ident" id="3181509">nil</span><span class="op" id="3181512">)</span><span class="op" id="3181513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181516">Register</span><span class="op" id="3181524">(</span><span class="op" id="3181525">[</span><span class="op" id="3181526">]</span><span class="builtintype" id="3181527">complex128</span><span class="op" id="3181537">(</span><span class="ident" id="3181538">nil</span><span class="op" id="3181541">)</span><span class="op" id="3181542">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181545">Register</span><span class="op" id="3181553">(</span><span class="op" id="3181554">[</span><span class="op" id="3181555">]</span><span class="builtintype" id="3181556">uintptr</span><span class="op" id="3181563">(</span><span class="ident" id="3181564">nil</span><span class="op" id="3181567">)</span><span class="op" id="3181568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181571">Register</span><span class="op" id="3181579">(</span><span class="op" id="3181580">[</span><span class="op" id="3181581">]</span><span class="builtintype" id="3181582">bool</span><span class="op" id="3181586">(</span><span class="ident" id="3181587">nil</span><span class="op" id="3181590">)</span><span class="op" id="3181591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3181594">Register</span><span class="op" id="3181602">(</span><span class="op" id="3181603">[</span><span class="op" id="3181604">]</span><span class="builtintype" id="3181605">string</span><span class="op" id="3181611">(</span><span class="ident" id="3181612">nil</span><span class="op" id="3181615">)</span><span class="op" id="3181616">)</span><br>
<span class="lineno"></span><span class="op" id="3181618">}</span>
</div>
</body>
</html>
