<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1822101">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1822156">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1822210">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1822261">//&nbsp;Package&nbsp;big&nbsp;implements&nbsp;multi-precision&nbsp;arithmetic&nbsp;(big&nbsp;numbers).</span><br>
<span class="lineno"></span><span class="comment" id="1822329">//&nbsp;The&nbsp;following&nbsp;numeric&nbsp;types&nbsp;are&nbsp;supported:</span><br>
<span class="lineno"></span><span class="comment" id="1822375">//</span><br>
<span class="lineno"></span><span class="comment" id="1822378">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Int&nbsp;&nbsp;&nbsp;&nbspsigned&nbsp;integers</span><br>
<span class="lineno"></span><span class="comment" id="1822403">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Rat&nbsp;&nbsp;&nbsp;&nbsprational&nbsp;numbers</span><br>
<span class="lineno">10</span><span class="comment" id="1822429">//</span><br>
<span class="lineno"></span><span class="comment" id="1822432">//&nbsp;Methods&nbsp;are&nbsp;typically&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="1822470">//</span><br>
<span class="lineno"></span><span class="comment" id="1822473">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(z&nbsp;*Int)&nbsp;Op(x,&nbsp;y&nbsp;*Int)&nbsp;*Int&nbsp;&nbsp;&nbsp;&nbsp(similar&nbsp;for&nbsp;*Rat)</span><br>
<span class="lineno"></span><span class="comment" id="1822528">//</span><br>
<span class="lineno">15</span><span class="comment" id="1822531">//&nbsp;and&nbsp;implement&nbsp;operations&nbsp;z&nbsp;=&nbsp;x&nbsp;Op&nbsp;y&nbsp;with&nbsp;the&nbsp;result&nbsp;as&nbsp;receiver;&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1822605">//&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;it&nbsp;may&nbsp;be&nbsp;overwritten&nbsp;(and&nbsp;its&nbsp;memory&nbsp;reused).</span><br>
<span class="lineno"></span><span class="comment" id="1822678">//&nbsp;To&nbsp;enable&nbsp;chaining&nbsp;of&nbsp;operations,&nbsp;the&nbsp;result&nbsp;is&nbsp;also&nbsp;returned.&nbsp;Methods</span><br>
<span class="lineno"></span><span class="comment" id="1822752">//&nbsp;returning&nbsp;a&nbsp;result&nbsp;other&nbsp;than&nbsp;*Int&nbsp;or&nbsp;*Rat&nbsp;take&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1822826">//&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno">20</span><span class="comment" id="1822843">//</span><br>
<span class="lineno"></span><span class="keyword" id="1822846">package</span>&nbsp;<span class="ident" id="1822854">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1822859">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;operations&nbsp;on&nbsp;unsigned&nbsp;multi-precision&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="1822930">//&nbsp;These&nbsp;are&nbsp;the&nbsp;building&nbsp;blocks&nbsp;for&nbsp;the&nbsp;operations&nbsp;on&nbsp;signed&nbsp;integers</span><br>
<span class="lineno">25</span><span class="comment" id="1823001">//&nbsp;and&nbsp;rationals.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1823020">import</span>&nbsp;<span class="op" id="1823027">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1823030">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1823040">&#34;io&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1823046">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1823054">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1823067">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="1823074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="1823077">//&nbsp;An&nbsp;unsigned&nbsp;integer&nbsp;x&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="1823114">//</span><br>
<span class="lineno"></span><span class="comment" id="1823117">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x[n-1]*_B^(n-1)&nbsp;+&nbsp;x[n-2]*_B^(n-2)&nbsp;+&nbsp;...&nbsp;+&nbsp;x[1]*_B&nbsp;+&nbsp;x[0]</span><br>
<span class="lineno"></span><span class="comment" id="1823183">//</span><br>
<span class="lineno"></span><span class="comment" id="1823186">//&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;x[i]&nbsp;&lt;&nbsp;_B&nbsp;and&nbsp;0&nbsp;&lt;=&nbsp;i&nbsp;&lt;&nbsp;n&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n,</span><br>
<span class="lineno">40</span><span class="comment" id="1823258">//&nbsp;with&nbsp;the&nbsp;digits&nbsp;x[i]&nbsp;as&nbsp;the&nbsp;slice&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="1823305">//</span><br>
<span class="lineno"></span><span class="comment" id="1823308">//&nbsp;A&nbsp;number&nbsp;is&nbsp;normalized&nbsp;if&nbsp;the&nbsp;slice&nbsp;contains&nbsp;no&nbsp;leading&nbsp;0&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="1823377">//&nbsp;During&nbsp;arithmetic&nbsp;operations,&nbsp;denormalized&nbsp;values&nbsp;may&nbsp;occur&nbsp;but&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="1823448">//&nbsp;always&nbsp;normalized&nbsp;before&nbsp;returning&nbsp;the&nbsp;final&nbsp;result.&nbsp;The&nbsp;normalized</span><br>
<span class="lineno">45</span><span class="comment" id="1823519">//&nbsp;representation&nbsp;of&nbsp;0&nbsp;is&nbsp;the&nbsp;empty&nbsp;or&nbsp;nil&nbsp;slice&nbsp;(length&nbsp;=&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="1823582">//</span><br>
<span class="lineno"></span><span class="keyword" id="1823585">type</span>&nbsp;<span class="ident" id="1823590">nat</span>&nbsp;<span class="op" id="1823594">[</span><span class="op" id="1823595">]</span><span class="ident" id="1823596">Word</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1823602">var</span>&nbsp;<span class="op" id="1823606">(</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823609">natOne</span>&nbsp;<span class="op" id="1823616">=</span>&nbsp;<span class="ident" id="1823618">nat</span><span class="op" id="1823621">{</span><span class="num" id="1823622">1</span><span class="op" id="1823623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823626">natTwo</span>&nbsp;<span class="op" id="1823633">=</span>&nbsp;<span class="ident" id="1823635">nat</span><span class="op" id="1823638">{</span><span class="num" id="1823639">2</span><span class="op" id="1823640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823643">natTen</span>&nbsp;<span class="op" id="1823650">=</span>&nbsp;<span class="ident" id="1823652">nat</span><span class="op" id="1823655">{</span><span class="num" id="1823656">10</span><span class="op" id="1823658">}</span><br>
<span class="lineno"></span><span class="op" id="1823660">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="1823663">func</span>&nbsp;<span class="op" id="1823668">(</span><span class="ident" id="1823669">z</span>&nbsp;<span class="ident" id="1823671">nat</span><span class="op" id="1823674">)</span>&nbsp;<span class="ident" id="1823676">clear</span><span class="op" id="1823681">(</span><span class="op" id="1823682">)</span>&nbsp;<span class="op" id="1823684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1823687">for</span>&nbsp;<span class="ident" id="1823691">i</span>&nbsp;<span class="op" id="1823693">:=</span>&nbsp;<span class="keyword" id="1823696">range</span>&nbsp;<span class="ident" id="1823702">z</span>&nbsp;<span class="op" id="1823704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823708">z</span><span class="op" id="1823709">[</span><span class="ident" id="1823710">i</span><span class="op" id="1823711">]</span>&nbsp;<span class="op" id="1823713">=</span>&nbsp;<span class="num" id="1823715">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1823718">}</span><br>
<span class="lineno"></span><span class="op" id="1823720">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="1823723">func</span>&nbsp;<span class="op" id="1823728">(</span><span class="ident" id="1823729">z</span>&nbsp;<span class="ident" id="1823731">nat</span><span class="op" id="1823734">)</span>&nbsp;<span class="ident" id="1823736">norm</span><span class="op" id="1823740">(</span><span class="op" id="1823741">)</span>&nbsp;<span class="ident" id="1823743">nat</span>&nbsp;<span class="op" id="1823747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823750">i</span>&nbsp;<span class="op" id="1823752">:=</span>&nbsp;<span class="builtinfunc" id="1823755">len</span><span class="op" id="1823758">(</span><span class="ident" id="1823759">z</span><span class="op" id="1823760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1823763">for</span>&nbsp;<span class="ident" id="1823767">i</span>&nbsp;<span class="op" id="1823769">&gt;</span>&nbsp;<span class="num" id="1823771">0</span>&nbsp;<span class="op" id="1823773">&amp;&amp;</span>&nbsp;<span class="ident" id="1823776">z</span><span class="op" id="1823777">[</span><span class="ident" id="1823778">i</span><span class="op" id="1823779">-</span><span class="num" id="1823780">1</span><span class="op" id="1823781">]</span>&nbsp;<span class="op" id="1823783">==</span>&nbsp;<span class="num" id="1823786">0</span>&nbsp;<span class="op" id="1823788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823792">i</span><span class="op" id="1823793">--</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1823797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1823800">return</span>&nbsp;<span class="ident" id="1823807">z</span><span class="op" id="1823808">[</span><span class="num" id="1823809">0</span><span class="op" id="1823810">:</span><span class="ident" id="1823811">i</span><span class="op" id="1823812">]</span><br>
<span class="lineno"></span><span class="op" id="1823814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1823817">func</span>&nbsp;<span class="op" id="1823822">(</span><span class="ident" id="1823823">z</span>&nbsp;<span class="ident" id="1823825">nat</span><span class="op" id="1823828">)</span>&nbsp;<span class="builtinfunc" id="1823830">make</span><span class="op" id="1823834">(</span><span class="ident" id="1823835">n</span>&nbsp;<span class="builtintype" id="1823837">int</span><span class="op" id="1823840">)</span>&nbsp;<span class="ident" id="1823842">nat</span>&nbsp;<span class="op" id="1823846">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1823849">if</span>&nbsp;<span class="ident" id="1823852">n</span>&nbsp;<span class="op" id="1823854">&lt;=</span>&nbsp;<span class="builtinfunc" id="1823857">cap</span><span class="op" id="1823860">(</span><span class="ident" id="1823861">z</span><span class="op" id="1823862">)</span>&nbsp;<span class="op" id="1823864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1823868">return</span>&nbsp;<span class="ident" id="1823875">z</span><span class="op" id="1823876">[</span><span class="num" id="1823877">0</span><span class="op" id="1823878">:</span><span class="ident" id="1823879">n</span><span class="op" id="1823880">]</span>&nbsp;<span class="comment" id="1823882">//&nbsp;reuse&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1823894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823897">//&nbsp;Choosing&nbsp;a&nbsp;good&nbsp;value&nbsp;for&nbsp;e&nbsp;has&nbsp;significant&nbsp;performance&nbsp;impact</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823964">//&nbsp;because&nbsp;it&nbsp;increases&nbsp;the&nbsp;chance&nbsp;that&nbsp;a&nbsp;value&nbsp;can&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824028">const</span>&nbsp;<span class="ident" id="1824034">e</span>&nbsp;<span class="op" id="1824036">=</span>&nbsp;<span class="num" id="1824038">4</span>&nbsp;<span class="comment" id="1824040">//&nbsp;extra&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824059">return</span>&nbsp;<span class="builtinfunc" id="1824066">make</span><span class="op" id="1824070">(</span><span class="ident" id="1824071">nat</span><span class="op" id="1824074">,</span>&nbsp;<span class="ident" id="1824076">n</span><span class="op" id="1824077">,</span>&nbsp;<span class="ident" id="1824079">n</span><span class="op" id="1824080">+</span><span class="ident" id="1824081">e</span><span class="op" id="1824082">)</span><br>
<span class="lineno"></span><span class="op" id="1824084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1824087">func</span>&nbsp;<span class="op" id="1824092">(</span><span class="ident" id="1824093">z</span>&nbsp;<span class="ident" id="1824095">nat</span><span class="op" id="1824098">)</span>&nbsp;<span class="ident" id="1824100">setWord</span><span class="op" id="1824107">(</span><span class="ident" id="1824108">x</span>&nbsp;<span class="ident" id="1824110">Word</span><span class="op" id="1824114">)</span>&nbsp;<span class="ident" id="1824116">nat</span>&nbsp;<span class="op" id="1824120">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824123">if</span>&nbsp;<span class="ident" id="1824126">x</span>&nbsp;<span class="op" id="1824128">==</span>&nbsp;<span class="num" id="1824131">0</span>&nbsp;<span class="op" id="1824133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824137">return</span>&nbsp;<span class="ident" id="1824144">z</span><span class="op" id="1824145">.</span><span class="builtinfunc" id="1824146">make</span><span class="op" id="1824150">(</span><span class="num" id="1824151">0</span><span class="op" id="1824152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824158">z</span>&nbsp;<span class="op" id="1824160">=</span>&nbsp;<span class="ident" id="1824162">z</span><span class="op" id="1824163">.</span><span class="builtinfunc" id="1824164">make</span><span class="op" id="1824168">(</span><span class="num" id="1824169">1</span><span class="op" id="1824170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824173">z</span><span class="op" id="1824174">[</span><span class="num" id="1824175">0</span><span class="op" id="1824176">]</span>&nbsp;<span class="op" id="1824178">=</span>&nbsp;<span class="ident" id="1824180">x</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824183">return</span>&nbsp;<span class="ident" id="1824190">z</span><br>
<span class="lineno"></span><span class="op" id="1824192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1824195">func</span>&nbsp;<span class="op" id="1824200">(</span><span class="ident" id="1824201">z</span>&nbsp;<span class="ident" id="1824203">nat</span><span class="op" id="1824206">)</span>&nbsp;<span class="ident" id="1824208">setUint64</span><span class="op" id="1824217">(</span><span class="ident" id="1824218">x</span>&nbsp;<span class="ident" id="1824220">uint64</span><span class="op" id="1824226">)</span>&nbsp;<span class="ident" id="1824228">nat</span>&nbsp;<span class="op" id="1824232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824235">//&nbsp;single-digit&nbsp;values</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824259">if</span>&nbsp;<span class="ident" id="1824262">w</span>&nbsp;<span class="op" id="1824264">:=</span>&nbsp;<span class="ident" id="1824267">Word</span><span class="op" id="1824271">(</span><span class="ident" id="1824272">x</span><span class="op" id="1824273">)</span><span class="op" id="1824274">;</span>&nbsp;<span class="ident" id="1824276">uint64</span><span class="op" id="1824282">(</span><span class="ident" id="1824283">w</span><span class="op" id="1824284">)</span>&nbsp;<span class="op" id="1824286">==</span>&nbsp;<span class="ident" id="1824289">x</span>&nbsp;<span class="op" id="1824291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824295">return</span>&nbsp;<span class="ident" id="1824302">z</span><span class="op" id="1824303">.</span><span class="ident" id="1824304">setWord</span><span class="op" id="1824311">(</span><span class="ident" id="1824312">w</span><span class="op" id="1824313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824320">//&nbsp;compute&nbsp;number&nbsp;of&nbsp;words&nbsp;n&nbsp;required&nbsp;to&nbsp;represent&nbsp;x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824374">n</span>&nbsp;<span class="op" id="1824376">:=</span>&nbsp;<span class="num" id="1824379">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824382">for</span>&nbsp;<span class="ident" id="1824386">t</span>&nbsp;<span class="op" id="1824388">:=</span>&nbsp;<span class="ident" id="1824391">x</span><span class="op" id="1824392">;</span>&nbsp;<span class="ident" id="1824394">t</span>&nbsp;<span class="op" id="1824396">&gt;</span>&nbsp;<span class="num" id="1824398">0</span><span class="op" id="1824399">;</span>&nbsp;<span class="ident" id="1824401">t</span>&nbsp;<span class="op" id="1824403">&gt;&gt;=</span>&nbsp;<span class="ident" id="1824407">_W</span>&nbsp;<span class="op" id="1824410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824414">n</span><span class="op" id="1824415">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824423">//&nbsp;split&nbsp;x&nbsp;into&nbsp;n&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824448">z</span>&nbsp;<span class="op" id="1824450">=</span>&nbsp;<span class="ident" id="1824452">z</span><span class="op" id="1824453">.</span><span class="builtinfunc" id="1824454">make</span><span class="op" id="1824458">(</span><span class="ident" id="1824459">n</span><span class="op" id="1824460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824463">for</span>&nbsp;<span class="ident" id="1824467">i</span>&nbsp;<span class="op" id="1824469">:=</span>&nbsp;<span class="keyword" id="1824472">range</span>&nbsp;<span class="ident" id="1824478">z</span>&nbsp;<span class="op" id="1824480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824484">z</span><span class="op" id="1824485">[</span><span class="ident" id="1824486">i</span><span class="op" id="1824487">]</span>&nbsp;<span class="op" id="1824489">=</span>&nbsp;<span class="ident" id="1824491">Word</span><span class="op" id="1824495">(</span><span class="ident" id="1824496">x</span>&nbsp;<span class="op" id="1824498">&amp;</span>&nbsp;<span class="ident" id="1824500">_M</span><span class="op" id="1824502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824506">x</span>&nbsp;<span class="op" id="1824508">&gt;&gt;=</span>&nbsp;<span class="ident" id="1824512">_W</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824520">return</span>&nbsp;<span class="ident" id="1824527">z</span><br>
<span class="lineno"></span><span class="op" id="1824529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="1824532">func</span>&nbsp;<span class="op" id="1824537">(</span><span class="ident" id="1824538">z</span>&nbsp;<span class="ident" id="1824540">nat</span><span class="op" id="1824543">)</span>&nbsp;<span class="ident" id="1824545">set</span><span class="op" id="1824548">(</span><span class="ident" id="1824549">x</span>&nbsp;<span class="ident" id="1824551">nat</span><span class="op" id="1824554">)</span>&nbsp;<span class="ident" id="1824556">nat</span>&nbsp;<span class="op" id="1824560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824563">z</span>&nbsp;<span class="op" id="1824565">=</span>&nbsp;<span class="ident" id="1824567">z</span><span class="op" id="1824568">.</span><span class="builtinfunc" id="1824569">make</span><span class="op" id="1824573">(</span><span class="builtinfunc" id="1824574">len</span><span class="op" id="1824577">(</span><span class="ident" id="1824578">x</span><span class="op" id="1824579">)</span><span class="op" id="1824580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1824583">copy</span><span class="op" id="1824587">(</span><span class="ident" id="1824588">z</span><span class="op" id="1824589">,</span>&nbsp;<span class="ident" id="1824591">x</span><span class="op" id="1824592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824595">return</span>&nbsp;<span class="ident" id="1824602">z</span><br>
<span class="lineno"></span><span class="op" id="1824604">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="1824607">func</span>&nbsp;<span class="op" id="1824612">(</span><span class="ident" id="1824613">z</span>&nbsp;<span class="ident" id="1824615">nat</span><span class="op" id="1824618">)</span>&nbsp;<span class="ident" id="1824620">add</span><span class="op" id="1824623">(</span><span class="ident" id="1824624">x</span><span class="op" id="1824625">,</span>&nbsp;<span class="ident" id="1824627">y</span>&nbsp;<span class="ident" id="1824629">nat</span><span class="op" id="1824632">)</span>&nbsp;<span class="ident" id="1824634">nat</span>&nbsp;<span class="op" id="1824638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824641">m</span>&nbsp;<span class="op" id="1824643">:=</span>&nbsp;<span class="builtinfunc" id="1824646">len</span><span class="op" id="1824649">(</span><span class="ident" id="1824650">x</span><span class="op" id="1824651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824654">n</span>&nbsp;<span class="op" id="1824656">:=</span>&nbsp;<span class="builtinfunc" id="1824659">len</span><span class="op" id="1824662">(</span><span class="ident" id="1824663">y</span><span class="op" id="1824664">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824668">switch</span>&nbsp;<span class="op" id="1824675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824678">case</span>&nbsp;<span class="ident" id="1824683">m</span>&nbsp;<span class="op" id="1824685">&lt;</span>&nbsp;<span class="ident" id="1824687">n</span><span class="op" id="1824688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824692">return</span>&nbsp;<span class="ident" id="1824699">z</span><span class="op" id="1824700">.</span><span class="ident" id="1824701">add</span><span class="op" id="1824704">(</span><span class="ident" id="1824705">y</span><span class="op" id="1824706">,</span>&nbsp;<span class="ident" id="1824708">x</span><span class="op" id="1824709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824712">case</span>&nbsp;<span class="ident" id="1824717">m</span>&nbsp;<span class="op" id="1824719">==</span>&nbsp;<span class="num" id="1824722">0</span><span class="op" id="1824723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824727">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824767">return</span>&nbsp;<span class="ident" id="1824774">z</span><span class="op" id="1824775">.</span><span class="builtinfunc" id="1824776">make</span><span class="op" id="1824780">(</span><span class="num" id="1824781">0</span><span class="op" id="1824782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824785">case</span>&nbsp;<span class="ident" id="1824790">n</span>&nbsp;<span class="op" id="1824792">==</span>&nbsp;<span class="num" id="1824795">0</span><span class="op" id="1824796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824800">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824817">return</span>&nbsp;<span class="ident" id="1824824">z</span><span class="op" id="1824825">.</span><span class="ident" id="1824826">set</span><span class="op" id="1824829">(</span><span class="ident" id="1824830">x</span><span class="op" id="1824831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824834">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824837">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824848">z</span>&nbsp;<span class="op" id="1824850">=</span>&nbsp;<span class="ident" id="1824852">z</span><span class="op" id="1824853">.</span><span class="builtinfunc" id="1824854">make</span><span class="op" id="1824858">(</span><span class="ident" id="1824859">m</span>&nbsp;<span class="op" id="1824861">+</span>&nbsp;<span class="num" id="1824863">1</span><span class="op" id="1824864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824867">c</span>&nbsp;<span class="op" id="1824869">:=</span>&nbsp;<span class="ident" id="1824872">addVV</span><span class="op" id="1824877">(</span><span class="ident" id="1824878">z</span><span class="op" id="1824879">[</span><span class="num" id="1824880">0</span><span class="op" id="1824881">:</span><span class="ident" id="1824882">n</span><span class="op" id="1824883">]</span><span class="op" id="1824884">,</span>&nbsp;<span class="ident" id="1824886">x</span><span class="op" id="1824887">,</span>&nbsp;<span class="ident" id="1824889">y</span><span class="op" id="1824890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824893">if</span>&nbsp;<span class="ident" id="1824896">m</span>&nbsp;<span class="op" id="1824898">&gt;</span>&nbsp;<span class="ident" id="1824900">n</span>&nbsp;<span class="op" id="1824902">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824906">c</span>&nbsp;<span class="op" id="1824908">=</span>&nbsp;<span class="ident" id="1824910">addVW</span><span class="op" id="1824915">(</span><span class="ident" id="1824916">z</span><span class="op" id="1824917">[</span><span class="ident" id="1824918">n</span><span class="op" id="1824919">:</span><span class="ident" id="1824920">m</span><span class="op" id="1824921">]</span><span class="op" id="1824922">,</span>&nbsp;<span class="ident" id="1824924">x</span><span class="op" id="1824925">[</span><span class="ident" id="1824926">n</span><span class="op" id="1824927">:</span><span class="op" id="1824928">]</span><span class="op" id="1824929">,</span>&nbsp;<span class="ident" id="1824931">c</span><span class="op" id="1824932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824938">z</span><span class="op" id="1824939">[</span><span class="ident" id="1824940">m</span><span class="op" id="1824941">]</span>&nbsp;<span class="op" id="1824943">=</span>&nbsp;<span class="ident" id="1824945">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824949">return</span>&nbsp;<span class="ident" id="1824956">z</span><span class="op" id="1824957">.</span><span class="ident" id="1824958">norm</span><span class="op" id="1824962">(</span><span class="op" id="1824963">)</span><br>
<span class="lineno">140</span><span class="op" id="1824965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1824968">func</span>&nbsp;<span class="op" id="1824973">(</span><span class="ident" id="1824974">z</span>&nbsp;<span class="ident" id="1824976">nat</span><span class="op" id="1824979">)</span>&nbsp;<span class="ident" id="1824981">sub</span><span class="op" id="1824984">(</span><span class="ident" id="1824985">x</span><span class="op" id="1824986">,</span>&nbsp;<span class="ident" id="1824988">y</span>&nbsp;<span class="ident" id="1824990">nat</span><span class="op" id="1824993">)</span>&nbsp;<span class="ident" id="1824995">nat</span>&nbsp;<span class="op" id="1824999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825002">m</span>&nbsp;<span class="op" id="1825004">:=</span>&nbsp;<span class="builtinfunc" id="1825007">len</span><span class="op" id="1825010">(</span><span class="ident" id="1825011">x</span><span class="op" id="1825012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825015">n</span>&nbsp;<span class="op" id="1825017">:=</span>&nbsp;<span class="builtinfunc" id="1825020">len</span><span class="op" id="1825023">(</span><span class="ident" id="1825024">y</span><span class="op" id="1825025">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825029">switch</span>&nbsp;<span class="op" id="1825036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825039">case</span>&nbsp;<span class="ident" id="1825044">m</span>&nbsp;<span class="op" id="1825046">&lt;</span>&nbsp;<span class="ident" id="1825048">n</span><span class="op" id="1825049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1825053">panic</span><span class="op" id="1825058">(</span><span class="string" id="1825059">&#34;underflow&#34;</span><span class="op" id="1825070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825073">case</span>&nbsp;<span class="ident" id="1825078">m</span>&nbsp;<span class="op" id="1825080">==</span>&nbsp;<span class="num" id="1825083">0</span><span class="op" id="1825084">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1825088">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825128">return</span>&nbsp;<span class="ident" id="1825135">z</span><span class="op" id="1825136">.</span><span class="builtinfunc" id="1825137">make</span><span class="op" id="1825141">(</span><span class="num" id="1825142">0</span><span class="op" id="1825143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825146">case</span>&nbsp;<span class="ident" id="1825151">n</span>&nbsp;<span class="op" id="1825153">==</span>&nbsp;<span class="num" id="1825156">0</span><span class="op" id="1825157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1825161">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825178">return</span>&nbsp;<span class="ident" id="1825185">z</span><span class="op" id="1825186">.</span><span class="ident" id="1825187">set</span><span class="op" id="1825190">(</span><span class="ident" id="1825191">x</span><span class="op" id="1825192">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1825198">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825209">z</span>&nbsp;<span class="op" id="1825211">=</span>&nbsp;<span class="ident" id="1825213">z</span><span class="op" id="1825214">.</span><span class="builtinfunc" id="1825215">make</span><span class="op" id="1825219">(</span><span class="ident" id="1825220">m</span><span class="op" id="1825221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825224">c</span>&nbsp;<span class="op" id="1825226">:=</span>&nbsp;<span class="ident" id="1825229">subVV</span><span class="op" id="1825234">(</span><span class="ident" id="1825235">z</span><span class="op" id="1825236">[</span><span class="num" id="1825237">0</span><span class="op" id="1825238">:</span><span class="ident" id="1825239">n</span><span class="op" id="1825240">]</span><span class="op" id="1825241">,</span>&nbsp;<span class="ident" id="1825243">x</span><span class="op" id="1825244">,</span>&nbsp;<span class="ident" id="1825246">y</span><span class="op" id="1825247">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825250">if</span>&nbsp;<span class="ident" id="1825253">m</span>&nbsp;<span class="op" id="1825255">&gt;</span>&nbsp;<span class="ident" id="1825257">n</span>&nbsp;<span class="op" id="1825259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825263">c</span>&nbsp;<span class="op" id="1825265">=</span>&nbsp;<span class="ident" id="1825267">subVW</span><span class="op" id="1825272">(</span><span class="ident" id="1825273">z</span><span class="op" id="1825274">[</span><span class="ident" id="1825275">n</span><span class="op" id="1825276">:</span><span class="op" id="1825277">]</span><span class="op" id="1825278">,</span>&nbsp;<span class="ident" id="1825280">x</span><span class="op" id="1825281">[</span><span class="ident" id="1825282">n</span><span class="op" id="1825283">:</span><span class="op" id="1825284">]</span><span class="op" id="1825285">,</span>&nbsp;<span class="ident" id="1825287">c</span><span class="op" id="1825288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825294">if</span>&nbsp;<span class="ident" id="1825297">c</span>&nbsp;<span class="op" id="1825299">!=</span>&nbsp;<span class="num" id="1825302">0</span>&nbsp;<span class="op" id="1825304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1825308">panic</span><span class="op" id="1825313">(</span><span class="string" id="1825314">&#34;underflow&#34;</span><span class="op" id="1825325">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825332">return</span>&nbsp;<span class="ident" id="1825339">z</span><span class="op" id="1825340">.</span><span class="ident" id="1825341">norm</span><span class="op" id="1825345">(</span><span class="op" id="1825346">)</span><br>
<span class="lineno"></span><span class="op" id="1825348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="1825351">func</span>&nbsp;<span class="op" id="1825356">(</span><span class="ident" id="1825357">x</span>&nbsp;<span class="ident" id="1825359">nat</span><span class="op" id="1825362">)</span>&nbsp;<span class="ident" id="1825364">cmp</span><span class="op" id="1825367">(</span><span class="ident" id="1825368">y</span>&nbsp;<span class="ident" id="1825370">nat</span><span class="op" id="1825373">)</span>&nbsp;<span class="op" id="1825375">(</span><span class="ident" id="1825376">r</span>&nbsp;<span class="builtintype" id="1825378">int</span><span class="op" id="1825381">)</span>&nbsp;<span class="op" id="1825383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825386">m</span>&nbsp;<span class="op" id="1825388">:=</span>&nbsp;<span class="builtinfunc" id="1825391">len</span><span class="op" id="1825394">(</span><span class="ident" id="1825395">x</span><span class="op" id="1825396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825399">n</span>&nbsp;<span class="op" id="1825401">:=</span>&nbsp;<span class="builtinfunc" id="1825404">len</span><span class="op" id="1825407">(</span><span class="ident" id="1825408">y</span><span class="op" id="1825409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825412">if</span>&nbsp;<span class="ident" id="1825415">m</span>&nbsp;<span class="op" id="1825417">!=</span>&nbsp;<span class="ident" id="1825420">n</span>&nbsp;<span class="op" id="1825422">||</span>&nbsp;<span class="ident" id="1825425">m</span>&nbsp;<span class="op" id="1825427">==</span>&nbsp;<span class="num" id="1825430">0</span>&nbsp;<span class="op" id="1825432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825436">switch</span>&nbsp;<span class="op" id="1825443">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825447">case</span>&nbsp;<span class="ident" id="1825452">m</span>&nbsp;<span class="op" id="1825454">&lt;</span>&nbsp;<span class="ident" id="1825456">n</span><span class="op" id="1825457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825462">r</span>&nbsp;<span class="op" id="1825464">=</span>&nbsp;<span class="op" id="1825466">-</span><span class="num" id="1825467">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825471">case</span>&nbsp;<span class="ident" id="1825476">m</span>&nbsp;<span class="op" id="1825478">&gt;</span>&nbsp;<span class="ident" id="1825480">n</span><span class="op" id="1825481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825486">r</span>&nbsp;<span class="op" id="1825488">=</span>&nbsp;<span class="num" id="1825490">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825494">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825498">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825510">i</span>&nbsp;<span class="op" id="1825512">:=</span>&nbsp;<span class="ident" id="1825515">m</span>&nbsp;<span class="op" id="1825517">-</span>&nbsp;<span class="num" id="1825519">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825522">for</span>&nbsp;<span class="ident" id="1825526">i</span>&nbsp;<span class="op" id="1825528">&gt;</span>&nbsp;<span class="num" id="1825530">0</span>&nbsp;<span class="op" id="1825532">&amp;&amp;</span>&nbsp;<span class="ident" id="1825535">x</span><span class="op" id="1825536">[</span><span class="ident" id="1825537">i</span><span class="op" id="1825538">]</span>&nbsp;<span class="op" id="1825540">==</span>&nbsp;<span class="ident" id="1825543">y</span><span class="op" id="1825544">[</span><span class="ident" id="1825545">i</span><span class="op" id="1825546">]</span>&nbsp;<span class="op" id="1825548">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825552">i</span><span class="op" id="1825553">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825561">switch</span>&nbsp;<span class="op" id="1825568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825571">case</span>&nbsp;<span class="ident" id="1825576">x</span><span class="op" id="1825577">[</span><span class="ident" id="1825578">i</span><span class="op" id="1825579">]</span>&nbsp;<span class="op" id="1825581">&lt;</span>&nbsp;<span class="ident" id="1825583">y</span><span class="op" id="1825584">[</span><span class="ident" id="1825585">i</span><span class="op" id="1825586">]</span><span class="op" id="1825587">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825591">r</span>&nbsp;<span class="op" id="1825593">=</span>&nbsp;<span class="op" id="1825595">-</span><span class="num" id="1825596">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825599">case</span>&nbsp;<span class="ident" id="1825604">x</span><span class="op" id="1825605">[</span><span class="ident" id="1825606">i</span><span class="op" id="1825607">]</span>&nbsp;<span class="op" id="1825609">&gt;</span>&nbsp;<span class="ident" id="1825611">y</span><span class="op" id="1825612">[</span><span class="ident" id="1825613">i</span><span class="op" id="1825614">]</span><span class="op" id="1825615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825619">r</span>&nbsp;<span class="op" id="1825621">=</span>&nbsp;<span class="num" id="1825623">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825629">return</span><br>
<span class="lineno">195</span><span class="op" id="1825636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1825639">func</span>&nbsp;<span class="op" id="1825644">(</span><span class="ident" id="1825645">z</span>&nbsp;<span class="ident" id="1825647">nat</span><span class="op" id="1825650">)</span>&nbsp;<span class="ident" id="1825652">mulAddWW</span><span class="op" id="1825660">(</span><span class="ident" id="1825661">x</span>&nbsp;<span class="ident" id="1825663">nat</span><span class="op" id="1825666">,</span>&nbsp;<span class="ident" id="1825668">y</span><span class="op" id="1825669">,</span>&nbsp;<span class="ident" id="1825671">r</span>&nbsp;<span class="ident" id="1825673">Word</span><span class="op" id="1825677">)</span>&nbsp;<span class="ident" id="1825679">nat</span>&nbsp;<span class="op" id="1825683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825686">m</span>&nbsp;<span class="op" id="1825688">:=</span>&nbsp;<span class="builtinfunc" id="1825691">len</span><span class="op" id="1825694">(</span><span class="ident" id="1825695">x</span><span class="op" id="1825696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825699">if</span>&nbsp;<span class="ident" id="1825702">m</span>&nbsp;<span class="op" id="1825704">==</span>&nbsp;<span class="num" id="1825707">0</span>&nbsp;<span class="op" id="1825709">||</span>&nbsp;<span class="ident" id="1825712">y</span>&nbsp;<span class="op" id="1825714">==</span>&nbsp;<span class="num" id="1825717">0</span>&nbsp;<span class="op" id="1825719">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825723">return</span>&nbsp;<span class="ident" id="1825730">z</span><span class="op" id="1825731">.</span><span class="ident" id="1825732">setWord</span><span class="op" id="1825739">(</span><span class="ident" id="1825740">r</span><span class="op" id="1825741">)</span>&nbsp;<span class="comment" id="1825743">//&nbsp;result&nbsp;is&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1825762">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825773">z</span>&nbsp;<span class="op" id="1825775">=</span>&nbsp;<span class="ident" id="1825777">z</span><span class="op" id="1825778">.</span><span class="builtinfunc" id="1825779">make</span><span class="op" id="1825783">(</span><span class="ident" id="1825784">m</span>&nbsp;<span class="op" id="1825786">+</span>&nbsp;<span class="num" id="1825788">1</span><span class="op" id="1825789">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825792">z</span><span class="op" id="1825793">[</span><span class="ident" id="1825794">m</span><span class="op" id="1825795">]</span>&nbsp;<span class="op" id="1825797">=</span>&nbsp;<span class="ident" id="1825799">mulAddVWW</span><span class="op" id="1825808">(</span><span class="ident" id="1825809">z</span><span class="op" id="1825810">[</span><span class="num" id="1825811">0</span><span class="op" id="1825812">:</span><span class="ident" id="1825813">m</span><span class="op" id="1825814">]</span><span class="op" id="1825815">,</span>&nbsp;<span class="ident" id="1825817">x</span><span class="op" id="1825818">,</span>&nbsp;<span class="ident" id="1825820">y</span><span class="op" id="1825821">,</span>&nbsp;<span class="ident" id="1825823">r</span><span class="op" id="1825824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825828">return</span>&nbsp;<span class="ident" id="1825835">z</span><span class="op" id="1825836">.</span><span class="ident" id="1825837">norm</span><span class="op" id="1825841">(</span><span class="op" id="1825842">)</span><br>
<span class="lineno"></span><span class="op" id="1825844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="1825847">//&nbsp;basicMul&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="1825906">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;len(x)&nbsp;+&nbsp;len(y)].</span><br>
<span class="lineno"></span><span class="keyword" id="1825974">func</span>&nbsp;<span class="ident" id="1825979">basicMul</span><span class="op" id="1825987">(</span><span class="ident" id="1825988">z</span><span class="op" id="1825989">,</span>&nbsp;<span class="ident" id="1825991">x</span><span class="op" id="1825992">,</span>&nbsp;<span class="ident" id="1825994">y</span>&nbsp;<span class="ident" id="1825996">nat</span><span class="op" id="1825999">)</span>&nbsp;<span class="op" id="1826001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826004">z</span><span class="op" id="1826005">[</span><span class="num" id="1826006">0</span>&nbsp;<span class="op" id="1826008">:</span>&nbsp;<span class="builtinfunc" id="1826010">len</span><span class="op" id="1826013">(</span><span class="ident" id="1826014">x</span><span class="op" id="1826015">)</span><span class="op" id="1826016">+</span><span class="builtinfunc" id="1826017">len</span><span class="op" id="1826020">(</span><span class="ident" id="1826021">y</span><span class="op" id="1826022">)</span><span class="op" id="1826023">]</span><span class="op" id="1826024">.</span><span class="ident" id="1826025">clear</span><span class="op" id="1826030">(</span><span class="op" id="1826031">)</span>&nbsp;<span class="comment" id="1826033">//&nbsp;initialize&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1826050">for</span>&nbsp;<span class="ident" id="1826054">i</span><span class="op" id="1826055">,</span>&nbsp;<span class="ident" id="1826057">d</span>&nbsp;<span class="op" id="1826059">:=</span>&nbsp;<span class="keyword" id="1826062">range</span>&nbsp;<span class="ident" id="1826068">y</span>&nbsp;<span class="op" id="1826070">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1826074">if</span>&nbsp;<span class="ident" id="1826077">d</span>&nbsp;<span class="op" id="1826079">!=</span>&nbsp;<span class="num" id="1826082">0</span>&nbsp;<span class="op" id="1826084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826089">z</span><span class="op" id="1826090">[</span><span class="builtinfunc" id="1826091">len</span><span class="op" id="1826094">(</span><span class="ident" id="1826095">x</span><span class="op" id="1826096">)</span><span class="op" id="1826097">+</span><span class="ident" id="1826098">i</span><span class="op" id="1826099">]</span>&nbsp;<span class="op" id="1826101">=</span>&nbsp;<span class="ident" id="1826103">addMulVVW</span><span class="op" id="1826112">(</span><span class="ident" id="1826113">z</span><span class="op" id="1826114">[</span><span class="ident" id="1826115">i</span><span class="op" id="1826116">:</span><span class="ident" id="1826117">i</span><span class="op" id="1826118">+</span><span class="builtinfunc" id="1826119">len</span><span class="op" id="1826122">(</span><span class="ident" id="1826123">x</span><span class="op" id="1826124">)</span><span class="op" id="1826125">]</span><span class="op" id="1826126">,</span>&nbsp;<span class="ident" id="1826128">x</span><span class="op" id="1826129">,</span>&nbsp;<span class="ident" id="1826131">d</span><span class="op" id="1826132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1826136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1826139">}</span><br>
<span class="lineno"></span><span class="op" id="1826141">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="1826144">//&nbsp;Fast&nbsp;version&nbsp;of&nbsp;z[0:n+n&gt;&gt;1].add(z[0:n+n&gt;&gt;1],&nbsp;x[0:n])&nbsp;w/o&nbsp;bounds&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="1826219">//&nbsp;Factored&nbsp;out&nbsp;for&nbsp;readability&nbsp;-&nbsp;do&nbsp;not&nbsp;use&nbsp;outside&nbsp;karatsuba.</span><br>
<span class="lineno"></span><span class="keyword" id="1826283">func</span>&nbsp;<span class="ident" id="1826288">karatsubaAdd</span><span class="op" id="1826300">(</span><span class="ident" id="1826301">z</span><span class="op" id="1826302">,</span>&nbsp;<span class="ident" id="1826304">x</span>&nbsp;<span class="ident" id="1826306">nat</span><span class="op" id="1826309">,</span>&nbsp;<span class="ident" id="1826311">n</span>&nbsp;<span class="builtintype" id="1826313">int</span><span class="op" id="1826316">)</span>&nbsp;<span class="op" id="1826318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1826321">if</span>&nbsp;<span class="ident" id="1826324">c</span>&nbsp;<span class="op" id="1826326">:=</span>&nbsp;<span class="ident" id="1826329">addVV</span><span class="op" id="1826334">(</span><span class="ident" id="1826335">z</span><span class="op" id="1826336">[</span><span class="num" id="1826337">0</span><span class="op" id="1826338">:</span><span class="ident" id="1826339">n</span><span class="op" id="1826340">]</span><span class="op" id="1826341">,</span>&nbsp;<span class="ident" id="1826343">z</span><span class="op" id="1826344">,</span>&nbsp;<span class="ident" id="1826346">x</span><span class="op" id="1826347">)</span><span class="op" id="1826348">;</span>&nbsp;<span class="ident" id="1826350">c</span>&nbsp;<span class="op" id="1826352">!=</span>&nbsp;<span class="num" id="1826355">0</span>&nbsp;<span class="op" id="1826357">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826361">addVW</span><span class="op" id="1826366">(</span><span class="ident" id="1826367">z</span><span class="op" id="1826368">[</span><span class="ident" id="1826369">n</span><span class="op" id="1826370">:</span><span class="ident" id="1826371">n</span><span class="op" id="1826372">+</span><span class="ident" id="1826373">n</span><span class="op" id="1826374">&gt;&gt;</span><span class="num" id="1826376">1</span><span class="op" id="1826377">]</span><span class="op" id="1826378">,</span>&nbsp;<span class="ident" id="1826380">z</span><span class="op" id="1826381">[</span><span class="ident" id="1826382">n</span><span class="op" id="1826383">:</span><span class="op" id="1826384">]</span><span class="op" id="1826385">,</span>&nbsp;<span class="ident" id="1826387">c</span><span class="op" id="1826388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1826391">}</span><br>
<span class="lineno"></span><span class="op" id="1826393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1826396">//&nbsp;Like&nbsp;karatsubaAdd,&nbsp;but&nbsp;does&nbsp;subtract.</span><br>
<span class="lineno">230</span><span class="keyword" id="1826437">func</span>&nbsp;<span class="ident" id="1826442">karatsubaSub</span><span class="op" id="1826454">(</span><span class="ident" id="1826455">z</span><span class="op" id="1826456">,</span>&nbsp;<span class="ident" id="1826458">x</span>&nbsp;<span class="ident" id="1826460">nat</span><span class="op" id="1826463">,</span>&nbsp;<span class="ident" id="1826465">n</span>&nbsp;<span class="builtintype" id="1826467">int</span><span class="op" id="1826470">)</span>&nbsp;<span class="op" id="1826472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1826475">if</span>&nbsp;<span class="ident" id="1826478">c</span>&nbsp;<span class="op" id="1826480">:=</span>&nbsp;<span class="ident" id="1826483">subVV</span><span class="op" id="1826488">(</span><span class="ident" id="1826489">z</span><span class="op" id="1826490">[</span><span class="num" id="1826491">0</span><span class="op" id="1826492">:</span><span class="ident" id="1826493">n</span><span class="op" id="1826494">]</span><span class="op" id="1826495">,</span>&nbsp;<span class="ident" id="1826497">z</span><span class="op" id="1826498">,</span>&nbsp;<span class="ident" id="1826500">x</span><span class="op" id="1826501">)</span><span class="op" id="1826502">;</span>&nbsp;<span class="ident" id="1826504">c</span>&nbsp;<span class="op" id="1826506">!=</span>&nbsp;<span class="num" id="1826509">0</span>&nbsp;<span class="op" id="1826511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826515">subVW</span><span class="op" id="1826520">(</span><span class="ident" id="1826521">z</span><span class="op" id="1826522">[</span><span class="ident" id="1826523">n</span><span class="op" id="1826524">:</span><span class="ident" id="1826525">n</span><span class="op" id="1826526">+</span><span class="ident" id="1826527">n</span><span class="op" id="1826528">&gt;&gt;</span><span class="num" id="1826530">1</span><span class="op" id="1826531">]</span><span class="op" id="1826532">,</span>&nbsp;<span class="ident" id="1826534">z</span><span class="op" id="1826535">[</span><span class="ident" id="1826536">n</span><span class="op" id="1826537">:</span><span class="op" id="1826538">]</span><span class="op" id="1826539">,</span>&nbsp;<span class="ident" id="1826541">c</span><span class="op" id="1826542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1826545">}</span><br>
<span class="lineno"></span><span class="op" id="1826547">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="1826550">//&nbsp;Operands&nbsp;that&nbsp;are&nbsp;shorter&nbsp;than&nbsp;karatsubaThreshold&nbsp;are&nbsp;multiplied&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="1826624">//&nbsp;&#34;grade&nbsp;school&#34;&nbsp;multiplication;&nbsp;for&nbsp;longer&nbsp;operands&nbsp;the&nbsp;Karatsuba&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="1826702">//&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="1826714">var</span>&nbsp;<span class="ident" id="1826718">karatsubaThreshold</span>&nbsp;<span class="builtintype" id="1826737">int</span>&nbsp;<span class="op" id="1826741">=</span>&nbsp;<span class="num" id="1826743">40</span>&nbsp;<span class="comment" id="1826746">//&nbsp;computed&nbsp;by&nbsp;calibrate.go</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="1826775">//&nbsp;karatsuba&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="1826835">//&nbsp;Both&nbsp;x&nbsp;and&nbsp;y&nbsp;must&nbsp;have&nbsp;the&nbsp;same&nbsp;length&nbsp;n&nbsp;and&nbsp;n&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1826895">//&nbsp;power&nbsp;of&nbsp;2.&nbsp;The&nbsp;result&nbsp;vector&nbsp;z&nbsp;must&nbsp;have&nbsp;len(z)&nbsp;&gt;=&nbsp;6*n.</span><br>
<span class="lineno"></span><span class="comment" id="1826955">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;2*n].</span><br>
<span class="lineno">245</span><span class="keyword" id="1827011">func</span>&nbsp;<span class="ident" id="1827016">karatsuba</span><span class="op" id="1827025">(</span><span class="ident" id="1827026">z</span><span class="op" id="1827027">,</span>&nbsp;<span class="ident" id="1827029">x</span><span class="op" id="1827030">,</span>&nbsp;<span class="ident" id="1827032">y</span>&nbsp;<span class="ident" id="1827034">nat</span><span class="op" id="1827037">)</span>&nbsp;<span class="op" id="1827039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827042">n</span>&nbsp;<span class="op" id="1827044">:=</span>&nbsp;<span class="builtinfunc" id="1827047">len</span><span class="op" id="1827050">(</span><span class="ident" id="1827051">y</span><span class="op" id="1827052">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827056">//&nbsp;Switch&nbsp;to&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;numbers&nbsp;are&nbsp;odd&nbsp;or&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827120">//&nbsp;(n&nbsp;is&nbsp;always&nbsp;even&nbsp;if&nbsp;karatsubaThreshold&nbsp;is&nbsp;even,&nbsp;but&nbsp;be</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827180">//&nbsp;conservative)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827198">if</span>&nbsp;<span class="ident" id="1827201">n</span><span class="op" id="1827202">&amp;</span><span class="num" id="1827203">1</span>&nbsp;<span class="op" id="1827205">!=</span>&nbsp;<span class="num" id="1827208">0</span>&nbsp;<span class="op" id="1827210">||</span>&nbsp;<span class="ident" id="1827213">n</span>&nbsp;<span class="op" id="1827215">&lt;</span>&nbsp;<span class="ident" id="1827217">karatsubaThreshold</span>&nbsp;<span class="op" id="1827236">||</span>&nbsp;<span class="ident" id="1827239">n</span>&nbsp;<span class="op" id="1827241">&lt;</span>&nbsp;<span class="num" id="1827243">2</span>&nbsp;<span class="op" id="1827245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827249">basicMul</span><span class="op" id="1827257">(</span><span class="ident" id="1827258">z</span><span class="op" id="1827259">,</span>&nbsp;<span class="ident" id="1827261">x</span><span class="op" id="1827262">,</span>&nbsp;<span class="ident" id="1827264">y</span><span class="op" id="1827265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827269">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827277">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827280">//&nbsp;n&amp;1&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827331">//&nbsp;Karatsuba&nbsp;multiplication&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;observation&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827393">//&nbsp;for&nbsp;two&nbsp;numbers&nbsp;x&nbsp;and&nbsp;y&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827427">//</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827431">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827451">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827471">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827475">//&nbsp;the&nbsp;product&nbsp;x*y&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;3&nbsp;products&nbsp;z2,&nbsp;z1,&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827538">//&nbsp;instead&nbsp;of&nbsp;4:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827556">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827560">//&nbsp;&nbsp;&nbsp;x*y&nbsp;=&nbsp;x1*y1*b*b&nbsp;+&nbsp;(x1*y0&nbsp;+&nbsp;x0*y1)*b&nbsp;+&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827610">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z2*b*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z1*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827660">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827664">//&nbsp;with:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827674">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827678">//&nbsp;&nbsp;&nbsp;xd&nbsp;=&nbsp;x1&nbsp;-&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827697">//&nbsp;&nbsp;&nbsp;yd&nbsp;=&nbsp;y0&nbsp;-&nbsp;y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827716">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827720">//&nbsp;&nbsp;&nbsp;z1&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xd*yd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827771">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(x1-x0)*(y0&nbsp;-&nbsp;y1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827822">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827873">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z2&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827924">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;x0*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827966">//&nbsp;split&nbsp;x,&nbsp;y&nbsp;into&nbsp;&#34;digits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827995">n2</span>&nbsp;<span class="op" id="1827998">:=</span>&nbsp;<span class="ident" id="1828001">n</span>&nbsp;<span class="op" id="1828003">&gt;&gt;</span>&nbsp;<span class="num" id="1828006">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1828021">//&nbsp;n2&nbsp;&gt;=&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828033">x1</span><span class="op" id="1828035">,</span>&nbsp;<span class="ident" id="1828037">x0</span>&nbsp;<span class="op" id="1828040">:=</span>&nbsp;<span class="ident" id="1828043">x</span><span class="op" id="1828044">[</span><span class="ident" id="1828045">n2</span><span class="op" id="1828047">:</span><span class="op" id="1828048">]</span><span class="op" id="1828049">,</span>&nbsp;<span class="ident" id="1828051">x</span><span class="op" id="1828052">[</span><span class="num" id="1828053">0</span><span class="op" id="1828054">:</span><span class="ident" id="1828055">n2</span><span class="op" id="1828057">]</span>&nbsp;<span class="comment" id="1828059">//&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828077">y1</span><span class="op" id="1828079">,</span>&nbsp;<span class="ident" id="1828081">y0</span>&nbsp;<span class="op" id="1828084">:=</span>&nbsp;<span class="ident" id="1828087">y</span><span class="op" id="1828088">[</span><span class="ident" id="1828089">n2</span><span class="op" id="1828091">:</span><span class="op" id="1828092">]</span><span class="op" id="1828093">,</span>&nbsp;<span class="ident" id="1828095">y</span><span class="op" id="1828096">[</span><span class="num" id="1828097">0</span><span class="op" id="1828098">:</span><span class="ident" id="1828099">n2</span><span class="op" id="1828101">]</span>&nbsp;<span class="comment" id="1828103">//&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828122">//&nbsp;z&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;result&nbsp;and&nbsp;temporary&nbsp;storage:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828174">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828178">//&nbsp;&nbsp;&nbsp;6*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0*n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828236">//&nbsp;z&nbsp;=&nbsp;[z2&nbsp;copy|z0&nbsp;copy|&nbsp;xd*yd&nbsp;|&nbsp;yd:xd&nbsp;|&nbsp;x1*y1&nbsp;|&nbsp;x0*y0&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828294">//</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828298">//&nbsp;For&nbsp;each&nbsp;recursive&nbsp;call&nbsp;of&nbsp;karatsuba,&nbsp;an&nbsp;unused&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828359">//&nbsp;z&nbsp;is&nbsp;passed&nbsp;in&nbsp;that&nbsp;has&nbsp;(at&nbsp;least)&nbsp;half&nbsp;the&nbsp;length&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828421">//&nbsp;caller&#39;s&nbsp;z.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828438">//&nbsp;compute&nbsp;z0&nbsp;and&nbsp;z2&nbsp;with&nbsp;the&nbsp;result&nbsp;&#34;in&nbsp;place&#34;&nbsp;in&nbsp;z</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828492">karatsuba</span><span class="op" id="1828501">(</span><span class="ident" id="1828502">z</span><span class="op" id="1828503">,</span>&nbsp;<span class="ident" id="1828505">x0</span><span class="op" id="1828507">,</span>&nbsp;<span class="ident" id="1828509">y0</span><span class="op" id="1828511">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1828517">//&nbsp;z0&nbsp;=&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828532">karatsuba</span><span class="op" id="1828541">(</span><span class="ident" id="1828542">z</span><span class="op" id="1828543">[</span><span class="ident" id="1828544">n</span><span class="op" id="1828545">:</span><span class="op" id="1828546">]</span><span class="op" id="1828547">,</span>&nbsp;<span class="ident" id="1828549">x1</span><span class="op" id="1828551">,</span>&nbsp;<span class="ident" id="1828553">y1</span><span class="op" id="1828555">)</span>&nbsp;<span class="comment" id="1828557">//&nbsp;z2&nbsp;=&nbsp;x1*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828573">//&nbsp;compute&nbsp;xd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828632">s</span>&nbsp;<span class="op" id="1828634">:=</span>&nbsp;<span class="num" id="1828637">1</span>&nbsp;<span class="comment" id="1828639">//&nbsp;sign&nbsp;of&nbsp;product&nbsp;xd*yd</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828665">xd</span>&nbsp;<span class="op" id="1828668">:=</span>&nbsp;<span class="ident" id="1828671">z</span><span class="op" id="1828672">[</span><span class="num" id="1828673">2</span><span class="op" id="1828674">*</span><span class="ident" id="1828675">n</span>&nbsp;<span class="op" id="1828677">:</span>&nbsp;<span class="num" id="1828679">2</span><span class="op" id="1828680">*</span><span class="ident" id="1828681">n</span><span class="op" id="1828682">+</span><span class="ident" id="1828683">n2</span><span class="op" id="1828685">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828688">if</span>&nbsp;<span class="ident" id="1828691">subVV</span><span class="op" id="1828696">(</span><span class="ident" id="1828697">xd</span><span class="op" id="1828699">,</span>&nbsp;<span class="ident" id="1828701">x1</span><span class="op" id="1828703">,</span>&nbsp;<span class="ident" id="1828705">x0</span><span class="op" id="1828707">)</span>&nbsp;<span class="op" id="1828709">!=</span>&nbsp;<span class="num" id="1828712">0</span>&nbsp;<span class="op" id="1828714">{</span>&nbsp;<span class="comment" id="1828716">//&nbsp;x1-x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828727">s</span>&nbsp;<span class="op" id="1828729">=</span>&nbsp;<span class="op" id="1828731">-</span><span class="ident" id="1828732">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828736">subVV</span><span class="op" id="1828741">(</span><span class="ident" id="1828742">xd</span><span class="op" id="1828744">,</span>&nbsp;<span class="ident" id="1828746">x0</span><span class="op" id="1828748">,</span>&nbsp;<span class="ident" id="1828750">x1</span><span class="op" id="1828752">)</span>&nbsp;<span class="comment" id="1828754">//&nbsp;x0-x1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828764">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828768">//&nbsp;compute&nbsp;yd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828827">yd</span>&nbsp;<span class="op" id="1828830">:=</span>&nbsp;<span class="ident" id="1828833">z</span><span class="op" id="1828834">[</span><span class="num" id="1828835">2</span><span class="op" id="1828836">*</span><span class="ident" id="1828837">n</span><span class="op" id="1828838">+</span><span class="ident" id="1828839">n2</span>&nbsp;<span class="op" id="1828842">:</span>&nbsp;<span class="num" id="1828844">3</span><span class="op" id="1828845">*</span><span class="ident" id="1828846">n</span><span class="op" id="1828847">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828850">if</span>&nbsp;<span class="ident" id="1828853">subVV</span><span class="op" id="1828858">(</span><span class="ident" id="1828859">yd</span><span class="op" id="1828861">,</span>&nbsp;<span class="ident" id="1828863">y0</span><span class="op" id="1828865">,</span>&nbsp;<span class="ident" id="1828867">y1</span><span class="op" id="1828869">)</span>&nbsp;<span class="op" id="1828871">!=</span>&nbsp;<span class="num" id="1828874">0</span>&nbsp;<span class="op" id="1828876">{</span>&nbsp;<span class="comment" id="1828878">//&nbsp;y0-y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828889">s</span>&nbsp;<span class="op" id="1828891">=</span>&nbsp;<span class="op" id="1828893">-</span><span class="ident" id="1828894">s</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828898">subVV</span><span class="op" id="1828903">(</span><span class="ident" id="1828904">yd</span><span class="op" id="1828906">,</span>&nbsp;<span class="ident" id="1828908">y1</span><span class="op" id="1828910">,</span>&nbsp;<span class="ident" id="1828912">y0</span><span class="op" id="1828914">)</span>&nbsp;<span class="comment" id="1828916">//&nbsp;y1-y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828930">//&nbsp;p&nbsp;=&nbsp;(x1-x0)*(y0-y1)&nbsp;==&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;for&nbsp;s&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828997">//&nbsp;p&nbsp;=&nbsp;(x0-x1)*(y0-y1)&nbsp;==&nbsp;x0*y0&nbsp;-&nbsp;x0*y1&nbsp;-&nbsp;x1*y0&nbsp;+&nbsp;x1*y1&nbsp;for&nbsp;s&nbsp;&lt;&nbsp;0</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829064">p</span>&nbsp;<span class="op" id="1829066">:=</span>&nbsp;<span class="ident" id="1829069">z</span><span class="op" id="1829070">[</span><span class="ident" id="1829071">n</span><span class="op" id="1829072">*</span><span class="num" id="1829073">3</span><span class="op" id="1829074">:</span><span class="op" id="1829075">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829078">karatsuba</span><span class="op" id="1829087">(</span><span class="ident" id="1829088">p</span><span class="op" id="1829089">,</span>&nbsp;<span class="ident" id="1829091">xd</span><span class="op" id="1829093">,</span>&nbsp;<span class="ident" id="1829095">yd</span><span class="op" id="1829097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829101">//&nbsp;save&nbsp;original&nbsp;z2:z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829125">//&nbsp;(ok&nbsp;to&nbsp;use&nbsp;upper&nbsp;half&nbsp;of&nbsp;z&nbsp;since&nbsp;we&#39;re&nbsp;done&nbsp;recursing)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829184">r</span>&nbsp;<span class="op" id="1829186">:=</span>&nbsp;<span class="ident" id="1829189">z</span><span class="op" id="1829190">[</span><span class="ident" id="1829191">n</span><span class="op" id="1829192">*</span><span class="num" id="1829193">4</span><span class="op" id="1829194">:</span><span class="op" id="1829195">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1829198">copy</span><span class="op" id="1829202">(</span><span class="ident" id="1829203">r</span><span class="op" id="1829204">,</span>&nbsp;<span class="ident" id="1829206">z</span><span class="op" id="1829207">[</span><span class="op" id="1829208">:</span><span class="ident" id="1829209">n</span><span class="op" id="1829210">*</span><span class="num" id="1829211">2</span><span class="op" id="1829212">]</span><span class="op" id="1829213">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829217">//&nbsp;add&nbsp;up&nbsp;all&nbsp;partial&nbsp;products</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829249">//</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829253">//&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829275">//&nbsp;z&nbsp;=&nbsp;[&nbsp;z2&nbsp;&nbsp;|&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829297">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829316">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z2&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829335">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;p&nbsp;&nbsp;]</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829354">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829358">karatsubaAdd</span><span class="op" id="1829370">(</span><span class="ident" id="1829371">z</span><span class="op" id="1829372">[</span><span class="ident" id="1829373">n2</span><span class="op" id="1829375">:</span><span class="op" id="1829376">]</span><span class="op" id="1829377">,</span>&nbsp;<span class="ident" id="1829379">r</span><span class="op" id="1829380">,</span>&nbsp;<span class="ident" id="1829382">n</span><span class="op" id="1829383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829386">karatsubaAdd</span><span class="op" id="1829398">(</span><span class="ident" id="1829399">z</span><span class="op" id="1829400">[</span><span class="ident" id="1829401">n2</span><span class="op" id="1829403">:</span><span class="op" id="1829404">]</span><span class="op" id="1829405">,</span>&nbsp;<span class="ident" id="1829407">r</span><span class="op" id="1829408">[</span><span class="ident" id="1829409">n</span><span class="op" id="1829410">:</span><span class="op" id="1829411">]</span><span class="op" id="1829412">,</span>&nbsp;<span class="ident" id="1829414">n</span><span class="op" id="1829415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829418">if</span>&nbsp;<span class="ident" id="1829421">s</span>&nbsp;<span class="op" id="1829423">&gt;</span>&nbsp;<span class="num" id="1829425">0</span>&nbsp;<span class="op" id="1829427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829431">karatsubaAdd</span><span class="op" id="1829443">(</span><span class="ident" id="1829444">z</span><span class="op" id="1829445">[</span><span class="ident" id="1829446">n2</span><span class="op" id="1829448">:</span><span class="op" id="1829449">]</span><span class="op" id="1829450">,</span>&nbsp;<span class="ident" id="1829452">p</span><span class="op" id="1829453">,</span>&nbsp;<span class="ident" id="1829455">n</span><span class="op" id="1829456">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1829459">}</span>&nbsp;<span class="keyword" id="1829461">else</span>&nbsp;<span class="op" id="1829466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829470">karatsubaSub</span><span class="op" id="1829482">(</span><span class="ident" id="1829483">z</span><span class="op" id="1829484">[</span><span class="ident" id="1829485">n2</span><span class="op" id="1829487">:</span><span class="op" id="1829488">]</span><span class="op" id="1829489">,</span>&nbsp;<span class="ident" id="1829491">p</span><span class="op" id="1829492">,</span>&nbsp;<span class="ident" id="1829494">n</span><span class="op" id="1829495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1829498">}</span><br>
<span class="lineno"></span><span class="op" id="1829500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="1829503">//&nbsp;alias&nbsp;returns&nbsp;true&nbsp;if&nbsp;x&nbsp;and&nbsp;y&nbsp;share&nbsp;the&nbsp;same&nbsp;base&nbsp;array.</span><br>
<span class="lineno"></span><span class="keyword" id="1829563">func</span>&nbsp;<span class="ident" id="1829568">alias</span><span class="op" id="1829573">(</span><span class="ident" id="1829574">x</span><span class="op" id="1829575">,</span>&nbsp;<span class="ident" id="1829577">y</span>&nbsp;<span class="ident" id="1829579">nat</span><span class="op" id="1829582">)</span>&nbsp;<span class="builtintype" id="1829584">bool</span>&nbsp;<span class="op" id="1829589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829592">return</span>&nbsp;<span class="builtinfunc" id="1829599">cap</span><span class="op" id="1829602">(</span><span class="ident" id="1829603">x</span><span class="op" id="1829604">)</span>&nbsp;<span class="op" id="1829606">&gt;</span>&nbsp;<span class="num" id="1829608">0</span>&nbsp;<span class="op" id="1829610">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1829613">cap</span><span class="op" id="1829616">(</span><span class="ident" id="1829617">y</span><span class="op" id="1829618">)</span>&nbsp;<span class="op" id="1829620">&gt;</span>&nbsp;<span class="num" id="1829622">0</span>&nbsp;<span class="op" id="1829624">&amp;&amp;</span>&nbsp;<span class="op" id="1829627">&amp;</span><span class="ident" id="1829628">x</span><span class="op" id="1829629">[</span><span class="num" id="1829630">0</span><span class="op" id="1829631">:</span><span class="builtinfunc" id="1829632">cap</span><span class="op" id="1829635">(</span><span class="ident" id="1829636">x</span><span class="op" id="1829637">)</span><span class="op" id="1829638">]</span><span class="op" id="1829639">[</span><span class="builtinfunc" id="1829640">cap</span><span class="op" id="1829643">(</span><span class="ident" id="1829644">x</span><span class="op" id="1829645">)</span><span class="op" id="1829646">-</span><span class="num" id="1829647">1</span><span class="op" id="1829648">]</span>&nbsp;<span class="op" id="1829650">==</span>&nbsp;<span class="op" id="1829653">&amp;</span><span class="ident" id="1829654">y</span><span class="op" id="1829655">[</span><span class="num" id="1829656">0</span><span class="op" id="1829657">:</span><span class="builtinfunc" id="1829658">cap</span><span class="op" id="1829661">(</span><span class="ident" id="1829662">y</span><span class="op" id="1829663">)</span><span class="op" id="1829664">]</span><span class="op" id="1829665">[</span><span class="builtinfunc" id="1829666">cap</span><span class="op" id="1829669">(</span><span class="ident" id="1829670">y</span><span class="op" id="1829671">)</span><span class="op" id="1829672">-</span><span class="num" id="1829673">1</span><span class="op" id="1829674">]</span><br>
<span class="lineno"></span><span class="op" id="1829676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="1829679">//&nbsp;addAt&nbsp;implements&nbsp;z&nbsp;+=&nbsp;x&lt;&lt;(_W*i);&nbsp;z&nbsp;must&nbsp;be&nbsp;long&nbsp;enough.</span><br>
<span class="lineno"></span><span class="comment" id="1829738">//&nbsp;(we&nbsp;don&#39;t&nbsp;use&nbsp;nat.add&nbsp;because&nbsp;we&nbsp;need&nbsp;z&nbsp;to&nbsp;stay&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="1829798">//&nbsp;slice,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;normalize&nbsp;z&nbsp;after&nbsp;each&nbsp;addition)</span><br>
<span class="lineno"></span><span class="keyword" id="1829862">func</span>&nbsp;<span class="ident" id="1829867">addAt</span><span class="op" id="1829872">(</span><span class="ident" id="1829873">z</span><span class="op" id="1829874">,</span>&nbsp;<span class="ident" id="1829876">x</span>&nbsp;<span class="ident" id="1829878">nat</span><span class="op" id="1829881">,</span>&nbsp;<span class="ident" id="1829883">i</span>&nbsp;<span class="builtintype" id="1829885">int</span><span class="op" id="1829888">)</span>&nbsp;<span class="op" id="1829890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829893">if</span>&nbsp;<span class="ident" id="1829896">n</span>&nbsp;<span class="op" id="1829898">:=</span>&nbsp;<span class="builtinfunc" id="1829901">len</span><span class="op" id="1829904">(</span><span class="ident" id="1829905">x</span><span class="op" id="1829906">)</span><span class="op" id="1829907">;</span>&nbsp;<span class="ident" id="1829909">n</span>&nbsp;<span class="op" id="1829911">&gt;</span>&nbsp;<span class="num" id="1829913">0</span>&nbsp;<span class="op" id="1829915">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829919">if</span>&nbsp;<span class="ident" id="1829922">c</span>&nbsp;<span class="op" id="1829924">:=</span>&nbsp;<span class="ident" id="1829927">addVV</span><span class="op" id="1829932">(</span><span class="ident" id="1829933">z</span><span class="op" id="1829934">[</span><span class="ident" id="1829935">i</span><span class="op" id="1829936">:</span><span class="ident" id="1829937">i</span><span class="op" id="1829938">+</span><span class="ident" id="1829939">n</span><span class="op" id="1829940">]</span><span class="op" id="1829941">,</span>&nbsp;<span class="ident" id="1829943">z</span><span class="op" id="1829944">[</span><span class="ident" id="1829945">i</span><span class="op" id="1829946">:</span><span class="op" id="1829947">]</span><span class="op" id="1829948">,</span>&nbsp;<span class="ident" id="1829950">x</span><span class="op" id="1829951">)</span><span class="op" id="1829952">;</span>&nbsp;<span class="ident" id="1829954">c</span>&nbsp;<span class="op" id="1829956">!=</span>&nbsp;<span class="num" id="1829959">0</span>&nbsp;<span class="op" id="1829961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829966">j</span>&nbsp;<span class="op" id="1829968">:=</span>&nbsp;<span class="ident" id="1829971">i</span>&nbsp;<span class="op" id="1829973">+</span>&nbsp;<span class="ident" id="1829975">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829980">if</span>&nbsp;<span class="ident" id="1829983">j</span>&nbsp;<span class="op" id="1829985">&lt;</span>&nbsp;<span class="builtinfunc" id="1829987">len</span><span class="op" id="1829990">(</span><span class="ident" id="1829991">z</span><span class="op" id="1829992">)</span>&nbsp;<span class="op" id="1829994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830000">addVW</span><span class="op" id="1830005">(</span><span class="ident" id="1830006">z</span><span class="op" id="1830007">[</span><span class="ident" id="1830008">j</span><span class="op" id="1830009">:</span><span class="op" id="1830010">]</span><span class="op" id="1830011">,</span>&nbsp;<span class="ident" id="1830013">z</span><span class="op" id="1830014">[</span><span class="ident" id="1830015">j</span><span class="op" id="1830016">:</span><span class="op" id="1830017">]</span><span class="op" id="1830018">,</span>&nbsp;<span class="ident" id="1830020">c</span><span class="op" id="1830021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830026">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830033">}</span><br>
<span class="lineno"></span><span class="op" id="1830035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1830038">func</span>&nbsp;<span class="ident" id="1830043">max</span><span class="op" id="1830046">(</span><span class="ident" id="1830047">x</span><span class="op" id="1830048">,</span>&nbsp;<span class="ident" id="1830050">y</span>&nbsp;<span class="builtintype" id="1830052">int</span><span class="op" id="1830055">)</span>&nbsp;<span class="builtintype" id="1830057">int</span>&nbsp;<span class="op" id="1830061">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830064">if</span>&nbsp;<span class="ident" id="1830067">x</span>&nbsp;<span class="op" id="1830069">&gt;</span>&nbsp;<span class="ident" id="1830071">y</span>&nbsp;<span class="op" id="1830073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830077">return</span>&nbsp;<span class="ident" id="1830084">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830090">return</span>&nbsp;<span class="ident" id="1830097">y</span><br>
<span class="lineno"></span><span class="op" id="1830099">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="comment" id="1830102">//&nbsp;karatsubaLen&nbsp;computes&nbsp;an&nbsp;approximation&nbsp;to&nbsp;the&nbsp;maximum&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="1830176">//&nbsp;k&nbsp;=&nbsp;p&lt;&lt;i&nbsp;for&nbsp;a&nbsp;number&nbsp;p&nbsp;&lt;=&nbsp;karatsubaThreshold&nbsp;and&nbsp;an&nbsp;i&nbsp;&gt;=&nbsp;0.&nbsp;Thus,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1830250">//&nbsp;result&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;that&nbsp;can&nbsp;be&nbsp;divided&nbsp;repeatedly&nbsp;by&nbsp;2&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="1830325">//&nbsp;becoming&nbsp;about&nbsp;the&nbsp;value&nbsp;of&nbsp;karatsubaThreshold.</span><br>
<span class="lineno">370</span><span class="keyword" id="1830376">func</span>&nbsp;<span class="ident" id="1830381">karatsubaLen</span><span class="op" id="1830393">(</span><span class="ident" id="1830394">n</span>&nbsp;<span class="builtintype" id="1830396">int</span><span class="op" id="1830399">)</span>&nbsp;<span class="builtintype" id="1830401">int</span>&nbsp;<span class="op" id="1830405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830408">i</span>&nbsp;<span class="op" id="1830410">:=</span>&nbsp;<span class="builtintype" id="1830413">uint</span><span class="op" id="1830417">(</span><span class="num" id="1830418">0</span><span class="op" id="1830419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830422">for</span>&nbsp;<span class="ident" id="1830426">n</span>&nbsp;<span class="op" id="1830428">&gt;</span>&nbsp;<span class="ident" id="1830430">karatsubaThreshold</span>&nbsp;<span class="op" id="1830449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830453">n</span>&nbsp;<span class="op" id="1830455">&gt;&gt;=</span>&nbsp;<span class="num" id="1830459">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830463">i</span><span class="op" id="1830464">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830471">return</span>&nbsp;<span class="ident" id="1830478">n</span>&nbsp;<span class="op" id="1830480">&lt;&lt;</span>&nbsp;<span class="ident" id="1830483">i</span><br>
<span class="lineno"></span><span class="op" id="1830485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1830488">func</span>&nbsp;<span class="op" id="1830493">(</span><span class="ident" id="1830494">z</span>&nbsp;<span class="ident" id="1830496">nat</span><span class="op" id="1830499">)</span>&nbsp;<span class="ident" id="1830501">mul</span><span class="op" id="1830504">(</span><span class="ident" id="1830505">x</span><span class="op" id="1830506">,</span>&nbsp;<span class="ident" id="1830508">y</span>&nbsp;<span class="ident" id="1830510">nat</span><span class="op" id="1830513">)</span>&nbsp;<span class="ident" id="1830515">nat</span>&nbsp;<span class="op" id="1830519">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830522">m</span>&nbsp;<span class="op" id="1830524">:=</span>&nbsp;<span class="builtinfunc" id="1830527">len</span><span class="op" id="1830530">(</span><span class="ident" id="1830531">x</span><span class="op" id="1830532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830535">n</span>&nbsp;<span class="op" id="1830537">:=</span>&nbsp;<span class="builtinfunc" id="1830540">len</span><span class="op" id="1830543">(</span><span class="ident" id="1830544">y</span><span class="op" id="1830545">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830549">switch</span>&nbsp;<span class="op" id="1830556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830559">case</span>&nbsp;<span class="ident" id="1830564">m</span>&nbsp;<span class="op" id="1830566">&lt;</span>&nbsp;<span class="ident" id="1830568">n</span><span class="op" id="1830569">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830573">return</span>&nbsp;<span class="ident" id="1830580">z</span><span class="op" id="1830581">.</span><span class="ident" id="1830582">mul</span><span class="op" id="1830585">(</span><span class="ident" id="1830586">y</span><span class="op" id="1830587">,</span>&nbsp;<span class="ident" id="1830589">x</span><span class="op" id="1830590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830593">case</span>&nbsp;<span class="ident" id="1830598">m</span>&nbsp;<span class="op" id="1830600">==</span>&nbsp;<span class="num" id="1830603">0</span>&nbsp;<span class="op" id="1830605">||</span>&nbsp;<span class="ident" id="1830608">n</span>&nbsp;<span class="op" id="1830610">==</span>&nbsp;<span class="num" id="1830613">0</span><span class="op" id="1830614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830618">return</span>&nbsp;<span class="ident" id="1830625">z</span><span class="op" id="1830626">.</span><span class="builtinfunc" id="1830627">make</span><span class="op" id="1830631">(</span><span class="num" id="1830632">0</span><span class="op" id="1830633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830636">case</span>&nbsp;<span class="ident" id="1830641">n</span>&nbsp;<span class="op" id="1830643">==</span>&nbsp;<span class="num" id="1830646">1</span><span class="op" id="1830647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830651">return</span>&nbsp;<span class="ident" id="1830658">z</span><span class="op" id="1830659">.</span><span class="ident" id="1830660">mulAddWW</span><span class="op" id="1830668">(</span><span class="ident" id="1830669">x</span><span class="op" id="1830670">,</span>&nbsp;<span class="ident" id="1830672">y</span><span class="op" id="1830673">[</span><span class="num" id="1830674">0</span><span class="op" id="1830675">]</span><span class="op" id="1830676">,</span>&nbsp;<span class="num" id="1830678">0</span><span class="op" id="1830679">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830685">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830701">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830734">if</span>&nbsp;<span class="ident" id="1830737">alias</span><span class="op" id="1830742">(</span><span class="ident" id="1830743">z</span><span class="op" id="1830744">,</span>&nbsp;<span class="ident" id="1830746">x</span><span class="op" id="1830747">)</span>&nbsp;<span class="op" id="1830749">||</span>&nbsp;<span class="ident" id="1830752">alias</span><span class="op" id="1830757">(</span><span class="ident" id="1830758">z</span><span class="op" id="1830759">,</span>&nbsp;<span class="ident" id="1830761">y</span><span class="op" id="1830762">)</span>&nbsp;<span class="op" id="1830764">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830768">z</span>&nbsp;<span class="op" id="1830770">=</span>&nbsp;<span class="ident" id="1830772">nil</span>&nbsp;<span class="comment" id="1830776">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830824">//&nbsp;use&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;the&nbsp;numbers&nbsp;are&nbsp;small</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830878">if</span>&nbsp;<span class="ident" id="1830881">n</span>&nbsp;<span class="op" id="1830883">&lt;</span>&nbsp;<span class="ident" id="1830885">karatsubaThreshold</span>&nbsp;<span class="op" id="1830904">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830908">z</span>&nbsp;<span class="op" id="1830910">=</span>&nbsp;<span class="ident" id="1830912">z</span><span class="op" id="1830913">.</span><span class="builtinfunc" id="1830914">make</span><span class="op" id="1830918">(</span><span class="ident" id="1830919">m</span>&nbsp;<span class="op" id="1830921">+</span>&nbsp;<span class="ident" id="1830923">n</span><span class="op" id="1830924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830928">basicMul</span><span class="op" id="1830936">(</span><span class="ident" id="1830937">z</span><span class="op" id="1830938">,</span>&nbsp;<span class="ident" id="1830940">x</span><span class="op" id="1830941">,</span>&nbsp;<span class="ident" id="1830943">y</span><span class="op" id="1830944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830948">return</span>&nbsp;<span class="ident" id="1830955">z</span><span class="op" id="1830956">.</span><span class="ident" id="1830957">norm</span><span class="op" id="1830961">(</span><span class="op" id="1830962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830968">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831017">//&nbsp;determine&nbsp;Karatsuba&nbsp;length&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831060">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831064">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;xh*b&nbsp;+&nbsp;x0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;x0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831099">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;yh*b&nbsp;+&nbsp;y0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;y0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831134">//&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;1&lt;&lt;(_W*k)&nbsp;&nbsp;(&#34;base&#34;&nbsp;of&nbsp;digits&nbsp;xi,&nbsp;yi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831181">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831185">k</span>&nbsp;<span class="op" id="1831187">:=</span>&nbsp;<span class="ident" id="1831190">karatsubaLen</span><span class="op" id="1831202">(</span><span class="ident" id="1831203">n</span><span class="op" id="1831204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831207">//&nbsp;k&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831219">//&nbsp;multiply&nbsp;x0&nbsp;and&nbsp;y0&nbsp;via&nbsp;Karatsuba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831256">x0</span>&nbsp;<span class="op" id="1831259">:=</span>&nbsp;<span class="ident" id="1831262">x</span><span class="op" id="1831263">[</span><span class="num" id="1831264">0</span><span class="op" id="1831265">:</span><span class="ident" id="1831266">k</span><span class="op" id="1831267">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1831282">//&nbsp;x0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831307">y0</span>&nbsp;<span class="op" id="1831310">:=</span>&nbsp;<span class="ident" id="1831313">y</span><span class="op" id="1831314">[</span><span class="num" id="1831315">0</span><span class="op" id="1831316">:</span><span class="ident" id="1831317">k</span><span class="op" id="1831318">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1831333">//&nbsp;y0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831358">z</span>&nbsp;<span class="op" id="1831360">=</span>&nbsp;<span class="ident" id="1831362">z</span><span class="op" id="1831363">.</span><span class="builtinfunc" id="1831364">make</span><span class="op" id="1831368">(</span><span class="ident" id="1831369">max</span><span class="op" id="1831372">(</span><span class="num" id="1831373">6</span><span class="op" id="1831374">*</span><span class="ident" id="1831375">k</span><span class="op" id="1831376">,</span>&nbsp;<span class="ident" id="1831378">m</span><span class="op" id="1831379">+</span><span class="ident" id="1831380">n</span><span class="op" id="1831381">)</span><span class="op" id="1831382">)</span>&nbsp;<span class="comment" id="1831384">//&nbsp;enough&nbsp;space&nbsp;for&nbsp;karatsuba&nbsp;of&nbsp;x0*y0&nbsp;and&nbsp;full&nbsp;result&nbsp;of&nbsp;x*y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831447">karatsuba</span><span class="op" id="1831456">(</span><span class="ident" id="1831457">z</span><span class="op" id="1831458">,</span>&nbsp;<span class="ident" id="1831460">x0</span><span class="op" id="1831462">,</span>&nbsp;<span class="ident" id="1831464">y0</span><span class="op" id="1831466">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831469">z</span>&nbsp;<span class="op" id="1831471">=</span>&nbsp;<span class="ident" id="1831473">z</span><span class="op" id="1831474">[</span><span class="num" id="1831475">0</span>&nbsp;<span class="op" id="1831477">:</span>&nbsp;<span class="ident" id="1831479">m</span><span class="op" id="1831480">+</span><span class="ident" id="1831481">n</span><span class="op" id="1831482">]</span>&nbsp;&nbsp;<span class="comment" id="1831485">//&nbsp;z&nbsp;has&nbsp;final&nbsp;length&nbsp;but&nbsp;may&nbsp;be&nbsp;incomplete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831530">z</span><span class="op" id="1831531">[</span><span class="num" id="1831532">2</span><span class="op" id="1831533">*</span><span class="ident" id="1831534">k</span><span class="op" id="1831535">:</span><span class="op" id="1831536">]</span><span class="op" id="1831537">.</span><span class="ident" id="1831538">clear</span><span class="op" id="1831543">(</span><span class="op" id="1831544">)</span>&nbsp;<span class="comment" id="1831546">//&nbsp;upper&nbsp;portion&nbsp;of&nbsp;z&nbsp;is&nbsp;garbage&nbsp;(and&nbsp;2*k&nbsp;&lt;=&nbsp;m+n&nbsp;since&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;m)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831616">//&nbsp;If&nbsp;xh&nbsp;!=&nbsp;0&nbsp;or&nbsp;yh&nbsp;!=&nbsp;0,&nbsp;add&nbsp;the&nbsp;missing&nbsp;terms&nbsp;to&nbsp;z.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831675">//</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831679">//&nbsp;&nbsp;&nbsp;xh&nbsp;=&nbsp;xi*b^i&nbsp;+&nbsp;...&nbsp;+&nbsp;x2*b^2&nbsp;+&nbsp;x1*b&nbsp;(0&nbsp;&lt;=&nbsp;xi&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831733">//&nbsp;&nbsp;&nbsp;yh&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1*b&nbsp;(0&nbsp;&lt;=&nbsp;y1&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831787">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831791">//&nbsp;the&nbsp;missing&nbsp;terms&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831817">//</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831821">//&nbsp;&nbsp;&nbsp;x0*y1*b&nbsp;and&nbsp;xi*y0*b^i,&nbsp;xi*y1*b^(i+1)&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831874">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831878">//&nbsp;since&nbsp;all&nbsp;the&nbsp;yi&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;1&nbsp;are&nbsp;0&nbsp;by&nbsp;choice&nbsp;of&nbsp;k:&nbsp;If&nbsp;any&nbsp;of&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831946">//&nbsp;were&nbsp;&gt;&nbsp;0,&nbsp;then&nbsp;yh&nbsp;&gt;=&nbsp;b^2&nbsp;and&nbsp;thus&nbsp;y&nbsp;&gt;=&nbsp;b^2.&nbsp;Then&nbsp;k&#39;&nbsp;=&nbsp;k*2&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1832014">//&nbsp;be&nbsp;a&nbsp;larger&nbsp;valid&nbsp;threshold&nbsp;contradicting&nbsp;the&nbsp;assumption&nbsp;about&nbsp;k.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1832084">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832088">if</span>&nbsp;<span class="ident" id="1832091">k</span>&nbsp;<span class="op" id="1832093">&lt;</span>&nbsp;<span class="ident" id="1832095">n</span>&nbsp;<span class="op" id="1832097">||</span>&nbsp;<span class="ident" id="1832100">m</span>&nbsp;<span class="op" id="1832102">!=</span>&nbsp;<span class="ident" id="1832105">n</span>&nbsp;<span class="op" id="1832107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832111">var</span>&nbsp;<span class="ident" id="1832115">t</span>&nbsp;<span class="ident" id="1832117">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1832124">//&nbsp;add&nbsp;x0*y1*b</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832141">x0</span>&nbsp;<span class="op" id="1832144">:=</span>&nbsp;<span class="ident" id="1832147">x0</span><span class="op" id="1832149">.</span><span class="ident" id="1832150">norm</span><span class="op" id="1832154">(</span><span class="op" id="1832155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832159">y1</span>&nbsp;<span class="op" id="1832162">:=</span>&nbsp;<span class="ident" id="1832165">y</span><span class="op" id="1832166">[</span><span class="ident" id="1832167">k</span><span class="op" id="1832168">:</span><span class="op" id="1832169">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1832177">//&nbsp;y1&nbsp;is&nbsp;normalized&nbsp;because&nbsp;y&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832212">t</span>&nbsp;<span class="op" id="1832214">=</span>&nbsp;<span class="ident" id="1832216">t</span><span class="op" id="1832217">.</span><span class="ident" id="1832218">mul</span><span class="op" id="1832221">(</span><span class="ident" id="1832222">x0</span><span class="op" id="1832224">,</span>&nbsp;<span class="ident" id="1832226">y1</span><span class="op" id="1832228">)</span>&nbsp;<span class="comment" id="1832230">//&nbsp;update&nbsp;t&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;t&#39;s&nbsp;underlying&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832282">addAt</span><span class="op" id="1832287">(</span><span class="ident" id="1832288">z</span><span class="op" id="1832289">,</span>&nbsp;<span class="ident" id="1832291">t</span><span class="op" id="1832292">,</span>&nbsp;<span class="ident" id="1832294">k</span><span class="op" id="1832295">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1832300">//&nbsp;add&nbsp;xi*y0&lt;&lt;i,&nbsp;xi*y1*b&lt;&lt;(i+k)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832334">y0</span>&nbsp;<span class="op" id="1832337">:=</span>&nbsp;<span class="ident" id="1832340">y0</span><span class="op" id="1832342">.</span><span class="ident" id="1832343">norm</span><span class="op" id="1832347">(</span><span class="op" id="1832348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832352">for</span>&nbsp;<span class="ident" id="1832356">i</span>&nbsp;<span class="op" id="1832358">:=</span>&nbsp;<span class="ident" id="1832361">k</span><span class="op" id="1832362">;</span>&nbsp;<span class="ident" id="1832364">i</span>&nbsp;<span class="op" id="1832366">&lt;</span>&nbsp;<span class="builtinfunc" id="1832368">len</span><span class="op" id="1832371">(</span><span class="ident" id="1832372">x</span><span class="op" id="1832373">)</span><span class="op" id="1832374">;</span>&nbsp;<span class="ident" id="1832376">i</span>&nbsp;<span class="op" id="1832378">+=</span>&nbsp;<span class="ident" id="1832381">k</span>&nbsp;<span class="op" id="1832383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832388">xi</span>&nbsp;<span class="op" id="1832391">:=</span>&nbsp;<span class="ident" id="1832394">x</span><span class="op" id="1832395">[</span><span class="ident" id="1832396">i</span><span class="op" id="1832397">:</span><span class="op" id="1832398">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832403">if</span>&nbsp;<span class="builtinfunc" id="1832406">len</span><span class="op" id="1832409">(</span><span class="ident" id="1832410">xi</span><span class="op" id="1832412">)</span>&nbsp;<span class="op" id="1832414">&gt;</span>&nbsp;<span class="ident" id="1832416">k</span>&nbsp;<span class="op" id="1832418">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832424">xi</span>&nbsp;<span class="op" id="1832427">=</span>&nbsp;<span class="ident" id="1832429">xi</span><span class="op" id="1832431">[</span><span class="op" id="1832432">:</span><span class="ident" id="1832433">k</span><span class="op" id="1832434">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1832439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832444">xi</span>&nbsp;<span class="op" id="1832447">=</span>&nbsp;<span class="ident" id="1832449">xi</span><span class="op" id="1832451">.</span><span class="ident" id="1832452">norm</span><span class="op" id="1832456">(</span><span class="op" id="1832457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832462">t</span>&nbsp;<span class="op" id="1832464">=</span>&nbsp;<span class="ident" id="1832466">t</span><span class="op" id="1832467">.</span><span class="ident" id="1832468">mul</span><span class="op" id="1832471">(</span><span class="ident" id="1832472">xi</span><span class="op" id="1832474">,</span>&nbsp;<span class="ident" id="1832476">y0</span><span class="op" id="1832478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832483">addAt</span><span class="op" id="1832488">(</span><span class="ident" id="1832489">z</span><span class="op" id="1832490">,</span>&nbsp;<span class="ident" id="1832492">t</span><span class="op" id="1832493">,</span>&nbsp;<span class="ident" id="1832495">i</span><span class="op" id="1832496">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832501">t</span>&nbsp;<span class="op" id="1832503">=</span>&nbsp;<span class="ident" id="1832505">t</span><span class="op" id="1832506">.</span><span class="ident" id="1832507">mul</span><span class="op" id="1832510">(</span><span class="ident" id="1832511">xi</span><span class="op" id="1832513">,</span>&nbsp;<span class="ident" id="1832515">y1</span><span class="op" id="1832517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832522">addAt</span><span class="op" id="1832527">(</span><span class="ident" id="1832528">z</span><span class="op" id="1832529">,</span>&nbsp;<span class="ident" id="1832531">t</span><span class="op" id="1832532">,</span>&nbsp;<span class="ident" id="1832534">i</span><span class="op" id="1832535">+</span><span class="ident" id="1832536">k</span><span class="op" id="1832537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1832541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1832544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832548">return</span>&nbsp;<span class="ident" id="1832555">z</span><span class="op" id="1832556">.</span><span class="ident" id="1832557">norm</span><span class="op" id="1832561">(</span><span class="op" id="1832562">)</span><br>
<span class="lineno"></span><span class="op" id="1832564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1832567">//&nbsp;mulRange&nbsp;computes&nbsp;the&nbsp;product&nbsp;of&nbsp;all&nbsp;the&nbsp;unsigned&nbsp;integers&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1832636">//&nbsp;range&nbsp;[a,&nbsp;b]&nbsp;inclusively.&nbsp;If&nbsp;a&nbsp;&gt;&nbsp;b&nbsp;(empty&nbsp;range),&nbsp;the&nbsp;result&nbsp;is&nbsp;1.</span><br>
<span class="lineno">465</span><span class="keyword" id="1832706">func</span>&nbsp;<span class="op" id="1832711">(</span><span class="ident" id="1832712">z</span>&nbsp;<span class="ident" id="1832714">nat</span><span class="op" id="1832717">)</span>&nbsp;<span class="ident" id="1832719">mulRange</span><span class="op" id="1832727">(</span><span class="ident" id="1832728">a</span><span class="op" id="1832729">,</span>&nbsp;<span class="ident" id="1832731">b</span>&nbsp;<span class="ident" id="1832733">uint64</span><span class="op" id="1832739">)</span>&nbsp;<span class="ident" id="1832741">nat</span>&nbsp;<span class="op" id="1832745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832748">switch</span>&nbsp;<span class="op" id="1832755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832758">case</span>&nbsp;<span class="ident" id="1832763">a</span>&nbsp;<span class="op" id="1832765">==</span>&nbsp;<span class="num" id="1832768">0</span><span class="op" id="1832769">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1832773">//&nbsp;cut&nbsp;long&nbsp;ranges&nbsp;short&nbsp;(optimization)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832815">return</span>&nbsp;<span class="ident" id="1832822">z</span><span class="op" id="1832823">.</span><span class="ident" id="1832824">setUint64</span><span class="op" id="1832833">(</span><span class="num" id="1832834">0</span><span class="op" id="1832835">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832838">case</span>&nbsp;<span class="ident" id="1832843">a</span>&nbsp;<span class="op" id="1832845">&gt;</span>&nbsp;<span class="ident" id="1832847">b</span><span class="op" id="1832848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832852">return</span>&nbsp;<span class="ident" id="1832859">z</span><span class="op" id="1832860">.</span><span class="ident" id="1832861">setUint64</span><span class="op" id="1832870">(</span><span class="num" id="1832871">1</span><span class="op" id="1832872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832875">case</span>&nbsp;<span class="ident" id="1832880">a</span>&nbsp;<span class="op" id="1832882">==</span>&nbsp;<span class="ident" id="1832885">b</span><span class="op" id="1832886">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832890">return</span>&nbsp;<span class="ident" id="1832897">z</span><span class="op" id="1832898">.</span><span class="ident" id="1832899">setUint64</span><span class="op" id="1832908">(</span><span class="ident" id="1832909">a</span><span class="op" id="1832910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832913">case</span>&nbsp;<span class="ident" id="1832918">a</span><span class="op" id="1832919">+</span><span class="num" id="1832920">1</span>&nbsp;<span class="op" id="1832922">==</span>&nbsp;<span class="ident" id="1832925">b</span><span class="op" id="1832926">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832930">return</span>&nbsp;<span class="ident" id="1832937">z</span><span class="op" id="1832938">.</span><span class="ident" id="1832939">mul</span><span class="op" id="1832942">(</span><span class="ident" id="1832943">nat</span><span class="op" id="1832946">(</span><span class="ident" id="1832947">nil</span><span class="op" id="1832950">)</span><span class="op" id="1832951">.</span><span class="ident" id="1832952">setUint64</span><span class="op" id="1832961">(</span><span class="ident" id="1832962">a</span><span class="op" id="1832963">)</span><span class="op" id="1832964">,</span>&nbsp;<span class="ident" id="1832966">nat</span><span class="op" id="1832969">(</span><span class="ident" id="1832970">nil</span><span class="op" id="1832973">)</span><span class="op" id="1832974">.</span><span class="ident" id="1832975">setUint64</span><span class="op" id="1832984">(</span><span class="ident" id="1832985">b</span><span class="op" id="1832986">)</span><span class="op" id="1832987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1832990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832993">m</span>&nbsp;<span class="op" id="1832995">:=</span>&nbsp;<span class="op" id="1832998">(</span><span class="ident" id="1832999">a</span>&nbsp;<span class="op" id="1833001">+</span>&nbsp;<span class="ident" id="1833003">b</span><span class="op" id="1833004">)</span>&nbsp;<span class="op" id="1833006">/</span>&nbsp;<span class="num" id="1833008">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833011">return</span>&nbsp;<span class="ident" id="1833018">z</span><span class="op" id="1833019">.</span><span class="ident" id="1833020">mul</span><span class="op" id="1833023">(</span><span class="ident" id="1833024">nat</span><span class="op" id="1833027">(</span><span class="ident" id="1833028">nil</span><span class="op" id="1833031">)</span><span class="op" id="1833032">.</span><span class="ident" id="1833033">mulRange</span><span class="op" id="1833041">(</span><span class="ident" id="1833042">a</span><span class="op" id="1833043">,</span>&nbsp;<span class="ident" id="1833045">m</span><span class="op" id="1833046">)</span><span class="op" id="1833047">,</span>&nbsp;<span class="ident" id="1833049">nat</span><span class="op" id="1833052">(</span><span class="ident" id="1833053">nil</span><span class="op" id="1833056">)</span><span class="op" id="1833057">.</span><span class="ident" id="1833058">mulRange</span><span class="op" id="1833066">(</span><span class="ident" id="1833067">m</span><span class="op" id="1833068">+</span><span class="num" id="1833069">1</span><span class="op" id="1833070">,</span>&nbsp;<span class="ident" id="1833072">b</span><span class="op" id="1833073">)</span><span class="op" id="1833074">)</span><br>
<span class="lineno"></span><span class="op" id="1833076">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="1833079">//&nbsp;q&nbsp;=&nbsp;(x-r)/y,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="keyword" id="1833111">func</span>&nbsp;<span class="op" id="1833116">(</span><span class="ident" id="1833117">z</span>&nbsp;<span class="ident" id="1833119">nat</span><span class="op" id="1833122">)</span>&nbsp;<span class="ident" id="1833124">divW</span><span class="op" id="1833128">(</span><span class="ident" id="1833129">x</span>&nbsp;<span class="ident" id="1833131">nat</span><span class="op" id="1833134">,</span>&nbsp;<span class="ident" id="1833136">y</span>&nbsp;<span class="ident" id="1833138">Word</span><span class="op" id="1833142">)</span>&nbsp;<span class="op" id="1833144">(</span><span class="ident" id="1833145">q</span>&nbsp;<span class="ident" id="1833147">nat</span><span class="op" id="1833150">,</span>&nbsp;<span class="ident" id="1833152">r</span>&nbsp;<span class="ident" id="1833154">Word</span><span class="op" id="1833158">)</span>&nbsp;<span class="op" id="1833160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833163">m</span>&nbsp;<span class="op" id="1833165">:=</span>&nbsp;<span class="builtinfunc" id="1833168">len</span><span class="op" id="1833171">(</span><span class="ident" id="1833172">x</span><span class="op" id="1833173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833176">switch</span>&nbsp;<span class="op" id="1833183">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833186">case</span>&nbsp;<span class="ident" id="1833191">y</span>&nbsp;<span class="op" id="1833193">==</span>&nbsp;<span class="num" id="1833196">0</span><span class="op" id="1833197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1833201">panic</span><span class="op" id="1833206">(</span><span class="string" id="1833207">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1833225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833228">case</span>&nbsp;<span class="ident" id="1833233">y</span>&nbsp;<span class="op" id="1833235">==</span>&nbsp;<span class="num" id="1833238">1</span><span class="op" id="1833239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833243">q</span>&nbsp;<span class="op" id="1833245">=</span>&nbsp;<span class="ident" id="1833247">z</span><span class="op" id="1833248">.</span><span class="ident" id="1833249">set</span><span class="op" id="1833252">(</span><span class="ident" id="1833253">x</span><span class="op" id="1833254">)</span>&nbsp;<span class="comment" id="1833256">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833273">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833281">case</span>&nbsp;<span class="ident" id="1833286">m</span>&nbsp;<span class="op" id="1833288">==</span>&nbsp;<span class="num" id="1833291">0</span><span class="op" id="1833292">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833296">q</span>&nbsp;<span class="op" id="1833298">=</span>&nbsp;<span class="ident" id="1833300">z</span><span class="op" id="1833301">.</span><span class="builtinfunc" id="1833302">make</span><span class="op" id="1833306">(</span><span class="num" id="1833307">0</span><span class="op" id="1833308">)</span>&nbsp;<span class="comment" id="1833310">//&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833327">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1833335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1833338">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833348">z</span>&nbsp;<span class="op" id="1833350">=</span>&nbsp;<span class="ident" id="1833352">z</span><span class="op" id="1833353">.</span><span class="builtinfunc" id="1833354">make</span><span class="op" id="1833358">(</span><span class="ident" id="1833359">m</span><span class="op" id="1833360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833363">r</span>&nbsp;<span class="op" id="1833365">=</span>&nbsp;<span class="ident" id="1833367">divWVW</span><span class="op" id="1833373">(</span><span class="ident" id="1833374">z</span><span class="op" id="1833375">,</span>&nbsp;<span class="num" id="1833377">0</span><span class="op" id="1833378">,</span>&nbsp;<span class="ident" id="1833380">x</span><span class="op" id="1833381">,</span>&nbsp;<span class="ident" id="1833383">y</span><span class="op" id="1833384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833387">q</span>&nbsp;<span class="op" id="1833389">=</span>&nbsp;<span class="ident" id="1833391">z</span><span class="op" id="1833392">.</span><span class="ident" id="1833393">norm</span><span class="op" id="1833397">(</span><span class="op" id="1833398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833401">return</span><br>
<span class="lineno"></span><span class="op" id="1833408">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="1833411">func</span>&nbsp;<span class="op" id="1833416">(</span><span class="ident" id="1833417">z</span>&nbsp;<span class="ident" id="1833419">nat</span><span class="op" id="1833422">)</span>&nbsp;<span class="ident" id="1833424">div</span><span class="op" id="1833427">(</span><span class="ident" id="1833428">z2</span><span class="op" id="1833430">,</span>&nbsp;<span class="ident" id="1833432">u</span><span class="op" id="1833433">,</span>&nbsp;<span class="ident" id="1833435">v</span>&nbsp;<span class="ident" id="1833437">nat</span><span class="op" id="1833440">)</span>&nbsp;<span class="op" id="1833442">(</span><span class="ident" id="1833443">q</span><span class="op" id="1833444">,</span>&nbsp;<span class="ident" id="1833446">r</span>&nbsp;<span class="ident" id="1833448">nat</span><span class="op" id="1833451">)</span>&nbsp;<span class="op" id="1833453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833456">if</span>&nbsp;<span class="builtinfunc" id="1833459">len</span><span class="op" id="1833462">(</span><span class="ident" id="1833463">v</span><span class="op" id="1833464">)</span>&nbsp;<span class="op" id="1833466">==</span>&nbsp;<span class="num" id="1833469">0</span>&nbsp;<span class="op" id="1833471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1833475">panic</span><span class="op" id="1833480">(</span><span class="string" id="1833481">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1833499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1833502">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833506">if</span>&nbsp;<span class="ident" id="1833509">u</span><span class="op" id="1833510">.</span><span class="ident" id="1833511">cmp</span><span class="op" id="1833514">(</span><span class="ident" id="1833515">v</span><span class="op" id="1833516">)</span>&nbsp;<span class="op" id="1833518">&lt;</span>&nbsp;<span class="num" id="1833520">0</span>&nbsp;<span class="op" id="1833522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833526">q</span>&nbsp;<span class="op" id="1833528">=</span>&nbsp;<span class="ident" id="1833530">z</span><span class="op" id="1833531">.</span><span class="builtinfunc" id="1833532">make</span><span class="op" id="1833536">(</span><span class="num" id="1833537">0</span><span class="op" id="1833538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833542">r</span>&nbsp;<span class="op" id="1833544">=</span>&nbsp;<span class="ident" id="1833546">z2</span><span class="op" id="1833548">.</span><span class="ident" id="1833549">set</span><span class="op" id="1833552">(</span><span class="ident" id="1833553">u</span><span class="op" id="1833554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833558">return</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1833566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833570">if</span>&nbsp;<span class="builtinfunc" id="1833573">len</span><span class="op" id="1833576">(</span><span class="ident" id="1833577">v</span><span class="op" id="1833578">)</span>&nbsp;<span class="op" id="1833580">==</span>&nbsp;<span class="num" id="1833583">1</span>&nbsp;<span class="op" id="1833585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833589">var</span>&nbsp;<span class="ident" id="1833593">r2</span>&nbsp;<span class="ident" id="1833596">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833603">q</span><span class="op" id="1833604">,</span>&nbsp;<span class="ident" id="1833606">r2</span>&nbsp;<span class="op" id="1833609">=</span>&nbsp;<span class="ident" id="1833611">z</span><span class="op" id="1833612">.</span><span class="ident" id="1833613">divW</span><span class="op" id="1833617">(</span><span class="ident" id="1833618">u</span><span class="op" id="1833619">,</span>&nbsp;<span class="ident" id="1833621">v</span><span class="op" id="1833622">[</span><span class="num" id="1833623">0</span><span class="op" id="1833624">]</span><span class="op" id="1833625">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833629">r</span>&nbsp;<span class="op" id="1833631">=</span>&nbsp;<span class="ident" id="1833633">z2</span><span class="op" id="1833635">.</span><span class="ident" id="1833636">setWord</span><span class="op" id="1833643">(</span><span class="ident" id="1833644">r2</span><span class="op" id="1833646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833650">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1833658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833662">q</span><span class="op" id="1833663">,</span>&nbsp;<span class="ident" id="1833665">r</span>&nbsp;<span class="op" id="1833667">=</span>&nbsp;<span class="ident" id="1833669">z</span><span class="op" id="1833670">.</span><span class="ident" id="1833671">divLarge</span><span class="op" id="1833679">(</span><span class="ident" id="1833680">z2</span><span class="op" id="1833682">,</span>&nbsp;<span class="ident" id="1833684">u</span><span class="op" id="1833685">,</span>&nbsp;<span class="ident" id="1833687">v</span><span class="op" id="1833688">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1833691">return</span><br>
<span class="lineno"></span><span class="op" id="1833698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1833701">//&nbsp;q&nbsp;=&nbsp;(uIn-r)/v,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="1833735">//&nbsp;Uses&nbsp;z&nbsp;as&nbsp;storage&nbsp;for&nbsp;q,&nbsp;and&nbsp;u&nbsp;as&nbsp;storage&nbsp;for&nbsp;r&nbsp;if&nbsp;possible.</span><br>
<span class="lineno">525</span><span class="comment" id="1833799">//&nbsp;See&nbsp;Knuth,&nbsp;Volume&nbsp;2,&nbsp;section&nbsp;4.3.1,&nbsp;Algorithm&nbsp;D.</span><br>
<span class="lineno"></span><span class="comment" id="1833851">//&nbsp;Preconditions:</span><br>
<span class="lineno"></span><span class="comment" id="1833869">//&nbsp;&nbsp;&nbsp;&nbsp;len(v)&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="1833887">//&nbsp;&nbsp;&nbsp;&nbsp;len(uIn)&nbsp;&gt;=&nbsp;len(v)</span><br>
<span class="lineno"></span><span class="keyword" id="1833912">func</span>&nbsp;<span class="op" id="1833917">(</span><span class="ident" id="1833918">z</span>&nbsp;<span class="ident" id="1833920">nat</span><span class="op" id="1833923">)</span>&nbsp;<span class="ident" id="1833925">divLarge</span><span class="op" id="1833933">(</span><span class="ident" id="1833934">u</span><span class="op" id="1833935">,</span>&nbsp;<span class="ident" id="1833937">uIn</span><span class="op" id="1833940">,</span>&nbsp;<span class="ident" id="1833942">v</span>&nbsp;<span class="ident" id="1833944">nat</span><span class="op" id="1833947">)</span>&nbsp;<span class="op" id="1833949">(</span><span class="ident" id="1833950">q</span><span class="op" id="1833951">,</span>&nbsp;<span class="ident" id="1833953">r</span>&nbsp;<span class="ident" id="1833955">nat</span><span class="op" id="1833958">)</span>&nbsp;<span class="op" id="1833960">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833963">n</span>&nbsp;<span class="op" id="1833965">:=</span>&nbsp;<span class="builtinfunc" id="1833968">len</span><span class="op" id="1833971">(</span><span class="ident" id="1833972">v</span><span class="op" id="1833973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1833976">m</span>&nbsp;<span class="op" id="1833978">:=</span>&nbsp;<span class="builtinfunc" id="1833981">len</span><span class="op" id="1833984">(</span><span class="ident" id="1833985">uIn</span><span class="op" id="1833988">)</span>&nbsp;<span class="op" id="1833990">-</span>&nbsp;<span class="ident" id="1833992">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1833996">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1834029">//&nbsp;TODO(gri)&nbsp;should&nbsp;find&nbsp;a&nbsp;better&nbsp;solution&nbsp;-&nbsp;this&nbsp;if&nbsp;statement</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1834093">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;very&nbsp;costly&nbsp;(see&nbsp;e.g.&nbsp;time&nbsp;pidigits&nbsp;-s&nbsp;-n&nbsp;10000)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1834159">if</span>&nbsp;<span class="ident" id="1834162">alias</span><span class="op" id="1834167">(</span><span class="ident" id="1834168">z</span><span class="op" id="1834169">,</span>&nbsp;<span class="ident" id="1834171">uIn</span><span class="op" id="1834174">)</span>&nbsp;<span class="op" id="1834176">||</span>&nbsp;<span class="ident" id="1834179">alias</span><span class="op" id="1834184">(</span><span class="ident" id="1834185">z</span><span class="op" id="1834186">,</span>&nbsp;<span class="ident" id="1834188">v</span><span class="op" id="1834189">)</span>&nbsp;<span class="op" id="1834191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834195">z</span>&nbsp;<span class="op" id="1834197">=</span>&nbsp;<span class="ident" id="1834199">nil</span>&nbsp;<span class="comment" id="1834203">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1834249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834252">q</span>&nbsp;<span class="op" id="1834254">=</span>&nbsp;<span class="ident" id="1834256">z</span><span class="op" id="1834257">.</span><span class="builtinfunc" id="1834258">make</span><span class="op" id="1834262">(</span><span class="ident" id="1834263">m</span>&nbsp;<span class="op" id="1834265">+</span>&nbsp;<span class="num" id="1834267">1</span><span class="op" id="1834268">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834272">qhatv</span>&nbsp;<span class="op" id="1834278">:=</span>&nbsp;<span class="builtinfunc" id="1834281">make</span><span class="op" id="1834285">(</span><span class="ident" id="1834286">nat</span><span class="op" id="1834289">,</span>&nbsp;<span class="ident" id="1834291">n</span><span class="op" id="1834292">+</span><span class="num" id="1834293">1</span><span class="op" id="1834294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1834297">if</span>&nbsp;<span class="ident" id="1834300">alias</span><span class="op" id="1834305">(</span><span class="ident" id="1834306">u</span><span class="op" id="1834307">,</span>&nbsp;<span class="ident" id="1834309">uIn</span><span class="op" id="1834312">)</span>&nbsp;<span class="op" id="1834314">||</span>&nbsp;<span class="ident" id="1834317">alias</span><span class="op" id="1834322">(</span><span class="ident" id="1834323">u</span><span class="op" id="1834324">,</span>&nbsp;<span class="ident" id="1834326">v</span><span class="op" id="1834327">)</span>&nbsp;<span class="op" id="1834329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834333">u</span>&nbsp;<span class="op" id="1834335">=</span>&nbsp;<span class="ident" id="1834337">nil</span>&nbsp;<span class="comment" id="1834341">//&nbsp;u&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1834387">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834390">u</span>&nbsp;<span class="op" id="1834392">=</span>&nbsp;<span class="ident" id="1834394">u</span><span class="op" id="1834395">.</span><span class="builtinfunc" id="1834396">make</span><span class="op" id="1834400">(</span><span class="builtinfunc" id="1834401">len</span><span class="op" id="1834404">(</span><span class="ident" id="1834405">uIn</span><span class="op" id="1834408">)</span>&nbsp;<span class="op" id="1834410">+</span>&nbsp;<span class="num" id="1834412">1</span><span class="op" id="1834413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834416">u</span><span class="op" id="1834417">.</span><span class="ident" id="1834418">clear</span><span class="op" id="1834423">(</span><span class="op" id="1834424">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1834428">//&nbsp;D1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834436">shift</span>&nbsp;<span class="op" id="1834442">:=</span>&nbsp;<span class="ident" id="1834445">leadingZeros</span><span class="op" id="1834457">(</span><span class="ident" id="1834458">v</span><span class="op" id="1834459">[</span><span class="ident" id="1834460">n</span><span class="op" id="1834461">-</span><span class="num" id="1834462">1</span><span class="op" id="1834463">]</span><span class="op" id="1834464">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1834467">if</span>&nbsp;<span class="ident" id="1834470">shift</span>&nbsp;<span class="op" id="1834476">&gt;</span>&nbsp;<span class="num" id="1834478">0</span>&nbsp;<span class="op" id="1834480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1834484">//&nbsp;do&nbsp;not&nbsp;modify&nbsp;v,&nbsp;it&nbsp;may&nbsp;be&nbsp;used&nbsp;by&nbsp;another&nbsp;goroutine&nbsp;simultaneously</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834557">v1</span>&nbsp;<span class="op" id="1834560">:=</span>&nbsp;<span class="builtinfunc" id="1834563">make</span><span class="op" id="1834567">(</span><span class="ident" id="1834568">nat</span><span class="op" id="1834571">,</span>&nbsp;<span class="ident" id="1834573">n</span><span class="op" id="1834574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834578">shlVU</span><span class="op" id="1834583">(</span><span class="ident" id="1834584">v1</span><span class="op" id="1834586">,</span>&nbsp;<span class="ident" id="1834588">v</span><span class="op" id="1834589">,</span>&nbsp;<span class="ident" id="1834591">shift</span><span class="op" id="1834596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834600">v</span>&nbsp;<span class="op" id="1834602">=</span>&nbsp;<span class="ident" id="1834604">v1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1834608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834611">u</span><span class="op" id="1834612">[</span><span class="builtinfunc" id="1834613">len</span><span class="op" id="1834616">(</span><span class="ident" id="1834617">uIn</span><span class="op" id="1834620">)</span><span class="op" id="1834621">]</span>&nbsp;<span class="op" id="1834623">=</span>&nbsp;<span class="ident" id="1834625">shlVU</span><span class="op" id="1834630">(</span><span class="ident" id="1834631">u</span><span class="op" id="1834632">[</span><span class="num" id="1834633">0</span><span class="op" id="1834634">:</span><span class="builtinfunc" id="1834635">len</span><span class="op" id="1834638">(</span><span class="ident" id="1834639">uIn</span><span class="op" id="1834642">)</span><span class="op" id="1834643">]</span><span class="op" id="1834644">,</span>&nbsp;<span class="ident" id="1834646">uIn</span><span class="op" id="1834649">,</span>&nbsp;<span class="ident" id="1834651">shift</span><span class="op" id="1834656">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1834660">//&nbsp;D2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1834668">for</span>&nbsp;<span class="ident" id="1834672">j</span>&nbsp;<span class="op" id="1834674">:=</span>&nbsp;<span class="ident" id="1834677">m</span><span class="op" id="1834678">;</span>&nbsp;<span class="ident" id="1834680">j</span>&nbsp;<span class="op" id="1834682">&gt;=</span>&nbsp;<span class="num" id="1834685">0</span><span class="op" id="1834686">;</span>&nbsp;<span class="ident" id="1834688">j</span><span class="op" id="1834689">--</span>&nbsp;<span class="op" id="1834692">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1834696">//&nbsp;D3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834705">qhat</span>&nbsp;<span class="op" id="1834710">:=</span>&nbsp;<span class="ident" id="1834713">Word</span><span class="op" id="1834717">(</span><span class="ident" id="1834718">_M</span><span class="op" id="1834720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1834724">if</span>&nbsp;<span class="ident" id="1834727">u</span><span class="op" id="1834728">[</span><span class="ident" id="1834729">j</span><span class="op" id="1834730">+</span><span class="ident" id="1834731">n</span><span class="op" id="1834732">]</span>&nbsp;<span class="op" id="1834734">!=</span>&nbsp;<span class="ident" id="1834737">v</span><span class="op" id="1834738">[</span><span class="ident" id="1834739">n</span><span class="op" id="1834740">-</span><span class="num" id="1834741">1</span><span class="op" id="1834742">]</span>&nbsp;<span class="op" id="1834744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1834749">var</span>&nbsp;<span class="ident" id="1834753">rhat</span>&nbsp;<span class="ident" id="1834758">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834766">qhat</span><span class="op" id="1834770">,</span>&nbsp;<span class="ident" id="1834772">rhat</span>&nbsp;<span class="op" id="1834777">=</span>&nbsp;<span class="ident" id="1834779">divWW</span><span class="op" id="1834784">(</span><span class="ident" id="1834785">u</span><span class="op" id="1834786">[</span><span class="ident" id="1834787">j</span><span class="op" id="1834788">+</span><span class="ident" id="1834789">n</span><span class="op" id="1834790">]</span><span class="op" id="1834791">,</span>&nbsp;<span class="ident" id="1834793">u</span><span class="op" id="1834794">[</span><span class="ident" id="1834795">j</span><span class="op" id="1834796">+</span><span class="ident" id="1834797">n</span><span class="op" id="1834798">-</span><span class="num" id="1834799">1</span><span class="op" id="1834800">]</span><span class="op" id="1834801">,</span>&nbsp;<span class="ident" id="1834803">v</span><span class="op" id="1834804">[</span><span class="ident" id="1834805">n</span><span class="op" id="1834806">-</span><span class="num" id="1834807">1</span><span class="op" id="1834808">]</span><span class="op" id="1834809">)</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1834815">//&nbsp;x1&nbsp;|&nbsp;x2&nbsp;=&nbsp;q̂v_{n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834842">x1</span><span class="op" id="1834844">,</span>&nbsp;<span class="ident" id="1834846">x2</span>&nbsp;<span class="op" id="1834849">:=</span>&nbsp;<span class="ident" id="1834852">mulWW</span><span class="op" id="1834857">(</span><span class="ident" id="1834858">qhat</span><span class="op" id="1834862">,</span>&nbsp;<span class="ident" id="1834864">v</span><span class="op" id="1834865">[</span><span class="ident" id="1834866">n</span><span class="op" id="1834867">-</span><span class="num" id="1834868">2</span><span class="op" id="1834869">]</span><span class="op" id="1834870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1834875">//&nbsp;test&nbsp;if&nbsp;q̂v_{n-2}&nbsp;&gt;&nbsp;br̂&nbsp;+&nbsp;u_{j+n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1834919">for</span>&nbsp;<span class="ident" id="1834923">greaterThan</span><span class="op" id="1834934">(</span><span class="ident" id="1834935">x1</span><span class="op" id="1834937">,</span>&nbsp;<span class="ident" id="1834939">x2</span><span class="op" id="1834941">,</span>&nbsp;<span class="ident" id="1834943">rhat</span><span class="op" id="1834947">,</span>&nbsp;<span class="ident" id="1834949">u</span><span class="op" id="1834950">[</span><span class="ident" id="1834951">j</span><span class="op" id="1834952">+</span><span class="ident" id="1834953">n</span><span class="op" id="1834954">-</span><span class="num" id="1834955">2</span><span class="op" id="1834956">]</span><span class="op" id="1834957">)</span>&nbsp;<span class="op" id="1834959">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834965">qhat</span><span class="op" id="1834969">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834976">prevRhat</span>&nbsp;<span class="op" id="1834985">:=</span>&nbsp;<span class="ident" id="1834988">rhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834997">rhat</span>&nbsp;<span class="op" id="1835002">+=</span>&nbsp;<span class="ident" id="1835005">v</span><span class="op" id="1835006">[</span><span class="ident" id="1835007">n</span><span class="op" id="1835008">-</span><span class="num" id="1835009">1</span><span class="op" id="1835010">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1835016">//&nbsp;v[n-1]&nbsp;&gt;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;tests&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835064">if</span>&nbsp;<span class="ident" id="1835067">rhat</span>&nbsp;<span class="op" id="1835072">&lt;</span>&nbsp;<span class="ident" id="1835074">prevRhat</span>&nbsp;<span class="op" id="1835083">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835090">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1835100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835106">x1</span><span class="op" id="1835108">,</span>&nbsp;<span class="ident" id="1835110">x2</span>&nbsp;<span class="op" id="1835113">=</span>&nbsp;<span class="ident" id="1835115">mulWW</span><span class="op" id="1835120">(</span><span class="ident" id="1835121">qhat</span><span class="op" id="1835125">,</span>&nbsp;<span class="ident" id="1835127">v</span><span class="op" id="1835128">[</span><span class="ident" id="1835129">n</span><span class="op" id="1835130">-</span><span class="num" id="1835131">2</span><span class="op" id="1835132">]</span><span class="op" id="1835133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1835138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1835142">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1835147">//&nbsp;D4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835156">qhatv</span><span class="op" id="1835161">[</span><span class="ident" id="1835162">n</span><span class="op" id="1835163">]</span>&nbsp;<span class="op" id="1835165">=</span>&nbsp;<span class="ident" id="1835167">mulAddVWW</span><span class="op" id="1835176">(</span><span class="ident" id="1835177">qhatv</span><span class="op" id="1835182">[</span><span class="num" id="1835183">0</span><span class="op" id="1835184">:</span><span class="ident" id="1835185">n</span><span class="op" id="1835186">]</span><span class="op" id="1835187">,</span>&nbsp;<span class="ident" id="1835189">v</span><span class="op" id="1835190">,</span>&nbsp;<span class="ident" id="1835192">qhat</span><span class="op" id="1835196">,</span>&nbsp;<span class="num" id="1835198">0</span><span class="op" id="1835199">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835204">c</span>&nbsp;<span class="op" id="1835206">:=</span>&nbsp;<span class="ident" id="1835209">subVV</span><span class="op" id="1835214">(</span><span class="ident" id="1835215">u</span><span class="op" id="1835216">[</span><span class="ident" id="1835217">j</span><span class="op" id="1835218">:</span><span class="ident" id="1835219">j</span><span class="op" id="1835220">+</span><span class="builtinfunc" id="1835221">len</span><span class="op" id="1835224">(</span><span class="ident" id="1835225">qhatv</span><span class="op" id="1835230">)</span><span class="op" id="1835231">]</span><span class="op" id="1835232">,</span>&nbsp;<span class="ident" id="1835234">u</span><span class="op" id="1835235">[</span><span class="ident" id="1835236">j</span><span class="op" id="1835237">:</span><span class="op" id="1835238">]</span><span class="op" id="1835239">,</span>&nbsp;<span class="ident" id="1835241">qhatv</span><span class="op" id="1835246">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835250">if</span>&nbsp;<span class="ident" id="1835253">c</span>&nbsp;<span class="op" id="1835255">!=</span>&nbsp;<span class="num" id="1835258">0</span>&nbsp;<span class="op" id="1835260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835265">c</span>&nbsp;<span class="op" id="1835267">:=</span>&nbsp;<span class="ident" id="1835270">addVV</span><span class="op" id="1835275">(</span><span class="ident" id="1835276">u</span><span class="op" id="1835277">[</span><span class="ident" id="1835278">j</span><span class="op" id="1835279">:</span><span class="ident" id="1835280">j</span><span class="op" id="1835281">+</span><span class="ident" id="1835282">n</span><span class="op" id="1835283">]</span><span class="op" id="1835284">,</span>&nbsp;<span class="ident" id="1835286">u</span><span class="op" id="1835287">[</span><span class="ident" id="1835288">j</span><span class="op" id="1835289">:</span><span class="op" id="1835290">]</span><span class="op" id="1835291">,</span>&nbsp;<span class="ident" id="1835293">v</span><span class="op" id="1835294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835299">u</span><span class="op" id="1835300">[</span><span class="ident" id="1835301">j</span><span class="op" id="1835302">+</span><span class="ident" id="1835303">n</span><span class="op" id="1835304">]</span>&nbsp;<span class="op" id="1835306">+=</span>&nbsp;<span class="ident" id="1835309">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835314">qhat</span><span class="op" id="1835318">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1835323">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835328">q</span><span class="op" id="1835329">[</span><span class="ident" id="1835330">j</span><span class="op" id="1835331">]</span>&nbsp;<span class="op" id="1835333">=</span>&nbsp;<span class="ident" id="1835335">qhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1835341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835345">q</span>&nbsp;<span class="op" id="1835347">=</span>&nbsp;<span class="ident" id="1835349">q</span><span class="op" id="1835350">.</span><span class="ident" id="1835351">norm</span><span class="op" id="1835355">(</span><span class="op" id="1835356">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835359">shrVU</span><span class="op" id="1835364">(</span><span class="ident" id="1835365">u</span><span class="op" id="1835366">,</span>&nbsp;<span class="ident" id="1835368">u</span><span class="op" id="1835369">,</span>&nbsp;<span class="ident" id="1835371">shift</span><span class="op" id="1835376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835379">r</span>&nbsp;<span class="op" id="1835381">=</span>&nbsp;<span class="ident" id="1835383">u</span><span class="op" id="1835384">.</span><span class="ident" id="1835385">norm</span><span class="op" id="1835389">(</span><span class="op" id="1835390">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835394">return</span>&nbsp;<span class="ident" id="1835401">q</span><span class="op" id="1835402">,</span>&nbsp;<span class="ident" id="1835404">r</span><br>
<span class="lineno"></span><span class="op" id="1835406">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="comment" id="1835409">//&nbsp;Length&nbsp;of&nbsp;x&nbsp;in&nbsp;bits.&nbsp;x&nbsp;must&nbsp;be&nbsp;normalized.</span><br>
<span class="lineno"></span><span class="keyword" id="1835455">func</span>&nbsp;<span class="op" id="1835460">(</span><span class="ident" id="1835461">x</span>&nbsp;<span class="ident" id="1835463">nat</span><span class="op" id="1835466">)</span>&nbsp;<span class="ident" id="1835468">bitLen</span><span class="op" id="1835474">(</span><span class="op" id="1835475">)</span>&nbsp;<span class="builtintype" id="1835477">int</span>&nbsp;<span class="op" id="1835481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835484">if</span>&nbsp;<span class="ident" id="1835487">i</span>&nbsp;<span class="op" id="1835489">:=</span>&nbsp;<span class="builtinfunc" id="1835492">len</span><span class="op" id="1835495">(</span><span class="ident" id="1835496">x</span><span class="op" id="1835497">)</span>&nbsp;<span class="op" id="1835499">-</span>&nbsp;<span class="num" id="1835501">1</span><span class="op" id="1835502">;</span>&nbsp;<span class="ident" id="1835504">i</span>&nbsp;<span class="op" id="1835506">&gt;=</span>&nbsp;<span class="num" id="1835509">0</span>&nbsp;<span class="op" id="1835511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835515">return</span>&nbsp;<span class="ident" id="1835522">i</span><span class="op" id="1835523">*</span><span class="ident" id="1835524">_W</span>&nbsp;<span class="op" id="1835527">+</span>&nbsp;<span class="ident" id="1835529">bitLen</span><span class="op" id="1835535">(</span><span class="ident" id="1835536">x</span><span class="op" id="1835537">[</span><span class="ident" id="1835538">i</span><span class="op" id="1835539">]</span><span class="op" id="1835540">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1835543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835546">return</span>&nbsp;<span class="num" id="1835553">0</span><br>
<span class="lineno"></span><span class="op" id="1835555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1835558">//&nbsp;MaxBase&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;base&nbsp;accepted&nbsp;for&nbsp;string&nbsp;conversions.</span><br>
<span class="lineno">610</span><span class="keyword" id="1835629">const</span>&nbsp;<span class="ident" id="1835635">MaxBase</span>&nbsp;<span class="op" id="1835643">=</span>&nbsp;<span class="string" id="1835645">&#39;z&#39;</span>&nbsp;<span class="op" id="1835649">-</span>&nbsp;<span class="string" id="1835651">&#39;a&#39;</span>&nbsp;<span class="op" id="1835655">+</span>&nbsp;<span class="num" id="1835657">10</span>&nbsp;<span class="op" id="1835660">+</span>&nbsp;<span class="num" id="1835662">1</span>&nbsp;<span class="comment" id="1835664">//&nbsp;=&nbsp;hexValue(&#39;z&#39;)&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1835688">func</span>&nbsp;<span class="ident" id="1835693">hexValue</span><span class="op" id="1835701">(</span><span class="ident" id="1835702">ch</span>&nbsp;<span class="builtintype" id="1835705">rune</span><span class="op" id="1835709">)</span>&nbsp;<span class="ident" id="1835711">Word</span>&nbsp;<span class="op" id="1835716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835719">d</span>&nbsp;<span class="op" id="1835721">:=</span>&nbsp;<span class="builtintype" id="1835724">int</span><span class="op" id="1835727">(</span><span class="ident" id="1835728">MaxBase</span>&nbsp;<span class="op" id="1835736">+</span>&nbsp;<span class="num" id="1835738">1</span><span class="op" id="1835739">)</span>&nbsp;<span class="comment" id="1835741">//&nbsp;illegal&nbsp;base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835758">switch</span>&nbsp;<span class="op" id="1835765">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835768">case</span>&nbsp;<span class="string" id="1835773">&#39;0&#39;</span>&nbsp;<span class="op" id="1835777">&lt;=</span>&nbsp;<span class="ident" id="1835780">ch</span>&nbsp;<span class="op" id="1835783">&amp;&amp;</span>&nbsp;<span class="ident" id="1835786">ch</span>&nbsp;<span class="op" id="1835789">&lt;=</span>&nbsp;<span class="string" id="1835792">&#39;9&#39;</span><span class="op" id="1835795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835799">d</span>&nbsp;<span class="op" id="1835801">=</span>&nbsp;<span class="builtintype" id="1835803">int</span><span class="op" id="1835806">(</span><span class="ident" id="1835807">ch</span>&nbsp;<span class="op" id="1835810">-</span>&nbsp;<span class="string" id="1835812">&#39;0&#39;</span><span class="op" id="1835815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835818">case</span>&nbsp;<span class="string" id="1835823">&#39;a&#39;</span>&nbsp;<span class="op" id="1835827">&lt;=</span>&nbsp;<span class="ident" id="1835830">ch</span>&nbsp;<span class="op" id="1835833">&amp;&amp;</span>&nbsp;<span class="ident" id="1835836">ch</span>&nbsp;<span class="op" id="1835839">&lt;=</span>&nbsp;<span class="string" id="1835842">&#39;z&#39;</span><span class="op" id="1835845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835849">d</span>&nbsp;<span class="op" id="1835851">=</span>&nbsp;<span class="builtintype" id="1835853">int</span><span class="op" id="1835856">(</span><span class="ident" id="1835857">ch</span>&nbsp;<span class="op" id="1835860">-</span>&nbsp;<span class="string" id="1835862">&#39;a&#39;</span>&nbsp;<span class="op" id="1835866">+</span>&nbsp;<span class="num" id="1835868">10</span><span class="op" id="1835870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835873">case</span>&nbsp;<span class="string" id="1835878">&#39;A&#39;</span>&nbsp;<span class="op" id="1835882">&lt;=</span>&nbsp;<span class="ident" id="1835885">ch</span>&nbsp;<span class="op" id="1835888">&amp;&amp;</span>&nbsp;<span class="ident" id="1835891">ch</span>&nbsp;<span class="op" id="1835894">&lt;=</span>&nbsp;<span class="string" id="1835897">&#39;Z&#39;</span><span class="op" id="1835900">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835904">d</span>&nbsp;<span class="op" id="1835906">=</span>&nbsp;<span class="builtintype" id="1835908">int</span><span class="op" id="1835911">(</span><span class="ident" id="1835912">ch</span>&nbsp;<span class="op" id="1835915">-</span>&nbsp;<span class="string" id="1835917">&#39;A&#39;</span>&nbsp;<span class="op" id="1835921">+</span>&nbsp;<span class="num" id="1835923">10</span><span class="op" id="1835925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1835928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835931">return</span>&nbsp;<span class="ident" id="1835938">Word</span><span class="op" id="1835942">(</span><span class="ident" id="1835943">d</span><span class="op" id="1835944">)</span><br>
<span class="lineno"></span><span class="op" id="1835946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="1835949">//&nbsp;scan&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;natural&nbsp;number&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;longest&nbsp;possible&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="1836031">//&nbsp;read&nbsp;from&nbsp;r&nbsp;representing&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;in&nbsp;a&nbsp;given&nbsp;conversion&nbsp;base.</span><br>
<span class="lineno"></span><span class="comment" id="1836107">//&nbsp;It&nbsp;returns&nbsp;z,&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base&nbsp;used,&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;In&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1836186">//&nbsp;error&nbsp;case,&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;syntax&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1836263">//&nbsp;unsigned&nbsp;integer&nbsp;literals&nbsp;in&nbsp;Go.</span><br>
<span class="lineno">630</span><span class="comment" id="1836299">//</span><br>
<span class="lineno"></span><span class="comment" id="1836302">//&nbsp;The&nbsp;base&nbsp;argument&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;a&nbsp;value&nbsp;from&nbsp;2&nbsp;through&nbsp;MaxBase.&nbsp;If&nbsp;the&nbsp;base</span><br>
<span class="lineno"></span><span class="comment" id="1836380">//&nbsp;is&nbsp;0,&nbsp;the&nbsp;string&nbsp;prefix&nbsp;determines&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base.&nbsp;A&nbsp;prefix&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1836458">//&nbsp;``0x&#39;&#39;&nbsp;or&nbsp;``0X&#39;&#39;&nbsp;selects&nbsp;base&nbsp;16;&nbsp;the&nbsp;``0&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;8,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1836534">//&nbsp;``0b&#39;&#39;&nbsp;or&nbsp;``0B&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;2.&nbsp;Otherwise&nbsp;the&nbsp;selected&nbsp;base&nbsp;is&nbsp;10.</span><br>
<span class="lineno">635</span><span class="comment" id="1836612">//</span><br>
<span class="lineno"></span><span class="keyword" id="1836615">func</span>&nbsp;<span class="op" id="1836620">(</span><span class="ident" id="1836621">z</span>&nbsp;<span class="ident" id="1836623">nat</span><span class="op" id="1836626">)</span>&nbsp;<span class="ident" id="1836628">scan</span><span class="op" id="1836632">(</span><span class="ident" id="1836633">r</span>&nbsp;<span class="ident" id="1836635">io</span><span class="op" id="1836637">.</span><span class="ident" id="1836638">RuneScanner</span><span class="op" id="1836649">,</span>&nbsp;<span class="ident" id="1836651">base</span>&nbsp;<span class="builtintype" id="1836656">int</span><span class="op" id="1836659">)</span>&nbsp;<span class="op" id="1836661">(</span><span class="ident" id="1836662">nat</span><span class="op" id="1836665">,</span>&nbsp;<span class="builtintype" id="1836667">int</span><span class="op" id="1836670">,</span>&nbsp;<span class="builtintype" id="1836672">error</span><span class="op" id="1836677">)</span>&nbsp;<span class="op" id="1836679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1836682">//&nbsp;reject&nbsp;illegal&nbsp;bases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836707">if</span>&nbsp;<span class="ident" id="1836710">base</span>&nbsp;<span class="op" id="1836715">&lt;</span>&nbsp;<span class="num" id="1836717">0</span>&nbsp;<span class="op" id="1836719">||</span>&nbsp;<span class="ident" id="1836722">base</span>&nbsp;<span class="op" id="1836727">==</span>&nbsp;<span class="num" id="1836730">1</span>&nbsp;<span class="op" id="1836732">||</span>&nbsp;<span class="ident" id="1836735">MaxBase</span>&nbsp;<span class="op" id="1836743">&lt;</span>&nbsp;<span class="ident" id="1836745">base</span>&nbsp;<span class="op" id="1836750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836754">return</span>&nbsp;<span class="ident" id="1836761">z</span><span class="op" id="1836762">,</span>&nbsp;<span class="num" id="1836764">0</span><span class="op" id="1836765">,</span>&nbsp;<span class="ident" id="1836767">errors</span><span class="op" id="1836773">.</span><span class="ident" id="1836774">New</span><span class="op" id="1836777">(</span><span class="string" id="1836778">&#34;illegal&nbsp;number&nbsp;base&#34;</span><span class="op" id="1836799">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1836802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1836806">//&nbsp;one&nbsp;char&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836830">ch</span><span class="op" id="1836832">,</span>&nbsp;<span class="ident" id="1836834">_</span><span class="op" id="1836835">,</span>&nbsp;<span class="ident" id="1836837">err</span>&nbsp;<span class="op" id="1836841">:=</span>&nbsp;<span class="ident" id="1836844">r</span><span class="op" id="1836845">.</span><span class="ident" id="1836846">ReadRune</span><span class="op" id="1836854">(</span><span class="op" id="1836855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836858">if</span>&nbsp;<span class="ident" id="1836861">err</span>&nbsp;<span class="op" id="1836865">!=</span>&nbsp;<span class="ident" id="1836868">nil</span>&nbsp;<span class="op" id="1836872">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836876">return</span>&nbsp;<span class="ident" id="1836883">z</span><span class="op" id="1836884">,</span>&nbsp;<span class="num" id="1836886">0</span><span class="op" id="1836887">,</span>&nbsp;<span class="ident" id="1836889">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1836894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1836898">//&nbsp;determine&nbsp;base&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836930">b</span>&nbsp;<span class="op" id="1836932">:=</span>&nbsp;<span class="ident" id="1836935">Word</span><span class="op" id="1836939">(</span><span class="ident" id="1836940">base</span><span class="op" id="1836944">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836947">if</span>&nbsp;<span class="ident" id="1836950">base</span>&nbsp;<span class="op" id="1836955">==</span>&nbsp;<span class="num" id="1836958">0</span>&nbsp;<span class="op" id="1836960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836964">b</span>&nbsp;<span class="op" id="1836966">=</span>&nbsp;<span class="num" id="1836968">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836973">if</span>&nbsp;<span class="ident" id="1836976">ch</span>&nbsp;<span class="op" id="1836979">==</span>&nbsp;<span class="string" id="1836982">&#39;0&#39;</span>&nbsp;<span class="op" id="1836986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836991">switch</span>&nbsp;<span class="ident" id="1836998">ch</span><span class="op" id="1837000">,</span>&nbsp;<span class="ident" id="1837002">_</span><span class="op" id="1837003">,</span>&nbsp;<span class="ident" id="1837005">err</span>&nbsp;<span class="op" id="1837009">=</span>&nbsp;<span class="ident" id="1837011">r</span><span class="op" id="1837012">.</span><span class="ident" id="1837013">ReadRune</span><span class="op" id="1837021">(</span><span class="op" id="1837022">)</span><span class="op" id="1837023">;</span>&nbsp;<span class="ident" id="1837025">err</span>&nbsp;<span class="op" id="1837029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837034">case</span>&nbsp;<span class="ident" id="1837039">nil</span><span class="op" id="1837042">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837048">b</span>&nbsp;<span class="op" id="1837050">=</span>&nbsp;<span class="num" id="1837052">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837058">switch</span>&nbsp;<span class="ident" id="1837065">ch</span>&nbsp;<span class="op" id="1837068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837074">case</span>&nbsp;<span class="string" id="1837079">&#39;x&#39;</span><span class="op" id="1837082">,</span>&nbsp;<span class="string" id="1837084">&#39;X&#39;</span><span class="op" id="1837087">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837094">b</span>&nbsp;<span class="op" id="1837096">=</span>&nbsp;<span class="num" id="1837098">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837105">case</span>&nbsp;<span class="string" id="1837110">&#39;b&#39;</span><span class="op" id="1837113">,</span>&nbsp;<span class="string" id="1837115">&#39;B&#39;</span><span class="op" id="1837118">:</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837125">b</span>&nbsp;<span class="op" id="1837127">=</span>&nbsp;<span class="num" id="1837129">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837141">if</span>&nbsp;<span class="ident" id="1837144">b</span>&nbsp;<span class="op" id="1837146">==</span>&nbsp;<span class="num" id="1837149">2</span>&nbsp;<span class="op" id="1837151">||</span>&nbsp;<span class="ident" id="1837154">b</span>&nbsp;<span class="op" id="1837156">==</span>&nbsp;<span class="num" id="1837159">16</span>&nbsp;<span class="op" id="1837162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837169">if</span>&nbsp;<span class="ident" id="1837172">ch</span><span class="op" id="1837174">,</span>&nbsp;<span class="ident" id="1837176">_</span><span class="op" id="1837177">,</span>&nbsp;<span class="ident" id="1837179">err</span>&nbsp;<span class="op" id="1837183">=</span>&nbsp;<span class="ident" id="1837185">r</span><span class="op" id="1837186">.</span><span class="ident" id="1837187">ReadRune</span><span class="op" id="1837195">(</span><span class="op" id="1837196">)</span><span class="op" id="1837197">;</span>&nbsp;<span class="ident" id="1837199">err</span>&nbsp;<span class="op" id="1837203">!=</span>&nbsp;<span class="ident" id="1837206">nil</span>&nbsp;<span class="op" id="1837210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837218">return</span>&nbsp;<span class="ident" id="1837225">z</span><span class="op" id="1837226">,</span>&nbsp;<span class="num" id="1837228">0</span><span class="op" id="1837229">,</span>&nbsp;<span class="ident" id="1837231">err</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837251">case</span>&nbsp;<span class="ident" id="1837256">io</span><span class="op" id="1837258">.</span><span class="ident" id="1837259">EOF</span><span class="op" id="1837262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837268">return</span>&nbsp;<span class="ident" id="1837275">z</span><span class="op" id="1837276">.</span><span class="builtinfunc" id="1837277">make</span><span class="op" id="1837281">(</span><span class="num" id="1837282">0</span><span class="op" id="1837283">)</span><span class="op" id="1837284">,</span>&nbsp;<span class="num" id="1837286">10</span><span class="op" id="1837288">,</span>&nbsp;<span class="ident" id="1837290">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837297">default</span><span class="op" id="1837304">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837310">return</span>&nbsp;<span class="ident" id="1837317">z</span><span class="op" id="1837318">,</span>&nbsp;<span class="num" id="1837320">10</span><span class="op" id="1837322">,</span>&nbsp;<span class="ident" id="1837324">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1837342">//&nbsp;convert&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1837361">//&nbsp;-&nbsp;group&nbsp;as&nbsp;many&nbsp;digits&nbsp;d&nbsp;as&nbsp;possible&nbsp;together&nbsp;into&nbsp;a&nbsp;&#34;super-digit&#34;&nbsp;dd&nbsp;with&nbsp;&#34;super-base&#34;&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1837456">//&nbsp;-&nbsp;only&nbsp;when&nbsp;bb&nbsp;does&nbsp;not&nbsp;fit&nbsp;into&nbsp;a&nbsp;word&nbsp;anymore,&nbsp;do&nbsp;a&nbsp;full&nbsp;number&nbsp;mulAddWW&nbsp;using&nbsp;bb&nbsp;and&nbsp;dd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837551">z</span>&nbsp;<span class="op" id="1837553">=</span>&nbsp;<span class="ident" id="1837555">z</span><span class="op" id="1837556">.</span><span class="builtinfunc" id="1837557">make</span><span class="op" id="1837561">(</span><span class="num" id="1837562">0</span><span class="op" id="1837563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837566">bb</span>&nbsp;<span class="op" id="1837569">:=</span>&nbsp;<span class="ident" id="1837572">Word</span><span class="op" id="1837576">(</span><span class="num" id="1837577">1</span><span class="op" id="1837578">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837581">dd</span>&nbsp;<span class="op" id="1837584">:=</span>&nbsp;<span class="ident" id="1837587">Word</span><span class="op" id="1837591">(</span><span class="num" id="1837592">0</span><span class="op" id="1837593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837596">for</span>&nbsp;<span class="ident" id="1837600">max</span>&nbsp;<span class="op" id="1837604">:=</span>&nbsp;<span class="ident" id="1837607">_M</span>&nbsp;<span class="op" id="1837610">/</span>&nbsp;<span class="ident" id="1837612">b</span><span class="op" id="1837613">;</span>&nbsp;<span class="op" id="1837615">;</span>&nbsp;<span class="op" id="1837617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837621">d</span>&nbsp;<span class="op" id="1837623">:=</span>&nbsp;<span class="ident" id="1837626">hexValue</span><span class="op" id="1837634">(</span><span class="ident" id="1837635">ch</span><span class="op" id="1837637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837641">if</span>&nbsp;<span class="ident" id="1837644">d</span>&nbsp;<span class="op" id="1837646">&gt;=</span>&nbsp;<span class="ident" id="1837649">b</span>&nbsp;<span class="op" id="1837651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837656">r</span><span class="op" id="1837657">.</span><span class="ident" id="1837658">UnreadRune</span><span class="op" id="1837668">(</span><span class="op" id="1837669">)</span>&nbsp;<span class="comment" id="1837671">//&nbsp;ch&nbsp;does&nbsp;not&nbsp;belong&nbsp;to&nbsp;number&nbsp;anymore</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837714">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837727">if</span>&nbsp;<span class="ident" id="1837730">bb</span>&nbsp;<span class="op" id="1837733">&lt;=</span>&nbsp;<span class="ident" id="1837736">max</span>&nbsp;<span class="op" id="1837740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837745">bb</span>&nbsp;<span class="op" id="1837748">*=</span>&nbsp;<span class="ident" id="1837751">b</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837756">dd</span>&nbsp;<span class="op" id="1837759">=</span>&nbsp;<span class="ident" id="1837761">dd</span><span class="op" id="1837763">*</span><span class="ident" id="1837764">b</span>&nbsp;<span class="op" id="1837766">+</span>&nbsp;<span class="ident" id="1837768">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837772">}</span>&nbsp;<span class="keyword" id="1837774">else</span>&nbsp;<span class="op" id="1837779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1837784">//&nbsp;bb&nbsp;*&nbsp;b&nbsp;would&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837812">z</span>&nbsp;<span class="op" id="1837814">=</span>&nbsp;<span class="ident" id="1837816">z</span><span class="op" id="1837817">.</span><span class="ident" id="1837818">mulAddWW</span><span class="op" id="1837826">(</span><span class="ident" id="1837827">z</span><span class="op" id="1837828">,</span>&nbsp;<span class="ident" id="1837830">bb</span><span class="op" id="1837832">,</span>&nbsp;<span class="ident" id="1837834">dd</span><span class="op" id="1837836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837841">bb</span>&nbsp;<span class="op" id="1837844">=</span>&nbsp;<span class="ident" id="1837846">b</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837851">dd</span>&nbsp;<span class="op" id="1837854">=</span>&nbsp;<span class="ident" id="1837856">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837865">if</span>&nbsp;<span class="ident" id="1837868">ch</span><span class="op" id="1837870">,</span>&nbsp;<span class="ident" id="1837872">_</span><span class="op" id="1837873">,</span>&nbsp;<span class="ident" id="1837875">err</span>&nbsp;<span class="op" id="1837879">=</span>&nbsp;<span class="ident" id="1837881">r</span><span class="op" id="1837882">.</span><span class="ident" id="1837883">ReadRune</span><span class="op" id="1837891">(</span><span class="op" id="1837892">)</span><span class="op" id="1837893">;</span>&nbsp;<span class="ident" id="1837895">err</span>&nbsp;<span class="op" id="1837899">!=</span>&nbsp;<span class="ident" id="1837902">nil</span>&nbsp;<span class="op" id="1837906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837911">if</span>&nbsp;<span class="ident" id="1837914">err</span>&nbsp;<span class="op" id="1837918">!=</span>&nbsp;<span class="ident" id="1837921">io</span><span class="op" id="1837923">.</span><span class="ident" id="1837924">EOF</span>&nbsp;<span class="op" id="1837928">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837934">return</span>&nbsp;<span class="ident" id="1837941">z</span><span class="op" id="1837942">,</span>&nbsp;<span class="builtintype" id="1837944">int</span><span class="op" id="1837947">(</span><span class="ident" id="1837948">b</span><span class="op" id="1837949">)</span><span class="op" id="1837950">,</span>&nbsp;<span class="ident" id="1837952">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837964">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837975">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837979">switch</span>&nbsp;<span class="op" id="1837986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837989">case</span>&nbsp;<span class="ident" id="1837994">bb</span>&nbsp;<span class="op" id="1837997">&gt;</span>&nbsp;<span class="num" id="1837999">1</span><span class="op" id="1838000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1838004">//&nbsp;there&nbsp;was&nbsp;at&nbsp;least&nbsp;one&nbsp;mantissa&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838047">z</span>&nbsp;<span class="op" id="1838049">=</span>&nbsp;<span class="ident" id="1838051">z</span><span class="op" id="1838052">.</span><span class="ident" id="1838053">mulAddWW</span><span class="op" id="1838061">(</span><span class="ident" id="1838062">z</span><span class="op" id="1838063">,</span>&nbsp;<span class="ident" id="1838065">bb</span><span class="op" id="1838067">,</span>&nbsp;<span class="ident" id="1838069">dd</span><span class="op" id="1838071">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1838074">case</span>&nbsp;<span class="ident" id="1838079">base</span>&nbsp;<span class="op" id="1838084">==</span>&nbsp;<span class="num" id="1838087">0</span>&nbsp;<span class="op" id="1838089">&amp;&amp;</span>&nbsp;<span class="ident" id="1838092">b</span>&nbsp;<span class="op" id="1838094">==</span>&nbsp;<span class="num" id="1838097">8</span><span class="op" id="1838098">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1838102">//&nbsp;there&nbsp;was&nbsp;only&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0&nbsp;(possibly&nbsp;followed&nbsp;by&nbsp;digits&nbsp;&gt;&nbsp;7);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1838176">//&nbsp;return&nbsp;base&nbsp;10,&nbsp;not&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1838203">return</span>&nbsp;<span class="ident" id="1838210">z</span><span class="op" id="1838211">,</span>&nbsp;<span class="num" id="1838213">10</span><span class="op" id="1838215">,</span>&nbsp;<span class="ident" id="1838217">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1838222">case</span>&nbsp;<span class="ident" id="1838227">base</span>&nbsp;<span class="op" id="1838232">!=</span>&nbsp;<span class="num" id="1838235">0</span>&nbsp;<span class="op" id="1838237">||</span>&nbsp;<span class="ident" id="1838240">b</span>&nbsp;<span class="op" id="1838242">!=</span>&nbsp;<span class="num" id="1838245">8</span><span class="op" id="1838246">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1838250">//&nbsp;there&nbsp;was&nbsp;neither&nbsp;a&nbsp;mantissa&nbsp;digit&nbsp;nor&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1838313">return</span>&nbsp;<span class="ident" id="1838320">z</span><span class="op" id="1838321">,</span>&nbsp;<span class="builtintype" id="1838323">int</span><span class="op" id="1838326">(</span><span class="ident" id="1838327">b</span><span class="op" id="1838328">)</span><span class="op" id="1838329">,</span>&nbsp;<span class="ident" id="1838331">errors</span><span class="op" id="1838337">.</span><span class="ident" id="1838338">New</span><span class="op" id="1838341">(</span><span class="string" id="1838342">&#34;syntax&nbsp;error&nbsp;scanning&nbsp;number&#34;</span><span class="op" id="1838372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1838375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1838379">return</span>&nbsp;<span class="ident" id="1838386">z</span><span class="op" id="1838387">.</span><span class="ident" id="1838388">norm</span><span class="op" id="1838392">(</span><span class="op" id="1838393">)</span><span class="op" id="1838394">,</span>&nbsp;<span class="builtintype" id="1838396">int</span><span class="op" id="1838399">(</span><span class="ident" id="1838400">b</span><span class="op" id="1838401">)</span><span class="op" id="1838402">,</span>&nbsp;<span class="ident" id="1838404">nil</span><br>
<span class="lineno">720</span><span class="op" id="1838408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1838411">//&nbsp;Character&nbsp;sets&nbsp;for&nbsp;string&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="keyword" id="1838452">const</span>&nbsp;<span class="op" id="1838458">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838461">lowercaseDigits</span>&nbsp;<span class="op" id="1838477">=</span>&nbsp;<span class="string" id="1838479">&#34;0123456789abcdefghijklmnopqrstuvwxyz&#34;</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838519">uppercaseDigits</span>&nbsp;<span class="op" id="1838535">=</span>&nbsp;<span class="string" id="1838537">&#34;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span><span class="op" id="1838576">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1838579">//&nbsp;decimalString&nbsp;returns&nbsp;a&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1838635">//&nbsp;It&nbsp;calls&nbsp;x.string&nbsp;with&nbsp;the&nbsp;charset&nbsp;&#34;0123456789&#34;.</span><br>
<span class="lineno">730</span><span class="keyword" id="1838687">func</span>&nbsp;<span class="op" id="1838692">(</span><span class="ident" id="1838693">x</span>&nbsp;<span class="ident" id="1838695">nat</span><span class="op" id="1838698">)</span>&nbsp;<span class="ident" id="1838700">decimalString</span><span class="op" id="1838713">(</span><span class="op" id="1838714">)</span>&nbsp;<span class="builtintype" id="1838716">string</span>&nbsp;<span class="op" id="1838723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1838726">return</span>&nbsp;<span class="ident" id="1838733">x</span><span class="op" id="1838734">.</span><span class="builtintype" id="1838735">string</span><span class="op" id="1838741">(</span><span class="ident" id="1838742">lowercaseDigits</span><span class="op" id="1838757">[</span><span class="num" id="1838758">0</span><span class="op" id="1838759">:</span><span class="num" id="1838760">10</span><span class="op" id="1838762">]</span><span class="op" id="1838763">)</span><br>
<span class="lineno"></span><span class="op" id="1838765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1838768">//&nbsp;string&nbsp;converts&nbsp;x&nbsp;to&nbsp;a&nbsp;string&nbsp;using&nbsp;digits&nbsp;from&nbsp;a&nbsp;charset;&nbsp;a&nbsp;digit&nbsp;with</span><br>
<span class="lineno">735</span><span class="comment" id="1838843">//&nbsp;value&nbsp;d&nbsp;is&nbsp;represented&nbsp;by&nbsp;charset[d].&nbsp;The&nbsp;conversion&nbsp;base&nbsp;is&nbsp;determined</span><br>
<span class="lineno"></span><span class="comment" id="1838918">//&nbsp;by&nbsp;len(charset),&nbsp;which&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&nbsp;and&nbsp;&lt;=&nbsp;256.</span><br>
<span class="lineno"></span><span class="keyword" id="1838969">func</span>&nbsp;<span class="op" id="1838974">(</span><span class="ident" id="1838975">x</span>&nbsp;<span class="ident" id="1838977">nat</span><span class="op" id="1838980">)</span>&nbsp;<span class="builtintype" id="1838982">string</span><span class="op" id="1838988">(</span><span class="ident" id="1838989">charset</span>&nbsp;<span class="builtintype" id="1838997">string</span><span class="op" id="1839003">)</span>&nbsp;<span class="builtintype" id="1839005">string</span>&nbsp;<span class="op" id="1839012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839015">b</span>&nbsp;<span class="op" id="1839017">:=</span>&nbsp;<span class="ident" id="1839020">Word</span><span class="op" id="1839024">(</span><span class="builtinfunc" id="1839025">len</span><span class="op" id="1839028">(</span><span class="ident" id="1839029">charset</span><span class="op" id="1839036">)</span><span class="op" id="1839037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1839041">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839059">switch</span>&nbsp;<span class="op" id="1839066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839069">case</span>&nbsp;<span class="ident" id="1839074">b</span>&nbsp;<span class="op" id="1839076">&lt;</span>&nbsp;<span class="num" id="1839078">2</span>&nbsp;<span class="op" id="1839080">||</span>&nbsp;<span class="ident" id="1839083">MaxBase</span>&nbsp;<span class="op" id="1839091">&gt;</span>&nbsp;<span class="num" id="1839093">256</span><span class="op" id="1839096">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1839100">panic</span><span class="op" id="1839105">(</span><span class="string" id="1839106">&#34;illegal&nbsp;base&#34;</span><span class="op" id="1839120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839123">case</span>&nbsp;<span class="builtinfunc" id="1839128">len</span><span class="op" id="1839131">(</span><span class="ident" id="1839132">x</span><span class="op" id="1839133">)</span>&nbsp;<span class="op" id="1839135">==</span>&nbsp;<span class="num" id="1839138">0</span><span class="op" id="1839139">:</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839143">return</span>&nbsp;<span class="builtintype" id="1839150">string</span><span class="op" id="1839156">(</span><span class="ident" id="1839157">charset</span><span class="op" id="1839164">[</span><span class="num" id="1839165">0</span><span class="op" id="1839166">]</span><span class="op" id="1839167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1839170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1839174">//&nbsp;allocate&nbsp;buffer&nbsp;for&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839209">i</span>&nbsp;<span class="op" id="1839211">:=</span>&nbsp;<span class="builtintype" id="1839214">int</span><span class="op" id="1839217">(</span><span class="builtintype" id="1839218">float64</span><span class="op" id="1839225">(</span><span class="ident" id="1839226">x</span><span class="op" id="1839227">.</span><span class="ident" id="1839228">bitLen</span><span class="op" id="1839234">(</span><span class="op" id="1839235">)</span><span class="op" id="1839236">)</span><span class="op" id="1839237">/</span><span class="ident" id="1839238">math</span><span class="op" id="1839242">.</span><span class="ident" id="1839243">Log2</span><span class="op" id="1839247">(</span><span class="builtintype" id="1839248">float64</span><span class="op" id="1839255">(</span><span class="ident" id="1839256">b</span><span class="op" id="1839257">)</span><span class="op" id="1839258">)</span><span class="op" id="1839259">)</span>&nbsp;<span class="op" id="1839261">+</span>&nbsp;<span class="num" id="1839263">1</span>&nbsp;<span class="comment" id="1839265">//&nbsp;off&nbsp;by&nbsp;one&nbsp;at&nbsp;most</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839288">s</span>&nbsp;<span class="op" id="1839290">:=</span>&nbsp;<span class="builtinfunc" id="1839293">make</span><span class="op" id="1839297">(</span><span class="op" id="1839298">[</span><span class="op" id="1839299">]</span><span class="builtintype" id="1839300">byte</span><span class="op" id="1839304">,</span>&nbsp;<span class="ident" id="1839306">i</span><span class="op" id="1839307">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1839311">//&nbsp;convert&nbsp;power&nbsp;of&nbsp;two&nbsp;and&nbsp;non&nbsp;power&nbsp;of&nbsp;two&nbsp;bases&nbsp;separately</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839374">if</span>&nbsp;<span class="ident" id="1839377">b</span>&nbsp;<span class="op" id="1839379">==</span>&nbsp;<span class="ident" id="1839382">b</span><span class="op" id="1839383">&amp;</span><span class="op" id="1839384">-</span><span class="ident" id="1839385">b</span>&nbsp;<span class="op" id="1839387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1839391">//&nbsp;shift&nbsp;is&nbsp;base-b&nbsp;digit&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839431">shift</span>&nbsp;<span class="op" id="1839437">:=</span>&nbsp;<span class="ident" id="1839440">trailingZeroBits</span><span class="op" id="1839456">(</span><span class="ident" id="1839457">b</span><span class="op" id="1839458">)</span>&nbsp;<span class="comment" id="1839460">//&nbsp;shift&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;b&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839490">mask</span>&nbsp;<span class="op" id="1839495">:=</span>&nbsp;<span class="ident" id="1839498">Word</span><span class="op" id="1839502">(</span><span class="num" id="1839503">1</span><span class="op" id="1839504">)</span><span class="op" id="1839505">&lt;&lt;</span><span class="ident" id="1839507">shift</span>&nbsp;<span class="op" id="1839513">-</span>&nbsp;<span class="num" id="1839515">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839519">w</span>&nbsp;<span class="op" id="1839521">:=</span>&nbsp;<span class="ident" id="1839524">x</span><span class="op" id="1839525">[</span><span class="num" id="1839526">0</span><span class="op" id="1839527">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839531">nbits</span>&nbsp;<span class="op" id="1839537">:=</span>&nbsp;<span class="builtintype" id="1839540">uint</span><span class="op" id="1839544">(</span><span class="ident" id="1839545">_W</span><span class="op" id="1839547">)</span>&nbsp;<span class="comment" id="1839549">//&nbsp;number&nbsp;of&nbsp;unprocessed&nbsp;bits&nbsp;in&nbsp;w</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1839587">//&nbsp;convert&nbsp;less-significant&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839623">for</span>&nbsp;<span class="ident" id="1839627">k</span>&nbsp;<span class="op" id="1839629">:=</span>&nbsp;<span class="num" id="1839632">1</span><span class="op" id="1839633">;</span>&nbsp;<span class="ident" id="1839635">k</span>&nbsp;<span class="op" id="1839637">&lt;</span>&nbsp;<span class="builtinfunc" id="1839639">len</span><span class="op" id="1839642">(</span><span class="ident" id="1839643">x</span><span class="op" id="1839644">)</span><span class="op" id="1839645">;</span>&nbsp;<span class="ident" id="1839647">k</span><span class="op" id="1839648">++</span>&nbsp;<span class="op" id="1839651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1839656">//&nbsp;convert&nbsp;full&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839682">for</span>&nbsp;<span class="ident" id="1839686">nbits</span>&nbsp;<span class="op" id="1839692">&gt;=</span>&nbsp;<span class="ident" id="1839695">shift</span>&nbsp;<span class="op" id="1839701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839707">i</span><span class="op" id="1839708">--</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839715">s</span><span class="op" id="1839716">[</span><span class="ident" id="1839717">i</span><span class="op" id="1839718">]</span>&nbsp;<span class="op" id="1839720">=</span>&nbsp;<span class="ident" id="1839722">charset</span><span class="op" id="1839729">[</span><span class="ident" id="1839730">w</span><span class="op" id="1839731">&amp;</span><span class="ident" id="1839732">mask</span><span class="op" id="1839736">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839742">w</span>&nbsp;<span class="op" id="1839744">&gt;&gt;=</span>&nbsp;<span class="ident" id="1839748">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839758">nbits</span>&nbsp;<span class="op" id="1839764">-=</span>&nbsp;<span class="ident" id="1839767">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1839776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1839782">//&nbsp;convert&nbsp;any&nbsp;partial&nbsp;leading&nbsp;digit&nbsp;and&nbsp;advance&nbsp;to&nbsp;next&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839847">if</span>&nbsp;<span class="ident" id="1839850">nbits</span>&nbsp;<span class="op" id="1839856">==</span>&nbsp;<span class="num" id="1839859">0</span>&nbsp;<span class="op" id="1839861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1839867">//&nbsp;no&nbsp;partial&nbsp;digit&nbsp;remaining,&nbsp;just&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839915">w</span>&nbsp;<span class="op" id="1839917">=</span>&nbsp;<span class="ident" id="1839919">x</span><span class="op" id="1839920">[</span><span class="ident" id="1839921">k</span><span class="op" id="1839922">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839928">nbits</span>&nbsp;<span class="op" id="1839934">=</span>&nbsp;<span class="ident" id="1839936">_W</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1839942">}</span>&nbsp;<span class="keyword" id="1839944">else</span>&nbsp;<span class="op" id="1839949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1839955">//&nbsp;partial&nbsp;digit&nbsp;in&nbsp;current&nbsp;(k-1)&nbsp;and&nbsp;next&nbsp;(k)&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840011">w</span>&nbsp;<span class="op" id="1840013">|=</span>&nbsp;<span class="ident" id="1840016">x</span><span class="op" id="1840017">[</span><span class="ident" id="1840018">k</span><span class="op" id="1840019">]</span>&nbsp;<span class="op" id="1840021">&lt;&lt;</span>&nbsp;<span class="ident" id="1840024">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840034">i</span><span class="op" id="1840035">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840042">s</span><span class="op" id="1840043">[</span><span class="ident" id="1840044">i</span><span class="op" id="1840045">]</span>&nbsp;<span class="op" id="1840047">=</span>&nbsp;<span class="ident" id="1840049">charset</span><span class="op" id="1840056">[</span><span class="ident" id="1840057">w</span><span class="op" id="1840058">&amp;</span><span class="ident" id="1840059">mask</span><span class="op" id="1840063">]</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840070">//&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840085">w</span>&nbsp;<span class="op" id="1840087">=</span>&nbsp;<span class="ident" id="1840089">x</span><span class="op" id="1840090">[</span><span class="ident" id="1840091">k</span><span class="op" id="1840092">]</span>&nbsp;<span class="op" id="1840094">&gt;&gt;</span>&nbsp;<span class="op" id="1840097">(</span><span class="ident" id="1840098">shift</span>&nbsp;<span class="op" id="1840104">-</span>&nbsp;<span class="ident" id="1840106">nbits</span><span class="op" id="1840111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840117">nbits</span>&nbsp;<span class="op" id="1840123">=</span>&nbsp;<span class="ident" id="1840125">_W</span>&nbsp;<span class="op" id="1840128">-</span>&nbsp;<span class="op" id="1840130">(</span><span class="ident" id="1840131">shift</span>&nbsp;<span class="op" id="1840137">-</span>&nbsp;<span class="ident" id="1840139">nbits</span><span class="op" id="1840144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1840149">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1840153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840158">//&nbsp;convert&nbsp;digits&nbsp;of&nbsp;most-significant&nbsp;word&nbsp;(omit&nbsp;leading&nbsp;zeros)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1840224">for</span>&nbsp;<span class="ident" id="1840228">nbits</span>&nbsp;<span class="op" id="1840234">&gt;=</span>&nbsp;<span class="num" id="1840237">0</span>&nbsp;<span class="op" id="1840239">&amp;&amp;</span>&nbsp;<span class="ident" id="1840242">w</span>&nbsp;<span class="op" id="1840244">!=</span>&nbsp;<span class="num" id="1840247">0</span>&nbsp;<span class="op" id="1840249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840254">i</span><span class="op" id="1840255">--</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840261">s</span><span class="op" id="1840262">[</span><span class="ident" id="1840263">i</span><span class="op" id="1840264">]</span>&nbsp;<span class="op" id="1840266">=</span>&nbsp;<span class="ident" id="1840268">charset</span><span class="op" id="1840275">[</span><span class="ident" id="1840276">w</span><span class="op" id="1840277">&amp;</span><span class="ident" id="1840278">mask</span><span class="op" id="1840282">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840287">w</span>&nbsp;<span class="op" id="1840289">&gt;&gt;=</span>&nbsp;<span class="ident" id="1840293">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840302">nbits</span>&nbsp;<span class="op" id="1840308">-=</span>&nbsp;<span class="ident" id="1840311">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1840319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1840323">}</span>&nbsp;<span class="keyword" id="1840325">else</span>&nbsp;<span class="op" id="1840330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840334">//&nbsp;determine&nbsp;&#34;big&nbsp;base&#34;;&nbsp;i.e.,&nbsp;the&nbsp;largest&nbsp;possible&nbsp;value&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840397">//&nbsp;that&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;base&nbsp;b&nbsp;and&nbsp;still&nbsp;fits&nbsp;into&nbsp;a&nbsp;Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840455">//&nbsp;(as&nbsp;in&nbsp;10^19&nbsp;for&nbsp;19&nbsp;decimal&nbsp;digits&nbsp;in&nbsp;a&nbsp;64bit&nbsp;Word)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840512">bb</span>&nbsp;<span class="op" id="1840515">:=</span>&nbsp;<span class="ident" id="1840518">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1840525">//&nbsp;big&nbsp;base&nbsp;is&nbsp;b**ndigits</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840553">ndigits</span>&nbsp;<span class="op" id="1840561">:=</span>&nbsp;<span class="num" id="1840564">1</span>&nbsp;<span class="comment" id="1840566">//&nbsp;number&nbsp;of&nbsp;base&nbsp;b&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1840595">for</span>&nbsp;<span class="ident" id="1840599">max</span>&nbsp;<span class="op" id="1840603">:=</span>&nbsp;<span class="ident" id="1840606">Word</span><span class="op" id="1840610">(</span><span class="ident" id="1840611">_M</span>&nbsp;<span class="op" id="1840614">/</span>&nbsp;<span class="ident" id="1840616">b</span><span class="op" id="1840617">)</span><span class="op" id="1840618">;</span>&nbsp;<span class="ident" id="1840620">bb</span>&nbsp;<span class="op" id="1840623">&lt;=</span>&nbsp;<span class="ident" id="1840626">max</span><span class="op" id="1840629">;</span>&nbsp;<span class="ident" id="1840631">bb</span>&nbsp;<span class="op" id="1840634">*=</span>&nbsp;<span class="ident" id="1840637">b</span>&nbsp;<span class="op" id="1840639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840644">ndigits</span><span class="op" id="1840651">++</span>&nbsp;<span class="comment" id="1840654">//&nbsp;maximize&nbsp;ndigits&nbsp;where&nbsp;bb&nbsp;=&nbsp;b**ndigits,&nbsp;bb&nbsp;&lt;=&nbsp;_M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1840708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840713">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;successive&nbsp;squares&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840794">//&nbsp;result&nbsp;(table&nbsp;!=&nbsp;nil)&nbsp;&lt;=&gt;&nbsp;(len(x)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840849">table</span>&nbsp;<span class="op" id="1840855">:=</span>&nbsp;<span class="ident" id="1840858">divisors</span><span class="op" id="1840866">(</span><span class="builtinfunc" id="1840867">len</span><span class="op" id="1840870">(</span><span class="ident" id="1840871">x</span><span class="op" id="1840872">)</span><span class="op" id="1840873">,</span>&nbsp;<span class="ident" id="1840875">b</span><span class="op" id="1840876">,</span>&nbsp;<span class="ident" id="1840878">ndigits</span><span class="op" id="1840885">,</span>&nbsp;<span class="ident" id="1840887">bb</span><span class="op" id="1840889">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840894">//&nbsp;preserve&nbsp;x,&nbsp;create&nbsp;local&nbsp;copy&nbsp;for&nbsp;use&nbsp;by&nbsp;convertWords</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840953">q</span>&nbsp;<span class="op" id="1840955">:=</span>&nbsp;<span class="ident" id="1840958">nat</span><span class="op" id="1840961">(</span><span class="ident" id="1840962">nil</span><span class="op" id="1840965">)</span><span class="op" id="1840966">.</span><span class="ident" id="1840967">set</span><span class="op" id="1840970">(</span><span class="ident" id="1840971">x</span><span class="op" id="1840972">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840977">//&nbsp;convert&nbsp;q&nbsp;to&nbsp;string&nbsp;s&nbsp;in&nbsp;base&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841014">q</span><span class="op" id="1841015">.</span><span class="ident" id="1841016">convertWords</span><span class="op" id="1841028">(</span><span class="ident" id="1841029">s</span><span class="op" id="1841030">,</span>&nbsp;<span class="ident" id="1841032">charset</span><span class="op" id="1841039">,</span>&nbsp;<span class="ident" id="1841041">b</span><span class="op" id="1841042">,</span>&nbsp;<span class="ident" id="1841044">ndigits</span><span class="op" id="1841051">,</span>&nbsp;<span class="ident" id="1841053">bb</span><span class="op" id="1841055">,</span>&nbsp;<span class="ident" id="1841057">table</span><span class="op" id="1841062">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841067">//&nbsp;strip&nbsp;leading&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841092">//&nbsp;(x&nbsp;!=&nbsp;0;&nbsp;thus&nbsp;s&nbsp;must&nbsp;contain&nbsp;at&nbsp;least&nbsp;one&nbsp;non-zero&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841154">//&nbsp;and&nbsp;the&nbsp;loop&nbsp;will&nbsp;terminate)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841188">i</span>&nbsp;<span class="op" id="1841190">=</span>&nbsp;<span class="num" id="1841192">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1841196">for</span>&nbsp;<span class="ident" id="1841200">zero</span>&nbsp;<span class="op" id="1841205">:=</span>&nbsp;<span class="ident" id="1841208">charset</span><span class="op" id="1841215">[</span><span class="num" id="1841216">0</span><span class="op" id="1841217">]</span><span class="op" id="1841218">;</span>&nbsp;<span class="ident" id="1841220">s</span><span class="op" id="1841221">[</span><span class="ident" id="1841222">i</span><span class="op" id="1841223">]</span>&nbsp;<span class="op" id="1841225">==</span>&nbsp;<span class="ident" id="1841228">zero</span><span class="op" id="1841232">;</span>&nbsp;<span class="op" id="1841234">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841239">i</span><span class="op" id="1841240">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1841252">return</span>&nbsp;<span class="builtintype" id="1841259">string</span><span class="op" id="1841265">(</span><span class="ident" id="1841266">s</span><span class="op" id="1841267">[</span><span class="ident" id="1841268">i</span><span class="op" id="1841269">:</span><span class="op" id="1841270">]</span><span class="op" id="1841271">)</span><br>
<span class="lineno">825</span><span class="op" id="1841273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1841276">//&nbsp;Convert&nbsp;words&nbsp;of&nbsp;q&nbsp;to&nbsp;base&nbsp;b&nbsp;digits&nbsp;in&nbsp;s.&nbsp;If&nbsp;q&nbsp;is&nbsp;large,&nbsp;it&nbsp;is&nbsp;recursively&nbsp;&#34;split&nbsp;in&nbsp;half&#34;</span><br>
<span class="lineno"></span><span class="comment" id="1841370">//&nbsp;by&nbsp;nat/nat&nbsp;division&nbsp;using&nbsp;tabulated&nbsp;divisors.&nbsp;Otherwise,&nbsp;it&nbsp;is&nbsp;converted&nbsp;iteratively&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="1841464">//&nbsp;repeated&nbsp;nat/Word&nbsp;division.</span><br>
<span class="lineno">830</span><span class="comment" id="1841495">//</span><br>
<span class="lineno"></span><span class="comment" id="1841498">//&nbsp;The&nbsp;iterative&nbsp;method&nbsp;processes&nbsp;n&nbsp;Words&nbsp;by&nbsp;n&nbsp;divW()&nbsp;calls,&nbsp;each&nbsp;of&nbsp;which&nbsp;visits&nbsp;every&nbsp;Word&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1841598">//&nbsp;incrementally&nbsp;shortened&nbsp;q&nbsp;for&nbsp;a&nbsp;total&nbsp;of&nbsp;n&nbsp;+&nbsp;(n-1)&nbsp;+&nbsp;(n-2)&nbsp;...&nbsp;+&nbsp;2&nbsp;+&nbsp;1,&nbsp;or&nbsp;n(n+1)/2&nbsp;divW()&#39;s.</span><br>
<span class="lineno"></span><span class="comment" id="1841695">//&nbsp;Recursive&nbsp;conversion&nbsp;divides&nbsp;q&nbsp;by&nbsp;its&nbsp;approximate&nbsp;square&nbsp;root,&nbsp;yielding&nbsp;two&nbsp;parts,&nbsp;each&nbsp;half</span><br>
<span class="lineno"></span><span class="comment" id="1841791">//&nbsp;the&nbsp;size&nbsp;of&nbsp;q.&nbsp;Using&nbsp;the&nbsp;iterative&nbsp;method&nbsp;on&nbsp;both&nbsp;halves&nbsp;means&nbsp;2&nbsp;*&nbsp;(n/2)(n/2&nbsp;+&nbsp;1)/2&nbsp;divW()&#39;s</span><br>
<span class="lineno">835</span><span class="comment" id="1841887">//&nbsp;plus&nbsp;the&nbsp;expensive&nbsp;long&nbsp;div().&nbsp;Asymptotically,&nbsp;the&nbsp;ratio&nbsp;is&nbsp;favorable&nbsp;at&nbsp;1/2&nbsp;the&nbsp;divW()&#39;s,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1841985">//&nbsp;is&nbsp;made&nbsp;better&nbsp;by&nbsp;splitting&nbsp;the&nbsp;subblocks&nbsp;recursively.&nbsp;Best&nbsp;is&nbsp;to&nbsp;split&nbsp;blocks&nbsp;until&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="1842082">//&nbsp;split&nbsp;would&nbsp;take&nbsp;longer&nbsp;(because&nbsp;of&nbsp;the&nbsp;nat/nat&nbsp;div())&nbsp;than&nbsp;the&nbsp;twice&nbsp;as&nbsp;many&nbsp;divW()&#39;s&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1842179">//&nbsp;iterative&nbsp;approach.&nbsp;This&nbsp;threshold&nbsp;is&nbsp;represented&nbsp;by&nbsp;leafSize.&nbsp;Benchmarking&nbsp;of&nbsp;leafSize&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1842277">//&nbsp;range&nbsp;2..64&nbsp;shows&nbsp;that&nbsp;values&nbsp;of&nbsp;8&nbsp;and&nbsp;16&nbsp;work&nbsp;well,&nbsp;with&nbsp;a&nbsp;4x&nbsp;speedup&nbsp;at&nbsp;medium&nbsp;lengths&nbsp;and</span><br>
<span class="lineno">840</span><span class="comment" id="1842373">//&nbsp;~30x&nbsp;for&nbsp;20000&nbsp;digits.&nbsp;Use&nbsp;nat_test.go&#39;s&nbsp;BenchmarkLeafSize&nbsp;tests&nbsp;to&nbsp;optimize&nbsp;leafSize&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="1842466">//&nbsp;specific&nbsp;hardware.</span><br>
<span class="lineno"></span><span class="comment" id="1842488">//</span><br>
<span class="lineno"></span><span class="keyword" id="1842491">func</span>&nbsp;<span class="op" id="1842496">(</span><span class="ident" id="1842497">q</span>&nbsp;<span class="ident" id="1842499">nat</span><span class="op" id="1842502">)</span>&nbsp;<span class="ident" id="1842504">convertWords</span><span class="op" id="1842516">(</span><span class="ident" id="1842517">s</span>&nbsp;<span class="op" id="1842519">[</span><span class="op" id="1842520">]</span><span class="builtintype" id="1842521">byte</span><span class="op" id="1842525">,</span>&nbsp;<span class="ident" id="1842527">charset</span>&nbsp;<span class="builtintype" id="1842535">string</span><span class="op" id="1842541">,</span>&nbsp;<span class="ident" id="1842543">b</span>&nbsp;<span class="ident" id="1842545">Word</span><span class="op" id="1842549">,</span>&nbsp;<span class="ident" id="1842551">ndigits</span>&nbsp;<span class="builtintype" id="1842559">int</span><span class="op" id="1842562">,</span>&nbsp;<span class="ident" id="1842564">bb</span>&nbsp;<span class="ident" id="1842567">Word</span><span class="op" id="1842571">,</span>&nbsp;<span class="ident" id="1842573">table</span>&nbsp;<span class="op" id="1842579">[</span><span class="op" id="1842580">]</span><span class="ident" id="1842581">divisor</span><span class="op" id="1842588">)</span>&nbsp;<span class="op" id="1842590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1842593">//&nbsp;split&nbsp;larger&nbsp;blocks&nbsp;recursively</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842629">if</span>&nbsp;<span class="ident" id="1842632">table</span>&nbsp;<span class="op" id="1842638">!=</span>&nbsp;<span class="ident" id="1842641">nil</span>&nbsp;<span class="op" id="1842645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1842649">//&nbsp;len(q)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842676">var</span>&nbsp;<span class="ident" id="1842680">r</span>&nbsp;<span class="ident" id="1842682">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842688">index</span>&nbsp;<span class="op" id="1842694">:=</span>&nbsp;<span class="builtinfunc" id="1842697">len</span><span class="op" id="1842700">(</span><span class="ident" id="1842701">table</span><span class="op" id="1842706">)</span>&nbsp;<span class="op" id="1842708">-</span>&nbsp;<span class="num" id="1842710">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842714">for</span>&nbsp;<span class="builtinfunc" id="1842718">len</span><span class="op" id="1842721">(</span><span class="ident" id="1842722">q</span><span class="op" id="1842723">)</span>&nbsp;<span class="op" id="1842725">&gt;</span>&nbsp;<span class="ident" id="1842727">leafSize</span>&nbsp;<span class="op" id="1842736">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1842741">//&nbsp;find&nbsp;divisor&nbsp;close&nbsp;to&nbsp;sqrt(q)&nbsp;if&nbsp;possible,&nbsp;but&nbsp;in&nbsp;any&nbsp;case&nbsp;&lt;&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842810">maxLength</span>&nbsp;<span class="op" id="1842820">:=</span>&nbsp;<span class="ident" id="1842823">q</span><span class="op" id="1842824">.</span><span class="ident" id="1842825">bitLen</span><span class="op" id="1842831">(</span><span class="op" id="1842832">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1842838">//&nbsp;~=&nbsp;log2&nbsp;q,&nbsp;or&nbsp;at&nbsp;of&nbsp;least&nbsp;largest&nbsp;possible&nbsp;q&nbsp;of&nbsp;this&nbsp;bit&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842908">minLength</span>&nbsp;<span class="op" id="1842918">:=</span>&nbsp;<span class="ident" id="1842921">maxLength</span>&nbsp;<span class="op" id="1842931">&gt;&gt;</span>&nbsp;<span class="num" id="1842934">1</span>&nbsp;<span class="comment" id="1842936">//&nbsp;~=&nbsp;log2&nbsp;sqrt(q)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842958">for</span>&nbsp;<span class="ident" id="1842962">index</span>&nbsp;<span class="op" id="1842968">&gt;</span>&nbsp;<span class="num" id="1842970">0</span>&nbsp;<span class="op" id="1842972">&amp;&amp;</span>&nbsp;<span class="ident" id="1842975">table</span><span class="op" id="1842980">[</span><span class="ident" id="1842981">index</span><span class="op" id="1842986">-</span><span class="num" id="1842987">1</span><span class="op" id="1842988">]</span><span class="op" id="1842989">.</span><span class="ident" id="1842990">nbits</span>&nbsp;<span class="op" id="1842996">&gt;</span>&nbsp;<span class="ident" id="1842998">minLength</span>&nbsp;<span class="op" id="1843008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843014">index</span><span class="op" id="1843019">--</span>&nbsp;<span class="comment" id="1843022">//&nbsp;desired</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1843036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1843041">if</span>&nbsp;<span class="ident" id="1843044">table</span><span class="op" id="1843049">[</span><span class="ident" id="1843050">index</span><span class="op" id="1843055">]</span><span class="op" id="1843056">.</span><span class="ident" id="1843057">nbits</span>&nbsp;<span class="op" id="1843063">&gt;=</span>&nbsp;<span class="ident" id="1843066">maxLength</span>&nbsp;<span class="op" id="1843076">&amp;&amp;</span>&nbsp;<span class="ident" id="1843079">table</span><span class="op" id="1843084">[</span><span class="ident" id="1843085">index</span><span class="op" id="1843090">]</span><span class="op" id="1843091">.</span><span class="ident" id="1843092">bbb</span><span class="op" id="1843095">.</span><span class="ident" id="1843096">cmp</span><span class="op" id="1843099">(</span><span class="ident" id="1843100">q</span><span class="op" id="1843101">)</span>&nbsp;<span class="op" id="1843103">&gt;=</span>&nbsp;<span class="num" id="1843106">0</span>&nbsp;<span class="op" id="1843108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843114">index</span><span class="op" id="1843119">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1843126">if</span>&nbsp;<span class="ident" id="1843129">index</span>&nbsp;<span class="op" id="1843135">&lt;</span>&nbsp;<span class="num" id="1843137">0</span>&nbsp;<span class="op" id="1843139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1843146">panic</span><span class="op" id="1843151">(</span><span class="string" id="1843152">&#34;internal&nbsp;inconsistency&#34;</span><span class="op" id="1843176">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1843182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1843187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1843193">//&nbsp;split&nbsp;q&nbsp;into&nbsp;the&nbsp;two&nbsp;digit&nbsp;number&nbsp;(q&#39;*bbb&nbsp;+&nbsp;r)&nbsp;to&nbsp;form&nbsp;independent&nbsp;subblocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843276">q</span><span class="op" id="1843277">,</span>&nbsp;<span class="ident" id="1843279">r</span>&nbsp;<span class="op" id="1843281">=</span>&nbsp;<span class="ident" id="1843283">q</span><span class="op" id="1843284">.</span><span class="ident" id="1843285">div</span><span class="op" id="1843288">(</span><span class="ident" id="1843289">r</span><span class="op" id="1843290">,</span>&nbsp;<span class="ident" id="1843292">q</span><span class="op" id="1843293">,</span>&nbsp;<span class="ident" id="1843295">table</span><span class="op" id="1843300">[</span><span class="ident" id="1843301">index</span><span class="op" id="1843306">]</span><span class="op" id="1843307">.</span><span class="ident" id="1843308">bbb</span><span class="op" id="1843311">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1843317">//&nbsp;convert&nbsp;subblocks&nbsp;and&nbsp;collect&nbsp;results&nbsp;in&nbsp;s[:h]&nbsp;and&nbsp;s[h:]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843380">h</span>&nbsp;<span class="op" id="1843382">:=</span>&nbsp;<span class="builtinfunc" id="1843385">len</span><span class="op" id="1843388">(</span><span class="ident" id="1843389">s</span><span class="op" id="1843390">)</span>&nbsp;<span class="op" id="1843392">-</span>&nbsp;<span class="ident" id="1843394">table</span><span class="op" id="1843399">[</span><span class="ident" id="1843400">index</span><span class="op" id="1843405">]</span><span class="op" id="1843406">.</span><span class="ident" id="1843407">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843418">r</span><span class="op" id="1843419">.</span><span class="ident" id="1843420">convertWords</span><span class="op" id="1843432">(</span><span class="ident" id="1843433">s</span><span class="op" id="1843434">[</span><span class="ident" id="1843435">h</span><span class="op" id="1843436">:</span><span class="op" id="1843437">]</span><span class="op" id="1843438">,</span>&nbsp;<span class="ident" id="1843440">charset</span><span class="op" id="1843447">,</span>&nbsp;<span class="ident" id="1843449">b</span><span class="op" id="1843450">,</span>&nbsp;<span class="ident" id="1843452">ndigits</span><span class="op" id="1843459">,</span>&nbsp;<span class="ident" id="1843461">bb</span><span class="op" id="1843463">,</span>&nbsp;<span class="ident" id="1843465">table</span><span class="op" id="1843470">[</span><span class="num" id="1843471">0</span><span class="op" id="1843472">:</span><span class="ident" id="1843473">index</span><span class="op" id="1843478">]</span><span class="op" id="1843479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843484">s</span>&nbsp;<span class="op" id="1843486">=</span>&nbsp;<span class="ident" id="1843488">s</span><span class="op" id="1843489">[</span><span class="op" id="1843490">:</span><span class="ident" id="1843491">h</span><span class="op" id="1843492">]</span>&nbsp;<span class="comment" id="1843494">//&nbsp;==&nbsp;q.convertWords(s,&nbsp;charset,&nbsp;b,&nbsp;ndigits,&nbsp;bb,&nbsp;table[0:index+1])</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1843563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1843566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1843570">//&nbsp;having&nbsp;split&nbsp;any&nbsp;large&nbsp;blocks&nbsp;now&nbsp;process&nbsp;the&nbsp;remaining&nbsp;(small)&nbsp;block&nbsp;iteratively</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843656">i</span>&nbsp;<span class="op" id="1843658">:=</span>&nbsp;<span class="builtinfunc" id="1843661">len</span><span class="op" id="1843664">(</span><span class="ident" id="1843665">s</span><span class="op" id="1843666">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1843669">var</span>&nbsp;<span class="ident" id="1843673">r</span>&nbsp;<span class="ident" id="1843675">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1843681">if</span>&nbsp;<span class="ident" id="1843684">b</span>&nbsp;<span class="op" id="1843686">==</span>&nbsp;<span class="num" id="1843689">10</span>&nbsp;<span class="op" id="1843692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1843696">//&nbsp;hard-coding&nbsp;for&nbsp;10&nbsp;here&nbsp;speeds&nbsp;this&nbsp;up&nbsp;by&nbsp;1.25x&nbsp;(allows&nbsp;for&nbsp;/&nbsp;and&nbsp;%&nbsp;by&nbsp;constants)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1843783">for</span>&nbsp;<span class="builtinfunc" id="1843787">len</span><span class="op" id="1843790">(</span><span class="ident" id="1843791">q</span><span class="op" id="1843792">)</span>&nbsp;<span class="op" id="1843794">&gt;</span>&nbsp;<span class="num" id="1843796">0</span>&nbsp;<span class="op" id="1843798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1843803">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843852">q</span><span class="op" id="1843853">,</span>&nbsp;<span class="ident" id="1843855">r</span>&nbsp;<span class="op" id="1843857">=</span>&nbsp;<span class="ident" id="1843859">q</span><span class="op" id="1843860">.</span><span class="ident" id="1843861">divW</span><span class="op" id="1843865">(</span><span class="ident" id="1843866">q</span><span class="op" id="1843867">,</span>&nbsp;<span class="ident" id="1843869">bb</span><span class="op" id="1843871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1843876">for</span>&nbsp;<span class="ident" id="1843880">j</span>&nbsp;<span class="op" id="1843882">:=</span>&nbsp;<span class="num" id="1843885">0</span><span class="op" id="1843886">;</span>&nbsp;<span class="ident" id="1843888">j</span>&nbsp;<span class="op" id="1843890">&lt;</span>&nbsp;<span class="ident" id="1843892">ndigits</span>&nbsp;<span class="op" id="1843900">&amp;&amp;</span>&nbsp;<span class="ident" id="1843903">i</span>&nbsp;<span class="op" id="1843905">&gt;</span>&nbsp;<span class="num" id="1843907">0</span><span class="op" id="1843908">;</span>&nbsp;<span class="ident" id="1843910">j</span><span class="op" id="1843911">++</span>&nbsp;<span class="op" id="1843914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843920">i</span><span class="op" id="1843921">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1843928">//&nbsp;avoid&nbsp;%&nbsp;computation&nbsp;since&nbsp;r%10&nbsp;==&nbsp;r&nbsp;-&nbsp;int(r/10)*10;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1843987">//&nbsp;this&nbsp;appears&nbsp;to&nbsp;be&nbsp;faster&nbsp;for&nbsp;BenchmarkString10000Base10</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1844051">//&nbsp;and&nbsp;smaller&nbsp;strings&nbsp;(but&nbsp;a&nbsp;bit&nbsp;slower&nbsp;for&nbsp;larger&nbsp;ones)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844113">t</span>&nbsp;<span class="op" id="1844115">:=</span>&nbsp;<span class="ident" id="1844118">r</span>&nbsp;<span class="op" id="1844120">/</span>&nbsp;<span class="num" id="1844122">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844129">s</span><span class="op" id="1844130">[</span><span class="ident" id="1844131">i</span><span class="op" id="1844132">]</span>&nbsp;<span class="op" id="1844134">=</span>&nbsp;<span class="ident" id="1844136">charset</span><span class="op" id="1844143">[</span><span class="ident" id="1844144">r</span><span class="op" id="1844145">-</span><span class="ident" id="1844146">t</span><span class="op" id="1844147">&lt;&lt;</span><span class="num" id="1844149">3</span><span class="op" id="1844150">-</span><span class="ident" id="1844151">t</span><span class="op" id="1844152">-</span><span class="ident" id="1844153">t</span><span class="op" id="1844154">]</span>&nbsp;<span class="comment" id="1844156">//&nbsp;TODO(gri)&nbsp;replace&nbsp;w/&nbsp;t*10&nbsp;once&nbsp;compiler&nbsp;produces&nbsp;better&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844224">r</span>&nbsp;<span class="op" id="1844226">=</span>&nbsp;<span class="ident" id="1844228">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1844233">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1844237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1844240">}</span>&nbsp;<span class="keyword" id="1844242">else</span>&nbsp;<span class="op" id="1844247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1844251">for</span>&nbsp;<span class="builtinfunc" id="1844255">len</span><span class="op" id="1844258">(</span><span class="ident" id="1844259">q</span><span class="op" id="1844260">)</span>&nbsp;<span class="op" id="1844262">&gt;</span>&nbsp;<span class="num" id="1844264">0</span>&nbsp;<span class="op" id="1844266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1844271">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844320">q</span><span class="op" id="1844321">,</span>&nbsp;<span class="ident" id="1844323">r</span>&nbsp;<span class="op" id="1844325">=</span>&nbsp;<span class="ident" id="1844327">q</span><span class="op" id="1844328">.</span><span class="ident" id="1844329">divW</span><span class="op" id="1844333">(</span><span class="ident" id="1844334">q</span><span class="op" id="1844335">,</span>&nbsp;<span class="ident" id="1844337">bb</span><span class="op" id="1844339">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1844344">for</span>&nbsp;<span class="ident" id="1844348">j</span>&nbsp;<span class="op" id="1844350">:=</span>&nbsp;<span class="num" id="1844353">0</span><span class="op" id="1844354">;</span>&nbsp;<span class="ident" id="1844356">j</span>&nbsp;<span class="op" id="1844358">&lt;</span>&nbsp;<span class="ident" id="1844360">ndigits</span>&nbsp;<span class="op" id="1844368">&amp;&amp;</span>&nbsp;<span class="ident" id="1844371">i</span>&nbsp;<span class="op" id="1844373">&gt;</span>&nbsp;<span class="num" id="1844375">0</span><span class="op" id="1844376">;</span>&nbsp;<span class="ident" id="1844378">j</span><span class="op" id="1844379">++</span>&nbsp;<span class="op" id="1844382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844388">i</span><span class="op" id="1844389">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844396">s</span><span class="op" id="1844397">[</span><span class="ident" id="1844398">i</span><span class="op" id="1844399">]</span>&nbsp;<span class="op" id="1844401">=</span>&nbsp;<span class="ident" id="1844403">charset</span><span class="op" id="1844410">[</span><span class="ident" id="1844411">r</span><span class="op" id="1844412">%</span><span class="ident" id="1844413">b</span><span class="op" id="1844414">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844420">r</span>&nbsp;<span class="op" id="1844422">/=</span>&nbsp;<span class="ident" id="1844425">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1844430">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1844434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1844437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1844441">//&nbsp;prepend&nbsp;high-order&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844471">zero</span>&nbsp;<span class="op" id="1844476">:=</span>&nbsp;<span class="ident" id="1844479">charset</span><span class="op" id="1844486">[</span><span class="num" id="1844487">0</span><span class="op" id="1844488">]</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1844491">for</span>&nbsp;<span class="ident" id="1844495">i</span>&nbsp;<span class="op" id="1844497">&gt;</span>&nbsp;<span class="num" id="1844499">0</span>&nbsp;<span class="op" id="1844501">{</span>&nbsp;<span class="comment" id="1844503">//&nbsp;while&nbsp;need&nbsp;more&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844539">i</span><span class="op" id="1844540">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844545">s</span><span class="op" id="1844546">[</span><span class="ident" id="1844547">i</span><span class="op" id="1844548">]</span>&nbsp;<span class="op" id="1844550">=</span>&nbsp;<span class="ident" id="1844552">zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1844558">}</span><br>
<span class="lineno"></span><span class="op" id="1844560">}</span><br>
<span class="lineno">910</span><br>
<span class="lineno"></span><span class="comment" id="1844563">//&nbsp;Split&nbsp;blocks&nbsp;greater&nbsp;than&nbsp;leafSize&nbsp;Words&nbsp;(or&nbsp;set&nbsp;to&nbsp;0&nbsp;to&nbsp;disable&nbsp;recursive&nbsp;conversion)</span><br>
<span class="lineno"></span><span class="comment" id="1844653">//&nbsp;Benchmark&nbsp;and&nbsp;configure&nbsp;leafSize&nbsp;using:&nbsp;go&nbsp;test&nbsp;-bench=&#34;Leaf&#34;</span><br>
<span class="lineno"></span><span class="comment" id="1844718">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;3.0&nbsp;GHz&nbsp;Xeon&nbsp;&#34;Clovertown&#34;&nbsp;CPU&nbsp;(128&nbsp;byte&nbsp;cache&nbsp;lines)</span><br>
<span class="lineno"></span><span class="comment" id="1844798">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;2.66&nbsp;GHz&nbsp;Core&nbsp;2&nbsp;Duo&nbsp;&#34;Penryn&#34;&nbsp;CPU</span><br>
<span class="lineno">915</span><span class="keyword" id="1844858">var</span>&nbsp;<span class="ident" id="1844862">leafSize</span>&nbsp;<span class="builtintype" id="1844871">int</span>&nbsp;<span class="op" id="1844875">=</span>&nbsp;<span class="num" id="1844877">8</span>&nbsp;<span class="comment" id="1844879">//&nbsp;number&nbsp;of&nbsp;Word-size&nbsp;binary&nbsp;values&nbsp;treat&nbsp;as&nbsp;a&nbsp;monolithic&nbsp;block</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1844945">type</span>&nbsp;<span class="ident" id="1844950">divisor</span>&nbsp;<span class="keyword" id="1844958">struct</span>&nbsp;<span class="op" id="1844965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844968">bbb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1844976">nat</span>&nbsp;<span class="comment" id="1844980">//&nbsp;divisor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844992">nbits</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1845000">int</span>&nbsp;<span class="comment" id="1845004">//&nbsp;bit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;(discounting&nbsp;leading&nbsp;zeroes)&nbsp;~=&nbsp;log2(bbb)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845072">ndigits</span>&nbsp;<span class="builtintype" id="1845080">int</span>&nbsp;<span class="comment" id="1845084">//&nbsp;digit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;in&nbsp;terms&nbsp;of&nbsp;output&nbsp;base&nbsp;digits</span><br>
<span class="lineno"></span><span class="op" id="1845142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1845145">var</span>&nbsp;<span class="ident" id="1845149">cacheBase10</span>&nbsp;<span class="keyword" id="1845161">struct</span>&nbsp;<span class="op" id="1845168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845171">sync</span><span class="op" id="1845175">.</span><span class="ident" id="1845176">Mutex</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845183">table</span>&nbsp;<span class="op" id="1845189">[</span><span class="num" id="1845190">64</span><span class="op" id="1845192">]</span><span class="ident" id="1845193">divisor</span>&nbsp;<span class="comment" id="1845201">//&nbsp;cached&nbsp;divisors&nbsp;for&nbsp;base&nbsp;10</span><br>
<span class="lineno"></span><span class="op" id="1845232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1845235">//&nbsp;expWW&nbsp;computes&nbsp;x**y</span><br>
<span class="lineno"></span><span class="keyword" id="1845258">func</span>&nbsp;<span class="op" id="1845263">(</span><span class="ident" id="1845264">z</span>&nbsp;<span class="ident" id="1845266">nat</span><span class="op" id="1845269">)</span>&nbsp;<span class="ident" id="1845271">expWW</span><span class="op" id="1845276">(</span><span class="ident" id="1845277">x</span><span class="op" id="1845278">,</span>&nbsp;<span class="ident" id="1845280">y</span>&nbsp;<span class="ident" id="1845282">Word</span><span class="op" id="1845286">)</span>&nbsp;<span class="ident" id="1845288">nat</span>&nbsp;<span class="op" id="1845292">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845295">return</span>&nbsp;<span class="ident" id="1845302">z</span><span class="op" id="1845303">.</span><span class="ident" id="1845304">expNN</span><span class="op" id="1845309">(</span><span class="ident" id="1845310">nat</span><span class="op" id="1845313">(</span><span class="ident" id="1845314">nil</span><span class="op" id="1845317">)</span><span class="op" id="1845318">.</span><span class="ident" id="1845319">setWord</span><span class="op" id="1845326">(</span><span class="ident" id="1845327">x</span><span class="op" id="1845328">)</span><span class="op" id="1845329">,</span>&nbsp;<span class="ident" id="1845331">nat</span><span class="op" id="1845334">(</span><span class="ident" id="1845335">nil</span><span class="op" id="1845338">)</span><span class="op" id="1845339">.</span><span class="ident" id="1845340">setWord</span><span class="op" id="1845347">(</span><span class="ident" id="1845348">y</span><span class="op" id="1845349">)</span><span class="op" id="1845350">,</span>&nbsp;<span class="ident" id="1845352">nil</span><span class="op" id="1845355">)</span><br>
<span class="lineno"></span><span class="op" id="1845357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1845360">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;powers&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span><span class="keyword" id="1845427">func</span>&nbsp;<span class="ident" id="1845432">divisors</span><span class="op" id="1845440">(</span><span class="ident" id="1845441">m</span>&nbsp;<span class="builtintype" id="1845443">int</span><span class="op" id="1845446">,</span>&nbsp;<span class="ident" id="1845448">b</span>&nbsp;<span class="ident" id="1845450">Word</span><span class="op" id="1845454">,</span>&nbsp;<span class="ident" id="1845456">ndigits</span>&nbsp;<span class="builtintype" id="1845464">int</span><span class="op" id="1845467">,</span>&nbsp;<span class="ident" id="1845469">bb</span>&nbsp;<span class="ident" id="1845472">Word</span><span class="op" id="1845476">)</span>&nbsp;<span class="op" id="1845478">[</span><span class="op" id="1845479">]</span><span class="ident" id="1845480">divisor</span>&nbsp;<span class="op" id="1845488">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1845491">//&nbsp;only&nbsp;compute&nbsp;table&nbsp;when&nbsp;recursive&nbsp;conversion&nbsp;is&nbsp;enabled&nbsp;and&nbsp;x&nbsp;is&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845566">if</span>&nbsp;<span class="ident" id="1845569">leafSize</span>&nbsp;<span class="op" id="1845578">==</span>&nbsp;<span class="num" id="1845581">0</span>&nbsp;<span class="op" id="1845583">||</span>&nbsp;<span class="ident" id="1845586">m</span>&nbsp;<span class="op" id="1845588">&lt;=</span>&nbsp;<span class="ident" id="1845591">leafSize</span>&nbsp;<span class="op" id="1845600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845604">return</span>&nbsp;<span class="ident" id="1845611">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1845616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1845620">//&nbsp;determine&nbsp;k&nbsp;where&nbsp;(bb**leafSize)**(2**k)&nbsp;&gt;=&nbsp;sqrt(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845676">k</span>&nbsp;<span class="op" id="1845678">:=</span>&nbsp;<span class="num" id="1845681">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845684">for</span>&nbsp;<span class="ident" id="1845688">words</span>&nbsp;<span class="op" id="1845694">:=</span>&nbsp;<span class="ident" id="1845697">leafSize</span><span class="op" id="1845705">;</span>&nbsp;<span class="ident" id="1845707">words</span>&nbsp;<span class="op" id="1845713">&lt;</span>&nbsp;<span class="ident" id="1845715">m</span><span class="op" id="1845716">&gt;&gt;</span><span class="num" id="1845718">1</span>&nbsp;<span class="op" id="1845720">&amp;&amp;</span>&nbsp;<span class="ident" id="1845723">k</span>&nbsp;<span class="op" id="1845725">&lt;</span>&nbsp;<span class="builtinfunc" id="1845727">len</span><span class="op" id="1845730">(</span><span class="ident" id="1845731">cacheBase10</span><span class="op" id="1845742">.</span><span class="ident" id="1845743">table</span><span class="op" id="1845748">)</span><span class="op" id="1845749">;</span>&nbsp;<span class="ident" id="1845751">words</span>&nbsp;<span class="op" id="1845757">&lt;&lt;=</span>&nbsp;<span class="num" id="1845761">1</span>&nbsp;<span class="op" id="1845763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845767">k</span><span class="op" id="1845768">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1845772">}</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1845776">//&nbsp;reuse&nbsp;and&nbsp;extend&nbsp;existing&nbsp;table&nbsp;of&nbsp;divisors&nbsp;or&nbsp;create&nbsp;new&nbsp;table&nbsp;as&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845859">var</span>&nbsp;<span class="ident" id="1845863">table</span>&nbsp;<span class="op" id="1845869">[</span><span class="op" id="1845870">]</span><span class="ident" id="1845871">divisor</span>&nbsp;<span class="comment" id="1845879">//&nbsp;for&nbsp;b&nbsp;==&nbsp;10,&nbsp;table&nbsp;overlaps&nbsp;with&nbsp;cacheBase10.table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845934">if</span>&nbsp;<span class="ident" id="1845937">b</span>&nbsp;<span class="op" id="1845939">==</span>&nbsp;<span class="num" id="1845942">10</span>&nbsp;<span class="op" id="1845945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845949">cacheBase10</span><span class="op" id="1845960">.</span><span class="ident" id="1845961">Lock</span><span class="op" id="1845965">(</span><span class="op" id="1845966">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845970">table</span>&nbsp;<span class="op" id="1845976">=</span>&nbsp;<span class="ident" id="1845978">cacheBase10</span><span class="op" id="1845989">.</span><span class="ident" id="1845990">table</span><span class="op" id="1845995">[</span><span class="num" id="1845996">0</span><span class="op" id="1845997">:</span><span class="ident" id="1845998">k</span><span class="op" id="1845999">]</span>&nbsp;<span class="comment" id="1846001">//&nbsp;reuse&nbsp;old&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1846041">}</span>&nbsp;<span class="keyword" id="1846043">else</span>&nbsp;<span class="op" id="1846048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846052">table</span>&nbsp;<span class="op" id="1846058">=</span>&nbsp;<span class="builtinfunc" id="1846060">make</span><span class="op" id="1846064">(</span><span class="op" id="1846065">[</span><span class="op" id="1846066">]</span><span class="ident" id="1846067">divisor</span><span class="op" id="1846074">,</span>&nbsp;<span class="ident" id="1846076">k</span><span class="op" id="1846077">)</span>&nbsp;<span class="comment" id="1846079">//&nbsp;create&nbsp;new&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1846120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1846124">//&nbsp;extend&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1846141">if</span>&nbsp;<span class="ident" id="1846144">table</span><span class="op" id="1846149">[</span><span class="ident" id="1846150">k</span><span class="op" id="1846151">-</span><span class="num" id="1846152">1</span><span class="op" id="1846153">]</span><span class="op" id="1846154">.</span><span class="ident" id="1846155">ndigits</span>&nbsp;<span class="op" id="1846163">==</span>&nbsp;<span class="num" id="1846166">0</span>&nbsp;<span class="op" id="1846168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1846172">//&nbsp;add&nbsp;new&nbsp;entries&nbsp;as&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1846203">var</span>&nbsp;<span class="ident" id="1846207">larger</span>&nbsp;<span class="ident" id="1846214">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1846220">for</span>&nbsp;<span class="ident" id="1846224">i</span>&nbsp;<span class="op" id="1846226">:=</span>&nbsp;<span class="num" id="1846229">0</span><span class="op" id="1846230">;</span>&nbsp;<span class="ident" id="1846232">i</span>&nbsp;<span class="op" id="1846234">&lt;</span>&nbsp;<span class="ident" id="1846236">k</span><span class="op" id="1846237">;</span>&nbsp;<span class="ident" id="1846239">i</span><span class="op" id="1846240">++</span>&nbsp;<span class="op" id="1846243">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1846248">if</span>&nbsp;<span class="ident" id="1846251">table</span><span class="op" id="1846256">[</span><span class="ident" id="1846257">i</span><span class="op" id="1846258">]</span><span class="op" id="1846259">.</span><span class="ident" id="1846260">ndigits</span>&nbsp;<span class="op" id="1846268">==</span>&nbsp;<span class="num" id="1846271">0</span>&nbsp;<span class="op" id="1846273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1846279">if</span>&nbsp;<span class="ident" id="1846282">i</span>&nbsp;<span class="op" id="1846284">==</span>&nbsp;<span class="num" id="1846287">0</span>&nbsp;<span class="op" id="1846289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846296">table</span><span class="op" id="1846301">[</span><span class="num" id="1846302">0</span><span class="op" id="1846303">]</span><span class="op" id="1846304">.</span><span class="ident" id="1846305">bbb</span>&nbsp;<span class="op" id="1846309">=</span>&nbsp;<span class="ident" id="1846311">nat</span><span class="op" id="1846314">(</span><span class="ident" id="1846315">nil</span><span class="op" id="1846318">)</span><span class="op" id="1846319">.</span><span class="ident" id="1846320">expWW</span><span class="op" id="1846325">(</span><span class="ident" id="1846326">bb</span><span class="op" id="1846328">,</span>&nbsp;<span class="ident" id="1846330">Word</span><span class="op" id="1846334">(</span><span class="ident" id="1846335">leafSize</span><span class="op" id="1846343">)</span><span class="op" id="1846344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846351">table</span><span class="op" id="1846356">[</span><span class="num" id="1846357">0</span><span class="op" id="1846358">]</span><span class="op" id="1846359">.</span><span class="ident" id="1846360">ndigits</span>&nbsp;<span class="op" id="1846368">=</span>&nbsp;<span class="ident" id="1846370">ndigits</span>&nbsp;<span class="op" id="1846378">*</span>&nbsp;<span class="ident" id="1846380">leafSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1846393">}</span>&nbsp;<span class="keyword" id="1846395">else</span>&nbsp;<span class="op" id="1846400">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846407">table</span><span class="op" id="1846412">[</span><span class="ident" id="1846413">i</span><span class="op" id="1846414">]</span><span class="op" id="1846415">.</span><span class="ident" id="1846416">bbb</span>&nbsp;<span class="op" id="1846420">=</span>&nbsp;<span class="ident" id="1846422">nat</span><span class="op" id="1846425">(</span><span class="ident" id="1846426">nil</span><span class="op" id="1846429">)</span><span class="op" id="1846430">.</span><span class="ident" id="1846431">mul</span><span class="op" id="1846434">(</span><span class="ident" id="1846435">table</span><span class="op" id="1846440">[</span><span class="ident" id="1846441">i</span><span class="op" id="1846442">-</span><span class="num" id="1846443">1</span><span class="op" id="1846444">]</span><span class="op" id="1846445">.</span><span class="ident" id="1846446">bbb</span><span class="op" id="1846449">,</span>&nbsp;<span class="ident" id="1846451">table</span><span class="op" id="1846456">[</span><span class="ident" id="1846457">i</span><span class="op" id="1846458">-</span><span class="num" id="1846459">1</span><span class="op" id="1846460">]</span><span class="op" id="1846461">.</span><span class="ident" id="1846462">bbb</span><span class="op" id="1846465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846472">table</span><span class="op" id="1846477">[</span><span class="ident" id="1846478">i</span><span class="op" id="1846479">]</span><span class="op" id="1846480">.</span><span class="ident" id="1846481">ndigits</span>&nbsp;<span class="op" id="1846489">=</span>&nbsp;<span class="num" id="1846491">2</span>&nbsp;<span class="op" id="1846493">*</span>&nbsp;<span class="ident" id="1846495">table</span><span class="op" id="1846500">[</span><span class="ident" id="1846501">i</span><span class="op" id="1846502">-</span><span class="num" id="1846503">1</span><span class="op" id="1846504">]</span><span class="op" id="1846505">.</span><span class="ident" id="1846506">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1846518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1846525">//&nbsp;optimization:&nbsp;exploit&nbsp;aggregated&nbsp;extra&nbsp;bits&nbsp;in&nbsp;macro&nbsp;blocks</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846592">larger</span>&nbsp;<span class="op" id="1846599">=</span>&nbsp;<span class="ident" id="1846601">nat</span><span class="op" id="1846604">(</span><span class="ident" id="1846605">nil</span><span class="op" id="1846608">)</span><span class="op" id="1846609">.</span><span class="ident" id="1846610">set</span><span class="op" id="1846613">(</span><span class="ident" id="1846614">table</span><span class="op" id="1846619">[</span><span class="ident" id="1846620">i</span><span class="op" id="1846621">]</span><span class="op" id="1846622">.</span><span class="ident" id="1846623">bbb</span><span class="op" id="1846626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1846632">for</span>&nbsp;<span class="ident" id="1846636">mulAddVWW</span><span class="op" id="1846645">(</span><span class="ident" id="1846646">larger</span><span class="op" id="1846652">,</span>&nbsp;<span class="ident" id="1846654">larger</span><span class="op" id="1846660">,</span>&nbsp;<span class="ident" id="1846662">b</span><span class="op" id="1846663">,</span>&nbsp;<span class="num" id="1846665">0</span><span class="op" id="1846666">)</span>&nbsp;<span class="op" id="1846668">==</span>&nbsp;<span class="num" id="1846671">0</span>&nbsp;<span class="op" id="1846673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846680">table</span><span class="op" id="1846685">[</span><span class="ident" id="1846686">i</span><span class="op" id="1846687">]</span><span class="op" id="1846688">.</span><span class="ident" id="1846689">bbb</span>&nbsp;<span class="op" id="1846693">=</span>&nbsp;<span class="ident" id="1846695">table</span><span class="op" id="1846700">[</span><span class="ident" id="1846701">i</span><span class="op" id="1846702">]</span><span class="op" id="1846703">.</span><span class="ident" id="1846704">bbb</span><span class="op" id="1846707">.</span><span class="ident" id="1846708">set</span><span class="op" id="1846711">(</span><span class="ident" id="1846712">larger</span><span class="op" id="1846718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846725">table</span><span class="op" id="1846730">[</span><span class="ident" id="1846731">i</span><span class="op" id="1846732">]</span><span class="op" id="1846733">.</span><span class="ident" id="1846734">ndigits</span><span class="op" id="1846741">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1846748">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846755">table</span><span class="op" id="1846760">[</span><span class="ident" id="1846761">i</span><span class="op" id="1846762">]</span><span class="op" id="1846763">.</span><span class="ident" id="1846764">nbits</span>&nbsp;<span class="op" id="1846770">=</span>&nbsp;<span class="ident" id="1846772">table</span><span class="op" id="1846777">[</span><span class="ident" id="1846778">i</span><span class="op" id="1846779">]</span><span class="op" id="1846780">.</span><span class="ident" id="1846781">bbb</span><span class="op" id="1846784">.</span><span class="ident" id="1846785">bitLen</span><span class="op" id="1846791">(</span><span class="op" id="1846792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1846797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1846801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1846804">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1846808">if</span>&nbsp;<span class="ident" id="1846811">b</span>&nbsp;<span class="op" id="1846813">==</span>&nbsp;<span class="num" id="1846816">10</span>&nbsp;<span class="op" id="1846819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846823">cacheBase10</span><span class="op" id="1846834">.</span><span class="ident" id="1846835">Unlock</span><span class="op" id="1846841">(</span><span class="op" id="1846842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1846845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1846849">return</span>&nbsp;<span class="ident" id="1846856">table</span><br>
<span class="lineno"></span><span class="op" id="1846862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1846865">const</span>&nbsp;<span class="ident" id="1846871">deBruijn32</span>&nbsp;<span class="op" id="1846882">=</span>&nbsp;<span class="num" id="1846884">0x077CB531</span><br>
<span class="lineno"></span><br>
<span class="lineno">990</span><span class="keyword" id="1846896">var</span>&nbsp;<span class="ident" id="1846900">deBruijn32Lookup</span>&nbsp;<span class="op" id="1846917">=</span>&nbsp;<span class="op" id="1846919">[</span><span class="op" id="1846920">]</span><span class="builtintype" id="1846921">byte</span><span class="op" id="1846925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="1846928">0</span><span class="op" id="1846929">,</span>&nbsp;<span class="num" id="1846931">1</span><span class="op" id="1846932">,</span>&nbsp;<span class="num" id="1846934">28</span><span class="op" id="1846936">,</span>&nbsp;<span class="num" id="1846938">2</span><span class="op" id="1846939">,</span>&nbsp;<span class="num" id="1846941">29</span><span class="op" id="1846943">,</span>&nbsp;<span class="num" id="1846945">14</span><span class="op" id="1846947">,</span>&nbsp;<span class="num" id="1846949">24</span><span class="op" id="1846951">,</span>&nbsp;<span class="num" id="1846953">3</span><span class="op" id="1846954">,</span>&nbsp;<span class="num" id="1846956">30</span><span class="op" id="1846958">,</span>&nbsp;<span class="num" id="1846960">22</span><span class="op" id="1846962">,</span>&nbsp;<span class="num" id="1846964">20</span><span class="op" id="1846966">,</span>&nbsp;<span class="num" id="1846968">15</span><span class="op" id="1846970">,</span>&nbsp;<span class="num" id="1846972">25</span><span class="op" id="1846974">,</span>&nbsp;<span class="num" id="1846976">17</span><span class="op" id="1846978">,</span>&nbsp;<span class="num" id="1846980">4</span><span class="op" id="1846981">,</span>&nbsp;<span class="num" id="1846983">8</span><span class="op" id="1846984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="1846987">31</span><span class="op" id="1846989">,</span>&nbsp;<span class="num" id="1846991">27</span><span class="op" id="1846993">,</span>&nbsp;<span class="num" id="1846995">13</span><span class="op" id="1846997">,</span>&nbsp;<span class="num" id="1846999">23</span><span class="op" id="1847001">,</span>&nbsp;<span class="num" id="1847003">21</span><span class="op" id="1847005">,</span>&nbsp;<span class="num" id="1847007">19</span><span class="op" id="1847009">,</span>&nbsp;<span class="num" id="1847011">16</span><span class="op" id="1847013">,</span>&nbsp;<span class="num" id="1847015">7</span><span class="op" id="1847016">,</span>&nbsp;<span class="num" id="1847018">26</span><span class="op" id="1847020">,</span>&nbsp;<span class="num" id="1847022">12</span><span class="op" id="1847024">,</span>&nbsp;<span class="num" id="1847026">18</span><span class="op" id="1847028">,</span>&nbsp;<span class="num" id="1847030">6</span><span class="op" id="1847031">,</span>&nbsp;<span class="num" id="1847033">11</span><span class="op" id="1847035">,</span>&nbsp;<span class="num" id="1847037">5</span><span class="op" id="1847038">,</span>&nbsp;<span class="num" id="1847040">10</span><span class="op" id="1847042">,</span>&nbsp;<span class="num" id="1847044">9</span><span class="op" id="1847045">,</span><br>
<span class="lineno"></span><span class="op" id="1847047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="1847050">const</span>&nbsp;<span class="ident" id="1847056">deBruijn64</span>&nbsp;<span class="op" id="1847067">=</span>&nbsp;<span class="num" id="1847069">0x03f79d71b4ca8b09</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1847089">var</span>&nbsp;<span class="ident" id="1847093">deBruijn64Lookup</span>&nbsp;<span class="op" id="1847110">=</span>&nbsp;<span class="op" id="1847112">[</span><span class="op" id="1847113">]</span><span class="builtintype" id="1847114">byte</span><span class="op" id="1847118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="1847121">0</span><span class="op" id="1847122">,</span>&nbsp;<span class="num" id="1847124">1</span><span class="op" id="1847125">,</span>&nbsp;<span class="num" id="1847127">56</span><span class="op" id="1847129">,</span>&nbsp;<span class="num" id="1847131">2</span><span class="op" id="1847132">,</span>&nbsp;<span class="num" id="1847134">57</span><span class="op" id="1847136">,</span>&nbsp;<span class="num" id="1847138">49</span><span class="op" id="1847140">,</span>&nbsp;<span class="num" id="1847142">28</span><span class="op" id="1847144">,</span>&nbsp;<span class="num" id="1847146">3</span><span class="op" id="1847147">,</span>&nbsp;<span class="num" id="1847149">61</span><span class="op" id="1847151">,</span>&nbsp;<span class="num" id="1847153">58</span><span class="op" id="1847155">,</span>&nbsp;<span class="num" id="1847157">42</span><span class="op" id="1847159">,</span>&nbsp;<span class="num" id="1847161">50</span><span class="op" id="1847163">,</span>&nbsp;<span class="num" id="1847165">38</span><span class="op" id="1847167">,</span>&nbsp;<span class="num" id="1847169">29</span><span class="op" id="1847171">,</span>&nbsp;<span class="num" id="1847173">17</span><span class="op" id="1847175">,</span>&nbsp;<span class="num" id="1847177">4</span><span class="op" id="1847178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="1847181">62</span><span class="op" id="1847183">,</span>&nbsp;<span class="num" id="1847185">47</span><span class="op" id="1847187">,</span>&nbsp;<span class="num" id="1847189">59</span><span class="op" id="1847191">,</span>&nbsp;<span class="num" id="1847193">36</span><span class="op" id="1847195">,</span>&nbsp;<span class="num" id="1847197">45</span><span class="op" id="1847199">,</span>&nbsp;<span class="num" id="1847201">43</span><span class="op" id="1847203">,</span>&nbsp;<span class="num" id="1847205">51</span><span class="op" id="1847207">,</span>&nbsp;<span class="num" id="1847209">22</span><span class="op" id="1847211">,</span>&nbsp;<span class="num" id="1847213">53</span><span class="op" id="1847215">,</span>&nbsp;<span class="num" id="1847217">39</span><span class="op" id="1847219">,</span>&nbsp;<span class="num" id="1847221">33</span><span class="op" id="1847223">,</span>&nbsp;<span class="num" id="1847225">30</span><span class="op" id="1847227">,</span>&nbsp;<span class="num" id="1847229">24</span><span class="op" id="1847231">,</span>&nbsp;<span class="num" id="1847233">18</span><span class="op" id="1847235">,</span>&nbsp;<span class="num" id="1847237">12</span><span class="op" id="1847239">,</span>&nbsp;<span class="num" id="1847241">5</span><span class="op" id="1847242">,</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="1847245">63</span><span class="op" id="1847247">,</span>&nbsp;<span class="num" id="1847249">55</span><span class="op" id="1847251">,</span>&nbsp;<span class="num" id="1847253">48</span><span class="op" id="1847255">,</span>&nbsp;<span class="num" id="1847257">27</span><span class="op" id="1847259">,</span>&nbsp;<span class="num" id="1847261">60</span><span class="op" id="1847263">,</span>&nbsp;<span class="num" id="1847265">41</span><span class="op" id="1847267">,</span>&nbsp;<span class="num" id="1847269">37</span><span class="op" id="1847271">,</span>&nbsp;<span class="num" id="1847273">16</span><span class="op" id="1847275">,</span>&nbsp;<span class="num" id="1847277">46</span><span class="op" id="1847279">,</span>&nbsp;<span class="num" id="1847281">35</span><span class="op" id="1847283">,</span>&nbsp;<span class="num" id="1847285">44</span><span class="op" id="1847287">,</span>&nbsp;<span class="num" id="1847289">21</span><span class="op" id="1847291">,</span>&nbsp;<span class="num" id="1847293">52</span><span class="op" id="1847295">,</span>&nbsp;<span class="num" id="1847297">32</span><span class="op" id="1847299">,</span>&nbsp;<span class="num" id="1847301">23</span><span class="op" id="1847303">,</span>&nbsp;<span class="num" id="1847305">11</span><span class="op" id="1847307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="1847310">54</span><span class="op" id="1847312">,</span>&nbsp;<span class="num" id="1847314">26</span><span class="op" id="1847316">,</span>&nbsp;<span class="num" id="1847318">40</span><span class="op" id="1847320">,</span>&nbsp;<span class="num" id="1847322">15</span><span class="op" id="1847324">,</span>&nbsp;<span class="num" id="1847326">34</span><span class="op" id="1847328">,</span>&nbsp;<span class="num" id="1847330">20</span><span class="op" id="1847332">,</span>&nbsp;<span class="num" id="1847334">31</span><span class="op" id="1847336">,</span>&nbsp;<span class="num" id="1847338">10</span><span class="op" id="1847340">,</span>&nbsp;<span class="num" id="1847342">25</span><span class="op" id="1847344">,</span>&nbsp;<span class="num" id="1847346">14</span><span class="op" id="1847348">,</span>&nbsp;<span class="num" id="1847350">19</span><span class="op" id="1847352">,</span>&nbsp;<span class="num" id="1847354">9</span><span class="op" id="1847355">,</span>&nbsp;<span class="num" id="1847357">13</span><span class="op" id="1847359">,</span>&nbsp;<span class="num" id="1847361">8</span><span class="op" id="1847362">,</span>&nbsp;<span class="num" id="1847364">7</span><span class="op" id="1847365">,</span>&nbsp;<span class="num" id="1847367">6</span><span class="op" id="1847368">,</span><br>
<span class="lineno"></span><span class="op" id="1847370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1847373">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno">1005</span><span class="comment" id="1847450">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="1847464">func</span>&nbsp;<span class="ident" id="1847469">trailingZeroBits</span><span class="op" id="1847485">(</span><span class="ident" id="1847486">x</span>&nbsp;<span class="ident" id="1847488">Word</span><span class="op" id="1847492">)</span>&nbsp;<span class="builtintype" id="1847494">uint</span>&nbsp;<span class="op" id="1847499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1847502">//&nbsp;x&nbsp;&amp;&nbsp;-x&nbsp;leaves&nbsp;only&nbsp;the&nbsp;right-most&nbsp;bit&nbsp;set&nbsp;in&nbsp;the&nbsp;word.&nbsp;Let&nbsp;k&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1847574">//&nbsp;index&nbsp;of&nbsp;that&nbsp;bit.&nbsp;Since&nbsp;only&nbsp;a&nbsp;single&nbsp;bit&nbsp;is&nbsp;set,&nbsp;the&nbsp;value&nbsp;is&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1847646">//&nbsp;to&nbsp;the&nbsp;power&nbsp;of&nbsp;k.&nbsp;Multiplying&nbsp;by&nbsp;a&nbsp;power&nbsp;of&nbsp;two&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1847716">//&nbsp;left&nbsp;shifting,&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;k&nbsp;bits.&nbsp;&nbsp;The&nbsp;de&nbsp;Bruijn&nbsp;constant&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1847786">//&nbsp;such&nbsp;that&nbsp;all&nbsp;six&nbsp;bit,&nbsp;consecutive&nbsp;substrings&nbsp;are&nbsp;distinct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1847850">//&nbsp;Therefore,&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;left&nbsp;shifted&nbsp;version&nbsp;of&nbsp;this&nbsp;constant&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1847923">//&nbsp;find&nbsp;by&nbsp;how&nbsp;many&nbsp;bits&nbsp;it&nbsp;was&nbsp;shifted&nbsp;by&nbsp;looking&nbsp;at&nbsp;which&nbsp;six&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1847992">//&nbsp;substring&nbsp;ended&nbsp;up&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;word.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1848039">//&nbsp;(Knuth,&nbsp;volume&nbsp;4,&nbsp;section&nbsp;7.3.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848076">switch</span>&nbsp;<span class="ident" id="1848083">_W</span>&nbsp;<span class="op" id="1848086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848089">case</span>&nbsp;<span class="num" id="1848094">32</span><span class="op" id="1848096">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848100">return</span>&nbsp;<span class="builtintype" id="1848107">uint</span><span class="op" id="1848111">(</span><span class="ident" id="1848112">deBruijn32Lookup</span><span class="op" id="1848128">[</span><span class="op" id="1848129">(</span><span class="op" id="1848130">(</span><span class="ident" id="1848131">x</span><span class="op" id="1848132">&amp;</span><span class="op" id="1848133">-</span><span class="ident" id="1848134">x</span><span class="op" id="1848135">)</span><span class="op" id="1848136">*</span><span class="ident" id="1848137">deBruijn32</span><span class="op" id="1848147">)</span><span class="op" id="1848148">&gt;&gt;</span><span class="num" id="1848150">27</span><span class="op" id="1848152">]</span><span class="op" id="1848153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848156">case</span>&nbsp;<span class="num" id="1848161">64</span><span class="op" id="1848163">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848167">return</span>&nbsp;<span class="builtintype" id="1848174">uint</span><span class="op" id="1848178">(</span><span class="ident" id="1848179">deBruijn64Lookup</span><span class="op" id="1848195">[</span><span class="op" id="1848196">(</span><span class="op" id="1848197">(</span><span class="ident" id="1848198">x</span><span class="op" id="1848199">&amp;</span><span class="op" id="1848200">-</span><span class="ident" id="1848201">x</span><span class="op" id="1848202">)</span><span class="op" id="1848203">*</span><span class="op" id="1848204">(</span><span class="ident" id="1848205">deBruijn64</span><span class="op" id="1848215">&amp;</span><span class="ident" id="1848216">_M</span><span class="op" id="1848218">)</span><span class="op" id="1848219">)</span><span class="op" id="1848220">&gt;&gt;</span><span class="num" id="1848222">58</span><span class="op" id="1848224">]</span><span class="op" id="1848225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848228">default</span><span class="op" id="1848235">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1848239">panic</span><span class="op" id="1848244">(</span><span class="string" id="1848245">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="1848264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1848267">}</span><br>
<span class="lineno"></span><span class="op" id="1848269">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span><span class="comment" id="1848272">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="1848349">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="1848363">func</span>&nbsp;<span class="op" id="1848368">(</span><span class="ident" id="1848369">x</span>&nbsp;<span class="ident" id="1848371">nat</span><span class="op" id="1848374">)</span>&nbsp;<span class="ident" id="1848376">trailingZeroBits</span><span class="op" id="1848392">(</span><span class="op" id="1848393">)</span>&nbsp;<span class="builtintype" id="1848395">uint</span>&nbsp;<span class="op" id="1848400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848403">if</span>&nbsp;<span class="builtinfunc" id="1848406">len</span><span class="op" id="1848409">(</span><span class="ident" id="1848410">x</span><span class="op" id="1848411">)</span>&nbsp;<span class="op" id="1848413">==</span>&nbsp;<span class="num" id="1848416">0</span>&nbsp;<span class="op" id="1848418">{</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848422">return</span>&nbsp;<span class="num" id="1848429">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1848432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848435">var</span>&nbsp;<span class="ident" id="1848439">i</span>&nbsp;<span class="builtintype" id="1848441">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848447">for</span>&nbsp;<span class="ident" id="1848451">x</span><span class="op" id="1848452">[</span><span class="ident" id="1848453">i</span><span class="op" id="1848454">]</span>&nbsp;<span class="op" id="1848456">==</span>&nbsp;<span class="num" id="1848459">0</span>&nbsp;<span class="op" id="1848461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848465">i</span><span class="op" id="1848466">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1848470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1848473">//&nbsp;x[i]&nbsp;!=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848487">return</span>&nbsp;<span class="ident" id="1848494">i</span><span class="op" id="1848495">*</span><span class="ident" id="1848496">_W</span>&nbsp;<span class="op" id="1848499">+</span>&nbsp;<span class="ident" id="1848501">trailingZeroBits</span><span class="op" id="1848517">(</span><span class="ident" id="1848518">x</span><span class="op" id="1848519">[</span><span class="ident" id="1848520">i</span><span class="op" id="1848521">]</span><span class="op" id="1848522">)</span><br>
<span class="lineno"></span><span class="op" id="1848524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1040</span><span class="comment" id="1848527">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&lt;&lt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="1848541">func</span>&nbsp;<span class="op" id="1848546">(</span><span class="ident" id="1848547">z</span>&nbsp;<span class="ident" id="1848549">nat</span><span class="op" id="1848552">)</span>&nbsp;<span class="ident" id="1848554">shl</span><span class="op" id="1848557">(</span><span class="ident" id="1848558">x</span>&nbsp;<span class="ident" id="1848560">nat</span><span class="op" id="1848563">,</span>&nbsp;<span class="ident" id="1848565">s</span>&nbsp;<span class="builtintype" id="1848567">uint</span><span class="op" id="1848571">)</span>&nbsp;<span class="ident" id="1848573">nat</span>&nbsp;<span class="op" id="1848577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848580">m</span>&nbsp;<span class="op" id="1848582">:=</span>&nbsp;<span class="builtinfunc" id="1848585">len</span><span class="op" id="1848588">(</span><span class="ident" id="1848589">x</span><span class="op" id="1848590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848593">if</span>&nbsp;<span class="ident" id="1848596">m</span>&nbsp;<span class="op" id="1848598">==</span>&nbsp;<span class="num" id="1848601">0</span>&nbsp;<span class="op" id="1848603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848607">return</span>&nbsp;<span class="ident" id="1848614">z</span><span class="op" id="1848615">.</span><span class="builtinfunc" id="1848616">make</span><span class="op" id="1848620">(</span><span class="num" id="1848621">0</span><span class="op" id="1848622">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1848625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1848628">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848639">n</span>&nbsp;<span class="op" id="1848641">:=</span>&nbsp;<span class="ident" id="1848644">m</span>&nbsp;<span class="op" id="1848646">+</span>&nbsp;<span class="builtintype" id="1848648">int</span><span class="op" id="1848651">(</span><span class="ident" id="1848652">s</span><span class="op" id="1848653">/</span><span class="ident" id="1848654">_W</span><span class="op" id="1848656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848659">z</span>&nbsp;<span class="op" id="1848661">=</span>&nbsp;<span class="ident" id="1848663">z</span><span class="op" id="1848664">.</span><span class="builtinfunc" id="1848665">make</span><span class="op" id="1848669">(</span><span class="ident" id="1848670">n</span>&nbsp;<span class="op" id="1848672">+</span>&nbsp;<span class="num" id="1848674">1</span><span class="op" id="1848675">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848678">z</span><span class="op" id="1848679">[</span><span class="ident" id="1848680">n</span><span class="op" id="1848681">]</span>&nbsp;<span class="op" id="1848683">=</span>&nbsp;<span class="ident" id="1848685">shlVU</span><span class="op" id="1848690">(</span><span class="ident" id="1848691">z</span><span class="op" id="1848692">[</span><span class="ident" id="1848693">n</span><span class="op" id="1848694">-</span><span class="ident" id="1848695">m</span><span class="op" id="1848696">:</span><span class="ident" id="1848697">n</span><span class="op" id="1848698">]</span><span class="op" id="1848699">,</span>&nbsp;<span class="ident" id="1848701">x</span><span class="op" id="1848702">,</span>&nbsp;<span class="ident" id="1848704">s</span><span class="op" id="1848705">%</span><span class="ident" id="1848706">_W</span><span class="op" id="1848708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848711">z</span><span class="op" id="1848712">[</span><span class="num" id="1848713">0</span>&nbsp;<span class="op" id="1848715">:</span>&nbsp;<span class="ident" id="1848717">n</span><span class="op" id="1848718">-</span><span class="ident" id="1848719">m</span><span class="op" id="1848720">]</span><span class="op" id="1848721">.</span><span class="ident" id="1848722">clear</span><span class="op" id="1848727">(</span><span class="op" id="1848728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848732">return</span>&nbsp;<span class="ident" id="1848739">z</span><span class="op" id="1848740">.</span><span class="ident" id="1848741">norm</span><span class="op" id="1848745">(</span><span class="op" id="1848746">)</span><br>
<span class="lineno"></span><span class="op" id="1848748">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span><span class="comment" id="1848751">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&gt;&gt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="1848765">func</span>&nbsp;<span class="op" id="1848770">(</span><span class="ident" id="1848771">z</span>&nbsp;<span class="ident" id="1848773">nat</span><span class="op" id="1848776">)</span>&nbsp;<span class="ident" id="1848778">shr</span><span class="op" id="1848781">(</span><span class="ident" id="1848782">x</span>&nbsp;<span class="ident" id="1848784">nat</span><span class="op" id="1848787">,</span>&nbsp;<span class="ident" id="1848789">s</span>&nbsp;<span class="builtintype" id="1848791">uint</span><span class="op" id="1848795">)</span>&nbsp;<span class="ident" id="1848797">nat</span>&nbsp;<span class="op" id="1848801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848804">m</span>&nbsp;<span class="op" id="1848806">:=</span>&nbsp;<span class="builtinfunc" id="1848809">len</span><span class="op" id="1848812">(</span><span class="ident" id="1848813">x</span><span class="op" id="1848814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848817">n</span>&nbsp;<span class="op" id="1848819">:=</span>&nbsp;<span class="ident" id="1848822">m</span>&nbsp;<span class="op" id="1848824">-</span>&nbsp;<span class="builtintype" id="1848826">int</span><span class="op" id="1848829">(</span><span class="ident" id="1848830">s</span><span class="op" id="1848831">/</span><span class="ident" id="1848832">_W</span><span class="op" id="1848834">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848837">if</span>&nbsp;<span class="ident" id="1848840">n</span>&nbsp;<span class="op" id="1848842">&lt;=</span>&nbsp;<span class="num" id="1848845">0</span>&nbsp;<span class="op" id="1848847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848851">return</span>&nbsp;<span class="ident" id="1848858">z</span><span class="op" id="1848859">.</span><span class="builtinfunc" id="1848860">make</span><span class="op" id="1848864">(</span><span class="num" id="1848865">0</span><span class="op" id="1848866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1848869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1848872">//&nbsp;n&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848883">z</span>&nbsp;<span class="op" id="1848885">=</span>&nbsp;<span class="ident" id="1848887">z</span><span class="op" id="1848888">.</span><span class="builtinfunc" id="1848889">make</span><span class="op" id="1848893">(</span><span class="ident" id="1848894">n</span><span class="op" id="1848895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848898">shrVU</span><span class="op" id="1848903">(</span><span class="ident" id="1848904">z</span><span class="op" id="1848905">,</span>&nbsp;<span class="ident" id="1848907">x</span><span class="op" id="1848908">[</span><span class="ident" id="1848909">m</span><span class="op" id="1848910">-</span><span class="ident" id="1848911">n</span><span class="op" id="1848912">:</span><span class="op" id="1848913">]</span><span class="op" id="1848914">,</span>&nbsp;<span class="ident" id="1848916">s</span><span class="op" id="1848917">%</span><span class="ident" id="1848918">_W</span><span class="op" id="1848920">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848924">return</span>&nbsp;<span class="ident" id="1848931">z</span><span class="op" id="1848932">.</span><span class="ident" id="1848933">norm</span><span class="op" id="1848937">(</span><span class="op" id="1848938">)</span><br>
<span class="lineno"></span><span class="op" id="1848940">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="1848943">func</span>&nbsp;<span class="op" id="1848948">(</span><span class="ident" id="1848949">z</span>&nbsp;<span class="ident" id="1848951">nat</span><span class="op" id="1848954">)</span>&nbsp;<span class="ident" id="1848956">setBit</span><span class="op" id="1848962">(</span><span class="ident" id="1848963">x</span>&nbsp;<span class="ident" id="1848965">nat</span><span class="op" id="1848968">,</span>&nbsp;<span class="ident" id="1848970">i</span>&nbsp;<span class="builtintype" id="1848972">uint</span><span class="op" id="1848976">,</span>&nbsp;<span class="ident" id="1848978">b</span>&nbsp;<span class="builtintype" id="1848980">uint</span><span class="op" id="1848984">)</span>&nbsp;<span class="ident" id="1848986">nat</span>&nbsp;<span class="op" id="1848990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848993">j</span>&nbsp;<span class="op" id="1848995">:=</span>&nbsp;<span class="builtintype" id="1848998">int</span><span class="op" id="1849001">(</span><span class="ident" id="1849002">i</span>&nbsp;<span class="op" id="1849004">/</span>&nbsp;<span class="ident" id="1849006">_W</span><span class="op" id="1849008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849011">m</span>&nbsp;<span class="op" id="1849013">:=</span>&nbsp;<span class="ident" id="1849016">Word</span><span class="op" id="1849020">(</span><span class="num" id="1849021">1</span><span class="op" id="1849022">)</span>&nbsp;<span class="op" id="1849024">&lt;&lt;</span>&nbsp;<span class="op" id="1849027">(</span><span class="ident" id="1849028">i</span>&nbsp;<span class="op" id="1849030">%</span>&nbsp;<span class="ident" id="1849032">_W</span><span class="op" id="1849034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849037">n</span>&nbsp;<span class="op" id="1849039">:=</span>&nbsp;<span class="builtinfunc" id="1849042">len</span><span class="op" id="1849045">(</span><span class="ident" id="1849046">x</span><span class="op" id="1849047">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849050">switch</span>&nbsp;<span class="ident" id="1849057">b</span>&nbsp;<span class="op" id="1849059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849062">case</span>&nbsp;<span class="num" id="1849067">0</span><span class="op" id="1849068">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849072">z</span>&nbsp;<span class="op" id="1849074">=</span>&nbsp;<span class="ident" id="1849076">z</span><span class="op" id="1849077">.</span><span class="builtinfunc" id="1849078">make</span><span class="op" id="1849082">(</span><span class="ident" id="1849083">n</span><span class="op" id="1849084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1849088">copy</span><span class="op" id="1849092">(</span><span class="ident" id="1849093">z</span><span class="op" id="1849094">,</span>&nbsp;<span class="ident" id="1849096">x</span><span class="op" id="1849097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849101">if</span>&nbsp;<span class="ident" id="1849104">j</span>&nbsp;<span class="op" id="1849106">&gt;=</span>&nbsp;<span class="ident" id="1849109">n</span>&nbsp;<span class="op" id="1849111">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1849116">//&nbsp;no&nbsp;need&nbsp;to&nbsp;grow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849138">return</span>&nbsp;<span class="ident" id="1849145">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849153">z</span><span class="op" id="1849154">[</span><span class="ident" id="1849155">j</span><span class="op" id="1849156">]</span>&nbsp;<span class="op" id="1849158">&amp;^=</span>&nbsp;<span class="ident" id="1849162">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849166">return</span>&nbsp;<span class="ident" id="1849173">z</span><span class="op" id="1849174">.</span><span class="ident" id="1849175">norm</span><span class="op" id="1849179">(</span><span class="op" id="1849180">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849183">case</span>&nbsp;<span class="num" id="1849188">1</span><span class="op" id="1849189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849193">if</span>&nbsp;<span class="ident" id="1849196">j</span>&nbsp;<span class="op" id="1849198">&gt;=</span>&nbsp;<span class="ident" id="1849201">n</span>&nbsp;<span class="op" id="1849203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849208">z</span>&nbsp;<span class="op" id="1849210">=</span>&nbsp;<span class="ident" id="1849212">z</span><span class="op" id="1849213">.</span><span class="builtinfunc" id="1849214">make</span><span class="op" id="1849218">(</span><span class="ident" id="1849219">j</span>&nbsp;<span class="op" id="1849221">+</span>&nbsp;<span class="num" id="1849223">1</span><span class="op" id="1849224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849229">z</span><span class="op" id="1849230">[</span><span class="ident" id="1849231">n</span><span class="op" id="1849232">:</span><span class="op" id="1849233">]</span><span class="op" id="1849234">.</span><span class="ident" id="1849235">clear</span><span class="op" id="1849240">(</span><span class="op" id="1849241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849245">}</span>&nbsp;<span class="keyword" id="1849247">else</span>&nbsp;<span class="op" id="1849252">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849257">z</span>&nbsp;<span class="op" id="1849259">=</span>&nbsp;<span class="ident" id="1849261">z</span><span class="op" id="1849262">.</span><span class="builtinfunc" id="1849263">make</span><span class="op" id="1849267">(</span><span class="ident" id="1849268">n</span><span class="op" id="1849269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1849277">copy</span><span class="op" id="1849281">(</span><span class="ident" id="1849282">z</span><span class="op" id="1849283">,</span>&nbsp;<span class="ident" id="1849285">x</span><span class="op" id="1849286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849290">z</span><span class="op" id="1849291">[</span><span class="ident" id="1849292">j</span><span class="op" id="1849293">]</span>&nbsp;<span class="op" id="1849295">|=</span>&nbsp;<span class="ident" id="1849298">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1849302">//&nbsp;no&nbsp;need&nbsp;to&nbsp;normalize</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849328">return</span>&nbsp;<span class="ident" id="1849335">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1849341">panic</span><span class="op" id="1849346">(</span><span class="string" id="1849347">&#34;set&nbsp;bit&nbsp;is&nbsp;not&nbsp;0&nbsp;or&nbsp;1&#34;</span><span class="op" id="1849370">)</span><br>
<span class="lineno"></span><span class="op" id="1849372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1100</span><span class="keyword" id="1849375">func</span>&nbsp;<span class="op" id="1849380">(</span><span class="ident" id="1849381">z</span>&nbsp;<span class="ident" id="1849383">nat</span><span class="op" id="1849386">)</span>&nbsp;<span class="ident" id="1849388">bit</span><span class="op" id="1849391">(</span><span class="ident" id="1849392">i</span>&nbsp;<span class="builtintype" id="1849394">uint</span><span class="op" id="1849398">)</span>&nbsp;<span class="builtintype" id="1849400">uint</span>&nbsp;<span class="op" id="1849405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849408">j</span>&nbsp;<span class="op" id="1849410">:=</span>&nbsp;<span class="builtintype" id="1849413">int</span><span class="op" id="1849416">(</span><span class="ident" id="1849417">i</span>&nbsp;<span class="op" id="1849419">/</span>&nbsp;<span class="ident" id="1849421">_W</span><span class="op" id="1849423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849426">if</span>&nbsp;<span class="ident" id="1849429">j</span>&nbsp;<span class="op" id="1849431">&gt;=</span>&nbsp;<span class="builtinfunc" id="1849434">len</span><span class="op" id="1849437">(</span><span class="ident" id="1849438">z</span><span class="op" id="1849439">)</span>&nbsp;<span class="op" id="1849441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849445">return</span>&nbsp;<span class="num" id="1849452">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849455">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849458">return</span>&nbsp;<span class="builtintype" id="1849465">uint</span><span class="op" id="1849469">(</span><span class="ident" id="1849470">z</span><span class="op" id="1849471">[</span><span class="ident" id="1849472">j</span><span class="op" id="1849473">]</span>&nbsp;<span class="op" id="1849475">&gt;&gt;</span>&nbsp;<span class="op" id="1849478">(</span><span class="ident" id="1849479">i</span>&nbsp;<span class="op" id="1849481">%</span>&nbsp;<span class="ident" id="1849483">_W</span><span class="op" id="1849485">)</span>&nbsp;<span class="op" id="1849487">&amp;</span>&nbsp;<span class="num" id="1849489">1</span><span class="op" id="1849490">)</span><br>
<span class="lineno"></span><span class="op" id="1849492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1849495">func</span>&nbsp;<span class="op" id="1849500">(</span><span class="ident" id="1849501">z</span>&nbsp;<span class="ident" id="1849503">nat</span><span class="op" id="1849506">)</span>&nbsp;<span class="ident" id="1849508">and</span><span class="op" id="1849511">(</span><span class="ident" id="1849512">x</span><span class="op" id="1849513">,</span>&nbsp;<span class="ident" id="1849515">y</span>&nbsp;<span class="ident" id="1849517">nat</span><span class="op" id="1849520">)</span>&nbsp;<span class="ident" id="1849522">nat</span>&nbsp;<span class="op" id="1849526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849529">m</span>&nbsp;<span class="op" id="1849531">:=</span>&nbsp;<span class="builtinfunc" id="1849534">len</span><span class="op" id="1849537">(</span><span class="ident" id="1849538">x</span><span class="op" id="1849539">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849542">n</span>&nbsp;<span class="op" id="1849544">:=</span>&nbsp;<span class="builtinfunc" id="1849547">len</span><span class="op" id="1849550">(</span><span class="ident" id="1849551">y</span><span class="op" id="1849552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849555">if</span>&nbsp;<span class="ident" id="1849558">m</span>&nbsp;<span class="op" id="1849560">&gt;</span>&nbsp;<span class="ident" id="1849562">n</span>&nbsp;<span class="op" id="1849564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849568">m</span>&nbsp;<span class="op" id="1849570">=</span>&nbsp;<span class="ident" id="1849572">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1849578">//&nbsp;m&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849590">z</span>&nbsp;<span class="op" id="1849592">=</span>&nbsp;<span class="ident" id="1849594">z</span><span class="op" id="1849595">.</span><span class="builtinfunc" id="1849596">make</span><span class="op" id="1849600">(</span><span class="ident" id="1849601">m</span><span class="op" id="1849602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849605">for</span>&nbsp;<span class="ident" id="1849609">i</span>&nbsp;<span class="op" id="1849611">:=</span>&nbsp;<span class="num" id="1849614">0</span><span class="op" id="1849615">;</span>&nbsp;<span class="ident" id="1849617">i</span>&nbsp;<span class="op" id="1849619">&lt;</span>&nbsp;<span class="ident" id="1849621">m</span><span class="op" id="1849622">;</span>&nbsp;<span class="ident" id="1849624">i</span><span class="op" id="1849625">++</span>&nbsp;<span class="op" id="1849628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849632">z</span><span class="op" id="1849633">[</span><span class="ident" id="1849634">i</span><span class="op" id="1849635">]</span>&nbsp;<span class="op" id="1849637">=</span>&nbsp;<span class="ident" id="1849639">x</span><span class="op" id="1849640">[</span><span class="ident" id="1849641">i</span><span class="op" id="1849642">]</span>&nbsp;<span class="op" id="1849644">&amp;</span>&nbsp;<span class="ident" id="1849646">y</span><span class="op" id="1849647">[</span><span class="ident" id="1849648">i</span><span class="op" id="1849649">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849652">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849656">return</span>&nbsp;<span class="ident" id="1849663">z</span><span class="op" id="1849664">.</span><span class="ident" id="1849665">norm</span><span class="op" id="1849669">(</span><span class="op" id="1849670">)</span><br>
<span class="lineno"></span><span class="op" id="1849672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1849675">func</span>&nbsp;<span class="op" id="1849680">(</span><span class="ident" id="1849681">z</span>&nbsp;<span class="ident" id="1849683">nat</span><span class="op" id="1849686">)</span>&nbsp;<span class="ident" id="1849688">andNot</span><span class="op" id="1849694">(</span><span class="ident" id="1849695">x</span><span class="op" id="1849696">,</span>&nbsp;<span class="ident" id="1849698">y</span>&nbsp;<span class="ident" id="1849700">nat</span><span class="op" id="1849703">)</span>&nbsp;<span class="ident" id="1849705">nat</span>&nbsp;<span class="op" id="1849709">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849712">m</span>&nbsp;<span class="op" id="1849714">:=</span>&nbsp;<span class="builtinfunc" id="1849717">len</span><span class="op" id="1849720">(</span><span class="ident" id="1849721">x</span><span class="op" id="1849722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849725">n</span>&nbsp;<span class="op" id="1849727">:=</span>&nbsp;<span class="builtinfunc" id="1849730">len</span><span class="op" id="1849733">(</span><span class="ident" id="1849734">y</span><span class="op" id="1849735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849738">if</span>&nbsp;<span class="ident" id="1849741">n</span>&nbsp;<span class="op" id="1849743">&gt;</span>&nbsp;<span class="ident" id="1849745">m</span>&nbsp;<span class="op" id="1849747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849751">n</span>&nbsp;<span class="op" id="1849753">=</span>&nbsp;<span class="ident" id="1849755">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849758">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1849761">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849773">z</span>&nbsp;<span class="op" id="1849775">=</span>&nbsp;<span class="ident" id="1849777">z</span><span class="op" id="1849778">.</span><span class="builtinfunc" id="1849779">make</span><span class="op" id="1849783">(</span><span class="ident" id="1849784">m</span><span class="op" id="1849785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849788">for</span>&nbsp;<span class="ident" id="1849792">i</span>&nbsp;<span class="op" id="1849794">:=</span>&nbsp;<span class="num" id="1849797">0</span><span class="op" id="1849798">;</span>&nbsp;<span class="ident" id="1849800">i</span>&nbsp;<span class="op" id="1849802">&lt;</span>&nbsp;<span class="ident" id="1849804">n</span><span class="op" id="1849805">;</span>&nbsp;<span class="ident" id="1849807">i</span><span class="op" id="1849808">++</span>&nbsp;<span class="op" id="1849811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849815">z</span><span class="op" id="1849816">[</span><span class="ident" id="1849817">i</span><span class="op" id="1849818">]</span>&nbsp;<span class="op" id="1849820">=</span>&nbsp;<span class="ident" id="1849822">x</span><span class="op" id="1849823">[</span><span class="ident" id="1849824">i</span><span class="op" id="1849825">]</span>&nbsp;<span class="op" id="1849827">&amp;^</span>&nbsp;<span class="ident" id="1849830">y</span><span class="op" id="1849831">[</span><span class="ident" id="1849832">i</span><span class="op" id="1849833">]</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1849839">copy</span><span class="op" id="1849843">(</span><span class="ident" id="1849844">z</span><span class="op" id="1849845">[</span><span class="ident" id="1849846">n</span><span class="op" id="1849847">:</span><span class="ident" id="1849848">m</span><span class="op" id="1849849">]</span><span class="op" id="1849850">,</span>&nbsp;<span class="ident" id="1849852">x</span><span class="op" id="1849853">[</span><span class="ident" id="1849854">n</span><span class="op" id="1849855">:</span><span class="ident" id="1849856">m</span><span class="op" id="1849857">]</span><span class="op" id="1849858">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849862">return</span>&nbsp;<span class="ident" id="1849869">z</span><span class="op" id="1849870">.</span><span class="ident" id="1849871">norm</span><span class="op" id="1849875">(</span><span class="op" id="1849876">)</span><br>
<span class="lineno"></span><span class="op" id="1849878">}</span><br>
<span class="lineno">1140</span><br>
<span class="lineno"></span><span class="keyword" id="1849881">func</span>&nbsp;<span class="op" id="1849886">(</span><span class="ident" id="1849887">z</span>&nbsp;<span class="ident" id="1849889">nat</span><span class="op" id="1849892">)</span>&nbsp;<span class="ident" id="1849894">or</span><span class="op" id="1849896">(</span><span class="ident" id="1849897">x</span><span class="op" id="1849898">,</span>&nbsp;<span class="ident" id="1849900">y</span>&nbsp;<span class="ident" id="1849902">nat</span><span class="op" id="1849905">)</span>&nbsp;<span class="ident" id="1849907">nat</span>&nbsp;<span class="op" id="1849911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849914">m</span>&nbsp;<span class="op" id="1849916">:=</span>&nbsp;<span class="builtinfunc" id="1849919">len</span><span class="op" id="1849922">(</span><span class="ident" id="1849923">x</span><span class="op" id="1849924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849927">n</span>&nbsp;<span class="op" id="1849929">:=</span>&nbsp;<span class="builtinfunc" id="1849932">len</span><span class="op" id="1849935">(</span><span class="ident" id="1849936">y</span><span class="op" id="1849937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849940">s</span>&nbsp;<span class="op" id="1849942">:=</span>&nbsp;<span class="ident" id="1849945">x</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849948">if</span>&nbsp;<span class="ident" id="1849951">m</span>&nbsp;<span class="op" id="1849953">&lt;</span>&nbsp;<span class="ident" id="1849955">n</span>&nbsp;<span class="op" id="1849957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849961">n</span><span class="op" id="1849962">,</span>&nbsp;<span class="ident" id="1849964">m</span>&nbsp;<span class="op" id="1849966">=</span>&nbsp;<span class="ident" id="1849968">m</span><span class="op" id="1849969">,</span>&nbsp;<span class="ident" id="1849971">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849975">s</span>&nbsp;<span class="op" id="1849977">=</span>&nbsp;<span class="ident" id="1849979">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1849985">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno">1150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849997">z</span>&nbsp;<span class="op" id="1849999">=</span>&nbsp;<span class="ident" id="1850001">z</span><span class="op" id="1850002">.</span><span class="builtinfunc" id="1850003">make</span><span class="op" id="1850007">(</span><span class="ident" id="1850008">m</span><span class="op" id="1850009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850012">for</span>&nbsp;<span class="ident" id="1850016">i</span>&nbsp;<span class="op" id="1850018">:=</span>&nbsp;<span class="num" id="1850021">0</span><span class="op" id="1850022">;</span>&nbsp;<span class="ident" id="1850024">i</span>&nbsp;<span class="op" id="1850026">&lt;</span>&nbsp;<span class="ident" id="1850028">n</span><span class="op" id="1850029">;</span>&nbsp;<span class="ident" id="1850031">i</span><span class="op" id="1850032">++</span>&nbsp;<span class="op" id="1850035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850039">z</span><span class="op" id="1850040">[</span><span class="ident" id="1850041">i</span><span class="op" id="1850042">]</span>&nbsp;<span class="op" id="1850044">=</span>&nbsp;<span class="ident" id="1850046">x</span><span class="op" id="1850047">[</span><span class="ident" id="1850048">i</span><span class="op" id="1850049">]</span>&nbsp;<span class="op" id="1850051">|</span>&nbsp;<span class="ident" id="1850053">y</span><span class="op" id="1850054">[</span><span class="ident" id="1850055">i</span><span class="op" id="1850056">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850059">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1850062">copy</span><span class="op" id="1850066">(</span><span class="ident" id="1850067">z</span><span class="op" id="1850068">[</span><span class="ident" id="1850069">n</span><span class="op" id="1850070">:</span><span class="ident" id="1850071">m</span><span class="op" id="1850072">]</span><span class="op" id="1850073">,</span>&nbsp;<span class="ident" id="1850075">s</span><span class="op" id="1850076">[</span><span class="ident" id="1850077">n</span><span class="op" id="1850078">:</span><span class="ident" id="1850079">m</span><span class="op" id="1850080">]</span><span class="op" id="1850081">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850085">return</span>&nbsp;<span class="ident" id="1850092">z</span><span class="op" id="1850093">.</span><span class="ident" id="1850094">norm</span><span class="op" id="1850098">(</span><span class="op" id="1850099">)</span><br>
<span class="lineno"></span><span class="op" id="1850101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="keyword" id="1850104">func</span>&nbsp;<span class="op" id="1850109">(</span><span class="ident" id="1850110">z</span>&nbsp;<span class="ident" id="1850112">nat</span><span class="op" id="1850115">)</span>&nbsp;<span class="ident" id="1850117">xor</span><span class="op" id="1850120">(</span><span class="ident" id="1850121">x</span><span class="op" id="1850122">,</span>&nbsp;<span class="ident" id="1850124">y</span>&nbsp;<span class="ident" id="1850126">nat</span><span class="op" id="1850129">)</span>&nbsp;<span class="ident" id="1850131">nat</span>&nbsp;<span class="op" id="1850135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850138">m</span>&nbsp;<span class="op" id="1850140">:=</span>&nbsp;<span class="builtinfunc" id="1850143">len</span><span class="op" id="1850146">(</span><span class="ident" id="1850147">x</span><span class="op" id="1850148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850151">n</span>&nbsp;<span class="op" id="1850153">:=</span>&nbsp;<span class="builtinfunc" id="1850156">len</span><span class="op" id="1850159">(</span><span class="ident" id="1850160">y</span><span class="op" id="1850161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850164">s</span>&nbsp;<span class="op" id="1850166">:=</span>&nbsp;<span class="ident" id="1850169">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850172">if</span>&nbsp;<span class="ident" id="1850175">m</span>&nbsp;<span class="op" id="1850177">&lt;</span>&nbsp;<span class="ident" id="1850179">n</span>&nbsp;<span class="op" id="1850181">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850185">n</span><span class="op" id="1850186">,</span>&nbsp;<span class="ident" id="1850188">m</span>&nbsp;<span class="op" id="1850190">=</span>&nbsp;<span class="ident" id="1850192">m</span><span class="op" id="1850193">,</span>&nbsp;<span class="ident" id="1850195">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850199">s</span>&nbsp;<span class="op" id="1850201">=</span>&nbsp;<span class="ident" id="1850203">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1850209">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850221">z</span>&nbsp;<span class="op" id="1850223">=</span>&nbsp;<span class="ident" id="1850225">z</span><span class="op" id="1850226">.</span><span class="builtinfunc" id="1850227">make</span><span class="op" id="1850231">(</span><span class="ident" id="1850232">m</span><span class="op" id="1850233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850236">for</span>&nbsp;<span class="ident" id="1850240">i</span>&nbsp;<span class="op" id="1850242">:=</span>&nbsp;<span class="num" id="1850245">0</span><span class="op" id="1850246">;</span>&nbsp;<span class="ident" id="1850248">i</span>&nbsp;<span class="op" id="1850250">&lt;</span>&nbsp;<span class="ident" id="1850252">n</span><span class="op" id="1850253">;</span>&nbsp;<span class="ident" id="1850255">i</span><span class="op" id="1850256">++</span>&nbsp;<span class="op" id="1850259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850263">z</span><span class="op" id="1850264">[</span><span class="ident" id="1850265">i</span><span class="op" id="1850266">]</span>&nbsp;<span class="op" id="1850268">=</span>&nbsp;<span class="ident" id="1850270">x</span><span class="op" id="1850271">[</span><span class="ident" id="1850272">i</span><span class="op" id="1850273">]</span>&nbsp;<span class="op" id="1850275">^</span>&nbsp;<span class="ident" id="1850277">y</span><span class="op" id="1850278">[</span><span class="ident" id="1850279">i</span><span class="op" id="1850280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1850286">copy</span><span class="op" id="1850290">(</span><span class="ident" id="1850291">z</span><span class="op" id="1850292">[</span><span class="ident" id="1850293">n</span><span class="op" id="1850294">:</span><span class="ident" id="1850295">m</span><span class="op" id="1850296">]</span><span class="op" id="1850297">,</span>&nbsp;<span class="ident" id="1850299">s</span><span class="op" id="1850300">[</span><span class="ident" id="1850301">n</span><span class="op" id="1850302">:</span><span class="ident" id="1850303">m</span><span class="op" id="1850304">]</span><span class="op" id="1850305">)</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850309">return</span>&nbsp;<span class="ident" id="1850316">z</span><span class="op" id="1850317">.</span><span class="ident" id="1850318">norm</span><span class="op" id="1850322">(</span><span class="op" id="1850323">)</span><br>
<span class="lineno"></span><span class="op" id="1850325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1850328">//&nbsp;greaterThan&nbsp;returns&nbsp;true&nbsp;iff&nbsp;(x1&lt;&lt;_W&nbsp;+&nbsp;x2)&nbsp;&gt;&nbsp;(y1&lt;&lt;_W&nbsp;+&nbsp;y2)</span><br>
<span class="lineno">1180</span><span class="keyword" id="1850390">func</span>&nbsp;<span class="ident" id="1850395">greaterThan</span><span class="op" id="1850406">(</span><span class="ident" id="1850407">x1</span><span class="op" id="1850409">,</span>&nbsp;<span class="ident" id="1850411">x2</span><span class="op" id="1850413">,</span>&nbsp;<span class="ident" id="1850415">y1</span><span class="op" id="1850417">,</span>&nbsp;<span class="ident" id="1850419">y2</span>&nbsp;<span class="ident" id="1850422">Word</span><span class="op" id="1850426">)</span>&nbsp;<span class="builtintype" id="1850428">bool</span>&nbsp;<span class="op" id="1850433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850436">return</span>&nbsp;<span class="ident" id="1850443">x1</span>&nbsp;<span class="op" id="1850446">&gt;</span>&nbsp;<span class="ident" id="1850448">y1</span>&nbsp;<span class="op" id="1850451">||</span>&nbsp;<span class="ident" id="1850454">x1</span>&nbsp;<span class="op" id="1850457">==</span>&nbsp;<span class="ident" id="1850460">y1</span>&nbsp;<span class="op" id="1850463">&amp;&amp;</span>&nbsp;<span class="ident" id="1850466">x2</span>&nbsp;<span class="op" id="1850469">&gt;</span>&nbsp;<span class="ident" id="1850471">y2</span><br>
<span class="lineno"></span><span class="op" id="1850474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1850477">//&nbsp;modW&nbsp;returns&nbsp;x&nbsp;%&nbsp;d.</span><br>
<span class="lineno">1185</span><span class="keyword" id="1850500">func</span>&nbsp;<span class="op" id="1850505">(</span><span class="ident" id="1850506">x</span>&nbsp;<span class="ident" id="1850508">nat</span><span class="op" id="1850511">)</span>&nbsp;<span class="ident" id="1850513">modW</span><span class="op" id="1850517">(</span><span class="ident" id="1850518">d</span>&nbsp;<span class="ident" id="1850520">Word</span><span class="op" id="1850524">)</span>&nbsp;<span class="op" id="1850526">(</span><span class="ident" id="1850527">r</span>&nbsp;<span class="ident" id="1850529">Word</span><span class="op" id="1850533">)</span>&nbsp;<span class="op" id="1850535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1850538">//&nbsp;TODO(agl):&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;q&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850598">var</span>&nbsp;<span class="ident" id="1850602">q</span>&nbsp;<span class="ident" id="1850604">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850609">q</span>&nbsp;<span class="op" id="1850611">=</span>&nbsp;<span class="ident" id="1850613">q</span><span class="op" id="1850614">.</span><span class="builtinfunc" id="1850615">make</span><span class="op" id="1850619">(</span><span class="builtinfunc" id="1850620">len</span><span class="op" id="1850623">(</span><span class="ident" id="1850624">x</span><span class="op" id="1850625">)</span><span class="op" id="1850626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850629">return</span>&nbsp;<span class="ident" id="1850636">divWVW</span><span class="op" id="1850642">(</span><span class="ident" id="1850643">q</span><span class="op" id="1850644">,</span>&nbsp;<span class="num" id="1850646">0</span><span class="op" id="1850647">,</span>&nbsp;<span class="ident" id="1850649">x</span><span class="op" id="1850650">,</span>&nbsp;<span class="ident" id="1850652">d</span><span class="op" id="1850653">)</span><br>
<span class="lineno">1190</span><span class="op" id="1850655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1850658">//&nbsp;random&nbsp;creates&nbsp;a&nbsp;random&nbsp;integer&nbsp;in&nbsp;[0..limit),&nbsp;using&nbsp;the&nbsp;space&nbsp;in&nbsp;z&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1850732">//&nbsp;possible.&nbsp;n&nbsp;is&nbsp;the&nbsp;bit&nbsp;length&nbsp;of&nbsp;limit.</span><br>
<span class="lineno"></span><span class="keyword" id="1850775">func</span>&nbsp;<span class="op" id="1850780">(</span><span class="ident" id="1850781">z</span>&nbsp;<span class="ident" id="1850783">nat</span><span class="op" id="1850786">)</span>&nbsp;<span class="ident" id="1850788">random</span><span class="op" id="1850794">(</span><span class="ident" id="1850795">rand</span>&nbsp;<span class="op" id="1850800">*</span><span class="ident" id="1850801">rand</span><span class="op" id="1850805">.</span><span class="ident" id="1850806">Rand</span><span class="op" id="1850810">,</span>&nbsp;<span class="ident" id="1850812">limit</span>&nbsp;<span class="ident" id="1850818">nat</span><span class="op" id="1850821">,</span>&nbsp;<span class="ident" id="1850823">n</span>&nbsp;<span class="builtintype" id="1850825">int</span><span class="op" id="1850828">)</span>&nbsp;<span class="ident" id="1850830">nat</span>&nbsp;<span class="op" id="1850834">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850837">if</span>&nbsp;<span class="ident" id="1850840">alias</span><span class="op" id="1850845">(</span><span class="ident" id="1850846">z</span><span class="op" id="1850847">,</span>&nbsp;<span class="ident" id="1850849">limit</span><span class="op" id="1850854">)</span>&nbsp;<span class="op" id="1850856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850860">z</span>&nbsp;<span class="op" id="1850862">=</span>&nbsp;<span class="ident" id="1850864">nil</span>&nbsp;<span class="comment" id="1850868">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;limit&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850914">z</span>&nbsp;<span class="op" id="1850916">=</span>&nbsp;<span class="ident" id="1850918">z</span><span class="op" id="1850919">.</span><span class="builtinfunc" id="1850920">make</span><span class="op" id="1850924">(</span><span class="builtinfunc" id="1850925">len</span><span class="op" id="1850928">(</span><span class="ident" id="1850929">limit</span><span class="op" id="1850934">)</span><span class="op" id="1850935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850939">bitLengthOfMSW</span>&nbsp;<span class="op" id="1850954">:=</span>&nbsp;<span class="builtintype" id="1850957">uint</span><span class="op" id="1850961">(</span><span class="ident" id="1850962">n</span>&nbsp;<span class="op" id="1850964">%</span>&nbsp;<span class="ident" id="1850966">_W</span><span class="op" id="1850968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850971">if</span>&nbsp;<span class="ident" id="1850974">bitLengthOfMSW</span>&nbsp;<span class="op" id="1850989">==</span>&nbsp;<span class="num" id="1850992">0</span>&nbsp;<span class="op" id="1850994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850998">bitLengthOfMSW</span>&nbsp;<span class="op" id="1851013">=</span>&nbsp;<span class="ident" id="1851015">_W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1851019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851022">mask</span>&nbsp;<span class="op" id="1851027">:=</span>&nbsp;<span class="ident" id="1851030">Word</span><span class="op" id="1851034">(</span><span class="op" id="1851035">(</span><span class="num" id="1851036">1</span>&nbsp;<span class="op" id="1851038">&lt;&lt;</span>&nbsp;<span class="ident" id="1851041">bitLengthOfMSW</span><span class="op" id="1851055">)</span>&nbsp;<span class="op" id="1851057">-</span>&nbsp;<span class="num" id="1851059">1</span><span class="op" id="1851060">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851064">for</span>&nbsp;<span class="op" id="1851068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851072">switch</span>&nbsp;<span class="ident" id="1851079">_W</span>&nbsp;<span class="op" id="1851082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851086">case</span>&nbsp;<span class="num" id="1851091">32</span><span class="op" id="1851093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851098">for</span>&nbsp;<span class="ident" id="1851102">i</span>&nbsp;<span class="op" id="1851104">:=</span>&nbsp;<span class="keyword" id="1851107">range</span>&nbsp;<span class="ident" id="1851113">z</span>&nbsp;<span class="op" id="1851115">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851121">z</span><span class="op" id="1851122">[</span><span class="ident" id="1851123">i</span><span class="op" id="1851124">]</span>&nbsp;<span class="op" id="1851126">=</span>&nbsp;<span class="ident" id="1851128">Word</span><span class="op" id="1851132">(</span><span class="ident" id="1851133">rand</span><span class="op" id="1851137">.</span><span class="ident" id="1851138">Uint32</span><span class="op" id="1851144">(</span><span class="op" id="1851145">)</span><span class="op" id="1851146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1851151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851155">case</span>&nbsp;<span class="num" id="1851160">64</span><span class="op" id="1851162">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851167">for</span>&nbsp;<span class="ident" id="1851171">i</span>&nbsp;<span class="op" id="1851173">:=</span>&nbsp;<span class="keyword" id="1851176">range</span>&nbsp;<span class="ident" id="1851182">z</span>&nbsp;<span class="op" id="1851184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851190">z</span><span class="op" id="1851191">[</span><span class="ident" id="1851192">i</span><span class="op" id="1851193">]</span>&nbsp;<span class="op" id="1851195">=</span>&nbsp;<span class="ident" id="1851197">Word</span><span class="op" id="1851201">(</span><span class="ident" id="1851202">rand</span><span class="op" id="1851206">.</span><span class="ident" id="1851207">Uint32</span><span class="op" id="1851213">(</span><span class="op" id="1851214">)</span><span class="op" id="1851215">)</span>&nbsp;<span class="op" id="1851217">|</span>&nbsp;<span class="ident" id="1851219">Word</span><span class="op" id="1851223">(</span><span class="ident" id="1851224">rand</span><span class="op" id="1851228">.</span><span class="ident" id="1851229">Uint32</span><span class="op" id="1851235">(</span><span class="op" id="1851236">)</span><span class="op" id="1851237">)</span><span class="op" id="1851238">&lt;&lt;</span><span class="num" id="1851240">32</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1851246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851250">default</span><span class="op" id="1851257">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1851262">panic</span><span class="op" id="1851267">(</span><span class="string" id="1851268">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="1851287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1851291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851295">z</span><span class="op" id="1851296">[</span><span class="builtinfunc" id="1851297">len</span><span class="op" id="1851300">(</span><span class="ident" id="1851301">limit</span><span class="op" id="1851306">)</span><span class="op" id="1851307">-</span><span class="num" id="1851308">1</span><span class="op" id="1851309">]</span>&nbsp;<span class="op" id="1851311">&amp;=</span>&nbsp;<span class="ident" id="1851314">mask</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851321">if</span>&nbsp;<span class="ident" id="1851324">z</span><span class="op" id="1851325">.</span><span class="ident" id="1851326">cmp</span><span class="op" id="1851329">(</span><span class="ident" id="1851330">limit</span><span class="op" id="1851335">)</span>&nbsp;<span class="op" id="1851337">&lt;</span>&nbsp;<span class="num" id="1851339">0</span>&nbsp;<span class="op" id="1851341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851346">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1851354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1851357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851361">return</span>&nbsp;<span class="ident" id="1851368">z</span><span class="op" id="1851369">.</span><span class="ident" id="1851370">norm</span><span class="op" id="1851374">(</span><span class="op" id="1851375">)</span><br>
<span class="lineno"></span><span class="op" id="1851377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1851380">//&nbsp;If&nbsp;m&nbsp;!=&nbsp;0&nbsp;(i.e.,&nbsp;len(m)&nbsp;!=&nbsp;0),&nbsp;expNN&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y&nbsp;mod&nbsp;m;</span><br>
<span class="lineno"></span><span class="comment" id="1851442">//&nbsp;otherwise&nbsp;it&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y.&nbsp;The&nbsp;result&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;z.</span><br>
<span class="lineno">1230</span><span class="keyword" id="1851504">func</span>&nbsp;<span class="op" id="1851509">(</span><span class="ident" id="1851510">z</span>&nbsp;<span class="ident" id="1851512">nat</span><span class="op" id="1851515">)</span>&nbsp;<span class="ident" id="1851517">expNN</span><span class="op" id="1851522">(</span><span class="ident" id="1851523">x</span><span class="op" id="1851524">,</span>&nbsp;<span class="ident" id="1851526">y</span><span class="op" id="1851527">,</span>&nbsp;<span class="ident" id="1851529">m</span>&nbsp;<span class="ident" id="1851531">nat</span><span class="op" id="1851534">)</span>&nbsp;<span class="ident" id="1851536">nat</span>&nbsp;<span class="op" id="1851540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851543">if</span>&nbsp;<span class="ident" id="1851546">alias</span><span class="op" id="1851551">(</span><span class="ident" id="1851552">z</span><span class="op" id="1851553">,</span>&nbsp;<span class="ident" id="1851555">x</span><span class="op" id="1851556">)</span>&nbsp;<span class="op" id="1851558">||</span>&nbsp;<span class="ident" id="1851561">alias</span><span class="op" id="1851566">(</span><span class="ident" id="1851567">z</span><span class="op" id="1851568">,</span>&nbsp;<span class="ident" id="1851570">y</span><span class="op" id="1851571">)</span>&nbsp;<span class="op" id="1851573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851577">//&nbsp;We&nbsp;cannot&nbsp;allow&nbsp;in-place&nbsp;modification&nbsp;of&nbsp;x&nbsp;or&nbsp;y.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851631">z</span>&nbsp;<span class="op" id="1851633">=</span>&nbsp;<span class="ident" id="1851635">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1851640">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851644">//&nbsp;x**y&nbsp;mod&nbsp;1&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851664">if</span>&nbsp;<span class="builtinfunc" id="1851667">len</span><span class="op" id="1851670">(</span><span class="ident" id="1851671">m</span><span class="op" id="1851672">)</span>&nbsp;<span class="op" id="1851674">==</span>&nbsp;<span class="num" id="1851677">1</span>&nbsp;<span class="op" id="1851679">&amp;&amp;</span>&nbsp;<span class="ident" id="1851682">m</span><span class="op" id="1851683">[</span><span class="num" id="1851684">0</span><span class="op" id="1851685">]</span>&nbsp;<span class="op" id="1851687">==</span>&nbsp;<span class="num" id="1851690">1</span>&nbsp;<span class="op" id="1851692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851696">return</span>&nbsp;<span class="ident" id="1851703">z</span><span class="op" id="1851704">.</span><span class="ident" id="1851705">setWord</span><span class="op" id="1851712">(</span><span class="num" id="1851713">0</span><span class="op" id="1851714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1851717">}</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851720">//&nbsp;m&nbsp;==&nbsp;0&nbsp;||&nbsp;m&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851741">//&nbsp;x**0&nbsp;==&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851755">if</span>&nbsp;<span class="builtinfunc" id="1851758">len</span><span class="op" id="1851761">(</span><span class="ident" id="1851762">y</span><span class="op" id="1851763">)</span>&nbsp;<span class="op" id="1851765">==</span>&nbsp;<span class="num" id="1851768">0</span>&nbsp;<span class="op" id="1851770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851774">return</span>&nbsp;<span class="ident" id="1851781">z</span><span class="op" id="1851782">.</span><span class="ident" id="1851783">setWord</span><span class="op" id="1851790">(</span><span class="num" id="1851791">1</span><span class="op" id="1851792">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1851795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851798">//&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851809">if</span>&nbsp;<span class="builtinfunc" id="1851812">len</span><span class="op" id="1851815">(</span><span class="ident" id="1851816">m</span><span class="op" id="1851817">)</span>&nbsp;<span class="op" id="1851819">!=</span>&nbsp;<span class="num" id="1851822">0</span>&nbsp;<span class="op" id="1851824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851828">//&nbsp;We&nbsp;likely&nbsp;end&nbsp;up&nbsp;being&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;modulus.</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851880">z</span>&nbsp;<span class="op" id="1851882">=</span>&nbsp;<span class="ident" id="1851884">z</span><span class="op" id="1851885">.</span><span class="builtinfunc" id="1851886">make</span><span class="op" id="1851890">(</span><span class="builtinfunc" id="1851891">len</span><span class="op" id="1851894">(</span><span class="ident" id="1851895">m</span><span class="op" id="1851896">)</span><span class="op" id="1851897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1851900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851903">z</span>&nbsp;<span class="op" id="1851905">=</span>&nbsp;<span class="ident" id="1851907">z</span><span class="op" id="1851908">.</span><span class="ident" id="1851909">set</span><span class="op" id="1851912">(</span><span class="ident" id="1851913">x</span><span class="op" id="1851914">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851918">//&nbsp;If&nbsp;the&nbsp;base&nbsp;is&nbsp;non-trivial&nbsp;and&nbsp;the&nbsp;exponent&nbsp;is&nbsp;large,&nbsp;we&nbsp;use</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851983">//&nbsp;4-bit,&nbsp;windowed&nbsp;exponentiation.&nbsp;This&nbsp;involves&nbsp;precomputing&nbsp;14&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1852056">//&nbsp;(x^2...x^15)&nbsp;but&nbsp;then&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;multiply-reduces&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1852126">//&nbsp;third.&nbsp;Even&nbsp;for&nbsp;a&nbsp;32-bit&nbsp;exponent,&nbsp;this&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1852192">//&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852208">if</span>&nbsp;<span class="builtinfunc" id="1852211">len</span><span class="op" id="1852214">(</span><span class="ident" id="1852215">x</span><span class="op" id="1852216">)</span>&nbsp;<span class="op" id="1852218">&gt;</span>&nbsp;<span class="num" id="1852220">1</span>&nbsp;<span class="op" id="1852222">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1852225">len</span><span class="op" id="1852228">(</span><span class="ident" id="1852229">y</span><span class="op" id="1852230">)</span>&nbsp;<span class="op" id="1852232">&gt;</span>&nbsp;<span class="num" id="1852234">1</span>&nbsp;<span class="op" id="1852236">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1852239">len</span><span class="op" id="1852242">(</span><span class="ident" id="1852243">m</span><span class="op" id="1852244">)</span>&nbsp;<span class="op" id="1852246">&gt;</span>&nbsp;<span class="num" id="1852248">0</span>&nbsp;<span class="op" id="1852250">{</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852254">return</span>&nbsp;<span class="ident" id="1852261">z</span><span class="op" id="1852262">.</span><span class="ident" id="1852263">expNNWindowed</span><span class="op" id="1852276">(</span><span class="ident" id="1852277">x</span><span class="op" id="1852278">,</span>&nbsp;<span class="ident" id="1852280">y</span><span class="op" id="1852281">,</span>&nbsp;<span class="ident" id="1852283">m</span><span class="op" id="1852284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1852287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852291">v</span>&nbsp;<span class="op" id="1852293">:=</span>&nbsp;<span class="ident" id="1852296">y</span><span class="op" id="1852297">[</span><span class="builtinfunc" id="1852298">len</span><span class="op" id="1852301">(</span><span class="ident" id="1852302">y</span><span class="op" id="1852303">)</span><span class="op" id="1852304">-</span><span class="num" id="1852305">1</span><span class="op" id="1852306">]</span>&nbsp;<span class="comment" id="1852308">//&nbsp;v&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;y&nbsp;is&nbsp;normalized&nbsp;and&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852352">shift</span>&nbsp;<span class="op" id="1852358">:=</span>&nbsp;<span class="ident" id="1852361">leadingZeros</span><span class="op" id="1852373">(</span><span class="ident" id="1852374">v</span><span class="op" id="1852375">)</span>&nbsp;<span class="op" id="1852377">+</span>&nbsp;<span class="num" id="1852379">1</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852382">v</span>&nbsp;<span class="op" id="1852384">&lt;&lt;=</span>&nbsp;<span class="ident" id="1852388">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852395">var</span>&nbsp;<span class="ident" id="1852399">q</span>&nbsp;<span class="ident" id="1852401">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852407">const</span>&nbsp;<span class="ident" id="1852413">mask</span>&nbsp;<span class="op" id="1852418">=</span>&nbsp;<span class="num" id="1852420">1</span>&nbsp;<span class="op" id="1852422">&lt;&lt;</span>&nbsp;<span class="op" id="1852425">(</span><span class="ident" id="1852426">_W</span>&nbsp;<span class="op" id="1852429">-</span>&nbsp;<span class="num" id="1852431">1</span><span class="op" id="1852432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1852436">//&nbsp;We&nbsp;walk&nbsp;through&nbsp;the&nbsp;bits&nbsp;of&nbsp;the&nbsp;exponent&nbsp;one&nbsp;by&nbsp;one.&nbsp;Each&nbsp;time&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1852506">//&nbsp;see&nbsp;a&nbsp;bit,&nbsp;we&nbsp;square,&nbsp;thus&nbsp;doubling&nbsp;the&nbsp;power.&nbsp;If&nbsp;the&nbsp;bit&nbsp;is&nbsp;a&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1852578">//&nbsp;we&nbsp;also&nbsp;multiply&nbsp;by&nbsp;x,&nbsp;thus&nbsp;adding&nbsp;one&nbsp;to&nbsp;the&nbsp;power.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852636">w</span>&nbsp;<span class="op" id="1852638">:=</span>&nbsp;<span class="ident" id="1852641">_W</span>&nbsp;<span class="op" id="1852644">-</span>&nbsp;<span class="builtintype" id="1852646">int</span><span class="op" id="1852649">(</span><span class="ident" id="1852650">shift</span><span class="op" id="1852655">)</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1852658">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1852718">//&nbsp;otherwise&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852759">var</span>&nbsp;<span class="ident" id="1852763">zz</span><span class="op" id="1852765">,</span>&nbsp;<span class="ident" id="1852767">r</span>&nbsp;<span class="ident" id="1852769">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852774">for</span>&nbsp;<span class="ident" id="1852778">j</span>&nbsp;<span class="op" id="1852780">:=</span>&nbsp;<span class="num" id="1852783">0</span><span class="op" id="1852784">;</span>&nbsp;<span class="ident" id="1852786">j</span>&nbsp;<span class="op" id="1852788">&lt;</span>&nbsp;<span class="ident" id="1852790">w</span><span class="op" id="1852791">;</span>&nbsp;<span class="ident" id="1852793">j</span><span class="op" id="1852794">++</span>&nbsp;<span class="op" id="1852797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852801">zz</span>&nbsp;<span class="op" id="1852804">=</span>&nbsp;<span class="ident" id="1852806">zz</span><span class="op" id="1852808">.</span><span class="ident" id="1852809">mul</span><span class="op" id="1852812">(</span><span class="ident" id="1852813">z</span><span class="op" id="1852814">,</span>&nbsp;<span class="ident" id="1852816">z</span><span class="op" id="1852817">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852821">zz</span><span class="op" id="1852823">,</span>&nbsp;<span class="ident" id="1852825">z</span>&nbsp;<span class="op" id="1852827">=</span>&nbsp;<span class="ident" id="1852829">z</span><span class="op" id="1852830">,</span>&nbsp;<span class="ident" id="1852832">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852838">if</span>&nbsp;<span class="ident" id="1852841">v</span><span class="op" id="1852842">&amp;</span><span class="ident" id="1852843">mask</span>&nbsp;<span class="op" id="1852848">!=</span>&nbsp;<span class="num" id="1852851">0</span>&nbsp;<span class="op" id="1852853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852858">zz</span>&nbsp;<span class="op" id="1852861">=</span>&nbsp;<span class="ident" id="1852863">zz</span><span class="op" id="1852865">.</span><span class="ident" id="1852866">mul</span><span class="op" id="1852869">(</span><span class="ident" id="1852870">z</span><span class="op" id="1852871">,</span>&nbsp;<span class="ident" id="1852873">x</span><span class="op" id="1852874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852879">zz</span><span class="op" id="1852881">,</span>&nbsp;<span class="ident" id="1852883">z</span>&nbsp;<span class="op" id="1852885">=</span>&nbsp;<span class="ident" id="1852887">z</span><span class="op" id="1852888">,</span>&nbsp;<span class="ident" id="1852890">zz</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1852895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852900">if</span>&nbsp;<span class="builtinfunc" id="1852903">len</span><span class="op" id="1852906">(</span><span class="ident" id="1852907">m</span><span class="op" id="1852908">)</span>&nbsp;<span class="op" id="1852910">!=</span>&nbsp;<span class="num" id="1852913">0</span>&nbsp;<span class="op" id="1852915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852920">zz</span><span class="op" id="1852922">,</span>&nbsp;<span class="ident" id="1852924">r</span>&nbsp;<span class="op" id="1852926">=</span>&nbsp;<span class="ident" id="1852928">zz</span><span class="op" id="1852930">.</span><span class="ident" id="1852931">div</span><span class="op" id="1852934">(</span><span class="ident" id="1852935">r</span><span class="op" id="1852936">,</span>&nbsp;<span class="ident" id="1852938">z</span><span class="op" id="1852939">,</span>&nbsp;<span class="ident" id="1852941">m</span><span class="op" id="1852942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852947">zz</span><span class="op" id="1852949">,</span>&nbsp;<span class="ident" id="1852951">r</span><span class="op" id="1852952">,</span>&nbsp;<span class="ident" id="1852954">q</span><span class="op" id="1852955">,</span>&nbsp;<span class="ident" id="1852957">z</span>&nbsp;<span class="op" id="1852959">=</span>&nbsp;<span class="ident" id="1852961">q</span><span class="op" id="1852962">,</span>&nbsp;<span class="ident" id="1852964">z</span><span class="op" id="1852965">,</span>&nbsp;<span class="ident" id="1852967">zz</span><span class="op" id="1852969">,</span>&nbsp;<span class="ident" id="1852971">r</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1852975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852980">v</span>&nbsp;<span class="op" id="1852982">&lt;&lt;=</span>&nbsp;<span class="num" id="1852986">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1852989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852993">for</span>&nbsp;<span class="ident" id="1852997">i</span>&nbsp;<span class="op" id="1852999">:=</span>&nbsp;<span class="builtinfunc" id="1853002">len</span><span class="op" id="1853005">(</span><span class="ident" id="1853006">y</span><span class="op" id="1853007">)</span>&nbsp;<span class="op" id="1853009">-</span>&nbsp;<span class="num" id="1853011">2</span><span class="op" id="1853012">;</span>&nbsp;<span class="ident" id="1853014">i</span>&nbsp;<span class="op" id="1853016">&gt;=</span>&nbsp;<span class="num" id="1853019">0</span><span class="op" id="1853020">;</span>&nbsp;<span class="ident" id="1853022">i</span><span class="op" id="1853023">--</span>&nbsp;<span class="op" id="1853026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853030">v</span>&nbsp;<span class="op" id="1853032">=</span>&nbsp;<span class="ident" id="1853034">y</span><span class="op" id="1853035">[</span><span class="ident" id="1853036">i</span><span class="op" id="1853037">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853042">for</span>&nbsp;<span class="ident" id="1853046">j</span>&nbsp;<span class="op" id="1853048">:=</span>&nbsp;<span class="num" id="1853051">0</span><span class="op" id="1853052">;</span>&nbsp;<span class="ident" id="1853054">j</span>&nbsp;<span class="op" id="1853056">&lt;</span>&nbsp;<span class="ident" id="1853058">_W</span><span class="op" id="1853060">;</span>&nbsp;<span class="ident" id="1853062">j</span><span class="op" id="1853063">++</span>&nbsp;<span class="op" id="1853066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853071">zz</span>&nbsp;<span class="op" id="1853074">=</span>&nbsp;<span class="ident" id="1853076">zz</span><span class="op" id="1853078">.</span><span class="ident" id="1853079">mul</span><span class="op" id="1853082">(</span><span class="ident" id="1853083">z</span><span class="op" id="1853084">,</span>&nbsp;<span class="ident" id="1853086">z</span><span class="op" id="1853087">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853092">zz</span><span class="op" id="1853094">,</span>&nbsp;<span class="ident" id="1853096">z</span>&nbsp;<span class="op" id="1853098">=</span>&nbsp;<span class="ident" id="1853100">z</span><span class="op" id="1853101">,</span>&nbsp;<span class="ident" id="1853103">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853110">if</span>&nbsp;<span class="ident" id="1853113">v</span><span class="op" id="1853114">&amp;</span><span class="ident" id="1853115">mask</span>&nbsp;<span class="op" id="1853120">!=</span>&nbsp;<span class="num" id="1853123">0</span>&nbsp;<span class="op" id="1853125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853131">zz</span>&nbsp;<span class="op" id="1853134">=</span>&nbsp;<span class="ident" id="1853136">zz</span><span class="op" id="1853138">.</span><span class="ident" id="1853139">mul</span><span class="op" id="1853142">(</span><span class="ident" id="1853143">z</span><span class="op" id="1853144">,</span>&nbsp;<span class="ident" id="1853146">x</span><span class="op" id="1853147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853153">zz</span><span class="op" id="1853155">,</span>&nbsp;<span class="ident" id="1853157">z</span>&nbsp;<span class="op" id="1853159">=</span>&nbsp;<span class="ident" id="1853161">z</span><span class="op" id="1853162">,</span>&nbsp;<span class="ident" id="1853164">zz</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853176">if</span>&nbsp;<span class="builtinfunc" id="1853179">len</span><span class="op" id="1853182">(</span><span class="ident" id="1853183">m</span><span class="op" id="1853184">)</span>&nbsp;<span class="op" id="1853186">!=</span>&nbsp;<span class="num" id="1853189">0</span>&nbsp;<span class="op" id="1853191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853197">zz</span><span class="op" id="1853199">,</span>&nbsp;<span class="ident" id="1853201">r</span>&nbsp;<span class="op" id="1853203">=</span>&nbsp;<span class="ident" id="1853205">zz</span><span class="op" id="1853207">.</span><span class="ident" id="1853208">div</span><span class="op" id="1853211">(</span><span class="ident" id="1853212">r</span><span class="op" id="1853213">,</span>&nbsp;<span class="ident" id="1853215">z</span><span class="op" id="1853216">,</span>&nbsp;<span class="ident" id="1853218">m</span><span class="op" id="1853219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853225">zz</span><span class="op" id="1853227">,</span>&nbsp;<span class="ident" id="1853229">r</span><span class="op" id="1853230">,</span>&nbsp;<span class="ident" id="1853232">q</span><span class="op" id="1853233">,</span>&nbsp;<span class="ident" id="1853235">z</span>&nbsp;<span class="op" id="1853237">=</span>&nbsp;<span class="ident" id="1853239">q</span><span class="op" id="1853240">,</span>&nbsp;<span class="ident" id="1853242">z</span><span class="op" id="1853243">,</span>&nbsp;<span class="ident" id="1853245">zz</span><span class="op" id="1853247">,</span>&nbsp;<span class="ident" id="1853249">r</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853260">v</span>&nbsp;<span class="op" id="1853262">&lt;&lt;=</span>&nbsp;<span class="num" id="1853266">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853273">}</span><br>
<span class="lineno">1315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853277">return</span>&nbsp;<span class="ident" id="1853284">z</span><span class="op" id="1853285">.</span><span class="ident" id="1853286">norm</span><span class="op" id="1853290">(</span><span class="op" id="1853291">)</span><br>
<span class="lineno"></span><span class="op" id="1853293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1853296">//&nbsp;expNNWindowed&nbsp;calculates&nbsp;x**y&nbsp;mod&nbsp;m&nbsp;using&nbsp;a&nbsp;fixed,&nbsp;4-bit&nbsp;window.</span><br>
<span class="lineno">1320</span><span class="keyword" id="1853364">func</span>&nbsp;<span class="op" id="1853369">(</span><span class="ident" id="1853370">z</span>&nbsp;<span class="ident" id="1853372">nat</span><span class="op" id="1853375">)</span>&nbsp;<span class="ident" id="1853377">expNNWindowed</span><span class="op" id="1853390">(</span><span class="ident" id="1853391">x</span><span class="op" id="1853392">,</span>&nbsp;<span class="ident" id="1853394">y</span><span class="op" id="1853395">,</span>&nbsp;<span class="ident" id="1853397">m</span>&nbsp;<span class="ident" id="1853399">nat</span><span class="op" id="1853402">)</span>&nbsp;<span class="ident" id="1853404">nat</span>&nbsp;<span class="op" id="1853408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1853411">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1853481">//&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853512">var</span>&nbsp;<span class="ident" id="1853516">zz</span><span class="op" id="1853518">,</span>&nbsp;<span class="ident" id="1853520">r</span>&nbsp;<span class="ident" id="1853522">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853528">const</span>&nbsp;<span class="ident" id="1853534">n</span>&nbsp;<span class="op" id="1853536">=</span>&nbsp;<span class="num" id="1853538">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1853541">//&nbsp;powers[i]&nbsp;contains&nbsp;x^i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853569">var</span>&nbsp;<span class="ident" id="1853573">powers</span>&nbsp;<span class="op" id="1853580">[</span><span class="num" id="1853581">1</span>&nbsp;<span class="op" id="1853583">&lt;&lt;</span>&nbsp;<span class="ident" id="1853586">n</span><span class="op" id="1853587">]</span><span class="ident" id="1853588">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853593">powers</span><span class="op" id="1853599">[</span><span class="num" id="1853600">0</span><span class="op" id="1853601">]</span>&nbsp;<span class="op" id="1853603">=</span>&nbsp;<span class="ident" id="1853605">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853613">powers</span><span class="op" id="1853619">[</span><span class="num" id="1853620">1</span><span class="op" id="1853621">]</span>&nbsp;<span class="op" id="1853623">=</span>&nbsp;<span class="ident" id="1853625">x</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853628">for</span>&nbsp;<span class="ident" id="1853632">i</span>&nbsp;<span class="op" id="1853634">:=</span>&nbsp;<span class="num" id="1853637">2</span><span class="op" id="1853638">;</span>&nbsp;<span class="ident" id="1853640">i</span>&nbsp;<span class="op" id="1853642">&lt;</span>&nbsp;<span class="num" id="1853644">1</span><span class="op" id="1853645">&lt;&lt;</span><span class="ident" id="1853647">n</span><span class="op" id="1853648">;</span>&nbsp;<span class="ident" id="1853650">i</span>&nbsp;<span class="op" id="1853652">+=</span>&nbsp;<span class="num" id="1853655">2</span>&nbsp;<span class="op" id="1853657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853661">p2</span><span class="op" id="1853663">,</span>&nbsp;<span class="ident" id="1853665">p</span><span class="op" id="1853666">,</span>&nbsp;<span class="ident" id="1853668">p1</span>&nbsp;<span class="op" id="1853671">:=</span>&nbsp;<span class="op" id="1853674">&amp;</span><span class="ident" id="1853675">powers</span><span class="op" id="1853681">[</span><span class="ident" id="1853682">i</span><span class="op" id="1853683">/</span><span class="num" id="1853684">2</span><span class="op" id="1853685">]</span><span class="op" id="1853686">,</span>&nbsp;<span class="op" id="1853688">&amp;</span><span class="ident" id="1853689">powers</span><span class="op" id="1853695">[</span><span class="ident" id="1853696">i</span><span class="op" id="1853697">]</span><span class="op" id="1853698">,</span>&nbsp;<span class="op" id="1853700">&amp;</span><span class="ident" id="1853701">powers</span><span class="op" id="1853707">[</span><span class="ident" id="1853708">i</span><span class="op" id="1853709">+</span><span class="num" id="1853710">1</span><span class="op" id="1853711">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853715">*</span><span class="ident" id="1853716">p</span>&nbsp;<span class="op" id="1853718">=</span>&nbsp;<span class="ident" id="1853720">p</span><span class="op" id="1853721">.</span><span class="ident" id="1853722">mul</span><span class="op" id="1853725">(</span><span class="op" id="1853726">*</span><span class="ident" id="1853727">p2</span><span class="op" id="1853729">,</span>&nbsp;<span class="op" id="1853731">*</span><span class="ident" id="1853732">p2</span><span class="op" id="1853734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853738">zz</span><span class="op" id="1853740">,</span>&nbsp;<span class="ident" id="1853742">r</span>&nbsp;<span class="op" id="1853744">=</span>&nbsp;<span class="ident" id="1853746">zz</span><span class="op" id="1853748">.</span><span class="ident" id="1853749">div</span><span class="op" id="1853752">(</span><span class="ident" id="1853753">r</span><span class="op" id="1853754">,</span>&nbsp;<span class="op" id="1853756">*</span><span class="ident" id="1853757">p</span><span class="op" id="1853758">,</span>&nbsp;<span class="ident" id="1853760">m</span><span class="op" id="1853761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853765">*</span><span class="ident" id="1853766">p</span><span class="op" id="1853767">,</span>&nbsp;<span class="ident" id="1853769">r</span>&nbsp;<span class="op" id="1853771">=</span>&nbsp;<span class="ident" id="1853773">r</span><span class="op" id="1853774">,</span>&nbsp;<span class="op" id="1853776">*</span><span class="ident" id="1853777">p</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853781">*</span><span class="ident" id="1853782">p1</span>&nbsp;<span class="op" id="1853785">=</span>&nbsp;<span class="ident" id="1853787">p1</span><span class="op" id="1853789">.</span><span class="ident" id="1853790">mul</span><span class="op" id="1853793">(</span><span class="op" id="1853794">*</span><span class="ident" id="1853795">p</span><span class="op" id="1853796">,</span>&nbsp;<span class="ident" id="1853798">x</span><span class="op" id="1853799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853803">zz</span><span class="op" id="1853805">,</span>&nbsp;<span class="ident" id="1853807">r</span>&nbsp;<span class="op" id="1853809">=</span>&nbsp;<span class="ident" id="1853811">zz</span><span class="op" id="1853813">.</span><span class="ident" id="1853814">div</span><span class="op" id="1853817">(</span><span class="ident" id="1853818">r</span><span class="op" id="1853819">,</span>&nbsp;<span class="op" id="1853821">*</span><span class="ident" id="1853822">p1</span><span class="op" id="1853824">,</span>&nbsp;<span class="ident" id="1853826">m</span><span class="op" id="1853827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853831">*</span><span class="ident" id="1853832">p1</span><span class="op" id="1853834">,</span>&nbsp;<span class="ident" id="1853836">r</span>&nbsp;<span class="op" id="1853838">=</span>&nbsp;<span class="ident" id="1853840">r</span><span class="op" id="1853841">,</span>&nbsp;<span class="op" id="1853843">*</span><span class="ident" id="1853844">p1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853852">z</span>&nbsp;<span class="op" id="1853854">=</span>&nbsp;<span class="ident" id="1853856">z</span><span class="op" id="1853857">.</span><span class="ident" id="1853858">setWord</span><span class="op" id="1853865">(</span><span class="num" id="1853866">1</span><span class="op" id="1853867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853871">for</span>&nbsp;<span class="ident" id="1853875">i</span>&nbsp;<span class="op" id="1853877">:=</span>&nbsp;<span class="builtinfunc" id="1853880">len</span><span class="op" id="1853883">(</span><span class="ident" id="1853884">y</span><span class="op" id="1853885">)</span>&nbsp;<span class="op" id="1853887">-</span>&nbsp;<span class="num" id="1853889">1</span><span class="op" id="1853890">;</span>&nbsp;<span class="ident" id="1853892">i</span>&nbsp;<span class="op" id="1853894">&gt;=</span>&nbsp;<span class="num" id="1853897">0</span><span class="op" id="1853898">;</span>&nbsp;<span class="ident" id="1853900">i</span><span class="op" id="1853901">--</span>&nbsp;<span class="op" id="1853904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853908">yi</span>&nbsp;<span class="op" id="1853911">:=</span>&nbsp;<span class="ident" id="1853914">y</span><span class="op" id="1853915">[</span><span class="ident" id="1853916">i</span><span class="op" id="1853917">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853921">for</span>&nbsp;<span class="ident" id="1853925">j</span>&nbsp;<span class="op" id="1853927">:=</span>&nbsp;<span class="num" id="1853930">0</span><span class="op" id="1853931">;</span>&nbsp;<span class="ident" id="1853933">j</span>&nbsp;<span class="op" id="1853935">&lt;</span>&nbsp;<span class="ident" id="1853937">_W</span><span class="op" id="1853939">;</span>&nbsp;<span class="ident" id="1853941">j</span>&nbsp;<span class="op" id="1853943">+=</span>&nbsp;<span class="ident" id="1853946">n</span>&nbsp;<span class="op" id="1853948">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853953">if</span>&nbsp;<span class="ident" id="1853956">i</span>&nbsp;<span class="op" id="1853958">!=</span>&nbsp;<span class="builtinfunc" id="1853961">len</span><span class="op" id="1853964">(</span><span class="ident" id="1853965">y</span><span class="op" id="1853966">)</span><span class="op" id="1853967">-</span><span class="num" id="1853968">1</span>&nbsp;<span class="op" id="1853970">||</span>&nbsp;<span class="ident" id="1853973">j</span>&nbsp;<span class="op" id="1853975">!=</span>&nbsp;<span class="num" id="1853978">0</span>&nbsp;<span class="op" id="1853980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1853986">//&nbsp;Unrolled&nbsp;loop&nbsp;for&nbsp;significant&nbsp;performance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1854035">//&nbsp;gain.&nbsp;&nbsp;Use&nbsp;go&nbsp;test&nbsp;-bench=&#34;.*&#34;&nbsp;in&nbsp;crypto/rsa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1854087">//&nbsp;to&nbsp;check&nbsp;performance&nbsp;before&nbsp;making&nbsp;changes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854138">zz</span>&nbsp;<span class="op" id="1854141">=</span>&nbsp;<span class="ident" id="1854143">zz</span><span class="op" id="1854145">.</span><span class="ident" id="1854146">mul</span><span class="op" id="1854149">(</span><span class="ident" id="1854150">z</span><span class="op" id="1854151">,</span>&nbsp;<span class="ident" id="1854153">z</span><span class="op" id="1854154">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854160">zz</span><span class="op" id="1854162">,</span>&nbsp;<span class="ident" id="1854164">z</span>&nbsp;<span class="op" id="1854166">=</span>&nbsp;<span class="ident" id="1854168">z</span><span class="op" id="1854169">,</span>&nbsp;<span class="ident" id="1854171">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854178">zz</span><span class="op" id="1854180">,</span>&nbsp;<span class="ident" id="1854182">r</span>&nbsp;<span class="op" id="1854184">=</span>&nbsp;<span class="ident" id="1854186">zz</span><span class="op" id="1854188">.</span><span class="ident" id="1854189">div</span><span class="op" id="1854192">(</span><span class="ident" id="1854193">r</span><span class="op" id="1854194">,</span>&nbsp;<span class="ident" id="1854196">z</span><span class="op" id="1854197">,</span>&nbsp;<span class="ident" id="1854199">m</span><span class="op" id="1854200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854206">z</span><span class="op" id="1854207">,</span>&nbsp;<span class="ident" id="1854209">r</span>&nbsp;<span class="op" id="1854211">=</span>&nbsp;<span class="ident" id="1854213">r</span><span class="op" id="1854214">,</span>&nbsp;<span class="ident" id="1854216">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854223">zz</span>&nbsp;<span class="op" id="1854226">=</span>&nbsp;<span class="ident" id="1854228">zz</span><span class="op" id="1854230">.</span><span class="ident" id="1854231">mul</span><span class="op" id="1854234">(</span><span class="ident" id="1854235">z</span><span class="op" id="1854236">,</span>&nbsp;<span class="ident" id="1854238">z</span><span class="op" id="1854239">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854245">zz</span><span class="op" id="1854247">,</span>&nbsp;<span class="ident" id="1854249">z</span>&nbsp;<span class="op" id="1854251">=</span>&nbsp;<span class="ident" id="1854253">z</span><span class="op" id="1854254">,</span>&nbsp;<span class="ident" id="1854256">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854263">zz</span><span class="op" id="1854265">,</span>&nbsp;<span class="ident" id="1854267">r</span>&nbsp;<span class="op" id="1854269">=</span>&nbsp;<span class="ident" id="1854271">zz</span><span class="op" id="1854273">.</span><span class="ident" id="1854274">div</span><span class="op" id="1854277">(</span><span class="ident" id="1854278">r</span><span class="op" id="1854279">,</span>&nbsp;<span class="ident" id="1854281">z</span><span class="op" id="1854282">,</span>&nbsp;<span class="ident" id="1854284">m</span><span class="op" id="1854285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854291">z</span><span class="op" id="1854292">,</span>&nbsp;<span class="ident" id="1854294">r</span>&nbsp;<span class="op" id="1854296">=</span>&nbsp;<span class="ident" id="1854298">r</span><span class="op" id="1854299">,</span>&nbsp;<span class="ident" id="1854301">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854308">zz</span>&nbsp;<span class="op" id="1854311">=</span>&nbsp;<span class="ident" id="1854313">zz</span><span class="op" id="1854315">.</span><span class="ident" id="1854316">mul</span><span class="op" id="1854319">(</span><span class="ident" id="1854320">z</span><span class="op" id="1854321">,</span>&nbsp;<span class="ident" id="1854323">z</span><span class="op" id="1854324">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854330">zz</span><span class="op" id="1854332">,</span>&nbsp;<span class="ident" id="1854334">z</span>&nbsp;<span class="op" id="1854336">=</span>&nbsp;<span class="ident" id="1854338">z</span><span class="op" id="1854339">,</span>&nbsp;<span class="ident" id="1854341">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854348">zz</span><span class="op" id="1854350">,</span>&nbsp;<span class="ident" id="1854352">r</span>&nbsp;<span class="op" id="1854354">=</span>&nbsp;<span class="ident" id="1854356">zz</span><span class="op" id="1854358">.</span><span class="ident" id="1854359">div</span><span class="op" id="1854362">(</span><span class="ident" id="1854363">r</span><span class="op" id="1854364">,</span>&nbsp;<span class="ident" id="1854366">z</span><span class="op" id="1854367">,</span>&nbsp;<span class="ident" id="1854369">m</span><span class="op" id="1854370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854376">z</span><span class="op" id="1854377">,</span>&nbsp;<span class="ident" id="1854379">r</span>&nbsp;<span class="op" id="1854381">=</span>&nbsp;<span class="ident" id="1854383">r</span><span class="op" id="1854384">,</span>&nbsp;<span class="ident" id="1854386">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854393">zz</span>&nbsp;<span class="op" id="1854396">=</span>&nbsp;<span class="ident" id="1854398">zz</span><span class="op" id="1854400">.</span><span class="ident" id="1854401">mul</span><span class="op" id="1854404">(</span><span class="ident" id="1854405">z</span><span class="op" id="1854406">,</span>&nbsp;<span class="ident" id="1854408">z</span><span class="op" id="1854409">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854415">zz</span><span class="op" id="1854417">,</span>&nbsp;<span class="ident" id="1854419">z</span>&nbsp;<span class="op" id="1854421">=</span>&nbsp;<span class="ident" id="1854423">z</span><span class="op" id="1854424">,</span>&nbsp;<span class="ident" id="1854426">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854433">zz</span><span class="op" id="1854435">,</span>&nbsp;<span class="ident" id="1854437">r</span>&nbsp;<span class="op" id="1854439">=</span>&nbsp;<span class="ident" id="1854441">zz</span><span class="op" id="1854443">.</span><span class="ident" id="1854444">div</span><span class="op" id="1854447">(</span><span class="ident" id="1854448">r</span><span class="op" id="1854449">,</span>&nbsp;<span class="ident" id="1854451">z</span><span class="op" id="1854452">,</span>&nbsp;<span class="ident" id="1854454">m</span><span class="op" id="1854455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854461">z</span><span class="op" id="1854462">,</span>&nbsp;<span class="ident" id="1854464">r</span>&nbsp;<span class="op" id="1854466">=</span>&nbsp;<span class="ident" id="1854468">r</span><span class="op" id="1854469">,</span>&nbsp;<span class="ident" id="1854471">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854482">zz</span>&nbsp;<span class="op" id="1854485">=</span>&nbsp;<span class="ident" id="1854487">zz</span><span class="op" id="1854489">.</span><span class="ident" id="1854490">mul</span><span class="op" id="1854493">(</span><span class="ident" id="1854494">z</span><span class="op" id="1854495">,</span>&nbsp;<span class="ident" id="1854497">powers</span><span class="op" id="1854503">[</span><span class="ident" id="1854504">yi</span><span class="op" id="1854506">&gt;&gt;</span><span class="op" id="1854508">(</span><span class="ident" id="1854509">_W</span><span class="op" id="1854511">-</span><span class="ident" id="1854512">n</span><span class="op" id="1854513">)</span><span class="op" id="1854514">]</span><span class="op" id="1854515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854520">zz</span><span class="op" id="1854522">,</span>&nbsp;<span class="ident" id="1854524">z</span>&nbsp;<span class="op" id="1854526">=</span>&nbsp;<span class="ident" id="1854528">z</span><span class="op" id="1854529">,</span>&nbsp;<span class="ident" id="1854531">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854537">zz</span><span class="op" id="1854539">,</span>&nbsp;<span class="ident" id="1854541">r</span>&nbsp;<span class="op" id="1854543">=</span>&nbsp;<span class="ident" id="1854545">zz</span><span class="op" id="1854547">.</span><span class="ident" id="1854548">div</span><span class="op" id="1854551">(</span><span class="ident" id="1854552">r</span><span class="op" id="1854553">,</span>&nbsp;<span class="ident" id="1854555">z</span><span class="op" id="1854556">,</span>&nbsp;<span class="ident" id="1854558">m</span><span class="op" id="1854559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854564">z</span><span class="op" id="1854565">,</span>&nbsp;<span class="ident" id="1854567">r</span>&nbsp;<span class="op" id="1854569">=</span>&nbsp;<span class="ident" id="1854571">r</span><span class="op" id="1854572">,</span>&nbsp;<span class="ident" id="1854574">z</span><br>
<span class="lineno"></span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854580">yi</span>&nbsp;<span class="op" id="1854583">&lt;&lt;=</span>&nbsp;<span class="ident" id="1854587">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854598">return</span>&nbsp;<span class="ident" id="1854605">z</span><span class="op" id="1854606">.</span><span class="ident" id="1854607">norm</span><span class="op" id="1854611">(</span><span class="op" id="1854612">)</span><br>
<span class="lineno">1380</span><span class="op" id="1854614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1854617">//&nbsp;probablyPrime&nbsp;performs&nbsp;reps&nbsp;Miller-Rabin&nbsp;tests&nbsp;to&nbsp;check&nbsp;whether&nbsp;n&nbsp;is&nbsp;prime.</span><br>
<span class="lineno"></span><span class="comment" id="1854696">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;true,&nbsp;n&nbsp;is&nbsp;prime&nbsp;with&nbsp;probability&nbsp;1&nbsp;-&nbsp;1/4^reps.</span><br>
<span class="lineno"></span><span class="comment" id="1854761">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;false,&nbsp;n&nbsp;is&nbsp;not&nbsp;prime.</span><br>
<span class="lineno">1385</span><span class="keyword" id="1854801">func</span>&nbsp;<span class="op" id="1854806">(</span><span class="ident" id="1854807">n</span>&nbsp;<span class="ident" id="1854809">nat</span><span class="op" id="1854812">)</span>&nbsp;<span class="ident" id="1854814">probablyPrime</span><span class="op" id="1854827">(</span><span class="ident" id="1854828">reps</span>&nbsp;<span class="builtintype" id="1854833">int</span><span class="op" id="1854836">)</span>&nbsp;<span class="builtintype" id="1854838">bool</span>&nbsp;<span class="op" id="1854843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854846">if</span>&nbsp;<span class="builtinfunc" id="1854849">len</span><span class="op" id="1854852">(</span><span class="ident" id="1854853">n</span><span class="op" id="1854854">)</span>&nbsp;<span class="op" id="1854856">==</span>&nbsp;<span class="num" id="1854859">0</span>&nbsp;<span class="op" id="1854861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854865">return</span>&nbsp;<span class="ident" id="1854872">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854883">if</span>&nbsp;<span class="builtinfunc" id="1854886">len</span><span class="op" id="1854889">(</span><span class="ident" id="1854890">n</span><span class="op" id="1854891">)</span>&nbsp;<span class="op" id="1854893">==</span>&nbsp;<span class="num" id="1854896">1</span>&nbsp;<span class="op" id="1854898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854902">if</span>&nbsp;<span class="ident" id="1854905">n</span><span class="op" id="1854906">[</span><span class="num" id="1854907">0</span><span class="op" id="1854908">]</span>&nbsp;<span class="op" id="1854910">&lt;</span>&nbsp;<span class="num" id="1854912">2</span>&nbsp;<span class="op" id="1854914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854919">return</span>&nbsp;<span class="ident" id="1854926">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854939">if</span>&nbsp;<span class="ident" id="1854942">n</span><span class="op" id="1854943">[</span><span class="num" id="1854944">0</span><span class="op" id="1854945">]</span><span class="op" id="1854946">%</span><span class="num" id="1854947">2</span>&nbsp;<span class="op" id="1854949">==</span>&nbsp;<span class="num" id="1854952">0</span>&nbsp;<span class="op" id="1854954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854959">return</span>&nbsp;<span class="ident" id="1854966">n</span><span class="op" id="1854967">[</span><span class="num" id="1854968">0</span><span class="op" id="1854969">]</span>&nbsp;<span class="op" id="1854971">==</span>&nbsp;<span class="num" id="1854974">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1854983">//&nbsp;We&nbsp;have&nbsp;to&nbsp;exclude&nbsp;these&nbsp;cases&nbsp;because&nbsp;we&nbsp;reject&nbsp;all</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1855041">//&nbsp;multiples&nbsp;of&nbsp;these&nbsp;numbers&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855080">switch</span>&nbsp;<span class="ident" id="1855087">n</span><span class="op" id="1855088">[</span><span class="num" id="1855089">0</span><span class="op" id="1855090">]</span>&nbsp;<span class="op" id="1855092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855096">case</span>&nbsp;<span class="num" id="1855101">3</span><span class="op" id="1855102">,</span>&nbsp;<span class="num" id="1855104">5</span><span class="op" id="1855105">,</span>&nbsp;<span class="num" id="1855107">7</span><span class="op" id="1855108">,</span>&nbsp;<span class="num" id="1855110">11</span><span class="op" id="1855112">,</span>&nbsp;<span class="num" id="1855114">13</span><span class="op" id="1855116">,</span>&nbsp;<span class="num" id="1855118">17</span><span class="op" id="1855120">,</span>&nbsp;<span class="num" id="1855122">19</span><span class="op" id="1855124">,</span>&nbsp;<span class="num" id="1855126">23</span><span class="op" id="1855128">,</span>&nbsp;<span class="num" id="1855130">29</span><span class="op" id="1855132">,</span>&nbsp;<span class="num" id="1855134">31</span><span class="op" id="1855136">,</span>&nbsp;<span class="num" id="1855138">37</span><span class="op" id="1855140">,</span>&nbsp;<span class="num" id="1855142">41</span><span class="op" id="1855144">,</span>&nbsp;<span class="num" id="1855146">43</span><span class="op" id="1855148">,</span>&nbsp;<span class="num" id="1855150">47</span><span class="op" id="1855152">,</span>&nbsp;<span class="num" id="1855154">53</span><span class="op" id="1855156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855161">return</span>&nbsp;<span class="ident" id="1855168">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1855175">}</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1855178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855182">const</span>&nbsp;<span class="ident" id="1855188">primesProduct32</span>&nbsp;<span class="op" id="1855204">=</span>&nbsp;<span class="num" id="1855206">0xC0CFD797</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1855225">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;29}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855260">const</span>&nbsp;<span class="ident" id="1855266">primesProduct64</span>&nbsp;<span class="op" id="1855282">=</span>&nbsp;<span class="num" id="1855284">0xE221F97C30E94E1D</span>&nbsp;<span class="comment" id="1855303">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;53}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855339">var</span>&nbsp;<span class="ident" id="1855343">r</span>&nbsp;<span class="ident" id="1855345">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855351">switch</span>&nbsp;<span class="ident" id="1855358">_W</span>&nbsp;<span class="op" id="1855361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855364">case</span>&nbsp;<span class="num" id="1855369">32</span><span class="op" id="1855371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855375">r</span>&nbsp;<span class="op" id="1855377">=</span>&nbsp;<span class="ident" id="1855379">n</span><span class="op" id="1855380">.</span><span class="ident" id="1855381">modW</span><span class="op" id="1855385">(</span><span class="ident" id="1855386">primesProduct32</span><span class="op" id="1855401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855404">case</span>&nbsp;<span class="num" id="1855409">64</span><span class="op" id="1855411">:</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855415">r</span>&nbsp;<span class="op" id="1855417">=</span>&nbsp;<span class="ident" id="1855419">n</span><span class="op" id="1855420">.</span><span class="ident" id="1855421">modW</span><span class="op" id="1855425">(</span><span class="ident" id="1855426">primesProduct64</span>&nbsp;<span class="op" id="1855442">&amp;</span>&nbsp;<span class="ident" id="1855444">_M</span><span class="op" id="1855446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855449">default</span><span class="op" id="1855456">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1855460">panic</span><span class="op" id="1855465">(</span><span class="string" id="1855466">&#34;Unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="1855485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1855488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855492">if</span>&nbsp;<span class="ident" id="1855495">r</span><span class="op" id="1855496">%</span><span class="num" id="1855497">3</span>&nbsp;<span class="op" id="1855499">==</span>&nbsp;<span class="num" id="1855502">0</span>&nbsp;<span class="op" id="1855504">||</span>&nbsp;<span class="ident" id="1855507">r</span><span class="op" id="1855508">%</span><span class="num" id="1855509">5</span>&nbsp;<span class="op" id="1855511">==</span>&nbsp;<span class="num" id="1855514">0</span>&nbsp;<span class="op" id="1855516">||</span>&nbsp;<span class="ident" id="1855519">r</span><span class="op" id="1855520">%</span><span class="num" id="1855521">7</span>&nbsp;<span class="op" id="1855523">==</span>&nbsp;<span class="num" id="1855526">0</span>&nbsp;<span class="op" id="1855528">||</span>&nbsp;<span class="ident" id="1855531">r</span><span class="op" id="1855532">%</span><span class="num" id="1855533">11</span>&nbsp;<span class="op" id="1855536">==</span>&nbsp;<span class="num" id="1855539">0</span>&nbsp;<span class="op" id="1855541">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855546">r</span><span class="op" id="1855547">%</span><span class="num" id="1855548">13</span>&nbsp;<span class="op" id="1855551">==</span>&nbsp;<span class="num" id="1855554">0</span>&nbsp;<span class="op" id="1855556">||</span>&nbsp;<span class="ident" id="1855559">r</span><span class="op" id="1855560">%</span><span class="num" id="1855561">17</span>&nbsp;<span class="op" id="1855564">==</span>&nbsp;<span class="num" id="1855567">0</span>&nbsp;<span class="op" id="1855569">||</span>&nbsp;<span class="ident" id="1855572">r</span><span class="op" id="1855573">%</span><span class="num" id="1855574">19</span>&nbsp;<span class="op" id="1855577">==</span>&nbsp;<span class="num" id="1855580">0</span>&nbsp;<span class="op" id="1855582">||</span>&nbsp;<span class="ident" id="1855585">r</span><span class="op" id="1855586">%</span><span class="num" id="1855587">23</span>&nbsp;<span class="op" id="1855590">==</span>&nbsp;<span class="num" id="1855593">0</span>&nbsp;<span class="op" id="1855595">||</span>&nbsp;<span class="ident" id="1855598">r</span><span class="op" id="1855599">%</span><span class="num" id="1855600">29</span>&nbsp;<span class="op" id="1855603">==</span>&nbsp;<span class="num" id="1855606">0</span>&nbsp;<span class="op" id="1855608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855612">return</span>&nbsp;<span class="ident" id="1855619">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1855626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855630">if</span>&nbsp;<span class="ident" id="1855633">_W</span>&nbsp;<span class="op" id="1855636">==</span>&nbsp;<span class="num" id="1855639">64</span>&nbsp;<span class="op" id="1855642">&amp;&amp;</span>&nbsp;<span class="op" id="1855645">(</span><span class="ident" id="1855646">r</span><span class="op" id="1855647">%</span><span class="num" id="1855648">31</span>&nbsp;<span class="op" id="1855651">==</span>&nbsp;<span class="num" id="1855654">0</span>&nbsp;<span class="op" id="1855656">||</span>&nbsp;<span class="ident" id="1855659">r</span><span class="op" id="1855660">%</span><span class="num" id="1855661">37</span>&nbsp;<span class="op" id="1855664">==</span>&nbsp;<span class="num" id="1855667">0</span>&nbsp;<span class="op" id="1855669">||</span>&nbsp;<span class="ident" id="1855672">r</span><span class="op" id="1855673">%</span><span class="num" id="1855674">41</span>&nbsp;<span class="op" id="1855677">==</span>&nbsp;<span class="num" id="1855680">0</span>&nbsp;<span class="op" id="1855682">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855687">r</span><span class="op" id="1855688">%</span><span class="num" id="1855689">43</span>&nbsp;<span class="op" id="1855692">==</span>&nbsp;<span class="num" id="1855695">0</span>&nbsp;<span class="op" id="1855697">||</span>&nbsp;<span class="ident" id="1855700">r</span><span class="op" id="1855701">%</span><span class="num" id="1855702">47</span>&nbsp;<span class="op" id="1855705">==</span>&nbsp;<span class="num" id="1855708">0</span>&nbsp;<span class="op" id="1855710">||</span>&nbsp;<span class="ident" id="1855713">r</span><span class="op" id="1855714">%</span><span class="num" id="1855715">53</span>&nbsp;<span class="op" id="1855718">==</span>&nbsp;<span class="num" id="1855721">0</span><span class="op" id="1855722">)</span>&nbsp;<span class="op" id="1855724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855728">return</span>&nbsp;<span class="ident" id="1855735">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1855742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855746">nm1</span>&nbsp;<span class="op" id="1855750">:=</span>&nbsp;<span class="ident" id="1855753">nat</span><span class="op" id="1855756">(</span><span class="ident" id="1855757">nil</span><span class="op" id="1855760">)</span><span class="op" id="1855761">.</span><span class="ident" id="1855762">sub</span><span class="op" id="1855765">(</span><span class="ident" id="1855766">n</span><span class="op" id="1855767">,</span>&nbsp;<span class="ident" id="1855769">natOne</span><span class="op" id="1855775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1855778">//&nbsp;determine&nbsp;q,&nbsp;k&nbsp;such&nbsp;that&nbsp;nm1&nbsp;=&nbsp;q&nbsp;&lt;&lt;&nbsp;k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855820">k</span>&nbsp;<span class="op" id="1855822">:=</span>&nbsp;<span class="ident" id="1855825">nm1</span><span class="op" id="1855828">.</span><span class="ident" id="1855829">trailingZeroBits</span><span class="op" id="1855845">(</span><span class="op" id="1855846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855849">q</span>&nbsp;<span class="op" id="1855851">:=</span>&nbsp;<span class="ident" id="1855854">nat</span><span class="op" id="1855857">(</span><span class="ident" id="1855858">nil</span><span class="op" id="1855861">)</span><span class="op" id="1855862">.</span><span class="ident" id="1855863">shr</span><span class="op" id="1855866">(</span><span class="ident" id="1855867">nm1</span><span class="op" id="1855870">,</span>&nbsp;<span class="ident" id="1855872">k</span><span class="op" id="1855873">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855877">nm3</span>&nbsp;<span class="op" id="1855881">:=</span>&nbsp;<span class="ident" id="1855884">nat</span><span class="op" id="1855887">(</span><span class="ident" id="1855888">nil</span><span class="op" id="1855891">)</span><span class="op" id="1855892">.</span><span class="ident" id="1855893">sub</span><span class="op" id="1855896">(</span><span class="ident" id="1855897">nm1</span><span class="op" id="1855900">,</span>&nbsp;<span class="ident" id="1855902">natTwo</span><span class="op" id="1855908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855911">rand</span>&nbsp;<span class="op" id="1855916">:=</span>&nbsp;<span class="ident" id="1855919">rand</span><span class="op" id="1855923">.</span><span class="ident" id="1855924">New</span><span class="op" id="1855927">(</span><span class="ident" id="1855928">rand</span><span class="op" id="1855932">.</span><span class="ident" id="1855933">NewSource</span><span class="op" id="1855942">(</span><span class="ident" id="1855943">int64</span><span class="op" id="1855948">(</span><span class="ident" id="1855949">n</span><span class="op" id="1855950">[</span><span class="num" id="1855951">0</span><span class="op" id="1855952">]</span><span class="op" id="1855953">)</span><span class="op" id="1855954">)</span><span class="op" id="1855955">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855959">var</span>&nbsp;<span class="ident" id="1855963">x</span><span class="op" id="1855964">,</span>&nbsp;<span class="ident" id="1855966">y</span><span class="op" id="1855967">,</span>&nbsp;<span class="ident" id="1855969">quotient</span>&nbsp;<span class="ident" id="1855978">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855983">nm3Len</span>&nbsp;<span class="op" id="1855990">:=</span>&nbsp;<span class="ident" id="1855993">nm3</span><span class="op" id="1855996">.</span><span class="ident" id="1855997">bitLen</span><span class="op" id="1856003">(</span><span class="op" id="1856004">)</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="ident" id="1856007">NextRandom</span><span class="op" id="1856017">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856020">for</span>&nbsp;<span class="ident" id="1856024">i</span>&nbsp;<span class="op" id="1856026">:=</span>&nbsp;<span class="num" id="1856029">0</span><span class="op" id="1856030">;</span>&nbsp;<span class="ident" id="1856032">i</span>&nbsp;<span class="op" id="1856034">&lt;</span>&nbsp;<span class="ident" id="1856036">reps</span><span class="op" id="1856040">;</span>&nbsp;<span class="ident" id="1856042">i</span><span class="op" id="1856043">++</span>&nbsp;<span class="op" id="1856046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856050">x</span>&nbsp;<span class="op" id="1856052">=</span>&nbsp;<span class="ident" id="1856054">x</span><span class="op" id="1856055">.</span><span class="ident" id="1856056">random</span><span class="op" id="1856062">(</span><span class="ident" id="1856063">rand</span><span class="op" id="1856067">,</span>&nbsp;<span class="ident" id="1856069">nm3</span><span class="op" id="1856072">,</span>&nbsp;<span class="ident" id="1856074">nm3Len</span><span class="op" id="1856080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856084">x</span>&nbsp;<span class="op" id="1856086">=</span>&nbsp;<span class="ident" id="1856088">x</span><span class="op" id="1856089">.</span><span class="ident" id="1856090">add</span><span class="op" id="1856093">(</span><span class="ident" id="1856094">x</span><span class="op" id="1856095">,</span>&nbsp;<span class="ident" id="1856097">natTwo</span><span class="op" id="1856103">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856107">y</span>&nbsp;<span class="op" id="1856109">=</span>&nbsp;<span class="ident" id="1856111">y</span><span class="op" id="1856112">.</span><span class="ident" id="1856113">expNN</span><span class="op" id="1856118">(</span><span class="ident" id="1856119">x</span><span class="op" id="1856120">,</span>&nbsp;<span class="ident" id="1856122">q</span><span class="op" id="1856123">,</span>&nbsp;<span class="ident" id="1856125">n</span><span class="op" id="1856126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856130">if</span>&nbsp;<span class="ident" id="1856133">y</span><span class="op" id="1856134">.</span><span class="ident" id="1856135">cmp</span><span class="op" id="1856138">(</span><span class="ident" id="1856139">natOne</span><span class="op" id="1856145">)</span>&nbsp;<span class="op" id="1856147">==</span>&nbsp;<span class="num" id="1856150">0</span>&nbsp;<span class="op" id="1856152">||</span>&nbsp;<span class="ident" id="1856155">y</span><span class="op" id="1856156">.</span><span class="ident" id="1856157">cmp</span><span class="op" id="1856160">(</span><span class="ident" id="1856161">nm1</span><span class="op" id="1856164">)</span>&nbsp;<span class="op" id="1856166">==</span>&nbsp;<span class="num" id="1856169">0</span>&nbsp;<span class="op" id="1856171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856176">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856191">for</span>&nbsp;<span class="ident" id="1856195">j</span>&nbsp;<span class="op" id="1856197">:=</span>&nbsp;<span class="builtintype" id="1856200">uint</span><span class="op" id="1856204">(</span><span class="num" id="1856205">1</span><span class="op" id="1856206">)</span><span class="op" id="1856207">;</span>&nbsp;<span class="ident" id="1856209">j</span>&nbsp;<span class="op" id="1856211">&lt;</span>&nbsp;<span class="ident" id="1856213">k</span><span class="op" id="1856214">;</span>&nbsp;<span class="ident" id="1856216">j</span><span class="op" id="1856217">++</span>&nbsp;<span class="op" id="1856220">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856225">y</span>&nbsp;<span class="op" id="1856227">=</span>&nbsp;<span class="ident" id="1856229">y</span><span class="op" id="1856230">.</span><span class="ident" id="1856231">mul</span><span class="op" id="1856234">(</span><span class="ident" id="1856235">y</span><span class="op" id="1856236">,</span>&nbsp;<span class="ident" id="1856238">y</span><span class="op" id="1856239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856244">quotient</span><span class="op" id="1856252">,</span>&nbsp;<span class="ident" id="1856254">y</span>&nbsp;<span class="op" id="1856256">=</span>&nbsp;<span class="ident" id="1856258">quotient</span><span class="op" id="1856266">.</span><span class="ident" id="1856267">div</span><span class="op" id="1856270">(</span><span class="ident" id="1856271">y</span><span class="op" id="1856272">,</span>&nbsp;<span class="ident" id="1856274">y</span><span class="op" id="1856275">,</span>&nbsp;<span class="ident" id="1856277">n</span><span class="op" id="1856278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856283">if</span>&nbsp;<span class="ident" id="1856286">y</span><span class="op" id="1856287">.</span><span class="ident" id="1856288">cmp</span><span class="op" id="1856291">(</span><span class="ident" id="1856292">nm1</span><span class="op" id="1856295">)</span>&nbsp;<span class="op" id="1856297">==</span>&nbsp;<span class="num" id="1856300">0</span>&nbsp;<span class="op" id="1856302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856308">continue</span>&nbsp;<span class="ident" id="1856317">NextRandom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856331">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856336">if</span>&nbsp;<span class="ident" id="1856339">y</span><span class="op" id="1856340">.</span><span class="ident" id="1856341">cmp</span><span class="op" id="1856344">(</span><span class="ident" id="1856345">natOne</span><span class="op" id="1856351">)</span>&nbsp;<span class="op" id="1856353">==</span>&nbsp;<span class="num" id="1856356">0</span>&nbsp;<span class="op" id="1856358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856364">return</span>&nbsp;<span class="ident" id="1856371">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856388">return</span>&nbsp;<span class="ident" id="1856395">false</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856406">return</span>&nbsp;<span class="ident" id="1856413">true</span><br>
<span class="lineno"></span><span class="op" id="1856418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1465</span><span class="comment" id="1856421">//&nbsp;bytes&nbsp;writes&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;into&nbsp;buf&nbsp;using&nbsp;big-endian&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="1856488">//&nbsp;len(buf)&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;len(z)*_S.&nbsp;The&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;encoded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1856555">//&nbsp;slice&nbsp;buf[i:].&nbsp;The&nbsp;number&nbsp;i&nbsp;of&nbsp;unused&nbsp;bytes&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1856622">//&nbsp;buf&nbsp;is&nbsp;returned&nbsp;as&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="1856652">func</span>&nbsp;<span class="op" id="1856657">(</span><span class="ident" id="1856658">z</span>&nbsp;<span class="ident" id="1856660">nat</span><span class="op" id="1856663">)</span>&nbsp;<span class="ident" id="1856665">bytes</span><span class="op" id="1856670">(</span><span class="ident" id="1856671">buf</span>&nbsp;<span class="op" id="1856675">[</span><span class="op" id="1856676">]</span><span class="builtintype" id="1856677">byte</span><span class="op" id="1856681">)</span>&nbsp;<span class="op" id="1856683">(</span><span class="ident" id="1856684">i</span>&nbsp;<span class="builtintype" id="1856686">int</span><span class="op" id="1856689">)</span>&nbsp;<span class="op" id="1856691">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856694">i</span>&nbsp;<span class="op" id="1856696">=</span>&nbsp;<span class="builtinfunc" id="1856698">len</span><span class="op" id="1856701">(</span><span class="ident" id="1856702">buf</span><span class="op" id="1856705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856708">for</span>&nbsp;<span class="ident" id="1856712">_</span><span class="op" id="1856713">,</span>&nbsp;<span class="ident" id="1856715">d</span>&nbsp;<span class="op" id="1856717">:=</span>&nbsp;<span class="keyword" id="1856720">range</span>&nbsp;<span class="ident" id="1856726">z</span>&nbsp;<span class="op" id="1856728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856732">for</span>&nbsp;<span class="ident" id="1856736">j</span>&nbsp;<span class="op" id="1856738">:=</span>&nbsp;<span class="num" id="1856741">0</span><span class="op" id="1856742">;</span>&nbsp;<span class="ident" id="1856744">j</span>&nbsp;<span class="op" id="1856746">&lt;</span>&nbsp;<span class="ident" id="1856748">_S</span><span class="op" id="1856750">;</span>&nbsp;<span class="ident" id="1856752">j</span><span class="op" id="1856753">++</span>&nbsp;<span class="op" id="1856756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856761">i</span><span class="op" id="1856762">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856768">buf</span><span class="op" id="1856771">[</span><span class="ident" id="1856772">i</span><span class="op" id="1856773">]</span>&nbsp;<span class="op" id="1856775">=</span>&nbsp;<span class="builtintype" id="1856777">byte</span><span class="op" id="1856781">(</span><span class="ident" id="1856782">d</span><span class="op" id="1856783">)</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856788">d</span>&nbsp;<span class="op" id="1856790">&gt;&gt;=</span>&nbsp;<span class="num" id="1856794">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856805">for</span>&nbsp;<span class="ident" id="1856809">i</span>&nbsp;<span class="op" id="1856811">&lt;</span>&nbsp;<span class="builtinfunc" id="1856813">len</span><span class="op" id="1856816">(</span><span class="ident" id="1856817">buf</span><span class="op" id="1856820">)</span>&nbsp;<span class="op" id="1856822">&amp;&amp;</span>&nbsp;<span class="ident" id="1856825">buf</span><span class="op" id="1856828">[</span><span class="ident" id="1856829">i</span><span class="op" id="1856830">]</span>&nbsp;<span class="op" id="1856832">==</span>&nbsp;<span class="num" id="1856835">0</span>&nbsp;<span class="op" id="1856837">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856841">i</span><span class="op" id="1856842">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856850">return</span><br>
<span class="lineno"></span><span class="op" id="1856857">}</span><br>
<span class="lineno">1485</span><br>
<span class="lineno"></span><span class="comment" id="1856860">//&nbsp;setBytes&nbsp;interprets&nbsp;buf&nbsp;as&nbsp;the&nbsp;bytes&nbsp;of&nbsp;a&nbsp;big-endian&nbsp;unsigned</span><br>
<span class="lineno"></span><span class="comment" id="1856925">//&nbsp;integer,&nbsp;sets&nbsp;z&nbsp;to&nbsp;that&nbsp;value,&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="1856974">func</span>&nbsp;<span class="op" id="1856979">(</span><span class="ident" id="1856980">z</span>&nbsp;<span class="ident" id="1856982">nat</span><span class="op" id="1856985">)</span>&nbsp;<span class="ident" id="1856987">setBytes</span><span class="op" id="1856995">(</span><span class="ident" id="1856996">buf</span>&nbsp;<span class="op" id="1857000">[</span><span class="op" id="1857001">]</span><span class="builtintype" id="1857002">byte</span><span class="op" id="1857006">)</span>&nbsp;<span class="ident" id="1857008">nat</span>&nbsp;<span class="op" id="1857012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857015">z</span>&nbsp;<span class="op" id="1857017">=</span>&nbsp;<span class="ident" id="1857019">z</span><span class="op" id="1857020">.</span><span class="builtinfunc" id="1857021">make</span><span class="op" id="1857025">(</span><span class="op" id="1857026">(</span><span class="builtinfunc" id="1857027">len</span><span class="op" id="1857030">(</span><span class="ident" id="1857031">buf</span><span class="op" id="1857034">)</span>&nbsp;<span class="op" id="1857036">+</span>&nbsp;<span class="ident" id="1857038">_S</span>&nbsp;<span class="op" id="1857041">-</span>&nbsp;<span class="num" id="1857043">1</span><span class="op" id="1857044">)</span>&nbsp;<span class="op" id="1857046">/</span>&nbsp;<span class="ident" id="1857048">_S</span><span class="op" id="1857050">)</span><br>
<span class="lineno">1490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857054">k</span>&nbsp;<span class="op" id="1857056">:=</span>&nbsp;<span class="num" id="1857059">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857062">s</span>&nbsp;<span class="op" id="1857064">:=</span>&nbsp;<span class="builtintype" id="1857067">uint</span><span class="op" id="1857071">(</span><span class="num" id="1857072">0</span><span class="op" id="1857073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857076">var</span>&nbsp;<span class="ident" id="1857080">d</span>&nbsp;<span class="ident" id="1857082">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857088">for</span>&nbsp;<span class="ident" id="1857092">i</span>&nbsp;<span class="op" id="1857094">:=</span>&nbsp;<span class="builtinfunc" id="1857097">len</span><span class="op" id="1857100">(</span><span class="ident" id="1857101">buf</span><span class="op" id="1857104">)</span><span class="op" id="1857105">;</span>&nbsp;<span class="ident" id="1857107">i</span>&nbsp;<span class="op" id="1857109">&gt;</span>&nbsp;<span class="num" id="1857111">0</span><span class="op" id="1857112">;</span>&nbsp;<span class="ident" id="1857114">i</span><span class="op" id="1857115">--</span>&nbsp;<span class="op" id="1857118">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857122">d</span>&nbsp;<span class="op" id="1857124">|=</span>&nbsp;<span class="ident" id="1857127">Word</span><span class="op" id="1857131">(</span><span class="ident" id="1857132">buf</span><span class="op" id="1857135">[</span><span class="ident" id="1857136">i</span><span class="op" id="1857137">-</span><span class="num" id="1857138">1</span><span class="op" id="1857139">]</span><span class="op" id="1857140">)</span>&nbsp;<span class="op" id="1857142">&lt;&lt;</span>&nbsp;<span class="ident" id="1857145">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857149">if</span>&nbsp;<span class="ident" id="1857152">s</span>&nbsp;<span class="op" id="1857154">+=</span>&nbsp;<span class="num" id="1857157">8</span><span class="op" id="1857158">;</span>&nbsp;<span class="ident" id="1857160">s</span>&nbsp;<span class="op" id="1857162">==</span>&nbsp;<span class="ident" id="1857165">_S</span><span class="op" id="1857167">*</span><span class="num" id="1857168">8</span>&nbsp;<span class="op" id="1857170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857175">z</span><span class="op" id="1857176">[</span><span class="ident" id="1857177">k</span><span class="op" id="1857178">]</span>&nbsp;<span class="op" id="1857180">=</span>&nbsp;<span class="ident" id="1857182">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857187">k</span><span class="op" id="1857188">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857194">s</span>&nbsp;<span class="op" id="1857196">=</span>&nbsp;<span class="num" id="1857198">0</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857203">d</span>&nbsp;<span class="op" id="1857205">=</span>&nbsp;<span class="num" id="1857207">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1857211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1857214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857217">if</span>&nbsp;<span class="ident" id="1857220">k</span>&nbsp;<span class="op" id="1857222">&lt;</span>&nbsp;<span class="builtinfunc" id="1857224">len</span><span class="op" id="1857227">(</span><span class="ident" id="1857228">z</span><span class="op" id="1857229">)</span>&nbsp;<span class="op" id="1857231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857235">z</span><span class="op" id="1857236">[</span><span class="ident" id="1857237">k</span><span class="op" id="1857238">]</span>&nbsp;<span class="op" id="1857240">=</span>&nbsp;<span class="ident" id="1857242">d</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1857245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857249">return</span>&nbsp;<span class="ident" id="1857256">z</span><span class="op" id="1857257">.</span><span class="ident" id="1857258">norm</span><span class="op" id="1857262">(</span><span class="op" id="1857263">)</span><br>
<span class="lineno"></span><span class="op" id="1857265">}</span>
</div>
</body>
</html>
