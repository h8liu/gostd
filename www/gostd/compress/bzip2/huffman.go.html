<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6381815">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6381870">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6381924">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6381975">package</span>&nbsp;<span class="ident" id="6381983">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6381990">import</span>&nbsp;<span class="string" id="6381997">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6382005">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="6382081">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="6382092">type</span>&nbsp;<span class="ident" id="6382097">huffmanTree</span>&nbsp;<span class="keyword" id="6382109">struct</span>&nbsp;<span class="op" id="6382116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382119">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382190">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382263">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382319">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382328">[</span><span class="op" id="6382329">]</span><span class="ident" id="6382330">huffmanNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382343">nextNode</span>&nbsp;<span class="builtintype" id="6382352">int</span><br>
<span class="lineno"></span><span class="op" id="6382356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6382359">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="6382439">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="6382519">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="6382579">//</span><br>
<span class="lineno"></span><span class="comment" id="6382582">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6382659">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="6382737">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="6382787">type</span>&nbsp;<span class="ident" id="6382792">huffmanNode</span>&nbsp;<span class="keyword" id="6382804">struct</span>&nbsp;<span class="op" id="6382811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382814">left</span><span class="op" id="6382818">,</span>&nbsp;<span class="ident" id="6382820">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6382836">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382844">leftValue</span><span class="op" id="6382853">,</span>&nbsp;<span class="ident" id="6382855">rightValue</span>&nbsp;<span class="builtintype" id="6382866">uint16</span><br>
<span class="lineno"></span><span class="op" id="6382873">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="6382876">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="6382953">const</span>&nbsp;<span class="ident" id="6382959">invalidNodeValue</span>&nbsp;<span class="op" id="6382976">=</span>&nbsp;<span class="num" id="6382978">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6382986">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="6383063">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="6383083">func</span>&nbsp;<span class="op" id="6383088">(</span><span class="ident" id="6383089">t</span>&nbsp;<span class="op" id="6383091">*</span><span class="ident" id="6383092">huffmanTree</span><span class="op" id="6383103">)</span>&nbsp;<span class="ident" id="6383105">Decode</span><span class="op" id="6383111">(</span><span class="ident" id="6383112">br</span>&nbsp;<span class="op" id="6383115">*</span><span class="ident" id="6383116">bitReader</span><span class="op" id="6383125">)</span>&nbsp;<span class="op" id="6383127">(</span><span class="ident" id="6383128">v</span>&nbsp;<span class="builtintype" id="6383130">uint16</span><span class="op" id="6383136">)</span>&nbsp;<span class="op" id="6383138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383141">nodeIndex</span>&nbsp;<span class="op" id="6383151">:=</span>&nbsp;<span class="builtintype" id="6383154">uint16</span><span class="op" id="6383160">(</span><span class="num" id="6383161">0</span><span class="op" id="6383162">)</span>&nbsp;<span class="comment" id="6383164">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383201">for</span>&nbsp;<span class="op" id="6383205">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383209">node</span>&nbsp;<span class="op" id="6383214">:=</span>&nbsp;<span class="op" id="6383217">&amp;</span><span class="ident" id="6383218">t</span><span class="op" id="6383219">.</span><span class="ident" id="6383220">nodes</span><span class="op" id="6383225">[</span><span class="ident" id="6383226">nodeIndex</span><span class="op" id="6383235">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383239">bit</span><span class="op" id="6383242">,</span>&nbsp;<span class="ident" id="6383244">ok</span>&nbsp;<span class="op" id="6383247">:=</span>&nbsp;<span class="ident" id="6383250">br</span><span class="op" id="6383252">.</span><span class="ident" id="6383253">TryReadBit</span><span class="op" id="6383263">(</span><span class="op" id="6383264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383268">if</span>&nbsp;<span class="op" id="6383271">!</span><span class="ident" id="6383272">ok</span>&nbsp;<span class="op" id="6383275">&amp;&amp;</span>&nbsp;<span class="ident" id="6383278">br</span><span class="op" id="6383280">.</span><span class="ident" id="6383281">ReadBit</span><span class="op" id="6383288">(</span><span class="op" id="6383289">)</span>&nbsp;<span class="op" id="6383291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383296">bit</span>&nbsp;<span class="op" id="6383300">=</span>&nbsp;<span class="num" id="6383302">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383306">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383310">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383349">if</span>&nbsp;<span class="ident" id="6383352">bit</span>&nbsp;<span class="op" id="6383356">!=</span>&nbsp;<span class="num" id="6383359">0</span>&nbsp;<span class="op" id="6383361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383366">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383377">if</span>&nbsp;<span class="ident" id="6383380">node</span><span class="op" id="6383384">.</span><span class="ident" id="6383385">left</span>&nbsp;<span class="op" id="6383390">==</span>&nbsp;<span class="ident" id="6383393">invalidNodeValue</span>&nbsp;<span class="op" id="6383410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383416">return</span>&nbsp;<span class="ident" id="6383423">node</span><span class="op" id="6383427">.</span><span class="ident" id="6383428">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383446">nodeIndex</span>&nbsp;<span class="op" id="6383456">=</span>&nbsp;<span class="ident" id="6383458">node</span><span class="op" id="6383462">.</span><span class="ident" id="6383463">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383470">}</span>&nbsp;<span class="keyword" id="6383472">else</span>&nbsp;<span class="op" id="6383477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383482">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383494">if</span>&nbsp;<span class="ident" id="6383497">node</span><span class="op" id="6383501">.</span><span class="ident" id="6383502">right</span>&nbsp;<span class="op" id="6383508">==</span>&nbsp;<span class="ident" id="6383511">invalidNodeValue</span>&nbsp;<span class="op" id="6383528">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383534">return</span>&nbsp;<span class="ident" id="6383541">node</span><span class="op" id="6383545">.</span><span class="ident" id="6383546">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383565">nodeIndex</span>&nbsp;<span class="op" id="6383575">=</span>&nbsp;<span class="ident" id="6383577">node</span><span class="op" id="6383581">.</span><span class="ident" id="6383582">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383593">}</span><br>
<span class="lineno">60</span><span class="op" id="6383595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6383598">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="6383671">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="6383734">func</span>&nbsp;<span class="ident" id="6383739">newHuffmanTree</span><span class="op" id="6383753">(</span><span class="ident" id="6383754">lengths</span>&nbsp;<span class="op" id="6383762">[</span><span class="op" id="6383763">]</span><span class="builtintype" id="6383764">uint8</span><span class="op" id="6383769">)</span>&nbsp;<span class="op" id="6383771">(</span><span class="ident" id="6383772">huffmanTree</span><span class="op" id="6383783">,</span>&nbsp;<span class="builtintype" id="6383785">error</span><span class="op" id="6383790">)</span>&nbsp;<span class="op" id="6383792">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383795">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383865">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383930">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383992">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384060">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384131">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384201">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384240">if</span>&nbsp;<span class="builtinfunc" id="6384243">len</span><span class="op" id="6384246">(</span><span class="ident" id="6384247">lengths</span><span class="op" id="6384254">)</span>&nbsp;<span class="op" id="6384256">&lt;</span>&nbsp;<span class="num" id="6384258">2</span>&nbsp;<span class="op" id="6384260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6384264">panic</span><span class="op" id="6384269">(</span><span class="string" id="6384270">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="6384303">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384310">var</span>&nbsp;<span class="ident" id="6384314">t</span>&nbsp;<span class="ident" id="6384316">huffmanTree</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384330">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384402">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384444">pairs</span>&nbsp;<span class="op" id="6384450">:=</span>&nbsp;<span class="ident" id="6384453">huffmanSymbolLengthPairs</span><span class="op" id="6384477">(</span><span class="builtinfunc" id="6384478">make</span><span class="op" id="6384482">(</span><span class="op" id="6384483">[</span><span class="op" id="6384484">]</span><span class="ident" id="6384485">huffmanSymbolLengthPair</span><span class="op" id="6384508">,</span>&nbsp;<span class="builtinfunc" id="6384510">len</span><span class="op" id="6384513">(</span><span class="ident" id="6384514">lengths</span><span class="op" id="6384521">)</span><span class="op" id="6384522">)</span><span class="op" id="6384523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384526">for</span>&nbsp;<span class="ident" id="6384530">i</span><span class="op" id="6384531">,</span>&nbsp;<span class="ident" id="6384533">length</span>&nbsp;<span class="op" id="6384540">:=</span>&nbsp;<span class="keyword" id="6384543">range</span>&nbsp;<span class="ident" id="6384549">lengths</span>&nbsp;<span class="op" id="6384557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384561">pairs</span><span class="op" id="6384566">[</span><span class="ident" id="6384567">i</span><span class="op" id="6384568">]</span><span class="op" id="6384569">.</span><span class="ident" id="6384570">value</span>&nbsp;<span class="op" id="6384576">=</span>&nbsp;<span class="builtintype" id="6384578">uint16</span><span class="op" id="6384584">(</span><span class="ident" id="6384585">i</span><span class="op" id="6384586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384590">pairs</span><span class="op" id="6384595">[</span><span class="ident" id="6384596">i</span><span class="op" id="6384597">]</span><span class="op" id="6384598">.</span><span class="ident" id="6384599">length</span>&nbsp;<span class="op" id="6384606">=</span>&nbsp;<span class="ident" id="6384608">length</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384620">sort</span><span class="op" id="6384624">.</span><span class="ident" id="6384625">Sort</span><span class="op" id="6384629">(</span><span class="ident" id="6384630">pairs</span><span class="op" id="6384635">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384639">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384711">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384784">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384856">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384877">code</span>&nbsp;<span class="op" id="6384882">:=</span>&nbsp;<span class="builtintype" id="6384885">uint32</span><span class="op" id="6384891">(</span><span class="num" id="6384892">0</span><span class="op" id="6384893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384896">length</span>&nbsp;<span class="op" id="6384903">:=</span>&nbsp;<span class="builtintype" id="6384906">uint8</span><span class="op" id="6384911">(</span><span class="num" id="6384912">32</span><span class="op" id="6384914">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384918">codes</span>&nbsp;<span class="op" id="6384924">:=</span>&nbsp;<span class="ident" id="6384927">huffmanCodes</span><span class="op" id="6384939">(</span><span class="builtinfunc" id="6384940">make</span><span class="op" id="6384944">(</span><span class="op" id="6384945">[</span><span class="op" id="6384946">]</span><span class="ident" id="6384947">huffmanCode</span><span class="op" id="6384958">,</span>&nbsp;<span class="builtinfunc" id="6384960">len</span><span class="op" id="6384963">(</span><span class="ident" id="6384964">lengths</span><span class="op" id="6384971">)</span><span class="op" id="6384972">)</span><span class="op" id="6384973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384976">for</span>&nbsp;<span class="ident" id="6384980">i</span>&nbsp;<span class="op" id="6384982">:=</span>&nbsp;<span class="builtinfunc" id="6384985">len</span><span class="op" id="6384988">(</span><span class="ident" id="6384989">pairs</span><span class="op" id="6384994">)</span>&nbsp;<span class="op" id="6384996">-</span>&nbsp;<span class="num" id="6384998">1</span><span class="op" id="6384999">;</span>&nbsp;<span class="ident" id="6385001">i</span>&nbsp;<span class="op" id="6385003">&gt;=</span>&nbsp;<span class="num" id="6385006">0</span><span class="op" id="6385007">;</span>&nbsp;<span class="ident" id="6385009">i</span><span class="op" id="6385010">--</span>&nbsp;<span class="op" id="6385013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385017">if</span>&nbsp;<span class="ident" id="6385020">length</span>&nbsp;<span class="op" id="6385027">&gt;</span>&nbsp;<span class="ident" id="6385029">pairs</span><span class="op" id="6385034">[</span><span class="ident" id="6385035">i</span><span class="op" id="6385036">]</span><span class="op" id="6385037">.</span><span class="ident" id="6385038">length</span>&nbsp;<span class="op" id="6385045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385050">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385106">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385154">length</span>&nbsp;<span class="op" id="6385161">&gt;&gt;=</span>&nbsp;<span class="num" id="6385165">32</span>&nbsp;<span class="op" id="6385168">-</span>&nbsp;<span class="ident" id="6385170">pairs</span><span class="op" id="6385175">[</span><span class="ident" id="6385176">i</span><span class="op" id="6385177">]</span><span class="op" id="6385178">.</span><span class="ident" id="6385179">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385189">length</span>&nbsp;<span class="op" id="6385196">&lt;&lt;=</span>&nbsp;<span class="num" id="6385200">32</span>&nbsp;<span class="op" id="6385203">-</span>&nbsp;<span class="ident" id="6385205">pairs</span><span class="op" id="6385210">[</span><span class="ident" id="6385211">i</span><span class="op" id="6385212">]</span><span class="op" id="6385213">.</span><span class="ident" id="6385214">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385224">length</span>&nbsp;<span class="op" id="6385231">=</span>&nbsp;<span class="ident" id="6385233">pairs</span><span class="op" id="6385238">[</span><span class="ident" id="6385239">i</span><span class="op" id="6385240">]</span><span class="op" id="6385241">.</span><span class="ident" id="6385242">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385251">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385255">codes</span><span class="op" id="6385260">[</span><span class="ident" id="6385261">i</span><span class="op" id="6385262">]</span><span class="op" id="6385263">.</span><span class="ident" id="6385264">code</span>&nbsp;<span class="op" id="6385269">=</span>&nbsp;<span class="ident" id="6385271">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385278">codes</span><span class="op" id="6385283">[</span><span class="ident" id="6385284">i</span><span class="op" id="6385285">]</span><span class="op" id="6385286">.</span><span class="ident" id="6385287">codeLen</span>&nbsp;<span class="op" id="6385295">=</span>&nbsp;<span class="ident" id="6385297">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385306">codes</span><span class="op" id="6385311">[</span><span class="ident" id="6385312">i</span><span class="op" id="6385313">]</span><span class="op" id="6385314">.</span><span class="ident" id="6385315">value</span>&nbsp;<span class="op" id="6385321">=</span>&nbsp;<span class="ident" id="6385323">pairs</span><span class="op" id="6385328">[</span><span class="ident" id="6385329">i</span><span class="op" id="6385330">]</span><span class="op" id="6385331">.</span><span class="ident" id="6385332">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385340">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385406">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385439">code</span>&nbsp;<span class="op" id="6385444">+=</span>&nbsp;<span class="num" id="6385447">1</span>&nbsp;<span class="op" id="6385449">&lt;&lt;</span>&nbsp;<span class="op" id="6385452">(</span><span class="num" id="6385453">32</span>&nbsp;<span class="op" id="6385456">-</span>&nbsp;<span class="ident" id="6385458">length</span><span class="op" id="6385464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385471">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385544">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385579">sort</span><span class="op" id="6385583">.</span><span class="ident" id="6385584">Sort</span><span class="op" id="6385588">(</span><span class="ident" id="6385589">codes</span><span class="op" id="6385594">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385598">t</span><span class="op" id="6385599">.</span><span class="ident" id="6385600">nodes</span>&nbsp;<span class="op" id="6385606">=</span>&nbsp;<span class="builtinfunc" id="6385608">make</span><span class="op" id="6385612">(</span><span class="op" id="6385613">[</span><span class="op" id="6385614">]</span><span class="ident" id="6385615">huffmanNode</span><span class="op" id="6385626">,</span>&nbsp;<span class="builtinfunc" id="6385628">len</span><span class="op" id="6385631">(</span><span class="ident" id="6385632">codes</span><span class="op" id="6385637">)</span><span class="op" id="6385638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385641">_</span><span class="op" id="6385642">,</span>&nbsp;<span class="ident" id="6385644">err</span>&nbsp;<span class="op" id="6385648">:=</span>&nbsp;<span class="ident" id="6385651">buildHuffmanNode</span><span class="op" id="6385667">(</span><span class="op" id="6385668">&amp;</span><span class="ident" id="6385669">t</span><span class="op" id="6385670">,</span>&nbsp;<span class="ident" id="6385672">codes</span><span class="op" id="6385677">,</span>&nbsp;<span class="num" id="6385679">0</span><span class="op" id="6385680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385683">return</span>&nbsp;<span class="ident" id="6385690">t</span><span class="op" id="6385691">,</span>&nbsp;<span class="ident" id="6385693">err</span><br>
<span class="lineno">120</span><span class="op" id="6385697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6385700">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6385766">type</span>&nbsp;<span class="ident" id="6385771">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="6385795">struct</span>&nbsp;<span class="op" id="6385802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385805">value</span>&nbsp;&nbsp;<span class="builtintype" id="6385812">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385820">length</span>&nbsp;<span class="builtintype" id="6385827">uint8</span><br>
<span class="lineno"></span><span class="op" id="6385833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6385836">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="6385908">type</span>&nbsp;<span class="ident" id="6385913">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="6385938">[</span><span class="op" id="6385939">]</span><span class="ident" id="6385940">huffmanSymbolLengthPair</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="6385965">func</span>&nbsp;<span class="op" id="6385970">(</span><span class="ident" id="6385971">h</span>&nbsp;<span class="ident" id="6385973">huffmanSymbolLengthPairs</span><span class="op" id="6385997">)</span>&nbsp;<span class="ident" id="6385999">Len</span><span class="op" id="6386002">(</span><span class="op" id="6386003">)</span>&nbsp;<span class="builtintype" id="6386005">int</span>&nbsp;<span class="op" id="6386009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386012">return</span>&nbsp;<span class="builtinfunc" id="6386019">len</span><span class="op" id="6386022">(</span><span class="ident" id="6386023">h</span><span class="op" id="6386024">)</span><br>
<span class="lineno"></span><span class="op" id="6386026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="6386029">func</span>&nbsp;<span class="op" id="6386034">(</span><span class="ident" id="6386035">h</span>&nbsp;<span class="ident" id="6386037">huffmanSymbolLengthPairs</span><span class="op" id="6386061">)</span>&nbsp;<span class="ident" id="6386063">Less</span><span class="op" id="6386067">(</span><span class="ident" id="6386068">i</span><span class="op" id="6386069">,</span>&nbsp;<span class="ident" id="6386071">j</span>&nbsp;<span class="builtintype" id="6386073">int</span><span class="op" id="6386076">)</span>&nbsp;<span class="builtintype" id="6386078">bool</span>&nbsp;<span class="op" id="6386083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386086">if</span>&nbsp;<span class="ident" id="6386089">h</span><span class="op" id="6386090">[</span><span class="ident" id="6386091">i</span><span class="op" id="6386092">]</span><span class="op" id="6386093">.</span><span class="ident" id="6386094">length</span>&nbsp;<span class="op" id="6386101">&lt;</span>&nbsp;<span class="ident" id="6386103">h</span><span class="op" id="6386104">[</span><span class="ident" id="6386105">j</span><span class="op" id="6386106">]</span><span class="op" id="6386107">.</span><span class="ident" id="6386108">length</span>&nbsp;<span class="op" id="6386115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386119">return</span>&nbsp;<span class="builtintype" id="6386126">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386135">if</span>&nbsp;<span class="ident" id="6386138">h</span><span class="op" id="6386139">[</span><span class="ident" id="6386140">i</span><span class="op" id="6386141">]</span><span class="op" id="6386142">.</span><span class="ident" id="6386143">length</span>&nbsp;<span class="op" id="6386150">&gt;</span>&nbsp;<span class="ident" id="6386152">h</span><span class="op" id="6386153">[</span><span class="ident" id="6386154">j</span><span class="op" id="6386155">]</span><span class="op" id="6386156">.</span><span class="ident" id="6386157">length</span>&nbsp;<span class="op" id="6386164">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386168">return</span>&nbsp;<span class="builtintype" id="6386175">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386185">if</span>&nbsp;<span class="ident" id="6386188">h</span><span class="op" id="6386189">[</span><span class="ident" id="6386190">i</span><span class="op" id="6386191">]</span><span class="op" id="6386192">.</span><span class="ident" id="6386193">value</span>&nbsp;<span class="op" id="6386199">&lt;</span>&nbsp;<span class="ident" id="6386201">h</span><span class="op" id="6386202">[</span><span class="ident" id="6386203">j</span><span class="op" id="6386204">]</span><span class="op" id="6386205">.</span><span class="ident" id="6386206">value</span>&nbsp;<span class="op" id="6386212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386216">return</span>&nbsp;<span class="builtintype" id="6386223">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386229">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386232">return</span>&nbsp;<span class="builtintype" id="6386239">false</span><br>
<span class="lineno"></span><span class="op" id="6386245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6386248">func</span>&nbsp;<span class="op" id="6386253">(</span><span class="ident" id="6386254">h</span>&nbsp;<span class="ident" id="6386256">huffmanSymbolLengthPairs</span><span class="op" id="6386280">)</span>&nbsp;<span class="ident" id="6386282">Swap</span><span class="op" id="6386286">(</span><span class="ident" id="6386287">i</span><span class="op" id="6386288">,</span>&nbsp;<span class="ident" id="6386290">j</span>&nbsp;<span class="builtintype" id="6386292">int</span><span class="op" id="6386295">)</span>&nbsp;<span class="op" id="6386297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386300">h</span><span class="op" id="6386301">[</span><span class="ident" id="6386302">i</span><span class="op" id="6386303">]</span><span class="op" id="6386304">,</span>&nbsp;<span class="ident" id="6386306">h</span><span class="op" id="6386307">[</span><span class="ident" id="6386308">j</span><span class="op" id="6386309">]</span>&nbsp;<span class="op" id="6386311">=</span>&nbsp;<span class="ident" id="6386313">h</span><span class="op" id="6386314">[</span><span class="ident" id="6386315">j</span><span class="op" id="6386316">]</span><span class="op" id="6386317">,</span>&nbsp;<span class="ident" id="6386319">h</span><span class="op" id="6386320">[</span><span class="ident" id="6386321">i</span><span class="op" id="6386322">]</span><br>
<span class="lineno">150</span><span class="op" id="6386324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6386327">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6386387">type</span>&nbsp;<span class="ident" id="6386392">huffmanCode</span>&nbsp;<span class="keyword" id="6386404">struct</span>&nbsp;<span class="op" id="6386411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386414">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6386422">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386430">codeLen</span>&nbsp;<span class="builtintype" id="6386438">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386445">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6386453">uint16</span><br>
<span class="lineno"></span><span class="op" id="6386460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6386463">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="6386524">type</span>&nbsp;<span class="ident" id="6386529">huffmanCodes</span>&nbsp;<span class="op" id="6386542">[</span><span class="op" id="6386543">]</span><span class="ident" id="6386544">huffmanCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6386557">func</span>&nbsp;<span class="op" id="6386562">(</span><span class="ident" id="6386563">n</span>&nbsp;<span class="ident" id="6386565">huffmanCodes</span><span class="op" id="6386577">)</span>&nbsp;<span class="ident" id="6386579">Len</span><span class="op" id="6386582">(</span><span class="op" id="6386583">)</span>&nbsp;<span class="builtintype" id="6386585">int</span>&nbsp;<span class="op" id="6386589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386592">return</span>&nbsp;<span class="builtinfunc" id="6386599">len</span><span class="op" id="6386602">(</span><span class="ident" id="6386603">n</span><span class="op" id="6386604">)</span><br>
<span class="lineno"></span><span class="op" id="6386606">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6386609">func</span>&nbsp;<span class="op" id="6386614">(</span><span class="ident" id="6386615">n</span>&nbsp;<span class="ident" id="6386617">huffmanCodes</span><span class="op" id="6386629">)</span>&nbsp;<span class="ident" id="6386631">Less</span><span class="op" id="6386635">(</span><span class="ident" id="6386636">i</span><span class="op" id="6386637">,</span>&nbsp;<span class="ident" id="6386639">j</span>&nbsp;<span class="builtintype" id="6386641">int</span><span class="op" id="6386644">)</span>&nbsp;<span class="builtintype" id="6386646">bool</span>&nbsp;<span class="op" id="6386651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386654">return</span>&nbsp;<span class="ident" id="6386661">n</span><span class="op" id="6386662">[</span><span class="ident" id="6386663">i</span><span class="op" id="6386664">]</span><span class="op" id="6386665">.</span><span class="ident" id="6386666">code</span>&nbsp;<span class="op" id="6386671">&lt;</span>&nbsp;<span class="ident" id="6386673">n</span><span class="op" id="6386674">[</span><span class="ident" id="6386675">j</span><span class="op" id="6386676">]</span><span class="op" id="6386677">.</span><span class="ident" id="6386678">code</span><br>
<span class="lineno"></span><span class="op" id="6386683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="6386686">func</span>&nbsp;<span class="op" id="6386691">(</span><span class="ident" id="6386692">n</span>&nbsp;<span class="ident" id="6386694">huffmanCodes</span><span class="op" id="6386706">)</span>&nbsp;<span class="ident" id="6386708">Swap</span><span class="op" id="6386712">(</span><span class="ident" id="6386713">i</span><span class="op" id="6386714">,</span>&nbsp;<span class="ident" id="6386716">j</span>&nbsp;<span class="builtintype" id="6386718">int</span><span class="op" id="6386721">)</span>&nbsp;<span class="op" id="6386723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386726">n</span><span class="op" id="6386727">[</span><span class="ident" id="6386728">i</span><span class="op" id="6386729">]</span><span class="op" id="6386730">,</span>&nbsp;<span class="ident" id="6386732">n</span><span class="op" id="6386733">[</span><span class="ident" id="6386734">j</span><span class="op" id="6386735">]</span>&nbsp;<span class="op" id="6386737">=</span>&nbsp;<span class="ident" id="6386739">n</span><span class="op" id="6386740">[</span><span class="ident" id="6386741">j</span><span class="op" id="6386742">]</span><span class="op" id="6386743">,</span>&nbsp;<span class="ident" id="6386745">n</span><span class="op" id="6386746">[</span><span class="ident" id="6386747">i</span><span class="op" id="6386748">]</span><br>
<span class="lineno"></span><span class="op" id="6386750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6386753">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="6386831">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="6386905">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="6386926">func</span>&nbsp;<span class="ident" id="6386931">buildHuffmanNode</span><span class="op" id="6386947">(</span><span class="ident" id="6386948">t</span>&nbsp;<span class="op" id="6386950">*</span><span class="ident" id="6386951">huffmanTree</span><span class="op" id="6386962">,</span>&nbsp;<span class="ident" id="6386964">codes</span>&nbsp;<span class="op" id="6386970">[</span><span class="op" id="6386971">]</span><span class="ident" id="6386972">huffmanCode</span><span class="op" id="6386983">,</span>&nbsp;<span class="ident" id="6386985">level</span>&nbsp;<span class="builtintype" id="6386991">uint32</span><span class="op" id="6386997">)</span>&nbsp;<span class="op" id="6386999">(</span><span class="ident" id="6387000">nodeIndex</span>&nbsp;<span class="builtintype" id="6387010">uint16</span><span class="op" id="6387016">,</span>&nbsp;<span class="ident" id="6387018">err</span>&nbsp;<span class="builtintype" id="6387022">error</span><span class="op" id="6387027">)</span>&nbsp;<span class="op" id="6387029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387032">test</span>&nbsp;<span class="op" id="6387037">:=</span>&nbsp;<span class="builtintype" id="6387040">uint32</span><span class="op" id="6387046">(</span><span class="num" id="6387047">1</span><span class="op" id="6387048">)</span>&nbsp;<span class="op" id="6387050">&lt;&lt;</span>&nbsp;<span class="op" id="6387053">(</span><span class="num" id="6387054">31</span>&nbsp;<span class="op" id="6387057">-</span>&nbsp;<span class="ident" id="6387059">level</span><span class="op" id="6387064">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387068">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387161">firstRightIndex</span>&nbsp;<span class="op" id="6387177">:=</span>&nbsp;<span class="builtinfunc" id="6387180">len</span><span class="op" id="6387183">(</span><span class="ident" id="6387184">codes</span><span class="op" id="6387189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387192">for</span>&nbsp;<span class="ident" id="6387196">i</span><span class="op" id="6387197">,</span>&nbsp;<span class="ident" id="6387199">code</span>&nbsp;<span class="op" id="6387204">:=</span>&nbsp;<span class="keyword" id="6387207">range</span>&nbsp;<span class="ident" id="6387213">codes</span>&nbsp;<span class="op" id="6387219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387223">if</span>&nbsp;<span class="ident" id="6387226">code</span><span class="op" id="6387230">.</span><span class="ident" id="6387231">code</span><span class="op" id="6387235">&amp;</span><span class="ident" id="6387236">test</span>&nbsp;<span class="op" id="6387241">!=</span>&nbsp;<span class="num" id="6387244">0</span>&nbsp;<span class="op" id="6387246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387251">firstRightIndex</span>&nbsp;<span class="op" id="6387267">=</span>&nbsp;<span class="ident" id="6387269">i</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387274">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387289">left</span>&nbsp;<span class="op" id="6387294">:=</span>&nbsp;<span class="ident" id="6387297">codes</span><span class="op" id="6387302">[</span><span class="op" id="6387303">:</span><span class="ident" id="6387304">firstRightIndex</span><span class="op" id="6387319">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387322">right</span>&nbsp;<span class="op" id="6387328">:=</span>&nbsp;<span class="ident" id="6387331">codes</span><span class="op" id="6387336">[</span><span class="ident" id="6387337">firstRightIndex</span><span class="op" id="6387352">:</span><span class="op" id="6387353">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387357">if</span>&nbsp;<span class="builtinfunc" id="6387360">len</span><span class="op" id="6387363">(</span><span class="ident" id="6387364">left</span><span class="op" id="6387368">)</span>&nbsp;<span class="op" id="6387370">==</span>&nbsp;<span class="num" id="6387373">0</span>&nbsp;<span class="op" id="6387375">||</span>&nbsp;<span class="builtinfunc" id="6387378">len</span><span class="op" id="6387381">(</span><span class="ident" id="6387382">right</span><span class="op" id="6387387">)</span>&nbsp;<span class="op" id="6387389">==</span>&nbsp;<span class="num" id="6387392">0</span>&nbsp;<span class="op" id="6387394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387398">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387463">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387529">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387561">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387624">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387687">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387735">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387740">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387805">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387871">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387933">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387988">if</span>&nbsp;<span class="builtinfunc" id="6387991">len</span><span class="op" id="6387994">(</span><span class="ident" id="6387995">codes</span><span class="op" id="6388000">)</span>&nbsp;<span class="op" id="6388002">&lt;</span>&nbsp;<span class="num" id="6388004">2</span>&nbsp;<span class="op" id="6388006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388011">return</span>&nbsp;<span class="num" id="6388018">0</span><span class="op" id="6388019">,</span>&nbsp;<span class="ident" id="6388021">StructuralError</span><span class="op" id="6388036">(</span><span class="string" id="6388037">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="6388057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6388066">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6388131">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6388190">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388206">if</span>&nbsp;<span class="ident" id="6388209">level</span>&nbsp;<span class="op" id="6388215">==</span>&nbsp;<span class="num" id="6388218">31</span>&nbsp;<span class="op" id="6388221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6388226">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6388283">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6388342">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6388393">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388419">return</span>&nbsp;<span class="num" id="6388426">0</span><span class="op" id="6388427">,</span>&nbsp;<span class="ident" id="6388429">StructuralError</span><span class="op" id="6388444">(</span><span class="string" id="6388445">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="6388476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388485">if</span>&nbsp;<span class="builtinfunc" id="6388488">len</span><span class="op" id="6388491">(</span><span class="ident" id="6388492">left</span><span class="op" id="6388496">)</span>&nbsp;<span class="op" id="6388498">==</span>&nbsp;<span class="num" id="6388501">0</span>&nbsp;<span class="op" id="6388503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388508">return</span>&nbsp;<span class="ident" id="6388515">buildHuffmanNode</span><span class="op" id="6388531">(</span><span class="ident" id="6388532">t</span><span class="op" id="6388533">,</span>&nbsp;<span class="ident" id="6388535">right</span><span class="op" id="6388540">,</span>&nbsp;<span class="ident" id="6388542">level</span><span class="op" id="6388547">+</span><span class="num" id="6388548">1</span><span class="op" id="6388549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388557">return</span>&nbsp;<span class="ident" id="6388564">buildHuffmanNode</span><span class="op" id="6388580">(</span><span class="ident" id="6388581">t</span><span class="op" id="6388582">,</span>&nbsp;<span class="ident" id="6388584">left</span><span class="op" id="6388588">,</span>&nbsp;<span class="ident" id="6388590">level</span><span class="op" id="6388595">+</span><span class="num" id="6388596">1</span><span class="op" id="6388597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388600">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388604">nodeIndex</span>&nbsp;<span class="op" id="6388614">=</span>&nbsp;<span class="builtintype" id="6388616">uint16</span><span class="op" id="6388622">(</span><span class="ident" id="6388623">t</span><span class="op" id="6388624">.</span><span class="ident" id="6388625">nextNode</span><span class="op" id="6388633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388636">node</span>&nbsp;<span class="op" id="6388641">:=</span>&nbsp;<span class="op" id="6388644">&amp;</span><span class="ident" id="6388645">t</span><span class="op" id="6388646">.</span><span class="ident" id="6388647">nodes</span><span class="op" id="6388652">[</span><span class="ident" id="6388653">t</span><span class="op" id="6388654">.</span><span class="ident" id="6388655">nextNode</span><span class="op" id="6388663">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388666">t</span><span class="op" id="6388667">.</span><span class="ident" id="6388668">nextNode</span><span class="op" id="6388676">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388681">if</span>&nbsp;<span class="builtinfunc" id="6388684">len</span><span class="op" id="6388687">(</span><span class="ident" id="6388688">left</span><span class="op" id="6388692">)</span>&nbsp;<span class="op" id="6388694">==</span>&nbsp;<span class="num" id="6388697">1</span>&nbsp;<span class="op" id="6388699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6388703">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388718">node</span><span class="op" id="6388722">.</span><span class="ident" id="6388723">left</span>&nbsp;<span class="op" id="6388728">=</span>&nbsp;<span class="ident" id="6388730">invalidNodeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388749">node</span><span class="op" id="6388753">.</span><span class="ident" id="6388754">leftValue</span>&nbsp;<span class="op" id="6388764">=</span>&nbsp;<span class="ident" id="6388766">left</span><span class="op" id="6388770">[</span><span class="num" id="6388771">0</span><span class="op" id="6388772">]</span><span class="op" id="6388773">.</span><span class="ident" id="6388774">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388781">}</span>&nbsp;<span class="keyword" id="6388783">else</span>&nbsp;<span class="op" id="6388788">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388792">node</span><span class="op" id="6388796">.</span><span class="ident" id="6388797">left</span><span class="op" id="6388801">,</span>&nbsp;<span class="ident" id="6388803">err</span>&nbsp;<span class="op" id="6388807">=</span>&nbsp;<span class="ident" id="6388809">buildHuffmanNode</span><span class="op" id="6388825">(</span><span class="ident" id="6388826">t</span><span class="op" id="6388827">,</span>&nbsp;<span class="ident" id="6388829">left</span><span class="op" id="6388833">,</span>&nbsp;<span class="ident" id="6388835">level</span><span class="op" id="6388840">+</span><span class="num" id="6388841">1</span><span class="op" id="6388842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388849">if</span>&nbsp;<span class="ident" id="6388852">err</span>&nbsp;<span class="op" id="6388856">!=</span>&nbsp;<span class="ident" id="6388859">nil</span>&nbsp;<span class="op" id="6388863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388867">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388879">if</span>&nbsp;<span class="builtinfunc" id="6388882">len</span><span class="op" id="6388885">(</span><span class="ident" id="6388886">right</span><span class="op" id="6388891">)</span>&nbsp;<span class="op" id="6388893">==</span>&nbsp;<span class="num" id="6388896">1</span>&nbsp;<span class="op" id="6388898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6388902">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388917">node</span><span class="op" id="6388921">.</span><span class="ident" id="6388922">right</span>&nbsp;<span class="op" id="6388928">=</span>&nbsp;<span class="ident" id="6388930">invalidNodeValue</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388949">node</span><span class="op" id="6388953">.</span><span class="ident" id="6388954">rightValue</span>&nbsp;<span class="op" id="6388965">=</span>&nbsp;<span class="ident" id="6388967">right</span><span class="op" id="6388972">[</span><span class="num" id="6388973">0</span><span class="op" id="6388974">]</span><span class="op" id="6388975">.</span><span class="ident" id="6388976">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388983">}</span>&nbsp;<span class="keyword" id="6388985">else</span>&nbsp;<span class="op" id="6388990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388994">node</span><span class="op" id="6388998">.</span><span class="ident" id="6388999">right</span><span class="op" id="6389004">,</span>&nbsp;<span class="ident" id="6389006">err</span>&nbsp;<span class="op" id="6389010">=</span>&nbsp;<span class="ident" id="6389012">buildHuffmanNode</span><span class="op" id="6389028">(</span><span class="ident" id="6389029">t</span><span class="op" id="6389030">,</span>&nbsp;<span class="ident" id="6389032">right</span><span class="op" id="6389037">,</span>&nbsp;<span class="ident" id="6389039">level</span><span class="op" id="6389044">+</span><span class="num" id="6389045">1</span><span class="op" id="6389046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389053">return</span><br>
<span class="lineno"></span><span class="op" id="6389060">}</span>
</div>
</body>
</html>
