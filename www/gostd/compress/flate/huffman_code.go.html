<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4143202">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4143257">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4143311">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4143362">package</span>&nbsp;<span class="ident" id="4143370">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4143377">import</span>&nbsp;<span class="op" id="4143384">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4143387">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4143395">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4143402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4143405">type</span>&nbsp;<span class="ident" id="4143410">huffmanEncoder</span>&nbsp;<span class="keyword" id="4143425">struct</span>&nbsp;<span class="op" id="4143432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143435">codeBits</span>&nbsp;<span class="op" id="4143444">[</span><span class="op" id="4143445">]</span><span class="builtintype" id="4143446">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143453">code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4143462">[</span><span class="op" id="4143463">]</span><span class="builtintype" id="4143464">uint16</span><br>
<span class="lineno">15</span><span class="op" id="4143471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4143474">type</span>&nbsp;<span class="ident" id="4143479">literalNode</span>&nbsp;<span class="keyword" id="4143491">struct</span>&nbsp;<span class="op" id="4143498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143501">literal</span>&nbsp;<span class="builtintype" id="4143509">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143517">freq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4143525">int32</span><br>
<span class="lineno">20</span><span class="op" id="4143531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4143534">//&nbsp;A&nbsp;levelInfo&nbsp;describes&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;constructed&nbsp;tree&nbsp;for&nbsp;a&nbsp;given&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4143612">type</span>&nbsp;<span class="ident" id="4143617">levelInfo</span>&nbsp;<span class="keyword" id="4143627">struct</span>&nbsp;<span class="op" id="4143634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143637">//&nbsp;Our&nbsp;level.&nbsp;&nbsp;for&nbsp;better&nbsp;printing</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143673">level</span>&nbsp;<span class="builtintype" id="4143679">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143687">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;last&nbsp;node&nbsp;at&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143736">lastFreq</span>&nbsp;<span class="builtintype" id="4143745">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143753">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;character&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143814">nextCharFreq</span>&nbsp;<span class="builtintype" id="4143827">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143835">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;pair&nbsp;(from&nbsp;level&nbsp;below)&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143911">//&nbsp;Only&nbsp;valid&nbsp;if&nbsp;the&nbsp;&#34;needed&#34;&nbsp;value&nbsp;of&nbsp;the&nbsp;next&nbsp;lower&nbsp;level&nbsp;is&nbsp;0.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143978">nextPairFreq</span>&nbsp;<span class="builtintype" id="4143991">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143999">//&nbsp;The&nbsp;number&nbsp;of&nbsp;chains&nbsp;remaining&nbsp;to&nbsp;generate&nbsp;for&nbsp;this&nbsp;level&nbsp;before&nbsp;moving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144075">//&nbsp;up&nbsp;to&nbsp;the&nbsp;next&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144100">needed</span>&nbsp;<span class="builtintype" id="4144107">int32</span><br>
<span class="lineno">40</span><span class="op" id="4144113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4144116">func</span>&nbsp;<span class="ident" id="4144121">maxNode</span><span class="op" id="4144128">(</span><span class="op" id="4144129">)</span>&nbsp;<span class="ident" id="4144131">literalNode</span>&nbsp;<span class="op" id="4144143">{</span>&nbsp;<span class="keyword" id="4144145">return</span>&nbsp;<span class="ident" id="4144152">literalNode</span><span class="op" id="4144163">{</span><span class="ident" id="4144164">math</span><span class="op" id="4144168">.</span><span class="ident" id="4144169">MaxUint16</span><span class="op" id="4144178">,</span>&nbsp;<span class="ident" id="4144180">math</span><span class="op" id="4144184">.</span><span class="ident" id="4144185">MaxInt32</span><span class="op" id="4144193">}</span>&nbsp;<span class="op" id="4144195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4144198">func</span>&nbsp;<span class="ident" id="4144203">newHuffmanEncoder</span><span class="op" id="4144220">(</span><span class="ident" id="4144221">size</span>&nbsp;<span class="builtintype" id="4144226">int</span><span class="op" id="4144229">)</span>&nbsp;<span class="op" id="4144231">*</span><span class="ident" id="4144232">huffmanEncoder</span>&nbsp;<span class="op" id="4144247">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144250">return</span>&nbsp;<span class="op" id="4144257">&amp;</span><span class="ident" id="4144258">huffmanEncoder</span><span class="op" id="4144272">{</span><span class="builtinfunc" id="4144273">make</span><span class="op" id="4144277">(</span><span class="op" id="4144278">[</span><span class="op" id="4144279">]</span><span class="builtintype" id="4144280">uint8</span><span class="op" id="4144285">,</span>&nbsp;<span class="ident" id="4144287">size</span><span class="op" id="4144291">)</span><span class="op" id="4144292">,</span>&nbsp;<span class="builtinfunc" id="4144294">make</span><span class="op" id="4144298">(</span><span class="op" id="4144299">[</span><span class="op" id="4144300">]</span><span class="builtintype" id="4144301">uint16</span><span class="op" id="4144307">,</span>&nbsp;<span class="ident" id="4144309">size</span><span class="op" id="4144313">)</span><span class="op" id="4144314">}</span><br>
<span class="lineno"></span><span class="op" id="4144316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4144319">//&nbsp;Generates&nbsp;a&nbsp;HuffmanCode&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;fixed&nbsp;literal&nbsp;table</span><br>
<span class="lineno"></span><span class="keyword" id="4144387">func</span>&nbsp;<span class="ident" id="4144392">generateFixedLiteralEncoding</span><span class="op" id="4144420">(</span><span class="op" id="4144421">)</span>&nbsp;<span class="op" id="4144423">*</span><span class="ident" id="4144424">huffmanEncoder</span>&nbsp;<span class="op" id="4144439">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144442">h</span>&nbsp;<span class="op" id="4144444">:=</span>&nbsp;<span class="ident" id="4144447">newHuffmanEncoder</span><span class="op" id="4144464">(</span><span class="ident" id="4144465">maxLit</span><span class="op" id="4144471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144474">codeBits</span>&nbsp;<span class="op" id="4144483">:=</span>&nbsp;<span class="ident" id="4144486">h</span><span class="op" id="4144487">.</span><span class="ident" id="4144488">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144498">code</span>&nbsp;<span class="op" id="4144503">:=</span>&nbsp;<span class="ident" id="4144506">h</span><span class="op" id="4144507">.</span><span class="ident" id="4144508">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144514">var</span>&nbsp;<span class="ident" id="4144518">ch</span>&nbsp;<span class="builtintype" id="4144521">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144529">for</span>&nbsp;<span class="ident" id="4144533">ch</span>&nbsp;<span class="op" id="4144536">=</span>&nbsp;<span class="num" id="4144538">0</span><span class="op" id="4144539">;</span>&nbsp;<span class="ident" id="4144541">ch</span>&nbsp;<span class="op" id="4144544">&lt;</span>&nbsp;<span class="ident" id="4144546">maxLit</span><span class="op" id="4144552">;</span>&nbsp;<span class="ident" id="4144554">ch</span><span class="op" id="4144556">++</span>&nbsp;<span class="op" id="4144559">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144563">var</span>&nbsp;<span class="ident" id="4144567">bits</span>&nbsp;<span class="builtintype" id="4144572">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144581">var</span>&nbsp;<span class="ident" id="4144585">size</span>&nbsp;<span class="builtintype" id="4144590">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144598">switch</span>&nbsp;<span class="op" id="4144605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144609">case</span>&nbsp;<span class="ident" id="4144614">ch</span>&nbsp;<span class="op" id="4144617">&lt;</span>&nbsp;<span class="num" id="4144619">144</span><span class="op" id="4144622">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144627">//&nbsp;size&nbsp;8,&nbsp;000110000&nbsp;&nbsp;..&nbsp;10111111</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144664">bits</span>&nbsp;<span class="op" id="4144669">=</span>&nbsp;<span class="ident" id="4144671">ch</span>&nbsp;<span class="op" id="4144674">+</span>&nbsp;<span class="num" id="4144676">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144682">size</span>&nbsp;<span class="op" id="4144687">=</span>&nbsp;<span class="num" id="4144689">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144694">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144702">case</span>&nbsp;<span class="ident" id="4144707">ch</span>&nbsp;<span class="op" id="4144710">&lt;</span>&nbsp;<span class="num" id="4144712">256</span><span class="op" id="4144715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144720">//&nbsp;size&nbsp;9,&nbsp;110010000&nbsp;..&nbsp;111111111</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144757">bits</span>&nbsp;<span class="op" id="4144762">=</span>&nbsp;<span class="ident" id="4144764">ch</span>&nbsp;<span class="op" id="4144767">+</span>&nbsp;<span class="num" id="4144769">400</span>&nbsp;<span class="op" id="4144773">-</span>&nbsp;<span class="num" id="4144775">144</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144782">size</span>&nbsp;<span class="op" id="4144787">=</span>&nbsp;<span class="num" id="4144789">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144794">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144802">case</span>&nbsp;<span class="ident" id="4144807">ch</span>&nbsp;<span class="op" id="4144810">&lt;</span>&nbsp;<span class="num" id="4144812">280</span><span class="op" id="4144815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144820">//&nbsp;size&nbsp;7,&nbsp;0000000&nbsp;..&nbsp;0010111</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144853">bits</span>&nbsp;<span class="op" id="4144858">=</span>&nbsp;<span class="ident" id="4144860">ch</span>&nbsp;<span class="op" id="4144863">-</span>&nbsp;<span class="num" id="4144865">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144872">size</span>&nbsp;<span class="op" id="4144877">=</span>&nbsp;<span class="num" id="4144879">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144884">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4144892">default</span><span class="op" id="4144899">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144904">//&nbsp;size&nbsp;8,&nbsp;11000000&nbsp;..&nbsp;11000111</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144939">bits</span>&nbsp;<span class="op" id="4144944">=</span>&nbsp;<span class="ident" id="4144946">ch</span>&nbsp;<span class="op" id="4144949">+</span>&nbsp;<span class="num" id="4144951">192</span>&nbsp;<span class="op" id="4144955">-</span>&nbsp;<span class="num" id="4144957">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144964">size</span>&nbsp;<span class="op" id="4144969">=</span>&nbsp;<span class="num" id="4144971">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4144975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144979">codeBits</span><span class="op" id="4144987">[</span><span class="ident" id="4144988">ch</span><span class="op" id="4144990">]</span>&nbsp;<span class="op" id="4144992">=</span>&nbsp;<span class="ident" id="4144994">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145001">code</span><span class="op" id="4145005">[</span><span class="ident" id="4145006">ch</span><span class="op" id="4145008">]</span>&nbsp;<span class="op" id="4145010">=</span>&nbsp;<span class="ident" id="4145012">reverseBits</span><span class="op" id="4145023">(</span><span class="ident" id="4145024">bits</span><span class="op" id="4145028">,</span>&nbsp;<span class="ident" id="4145030">size</span><span class="op" id="4145034">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4145037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145040">return</span>&nbsp;<span class="ident" id="4145047">h</span><br>
<span class="lineno"></span><span class="op" id="4145049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4145052">func</span>&nbsp;<span class="ident" id="4145057">generateFixedOffsetEncoding</span><span class="op" id="4145084">(</span><span class="op" id="4145085">)</span>&nbsp;<span class="op" id="4145087">*</span><span class="ident" id="4145088">huffmanEncoder</span>&nbsp;<span class="op" id="4145103">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145106">h</span>&nbsp;<span class="op" id="4145108">:=</span>&nbsp;<span class="ident" id="4145111">newHuffmanEncoder</span><span class="op" id="4145128">(</span><span class="num" id="4145129">30</span><span class="op" id="4145131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145134">codeBits</span>&nbsp;<span class="op" id="4145143">:=</span>&nbsp;<span class="ident" id="4145146">h</span><span class="op" id="4145147">.</span><span class="ident" id="4145148">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145158">code</span>&nbsp;<span class="op" id="4145163">:=</span>&nbsp;<span class="ident" id="4145166">h</span><span class="op" id="4145167">.</span><span class="ident" id="4145168">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145174">for</span>&nbsp;<span class="ident" id="4145178">ch</span>&nbsp;<span class="op" id="4145181">:=</span>&nbsp;<span class="builtintype" id="4145184">uint16</span><span class="op" id="4145190">(</span><span class="num" id="4145191">0</span><span class="op" id="4145192">)</span><span class="op" id="4145193">;</span>&nbsp;<span class="ident" id="4145195">ch</span>&nbsp;<span class="op" id="4145198">&lt;</span>&nbsp;<span class="num" id="4145200">30</span><span class="op" id="4145202">;</span>&nbsp;<span class="ident" id="4145204">ch</span><span class="op" id="4145206">++</span>&nbsp;<span class="op" id="4145209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145213">codeBits</span><span class="op" id="4145221">[</span><span class="ident" id="4145222">ch</span><span class="op" id="4145224">]</span>&nbsp;<span class="op" id="4145226">=</span>&nbsp;<span class="num" id="4145228">5</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145232">code</span><span class="op" id="4145236">[</span><span class="ident" id="4145237">ch</span><span class="op" id="4145239">]</span>&nbsp;<span class="op" id="4145241">=</span>&nbsp;<span class="ident" id="4145243">reverseBits</span><span class="op" id="4145254">(</span><span class="ident" id="4145255">ch</span><span class="op" id="4145257">,</span>&nbsp;<span class="num" id="4145259">5</span><span class="op" id="4145260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4145263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145266">return</span>&nbsp;<span class="ident" id="4145273">h</span><br>
<span class="lineno"></span><span class="op" id="4145275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4145278">var</span>&nbsp;<span class="ident" id="4145282">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4145303">*</span><span class="ident" id="4145304">huffmanEncoder</span>&nbsp;<span class="op" id="4145319">=</span>&nbsp;<span class="ident" id="4145321">generateFixedLiteralEncoding</span><span class="op" id="4145349">(</span><span class="op" id="4145350">)</span><br>
<span class="lineno"></span><span class="keyword" id="4145352">var</span>&nbsp;<span class="ident" id="4145356">fixedOffsetEncoding</span>&nbsp;<span class="op" id="4145376">*</span><span class="ident" id="4145377">huffmanEncoder</span>&nbsp;<span class="op" id="4145392">=</span>&nbsp;<span class="ident" id="4145394">generateFixedOffsetEncoding</span><span class="op" id="4145421">(</span><span class="op" id="4145422">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4145425">func</span>&nbsp;<span class="op" id="4145430">(</span><span class="ident" id="4145431">h</span>&nbsp;<span class="op" id="4145433">*</span><span class="ident" id="4145434">huffmanEncoder</span><span class="op" id="4145448">)</span>&nbsp;<span class="ident" id="4145450">bitLength</span><span class="op" id="4145459">(</span><span class="ident" id="4145460">freq</span>&nbsp;<span class="op" id="4145465">[</span><span class="op" id="4145466">]</span><span class="builtintype" id="4145467">int32</span><span class="op" id="4145472">)</span>&nbsp;<span class="ident" id="4145474">int64</span>&nbsp;<span class="op" id="4145480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145483">var</span>&nbsp;<span class="ident" id="4145487">total</span>&nbsp;<span class="ident" id="4145493">int64</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145500">for</span>&nbsp;<span class="ident" id="4145504">i</span><span class="op" id="4145505">,</span>&nbsp;<span class="ident" id="4145507">f</span>&nbsp;<span class="op" id="4145509">:=</span>&nbsp;<span class="keyword" id="4145512">range</span>&nbsp;<span class="ident" id="4145518">freq</span>&nbsp;<span class="op" id="4145523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145527">if</span>&nbsp;<span class="ident" id="4145530">f</span>&nbsp;<span class="op" id="4145532">!=</span>&nbsp;<span class="num" id="4145535">0</span>&nbsp;<span class="op" id="4145537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145542">total</span>&nbsp;<span class="op" id="4145548">+=</span>&nbsp;<span class="ident" id="4145551">int64</span><span class="op" id="4145556">(</span><span class="ident" id="4145557">f</span><span class="op" id="4145558">)</span>&nbsp;<span class="op" id="4145560">*</span>&nbsp;<span class="ident" id="4145562">int64</span><span class="op" id="4145567">(</span><span class="ident" id="4145568">h</span><span class="op" id="4145569">.</span><span class="ident" id="4145570">codeBits</span><span class="op" id="4145578">[</span><span class="ident" id="4145579">i</span><span class="op" id="4145580">]</span><span class="op" id="4145581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4145585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4145588">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145591">return</span>&nbsp;<span class="ident" id="4145598">total</span><br>
<span class="lineno"></span><span class="op" id="4145604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4145607">const</span>&nbsp;<span class="ident" id="4145613">maxBitsLimit</span>&nbsp;<span class="op" id="4145626">=</span>&nbsp;<span class="num" id="4145628">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4145632">//&nbsp;Return&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;assigned&nbsp;to&nbsp;each&nbsp;bit&nbsp;size&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4145715">//</span><br>
<span class="lineno"></span><span class="comment" id="4145718">//&nbsp;This&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;list.length&nbsp;&gt;=&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="4145770">//&nbsp;The&nbsp;cases&nbsp;of&nbsp;0,&nbsp;1,&nbsp;and&nbsp;2&nbsp;literals&nbsp;are&nbsp;handled&nbsp;by&nbsp;special&nbsp;case&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4145841">//</span><br>
<span class="lineno">115</span><span class="comment" id="4145844">//&nbsp;list&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;the&nbsp;literals&nbsp;with&nbsp;non-zero&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4145904">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;their&nbsp;associated&nbsp;frequencies.&nbsp;&nbsp;The&nbsp;array&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing</span><br>
<span class="lineno"></span><span class="comment" id="4145990">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frequency,&nbsp;and&nbsp;has&nbsp;as&nbsp;its&nbsp;last&nbsp;element&nbsp;a&nbsp;special&nbsp;element&nbsp;with&nbsp;frequency</span><br>
<span class="lineno"></span><span class="comment" id="4146077">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxInt32</span><br>
<span class="lineno"></span><span class="comment" id="4146101">//&nbsp;maxBits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;encode&nbsp;any&nbsp;literal.</span><br>
<span class="lineno">120</span><span class="comment" id="4146186">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;be&nbsp;less&nbsp;than&nbsp;16.</span><br>
<span class="lineno"></span><span class="comment" id="4146223">//&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;integer&nbsp;array&nbsp;in&nbsp;which&nbsp;array[i]&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span><span class="comment" id="4146306">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;should&nbsp;be&nbsp;encoded&nbsp;in&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4146355">func</span>&nbsp;<span class="op" id="4146360">(</span><span class="ident" id="4146361">h</span>&nbsp;<span class="op" id="4146363">*</span><span class="ident" id="4146364">huffmanEncoder</span><span class="op" id="4146378">)</span>&nbsp;<span class="ident" id="4146380">bitCounts</span><span class="op" id="4146389">(</span><span class="ident" id="4146390">list</span>&nbsp;<span class="op" id="4146395">[</span><span class="op" id="4146396">]</span><span class="ident" id="4146397">literalNode</span><span class="op" id="4146408">,</span>&nbsp;<span class="ident" id="4146410">maxBits</span>&nbsp;<span class="builtintype" id="4146418">int32</span><span class="op" id="4146423">)</span>&nbsp;<span class="op" id="4146425">[</span><span class="op" id="4146426">]</span><span class="builtintype" id="4146427">int32</span>&nbsp;<span class="op" id="4146433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146436">if</span>&nbsp;<span class="ident" id="4146439">maxBits</span>&nbsp;<span class="op" id="4146447">&gt;=</span>&nbsp;<span class="ident" id="4146450">maxBitsLimit</span>&nbsp;<span class="op" id="4146463">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4146467">panic</span><span class="op" id="4146472">(</span><span class="string" id="4146473">&#34;flate:&nbsp;maxBits&nbsp;too&nbsp;large&#34;</span><span class="op" id="4146499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146505">n</span>&nbsp;<span class="op" id="4146507">:=</span>&nbsp;<span class="builtintype" id="4146510">int32</span><span class="op" id="4146515">(</span><span class="builtinfunc" id="4146516">len</span><span class="op" id="4146519">(</span><span class="ident" id="4146520">list</span><span class="op" id="4146524">)</span><span class="op" id="4146525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146528">list</span>&nbsp;<span class="op" id="4146533">=</span>&nbsp;<span class="ident" id="4146535">list</span><span class="op" id="4146539">[</span><span class="num" id="4146540">0</span>&nbsp;<span class="op" id="4146542">:</span>&nbsp;<span class="ident" id="4146544">n</span><span class="op" id="4146545">+</span><span class="num" id="4146546">1</span><span class="op" id="4146547">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146550">list</span><span class="op" id="4146554">[</span><span class="ident" id="4146555">n</span><span class="op" id="4146556">]</span>&nbsp;<span class="op" id="4146558">=</span>&nbsp;<span class="ident" id="4146560">maxNode</span><span class="op" id="4146567">(</span><span class="op" id="4146568">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4146572">//&nbsp;The&nbsp;tree&nbsp;can&#39;t&nbsp;have&nbsp;greater&nbsp;depth&nbsp;than&nbsp;n&nbsp;-&nbsp;1,&nbsp;no&nbsp;matter&nbsp;what.&nbsp;&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4146644">//&nbsp;saves&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;work&nbsp;in&nbsp;some&nbsp;small&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146695">if</span>&nbsp;<span class="ident" id="4146698">maxBits</span>&nbsp;<span class="op" id="4146706">&gt;</span>&nbsp;<span class="ident" id="4146708">n</span><span class="op" id="4146709">-</span><span class="num" id="4146710">1</span>&nbsp;<span class="op" id="4146712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146716">maxBits</span>&nbsp;<span class="op" id="4146724">=</span>&nbsp;<span class="ident" id="4146726">n</span>&nbsp;<span class="op" id="4146728">-</span>&nbsp;<span class="num" id="4146730">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4146737">//&nbsp;Create&nbsp;information&nbsp;about&nbsp;each&nbsp;of&nbsp;the&nbsp;levels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4146786">//&nbsp;A&nbsp;bogus&nbsp;&#34;Level&nbsp;0&#34;&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4146838">//&nbsp;level1.prev.needed==0.&nbsp;&nbsp;This&nbsp;makes&nbsp;level1.nextPairFreq</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4146897">//&nbsp;be&nbsp;a&nbsp;legitimate&nbsp;value&nbsp;that&nbsp;never&nbsp;gets&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146947">var</span>&nbsp;<span class="ident" id="4146951">levels</span>&nbsp;<span class="op" id="4146958">[</span><span class="ident" id="4146959">maxBitsLimit</span><span class="op" id="4146971">]</span><span class="ident" id="4146972">levelInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4146983">//&nbsp;leafCounts[i]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4147043">//&nbsp;of&nbsp;ancestors&nbsp;of&nbsp;the&nbsp;rightmost&nbsp;node&nbsp;at&nbsp;level&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4147094">//&nbsp;leafCounts[i][j]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4147153">//&nbsp;of&nbsp;the&nbsp;level&nbsp;j&nbsp;ancestor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147182">var</span>&nbsp;<span class="ident" id="4147186">leafCounts</span>&nbsp;<span class="op" id="4147197">[</span><span class="ident" id="4147198">maxBitsLimit</span><span class="op" id="4147210">]</span><span class="op" id="4147211">[</span><span class="ident" id="4147212">maxBitsLimit</span><span class="op" id="4147224">]</span><span class="builtintype" id="4147225">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147233">for</span>&nbsp;<span class="ident" id="4147237">level</span>&nbsp;<span class="op" id="4147243">:=</span>&nbsp;<span class="builtintype" id="4147246">int32</span><span class="op" id="4147251">(</span><span class="num" id="4147252">1</span><span class="op" id="4147253">)</span><span class="op" id="4147254">;</span>&nbsp;<span class="ident" id="4147256">level</span>&nbsp;<span class="op" id="4147262">&lt;=</span>&nbsp;<span class="ident" id="4147265">maxBits</span><span class="op" id="4147272">;</span>&nbsp;<span class="ident" id="4147274">level</span><span class="op" id="4147279">++</span>&nbsp;<span class="op" id="4147282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4147286">//&nbsp;For&nbsp;every&nbsp;level,&nbsp;the&nbsp;first&nbsp;two&nbsp;items&nbsp;are&nbsp;the&nbsp;first&nbsp;two&nbsp;characters.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4147358">//&nbsp;We&nbsp;initialize&nbsp;the&nbsp;levels&nbsp;as&nbsp;if&nbsp;we&nbsp;had&nbsp;already&nbsp;figured&nbsp;this&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147427">levels</span><span class="op" id="4147433">[</span><span class="ident" id="4147434">level</span><span class="op" id="4147439">]</span>&nbsp;<span class="op" id="4147441">=</span>&nbsp;<span class="ident" id="4147443">levelInfo</span><span class="op" id="4147452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147457">level</span><span class="op" id="4147462">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4147471">level</span><span class="op" id="4147476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147481">lastFreq</span><span class="op" id="4147489">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4147495">list</span><span class="op" id="4147499">[</span><span class="num" id="4147500">1</span><span class="op" id="4147501">]</span><span class="op" id="4147502">.</span><span class="ident" id="4147503">freq</span><span class="op" id="4147507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147512">nextCharFreq</span><span class="op" id="4147524">:</span>&nbsp;<span class="ident" id="4147526">list</span><span class="op" id="4147530">[</span><span class="num" id="4147531">2</span><span class="op" id="4147532">]</span><span class="op" id="4147533">.</span><span class="ident" id="4147534">freq</span><span class="op" id="4147538">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147543">nextPairFreq</span><span class="op" id="4147555">:</span>&nbsp;<span class="ident" id="4147557">list</span><span class="op" id="4147561">[</span><span class="num" id="4147562">0</span><span class="op" id="4147563">]</span><span class="op" id="4147564">.</span><span class="ident" id="4147565">freq</span>&nbsp;<span class="op" id="4147570">+</span>&nbsp;<span class="ident" id="4147572">list</span><span class="op" id="4147576">[</span><span class="num" id="4147577">1</span><span class="op" id="4147578">]</span><span class="op" id="4147579">.</span><span class="ident" id="4147580">freq</span><span class="op" id="4147584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147592">leafCounts</span><span class="op" id="4147602">[</span><span class="ident" id="4147603">level</span><span class="op" id="4147608">]</span><span class="op" id="4147609">[</span><span class="ident" id="4147610">level</span><span class="op" id="4147615">]</span>&nbsp;<span class="op" id="4147617">=</span>&nbsp;<span class="num" id="4147619">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147623">if</span>&nbsp;<span class="ident" id="4147626">level</span>&nbsp;<span class="op" id="4147632">==</span>&nbsp;<span class="num" id="4147635">1</span>&nbsp;<span class="op" id="4147637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147642">levels</span><span class="op" id="4147648">[</span><span class="ident" id="4147649">level</span><span class="op" id="4147654">]</span><span class="op" id="4147655">.</span><span class="ident" id="4147656">nextPairFreq</span>&nbsp;<span class="op" id="4147669">=</span>&nbsp;<span class="ident" id="4147671">math</span><span class="op" id="4147675">.</span><span class="ident" id="4147676">MaxInt32</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4147694">//&nbsp;We&nbsp;need&nbsp;a&nbsp;total&nbsp;of&nbsp;2*n&nbsp;-&nbsp;2&nbsp;items&nbsp;at&nbsp;top&nbsp;level&nbsp;and&nbsp;have&nbsp;already&nbsp;generated&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147774">levels</span><span class="op" id="4147780">[</span><span class="ident" id="4147781">maxBits</span><span class="op" id="4147788">]</span><span class="op" id="4147789">.</span><span class="ident" id="4147790">needed</span>&nbsp;<span class="op" id="4147797">=</span>&nbsp;<span class="num" id="4147799">2</span><span class="op" id="4147800">*</span><span class="ident" id="4147801">n</span>&nbsp;<span class="op" id="4147803">-</span>&nbsp;<span class="num" id="4147805">4</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147809">level</span>&nbsp;<span class="op" id="4147815">:=</span>&nbsp;<span class="ident" id="4147818">maxBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147827">for</span>&nbsp;<span class="op" id="4147831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147835">l</span>&nbsp;<span class="op" id="4147837">:=</span>&nbsp;<span class="op" id="4147840">&amp;</span><span class="ident" id="4147841">levels</span><span class="op" id="4147847">[</span><span class="ident" id="4147848">level</span><span class="op" id="4147853">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147857">if</span>&nbsp;<span class="ident" id="4147860">l</span><span class="op" id="4147861">.</span><span class="ident" id="4147862">nextPairFreq</span>&nbsp;<span class="op" id="4147875">==</span>&nbsp;<span class="ident" id="4147878">math</span><span class="op" id="4147882">.</span><span class="ident" id="4147883">MaxInt32</span>&nbsp;<span class="op" id="4147892">&amp;&amp;</span>&nbsp;<span class="ident" id="4147895">l</span><span class="op" id="4147896">.</span><span class="ident" id="4147897">nextCharFreq</span>&nbsp;<span class="op" id="4147910">==</span>&nbsp;<span class="ident" id="4147913">math</span><span class="op" id="4147917">.</span><span class="ident" id="4147918">MaxInt32</span>&nbsp;<span class="op" id="4147927">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4147932">//&nbsp;We&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;both&nbsp;leafs&nbsp;and&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4147977">//&nbsp;End&nbsp;all&nbsp;calculations&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4148020">//&nbsp;To&nbsp;make&nbsp;sure&nbsp;we&nbsp;never&nbsp;come&nbsp;back&nbsp;to&nbsp;this&nbsp;level&nbsp;or&nbsp;any&nbsp;lower&nbsp;level,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4148092">//&nbsp;set&nbsp;nextPairFreq&nbsp;impossibly&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148133">l</span><span class="op" id="4148134">.</span><span class="ident" id="4148135">needed</span>&nbsp;<span class="op" id="4148142">=</span>&nbsp;<span class="num" id="4148144">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148149">levels</span><span class="op" id="4148155">[</span><span class="ident" id="4148156">level</span><span class="op" id="4148161">+</span><span class="num" id="4148162">1</span><span class="op" id="4148163">]</span><span class="op" id="4148164">.</span><span class="ident" id="4148165">nextPairFreq</span>&nbsp;<span class="op" id="4148178">=</span>&nbsp;<span class="ident" id="4148180">math</span><span class="op" id="4148184">.</span><span class="ident" id="4148185">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148197">level</span><span class="op" id="4148202">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148208">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148224">prevFreq</span>&nbsp;<span class="op" id="4148233">:=</span>&nbsp;<span class="ident" id="4148236">l</span><span class="op" id="4148237">.</span><span class="ident" id="4148238">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148249">if</span>&nbsp;<span class="ident" id="4148252">l</span><span class="op" id="4148253">.</span><span class="ident" id="4148254">nextCharFreq</span>&nbsp;<span class="op" id="4148267">&lt;</span>&nbsp;<span class="ident" id="4148269">l</span><span class="op" id="4148270">.</span><span class="ident" id="4148271">nextPairFreq</span>&nbsp;<span class="op" id="4148284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4148289">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;leaf&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148337">n</span>&nbsp;<span class="op" id="4148339">:=</span>&nbsp;<span class="ident" id="4148342">leafCounts</span><span class="op" id="4148352">[</span><span class="ident" id="4148353">level</span><span class="op" id="4148358">]</span><span class="op" id="4148359">[</span><span class="ident" id="4148360">level</span><span class="op" id="4148365">]</span>&nbsp;<span class="op" id="4148367">+</span>&nbsp;<span class="num" id="4148369">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148374">l</span><span class="op" id="4148375">.</span><span class="ident" id="4148376">lastFreq</span>&nbsp;<span class="op" id="4148385">=</span>&nbsp;<span class="ident" id="4148387">l</span><span class="op" id="4148388">.</span><span class="ident" id="4148389">nextCharFreq</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4148405">//&nbsp;Lower&nbsp;leafCounts&nbsp;are&nbsp;the&nbsp;same&nbsp;of&nbsp;the&nbsp;previous&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148463">leafCounts</span><span class="op" id="4148473">[</span><span class="ident" id="4148474">level</span><span class="op" id="4148479">]</span><span class="op" id="4148480">[</span><span class="ident" id="4148481">level</span><span class="op" id="4148486">]</span>&nbsp;<span class="op" id="4148488">=</span>&nbsp;<span class="ident" id="4148490">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148495">l</span><span class="op" id="4148496">.</span><span class="ident" id="4148497">nextCharFreq</span>&nbsp;<span class="op" id="4148510">=</span>&nbsp;<span class="ident" id="4148512">list</span><span class="op" id="4148516">[</span><span class="ident" id="4148517">n</span><span class="op" id="4148518">]</span><span class="op" id="4148519">.</span><span class="ident" id="4148520">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148527">}</span>&nbsp;<span class="keyword" id="4148529">else</span>&nbsp;<span class="op" id="4148534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4148539">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;pair&nbsp;from&nbsp;the&nbsp;previous&nbsp;row.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4148604">//&nbsp;nextPairFreq&nbsp;isn&#39;t&nbsp;valid&nbsp;until&nbsp;we&nbsp;generate&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4148657">//&nbsp;more&nbsp;values&nbsp;in&nbsp;the&nbsp;level&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148694">l</span><span class="op" id="4148695">.</span><span class="ident" id="4148696">lastFreq</span>&nbsp;<span class="op" id="4148705">=</span>&nbsp;<span class="ident" id="4148707">l</span><span class="op" id="4148708">.</span><span class="ident" id="4148709">nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4148725">//&nbsp;Take&nbsp;leaf&nbsp;counts&nbsp;from&nbsp;the&nbsp;lower&nbsp;level,&nbsp;except&nbsp;counts[level]&nbsp;remains&nbsp;the&nbsp;same.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4148809">copy</span><span class="op" id="4148813">(</span><span class="ident" id="4148814">leafCounts</span><span class="op" id="4148824">[</span><span class="ident" id="4148825">level</span><span class="op" id="4148830">]</span><span class="op" id="4148831">[</span><span class="op" id="4148832">:</span><span class="ident" id="4148833">level</span><span class="op" id="4148838">]</span><span class="op" id="4148839">,</span>&nbsp;<span class="ident" id="4148841">leafCounts</span><span class="op" id="4148851">[</span><span class="ident" id="4148852">level</span><span class="op" id="4148857">-</span><span class="num" id="4148858">1</span><span class="op" id="4148859">]</span><span class="op" id="4148860">[</span><span class="op" id="4148861">:</span><span class="ident" id="4148862">level</span><span class="op" id="4148867">]</span><span class="op" id="4148868">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148873">levels</span><span class="op" id="4148879">[</span><span class="ident" id="4148880">l</span><span class="op" id="4148881">.</span><span class="ident" id="4148882">level</span><span class="op" id="4148887">-</span><span class="num" id="4148888">1</span><span class="op" id="4148889">]</span><span class="op" id="4148890">.</span><span class="ident" id="4148891">needed</span>&nbsp;<span class="op" id="4148898">=</span>&nbsp;<span class="num" id="4148900">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148909">if</span>&nbsp;<span class="ident" id="4148912">l</span><span class="op" id="4148913">.</span><span class="ident" id="4148914">needed</span><span class="op" id="4148920">--</span><span class="op" id="4148922">;</span>&nbsp;<span class="ident" id="4148924">l</span><span class="op" id="4148925">.</span><span class="ident" id="4148926">needed</span>&nbsp;<span class="op" id="4148933">==</span>&nbsp;<span class="num" id="4148936">0</span>&nbsp;<span class="op" id="4148938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4148943">//&nbsp;We&#39;ve&nbsp;done&nbsp;everything&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149001">//&nbsp;Continue&nbsp;calculating&nbsp;one&nbsp;level&nbsp;up.&nbsp;&nbsp;Fill&nbsp;in&nbsp;nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149064">//&nbsp;of&nbsp;that&nbsp;level&nbsp;with&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;nodes&nbsp;we&#39;ve&nbsp;just&nbsp;calculated&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149139">//&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149157">if</span>&nbsp;<span class="ident" id="4149160">l</span><span class="op" id="4149161">.</span><span class="ident" id="4149162">level</span>&nbsp;<span class="op" id="4149168">==</span>&nbsp;<span class="ident" id="4149171">maxBits</span>&nbsp;<span class="op" id="4149179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149185">//&nbsp;All&nbsp;done!</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149202">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149216">levels</span><span class="op" id="4149222">[</span><span class="ident" id="4149223">l</span><span class="op" id="4149224">.</span><span class="ident" id="4149225">level</span><span class="op" id="4149230">+</span><span class="num" id="4149231">1</span><span class="op" id="4149232">]</span><span class="op" id="4149233">.</span><span class="ident" id="4149234">nextPairFreq</span>&nbsp;<span class="op" id="4149247">=</span>&nbsp;<span class="ident" id="4149249">prevFreq</span>&nbsp;<span class="op" id="4149258">+</span>&nbsp;<span class="ident" id="4149260">l</span><span class="op" id="4149261">.</span><span class="ident" id="4149262">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149274">level</span><span class="op" id="4149279">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149284">}</span>&nbsp;<span class="keyword" id="4149286">else</span>&nbsp;<span class="op" id="4149291">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149296">//&nbsp;If&nbsp;we&nbsp;stole&nbsp;from&nbsp;below,&nbsp;move&nbsp;down&nbsp;temporarily&nbsp;to&nbsp;replenish&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149365">for</span>&nbsp;<span class="ident" id="4149369">levels</span><span class="op" id="4149375">[</span><span class="ident" id="4149376">level</span><span class="op" id="4149381">-</span><span class="num" id="4149382">1</span><span class="op" id="4149383">]</span><span class="op" id="4149384">.</span><span class="ident" id="4149385">needed</span>&nbsp;<span class="op" id="4149392">&gt;</span>&nbsp;<span class="num" id="4149394">0</span>&nbsp;<span class="op" id="4149396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149402">level</span><span class="op" id="4149407">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149417">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149424">//&nbsp;Somethings&nbsp;is&nbsp;wrong&nbsp;if&nbsp;at&nbsp;the&nbsp;end,&nbsp;the&nbsp;top&nbsp;level&nbsp;is&nbsp;null&nbsp;or&nbsp;hasn&#39;t&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149500">//&nbsp;all&nbsp;of&nbsp;the&nbsp;leaves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149523">if</span>&nbsp;<span class="ident" id="4149526">leafCounts</span><span class="op" id="4149536">[</span><span class="ident" id="4149537">maxBits</span><span class="op" id="4149544">]</span><span class="op" id="4149545">[</span><span class="ident" id="4149546">maxBits</span><span class="op" id="4149553">]</span>&nbsp;<span class="op" id="4149555">!=</span>&nbsp;<span class="ident" id="4149558">n</span>&nbsp;<span class="op" id="4149560">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4149564">panic</span><span class="op" id="4149569">(</span><span class="string" id="4149570">&#34;leafCounts[maxBits][maxBits]&nbsp;!=&nbsp;n&#34;</span><span class="op" id="4149605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149612">bitCount</span>&nbsp;<span class="op" id="4149621">:=</span>&nbsp;<span class="builtinfunc" id="4149624">make</span><span class="op" id="4149628">(</span><span class="op" id="4149629">[</span><span class="op" id="4149630">]</span><span class="builtintype" id="4149631">int32</span><span class="op" id="4149636">,</span>&nbsp;<span class="ident" id="4149638">maxBits</span><span class="op" id="4149645">+</span><span class="num" id="4149646">1</span><span class="op" id="4149647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149650">bits</span>&nbsp;<span class="op" id="4149655">:=</span>&nbsp;<span class="num" id="4149658">1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149661">counts</span>&nbsp;<span class="op" id="4149668">:=</span>&nbsp;<span class="op" id="4149671">&amp;</span><span class="ident" id="4149672">leafCounts</span><span class="op" id="4149682">[</span><span class="ident" id="4149683">maxBits</span><span class="op" id="4149690">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149693">for</span>&nbsp;<span class="ident" id="4149697">level</span>&nbsp;<span class="op" id="4149703">:=</span>&nbsp;<span class="ident" id="4149706">maxBits</span><span class="op" id="4149713">;</span>&nbsp;<span class="ident" id="4149715">level</span>&nbsp;<span class="op" id="4149721">&gt;</span>&nbsp;<span class="num" id="4149723">0</span><span class="op" id="4149724">;</span>&nbsp;<span class="ident" id="4149726">level</span><span class="op" id="4149731">--</span>&nbsp;<span class="op" id="4149734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149738">//&nbsp;chain.leafCount&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;requiring&nbsp;at&nbsp;least&nbsp;&#34;bits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149814">//&nbsp;bits&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149835">bitCount</span><span class="op" id="4149843">[</span><span class="ident" id="4149844">bits</span><span class="op" id="4149848">]</span>&nbsp;<span class="op" id="4149850">=</span>&nbsp;<span class="ident" id="4149852">counts</span><span class="op" id="4149858">[</span><span class="ident" id="4149859">level</span><span class="op" id="4149864">]</span>&nbsp;<span class="op" id="4149866">-</span>&nbsp;<span class="ident" id="4149868">counts</span><span class="op" id="4149874">[</span><span class="ident" id="4149875">level</span><span class="op" id="4149880">-</span><span class="num" id="4149881">1</span><span class="op" id="4149882">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149886">bits</span><span class="op" id="4149890">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149897">return</span>&nbsp;<span class="ident" id="4149904">bitCount</span><br>
<span class="lineno"></span><span class="op" id="4149913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4149916">//&nbsp;Look&nbsp;at&nbsp;the&nbsp;leaves&nbsp;and&nbsp;assign&nbsp;them&nbsp;a&nbsp;bit&nbsp;count&nbsp;and&nbsp;an&nbsp;encoding&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4149995">//&nbsp;in&nbsp;RFC&nbsp;1951&nbsp;3.2.2</span><br>
<span class="lineno"></span><span class="keyword" id="4150016">func</span>&nbsp;<span class="op" id="4150021">(</span><span class="ident" id="4150022">h</span>&nbsp;<span class="op" id="4150024">*</span><span class="ident" id="4150025">huffmanEncoder</span><span class="op" id="4150039">)</span>&nbsp;<span class="ident" id="4150041">assignEncodingAndSize</span><span class="op" id="4150062">(</span><span class="ident" id="4150063">bitCount</span>&nbsp;<span class="op" id="4150072">[</span><span class="op" id="4150073">]</span><span class="builtintype" id="4150074">int32</span><span class="op" id="4150079">,</span>&nbsp;<span class="ident" id="4150081">list</span>&nbsp;<span class="op" id="4150086">[</span><span class="op" id="4150087">]</span><span class="ident" id="4150088">literalNode</span><span class="op" id="4150099">)</span>&nbsp;<span class="op" id="4150101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150104">code</span>&nbsp;<span class="op" id="4150109">:=</span>&nbsp;<span class="builtintype" id="4150112">uint16</span><span class="op" id="4150118">(</span><span class="num" id="4150119">0</span><span class="op" id="4150120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150123">for</span>&nbsp;<span class="ident" id="4150127">n</span><span class="op" id="4150128">,</span>&nbsp;<span class="ident" id="4150130">bits</span>&nbsp;<span class="op" id="4150135">:=</span>&nbsp;<span class="keyword" id="4150138">range</span>&nbsp;<span class="ident" id="4150144">bitCount</span>&nbsp;<span class="op" id="4150153">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150157">code</span>&nbsp;<span class="op" id="4150162">&lt;&lt;=</span>&nbsp;<span class="num" id="4150166">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150170">if</span>&nbsp;<span class="ident" id="4150173">n</span>&nbsp;<span class="op" id="4150175">==</span>&nbsp;<span class="num" id="4150178">0</span>&nbsp;<span class="op" id="4150180">||</span>&nbsp;<span class="ident" id="4150183">bits</span>&nbsp;<span class="op" id="4150188">==</span>&nbsp;<span class="num" id="4150191">0</span>&nbsp;<span class="op" id="4150193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150198">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150213">//&nbsp;The&nbsp;literals&nbsp;list[len(list)-bits]&nbsp;..&nbsp;list[len(list)-bits]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150276">//&nbsp;are&nbsp;encoded&nbsp;using&nbsp;&#34;bits&#34;&nbsp;bits,&nbsp;and&nbsp;get&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150331">//&nbsp;code,&nbsp;code&nbsp;+&nbsp;1,&nbsp;....&nbsp;&nbsp;The&nbsp;code&nbsp;values&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150378">//&nbsp;assigned&nbsp;in&nbsp;literal&nbsp;order&nbsp;(not&nbsp;frequency&nbsp;order).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150432">chunk</span>&nbsp;<span class="op" id="4150438">:=</span>&nbsp;<span class="ident" id="4150441">list</span><span class="op" id="4150445">[</span><span class="builtinfunc" id="4150446">len</span><span class="op" id="4150449">(</span><span class="ident" id="4150450">list</span><span class="op" id="4150454">)</span><span class="op" id="4150455">-</span><span class="builtintype" id="4150456">int</span><span class="op" id="4150459">(</span><span class="ident" id="4150460">bits</span><span class="op" id="4150464">)</span><span class="op" id="4150465">:</span><span class="op" id="4150466">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150470">sortByLiteral</span><span class="op" id="4150483">(</span><span class="ident" id="4150484">chunk</span><span class="op" id="4150489">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150493">for</span>&nbsp;<span class="ident" id="4150497">_</span><span class="op" id="4150498">,</span>&nbsp;<span class="ident" id="4150500">node</span>&nbsp;<span class="op" id="4150505">:=</span>&nbsp;<span class="keyword" id="4150508">range</span>&nbsp;<span class="ident" id="4150514">chunk</span>&nbsp;<span class="op" id="4150520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150525">h</span><span class="op" id="4150526">.</span><span class="ident" id="4150527">codeBits</span><span class="op" id="4150535">[</span><span class="ident" id="4150536">node</span><span class="op" id="4150540">.</span><span class="ident" id="4150541">literal</span><span class="op" id="4150548">]</span>&nbsp;<span class="op" id="4150550">=</span>&nbsp;<span class="builtintype" id="4150552">uint8</span><span class="op" id="4150557">(</span><span class="ident" id="4150558">n</span><span class="op" id="4150559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150564">h</span><span class="op" id="4150565">.</span><span class="ident" id="4150566">code</span><span class="op" id="4150570">[</span><span class="ident" id="4150571">node</span><span class="op" id="4150575">.</span><span class="ident" id="4150576">literal</span><span class="op" id="4150583">]</span>&nbsp;<span class="op" id="4150585">=</span>&nbsp;<span class="ident" id="4150587">reverseBits</span><span class="op" id="4150598">(</span><span class="ident" id="4150599">code</span><span class="op" id="4150603">,</span>&nbsp;<span class="builtintype" id="4150605">uint8</span><span class="op" id="4150610">(</span><span class="ident" id="4150611">n</span><span class="op" id="4150612">)</span><span class="op" id="4150613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150618">code</span><span class="op" id="4150622">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150627">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150631">list</span>&nbsp;<span class="op" id="4150636">=</span>&nbsp;<span class="ident" id="4150638">list</span><span class="op" id="4150642">[</span><span class="num" id="4150643">0</span>&nbsp;<span class="op" id="4150645">:</span>&nbsp;<span class="builtinfunc" id="4150647">len</span><span class="op" id="4150650">(</span><span class="ident" id="4150651">list</span><span class="op" id="4150655">)</span><span class="op" id="4150656">-</span><span class="builtintype" id="4150657">int</span><span class="op" id="4150660">(</span><span class="ident" id="4150661">bits</span><span class="op" id="4150665">)</span><span class="op" id="4150666">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150669">}</span><br>
<span class="lineno"></span><span class="op" id="4150671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4150674">//&nbsp;Update&nbsp;this&nbsp;Huffman&nbsp;Code&nbsp;object&nbsp;to&nbsp;be&nbsp;the&nbsp;minimum&nbsp;code&nbsp;for&nbsp;the&nbsp;specified&nbsp;frequency&nbsp;count.</span><br>
<span class="lineno">260</span><span class="comment" id="4150767">//</span><br>
<span class="lineno"></span><span class="comment" id="4150770">//&nbsp;freq&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;frequencies,&nbsp;in&nbsp;which&nbsp;frequency[i]&nbsp;gives&nbsp;the&nbsp;frequency&nbsp;of&nbsp;literal&nbsp;i.</span><br>
<span class="lineno"></span><span class="comment" id="4150860">//&nbsp;maxBits&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;any&nbsp;literal.</span><br>
<span class="lineno"></span><span class="keyword" id="4150923">func</span>&nbsp;<span class="op" id="4150928">(</span><span class="ident" id="4150929">h</span>&nbsp;<span class="op" id="4150931">*</span><span class="ident" id="4150932">huffmanEncoder</span><span class="op" id="4150946">)</span>&nbsp;<span class="ident" id="4150948">generate</span><span class="op" id="4150956">(</span><span class="ident" id="4150957">freq</span>&nbsp;<span class="op" id="4150962">[</span><span class="op" id="4150963">]</span><span class="builtintype" id="4150964">int32</span><span class="op" id="4150969">,</span>&nbsp;<span class="ident" id="4150971">maxBits</span>&nbsp;<span class="builtintype" id="4150979">int32</span><span class="op" id="4150984">)</span>&nbsp;<span class="op" id="4150986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150989">list</span>&nbsp;<span class="op" id="4150994">:=</span>&nbsp;<span class="builtinfunc" id="4150997">make</span><span class="op" id="4151001">(</span><span class="op" id="4151002">[</span><span class="op" id="4151003">]</span><span class="ident" id="4151004">literalNode</span><span class="op" id="4151015">,</span>&nbsp;<span class="builtinfunc" id="4151017">len</span><span class="op" id="4151020">(</span><span class="ident" id="4151021">freq</span><span class="op" id="4151025">)</span><span class="op" id="4151026">+</span><span class="num" id="4151027">1</span><span class="op" id="4151028">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151031">//&nbsp;Number&nbsp;of&nbsp;non-zero&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151063">count</span>&nbsp;<span class="op" id="4151069">:=</span>&nbsp;<span class="num" id="4151072">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151075">//&nbsp;Set&nbsp;list&nbsp;to&nbsp;be&nbsp;the&nbsp;set&nbsp;of&nbsp;all&nbsp;non-zero&nbsp;literals&nbsp;and&nbsp;their&nbsp;frequencies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151149">for</span>&nbsp;<span class="ident" id="4151153">i</span><span class="op" id="4151154">,</span>&nbsp;<span class="ident" id="4151156">f</span>&nbsp;<span class="op" id="4151158">:=</span>&nbsp;<span class="keyword" id="4151161">range</span>&nbsp;<span class="ident" id="4151167">freq</span>&nbsp;<span class="op" id="4151172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151176">if</span>&nbsp;<span class="ident" id="4151179">f</span>&nbsp;<span class="op" id="4151181">!=</span>&nbsp;<span class="num" id="4151184">0</span>&nbsp;<span class="op" id="4151186">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151191">list</span><span class="op" id="4151195">[</span><span class="ident" id="4151196">count</span><span class="op" id="4151201">]</span>&nbsp;<span class="op" id="4151203">=</span>&nbsp;<span class="ident" id="4151205">literalNode</span><span class="op" id="4151216">{</span><span class="builtintype" id="4151217">uint16</span><span class="op" id="4151223">(</span><span class="ident" id="4151224">i</span><span class="op" id="4151225">)</span><span class="op" id="4151226">,</span>&nbsp;<span class="ident" id="4151228">f</span><span class="op" id="4151229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151234">count</span><span class="op" id="4151239">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151244">}</span>&nbsp;<span class="keyword" id="4151246">else</span>&nbsp;<span class="op" id="4151251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151256">h</span><span class="op" id="4151257">.</span><span class="ident" id="4151258">codeBits</span><span class="op" id="4151266">[</span><span class="ident" id="4151267">i</span><span class="op" id="4151268">]</span>&nbsp;<span class="op" id="4151270">=</span>&nbsp;<span class="num" id="4151272">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151276">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151282">//&nbsp;If&nbsp;freq[]&nbsp;is&nbsp;shorter&nbsp;than&nbsp;codeBits[],&nbsp;fill&nbsp;rest&nbsp;of&nbsp;codeBits[]&nbsp;with&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151359">h</span><span class="op" id="4151360">.</span><span class="ident" id="4151361">codeBits</span>&nbsp;<span class="op" id="4151370">=</span>&nbsp;<span class="ident" id="4151372">h</span><span class="op" id="4151373">.</span><span class="ident" id="4151374">codeBits</span><span class="op" id="4151382">[</span><span class="num" id="4151383">0</span><span class="op" id="4151384">:</span><span class="builtinfunc" id="4151385">len</span><span class="op" id="4151388">(</span><span class="ident" id="4151389">freq</span><span class="op" id="4151393">)</span><span class="op" id="4151394">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151397">list</span>&nbsp;<span class="op" id="4151402">=</span>&nbsp;<span class="ident" id="4151404">list</span><span class="op" id="4151408">[</span><span class="num" id="4151409">0</span><span class="op" id="4151410">:</span><span class="ident" id="4151411">count</span><span class="op" id="4151416">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151419">if</span>&nbsp;<span class="ident" id="4151422">count</span>&nbsp;<span class="op" id="4151428">&lt;=</span>&nbsp;<span class="num" id="4151431">2</span>&nbsp;<span class="op" id="4151433">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151437">//&nbsp;Handle&nbsp;the&nbsp;small&nbsp;cases&nbsp;here,&nbsp;because&nbsp;they&nbsp;are&nbsp;awkward&nbsp;for&nbsp;the&nbsp;general&nbsp;case&nbsp;code.&nbsp;&nbsp;With</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151529">//&nbsp;two&nbsp;or&nbsp;fewer&nbsp;literals,&nbsp;everything&nbsp;has&nbsp;bit&nbsp;length&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151586">for</span>&nbsp;<span class="ident" id="4151590">i</span><span class="op" id="4151591">,</span>&nbsp;<span class="ident" id="4151593">node</span>&nbsp;<span class="op" id="4151598">:=</span>&nbsp;<span class="keyword" id="4151601">range</span>&nbsp;<span class="ident" id="4151607">list</span>&nbsp;<span class="op" id="4151612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151617">//&nbsp;&#34;list&#34;&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing&nbsp;literal&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151671">h</span><span class="op" id="4151672">.</span><span class="ident" id="4151673">codeBits</span><span class="op" id="4151681">[</span><span class="ident" id="4151682">node</span><span class="op" id="4151686">.</span><span class="ident" id="4151687">literal</span><span class="op" id="4151694">]</span>&nbsp;<span class="op" id="4151696">=</span>&nbsp;<span class="num" id="4151698">1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151703">h</span><span class="op" id="4151704">.</span><span class="ident" id="4151705">code</span><span class="op" id="4151709">[</span><span class="ident" id="4151710">node</span><span class="op" id="4151714">.</span><span class="ident" id="4151715">literal</span><span class="op" id="4151722">]</span>&nbsp;<span class="op" id="4151724">=</span>&nbsp;<span class="builtintype" id="4151726">uint16</span><span class="op" id="4151732">(</span><span class="ident" id="4151733">i</span><span class="op" id="4151734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151742">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151753">sortByFreq</span><span class="op" id="4151763">(</span><span class="ident" id="4151764">list</span><span class="op" id="4151768">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151772">//&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;for&nbsp;each&nbsp;bit&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151822">bitCount</span>&nbsp;<span class="op" id="4151831">:=</span>&nbsp;<span class="ident" id="4151834">h</span><span class="op" id="4151835">.</span><span class="ident" id="4151836">bitCounts</span><span class="op" id="4151845">(</span><span class="ident" id="4151846">list</span><span class="op" id="4151850">,</span>&nbsp;<span class="ident" id="4151852">maxBits</span><span class="op" id="4151859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151862">//&nbsp;And&nbsp;do&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151888">h</span><span class="op" id="4151889">.</span><span class="ident" id="4151890">assignEncodingAndSize</span><span class="op" id="4151911">(</span><span class="ident" id="4151912">bitCount</span><span class="op" id="4151920">,</span>&nbsp;<span class="ident" id="4151922">list</span><span class="op" id="4151926">)</span><br>
<span class="lineno">295</span><span class="op" id="4151928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4151931">type</span>&nbsp;<span class="ident" id="4151936">literalNodeSorter</span>&nbsp;<span class="keyword" id="4151954">struct</span>&nbsp;<span class="op" id="4151961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151964">a</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4151969">[</span><span class="op" id="4151970">]</span><span class="ident" id="4151971">literalNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151984">less</span>&nbsp;<span class="keyword" id="4151989">func</span><span class="op" id="4151993">(</span><span class="ident" id="4151994">i</span><span class="op" id="4151995">,</span>&nbsp;<span class="ident" id="4151997">j</span>&nbsp;<span class="builtintype" id="4151999">int</span><span class="op" id="4152002">)</span>&nbsp;<span class="builtintype" id="4152004">bool</span><br>
<span class="lineno">300</span><span class="op" id="4152009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4152012">func</span>&nbsp;<span class="op" id="4152017">(</span><span class="ident" id="4152018">s</span>&nbsp;<span class="ident" id="4152020">literalNodeSorter</span><span class="op" id="4152037">)</span>&nbsp;<span class="ident" id="4152039">Len</span><span class="op" id="4152042">(</span><span class="op" id="4152043">)</span>&nbsp;<span class="builtintype" id="4152045">int</span>&nbsp;<span class="op" id="4152049">{</span>&nbsp;<span class="keyword" id="4152051">return</span>&nbsp;<span class="builtinfunc" id="4152058">len</span><span class="op" id="4152061">(</span><span class="ident" id="4152062">s</span><span class="op" id="4152063">.</span><span class="ident" id="4152064">a</span><span class="op" id="4152065">)</span>&nbsp;<span class="op" id="4152067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4152070">func</span>&nbsp;<span class="op" id="4152075">(</span><span class="ident" id="4152076">s</span>&nbsp;<span class="ident" id="4152078">literalNodeSorter</span><span class="op" id="4152095">)</span>&nbsp;<span class="ident" id="4152097">Less</span><span class="op" id="4152101">(</span><span class="ident" id="4152102">i</span><span class="op" id="4152103">,</span>&nbsp;<span class="ident" id="4152105">j</span>&nbsp;<span class="builtintype" id="4152107">int</span><span class="op" id="4152110">)</span>&nbsp;<span class="builtintype" id="4152112">bool</span>&nbsp;<span class="op" id="4152117">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152120">return</span>&nbsp;<span class="ident" id="4152127">s</span><span class="op" id="4152128">.</span><span class="ident" id="4152129">less</span><span class="op" id="4152133">(</span><span class="ident" id="4152134">i</span><span class="op" id="4152135">,</span>&nbsp;<span class="ident" id="4152137">j</span><span class="op" id="4152138">)</span><br>
<span class="lineno"></span><span class="op" id="4152140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4152143">func</span>&nbsp;<span class="op" id="4152148">(</span><span class="ident" id="4152149">s</span>&nbsp;<span class="ident" id="4152151">literalNodeSorter</span><span class="op" id="4152168">)</span>&nbsp;<span class="ident" id="4152170">Swap</span><span class="op" id="4152174">(</span><span class="ident" id="4152175">i</span><span class="op" id="4152176">,</span>&nbsp;<span class="ident" id="4152178">j</span>&nbsp;<span class="builtintype" id="4152180">int</span><span class="op" id="4152183">)</span>&nbsp;<span class="op" id="4152185">{</span>&nbsp;<span class="ident" id="4152187">s</span><span class="op" id="4152188">.</span><span class="ident" id="4152189">a</span><span class="op" id="4152190">[</span><span class="ident" id="4152191">i</span><span class="op" id="4152192">]</span><span class="op" id="4152193">,</span>&nbsp;<span class="ident" id="4152195">s</span><span class="op" id="4152196">.</span><span class="ident" id="4152197">a</span><span class="op" id="4152198">[</span><span class="ident" id="4152199">j</span><span class="op" id="4152200">]</span>&nbsp;<span class="op" id="4152202">=</span>&nbsp;<span class="ident" id="4152204">s</span><span class="op" id="4152205">.</span><span class="ident" id="4152206">a</span><span class="op" id="4152207">[</span><span class="ident" id="4152208">j</span><span class="op" id="4152209">]</span><span class="op" id="4152210">,</span>&nbsp;<span class="ident" id="4152212">s</span><span class="op" id="4152213">.</span><span class="ident" id="4152214">a</span><span class="op" id="4152215">[</span><span class="ident" id="4152216">i</span><span class="op" id="4152217">]</span>&nbsp;<span class="op" id="4152219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="4152222">func</span>&nbsp;<span class="ident" id="4152227">sortByFreq</span><span class="op" id="4152237">(</span><span class="ident" id="4152238">a</span>&nbsp;<span class="op" id="4152240">[</span><span class="op" id="4152241">]</span><span class="ident" id="4152242">literalNode</span><span class="op" id="4152253">)</span>&nbsp;<span class="op" id="4152255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152258">s</span>&nbsp;<span class="op" id="4152260">:=</span>&nbsp;<span class="op" id="4152263">&amp;</span><span class="ident" id="4152264">literalNodeSorter</span><span class="op" id="4152281">{</span><span class="ident" id="4152282">a</span><span class="op" id="4152283">,</span>&nbsp;<span class="keyword" id="4152285">func</span><span class="op" id="4152289">(</span><span class="ident" id="4152290">i</span><span class="op" id="4152291">,</span>&nbsp;<span class="ident" id="4152293">j</span>&nbsp;<span class="builtintype" id="4152295">int</span><span class="op" id="4152298">)</span>&nbsp;<span class="builtintype" id="4152300">bool</span>&nbsp;<span class="op" id="4152305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152309">if</span>&nbsp;<span class="ident" id="4152312">a</span><span class="op" id="4152313">[</span><span class="ident" id="4152314">i</span><span class="op" id="4152315">]</span><span class="op" id="4152316">.</span><span class="ident" id="4152317">freq</span>&nbsp;<span class="op" id="4152322">==</span>&nbsp;<span class="ident" id="4152325">a</span><span class="op" id="4152326">[</span><span class="ident" id="4152327">j</span><span class="op" id="4152328">]</span><span class="op" id="4152329">.</span><span class="ident" id="4152330">freq</span>&nbsp;<span class="op" id="4152335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152340">return</span>&nbsp;<span class="ident" id="4152347">a</span><span class="op" id="4152348">[</span><span class="ident" id="4152349">i</span><span class="op" id="4152350">]</span><span class="op" id="4152351">.</span><span class="ident" id="4152352">literal</span>&nbsp;<span class="op" id="4152360">&lt;</span>&nbsp;<span class="ident" id="4152362">a</span><span class="op" id="4152363">[</span><span class="ident" id="4152364">j</span><span class="op" id="4152365">]</span><span class="op" id="4152366">.</span><span class="ident" id="4152367">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152377">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152381">return</span>&nbsp;<span class="ident" id="4152388">a</span><span class="op" id="4152389">[</span><span class="ident" id="4152390">i</span><span class="op" id="4152391">]</span><span class="op" id="4152392">.</span><span class="ident" id="4152393">freq</span>&nbsp;<span class="op" id="4152398">&lt;</span>&nbsp;<span class="ident" id="4152400">a</span><span class="op" id="4152401">[</span><span class="ident" id="4152402">j</span><span class="op" id="4152403">]</span><span class="op" id="4152404">.</span><span class="ident" id="4152405">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152411">}</span><span class="op" id="4152412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152415">sort</span><span class="op" id="4152419">.</span><span class="ident" id="4152420">Sort</span><span class="op" id="4152424">(</span><span class="ident" id="4152425">s</span><span class="op" id="4152426">)</span><br>
<span class="lineno"></span><span class="op" id="4152428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="4152431">func</span>&nbsp;<span class="ident" id="4152436">sortByLiteral</span><span class="op" id="4152449">(</span><span class="ident" id="4152450">a</span>&nbsp;<span class="op" id="4152452">[</span><span class="op" id="4152453">]</span><span class="ident" id="4152454">literalNode</span><span class="op" id="4152465">)</span>&nbsp;<span class="op" id="4152467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152470">s</span>&nbsp;<span class="op" id="4152472">:=</span>&nbsp;<span class="op" id="4152475">&amp;</span><span class="ident" id="4152476">literalNodeSorter</span><span class="op" id="4152493">{</span><span class="ident" id="4152494">a</span><span class="op" id="4152495">,</span>&nbsp;<span class="keyword" id="4152497">func</span><span class="op" id="4152501">(</span><span class="ident" id="4152502">i</span><span class="op" id="4152503">,</span>&nbsp;<span class="ident" id="4152505">j</span>&nbsp;<span class="builtintype" id="4152507">int</span><span class="op" id="4152510">)</span>&nbsp;<span class="builtintype" id="4152512">bool</span>&nbsp;<span class="op" id="4152517">{</span>&nbsp;<span class="keyword" id="4152519">return</span>&nbsp;<span class="ident" id="4152526">a</span><span class="op" id="4152527">[</span><span class="ident" id="4152528">i</span><span class="op" id="4152529">]</span><span class="op" id="4152530">.</span><span class="ident" id="4152531">literal</span>&nbsp;<span class="op" id="4152539">&lt;</span>&nbsp;<span class="ident" id="4152541">a</span><span class="op" id="4152542">[</span><span class="ident" id="4152543">j</span><span class="op" id="4152544">]</span><span class="op" id="4152545">.</span><span class="ident" id="4152546">literal</span>&nbsp;<span class="op" id="4152554">}</span><span class="op" id="4152555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152558">sort</span><span class="op" id="4152562">.</span><span class="ident" id="4152563">Sort</span><span class="op" id="4152567">(</span><span class="ident" id="4152568">s</span><span class="op" id="4152569">)</span><br>
<span class="lineno"></span><span class="op" id="4152571">}</span>
</div>
</body>
</html>
