<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3337174">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3337229">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3337283">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3337334">package</span>&nbsp;<span class="ident" id="3337342">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3337348">import</span>&nbsp;<span class="op" id="3337355">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3337358">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3337365">&#34;io&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3337370">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3337373">//&nbsp;fileTransport&nbsp;implements&nbsp;RoundTripper&nbsp;for&nbsp;the&nbsp;&#39;file&#39;&nbsp;protocol.</span><br>
<span class="lineno"></span><span class="keyword" id="3337439">type</span>&nbsp;<span class="ident" id="3337444">fileTransport</span>&nbsp;<span class="keyword" id="3337458">struct</span>&nbsp;<span class="op" id="3337465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337468">fh</span>&nbsp;<span class="ident" id="3337471"><a href="/net/http/fs.go.html#3353059">fileHandler</a></span><br>
<span class="lineno">15</span><span class="op" id="3337483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3337486">//&nbsp;NewFileTransport&nbsp;returns&nbsp;a&nbsp;new&nbsp;RoundTripper,&nbsp;serving&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="3337555">//&nbsp;FileSystem.&nbsp;The&nbsp;returned&nbsp;RoundTripper&nbsp;ignores&nbsp;the&nbsp;URL&nbsp;host&nbsp;in&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3337624">//&nbsp;incoming&nbsp;requests,&nbsp;as&nbsp;well&nbsp;as&nbsp;most&nbsp;other&nbsp;properties&nbsp;of&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="3337686">//&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3337698">//</span><br>
<span class="lineno"></span><span class="comment" id="3337701">//&nbsp;The&nbsp;typical&nbsp;use&nbsp;case&nbsp;for&nbsp;NewFileTransport&nbsp;is&nbsp;to&nbsp;register&nbsp;the&nbsp;&#34;file&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3337772">//&nbsp;protocol&nbsp;with&nbsp;a&nbsp;Transport,&nbsp;as&nbsp;in:</span><br>
<span class="lineno"></span><span class="comment" id="3337809">//</span><br>
<span class="lineno">25</span><span class="comment" id="3337812">//&nbsp;&nbsp;&nbsp;t&nbsp;:=&nbsp;&amp;http.Transport{}</span><br>
<span class="lineno"></span><span class="comment" id="3337840">//&nbsp;&nbsp;&nbsp;t.RegisterProtocol(&#34;file&#34;,&nbsp;http.NewFileTransport(http.Dir(&#34;/&#34;)))</span><br>
<span class="lineno"></span><span class="comment" id="3337910">//&nbsp;&nbsp;&nbsp;c&nbsp;:=&nbsp;&amp;http.Client{Transport:&nbsp;t}</span><br>
<span class="lineno"></span><span class="comment" id="3337947">//&nbsp;&nbsp;&nbsp;res,&nbsp;err&nbsp;:=&nbsp;c.Get(&#34;file:///etc/passwd&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3337992">//&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno">30</span><span class="keyword" id="3338001">func</span>&nbsp;<span class="ident" id="3338006">NewFileTransport</span><span class="op" id="3338022">(</span><span class="ident" id="3338023">fs</span>&nbsp;<span class="ident" id="3338026"><a href="/net/http/fs.go.html#3341508">FileSystem</a></span><span class="op" id="3338036">)</span>&nbsp;<span class="ident" id="3338038"><a href="/net/http/client.go.html#3313167">RoundTripper</a></span>&nbsp;<span class="op" id="3338051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338054">return</span>&nbsp;<span class="ident" id="3338061"><a href="/net/http/filetransport.go.html#3337444">fileTransport</a></span><span class="op" id="3338074">{</span><span class="ident" id="3338075"><a href="/net/http/fs.go.html#3353059">fileHandler</a></span><span class="op" id="3338086">{</span><span class="ident" id="3338087"><a href="/net/http/filetransport.go.html#3338023">fs</a></span><span class="op" id="3338089">}</span><span class="op" id="3338090">}</span><br>
<span class="lineno"></span><span class="op" id="3338092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3338095">func</span>&nbsp;<span class="op" id="3338100">(</span><span class="ident" id="3338101">t</span>&nbsp;<span class="ident" id="3338103"><a href="/net/http/filetransport.go.html#3337444">fileTransport</a></span><span class="op" id="3338116">)</span>&nbsp;<span class="ident" id="3338118">RoundTrip</span><span class="op" id="3338127">(</span><span class="ident" id="3338128">req</span>&nbsp;<span class="op" id="3338132">*</span><span class="ident" id="3338133"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3338140">)</span>&nbsp;<span class="op" id="3338142">(</span><span class="ident" id="3338143">resp</span>&nbsp;<span class="op" id="3338148">*</span><span class="ident" id="3338149"><a href="/net/http/response.go.html#3392041">Response</a></span><span class="op" id="3338157">,</span>&nbsp;<span class="ident" id="3338159">err</span>&nbsp;<span class="builtintype" id="3338163">error</span><span class="op" id="3338168">)</span>&nbsp;<span class="op" id="3338170">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338173">//&nbsp;We&nbsp;start&nbsp;ServeHTTP&nbsp;in&nbsp;a&nbsp;goroutine,&nbsp;which&nbsp;may&nbsp;take&nbsp;a&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338234">//&nbsp;time&nbsp;if&nbsp;the&nbsp;file&nbsp;is&nbsp;large.&nbsp;&nbsp;The&nbsp;newPopulateResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338296">//&nbsp;call&nbsp;returns&nbsp;a&nbsp;channel&nbsp;which&nbsp;either&nbsp;ServeHTTP&nbsp;or&nbsp;finish()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338358">//&nbsp;sends&nbsp;our&nbsp;*Response&nbsp;on,&nbsp;once&nbsp;the&nbsp;*Response&nbsp;itself&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338421">//&nbsp;populated&nbsp;(even&nbsp;if&nbsp;the&nbsp;body&nbsp;itself&nbsp;is&nbsp;still&nbsp;being</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338475">//&nbsp;written&nbsp;to&nbsp;the&nbsp;res.Body,&nbsp;a&nbsp;pipe)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338512">rw</span><span class="op" id="3338514">,</span>&nbsp;<span class="ident" id="3338516">resc</span>&nbsp;<span class="op" id="3338521">:=</span>&nbsp;<span class="ident" id="3338524"><a href="/net/http/filetransport.go.html#3338638">newPopulateResponseWriter</a></span><span class="op" id="3338549">(</span><span class="op" id="3338550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338553">go</span>&nbsp;<span class="keyword" id="3338556">func</span><span class="op" id="3338560">(</span><span class="op" id="3338561">)</span>&nbsp;<span class="op" id="3338563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338567"><a href="/net/http/filetransport.go.html#3338101">t</a></span><span class="op" id="3338568">.</span><span class="ident" id="3338569">fh</span><span class="op" id="3338571">.</span><span class="ident" id="3338572">ServeHTTP</span><span class="op" id="3338581">(</span><span class="ident" id="3338582"><a href="/net/http/filetransport.go.html#3338512">rw</a></span><span class="op" id="3338584">,</span>&nbsp;<span class="ident" id="3338586"><a href="/net/http/filetransport.go.html#3338128">req</a></span><span class="op" id="3338589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338593"><a href="/net/http/filetransport.go.html#3338512">rw</a></span><span class="op" id="3338595">.</span><span class="ident" id="3338596">finish</span><span class="op" id="3338602">(</span><span class="op" id="3338603">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338606">}</span><span class="op" id="3338607">(</span><span class="op" id="3338608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338611">return</span>&nbsp;<span class="op" id="3338618">&lt;-</span><span class="ident" id="3338620"><a href="/net/http/filetransport.go.html#3338516">resc</a></span><span class="op" id="3338624">,</span>&nbsp;<span class="ident" id="3338626">nil</span><br>
<span class="lineno"></span><span class="op" id="3338630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3338633">func</span>&nbsp;<span class="ident" id="3338638">newPopulateResponseWriter</span><span class="op" id="3338663">(</span><span class="op" id="3338664">)</span>&nbsp;<span class="op" id="3338666">(</span><span class="op" id="3338667">*</span><span class="ident" id="3338668"><a href="/net/http/filetransport.go.html#3339174">populateResponse</a></span><span class="op" id="3338684">,</span>&nbsp;<span class="op" id="3338686">&lt;-</span><span class="keyword" id="3338688">chan</span>&nbsp;<span class="op" id="3338693">*</span><span class="ident" id="3338694"><a href="/net/http/response.go.html#3392041">Response</a></span><span class="op" id="3338702">)</span>&nbsp;<span class="op" id="3338704">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338707">pr</span><span class="op" id="3338709">,</span>&nbsp;<span class="ident" id="3338711">pw</span>&nbsp;<span class="op" id="3338714">:=</span>&nbsp;<span class="ident" id="3338717"><a href="/net/http/filetransport.go.html#3337365">io</a></span><span class="op" id="3338719">.</span><span class="ident" id="3338720">Pipe</span><span class="op" id="3338724">(</span><span class="op" id="3338725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338728">rw</span>&nbsp;<span class="op" id="3338731">:=</span>&nbsp;<span class="op" id="3338734">&amp;</span><span class="ident" id="3338735"><a href="/net/http/filetransport.go.html#3339174">populateResponse</a></span><span class="op" id="3338751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338755">ch</span><span class="op" id="3338757">:</span>&nbsp;<span class="builtinfunc" id="3338759">make</span><span class="op" id="3338763">(</span><span class="keyword" id="3338764">chan</span>&nbsp;<span class="op" id="3338769">*</span><span class="ident" id="3338770"><a href="/net/http/response.go.html#3392041">Response</a></span><span class="op" id="3338778">)</span><span class="op" id="3338779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338783">pw</span><span class="op" id="3338785">:</span>&nbsp;<span class="ident" id="3338787"><a href="/net/http/filetransport.go.html#3338711">pw</a></span><span class="op" id="3338789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338793">res</span><span class="op" id="3338796">:</span>&nbsp;<span class="op" id="3338798">&amp;</span><span class="ident" id="3338799"><a href="/net/http/response.go.html#3392041">Response</a></span><span class="op" id="3338807">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338812">Proto</span><span class="op" id="3338817">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3338824">&#34;HTTP/1.0&#34;</span><span class="op" id="3338834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338839">ProtoMajor</span><span class="op" id="3338849">:</span>&nbsp;<span class="num" id="3338851">1</span><span class="op" id="3338852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338857">Header</span><span class="op" id="3338863">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3338869">make</span><span class="op" id="3338873">(</span><span class="ident" id="3338874"><a href="/net/http/header.go.html#3356649">Header</a></span><span class="op" id="3338880">)</span><span class="op" id="3338881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338886">Close</span><span class="op" id="3338891">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3338898">true</span><span class="op" id="3338902">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338907">Body</span><span class="op" id="3338911">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3338919"><a href="/net/http/filetransport.go.html#3338707">pr</a></span><span class="op" id="3338921">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338925">}</span><span class="op" id="3338926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338932">return</span>&nbsp;<span class="ident" id="3338939"><a href="/net/http/filetransport.go.html#3338728">rw</a></span><span class="op" id="3338941">,</span>&nbsp;<span class="ident" id="3338943"><a href="/net/http/filetransport.go.html#3338728">rw</a></span><span class="op" id="3338945">.</span><span class="ident" id="3338946">ch</span><br>
<span class="lineno"></span><span class="op" id="3338949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3338952">//&nbsp;populateResponse&nbsp;is&nbsp;a&nbsp;ResponseWriter&nbsp;that&nbsp;populates&nbsp;the&nbsp;*Response</span><br>
<span class="lineno"></span><span class="comment" id="3339021">//&nbsp;in&nbsp;res,&nbsp;and&nbsp;writes&nbsp;its&nbsp;body&nbsp;to&nbsp;a&nbsp;pipe&nbsp;connected&nbsp;to&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="comment" id="3339088">//&nbsp;body.&nbsp;Once&nbsp;writes&nbsp;begin&nbsp;or&nbsp;finish()&nbsp;is&nbsp;called,&nbsp;the&nbsp;response&nbsp;is&nbsp;sent</span><br>
<span class="lineno"></span><span class="comment" id="3339159">//&nbsp;on&nbsp;ch.</span><br>
<span class="lineno"></span><span class="keyword" id="3339169">type</span>&nbsp;<span class="ident" id="3339174">populateResponse</span>&nbsp;<span class="keyword" id="3339191">struct</span>&nbsp;<span class="op" id="3339198">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339201">res</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3339214">*</span><span class="ident" id="3339215"><a href="/net/http/response.go.html#3392041">Response</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339225">ch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3339238">chan</span>&nbsp;<span class="op" id="3339243">*</span><span class="ident" id="3339244"><a href="/net/http/response.go.html#3392041">Response</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339254">wroteHeader</span>&nbsp;&nbsp;<span class="builtintype" id="3339267">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339273">hasContent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3339286">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339292">sentResponse</span>&nbsp;<span class="builtintype" id="3339305">bool</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339311">pw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3339324">*</span><span class="ident" id="3339325"><a href="/net/http/filetransport.go.html#3337365">io</a></span><span class="op" id="3339327">.</span><span class="ident" id="3339328">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="3339339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3339342">func</span>&nbsp;<span class="op" id="3339347">(</span><span class="ident" id="3339348">pr</span>&nbsp;<span class="op" id="3339351">*</span><span class="ident" id="3339352"><a href="/net/http/filetransport.go.html#3339174">populateResponse</a></span><span class="op" id="3339368">)</span>&nbsp;<span class="ident" id="3339370">finish</span><span class="op" id="3339376">(</span><span class="op" id="3339377">)</span>&nbsp;<span class="op" id="3339379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339382">if</span>&nbsp;<span class="op" id="3339385">!</span><span class="ident" id="3339386"><a href="/net/http/filetransport.go.html#3339348">pr</a></span><span class="op" id="3339388">.</span><span class="ident" id="3339389">wroteHeader</span>&nbsp;<span class="op" id="3339401">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339405"><a href="/net/http/filetransport.go.html#3339348">pr</a></span><span class="op" id="3339407">.</span><span class="ident" id="3339408">WriteHeader</span><span class="op" id="3339419">(</span><span class="num" id="3339420">500</span><span class="op" id="3339423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339429">if</span>&nbsp;<span class="op" id="3339432">!</span><span class="ident" id="3339433"><a href="/net/http/filetransport.go.html#3339348">pr</a></span><span class="op" id="3339435">.</span><span class="ident" id="3339436">sentResponse</span>&nbsp;<span class="op" id="3339449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339453"><a href="/net/http/filetransport.go.html#3339348">pr</a></span><span class="op" id="3339455">.</span><span class="ident" id="3339456">sendResponse</span><span class="op" id="3339468">(</span><span class="op" id="3339469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339472">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339475"><a href="/net/http/filetransport.go.html#3339348">pr</a></span><span class="op" id="3339477">.</span><span class="ident" id="3339478">pw</span><span class="op" id="3339480">.</span><span class="ident" id="3339481">Close</span><span class="op" id="3339486">(</span><span class="op" id="3339487">)</span><br>
<span class="lineno"></span><span class="op" id="3339489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3339492">func</span>&nbsp;<span class="op" id="3339497">(</span><span class="ident" id="3339498">pr</span>&nbsp;<span class="op" id="3339501">*</span><span class="ident" id="3339502"><a href="/net/http/filetransport.go.html#3339174">populateResponse</a></span><span class="op" id="3339518">)</span>&nbsp;<span class="ident" id="3339520">sendResponse</span><span class="op" id="3339532">(</span><span class="op" id="3339533">)</span>&nbsp;<span class="op" id="3339535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339538">if</span>&nbsp;<span class="ident" id="3339541"><a href="/net/http/filetransport.go.html#3339498">pr</a></span><span class="op" id="3339543">.</span><span class="ident" id="3339544">sentResponse</span>&nbsp;<span class="op" id="3339557">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339561">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339572"><a href="/net/http/filetransport.go.html#3339498">pr</a></span><span class="op" id="3339574">.</span><span class="ident" id="3339575">sentResponse</span>&nbsp;<span class="op" id="3339588">=</span>&nbsp;<span class="builtintype" id="3339590">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339597">if</span>&nbsp;<span class="ident" id="3339600"><a href="/net/http/filetransport.go.html#3339498">pr</a></span><span class="op" id="3339602">.</span><span class="ident" id="3339603">hasContent</span>&nbsp;<span class="op" id="3339614">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339618"><a href="/net/http/filetransport.go.html#3339498">pr</a></span><span class="op" id="3339620">.</span><span class="ident" id="3339621">res</span><span class="op" id="3339624">.</span><span class="ident" id="3339625">ContentLength</span>&nbsp;<span class="op" id="3339639">=</span>&nbsp;<span class="op" id="3339641">-</span><span class="num" id="3339642">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339648"><a href="/net/http/filetransport.go.html#3339498">pr</a></span><span class="op" id="3339650">.</span><span class="ident" id="3339651">ch</span>&nbsp;<span class="op" id="3339654">&lt;-</span>&nbsp;<span class="ident" id="3339657"><a href="/net/http/filetransport.go.html#3339498">pr</a></span><span class="op" id="3339659">.</span><span class="ident" id="3339660">res</span><br>
<span class="lineno"></span><span class="op" id="3339664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="3339667">func</span>&nbsp;<span class="op" id="3339672">(</span><span class="ident" id="3339673">pr</span>&nbsp;<span class="op" id="3339676">*</span><span class="ident" id="3339677"><a href="/net/http/filetransport.go.html#3339174">populateResponse</a></span><span class="op" id="3339693">)</span>&nbsp;<span class="ident" id="3339695">Header</span><span class="op" id="3339701">(</span><span class="op" id="3339702">)</span>&nbsp;<span class="ident" id="3339704"><a href="/net/http/header.go.html#3356649">Header</a></span>&nbsp;<span class="op" id="3339711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339714">return</span>&nbsp;<span class="ident" id="3339721"><a href="/net/http/filetransport.go.html#3339673">pr</a></span><span class="op" id="3339723">.</span><span class="ident" id="3339724">res</span><span class="op" id="3339727">.</span><span class="ident" id="3339728">Header</span><br>
<span class="lineno"></span><span class="op" id="3339735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3339738">func</span>&nbsp;<span class="op" id="3339743">(</span><span class="ident" id="3339744">pr</span>&nbsp;<span class="op" id="3339747">*</span><span class="ident" id="3339748"><a href="/net/http/filetransport.go.html#3339174">populateResponse</a></span><span class="op" id="3339764">)</span>&nbsp;<span class="ident" id="3339766">WriteHeader</span><span class="op" id="3339777">(</span><span class="ident" id="3339778">code</span>&nbsp;<span class="builtintype" id="3339783">int</span><span class="op" id="3339786">)</span>&nbsp;<span class="op" id="3339788">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339791">if</span>&nbsp;<span class="ident" id="3339794"><a href="/net/http/filetransport.go.html#3339744">pr</a></span><span class="op" id="3339796">.</span><span class="ident" id="3339797">wroteHeader</span>&nbsp;<span class="op" id="3339809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339813">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339824"><a href="/net/http/filetransport.go.html#3339744">pr</a></span><span class="op" id="3339826">.</span><span class="ident" id="3339827">wroteHeader</span>&nbsp;<span class="op" id="3339839">=</span>&nbsp;<span class="builtintype" id="3339841">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339848"><a href="/net/http/filetransport.go.html#3339744">pr</a></span><span class="op" id="3339850">.</span><span class="ident" id="3339851">res</span><span class="op" id="3339854">.</span><span class="ident" id="3339855">StatusCode</span>&nbsp;<span class="op" id="3339866">=</span>&nbsp;<span class="ident" id="3339868"><a href="/net/http/filetransport.go.html#3339778">code</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339874"><a href="/net/http/filetransport.go.html#3339744">pr</a></span><span class="op" id="3339876">.</span><span class="ident" id="3339877">res</span><span class="op" id="3339880">.</span><span class="ident" id="3339881">Status</span>&nbsp;<span class="op" id="3339888">=</span>&nbsp;<span class="ident" id="3339890"><a href="/net/http/filetransport.go.html#3337358">fmt</a></span><span class="op" id="3339893">.</span><span class="ident" id="3339894">Sprintf</span><span class="op" id="3339901">(</span><span class="string" id="3339902">&#34;%d&nbsp;%s&#34;</span><span class="op" id="3339909">,</span>&nbsp;<span class="ident" id="3339911"><a href="/net/http/filetransport.go.html#3339778">code</a></span><span class="op" id="3339915">,</span>&nbsp;<span class="ident" id="3339917"><a href="/net/http/status.go.html#3471058">StatusText</a></span><span class="op" id="3339927">(</span><span class="ident" id="3339928"><a href="/net/http/filetransport.go.html#3339778">code</a></span><span class="op" id="3339932">)</span><span class="op" id="3339933">)</span><br>
<span class="lineno"></span><span class="op" id="3339935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3339938">func</span>&nbsp;<span class="op" id="3339943">(</span><span class="ident" id="3339944">pr</span>&nbsp;<span class="op" id="3339947">*</span><span class="ident" id="3339948"><a href="/net/http/filetransport.go.html#3339174">populateResponse</a></span><span class="op" id="3339964">)</span>&nbsp;<span class="ident" id="3339966">Write</span><span class="op" id="3339971">(</span><span class="ident" id="3339972">p</span>&nbsp;<span class="op" id="3339974">[</span><span class="op" id="3339975">]</span><span class="builtintype" id="3339976">byte</span><span class="op" id="3339980">)</span>&nbsp;<span class="op" id="3339982">(</span><span class="ident" id="3339983">n</span>&nbsp;<span class="builtintype" id="3339985">int</span><span class="op" id="3339988">,</span>&nbsp;<span class="ident" id="3339990">err</span>&nbsp;<span class="builtintype" id="3339994">error</span><span class="op" id="3339999">)</span>&nbsp;<span class="op" id="3340001">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340004">if</span>&nbsp;<span class="op" id="3340007">!</span><span class="ident" id="3340008"><a href="/net/http/filetransport.go.html#3339944">pr</a></span><span class="op" id="3340010">.</span><span class="ident" id="3340011">wroteHeader</span>&nbsp;<span class="op" id="3340023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340027"><a href="/net/http/filetransport.go.html#3339944">pr</a></span><span class="op" id="3340029">.</span><span class="ident" id="3340030">WriteHeader</span><span class="op" id="3340041">(</span><span class="ident" id="3340042"><a href="/net/http/status.go.html#3466742">StatusOK</a></span><span class="op" id="3340050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340056"><a href="/net/http/filetransport.go.html#3339944">pr</a></span><span class="op" id="3340058">.</span><span class="ident" id="3340059">hasContent</span>&nbsp;<span class="op" id="3340070">=</span>&nbsp;<span class="builtintype" id="3340072">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340078">if</span>&nbsp;<span class="op" id="3340081">!</span><span class="ident" id="3340082"><a href="/net/http/filetransport.go.html#3339944">pr</a></span><span class="op" id="3340084">.</span><span class="ident" id="3340085">sentResponse</span>&nbsp;<span class="op" id="3340098">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340102"><a href="/net/http/filetransport.go.html#3339944">pr</a></span><span class="op" id="3340104">.</span><span class="ident" id="3340105">sendResponse</span><span class="op" id="3340117">(</span><span class="op" id="3340118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340124">return</span>&nbsp;<span class="ident" id="3340131"><a href="/net/http/filetransport.go.html#3339944">pr</a></span><span class="op" id="3340133">.</span><span class="ident" id="3340134">pw</span><span class="op" id="3340136">.</span><span class="ident" id="3340137">Write</span><span class="op" id="3340142">(</span><span class="ident" id="3340143"><a href="/net/http/filetransport.go.html#3339972">p</a></span><span class="op" id="3340144">)</span><br>
<span class="lineno"></span><span class="op" id="3340146">}</span>
</div>
</body>
</html>
