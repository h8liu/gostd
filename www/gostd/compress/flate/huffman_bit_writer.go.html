<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2991712">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2991767">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2991821">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2991872">package</span>&nbsp;<span class="ident" id="2991880">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2991887">import</span>&nbsp;<span class="op" id="2991894">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2991897">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2991903">&#34;math&#34;</span><br>
<span class="lineno">10</span><span class="op" id="2991910">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2991913">const</span>&nbsp;<span class="op" id="2991919">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2991922">//&nbsp;The&nbsp;largest&nbsp;offset&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991951">offsetCodeCount</span>&nbsp;<span class="op" id="2991967">=</span>&nbsp;<span class="num" id="2991969">30</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2991974">//&nbsp;The&nbsp;special&nbsp;code&nbsp;used&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992028">endBlockMarker</span>&nbsp;<span class="op" id="2992043">=</span>&nbsp;<span class="num" id="2992045">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2992051">//&nbsp;The&nbsp;first&nbsp;length&nbsp;code.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992078">lengthCodesStart</span>&nbsp;<span class="op" id="2992095">=</span>&nbsp;<span class="num" id="2992097">257</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2992103">//&nbsp;The&nbsp;number&nbsp;of&nbsp;codegen&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992136">codegenCodeCount</span>&nbsp;<span class="op" id="2992153">=</span>&nbsp;<span class="num" id="2992155">19</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992159">badCode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992176">=</span>&nbsp;<span class="num" id="2992178">255</span><br>
<span class="lineno">25</span><span class="op" id="2992182">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2992185">//&nbsp;The&nbsp;number&nbsp;of&nbsp;extra&nbsp;bits&nbsp;needed&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="2992259">var</span>&nbsp;<span class="ident" id="2992263">lengthExtraBits</span>&nbsp;<span class="op" id="2992279">=</span>&nbsp;<span class="op" id="2992281">[</span><span class="op" id="2992282">]</span><span class="builtintype" id="2992283">int8</span><span class="op" id="2992287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2992290">/*&nbsp;257&nbsp;*/</span>&nbsp;<span class="num" id="2992300">0</span><span class="op" id="2992301">,</span>&nbsp;<span class="num" id="2992303">0</span><span class="op" id="2992304">,</span>&nbsp;<span class="num" id="2992306">0</span><span class="op" id="2992307">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2992310">/*&nbsp;260&nbsp;*/</span>&nbsp;<span class="num" id="2992320">0</span><span class="op" id="2992321">,</span>&nbsp;<span class="num" id="2992323">0</span><span class="op" id="2992324">,</span>&nbsp;<span class="num" id="2992326">0</span><span class="op" id="2992327">,</span>&nbsp;<span class="num" id="2992329">0</span><span class="op" id="2992330">,</span>&nbsp;<span class="num" id="2992332">0</span><span class="op" id="2992333">,</span>&nbsp;<span class="num" id="2992335">1</span><span class="op" id="2992336">,</span>&nbsp;<span class="num" id="2992338">1</span><span class="op" id="2992339">,</span>&nbsp;<span class="num" id="2992341">1</span><span class="op" id="2992342">,</span>&nbsp;<span class="num" id="2992344">1</span><span class="op" id="2992345">,</span>&nbsp;<span class="num" id="2992347">2</span><span class="op" id="2992348">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2992351">/*&nbsp;270&nbsp;*/</span>&nbsp;<span class="num" id="2992361">2</span><span class="op" id="2992362">,</span>&nbsp;<span class="num" id="2992364">2</span><span class="op" id="2992365">,</span>&nbsp;<span class="num" id="2992367">2</span><span class="op" id="2992368">,</span>&nbsp;<span class="num" id="2992370">3</span><span class="op" id="2992371">,</span>&nbsp;<span class="num" id="2992373">3</span><span class="op" id="2992374">,</span>&nbsp;<span class="num" id="2992376">3</span><span class="op" id="2992377">,</span>&nbsp;<span class="num" id="2992379">3</span><span class="op" id="2992380">,</span>&nbsp;<span class="num" id="2992382">4</span><span class="op" id="2992383">,</span>&nbsp;<span class="num" id="2992385">4</span><span class="op" id="2992386">,</span>&nbsp;<span class="num" id="2992388">4</span><span class="op" id="2992389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2992392">/*&nbsp;280&nbsp;*/</span>&nbsp;<span class="num" id="2992402">4</span><span class="op" id="2992403">,</span>&nbsp;<span class="num" id="2992405">5</span><span class="op" id="2992406">,</span>&nbsp;<span class="num" id="2992408">5</span><span class="op" id="2992409">,</span>&nbsp;<span class="num" id="2992411">5</span><span class="op" id="2992412">,</span>&nbsp;<span class="num" id="2992414">5</span><span class="op" id="2992415">,</span>&nbsp;<span class="num" id="2992417">0</span><span class="op" id="2992418">,</span><br>
<span class="lineno"></span><span class="op" id="2992420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="2992423">//&nbsp;The&nbsp;length&nbsp;indicated&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="2992486">var</span>&nbsp;<span class="ident" id="2992490">lengthBase</span>&nbsp;<span class="op" id="2992501">=</span>&nbsp;<span class="op" id="2992503">[</span><span class="op" id="2992504">]</span><span class="builtintype" id="2992505">uint32</span><span class="op" id="2992511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2992514">0</span><span class="op" id="2992515">,</span>&nbsp;<span class="num" id="2992517">1</span><span class="op" id="2992518">,</span>&nbsp;<span class="num" id="2992520">2</span><span class="op" id="2992521">,</span>&nbsp;<span class="num" id="2992523">3</span><span class="op" id="2992524">,</span>&nbsp;<span class="num" id="2992526">4</span><span class="op" id="2992527">,</span>&nbsp;<span class="num" id="2992529">5</span><span class="op" id="2992530">,</span>&nbsp;<span class="num" id="2992532">6</span><span class="op" id="2992533">,</span>&nbsp;<span class="num" id="2992535">7</span><span class="op" id="2992536">,</span>&nbsp;<span class="num" id="2992538">8</span><span class="op" id="2992539">,</span>&nbsp;<span class="num" id="2992541">10</span><span class="op" id="2992543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2992546">12</span><span class="op" id="2992548">,</span>&nbsp;<span class="num" id="2992550">14</span><span class="op" id="2992552">,</span>&nbsp;<span class="num" id="2992554">16</span><span class="op" id="2992556">,</span>&nbsp;<span class="num" id="2992558">20</span><span class="op" id="2992560">,</span>&nbsp;<span class="num" id="2992562">24</span><span class="op" id="2992564">,</span>&nbsp;<span class="num" id="2992566">28</span><span class="op" id="2992568">,</span>&nbsp;<span class="num" id="2992570">32</span><span class="op" id="2992572">,</span>&nbsp;<span class="num" id="2992574">40</span><span class="op" id="2992576">,</span>&nbsp;<span class="num" id="2992578">48</span><span class="op" id="2992580">,</span>&nbsp;<span class="num" id="2992582">56</span><span class="op" id="2992584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2992587">64</span><span class="op" id="2992589">,</span>&nbsp;<span class="num" id="2992591">80</span><span class="op" id="2992593">,</span>&nbsp;<span class="num" id="2992595">96</span><span class="op" id="2992597">,</span>&nbsp;<span class="num" id="2992599">112</span><span class="op" id="2992602">,</span>&nbsp;<span class="num" id="2992604">128</span><span class="op" id="2992607">,</span>&nbsp;<span class="num" id="2992609">160</span><span class="op" id="2992612">,</span>&nbsp;<span class="num" id="2992614">192</span><span class="op" id="2992617">,</span>&nbsp;<span class="num" id="2992619">224</span><span class="op" id="2992622">,</span>&nbsp;<span class="num" id="2992624">255</span><span class="op" id="2992627">,</span><br>
<span class="lineno">40</span><span class="op" id="2992629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2992632">//&nbsp;offset&nbsp;code&nbsp;word&nbsp;extra&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="2992664">var</span>&nbsp;<span class="ident" id="2992668">offsetExtraBits</span>&nbsp;<span class="op" id="2992684">=</span>&nbsp;<span class="op" id="2992686">[</span><span class="op" id="2992687">]</span><span class="builtintype" id="2992688">int8</span><span class="op" id="2992692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2992695">0</span><span class="op" id="2992696">,</span>&nbsp;<span class="num" id="2992698">0</span><span class="op" id="2992699">,</span>&nbsp;<span class="num" id="2992701">0</span><span class="op" id="2992702">,</span>&nbsp;<span class="num" id="2992704">0</span><span class="op" id="2992705">,</span>&nbsp;<span class="num" id="2992707">1</span><span class="op" id="2992708">,</span>&nbsp;<span class="num" id="2992710">1</span><span class="op" id="2992711">,</span>&nbsp;<span class="num" id="2992713">2</span><span class="op" id="2992714">,</span>&nbsp;<span class="num" id="2992716">2</span><span class="op" id="2992717">,</span>&nbsp;<span class="num" id="2992719">3</span><span class="op" id="2992720">,</span>&nbsp;<span class="num" id="2992722">3</span><span class="op" id="2992723">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2992726">4</span><span class="op" id="2992727">,</span>&nbsp;<span class="num" id="2992729">4</span><span class="op" id="2992730">,</span>&nbsp;<span class="num" id="2992732">5</span><span class="op" id="2992733">,</span>&nbsp;<span class="num" id="2992735">5</span><span class="op" id="2992736">,</span>&nbsp;<span class="num" id="2992738">6</span><span class="op" id="2992739">,</span>&nbsp;<span class="num" id="2992741">6</span><span class="op" id="2992742">,</span>&nbsp;<span class="num" id="2992744">7</span><span class="op" id="2992745">,</span>&nbsp;<span class="num" id="2992747">7</span><span class="op" id="2992748">,</span>&nbsp;<span class="num" id="2992750">8</span><span class="op" id="2992751">,</span>&nbsp;<span class="num" id="2992753">8</span><span class="op" id="2992754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2992757">9</span><span class="op" id="2992758">,</span>&nbsp;<span class="num" id="2992760">9</span><span class="op" id="2992761">,</span>&nbsp;<span class="num" id="2992763">10</span><span class="op" id="2992765">,</span>&nbsp;<span class="num" id="2992767">10</span><span class="op" id="2992769">,</span>&nbsp;<span class="num" id="2992771">11</span><span class="op" id="2992773">,</span>&nbsp;<span class="num" id="2992775">11</span><span class="op" id="2992777">,</span>&nbsp;<span class="num" id="2992779">12</span><span class="op" id="2992781">,</span>&nbsp;<span class="num" id="2992783">12</span><span class="op" id="2992785">,</span>&nbsp;<span class="num" id="2992787">13</span><span class="op" id="2992789">,</span>&nbsp;<span class="num" id="2992791">13</span><span class="op" id="2992793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2992796">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2992819">14</span><span class="op" id="2992821">,</span>&nbsp;<span class="num" id="2992823">14</span><span class="op" id="2992825">,</span>&nbsp;<span class="num" id="2992827">15</span><span class="op" id="2992829">,</span>&nbsp;<span class="num" id="2992831">15</span><span class="op" id="2992833">,</span>&nbsp;<span class="num" id="2992835">16</span><span class="op" id="2992837">,</span>&nbsp;<span class="num" id="2992839">16</span><span class="op" id="2992841">,</span>&nbsp;<span class="num" id="2992843">17</span><span class="op" id="2992845">,</span>&nbsp;<span class="num" id="2992847">17</span><span class="op" id="2992849">,</span>&nbsp;<span class="num" id="2992851">18</span><span class="op" id="2992853">,</span>&nbsp;<span class="num" id="2992855">18</span><span class="op" id="2992857">,</span>&nbsp;<span class="num" id="2992859">19</span><span class="op" id="2992861">,</span>&nbsp;<span class="num" id="2992863">19</span><span class="op" id="2992865">,</span>&nbsp;<span class="num" id="2992867">20</span><span class="op" id="2992869">,</span>&nbsp;<span class="num" id="2992871">20</span><span class="op" id="2992873">,</span><br>
<span class="lineno"></span><span class="op" id="2992875">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="2992878">var</span>&nbsp;<span class="ident" id="2992882">offsetBase</span>&nbsp;<span class="op" id="2992893">=</span>&nbsp;<span class="op" id="2992895">[</span><span class="op" id="2992896">]</span><span class="builtintype" id="2992897">uint32</span><span class="op" id="2992903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2992906">/*&nbsp;normal&nbsp;deflate&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2992928">0x000000</span><span class="op" id="2992936">,</span>&nbsp;<span class="num" id="2992938">0x000001</span><span class="op" id="2992946">,</span>&nbsp;<span class="num" id="2992948">0x000002</span><span class="op" id="2992956">,</span>&nbsp;<span class="num" id="2992958">0x000003</span><span class="op" id="2992966">,</span>&nbsp;<span class="num" id="2992968">0x000004</span><span class="op" id="2992976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2992979">0x000006</span><span class="op" id="2992987">,</span>&nbsp;<span class="num" id="2992989">0x000008</span><span class="op" id="2992997">,</span>&nbsp;<span class="num" id="2992999">0x00000c</span><span class="op" id="2993007">,</span>&nbsp;<span class="num" id="2993009">0x000010</span><span class="op" id="2993017">,</span>&nbsp;<span class="num" id="2993019">0x000018</span><span class="op" id="2993027">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2993030">0x000020</span><span class="op" id="2993038">,</span>&nbsp;<span class="num" id="2993040">0x000030</span><span class="op" id="2993048">,</span>&nbsp;<span class="num" id="2993050">0x000040</span><span class="op" id="2993058">,</span>&nbsp;<span class="num" id="2993060">0x000060</span><span class="op" id="2993068">,</span>&nbsp;<span class="num" id="2993070">0x000080</span><span class="op" id="2993078">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2993081">0x0000c0</span><span class="op" id="2993089">,</span>&nbsp;<span class="num" id="2993091">0x000100</span><span class="op" id="2993099">,</span>&nbsp;<span class="num" id="2993101">0x000180</span><span class="op" id="2993109">,</span>&nbsp;<span class="num" id="2993111">0x000200</span><span class="op" id="2993119">,</span>&nbsp;<span class="num" id="2993121">0x000300</span><span class="op" id="2993129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2993132">0x000400</span><span class="op" id="2993140">,</span>&nbsp;<span class="num" id="2993142">0x000600</span><span class="op" id="2993150">,</span>&nbsp;<span class="num" id="2993152">0x000800</span><span class="op" id="2993160">,</span>&nbsp;<span class="num" id="2993162">0x000c00</span><span class="op" id="2993170">,</span>&nbsp;<span class="num" id="2993172">0x001000</span><span class="op" id="2993180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2993183">0x001800</span><span class="op" id="2993191">,</span>&nbsp;<span class="num" id="2993193">0x002000</span><span class="op" id="2993201">,</span>&nbsp;<span class="num" id="2993203">0x003000</span><span class="op" id="2993211">,</span>&nbsp;<span class="num" id="2993213">0x004000</span><span class="op" id="2993221">,</span>&nbsp;<span class="num" id="2993223">0x006000</span><span class="op" id="2993231">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2993235">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2993258">0x008000</span><span class="op" id="2993266">,</span>&nbsp;<span class="num" id="2993268">0x00c000</span><span class="op" id="2993276">,</span>&nbsp;<span class="num" id="2993278">0x010000</span><span class="op" id="2993286">,</span>&nbsp;<span class="num" id="2993288">0x018000</span><span class="op" id="2993296">,</span>&nbsp;<span class="num" id="2993298">0x020000</span><span class="op" id="2993306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2993309">0x030000</span><span class="op" id="2993317">,</span>&nbsp;<span class="num" id="2993319">0x040000</span><span class="op" id="2993327">,</span>&nbsp;<span class="num" id="2993329">0x060000</span><span class="op" id="2993337">,</span>&nbsp;<span class="num" id="2993339">0x080000</span><span class="op" id="2993347">,</span>&nbsp;<span class="num" id="2993349">0x0c0000</span><span class="op" id="2993357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2993360">0x100000</span><span class="op" id="2993368">,</span>&nbsp;<span class="num" id="2993370">0x180000</span><span class="op" id="2993378">,</span>&nbsp;<span class="num" id="2993380">0x200000</span><span class="op" id="2993388">,</span>&nbsp;<span class="num" id="2993390">0x300000</span><span class="op" id="2993398">,</span><br>
<span class="lineno"></span><span class="op" id="2993400">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="2993403">//&nbsp;The&nbsp;odd&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;codegen&nbsp;code&nbsp;sizes&nbsp;are&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="2993465">var</span>&nbsp;<span class="ident" id="2993469">codegenOrder</span>&nbsp;<span class="op" id="2993482">=</span>&nbsp;<span class="op" id="2993484">[</span><span class="op" id="2993485">]</span><span class="builtintype" id="2993486">uint32</span><span class="op" id="2993492">{</span><span class="num" id="2993493">16</span><span class="op" id="2993495">,</span>&nbsp;<span class="num" id="2993497">17</span><span class="op" id="2993499">,</span>&nbsp;<span class="num" id="2993501">18</span><span class="op" id="2993503">,</span>&nbsp;<span class="num" id="2993505">0</span><span class="op" id="2993506">,</span>&nbsp;<span class="num" id="2993508">8</span><span class="op" id="2993509">,</span>&nbsp;<span class="num" id="2993511">7</span><span class="op" id="2993512">,</span>&nbsp;<span class="num" id="2993514">9</span><span class="op" id="2993515">,</span>&nbsp;<span class="num" id="2993517">6</span><span class="op" id="2993518">,</span>&nbsp;<span class="num" id="2993520">10</span><span class="op" id="2993522">,</span>&nbsp;<span class="num" id="2993524">5</span><span class="op" id="2993525">,</span>&nbsp;<span class="num" id="2993527">11</span><span class="op" id="2993529">,</span>&nbsp;<span class="num" id="2993531">4</span><span class="op" id="2993532">,</span>&nbsp;<span class="num" id="2993534">12</span><span class="op" id="2993536">,</span>&nbsp;<span class="num" id="2993538">3</span><span class="op" id="2993539">,</span>&nbsp;<span class="num" id="2993541">13</span><span class="op" id="2993543">,</span>&nbsp;<span class="num" id="2993545">2</span><span class="op" id="2993546">,</span>&nbsp;<span class="num" id="2993548">14</span><span class="op" id="2993550">,</span>&nbsp;<span class="num" id="2993552">1</span><span class="op" id="2993553">,</span>&nbsp;<span class="num" id="2993555">15</span><span class="op" id="2993557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2993560">type</span>&nbsp;<span class="ident" id="2993565">huffmanBitWriter</span>&nbsp;<span class="keyword" id="2993582">struct</span>&nbsp;<span class="op" id="2993589">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993592">w</span>&nbsp;<span class="ident" id="2993594">io</span><span class="op" id="2993596">.</span><span class="ident" id="2993597">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2993605">//&nbsp;Data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;written&nbsp;is&nbsp;bytes[0:nbytes]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2993655">//&nbsp;and&nbsp;then&nbsp;the&nbsp;low&nbsp;nbits&nbsp;of&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993691">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2993707">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993715">nbits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2993731">uint32</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993739">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993755">[</span><span class="num" id="2993756">64</span><span class="op" id="2993758">]</span><span class="builtintype" id="2993759">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993765">nbytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2993781">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993786">literalFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993802">[</span><span class="op" id="2993803">]</span><span class="builtintype" id="2993804">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993811">offsetFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993827">[</span><span class="op" id="2993828">]</span><span class="builtintype" id="2993829">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993836">codegen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993852">[</span><span class="op" id="2993853">]</span><span class="builtintype" id="2993854">uint8</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993861">codegenFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993877">[</span><span class="op" id="2993878">]</span><span class="builtintype" id="2993879">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993886">literalEncoding</span>&nbsp;<span class="op" id="2993902">*</span><span class="ident" id="2993903">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993919">offsetEncoding</span>&nbsp;&nbsp;<span class="op" id="2993935">*</span><span class="ident" id="2993936">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993952">codegenEncoding</span>&nbsp;<span class="op" id="2993968">*</span><span class="ident" id="2993969">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993985">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2994001">error</span><br>
<span class="lineno">85</span><span class="op" id="2994007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2994010">func</span>&nbsp;<span class="ident" id="2994015">newHuffmanBitWriter</span><span class="op" id="2994034">(</span><span class="ident" id="2994035">w</span>&nbsp;<span class="ident" id="2994037">io</span><span class="op" id="2994039">.</span><span class="ident" id="2994040">Writer</span><span class="op" id="2994046">)</span>&nbsp;<span class="op" id="2994048">*</span><span class="ident" id="2994049">huffmanBitWriter</span>&nbsp;<span class="op" id="2994066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994069">return</span>&nbsp;<span class="op" id="2994076">&amp;</span><span class="ident" id="2994077">huffmanBitWriter</span><span class="op" id="2994093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994097">w</span><span class="op" id="2994098">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994114">w</span><span class="op" id="2994115">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994119">literalFreq</span><span class="op" id="2994130">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2994136">make</span><span class="op" id="2994140">(</span><span class="op" id="2994141">[</span><span class="op" id="2994142">]</span><span class="builtintype" id="2994143">int32</span><span class="op" id="2994148">,</span>&nbsp;<span class="ident" id="2994150">maxLit</span><span class="op" id="2994156">)</span><span class="op" id="2994157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994161">offsetFreq</span><span class="op" id="2994171">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2994178">make</span><span class="op" id="2994182">(</span><span class="op" id="2994183">[</span><span class="op" id="2994184">]</span><span class="builtintype" id="2994185">int32</span><span class="op" id="2994190">,</span>&nbsp;<span class="ident" id="2994192">offsetCodeCount</span><span class="op" id="2994207">)</span><span class="op" id="2994208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994212">codegen</span><span class="op" id="2994219">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2994229">make</span><span class="op" id="2994233">(</span><span class="op" id="2994234">[</span><span class="op" id="2994235">]</span><span class="builtintype" id="2994236">uint8</span><span class="op" id="2994241">,</span>&nbsp;<span class="ident" id="2994243">maxLit</span><span class="op" id="2994249">+</span><span class="ident" id="2994250">offsetCodeCount</span><span class="op" id="2994265">+</span><span class="num" id="2994266">1</span><span class="op" id="2994267">)</span><span class="op" id="2994268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994272">codegenFreq</span><span class="op" id="2994283">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2994289">make</span><span class="op" id="2994293">(</span><span class="op" id="2994294">[</span><span class="op" id="2994295">]</span><span class="builtintype" id="2994296">int32</span><span class="op" id="2994301">,</span>&nbsp;<span class="ident" id="2994303">codegenCodeCount</span><span class="op" id="2994319">)</span><span class="op" id="2994320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994324">literalEncoding</span><span class="op" id="2994339">:</span>&nbsp;<span class="ident" id="2994341">newHuffmanEncoder</span><span class="op" id="2994358">(</span><span class="ident" id="2994359">maxLit</span><span class="op" id="2994365">)</span><span class="op" id="2994366">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994370">offsetEncoding</span><span class="op" id="2994384">:</span>&nbsp;&nbsp;<span class="ident" id="2994387">newHuffmanEncoder</span><span class="op" id="2994404">(</span><span class="ident" id="2994405">offsetCodeCount</span><span class="op" id="2994420">)</span><span class="op" id="2994421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994425">codegenEncoding</span><span class="op" id="2994440">:</span>&nbsp;<span class="ident" id="2994442">newHuffmanEncoder</span><span class="op" id="2994459">(</span><span class="ident" id="2994460">codegenCodeCount</span><span class="op" id="2994476">)</span><span class="op" id="2994477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2994480">}</span><br>
<span class="lineno"></span><span class="op" id="2994482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="2994485">func</span>&nbsp;<span class="op" id="2994490">(</span><span class="ident" id="2994491">w</span>&nbsp;<span class="op" id="2994493">*</span><span class="ident" id="2994494">huffmanBitWriter</span><span class="op" id="2994510">)</span>&nbsp;<span class="ident" id="2994512">reset</span><span class="op" id="2994517">(</span><span class="ident" id="2994518">writer</span>&nbsp;<span class="ident" id="2994525">io</span><span class="op" id="2994527">.</span><span class="ident" id="2994528">Writer</span><span class="op" id="2994534">)</span>&nbsp;<span class="op" id="2994536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994539">w</span><span class="op" id="2994540">.</span><span class="ident" id="2994541">w</span>&nbsp;<span class="op" id="2994543">=</span>&nbsp;<span class="ident" id="2994545">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994553">w</span><span class="op" id="2994554">.</span><span class="ident" id="2994555">bits</span><span class="op" id="2994559">,</span>&nbsp;<span class="ident" id="2994561">w</span><span class="op" id="2994562">.</span><span class="ident" id="2994563">nbits</span><span class="op" id="2994568">,</span>&nbsp;<span class="ident" id="2994570">w</span><span class="op" id="2994571">.</span><span class="ident" id="2994572">nbytes</span><span class="op" id="2994578">,</span>&nbsp;<span class="ident" id="2994580">w</span><span class="op" id="2994581">.</span><span class="ident" id="2994582">err</span>&nbsp;<span class="op" id="2994586">=</span>&nbsp;<span class="num" id="2994588">0</span><span class="op" id="2994589">,</span>&nbsp;<span class="num" id="2994591">0</span><span class="op" id="2994592">,</span>&nbsp;<span class="num" id="2994594">0</span><span class="op" id="2994595">,</span>&nbsp;<span class="ident" id="2994597">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994602">w</span><span class="op" id="2994603">.</span><span class="ident" id="2994604">bytes</span>&nbsp;<span class="op" id="2994610">=</span>&nbsp;<span class="op" id="2994612">[</span><span class="num" id="2994613">64</span><span class="op" id="2994615">]</span><span class="builtintype" id="2994616">byte</span><span class="op" id="2994620">{</span><span class="op" id="2994621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994624">for</span>&nbsp;<span class="ident" id="2994628">i</span>&nbsp;<span class="op" id="2994630">:=</span>&nbsp;<span class="keyword" id="2994633">range</span>&nbsp;<span class="ident" id="2994639">w</span><span class="op" id="2994640">.</span><span class="ident" id="2994641">codegen</span>&nbsp;<span class="op" id="2994649">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994653">w</span><span class="op" id="2994654">.</span><span class="ident" id="2994655">codegen</span><span class="op" id="2994662">[</span><span class="ident" id="2994663">i</span><span class="op" id="2994664">]</span>&nbsp;<span class="op" id="2994666">=</span>&nbsp;<span class="num" id="2994668">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2994671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994674">for</span>&nbsp;<span class="ident" id="2994678">_</span><span class="op" id="2994679">,</span>&nbsp;<span class="ident" id="2994681">s</span>&nbsp;<span class="op" id="2994683">:=</span>&nbsp;<span class="keyword" id="2994686">range</span>&nbsp;<span class="op" id="2994692">[</span><span class="op" id="2994693">...</span><span class="op" id="2994696">]</span><span class="op" id="2994697">[</span><span class="op" id="2994698">]</span><span class="builtintype" id="2994699">int32</span><span class="op" id="2994704">{</span><span class="ident" id="2994705">w</span><span class="op" id="2994706">.</span><span class="ident" id="2994707">literalFreq</span><span class="op" id="2994718">,</span>&nbsp;<span class="ident" id="2994720">w</span><span class="op" id="2994721">.</span><span class="ident" id="2994722">offsetFreq</span><span class="op" id="2994732">,</span>&nbsp;<span class="ident" id="2994734">w</span><span class="op" id="2994735">.</span><span class="ident" id="2994736">codegenFreq</span><span class="op" id="2994747">}</span>&nbsp;<span class="op" id="2994749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994753">for</span>&nbsp;<span class="ident" id="2994757">i</span>&nbsp;<span class="op" id="2994759">:=</span>&nbsp;<span class="keyword" id="2994762">range</span>&nbsp;<span class="ident" id="2994768">s</span>&nbsp;<span class="op" id="2994770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994775">s</span><span class="op" id="2994776">[</span><span class="ident" id="2994777">i</span><span class="op" id="2994778">]</span>&nbsp;<span class="op" id="2994780">=</span>&nbsp;<span class="num" id="2994782">0</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2994786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2994789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994792">for</span>&nbsp;<span class="ident" id="2994796">_</span><span class="op" id="2994797">,</span>&nbsp;<span class="ident" id="2994799">enc</span>&nbsp;<span class="op" id="2994803">:=</span>&nbsp;<span class="keyword" id="2994806">range</span>&nbsp;<span class="op" id="2994812">[</span><span class="op" id="2994813">...</span><span class="op" id="2994816">]</span><span class="op" id="2994817">*</span><span class="ident" id="2994818">huffmanEncoder</span><span class="op" id="2994832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994836">w</span><span class="op" id="2994837">.</span><span class="ident" id="2994838">literalEncoding</span><span class="op" id="2994853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994857">w</span><span class="op" id="2994858">.</span><span class="ident" id="2994859">offsetEncoding</span><span class="op" id="2994873">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994877">w</span><span class="op" id="2994878">.</span><span class="ident" id="2994879">codegenEncoding</span><span class="op" id="2994894">}</span>&nbsp;<span class="op" id="2994896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994900">for</span>&nbsp;<span class="ident" id="2994904">i</span>&nbsp;<span class="op" id="2994906">:=</span>&nbsp;<span class="keyword" id="2994909">range</span>&nbsp;<span class="ident" id="2994915">enc</span><span class="op" id="2994918">.</span><span class="ident" id="2994919">code</span>&nbsp;<span class="op" id="2994924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994929">enc</span><span class="op" id="2994932">.</span><span class="ident" id="2994933">code</span><span class="op" id="2994937">[</span><span class="ident" id="2994938">i</span><span class="op" id="2994939">]</span>&nbsp;<span class="op" id="2994941">=</span>&nbsp;<span class="num" id="2994943">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2994947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994951">for</span>&nbsp;<span class="ident" id="2994955">i</span>&nbsp;<span class="op" id="2994957">:=</span>&nbsp;<span class="keyword" id="2994960">range</span>&nbsp;<span class="ident" id="2994966">enc</span><span class="op" id="2994969">.</span><span class="ident" id="2994970">codeBits</span>&nbsp;<span class="op" id="2994979">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994984">enc</span><span class="op" id="2994987">.</span><span class="ident" id="2994988">codeBits</span><span class="op" id="2994996">[</span><span class="ident" id="2994997">i</span><span class="op" id="2994998">]</span>&nbsp;<span class="op" id="2995000">=</span>&nbsp;<span class="num" id="2995002">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2995006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2995009">}</span><br>
<span class="lineno"></span><span class="op" id="2995011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2995014">func</span>&nbsp;<span class="op" id="2995019">(</span><span class="ident" id="2995020">w</span>&nbsp;<span class="op" id="2995022">*</span><span class="ident" id="2995023">huffmanBitWriter</span><span class="op" id="2995039">)</span>&nbsp;<span class="ident" id="2995041">flushBits</span><span class="op" id="2995050">(</span><span class="op" id="2995051">)</span>&nbsp;<span class="op" id="2995053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995056">if</span>&nbsp;<span class="ident" id="2995059">w</span><span class="op" id="2995060">.</span><span class="ident" id="2995061">err</span>&nbsp;<span class="op" id="2995065">!=</span>&nbsp;<span class="ident" id="2995068">nil</span>&nbsp;<span class="op" id="2995072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995076">w</span><span class="op" id="2995077">.</span><span class="ident" id="2995078">nbits</span>&nbsp;<span class="op" id="2995084">=</span>&nbsp;<span class="num" id="2995086">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995090">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2995098">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995101">bits</span>&nbsp;<span class="op" id="2995106">:=</span>&nbsp;<span class="ident" id="2995109">w</span><span class="op" id="2995110">.</span><span class="ident" id="2995111">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995117">w</span><span class="op" id="2995118">.</span><span class="ident" id="2995119">bits</span>&nbsp;<span class="op" id="2995124">&gt;&gt;=</span>&nbsp;<span class="num" id="2995128">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995132">w</span><span class="op" id="2995133">.</span><span class="ident" id="2995134">nbits</span>&nbsp;<span class="op" id="2995140">-=</span>&nbsp;<span class="num" id="2995143">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995147">n</span>&nbsp;<span class="op" id="2995149">:=</span>&nbsp;<span class="ident" id="2995152">w</span><span class="op" id="2995153">.</span><span class="ident" id="2995154">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995162">w</span><span class="op" id="2995163">.</span><span class="ident" id="2995164">bytes</span><span class="op" id="2995169">[</span><span class="ident" id="2995170">n</span><span class="op" id="2995171">]</span>&nbsp;<span class="op" id="2995173">=</span>&nbsp;<span class="builtintype" id="2995175">byte</span><span class="op" id="2995179">(</span><span class="ident" id="2995180">bits</span><span class="op" id="2995184">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995187">w</span><span class="op" id="2995188">.</span><span class="ident" id="2995189">bytes</span><span class="op" id="2995194">[</span><span class="ident" id="2995195">n</span><span class="op" id="2995196">+</span><span class="num" id="2995197">1</span><span class="op" id="2995198">]</span>&nbsp;<span class="op" id="2995200">=</span>&nbsp;<span class="builtintype" id="2995202">byte</span><span class="op" id="2995206">(</span><span class="ident" id="2995207">bits</span>&nbsp;<span class="op" id="2995212">&gt;&gt;</span>&nbsp;<span class="num" id="2995215">8</span><span class="op" id="2995216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995219">if</span>&nbsp;<span class="ident" id="2995222">n</span>&nbsp;<span class="op" id="2995224">+=</span>&nbsp;<span class="num" id="2995227">2</span><span class="op" id="2995228">;</span>&nbsp;<span class="ident" id="2995230">n</span>&nbsp;<span class="op" id="2995232">&gt;=</span>&nbsp;<span class="builtinfunc" id="2995235">len</span><span class="op" id="2995238">(</span><span class="ident" id="2995239">w</span><span class="op" id="2995240">.</span><span class="ident" id="2995241">bytes</span><span class="op" id="2995246">)</span>&nbsp;<span class="op" id="2995248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995252">_</span><span class="op" id="2995253">,</span>&nbsp;<span class="ident" id="2995255">w</span><span class="op" id="2995256">.</span><span class="ident" id="2995257">err</span>&nbsp;<span class="op" id="2995261">=</span>&nbsp;<span class="ident" id="2995263">w</span><span class="op" id="2995264">.</span><span class="ident" id="2995265">w</span><span class="op" id="2995266">.</span><span class="ident" id="2995267">Write</span><span class="op" id="2995272">(</span><span class="ident" id="2995273">w</span><span class="op" id="2995274">.</span><span class="ident" id="2995275">bytes</span><span class="op" id="2995280">[</span><span class="num" id="2995281">0</span><span class="op" id="2995282">:</span><span class="op" id="2995283">]</span><span class="op" id="2995284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995288">n</span>&nbsp;<span class="op" id="2995290">=</span>&nbsp;<span class="num" id="2995292">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2995295">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995298">w</span><span class="op" id="2995299">.</span><span class="ident" id="2995300">nbytes</span>&nbsp;<span class="op" id="2995307">=</span>&nbsp;<span class="ident" id="2995309">n</span><br>
<span class="lineno"></span><span class="op" id="2995311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2995314">func</span>&nbsp;<span class="op" id="2995319">(</span><span class="ident" id="2995320">w</span>&nbsp;<span class="op" id="2995322">*</span><span class="ident" id="2995323">huffmanBitWriter</span><span class="op" id="2995339">)</span>&nbsp;<span class="ident" id="2995341">flush</span><span class="op" id="2995346">(</span><span class="op" id="2995347">)</span>&nbsp;<span class="op" id="2995349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995352">if</span>&nbsp;<span class="ident" id="2995355">w</span><span class="op" id="2995356">.</span><span class="ident" id="2995357">err</span>&nbsp;<span class="op" id="2995361">!=</span>&nbsp;<span class="ident" id="2995364">nil</span>&nbsp;<span class="op" id="2995368">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995372">w</span><span class="op" id="2995373">.</span><span class="ident" id="2995374">nbits</span>&nbsp;<span class="op" id="2995380">=</span>&nbsp;<span class="num" id="2995382">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995386">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2995394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995397">n</span>&nbsp;<span class="op" id="2995399">:=</span>&nbsp;<span class="ident" id="2995402">w</span><span class="op" id="2995403">.</span><span class="ident" id="2995404">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995412">if</span>&nbsp;<span class="ident" id="2995415">w</span><span class="op" id="2995416">.</span><span class="ident" id="2995417">nbits</span>&nbsp;<span class="op" id="2995423">&gt;</span>&nbsp;<span class="num" id="2995425">8</span>&nbsp;<span class="op" id="2995427">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995431">w</span><span class="op" id="2995432">.</span><span class="ident" id="2995433">bytes</span><span class="op" id="2995438">[</span><span class="ident" id="2995439">n</span><span class="op" id="2995440">]</span>&nbsp;<span class="op" id="2995442">=</span>&nbsp;<span class="builtintype" id="2995444">byte</span><span class="op" id="2995448">(</span><span class="ident" id="2995449">w</span><span class="op" id="2995450">.</span><span class="ident" id="2995451">bits</span><span class="op" id="2995455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995459">w</span><span class="op" id="2995460">.</span><span class="ident" id="2995461">bits</span>&nbsp;<span class="op" id="2995466">&gt;&gt;=</span>&nbsp;<span class="num" id="2995470">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995474">w</span><span class="op" id="2995475">.</span><span class="ident" id="2995476">nbits</span>&nbsp;<span class="op" id="2995482">-=</span>&nbsp;<span class="num" id="2995485">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995489">n</span><span class="op" id="2995490">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2995494">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995497">if</span>&nbsp;<span class="ident" id="2995500">w</span><span class="op" id="2995501">.</span><span class="ident" id="2995502">nbits</span>&nbsp;<span class="op" id="2995508">&gt;</span>&nbsp;<span class="num" id="2995510">0</span>&nbsp;<span class="op" id="2995512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995516">w</span><span class="op" id="2995517">.</span><span class="ident" id="2995518">bytes</span><span class="op" id="2995523">[</span><span class="ident" id="2995524">n</span><span class="op" id="2995525">]</span>&nbsp;<span class="op" id="2995527">=</span>&nbsp;<span class="builtintype" id="2995529">byte</span><span class="op" id="2995533">(</span><span class="ident" id="2995534">w</span><span class="op" id="2995535">.</span><span class="ident" id="2995536">bits</span><span class="op" id="2995540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995544">w</span><span class="op" id="2995545">.</span><span class="ident" id="2995546">nbits</span>&nbsp;<span class="op" id="2995552">=</span>&nbsp;<span class="num" id="2995554">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995558">n</span><span class="op" id="2995559">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2995563">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995566">w</span><span class="op" id="2995567">.</span><span class="ident" id="2995568">bits</span>&nbsp;<span class="op" id="2995573">=</span>&nbsp;<span class="num" id="2995575">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995578">_</span><span class="op" id="2995579">,</span>&nbsp;<span class="ident" id="2995581">w</span><span class="op" id="2995582">.</span><span class="ident" id="2995583">err</span>&nbsp;<span class="op" id="2995587">=</span>&nbsp;<span class="ident" id="2995589">w</span><span class="op" id="2995590">.</span><span class="ident" id="2995591">w</span><span class="op" id="2995592">.</span><span class="ident" id="2995593">Write</span><span class="op" id="2995598">(</span><span class="ident" id="2995599">w</span><span class="op" id="2995600">.</span><span class="ident" id="2995601">bytes</span><span class="op" id="2995606">[</span><span class="num" id="2995607">0</span><span class="op" id="2995608">:</span><span class="ident" id="2995609">n</span><span class="op" id="2995610">]</span><span class="op" id="2995611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995614">w</span><span class="op" id="2995615">.</span><span class="ident" id="2995616">nbytes</span>&nbsp;<span class="op" id="2995623">=</span>&nbsp;<span class="num" id="2995625">0</span><br>
<span class="lineno"></span><span class="op" id="2995627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="2995630">func</span>&nbsp;<span class="op" id="2995635">(</span><span class="ident" id="2995636">w</span>&nbsp;<span class="op" id="2995638">*</span><span class="ident" id="2995639">huffmanBitWriter</span><span class="op" id="2995655">)</span>&nbsp;<span class="ident" id="2995657">writeBits</span><span class="op" id="2995666">(</span><span class="ident" id="2995667">b</span><span class="op" id="2995668">,</span>&nbsp;<span class="ident" id="2995670">nb</span>&nbsp;<span class="builtintype" id="2995673">int32</span><span class="op" id="2995678">)</span>&nbsp;<span class="op" id="2995680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995683">w</span><span class="op" id="2995684">.</span><span class="ident" id="2995685">bits</span>&nbsp;<span class="op" id="2995690">|=</span>&nbsp;<span class="builtintype" id="2995693">uint32</span><span class="op" id="2995699">(</span><span class="ident" id="2995700">b</span><span class="op" id="2995701">)</span>&nbsp;<span class="op" id="2995703">&lt;&lt;</span>&nbsp;<span class="ident" id="2995706">w</span><span class="op" id="2995707">.</span><span class="ident" id="2995708">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995715">if</span>&nbsp;<span class="ident" id="2995718">w</span><span class="op" id="2995719">.</span><span class="ident" id="2995720">nbits</span>&nbsp;<span class="op" id="2995726">+=</span>&nbsp;<span class="builtintype" id="2995729">uint32</span><span class="op" id="2995735">(</span><span class="ident" id="2995736">nb</span><span class="op" id="2995738">)</span><span class="op" id="2995739">;</span>&nbsp;<span class="ident" id="2995741">w</span><span class="op" id="2995742">.</span><span class="ident" id="2995743">nbits</span>&nbsp;<span class="op" id="2995749">&gt;=</span>&nbsp;<span class="num" id="2995752">16</span>&nbsp;<span class="op" id="2995755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995759">w</span><span class="op" id="2995760">.</span><span class="ident" id="2995761">flushBits</span><span class="op" id="2995770">(</span><span class="op" id="2995771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2995774">}</span><br>
<span class="lineno">170</span><span class="op" id="2995776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2995779">func</span>&nbsp;<span class="op" id="2995784">(</span><span class="ident" id="2995785">w</span>&nbsp;<span class="op" id="2995787">*</span><span class="ident" id="2995788">huffmanBitWriter</span><span class="op" id="2995804">)</span>&nbsp;<span class="ident" id="2995806">writeBytes</span><span class="op" id="2995816">(</span><span class="ident" id="2995817">bytes</span>&nbsp;<span class="op" id="2995823">[</span><span class="op" id="2995824">]</span><span class="builtintype" id="2995825">byte</span><span class="op" id="2995829">)</span>&nbsp;<span class="op" id="2995831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995834">if</span>&nbsp;<span class="ident" id="2995837">w</span><span class="op" id="2995838">.</span><span class="ident" id="2995839">err</span>&nbsp;<span class="op" id="2995843">!=</span>&nbsp;<span class="ident" id="2995846">nil</span>&nbsp;<span class="op" id="2995850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995854">return</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2995862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995865">n</span>&nbsp;<span class="op" id="2995867">:=</span>&nbsp;<span class="ident" id="2995870">w</span><span class="op" id="2995871">.</span><span class="ident" id="2995872">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995880">if</span>&nbsp;<span class="ident" id="2995883">w</span><span class="op" id="2995884">.</span><span class="ident" id="2995885">nbits</span>&nbsp;<span class="op" id="2995891">==</span>&nbsp;<span class="num" id="2995894">8</span>&nbsp;<span class="op" id="2995896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995900">w</span><span class="op" id="2995901">.</span><span class="ident" id="2995902">bytes</span><span class="op" id="2995907">[</span><span class="ident" id="2995908">n</span><span class="op" id="2995909">]</span>&nbsp;<span class="op" id="2995911">=</span>&nbsp;<span class="builtintype" id="2995913">byte</span><span class="op" id="2995917">(</span><span class="ident" id="2995918">w</span><span class="op" id="2995919">.</span><span class="ident" id="2995920">bits</span><span class="op" id="2995924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995928">w</span><span class="op" id="2995929">.</span><span class="ident" id="2995930">nbits</span>&nbsp;<span class="op" id="2995936">=</span>&nbsp;<span class="num" id="2995938">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995942">n</span><span class="op" id="2995943">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2995947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995950">if</span>&nbsp;<span class="ident" id="2995953">w</span><span class="op" id="2995954">.</span><span class="ident" id="2995955">nbits</span>&nbsp;<span class="op" id="2995961">!=</span>&nbsp;<span class="num" id="2995964">0</span>&nbsp;<span class="op" id="2995966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995970">w</span><span class="op" id="2995971">.</span><span class="ident" id="2995972">err</span>&nbsp;<span class="op" id="2995976">=</span>&nbsp;<span class="ident" id="2995978">InternalError</span><span class="op" id="2995991">(</span><span class="string" id="2995992">&#34;writeBytes&nbsp;with&nbsp;unfinished&nbsp;bits&#34;</span><span class="op" id="2996025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2996029">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2996037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2996040">if</span>&nbsp;<span class="ident" id="2996043">n</span>&nbsp;<span class="op" id="2996045">!=</span>&nbsp;<span class="num" id="2996048">0</span>&nbsp;<span class="op" id="2996050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996054">_</span><span class="op" id="2996055">,</span>&nbsp;<span class="ident" id="2996057">w</span><span class="op" id="2996058">.</span><span class="ident" id="2996059">err</span>&nbsp;<span class="op" id="2996063">=</span>&nbsp;<span class="ident" id="2996065">w</span><span class="op" id="2996066">.</span><span class="ident" id="2996067">w</span><span class="op" id="2996068">.</span><span class="ident" id="2996069">Write</span><span class="op" id="2996074">(</span><span class="ident" id="2996075">w</span><span class="op" id="2996076">.</span><span class="ident" id="2996077">bytes</span><span class="op" id="2996082">[</span><span class="num" id="2996083">0</span><span class="op" id="2996084">:</span><span class="ident" id="2996085">n</span><span class="op" id="2996086">]</span><span class="op" id="2996087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2996091">if</span>&nbsp;<span class="ident" id="2996094">w</span><span class="op" id="2996095">.</span><span class="ident" id="2996096">err</span>&nbsp;<span class="op" id="2996100">!=</span>&nbsp;<span class="ident" id="2996103">nil</span>&nbsp;<span class="op" id="2996107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2996112">return</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2996121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2996124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996127">w</span><span class="op" id="2996128">.</span><span class="ident" id="2996129">nbytes</span>&nbsp;<span class="op" id="2996136">=</span>&nbsp;<span class="num" id="2996138">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996141">_</span><span class="op" id="2996142">,</span>&nbsp;<span class="ident" id="2996144">w</span><span class="op" id="2996145">.</span><span class="ident" id="2996146">err</span>&nbsp;<span class="op" id="2996150">=</span>&nbsp;<span class="ident" id="2996152">w</span><span class="op" id="2996153">.</span><span class="ident" id="2996154">w</span><span class="op" id="2996155">.</span><span class="ident" id="2996156">Write</span><span class="op" id="2996161">(</span><span class="ident" id="2996162">bytes</span><span class="op" id="2996167">)</span><br>
<span class="lineno"></span><span class="op" id="2996169">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="2996172">//&nbsp;RFC&nbsp;1951&nbsp;3.2.7&nbsp;specifies&nbsp;a&nbsp;special&nbsp;run-length&nbsp;encoding&nbsp;for&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="2996245">//&nbsp;the&nbsp;literal&nbsp;and&nbsp;offset&nbsp;lengths&nbsp;arrays&nbsp;(which&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="2996324">//&nbsp;array).&nbsp;&nbsp;This&nbsp;method&nbsp;generates&nbsp;that&nbsp;run-length&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="2996384">//</span><br>
<span class="lineno">200</span><span class="comment" id="2996387">//&nbsp;The&nbsp;result&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegen&nbsp;array,&nbsp;and&nbsp;the&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="2996456">//&nbsp;of&nbsp;each&nbsp;code&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegenFreq&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="2996511">//&nbsp;Codes&nbsp;0-15&nbsp;are&nbsp;single&nbsp;byte&nbsp;codes.&nbsp;Codes&nbsp;16-18&nbsp;are&nbsp;followed&nbsp;by&nbsp;additional</span><br>
<span class="lineno"></span><span class="comment" id="2996587">//&nbsp;information.&nbsp;&nbsp;Code&nbsp;badCode&nbsp;is&nbsp;an&nbsp;end&nbsp;marker</span><br>
<span class="lineno"></span><span class="comment" id="2996634">//</span><br>
<span class="lineno">205</span><span class="comment" id="2996637">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;in&nbsp;literalEncoding</span><br>
<span class="lineno"></span><span class="comment" id="2996700">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;in&nbsp;offsetEncoding</span><br>
<span class="lineno"></span><span class="keyword" id="2996761">func</span>&nbsp;<span class="op" id="2996766">(</span><span class="ident" id="2996767">w</span>&nbsp;<span class="op" id="2996769">*</span><span class="ident" id="2996770">huffmanBitWriter</span><span class="op" id="2996786">)</span>&nbsp;<span class="ident" id="2996788">generateCodegen</span><span class="op" id="2996803">(</span><span class="ident" id="2996804">numLiterals</span>&nbsp;<span class="builtintype" id="2996816">int</span><span class="op" id="2996819">,</span>&nbsp;<span class="ident" id="2996821">numOffsets</span>&nbsp;<span class="builtintype" id="2996832">int</span><span class="op" id="2996835">)</span>&nbsp;<span class="op" id="2996837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2996840">for</span>&nbsp;<span class="ident" id="2996844">i</span>&nbsp;<span class="op" id="2996846">:=</span>&nbsp;<span class="keyword" id="2996849">range</span>&nbsp;<span class="ident" id="2996855">w</span><span class="op" id="2996856">.</span><span class="ident" id="2996857">codegenFreq</span>&nbsp;<span class="op" id="2996869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2996873">w</span><span class="op" id="2996874">.</span><span class="ident" id="2996875">codegenFreq</span><span class="op" id="2996886">[</span><span class="ident" id="2996887">i</span><span class="op" id="2996888">]</span>&nbsp;<span class="op" id="2996890">=</span>&nbsp;<span class="num" id="2996892">0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2996895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2996898">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;are&nbsp;using&nbsp;codegen&nbsp;both&nbsp;as&nbsp;a&nbsp;temporary&nbsp;variable&nbsp;for&nbsp;holding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2996974">//&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;frequencies,&nbsp;and&nbsp;as&nbsp;the&nbsp;place&nbsp;where&nbsp;we&nbsp;put&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2997047">//&nbsp;This&nbsp;is&nbsp;fine&nbsp;because&nbsp;the&nbsp;output&nbsp;is&nbsp;always&nbsp;shorter&nbsp;than&nbsp;the&nbsp;input&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2997121">//&nbsp;so&nbsp;far.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997133">codegen</span>&nbsp;<span class="op" id="2997141">:=</span>&nbsp;<span class="ident" id="2997144">w</span><span class="op" id="2997145">.</span><span class="ident" id="2997146">codegen</span>&nbsp;<span class="comment" id="2997154">//&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2997164">//&nbsp;Copy&nbsp;the&nbsp;concatenated&nbsp;code&nbsp;sizes&nbsp;to&nbsp;codegen.&nbsp;&nbsp;Put&nbsp;a&nbsp;marker&nbsp;at&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2997239">copy</span><span class="op" id="2997243">(</span><span class="ident" id="2997244">codegen</span><span class="op" id="2997251">[</span><span class="num" id="2997252">0</span><span class="op" id="2997253">:</span><span class="ident" id="2997254">numLiterals</span><span class="op" id="2997265">]</span><span class="op" id="2997266">,</span>&nbsp;<span class="ident" id="2997268">w</span><span class="op" id="2997269">.</span><span class="ident" id="2997270">literalEncoding</span><span class="op" id="2997285">.</span><span class="ident" id="2997286">codeBits</span><span class="op" id="2997294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2997297">copy</span><span class="op" id="2997301">(</span><span class="ident" id="2997302">codegen</span><span class="op" id="2997309">[</span><span class="ident" id="2997310">numLiterals</span><span class="op" id="2997321">:</span><span class="ident" id="2997322">numLiterals</span><span class="op" id="2997333">+</span><span class="ident" id="2997334">numOffsets</span><span class="op" id="2997344">]</span><span class="op" id="2997345">,</span>&nbsp;<span class="ident" id="2997347">w</span><span class="op" id="2997348">.</span><span class="ident" id="2997349">offsetEncoding</span><span class="op" id="2997363">.</span><span class="ident" id="2997364">codeBits</span><span class="op" id="2997372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997375">codegen</span><span class="op" id="2997382">[</span><span class="ident" id="2997383">numLiterals</span><span class="op" id="2997394">+</span><span class="ident" id="2997395">numOffsets</span><span class="op" id="2997405">]</span>&nbsp;<span class="op" id="2997407">=</span>&nbsp;<span class="ident" id="2997409">badCode</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997419">size</span>&nbsp;<span class="op" id="2997424">:=</span>&nbsp;<span class="ident" id="2997427">codegen</span><span class="op" id="2997434">[</span><span class="num" id="2997435">0</span><span class="op" id="2997436">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997439">count</span>&nbsp;<span class="op" id="2997445">:=</span>&nbsp;<span class="num" id="2997448">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997451">outIndex</span>&nbsp;<span class="op" id="2997460">:=</span>&nbsp;<span class="num" id="2997463">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997466">for</span>&nbsp;<span class="ident" id="2997470">inIndex</span>&nbsp;<span class="op" id="2997478">:=</span>&nbsp;<span class="num" id="2997481">1</span><span class="op" id="2997482">;</span>&nbsp;<span class="ident" id="2997484">size</span>&nbsp;<span class="op" id="2997489">!=</span>&nbsp;<span class="ident" id="2997492">badCode</span><span class="op" id="2997499">;</span>&nbsp;<span class="ident" id="2997501">inIndex</span><span class="op" id="2997508">++</span>&nbsp;<span class="op" id="2997511">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2997515">//&nbsp;INVARIANT:&nbsp;We&nbsp;have&nbsp;seen&nbsp;&#34;count&#34;&nbsp;copies&nbsp;of&nbsp;size&nbsp;that&nbsp;have&nbsp;not&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2997585">//&nbsp;had&nbsp;output&nbsp;generated&nbsp;for&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997621">nextSize</span>&nbsp;<span class="op" id="2997630">:=</span>&nbsp;<span class="ident" id="2997633">codegen</span><span class="op" id="2997640">[</span><span class="ident" id="2997641">inIndex</span><span class="op" id="2997648">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997652">if</span>&nbsp;<span class="ident" id="2997655">nextSize</span>&nbsp;<span class="op" id="2997664">==</span>&nbsp;<span class="ident" id="2997667">size</span>&nbsp;<span class="op" id="2997672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997677">count</span><span class="op" id="2997682">++</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997688">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2997699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2997703">//&nbsp;We&nbsp;need&nbsp;to&nbsp;generate&nbsp;codegen&nbsp;indicating&nbsp;&#34;count&#34;&nbsp;of&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997764">if</span>&nbsp;<span class="ident" id="2997767">size</span>&nbsp;<span class="op" id="2997772">!=</span>&nbsp;<span class="num" id="2997775">0</span>&nbsp;<span class="op" id="2997777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997782">codegen</span><span class="op" id="2997789">[</span><span class="ident" id="2997790">outIndex</span><span class="op" id="2997798">]</span>&nbsp;<span class="op" id="2997800">=</span>&nbsp;<span class="ident" id="2997802">size</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997810">outIndex</span><span class="op" id="2997818">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997824">w</span><span class="op" id="2997825">.</span><span class="ident" id="2997826">codegenFreq</span><span class="op" id="2997837">[</span><span class="ident" id="2997838">size</span><span class="op" id="2997842">]</span><span class="op" id="2997843">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997849">count</span><span class="op" id="2997854">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997860">for</span>&nbsp;<span class="ident" id="2997864">count</span>&nbsp;<span class="op" id="2997870">&gt;=</span>&nbsp;<span class="num" id="2997873">3</span>&nbsp;<span class="op" id="2997875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997881">n</span>&nbsp;<span class="op" id="2997883">:=</span>&nbsp;<span class="num" id="2997886">6</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2997892">if</span>&nbsp;<span class="ident" id="2997895">n</span>&nbsp;<span class="op" id="2997897">&gt;</span>&nbsp;<span class="ident" id="2997899">count</span>&nbsp;<span class="op" id="2997905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997912">n</span>&nbsp;<span class="op" id="2997914">=</span>&nbsp;<span class="ident" id="2997916">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2997926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997932">codegen</span><span class="op" id="2997939">[</span><span class="ident" id="2997940">outIndex</span><span class="op" id="2997948">]</span>&nbsp;<span class="op" id="2997950">=</span>&nbsp;<span class="num" id="2997952">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997959">outIndex</span><span class="op" id="2997967">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2997974">codegen</span><span class="op" id="2997981">[</span><span class="ident" id="2997982">outIndex</span><span class="op" id="2997990">]</span>&nbsp;<span class="op" id="2997992">=</span>&nbsp;<span class="builtintype" id="2997994">uint8</span><span class="op" id="2997999">(</span><span class="ident" id="2998000">n</span>&nbsp;<span class="op" id="2998002">-</span>&nbsp;<span class="num" id="2998004">3</span><span class="op" id="2998005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998011">outIndex</span><span class="op" id="2998019">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998026">w</span><span class="op" id="2998027">.</span><span class="ident" id="2998028">codegenFreq</span><span class="op" id="2998039">[</span><span class="num" id="2998040">16</span><span class="op" id="2998042">]</span><span class="op" id="2998043">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998050">count</span>&nbsp;<span class="op" id="2998056">-=</span>&nbsp;<span class="ident" id="2998059">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998064">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998068">}</span>&nbsp;<span class="keyword" id="2998070">else</span>&nbsp;<span class="op" id="2998075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998080">for</span>&nbsp;<span class="ident" id="2998084">count</span>&nbsp;<span class="op" id="2998090">&gt;=</span>&nbsp;<span class="num" id="2998093">11</span>&nbsp;<span class="op" id="2998096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998102">n</span>&nbsp;<span class="op" id="2998104">:=</span>&nbsp;<span class="num" id="2998107">138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998115">if</span>&nbsp;<span class="ident" id="2998118">n</span>&nbsp;<span class="op" id="2998120">&gt;</span>&nbsp;<span class="ident" id="2998122">count</span>&nbsp;<span class="op" id="2998128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998135">n</span>&nbsp;<span class="op" id="2998137">=</span>&nbsp;<span class="ident" id="2998139">count</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998155">codegen</span><span class="op" id="2998162">[</span><span class="ident" id="2998163">outIndex</span><span class="op" id="2998171">]</span>&nbsp;<span class="op" id="2998173">=</span>&nbsp;<span class="num" id="2998175">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998182">outIndex</span><span class="op" id="2998190">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998197">codegen</span><span class="op" id="2998204">[</span><span class="ident" id="2998205">outIndex</span><span class="op" id="2998213">]</span>&nbsp;<span class="op" id="2998215">=</span>&nbsp;<span class="builtintype" id="2998217">uint8</span><span class="op" id="2998222">(</span><span class="ident" id="2998223">n</span>&nbsp;<span class="op" id="2998225">-</span>&nbsp;<span class="num" id="2998227">11</span><span class="op" id="2998229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998235">outIndex</span><span class="op" id="2998243">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998250">w</span><span class="op" id="2998251">.</span><span class="ident" id="2998252">codegenFreq</span><span class="op" id="2998263">[</span><span class="num" id="2998264">18</span><span class="op" id="2998266">]</span><span class="op" id="2998267">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998274">count</span>&nbsp;<span class="op" id="2998280">-=</span>&nbsp;<span class="ident" id="2998283">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998293">if</span>&nbsp;<span class="ident" id="2998296">count</span>&nbsp;<span class="op" id="2998302">&gt;=</span>&nbsp;<span class="num" id="2998305">3</span>&nbsp;<span class="op" id="2998307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998313">//&nbsp;count&nbsp;&gt;=&nbsp;3&nbsp;&amp;&amp;&nbsp;count&nbsp;&lt;=&nbsp;10</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998346">codegen</span><span class="op" id="2998353">[</span><span class="ident" id="2998354">outIndex</span><span class="op" id="2998362">]</span>&nbsp;<span class="op" id="2998364">=</span>&nbsp;<span class="num" id="2998366">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998373">outIndex</span><span class="op" id="2998381">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998388">codegen</span><span class="op" id="2998395">[</span><span class="ident" id="2998396">outIndex</span><span class="op" id="2998404">]</span>&nbsp;<span class="op" id="2998406">=</span>&nbsp;<span class="builtintype" id="2998408">uint8</span><span class="op" id="2998413">(</span><span class="ident" id="2998414">count</span>&nbsp;<span class="op" id="2998420">-</span>&nbsp;<span class="num" id="2998422">3</span><span class="op" id="2998423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998429">outIndex</span><span class="op" id="2998437">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998444">w</span><span class="op" id="2998445">.</span><span class="ident" id="2998446">codegenFreq</span><span class="op" id="2998457">[</span><span class="num" id="2998458">17</span><span class="op" id="2998460">]</span><span class="op" id="2998461">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998468">count</span>&nbsp;<span class="op" id="2998474">=</span>&nbsp;<span class="num" id="2998476">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998489">count</span><span class="op" id="2998494">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998499">for</span>&nbsp;<span class="op" id="2998503">;</span>&nbsp;<span class="ident" id="2998505">count</span>&nbsp;<span class="op" id="2998511">&gt;=</span>&nbsp;<span class="num" id="2998514">0</span><span class="op" id="2998515">;</span>&nbsp;<span class="ident" id="2998517">count</span><span class="op" id="2998522">--</span>&nbsp;<span class="op" id="2998525">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998530">codegen</span><span class="op" id="2998537">[</span><span class="ident" id="2998538">outIndex</span><span class="op" id="2998546">]</span>&nbsp;<span class="op" id="2998548">=</span>&nbsp;<span class="ident" id="2998550">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998558">outIndex</span><span class="op" id="2998566">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998572">w</span><span class="op" id="2998573">.</span><span class="ident" id="2998574">codegenFreq</span><span class="op" id="2998585">[</span><span class="ident" id="2998586">size</span><span class="op" id="2998590">]</span><span class="op" id="2998591">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998600">//&nbsp;Set&nbsp;up&nbsp;invariant&nbsp;for&nbsp;next&nbsp;time&nbsp;through&nbsp;the&nbsp;loop.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998654">size</span>&nbsp;<span class="op" id="2998659">=</span>&nbsp;<span class="ident" id="2998661">nextSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998672">count</span>&nbsp;<span class="op" id="2998678">=</span>&nbsp;<span class="num" id="2998680">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2998686">//&nbsp;Marker&nbsp;indicating&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;codegen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998732">codegen</span><span class="op" id="2998739">[</span><span class="ident" id="2998740">outIndex</span><span class="op" id="2998748">]</span>&nbsp;<span class="op" id="2998750">=</span>&nbsp;<span class="ident" id="2998752">badCode</span><br>
<span class="lineno">285</span><span class="op" id="2998760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2998763">func</span>&nbsp;<span class="op" id="2998768">(</span><span class="ident" id="2998769">w</span>&nbsp;<span class="op" id="2998771">*</span><span class="ident" id="2998772">huffmanBitWriter</span><span class="op" id="2998788">)</span>&nbsp;<span class="ident" id="2998790">writeCode</span><span class="op" id="2998799">(</span><span class="ident" id="2998800">code</span>&nbsp;<span class="op" id="2998805">*</span><span class="ident" id="2998806">huffmanEncoder</span><span class="op" id="2998820">,</span>&nbsp;<span class="ident" id="2998822">literal</span>&nbsp;<span class="builtintype" id="2998830">uint32</span><span class="op" id="2998836">)</span>&nbsp;<span class="op" id="2998838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998841">if</span>&nbsp;<span class="ident" id="2998844">w</span><span class="op" id="2998845">.</span><span class="ident" id="2998846">err</span>&nbsp;<span class="op" id="2998850">!=</span>&nbsp;<span class="ident" id="2998853">nil</span>&nbsp;<span class="op" id="2998857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2998861">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2998869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2998872">w</span><span class="op" id="2998873">.</span><span class="ident" id="2998874">writeBits</span><span class="op" id="2998883">(</span><span class="builtintype" id="2998884">int32</span><span class="op" id="2998889">(</span><span class="ident" id="2998890">code</span><span class="op" id="2998894">.</span><span class="ident" id="2998895">code</span><span class="op" id="2998899">[</span><span class="ident" id="2998900">literal</span><span class="op" id="2998907">]</span><span class="op" id="2998908">)</span><span class="op" id="2998909">,</span>&nbsp;<span class="builtintype" id="2998911">int32</span><span class="op" id="2998916">(</span><span class="ident" id="2998917">code</span><span class="op" id="2998921">.</span><span class="ident" id="2998922">codeBits</span><span class="op" id="2998930">[</span><span class="ident" id="2998931">literal</span><span class="op" id="2998938">]</span><span class="op" id="2998939">)</span><span class="op" id="2998940">)</span><br>
<span class="lineno"></span><span class="op" id="2998942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2998945">//&nbsp;Write&nbsp;the&nbsp;header&nbsp;of&nbsp;a&nbsp;dynamic&nbsp;Huffman&nbsp;block&nbsp;to&nbsp;the&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">295</span><span class="comment" id="2999014">//</span><br>
<span class="lineno"></span><span class="comment" id="2999017">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="2999078">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="2999138">//&nbsp;&nbsp;numCodegens&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;codegens&nbsp;used&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="keyword" id="2999194">func</span>&nbsp;<span class="op" id="2999199">(</span><span class="ident" id="2999200">w</span>&nbsp;<span class="op" id="2999202">*</span><span class="ident" id="2999203">huffmanBitWriter</span><span class="op" id="2999219">)</span>&nbsp;<span class="ident" id="2999221">writeDynamicHeader</span><span class="op" id="2999239">(</span><span class="ident" id="2999240">numLiterals</span>&nbsp;<span class="builtintype" id="2999252">int</span><span class="op" id="2999255">,</span>&nbsp;<span class="ident" id="2999257">numOffsets</span>&nbsp;<span class="builtintype" id="2999268">int</span><span class="op" id="2999271">,</span>&nbsp;<span class="ident" id="2999273">numCodegens</span>&nbsp;<span class="builtintype" id="2999285">int</span><span class="op" id="2999288">,</span>&nbsp;<span class="ident" id="2999290">isEof</span>&nbsp;<span class="builtintype" id="2999296">bool</span><span class="op" id="2999300">)</span>&nbsp;<span class="op" id="2999302">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999305">if</span>&nbsp;<span class="ident" id="2999308">w</span><span class="op" id="2999309">.</span><span class="ident" id="2999310">err</span>&nbsp;<span class="op" id="2999314">!=</span>&nbsp;<span class="ident" id="2999317">nil</span>&nbsp;<span class="op" id="2999321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999325">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999336">var</span>&nbsp;<span class="ident" id="2999340">firstBits</span>&nbsp;<span class="builtintype" id="2999350">int32</span>&nbsp;<span class="op" id="2999356">=</span>&nbsp;<span class="num" id="2999358">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999361">if</span>&nbsp;<span class="ident" id="2999364">isEof</span>&nbsp;<span class="op" id="2999370">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999374">firstBits</span>&nbsp;<span class="op" id="2999384">=</span>&nbsp;<span class="num" id="2999386">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999392">w</span><span class="op" id="2999393">.</span><span class="ident" id="2999394">writeBits</span><span class="op" id="2999403">(</span><span class="ident" id="2999404">firstBits</span><span class="op" id="2999413">,</span>&nbsp;<span class="num" id="2999415">3</span><span class="op" id="2999416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999419">w</span><span class="op" id="2999420">.</span><span class="ident" id="2999421">writeBits</span><span class="op" id="2999430">(</span><span class="builtintype" id="2999431">int32</span><span class="op" id="2999436">(</span><span class="ident" id="2999437">numLiterals</span><span class="op" id="2999448">-</span><span class="num" id="2999449">257</span><span class="op" id="2999452">)</span><span class="op" id="2999453">,</span>&nbsp;<span class="num" id="2999455">5</span><span class="op" id="2999456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999459">w</span><span class="op" id="2999460">.</span><span class="ident" id="2999461">writeBits</span><span class="op" id="2999470">(</span><span class="builtintype" id="2999471">int32</span><span class="op" id="2999476">(</span><span class="ident" id="2999477">numOffsets</span><span class="op" id="2999487">-</span><span class="num" id="2999488">1</span><span class="op" id="2999489">)</span><span class="op" id="2999490">,</span>&nbsp;<span class="num" id="2999492">5</span><span class="op" id="2999493">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999496">w</span><span class="op" id="2999497">.</span><span class="ident" id="2999498">writeBits</span><span class="op" id="2999507">(</span><span class="builtintype" id="2999508">int32</span><span class="op" id="2999513">(</span><span class="ident" id="2999514">numCodegens</span><span class="op" id="2999525">-</span><span class="num" id="2999526">4</span><span class="op" id="2999527">)</span><span class="op" id="2999528">,</span>&nbsp;<span class="num" id="2999530">4</span><span class="op" id="2999531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999535">for</span>&nbsp;<span class="ident" id="2999539">i</span>&nbsp;<span class="op" id="2999541">:=</span>&nbsp;<span class="num" id="2999544">0</span><span class="op" id="2999545">;</span>&nbsp;<span class="ident" id="2999547">i</span>&nbsp;<span class="op" id="2999549">&lt;</span>&nbsp;<span class="ident" id="2999551">numCodegens</span><span class="op" id="2999562">;</span>&nbsp;<span class="ident" id="2999564">i</span><span class="op" id="2999565">++</span>&nbsp;<span class="op" id="2999568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999572">value</span>&nbsp;<span class="op" id="2999578">:=</span>&nbsp;<span class="ident" id="2999581">w</span><span class="op" id="2999582">.</span><span class="ident" id="2999583">codegenEncoding</span><span class="op" id="2999598">.</span><span class="ident" id="2999599">codeBits</span><span class="op" id="2999607">[</span><span class="ident" id="2999608">codegenOrder</span><span class="op" id="2999620">[</span><span class="ident" id="2999621">i</span><span class="op" id="2999622">]</span><span class="op" id="2999623">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999627">w</span><span class="op" id="2999628">.</span><span class="ident" id="2999629">writeBits</span><span class="op" id="2999638">(</span><span class="builtintype" id="2999639">int32</span><span class="op" id="2999644">(</span><span class="ident" id="2999645">value</span><span class="op" id="2999650">)</span><span class="op" id="2999651">,</span>&nbsp;<span class="num" id="2999653">3</span><span class="op" id="2999654">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999661">i</span>&nbsp;<span class="op" id="2999663">:=</span>&nbsp;<span class="num" id="2999666">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999669">for</span>&nbsp;<span class="op" id="2999673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999677">var</span>&nbsp;<span class="ident" id="2999681">codeWord</span>&nbsp;<span class="builtintype" id="2999690">int</span>&nbsp;<span class="op" id="2999694">=</span>&nbsp;<span class="builtintype" id="2999696">int</span><span class="op" id="2999699">(</span><span class="ident" id="2999700">w</span><span class="op" id="2999701">.</span><span class="ident" id="2999702">codegen</span><span class="op" id="2999709">[</span><span class="ident" id="2999710">i</span><span class="op" id="2999711">]</span><span class="op" id="2999712">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999716">i</span><span class="op" id="2999717">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999722">if</span>&nbsp;<span class="ident" id="2999725">codeWord</span>&nbsp;<span class="op" id="2999734">==</span>&nbsp;<span class="ident" id="2999737">badCode</span>&nbsp;<span class="op" id="2999745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999750">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2999762">//&nbsp;The&nbsp;low&nbsp;byte&nbsp;contains&nbsp;the&nbsp;actual&nbsp;code&nbsp;to&nbsp;generate.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999818">w</span><span class="op" id="2999819">.</span><span class="ident" id="2999820">writeCode</span><span class="op" id="2999829">(</span><span class="ident" id="2999830">w</span><span class="op" id="2999831">.</span><span class="ident" id="2999832">codegenEncoding</span><span class="op" id="2999847">,</span>&nbsp;<span class="builtintype" id="2999849">uint32</span><span class="op" id="2999855">(</span><span class="ident" id="2999856">codeWord</span><span class="op" id="2999864">)</span><span class="op" id="2999865">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999870">switch</span>&nbsp;<span class="ident" id="2999877">codeWord</span>&nbsp;<span class="op" id="2999886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999890">case</span>&nbsp;<span class="num" id="2999895">16</span><span class="op" id="2999897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999902">w</span><span class="op" id="2999903">.</span><span class="ident" id="2999904">writeBits</span><span class="op" id="2999913">(</span><span class="builtintype" id="2999914">int32</span><span class="op" id="2999919">(</span><span class="ident" id="2999920">w</span><span class="op" id="2999921">.</span><span class="ident" id="2999922">codegen</span><span class="op" id="2999929">[</span><span class="ident" id="2999930">i</span><span class="op" id="2999931">]</span><span class="op" id="2999932">)</span><span class="op" id="2999933">,</span>&nbsp;<span class="num" id="2999935">2</span><span class="op" id="2999936">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999941">i</span><span class="op" id="2999942">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999948">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999956">case</span>&nbsp;<span class="num" id="2999961">17</span><span class="op" id="2999963">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999968">w</span><span class="op" id="2999969">.</span><span class="ident" id="2999970">writeBits</span><span class="op" id="2999979">(</span><span class="builtintype" id="2999980">int32</span><span class="op" id="2999985">(</span><span class="ident" id="2999986">w</span><span class="op" id="2999987">.</span><span class="ident" id="2999988">codegen</span><span class="op" id="2999995">[</span><span class="ident" id="2999996">i</span><span class="op" id="2999997">]</span><span class="op" id="2999998">)</span><span class="op" id="2999999">,</span>&nbsp;<span class="num" id="3000001">3</span><span class="op" id="3000002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000007">i</span><span class="op" id="3000008">++</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000014">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000022">case</span>&nbsp;<span class="num" id="3000027">18</span><span class="op" id="3000029">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000034">w</span><span class="op" id="3000035">.</span><span class="ident" id="3000036">writeBits</span><span class="op" id="3000045">(</span><span class="builtintype" id="3000046">int32</span><span class="op" id="3000051">(</span><span class="ident" id="3000052">w</span><span class="op" id="3000053">.</span><span class="ident" id="3000054">codegen</span><span class="op" id="3000061">[</span><span class="ident" id="3000062">i</span><span class="op" id="3000063">]</span><span class="op" id="3000064">)</span><span class="op" id="3000065">,</span>&nbsp;<span class="num" id="3000067">7</span><span class="op" id="3000068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000073">i</span><span class="op" id="3000074">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000080">break</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000091">}</span><br>
<span class="lineno"></span><span class="op" id="3000093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3000096">func</span>&nbsp;<span class="op" id="3000101">(</span><span class="ident" id="3000102">w</span>&nbsp;<span class="op" id="3000104">*</span><span class="ident" id="3000105">huffmanBitWriter</span><span class="op" id="3000121">)</span>&nbsp;<span class="ident" id="3000123">writeStoredHeader</span><span class="op" id="3000140">(</span><span class="ident" id="3000141">length</span>&nbsp;<span class="builtintype" id="3000148">int</span><span class="op" id="3000151">,</span>&nbsp;<span class="ident" id="3000153">isEof</span>&nbsp;<span class="builtintype" id="3000159">bool</span><span class="op" id="3000163">)</span>&nbsp;<span class="op" id="3000165">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000168">if</span>&nbsp;<span class="ident" id="3000171">w</span><span class="op" id="3000172">.</span><span class="ident" id="3000173">err</span>&nbsp;<span class="op" id="3000177">!=</span>&nbsp;<span class="ident" id="3000180">nil</span>&nbsp;<span class="op" id="3000184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000188">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000199">var</span>&nbsp;<span class="ident" id="3000203">flag</span>&nbsp;<span class="builtintype" id="3000208">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000215">if</span>&nbsp;<span class="ident" id="3000218">isEof</span>&nbsp;<span class="op" id="3000224">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000228">flag</span>&nbsp;<span class="op" id="3000233">=</span>&nbsp;<span class="num" id="3000235">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000241">w</span><span class="op" id="3000242">.</span><span class="ident" id="3000243">writeBits</span><span class="op" id="3000252">(</span><span class="ident" id="3000253">flag</span><span class="op" id="3000257">,</span>&nbsp;<span class="num" id="3000259">3</span><span class="op" id="3000260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000263">w</span><span class="op" id="3000264">.</span><span class="ident" id="3000265">flush</span><span class="op" id="3000270">(</span><span class="op" id="3000271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000274">w</span><span class="op" id="3000275">.</span><span class="ident" id="3000276">writeBits</span><span class="op" id="3000285">(</span><span class="builtintype" id="3000286">int32</span><span class="op" id="3000291">(</span><span class="ident" id="3000292">length</span><span class="op" id="3000298">)</span><span class="op" id="3000299">,</span>&nbsp;<span class="num" id="3000301">16</span><span class="op" id="3000303">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000306">w</span><span class="op" id="3000307">.</span><span class="ident" id="3000308">writeBits</span><span class="op" id="3000317">(</span><span class="builtintype" id="3000318">int32</span><span class="op" id="3000323">(</span><span class="op" id="3000324">^</span><span class="builtintype" id="3000325">uint16</span><span class="op" id="3000331">(</span><span class="ident" id="3000332">length</span><span class="op" id="3000338">)</span><span class="op" id="3000339">)</span><span class="op" id="3000340">,</span>&nbsp;<span class="num" id="3000342">16</span><span class="op" id="3000344">)</span><br>
<span class="lineno"></span><span class="op" id="3000346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3000349">func</span>&nbsp;<span class="op" id="3000354">(</span><span class="ident" id="3000355">w</span>&nbsp;<span class="op" id="3000357">*</span><span class="ident" id="3000358">huffmanBitWriter</span><span class="op" id="3000374">)</span>&nbsp;<span class="ident" id="3000376">writeFixedHeader</span><span class="op" id="3000392">(</span><span class="ident" id="3000393">isEof</span>&nbsp;<span class="builtintype" id="3000399">bool</span><span class="op" id="3000403">)</span>&nbsp;<span class="op" id="3000405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000408">if</span>&nbsp;<span class="ident" id="3000411">w</span><span class="op" id="3000412">.</span><span class="ident" id="3000413">err</span>&nbsp;<span class="op" id="3000417">!=</span>&nbsp;<span class="ident" id="3000420">nil</span>&nbsp;<span class="op" id="3000424">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000428">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3000439">//&nbsp;Indicate&nbsp;that&nbsp;we&nbsp;are&nbsp;a&nbsp;fixed&nbsp;Huffman&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000486">var</span>&nbsp;<span class="ident" id="3000490">value</span>&nbsp;<span class="builtintype" id="3000496">int32</span>&nbsp;<span class="op" id="3000502">=</span>&nbsp;<span class="num" id="3000504">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000507">if</span>&nbsp;<span class="ident" id="3000510">isEof</span>&nbsp;<span class="op" id="3000516">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000520">value</span>&nbsp;<span class="op" id="3000526">=</span>&nbsp;<span class="num" id="3000528">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000534">w</span><span class="op" id="3000535">.</span><span class="ident" id="3000536">writeBits</span><span class="op" id="3000545">(</span><span class="ident" id="3000546">value</span><span class="op" id="3000551">,</span>&nbsp;<span class="num" id="3000553">3</span><span class="op" id="3000554">)</span><br>
<span class="lineno"></span><span class="op" id="3000556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="3000559">func</span>&nbsp;<span class="op" id="3000564">(</span><span class="ident" id="3000565">w</span>&nbsp;<span class="op" id="3000567">*</span><span class="ident" id="3000568">huffmanBitWriter</span><span class="op" id="3000584">)</span>&nbsp;<span class="ident" id="3000586">writeBlock</span><span class="op" id="3000596">(</span><span class="ident" id="3000597">tokens</span>&nbsp;<span class="op" id="3000604">[</span><span class="op" id="3000605">]</span><span class="ident" id="3000606">token</span><span class="op" id="3000611">,</span>&nbsp;<span class="ident" id="3000613">eof</span>&nbsp;<span class="builtintype" id="3000617">bool</span><span class="op" id="3000621">,</span>&nbsp;<span class="ident" id="3000623">input</span>&nbsp;<span class="op" id="3000629">[</span><span class="op" id="3000630">]</span><span class="builtintype" id="3000631">byte</span><span class="op" id="3000635">)</span>&nbsp;<span class="op" id="3000637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000640">if</span>&nbsp;<span class="ident" id="3000643">w</span><span class="op" id="3000644">.</span><span class="ident" id="3000645">err</span>&nbsp;<span class="op" id="3000649">!=</span>&nbsp;<span class="ident" id="3000652">nil</span>&nbsp;<span class="op" id="3000656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000660">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000671">for</span>&nbsp;<span class="ident" id="3000675">i</span>&nbsp;<span class="op" id="3000677">:=</span>&nbsp;<span class="keyword" id="3000680">range</span>&nbsp;<span class="ident" id="3000686">w</span><span class="op" id="3000687">.</span><span class="ident" id="3000688">literalFreq</span>&nbsp;<span class="op" id="3000700">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000704">w</span><span class="op" id="3000705">.</span><span class="ident" id="3000706">literalFreq</span><span class="op" id="3000717">[</span><span class="ident" id="3000718">i</span><span class="op" id="3000719">]</span>&nbsp;<span class="op" id="3000721">=</span>&nbsp;<span class="num" id="3000723">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000729">for</span>&nbsp;<span class="ident" id="3000733">i</span>&nbsp;<span class="op" id="3000735">:=</span>&nbsp;<span class="keyword" id="3000738">range</span>&nbsp;<span class="ident" id="3000744">w</span><span class="op" id="3000745">.</span><span class="ident" id="3000746">offsetFreq</span>&nbsp;<span class="op" id="3000757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000761">w</span><span class="op" id="3000762">.</span><span class="ident" id="3000763">offsetFreq</span><span class="op" id="3000773">[</span><span class="ident" id="3000774">i</span><span class="op" id="3000775">]</span>&nbsp;<span class="op" id="3000777">=</span>&nbsp;<span class="num" id="3000779">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000782">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000786">n</span>&nbsp;<span class="op" id="3000788">:=</span>&nbsp;<span class="builtinfunc" id="3000791">len</span><span class="op" id="3000794">(</span><span class="ident" id="3000795">tokens</span><span class="op" id="3000801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000804">tokens</span>&nbsp;<span class="op" id="3000811">=</span>&nbsp;<span class="ident" id="3000813">tokens</span><span class="op" id="3000819">[</span><span class="num" id="3000820">0</span>&nbsp;<span class="op" id="3000822">:</span>&nbsp;<span class="ident" id="3000824">n</span><span class="op" id="3000825">+</span><span class="num" id="3000826">1</span><span class="op" id="3000827">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000830">tokens</span><span class="op" id="3000836">[</span><span class="ident" id="3000837">n</span><span class="op" id="3000838">]</span>&nbsp;<span class="op" id="3000840">=</span>&nbsp;<span class="ident" id="3000842">endBlockMarker</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000859">for</span>&nbsp;<span class="ident" id="3000863">_</span><span class="op" id="3000864">,</span>&nbsp;<span class="ident" id="3000866">t</span>&nbsp;<span class="op" id="3000868">:=</span>&nbsp;<span class="keyword" id="3000871">range</span>&nbsp;<span class="ident" id="3000877">tokens</span>&nbsp;<span class="op" id="3000884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000888">switch</span>&nbsp;<span class="ident" id="3000895">t</span><span class="op" id="3000896">.</span><span class="ident" id="3000897">typ</span><span class="op" id="3000900">(</span><span class="op" id="3000901">)</span>&nbsp;<span class="op" id="3000903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000907">case</span>&nbsp;<span class="ident" id="3000912">literalType</span><span class="op" id="3000923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000928">w</span><span class="op" id="3000929">.</span><span class="ident" id="3000930">literalFreq</span><span class="op" id="3000941">[</span><span class="ident" id="3000942">t</span><span class="op" id="3000943">.</span><span class="ident" id="3000944">literal</span><span class="op" id="3000951">(</span><span class="op" id="3000952">)</span><span class="op" id="3000953">]</span><span class="op" id="3000954">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000959">case</span>&nbsp;<span class="ident" id="3000964">matchType</span><span class="op" id="3000973">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000978">length</span>&nbsp;<span class="op" id="3000985">:=</span>&nbsp;<span class="ident" id="3000988">t</span><span class="op" id="3000989">.</span><span class="ident" id="3000990">length</span><span class="op" id="3000996">(</span><span class="op" id="3000997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001002">offset</span>&nbsp;<span class="op" id="3001009">:=</span>&nbsp;<span class="ident" id="3001012">t</span><span class="op" id="3001013">.</span><span class="ident" id="3001014">offset</span><span class="op" id="3001020">(</span><span class="op" id="3001021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001026">w</span><span class="op" id="3001027">.</span><span class="ident" id="3001028">literalFreq</span><span class="op" id="3001039">[</span><span class="ident" id="3001040">lengthCodesStart</span><span class="op" id="3001056">+</span><span class="ident" id="3001057">lengthCode</span><span class="op" id="3001067">(</span><span class="ident" id="3001068">length</span><span class="op" id="3001074">)</span><span class="op" id="3001075">]</span><span class="op" id="3001076">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001082">w</span><span class="op" id="3001083">.</span><span class="ident" id="3001084">offsetFreq</span><span class="op" id="3001094">[</span><span class="ident" id="3001095">offsetCode</span><span class="op" id="3001105">(</span><span class="ident" id="3001106">offset</span><span class="op" id="3001112">)</span><span class="op" id="3001113">]</span><span class="op" id="3001114">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001119">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3001126">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001157">numLiterals</span>&nbsp;<span class="op" id="3001169">:=</span>&nbsp;<span class="builtinfunc" id="3001172">len</span><span class="op" id="3001175">(</span><span class="ident" id="3001176">w</span><span class="op" id="3001177">.</span><span class="ident" id="3001178">literalFreq</span><span class="op" id="3001189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001192">for</span>&nbsp;<span class="ident" id="3001196">w</span><span class="op" id="3001197">.</span><span class="ident" id="3001198">literalFreq</span><span class="op" id="3001209">[</span><span class="ident" id="3001210">numLiterals</span><span class="op" id="3001221">-</span><span class="num" id="3001222">1</span><span class="op" id="3001223">]</span>&nbsp;<span class="op" id="3001225">==</span>&nbsp;<span class="num" id="3001228">0</span>&nbsp;<span class="op" id="3001230">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001234">numLiterals</span><span class="op" id="3001245">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3001252">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001282">numOffsets</span>&nbsp;<span class="op" id="3001293">:=</span>&nbsp;<span class="builtinfunc" id="3001296">len</span><span class="op" id="3001299">(</span><span class="ident" id="3001300">w</span><span class="op" id="3001301">.</span><span class="ident" id="3001302">offsetFreq</span><span class="op" id="3001312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001315">for</span>&nbsp;<span class="ident" id="3001319">numOffsets</span>&nbsp;<span class="op" id="3001330">&gt;</span>&nbsp;<span class="num" id="3001332">0</span>&nbsp;<span class="op" id="3001334">&amp;&amp;</span>&nbsp;<span class="ident" id="3001337">w</span><span class="op" id="3001338">.</span><span class="ident" id="3001339">offsetFreq</span><span class="op" id="3001349">[</span><span class="ident" id="3001350">numOffsets</span><span class="op" id="3001360">-</span><span class="num" id="3001361">1</span><span class="op" id="3001362">]</span>&nbsp;<span class="op" id="3001364">==</span>&nbsp;<span class="num" id="3001367">0</span>&nbsp;<span class="op" id="3001369">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001373">numOffsets</span><span class="op" id="3001383">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001390">if</span>&nbsp;<span class="ident" id="3001393">numOffsets</span>&nbsp;<span class="op" id="3001404">==</span>&nbsp;<span class="num" id="3001407">0</span>&nbsp;<span class="op" id="3001409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3001413">//&nbsp;We&nbsp;haven&#39;t&nbsp;found&nbsp;a&nbsp;single&nbsp;match.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;go&nbsp;with&nbsp;the&nbsp;dynamic&nbsp;encoding,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3001495">//&nbsp;we&nbsp;should&nbsp;count&nbsp;at&nbsp;least&nbsp;one&nbsp;offset&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;the&nbsp;offset&nbsp;huffman&nbsp;tree&nbsp;could&nbsp;be&nbsp;encoded.</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001594">w</span><span class="op" id="3001595">.</span><span class="ident" id="3001596">offsetFreq</span><span class="op" id="3001606">[</span><span class="num" id="3001607">0</span><span class="op" id="3001608">]</span>&nbsp;<span class="op" id="3001610">=</span>&nbsp;<span class="num" id="3001612">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001616">numOffsets</span>&nbsp;<span class="op" id="3001627">=</span>&nbsp;<span class="num" id="3001629">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001636">w</span><span class="op" id="3001637">.</span><span class="ident" id="3001638">literalEncoding</span><span class="op" id="3001653">.</span><span class="ident" id="3001654">generate</span><span class="op" id="3001662">(</span><span class="ident" id="3001663">w</span><span class="op" id="3001664">.</span><span class="ident" id="3001665">literalFreq</span><span class="op" id="3001676">,</span>&nbsp;<span class="num" id="3001678">15</span><span class="op" id="3001680">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001683">w</span><span class="op" id="3001684">.</span><span class="ident" id="3001685">offsetEncoding</span><span class="op" id="3001699">.</span><span class="ident" id="3001700">generate</span><span class="op" id="3001708">(</span><span class="ident" id="3001709">w</span><span class="op" id="3001710">.</span><span class="ident" id="3001711">offsetFreq</span><span class="op" id="3001721">,</span>&nbsp;<span class="num" id="3001723">15</span><span class="op" id="3001725">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001729">storedBytes</span>&nbsp;<span class="op" id="3001741">:=</span>&nbsp;<span class="num" id="3001744">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001747">if</span>&nbsp;<span class="ident" id="3001750">input</span>&nbsp;<span class="op" id="3001756">!=</span>&nbsp;<span class="ident" id="3001759">nil</span>&nbsp;<span class="op" id="3001763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001767">storedBytes</span>&nbsp;<span class="op" id="3001779">=</span>&nbsp;<span class="builtinfunc" id="3001781">len</span><span class="op" id="3001784">(</span><span class="ident" id="3001785">input</span><span class="op" id="3001790">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001796">var</span>&nbsp;<span class="ident" id="3001800">extraBits</span>&nbsp;<span class="ident" id="3001810">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001817">var</span>&nbsp;<span class="ident" id="3001821">storedSize</span>&nbsp;<span class="ident" id="3001832">int64</span>&nbsp;<span class="op" id="3001838">=</span>&nbsp;<span class="ident" id="3001840">math</span><span class="op" id="3001844">.</span><span class="ident" id="3001845">MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001855">if</span>&nbsp;<span class="ident" id="3001858">storedBytes</span>&nbsp;<span class="op" id="3001870">&lt;=</span>&nbsp;<span class="ident" id="3001873">maxStoreBlockSize</span>&nbsp;<span class="op" id="3001891">&amp;&amp;</span>&nbsp;<span class="ident" id="3001894">input</span>&nbsp;<span class="op" id="3001900">!=</span>&nbsp;<span class="ident" id="3001903">nil</span>&nbsp;<span class="op" id="3001907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001911">storedSize</span>&nbsp;<span class="op" id="3001922">=</span>&nbsp;<span class="ident" id="3001924">int64</span><span class="op" id="3001929">(</span><span class="op" id="3001930">(</span><span class="ident" id="3001931">storedBytes</span>&nbsp;<span class="op" id="3001943">+</span>&nbsp;<span class="num" id="3001945">5</span><span class="op" id="3001946">)</span>&nbsp;<span class="op" id="3001948">*</span>&nbsp;<span class="num" id="3001950">8</span><span class="op" id="3001951">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3001955">//&nbsp;We&nbsp;only&nbsp;bother&nbsp;calculating&nbsp;the&nbsp;costs&nbsp;of&nbsp;the&nbsp;extra&nbsp;bits&nbsp;required&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3002027">//&nbsp;the&nbsp;length&nbsp;of&nbsp;offset&nbsp;fields&nbsp;(which&nbsp;will&nbsp;be&nbsp;the&nbsp;same&nbsp;for&nbsp;both&nbsp;fixed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3002099">//&nbsp;and&nbsp;dynamic&nbsp;encoding),&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;compare&nbsp;those&nbsp;two&nbsp;encodings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3002169">//&nbsp;against&nbsp;stored&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002199">for</span>&nbsp;<span class="ident" id="3002203">lengthCode</span>&nbsp;<span class="op" id="3002214">:=</span>&nbsp;<span class="ident" id="3002217">lengthCodesStart</span>&nbsp;<span class="op" id="3002234">+</span>&nbsp;<span class="num" id="3002236">8</span><span class="op" id="3002237">;</span>&nbsp;<span class="ident" id="3002239">lengthCode</span>&nbsp;<span class="op" id="3002250">&lt;</span>&nbsp;<span class="ident" id="3002252">numLiterals</span><span class="op" id="3002263">;</span>&nbsp;<span class="ident" id="3002265">lengthCode</span><span class="op" id="3002275">++</span>&nbsp;<span class="op" id="3002278">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3002283">//&nbsp;First&nbsp;eight&nbsp;length&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002335">extraBits</span>&nbsp;<span class="op" id="3002345">+=</span>&nbsp;<span class="ident" id="3002348">int64</span><span class="op" id="3002353">(</span><span class="ident" id="3002354">w</span><span class="op" id="3002355">.</span><span class="ident" id="3002356">literalFreq</span><span class="op" id="3002367">[</span><span class="ident" id="3002368">lengthCode</span><span class="op" id="3002378">]</span><span class="op" id="3002379">)</span>&nbsp;<span class="op" id="3002381">*</span>&nbsp;<span class="ident" id="3002383">int64</span><span class="op" id="3002388">(</span><span class="ident" id="3002389">lengthExtraBits</span><span class="op" id="3002404">[</span><span class="ident" id="3002405">lengthCode</span><span class="op" id="3002415">-</span><span class="ident" id="3002416">lengthCodesStart</span><span class="op" id="3002432">]</span><span class="op" id="3002433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3002437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002441">for</span>&nbsp;<span class="ident" id="3002445">offsetCode</span>&nbsp;<span class="op" id="3002456">:=</span>&nbsp;<span class="num" id="3002459">4</span><span class="op" id="3002460">;</span>&nbsp;<span class="ident" id="3002462">offsetCode</span>&nbsp;<span class="op" id="3002473">&lt;</span>&nbsp;<span class="ident" id="3002475">numOffsets</span><span class="op" id="3002485">;</span>&nbsp;<span class="ident" id="3002487">offsetCode</span><span class="op" id="3002497">++</span>&nbsp;<span class="op" id="3002500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3002505">//&nbsp;First&nbsp;four&nbsp;offset&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002556">extraBits</span>&nbsp;<span class="op" id="3002566">+=</span>&nbsp;<span class="ident" id="3002569">int64</span><span class="op" id="3002574">(</span><span class="ident" id="3002575">w</span><span class="op" id="3002576">.</span><span class="ident" id="3002577">offsetFreq</span><span class="op" id="3002587">[</span><span class="ident" id="3002588">offsetCode</span><span class="op" id="3002598">]</span><span class="op" id="3002599">)</span>&nbsp;<span class="op" id="3002601">*</span>&nbsp;<span class="ident" id="3002603">int64</span><span class="op" id="3002608">(</span><span class="ident" id="3002609">offsetExtraBits</span><span class="op" id="3002624">[</span><span class="ident" id="3002625">offsetCode</span><span class="op" id="3002635">]</span><span class="op" id="3002636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3002640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3002643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3002647">//&nbsp;Figure&nbsp;out&nbsp;smallest&nbsp;code.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3002677">//&nbsp;Fixed&nbsp;Huffman&nbsp;baseline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002705">var</span>&nbsp;<span class="ident" id="3002709">size</span>&nbsp;<span class="op" id="3002714">=</span>&nbsp;<span class="ident" id="3002716">int64</span><span class="op" id="3002721">(</span><span class="num" id="3002722">3</span><span class="op" id="3002723">)</span>&nbsp;<span class="op" id="3002725">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002729">fixedLiteralEncoding</span><span class="op" id="3002749">.</span><span class="ident" id="3002750">bitLength</span><span class="op" id="3002759">(</span><span class="ident" id="3002760">w</span><span class="op" id="3002761">.</span><span class="ident" id="3002762">literalFreq</span><span class="op" id="3002773">)</span>&nbsp;<span class="op" id="3002775">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002779">fixedOffsetEncoding</span><span class="op" id="3002798">.</span><span class="ident" id="3002799">bitLength</span><span class="op" id="3002808">(</span><span class="ident" id="3002809">w</span><span class="op" id="3002810">.</span><span class="ident" id="3002811">offsetFreq</span><span class="op" id="3002821">)</span>&nbsp;<span class="op" id="3002823">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3002827">extraBits</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002838">var</span>&nbsp;<span class="ident" id="3002842">literalEncoding</span>&nbsp;<span class="op" id="3002858">=</span>&nbsp;<span class="ident" id="3002860">fixedLiteralEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002882">var</span>&nbsp;<span class="ident" id="3002886">offsetEncoding</span>&nbsp;<span class="op" id="3002901">=</span>&nbsp;<span class="ident" id="3002903">fixedOffsetEncoding</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3002925">//&nbsp;Dynamic&nbsp;Huffman?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3002946">var</span>&nbsp;<span class="ident" id="3002950">numCodegens</span>&nbsp;<span class="builtintype" id="3002962">int</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3002968">//&nbsp;Generate&nbsp;codegen&nbsp;and&nbsp;codegenFrequencies,&nbsp;which&nbsp;indicates&nbsp;how&nbsp;to&nbsp;encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3003043">//&nbsp;the&nbsp;literalEncoding&nbsp;and&nbsp;the&nbsp;offsetEncoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003091">w</span><span class="op" id="3003092">.</span><span class="ident" id="3003093">generateCodegen</span><span class="op" id="3003108">(</span><span class="ident" id="3003109">numLiterals</span><span class="op" id="3003120">,</span>&nbsp;<span class="ident" id="3003122">numOffsets</span><span class="op" id="3003132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003135">w</span><span class="op" id="3003136">.</span><span class="ident" id="3003137">codegenEncoding</span><span class="op" id="3003152">.</span><span class="ident" id="3003153">generate</span><span class="op" id="3003161">(</span><span class="ident" id="3003162">w</span><span class="op" id="3003163">.</span><span class="ident" id="3003164">codegenFreq</span><span class="op" id="3003175">,</span>&nbsp;<span class="num" id="3003177">7</span><span class="op" id="3003178">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003181">numCodegens</span>&nbsp;<span class="op" id="3003193">=</span>&nbsp;<span class="builtinfunc" id="3003195">len</span><span class="op" id="3003198">(</span><span class="ident" id="3003199">w</span><span class="op" id="3003200">.</span><span class="ident" id="3003201">codegenFreq</span><span class="op" id="3003212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003215">for</span>&nbsp;<span class="ident" id="3003219">numCodegens</span>&nbsp;<span class="op" id="3003231">&gt;</span>&nbsp;<span class="num" id="3003233">4</span>&nbsp;<span class="op" id="3003235">&amp;&amp;</span>&nbsp;<span class="ident" id="3003238">w</span><span class="op" id="3003239">.</span><span class="ident" id="3003240">codegenFreq</span><span class="op" id="3003251">[</span><span class="ident" id="3003252">codegenOrder</span><span class="op" id="3003264">[</span><span class="ident" id="3003265">numCodegens</span><span class="op" id="3003276">-</span><span class="num" id="3003277">1</span><span class="op" id="3003278">]</span><span class="op" id="3003279">]</span>&nbsp;<span class="op" id="3003281">==</span>&nbsp;<span class="num" id="3003284">0</span>&nbsp;<span class="op" id="3003286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003290">numCodegens</span><span class="op" id="3003301">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003308">dynamicHeader</span>&nbsp;<span class="op" id="3003322">:=</span>&nbsp;<span class="ident" id="3003325">int64</span><span class="op" id="3003330">(</span><span class="num" id="3003331">3</span><span class="op" id="3003332">+</span><span class="num" id="3003333">5</span><span class="op" id="3003334">+</span><span class="num" id="3003335">5</span><span class="op" id="3003336">+</span><span class="num" id="3003337">4</span><span class="op" id="3003338">+</span><span class="op" id="3003339">(</span><span class="num" id="3003340">3</span><span class="op" id="3003341">*</span><span class="ident" id="3003342">numCodegens</span><span class="op" id="3003353">)</span><span class="op" id="3003354">)</span>&nbsp;<span class="op" id="3003356">+</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003360">w</span><span class="op" id="3003361">.</span><span class="ident" id="3003362">codegenEncoding</span><span class="op" id="3003377">.</span><span class="ident" id="3003378">bitLength</span><span class="op" id="3003387">(</span><span class="ident" id="3003388">w</span><span class="op" id="3003389">.</span><span class="ident" id="3003390">codegenFreq</span><span class="op" id="3003401">)</span>&nbsp;<span class="op" id="3003403">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003407">int64</span><span class="op" id="3003412">(</span><span class="ident" id="3003413">extraBits</span><span class="op" id="3003422">)</span>&nbsp;<span class="op" id="3003424">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003428">int64</span><span class="op" id="3003433">(</span><span class="ident" id="3003434">w</span><span class="op" id="3003435">.</span><span class="ident" id="3003436">codegenFreq</span><span class="op" id="3003447">[</span><span class="num" id="3003448">16</span><span class="op" id="3003450">]</span><span class="op" id="3003451">*</span><span class="num" id="3003452">2</span><span class="op" id="3003453">)</span>&nbsp;<span class="op" id="3003455">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003459">int64</span><span class="op" id="3003464">(</span><span class="ident" id="3003465">w</span><span class="op" id="3003466">.</span><span class="ident" id="3003467">codegenFreq</span><span class="op" id="3003478">[</span><span class="num" id="3003479">17</span><span class="op" id="3003481">]</span><span class="op" id="3003482">*</span><span class="num" id="3003483">3</span><span class="op" id="3003484">)</span>&nbsp;<span class="op" id="3003486">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003490">int64</span><span class="op" id="3003495">(</span><span class="ident" id="3003496">w</span><span class="op" id="3003497">.</span><span class="ident" id="3003498">codegenFreq</span><span class="op" id="3003509">[</span><span class="num" id="3003510">18</span><span class="op" id="3003512">]</span><span class="op" id="3003513">*</span><span class="num" id="3003514">7</span><span class="op" id="3003515">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003518">dynamicSize</span>&nbsp;<span class="op" id="3003530">:=</span>&nbsp;<span class="ident" id="3003533">dynamicHeader</span>&nbsp;<span class="op" id="3003547">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003551">w</span><span class="op" id="3003552">.</span><span class="ident" id="3003553">literalEncoding</span><span class="op" id="3003568">.</span><span class="ident" id="3003569">bitLength</span><span class="op" id="3003578">(</span><span class="ident" id="3003579">w</span><span class="op" id="3003580">.</span><span class="ident" id="3003581">literalFreq</span><span class="op" id="3003592">)</span>&nbsp;<span class="op" id="3003594">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003598">w</span><span class="op" id="3003599">.</span><span class="ident" id="3003600">offsetEncoding</span><span class="op" id="3003614">.</span><span class="ident" id="3003615">bitLength</span><span class="op" id="3003624">(</span><span class="ident" id="3003625">w</span><span class="op" id="3003626">.</span><span class="ident" id="3003627">offsetFreq</span><span class="op" id="3003637">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003641">if</span>&nbsp;<span class="ident" id="3003644">dynamicSize</span>&nbsp;<span class="op" id="3003656">&lt;</span>&nbsp;<span class="ident" id="3003658">size</span>&nbsp;<span class="op" id="3003663">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003667">size</span>&nbsp;<span class="op" id="3003672">=</span>&nbsp;<span class="ident" id="3003674">dynamicSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003688">literalEncoding</span>&nbsp;<span class="op" id="3003704">=</span>&nbsp;<span class="ident" id="3003706">w</span><span class="op" id="3003707">.</span><span class="ident" id="3003708">literalEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003726">offsetEncoding</span>&nbsp;<span class="op" id="3003741">=</span>&nbsp;<span class="ident" id="3003743">w</span><span class="op" id="3003744">.</span><span class="ident" id="3003745">offsetEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3003765">//&nbsp;Stored&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003783">if</span>&nbsp;<span class="ident" id="3003786">storedSize</span>&nbsp;<span class="op" id="3003797">&lt;</span>&nbsp;<span class="ident" id="3003799">size</span>&nbsp;<span class="op" id="3003804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003808">w</span><span class="op" id="3003809">.</span><span class="ident" id="3003810">writeStoredHeader</span><span class="op" id="3003827">(</span><span class="ident" id="3003828">storedBytes</span><span class="op" id="3003839">,</span>&nbsp;<span class="ident" id="3003841">eof</span><span class="op" id="3003844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003848">w</span><span class="op" id="3003849">.</span><span class="ident" id="3003850">writeBytes</span><span class="op" id="3003860">(</span><span class="ident" id="3003861">input</span><span class="op" id="3003866">[</span><span class="num" id="3003867">0</span><span class="op" id="3003868">:</span><span class="ident" id="3003869">storedBytes</span><span class="op" id="3003880">]</span><span class="op" id="3003881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003885">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3003897">//&nbsp;Huffman.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3003910">if</span>&nbsp;<span class="ident" id="3003913">literalEncoding</span>&nbsp;<span class="op" id="3003929">==</span>&nbsp;<span class="ident" id="3003932">fixedLiteralEncoding</span>&nbsp;<span class="op" id="3003953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003957">w</span><span class="op" id="3003958">.</span><span class="ident" id="3003959">writeFixedHeader</span><span class="op" id="3003975">(</span><span class="ident" id="3003976">eof</span><span class="op" id="3003979">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3003982">}</span>&nbsp;<span class="keyword" id="3003984">else</span>&nbsp;<span class="op" id="3003989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3003993">w</span><span class="op" id="3003994">.</span><span class="ident" id="3003995">writeDynamicHeader</span><span class="op" id="3004013">(</span><span class="ident" id="3004014">numLiterals</span><span class="op" id="3004025">,</span>&nbsp;<span class="ident" id="3004027">numOffsets</span><span class="op" id="3004037">,</span>&nbsp;<span class="ident" id="3004039">numCodegens</span><span class="op" id="3004050">,</span>&nbsp;<span class="ident" id="3004052">eof</span><span class="op" id="3004055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004061">for</span>&nbsp;<span class="ident" id="3004065">_</span><span class="op" id="3004066">,</span>&nbsp;<span class="ident" id="3004068">t</span>&nbsp;<span class="op" id="3004070">:=</span>&nbsp;<span class="keyword" id="3004073">range</span>&nbsp;<span class="ident" id="3004079">tokens</span>&nbsp;<span class="op" id="3004086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004090">switch</span>&nbsp;<span class="ident" id="3004097">t</span><span class="op" id="3004098">.</span><span class="ident" id="3004099">typ</span><span class="op" id="3004102">(</span><span class="op" id="3004103">)</span>&nbsp;<span class="op" id="3004105">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004109">case</span>&nbsp;<span class="ident" id="3004114">literalType</span><span class="op" id="3004125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004130">w</span><span class="op" id="3004131">.</span><span class="ident" id="3004132">writeCode</span><span class="op" id="3004141">(</span><span class="ident" id="3004142">literalEncoding</span><span class="op" id="3004157">,</span>&nbsp;<span class="ident" id="3004159">t</span><span class="op" id="3004160">.</span><span class="ident" id="3004161">literal</span><span class="op" id="3004168">(</span><span class="op" id="3004169">)</span><span class="op" id="3004170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004175">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004183">case</span>&nbsp;<span class="ident" id="3004188">matchType</span><span class="op" id="3004197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3004202">//&nbsp;Write&nbsp;the&nbsp;length</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004225">length</span>&nbsp;<span class="op" id="3004232">:=</span>&nbsp;<span class="ident" id="3004235">t</span><span class="op" id="3004236">.</span><span class="ident" id="3004237">length</span><span class="op" id="3004243">(</span><span class="op" id="3004244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004249">lengthCode</span>&nbsp;<span class="op" id="3004260">:=</span>&nbsp;<span class="ident" id="3004263">lengthCode</span><span class="op" id="3004273">(</span><span class="ident" id="3004274">length</span><span class="op" id="3004280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004285">w</span><span class="op" id="3004286">.</span><span class="ident" id="3004287">writeCode</span><span class="op" id="3004296">(</span><span class="ident" id="3004297">literalEncoding</span><span class="op" id="3004312">,</span>&nbsp;<span class="ident" id="3004314">lengthCode</span><span class="op" id="3004324">+</span><span class="ident" id="3004325">lengthCodesStart</span><span class="op" id="3004341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004346">extraLengthBits</span>&nbsp;<span class="op" id="3004362">:=</span>&nbsp;<span class="builtintype" id="3004365">int32</span><span class="op" id="3004370">(</span><span class="ident" id="3004371">lengthExtraBits</span><span class="op" id="3004386">[</span><span class="ident" id="3004387">lengthCode</span><span class="op" id="3004397">]</span><span class="op" id="3004398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004403">if</span>&nbsp;<span class="ident" id="3004406">extraLengthBits</span>&nbsp;<span class="op" id="3004422">&gt;</span>&nbsp;<span class="num" id="3004424">0</span>&nbsp;<span class="op" id="3004426">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004432">extraLength</span>&nbsp;<span class="op" id="3004444">:=</span>&nbsp;<span class="builtintype" id="3004447">int32</span><span class="op" id="3004452">(</span><span class="ident" id="3004453">length</span>&nbsp;<span class="op" id="3004460">-</span>&nbsp;<span class="ident" id="3004462">lengthBase</span><span class="op" id="3004472">[</span><span class="ident" id="3004473">lengthCode</span><span class="op" id="3004483">]</span><span class="op" id="3004484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004490">w</span><span class="op" id="3004491">.</span><span class="ident" id="3004492">writeBits</span><span class="op" id="3004501">(</span><span class="ident" id="3004502">extraLength</span><span class="op" id="3004513">,</span>&nbsp;<span class="ident" id="3004515">extraLengthBits</span><span class="op" id="3004530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3004540">//&nbsp;Write&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004563">offset</span>&nbsp;<span class="op" id="3004570">:=</span>&nbsp;<span class="ident" id="3004573">t</span><span class="op" id="3004574">.</span><span class="ident" id="3004575">offset</span><span class="op" id="3004581">(</span><span class="op" id="3004582">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004587">offsetCode</span>&nbsp;<span class="op" id="3004598">:=</span>&nbsp;<span class="ident" id="3004601">offsetCode</span><span class="op" id="3004611">(</span><span class="ident" id="3004612">offset</span><span class="op" id="3004618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004623">w</span><span class="op" id="3004624">.</span><span class="ident" id="3004625">writeCode</span><span class="op" id="3004634">(</span><span class="ident" id="3004635">offsetEncoding</span><span class="op" id="3004649">,</span>&nbsp;<span class="ident" id="3004651">offsetCode</span><span class="op" id="3004661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004666">extraOffsetBits</span>&nbsp;<span class="op" id="3004682">:=</span>&nbsp;<span class="builtintype" id="3004685">int32</span><span class="op" id="3004690">(</span><span class="ident" id="3004691">offsetExtraBits</span><span class="op" id="3004706">[</span><span class="ident" id="3004707">offsetCode</span><span class="op" id="3004717">]</span><span class="op" id="3004718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004723">if</span>&nbsp;<span class="ident" id="3004726">extraOffsetBits</span>&nbsp;<span class="op" id="3004742">&gt;</span>&nbsp;<span class="num" id="3004744">0</span>&nbsp;<span class="op" id="3004746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004752">extraOffset</span>&nbsp;<span class="op" id="3004764">:=</span>&nbsp;<span class="builtintype" id="3004767">int32</span><span class="op" id="3004772">(</span><span class="ident" id="3004773">offset</span>&nbsp;<span class="op" id="3004780">-</span>&nbsp;<span class="ident" id="3004782">offsetBase</span><span class="op" id="3004792">[</span><span class="ident" id="3004793">offsetCode</span><span class="op" id="3004803">]</span><span class="op" id="3004804">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3004810">w</span><span class="op" id="3004811">.</span><span class="ident" id="3004812">writeBits</span><span class="op" id="3004821">(</span><span class="ident" id="3004822">extraOffset</span><span class="op" id="3004833">,</span>&nbsp;<span class="ident" id="3004835">extraOffsetBits</span><span class="op" id="3004850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004860">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3004868">default</span><span class="op" id="3004875">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3004880">panic</span><span class="op" id="3004885">(</span><span class="string" id="3004886">&#34;unknown&nbsp;token&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="3004909">+</span>&nbsp;<span class="builtintype" id="3004911">string</span><span class="op" id="3004917">(</span><span class="ident" id="3004918">t</span><span class="op" id="3004919">)</span><span class="op" id="3004920">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3004927">}</span><br>
<span class="lineno"></span><span class="op" id="3004929">}</span>
</div>
</body>
</html>
