<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7837418">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7837473">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7837527">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7837578">package</span>&nbsp;<span class="ident" id="7837586">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7837591">import</span>&nbsp;<span class="op" id="7837598">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7837601">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7837609">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7837616">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7837622">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7837633">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7837644">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7837654">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7837657">//&nbsp;If&nbsp;an&nbsp;IPv6&nbsp;tunnel&nbsp;is&nbsp;running,&nbsp;we&nbsp;can&nbsp;try&nbsp;dialing&nbsp;a&nbsp;real&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="7837730">var</span>&nbsp;<span class="ident" id="7837734">testIPv6</span>&nbsp;<span class="op" id="7837743">=</span>&nbsp;<span class="ident" id="7837745">flag</span><span class="op" id="7837749">.</span><span class="ident" id="7837750">Bool</span><span class="op" id="7837754">(</span><span class="string" id="7837755">&#34;ipv6&#34;</span><span class="op" id="7837761">,</span>&nbsp;<span class="builtintype" id="7837763">false</span><span class="op" id="7837768">,</span>&nbsp;<span class="string" id="7837770">&#34;assume&nbsp;ipv6&nbsp;tunnel&nbsp;is&nbsp;present&#34;</span><span class="op" id="7837801">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7837804">func</span>&nbsp;<span class="ident" id="7837809">TestResolveGoogle</span><span class="op" id="7837826">(</span><span class="ident" id="7837827">t</span>&nbsp;<span class="op" id="7837829">*</span><span class="ident" id="7837830">testing</span><span class="op" id="7837837">.</span><span class="ident" id="7837838">T</span><span class="op" id="7837839">)</span>&nbsp;<span class="op" id="7837841">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837844">if</span>&nbsp;<span class="ident" id="7837847">testing</span><span class="op" id="7837854">.</span><span class="ident" id="7837855">Short</span><span class="op" id="7837860">(</span><span class="op" id="7837861">)</span>&nbsp;<span class="op" id="7837863">||</span>&nbsp;<span class="op" id="7837866">!</span><span class="op" id="7837867">*</span><span class="ident" id="7837868">testExternal</span>&nbsp;<span class="op" id="7837881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837885">t</span><span class="op" id="7837886">.</span><span class="ident" id="7837887">Skip</span><span class="op" id="7837891">(</span><span class="string" id="7837892">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7837933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837940">for</span>&nbsp;<span class="ident" id="7837944">_</span><span class="op" id="7837945">,</span>&nbsp;<span class="ident" id="7837947">network</span>&nbsp;<span class="op" id="7837955">:=</span>&nbsp;<span class="keyword" id="7837958">range</span>&nbsp;<span class="op" id="7837964">[</span><span class="op" id="7837965">]</span><span class="builtintype" id="7837966">string</span><span class="op" id="7837972">{</span><span class="string" id="7837973">&#34;tcp&#34;</span><span class="op" id="7837978">,</span>&nbsp;<span class="string" id="7837980">&#34;tcp4&#34;</span><span class="op" id="7837986">,</span>&nbsp;<span class="string" id="7837988">&#34;tcp6&#34;</span><span class="op" id="7837994">}</span>&nbsp;<span class="op" id="7837996">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838000">addr</span><span class="op" id="7838004">,</span>&nbsp;<span class="ident" id="7838006">err</span>&nbsp;<span class="op" id="7838010">:=</span>&nbsp;<span class="ident" id="7838013">ResolveTCPAddr</span><span class="op" id="7838027">(</span><span class="ident" id="7838028">network</span><span class="op" id="7838035">,</span>&nbsp;<span class="string" id="7838037">&#34;www.google.com:http&#34;</span><span class="op" id="7838058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838062">if</span>&nbsp;<span class="ident" id="7838065">err</span>&nbsp;<span class="op" id="7838069">!=</span>&nbsp;<span class="ident" id="7838072">nil</span>&nbsp;<span class="op" id="7838076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838081">if</span>&nbsp;<span class="op" id="7838084">(</span><span class="ident" id="7838085">network</span>&nbsp;<span class="op" id="7838093">==</span>&nbsp;<span class="string" id="7838096">&#34;tcp&#34;</span>&nbsp;<span class="op" id="7838102">||</span>&nbsp;<span class="ident" id="7838105">network</span>&nbsp;<span class="op" id="7838113">==</span>&nbsp;<span class="string" id="7838116">&#34;tcp4&#34;</span><span class="op" id="7838122">)</span>&nbsp;<span class="op" id="7838124">&amp;&amp;</span>&nbsp;<span class="op" id="7838127">!</span><span class="ident" id="7838128">supportsIPv4</span>&nbsp;<span class="op" id="7838141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838147">t</span><span class="op" id="7838148">.</span><span class="ident" id="7838149">Logf</span><span class="op" id="7838153">(</span><span class="string" id="7838154">&#34;ipv4&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="7838181">,</span>&nbsp;<span class="ident" id="7838183">err</span><span class="op" id="7838186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838191">}</span>&nbsp;<span class="keyword" id="7838193">else</span>&nbsp;<span class="keyword" id="7838198">if</span>&nbsp;<span class="ident" id="7838201">network</span>&nbsp;<span class="op" id="7838209">==</span>&nbsp;<span class="string" id="7838212">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="7838219">&amp;&amp;</span>&nbsp;<span class="op" id="7838222">!</span><span class="ident" id="7838223">supportsIPv6</span>&nbsp;<span class="op" id="7838236">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838242">t</span><span class="op" id="7838243">.</span><span class="ident" id="7838244">Logf</span><span class="op" id="7838248">(</span><span class="string" id="7838249">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="7838276">,</span>&nbsp;<span class="ident" id="7838278">err</span><span class="op" id="7838281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838286">}</span>&nbsp;<span class="keyword" id="7838288">else</span>&nbsp;<span class="op" id="7838293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838299">t</span><span class="op" id="7838300">.</span><span class="ident" id="7838301">Errorf</span><span class="op" id="7838307">(</span><span class="string" id="7838308">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7838335">,</span>&nbsp;<span class="ident" id="7838337">err</span><span class="op" id="7838340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838350">continue</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838365">if</span>&nbsp;<span class="op" id="7838368">(</span><span class="ident" id="7838369">network</span>&nbsp;<span class="op" id="7838377">==</span>&nbsp;<span class="string" id="7838380">&#34;tcp&#34;</span>&nbsp;<span class="op" id="7838386">||</span>&nbsp;<span class="ident" id="7838389">network</span>&nbsp;<span class="op" id="7838397">==</span>&nbsp;<span class="string" id="7838400">&#34;tcp4&#34;</span><span class="op" id="7838406">)</span>&nbsp;<span class="op" id="7838408">&amp;&amp;</span>&nbsp;<span class="ident" id="7838411">addr</span><span class="op" id="7838415">.</span><span class="ident" id="7838416">IP</span><span class="op" id="7838418">.</span><span class="ident" id="7838419">To4</span><span class="op" id="7838422">(</span><span class="op" id="7838423">)</span>&nbsp;<span class="op" id="7838425">==</span>&nbsp;<span class="ident" id="7838428">nil</span>&nbsp;<span class="op" id="7838432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838437">t</span><span class="op" id="7838438">.</span><span class="ident" id="7838439">Errorf</span><span class="op" id="7838445">(</span><span class="string" id="7838446">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="7838486">,</span>&nbsp;<span class="ident" id="7838488">addr</span><span class="op" id="7838492">,</span>&nbsp;<span class="ident" id="7838494">network</span><span class="op" id="7838501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838505">}</span>&nbsp;<span class="keyword" id="7838507">else</span>&nbsp;<span class="keyword" id="7838512">if</span>&nbsp;<span class="ident" id="7838515">network</span>&nbsp;<span class="op" id="7838523">==</span>&nbsp;<span class="string" id="7838526">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="7838533">&amp;&amp;</span>&nbsp;<span class="op" id="7838536">(</span><span class="ident" id="7838537">addr</span><span class="op" id="7838541">.</span><span class="ident" id="7838542">IP</span><span class="op" id="7838544">.</span><span class="ident" id="7838545">To16</span><span class="op" id="7838549">(</span><span class="op" id="7838550">)</span>&nbsp;<span class="op" id="7838552">==</span>&nbsp;<span class="ident" id="7838555">nil</span>&nbsp;<span class="op" id="7838559">||</span>&nbsp;<span class="ident" id="7838562">addr</span><span class="op" id="7838566">.</span><span class="ident" id="7838567">IP</span><span class="op" id="7838569">.</span><span class="ident" id="7838570">To4</span><span class="op" id="7838573">(</span><span class="op" id="7838574">)</span>&nbsp;<span class="op" id="7838576">!=</span>&nbsp;<span class="ident" id="7838579">nil</span><span class="op" id="7838582">)</span>&nbsp;<span class="op" id="7838584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838589">t</span><span class="op" id="7838590">.</span><span class="ident" id="7838591">Errorf</span><span class="op" id="7838597">(</span><span class="string" id="7838598">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="7838638">,</span>&nbsp;<span class="ident" id="7838640">addr</span><span class="op" id="7838644">,</span>&nbsp;<span class="ident" id="7838646">network</span><span class="op" id="7838653">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838660">}</span><br>
<span class="lineno"></span><span class="op" id="7838662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7838665">func</span>&nbsp;<span class="ident" id="7838670">TestDialGoogle</span><span class="op" id="7838684">(</span><span class="ident" id="7838685">t</span>&nbsp;<span class="op" id="7838687">*</span><span class="ident" id="7838688">testing</span><span class="op" id="7838695">.</span><span class="ident" id="7838696">T</span><span class="op" id="7838697">)</span>&nbsp;<span class="op" id="7838699">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838702">if</span>&nbsp;<span class="ident" id="7838705">testing</span><span class="op" id="7838712">.</span><span class="ident" id="7838713">Short</span><span class="op" id="7838718">(</span><span class="op" id="7838719">)</span>&nbsp;<span class="op" id="7838721">||</span>&nbsp;<span class="op" id="7838724">!</span><span class="op" id="7838725">*</span><span class="ident" id="7838726">testExternal</span>&nbsp;<span class="op" id="7838739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838743">t</span><span class="op" id="7838744">.</span><span class="ident" id="7838745">Skip</span><span class="op" id="7838749">(</span><span class="string" id="7838750">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7838791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838798">d</span>&nbsp;<span class="op" id="7838800">:=</span>&nbsp;<span class="op" id="7838803">&amp;</span><span class="ident" id="7838804">Dialer</span><span class="op" id="7838810">{</span><span class="ident" id="7838811">DualStack</span><span class="op" id="7838820">:</span>&nbsp;<span class="builtintype" id="7838822">true</span><span class="op" id="7838826">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838829">for</span>&nbsp;<span class="ident" id="7838833">_</span><span class="op" id="7838834">,</span>&nbsp;<span class="ident" id="7838836">network</span>&nbsp;<span class="op" id="7838844">:=</span>&nbsp;<span class="keyword" id="7838847">range</span>&nbsp;<span class="op" id="7838853">[</span><span class="op" id="7838854">]</span><span class="builtintype" id="7838855">string</span><span class="op" id="7838861">{</span><span class="string" id="7838862">&#34;tcp&#34;</span><span class="op" id="7838867">,</span>&nbsp;<span class="string" id="7838869">&#34;tcp4&#34;</span><span class="op" id="7838875">,</span>&nbsp;<span class="string" id="7838877">&#34;tcp6&#34;</span><span class="op" id="7838883">}</span>&nbsp;<span class="op" id="7838885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838889">if</span>&nbsp;<span class="ident" id="7838892">network</span>&nbsp;<span class="op" id="7838900">==</span>&nbsp;<span class="string" id="7838903">&#34;tcp&#34;</span>&nbsp;<span class="op" id="7838909">&amp;&amp;</span>&nbsp;<span class="op" id="7838912">!</span><span class="ident" id="7838913">supportsIPv4</span>&nbsp;<span class="op" id="7838926">&amp;&amp;</span>&nbsp;<span class="op" id="7838929">!</span><span class="ident" id="7838930">supportsIPv6</span>&nbsp;<span class="op" id="7838943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838948">t</span><span class="op" id="7838949">.</span><span class="ident" id="7838950">Logf</span><span class="op" id="7838954">(</span><span class="string" id="7838955">&#34;skipping&nbsp;test;&nbsp;both&nbsp;ipv4&nbsp;and&nbsp;ipv6&nbsp;are&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7839008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839013">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839024">}</span>&nbsp;<span class="keyword" id="7839026">else</span>&nbsp;<span class="keyword" id="7839031">if</span>&nbsp;<span class="ident" id="7839034">network</span>&nbsp;<span class="op" id="7839042">==</span>&nbsp;<span class="string" id="7839045">&#34;tcp4&#34;</span>&nbsp;<span class="op" id="7839052">&amp;&amp;</span>&nbsp;<span class="op" id="7839055">!</span><span class="ident" id="7839056">supportsIPv4</span>&nbsp;<span class="op" id="7839069">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839074">t</span><span class="op" id="7839075">.</span><span class="ident" id="7839076">Logf</span><span class="op" id="7839080">(</span><span class="string" id="7839081">&#34;skipping&nbsp;test;&nbsp;ipv4&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7839119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839124">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839135">}</span>&nbsp;<span class="keyword" id="7839137">else</span>&nbsp;<span class="keyword" id="7839142">if</span>&nbsp;<span class="ident" id="7839145">network</span>&nbsp;<span class="op" id="7839153">==</span>&nbsp;<span class="string" id="7839156">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="7839163">&amp;&amp;</span>&nbsp;<span class="op" id="7839166">!</span><span class="ident" id="7839167">supportsIPv6</span>&nbsp;<span class="op" id="7839180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839185">t</span><span class="op" id="7839186">.</span><span class="ident" id="7839187">Logf</span><span class="op" id="7839191">(</span><span class="string" id="7839192">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7839230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839235">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839246">}</span>&nbsp;<span class="keyword" id="7839248">else</span>&nbsp;<span class="keyword" id="7839253">if</span>&nbsp;<span class="ident" id="7839256">network</span>&nbsp;<span class="op" id="7839264">==</span>&nbsp;<span class="string" id="7839267">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="7839274">&amp;&amp;</span>&nbsp;<span class="op" id="7839277">!</span><span class="op" id="7839278">*</span><span class="ident" id="7839279">testIPv6</span>&nbsp;<span class="op" id="7839288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839293">t</span><span class="op" id="7839294">.</span><span class="ident" id="7839295">Logf</span><span class="op" id="7839299">(</span><span class="string" id="7839300">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="7839336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839341">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839356">if</span>&nbsp;<span class="ident" id="7839359">c</span><span class="op" id="7839360">,</span>&nbsp;<span class="ident" id="7839362">err</span>&nbsp;<span class="op" id="7839366">:=</span>&nbsp;<span class="ident" id="7839369">d</span><span class="op" id="7839370">.</span><span class="ident" id="7839371">Dial</span><span class="op" id="7839375">(</span><span class="ident" id="7839376">network</span><span class="op" id="7839383">,</span>&nbsp;<span class="string" id="7839385">&#34;www.google.com:http&#34;</span><span class="op" id="7839406">)</span><span class="op" id="7839407">;</span>&nbsp;<span class="ident" id="7839409">err</span>&nbsp;<span class="op" id="7839413">!=</span>&nbsp;<span class="ident" id="7839416">nil</span>&nbsp;<span class="op" id="7839420">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839425">t</span><span class="op" id="7839426">.</span><span class="ident" id="7839427">Errorf</span><span class="op" id="7839433">(</span><span class="string" id="7839434">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7839451">,</span>&nbsp;<span class="ident" id="7839453">err</span><span class="op" id="7839456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839460">}</span>&nbsp;<span class="keyword" id="7839462">else</span>&nbsp;<span class="op" id="7839467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839472">c</span><span class="op" id="7839473">.</span><span class="ident" id="7839474">Close</span><span class="op" id="7839479">(</span><span class="op" id="7839480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839487">}</span><br>
<span class="lineno">70</span><span class="op" id="7839489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7839492">//&nbsp;fd&nbsp;is&nbsp;already&nbsp;connected&nbsp;to&nbsp;the&nbsp;destination,&nbsp;port&nbsp;80.</span><br>
<span class="lineno"></span><span class="comment" id="7839548">//&nbsp;Run&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;to&nbsp;fetch&nbsp;the&nbsp;appropriate&nbsp;page.</span><br>
<span class="lineno"></span><span class="keyword" id="7839602">func</span>&nbsp;<span class="ident" id="7839607">fetchGoogle</span><span class="op" id="7839618">(</span><span class="ident" id="7839619">t</span>&nbsp;<span class="op" id="7839621">*</span><span class="ident" id="7839622">testing</span><span class="op" id="7839629">.</span><span class="ident" id="7839630">T</span><span class="op" id="7839631">,</span>&nbsp;<span class="ident" id="7839633">fd</span>&nbsp;<span class="ident" id="7839636">Conn</span><span class="op" id="7839640">,</span>&nbsp;<span class="ident" id="7839642">network</span><span class="op" id="7839649">,</span>&nbsp;<span class="ident" id="7839651">addr</span>&nbsp;<span class="builtintype" id="7839656">string</span><span class="op" id="7839662">)</span>&nbsp;<span class="op" id="7839664">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839667">req</span>&nbsp;<span class="op" id="7839671">:=</span>&nbsp;<span class="op" id="7839674">[</span><span class="op" id="7839675">]</span><span class="builtintype" id="7839676">byte</span><span class="op" id="7839680">(</span><span class="string" id="7839681">&#34;GET&nbsp;/robots.txt&nbsp;HTTP/1.0\r\nHost:&nbsp;www.google.com\r\n\r\n&#34;</span><span class="op" id="7839739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839742">n</span><span class="op" id="7839743">,</span>&nbsp;<span class="ident" id="7839745">err</span>&nbsp;<span class="op" id="7839749">:=</span>&nbsp;<span class="ident" id="7839752">fd</span><span class="op" id="7839754">.</span><span class="ident" id="7839755">Write</span><span class="op" id="7839760">(</span><span class="ident" id="7839761">req</span><span class="op" id="7839764">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839768">buf</span>&nbsp;<span class="op" id="7839772">:=</span>&nbsp;<span class="builtinfunc" id="7839775">make</span><span class="op" id="7839779">(</span><span class="op" id="7839780">[</span><span class="op" id="7839781">]</span><span class="builtintype" id="7839782">byte</span><span class="op" id="7839786">,</span>&nbsp;<span class="num" id="7839788">1000</span><span class="op" id="7839792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839795">n</span><span class="op" id="7839796">,</span>&nbsp;<span class="ident" id="7839798">err</span>&nbsp;<span class="op" id="7839802">=</span>&nbsp;<span class="ident" id="7839804">io</span><span class="op" id="7839806">.</span><span class="ident" id="7839807">ReadFull</span><span class="op" id="7839815">(</span><span class="ident" id="7839816">fd</span><span class="op" id="7839818">,</span>&nbsp;<span class="ident" id="7839820">buf</span><span class="op" id="7839823">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839827">if</span>&nbsp;<span class="ident" id="7839830">n</span>&nbsp;<span class="op" id="7839832">&lt;</span>&nbsp;<span class="num" id="7839834">1000</span>&nbsp;<span class="op" id="7839839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839843">t</span><span class="op" id="7839844">.</span><span class="ident" id="7839845">Errorf</span><span class="op" id="7839851">(</span><span class="string" id="7839852">&#34;fetchGoogle:&nbsp;short&nbsp;HTTP&nbsp;read&nbsp;from&nbsp;%s&nbsp;%s&nbsp;-&nbsp;%v&#34;</span><span class="op" id="7839898">,</span>&nbsp;<span class="ident" id="7839900">network</span><span class="op" id="7839907">,</span>&nbsp;<span class="ident" id="7839909">addr</span><span class="op" id="7839913">,</span>&nbsp;<span class="ident" id="7839915">err</span><span class="op" id="7839918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839922">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839930">}</span><br>
<span class="lineno">85</span><span class="op" id="7839932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7839935">func</span>&nbsp;<span class="ident" id="7839940">doDial</span><span class="op" id="7839946">(</span><span class="ident" id="7839947">t</span>&nbsp;<span class="op" id="7839949">*</span><span class="ident" id="7839950">testing</span><span class="op" id="7839957">.</span><span class="ident" id="7839958">T</span><span class="op" id="7839959">,</span>&nbsp;<span class="ident" id="7839961">network</span><span class="op" id="7839968">,</span>&nbsp;<span class="ident" id="7839970">addr</span>&nbsp;<span class="builtintype" id="7839975">string</span><span class="op" id="7839981">)</span>&nbsp;<span class="op" id="7839983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839986">fd</span><span class="op" id="7839988">,</span>&nbsp;<span class="ident" id="7839990">err</span>&nbsp;<span class="op" id="7839994">:=</span>&nbsp;<span class="ident" id="7839997">Dial</span><span class="op" id="7840001">(</span><span class="ident" id="7840002">network</span><span class="op" id="7840009">,</span>&nbsp;<span class="ident" id="7840011">addr</span><span class="op" id="7840015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840018">if</span>&nbsp;<span class="ident" id="7840021">err</span>&nbsp;<span class="op" id="7840025">!=</span>&nbsp;<span class="ident" id="7840028">nil</span>&nbsp;<span class="op" id="7840032">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840036">t</span><span class="op" id="7840037">.</span><span class="ident" id="7840038">Errorf</span><span class="op" id="7840044">(</span><span class="string" id="7840045">&#34;Dial(%q,&nbsp;%q,&nbsp;%q)&nbsp;=&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7840071">,</span>&nbsp;<span class="ident" id="7840073">network</span><span class="op" id="7840080">,</span>&nbsp;<span class="string" id="7840082">&#34;&#34;</span><span class="op" id="7840084">,</span>&nbsp;<span class="ident" id="7840086">addr</span><span class="op" id="7840090">,</span>&nbsp;<span class="ident" id="7840092">err</span><span class="op" id="7840095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840099">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840110">fetchGoogle</span><span class="op" id="7840121">(</span><span class="ident" id="7840122">t</span><span class="op" id="7840123">,</span>&nbsp;<span class="ident" id="7840125">fd</span><span class="op" id="7840127">,</span>&nbsp;<span class="ident" id="7840129">network</span><span class="op" id="7840136">,</span>&nbsp;<span class="ident" id="7840138">addr</span><span class="op" id="7840142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840145">fd</span><span class="op" id="7840147">.</span><span class="ident" id="7840148">Close</span><span class="op" id="7840153">(</span><span class="op" id="7840154">)</span><br>
<span class="lineno">95</span><span class="op" id="7840156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7840159">var</span>&nbsp;<span class="ident" id="7840163">googleaddrsipv4</span>&nbsp;<span class="op" id="7840179">=</span>&nbsp;<span class="op" id="7840181">[</span><span class="op" id="7840182">]</span><span class="builtintype" id="7840183">string</span><span class="op" id="7840189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7840192">&#34;%d.%d.%d.%d:80&#34;</span><span class="op" id="7840208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7840211">&#34;www.google.com:80&#34;</span><span class="op" id="7840230">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7840233">&#34;%d.%d.%d.%d:http&#34;</span><span class="op" id="7840251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7840254">&#34;www.google.com:http&#34;</span><span class="op" id="7840275">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7840278">&#34;%03d.%03d.%03d.%03d:0080&#34;</span><span class="op" id="7840304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7840307">&#34;[::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="7840332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7840335">&#34;[::ffff:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="7840366">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7840369">&#34;[0:0:0:0:0000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="7840405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7840408">&#34;[0:0:0:0:000000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="7840446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7840449">&#34;[0:0:0:0::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="7840481">,</span><br>
<span class="lineno"></span><span class="op" id="7840483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7840486">func</span>&nbsp;<span class="ident" id="7840491">TestDialGoogleIPv4</span><span class="op" id="7840509">(</span><span class="ident" id="7840510">t</span>&nbsp;<span class="op" id="7840512">*</span><span class="ident" id="7840513">testing</span><span class="op" id="7840520">.</span><span class="ident" id="7840521">T</span><span class="op" id="7840522">)</span>&nbsp;<span class="op" id="7840524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840527">if</span>&nbsp;<span class="ident" id="7840530">testing</span><span class="op" id="7840537">.</span><span class="ident" id="7840538">Short</span><span class="op" id="7840543">(</span><span class="op" id="7840544">)</span>&nbsp;<span class="op" id="7840546">||</span>&nbsp;<span class="op" id="7840549">!</span><span class="op" id="7840550">*</span><span class="ident" id="7840551">testExternal</span>&nbsp;<span class="op" id="7840564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840568">t</span><span class="op" id="7840569">.</span><span class="ident" id="7840570">Skip</span><span class="op" id="7840574">(</span><span class="string" id="7840575">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7840616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7840623">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv4&nbsp;address&nbsp;for&nbsp;google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7840672">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840692">addrs</span><span class="op" id="7840697">,</span>&nbsp;<span class="ident" id="7840699">err</span>&nbsp;<span class="op" id="7840703">:=</span>&nbsp;<span class="ident" id="7840706">LookupIP</span><span class="op" id="7840714">(</span><span class="string" id="7840715">&#34;www.google.com&#34;</span><span class="op" id="7840731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840734">if</span>&nbsp;<span class="ident" id="7840737">err</span>&nbsp;<span class="op" id="7840741">!=</span>&nbsp;<span class="ident" id="7840744">nil</span>&nbsp;<span class="op" id="7840748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840752">t</span><span class="op" id="7840753">.</span><span class="ident" id="7840754">Fatalf</span><span class="op" id="7840760">(</span><span class="string" id="7840761">&#34;lookup&nbsp;www.google.com:&nbsp;%v&#34;</span><span class="op" id="7840788">,</span>&nbsp;<span class="ident" id="7840790">err</span><span class="op" id="7840793">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840799">var</span>&nbsp;<span class="ident" id="7840803">ip</span>&nbsp;<span class="ident" id="7840806">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840810">for</span>&nbsp;<span class="ident" id="7840814">_</span><span class="op" id="7840815">,</span>&nbsp;<span class="ident" id="7840817">addr</span>&nbsp;<span class="op" id="7840822">:=</span>&nbsp;<span class="keyword" id="7840825">range</span>&nbsp;<span class="ident" id="7840831">addrs</span>&nbsp;<span class="op" id="7840837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840841">if</span>&nbsp;<span class="ident" id="7840844">x</span>&nbsp;<span class="op" id="7840846">:=</span>&nbsp;<span class="ident" id="7840849">addr</span><span class="op" id="7840853">.</span><span class="ident" id="7840854">To4</span><span class="op" id="7840857">(</span><span class="op" id="7840858">)</span><span class="op" id="7840859">;</span>&nbsp;<span class="ident" id="7840861">x</span>&nbsp;<span class="op" id="7840863">!=</span>&nbsp;<span class="ident" id="7840866">nil</span>&nbsp;<span class="op" id="7840870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840875">ip</span>&nbsp;<span class="op" id="7840878">=</span>&nbsp;<span class="ident" id="7840880">x</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840885">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840899">if</span>&nbsp;<span class="ident" id="7840902">ip</span>&nbsp;<span class="op" id="7840905">==</span>&nbsp;<span class="ident" id="7840908">nil</span>&nbsp;<span class="op" id="7840912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840916">t</span><span class="op" id="7840917">.</span><span class="ident" id="7840918">Fatalf</span><span class="op" id="7840924">(</span><span class="string" id="7840925">&#34;no&nbsp;IPv4&nbsp;addresses&nbsp;for&nbsp;www.google.com&#34;</span><span class="op" id="7840963">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7840970">for</span>&nbsp;<span class="ident" id="7840974">i</span><span class="op" id="7840975">,</span>&nbsp;<span class="ident" id="7840977">s</span>&nbsp;<span class="op" id="7840979">:=</span>&nbsp;<span class="keyword" id="7840982">range</span>&nbsp;<span class="ident" id="7840988">googleaddrsipv4</span>&nbsp;<span class="op" id="7841004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7841008">if</span>&nbsp;<span class="ident" id="7841011">strings</span><span class="op" id="7841018">.</span><span class="ident" id="7841019">Contains</span><span class="op" id="7841027">(</span><span class="ident" id="7841028">s</span><span class="op" id="7841029">,</span>&nbsp;<span class="string" id="7841031">&#34;%&#34;</span><span class="op" id="7841034">)</span>&nbsp;<span class="op" id="7841036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841041">googleaddrsipv4</span><span class="op" id="7841056">[</span><span class="ident" id="7841057">i</span><span class="op" id="7841058">]</span>&nbsp;<span class="op" id="7841060">=</span>&nbsp;<span class="ident" id="7841062">fmt</span><span class="op" id="7841065">.</span><span class="ident" id="7841066">Sprintf</span><span class="op" id="7841073">(</span><span class="ident" id="7841074">s</span><span class="op" id="7841075">,</span>&nbsp;<span class="ident" id="7841077">ip</span><span class="op" id="7841079">[</span><span class="num" id="7841080">0</span><span class="op" id="7841081">]</span><span class="op" id="7841082">,</span>&nbsp;<span class="ident" id="7841084">ip</span><span class="op" id="7841086">[</span><span class="num" id="7841087">1</span><span class="op" id="7841088">]</span><span class="op" id="7841089">,</span>&nbsp;<span class="ident" id="7841091">ip</span><span class="op" id="7841093">[</span><span class="num" id="7841094">2</span><span class="op" id="7841095">]</span><span class="op" id="7841096">,</span>&nbsp;<span class="ident" id="7841098">ip</span><span class="op" id="7841100">[</span><span class="num" id="7841101">3</span><span class="op" id="7841102">]</span><span class="op" id="7841103">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7841107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7841110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7841114">for</span>&nbsp;<span class="ident" id="7841118">i</span>&nbsp;<span class="op" id="7841120">:=</span>&nbsp;<span class="num" id="7841123">0</span><span class="op" id="7841124">;</span>&nbsp;<span class="ident" id="7841126">i</span>&nbsp;<span class="op" id="7841128">&lt;</span>&nbsp;<span class="builtinfunc" id="7841130">len</span><span class="op" id="7841133">(</span><span class="ident" id="7841134">googleaddrsipv4</span><span class="op" id="7841149">)</span><span class="op" id="7841150">;</span>&nbsp;<span class="ident" id="7841152">i</span><span class="op" id="7841153">++</span>&nbsp;<span class="op" id="7841156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841160">addr</span>&nbsp;<span class="op" id="7841165">:=</span>&nbsp;<span class="ident" id="7841168">googleaddrsipv4</span><span class="op" id="7841183">[</span><span class="ident" id="7841184">i</span><span class="op" id="7841185">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7841189">if</span>&nbsp;<span class="ident" id="7841192">addr</span>&nbsp;<span class="op" id="7841197">==</span>&nbsp;<span class="string" id="7841200">&#34;&#34;</span>&nbsp;<span class="op" id="7841203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7841208">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7841219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841223">t</span><span class="op" id="7841224">.</span><span class="ident" id="7841225">Logf</span><span class="op" id="7841229">(</span><span class="string" id="7841230">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="7841240">,</span>&nbsp;<span class="ident" id="7841242">addr</span><span class="op" id="7841246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841250">doDial</span><span class="op" id="7841256">(</span><span class="ident" id="7841257">t</span><span class="op" id="7841258">,</span>&nbsp;<span class="string" id="7841260">&#34;tcp&#34;</span><span class="op" id="7841265">,</span>&nbsp;<span class="ident" id="7841267">addr</span><span class="op" id="7841271">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7841275">if</span>&nbsp;<span class="ident" id="7841278">addr</span><span class="op" id="7841282">[</span><span class="num" id="7841283">0</span><span class="op" id="7841284">]</span>&nbsp;<span class="op" id="7841286">!=</span>&nbsp;<span class="string" id="7841289">&#39;[&#39;</span>&nbsp;<span class="op" id="7841293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841298">doDial</span><span class="op" id="7841304">(</span><span class="ident" id="7841305">t</span><span class="op" id="7841306">,</span>&nbsp;<span class="string" id="7841308">&#34;tcp4&#34;</span><span class="op" id="7841314">,</span>&nbsp;<span class="ident" id="7841316">addr</span><span class="op" id="7841320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7841325">if</span>&nbsp;<span class="ident" id="7841328">supportsIPv6</span>&nbsp;<span class="op" id="7841341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7841347">//&nbsp;make&nbsp;sure&nbsp;syscall.SocketDisableIPv6&nbsp;flag&nbsp;works.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841402">syscall</span><span class="op" id="7841409">.</span><span class="ident" id="7841410">SocketDisableIPv6</span>&nbsp;<span class="op" id="7841428">=</span>&nbsp;<span class="builtintype" id="7841430">true</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841439">doDial</span><span class="op" id="7841445">(</span><span class="ident" id="7841446">t</span><span class="op" id="7841447">,</span>&nbsp;<span class="string" id="7841449">&#34;tcp&#34;</span><span class="op" id="7841454">,</span>&nbsp;<span class="ident" id="7841456">addr</span><span class="op" id="7841460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841466">doDial</span><span class="op" id="7841472">(</span><span class="ident" id="7841473">t</span><span class="op" id="7841474">,</span>&nbsp;<span class="string" id="7841476">&#34;tcp4&#34;</span><span class="op" id="7841482">,</span>&nbsp;<span class="ident" id="7841484">addr</span><span class="op" id="7841488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841494">syscall</span><span class="op" id="7841501">.</span><span class="ident" id="7841502">SocketDisableIPv6</span>&nbsp;<span class="op" id="7841520">=</span>&nbsp;<span class="builtintype" id="7841522">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7841531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7841535">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7841538">}</span><br>
<span class="lineno"></span><span class="op" id="7841540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7841543">var</span>&nbsp;<span class="ident" id="7841547">googleaddrsipv6</span>&nbsp;<span class="op" id="7841563">=</span>&nbsp;<span class="op" id="7841565">[</span><span class="op" id="7841566">]</span><span class="builtintype" id="7841567">string</span><span class="op" id="7841573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7841576">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="7841654">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7841657">&#34;ipv6.google.com:80&#34;</span><span class="op" id="7841677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7841680">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:http&#34;</span><span class="op" id="7841760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7841763">&#34;ipv6.google.com:http&#34;</span><span class="op" id="7841785">,</span><br>
<span class="lineno"></span><span class="op" id="7841787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="7841790">func</span>&nbsp;<span class="ident" id="7841795">TestDialGoogleIPv6</span><span class="op" id="7841813">(</span><span class="ident" id="7841814">t</span>&nbsp;<span class="op" id="7841816">*</span><span class="ident" id="7841817">testing</span><span class="op" id="7841824">.</span><span class="ident" id="7841825">T</span><span class="op" id="7841826">)</span>&nbsp;<span class="op" id="7841828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7841831">if</span>&nbsp;<span class="ident" id="7841834">testing</span><span class="op" id="7841841">.</span><span class="ident" id="7841842">Short</span><span class="op" id="7841847">(</span><span class="op" id="7841848">)</span>&nbsp;<span class="op" id="7841850">||</span>&nbsp;<span class="op" id="7841853">!</span><span class="op" id="7841854">*</span><span class="ident" id="7841855">testExternal</span>&nbsp;<span class="op" id="7841868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841872">t</span><span class="op" id="7841873">.</span><span class="ident" id="7841874">Skip</span><span class="op" id="7841878">(</span><span class="string" id="7841879">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7841920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7841923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7841926">//&nbsp;Only&nbsp;run&nbsp;tcp6&nbsp;if&nbsp;the&nbsp;kernel&nbsp;will&nbsp;take&nbsp;it.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7841972">if</span>&nbsp;<span class="op" id="7841975">!</span><span class="ident" id="7841976">supportsIPv6</span>&nbsp;<span class="op" id="7841989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841993">t</span><span class="op" id="7841994">.</span><span class="ident" id="7841995">Skip</span><span class="op" id="7841999">(</span><span class="string" id="7842000">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7842038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842044">if</span>&nbsp;<span class="op" id="7842047">!</span><span class="op" id="7842048">*</span><span class="ident" id="7842049">testIPv6</span>&nbsp;<span class="op" id="7842058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842062">t</span><span class="op" id="7842063">.</span><span class="ident" id="7842064">Skip</span><span class="op" id="7842068">(</span><span class="string" id="7842069">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="7842105">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7842112">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv6&nbsp;address&nbsp;for&nbsp;ipv6.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7842166">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842186">addrs</span><span class="op" id="7842191">,</span>&nbsp;<span class="ident" id="7842193">err</span>&nbsp;<span class="op" id="7842197">:=</span>&nbsp;<span class="ident" id="7842200">LookupIP</span><span class="op" id="7842208">(</span><span class="string" id="7842209">&#34;ipv6.google.com&#34;</span><span class="op" id="7842226">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842229">if</span>&nbsp;<span class="ident" id="7842232">err</span>&nbsp;<span class="op" id="7842236">!=</span>&nbsp;<span class="ident" id="7842239">nil</span>&nbsp;<span class="op" id="7842243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842247">t</span><span class="op" id="7842248">.</span><span class="ident" id="7842249">Fatalf</span><span class="op" id="7842255">(</span><span class="string" id="7842256">&#34;lookup&nbsp;ipv6.google.com:&nbsp;%v&#34;</span><span class="op" id="7842284">,</span>&nbsp;<span class="ident" id="7842286">err</span><span class="op" id="7842289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842295">var</span>&nbsp;<span class="ident" id="7842299">ip</span>&nbsp;<span class="ident" id="7842302">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842306">for</span>&nbsp;<span class="ident" id="7842310">_</span><span class="op" id="7842311">,</span>&nbsp;<span class="ident" id="7842313">addr</span>&nbsp;<span class="op" id="7842318">:=</span>&nbsp;<span class="keyword" id="7842321">range</span>&nbsp;<span class="ident" id="7842327">addrs</span>&nbsp;<span class="op" id="7842333">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842337">if</span>&nbsp;<span class="ident" id="7842340">x</span>&nbsp;<span class="op" id="7842342">:=</span>&nbsp;<span class="ident" id="7842345">addr</span><span class="op" id="7842349">.</span><span class="ident" id="7842350">To16</span><span class="op" id="7842354">(</span><span class="op" id="7842355">)</span><span class="op" id="7842356">;</span>&nbsp;<span class="ident" id="7842358">x</span>&nbsp;<span class="op" id="7842360">!=</span>&nbsp;<span class="ident" id="7842363">nil</span>&nbsp;<span class="op" id="7842367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842372">ip</span>&nbsp;<span class="op" id="7842375">=</span>&nbsp;<span class="ident" id="7842377">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842382">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842393">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842396">if</span>&nbsp;<span class="ident" id="7842399">ip</span>&nbsp;<span class="op" id="7842402">==</span>&nbsp;<span class="ident" id="7842405">nil</span>&nbsp;<span class="op" id="7842409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842413">t</span><span class="op" id="7842414">.</span><span class="ident" id="7842415">Fatalf</span><span class="op" id="7842421">(</span><span class="string" id="7842422">&#34;no&nbsp;IPv6&nbsp;addresses&nbsp;for&nbsp;ipv6.google.com&#34;</span><span class="op" id="7842461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842468">for</span>&nbsp;<span class="ident" id="7842472">i</span><span class="op" id="7842473">,</span>&nbsp;<span class="ident" id="7842475">s</span>&nbsp;<span class="op" id="7842477">:=</span>&nbsp;<span class="keyword" id="7842480">range</span>&nbsp;<span class="ident" id="7842486">googleaddrsipv6</span>&nbsp;<span class="op" id="7842502">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842506">if</span>&nbsp;<span class="ident" id="7842509">strings</span><span class="op" id="7842516">.</span><span class="ident" id="7842517">Contains</span><span class="op" id="7842525">(</span><span class="ident" id="7842526">s</span><span class="op" id="7842527">,</span>&nbsp;<span class="string" id="7842529">&#34;%&#34;</span><span class="op" id="7842532">)</span>&nbsp;<span class="op" id="7842534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842539">googleaddrsipv6</span><span class="op" id="7842554">[</span><span class="ident" id="7842555">i</span><span class="op" id="7842556">]</span>&nbsp;<span class="op" id="7842558">=</span>&nbsp;<span class="ident" id="7842560">fmt</span><span class="op" id="7842563">.</span><span class="ident" id="7842564">Sprintf</span><span class="op" id="7842571">(</span><span class="ident" id="7842572">s</span><span class="op" id="7842573">,</span>&nbsp;<span class="ident" id="7842575">ip</span><span class="op" id="7842577">[</span><span class="num" id="7842578">0</span><span class="op" id="7842579">]</span><span class="op" id="7842580">,</span>&nbsp;<span class="ident" id="7842582">ip</span><span class="op" id="7842584">[</span><span class="num" id="7842585">1</span><span class="op" id="7842586">]</span><span class="op" id="7842587">,</span>&nbsp;<span class="ident" id="7842589">ip</span><span class="op" id="7842591">[</span><span class="num" id="7842592">2</span><span class="op" id="7842593">]</span><span class="op" id="7842594">,</span>&nbsp;<span class="ident" id="7842596">ip</span><span class="op" id="7842598">[</span><span class="num" id="7842599">3</span><span class="op" id="7842600">]</span><span class="op" id="7842601">,</span>&nbsp;<span class="ident" id="7842603">ip</span><span class="op" id="7842605">[</span><span class="num" id="7842606">4</span><span class="op" id="7842607">]</span><span class="op" id="7842608">,</span>&nbsp;<span class="ident" id="7842610">ip</span><span class="op" id="7842612">[</span><span class="num" id="7842613">5</span><span class="op" id="7842614">]</span><span class="op" id="7842615">,</span>&nbsp;<span class="ident" id="7842617">ip</span><span class="op" id="7842619">[</span><span class="num" id="7842620">6</span><span class="op" id="7842621">]</span><span class="op" id="7842622">,</span>&nbsp;<span class="ident" id="7842624">ip</span><span class="op" id="7842626">[</span><span class="num" id="7842627">7</span><span class="op" id="7842628">]</span><span class="op" id="7842629">,</span>&nbsp;<span class="ident" id="7842631">ip</span><span class="op" id="7842633">[</span><span class="num" id="7842634">8</span><span class="op" id="7842635">]</span><span class="op" id="7842636">,</span>&nbsp;<span class="ident" id="7842638">ip</span><span class="op" id="7842640">[</span><span class="num" id="7842641">9</span><span class="op" id="7842642">]</span><span class="op" id="7842643">,</span>&nbsp;<span class="ident" id="7842645">ip</span><span class="op" id="7842647">[</span><span class="num" id="7842648">10</span><span class="op" id="7842650">]</span><span class="op" id="7842651">,</span>&nbsp;<span class="ident" id="7842653">ip</span><span class="op" id="7842655">[</span><span class="num" id="7842656">11</span><span class="op" id="7842658">]</span><span class="op" id="7842659">,</span>&nbsp;<span class="ident" id="7842661">ip</span><span class="op" id="7842663">[</span><span class="num" id="7842664">12</span><span class="op" id="7842666">]</span><span class="op" id="7842667">,</span>&nbsp;<span class="ident" id="7842669">ip</span><span class="op" id="7842671">[</span><span class="num" id="7842672">13</span><span class="op" id="7842674">]</span><span class="op" id="7842675">,</span>&nbsp;<span class="ident" id="7842677">ip</span><span class="op" id="7842679">[</span><span class="num" id="7842680">14</span><span class="op" id="7842682">]</span><span class="op" id="7842683">,</span>&nbsp;<span class="ident" id="7842685">ip</span><span class="op" id="7842687">[</span><span class="num" id="7842688">15</span><span class="op" id="7842690">]</span><span class="op" id="7842691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842702">for</span>&nbsp;<span class="ident" id="7842706">i</span>&nbsp;<span class="op" id="7842708">:=</span>&nbsp;<span class="num" id="7842711">0</span><span class="op" id="7842712">;</span>&nbsp;<span class="ident" id="7842714">i</span>&nbsp;<span class="op" id="7842716">&lt;</span>&nbsp;<span class="builtinfunc" id="7842718">len</span><span class="op" id="7842721">(</span><span class="ident" id="7842722">googleaddrsipv6</span><span class="op" id="7842737">)</span><span class="op" id="7842738">;</span>&nbsp;<span class="ident" id="7842740">i</span><span class="op" id="7842741">++</span>&nbsp;<span class="op" id="7842744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842748">addr</span>&nbsp;<span class="op" id="7842753">:=</span>&nbsp;<span class="ident" id="7842756">googleaddrsipv6</span><span class="op" id="7842771">[</span><span class="ident" id="7842772">i</span><span class="op" id="7842773">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842777">if</span>&nbsp;<span class="ident" id="7842780">addr</span>&nbsp;<span class="op" id="7842785">==</span>&nbsp;<span class="string" id="7842788">&#34;&#34;</span>&nbsp;<span class="op" id="7842791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842796">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842807">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842811">t</span><span class="op" id="7842812">.</span><span class="ident" id="7842813">Logf</span><span class="op" id="7842817">(</span><span class="string" id="7842818">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="7842828">,</span>&nbsp;<span class="ident" id="7842830">addr</span><span class="op" id="7842834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842838">doDial</span><span class="op" id="7842844">(</span><span class="ident" id="7842845">t</span><span class="op" id="7842846">,</span>&nbsp;<span class="string" id="7842848">&#34;tcp&#34;</span><span class="op" id="7842853">,</span>&nbsp;<span class="ident" id="7842855">addr</span><span class="op" id="7842859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842863">doDial</span><span class="op" id="7842869">(</span><span class="ident" id="7842870">t</span><span class="op" id="7842871">,</span>&nbsp;<span class="string" id="7842873">&#34;tcp6&#34;</span><span class="op" id="7842879">,</span>&nbsp;<span class="ident" id="7842881">addr</span><span class="op" id="7842885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842888">}</span><br>
<span class="lineno"></span><span class="op" id="7842890">}</span>
</div>
</body>
</html>
