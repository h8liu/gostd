<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2101747">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2101802">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2101856">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2101907">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;runtime&nbsp;support&nbsp;for&nbsp;signal&nbsp;handling.</span><br>
<span class="lineno"></span><span class="comment" id="2101968">//</span><br>
<span class="lineno"></span><span class="comment" id="2101971">//&nbsp;Most&nbsp;synchronization&nbsp;primitives&nbsp;are&nbsp;not&nbsp;available&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="2102029">//&nbsp;the&nbsp;signal&nbsp;handler&nbsp;(it&nbsp;cannot&nbsp;block,&nbsp;allocate&nbsp;memory,&nbsp;or&nbsp;use&nbsp;locks)</span><br>
<span class="lineno"></span><span class="comment" id="2102100">//&nbsp;so&nbsp;the&nbsp;handler&nbsp;communicates&nbsp;with&nbsp;a&nbsp;processing&nbsp;goroutine</span><br>
<span class="lineno">10</span><span class="comment" id="2102159">//&nbsp;via&nbsp;struct&nbsp;sig,&nbsp;below.</span><br>
<span class="lineno"></span><span class="comment" id="2102185">//</span><br>
<span class="lineno"></span><span class="comment" id="2102188">//&nbsp;sigsend&nbsp;is&nbsp;called&nbsp;by&nbsp;the&nbsp;signal&nbsp;handler&nbsp;to&nbsp;queue&nbsp;a&nbsp;new&nbsp;signal.</span><br>
<span class="lineno"></span><span class="comment" id="2102254">//&nbsp;signal_recv&nbsp;is&nbsp;called&nbsp;by&nbsp;the&nbsp;Go&nbsp;program&nbsp;to&nbsp;receive&nbsp;a&nbsp;newly&nbsp;queued&nbsp;signal.</span><br>
<span class="lineno"></span><span class="comment" id="2102331">//&nbsp;Synchronization&nbsp;between&nbsp;sigsend&nbsp;and&nbsp;signal_recv&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;sig.state</span><br>
<span class="lineno">15</span><span class="comment" id="2102408">//&nbsp;variable.&nbsp;&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;3&nbsp;states:&nbsp;sigIdle,&nbsp;sigReceiving&nbsp;and&nbsp;sigSending.</span><br>
<span class="lineno"></span><span class="comment" id="2102483">//&nbsp;sigReceiving&nbsp;means&nbsp;that&nbsp;signal_recv&nbsp;is&nbsp;blocked&nbsp;on&nbsp;sig.Note&nbsp;and&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="2102562">//&nbsp;new&nbsp;pending&nbsp;signals.</span><br>
<span class="lineno"></span><span class="comment" id="2102586">//&nbsp;sigSending&nbsp;means&nbsp;that&nbsp;sig.mask&nbsp;*may*&nbsp;contain&nbsp;new&nbsp;pending&nbsp;signals,</span><br>
<span class="lineno"></span><span class="comment" id="2102655">//&nbsp;signal_recv&nbsp;can&#39;t&nbsp;be&nbsp;blocked&nbsp;in&nbsp;this&nbsp;state.</span><br>
<span class="lineno">20</span><span class="comment" id="2102702">//&nbsp;sigIdle&nbsp;means&nbsp;that&nbsp;there&nbsp;are&nbsp;no&nbsp;new&nbsp;pending&nbsp;signals&nbsp;and&nbsp;signal_recv&nbsp;is&nbsp;not&nbsp;blocked.</span><br>
<span class="lineno"></span><span class="comment" id="2102789">//&nbsp;Transitions&nbsp;between&nbsp;states&nbsp;are&nbsp;done&nbsp;atomically&nbsp;with&nbsp;CAS.</span><br>
<span class="lineno"></span><span class="comment" id="2102849">//&nbsp;When&nbsp;signal_recv&nbsp;is&nbsp;unblocked,&nbsp;it&nbsp;resets&nbsp;sig.Note&nbsp;and&nbsp;rechecks&nbsp;sig.mask.</span><br>
<span class="lineno"></span><span class="comment" id="2102925">//&nbsp;If&nbsp;several&nbsp;sigsends&nbsp;and&nbsp;signal_recv&nbsp;execute&nbsp;concurrently,&nbsp;it&nbsp;can&nbsp;lead&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2103001">//&nbsp;unnecessary&nbsp;rechecks&nbsp;of&nbsp;sig.mask,&nbsp;but&nbsp;it&nbsp;cannot&nbsp;lead&nbsp;to&nbsp;missed&nbsp;signals</span><br>
<span class="lineno">25</span><span class="comment" id="2103075">//&nbsp;nor&nbsp;deadlocks.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2103094">package</span>&nbsp;<span class="ident" id="2103102">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2103111">import</span>&nbsp;<span class="string" id="2103118">&#34;unsafe&#34;</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="2103128">var</span>&nbsp;<span class="ident" id="2103132">sig</span>&nbsp;<span class="keyword" id="2103136">struct</span>&nbsp;<span class="op" id="2103143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2103146">note</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2103153"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179346">note</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2103159">mask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2103166">[</span><span class="op" id="2103167">(</span><span class="ident" id="2103168"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2193694">_NSIG</a></span>&nbsp;<span class="op" id="2103174">+</span>&nbsp;<span class="num" id="2103176">31</span><span class="op" id="2103178">)</span>&nbsp;<span class="op" id="2103180">/</span>&nbsp;<span class="num" id="2103182">32</span><span class="op" id="2103184">]</span><span class="builtintype" id="2103185">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2103193">wanted</span>&nbsp;<span class="op" id="2103200">[</span><span class="op" id="2103201">(</span><span class="ident" id="2103202"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2193694">_NSIG</a></span>&nbsp;<span class="op" id="2103208">+</span>&nbsp;<span class="num" id="2103210">31</span><span class="op" id="2103212">)</span>&nbsp;<span class="op" id="2103214">/</span>&nbsp;<span class="num" id="2103216">32</span><span class="op" id="2103218">]</span><span class="builtintype" id="2103219">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2103227">recv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2103234">[</span><span class="op" id="2103235">(</span><span class="ident" id="2103236"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2193694">_NSIG</a></span>&nbsp;<span class="op" id="2103242">+</span>&nbsp;<span class="num" id="2103244">31</span><span class="op" id="2103246">)</span>&nbsp;<span class="op" id="2103248">/</span>&nbsp;<span class="num" id="2103250">32</span><span class="op" id="2103252">]</span><span class="builtintype" id="2103253">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2103261">state</span>&nbsp;&nbsp;<span class="builtintype" id="2103268">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2103276">inuse</span>&nbsp;&nbsp;<span class="builtintype" id="2103283">bool</span><br>
<span class="lineno"></span><span class="op" id="2103288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2103291">const</span>&nbsp;<span class="op" id="2103297">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2103300">sigIdle</span>&nbsp;<span class="op" id="2103308">=</span>&nbsp;<span class="ident" id="2103310">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2103316">sigReceiving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2103330">sigSending</span><br>
<span class="lineno"></span><span class="op" id="2103341">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2103344">//&nbsp;Called&nbsp;from&nbsp;sighandler&nbsp;to&nbsp;send&nbsp;a&nbsp;signal&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;signal&nbsp;handling&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="2103427">//&nbsp;Reports&nbsp;whether&nbsp;the&nbsp;signal&nbsp;was&nbsp;sent.&nbsp;If&nbsp;not,&nbsp;the&nbsp;caller&nbsp;typically&nbsp;crashes&nbsp;the&nbsp;program.</span><br>
<span class="lineno"></span><span class="keyword" id="2103517">func</span>&nbsp;<span class="ident" id="2103522">sigsend</span><span class="op" id="2103529">(</span><span class="ident" id="2103530">s</span>&nbsp;<span class="builtintype" id="2103532">int32</span><span class="op" id="2103537">)</span>&nbsp;<span class="builtintype" id="2103539">bool</span>&nbsp;<span class="op" id="2103544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2103547">bit</span>&nbsp;<span class="op" id="2103551">:=</span>&nbsp;<span class="builtintype" id="2103554">uint32</span><span class="op" id="2103560">(</span><span class="num" id="2103561">1</span><span class="op" id="2103562">)</span>&nbsp;<span class="op" id="2103564">&lt;&lt;</span>&nbsp;<span class="builtintype" id="2103567">uint</span><span class="op" id="2103571">(</span><span class="ident" id="2103572"><a href="/runtime/sigqueue.go.html#2103530">s</a></span><span class="op" id="2103573">&amp;</span><span class="num" id="2103574">31</span><span class="op" id="2103576">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2103579">if</span>&nbsp;<span class="op" id="2103582">!</span><span class="ident" id="2103583"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2103586">.</span><span class="ident" id="2103587">inuse</span>&nbsp;<span class="op" id="2103593">||</span>&nbsp;<span class="ident" id="2103596"><a href="/runtime/sigqueue.go.html#2103530">s</a></span>&nbsp;<span class="op" id="2103598">&lt;</span>&nbsp;<span class="num" id="2103600">0</span>&nbsp;<span class="op" id="2103602">||</span>&nbsp;<span class="builtintype" id="2103605">int</span><span class="op" id="2103608">(</span><span class="ident" id="2103609"><a href="/runtime/sigqueue.go.html#2103530">s</a></span><span class="op" id="2103610">)</span>&nbsp;<span class="op" id="2103612">&gt;=</span>&nbsp;<span class="num" id="2103615">32</span><span class="op" id="2103617">*</span><span class="builtinfunc" id="2103618">len</span><span class="op" id="2103621">(</span><span class="ident" id="2103622"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2103625">.</span><span class="ident" id="2103626">wanted</span><span class="op" id="2103632">)</span>&nbsp;<span class="op" id="2103634">||</span>&nbsp;<span class="ident" id="2103637"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2103640">.</span><span class="ident" id="2103641">wanted</span><span class="op" id="2103647">[</span><span class="ident" id="2103648"><a href="/runtime/sigqueue.go.html#2103530">s</a></span><span class="op" id="2103649">/</span><span class="num" id="2103650">32</span><span class="op" id="2103652">]</span><span class="op" id="2103653">&amp;</span><span class="ident" id="2103654"><a href="/runtime/sigqueue.go.html#2103547">bit</a></span>&nbsp;<span class="op" id="2103658">==</span>&nbsp;<span class="num" id="2103661">0</span>&nbsp;<span class="op" id="2103663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2103667">return</span>&nbsp;<span class="builtintype" id="2103674">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2103681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2103685">//&nbsp;Add&nbsp;signal&nbsp;to&nbsp;outgoing&nbsp;queue.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2103719">for</span>&nbsp;<span class="op" id="2103723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2103727">mask</span>&nbsp;<span class="op" id="2103732">:=</span>&nbsp;<span class="ident" id="2103735"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2103738">.</span><span class="ident" id="2103739">mask</span><span class="op" id="2103743">[</span><span class="ident" id="2103744"><a href="/runtime/sigqueue.go.html#2103530">s</a></span><span class="op" id="2103745">/</span><span class="num" id="2103746">32</span><span class="op" id="2103748">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2103752">if</span>&nbsp;<span class="ident" id="2103755"><a href="/runtime/sigqueue.go.html#2103727">mask</a></span><span class="op" id="2103759">&amp;</span><span class="ident" id="2103760"><a href="/runtime/sigqueue.go.html#2103547">bit</a></span>&nbsp;<span class="op" id="2103764">!=</span>&nbsp;<span class="num" id="2103767">0</span>&nbsp;<span class="op" id="2103769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2103774">return</span>&nbsp;<span class="builtintype" id="2103781">true</span>&nbsp;<span class="comment" id="2103786">//&nbsp;signal&nbsp;already&nbsp;in&nbsp;queue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2103815">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2103819">if</span>&nbsp;<span class="ident" id="2103822"><a href="/runtime/stubs.go.html#2137846">cas</a></span><span class="op" id="2103825">(</span><span class="op" id="2103826">&amp;</span><span class="ident" id="2103827"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2103830">.</span><span class="ident" id="2103831">mask</span><span class="op" id="2103835">[</span><span class="ident" id="2103836"><a href="/runtime/sigqueue.go.html#2103530">s</a></span><span class="op" id="2103837">/</span><span class="num" id="2103838">32</span><span class="op" id="2103840">]</span><span class="op" id="2103841">,</span>&nbsp;<span class="ident" id="2103843"><a href="/runtime/sigqueue.go.html#2103727">mask</a></span><span class="op" id="2103847">,</span>&nbsp;<span class="ident" id="2103849"><a href="/runtime/sigqueue.go.html#2103727">mask</a></span><span class="op" id="2103853">|</span><span class="ident" id="2103854"><a href="/runtime/sigqueue.go.html#2103547">bit</a></span><span class="op" id="2103857">)</span>&nbsp;<span class="op" id="2103859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2103864">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2103872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2103875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2103879">//&nbsp;Notify&nbsp;receiver&nbsp;that&nbsp;queue&nbsp;has&nbsp;new&nbsp;bit.</span><br>
<span class="lineno"></span><span class="ident" id="2103922">Send</span><span class="op" id="2103926">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2103929">for</span>&nbsp;<span class="op" id="2103933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2103937">switch</span>&nbsp;<span class="ident" id="2103944"><a href="/runtime/atomic.go.html#1874432">atomicload</a></span><span class="op" id="2103954">(</span><span class="op" id="2103955">&amp;</span><span class="ident" id="2103956"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2103959">.</span><span class="ident" id="2103960">state</span><span class="op" id="2103965">)</span>&nbsp;<span class="op" id="2103967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2103971">default</span><span class="op" id="2103978">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2103983"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2103990">(</span><span class="string" id="2103991">&#34;sigsend:&nbsp;inconsistent&nbsp;state&#34;</span><span class="op" id="2104020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104024">case</span>&nbsp;<span class="ident" id="2104029"><a href="/runtime/sigqueue.go.html#2103300">sigIdle</a></span><span class="op" id="2104036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104041">if</span>&nbsp;<span class="ident" id="2104044"><a href="/runtime/stubs.go.html#2137846">cas</a></span><span class="op" id="2104047">(</span><span class="op" id="2104048">&amp;</span><span class="ident" id="2104049"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2104052">.</span><span class="ident" id="2104053">state</span><span class="op" id="2104058">,</span>&nbsp;<span class="ident" id="2104060"><a href="/runtime/sigqueue.go.html#2103300">sigIdle</a></span><span class="op" id="2104067">,</span>&nbsp;<span class="ident" id="2104069"><a href="/runtime/sigqueue.go.html#2103330">sigSending</a></span><span class="op" id="2104079">)</span>&nbsp;<span class="op" id="2104081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104087">break</span>&nbsp;<span class="ident" id="2104093">Send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2104101">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104105">case</span>&nbsp;<span class="ident" id="2104110"><a href="/runtime/sigqueue.go.html#2103330">sigSending</a></span><span class="op" id="2104120">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2104125">//&nbsp;notification&nbsp;already&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104160">break</span>&nbsp;<span class="ident" id="2104166">Send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104173">case</span>&nbsp;<span class="ident" id="2104178"><a href="/runtime/sigqueue.go.html#2103316">sigReceiving</a></span><span class="op" id="2104190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104195">if</span>&nbsp;<span class="ident" id="2104198"><a href="/runtime/stubs.go.html#2137846">cas</a></span><span class="op" id="2104201">(</span><span class="op" id="2104202">&amp;</span><span class="ident" id="2104203"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2104206">.</span><span class="ident" id="2104207">state</span><span class="op" id="2104212">,</span>&nbsp;<span class="ident" id="2104214"><a href="/runtime/sigqueue.go.html#2103316">sigReceiving</a></span><span class="op" id="2104226">,</span>&nbsp;<span class="ident" id="2104228"><a href="/runtime/sigqueue.go.html#2103300">sigIdle</a></span><span class="op" id="2104235">)</span>&nbsp;<span class="op" id="2104237">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2104243"><a href="/runtime/lock_futex.go.html#1980230">notewakeup</a></span><span class="op" id="2104253">(</span><span class="op" id="2104254">&amp;</span><span class="ident" id="2104255"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2104258">.</span><span class="ident" id="2104259">note</span><span class="op" id="2104263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104269">break</span>&nbsp;<span class="ident" id="2104275">Send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2104283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2104287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2104290">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104294">return</span>&nbsp;<span class="builtintype" id="2104301">true</span><br>
<span class="lineno"></span><span class="op" id="2104306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2104309">//&nbsp;Called&nbsp;to&nbsp;receive&nbsp;the&nbsp;next&nbsp;queued&nbsp;signal.</span><br>
<span class="lineno">90</span><span class="comment" id="2104354">//&nbsp;Must&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="2104412">func</span>&nbsp;<span class="ident" id="2104417">signal_recv</span><span class="op" id="2104428">(</span><span class="op" id="2104429">)</span>&nbsp;<span class="builtintype" id="2104431">uint32</span>&nbsp;<span class="op" id="2104438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104441">for</span>&nbsp;<span class="op" id="2104445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2104449">//&nbsp;Serve&nbsp;any&nbsp;signals&nbsp;from&nbsp;local&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104489">for</span>&nbsp;<span class="ident" id="2104493">i</span>&nbsp;<span class="op" id="2104495">:=</span>&nbsp;<span class="builtintype" id="2104498">uint32</span><span class="op" id="2104504">(</span><span class="num" id="2104505">0</span><span class="op" id="2104506">)</span><span class="op" id="2104507">;</span>&nbsp;<span class="ident" id="2104509"><a href="/runtime/sigqueue.go.html#2104493">i</a></span>&nbsp;<span class="op" id="2104511">&lt;</span>&nbsp;<span class="ident" id="2104513"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2193694">_NSIG</a></span><span class="op" id="2104518">;</span>&nbsp;<span class="ident" id="2104520"><a href="/runtime/sigqueue.go.html#2104493">i</a></span><span class="op" id="2104521">++</span>&nbsp;<span class="op" id="2104524">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104529">if</span>&nbsp;<span class="ident" id="2104532"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2104535">.</span><span class="ident" id="2104536">recv</span><span class="op" id="2104540">[</span><span class="ident" id="2104541"><a href="/runtime/sigqueue.go.html#2104493">i</a></span><span class="op" id="2104542">/</span><span class="num" id="2104543">32</span><span class="op" id="2104545">]</span><span class="op" id="2104546">&amp;</span><span class="op" id="2104547">(</span><span class="num" id="2104548">1</span><span class="op" id="2104549">&lt;&lt;</span><span class="op" id="2104551">(</span><span class="ident" id="2104552"><a href="/runtime/sigqueue.go.html#2104493">i</a></span><span class="op" id="2104553">&amp;</span><span class="num" id="2104554">31</span><span class="op" id="2104556">)</span><span class="op" id="2104557">)</span>&nbsp;<span class="op" id="2104559">!=</span>&nbsp;<span class="num" id="2104562">0</span>&nbsp;<span class="op" id="2104564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2104570"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2104573">.</span><span class="ident" id="2104574">recv</span><span class="op" id="2104578">[</span><span class="ident" id="2104579"><a href="/runtime/sigqueue.go.html#2104493">i</a></span><span class="op" id="2104580">/</span><span class="num" id="2104581">32</span><span class="op" id="2104583">]</span>&nbsp;<span class="op" id="2104585">&amp;^=</span>&nbsp;<span class="num" id="2104589">1</span>&nbsp;<span class="op" id="2104591">&lt;&lt;</span>&nbsp;<span class="op" id="2104594">(</span><span class="ident" id="2104595"><a href="/runtime/sigqueue.go.html#2104493">i</a></span>&nbsp;<span class="op" id="2104597">&amp;</span>&nbsp;<span class="num" id="2104599">31</span><span class="op" id="2104601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104607">return</span>&nbsp;<span class="ident" id="2104614"><a href="/runtime/sigqueue.go.html#2104493">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2104619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2104623">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2104628">//&nbsp;Wait&nbsp;for&nbsp;updates&nbsp;to&nbsp;be&nbsp;available&nbsp;from&nbsp;signal&nbsp;sender.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2104685">Receive</span><span class="op" id="2104692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104696">for</span>&nbsp;<span class="op" id="2104700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104705">switch</span>&nbsp;<span class="ident" id="2104712"><a href="/runtime/atomic.go.html#1874432">atomicload</a></span><span class="op" id="2104722">(</span><span class="op" id="2104723">&amp;</span><span class="ident" id="2104724"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2104727">.</span><span class="ident" id="2104728">state</span><span class="op" id="2104733">)</span>&nbsp;<span class="op" id="2104735">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104740">default</span><span class="op" id="2104747">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2104753"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2104760">(</span><span class="string" id="2104761">&#34;signal_recv:&nbsp;inconsistent&nbsp;state&#34;</span><span class="op" id="2104794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104799">case</span>&nbsp;<span class="ident" id="2104804"><a href="/runtime/sigqueue.go.html#2103300">sigIdle</a></span><span class="op" id="2104811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104817">if</span>&nbsp;<span class="ident" id="2104820"><a href="/runtime/stubs.go.html#2137846">cas</a></span><span class="op" id="2104823">(</span><span class="op" id="2104824">&amp;</span><span class="ident" id="2104825"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2104828">.</span><span class="ident" id="2104829">state</span><span class="op" id="2104834">,</span>&nbsp;<span class="ident" id="2104836"><a href="/runtime/sigqueue.go.html#2103300">sigIdle</a></span><span class="op" id="2104843">,</span>&nbsp;<span class="ident" id="2104845"><a href="/runtime/sigqueue.go.html#2103316">sigReceiving</a></span><span class="op" id="2104857">)</span>&nbsp;<span class="op" id="2104859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2104866"><a href="/runtime/lock_futex.go.html#1981536">notetsleepg</a></span><span class="op" id="2104877">(</span><span class="op" id="2104878">&amp;</span><span class="ident" id="2104879"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2104882">.</span><span class="ident" id="2104883">note</span><span class="op" id="2104887">,</span>&nbsp;<span class="op" id="2104889">-</span><span class="num" id="2104890">1</span><span class="op" id="2104891">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2104898"><a href="/runtime/lock_futex.go.html#1980190">noteclear</a></span><span class="op" id="2104907">(</span><span class="op" id="2104908">&amp;</span><span class="ident" id="2104909"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2104912">.</span><span class="ident" id="2104913">note</span><span class="op" id="2104917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104924">break</span>&nbsp;<span class="ident" id="2104930">Receive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2104942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104947">case</span>&nbsp;<span class="ident" id="2104952"><a href="/runtime/sigqueue.go.html#2103330">sigSending</a></span><span class="op" id="2104962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2104968">if</span>&nbsp;<span class="ident" id="2104971"><a href="/runtime/stubs.go.html#2137846">cas</a></span><span class="op" id="2104974">(</span><span class="op" id="2104975">&amp;</span><span class="ident" id="2104976"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2104979">.</span><span class="ident" id="2104980">state</span><span class="op" id="2104985">,</span>&nbsp;<span class="ident" id="2104987"><a href="/runtime/sigqueue.go.html#2103330">sigSending</a></span><span class="op" id="2104997">,</span>&nbsp;<span class="ident" id="2104999"><a href="/runtime/sigqueue.go.html#2103300">sigIdle</a></span><span class="op" id="2105006">)</span>&nbsp;<span class="op" id="2105008">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105015">break</span>&nbsp;<span class="ident" id="2105021">Receive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2105033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2105038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2105042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2105047">//&nbsp;Incorporate&nbsp;updates&nbsp;from&nbsp;sender&nbsp;into&nbsp;local&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105101">for</span>&nbsp;<span class="ident" id="2105105">i</span>&nbsp;<span class="op" id="2105107">:=</span>&nbsp;<span class="keyword" id="2105110">range</span>&nbsp;<span class="ident" id="2105116"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2105119">.</span><span class="ident" id="2105120">mask</span>&nbsp;<span class="op" id="2105125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105130"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2105133">.</span><span class="ident" id="2105134">recv</span><span class="op" id="2105138">[</span><span class="ident" id="2105139"><a href="/runtime/sigqueue.go.html#2105105">i</a></span><span class="op" id="2105140">]</span>&nbsp;<span class="op" id="2105142">=</span>&nbsp;<span class="ident" id="2105144"><a href="/runtime/atomic.go.html#1874168">xchg</a></span><span class="op" id="2105148">(</span><span class="op" id="2105149">&amp;</span><span class="ident" id="2105150"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2105153">.</span><span class="ident" id="2105154">mask</span><span class="op" id="2105158">[</span><span class="ident" id="2105159"><a href="/runtime/sigqueue.go.html#2105105">i</a></span><span class="op" id="2105160">]</span><span class="op" id="2105161">,</span>&nbsp;<span class="num" id="2105163">0</span><span class="op" id="2105164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2105168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2105171">}</span><br>
<span class="lineno">125</span><span class="op" id="2105173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2105176">//&nbsp;Must&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="2105234">func</span>&nbsp;<span class="ident" id="2105239">signal_enable</span><span class="op" id="2105252">(</span><span class="ident" id="2105253">s</span>&nbsp;<span class="builtintype" id="2105255">uint32</span><span class="op" id="2105261">)</span>&nbsp;<span class="op" id="2105263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105266">if</span>&nbsp;<span class="op" id="2105269">!</span><span class="ident" id="2105270"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2105273">.</span><span class="ident" id="2105274">inuse</span>&nbsp;<span class="op" id="2105280">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2105284">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;signal_enable&nbsp;is&nbsp;for&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2105331">//&nbsp;to&nbsp;use&nbsp;for&nbsp;initialization.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;pass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2105381">//&nbsp;signal&nbsp;information&nbsp;in&nbsp;m.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105411"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2105414">.</span><span class="ident" id="2105415">inuse</span>&nbsp;<span class="op" id="2105421">=</span>&nbsp;<span class="builtintype" id="2105423">true</span>&nbsp;<span class="comment" id="2105428">//&nbsp;enable&nbsp;reception&nbsp;of&nbsp;signals;&nbsp;cannot&nbsp;disable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105477"><a href="/runtime/lock_futex.go.html#1980190">noteclear</a></span><span class="op" id="2105486">(</span><span class="op" id="2105487">&amp;</span><span class="ident" id="2105488"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2105491">.</span><span class="ident" id="2105492">note</span><span class="op" id="2105496">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105500">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2105508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105512">if</span>&nbsp;<span class="builtintype" id="2105515">int</span><span class="op" id="2105518">(</span><span class="ident" id="2105519"><a href="/runtime/sigqueue.go.html#2105253">s</a></span><span class="op" id="2105520">)</span>&nbsp;<span class="op" id="2105522">&gt;=</span>&nbsp;<span class="builtinfunc" id="2105525">len</span><span class="op" id="2105528">(</span><span class="ident" id="2105529"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2105532">.</span><span class="ident" id="2105533">wanted</span><span class="op" id="2105539">)</span><span class="op" id="2105540">*</span><span class="num" id="2105541">32</span>&nbsp;<span class="op" id="2105544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105548">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2105556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105559"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2105562">.</span><span class="ident" id="2105563">wanted</span><span class="op" id="2105569">[</span><span class="ident" id="2105570"><a href="/runtime/sigqueue.go.html#2105253">s</a></span><span class="op" id="2105571">/</span><span class="num" id="2105572">32</span><span class="op" id="2105574">]</span>&nbsp;<span class="op" id="2105576">|=</span>&nbsp;<span class="num" id="2105579">1</span>&nbsp;<span class="op" id="2105581">&lt;&lt;</span>&nbsp;<span class="op" id="2105584">(</span><span class="ident" id="2105585"><a href="/runtime/sigqueue.go.html#2105253">s</a></span>&nbsp;<span class="op" id="2105587">&amp;</span>&nbsp;<span class="num" id="2105589">31</span><span class="op" id="2105591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105594"><a href="/runtime/sigqueue.go.html#2106067">sigenable_go</a></span><span class="op" id="2105606">(</span><span class="ident" id="2105607"><a href="/runtime/sigqueue.go.html#2105253">s</a></span><span class="op" id="2105608">)</span><br>
<span class="lineno"></span><span class="op" id="2105610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="2105613">//&nbsp;Must&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="2105671">func</span>&nbsp;<span class="ident" id="2105676">signal_disable</span><span class="op" id="2105690">(</span><span class="ident" id="2105691">s</span>&nbsp;<span class="builtintype" id="2105693">uint32</span><span class="op" id="2105699">)</span>&nbsp;<span class="op" id="2105701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105704">if</span>&nbsp;<span class="builtintype" id="2105707">int</span><span class="op" id="2105710">(</span><span class="ident" id="2105711"><a href="/runtime/sigqueue.go.html#2105691">s</a></span><span class="op" id="2105712">)</span>&nbsp;<span class="op" id="2105714">&gt;=</span>&nbsp;<span class="builtinfunc" id="2105717">len</span><span class="op" id="2105720">(</span><span class="ident" id="2105721"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2105724">.</span><span class="ident" id="2105725">wanted</span><span class="op" id="2105731">)</span><span class="op" id="2105732">*</span><span class="num" id="2105733">32</span>&nbsp;<span class="op" id="2105736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105740">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2105748">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105751"><a href="/runtime/sigqueue.go.html#2103132">sig</a></span><span class="op" id="2105754">.</span><span class="ident" id="2105755">wanted</span><span class="op" id="2105761">[</span><span class="ident" id="2105762"><a href="/runtime/sigqueue.go.html#2105691">s</a></span><span class="op" id="2105763">/</span><span class="num" id="2105764">32</span><span class="op" id="2105766">]</span>&nbsp;<span class="op" id="2105768">&amp;^=</span>&nbsp;<span class="num" id="2105772">1</span>&nbsp;<span class="op" id="2105774">&lt;&lt;</span>&nbsp;<span class="op" id="2105777">(</span><span class="ident" id="2105778"><a href="/runtime/sigqueue.go.html#2105691">s</a></span>&nbsp;<span class="op" id="2105780">&amp;</span>&nbsp;<span class="num" id="2105782">31</span><span class="op" id="2105784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105787"><a href="/runtime/sigqueue.go.html#2106162">sigdisable_go</a></span><span class="op" id="2105800">(</span><span class="ident" id="2105801"><a href="/runtime/sigqueue.go.html#2105691">s</a></span><span class="op" id="2105802">)</span><br>
<span class="lineno"></span><span class="op" id="2105804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2105807">//&nbsp;This&nbsp;runs&nbsp;on&nbsp;a&nbsp;foreign&nbsp;stack,&nbsp;without&nbsp;an&nbsp;m&nbsp;or&nbsp;a&nbsp;g.&nbsp;&nbsp;No&nbsp;stack&nbsp;split.</span><br>
<span class="lineno">155</span><span class="comment" id="2105878">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="2105891">func</span>&nbsp;<span class="ident" id="2105896">badsignal</span><span class="op" id="2105905">(</span><span class="ident" id="2105906">sig</span>&nbsp;<span class="builtintype" id="2105910">uintptr</span><span class="op" id="2105917">)</span>&nbsp;<span class="op" id="2105919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105922"><a href="/runtime/stubs.go.html#2136637">cgocallback</a></span><span class="op" id="2105933">(</span><span class="ident" id="2105934"><a href="/runtime/sigqueue.go.html#2103118">unsafe</a></span><span class="op" id="2105940">.</span><span class="ident" id="2105941">Pointer</span><span class="op" id="2105948">(</span><span class="ident" id="2105949"><a href="/runtime/proc.go.html#2068560">funcPC</a></span><span class="op" id="2105955">(</span><span class="ident" id="2105956"><a href="/runtime/sigqueue.go.html#2103522">sigsend</a></span><span class="op" id="2105963">)</span><span class="op" id="2105964">)</span><span class="op" id="2105965">,</span>&nbsp;<span class="ident" id="2105967"><a href="/runtime/stubs.go.html#2136422">noescape</a></span><span class="op" id="2105975">(</span><span class="ident" id="2105976"><a href="/runtime/sigqueue.go.html#2103118">unsafe</a></span><span class="op" id="2105982">.</span><span class="ident" id="2105983">Pointer</span><span class="op" id="2105990">(</span><span class="op" id="2105991">&amp;</span><span class="ident" id="2105992"><a href="/runtime/sigqueue.go.html#2105906">sig</a></span><span class="op" id="2105995">)</span><span class="op" id="2105996">)</span><span class="op" id="2105997">,</span>&nbsp;<span class="ident" id="2105999"><a href="/runtime/sigqueue.go.html#2103118">unsafe</a></span><span class="op" id="2106005">.</span><span class="ident" id="2106006">Sizeof</span><span class="op" id="2106012">(</span><span class="ident" id="2106013"><a href="/runtime/sigqueue.go.html#2105906">sig</a></span><span class="op" id="2106016">)</span><span class="op" id="2106017">)</span><br>
<span class="lineno"></span><span class="op" id="2106019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="2106022">func</span>&nbsp;<span class="ident" id="2106027">sigenable_m</span><span class="op" id="2106038">(</span><span class="op" id="2106039">)</span><br>
<span class="lineno"></span><span class="keyword" id="2106041">func</span>&nbsp;<span class="ident" id="2106046">sigdisable_m</span><span class="op" id="2106058">(</span><span class="op" id="2106059">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2106062">func</span>&nbsp;<span class="ident" id="2106067">sigenable_go</span><span class="op" id="2106079">(</span><span class="ident" id="2106080">s</span>&nbsp;<span class="builtintype" id="2106082">uint32</span><span class="op" id="2106088">)</span>&nbsp;<span class="op" id="2106090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106093">g</span>&nbsp;<span class="op" id="2106095">:=</span>&nbsp;<span class="ident" id="2106098"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2106102">(</span><span class="op" id="2106103">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106106"><a href="/runtime/sigqueue.go.html#2106093">g</a></span><span class="op" id="2106107">.</span><span class="ident" id="2106108">m</span><span class="op" id="2106109">.</span><span class="ident" id="2106110">scalararg</span><span class="op" id="2106119">[</span><span class="num" id="2106120">0</span><span class="op" id="2106121">]</span>&nbsp;<span class="op" id="2106123">=</span>&nbsp;<span class="builtintype" id="2106125">uintptr</span><span class="op" id="2106132">(</span><span class="ident" id="2106133"><a href="/runtime/sigqueue.go.html#2106080">s</a></span><span class="op" id="2106134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106137"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2106140">(</span><span class="ident" id="2106141"><a href="/runtime/sigqueue.go.html#2106027">sigenable_m</a></span><span class="op" id="2106152">)</span><br>
<span class="lineno"></span><span class="op" id="2106154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2106157">func</span>&nbsp;<span class="ident" id="2106162">sigdisable_go</span><span class="op" id="2106175">(</span><span class="ident" id="2106176">s</span>&nbsp;<span class="builtintype" id="2106178">uint32</span><span class="op" id="2106184">)</span>&nbsp;<span class="op" id="2106186">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106189">g</span>&nbsp;<span class="op" id="2106191">:=</span>&nbsp;<span class="ident" id="2106194"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2106198">(</span><span class="op" id="2106199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106202"><a href="/runtime/sigqueue.go.html#2106189">g</a></span><span class="op" id="2106203">.</span><span class="ident" id="2106204">m</span><span class="op" id="2106205">.</span><span class="ident" id="2106206">scalararg</span><span class="op" id="2106215">[</span><span class="num" id="2106216">0</span><span class="op" id="2106217">]</span>&nbsp;<span class="op" id="2106219">=</span>&nbsp;<span class="builtintype" id="2106221">uintptr</span><span class="op" id="2106228">(</span><span class="ident" id="2106229"><a href="/runtime/sigqueue.go.html#2106176">s</a></span><span class="op" id="2106230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106233"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2106236">(</span><span class="ident" id="2106237"><a href="/runtime/sigqueue.go.html#2106046">sigdisable_m</a></span><span class="op" id="2106249">)</span><br>
<span class="lineno"></span><span class="op" id="2106251">}</span>
</div>
</body>
</html>
