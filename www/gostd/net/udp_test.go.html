<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8342565">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8342621">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8342675">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8342726">package</span>&nbsp;<span class="ident" id="8342734">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8342739">import</span>&nbsp;<span class="op" id="8342746">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8342749">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8342760">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8342771">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8342782">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8342793">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8342800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8342803">func</span>&nbsp;<span class="ident" id="8342808">TestResolveUDPAddr</span><span class="op" id="8342826">(</span><span class="ident" id="8342827">t</span>&nbsp;<span class="op" id="8342829">*</span><span class="ident" id="8342830">testing</span><span class="op" id="8342837">.</span><span class="ident" id="8342838">T</span><span class="op" id="8342839">)</span>&nbsp;<span class="op" id="8342841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342844">for</span>&nbsp;<span class="ident" id="8342848">_</span><span class="op" id="8342849">,</span>&nbsp;<span class="ident" id="8342851">tt</span>&nbsp;<span class="op" id="8342854">:=</span>&nbsp;<span class="keyword" id="8342857">range</span>&nbsp;<span class="ident" id="8342863">resolveTCPAddrTests</span>&nbsp;<span class="op" id="8342883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342887">net</span>&nbsp;<span class="op" id="8342891">:=</span>&nbsp;<span class="ident" id="8342894">strings</span><span class="op" id="8342901">.</span><span class="ident" id="8342902">Replace</span><span class="op" id="8342909">(</span><span class="ident" id="8342910">tt</span><span class="op" id="8342912">.</span><span class="ident" id="8342913">net</span><span class="op" id="8342916">,</span>&nbsp;<span class="string" id="8342918">&#34;tcp&#34;</span><span class="op" id="8342923">,</span>&nbsp;<span class="string" id="8342925">&#34;udp&#34;</span><span class="op" id="8342930">,</span>&nbsp;<span class="op" id="8342932">-</span><span class="num" id="8342933">1</span><span class="op" id="8342934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342938">addr</span><span class="op" id="8342942">,</span>&nbsp;<span class="ident" id="8342944">err</span>&nbsp;<span class="op" id="8342948">:=</span>&nbsp;<span class="ident" id="8342951">ResolveUDPAddr</span><span class="op" id="8342965">(</span><span class="ident" id="8342966">net</span><span class="op" id="8342969">,</span>&nbsp;<span class="ident" id="8342971">tt</span><span class="op" id="8342973">.</span><span class="ident" id="8342974">litAddrOrName</span><span class="op" id="8342987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342991">if</span>&nbsp;<span class="ident" id="8342994">err</span>&nbsp;<span class="op" id="8342998">!=</span>&nbsp;<span class="ident" id="8343001">tt</span><span class="op" id="8343003">.</span><span class="ident" id="8343004">err</span>&nbsp;<span class="op" id="8343008">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343013">t</span><span class="op" id="8343014">.</span><span class="ident" id="8343015">Fatalf</span><span class="op" id="8343021">(</span><span class="string" id="8343022">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8343057">,</span>&nbsp;<span class="ident" id="8343059">net</span><span class="op" id="8343062">,</span>&nbsp;<span class="ident" id="8343064">tt</span><span class="op" id="8343066">.</span><span class="ident" id="8343067">litAddrOrName</span><span class="op" id="8343080">,</span>&nbsp;<span class="ident" id="8343082">err</span><span class="op" id="8343085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343093">if</span>&nbsp;<span class="op" id="8343096">!</span><span class="ident" id="8343097">reflect</span><span class="op" id="8343104">.</span><span class="ident" id="8343105">DeepEqual</span><span class="op" id="8343114">(</span><span class="ident" id="8343115">addr</span><span class="op" id="8343119">,</span>&nbsp;<span class="op" id="8343121">(</span><span class="op" id="8343122">*</span><span class="ident" id="8343123">UDPAddr</span><span class="op" id="8343130">)</span><span class="op" id="8343131">(</span><span class="ident" id="8343132">tt</span><span class="op" id="8343134">.</span><span class="ident" id="8343135">addr</span><span class="op" id="8343139">)</span><span class="op" id="8343140">)</span>&nbsp;<span class="op" id="8343142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343147">t</span><span class="op" id="8343148">.</span><span class="ident" id="8343149">Fatalf</span><span class="op" id="8343155">(</span><span class="string" id="8343156">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;=&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="8343196">,</span>&nbsp;<span class="ident" id="8343198">net</span><span class="op" id="8343201">,</span>&nbsp;<span class="ident" id="8343203">tt</span><span class="op" id="8343205">.</span><span class="ident" id="8343206">litAddrOrName</span><span class="op" id="8343219">,</span>&nbsp;<span class="ident" id="8343221">addr</span><span class="op" id="8343225">,</span>&nbsp;<span class="ident" id="8343227">tt</span><span class="op" id="8343229">.</span><span class="ident" id="8343230">addr</span><span class="op" id="8343234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343238">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343242">if</span>&nbsp;<span class="ident" id="8343245">err</span>&nbsp;<span class="op" id="8343249">==</span>&nbsp;<span class="ident" id="8343252">nil</span>&nbsp;<span class="op" id="8343256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343261">str</span>&nbsp;<span class="op" id="8343265">:=</span>&nbsp;<span class="ident" id="8343268">addr</span><span class="op" id="8343272">.</span><span class="ident" id="8343273">String</span><span class="op" id="8343279">(</span><span class="op" id="8343280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343285">addr1</span><span class="op" id="8343290">,</span>&nbsp;<span class="ident" id="8343292">err</span>&nbsp;<span class="op" id="8343296">:=</span>&nbsp;<span class="ident" id="8343299">ResolveUDPAddr</span><span class="op" id="8343313">(</span><span class="ident" id="8343314">net</span><span class="op" id="8343317">,</span>&nbsp;<span class="ident" id="8343319">str</span><span class="op" id="8343322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343327">if</span>&nbsp;<span class="ident" id="8343330">err</span>&nbsp;<span class="op" id="8343334">!=</span>&nbsp;<span class="ident" id="8343337">nil</span>&nbsp;<span class="op" id="8343341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343347">t</span><span class="op" id="8343348">.</span><span class="ident" id="8343349">Fatalf</span><span class="op" id="8343355">(</span><span class="string" id="8343356">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;[from&nbsp;%q]:&nbsp;%v&#34;</span><span class="op" id="8343394">,</span>&nbsp;<span class="ident" id="8343396">net</span><span class="op" id="8343399">,</span>&nbsp;<span class="ident" id="8343401">str</span><span class="op" id="8343404">,</span>&nbsp;<span class="ident" id="8343406">tt</span><span class="op" id="8343408">.</span><span class="ident" id="8343409">litAddrOrName</span><span class="op" id="8343422">,</span>&nbsp;<span class="ident" id="8343424">err</span><span class="op" id="8343427">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343437">if</span>&nbsp;<span class="op" id="8343440">!</span><span class="ident" id="8343441">reflect</span><span class="op" id="8343448">.</span><span class="ident" id="8343449">DeepEqual</span><span class="op" id="8343458">(</span><span class="ident" id="8343459">addr1</span><span class="op" id="8343464">,</span>&nbsp;<span class="ident" id="8343466">addr</span><span class="op" id="8343470">)</span>&nbsp;<span class="op" id="8343472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343478">t</span><span class="op" id="8343479">.</span><span class="ident" id="8343480">Fatalf</span><span class="op" id="8343486">(</span><span class="string" id="8343487">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;[from&nbsp;%q]&nbsp;=&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="8343537">,</span>&nbsp;<span class="ident" id="8343539">net</span><span class="op" id="8343542">,</span>&nbsp;<span class="ident" id="8343544">str</span><span class="op" id="8343547">,</span>&nbsp;<span class="ident" id="8343549">tt</span><span class="op" id="8343551">.</span><span class="ident" id="8343552">litAddrOrName</span><span class="op" id="8343565">,</span>&nbsp;<span class="ident" id="8343567">addr1</span><span class="op" id="8343572">,</span>&nbsp;<span class="ident" id="8343574">addr</span><span class="op" id="8343578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343587">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343590">}</span><br>
<span class="lineno"></span><span class="op" id="8343592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8343595">func</span>&nbsp;<span class="ident" id="8343600">TestReadFromUDP</span><span class="op" id="8343615">(</span><span class="ident" id="8343616">t</span>&nbsp;<span class="op" id="8343618">*</span><span class="ident" id="8343619">testing</span><span class="op" id="8343626">.</span><span class="ident" id="8343627">T</span><span class="op" id="8343628">)</span>&nbsp;<span class="op" id="8343630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343633">switch</span>&nbsp;<span class="ident" id="8343640">runtime</span><span class="op" id="8343647">.</span><span class="ident" id="8343648">GOOS</span>&nbsp;<span class="op" id="8343653">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343656">case</span>&nbsp;<span class="string" id="8343661">&#34;nacl&#34;</span><span class="op" id="8343667">,</span>&nbsp;<span class="string" id="8343669">&#34;plan9&#34;</span><span class="op" id="8343676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343680">t</span><span class="op" id="8343681">.</span><span class="ident" id="8343682">Skipf</span><span class="op" id="8343687">(</span><span class="string" id="8343688">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q,&nbsp;see&nbsp;issue&nbsp;8916&#34;</span><span class="op" id="8343725">,</span>&nbsp;<span class="ident" id="8343727">runtime</span><span class="op" id="8343734">.</span><span class="ident" id="8343735">GOOS</span><span class="op" id="8343739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343746">ra</span><span class="op" id="8343748">,</span>&nbsp;<span class="ident" id="8343750">err</span>&nbsp;<span class="op" id="8343754">:=</span>&nbsp;<span class="ident" id="8343757">ResolveUDPAddr</span><span class="op" id="8343771">(</span><span class="string" id="8343772">&#34;udp&#34;</span><span class="op" id="8343777">,</span>&nbsp;<span class="string" id="8343779">&#34;127.0.0.1:7&#34;</span><span class="op" id="8343792">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343795">if</span>&nbsp;<span class="ident" id="8343798">err</span>&nbsp;<span class="op" id="8343802">!=</span>&nbsp;<span class="ident" id="8343805">nil</span>&nbsp;<span class="op" id="8343809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343813">t</span><span class="op" id="8343814">.</span><span class="ident" id="8343815">Fatal</span><span class="op" id="8343820">(</span><span class="ident" id="8343821">err</span><span class="op" id="8343824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343831">la</span><span class="op" id="8343833">,</span>&nbsp;<span class="ident" id="8343835">err</span>&nbsp;<span class="op" id="8343839">:=</span>&nbsp;<span class="ident" id="8343842">ResolveUDPAddr</span><span class="op" id="8343856">(</span><span class="string" id="8343857">&#34;udp&#34;</span><span class="op" id="8343862">,</span>&nbsp;<span class="string" id="8343864">&#34;127.0.0.1:0&#34;</span><span class="op" id="8343877">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343880">if</span>&nbsp;<span class="ident" id="8343883">err</span>&nbsp;<span class="op" id="8343887">!=</span>&nbsp;<span class="ident" id="8343890">nil</span>&nbsp;<span class="op" id="8343894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343898">t</span><span class="op" id="8343899">.</span><span class="ident" id="8343900">Fatal</span><span class="op" id="8343905">(</span><span class="ident" id="8343906">err</span><span class="op" id="8343909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343916">c</span><span class="op" id="8343917">,</span>&nbsp;<span class="ident" id="8343919">err</span>&nbsp;<span class="op" id="8343923">:=</span>&nbsp;<span class="ident" id="8343926">ListenUDP</span><span class="op" id="8343935">(</span><span class="string" id="8343936">&#34;udp&#34;</span><span class="op" id="8343941">,</span>&nbsp;<span class="ident" id="8343943">la</span><span class="op" id="8343945">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343948">if</span>&nbsp;<span class="ident" id="8343951">err</span>&nbsp;<span class="op" id="8343955">!=</span>&nbsp;<span class="ident" id="8343958">nil</span>&nbsp;<span class="op" id="8343962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343966">t</span><span class="op" id="8343967">.</span><span class="ident" id="8343968">Fatal</span><span class="op" id="8343973">(</span><span class="ident" id="8343974">err</span><span class="op" id="8343977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343983">defer</span>&nbsp;<span class="ident" id="8343989">c</span><span class="op" id="8343990">.</span><span class="ident" id="8343991">Close</span><span class="op" id="8343996">(</span><span class="op" id="8343997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344001">_</span><span class="op" id="8344002">,</span>&nbsp;<span class="ident" id="8344004">err</span>&nbsp;<span class="op" id="8344008">=</span>&nbsp;<span class="ident" id="8344010">c</span><span class="op" id="8344011">.</span><span class="ident" id="8344012">WriteToUDP</span><span class="op" id="8344022">(</span><span class="op" id="8344023">[</span><span class="op" id="8344024">]</span><span class="builtintype" id="8344025">byte</span><span class="op" id="8344029">(</span><span class="string" id="8344030">&#34;a&#34;</span><span class="op" id="8344033">)</span><span class="op" id="8344034">,</span>&nbsp;<span class="ident" id="8344036">ra</span><span class="op" id="8344038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344041">if</span>&nbsp;<span class="ident" id="8344044">err</span>&nbsp;<span class="op" id="8344048">!=</span>&nbsp;<span class="ident" id="8344051">nil</span>&nbsp;<span class="op" id="8344055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344059">t</span><span class="op" id="8344060">.</span><span class="ident" id="8344061">Fatal</span><span class="op" id="8344066">(</span><span class="ident" id="8344067">err</span><span class="op" id="8344070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344077">err</span>&nbsp;<span class="op" id="8344081">=</span>&nbsp;<span class="ident" id="8344083">c</span><span class="op" id="8344084">.</span><span class="ident" id="8344085">SetDeadline</span><span class="op" id="8344096">(</span><span class="ident" id="8344097">time</span><span class="op" id="8344101">.</span><span class="ident" id="8344102">Now</span><span class="op" id="8344105">(</span><span class="op" id="8344106">)</span><span class="op" id="8344107">.</span><span class="ident" id="8344108">Add</span><span class="op" id="8344111">(</span><span class="num" id="8344112">100</span>&nbsp;<span class="op" id="8344116">*</span>&nbsp;<span class="ident" id="8344118">time</span><span class="op" id="8344122">.</span><span class="ident" id="8344123">Millisecond</span><span class="op" id="8344134">)</span><span class="op" id="8344135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344138">if</span>&nbsp;<span class="ident" id="8344141">err</span>&nbsp;<span class="op" id="8344145">!=</span>&nbsp;<span class="ident" id="8344148">nil</span>&nbsp;<span class="op" id="8344152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344156">t</span><span class="op" id="8344157">.</span><span class="ident" id="8344158">Fatal</span><span class="op" id="8344163">(</span><span class="ident" id="8344164">err</span><span class="op" id="8344167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344173">b</span>&nbsp;<span class="op" id="8344175">:=</span>&nbsp;<span class="builtinfunc" id="8344178">make</span><span class="op" id="8344182">(</span><span class="op" id="8344183">[</span><span class="op" id="8344184">]</span><span class="builtintype" id="8344185">byte</span><span class="op" id="8344189">,</span>&nbsp;<span class="num" id="8344191">1</span><span class="op" id="8344192">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344195">_</span><span class="op" id="8344196">,</span>&nbsp;<span class="ident" id="8344198">_</span><span class="op" id="8344199">,</span>&nbsp;<span class="ident" id="8344201">err</span>&nbsp;<span class="op" id="8344205">=</span>&nbsp;<span class="ident" id="8344207">c</span><span class="op" id="8344208">.</span><span class="ident" id="8344209">ReadFromUDP</span><span class="op" id="8344220">(</span><span class="ident" id="8344221">b</span><span class="op" id="8344222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344225">if</span>&nbsp;<span class="ident" id="8344228">err</span>&nbsp;<span class="op" id="8344232">==</span>&nbsp;<span class="ident" id="8344235">nil</span>&nbsp;<span class="op" id="8344239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344243">t</span><span class="op" id="8344244">.</span><span class="ident" id="8344245">Fatal</span><span class="op" id="8344250">(</span><span class="string" id="8344251">&#34;ReadFromUDP&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8344276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344279">}</span>&nbsp;<span class="keyword" id="8344281">else</span>&nbsp;<span class="keyword" id="8344286">if</span>&nbsp;<span class="op" id="8344289">!</span><span class="ident" id="8344290">isTimeout</span><span class="op" id="8344299">(</span><span class="ident" id="8344300">err</span><span class="op" id="8344303">)</span>&nbsp;<span class="op" id="8344305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344309">t</span><span class="op" id="8344310">.</span><span class="ident" id="8344311">Fatal</span><span class="op" id="8344316">(</span><span class="ident" id="8344317">err</span><span class="op" id="8344320">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344323">}</span><br>
<span class="lineno"></span><span class="op" id="8344325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8344328">func</span>&nbsp;<span class="ident" id="8344333">TestWriteToUDP</span><span class="op" id="8344347">(</span><span class="ident" id="8344348">t</span>&nbsp;<span class="op" id="8344350">*</span><span class="ident" id="8344351">testing</span><span class="op" id="8344358">.</span><span class="ident" id="8344359">T</span><span class="op" id="8344360">)</span>&nbsp;<span class="op" id="8344362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344365">switch</span>&nbsp;<span class="ident" id="8344372">runtime</span><span class="op" id="8344379">.</span><span class="ident" id="8344380">GOOS</span>&nbsp;<span class="op" id="8344385">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344388">case</span>&nbsp;<span class="string" id="8344393">&#34;plan9&#34;</span><span class="op" id="8344400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344404">t</span><span class="op" id="8344405">.</span><span class="ident" id="8344406">Skipf</span><span class="op" id="8344411">(</span><span class="string" id="8344412">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8344433">,</span>&nbsp;<span class="ident" id="8344435">runtime</span><span class="op" id="8344442">.</span><span class="ident" id="8344443">GOOS</span><span class="op" id="8344447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344454">l</span><span class="op" id="8344455">,</span>&nbsp;<span class="ident" id="8344457">err</span>&nbsp;<span class="op" id="8344461">:=</span>&nbsp;<span class="ident" id="8344464">ListenPacket</span><span class="op" id="8344476">(</span><span class="string" id="8344477">&#34;udp&#34;</span><span class="op" id="8344482">,</span>&nbsp;<span class="string" id="8344484">&#34;127.0.0.1:0&#34;</span><span class="op" id="8344497">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344500">if</span>&nbsp;<span class="ident" id="8344503">err</span>&nbsp;<span class="op" id="8344507">!=</span>&nbsp;<span class="ident" id="8344510">nil</span>&nbsp;<span class="op" id="8344514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344518">t</span><span class="op" id="8344519">.</span><span class="ident" id="8344520">Fatalf</span><span class="op" id="8344526">(</span><span class="string" id="8344527">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8344546">,</span>&nbsp;<span class="ident" id="8344548">err</span><span class="op" id="8344551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344557">defer</span>&nbsp;<span class="ident" id="8344563">l</span><span class="op" id="8344564">.</span><span class="ident" id="8344565">Close</span><span class="op" id="8344570">(</span><span class="op" id="8344571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344575">testWriteToConn</span><span class="op" id="8344590">(</span><span class="ident" id="8344591">t</span><span class="op" id="8344592">,</span>&nbsp;<span class="ident" id="8344594">l</span><span class="op" id="8344595">.</span><span class="ident" id="8344596">LocalAddr</span><span class="op" id="8344605">(</span><span class="op" id="8344606">)</span><span class="op" id="8344607">.</span><span class="ident" id="8344608">String</span><span class="op" id="8344614">(</span><span class="op" id="8344615">)</span><span class="op" id="8344616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344619">testWriteToPacketConn</span><span class="op" id="8344640">(</span><span class="ident" id="8344641">t</span><span class="op" id="8344642">,</span>&nbsp;<span class="ident" id="8344644">l</span><span class="op" id="8344645">.</span><span class="ident" id="8344646">LocalAddr</span><span class="op" id="8344655">(</span><span class="op" id="8344656">)</span><span class="op" id="8344657">.</span><span class="ident" id="8344658">String</span><span class="op" id="8344664">(</span><span class="op" id="8344665">)</span><span class="op" id="8344666">)</span><br>
<span class="lineno"></span><span class="op" id="8344668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8344671">func</span>&nbsp;<span class="ident" id="8344676">testWriteToConn</span><span class="op" id="8344691">(</span><span class="ident" id="8344692">t</span>&nbsp;<span class="op" id="8344694">*</span><span class="ident" id="8344695">testing</span><span class="op" id="8344702">.</span><span class="ident" id="8344703">T</span><span class="op" id="8344704">,</span>&nbsp;<span class="ident" id="8344706">raddr</span>&nbsp;<span class="builtintype" id="8344712">string</span><span class="op" id="8344718">)</span>&nbsp;<span class="op" id="8344720">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344723">c</span><span class="op" id="8344724">,</span>&nbsp;<span class="ident" id="8344726">err</span>&nbsp;<span class="op" id="8344730">:=</span>&nbsp;<span class="ident" id="8344733">Dial</span><span class="op" id="8344737">(</span><span class="string" id="8344738">&#34;udp&#34;</span><span class="op" id="8344743">,</span>&nbsp;<span class="ident" id="8344745">raddr</span><span class="op" id="8344750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344753">if</span>&nbsp;<span class="ident" id="8344756">err</span>&nbsp;<span class="op" id="8344760">!=</span>&nbsp;<span class="ident" id="8344763">nil</span>&nbsp;<span class="op" id="8344767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344771">t</span><span class="op" id="8344772">.</span><span class="ident" id="8344773">Fatalf</span><span class="op" id="8344779">(</span><span class="string" id="8344780">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8344797">,</span>&nbsp;<span class="ident" id="8344799">err</span><span class="op" id="8344802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344808">defer</span>&nbsp;<span class="ident" id="8344814">c</span><span class="op" id="8344815">.</span><span class="ident" id="8344816">Close</span><span class="op" id="8344821">(</span><span class="op" id="8344822">)</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344826">ra</span><span class="op" id="8344828">,</span>&nbsp;<span class="ident" id="8344830">err</span>&nbsp;<span class="op" id="8344834">:=</span>&nbsp;<span class="ident" id="8344837">ResolveUDPAddr</span><span class="op" id="8344851">(</span><span class="string" id="8344852">&#34;udp&#34;</span><span class="op" id="8344857">,</span>&nbsp;<span class="ident" id="8344859">raddr</span><span class="op" id="8344864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344867">if</span>&nbsp;<span class="ident" id="8344870">err</span>&nbsp;<span class="op" id="8344874">!=</span>&nbsp;<span class="ident" id="8344877">nil</span>&nbsp;<span class="op" id="8344881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344885">t</span><span class="op" id="8344886">.</span><span class="ident" id="8344887">Fatalf</span><span class="op" id="8344893">(</span><span class="string" id="8344894">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8344921">,</span>&nbsp;<span class="ident" id="8344923">err</span><span class="op" id="8344926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344929">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344933">_</span><span class="op" id="8344934">,</span>&nbsp;<span class="ident" id="8344936">err</span>&nbsp;<span class="op" id="8344940">=</span>&nbsp;<span class="ident" id="8344942">c</span><span class="op" id="8344943">.</span><span class="op" id="8344944">(</span><span class="op" id="8344945">*</span><span class="ident" id="8344946">UDPConn</span><span class="op" id="8344953">)</span><span class="op" id="8344954">.</span><span class="ident" id="8344955">WriteToUDP</span><span class="op" id="8344965">(</span><span class="op" id="8344966">[</span><span class="op" id="8344967">]</span><span class="builtintype" id="8344968">byte</span><span class="op" id="8344972">(</span><span class="string" id="8344973">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8345006">)</span><span class="op" id="8345007">,</span>&nbsp;<span class="ident" id="8345009">ra</span><span class="op" id="8345011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345014">if</span>&nbsp;<span class="ident" id="8345017">err</span>&nbsp;<span class="op" id="8345021">==</span>&nbsp;<span class="ident" id="8345024">nil</span>&nbsp;<span class="op" id="8345028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345032">t</span><span class="op" id="8345033">.</span><span class="ident" id="8345034">Fatal</span><span class="op" id="8345039">(</span><span class="string" id="8345040">&#34;WriteToUDP&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8345064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345067">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345070">if</span>&nbsp;<span class="ident" id="8345073">err</span>&nbsp;<span class="op" id="8345077">!=</span>&nbsp;<span class="ident" id="8345080">nil</span>&nbsp;<span class="op" id="8345084">&amp;&amp;</span>&nbsp;<span class="ident" id="8345087">err</span><span class="op" id="8345090">.</span><span class="op" id="8345091">(</span><span class="op" id="8345092">*</span><span class="ident" id="8345093">OpError</span><span class="op" id="8345100">)</span><span class="op" id="8345101">.</span><span class="ident" id="8345102">Err</span>&nbsp;<span class="op" id="8345106">!=</span>&nbsp;<span class="ident" id="8345109">ErrWriteToConnected</span>&nbsp;<span class="op" id="8345129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345133">t</span><span class="op" id="8345134">.</span><span class="ident" id="8345135">Fatalf</span><span class="op" id="8345141">(</span><span class="string" id="8345142">&#34;WriteToUDP&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8345193">,</span>&nbsp;<span class="ident" id="8345195">err</span><span class="op" id="8345198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345205">_</span><span class="op" id="8345206">,</span>&nbsp;<span class="ident" id="8345208">err</span>&nbsp;<span class="op" id="8345212">=</span>&nbsp;<span class="ident" id="8345214">c</span><span class="op" id="8345215">.</span><span class="op" id="8345216">(</span><span class="op" id="8345217">*</span><span class="ident" id="8345218">UDPConn</span><span class="op" id="8345225">)</span><span class="op" id="8345226">.</span><span class="ident" id="8345227">WriteTo</span><span class="op" id="8345234">(</span><span class="op" id="8345235">[</span><span class="op" id="8345236">]</span><span class="builtintype" id="8345237">byte</span><span class="op" id="8345241">(</span><span class="string" id="8345242">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8345275">)</span><span class="op" id="8345276">,</span>&nbsp;<span class="ident" id="8345278">ra</span><span class="op" id="8345280">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345283">if</span>&nbsp;<span class="ident" id="8345286">err</span>&nbsp;<span class="op" id="8345290">==</span>&nbsp;<span class="ident" id="8345293">nil</span>&nbsp;<span class="op" id="8345297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345301">t</span><span class="op" id="8345302">.</span><span class="ident" id="8345303">Fatal</span><span class="op" id="8345308">(</span><span class="string" id="8345309">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8345330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345336">if</span>&nbsp;<span class="ident" id="8345339">err</span>&nbsp;<span class="op" id="8345343">!=</span>&nbsp;<span class="ident" id="8345346">nil</span>&nbsp;<span class="op" id="8345350">&amp;&amp;</span>&nbsp;<span class="ident" id="8345353">err</span><span class="op" id="8345356">.</span><span class="op" id="8345357">(</span><span class="op" id="8345358">*</span><span class="ident" id="8345359">OpError</span><span class="op" id="8345366">)</span><span class="op" id="8345367">.</span><span class="ident" id="8345368">Err</span>&nbsp;<span class="op" id="8345372">!=</span>&nbsp;<span class="ident" id="8345375">ErrWriteToConnected</span>&nbsp;<span class="op" id="8345395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345399">t</span><span class="op" id="8345400">.</span><span class="ident" id="8345401">Fatalf</span><span class="op" id="8345407">(</span><span class="string" id="8345408">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8345456">,</span>&nbsp;<span class="ident" id="8345458">err</span><span class="op" id="8345461">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345468">_</span><span class="op" id="8345469">,</span>&nbsp;<span class="ident" id="8345471">err</span>&nbsp;<span class="op" id="8345475">=</span>&nbsp;<span class="ident" id="8345477">c</span><span class="op" id="8345478">.</span><span class="ident" id="8345479">Write</span><span class="op" id="8345484">(</span><span class="op" id="8345485">[</span><span class="op" id="8345486">]</span><span class="builtintype" id="8345487">byte</span><span class="op" id="8345491">(</span><span class="string" id="8345492">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8345525">)</span><span class="op" id="8345526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345529">if</span>&nbsp;<span class="ident" id="8345532">err</span>&nbsp;<span class="op" id="8345536">!=</span>&nbsp;<span class="ident" id="8345539">nil</span>&nbsp;<span class="op" id="8345543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345547">t</span><span class="op" id="8345548">.</span><span class="ident" id="8345549">Fatalf</span><span class="op" id="8345555">(</span><span class="string" id="8345556">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8345574">,</span>&nbsp;<span class="ident" id="8345576">err</span><span class="op" id="8345579">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345582">}</span><br>
<span class="lineno"></span><span class="op" id="8345584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8345587">func</span>&nbsp;<span class="ident" id="8345592">testWriteToPacketConn</span><span class="op" id="8345613">(</span><span class="ident" id="8345614">t</span>&nbsp;<span class="op" id="8345616">*</span><span class="ident" id="8345617">testing</span><span class="op" id="8345624">.</span><span class="ident" id="8345625">T</span><span class="op" id="8345626">,</span>&nbsp;<span class="ident" id="8345628">raddr</span>&nbsp;<span class="builtintype" id="8345634">string</span><span class="op" id="8345640">)</span>&nbsp;<span class="op" id="8345642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345645">c</span><span class="op" id="8345646">,</span>&nbsp;<span class="ident" id="8345648">err</span>&nbsp;<span class="op" id="8345652">:=</span>&nbsp;<span class="ident" id="8345655">ListenPacket</span><span class="op" id="8345667">(</span><span class="string" id="8345668">&#34;udp&#34;</span><span class="op" id="8345673">,</span>&nbsp;<span class="string" id="8345675">&#34;127.0.0.1:0&#34;</span><span class="op" id="8345688">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345691">if</span>&nbsp;<span class="ident" id="8345694">err</span>&nbsp;<span class="op" id="8345698">!=</span>&nbsp;<span class="ident" id="8345701">nil</span>&nbsp;<span class="op" id="8345705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345709">t</span><span class="op" id="8345710">.</span><span class="ident" id="8345711">Fatalf</span><span class="op" id="8345717">(</span><span class="string" id="8345718">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8345743">,</span>&nbsp;<span class="ident" id="8345745">err</span><span class="op" id="8345748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345754">defer</span>&nbsp;<span class="ident" id="8345760">c</span><span class="op" id="8345761">.</span><span class="ident" id="8345762">Close</span><span class="op" id="8345767">(</span><span class="op" id="8345768">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345772">ra</span><span class="op" id="8345774">,</span>&nbsp;<span class="ident" id="8345776">err</span>&nbsp;<span class="op" id="8345780">:=</span>&nbsp;<span class="ident" id="8345783">ResolveUDPAddr</span><span class="op" id="8345797">(</span><span class="string" id="8345798">&#34;udp&#34;</span><span class="op" id="8345803">,</span>&nbsp;<span class="ident" id="8345805">raddr</span><span class="op" id="8345810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345813">if</span>&nbsp;<span class="ident" id="8345816">err</span>&nbsp;<span class="op" id="8345820">!=</span>&nbsp;<span class="ident" id="8345823">nil</span>&nbsp;<span class="op" id="8345827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345831">t</span><span class="op" id="8345832">.</span><span class="ident" id="8345833">Fatalf</span><span class="op" id="8345839">(</span><span class="string" id="8345840">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8345867">,</span>&nbsp;<span class="ident" id="8345869">err</span><span class="op" id="8345872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345879">_</span><span class="op" id="8345880">,</span>&nbsp;<span class="ident" id="8345882">err</span>&nbsp;<span class="op" id="8345886">=</span>&nbsp;<span class="ident" id="8345888">c</span><span class="op" id="8345889">.</span><span class="op" id="8345890">(</span><span class="op" id="8345891">*</span><span class="ident" id="8345892">UDPConn</span><span class="op" id="8345899">)</span><span class="op" id="8345900">.</span><span class="ident" id="8345901">WriteToUDP</span><span class="op" id="8345911">(</span><span class="op" id="8345912">[</span><span class="op" id="8345913">]</span><span class="builtintype" id="8345914">byte</span><span class="op" id="8345918">(</span><span class="string" id="8345919">&#34;Connection-less&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8345948">)</span><span class="op" id="8345949">,</span>&nbsp;<span class="ident" id="8345951">ra</span><span class="op" id="8345953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345956">if</span>&nbsp;<span class="ident" id="8345959">err</span>&nbsp;<span class="op" id="8345963">!=</span>&nbsp;<span class="ident" id="8345966">nil</span>&nbsp;<span class="op" id="8345970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345974">t</span><span class="op" id="8345975">.</span><span class="ident" id="8345976">Fatalf</span><span class="op" id="8345982">(</span><span class="string" id="8345983">&#34;WriteToUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8346006">,</span>&nbsp;<span class="ident" id="8346008">err</span><span class="op" id="8346011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346018">_</span><span class="op" id="8346019">,</span>&nbsp;<span class="ident" id="8346021">err</span>&nbsp;<span class="op" id="8346025">=</span>&nbsp;<span class="ident" id="8346027">c</span><span class="op" id="8346028">.</span><span class="ident" id="8346029">WriteTo</span><span class="op" id="8346036">(</span><span class="op" id="8346037">[</span><span class="op" id="8346038">]</span><span class="builtintype" id="8346039">byte</span><span class="op" id="8346043">(</span><span class="string" id="8346044">&#34;Connection-less&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8346073">)</span><span class="op" id="8346074">,</span>&nbsp;<span class="ident" id="8346076">ra</span><span class="op" id="8346078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346081">if</span>&nbsp;<span class="ident" id="8346084">err</span>&nbsp;<span class="op" id="8346088">!=</span>&nbsp;<span class="ident" id="8346091">nil</span>&nbsp;<span class="op" id="8346095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346099">t</span><span class="op" id="8346100">.</span><span class="ident" id="8346101">Fatalf</span><span class="op" id="8346107">(</span><span class="string" id="8346108">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8346128">,</span>&nbsp;<span class="ident" id="8346130">err</span><span class="op" id="8346133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346140">_</span><span class="op" id="8346141">,</span>&nbsp;<span class="ident" id="8346143">err</span>&nbsp;<span class="op" id="8346147">=</span>&nbsp;<span class="ident" id="8346149">c</span><span class="op" id="8346150">.</span><span class="op" id="8346151">(</span><span class="op" id="8346152">*</span><span class="ident" id="8346153">UDPConn</span><span class="op" id="8346160">)</span><span class="op" id="8346161">.</span><span class="ident" id="8346162">Write</span><span class="op" id="8346167">(</span><span class="op" id="8346168">[</span><span class="op" id="8346169">]</span><span class="builtintype" id="8346170">byte</span><span class="op" id="8346174">(</span><span class="string" id="8346175">&#34;Connection-less&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8346204">)</span><span class="op" id="8346205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346208">if</span>&nbsp;<span class="ident" id="8346211">err</span>&nbsp;<span class="op" id="8346215">==</span>&nbsp;<span class="ident" id="8346218">nil</span>&nbsp;<span class="op" id="8346222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346226">t</span><span class="op" id="8346227">.</span><span class="ident" id="8346228">Fatal</span><span class="op" id="8346233">(</span><span class="string" id="8346234">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8346253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346256">}</span><br>
<span class="lineno"></span><span class="op" id="8346258">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="8346261">var</span>&nbsp;<span class="ident" id="8346265">udpConnLocalNameTests</span>&nbsp;<span class="op" id="8346287">=</span>&nbsp;<span class="op" id="8346289">[</span><span class="op" id="8346290">]</span><span class="keyword" id="8346291">struct</span>&nbsp;<span class="op" id="8346298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346301">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8346307">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346315">laddr</span>&nbsp;<span class="op" id="8346321">*</span><span class="ident" id="8346322">UDPAddr</span><br>
<span class="lineno"></span><span class="op" id="8346330">}</span><span class="op" id="8346331">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346334">{</span><span class="string" id="8346335">&#34;udp4&#34;</span><span class="op" id="8346341">,</span>&nbsp;<span class="op" id="8346343">&amp;</span><span class="ident" id="8346344">UDPAddr</span><span class="op" id="8346351">{</span><span class="ident" id="8346352">IP</span><span class="op" id="8346354">:</span>&nbsp;<span class="ident" id="8346356">IPv4</span><span class="op" id="8346360">(</span><span class="num" id="8346361">127</span><span class="op" id="8346364">,</span>&nbsp;<span class="num" id="8346366">0</span><span class="op" id="8346367">,</span>&nbsp;<span class="num" id="8346369">0</span><span class="op" id="8346370">,</span>&nbsp;<span class="num" id="8346372">1</span><span class="op" id="8346373">)</span><span class="op" id="8346374">}</span><span class="op" id="8346375">}</span><span class="op" id="8346376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346379">{</span><span class="string" id="8346380">&#34;udp4&#34;</span><span class="op" id="8346386">,</span>&nbsp;<span class="op" id="8346388">&amp;</span><span class="ident" id="8346389">UDPAddr</span><span class="op" id="8346396">{</span><span class="op" id="8346397">}</span><span class="op" id="8346398">}</span><span class="op" id="8346399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346402">{</span><span class="string" id="8346403">&#34;udp4&#34;</span><span class="op" id="8346409">,</span>&nbsp;<span class="ident" id="8346411">nil</span><span class="op" id="8346414">}</span><span class="op" id="8346415">,</span><br>
<span class="lineno"></span><span class="op" id="8346417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="8346420">func</span>&nbsp;<span class="ident" id="8346425">TestUDPConnLocalName</span><span class="op" id="8346445">(</span><span class="ident" id="8346446">t</span>&nbsp;<span class="op" id="8346448">*</span><span class="ident" id="8346449">testing</span><span class="op" id="8346456">.</span><span class="ident" id="8346457">T</span><span class="op" id="8346458">)</span>&nbsp;<span class="op" id="8346460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346463">if</span>&nbsp;<span class="ident" id="8346466">testing</span><span class="op" id="8346473">.</span><span class="ident" id="8346474">Short</span><span class="op" id="8346479">(</span><span class="op" id="8346480">)</span>&nbsp;<span class="op" id="8346482">||</span>&nbsp;<span class="op" id="8346485">!</span><span class="op" id="8346486">*</span><span class="ident" id="8346487">testExternal</span>&nbsp;<span class="op" id="8346500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346504">t</span><span class="op" id="8346505">.</span><span class="ident" id="8346506">Skip</span><span class="op" id="8346510">(</span><span class="string" id="8346511">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8346552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346559">for</span>&nbsp;<span class="ident" id="8346563">_</span><span class="op" id="8346564">,</span>&nbsp;<span class="ident" id="8346566">tt</span>&nbsp;<span class="op" id="8346569">:=</span>&nbsp;<span class="keyword" id="8346572">range</span>&nbsp;<span class="ident" id="8346578">udpConnLocalNameTests</span>&nbsp;<span class="op" id="8346600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346604">c</span><span class="op" id="8346605">,</span>&nbsp;<span class="ident" id="8346607">err</span>&nbsp;<span class="op" id="8346611">:=</span>&nbsp;<span class="ident" id="8346614">ListenUDP</span><span class="op" id="8346623">(</span><span class="ident" id="8346624">tt</span><span class="op" id="8346626">.</span><span class="ident" id="8346627">net</span><span class="op" id="8346630">,</span>&nbsp;<span class="ident" id="8346632">tt</span><span class="op" id="8346634">.</span><span class="ident" id="8346635">laddr</span><span class="op" id="8346640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346644">if</span>&nbsp;<span class="ident" id="8346647">err</span>&nbsp;<span class="op" id="8346651">!=</span>&nbsp;<span class="ident" id="8346654">nil</span>&nbsp;<span class="op" id="8346658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346663">t</span><span class="op" id="8346664">.</span><span class="ident" id="8346665">Fatalf</span><span class="op" id="8346671">(</span><span class="string" id="8346672">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8346694">,</span>&nbsp;<span class="ident" id="8346696">err</span><span class="op" id="8346699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346703">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346707">defer</span>&nbsp;<span class="ident" id="8346713">c</span><span class="op" id="8346714">.</span><span class="ident" id="8346715">Close</span><span class="op" id="8346720">(</span><span class="op" id="8346721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346725">la</span>&nbsp;<span class="op" id="8346728">:=</span>&nbsp;<span class="ident" id="8346731">c</span><span class="op" id="8346732">.</span><span class="ident" id="8346733">LocalAddr</span><span class="op" id="8346742">(</span><span class="op" id="8346743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346747">if</span>&nbsp;<span class="ident" id="8346750">a</span><span class="op" id="8346751">,</span>&nbsp;<span class="ident" id="8346753">ok</span>&nbsp;<span class="op" id="8346756">:=</span>&nbsp;<span class="ident" id="8346759">la</span><span class="op" id="8346761">.</span><span class="op" id="8346762">(</span><span class="op" id="8346763">*</span><span class="ident" id="8346764">UDPAddr</span><span class="op" id="8346771">)</span><span class="op" id="8346772">;</span>&nbsp;<span class="op" id="8346774">!</span><span class="ident" id="8346775">ok</span>&nbsp;<span class="op" id="8346778">||</span>&nbsp;<span class="ident" id="8346781">a</span><span class="op" id="8346782">.</span><span class="ident" id="8346783">Port</span>&nbsp;<span class="op" id="8346788">==</span>&nbsp;<span class="num" id="8346791">0</span>&nbsp;<span class="op" id="8346793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346798">t</span><span class="op" id="8346799">.</span><span class="ident" id="8346800">Fatalf</span><span class="op" id="8346806">(</span><span class="string" id="8346807">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;non-zero&nbsp;port&nbsp;number&#34;</span><span class="op" id="8346868">,</span>&nbsp;<span class="ident" id="8346870">la</span><span class="op" id="8346872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346876">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346879">}</span><br>
<span class="lineno"></span><span class="op" id="8346881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8346884">func</span>&nbsp;<span class="ident" id="8346889">TestUDPConnLocalAndRemoteNames</span><span class="op" id="8346919">(</span><span class="ident" id="8346920">t</span>&nbsp;<span class="op" id="8346922">*</span><span class="ident" id="8346923">testing</span><span class="op" id="8346930">.</span><span class="ident" id="8346931">T</span><span class="op" id="8346932">)</span>&nbsp;<span class="op" id="8346934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346937">for</span>&nbsp;<span class="ident" id="8346941">_</span><span class="op" id="8346942">,</span>&nbsp;<span class="ident" id="8346944">laddr</span>&nbsp;<span class="op" id="8346950">:=</span>&nbsp;<span class="keyword" id="8346953">range</span>&nbsp;<span class="op" id="8346959">[</span><span class="op" id="8346960">]</span><span class="builtintype" id="8346961">string</span><span class="op" id="8346967">{</span><span class="string" id="8346968">&#34;&#34;</span><span class="op" id="8346970">,</span>&nbsp;<span class="string" id="8346972">&#34;127.0.0.1:0&#34;</span><span class="op" id="8346985">}</span>&nbsp;<span class="op" id="8346987">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346991">c1</span><span class="op" id="8346993">,</span>&nbsp;<span class="ident" id="8346995">err</span>&nbsp;<span class="op" id="8346999">:=</span>&nbsp;<span class="ident" id="8347002">ListenPacket</span><span class="op" id="8347014">(</span><span class="string" id="8347015">&#34;udp&#34;</span><span class="op" id="8347020">,</span>&nbsp;<span class="string" id="8347022">&#34;127.0.0.1:0&#34;</span><span class="op" id="8347035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347039">if</span>&nbsp;<span class="ident" id="8347042">err</span>&nbsp;<span class="op" id="8347046">!=</span>&nbsp;<span class="ident" id="8347049">nil</span>&nbsp;<span class="op" id="8347053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347058">t</span><span class="op" id="8347059">.</span><span class="ident" id="8347060">Fatalf</span><span class="op" id="8347066">(</span><span class="string" id="8347067">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8347089">,</span>&nbsp;<span class="ident" id="8347091">err</span><span class="op" id="8347094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347102">defer</span>&nbsp;<span class="ident" id="8347108">c1</span><span class="op" id="8347110">.</span><span class="ident" id="8347111">Close</span><span class="op" id="8347116">(</span><span class="op" id="8347117">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347122">var</span>&nbsp;<span class="ident" id="8347126">la</span>&nbsp;<span class="op" id="8347129">*</span><span class="ident" id="8347130">UDPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347140">if</span>&nbsp;<span class="ident" id="8347143">laddr</span>&nbsp;<span class="op" id="8347149">!=</span>&nbsp;<span class="string" id="8347152">&#34;&#34;</span>&nbsp;<span class="op" id="8347155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347160">var</span>&nbsp;<span class="ident" id="8347164">err</span>&nbsp;<span class="builtintype" id="8347168">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347177">if</span>&nbsp;<span class="ident" id="8347180">la</span><span class="op" id="8347182">,</span>&nbsp;<span class="ident" id="8347184">err</span>&nbsp;<span class="op" id="8347188">=</span>&nbsp;<span class="ident" id="8347190">ResolveUDPAddr</span><span class="op" id="8347204">(</span><span class="string" id="8347205">&#34;udp&#34;</span><span class="op" id="8347210">,</span>&nbsp;<span class="ident" id="8347212">laddr</span><span class="op" id="8347217">)</span><span class="op" id="8347218">;</span>&nbsp;<span class="ident" id="8347220">err</span>&nbsp;<span class="op" id="8347224">!=</span>&nbsp;<span class="ident" id="8347227">nil</span>&nbsp;<span class="op" id="8347231">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347237">t</span><span class="op" id="8347238">.</span><span class="ident" id="8347239">Fatalf</span><span class="op" id="8347245">(</span><span class="string" id="8347246">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8347273">,</span>&nbsp;<span class="ident" id="8347275">err</span><span class="op" id="8347278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347291">c2</span><span class="op" id="8347293">,</span>&nbsp;<span class="ident" id="8347295">err</span>&nbsp;<span class="op" id="8347299">:=</span>&nbsp;<span class="ident" id="8347302">DialUDP</span><span class="op" id="8347309">(</span><span class="string" id="8347310">&#34;udp&#34;</span><span class="op" id="8347315">,</span>&nbsp;<span class="ident" id="8347317">la</span><span class="op" id="8347319">,</span>&nbsp;<span class="ident" id="8347321">c1</span><span class="op" id="8347323">.</span><span class="ident" id="8347324">LocalAddr</span><span class="op" id="8347333">(</span><span class="op" id="8347334">)</span><span class="op" id="8347335">.</span><span class="op" id="8347336">(</span><span class="op" id="8347337">*</span><span class="ident" id="8347338">UDPAddr</span><span class="op" id="8347345">)</span><span class="op" id="8347346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347350">if</span>&nbsp;<span class="ident" id="8347353">err</span>&nbsp;<span class="op" id="8347357">!=</span>&nbsp;<span class="ident" id="8347360">nil</span>&nbsp;<span class="op" id="8347364">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347369">t</span><span class="op" id="8347370">.</span><span class="ident" id="8347371">Fatalf</span><span class="op" id="8347377">(</span><span class="string" id="8347378">&#34;DialUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8347398">,</span>&nbsp;<span class="ident" id="8347400">err</span><span class="op" id="8347403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347411">defer</span>&nbsp;<span class="ident" id="8347417">c2</span><span class="op" id="8347419">.</span><span class="ident" id="8347420">Close</span><span class="op" id="8347425">(</span><span class="op" id="8347426">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347431">var</span>&nbsp;<span class="ident" id="8347435">connAddrs</span>&nbsp;<span class="op" id="8347445">=</span>&nbsp;<span class="op" id="8347447">[</span><span class="num" id="8347448">4</span><span class="op" id="8347449">]</span><span class="keyword" id="8347450">struct</span>&nbsp;<span class="op" id="8347457">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347462">got</span>&nbsp;<span class="ident" id="8347466">Addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347474">ok</span>&nbsp;&nbsp;<span class="builtintype" id="8347478">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347485">}</span><span class="op" id="8347486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347491">{</span><span class="ident" id="8347492">c1</span><span class="op" id="8347494">.</span><span class="ident" id="8347495">LocalAddr</span><span class="op" id="8347504">(</span><span class="op" id="8347505">)</span><span class="op" id="8347506">,</span>&nbsp;<span class="builtintype" id="8347508">true</span><span class="op" id="8347512">}</span><span class="op" id="8347513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347518">{</span><span class="ident" id="8347519">c1</span><span class="op" id="8347521">.</span><span class="op" id="8347522">(</span><span class="op" id="8347523">*</span><span class="ident" id="8347524">UDPConn</span><span class="op" id="8347531">)</span><span class="op" id="8347532">.</span><span class="ident" id="8347533">RemoteAddr</span><span class="op" id="8347543">(</span><span class="op" id="8347544">)</span><span class="op" id="8347545">,</span>&nbsp;<span class="builtintype" id="8347547">false</span><span class="op" id="8347552">}</span><span class="op" id="8347553">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347558">{</span><span class="ident" id="8347559">c2</span><span class="op" id="8347561">.</span><span class="ident" id="8347562">LocalAddr</span><span class="op" id="8347571">(</span><span class="op" id="8347572">)</span><span class="op" id="8347573">,</span>&nbsp;<span class="builtintype" id="8347575">true</span><span class="op" id="8347579">}</span><span class="op" id="8347580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347585">{</span><span class="ident" id="8347586">c2</span><span class="op" id="8347588">.</span><span class="ident" id="8347589">RemoteAddr</span><span class="op" id="8347599">(</span><span class="op" id="8347600">)</span><span class="op" id="8347601">,</span>&nbsp;<span class="builtintype" id="8347603">true</span><span class="op" id="8347607">}</span><span class="op" id="8347608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347616">for</span>&nbsp;<span class="ident" id="8347620">_</span><span class="op" id="8347621">,</span>&nbsp;<span class="ident" id="8347623">ca</span>&nbsp;<span class="op" id="8347626">:=</span>&nbsp;<span class="keyword" id="8347629">range</span>&nbsp;<span class="ident" id="8347635">connAddrs</span>&nbsp;<span class="op" id="8347645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347650">if</span>&nbsp;<span class="ident" id="8347653">a</span><span class="op" id="8347654">,</span>&nbsp;<span class="ident" id="8347656">ok</span>&nbsp;<span class="op" id="8347659">:=</span>&nbsp;<span class="ident" id="8347662">ca</span><span class="op" id="8347664">.</span><span class="ident" id="8347665">got</span><span class="op" id="8347668">.</span><span class="op" id="8347669">(</span><span class="op" id="8347670">*</span><span class="ident" id="8347671">UDPAddr</span><span class="op" id="8347678">)</span><span class="op" id="8347679">;</span>&nbsp;<span class="ident" id="8347681">ok</span>&nbsp;<span class="op" id="8347684">!=</span>&nbsp;<span class="ident" id="8347687">ca</span><span class="op" id="8347689">.</span><span class="ident" id="8347690">ok</span>&nbsp;<span class="op" id="8347693">||</span>&nbsp;<span class="ident" id="8347696">ok</span>&nbsp;<span class="op" id="8347699">&amp;&amp;</span>&nbsp;<span class="ident" id="8347702">a</span><span class="op" id="8347703">.</span><span class="ident" id="8347704">Port</span>&nbsp;<span class="op" id="8347709">==</span>&nbsp;<span class="num" id="8347712">0</span>&nbsp;<span class="op" id="8347714">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347720">t</span><span class="op" id="8347721">.</span><span class="ident" id="8347722">Fatalf</span><span class="op" id="8347728">(</span><span class="string" id="8347729">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;non-zero&nbsp;port&nbsp;number&#34;</span><span class="op" id="8347790">,</span>&nbsp;<span class="ident" id="8347792">ca</span><span class="op" id="8347794">.</span><span class="ident" id="8347795">got</span><span class="op" id="8347798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347810">}</span><br>
<span class="lineno"></span><span class="op" id="8347812">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="8347815">func</span>&nbsp;<span class="ident" id="8347820">TestIPv6LinkLocalUnicastUDP</span><span class="op" id="8347847">(</span><span class="ident" id="8347848">t</span>&nbsp;<span class="op" id="8347850">*</span><span class="ident" id="8347851">testing</span><span class="op" id="8347858">.</span><span class="ident" id="8347859">T</span><span class="op" id="8347860">)</span>&nbsp;<span class="op" id="8347862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347865">if</span>&nbsp;<span class="ident" id="8347868">testing</span><span class="op" id="8347875">.</span><span class="ident" id="8347876">Short</span><span class="op" id="8347881">(</span><span class="op" id="8347882">)</span>&nbsp;<span class="op" id="8347884">||</span>&nbsp;<span class="op" id="8347887">!</span><span class="op" id="8347888">*</span><span class="ident" id="8347889">testExternal</span>&nbsp;<span class="op" id="8347902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347906">t</span><span class="op" id="8347907">.</span><span class="ident" id="8347908">Skip</span><span class="op" id="8347912">(</span><span class="string" id="8347913">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8347954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347957">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347960">if</span>&nbsp;<span class="op" id="8347963">!</span><span class="ident" id="8347964">supportsIPv6</span>&nbsp;<span class="op" id="8347977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347981">t</span><span class="op" id="8347982">.</span><span class="ident" id="8347983">Skip</span><span class="op" id="8347987">(</span><span class="string" id="8347988">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8348011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348017">ifi</span>&nbsp;<span class="op" id="8348021">:=</span>&nbsp;<span class="ident" id="8348024">loopbackInterface</span><span class="op" id="8348041">(</span><span class="op" id="8348042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348045">if</span>&nbsp;<span class="ident" id="8348048">ifi</span>&nbsp;<span class="op" id="8348052">==</span>&nbsp;<span class="ident" id="8348055">nil</span>&nbsp;<span class="op" id="8348059">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348063">t</span><span class="op" id="8348064">.</span><span class="ident" id="8348065">Skip</span><span class="op" id="8348069">(</span><span class="string" id="8348070">&#34;loopback&nbsp;interface&nbsp;not&nbsp;found&#34;</span><span class="op" id="8348100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348106">laddr</span>&nbsp;<span class="op" id="8348112">:=</span>&nbsp;<span class="ident" id="8348115">ipv6LinkLocalUnicastAddr</span><span class="op" id="8348139">(</span><span class="ident" id="8348140">ifi</span><span class="op" id="8348143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348146">if</span>&nbsp;<span class="ident" id="8348149">laddr</span>&nbsp;<span class="op" id="8348155">==</span>&nbsp;<span class="string" id="8348158">&#34;&#34;</span>&nbsp;<span class="op" id="8348161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348165">t</span><span class="op" id="8348166">.</span><span class="ident" id="8348167">Skip</span><span class="op" id="8348171">(</span><span class="string" id="8348172">&#34;ipv6&nbsp;unicast&nbsp;address&nbsp;on&nbsp;loopback&nbsp;not&nbsp;found&#34;</span><span class="op" id="8348216">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348223">type</span>&nbsp;<span class="ident" id="8348228">test</span>&nbsp;<span class="keyword" id="8348233">struct</span>&nbsp;<span class="op" id="8348240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348244">net</span><span class="op" id="8348247">,</span>&nbsp;<span class="ident" id="8348249">addr</span>&nbsp;&nbsp;<span class="builtintype" id="8348255">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348264">nameLookup</span>&nbsp;<span class="builtintype" id="8348275">bool</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348284">var</span>&nbsp;<span class="ident" id="8348288">tests</span>&nbsp;<span class="op" id="8348294">=</span>&nbsp;<span class="op" id="8348296">[</span><span class="op" id="8348297">]</span><span class="ident" id="8348298">test</span><span class="op" id="8348302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348306">{</span><span class="string" id="8348307">&#34;udp&#34;</span><span class="op" id="8348312">,</span>&nbsp;<span class="string" id="8348314">&#34;[&#34;</span>&nbsp;<span class="op" id="8348318">+</span>&nbsp;<span class="ident" id="8348320">laddr</span>&nbsp;<span class="op" id="8348326">+</span>&nbsp;<span class="string" id="8348328">&#34;%&#34;</span>&nbsp;<span class="op" id="8348332">+</span>&nbsp;<span class="ident" id="8348334">ifi</span><span class="op" id="8348337">.</span><span class="ident" id="8348338">Name</span>&nbsp;<span class="op" id="8348343">+</span>&nbsp;<span class="string" id="8348345">&#34;]:0&#34;</span><span class="op" id="8348350">,</span>&nbsp;<span class="builtintype" id="8348352">false</span><span class="op" id="8348357">}</span><span class="op" id="8348358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348362">{</span><span class="string" id="8348363">&#34;udp6&#34;</span><span class="op" id="8348369">,</span>&nbsp;<span class="string" id="8348371">&#34;[&#34;</span>&nbsp;<span class="op" id="8348375">+</span>&nbsp;<span class="ident" id="8348377">laddr</span>&nbsp;<span class="op" id="8348383">+</span>&nbsp;<span class="string" id="8348385">&#34;%&#34;</span>&nbsp;<span class="op" id="8348389">+</span>&nbsp;<span class="ident" id="8348391">ifi</span><span class="op" id="8348394">.</span><span class="ident" id="8348395">Name</span>&nbsp;<span class="op" id="8348400">+</span>&nbsp;<span class="string" id="8348402">&#34;]:0&#34;</span><span class="op" id="8348407">,</span>&nbsp;<span class="builtintype" id="8348409">false</span><span class="op" id="8348414">}</span><span class="op" id="8348415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348418">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8348421">//&nbsp;The&nbsp;first&nbsp;udp&nbsp;test&nbsp;fails&nbsp;on&nbsp;DragonFly&nbsp;-&nbsp;see&nbsp;issue&nbsp;7473.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348481">if</span>&nbsp;<span class="ident" id="8348484">runtime</span><span class="op" id="8348491">.</span><span class="ident" id="8348492">GOOS</span>&nbsp;<span class="op" id="8348497">==</span>&nbsp;<span class="string" id="8348500">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="8348512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348516">tests</span>&nbsp;<span class="op" id="8348522">=</span>&nbsp;<span class="ident" id="8348524">tests</span><span class="op" id="8348529">[</span><span class="num" id="8348530">1</span><span class="op" id="8348531">:</span><span class="op" id="8348532">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348538">switch</span>&nbsp;<span class="ident" id="8348545">runtime</span><span class="op" id="8348552">.</span><span class="ident" id="8348553">GOOS</span>&nbsp;<span class="op" id="8348558">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348561">case</span>&nbsp;<span class="string" id="8348566">&#34;darwin&#34;</span><span class="op" id="8348574">,</span>&nbsp;<span class="string" id="8348576">&#34;dragonfly&#34;</span><span class="op" id="8348587">,</span>&nbsp;<span class="string" id="8348589">&#34;freebsd&#34;</span><span class="op" id="8348598">,</span>&nbsp;<span class="string" id="8348600">&#34;openbsd&#34;</span><span class="op" id="8348609">,</span>&nbsp;<span class="string" id="8348611">&#34;netbsd&#34;</span><span class="op" id="8348619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348623">tests</span>&nbsp;<span class="op" id="8348629">=</span>&nbsp;<span class="builtinfunc" id="8348631">append</span><span class="op" id="8348637">(</span><span class="ident" id="8348638">tests</span><span class="op" id="8348643">,</span>&nbsp;<span class="op" id="8348645">[</span><span class="op" id="8348646">]</span><span class="ident" id="8348647">test</span><span class="op" id="8348651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348656">{</span><span class="string" id="8348657">&#34;udp&#34;</span><span class="op" id="8348662">,</span>&nbsp;<span class="string" id="8348664">&#34;[localhost%&#34;</span>&nbsp;<span class="op" id="8348678">+</span>&nbsp;<span class="ident" id="8348680">ifi</span><span class="op" id="8348683">.</span><span class="ident" id="8348684">Name</span>&nbsp;<span class="op" id="8348689">+</span>&nbsp;<span class="string" id="8348691">&#34;]:0&#34;</span><span class="op" id="8348696">,</span>&nbsp;<span class="builtintype" id="8348698">true</span><span class="op" id="8348702">}</span><span class="op" id="8348703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348708">{</span><span class="string" id="8348709">&#34;udp6&#34;</span><span class="op" id="8348715">,</span>&nbsp;<span class="string" id="8348717">&#34;[localhost%&#34;</span>&nbsp;<span class="op" id="8348731">+</span>&nbsp;<span class="ident" id="8348733">ifi</span><span class="op" id="8348736">.</span><span class="ident" id="8348737">Name</span>&nbsp;<span class="op" id="8348742">+</span>&nbsp;<span class="string" id="8348744">&#34;]:0&#34;</span><span class="op" id="8348749">,</span>&nbsp;<span class="builtintype" id="8348751">true</span><span class="op" id="8348755">}</span><span class="op" id="8348756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348760">}</span><span class="op" id="8348761">...</span><span class="op" id="8348764">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348767">case</span>&nbsp;<span class="string" id="8348772">&#34;linux&#34;</span><span class="op" id="8348779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348783">tests</span>&nbsp;<span class="op" id="8348789">=</span>&nbsp;<span class="builtinfunc" id="8348791">append</span><span class="op" id="8348797">(</span><span class="ident" id="8348798">tests</span><span class="op" id="8348803">,</span>&nbsp;<span class="op" id="8348805">[</span><span class="op" id="8348806">]</span><span class="ident" id="8348807">test</span><span class="op" id="8348811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348816">{</span><span class="string" id="8348817">&#34;udp&#34;</span><span class="op" id="8348822">,</span>&nbsp;<span class="string" id="8348824">&#34;[ip6-localhost%&#34;</span>&nbsp;<span class="op" id="8348842">+</span>&nbsp;<span class="ident" id="8348844">ifi</span><span class="op" id="8348847">.</span><span class="ident" id="8348848">Name</span>&nbsp;<span class="op" id="8348853">+</span>&nbsp;<span class="string" id="8348855">&#34;]:0&#34;</span><span class="op" id="8348860">,</span>&nbsp;<span class="builtintype" id="8348862">true</span><span class="op" id="8348866">}</span><span class="op" id="8348867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348872">{</span><span class="string" id="8348873">&#34;udp6&#34;</span><span class="op" id="8348879">,</span>&nbsp;<span class="string" id="8348881">&#34;[ip6-localhost%&#34;</span>&nbsp;<span class="op" id="8348899">+</span>&nbsp;<span class="ident" id="8348901">ifi</span><span class="op" id="8348904">.</span><span class="ident" id="8348905">Name</span>&nbsp;<span class="op" id="8348910">+</span>&nbsp;<span class="string" id="8348912">&#34;]:0&#34;</span><span class="op" id="8348917">,</span>&nbsp;<span class="builtintype" id="8348919">true</span><span class="op" id="8348923">}</span><span class="op" id="8348924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348928">}</span><span class="op" id="8348929">...</span><span class="op" id="8348932">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348938">for</span>&nbsp;<span class="ident" id="8348942">_</span><span class="op" id="8348943">,</span>&nbsp;<span class="ident" id="8348945">tt</span>&nbsp;<span class="op" id="8348948">:=</span>&nbsp;<span class="keyword" id="8348951">range</span>&nbsp;<span class="ident" id="8348957">tests</span>&nbsp;<span class="op" id="8348963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348967">c1</span><span class="op" id="8348969">,</span>&nbsp;<span class="ident" id="8348971">err</span>&nbsp;<span class="op" id="8348975">:=</span>&nbsp;<span class="ident" id="8348978">ListenPacket</span><span class="op" id="8348990">(</span><span class="ident" id="8348991">tt</span><span class="op" id="8348993">.</span><span class="ident" id="8348994">net</span><span class="op" id="8348997">,</span>&nbsp;<span class="ident" id="8348999">tt</span><span class="op" id="8349001">.</span><span class="ident" id="8349002">addr</span><span class="op" id="8349006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349010">if</span>&nbsp;<span class="ident" id="8349013">err</span>&nbsp;<span class="op" id="8349017">!=</span>&nbsp;<span class="ident" id="8349020">nil</span>&nbsp;<span class="op" id="8349024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8349029">//&nbsp;It&nbsp;might&nbsp;return&nbsp;&#34;LookupHost&nbsp;returned&nbsp;no</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8349075">//&nbsp;suitable&nbsp;address&#34;&nbsp;error&nbsp;on&nbsp;some&nbsp;platforms.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349124">t</span><span class="op" id="8349125">.</span><span class="ident" id="8349126">Logf</span><span class="op" id="8349130">(</span><span class="string" id="8349131">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8349156">,</span>&nbsp;<span class="ident" id="8349158">err</span><span class="op" id="8349161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349166">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349181">defer</span>&nbsp;<span class="ident" id="8349187">c1</span><span class="op" id="8349189">.</span><span class="ident" id="8349190">Close</span><span class="op" id="8349195">(</span><span class="op" id="8349196">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349200">if</span>&nbsp;<span class="ident" id="8349203">la</span><span class="op" id="8349205">,</span>&nbsp;<span class="ident" id="8349207">ok</span>&nbsp;<span class="op" id="8349210">:=</span>&nbsp;<span class="ident" id="8349213">c1</span><span class="op" id="8349215">.</span><span class="ident" id="8349216">LocalAddr</span><span class="op" id="8349225">(</span><span class="op" id="8349226">)</span><span class="op" id="8349227">.</span><span class="op" id="8349228">(</span><span class="op" id="8349229">*</span><span class="ident" id="8349230">UDPAddr</span><span class="op" id="8349237">)</span><span class="op" id="8349238">;</span>&nbsp;<span class="op" id="8349240">!</span><span class="ident" id="8349241">ok</span>&nbsp;<span class="op" id="8349244">||</span>&nbsp;<span class="op" id="8349247">!</span><span class="ident" id="8349248">tt</span><span class="op" id="8349250">.</span><span class="ident" id="8349251">nameLookup</span>&nbsp;<span class="op" id="8349262">&amp;&amp;</span>&nbsp;<span class="ident" id="8349265">la</span><span class="op" id="8349267">.</span><span class="ident" id="8349268">Zone</span>&nbsp;<span class="op" id="8349273">==</span>&nbsp;<span class="string" id="8349276">&#34;&#34;</span>&nbsp;<span class="op" id="8349279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349284">t</span><span class="op" id="8349285">.</span><span class="ident" id="8349286">Fatalf</span><span class="op" id="8349292">(</span><span class="string" id="8349293">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="8349349">,</span>&nbsp;<span class="ident" id="8349351">la</span><span class="op" id="8349353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349362">c2</span><span class="op" id="8349364">,</span>&nbsp;<span class="ident" id="8349366">err</span>&nbsp;<span class="op" id="8349370">:=</span>&nbsp;<span class="ident" id="8349373">Dial</span><span class="op" id="8349377">(</span><span class="ident" id="8349378">tt</span><span class="op" id="8349380">.</span><span class="ident" id="8349381">net</span><span class="op" id="8349384">,</span>&nbsp;<span class="ident" id="8349386">c1</span><span class="op" id="8349388">.</span><span class="ident" id="8349389">LocalAddr</span><span class="op" id="8349398">(</span><span class="op" id="8349399">)</span><span class="op" id="8349400">.</span><span class="ident" id="8349401">String</span><span class="op" id="8349407">(</span><span class="op" id="8349408">)</span><span class="op" id="8349409">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349413">if</span>&nbsp;<span class="ident" id="8349416">err</span>&nbsp;<span class="op" id="8349420">!=</span>&nbsp;<span class="ident" id="8349423">nil</span>&nbsp;<span class="op" id="8349427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349432">t</span><span class="op" id="8349433">.</span><span class="ident" id="8349434">Fatalf</span><span class="op" id="8349440">(</span><span class="string" id="8349441">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8349458">,</span>&nbsp;<span class="ident" id="8349460">err</span><span class="op" id="8349463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349471">defer</span>&nbsp;<span class="ident" id="8349477">c2</span><span class="op" id="8349479">.</span><span class="ident" id="8349480">Close</span><span class="op" id="8349485">(</span><span class="op" id="8349486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349490">if</span>&nbsp;<span class="ident" id="8349493">la</span><span class="op" id="8349495">,</span>&nbsp;<span class="ident" id="8349497">ok</span>&nbsp;<span class="op" id="8349500">:=</span>&nbsp;<span class="ident" id="8349503">c2</span><span class="op" id="8349505">.</span><span class="ident" id="8349506">LocalAddr</span><span class="op" id="8349515">(</span><span class="op" id="8349516">)</span><span class="op" id="8349517">.</span><span class="op" id="8349518">(</span><span class="op" id="8349519">*</span><span class="ident" id="8349520">UDPAddr</span><span class="op" id="8349527">)</span><span class="op" id="8349528">;</span>&nbsp;<span class="op" id="8349530">!</span><span class="ident" id="8349531">ok</span>&nbsp;<span class="op" id="8349534">||</span>&nbsp;<span class="op" id="8349537">!</span><span class="ident" id="8349538">tt</span><span class="op" id="8349540">.</span><span class="ident" id="8349541">nameLookup</span>&nbsp;<span class="op" id="8349552">&amp;&amp;</span>&nbsp;<span class="ident" id="8349555">la</span><span class="op" id="8349557">.</span><span class="ident" id="8349558">Zone</span>&nbsp;<span class="op" id="8349563">==</span>&nbsp;<span class="string" id="8349566">&#34;&#34;</span>&nbsp;<span class="op" id="8349569">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349574">t</span><span class="op" id="8349575">.</span><span class="ident" id="8349576">Fatalf</span><span class="op" id="8349582">(</span><span class="string" id="8349583">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="8349639">,</span>&nbsp;<span class="ident" id="8349641">la</span><span class="op" id="8349643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349651">if</span>&nbsp;<span class="ident" id="8349654">ra</span><span class="op" id="8349656">,</span>&nbsp;<span class="ident" id="8349658">ok</span>&nbsp;<span class="op" id="8349661">:=</span>&nbsp;<span class="ident" id="8349664">c2</span><span class="op" id="8349666">.</span><span class="ident" id="8349667">RemoteAddr</span><span class="op" id="8349677">(</span><span class="op" id="8349678">)</span><span class="op" id="8349679">.</span><span class="op" id="8349680">(</span><span class="op" id="8349681">*</span><span class="ident" id="8349682">UDPAddr</span><span class="op" id="8349689">)</span><span class="op" id="8349690">;</span>&nbsp;<span class="op" id="8349692">!</span><span class="ident" id="8349693">ok</span>&nbsp;<span class="op" id="8349696">||</span>&nbsp;<span class="op" id="8349699">!</span><span class="ident" id="8349700">tt</span><span class="op" id="8349702">.</span><span class="ident" id="8349703">nameLookup</span>&nbsp;<span class="op" id="8349714">&amp;&amp;</span>&nbsp;<span class="ident" id="8349717">ra</span><span class="op" id="8349719">.</span><span class="ident" id="8349720">Zone</span>&nbsp;<span class="op" id="8349725">==</span>&nbsp;<span class="string" id="8349728">&#34;&#34;</span>&nbsp;<span class="op" id="8349731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349736">t</span><span class="op" id="8349737">.</span><span class="ident" id="8349738">Fatalf</span><span class="op" id="8349744">(</span><span class="string" id="8349745">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="8349801">,</span>&nbsp;<span class="ident" id="8349803">ra</span><span class="op" id="8349805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349809">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349814">if</span>&nbsp;<span class="ident" id="8349817">_</span><span class="op" id="8349818">,</span>&nbsp;<span class="ident" id="8349820">err</span>&nbsp;<span class="op" id="8349824">:=</span>&nbsp;<span class="ident" id="8349827">c2</span><span class="op" id="8349829">.</span><span class="ident" id="8349830">Write</span><span class="op" id="8349835">(</span><span class="op" id="8349836">[</span><span class="op" id="8349837">]</span><span class="builtintype" id="8349838">byte</span><span class="op" id="8349842">(</span><span class="string" id="8349843">&#34;UDP&nbsp;OVER&nbsp;IPV6&nbsp;LINKLOCAL&nbsp;TEST&#34;</span><span class="op" id="8349873">)</span><span class="op" id="8349874">)</span><span class="op" id="8349875">;</span>&nbsp;<span class="ident" id="8349877">err</span>&nbsp;<span class="op" id="8349881">!=</span>&nbsp;<span class="ident" id="8349884">nil</span>&nbsp;<span class="op" id="8349888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349893">t</span><span class="op" id="8349894">.</span><span class="ident" id="8349895">Fatalf</span><span class="op" id="8349901">(</span><span class="string" id="8349902">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8349925">,</span>&nbsp;<span class="ident" id="8349927">err</span><span class="op" id="8349930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349938">b</span>&nbsp;<span class="op" id="8349940">:=</span>&nbsp;<span class="builtinfunc" id="8349943">make</span><span class="op" id="8349947">(</span><span class="op" id="8349948">[</span><span class="op" id="8349949">]</span><span class="builtintype" id="8349950">byte</span><span class="op" id="8349954">,</span>&nbsp;<span class="num" id="8349956">32</span><span class="op" id="8349958">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349962">if</span>&nbsp;<span class="ident" id="8349965">_</span><span class="op" id="8349966">,</span>&nbsp;<span class="ident" id="8349968">from</span><span class="op" id="8349972">,</span>&nbsp;<span class="ident" id="8349974">err</span>&nbsp;<span class="op" id="8349978">:=</span>&nbsp;<span class="ident" id="8349981">c1</span><span class="op" id="8349983">.</span><span class="ident" id="8349984">ReadFrom</span><span class="op" id="8349992">(</span><span class="ident" id="8349993">b</span><span class="op" id="8349994">)</span><span class="op" id="8349995">;</span>&nbsp;<span class="ident" id="8349997">err</span>&nbsp;<span class="op" id="8350001">!=</span>&nbsp;<span class="ident" id="8350004">nil</span>&nbsp;<span class="op" id="8350008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350013">t</span><span class="op" id="8350014">.</span><span class="ident" id="8350015">Fatalf</span><span class="op" id="8350021">(</span><span class="string" id="8350022">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8350054">,</span>&nbsp;<span class="ident" id="8350056">err</span><span class="op" id="8350059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350063">}</span>&nbsp;<span class="keyword" id="8350065">else</span>&nbsp;<span class="op" id="8350070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350075">if</span>&nbsp;<span class="ident" id="8350078">ra</span><span class="op" id="8350080">,</span>&nbsp;<span class="ident" id="8350082">ok</span>&nbsp;<span class="op" id="8350085">:=</span>&nbsp;<span class="ident" id="8350088">from</span><span class="op" id="8350092">.</span><span class="op" id="8350093">(</span><span class="op" id="8350094">*</span><span class="ident" id="8350095">UDPAddr</span><span class="op" id="8350102">)</span><span class="op" id="8350103">;</span>&nbsp;<span class="op" id="8350105">!</span><span class="ident" id="8350106">ok</span>&nbsp;<span class="op" id="8350109">||</span>&nbsp;<span class="op" id="8350112">!</span><span class="ident" id="8350113">tt</span><span class="op" id="8350115">.</span><span class="ident" id="8350116">nameLookup</span>&nbsp;<span class="op" id="8350127">&amp;&amp;</span>&nbsp;<span class="ident" id="8350130">ra</span><span class="op" id="8350132">.</span><span class="ident" id="8350133">Zone</span>&nbsp;<span class="op" id="8350138">==</span>&nbsp;<span class="string" id="8350141">&#34;&#34;</span>&nbsp;<span class="op" id="8350144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350150">t</span><span class="op" id="8350151">.</span><span class="ident" id="8350152">Fatalf</span><span class="op" id="8350158">(</span><span class="string" id="8350159">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="8350215">,</span>&nbsp;<span class="ident" id="8350217">ra</span><span class="op" id="8350219">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350231">}</span><br>
<span class="lineno"></span><span class="op" id="8350233">}</span>
</div>
</body>
</html>
