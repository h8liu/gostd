<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4997702">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4997757">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4997811">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4997862">//go:generate&nbsp;go&nbsp;run&nbsp;decgen.go&nbsp;-output&nbsp;dec_helpers.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4997917">package</span>&nbsp;<span class="ident" id="4997925">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4997930">import</span>&nbsp;<span class="op" id="4997937">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4997940">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4997952">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4997962">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4997968">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4997976">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4997986">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4997989">var</span>&nbsp;<span class="op" id="4997993">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997996">errBadUint</span>&nbsp;<span class="op" id="4998007">=</span>&nbsp;<span class="ident" id="4998009">errors</span><span class="op" id="4998015">.</span><span class="ident" id="4998016">New</span><span class="op" id="4998019">(</span><span class="string" id="4998020">&#34;gob:&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="4998064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998067">errBadType</span>&nbsp;<span class="op" id="4998078">=</span>&nbsp;<span class="ident" id="4998080">errors</span><span class="op" id="4998086">.</span><span class="ident" id="4998087">New</span><span class="op" id="4998090">(</span><span class="string" id="4998091">&#34;gob:&nbsp;unknown&nbsp;type&nbsp;id&nbsp;or&nbsp;corrupted&nbsp;data&#34;</span><span class="op" id="4998131">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998134">errRange</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4998145">=</span>&nbsp;<span class="ident" id="4998147">errors</span><span class="op" id="4998153">.</span><span class="ident" id="4998154">New</span><span class="op" id="4998157">(</span><span class="string" id="4998158">&#34;gob:&nbsp;bad&nbsp;data:&nbsp;field&nbsp;numbers&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="4998202">)</span><br>
<span class="lineno"></span><span class="op" id="4998204">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4998207">type</span>&nbsp;<span class="ident" id="4998212">decHelper</span>&nbsp;<span class="keyword" id="4998222">func</span><span class="op" id="4998226">(</span><span class="ident" id="4998227">state</span>&nbsp;<span class="op" id="4998233">*</span><span class="ident" id="4998234">decoderState</span><span class="op" id="4998246">,</span>&nbsp;<span class="ident" id="4998248">v</span>&nbsp;<span class="ident" id="4998250">reflect</span><span class="op" id="4998257">.</span><span class="ident" id="4998258">Value</span><span class="op" id="4998263">,</span>&nbsp;<span class="ident" id="4998265">length</span>&nbsp;<span class="builtintype" id="4998272">int</span><span class="op" id="4998275">,</span>&nbsp;<span class="ident" id="4998277">ovfl</span>&nbsp;<span class="builtintype" id="4998282">error</span><span class="op" id="4998287">)</span>&nbsp;<span class="builtintype" id="4998289">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4998295">//&nbsp;decoderState&nbsp;is&nbsp;the&nbsp;execution&nbsp;state&nbsp;of&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;decoder.&nbsp;A&nbsp;new&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="4998377">//&nbsp;is&nbsp;created&nbsp;for&nbsp;nested&nbsp;objects.</span><br>
<span class="lineno"></span><span class="keyword" id="4998411">type</span>&nbsp;<span class="ident" id="4998416">decoderState</span>&nbsp;<span class="keyword" id="4998429">struct</span>&nbsp;<span class="op" id="4998436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998439">dec</span>&nbsp;<span class="op" id="4998443">*</span><span class="ident" id="4998444">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998453">//&nbsp;The&nbsp;buffer&nbsp;is&nbsp;stored&nbsp;with&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;replaced</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998531">//&nbsp;if&nbsp;we&nbsp;load&nbsp;a&nbsp;type&nbsp;during&nbsp;decode&nbsp;(when&nbsp;reading&nbsp;an&nbsp;interface&nbsp;value).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998602">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998611">*</span><span class="ident" id="4998612">decBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998623">fieldnum</span>&nbsp;<span class="builtintype" id="4998632">int</span>&nbsp;<span class="comment" id="4998636">//&nbsp;the&nbsp;last&nbsp;field&nbsp;number&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998668">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998677">[</span><span class="op" id="4998678">]</span><span class="builtintype" id="4998679">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998685">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998694">*</span><span class="ident" id="4998695">decoderState</span>&nbsp;<span class="comment" id="4998708">//&nbsp;for&nbsp;free&nbsp;list</span><br>
<span class="lineno">35</span><span class="op" id="4998725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4998728">//&nbsp;decBuffer&nbsp;is&nbsp;an&nbsp;extremely&nbsp;simple,&nbsp;fast&nbsp;implementation&nbsp;of&nbsp;a&nbsp;read-only&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="4998813">//&nbsp;It&nbsp;is&nbsp;initialized&nbsp;by&nbsp;calling&nbsp;Size&nbsp;and&nbsp;then&nbsp;copying&nbsp;the&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;Bytes().</span><br>
<span class="lineno"></span><span class="keyword" id="4998912">type</span>&nbsp;<span class="ident" id="4998917">decBuffer</span>&nbsp;<span class="keyword" id="4998927">struct</span>&nbsp;<span class="op" id="4998934">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998937">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4998944">[</span><span class="op" id="4998945">]</span><span class="builtintype" id="4998946">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998952">offset</span>&nbsp;<span class="builtintype" id="4998959">int</span>&nbsp;<span class="comment" id="4998963">//&nbsp;Read&nbsp;offset.</span><br>
<span class="lineno"></span><span class="op" id="4998979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4998982">func</span>&nbsp;<span class="op" id="4998987">(</span><span class="ident" id="4998988">d</span>&nbsp;<span class="op" id="4998990">*</span><span class="ident" id="4998991">decBuffer</span><span class="op" id="4999000">)</span>&nbsp;<span class="ident" id="4999002">Read</span><span class="op" id="4999006">(</span><span class="ident" id="4999007">p</span>&nbsp;<span class="op" id="4999009">[</span><span class="op" id="4999010">]</span><span class="builtintype" id="4999011">byte</span><span class="op" id="4999015">)</span>&nbsp;<span class="op" id="4999017">(</span><span class="builtintype" id="4999018">int</span><span class="op" id="4999021">,</span>&nbsp;<span class="builtintype" id="4999023">error</span><span class="op" id="4999028">)</span>&nbsp;<span class="op" id="4999030">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999033">n</span>&nbsp;<span class="op" id="4999035">:=</span>&nbsp;<span class="builtinfunc" id="4999038">copy</span><span class="op" id="4999042">(</span><span class="ident" id="4999043">p</span><span class="op" id="4999044">,</span>&nbsp;<span class="ident" id="4999046">d</span><span class="op" id="4999047">.</span><span class="ident" id="4999048">data</span><span class="op" id="4999052">[</span><span class="ident" id="4999053">d</span><span class="op" id="4999054">.</span><span class="ident" id="4999055">offset</span><span class="op" id="4999061">:</span><span class="op" id="4999062">]</span><span class="op" id="4999063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999066">if</span>&nbsp;<span class="ident" id="4999069">n</span>&nbsp;<span class="op" id="4999071">==</span>&nbsp;<span class="num" id="4999074">0</span>&nbsp;<span class="op" id="4999076">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4999079">len</span><span class="op" id="4999082">(</span><span class="ident" id="4999083">p</span><span class="op" id="4999084">)</span>&nbsp;<span class="op" id="4999086">!=</span>&nbsp;<span class="num" id="4999089">0</span>&nbsp;<span class="op" id="4999091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999095">return</span>&nbsp;<span class="num" id="4999102">0</span><span class="op" id="4999103">,</span>&nbsp;<span class="ident" id="4999105">io</span><span class="op" id="4999107">.</span><span class="ident" id="4999108">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999116">d</span><span class="op" id="4999117">.</span><span class="ident" id="4999118">offset</span>&nbsp;<span class="op" id="4999125">+=</span>&nbsp;<span class="ident" id="4999128">n</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999131">return</span>&nbsp;<span class="ident" id="4999138">n</span><span class="op" id="4999139">,</span>&nbsp;<span class="ident" id="4999141">nil</span><br>
<span class="lineno"></span><span class="op" id="4999145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4999148">func</span>&nbsp;<span class="op" id="4999153">(</span><span class="ident" id="4999154">d</span>&nbsp;<span class="op" id="4999156">*</span><span class="ident" id="4999157">decBuffer</span><span class="op" id="4999166">)</span>&nbsp;<span class="ident" id="4999168">Drop</span><span class="op" id="4999172">(</span><span class="ident" id="4999173">n</span>&nbsp;<span class="builtintype" id="4999175">int</span><span class="op" id="4999178">)</span>&nbsp;<span class="op" id="4999180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999183">if</span>&nbsp;<span class="ident" id="4999186">n</span>&nbsp;<span class="op" id="4999188">&gt;</span>&nbsp;<span class="ident" id="4999190">d</span><span class="op" id="4999191">.</span><span class="ident" id="4999192">Len</span><span class="op" id="4999195">(</span><span class="op" id="4999196">)</span>&nbsp;<span class="op" id="4999198">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4999202">panic</span><span class="op" id="4999207">(</span><span class="string" id="4999208">&#34;drop&#34;</span><span class="op" id="4999214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999220">d</span><span class="op" id="4999221">.</span><span class="ident" id="4999222">offset</span>&nbsp;<span class="op" id="4999229">+=</span>&nbsp;<span class="ident" id="4999232">n</span><br>
<span class="lineno"></span><span class="op" id="4999234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4999237">//&nbsp;Size&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;exactly&nbsp;n&nbsp;bytes,&nbsp;so&nbsp;d.Bytes()&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4999300">//&nbsp;return&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n.&nbsp;Existing&nbsp;data&nbsp;is&nbsp;first&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4999365">func</span>&nbsp;<span class="op" id="4999370">(</span><span class="ident" id="4999371">d</span>&nbsp;<span class="op" id="4999373">*</span><span class="ident" id="4999374">decBuffer</span><span class="op" id="4999383">)</span>&nbsp;<span class="ident" id="4999385">Size</span><span class="op" id="4999389">(</span><span class="ident" id="4999390">n</span>&nbsp;<span class="builtintype" id="4999392">int</span><span class="op" id="4999395">)</span>&nbsp;<span class="op" id="4999397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999400">d</span><span class="op" id="4999401">.</span><span class="ident" id="4999402">Reset</span><span class="op" id="4999407">(</span><span class="op" id="4999408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999411">if</span>&nbsp;<span class="builtinfunc" id="4999414">cap</span><span class="op" id="4999417">(</span><span class="ident" id="4999418">d</span><span class="op" id="4999419">.</span><span class="ident" id="4999420">data</span><span class="op" id="4999424">)</span>&nbsp;<span class="op" id="4999426">&lt;</span>&nbsp;<span class="ident" id="4999428">n</span>&nbsp;<span class="op" id="4999430">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999434">d</span><span class="op" id="4999435">.</span><span class="ident" id="4999436">data</span>&nbsp;<span class="op" id="4999441">=</span>&nbsp;<span class="builtinfunc" id="4999443">make</span><span class="op" id="4999447">(</span><span class="op" id="4999448">[</span><span class="op" id="4999449">]</span><span class="builtintype" id="4999450">byte</span><span class="op" id="4999454">,</span>&nbsp;<span class="ident" id="4999456">n</span><span class="op" id="4999457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999460">}</span>&nbsp;<span class="keyword" id="4999462">else</span>&nbsp;<span class="op" id="4999467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999471">d</span><span class="op" id="4999472">.</span><span class="ident" id="4999473">data</span>&nbsp;<span class="op" id="4999478">=</span>&nbsp;<span class="ident" id="4999480">d</span><span class="op" id="4999481">.</span><span class="ident" id="4999482">data</span><span class="op" id="4999486">[</span><span class="num" id="4999487">0</span><span class="op" id="4999488">:</span><span class="ident" id="4999489">n</span><span class="op" id="4999490">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999493">}</span><br>
<span class="lineno"></span><span class="op" id="4999495">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4999498">func</span>&nbsp;<span class="op" id="4999503">(</span><span class="ident" id="4999504">d</span>&nbsp;<span class="op" id="4999506">*</span><span class="ident" id="4999507">decBuffer</span><span class="op" id="4999516">)</span>&nbsp;<span class="ident" id="4999518">ReadByte</span><span class="op" id="4999526">(</span><span class="op" id="4999527">)</span>&nbsp;<span class="op" id="4999529">(</span><span class="builtintype" id="4999530">byte</span><span class="op" id="4999534">,</span>&nbsp;<span class="builtintype" id="4999536">error</span><span class="op" id="4999541">)</span>&nbsp;<span class="op" id="4999543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999546">if</span>&nbsp;<span class="ident" id="4999549">d</span><span class="op" id="4999550">.</span><span class="ident" id="4999551">offset</span>&nbsp;<span class="op" id="4999558">&gt;=</span>&nbsp;<span class="builtinfunc" id="4999561">len</span><span class="op" id="4999564">(</span><span class="ident" id="4999565">d</span><span class="op" id="4999566">.</span><span class="ident" id="4999567">data</span><span class="op" id="4999571">)</span>&nbsp;<span class="op" id="4999573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999577">return</span>&nbsp;<span class="num" id="4999584">0</span><span class="op" id="4999585">,</span>&nbsp;<span class="ident" id="4999587">io</span><span class="op" id="4999589">.</span><span class="ident" id="4999590">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999595">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999598">c</span>&nbsp;<span class="op" id="4999600">:=</span>&nbsp;<span class="ident" id="4999603">d</span><span class="op" id="4999604">.</span><span class="ident" id="4999605">data</span><span class="op" id="4999609">[</span><span class="ident" id="4999610">d</span><span class="op" id="4999611">.</span><span class="ident" id="4999612">offset</span><span class="op" id="4999618">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999621">d</span><span class="op" id="4999622">.</span><span class="ident" id="4999623">offset</span><span class="op" id="4999629">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999633">return</span>&nbsp;<span class="ident" id="4999640">c</span><span class="op" id="4999641">,</span>&nbsp;<span class="ident" id="4999643">nil</span><br>
<span class="lineno"></span><span class="op" id="4999647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4999650">func</span>&nbsp;<span class="op" id="4999655">(</span><span class="ident" id="4999656">d</span>&nbsp;<span class="op" id="4999658">*</span><span class="ident" id="4999659">decBuffer</span><span class="op" id="4999668">)</span>&nbsp;<span class="ident" id="4999670">Len</span><span class="op" id="4999673">(</span><span class="op" id="4999674">)</span>&nbsp;<span class="builtintype" id="4999676">int</span>&nbsp;<span class="op" id="4999680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999683">return</span>&nbsp;<span class="builtinfunc" id="4999690">len</span><span class="op" id="4999693">(</span><span class="ident" id="4999694">d</span><span class="op" id="4999695">.</span><span class="ident" id="4999696">data</span><span class="op" id="4999700">)</span>&nbsp;<span class="op" id="4999702">-</span>&nbsp;<span class="ident" id="4999704">d</span><span class="op" id="4999705">.</span><span class="ident" id="4999706">offset</span><br>
<span class="lineno"></span><span class="op" id="4999713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4999716">func</span>&nbsp;<span class="op" id="4999721">(</span><span class="ident" id="4999722">d</span>&nbsp;<span class="op" id="4999724">*</span><span class="ident" id="4999725">decBuffer</span><span class="op" id="4999734">)</span>&nbsp;<span class="ident" id="4999736">Bytes</span><span class="op" id="4999741">(</span><span class="op" id="4999742">)</span>&nbsp;<span class="op" id="4999744">[</span><span class="op" id="4999745">]</span><span class="builtintype" id="4999746">byte</span>&nbsp;<span class="op" id="4999751">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999754">return</span>&nbsp;<span class="ident" id="4999761">d</span><span class="op" id="4999762">.</span><span class="ident" id="4999763">data</span><span class="op" id="4999767">[</span><span class="ident" id="4999768">d</span><span class="op" id="4999769">.</span><span class="ident" id="4999770">offset</span><span class="op" id="4999776">:</span><span class="op" id="4999777">]</span><br>
<span class="lineno"></span><span class="op" id="4999779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4999782">func</span>&nbsp;<span class="op" id="4999787">(</span><span class="ident" id="4999788">d</span>&nbsp;<span class="op" id="4999790">*</span><span class="ident" id="4999791">decBuffer</span><span class="op" id="4999800">)</span>&nbsp;<span class="ident" id="4999802">Reset</span><span class="op" id="4999807">(</span><span class="op" id="4999808">)</span>&nbsp;<span class="op" id="4999810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999813">d</span><span class="op" id="4999814">.</span><span class="ident" id="4999815">data</span>&nbsp;<span class="op" id="4999820">=</span>&nbsp;<span class="ident" id="4999822">d</span><span class="op" id="4999823">.</span><span class="ident" id="4999824">data</span><span class="op" id="4999828">[</span><span class="num" id="4999829">0</span><span class="op" id="4999830">:</span><span class="num" id="4999831">0</span><span class="op" id="4999832">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999835">d</span><span class="op" id="4999836">.</span><span class="ident" id="4999837">offset</span>&nbsp;<span class="op" id="4999844">=</span>&nbsp;<span class="num" id="4999846">0</span><br>
<span class="lineno"></span><span class="op" id="4999848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4999851">//&nbsp;We&nbsp;pass&nbsp;the&nbsp;bytes.Buffer&nbsp;separately&nbsp;for&nbsp;easier&nbsp;testing&nbsp;of&nbsp;the&nbsp;infrastructure</span><br>
<span class="lineno"></span><span class="comment" id="4999931">//&nbsp;without&nbsp;requiring&nbsp;a&nbsp;full&nbsp;Decoder.</span><br>
<span class="lineno">95</span><span class="keyword" id="4999968">func</span>&nbsp;<span class="op" id="4999973">(</span><span class="ident" id="4999974">dec</span>&nbsp;<span class="op" id="4999978">*</span><span class="ident" id="4999979">Decoder</span><span class="op" id="4999986">)</span>&nbsp;<span class="ident" id="4999988">newDecoderState</span><span class="op" id="5000003">(</span><span class="ident" id="5000004">buf</span>&nbsp;<span class="op" id="5000008">*</span><span class="ident" id="5000009">decBuffer</span><span class="op" id="5000018">)</span>&nbsp;<span class="op" id="5000020">*</span><span class="ident" id="5000021">decoderState</span>&nbsp;<span class="op" id="5000034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000037">d</span>&nbsp;<span class="op" id="5000039">:=</span>&nbsp;<span class="ident" id="5000042">dec</span><span class="op" id="5000045">.</span><span class="ident" id="5000046">freeList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000056">if</span>&nbsp;<span class="ident" id="5000059">d</span>&nbsp;<span class="op" id="5000061">==</span>&nbsp;<span class="ident" id="5000064">nil</span>&nbsp;<span class="op" id="5000068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000072">d</span>&nbsp;<span class="op" id="5000074">=</span>&nbsp;<span class="builtinfunc" id="5000076">new</span><span class="op" id="5000079">(</span><span class="ident" id="5000080">decoderState</span><span class="op" id="5000092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000096">d</span><span class="op" id="5000097">.</span><span class="ident" id="5000098">dec</span>&nbsp;<span class="op" id="5000102">=</span>&nbsp;<span class="ident" id="5000104">dec</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000110">d</span><span class="op" id="5000111">.</span><span class="ident" id="5000112">buf</span>&nbsp;<span class="op" id="5000116">=</span>&nbsp;<span class="builtinfunc" id="5000118">make</span><span class="op" id="5000122">(</span><span class="op" id="5000123">[</span><span class="op" id="5000124">]</span><span class="builtintype" id="5000125">byte</span><span class="op" id="5000129">,</span>&nbsp;<span class="ident" id="5000131">uint64Size</span><span class="op" id="5000141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5000144">}</span>&nbsp;<span class="keyword" id="5000146">else</span>&nbsp;<span class="op" id="5000151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000155">dec</span><span class="op" id="5000158">.</span><span class="ident" id="5000159">freeList</span>&nbsp;<span class="op" id="5000168">=</span>&nbsp;<span class="ident" id="5000170">d</span><span class="op" id="5000171">.</span><span class="ident" id="5000172">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5000178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000181">d</span><span class="op" id="5000182">.</span><span class="ident" id="5000183">b</span>&nbsp;<span class="op" id="5000185">=</span>&nbsp;<span class="ident" id="5000187">buf</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000192">return</span>&nbsp;<span class="ident" id="5000199">d</span><br>
<span class="lineno"></span><span class="op" id="5000201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5000204">func</span>&nbsp;<span class="op" id="5000209">(</span><span class="ident" id="5000210">dec</span>&nbsp;<span class="op" id="5000214">*</span><span class="ident" id="5000215">Decoder</span><span class="op" id="5000222">)</span>&nbsp;<span class="ident" id="5000224">freeDecoderState</span><span class="op" id="5000240">(</span><span class="ident" id="5000241">d</span>&nbsp;<span class="op" id="5000243">*</span><span class="ident" id="5000244">decoderState</span><span class="op" id="5000256">)</span>&nbsp;<span class="op" id="5000258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000261">d</span><span class="op" id="5000262">.</span><span class="ident" id="5000263">next</span>&nbsp;<span class="op" id="5000268">=</span>&nbsp;<span class="ident" id="5000270">dec</span><span class="op" id="5000273">.</span><span class="ident" id="5000274">freeList</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000284">dec</span><span class="op" id="5000287">.</span><span class="ident" id="5000288">freeList</span>&nbsp;<span class="op" id="5000297">=</span>&nbsp;<span class="ident" id="5000299">d</span><br>
<span class="lineno"></span><span class="op" id="5000301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5000304">func</span>&nbsp;<span class="ident" id="5000309">overflow</span><span class="op" id="5000317">(</span><span class="ident" id="5000318">name</span>&nbsp;<span class="builtintype" id="5000323">string</span><span class="op" id="5000329">)</span>&nbsp;<span class="builtintype" id="5000331">error</span>&nbsp;<span class="op" id="5000337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000340">return</span>&nbsp;<span class="ident" id="5000347">errors</span><span class="op" id="5000353">.</span><span class="ident" id="5000354">New</span><span class="op" id="5000357">(</span><span class="string" id="5000358">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="5000372">+</span>&nbsp;<span class="ident" id="5000374">name</span>&nbsp;<span class="op" id="5000379">+</span>&nbsp;<span class="string" id="5000381">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="5000397">)</span><br>
<span class="lineno">115</span><span class="op" id="5000399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5000402">//&nbsp;decodeUintReader&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="5000475">//&nbsp;Used&nbsp;only&nbsp;by&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;read&nbsp;the&nbsp;message&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5000531">func</span>&nbsp;<span class="ident" id="5000536">decodeUintReader</span><span class="op" id="5000552">(</span><span class="ident" id="5000553">r</span>&nbsp;<span class="ident" id="5000555">io</span><span class="op" id="5000557">.</span><span class="ident" id="5000558">Reader</span><span class="op" id="5000564">,</span>&nbsp;<span class="ident" id="5000566">buf</span>&nbsp;<span class="op" id="5000570">[</span><span class="op" id="5000571">]</span><span class="builtintype" id="5000572">byte</span><span class="op" id="5000576">)</span>&nbsp;<span class="op" id="5000578">(</span><span class="ident" id="5000579">x</span>&nbsp;<span class="ident" id="5000581">uint64</span><span class="op" id="5000587">,</span>&nbsp;<span class="ident" id="5000589">width</span>&nbsp;<span class="builtintype" id="5000595">int</span><span class="op" id="5000598">,</span>&nbsp;<span class="ident" id="5000600">err</span>&nbsp;<span class="builtintype" id="5000604">error</span><span class="op" id="5000609">)</span>&nbsp;<span class="op" id="5000611">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000614">width</span>&nbsp;<span class="op" id="5000620">=</span>&nbsp;<span class="num" id="5000622">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000625">n</span><span class="op" id="5000626">,</span>&nbsp;<span class="ident" id="5000628">err</span>&nbsp;<span class="op" id="5000632">:=</span>&nbsp;<span class="ident" id="5000635">io</span><span class="op" id="5000637">.</span><span class="ident" id="5000638">ReadFull</span><span class="op" id="5000646">(</span><span class="ident" id="5000647">r</span><span class="op" id="5000648">,</span>&nbsp;<span class="ident" id="5000650">buf</span><span class="op" id="5000653">[</span><span class="num" id="5000654">0</span><span class="op" id="5000655">:</span><span class="ident" id="5000656">width</span><span class="op" id="5000661">]</span><span class="op" id="5000662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000665">if</span>&nbsp;<span class="ident" id="5000668">n</span>&nbsp;<span class="op" id="5000670">==</span>&nbsp;<span class="num" id="5000673">0</span>&nbsp;<span class="op" id="5000675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000679">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5000687">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000690">b</span>&nbsp;<span class="op" id="5000692">:=</span>&nbsp;<span class="ident" id="5000695">buf</span><span class="op" id="5000698">[</span><span class="num" id="5000699">0</span><span class="op" id="5000700">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000703">if</span>&nbsp;<span class="ident" id="5000706">b</span>&nbsp;<span class="op" id="5000708">&lt;=</span>&nbsp;<span class="num" id="5000711">0x7f</span>&nbsp;<span class="op" id="5000716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000720">return</span>&nbsp;<span class="ident" id="5000727">uint64</span><span class="op" id="5000733">(</span><span class="ident" id="5000734">b</span><span class="op" id="5000735">)</span><span class="op" id="5000736">,</span>&nbsp;<span class="ident" id="5000738">width</span><span class="op" id="5000743">,</span>&nbsp;<span class="ident" id="5000745">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5000750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000753">n</span>&nbsp;<span class="op" id="5000755">=</span>&nbsp;<span class="op" id="5000757">-</span><span class="builtintype" id="5000758">int</span><span class="op" id="5000761">(</span><span class="builtintype" id="5000762">int8</span><span class="op" id="5000766">(</span><span class="ident" id="5000767">b</span><span class="op" id="5000768">)</span><span class="op" id="5000769">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000772">if</span>&nbsp;<span class="ident" id="5000775">n</span>&nbsp;<span class="op" id="5000777">&gt;</span>&nbsp;<span class="ident" id="5000779">uint64Size</span>&nbsp;<span class="op" id="5000790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000794">err</span>&nbsp;<span class="op" id="5000798">=</span>&nbsp;<span class="ident" id="5000800">errBadUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000813">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5000821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000824">width</span><span class="op" id="5000829">,</span>&nbsp;<span class="ident" id="5000831">err</span>&nbsp;<span class="op" id="5000835">=</span>&nbsp;<span class="ident" id="5000837">io</span><span class="op" id="5000839">.</span><span class="ident" id="5000840">ReadFull</span><span class="op" id="5000848">(</span><span class="ident" id="5000849">r</span><span class="op" id="5000850">,</span>&nbsp;<span class="ident" id="5000852">buf</span><span class="op" id="5000855">[</span><span class="num" id="5000856">0</span><span class="op" id="5000857">:</span><span class="ident" id="5000858">n</span><span class="op" id="5000859">]</span><span class="op" id="5000860">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000863">if</span>&nbsp;<span class="ident" id="5000866">err</span>&nbsp;<span class="op" id="5000870">!=</span>&nbsp;<span class="ident" id="5000873">nil</span>&nbsp;<span class="op" id="5000877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000881">if</span>&nbsp;<span class="ident" id="5000884">err</span>&nbsp;<span class="op" id="5000888">==</span>&nbsp;<span class="ident" id="5000891">io</span><span class="op" id="5000893">.</span><span class="ident" id="5000894">EOF</span>&nbsp;<span class="op" id="5000898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000903">err</span>&nbsp;<span class="op" id="5000907">=</span>&nbsp;<span class="ident" id="5000909">io</span><span class="op" id="5000911">.</span><span class="ident" id="5000912">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5000931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000935">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5000943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5000946">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001012">for</span>&nbsp;<span class="ident" id="5001016">_</span><span class="op" id="5001017">,</span>&nbsp;<span class="ident" id="5001019">b</span>&nbsp;<span class="op" id="5001021">:=</span>&nbsp;<span class="keyword" id="5001024">range</span>&nbsp;<span class="ident" id="5001030">buf</span><span class="op" id="5001033">[</span><span class="num" id="5001034">0</span><span class="op" id="5001035">:</span><span class="ident" id="5001036">width</span><span class="op" id="5001041">]</span>&nbsp;<span class="op" id="5001043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001047">x</span>&nbsp;<span class="op" id="5001049">=</span>&nbsp;<span class="ident" id="5001051">x</span><span class="op" id="5001052">&lt;&lt;</span><span class="num" id="5001054">8</span>&nbsp;<span class="op" id="5001056">|</span>&nbsp;<span class="ident" id="5001058">uint64</span><span class="op" id="5001064">(</span><span class="ident" id="5001065">b</span><span class="op" id="5001066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5001069">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001072">width</span><span class="op" id="5001077">++</span>&nbsp;<span class="comment" id="5001080">//&nbsp;+1&nbsp;for&nbsp;length&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001103">return</span><br>
<span class="lineno"></span><span class="op" id="5001110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5001113">//&nbsp;decodeUint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno">150</span><span class="comment" id="5001175">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="5001207">func</span>&nbsp;<span class="op" id="5001212">(</span><span class="ident" id="5001213">state</span>&nbsp;<span class="op" id="5001219">*</span><span class="ident" id="5001220">decoderState</span><span class="op" id="5001232">)</span>&nbsp;<span class="ident" id="5001234">decodeUint</span><span class="op" id="5001244">(</span><span class="op" id="5001245">)</span>&nbsp;<span class="op" id="5001247">(</span><span class="ident" id="5001248">x</span>&nbsp;<span class="ident" id="5001250">uint64</span><span class="op" id="5001256">)</span>&nbsp;<span class="op" id="5001258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001261">b</span><span class="op" id="5001262">,</span>&nbsp;<span class="ident" id="5001264">err</span>&nbsp;<span class="op" id="5001268">:=</span>&nbsp;<span class="ident" id="5001271">state</span><span class="op" id="5001276">.</span><span class="ident" id="5001277">b</span><span class="op" id="5001278">.</span><span class="ident" id="5001279">ReadByte</span><span class="op" id="5001287">(</span><span class="op" id="5001288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001291">if</span>&nbsp;<span class="ident" id="5001294">err</span>&nbsp;<span class="op" id="5001298">!=</span>&nbsp;<span class="ident" id="5001301">nil</span>&nbsp;<span class="op" id="5001305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001309">error_</span><span class="op" id="5001315">(</span><span class="ident" id="5001316">err</span><span class="op" id="5001319">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5001322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001325">if</span>&nbsp;<span class="ident" id="5001328">b</span>&nbsp;<span class="op" id="5001330">&lt;=</span>&nbsp;<span class="num" id="5001333">0x7f</span>&nbsp;<span class="op" id="5001338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001342">return</span>&nbsp;<span class="ident" id="5001349">uint64</span><span class="op" id="5001355">(</span><span class="ident" id="5001356">b</span><span class="op" id="5001357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5001360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001363">n</span>&nbsp;<span class="op" id="5001365">:=</span>&nbsp;<span class="op" id="5001368">-</span><span class="builtintype" id="5001369">int</span><span class="op" id="5001372">(</span><span class="builtintype" id="5001373">int8</span><span class="op" id="5001377">(</span><span class="ident" id="5001378">b</span><span class="op" id="5001379">)</span><span class="op" id="5001380">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001383">if</span>&nbsp;<span class="ident" id="5001386">n</span>&nbsp;<span class="op" id="5001388">&gt;</span>&nbsp;<span class="ident" id="5001390">uint64Size</span>&nbsp;<span class="op" id="5001401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001405">error_</span><span class="op" id="5001411">(</span><span class="ident" id="5001412">errBadUint</span><span class="op" id="5001422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5001425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001428">width</span><span class="op" id="5001433">,</span>&nbsp;<span class="ident" id="5001435">err</span>&nbsp;<span class="op" id="5001439">:=</span>&nbsp;<span class="ident" id="5001442">state</span><span class="op" id="5001447">.</span><span class="ident" id="5001448">b</span><span class="op" id="5001449">.</span><span class="ident" id="5001450">Read</span><span class="op" id="5001454">(</span><span class="ident" id="5001455">state</span><span class="op" id="5001460">.</span><span class="ident" id="5001461">buf</span><span class="op" id="5001464">[</span><span class="num" id="5001465">0</span><span class="op" id="5001466">:</span><span class="ident" id="5001467">n</span><span class="op" id="5001468">]</span><span class="op" id="5001469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001472">if</span>&nbsp;<span class="ident" id="5001475">err</span>&nbsp;<span class="op" id="5001479">!=</span>&nbsp;<span class="ident" id="5001482">nil</span>&nbsp;<span class="op" id="5001486">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001490">error_</span><span class="op" id="5001496">(</span><span class="ident" id="5001497">err</span><span class="op" id="5001500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5001503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5001506">//&nbsp;Don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;error;&nbsp;it&#39;s&nbsp;safe&nbsp;to&nbsp;loop&nbsp;regardless.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5001567">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001633">for</span>&nbsp;<span class="ident" id="5001637">_</span><span class="op" id="5001638">,</span>&nbsp;<span class="ident" id="5001640">b</span>&nbsp;<span class="op" id="5001642">:=</span>&nbsp;<span class="keyword" id="5001645">range</span>&nbsp;<span class="ident" id="5001651">state</span><span class="op" id="5001656">.</span><span class="ident" id="5001657">buf</span><span class="op" id="5001660">[</span><span class="num" id="5001661">0</span><span class="op" id="5001662">:</span><span class="ident" id="5001663">width</span><span class="op" id="5001668">]</span>&nbsp;<span class="op" id="5001670">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001674">x</span>&nbsp;<span class="op" id="5001676">=</span>&nbsp;<span class="ident" id="5001678">x</span><span class="op" id="5001679">&lt;&lt;</span><span class="num" id="5001681">8</span>&nbsp;<span class="op" id="5001683">|</span>&nbsp;<span class="ident" id="5001685">uint64</span><span class="op" id="5001691">(</span><span class="ident" id="5001692">b</span><span class="op" id="5001693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5001696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001699">return</span>&nbsp;<span class="ident" id="5001706">x</span><br>
<span class="lineno"></span><span class="op" id="5001708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5001711">//&nbsp;decodeInt&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno"></span><span class="comment" id="5001770">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="5001802">func</span>&nbsp;<span class="op" id="5001807">(</span><span class="ident" id="5001808">state</span>&nbsp;<span class="op" id="5001814">*</span><span class="ident" id="5001815">decoderState</span><span class="op" id="5001827">)</span>&nbsp;<span class="ident" id="5001829">decodeInt</span><span class="op" id="5001838">(</span><span class="op" id="5001839">)</span>&nbsp;<span class="ident" id="5001841">int64</span>&nbsp;<span class="op" id="5001847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001850">x</span>&nbsp;<span class="op" id="5001852">:=</span>&nbsp;<span class="ident" id="5001855">state</span><span class="op" id="5001860">.</span><span class="ident" id="5001861">decodeUint</span><span class="op" id="5001871">(</span><span class="op" id="5001872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001875">if</span>&nbsp;<span class="ident" id="5001878">x</span><span class="op" id="5001879">&amp;</span><span class="num" id="5001880">1</span>&nbsp;<span class="op" id="5001882">!=</span>&nbsp;<span class="num" id="5001885">0</span>&nbsp;<span class="op" id="5001887">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001891">return</span>&nbsp;<span class="op" id="5001898">^</span><span class="ident" id="5001899">int64</span><span class="op" id="5001904">(</span><span class="ident" id="5001905">x</span>&nbsp;<span class="op" id="5001907">&gt;&gt;</span>&nbsp;<span class="num" id="5001910">1</span><span class="op" id="5001911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5001914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001917">return</span>&nbsp;<span class="ident" id="5001924">int64</span><span class="op" id="5001929">(</span><span class="ident" id="5001930">x</span>&nbsp;<span class="op" id="5001932">&gt;&gt;</span>&nbsp;<span class="num" id="5001935">1</span><span class="op" id="5001936">)</span><br>
<span class="lineno"></span><span class="op" id="5001938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="5001941">//&nbsp;decOp&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;a&nbsp;decoding&nbsp;operator&nbsp;for&nbsp;a&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5002008">type</span>&nbsp;<span class="ident" id="5002013">decOp</span>&nbsp;<span class="keyword" id="5002019">func</span><span class="op" id="5002023">(</span><span class="ident" id="5002024">i</span>&nbsp;<span class="op" id="5002026">*</span><span class="ident" id="5002027">decInstr</span><span class="op" id="5002035">,</span>&nbsp;<span class="ident" id="5002037">state</span>&nbsp;<span class="op" id="5002043">*</span><span class="ident" id="5002044">decoderState</span><span class="op" id="5002056">,</span>&nbsp;<span class="ident" id="5002058">v</span>&nbsp;<span class="ident" id="5002060">reflect</span><span class="op" id="5002067">.</span><span class="ident" id="5002068">Value</span><span class="op" id="5002073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5002076">//&nbsp;The&nbsp;&#39;instructions&#39;&nbsp;of&nbsp;the&nbsp;decoding&nbsp;machine</span><br>
<span class="lineno"></span><span class="keyword" id="5002122">type</span>&nbsp;<span class="ident" id="5002127">decInstr</span>&nbsp;<span class="keyword" id="5002136">struct</span>&nbsp;<span class="op" id="5002143">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002146">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002152">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002159">field</span>&nbsp;<span class="builtintype" id="5002165">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5002171">//&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;wire&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002205">index</span>&nbsp;<span class="op" id="5002211">[</span><span class="op" id="5002212">]</span><span class="builtintype" id="5002213">int</span>&nbsp;<span class="comment" id="5002217">//&nbsp;field&nbsp;access&nbsp;indices&nbsp;for&nbsp;destination&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002263">ovfl</span>&nbsp;&nbsp;<span class="builtintype" id="5002269">error</span>&nbsp;<span class="comment" id="5002275">//&nbsp;error&nbsp;message&nbsp;for&nbsp;overflow/underflow&nbsp;(for&nbsp;arrays,&nbsp;of&nbsp;the&nbsp;elements)</span><br>
<span class="lineno"></span><span class="op" id="5002345">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="5002348">//&nbsp;ignoreUint&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5002405">func</span>&nbsp;<span class="ident" id="5002410">ignoreUint</span><span class="op" id="5002420">(</span><span class="ident" id="5002421">i</span>&nbsp;<span class="op" id="5002423">*</span><span class="ident" id="5002424">decInstr</span><span class="op" id="5002432">,</span>&nbsp;<span class="ident" id="5002434">state</span>&nbsp;<span class="op" id="5002440">*</span><span class="ident" id="5002441">decoderState</span><span class="op" id="5002453">,</span>&nbsp;<span class="ident" id="5002455">v</span>&nbsp;<span class="ident" id="5002457">reflect</span><span class="op" id="5002464">.</span><span class="ident" id="5002465">Value</span><span class="op" id="5002470">)</span>&nbsp;<span class="op" id="5002472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002475">state</span><span class="op" id="5002480">.</span><span class="ident" id="5002481">decodeUint</span><span class="op" id="5002491">(</span><span class="op" id="5002492">)</span><br>
<span class="lineno"></span><span class="op" id="5002494">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5002497">//&nbsp;ignoreTwoUints&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;to&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="5002576">//&nbsp;complex&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5002595">func</span>&nbsp;<span class="ident" id="5002600">ignoreTwoUints</span><span class="op" id="5002614">(</span><span class="ident" id="5002615">i</span>&nbsp;<span class="op" id="5002617">*</span><span class="ident" id="5002618">decInstr</span><span class="op" id="5002626">,</span>&nbsp;<span class="ident" id="5002628">state</span>&nbsp;<span class="op" id="5002634">*</span><span class="ident" id="5002635">decoderState</span><span class="op" id="5002647">,</span>&nbsp;<span class="ident" id="5002649">v</span>&nbsp;<span class="ident" id="5002651">reflect</span><span class="op" id="5002658">.</span><span class="ident" id="5002659">Value</span><span class="op" id="5002664">)</span>&nbsp;<span class="op" id="5002666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002669">state</span><span class="op" id="5002674">.</span><span class="ident" id="5002675">decodeUint</span><span class="op" id="5002685">(</span><span class="op" id="5002686">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002689">state</span><span class="op" id="5002694">.</span><span class="ident" id="5002695">decodeUint</span><span class="op" id="5002705">(</span><span class="op" id="5002706">)</span><br>
<span class="lineno"></span><span class="op" id="5002708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5002711">//&nbsp;Since&nbsp;the&nbsp;encoder&nbsp;writes&nbsp;no&nbsp;zeros,&nbsp;if&nbsp;we&nbsp;arrive&nbsp;at&nbsp;a&nbsp;decoder&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="5002783">//&nbsp;a&nbsp;value&nbsp;to&nbsp;extract&nbsp;and&nbsp;store.&nbsp;&nbsp;The&nbsp;field&nbsp;number&nbsp;has&nbsp;already&nbsp;been&nbsp;read</span><br>
<span class="lineno">210</span><span class="comment" id="5002856">//&nbsp;(it&#39;s&nbsp;how&nbsp;we&nbsp;knew&nbsp;to&nbsp;call&nbsp;this&nbsp;decoder).</span><br>
<span class="lineno"></span><span class="comment" id="5002900">//&nbsp;Each&nbsp;decoder&nbsp;is&nbsp;responsible&nbsp;for&nbsp;handling&nbsp;any&nbsp;indirections&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5002972">//&nbsp;with&nbsp;the&nbsp;data&nbsp;structure.&nbsp;&nbsp;If&nbsp;any&nbsp;pointer&nbsp;so&nbsp;reached&nbsp;is&nbsp;nil,&nbsp;allocation&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5003051">//&nbsp;be&nbsp;done.</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5003064">//&nbsp;decAlloc&nbsp;takes&nbsp;a&nbsp;value&nbsp;and&nbsp;returns&nbsp;a&nbsp;settable&nbsp;value&nbsp;that&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5003128">//&nbsp;be&nbsp;assigned&nbsp;to.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer,&nbsp;decAlloc&nbsp;guarantees&nbsp;it&nbsp;points&nbsp;to&nbsp;storage.</span><br>
<span class="lineno"></span><span class="comment" id="5003216">//&nbsp;The&nbsp;callers&nbsp;to&nbsp;the&nbsp;individual&nbsp;decoders&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;used&nbsp;decAlloc.</span><br>
<span class="lineno"></span><span class="comment" id="5003294">//&nbsp;The&nbsp;individual&nbsp;decoders&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5003339">func</span>&nbsp;<span class="ident" id="5003344">decAlloc</span><span class="op" id="5003352">(</span><span class="ident" id="5003353">v</span>&nbsp;<span class="ident" id="5003355">reflect</span><span class="op" id="5003362">.</span><span class="ident" id="5003363">Value</span><span class="op" id="5003368">)</span>&nbsp;<span class="ident" id="5003370">reflect</span><span class="op" id="5003377">.</span><span class="ident" id="5003378">Value</span>&nbsp;<span class="op" id="5003384">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003387">for</span>&nbsp;<span class="ident" id="5003391">v</span><span class="op" id="5003392">.</span><span class="ident" id="5003393">Kind</span><span class="op" id="5003397">(</span><span class="op" id="5003398">)</span>&nbsp;<span class="op" id="5003400">==</span>&nbsp;<span class="ident" id="5003403">reflect</span><span class="op" id="5003410">.</span><span class="ident" id="5003411">Ptr</span>&nbsp;<span class="op" id="5003415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003419">if</span>&nbsp;<span class="ident" id="5003422">v</span><span class="op" id="5003423">.</span><span class="ident" id="5003424">IsNil</span><span class="op" id="5003429">(</span><span class="op" id="5003430">)</span>&nbsp;<span class="op" id="5003432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003437">v</span><span class="op" id="5003438">.</span><span class="ident" id="5003439">Set</span><span class="op" id="5003442">(</span><span class="ident" id="5003443">reflect</span><span class="op" id="5003450">.</span><span class="ident" id="5003451">New</span><span class="op" id="5003454">(</span><span class="ident" id="5003455">v</span><span class="op" id="5003456">.</span><span class="ident" id="5003457">Type</span><span class="op" id="5003461">(</span><span class="op" id="5003462">)</span><span class="op" id="5003463">.</span><span class="ident" id="5003464">Elem</span><span class="op" id="5003468">(</span><span class="op" id="5003469">)</span><span class="op" id="5003470">)</span><span class="op" id="5003471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5003475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003479">v</span>&nbsp;<span class="op" id="5003481">=</span>&nbsp;<span class="ident" id="5003483">v</span><span class="op" id="5003484">.</span><span class="ident" id="5003485">Elem</span><span class="op" id="5003489">(</span><span class="op" id="5003490">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5003493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003496">return</span>&nbsp;<span class="ident" id="5003503">v</span><br>
<span class="lineno"></span><span class="op" id="5003505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5003508">//&nbsp;decBool&nbsp;decodes&nbsp;a&nbsp;uint&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;boolean&nbsp;in&nbsp;value.</span><br>
<span class="lineno">230</span><span class="keyword" id="5003571">func</span>&nbsp;<span class="ident" id="5003576">decBool</span><span class="op" id="5003583">(</span><span class="ident" id="5003584">i</span>&nbsp;<span class="op" id="5003586">*</span><span class="ident" id="5003587">decInstr</span><span class="op" id="5003595">,</span>&nbsp;<span class="ident" id="5003597">state</span>&nbsp;<span class="op" id="5003603">*</span><span class="ident" id="5003604">decoderState</span><span class="op" id="5003616">,</span>&nbsp;<span class="ident" id="5003618">value</span>&nbsp;<span class="ident" id="5003624">reflect</span><span class="op" id="5003631">.</span><span class="ident" id="5003632">Value</span><span class="op" id="5003637">)</span>&nbsp;<span class="op" id="5003639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003642">value</span><span class="op" id="5003647">.</span><span class="ident" id="5003648">SetBool</span><span class="op" id="5003655">(</span><span class="ident" id="5003656">state</span><span class="op" id="5003661">.</span><span class="ident" id="5003662">decodeUint</span><span class="op" id="5003672">(</span><span class="op" id="5003673">)</span>&nbsp;<span class="op" id="5003675">!=</span>&nbsp;<span class="num" id="5003678">0</span><span class="op" id="5003679">)</span><br>
<span class="lineno"></span><span class="op" id="5003681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5003684">//&nbsp;decInt8&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int8&nbsp;in&nbsp;value.</span><br>
<span class="lineno">235</span><span class="keyword" id="5003749">func</span>&nbsp;<span class="ident" id="5003754">decInt8</span><span class="op" id="5003761">(</span><span class="ident" id="5003762">i</span>&nbsp;<span class="op" id="5003764">*</span><span class="ident" id="5003765">decInstr</span><span class="op" id="5003773">,</span>&nbsp;<span class="ident" id="5003775">state</span>&nbsp;<span class="op" id="5003781">*</span><span class="ident" id="5003782">decoderState</span><span class="op" id="5003794">,</span>&nbsp;<span class="ident" id="5003796">value</span>&nbsp;<span class="ident" id="5003802">reflect</span><span class="op" id="5003809">.</span><span class="ident" id="5003810">Value</span><span class="op" id="5003815">)</span>&nbsp;<span class="op" id="5003817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003820">v</span>&nbsp;<span class="op" id="5003822">:=</span>&nbsp;<span class="ident" id="5003825">state</span><span class="op" id="5003830">.</span><span class="ident" id="5003831">decodeInt</span><span class="op" id="5003840">(</span><span class="op" id="5003841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003844">if</span>&nbsp;<span class="ident" id="5003847">v</span>&nbsp;<span class="op" id="5003849">&lt;</span>&nbsp;<span class="ident" id="5003851">math</span><span class="op" id="5003855">.</span><span class="ident" id="5003856">MinInt8</span>&nbsp;<span class="op" id="5003864">||</span>&nbsp;<span class="ident" id="5003867">math</span><span class="op" id="5003871">.</span><span class="ident" id="5003872">MaxInt8</span>&nbsp;<span class="op" id="5003880">&lt;</span>&nbsp;<span class="ident" id="5003882">v</span>&nbsp;<span class="op" id="5003884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003888">error_</span><span class="op" id="5003894">(</span><span class="ident" id="5003895">i</span><span class="op" id="5003896">.</span><span class="ident" id="5003897">ovfl</span><span class="op" id="5003901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5003904">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003907">value</span><span class="op" id="5003912">.</span><span class="ident" id="5003913">SetInt</span><span class="op" id="5003919">(</span><span class="ident" id="5003920">v</span><span class="op" id="5003921">)</span><br>
<span class="lineno"></span><span class="op" id="5003923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5003926">//&nbsp;decUint8&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint8&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5004001">func</span>&nbsp;<span class="ident" id="5004006">decUint8</span><span class="op" id="5004014">(</span><span class="ident" id="5004015">i</span>&nbsp;<span class="op" id="5004017">*</span><span class="ident" id="5004018">decInstr</span><span class="op" id="5004026">,</span>&nbsp;<span class="ident" id="5004028">state</span>&nbsp;<span class="op" id="5004034">*</span><span class="ident" id="5004035">decoderState</span><span class="op" id="5004047">,</span>&nbsp;<span class="ident" id="5004049">value</span>&nbsp;<span class="ident" id="5004055">reflect</span><span class="op" id="5004062">.</span><span class="ident" id="5004063">Value</span><span class="op" id="5004068">)</span>&nbsp;<span class="op" id="5004070">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004073">v</span>&nbsp;<span class="op" id="5004075">:=</span>&nbsp;<span class="ident" id="5004078">state</span><span class="op" id="5004083">.</span><span class="ident" id="5004084">decodeUint</span><span class="op" id="5004094">(</span><span class="op" id="5004095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5004098">if</span>&nbsp;<span class="ident" id="5004101">math</span><span class="op" id="5004105">.</span><span class="ident" id="5004106">MaxUint8</span>&nbsp;<span class="op" id="5004115">&lt;</span>&nbsp;<span class="ident" id="5004117">v</span>&nbsp;<span class="op" id="5004119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004123">error_</span><span class="op" id="5004129">(</span><span class="ident" id="5004130">i</span><span class="op" id="5004131">.</span><span class="ident" id="5004132">ovfl</span><span class="op" id="5004136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5004139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004142">value</span><span class="op" id="5004147">.</span><span class="ident" id="5004148">SetUint</span><span class="op" id="5004155">(</span><span class="ident" id="5004156">v</span><span class="op" id="5004157">)</span><br>
<span class="lineno">250</span><span class="op" id="5004159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5004162">//&nbsp;decInt16&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5004229">func</span>&nbsp;<span class="ident" id="5004234">decInt16</span><span class="op" id="5004242">(</span><span class="ident" id="5004243">i</span>&nbsp;<span class="op" id="5004245">*</span><span class="ident" id="5004246">decInstr</span><span class="op" id="5004254">,</span>&nbsp;<span class="ident" id="5004256">state</span>&nbsp;<span class="op" id="5004262">*</span><span class="ident" id="5004263">decoderState</span><span class="op" id="5004275">,</span>&nbsp;<span class="ident" id="5004277">value</span>&nbsp;<span class="ident" id="5004283">reflect</span><span class="op" id="5004290">.</span><span class="ident" id="5004291">Value</span><span class="op" id="5004296">)</span>&nbsp;<span class="op" id="5004298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004301">v</span>&nbsp;<span class="op" id="5004303">:=</span>&nbsp;<span class="ident" id="5004306">state</span><span class="op" id="5004311">.</span><span class="ident" id="5004312">decodeInt</span><span class="op" id="5004321">(</span><span class="op" id="5004322">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5004325">if</span>&nbsp;<span class="ident" id="5004328">v</span>&nbsp;<span class="op" id="5004330">&lt;</span>&nbsp;<span class="ident" id="5004332">math</span><span class="op" id="5004336">.</span><span class="ident" id="5004337">MinInt16</span>&nbsp;<span class="op" id="5004346">||</span>&nbsp;<span class="ident" id="5004349">math</span><span class="op" id="5004353">.</span><span class="ident" id="5004354">MaxInt16</span>&nbsp;<span class="op" id="5004363">&lt;</span>&nbsp;<span class="ident" id="5004365">v</span>&nbsp;<span class="op" id="5004367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004371">error_</span><span class="op" id="5004377">(</span><span class="ident" id="5004378">i</span><span class="op" id="5004379">.</span><span class="ident" id="5004380">ovfl</span><span class="op" id="5004384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5004387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004390">value</span><span class="op" id="5004395">.</span><span class="ident" id="5004396">SetInt</span><span class="op" id="5004402">(</span><span class="ident" id="5004403">v</span><span class="op" id="5004404">)</span><br>
<span class="lineno"></span><span class="op" id="5004406">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="5004409">//&nbsp;decUint16&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5004486">func</span>&nbsp;<span class="ident" id="5004491">decUint16</span><span class="op" id="5004500">(</span><span class="ident" id="5004501">i</span>&nbsp;<span class="op" id="5004503">*</span><span class="ident" id="5004504">decInstr</span><span class="op" id="5004512">,</span>&nbsp;<span class="ident" id="5004514">state</span>&nbsp;<span class="op" id="5004520">*</span><span class="ident" id="5004521">decoderState</span><span class="op" id="5004533">,</span>&nbsp;<span class="ident" id="5004535">value</span>&nbsp;<span class="ident" id="5004541">reflect</span><span class="op" id="5004548">.</span><span class="ident" id="5004549">Value</span><span class="op" id="5004554">)</span>&nbsp;<span class="op" id="5004556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004559">v</span>&nbsp;<span class="op" id="5004561">:=</span>&nbsp;<span class="ident" id="5004564">state</span><span class="op" id="5004569">.</span><span class="ident" id="5004570">decodeUint</span><span class="op" id="5004580">(</span><span class="op" id="5004581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5004584">if</span>&nbsp;<span class="ident" id="5004587">math</span><span class="op" id="5004591">.</span><span class="ident" id="5004592">MaxUint16</span>&nbsp;<span class="op" id="5004602">&lt;</span>&nbsp;<span class="ident" id="5004604">v</span>&nbsp;<span class="op" id="5004606">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004610">error_</span><span class="op" id="5004616">(</span><span class="ident" id="5004617">i</span><span class="op" id="5004618">.</span><span class="ident" id="5004619">ovfl</span><span class="op" id="5004623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5004626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004629">value</span><span class="op" id="5004634">.</span><span class="ident" id="5004635">SetUint</span><span class="op" id="5004642">(</span><span class="ident" id="5004643">v</span><span class="op" id="5004644">)</span><br>
<span class="lineno"></span><span class="op" id="5004646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5004649">//&nbsp;decInt32&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int32&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5004716">func</span>&nbsp;<span class="ident" id="5004721">decInt32</span><span class="op" id="5004729">(</span><span class="ident" id="5004730">i</span>&nbsp;<span class="op" id="5004732">*</span><span class="ident" id="5004733">decInstr</span><span class="op" id="5004741">,</span>&nbsp;<span class="ident" id="5004743">state</span>&nbsp;<span class="op" id="5004749">*</span><span class="ident" id="5004750">decoderState</span><span class="op" id="5004762">,</span>&nbsp;<span class="ident" id="5004764">value</span>&nbsp;<span class="ident" id="5004770">reflect</span><span class="op" id="5004777">.</span><span class="ident" id="5004778">Value</span><span class="op" id="5004783">)</span>&nbsp;<span class="op" id="5004785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004788">v</span>&nbsp;<span class="op" id="5004790">:=</span>&nbsp;<span class="ident" id="5004793">state</span><span class="op" id="5004798">.</span><span class="ident" id="5004799">decodeInt</span><span class="op" id="5004808">(</span><span class="op" id="5004809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5004812">if</span>&nbsp;<span class="ident" id="5004815">v</span>&nbsp;<span class="op" id="5004817">&lt;</span>&nbsp;<span class="ident" id="5004819">math</span><span class="op" id="5004823">.</span><span class="ident" id="5004824">MinInt32</span>&nbsp;<span class="op" id="5004833">||</span>&nbsp;<span class="ident" id="5004836">math</span><span class="op" id="5004840">.</span><span class="ident" id="5004841">MaxInt32</span>&nbsp;<span class="op" id="5004850">&lt;</span>&nbsp;<span class="ident" id="5004852">v</span>&nbsp;<span class="op" id="5004854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004858">error_</span><span class="op" id="5004864">(</span><span class="ident" id="5004865">i</span><span class="op" id="5004866">.</span><span class="ident" id="5004867">ovfl</span><span class="op" id="5004871">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5004874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004877">value</span><span class="op" id="5004882">.</span><span class="ident" id="5004883">SetInt</span><span class="op" id="5004889">(</span><span class="ident" id="5004890">v</span><span class="op" id="5004891">)</span><br>
<span class="lineno"></span><span class="op" id="5004893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5004896">//&nbsp;decUint32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint32&nbsp;in&nbsp;value.</span><br>
<span class="lineno">280</span><span class="keyword" id="5004973">func</span>&nbsp;<span class="ident" id="5004978">decUint32</span><span class="op" id="5004987">(</span><span class="ident" id="5004988">i</span>&nbsp;<span class="op" id="5004990">*</span><span class="ident" id="5004991">decInstr</span><span class="op" id="5004999">,</span>&nbsp;<span class="ident" id="5005001">state</span>&nbsp;<span class="op" id="5005007">*</span><span class="ident" id="5005008">decoderState</span><span class="op" id="5005020">,</span>&nbsp;<span class="ident" id="5005022">value</span>&nbsp;<span class="ident" id="5005028">reflect</span><span class="op" id="5005035">.</span><span class="ident" id="5005036">Value</span><span class="op" id="5005041">)</span>&nbsp;<span class="op" id="5005043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005046">v</span>&nbsp;<span class="op" id="5005048">:=</span>&nbsp;<span class="ident" id="5005051">state</span><span class="op" id="5005056">.</span><span class="ident" id="5005057">decodeUint</span><span class="op" id="5005067">(</span><span class="op" id="5005068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005071">if</span>&nbsp;<span class="ident" id="5005074">math</span><span class="op" id="5005078">.</span><span class="ident" id="5005079">MaxUint32</span>&nbsp;<span class="op" id="5005089">&lt;</span>&nbsp;<span class="ident" id="5005091">v</span>&nbsp;<span class="op" id="5005093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005097">error_</span><span class="op" id="5005103">(</span><span class="ident" id="5005104">i</span><span class="op" id="5005105">.</span><span class="ident" id="5005106">ovfl</span><span class="op" id="5005110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5005113">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005116">value</span><span class="op" id="5005121">.</span><span class="ident" id="5005122">SetUint</span><span class="op" id="5005129">(</span><span class="ident" id="5005130">v</span><span class="op" id="5005131">)</span><br>
<span class="lineno"></span><span class="op" id="5005133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5005136">//&nbsp;decInt64&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5005203">func</span>&nbsp;<span class="ident" id="5005208">decInt64</span><span class="op" id="5005216">(</span><span class="ident" id="5005217">i</span>&nbsp;<span class="op" id="5005219">*</span><span class="ident" id="5005220">decInstr</span><span class="op" id="5005228">,</span>&nbsp;<span class="ident" id="5005230">state</span>&nbsp;<span class="op" id="5005236">*</span><span class="ident" id="5005237">decoderState</span><span class="op" id="5005249">,</span>&nbsp;<span class="ident" id="5005251">value</span>&nbsp;<span class="ident" id="5005257">reflect</span><span class="op" id="5005264">.</span><span class="ident" id="5005265">Value</span><span class="op" id="5005270">)</span>&nbsp;<span class="op" id="5005272">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005275">v</span>&nbsp;<span class="op" id="5005277">:=</span>&nbsp;<span class="ident" id="5005280">state</span><span class="op" id="5005285">.</span><span class="ident" id="5005286">decodeInt</span><span class="op" id="5005295">(</span><span class="op" id="5005296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005299">value</span><span class="op" id="5005304">.</span><span class="ident" id="5005305">SetInt</span><span class="op" id="5005311">(</span><span class="ident" id="5005312">v</span><span class="op" id="5005313">)</span><br>
<span class="lineno"></span><span class="op" id="5005315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5005318">//&nbsp;decUint64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64&nbsp;in&nbsp;value.</span><br>
<span class="lineno">295</span><span class="keyword" id="5005395">func</span>&nbsp;<span class="ident" id="5005400">decUint64</span><span class="op" id="5005409">(</span><span class="ident" id="5005410">i</span>&nbsp;<span class="op" id="5005412">*</span><span class="ident" id="5005413">decInstr</span><span class="op" id="5005421">,</span>&nbsp;<span class="ident" id="5005423">state</span>&nbsp;<span class="op" id="5005429">*</span><span class="ident" id="5005430">decoderState</span><span class="op" id="5005442">,</span>&nbsp;<span class="ident" id="5005444">value</span>&nbsp;<span class="ident" id="5005450">reflect</span><span class="op" id="5005457">.</span><span class="ident" id="5005458">Value</span><span class="op" id="5005463">)</span>&nbsp;<span class="op" id="5005465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005468">v</span>&nbsp;<span class="op" id="5005470">:=</span>&nbsp;<span class="ident" id="5005473">state</span><span class="op" id="5005478">.</span><span class="ident" id="5005479">decodeUint</span><span class="op" id="5005489">(</span><span class="op" id="5005490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005493">value</span><span class="op" id="5005498">.</span><span class="ident" id="5005499">SetUint</span><span class="op" id="5005506">(</span><span class="ident" id="5005507">v</span><span class="op" id="5005508">)</span><br>
<span class="lineno"></span><span class="op" id="5005510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="5005513">//&nbsp;Floating-point&nbsp;numbers&nbsp;are&nbsp;transmitted&nbsp;as&nbsp;uint64s&nbsp;holding&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="5005583">//&nbsp;of&nbsp;the&nbsp;underlying&nbsp;representation.&nbsp;&nbsp;They&nbsp;are&nbsp;sent&nbsp;byte-reversed,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5005655">//&nbsp;the&nbsp;exponent&nbsp;end&nbsp;coming&nbsp;out&nbsp;first,&nbsp;so&nbsp;integer&nbsp;floating&nbsp;point&nbsp;numbers</span><br>
<span class="lineno"></span><span class="comment" id="5005727">//&nbsp;(for&nbsp;example)&nbsp;transmit&nbsp;more&nbsp;compactly.&nbsp;&nbsp;This&nbsp;routine&nbsp;does&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5005792">//&nbsp;unswizzling.</span><br>
<span class="lineno">305</span><span class="keyword" id="5005808">func</span>&nbsp;<span class="ident" id="5005813">float64FromBits</span><span class="op" id="5005828">(</span><span class="ident" id="5005829">u</span>&nbsp;<span class="ident" id="5005831">uint64</span><span class="op" id="5005837">)</span>&nbsp;<span class="builtintype" id="5005839">float64</span>&nbsp;<span class="op" id="5005847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005850">var</span>&nbsp;<span class="ident" id="5005854">v</span>&nbsp;<span class="ident" id="5005856">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005864">for</span>&nbsp;<span class="ident" id="5005868">i</span>&nbsp;<span class="op" id="5005870">:=</span>&nbsp;<span class="num" id="5005873">0</span><span class="op" id="5005874">;</span>&nbsp;<span class="ident" id="5005876">i</span>&nbsp;<span class="op" id="5005878">&lt;</span>&nbsp;<span class="num" id="5005880">8</span><span class="op" id="5005881">;</span>&nbsp;<span class="ident" id="5005883">i</span><span class="op" id="5005884">++</span>&nbsp;<span class="op" id="5005887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005891">v</span>&nbsp;<span class="op" id="5005893">&lt;&lt;=</span>&nbsp;<span class="num" id="5005897">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005901">v</span>&nbsp;<span class="op" id="5005903">|=</span>&nbsp;<span class="ident" id="5005906">u</span>&nbsp;<span class="op" id="5005908">&amp;</span>&nbsp;<span class="num" id="5005910">0xFF</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005917">u</span>&nbsp;<span class="op" id="5005919">&gt;&gt;=</span>&nbsp;<span class="num" id="5005923">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5005926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005929">return</span>&nbsp;<span class="ident" id="5005936">math</span><span class="op" id="5005940">.</span><span class="ident" id="5005941">Float64frombits</span><span class="op" id="5005956">(</span><span class="ident" id="5005957">v</span><span class="op" id="5005958">)</span><br>
<span class="lineno"></span><span class="op" id="5005960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="5005963">//&nbsp;float32FromBits&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5006048">//&nbsp;number,&nbsp;and&nbsp;returns&nbsp;it.&nbsp;It&#39;s&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;float32&nbsp;and&nbsp;complex64.</span><br>
<span class="lineno"></span><span class="comment" id="5006125">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;float64&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;reflection&nbsp;needs,&nbsp;but&nbsp;its&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5006202">//&nbsp;value&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;accurately&nbsp;representable&nbsp;in&nbsp;a&nbsp;float32.</span><br>
<span class="lineno"></span><span class="keyword" id="5006265">func</span>&nbsp;<span class="ident" id="5006270">float32FromBits</span><span class="op" id="5006285">(</span><span class="ident" id="5006286">u</span>&nbsp;<span class="ident" id="5006288">uint64</span><span class="op" id="5006294">,</span>&nbsp;<span class="ident" id="5006296">ovfl</span>&nbsp;<span class="builtintype" id="5006301">error</span><span class="op" id="5006306">)</span>&nbsp;<span class="builtintype" id="5006308">float64</span>&nbsp;<span class="op" id="5006316">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006319">v</span>&nbsp;<span class="op" id="5006321">:=</span>&nbsp;<span class="ident" id="5006324">float64FromBits</span><span class="op" id="5006339">(</span><span class="ident" id="5006340">u</span><span class="op" id="5006341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006344">av</span>&nbsp;<span class="op" id="5006347">:=</span>&nbsp;<span class="ident" id="5006350">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006353">if</span>&nbsp;<span class="ident" id="5006356">av</span>&nbsp;<span class="op" id="5006359">&lt;</span>&nbsp;<span class="num" id="5006361">0</span>&nbsp;<span class="op" id="5006363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006367">av</span>&nbsp;<span class="op" id="5006370">=</span>&nbsp;<span class="op" id="5006372">-</span><span class="ident" id="5006373">av</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5006377">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5006380">//&nbsp;+Inf&nbsp;is&nbsp;OK&nbsp;in&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;floats.&nbsp;&nbsp;Underflow&nbsp;is&nbsp;always&nbsp;OK.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006451">if</span>&nbsp;<span class="ident" id="5006454">math</span><span class="op" id="5006458">.</span><span class="ident" id="5006459">MaxFloat32</span>&nbsp;<span class="op" id="5006470">&lt;</span>&nbsp;<span class="ident" id="5006472">av</span>&nbsp;<span class="op" id="5006475">&amp;&amp;</span>&nbsp;<span class="ident" id="5006478">av</span>&nbsp;<span class="op" id="5006481">&lt;=</span>&nbsp;<span class="ident" id="5006484">math</span><span class="op" id="5006488">.</span><span class="ident" id="5006489">MaxFloat64</span>&nbsp;<span class="op" id="5006500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006504">error_</span><span class="op" id="5006510">(</span><span class="ident" id="5006511">ovfl</span><span class="op" id="5006515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5006518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006521">return</span>&nbsp;<span class="ident" id="5006528">v</span><br>
<span class="lineno">330</span><span class="op" id="5006530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5006533">//&nbsp;decFloat32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5006613">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5006648">func</span>&nbsp;<span class="ident" id="5006653">decFloat32</span><span class="op" id="5006663">(</span><span class="ident" id="5006664">i</span>&nbsp;<span class="op" id="5006666">*</span><span class="ident" id="5006667">decInstr</span><span class="op" id="5006675">,</span>&nbsp;<span class="ident" id="5006677">state</span>&nbsp;<span class="op" id="5006683">*</span><span class="ident" id="5006684">decoderState</span><span class="op" id="5006696">,</span>&nbsp;<span class="ident" id="5006698">value</span>&nbsp;<span class="ident" id="5006704">reflect</span><span class="op" id="5006711">.</span><span class="ident" id="5006712">Value</span><span class="op" id="5006717">)</span>&nbsp;<span class="op" id="5006719">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006722">value</span><span class="op" id="5006727">.</span><span class="ident" id="5006728">SetFloat</span><span class="op" id="5006736">(</span><span class="ident" id="5006737">float32FromBits</span><span class="op" id="5006752">(</span><span class="ident" id="5006753">state</span><span class="op" id="5006758">.</span><span class="ident" id="5006759">decodeUint</span><span class="op" id="5006769">(</span><span class="op" id="5006770">)</span><span class="op" id="5006771">,</span>&nbsp;<span class="ident" id="5006773">i</span><span class="op" id="5006774">.</span><span class="ident" id="5006775">ovfl</span><span class="op" id="5006779">)</span><span class="op" id="5006780">)</span><br>
<span class="lineno"></span><span class="op" id="5006782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5006785">//&nbsp;decFloat64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;64-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5006865">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">340</span><span class="keyword" id="5006900">func</span>&nbsp;<span class="ident" id="5006905">decFloat64</span><span class="op" id="5006915">(</span><span class="ident" id="5006916">i</span>&nbsp;<span class="op" id="5006918">*</span><span class="ident" id="5006919">decInstr</span><span class="op" id="5006927">,</span>&nbsp;<span class="ident" id="5006929">state</span>&nbsp;<span class="op" id="5006935">*</span><span class="ident" id="5006936">decoderState</span><span class="op" id="5006948">,</span>&nbsp;<span class="ident" id="5006950">value</span>&nbsp;<span class="ident" id="5006956">reflect</span><span class="op" id="5006963">.</span><span class="ident" id="5006964">Value</span><span class="op" id="5006969">)</span>&nbsp;<span class="op" id="5006971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006974">value</span><span class="op" id="5006979">.</span><span class="ident" id="5006980">SetFloat</span><span class="op" id="5006988">(</span><span class="ident" id="5006989">float64FromBits</span><span class="op" id="5007004">(</span><span class="ident" id="5007005">state</span><span class="op" id="5007010">.</span><span class="ident" id="5007011">decodeUint</span><span class="op" id="5007021">(</span><span class="op" id="5007022">)</span><span class="op" id="5007023">)</span><span class="op" id="5007024">)</span><br>
<span class="lineno"></span><span class="op" id="5007026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5007029">//&nbsp;decComplex64&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno">345</span><span class="comment" id="5007099">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5007175">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5007205">func</span>&nbsp;<span class="ident" id="5007210">decComplex64</span><span class="op" id="5007222">(</span><span class="ident" id="5007223">i</span>&nbsp;<span class="op" id="5007225">*</span><span class="ident" id="5007226">decInstr</span><span class="op" id="5007234">,</span>&nbsp;<span class="ident" id="5007236">state</span>&nbsp;<span class="op" id="5007242">*</span><span class="ident" id="5007243">decoderState</span><span class="op" id="5007255">,</span>&nbsp;<span class="ident" id="5007257">value</span>&nbsp;<span class="ident" id="5007263">reflect</span><span class="op" id="5007270">.</span><span class="ident" id="5007271">Value</span><span class="op" id="5007276">)</span>&nbsp;<span class="op" id="5007278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5007281">real</span>&nbsp;<span class="op" id="5007286">:=</span>&nbsp;<span class="ident" id="5007289">float32FromBits</span><span class="op" id="5007304">(</span><span class="ident" id="5007305">state</span><span class="op" id="5007310">.</span><span class="ident" id="5007311">decodeUint</span><span class="op" id="5007321">(</span><span class="op" id="5007322">)</span><span class="op" id="5007323">,</span>&nbsp;<span class="ident" id="5007325">i</span><span class="op" id="5007326">.</span><span class="ident" id="5007327">ovfl</span><span class="op" id="5007331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5007334">imag</span>&nbsp;<span class="op" id="5007339">:=</span>&nbsp;<span class="ident" id="5007342">float32FromBits</span><span class="op" id="5007357">(</span><span class="ident" id="5007358">state</span><span class="op" id="5007363">.</span><span class="ident" id="5007364">decodeUint</span><span class="op" id="5007374">(</span><span class="op" id="5007375">)</span><span class="op" id="5007376">,</span>&nbsp;<span class="ident" id="5007378">i</span><span class="op" id="5007379">.</span><span class="ident" id="5007380">ovfl</span><span class="op" id="5007384">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007387">value</span><span class="op" id="5007392">.</span><span class="ident" id="5007393">SetComplex</span><span class="op" id="5007403">(</span><span class="builtinfunc" id="5007404">complex</span><span class="op" id="5007411">(</span><span class="builtinfunc" id="5007412">real</span><span class="op" id="5007416">,</span>&nbsp;<span class="builtinfunc" id="5007418">imag</span><span class="op" id="5007422">)</span><span class="op" id="5007423">)</span><br>
<span class="lineno"></span><span class="op" id="5007425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5007428">//&nbsp;decComplex128&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5007499">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex128&nbsp;in&nbsp;value.</span><br>
<span class="lineno">355</span><span class="comment" id="5007576">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5007606">func</span>&nbsp;<span class="ident" id="5007611">decComplex128</span><span class="op" id="5007624">(</span><span class="ident" id="5007625">i</span>&nbsp;<span class="op" id="5007627">*</span><span class="ident" id="5007628">decInstr</span><span class="op" id="5007636">,</span>&nbsp;<span class="ident" id="5007638">state</span>&nbsp;<span class="op" id="5007644">*</span><span class="ident" id="5007645">decoderState</span><span class="op" id="5007657">,</span>&nbsp;<span class="ident" id="5007659">value</span>&nbsp;<span class="ident" id="5007665">reflect</span><span class="op" id="5007672">.</span><span class="ident" id="5007673">Value</span><span class="op" id="5007678">)</span>&nbsp;<span class="op" id="5007680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5007683">real</span>&nbsp;<span class="op" id="5007688">:=</span>&nbsp;<span class="ident" id="5007691">float64FromBits</span><span class="op" id="5007706">(</span><span class="ident" id="5007707">state</span><span class="op" id="5007712">.</span><span class="ident" id="5007713">decodeUint</span><span class="op" id="5007723">(</span><span class="op" id="5007724">)</span><span class="op" id="5007725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5007728">imag</span>&nbsp;<span class="op" id="5007733">:=</span>&nbsp;<span class="ident" id="5007736">float64FromBits</span><span class="op" id="5007751">(</span><span class="ident" id="5007752">state</span><span class="op" id="5007757">.</span><span class="ident" id="5007758">decodeUint</span><span class="op" id="5007768">(</span><span class="op" id="5007769">)</span><span class="op" id="5007770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007773">value</span><span class="op" id="5007778">.</span><span class="ident" id="5007779">SetComplex</span><span class="op" id="5007789">(</span><span class="builtinfunc" id="5007790">complex</span><span class="op" id="5007797">(</span><span class="builtinfunc" id="5007798">real</span><span class="op" id="5007802">,</span>&nbsp;<span class="builtinfunc" id="5007804">imag</span><span class="op" id="5007808">)</span><span class="op" id="5007809">)</span><br>
<span class="lineno">360</span><span class="op" id="5007811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5007814">//&nbsp;decUint8Slice&nbsp;decodes&nbsp;a&nbsp;byte&nbsp;slice&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;slice&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5007887">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5007911">//&nbsp;uint8&nbsp;slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">365</span><span class="keyword" id="5007987">func</span>&nbsp;<span class="ident" id="5007992">decUint8Slice</span><span class="op" id="5008005">(</span><span class="ident" id="5008006">i</span>&nbsp;<span class="op" id="5008008">*</span><span class="ident" id="5008009">decInstr</span><span class="op" id="5008017">,</span>&nbsp;<span class="ident" id="5008019">state</span>&nbsp;<span class="op" id="5008025">*</span><span class="ident" id="5008026">decoderState</span><span class="op" id="5008038">,</span>&nbsp;<span class="ident" id="5008040">value</span>&nbsp;<span class="ident" id="5008046">reflect</span><span class="op" id="5008053">.</span><span class="ident" id="5008054">Value</span><span class="op" id="5008059">)</span>&nbsp;<span class="op" id="5008061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008064">u</span>&nbsp;<span class="op" id="5008066">:=</span>&nbsp;<span class="ident" id="5008069">state</span><span class="op" id="5008074">.</span><span class="ident" id="5008075">decodeUint</span><span class="op" id="5008085">(</span><span class="op" id="5008086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008089">n</span>&nbsp;<span class="op" id="5008091">:=</span>&nbsp;<span class="builtintype" id="5008094">int</span><span class="op" id="5008097">(</span><span class="ident" id="5008098">u</span><span class="op" id="5008099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008102">if</span>&nbsp;<span class="ident" id="5008105">n</span>&nbsp;<span class="op" id="5008107">&lt;</span>&nbsp;<span class="num" id="5008109">0</span>&nbsp;<span class="op" id="5008111">||</span>&nbsp;<span class="ident" id="5008114">uint64</span><span class="op" id="5008120">(</span><span class="ident" id="5008121">n</span><span class="op" id="5008122">)</span>&nbsp;<span class="op" id="5008124">!=</span>&nbsp;<span class="ident" id="5008127">u</span>&nbsp;<span class="op" id="5008129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008133">errorf</span><span class="op" id="5008139">(</span><span class="string" id="5008140">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="5008184">,</span>&nbsp;<span class="ident" id="5008186">value</span><span class="op" id="5008191">.</span><span class="ident" id="5008192">Type</span><span class="op" id="5008196">(</span><span class="op" id="5008197">)</span><span class="op" id="5008198">,</span>&nbsp;<span class="ident" id="5008200">u</span><span class="op" id="5008201">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008207">if</span>&nbsp;<span class="ident" id="5008210">n</span>&nbsp;<span class="op" id="5008212">&gt;</span>&nbsp;<span class="ident" id="5008214">state</span><span class="op" id="5008219">.</span><span class="ident" id="5008220">b</span><span class="op" id="5008221">.</span><span class="ident" id="5008222">Len</span><span class="op" id="5008225">(</span><span class="op" id="5008226">)</span>&nbsp;<span class="op" id="5008228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008232">errorf</span><span class="op" id="5008238">(</span><span class="string" id="5008239">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="5008272">,</span>&nbsp;<span class="ident" id="5008274">value</span><span class="op" id="5008279">.</span><span class="ident" id="5008280">Type</span><span class="op" id="5008284">(</span><span class="op" id="5008285">)</span><span class="op" id="5008286">,</span>&nbsp;<span class="ident" id="5008288">n</span><span class="op" id="5008289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008295">if</span>&nbsp;<span class="ident" id="5008298">n</span>&nbsp;<span class="op" id="5008300">&gt;</span>&nbsp;<span class="ident" id="5008302">tooBig</span>&nbsp;<span class="op" id="5008309">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008313">errorf</span><span class="op" id="5008319">(</span><span class="string" id="5008320">&#34;byte&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&#34;</span><span class="op" id="5008344">,</span>&nbsp;<span class="ident" id="5008346">n</span><span class="op" id="5008347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008353">if</span>&nbsp;<span class="ident" id="5008356">value</span><span class="op" id="5008361">.</span><span class="ident" id="5008362">Cap</span><span class="op" id="5008365">(</span><span class="op" id="5008366">)</span>&nbsp;<span class="op" id="5008368">&lt;</span>&nbsp;<span class="ident" id="5008370">n</span>&nbsp;<span class="op" id="5008372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008376">value</span><span class="op" id="5008381">.</span><span class="ident" id="5008382">Set</span><span class="op" id="5008385">(</span><span class="ident" id="5008386">reflect</span><span class="op" id="5008393">.</span><span class="ident" id="5008394">MakeSlice</span><span class="op" id="5008403">(</span><span class="ident" id="5008404">value</span><span class="op" id="5008409">.</span><span class="ident" id="5008410">Type</span><span class="op" id="5008414">(</span><span class="op" id="5008415">)</span><span class="op" id="5008416">,</span>&nbsp;<span class="ident" id="5008418">n</span><span class="op" id="5008419">,</span>&nbsp;<span class="ident" id="5008421">n</span><span class="op" id="5008422">)</span><span class="op" id="5008423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008426">}</span>&nbsp;<span class="keyword" id="5008428">else</span>&nbsp;<span class="op" id="5008433">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008437">value</span><span class="op" id="5008442">.</span><span class="ident" id="5008443">Set</span><span class="op" id="5008446">(</span><span class="ident" id="5008447">value</span><span class="op" id="5008452">.</span><span class="ident" id="5008453">Slice</span><span class="op" id="5008458">(</span><span class="num" id="5008459">0</span><span class="op" id="5008460">,</span>&nbsp;<span class="ident" id="5008462">n</span><span class="op" id="5008463">)</span><span class="op" id="5008464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008470">if</span>&nbsp;<span class="ident" id="5008473">_</span><span class="op" id="5008474">,</span>&nbsp;<span class="ident" id="5008476">err</span>&nbsp;<span class="op" id="5008480">:=</span>&nbsp;<span class="ident" id="5008483">state</span><span class="op" id="5008488">.</span><span class="ident" id="5008489">b</span><span class="op" id="5008490">.</span><span class="ident" id="5008491">Read</span><span class="op" id="5008495">(</span><span class="ident" id="5008496">value</span><span class="op" id="5008501">.</span><span class="ident" id="5008502">Bytes</span><span class="op" id="5008507">(</span><span class="op" id="5008508">)</span><span class="op" id="5008509">)</span><span class="op" id="5008510">;</span>&nbsp;<span class="ident" id="5008512">err</span>&nbsp;<span class="op" id="5008516">!=</span>&nbsp;<span class="ident" id="5008519">nil</span>&nbsp;<span class="op" id="5008523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008527">errorf</span><span class="op" id="5008533">(</span><span class="string" id="5008534">&#34;error&nbsp;decoding&nbsp;[]byte:&nbsp;%s&#34;</span><span class="op" id="5008561">,</span>&nbsp;<span class="ident" id="5008563">err</span><span class="op" id="5008566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008569">}</span><br>
<span class="lineno">385</span><span class="op" id="5008571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5008574">//&nbsp;decString&nbsp;decodes&nbsp;byte&nbsp;array&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;string&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5008642">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5008666">//&nbsp;Strings&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">390</span><span class="keyword" id="5008737">func</span>&nbsp;<span class="ident" id="5008742">decString</span><span class="op" id="5008751">(</span><span class="ident" id="5008752">i</span>&nbsp;<span class="op" id="5008754">*</span><span class="ident" id="5008755">decInstr</span><span class="op" id="5008763">,</span>&nbsp;<span class="ident" id="5008765">state</span>&nbsp;<span class="op" id="5008771">*</span><span class="ident" id="5008772">decoderState</span><span class="op" id="5008784">,</span>&nbsp;<span class="ident" id="5008786">value</span>&nbsp;<span class="ident" id="5008792">reflect</span><span class="op" id="5008799">.</span><span class="ident" id="5008800">Value</span><span class="op" id="5008805">)</span>&nbsp;<span class="op" id="5008807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008810">u</span>&nbsp;<span class="op" id="5008812">:=</span>&nbsp;<span class="ident" id="5008815">state</span><span class="op" id="5008820">.</span><span class="ident" id="5008821">decodeUint</span><span class="op" id="5008831">(</span><span class="op" id="5008832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008835">n</span>&nbsp;<span class="op" id="5008837">:=</span>&nbsp;<span class="builtintype" id="5008840">int</span><span class="op" id="5008843">(</span><span class="ident" id="5008844">u</span><span class="op" id="5008845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008848">if</span>&nbsp;<span class="ident" id="5008851">n</span>&nbsp;<span class="op" id="5008853">&lt;</span>&nbsp;<span class="num" id="5008855">0</span>&nbsp;<span class="op" id="5008857">||</span>&nbsp;<span class="ident" id="5008860">uint64</span><span class="op" id="5008866">(</span><span class="ident" id="5008867">n</span><span class="op" id="5008868">)</span>&nbsp;<span class="op" id="5008870">!=</span>&nbsp;<span class="ident" id="5008873">u</span>&nbsp;<span class="op" id="5008875">||</span>&nbsp;<span class="ident" id="5008878">n</span>&nbsp;<span class="op" id="5008880">&gt;</span>&nbsp;<span class="ident" id="5008882">state</span><span class="op" id="5008887">.</span><span class="ident" id="5008888">b</span><span class="op" id="5008889">.</span><span class="ident" id="5008890">Len</span><span class="op" id="5008893">(</span><span class="op" id="5008894">)</span>&nbsp;<span class="op" id="5008896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008900">errorf</span><span class="op" id="5008906">(</span><span class="string" id="5008907">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="5008951">,</span>&nbsp;<span class="ident" id="5008953">value</span><span class="op" id="5008958">.</span><span class="ident" id="5008959">Type</span><span class="op" id="5008963">(</span><span class="op" id="5008964">)</span><span class="op" id="5008965">,</span>&nbsp;<span class="ident" id="5008967">u</span><span class="op" id="5008968">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008974">if</span>&nbsp;<span class="ident" id="5008977">n</span>&nbsp;<span class="op" id="5008979">&gt;</span>&nbsp;<span class="ident" id="5008981">state</span><span class="op" id="5008986">.</span><span class="ident" id="5008987">b</span><span class="op" id="5008988">.</span><span class="ident" id="5008989">Len</span><span class="op" id="5008992">(</span><span class="op" id="5008993">)</span>&nbsp;<span class="op" id="5008995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008999">errorf</span><span class="op" id="5009005">(</span><span class="string" id="5009006">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="5009039">,</span>&nbsp;<span class="ident" id="5009041">value</span><span class="op" id="5009046">.</span><span class="ident" id="5009047">Type</span><span class="op" id="5009051">(</span><span class="op" id="5009052">)</span><span class="op" id="5009053">,</span>&nbsp;<span class="ident" id="5009055">n</span><span class="op" id="5009056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5009059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009062">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009081">data</span>&nbsp;<span class="op" id="5009086">:=</span>&nbsp;<span class="builtinfunc" id="5009089">make</span><span class="op" id="5009093">(</span><span class="op" id="5009094">[</span><span class="op" id="5009095">]</span><span class="builtintype" id="5009096">byte</span><span class="op" id="5009100">,</span>&nbsp;<span class="ident" id="5009102">n</span><span class="op" id="5009103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009106">if</span>&nbsp;<span class="ident" id="5009109">_</span><span class="op" id="5009110">,</span>&nbsp;<span class="ident" id="5009112">err</span>&nbsp;<span class="op" id="5009116">:=</span>&nbsp;<span class="ident" id="5009119">state</span><span class="op" id="5009124">.</span><span class="ident" id="5009125">b</span><span class="op" id="5009126">.</span><span class="ident" id="5009127">Read</span><span class="op" id="5009131">(</span><span class="ident" id="5009132">data</span><span class="op" id="5009136">)</span><span class="op" id="5009137">;</span>&nbsp;<span class="ident" id="5009139">err</span>&nbsp;<span class="op" id="5009143">!=</span>&nbsp;<span class="ident" id="5009146">nil</span>&nbsp;<span class="op" id="5009150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009154">errorf</span><span class="op" id="5009160">(</span><span class="string" id="5009161">&#34;error&nbsp;decoding&nbsp;string:&nbsp;%s&#34;</span><span class="op" id="5009188">,</span>&nbsp;<span class="ident" id="5009190">err</span><span class="op" id="5009193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5009196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009199">value</span><span class="op" id="5009204">.</span><span class="ident" id="5009205">SetString</span><span class="op" id="5009214">(</span><span class="builtintype" id="5009215">string</span><span class="op" id="5009221">(</span><span class="ident" id="5009222">data</span><span class="op" id="5009226">)</span><span class="op" id="5009227">)</span><br>
<span class="lineno">405</span><span class="op" id="5009229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5009232">//&nbsp;ignoreUint8Array&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;byte&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5009316">func</span>&nbsp;<span class="ident" id="5009321">ignoreUint8Array</span><span class="op" id="5009337">(</span><span class="ident" id="5009338">i</span>&nbsp;<span class="op" id="5009340">*</span><span class="ident" id="5009341">decInstr</span><span class="op" id="5009349">,</span>&nbsp;<span class="ident" id="5009351">state</span>&nbsp;<span class="op" id="5009357">*</span><span class="ident" id="5009358">decoderState</span><span class="op" id="5009370">,</span>&nbsp;<span class="ident" id="5009372">value</span>&nbsp;<span class="ident" id="5009378">reflect</span><span class="op" id="5009385">.</span><span class="ident" id="5009386">Value</span><span class="op" id="5009391">)</span>&nbsp;<span class="op" id="5009393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009396">b</span>&nbsp;<span class="op" id="5009398">:=</span>&nbsp;<span class="builtinfunc" id="5009401">make</span><span class="op" id="5009405">(</span><span class="op" id="5009406">[</span><span class="op" id="5009407">]</span><span class="builtintype" id="5009408">byte</span><span class="op" id="5009412">,</span>&nbsp;<span class="ident" id="5009414">state</span><span class="op" id="5009419">.</span><span class="ident" id="5009420">decodeUint</span><span class="op" id="5009430">(</span><span class="op" id="5009431">)</span><span class="op" id="5009432">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009435">state</span><span class="op" id="5009440">.</span><span class="ident" id="5009441">b</span><span class="op" id="5009442">.</span><span class="ident" id="5009443">Read</span><span class="op" id="5009447">(</span><span class="ident" id="5009448">b</span><span class="op" id="5009449">)</span><br>
<span class="lineno"></span><span class="op" id="5009451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5009454">//&nbsp;Execution&nbsp;engine</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="5009475">//&nbsp;The&nbsp;encoder&nbsp;engine&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;instructions&nbsp;indexed&nbsp;by&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5009565">//&nbsp;decoder.&nbsp;&nbsp;It&nbsp;is&nbsp;executed&nbsp;with&nbsp;random&nbsp;access&nbsp;according&nbsp;to&nbsp;field&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword" id="5009639">type</span>&nbsp;<span class="ident" id="5009644">decEngine</span>&nbsp;<span class="keyword" id="5009654">struct</span>&nbsp;<span class="op" id="5009661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009664">instr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009673">[</span><span class="op" id="5009674">]</span><span class="ident" id="5009675">decInstr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009685">numInstr</span>&nbsp;<span class="builtintype" id="5009694">int</span>&nbsp;<span class="comment" id="5009698">//&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;instructions</span><br>
<span class="lineno">420</span><span class="op" id="5009735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5009738">//&nbsp;decodeSingle&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;value&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5009825">//&nbsp;Such&nbsp;values&nbsp;are&nbsp;preceded&nbsp;by&nbsp;a&nbsp;zero,&nbsp;making&nbsp;them&nbsp;have&nbsp;the&nbsp;memory&nbsp;layout&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5009904">//&nbsp;struct&nbsp;field&nbsp;(although&nbsp;with&nbsp;an&nbsp;illegal&nbsp;field&nbsp;number).</span><br>
<span class="lineno">425</span><span class="keyword" id="5009961">func</span>&nbsp;<span class="op" id="5009966">(</span><span class="ident" id="5009967">dec</span>&nbsp;<span class="op" id="5009971">*</span><span class="ident" id="5009972">Decoder</span><span class="op" id="5009979">)</span>&nbsp;<span class="ident" id="5009981">decodeSingle</span><span class="op" id="5009993">(</span><span class="ident" id="5009994">engine</span>&nbsp;<span class="op" id="5010001">*</span><span class="ident" id="5010002">decEngine</span><span class="op" id="5010011">,</span>&nbsp;<span class="ident" id="5010013">ut</span>&nbsp;<span class="op" id="5010016">*</span><span class="ident" id="5010017">userTypeInfo</span><span class="op" id="5010029">,</span>&nbsp;<span class="ident" id="5010031">value</span>&nbsp;<span class="ident" id="5010037">reflect</span><span class="op" id="5010044">.</span><span class="ident" id="5010045">Value</span><span class="op" id="5010050">)</span>&nbsp;<span class="op" id="5010052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010055">state</span>&nbsp;<span class="op" id="5010061">:=</span>&nbsp;<span class="ident" id="5010064">dec</span><span class="op" id="5010067">.</span><span class="ident" id="5010068">newDecoderState</span><span class="op" id="5010083">(</span><span class="op" id="5010084">&amp;</span><span class="ident" id="5010085">dec</span><span class="op" id="5010088">.</span><span class="ident" id="5010089">buf</span><span class="op" id="5010092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010095">defer</span>&nbsp;<span class="ident" id="5010101">dec</span><span class="op" id="5010104">.</span><span class="ident" id="5010105">freeDecoderState</span><span class="op" id="5010121">(</span><span class="ident" id="5010122">state</span><span class="op" id="5010127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010130">state</span><span class="op" id="5010135">.</span><span class="ident" id="5010136">fieldnum</span>&nbsp;<span class="op" id="5010145">=</span>&nbsp;<span class="ident" id="5010147">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010163">if</span>&nbsp;<span class="ident" id="5010166">state</span><span class="op" id="5010171">.</span><span class="ident" id="5010172">decodeUint</span><span class="op" id="5010182">(</span><span class="op" id="5010183">)</span>&nbsp;<span class="op" id="5010185">!=</span>&nbsp;<span class="num" id="5010188">0</span>&nbsp;<span class="op" id="5010190">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010194">errorf</span><span class="op" id="5010200">(</span><span class="string" id="5010201">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="5010255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010261">instr</span>&nbsp;<span class="op" id="5010267">:=</span>&nbsp;<span class="op" id="5010270">&amp;</span><span class="ident" id="5010271">engine</span><span class="op" id="5010277">.</span><span class="ident" id="5010278">instr</span><span class="op" id="5010283">[</span><span class="ident" id="5010284">singletonField</span><span class="op" id="5010298">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010301">instr</span><span class="op" id="5010306">.</span><span class="ident" id="5010307">op</span><span class="op" id="5010309">(</span><span class="ident" id="5010310">instr</span><span class="op" id="5010315">,</span>&nbsp;<span class="ident" id="5010317">state</span><span class="op" id="5010322">,</span>&nbsp;<span class="ident" id="5010324">value</span><span class="op" id="5010329">)</span><br>
<span class="lineno"></span><span class="op" id="5010331">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="5010334">//&nbsp;decodeStruct&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5010401">//&nbsp;Indir&nbsp;is&nbsp;for&nbsp;the&nbsp;value,&nbsp;not&nbsp;the&nbsp;type.&nbsp;&nbsp;At&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call&nbsp;it&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="5010474">//&nbsp;differ&nbsp;from&nbsp;ut.indir,&nbsp;which&nbsp;was&nbsp;computed&nbsp;when&nbsp;the&nbsp;engine&nbsp;was&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="5010545">//&nbsp;This&nbsp;state&nbsp;cannot&nbsp;arise&nbsp;for&nbsp;decodeSingle,&nbsp;which&nbsp;is&nbsp;called&nbsp;directly</span><br>
<span class="lineno">440</span><span class="comment" id="5010615">//&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;value,&nbsp;not&nbsp;from&nbsp;the&nbsp;innards&nbsp;of&nbsp;an&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="5010676">func</span>&nbsp;<span class="op" id="5010681">(</span><span class="ident" id="5010682">dec</span>&nbsp;<span class="op" id="5010686">*</span><span class="ident" id="5010687">Decoder</span><span class="op" id="5010694">)</span>&nbsp;<span class="ident" id="5010696">decodeStruct</span><span class="op" id="5010708">(</span><span class="ident" id="5010709">engine</span>&nbsp;<span class="op" id="5010716">*</span><span class="ident" id="5010717">decEngine</span><span class="op" id="5010726">,</span>&nbsp;<span class="ident" id="5010728">ut</span>&nbsp;<span class="op" id="5010731">*</span><span class="ident" id="5010732">userTypeInfo</span><span class="op" id="5010744">,</span>&nbsp;<span class="ident" id="5010746">value</span>&nbsp;<span class="ident" id="5010752">reflect</span><span class="op" id="5010759">.</span><span class="ident" id="5010760">Value</span><span class="op" id="5010765">)</span>&nbsp;<span class="op" id="5010767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010770">state</span>&nbsp;<span class="op" id="5010776">:=</span>&nbsp;<span class="ident" id="5010779">dec</span><span class="op" id="5010782">.</span><span class="ident" id="5010783">newDecoderState</span><span class="op" id="5010798">(</span><span class="op" id="5010799">&amp;</span><span class="ident" id="5010800">dec</span><span class="op" id="5010803">.</span><span class="ident" id="5010804">buf</span><span class="op" id="5010807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010810">defer</span>&nbsp;<span class="ident" id="5010816">dec</span><span class="op" id="5010819">.</span><span class="ident" id="5010820">freeDecoderState</span><span class="op" id="5010836">(</span><span class="ident" id="5010837">state</span><span class="op" id="5010842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010845">state</span><span class="op" id="5010850">.</span><span class="ident" id="5010851">fieldnum</span>&nbsp;<span class="op" id="5010860">=</span>&nbsp;<span class="op" id="5010862">-</span><span class="num" id="5010863">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010866">for</span>&nbsp;<span class="ident" id="5010870">state</span><span class="op" id="5010875">.</span><span class="ident" id="5010876">b</span><span class="op" id="5010877">.</span><span class="ident" id="5010878">Len</span><span class="op" id="5010881">(</span><span class="op" id="5010882">)</span>&nbsp;<span class="op" id="5010884">&gt;</span>&nbsp;<span class="num" id="5010886">0</span>&nbsp;<span class="op" id="5010888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010892">delta</span>&nbsp;<span class="op" id="5010898">:=</span>&nbsp;<span class="builtintype" id="5010901">int</span><span class="op" id="5010904">(</span><span class="ident" id="5010905">state</span><span class="op" id="5010910">.</span><span class="ident" id="5010911">decodeUint</span><span class="op" id="5010921">(</span><span class="op" id="5010922">)</span><span class="op" id="5010923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010927">if</span>&nbsp;<span class="ident" id="5010930">delta</span>&nbsp;<span class="op" id="5010936">&lt;</span>&nbsp;<span class="num" id="5010938">0</span>&nbsp;<span class="op" id="5010940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010945">errorf</span><span class="op" id="5010951">(</span><span class="string" id="5010952">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="5010992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010996">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011000">if</span>&nbsp;<span class="ident" id="5011003">delta</span>&nbsp;<span class="op" id="5011009">==</span>&nbsp;<span class="num" id="5011012">0</span>&nbsp;<span class="op" id="5011014">{</span>&nbsp;<span class="comment" id="5011016">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011063">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011075">fieldnum</span>&nbsp;<span class="op" id="5011084">:=</span>&nbsp;<span class="ident" id="5011087">state</span><span class="op" id="5011092">.</span><span class="ident" id="5011093">fieldnum</span>&nbsp;<span class="op" id="5011102">+</span>&nbsp;<span class="ident" id="5011104">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011112">if</span>&nbsp;<span class="ident" id="5011115">fieldnum</span>&nbsp;<span class="op" id="5011124">&gt;=</span>&nbsp;<span class="builtinfunc" id="5011127">len</span><span class="op" id="5011130">(</span><span class="ident" id="5011131">engine</span><span class="op" id="5011137">.</span><span class="ident" id="5011138">instr</span><span class="op" id="5011143">)</span>&nbsp;<span class="op" id="5011145">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011150">error_</span><span class="op" id="5011156">(</span><span class="ident" id="5011157">errRange</span><span class="op" id="5011165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011170">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011182">instr</span>&nbsp;<span class="op" id="5011188">:=</span>&nbsp;<span class="op" id="5011191">&amp;</span><span class="ident" id="5011192">engine</span><span class="op" id="5011198">.</span><span class="ident" id="5011199">instr</span><span class="op" id="5011204">[</span><span class="ident" id="5011205">fieldnum</span><span class="op" id="5011213">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011217">var</span>&nbsp;<span class="ident" id="5011221">field</span>&nbsp;<span class="ident" id="5011227">reflect</span><span class="op" id="5011234">.</span><span class="ident" id="5011235">Value</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011243">if</span>&nbsp;<span class="ident" id="5011246">instr</span><span class="op" id="5011251">.</span><span class="ident" id="5011252">index</span>&nbsp;<span class="op" id="5011258">!=</span>&nbsp;<span class="ident" id="5011261">nil</span>&nbsp;<span class="op" id="5011265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011270">//&nbsp;Otherwise&nbsp;the&nbsp;field&nbsp;is&nbsp;unknown&nbsp;to&nbsp;us&nbsp;and&nbsp;instr.op&nbsp;is&nbsp;an&nbsp;ignore&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011343">field</span>&nbsp;<span class="op" id="5011349">=</span>&nbsp;<span class="ident" id="5011351">value</span><span class="op" id="5011356">.</span><span class="ident" id="5011357">FieldByIndex</span><span class="op" id="5011369">(</span><span class="ident" id="5011370">instr</span><span class="op" id="5011375">.</span><span class="ident" id="5011376">index</span><span class="op" id="5011381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011386">if</span>&nbsp;<span class="ident" id="5011389">field</span><span class="op" id="5011394">.</span><span class="ident" id="5011395">Kind</span><span class="op" id="5011399">(</span><span class="op" id="5011400">)</span>&nbsp;<span class="op" id="5011402">==</span>&nbsp;<span class="ident" id="5011405">reflect</span><span class="op" id="5011412">.</span><span class="ident" id="5011413">Ptr</span>&nbsp;<span class="op" id="5011417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011423">field</span>&nbsp;<span class="op" id="5011429">=</span>&nbsp;<span class="ident" id="5011431">decAlloc</span><span class="op" id="5011439">(</span><span class="ident" id="5011440">field</span><span class="op" id="5011445">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011458">instr</span><span class="op" id="5011463">.</span><span class="ident" id="5011464">op</span><span class="op" id="5011466">(</span><span class="ident" id="5011467">instr</span><span class="op" id="5011472">,</span>&nbsp;<span class="ident" id="5011474">state</span><span class="op" id="5011479">,</span>&nbsp;<span class="ident" id="5011481">field</span><span class="op" id="5011486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011490">state</span><span class="op" id="5011495">.</span><span class="ident" id="5011496">fieldnum</span>&nbsp;<span class="op" id="5011505">=</span>&nbsp;<span class="ident" id="5011507">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011517">}</span><br>
<span class="lineno">470</span><span class="op" id="5011519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5011522">var</span>&nbsp;<span class="ident" id="5011526">noValue</span>&nbsp;<span class="ident" id="5011534">reflect</span><span class="op" id="5011541">.</span><span class="ident" id="5011542">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5011549">//&nbsp;ignoreStruct&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;struct&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">475</span><span class="keyword" id="5011617">func</span>&nbsp;<span class="op" id="5011622">(</span><span class="ident" id="5011623">dec</span>&nbsp;<span class="op" id="5011627">*</span><span class="ident" id="5011628">Decoder</span><span class="op" id="5011635">)</span>&nbsp;<span class="ident" id="5011637">ignoreStruct</span><span class="op" id="5011649">(</span><span class="ident" id="5011650">engine</span>&nbsp;<span class="op" id="5011657">*</span><span class="ident" id="5011658">decEngine</span><span class="op" id="5011667">)</span>&nbsp;<span class="op" id="5011669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011672">state</span>&nbsp;<span class="op" id="5011678">:=</span>&nbsp;<span class="ident" id="5011681">dec</span><span class="op" id="5011684">.</span><span class="ident" id="5011685">newDecoderState</span><span class="op" id="5011700">(</span><span class="op" id="5011701">&amp;</span><span class="ident" id="5011702">dec</span><span class="op" id="5011705">.</span><span class="ident" id="5011706">buf</span><span class="op" id="5011709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011712">defer</span>&nbsp;<span class="ident" id="5011718">dec</span><span class="op" id="5011721">.</span><span class="ident" id="5011722">freeDecoderState</span><span class="op" id="5011738">(</span><span class="ident" id="5011739">state</span><span class="op" id="5011744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011747">state</span><span class="op" id="5011752">.</span><span class="ident" id="5011753">fieldnum</span>&nbsp;<span class="op" id="5011762">=</span>&nbsp;<span class="op" id="5011764">-</span><span class="num" id="5011765">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011768">for</span>&nbsp;<span class="ident" id="5011772">state</span><span class="op" id="5011777">.</span><span class="ident" id="5011778">b</span><span class="op" id="5011779">.</span><span class="ident" id="5011780">Len</span><span class="op" id="5011783">(</span><span class="op" id="5011784">)</span>&nbsp;<span class="op" id="5011786">&gt;</span>&nbsp;<span class="num" id="5011788">0</span>&nbsp;<span class="op" id="5011790">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011794">delta</span>&nbsp;<span class="op" id="5011800">:=</span>&nbsp;<span class="builtintype" id="5011803">int</span><span class="op" id="5011806">(</span><span class="ident" id="5011807">state</span><span class="op" id="5011812">.</span><span class="ident" id="5011813">decodeUint</span><span class="op" id="5011823">(</span><span class="op" id="5011824">)</span><span class="op" id="5011825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011829">if</span>&nbsp;<span class="ident" id="5011832">delta</span>&nbsp;<span class="op" id="5011838">&lt;</span>&nbsp;<span class="num" id="5011840">0</span>&nbsp;<span class="op" id="5011842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011847">errorf</span><span class="op" id="5011853">(</span><span class="string" id="5011854">&#34;ignore&nbsp;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="5011901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011909">if</span>&nbsp;<span class="ident" id="5011912">delta</span>&nbsp;<span class="op" id="5011918">==</span>&nbsp;<span class="num" id="5011921">0</span>&nbsp;<span class="op" id="5011923">{</span>&nbsp;<span class="comment" id="5011925">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011972">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011984">fieldnum</span>&nbsp;<span class="op" id="5011993">:=</span>&nbsp;<span class="ident" id="5011996">state</span><span class="op" id="5012001">.</span><span class="ident" id="5012002">fieldnum</span>&nbsp;<span class="op" id="5012011">+</span>&nbsp;<span class="ident" id="5012013">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012021">if</span>&nbsp;<span class="ident" id="5012024">fieldnum</span>&nbsp;<span class="op" id="5012033">&gt;=</span>&nbsp;<span class="builtinfunc" id="5012036">len</span><span class="op" id="5012039">(</span><span class="ident" id="5012040">engine</span><span class="op" id="5012046">.</span><span class="ident" id="5012047">instr</span><span class="op" id="5012052">)</span>&nbsp;<span class="op" id="5012054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012059">error_</span><span class="op" id="5012065">(</span><span class="ident" id="5012066">errRange</span><span class="op" id="5012074">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012082">instr</span>&nbsp;<span class="op" id="5012088">:=</span>&nbsp;<span class="op" id="5012091">&amp;</span><span class="ident" id="5012092">engine</span><span class="op" id="5012098">.</span><span class="ident" id="5012099">instr</span><span class="op" id="5012104">[</span><span class="ident" id="5012105">fieldnum</span><span class="op" id="5012113">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012117">instr</span><span class="op" id="5012122">.</span><span class="ident" id="5012123">op</span><span class="op" id="5012125">(</span><span class="ident" id="5012126">instr</span><span class="op" id="5012131">,</span>&nbsp;<span class="ident" id="5012133">state</span><span class="op" id="5012138">,</span>&nbsp;<span class="ident" id="5012140">noValue</span><span class="op" id="5012147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012151">state</span><span class="op" id="5012156">.</span><span class="ident" id="5012157">fieldnum</span>&nbsp;<span class="op" id="5012166">=</span>&nbsp;<span class="ident" id="5012168">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012178">}</span><br>
<span class="lineno">495</span><span class="op" id="5012180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5012183">//&nbsp;ignoreSingle&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;top-level&nbsp;non-struct&nbsp;value&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5012258">//&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;when&nbsp;calling&nbsp;Decode&nbsp;with&nbsp;a&nbsp;nil&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5012322">func</span>&nbsp;<span class="op" id="5012327">(</span><span class="ident" id="5012328">dec</span>&nbsp;<span class="op" id="5012332">*</span><span class="ident" id="5012333">Decoder</span><span class="op" id="5012340">)</span>&nbsp;<span class="ident" id="5012342">ignoreSingle</span><span class="op" id="5012354">(</span><span class="ident" id="5012355">engine</span>&nbsp;<span class="op" id="5012362">*</span><span class="ident" id="5012363">decEngine</span><span class="op" id="5012372">)</span>&nbsp;<span class="op" id="5012374">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012377">state</span>&nbsp;<span class="op" id="5012383">:=</span>&nbsp;<span class="ident" id="5012386">dec</span><span class="op" id="5012389">.</span><span class="ident" id="5012390">newDecoderState</span><span class="op" id="5012405">(</span><span class="op" id="5012406">&amp;</span><span class="ident" id="5012407">dec</span><span class="op" id="5012410">.</span><span class="ident" id="5012411">buf</span><span class="op" id="5012414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012417">defer</span>&nbsp;<span class="ident" id="5012423">dec</span><span class="op" id="5012426">.</span><span class="ident" id="5012427">freeDecoderState</span><span class="op" id="5012443">(</span><span class="ident" id="5012444">state</span><span class="op" id="5012449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012452">state</span><span class="op" id="5012457">.</span><span class="ident" id="5012458">fieldnum</span>&nbsp;<span class="op" id="5012467">=</span>&nbsp;<span class="ident" id="5012469">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012485">delta</span>&nbsp;<span class="op" id="5012491">:=</span>&nbsp;<span class="builtintype" id="5012494">int</span><span class="op" id="5012497">(</span><span class="ident" id="5012498">state</span><span class="op" id="5012503">.</span><span class="ident" id="5012504">decodeUint</span><span class="op" id="5012514">(</span><span class="op" id="5012515">)</span><span class="op" id="5012516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012519">if</span>&nbsp;<span class="ident" id="5012522">delta</span>&nbsp;<span class="op" id="5012528">!=</span>&nbsp;<span class="num" id="5012531">0</span>&nbsp;<span class="op" id="5012533">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012537">errorf</span><span class="op" id="5012543">(</span><span class="string" id="5012544">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="5012598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012604">instr</span>&nbsp;<span class="op" id="5012610">:=</span>&nbsp;<span class="op" id="5012613">&amp;</span><span class="ident" id="5012614">engine</span><span class="op" id="5012620">.</span><span class="ident" id="5012621">instr</span><span class="op" id="5012626">[</span><span class="ident" id="5012627">singletonField</span><span class="op" id="5012641">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012644">instr</span><span class="op" id="5012649">.</span><span class="ident" id="5012650">op</span><span class="op" id="5012652">(</span><span class="ident" id="5012653">instr</span><span class="op" id="5012658">,</span>&nbsp;<span class="ident" id="5012660">state</span><span class="op" id="5012665">,</span>&nbsp;<span class="ident" id="5012667">noValue</span><span class="op" id="5012674">)</span><br>
<span class="lineno"></span><span class="op" id="5012676">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="5012679">//&nbsp;decodeArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;decoding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="5012746">func</span>&nbsp;<span class="op" id="5012751">(</span><span class="ident" id="5012752">dec</span>&nbsp;<span class="op" id="5012756">*</span><span class="ident" id="5012757">Decoder</span><span class="op" id="5012764">)</span>&nbsp;<span class="ident" id="5012766">decodeArrayHelper</span><span class="op" id="5012783">(</span><span class="ident" id="5012784">state</span>&nbsp;<span class="op" id="5012790">*</span><span class="ident" id="5012791">decoderState</span><span class="op" id="5012803">,</span>&nbsp;<span class="ident" id="5012805">value</span>&nbsp;<span class="ident" id="5012811">reflect</span><span class="op" id="5012818">.</span><span class="ident" id="5012819">Value</span><span class="op" id="5012824">,</span>&nbsp;<span class="ident" id="5012826">elemOp</span>&nbsp;<span class="ident" id="5012833">decOp</span><span class="op" id="5012838">,</span>&nbsp;<span class="ident" id="5012840">length</span>&nbsp;<span class="builtintype" id="5012847">int</span><span class="op" id="5012850">,</span>&nbsp;<span class="ident" id="5012852">ovfl</span>&nbsp;<span class="builtintype" id="5012857">error</span><span class="op" id="5012862">,</span>&nbsp;<span class="ident" id="5012864">helper</span>&nbsp;<span class="ident" id="5012871">decHelper</span><span class="op" id="5012880">)</span>&nbsp;<span class="op" id="5012882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012885">if</span>&nbsp;<span class="ident" id="5012888">helper</span>&nbsp;<span class="op" id="5012895">!=</span>&nbsp;<span class="ident" id="5012898">nil</span>&nbsp;<span class="op" id="5012902">&amp;&amp;</span>&nbsp;<span class="ident" id="5012905">helper</span><span class="op" id="5012911">(</span><span class="ident" id="5012912">state</span><span class="op" id="5012917">,</span>&nbsp;<span class="ident" id="5012919">value</span><span class="op" id="5012924">,</span>&nbsp;<span class="ident" id="5012926">length</span><span class="op" id="5012932">,</span>&nbsp;<span class="ident" id="5012934">ovfl</span><span class="op" id="5012938">)</span>&nbsp;<span class="op" id="5012940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012944">return</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012955">instr</span>&nbsp;<span class="op" id="5012961">:=</span>&nbsp;<span class="op" id="5012964">&amp;</span><span class="ident" id="5012965">decInstr</span><span class="op" id="5012973">{</span><span class="ident" id="5012974">elemOp</span><span class="op" id="5012980">,</span>&nbsp;<span class="num" id="5012982">0</span><span class="op" id="5012983">,</span>&nbsp;<span class="ident" id="5012985">nil</span><span class="op" id="5012988">,</span>&nbsp;<span class="ident" id="5012990">ovfl</span><span class="op" id="5012994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012997">isPtr</span>&nbsp;<span class="op" id="5013003">:=</span>&nbsp;<span class="ident" id="5013006">value</span><span class="op" id="5013011">.</span><span class="ident" id="5013012">Type</span><span class="op" id="5013016">(</span><span class="op" id="5013017">)</span><span class="op" id="5013018">.</span><span class="ident" id="5013019">Elem</span><span class="op" id="5013023">(</span><span class="op" id="5013024">)</span><span class="op" id="5013025">.</span><span class="ident" id="5013026">Kind</span><span class="op" id="5013030">(</span><span class="op" id="5013031">)</span>&nbsp;<span class="op" id="5013033">==</span>&nbsp;<span class="ident" id="5013036">reflect</span><span class="op" id="5013043">.</span><span class="ident" id="5013044">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013049">for</span>&nbsp;<span class="ident" id="5013053">i</span>&nbsp;<span class="op" id="5013055">:=</span>&nbsp;<span class="num" id="5013058">0</span><span class="op" id="5013059">;</span>&nbsp;<span class="ident" id="5013061">i</span>&nbsp;<span class="op" id="5013063">&lt;</span>&nbsp;<span class="ident" id="5013065">length</span><span class="op" id="5013071">;</span>&nbsp;<span class="ident" id="5013073">i</span><span class="op" id="5013074">++</span>&nbsp;<span class="op" id="5013077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013081">if</span>&nbsp;<span class="ident" id="5013084">state</span><span class="op" id="5013089">.</span><span class="ident" id="5013090">b</span><span class="op" id="5013091">.</span><span class="ident" id="5013092">Len</span><span class="op" id="5013095">(</span><span class="op" id="5013096">)</span>&nbsp;<span class="op" id="5013098">==</span>&nbsp;<span class="num" id="5013101">0</span>&nbsp;<span class="op" id="5013103">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013108">errorf</span><span class="op" id="5013114">(</span><span class="string" id="5013115">&#34;decoding&nbsp;array&nbsp;or&nbsp;slice:&nbsp;length&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;elements)&#34;</span><span class="op" id="5013181">,</span>&nbsp;<span class="ident" id="5013183">length</span><span class="op" id="5013189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013197">v</span>&nbsp;<span class="op" id="5013199">:=</span>&nbsp;<span class="ident" id="5013202">value</span><span class="op" id="5013207">.</span><span class="ident" id="5013208">Index</span><span class="op" id="5013213">(</span><span class="ident" id="5013214">i</span><span class="op" id="5013215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013219">if</span>&nbsp;<span class="ident" id="5013222">isPtr</span>&nbsp;<span class="op" id="5013228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013233">v</span>&nbsp;<span class="op" id="5013235">=</span>&nbsp;<span class="ident" id="5013237">decAlloc</span><span class="op" id="5013245">(</span><span class="ident" id="5013246">v</span><span class="op" id="5013247">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013255">elemOp</span><span class="op" id="5013261">(</span><span class="ident" id="5013262">instr</span><span class="op" id="5013267">,</span>&nbsp;<span class="ident" id="5013269">state</span><span class="op" id="5013274">,</span>&nbsp;<span class="ident" id="5013276">v</span><span class="op" id="5013277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013280">}</span><br>
<span class="lineno"></span><span class="op" id="5013282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="5013285">//&nbsp;decodeArray&nbsp;decodes&nbsp;an&nbsp;array&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5013341">//&nbsp;The&nbsp;length&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;preceding&nbsp;the&nbsp;elements.&nbsp;&nbsp;Even&nbsp;though&nbsp;the&nbsp;length&nbsp;is&nbsp;redundant</span><br>
<span class="lineno"></span><span class="comment" id="5013439">//&nbsp;(it&#39;s&nbsp;part&nbsp;of&nbsp;the&nbsp;type),&nbsp;it&#39;s&nbsp;a&nbsp;useful&nbsp;check&nbsp;and&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5013520">func</span>&nbsp;<span class="op" id="5013525">(</span><span class="ident" id="5013526">dec</span>&nbsp;<span class="op" id="5013530">*</span><span class="ident" id="5013531">Decoder</span><span class="op" id="5013538">)</span>&nbsp;<span class="ident" id="5013540">decodeArray</span><span class="op" id="5013551">(</span><span class="ident" id="5013552">atyp</span>&nbsp;<span class="ident" id="5013557">reflect</span><span class="op" id="5013564">.</span><span class="ident" id="5013565">Type</span><span class="op" id="5013569">,</span>&nbsp;<span class="ident" id="5013571">state</span>&nbsp;<span class="op" id="5013577">*</span><span class="ident" id="5013578">decoderState</span><span class="op" id="5013590">,</span>&nbsp;<span class="ident" id="5013592">value</span>&nbsp;<span class="ident" id="5013598">reflect</span><span class="op" id="5013605">.</span><span class="ident" id="5013606">Value</span><span class="op" id="5013611">,</span>&nbsp;<span class="ident" id="5013613">elemOp</span>&nbsp;<span class="ident" id="5013620">decOp</span><span class="op" id="5013625">,</span>&nbsp;<span class="ident" id="5013627">length</span>&nbsp;<span class="builtintype" id="5013634">int</span><span class="op" id="5013637">,</span>&nbsp;<span class="ident" id="5013639">ovfl</span>&nbsp;<span class="builtintype" id="5013644">error</span><span class="op" id="5013649">,</span>&nbsp;<span class="ident" id="5013651">helper</span>&nbsp;<span class="ident" id="5013658">decHelper</span><span class="op" id="5013667">)</span>&nbsp;<span class="op" id="5013669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013672">if</span>&nbsp;<span class="ident" id="5013675">n</span>&nbsp;<span class="op" id="5013677">:=</span>&nbsp;<span class="ident" id="5013680">state</span><span class="op" id="5013685">.</span><span class="ident" id="5013686">decodeUint</span><span class="op" id="5013696">(</span><span class="op" id="5013697">)</span><span class="op" id="5013698">;</span>&nbsp;<span class="ident" id="5013700">n</span>&nbsp;<span class="op" id="5013702">!=</span>&nbsp;<span class="ident" id="5013705">uint64</span><span class="op" id="5013711">(</span><span class="ident" id="5013712">length</span><span class="op" id="5013718">)</span>&nbsp;<span class="op" id="5013720">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013724">errorf</span><span class="op" id="5013730">(</span><span class="string" id="5013731">&#34;length&nbsp;mismatch&nbsp;in&nbsp;decodeArray&#34;</span><span class="op" id="5013763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013769">dec</span><span class="op" id="5013772">.</span><span class="ident" id="5013773">decodeArrayHelper</span><span class="op" id="5013790">(</span><span class="ident" id="5013791">state</span><span class="op" id="5013796">,</span>&nbsp;<span class="ident" id="5013798">value</span><span class="op" id="5013803">,</span>&nbsp;<span class="ident" id="5013805">elemOp</span><span class="op" id="5013811">,</span>&nbsp;<span class="ident" id="5013813">length</span><span class="op" id="5013819">,</span>&nbsp;<span class="ident" id="5013821">ovfl</span><span class="op" id="5013825">,</span>&nbsp;<span class="ident" id="5013827">helper</span><span class="op" id="5013833">)</span><br>
<span class="lineno"></span><span class="op" id="5013835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="5013838">//&nbsp;decodeIntoValue&nbsp;is&nbsp;a&nbsp;helper&nbsp;for&nbsp;map&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5013887">func</span>&nbsp;<span class="ident" id="5013892">decodeIntoValue</span><span class="op" id="5013907">(</span><span class="ident" id="5013908">state</span>&nbsp;<span class="op" id="5013914">*</span><span class="ident" id="5013915">decoderState</span><span class="op" id="5013927">,</span>&nbsp;<span class="ident" id="5013929">op</span>&nbsp;<span class="ident" id="5013932">decOp</span><span class="op" id="5013937">,</span>&nbsp;<span class="ident" id="5013939">isPtr</span>&nbsp;<span class="builtintype" id="5013945">bool</span><span class="op" id="5013949">,</span>&nbsp;<span class="ident" id="5013951">value</span>&nbsp;<span class="ident" id="5013957">reflect</span><span class="op" id="5013964">.</span><span class="ident" id="5013965">Value</span><span class="op" id="5013970">,</span>&nbsp;<span class="ident" id="5013972">ovfl</span>&nbsp;<span class="builtintype" id="5013977">error</span><span class="op" id="5013982">)</span>&nbsp;<span class="ident" id="5013984">reflect</span><span class="op" id="5013991">.</span><span class="ident" id="5013992">Value</span>&nbsp;<span class="op" id="5013998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014001">instr</span>&nbsp;<span class="op" id="5014007">:=</span>&nbsp;<span class="op" id="5014010">&amp;</span><span class="ident" id="5014011">decInstr</span><span class="op" id="5014019">{</span><span class="ident" id="5014020">op</span><span class="op" id="5014022">,</span>&nbsp;<span class="num" id="5014024">0</span><span class="op" id="5014025">,</span>&nbsp;<span class="ident" id="5014027">nil</span><span class="op" id="5014030">,</span>&nbsp;<span class="ident" id="5014032">ovfl</span><span class="op" id="5014036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014039">v</span>&nbsp;<span class="op" id="5014041">:=</span>&nbsp;<span class="ident" id="5014044">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014051">if</span>&nbsp;<span class="ident" id="5014054">isPtr</span>&nbsp;<span class="op" id="5014060">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014064">v</span>&nbsp;<span class="op" id="5014066">=</span>&nbsp;<span class="ident" id="5014068">decAlloc</span><span class="op" id="5014076">(</span><span class="ident" id="5014077">value</span><span class="op" id="5014082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014088">op</span><span class="op" id="5014090">(</span><span class="ident" id="5014091">instr</span><span class="op" id="5014096">,</span>&nbsp;<span class="ident" id="5014098">state</span><span class="op" id="5014103">,</span>&nbsp;<span class="ident" id="5014105">v</span><span class="op" id="5014106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014109">return</span>&nbsp;<span class="ident" id="5014116">value</span><br>
<span class="lineno"></span><span class="op" id="5014122">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="5014125">//&nbsp;decodeMap&nbsp;decodes&nbsp;a&nbsp;map&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5014176">//&nbsp;Maps&nbsp;are&nbsp;encoded&nbsp;as&nbsp;a&nbsp;length&nbsp;followed&nbsp;by&nbsp;key:value&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="5014237">//&nbsp;Because&nbsp;the&nbsp;internals&nbsp;of&nbsp;maps&nbsp;are&nbsp;not&nbsp;visible&nbsp;to&nbsp;us,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5014301">//&nbsp;use&nbsp;reflection&nbsp;rather&nbsp;than&nbsp;pointer&nbsp;magic.</span><br>
<span class="lineno">555</span><span class="keyword" id="5014346">func</span>&nbsp;<span class="op" id="5014351">(</span><span class="ident" id="5014352">dec</span>&nbsp;<span class="op" id="5014356">*</span><span class="ident" id="5014357">Decoder</span><span class="op" id="5014364">)</span>&nbsp;<span class="ident" id="5014366">decodeMap</span><span class="op" id="5014375">(</span><span class="ident" id="5014376">mtyp</span>&nbsp;<span class="ident" id="5014381">reflect</span><span class="op" id="5014388">.</span><span class="ident" id="5014389">Type</span><span class="op" id="5014393">,</span>&nbsp;<span class="ident" id="5014395">state</span>&nbsp;<span class="op" id="5014401">*</span><span class="ident" id="5014402">decoderState</span><span class="op" id="5014414">,</span>&nbsp;<span class="ident" id="5014416">value</span>&nbsp;<span class="ident" id="5014422">reflect</span><span class="op" id="5014429">.</span><span class="ident" id="5014430">Value</span><span class="op" id="5014435">,</span>&nbsp;<span class="ident" id="5014437">keyOp</span><span class="op" id="5014442">,</span>&nbsp;<span class="ident" id="5014444">elemOp</span>&nbsp;<span class="ident" id="5014451">decOp</span><span class="op" id="5014456">,</span>&nbsp;<span class="ident" id="5014458">ovfl</span>&nbsp;<span class="builtintype" id="5014463">error</span><span class="op" id="5014468">)</span>&nbsp;<span class="op" id="5014470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014473">if</span>&nbsp;<span class="ident" id="5014476">value</span><span class="op" id="5014481">.</span><span class="ident" id="5014482">IsNil</span><span class="op" id="5014487">(</span><span class="op" id="5014488">)</span>&nbsp;<span class="op" id="5014490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014494">//&nbsp;Allocate&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014513">value</span><span class="op" id="5014518">.</span><span class="ident" id="5014519">Set</span><span class="op" id="5014522">(</span><span class="ident" id="5014523">reflect</span><span class="op" id="5014530">.</span><span class="ident" id="5014531">MakeMap</span><span class="op" id="5014538">(</span><span class="ident" id="5014539">mtyp</span><span class="op" id="5014543">)</span><span class="op" id="5014544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014547">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014550">n</span>&nbsp;<span class="op" id="5014552">:=</span>&nbsp;<span class="builtintype" id="5014555">int</span><span class="op" id="5014558">(</span><span class="ident" id="5014559">state</span><span class="op" id="5014564">.</span><span class="ident" id="5014565">decodeUint</span><span class="op" id="5014575">(</span><span class="op" id="5014576">)</span><span class="op" id="5014577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014580">keyIsPtr</span>&nbsp;<span class="op" id="5014589">:=</span>&nbsp;<span class="ident" id="5014592">mtyp</span><span class="op" id="5014596">.</span><span class="ident" id="5014597">Key</span><span class="op" id="5014600">(</span><span class="op" id="5014601">)</span><span class="op" id="5014602">.</span><span class="ident" id="5014603">Kind</span><span class="op" id="5014607">(</span><span class="op" id="5014608">)</span>&nbsp;<span class="op" id="5014610">==</span>&nbsp;<span class="ident" id="5014613">reflect</span><span class="op" id="5014620">.</span><span class="ident" id="5014621">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014626">elemIsPtr</span>&nbsp;<span class="op" id="5014636">:=</span>&nbsp;<span class="ident" id="5014639">mtyp</span><span class="op" id="5014643">.</span><span class="ident" id="5014644">Elem</span><span class="op" id="5014648">(</span><span class="op" id="5014649">)</span><span class="op" id="5014650">.</span><span class="ident" id="5014651">Kind</span><span class="op" id="5014655">(</span><span class="op" id="5014656">)</span>&nbsp;<span class="op" id="5014658">==</span>&nbsp;<span class="ident" id="5014661">reflect</span><span class="op" id="5014668">.</span><span class="ident" id="5014669">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014674">for</span>&nbsp;<span class="ident" id="5014678">i</span>&nbsp;<span class="op" id="5014680">:=</span>&nbsp;<span class="num" id="5014683">0</span><span class="op" id="5014684">;</span>&nbsp;<span class="ident" id="5014686">i</span>&nbsp;<span class="op" id="5014688">&lt;</span>&nbsp;<span class="ident" id="5014690">n</span><span class="op" id="5014691">;</span>&nbsp;<span class="ident" id="5014693">i</span><span class="op" id="5014694">++</span>&nbsp;<span class="op" id="5014697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014701">key</span>&nbsp;<span class="op" id="5014705">:=</span>&nbsp;<span class="ident" id="5014708">decodeIntoValue</span><span class="op" id="5014723">(</span><span class="ident" id="5014724">state</span><span class="op" id="5014729">,</span>&nbsp;<span class="ident" id="5014731">keyOp</span><span class="op" id="5014736">,</span>&nbsp;<span class="ident" id="5014738">keyIsPtr</span><span class="op" id="5014746">,</span>&nbsp;<span class="ident" id="5014748">allocValue</span><span class="op" id="5014758">(</span><span class="ident" id="5014759">mtyp</span><span class="op" id="5014763">.</span><span class="ident" id="5014764">Key</span><span class="op" id="5014767">(</span><span class="op" id="5014768">)</span><span class="op" id="5014769">)</span><span class="op" id="5014770">,</span>&nbsp;<span class="ident" id="5014772">ovfl</span><span class="op" id="5014776">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014780">elem</span>&nbsp;<span class="op" id="5014785">:=</span>&nbsp;<span class="ident" id="5014788">decodeIntoValue</span><span class="op" id="5014803">(</span><span class="ident" id="5014804">state</span><span class="op" id="5014809">,</span>&nbsp;<span class="ident" id="5014811">elemOp</span><span class="op" id="5014817">,</span>&nbsp;<span class="ident" id="5014819">elemIsPtr</span><span class="op" id="5014828">,</span>&nbsp;<span class="ident" id="5014830">allocValue</span><span class="op" id="5014840">(</span><span class="ident" id="5014841">mtyp</span><span class="op" id="5014845">.</span><span class="ident" id="5014846">Elem</span><span class="op" id="5014850">(</span><span class="op" id="5014851">)</span><span class="op" id="5014852">)</span><span class="op" id="5014853">,</span>&nbsp;<span class="ident" id="5014855">ovfl</span><span class="op" id="5014859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014863">value</span><span class="op" id="5014868">.</span><span class="ident" id="5014869">SetMapIndex</span><span class="op" id="5014880">(</span><span class="ident" id="5014881">key</span><span class="op" id="5014884">,</span>&nbsp;<span class="ident" id="5014886">elem</span><span class="op" id="5014890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014893">}</span><br>
<span class="lineno"></span><span class="op" id="5014895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="5014898">//&nbsp;ignoreArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;discarding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="5014967">func</span>&nbsp;<span class="op" id="5014972">(</span><span class="ident" id="5014973">dec</span>&nbsp;<span class="op" id="5014977">*</span><span class="ident" id="5014978">Decoder</span><span class="op" id="5014985">)</span>&nbsp;<span class="ident" id="5014987">ignoreArrayHelper</span><span class="op" id="5015004">(</span><span class="ident" id="5015005">state</span>&nbsp;<span class="op" id="5015011">*</span><span class="ident" id="5015012">decoderState</span><span class="op" id="5015024">,</span>&nbsp;<span class="ident" id="5015026">elemOp</span>&nbsp;<span class="ident" id="5015033">decOp</span><span class="op" id="5015038">,</span>&nbsp;<span class="ident" id="5015040">length</span>&nbsp;<span class="builtintype" id="5015047">int</span><span class="op" id="5015050">)</span>&nbsp;<span class="op" id="5015052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015055">instr</span>&nbsp;<span class="op" id="5015061">:=</span>&nbsp;<span class="op" id="5015064">&amp;</span><span class="ident" id="5015065">decInstr</span><span class="op" id="5015073">{</span><span class="ident" id="5015074">elemOp</span><span class="op" id="5015080">,</span>&nbsp;<span class="num" id="5015082">0</span><span class="op" id="5015083">,</span>&nbsp;<span class="ident" id="5015085">nil</span><span class="op" id="5015088">,</span>&nbsp;<span class="ident" id="5015090">errors</span><span class="op" id="5015096">.</span><span class="ident" id="5015097">New</span><span class="op" id="5015100">(</span><span class="string" id="5015101">&#34;no&nbsp;error&#34;</span><span class="op" id="5015111">)</span><span class="op" id="5015112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015115">for</span>&nbsp;<span class="ident" id="5015119">i</span>&nbsp;<span class="op" id="5015121">:=</span>&nbsp;<span class="num" id="5015124">0</span><span class="op" id="5015125">;</span>&nbsp;<span class="ident" id="5015127">i</span>&nbsp;<span class="op" id="5015129">&lt;</span>&nbsp;<span class="ident" id="5015131">length</span><span class="op" id="5015137">;</span>&nbsp;<span class="ident" id="5015139">i</span><span class="op" id="5015140">++</span>&nbsp;<span class="op" id="5015143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015147">elemOp</span><span class="op" id="5015153">(</span><span class="ident" id="5015154">instr</span><span class="op" id="5015159">,</span>&nbsp;<span class="ident" id="5015161">state</span><span class="op" id="5015166">,</span>&nbsp;<span class="ident" id="5015168">noValue</span><span class="op" id="5015175">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015178">}</span><br>
<span class="lineno"></span><span class="op" id="5015180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5015183">//&nbsp;ignoreArray&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;array&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5015256">func</span>&nbsp;<span class="op" id="5015261">(</span><span class="ident" id="5015262">dec</span>&nbsp;<span class="op" id="5015266">*</span><span class="ident" id="5015267">Decoder</span><span class="op" id="5015274">)</span>&nbsp;<span class="ident" id="5015276">ignoreArray</span><span class="op" id="5015287">(</span><span class="ident" id="5015288">state</span>&nbsp;<span class="op" id="5015294">*</span><span class="ident" id="5015295">decoderState</span><span class="op" id="5015307">,</span>&nbsp;<span class="ident" id="5015309">elemOp</span>&nbsp;<span class="ident" id="5015316">decOp</span><span class="op" id="5015321">,</span>&nbsp;<span class="ident" id="5015323">length</span>&nbsp;<span class="builtintype" id="5015330">int</span><span class="op" id="5015333">)</span>&nbsp;<span class="op" id="5015335">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015338">if</span>&nbsp;<span class="ident" id="5015341">n</span>&nbsp;<span class="op" id="5015343">:=</span>&nbsp;<span class="ident" id="5015346">state</span><span class="op" id="5015351">.</span><span class="ident" id="5015352">decodeUint</span><span class="op" id="5015362">(</span><span class="op" id="5015363">)</span><span class="op" id="5015364">;</span>&nbsp;<span class="ident" id="5015366">n</span>&nbsp;<span class="op" id="5015368">!=</span>&nbsp;<span class="ident" id="5015371">uint64</span><span class="op" id="5015377">(</span><span class="ident" id="5015378">length</span><span class="op" id="5015384">)</span>&nbsp;<span class="op" id="5015386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015390">errorf</span><span class="op" id="5015396">(</span><span class="string" id="5015397">&#34;length&nbsp;mismatch&nbsp;in&nbsp;ignoreArray&#34;</span><span class="op" id="5015429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015435">dec</span><span class="op" id="5015438">.</span><span class="ident" id="5015439">ignoreArrayHelper</span><span class="op" id="5015456">(</span><span class="ident" id="5015457">state</span><span class="op" id="5015462">,</span>&nbsp;<span class="ident" id="5015464">elemOp</span><span class="op" id="5015470">,</span>&nbsp;<span class="ident" id="5015472">length</span><span class="op" id="5015478">)</span><br>
<span class="lineno"></span><span class="op" id="5015480">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="comment" id="5015483">//&nbsp;ignoreMap&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;map&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5015551">func</span>&nbsp;<span class="op" id="5015556">(</span><span class="ident" id="5015557">dec</span>&nbsp;<span class="op" id="5015561">*</span><span class="ident" id="5015562">Decoder</span><span class="op" id="5015569">)</span>&nbsp;<span class="ident" id="5015571">ignoreMap</span><span class="op" id="5015580">(</span><span class="ident" id="5015581">state</span>&nbsp;<span class="op" id="5015587">*</span><span class="ident" id="5015588">decoderState</span><span class="op" id="5015600">,</span>&nbsp;<span class="ident" id="5015602">keyOp</span><span class="op" id="5015607">,</span>&nbsp;<span class="ident" id="5015609">elemOp</span>&nbsp;<span class="ident" id="5015616">decOp</span><span class="op" id="5015621">)</span>&nbsp;<span class="op" id="5015623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015626">n</span>&nbsp;<span class="op" id="5015628">:=</span>&nbsp;<span class="builtintype" id="5015631">int</span><span class="op" id="5015634">(</span><span class="ident" id="5015635">state</span><span class="op" id="5015640">.</span><span class="ident" id="5015641">decodeUint</span><span class="op" id="5015651">(</span><span class="op" id="5015652">)</span><span class="op" id="5015653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015656">keyInstr</span>&nbsp;<span class="op" id="5015665">:=</span>&nbsp;<span class="op" id="5015668">&amp;</span><span class="ident" id="5015669">decInstr</span><span class="op" id="5015677">{</span><span class="ident" id="5015678">keyOp</span><span class="op" id="5015683">,</span>&nbsp;<span class="num" id="5015685">0</span><span class="op" id="5015686">,</span>&nbsp;<span class="ident" id="5015688">nil</span><span class="op" id="5015691">,</span>&nbsp;<span class="ident" id="5015693">errors</span><span class="op" id="5015699">.</span><span class="ident" id="5015700">New</span><span class="op" id="5015703">(</span><span class="string" id="5015704">&#34;no&nbsp;error&#34;</span><span class="op" id="5015714">)</span><span class="op" id="5015715">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015718">elemInstr</span>&nbsp;<span class="op" id="5015728">:=</span>&nbsp;<span class="op" id="5015731">&amp;</span><span class="ident" id="5015732">decInstr</span><span class="op" id="5015740">{</span><span class="ident" id="5015741">elemOp</span><span class="op" id="5015747">,</span>&nbsp;<span class="num" id="5015749">0</span><span class="op" id="5015750">,</span>&nbsp;<span class="ident" id="5015752">nil</span><span class="op" id="5015755">,</span>&nbsp;<span class="ident" id="5015757">errors</span><span class="op" id="5015763">.</span><span class="ident" id="5015764">New</span><span class="op" id="5015767">(</span><span class="string" id="5015768">&#34;no&nbsp;error&#34;</span><span class="op" id="5015778">)</span><span class="op" id="5015779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015782">for</span>&nbsp;<span class="ident" id="5015786">i</span>&nbsp;<span class="op" id="5015788">:=</span>&nbsp;<span class="num" id="5015791">0</span><span class="op" id="5015792">;</span>&nbsp;<span class="ident" id="5015794">i</span>&nbsp;<span class="op" id="5015796">&lt;</span>&nbsp;<span class="ident" id="5015798">n</span><span class="op" id="5015799">;</span>&nbsp;<span class="ident" id="5015801">i</span><span class="op" id="5015802">++</span>&nbsp;<span class="op" id="5015805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015809">keyOp</span><span class="op" id="5015814">(</span><span class="ident" id="5015815">keyInstr</span><span class="op" id="5015823">,</span>&nbsp;<span class="ident" id="5015825">state</span><span class="op" id="5015830">,</span>&nbsp;<span class="ident" id="5015832">noValue</span><span class="op" id="5015839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015843">elemOp</span><span class="op" id="5015849">(</span><span class="ident" id="5015850">elemInstr</span><span class="op" id="5015859">,</span>&nbsp;<span class="ident" id="5015861">state</span><span class="op" id="5015866">,</span>&nbsp;<span class="ident" id="5015868">noValue</span><span class="op" id="5015875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015878">}</span><br>
<span class="lineno">595</span><span class="op" id="5015880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5015883">//&nbsp;decodeSlice&nbsp;decodes&nbsp;a&nbsp;slice&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5015938">//&nbsp;Slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;length&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="5016008">func</span>&nbsp;<span class="op" id="5016013">(</span><span class="ident" id="5016014">dec</span>&nbsp;<span class="op" id="5016018">*</span><span class="ident" id="5016019">Decoder</span><span class="op" id="5016026">)</span>&nbsp;<span class="ident" id="5016028">decodeSlice</span><span class="op" id="5016039">(</span><span class="ident" id="5016040">state</span>&nbsp;<span class="op" id="5016046">*</span><span class="ident" id="5016047">decoderState</span><span class="op" id="5016059">,</span>&nbsp;<span class="ident" id="5016061">value</span>&nbsp;<span class="ident" id="5016067">reflect</span><span class="op" id="5016074">.</span><span class="ident" id="5016075">Value</span><span class="op" id="5016080">,</span>&nbsp;<span class="ident" id="5016082">elemOp</span>&nbsp;<span class="ident" id="5016089">decOp</span><span class="op" id="5016094">,</span>&nbsp;<span class="ident" id="5016096">ovfl</span>&nbsp;<span class="builtintype" id="5016101">error</span><span class="op" id="5016106">,</span>&nbsp;<span class="ident" id="5016108">helper</span>&nbsp;<span class="ident" id="5016115">decHelper</span><span class="op" id="5016124">)</span>&nbsp;<span class="op" id="5016126">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016129">u</span>&nbsp;<span class="op" id="5016131">:=</span>&nbsp;<span class="ident" id="5016134">state</span><span class="op" id="5016139">.</span><span class="ident" id="5016140">decodeUint</span><span class="op" id="5016150">(</span><span class="op" id="5016151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016154">typ</span>&nbsp;<span class="op" id="5016158">:=</span>&nbsp;<span class="ident" id="5016161">value</span><span class="op" id="5016166">.</span><span class="ident" id="5016167">Type</span><span class="op" id="5016171">(</span><span class="op" id="5016172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016175">size</span>&nbsp;<span class="op" id="5016180">:=</span>&nbsp;<span class="ident" id="5016183">uint64</span><span class="op" id="5016189">(</span><span class="ident" id="5016190">typ</span><span class="op" id="5016193">.</span><span class="ident" id="5016194">Elem</span><span class="op" id="5016198">(</span><span class="op" id="5016199">)</span><span class="op" id="5016200">.</span><span class="ident" id="5016201">Size</span><span class="op" id="5016205">(</span><span class="op" id="5016206">)</span><span class="op" id="5016207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016210">nBytes</span>&nbsp;<span class="op" id="5016217">:=</span>&nbsp;<span class="ident" id="5016220">u</span>&nbsp;<span class="op" id="5016222">*</span>&nbsp;<span class="ident" id="5016224">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016230">n</span>&nbsp;<span class="op" id="5016232">:=</span>&nbsp;<span class="builtintype" id="5016235">int</span><span class="op" id="5016238">(</span><span class="ident" id="5016239">u</span><span class="op" id="5016240">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016243">//&nbsp;Take&nbsp;care&nbsp;with&nbsp;overflow&nbsp;in&nbsp;this&nbsp;calculation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016292">if</span>&nbsp;<span class="ident" id="5016295">n</span>&nbsp;<span class="op" id="5016297">&lt;</span>&nbsp;<span class="num" id="5016299">0</span>&nbsp;<span class="op" id="5016301">||</span>&nbsp;<span class="ident" id="5016304">uint64</span><span class="op" id="5016310">(</span><span class="ident" id="5016311">n</span><span class="op" id="5016312">)</span>&nbsp;<span class="op" id="5016314">!=</span>&nbsp;<span class="ident" id="5016317">u</span>&nbsp;<span class="op" id="5016319">||</span>&nbsp;<span class="ident" id="5016322">nBytes</span>&nbsp;<span class="op" id="5016329">&gt;</span>&nbsp;<span class="ident" id="5016331">tooBig</span>&nbsp;<span class="op" id="5016338">||</span>&nbsp;<span class="op" id="5016341">(</span><span class="ident" id="5016342">size</span>&nbsp;<span class="op" id="5016347">&gt;</span>&nbsp;<span class="num" id="5016349">0</span>&nbsp;<span class="op" id="5016351">&amp;&amp;</span>&nbsp;<span class="ident" id="5016354">nBytes</span><span class="op" id="5016360">/</span><span class="ident" id="5016361">size</span>&nbsp;<span class="op" id="5016366">!=</span>&nbsp;<span class="ident" id="5016369">u</span><span class="op" id="5016370">)</span>&nbsp;<span class="op" id="5016372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016376">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;n&nbsp;against&nbsp;buffer&nbsp;length&nbsp;here&nbsp;because&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016449">//&nbsp;of&nbsp;interfaces,&nbsp;there&nbsp;will&nbsp;be&nbsp;buffer&nbsp;reloads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016499">errorf</span><span class="op" id="5016505">(</span><span class="string" id="5016506">&#34;%s&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&nbsp;elements&nbsp;of&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="5016549">,</span>&nbsp;<span class="ident" id="5016551">typ</span><span class="op" id="5016554">.</span><span class="ident" id="5016555">Elem</span><span class="op" id="5016559">(</span><span class="op" id="5016560">)</span><span class="op" id="5016561">,</span>&nbsp;<span class="ident" id="5016563">u</span><span class="op" id="5016564">,</span>&nbsp;<span class="ident" id="5016566">size</span><span class="op" id="5016570">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016576">if</span>&nbsp;<span class="ident" id="5016579">value</span><span class="op" id="5016584">.</span><span class="ident" id="5016585">Cap</span><span class="op" id="5016588">(</span><span class="op" id="5016589">)</span>&nbsp;<span class="op" id="5016591">&lt;</span>&nbsp;<span class="ident" id="5016593">n</span>&nbsp;<span class="op" id="5016595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016599">value</span><span class="op" id="5016604">.</span><span class="ident" id="5016605">Set</span><span class="op" id="5016608">(</span><span class="ident" id="5016609">reflect</span><span class="op" id="5016616">.</span><span class="ident" id="5016617">MakeSlice</span><span class="op" id="5016626">(</span><span class="ident" id="5016627">typ</span><span class="op" id="5016630">,</span>&nbsp;<span class="ident" id="5016632">n</span><span class="op" id="5016633">,</span>&nbsp;<span class="ident" id="5016635">n</span><span class="op" id="5016636">)</span><span class="op" id="5016637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016640">}</span>&nbsp;<span class="keyword" id="5016642">else</span>&nbsp;<span class="op" id="5016647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016651">value</span><span class="op" id="5016656">.</span><span class="ident" id="5016657">Set</span><span class="op" id="5016660">(</span><span class="ident" id="5016661">value</span><span class="op" id="5016666">.</span><span class="ident" id="5016667">Slice</span><span class="op" id="5016672">(</span><span class="num" id="5016673">0</span><span class="op" id="5016674">,</span>&nbsp;<span class="ident" id="5016676">n</span><span class="op" id="5016677">)</span><span class="op" id="5016678">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016684">dec</span><span class="op" id="5016687">.</span><span class="ident" id="5016688">decodeArrayHelper</span><span class="op" id="5016705">(</span><span class="ident" id="5016706">state</span><span class="op" id="5016711">,</span>&nbsp;<span class="ident" id="5016713">value</span><span class="op" id="5016718">,</span>&nbsp;<span class="ident" id="5016720">elemOp</span><span class="op" id="5016726">,</span>&nbsp;<span class="ident" id="5016728">n</span><span class="op" id="5016729">,</span>&nbsp;<span class="ident" id="5016731">ovfl</span><span class="op" id="5016735">,</span>&nbsp;<span class="ident" id="5016737">helper</span><span class="op" id="5016743">)</span><br>
<span class="lineno"></span><span class="op" id="5016745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5016748">//&nbsp;ignoreSlice&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">620</span><span class="keyword" id="5016822">func</span>&nbsp;<span class="op" id="5016827">(</span><span class="ident" id="5016828">dec</span>&nbsp;<span class="op" id="5016832">*</span><span class="ident" id="5016833">Decoder</span><span class="op" id="5016840">)</span>&nbsp;<span class="ident" id="5016842">ignoreSlice</span><span class="op" id="5016853">(</span><span class="ident" id="5016854">state</span>&nbsp;<span class="op" id="5016860">*</span><span class="ident" id="5016861">decoderState</span><span class="op" id="5016873">,</span>&nbsp;<span class="ident" id="5016875">elemOp</span>&nbsp;<span class="ident" id="5016882">decOp</span><span class="op" id="5016887">)</span>&nbsp;<span class="op" id="5016889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016892">dec</span><span class="op" id="5016895">.</span><span class="ident" id="5016896">ignoreArrayHelper</span><span class="op" id="5016913">(</span><span class="ident" id="5016914">state</span><span class="op" id="5016919">,</span>&nbsp;<span class="ident" id="5016921">elemOp</span><span class="op" id="5016927">,</span>&nbsp;<span class="builtintype" id="5016929">int</span><span class="op" id="5016932">(</span><span class="ident" id="5016933">state</span><span class="op" id="5016938">.</span><span class="ident" id="5016939">decodeUint</span><span class="op" id="5016949">(</span><span class="op" id="5016950">)</span><span class="op" id="5016951">)</span><span class="op" id="5016952">)</span><br>
<span class="lineno"></span><span class="op" id="5016954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5016957">//&nbsp;decodeInterface&nbsp;decodes&nbsp;an&nbsp;interface&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">625</span><span class="comment" id="5017027">//&nbsp;Interfaces&nbsp;are&nbsp;encoded&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;concrete&nbsp;type&nbsp;followed&nbsp;by&nbsp;a&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5017105">//&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;empty,&nbsp;the&nbsp;value&nbsp;is&nbsp;nil&nbsp;and&nbsp;no&nbsp;value&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="5017169">func</span>&nbsp;<span class="op" id="5017174">(</span><span class="ident" id="5017175">dec</span>&nbsp;<span class="op" id="5017179">*</span><span class="ident" id="5017180">Decoder</span><span class="op" id="5017187">)</span>&nbsp;<span class="ident" id="5017189">decodeInterface</span><span class="op" id="5017204">(</span><span class="ident" id="5017205">ityp</span>&nbsp;<span class="ident" id="5017210">reflect</span><span class="op" id="5017217">.</span><span class="ident" id="5017218">Type</span><span class="op" id="5017222">,</span>&nbsp;<span class="ident" id="5017224">state</span>&nbsp;<span class="op" id="5017230">*</span><span class="ident" id="5017231">decoderState</span><span class="op" id="5017243">,</span>&nbsp;<span class="ident" id="5017245">value</span>&nbsp;<span class="ident" id="5017251">reflect</span><span class="op" id="5017258">.</span><span class="ident" id="5017259">Value</span><span class="op" id="5017264">)</span>&nbsp;<span class="op" id="5017266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017269">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017309">nr</span>&nbsp;<span class="op" id="5017312">:=</span>&nbsp;<span class="ident" id="5017315">state</span><span class="op" id="5017320">.</span><span class="ident" id="5017321">decodeUint</span><span class="op" id="5017331">(</span><span class="op" id="5017332">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017335">if</span>&nbsp;<span class="ident" id="5017338">nr</span>&nbsp;<span class="op" id="5017341">&lt;</span>&nbsp;<span class="num" id="5017343">0</span>&nbsp;<span class="op" id="5017345">||</span>&nbsp;<span class="ident" id="5017348">nr</span>&nbsp;<span class="op" id="5017351">&gt;</span>&nbsp;<span class="num" id="5017353">1</span><span class="op" id="5017354">&lt;&lt;</span><span class="num" id="5017356">31</span>&nbsp;<span class="op" id="5017359">{</span>&nbsp;<span class="comment" id="5017361">//&nbsp;zero&nbsp;is&nbsp;permissible&nbsp;for&nbsp;anonymous&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017406">errorf</span><span class="op" id="5017412">(</span><span class="string" id="5017413">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d&#34;</span><span class="op" id="5017442">,</span>&nbsp;<span class="ident" id="5017444">nr</span><span class="op" id="5017446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017452">if</span>&nbsp;<span class="ident" id="5017455">nr</span>&nbsp;<span class="op" id="5017458">&gt;</span>&nbsp;<span class="ident" id="5017460">uint64</span><span class="op" id="5017466">(</span><span class="ident" id="5017467">state</span><span class="op" id="5017472">.</span><span class="ident" id="5017473">b</span><span class="op" id="5017474">.</span><span class="ident" id="5017475">Len</span><span class="op" id="5017478">(</span><span class="op" id="5017479">)</span><span class="op" id="5017480">)</span>&nbsp;<span class="op" id="5017482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017486">errorf</span><span class="op" id="5017492">(</span><span class="string" id="5017493">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d:&nbsp;exceeds&nbsp;input&nbsp;size&#34;</span><span class="op" id="5017542">,</span>&nbsp;<span class="ident" id="5017544">nr</span><span class="op" id="5017546">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017552">b</span>&nbsp;<span class="op" id="5017554">:=</span>&nbsp;<span class="builtinfunc" id="5017557">make</span><span class="op" id="5017561">(</span><span class="op" id="5017562">[</span><span class="op" id="5017563">]</span><span class="builtintype" id="5017564">byte</span><span class="op" id="5017568">,</span>&nbsp;<span class="ident" id="5017570">nr</span><span class="op" id="5017572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017575">state</span><span class="op" id="5017580">.</span><span class="ident" id="5017581">b</span><span class="op" id="5017582">.</span><span class="ident" id="5017583">Read</span><span class="op" id="5017587">(</span><span class="ident" id="5017588">b</span><span class="op" id="5017589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017592">name</span>&nbsp;<span class="op" id="5017597">:=</span>&nbsp;<span class="builtintype" id="5017600">string</span><span class="op" id="5017606">(</span><span class="ident" id="5017607">b</span><span class="op" id="5017608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017611">//&nbsp;Allocate&nbsp;the&nbsp;destination&nbsp;interface&nbsp;value.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017657">if</span>&nbsp;<span class="ident" id="5017660">name</span>&nbsp;<span class="op" id="5017665">==</span>&nbsp;<span class="string" id="5017668">&#34;&#34;</span>&nbsp;<span class="op" id="5017671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017675">//&nbsp;Copy&nbsp;the&nbsp;nil&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017724">value</span><span class="op" id="5017729">.</span><span class="ident" id="5017730">Set</span><span class="op" id="5017733">(</span><span class="ident" id="5017734">reflect</span><span class="op" id="5017741">.</span><span class="ident" id="5017742">Zero</span><span class="op" id="5017746">(</span><span class="ident" id="5017747">value</span><span class="op" id="5017752">.</span><span class="ident" id="5017753">Type</span><span class="op" id="5017757">(</span><span class="op" id="5017758">)</span><span class="op" id="5017759">)</span><span class="op" id="5017760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017764">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017772">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017775">if</span>&nbsp;<span class="builtinfunc" id="5017778">len</span><span class="op" id="5017781">(</span><span class="ident" id="5017782">name</span><span class="op" id="5017786">)</span>&nbsp;<span class="op" id="5017788">&gt;</span>&nbsp;<span class="num" id="5017790">1024</span>&nbsp;<span class="op" id="5017795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017799">errorf</span><span class="op" id="5017805">(</span><span class="string" id="5017806">&#34;name&nbsp;too&nbsp;long&nbsp;(%d&nbsp;bytes):&nbsp;%.20q...&#34;</span><span class="op" id="5017842">,</span>&nbsp;<span class="builtinfunc" id="5017844">len</span><span class="op" id="5017847">(</span><span class="ident" id="5017848">name</span><span class="op" id="5017852">)</span><span class="op" id="5017853">,</span>&nbsp;<span class="ident" id="5017855">name</span><span class="op" id="5017859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017865">//&nbsp;The&nbsp;concrete&nbsp;type&nbsp;must&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017907">registerLock</span><span class="op" id="5017919">.</span><span class="ident" id="5017920">RLock</span><span class="op" id="5017925">(</span><span class="op" id="5017926">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017929">typ</span><span class="op" id="5017932">,</span>&nbsp;<span class="ident" id="5017934">ok</span>&nbsp;<span class="op" id="5017937">:=</span>&nbsp;<span class="ident" id="5017940">nameToConcreteType</span><span class="op" id="5017958">[</span><span class="ident" id="5017959">name</span><span class="op" id="5017963">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017966">registerLock</span><span class="op" id="5017978">.</span><span class="ident" id="5017979">RUnlock</span><span class="op" id="5017986">(</span><span class="op" id="5017987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017990">if</span>&nbsp;<span class="op" id="5017993">!</span><span class="ident" id="5017994">ok</span>&nbsp;<span class="op" id="5017997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018001">errorf</span><span class="op" id="5018007">(</span><span class="string" id="5018008">&#34;name&nbsp;not&nbsp;registered&nbsp;for&nbsp;interface:&nbsp;%q&#34;</span><span class="op" id="5018047">,</span>&nbsp;<span class="ident" id="5018049">name</span><span class="op" id="5018053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018056">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018059">//&nbsp;Read&nbsp;the&nbsp;type&nbsp;id&nbsp;of&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018103">concreteId</span>&nbsp;<span class="op" id="5018114">:=</span>&nbsp;<span class="ident" id="5018117">dec</span><span class="op" id="5018120">.</span><span class="ident" id="5018121">decodeTypeSequence</span><span class="op" id="5018139">(</span><span class="builtintype" id="5018140">true</span><span class="op" id="5018144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018147">if</span>&nbsp;<span class="ident" id="5018150">concreteId</span>&nbsp;<span class="op" id="5018161">&lt;</span>&nbsp;<span class="num" id="5018163">0</span>&nbsp;<span class="op" id="5018165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018169">error_</span><span class="op" id="5018175">(</span><span class="ident" id="5018176">dec</span><span class="op" id="5018179">.</span><span class="ident" id="5018180">err</span><span class="op" id="5018183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018186">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018189">//&nbsp;Byte&nbsp;count&nbsp;of&nbsp;value&nbsp;is&nbsp;next;&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;it&nbsp;is&nbsp;(it&#39;s&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018259">//&nbsp;in&nbsp;case&nbsp;we&nbsp;want&nbsp;to&nbsp;ignore&nbsp;the&nbsp;value&nbsp;by&nbsp;skipping&nbsp;it&nbsp;completely).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018327">state</span><span class="op" id="5018332">.</span><span class="ident" id="5018333">decodeUint</span><span class="op" id="5018343">(</span><span class="op" id="5018344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018347">//&nbsp;Read&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018376">v</span>&nbsp;<span class="op" id="5018378">:=</span>&nbsp;<span class="ident" id="5018381">allocValue</span><span class="op" id="5018391">(</span><span class="ident" id="5018392">typ</span><span class="op" id="5018395">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018398">dec</span><span class="op" id="5018401">.</span><span class="ident" id="5018402">decodeValue</span><span class="op" id="5018413">(</span><span class="ident" id="5018414">concreteId</span><span class="op" id="5018424">,</span>&nbsp;<span class="ident" id="5018426">v</span><span class="op" id="5018427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018430">if</span>&nbsp;<span class="ident" id="5018433">dec</span><span class="op" id="5018436">.</span><span class="ident" id="5018437">err</span>&nbsp;<span class="op" id="5018441">!=</span>&nbsp;<span class="ident" id="5018444">nil</span>&nbsp;<span class="op" id="5018448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018452">error_</span><span class="op" id="5018458">(</span><span class="ident" id="5018459">dec</span><span class="op" id="5018462">.</span><span class="ident" id="5018463">err</span><span class="op" id="5018466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018472">//&nbsp;Assign&nbsp;the&nbsp;concrete&nbsp;value&nbsp;to&nbsp;the&nbsp;interface.</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018520">//&nbsp;Tread&nbsp;carefully;&nbsp;it&nbsp;might&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018577">if</span>&nbsp;<span class="op" id="5018580">!</span><span class="ident" id="5018581">typ</span><span class="op" id="5018584">.</span><span class="ident" id="5018585">AssignableTo</span><span class="op" id="5018597">(</span><span class="ident" id="5018598">ityp</span><span class="op" id="5018602">)</span>&nbsp;<span class="op" id="5018604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018608">errorf</span><span class="op" id="5018614">(</span><span class="string" id="5018615">&#34;%s&nbsp;is&nbsp;not&nbsp;assignable&nbsp;to&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5018648">,</span>&nbsp;<span class="ident" id="5018650">typ</span><span class="op" id="5018653">,</span>&nbsp;<span class="ident" id="5018655">ityp</span><span class="op" id="5018659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018665">//&nbsp;Copy&nbsp;the&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018709">value</span><span class="op" id="5018714">.</span><span class="ident" id="5018715">Set</span><span class="op" id="5018718">(</span><span class="ident" id="5018719">v</span><span class="op" id="5018720">)</span><br>
<span class="lineno"></span><span class="op" id="5018722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5018725">//&nbsp;ignoreInterface&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;interface&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5018806">func</span>&nbsp;<span class="op" id="5018811">(</span><span class="ident" id="5018812">dec</span>&nbsp;<span class="op" id="5018816">*</span><span class="ident" id="5018817">Decoder</span><span class="op" id="5018824">)</span>&nbsp;<span class="ident" id="5018826">ignoreInterface</span><span class="op" id="5018841">(</span><span class="ident" id="5018842">state</span>&nbsp;<span class="op" id="5018848">*</span><span class="ident" id="5018849">decoderState</span><span class="op" id="5018861">)</span>&nbsp;<span class="op" id="5018863">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018866">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018906">b</span>&nbsp;<span class="op" id="5018908">:=</span>&nbsp;<span class="builtinfunc" id="5018911">make</span><span class="op" id="5018915">(</span><span class="op" id="5018916">[</span><span class="op" id="5018917">]</span><span class="builtintype" id="5018918">byte</span><span class="op" id="5018922">,</span>&nbsp;<span class="ident" id="5018924">state</span><span class="op" id="5018929">.</span><span class="ident" id="5018930">decodeUint</span><span class="op" id="5018940">(</span><span class="op" id="5018941">)</span><span class="op" id="5018942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018945">_</span><span class="op" id="5018946">,</span>&nbsp;<span class="ident" id="5018948">err</span>&nbsp;<span class="op" id="5018952">:=</span>&nbsp;<span class="ident" id="5018955">state</span><span class="op" id="5018960">.</span><span class="ident" id="5018961">b</span><span class="op" id="5018962">.</span><span class="ident" id="5018963">Read</span><span class="op" id="5018967">(</span><span class="ident" id="5018968">b</span><span class="op" id="5018969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018972">if</span>&nbsp;<span class="ident" id="5018975">err</span>&nbsp;<span class="op" id="5018979">!=</span>&nbsp;<span class="ident" id="5018982">nil</span>&nbsp;<span class="op" id="5018986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018990">error_</span><span class="op" id="5018996">(</span><span class="ident" id="5018997">err</span><span class="op" id="5019000">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019006">id</span>&nbsp;<span class="op" id="5019009">:=</span>&nbsp;<span class="ident" id="5019012">dec</span><span class="op" id="5019015">.</span><span class="ident" id="5019016">decodeTypeSequence</span><span class="op" id="5019034">(</span><span class="builtintype" id="5019035">true</span><span class="op" id="5019039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019042">if</span>&nbsp;<span class="ident" id="5019045">id</span>&nbsp;<span class="op" id="5019048">&lt;</span>&nbsp;<span class="num" id="5019050">0</span>&nbsp;<span class="op" id="5019052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019056">error_</span><span class="op" id="5019062">(</span><span class="ident" id="5019063">dec</span><span class="op" id="5019066">.</span><span class="ident" id="5019067">err</span><span class="op" id="5019070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019073">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019076">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;decoder&nbsp;buffer&nbsp;contains&nbsp;a&nbsp;delimited&nbsp;value.&nbsp;Just&nbsp;toss&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019156">state</span><span class="op" id="5019161">.</span><span class="ident" id="5019162">b</span><span class="op" id="5019163">.</span><span class="ident" id="5019164">Drop</span><span class="op" id="5019168">(</span><span class="builtintype" id="5019169">int</span><span class="op" id="5019172">(</span><span class="ident" id="5019173">state</span><span class="op" id="5019178">.</span><span class="ident" id="5019179">decodeUint</span><span class="op" id="5019189">(</span><span class="op" id="5019190">)</span><span class="op" id="5019191">)</span><span class="op" id="5019192">)</span><br>
<span class="lineno"></span><span class="op" id="5019194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5019197">//&nbsp;decodeGobDecoder&nbsp;decodes&nbsp;something&nbsp;implementing&nbsp;the&nbsp;GobDecoder&nbsp;interface.</span><br>
<span class="lineno">695</span><span class="comment" id="5019274">//&nbsp;The&nbsp;data&nbsp;is&nbsp;encoded&nbsp;as&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="5019314">func</span>&nbsp;<span class="op" id="5019319">(</span><span class="ident" id="5019320">dec</span>&nbsp;<span class="op" id="5019324">*</span><span class="ident" id="5019325">Decoder</span><span class="op" id="5019332">)</span>&nbsp;<span class="ident" id="5019334">decodeGobDecoder</span><span class="op" id="5019350">(</span><span class="ident" id="5019351">ut</span>&nbsp;<span class="op" id="5019354">*</span><span class="ident" id="5019355">userTypeInfo</span><span class="op" id="5019367">,</span>&nbsp;<span class="ident" id="5019369">state</span>&nbsp;<span class="op" id="5019375">*</span><span class="ident" id="5019376">decoderState</span><span class="op" id="5019388">,</span>&nbsp;<span class="ident" id="5019390">value</span>&nbsp;<span class="ident" id="5019396">reflect</span><span class="op" id="5019403">.</span><span class="ident" id="5019404">Value</span><span class="op" id="5019409">)</span>&nbsp;<span class="op" id="5019411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019414">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019448">b</span>&nbsp;<span class="op" id="5019450">:=</span>&nbsp;<span class="builtinfunc" id="5019453">make</span><span class="op" id="5019457">(</span><span class="op" id="5019458">[</span><span class="op" id="5019459">]</span><span class="builtintype" id="5019460">byte</span><span class="op" id="5019464">,</span>&nbsp;<span class="ident" id="5019466">state</span><span class="op" id="5019471">.</span><span class="ident" id="5019472">decodeUint</span><span class="op" id="5019482">(</span><span class="op" id="5019483">)</span><span class="op" id="5019484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019487">_</span><span class="op" id="5019488">,</span>&nbsp;<span class="ident" id="5019490">err</span>&nbsp;<span class="op" id="5019494">:=</span>&nbsp;<span class="ident" id="5019497">state</span><span class="op" id="5019502">.</span><span class="ident" id="5019503">b</span><span class="op" id="5019504">.</span><span class="ident" id="5019505">Read</span><span class="op" id="5019509">(</span><span class="ident" id="5019510">b</span><span class="op" id="5019511">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019514">if</span>&nbsp;<span class="ident" id="5019517">err</span>&nbsp;<span class="op" id="5019521">!=</span>&nbsp;<span class="ident" id="5019524">nil</span>&nbsp;<span class="op" id="5019528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019532">error_</span><span class="op" id="5019538">(</span><span class="ident" id="5019539">err</span><span class="op" id="5019542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019548">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;one&nbsp;of&nbsp;these.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019579">switch</span>&nbsp;<span class="ident" id="5019586">ut</span><span class="op" id="5019588">.</span><span class="ident" id="5019589">externalDec</span>&nbsp;<span class="op" id="5019601">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019604">case</span>&nbsp;<span class="ident" id="5019609">xGob</span><span class="op" id="5019613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019617">err</span>&nbsp;<span class="op" id="5019621">=</span>&nbsp;<span class="ident" id="5019623">value</span><span class="op" id="5019628">.</span><span class="ident" id="5019629">Interface</span><span class="op" id="5019638">(</span><span class="op" id="5019639">)</span><span class="op" id="5019640">.</span><span class="op" id="5019641">(</span><span class="ident" id="5019642">GobDecoder</span><span class="op" id="5019652">)</span><span class="op" id="5019653">.</span><span class="ident" id="5019654">GobDecode</span><span class="op" id="5019663">(</span><span class="ident" id="5019664">b</span><span class="op" id="5019665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019668">case</span>&nbsp;<span class="ident" id="5019673">xBinary</span><span class="op" id="5019680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019684">err</span>&nbsp;<span class="op" id="5019688">=</span>&nbsp;<span class="ident" id="5019690">value</span><span class="op" id="5019695">.</span><span class="ident" id="5019696">Interface</span><span class="op" id="5019705">(</span><span class="op" id="5019706">)</span><span class="op" id="5019707">.</span><span class="op" id="5019708">(</span><span class="ident" id="5019709">encoding</span><span class="op" id="5019717">.</span><span class="ident" id="5019718">BinaryUnmarshaler</span><span class="op" id="5019735">)</span><span class="op" id="5019736">.</span><span class="ident" id="5019737">UnmarshalBinary</span><span class="op" id="5019752">(</span><span class="ident" id="5019753">b</span><span class="op" id="5019754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019757">case</span>&nbsp;<span class="ident" id="5019762">xText</span><span class="op" id="5019767">:</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019771">err</span>&nbsp;<span class="op" id="5019775">=</span>&nbsp;<span class="ident" id="5019777">value</span><span class="op" id="5019782">.</span><span class="ident" id="5019783">Interface</span><span class="op" id="5019792">(</span><span class="op" id="5019793">)</span><span class="op" id="5019794">.</span><span class="op" id="5019795">(</span><span class="ident" id="5019796">encoding</span><span class="op" id="5019804">.</span><span class="ident" id="5019805">TextUnmarshaler</span><span class="op" id="5019820">)</span><span class="op" id="5019821">.</span><span class="ident" id="5019822">UnmarshalText</span><span class="op" id="5019835">(</span><span class="ident" id="5019836">b</span><span class="op" id="5019837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019843">if</span>&nbsp;<span class="ident" id="5019846">err</span>&nbsp;<span class="op" id="5019850">!=</span>&nbsp;<span class="ident" id="5019853">nil</span>&nbsp;<span class="op" id="5019857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019861">error_</span><span class="op" id="5019867">(</span><span class="ident" id="5019868">err</span><span class="op" id="5019871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019874">}</span><br>
<span class="lineno">715</span><span class="op" id="5019876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5019879">//&nbsp;ignoreGobDecoder&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;GobDecoder&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5019961">func</span>&nbsp;<span class="op" id="5019966">(</span><span class="ident" id="5019967">dec</span>&nbsp;<span class="op" id="5019971">*</span><span class="ident" id="5019972">Decoder</span><span class="op" id="5019979">)</span>&nbsp;<span class="ident" id="5019981">ignoreGobDecoder</span><span class="op" id="5019997">(</span><span class="ident" id="5019998">state</span>&nbsp;<span class="op" id="5020004">*</span><span class="ident" id="5020005">decoderState</span><span class="op" id="5020017">)</span>&nbsp;<span class="op" id="5020019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5020022">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020056">b</span>&nbsp;<span class="op" id="5020058">:=</span>&nbsp;<span class="builtinfunc" id="5020061">make</span><span class="op" id="5020065">(</span><span class="op" id="5020066">[</span><span class="op" id="5020067">]</span><span class="builtintype" id="5020068">byte</span><span class="op" id="5020072">,</span>&nbsp;<span class="ident" id="5020074">state</span><span class="op" id="5020079">.</span><span class="ident" id="5020080">decodeUint</span><span class="op" id="5020090">(</span><span class="op" id="5020091">)</span><span class="op" id="5020092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020095">_</span><span class="op" id="5020096">,</span>&nbsp;<span class="ident" id="5020098">err</span>&nbsp;<span class="op" id="5020102">:=</span>&nbsp;<span class="ident" id="5020105">state</span><span class="op" id="5020110">.</span><span class="ident" id="5020111">b</span><span class="op" id="5020112">.</span><span class="ident" id="5020113">Read</span><span class="op" id="5020117">(</span><span class="ident" id="5020118">b</span><span class="op" id="5020119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020122">if</span>&nbsp;<span class="ident" id="5020125">err</span>&nbsp;<span class="op" id="5020129">!=</span>&nbsp;<span class="ident" id="5020132">nil</span>&nbsp;<span class="op" id="5020136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020140">error_</span><span class="op" id="5020146">(</span><span class="ident" id="5020147">err</span><span class="op" id="5020150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020153">}</span><br>
<span class="lineno">725</span><span class="op" id="5020155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5020158">//&nbsp;Index&nbsp;by&nbsp;Go&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="5020180">var</span>&nbsp;<span class="ident" id="5020184">decOpTable</span>&nbsp;<span class="op" id="5020195">=</span>&nbsp;<span class="op" id="5020197">[</span><span class="op" id="5020198">...</span><span class="op" id="5020201">]</span><span class="ident" id="5020202">decOp</span><span class="op" id="5020207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020210">reflect</span><span class="op" id="5020217">.</span><span class="ident" id="5020218">Bool</span><span class="op" id="5020222">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020230">decBool</span><span class="op" id="5020237">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020240">reflect</span><span class="op" id="5020247">.</span><span class="ident" id="5020248">Int8</span><span class="op" id="5020252">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020260">decInt8</span><span class="op" id="5020267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020270">reflect</span><span class="op" id="5020277">.</span><span class="ident" id="5020278">Int16</span><span class="op" id="5020283">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020290">decInt16</span><span class="op" id="5020298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020301">reflect</span><span class="op" id="5020308">.</span><span class="ident" id="5020309">Int32</span><span class="op" id="5020314">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020321">decInt32</span><span class="op" id="5020329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020332">reflect</span><span class="op" id="5020339">.</span><span class="ident" id="5020340">Int64</span><span class="op" id="5020345">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020352">decInt64</span><span class="op" id="5020360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020363">reflect</span><span class="op" id="5020370">.</span><span class="ident" id="5020371">Uint8</span><span class="op" id="5020376">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020383">decUint8</span><span class="op" id="5020391">,</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020394">reflect</span><span class="op" id="5020401">.</span><span class="ident" id="5020402">Uint16</span><span class="op" id="5020408">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020414">decUint16</span><span class="op" id="5020423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020426">reflect</span><span class="op" id="5020433">.</span><span class="ident" id="5020434">Uint32</span><span class="op" id="5020440">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020446">decUint32</span><span class="op" id="5020455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020458">reflect</span><span class="op" id="5020465">.</span><span class="ident" id="5020466">Uint64</span><span class="op" id="5020472">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020478">decUint64</span><span class="op" id="5020487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020490">reflect</span><span class="op" id="5020497">.</span><span class="ident" id="5020498">Float32</span><span class="op" id="5020505">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020510">decFloat32</span><span class="op" id="5020520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020523">reflect</span><span class="op" id="5020530">.</span><span class="ident" id="5020531">Float64</span><span class="op" id="5020538">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020543">decFloat64</span><span class="op" id="5020553">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020556">reflect</span><span class="op" id="5020563">.</span><span class="ident" id="5020564">Complex64</span><span class="op" id="5020573">:</span>&nbsp;&nbsp;<span class="ident" id="5020576">decComplex64</span><span class="op" id="5020588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020591">reflect</span><span class="op" id="5020598">.</span><span class="ident" id="5020599">Complex128</span><span class="op" id="5020609">:</span>&nbsp;<span class="ident" id="5020611">decComplex128</span><span class="op" id="5020624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020627">reflect</span><span class="op" id="5020634">.</span><span class="ident" id="5020635">String</span><span class="op" id="5020641">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020647">decString</span><span class="op" id="5020656">,</span><br>
<span class="lineno"></span><span class="op" id="5020658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="5020661">//&nbsp;Indexed&nbsp;by&nbsp;gob&nbsp;types.&nbsp;&nbsp;tComplex&nbsp;will&nbsp;be&nbsp;added&nbsp;during&nbsp;type.init().</span><br>
<span class="lineno"></span><span class="keyword" id="5020730">var</span>&nbsp;<span class="ident" id="5020734">decIgnoreOpMap</span>&nbsp;<span class="op" id="5020749">=</span>&nbsp;<span class="keyword" id="5020751">map</span><span class="op" id="5020754">[</span><span class="ident" id="5020755">typeId</span><span class="op" id="5020761">]</span><span class="ident" id="5020762">decOp</span><span class="op" id="5020767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020770">tBool</span><span class="op" id="5020775">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020780">ignoreUint</span><span class="op" id="5020790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020793">tInt</span><span class="op" id="5020797">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020803">ignoreUint</span><span class="op" id="5020813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020816">tUint</span><span class="op" id="5020821">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5020826">ignoreUint</span><span class="op" id="5020836">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020839">tFloat</span><span class="op" id="5020845">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5020849">ignoreUint</span><span class="op" id="5020859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020862">tBytes</span><span class="op" id="5020868">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5020872">ignoreUint8Array</span><span class="op" id="5020888">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020891">tString</span><span class="op" id="5020898">:</span>&nbsp;&nbsp;<span class="ident" id="5020901">ignoreUint8Array</span><span class="op" id="5020917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020920">tComplex</span><span class="op" id="5020928">:</span>&nbsp;<span class="ident" id="5020930">ignoreTwoUints</span><span class="op" id="5020944">,</span><br>
<span class="lineno"></span><span class="op" id="5020946">}</span><br>
<span class="lineno">755</span><br>
<span class="lineno"></span><span class="comment" id="5020949">//&nbsp;decOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;the&nbsp;base&nbsp;type&nbsp;under&nbsp;rt&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5021016">//&nbsp;the&nbsp;indirection&nbsp;count&nbsp;to&nbsp;reach&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5021054">func</span>&nbsp;<span class="op" id="5021059">(</span><span class="ident" id="5021060">dec</span>&nbsp;<span class="op" id="5021064">*</span><span class="ident" id="5021065">Decoder</span><span class="op" id="5021072">)</span>&nbsp;<span class="ident" id="5021074">decOpFor</span><span class="op" id="5021082">(</span><span class="ident" id="5021083">wireId</span>&nbsp;<span class="ident" id="5021090">typeId</span><span class="op" id="5021096">,</span>&nbsp;<span class="ident" id="5021098">rt</span>&nbsp;<span class="ident" id="5021101">reflect</span><span class="op" id="5021108">.</span><span class="ident" id="5021109">Type</span><span class="op" id="5021113">,</span>&nbsp;<span class="ident" id="5021115">name</span>&nbsp;<span class="builtintype" id="5021120">string</span><span class="op" id="5021126">,</span>&nbsp;<span class="ident" id="5021128">inProgress</span>&nbsp;<span class="keyword" id="5021139">map</span><span class="op" id="5021142">[</span><span class="ident" id="5021143">reflect</span><span class="op" id="5021150">.</span><span class="ident" id="5021151">Type</span><span class="op" id="5021155">]</span><span class="op" id="5021156">*</span><span class="ident" id="5021157">decOp</span><span class="op" id="5021162">)</span>&nbsp;<span class="op" id="5021164">*</span><span class="ident" id="5021165">decOp</span>&nbsp;<span class="op" id="5021171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021174">ut</span>&nbsp;<span class="op" id="5021177">:=</span>&nbsp;<span class="ident" id="5021180">userType</span><span class="op" id="5021188">(</span><span class="ident" id="5021189">rt</span><span class="op" id="5021191">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021194">//&nbsp;If&nbsp;the&nbsp;type&nbsp;implements&nbsp;GobEncoder,&nbsp;we&nbsp;handle&nbsp;it&nbsp;without&nbsp;further&nbsp;processing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021274">if</span>&nbsp;<span class="ident" id="5021277">ut</span><span class="op" id="5021279">.</span><span class="ident" id="5021280">externalDec</span>&nbsp;<span class="op" id="5021292">!=</span>&nbsp;<span class="num" id="5021295">0</span>&nbsp;<span class="op" id="5021297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021301">return</span>&nbsp;<span class="ident" id="5021308">dec</span><span class="op" id="5021311">.</span><span class="ident" id="5021312">gobDecodeOpFor</span><span class="op" id="5021326">(</span><span class="ident" id="5021327">ut</span><span class="op" id="5021329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021336">//&nbsp;If&nbsp;this&nbsp;type&nbsp;is&nbsp;already&nbsp;in&nbsp;progress,&nbsp;it&#39;s&nbsp;a&nbsp;recursive&nbsp;type&nbsp;(e.g.&nbsp;map[string]*T).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021421">//&nbsp;Return&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;op&nbsp;we&#39;re&nbsp;already&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021478">if</span>&nbsp;<span class="ident" id="5021481">opPtr</span>&nbsp;<span class="op" id="5021487">:=</span>&nbsp;<span class="ident" id="5021490">inProgress</span><span class="op" id="5021500">[</span><span class="ident" id="5021501">rt</span><span class="op" id="5021503">]</span><span class="op" id="5021504">;</span>&nbsp;<span class="ident" id="5021506">opPtr</span>&nbsp;<span class="op" id="5021512">!=</span>&nbsp;<span class="ident" id="5021515">nil</span>&nbsp;<span class="op" id="5021519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021523">return</span>&nbsp;<span class="ident" id="5021530">opPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021537">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021540">typ</span>&nbsp;<span class="op" id="5021544">:=</span>&nbsp;<span class="ident" id="5021547">ut</span><span class="op" id="5021549">.</span><span class="ident" id="5021550">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021556">var</span>&nbsp;<span class="ident" id="5021560">op</span>&nbsp;<span class="ident" id="5021563">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021570">k</span>&nbsp;<span class="op" id="5021572">:=</span>&nbsp;<span class="ident" id="5021575">typ</span><span class="op" id="5021578">.</span><span class="ident" id="5021579">Kind</span><span class="op" id="5021583">(</span><span class="op" id="5021584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021587">if</span>&nbsp;<span class="builtintype" id="5021590">int</span><span class="op" id="5021593">(</span><span class="ident" id="5021594">k</span><span class="op" id="5021595">)</span>&nbsp;<span class="op" id="5021597">&lt;</span>&nbsp;<span class="builtinfunc" id="5021599">len</span><span class="op" id="5021602">(</span><span class="ident" id="5021603">decOpTable</span><span class="op" id="5021613">)</span>&nbsp;<span class="op" id="5021615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021619">op</span>&nbsp;<span class="op" id="5021622">=</span>&nbsp;<span class="ident" id="5021624">decOpTable</span><span class="op" id="5021634">[</span><span class="ident" id="5021635">k</span><span class="op" id="5021636">]</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021642">if</span>&nbsp;<span class="ident" id="5021645">op</span>&nbsp;<span class="op" id="5021648">==</span>&nbsp;<span class="ident" id="5021651">nil</span>&nbsp;<span class="op" id="5021655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021659">inProgress</span><span class="op" id="5021669">[</span><span class="ident" id="5021670">rt</span><span class="op" id="5021672">]</span>&nbsp;<span class="op" id="5021674">=</span>&nbsp;<span class="op" id="5021676">&amp;</span><span class="ident" id="5021677">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021682">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021701">switch</span>&nbsp;<span class="ident" id="5021708">t</span>&nbsp;<span class="op" id="5021710">:=</span>&nbsp;<span class="ident" id="5021713">typ</span><span class="op" id="5021716">;</span>&nbsp;<span class="ident" id="5021718">t</span><span class="op" id="5021719">.</span><span class="ident" id="5021720">Kind</span><span class="op" id="5021724">(</span><span class="op" id="5021725">)</span>&nbsp;<span class="op" id="5021727">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021731">case</span>&nbsp;<span class="ident" id="5021736">reflect</span><span class="op" id="5021743">.</span><span class="ident" id="5021744">Array</span><span class="op" id="5021749">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021754">name</span>&nbsp;<span class="op" id="5021759">=</span>&nbsp;<span class="string" id="5021761">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="5021775">+</span>&nbsp;<span class="ident" id="5021777">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021785">elemId</span>&nbsp;<span class="op" id="5021792">:=</span>&nbsp;<span class="ident" id="5021795">dec</span><span class="op" id="5021798">.</span><span class="ident" id="5021799">wireType</span><span class="op" id="5021807">[</span><span class="ident" id="5021808">wireId</span><span class="op" id="5021814">]</span><span class="op" id="5021815">.</span><span class="ident" id="5021816">ArrayT</span><span class="op" id="5021822">.</span><span class="ident" id="5021823">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021831">elemOp</span>&nbsp;<span class="op" id="5021838">:=</span>&nbsp;<span class="ident" id="5021841">dec</span><span class="op" id="5021844">.</span><span class="ident" id="5021845">decOpFor</span><span class="op" id="5021853">(</span><span class="ident" id="5021854">elemId</span><span class="op" id="5021860">,</span>&nbsp;<span class="ident" id="5021862">t</span><span class="op" id="5021863">.</span><span class="ident" id="5021864">Elem</span><span class="op" id="5021868">(</span><span class="op" id="5021869">)</span><span class="op" id="5021870">,</span>&nbsp;<span class="ident" id="5021872">name</span><span class="op" id="5021876">,</span>&nbsp;<span class="ident" id="5021878">inProgress</span><span class="op" id="5021888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021893">ovfl</span>&nbsp;<span class="op" id="5021898">:=</span>&nbsp;<span class="ident" id="5021901">overflow</span><span class="op" id="5021909">(</span><span class="ident" id="5021910">name</span><span class="op" id="5021914">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021919">helper</span>&nbsp;<span class="op" id="5021926">:=</span>&nbsp;<span class="ident" id="5021929">decArrayHelper</span><span class="op" id="5021943">[</span><span class="ident" id="5021944">t</span><span class="op" id="5021945">.</span><span class="ident" id="5021946">Elem</span><span class="op" id="5021950">(</span><span class="op" id="5021951">)</span><span class="op" id="5021952">.</span><span class="ident" id="5021953">Kind</span><span class="op" id="5021957">(</span><span class="op" id="5021958">)</span><span class="op" id="5021959">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021964">op</span>&nbsp;<span class="op" id="5021967">=</span>&nbsp;<span class="keyword" id="5021969">func</span><span class="op" id="5021973">(</span><span class="ident" id="5021974">i</span>&nbsp;<span class="op" id="5021976">*</span><span class="ident" id="5021977">decInstr</span><span class="op" id="5021985">,</span>&nbsp;<span class="ident" id="5021987">state</span>&nbsp;<span class="op" id="5021993">*</span><span class="ident" id="5021994">decoderState</span><span class="op" id="5022006">,</span>&nbsp;<span class="ident" id="5022008">value</span>&nbsp;<span class="ident" id="5022014">reflect</span><span class="op" id="5022021">.</span><span class="ident" id="5022022">Value</span><span class="op" id="5022027">)</span>&nbsp;<span class="op" id="5022029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022035">state</span><span class="op" id="5022040">.</span><span class="ident" id="5022041">dec</span><span class="op" id="5022044">.</span><span class="ident" id="5022045">decodeArray</span><span class="op" id="5022056">(</span><span class="ident" id="5022057">t</span><span class="op" id="5022058">,</span>&nbsp;<span class="ident" id="5022060">state</span><span class="op" id="5022065">,</span>&nbsp;<span class="ident" id="5022067">value</span><span class="op" id="5022072">,</span>&nbsp;<span class="op" id="5022074">*</span><span class="ident" id="5022075">elemOp</span><span class="op" id="5022081">,</span>&nbsp;<span class="ident" id="5022083">t</span><span class="op" id="5022084">.</span><span class="ident" id="5022085">Len</span><span class="op" id="5022088">(</span><span class="op" id="5022089">)</span><span class="op" id="5022090">,</span>&nbsp;<span class="ident" id="5022092">ovfl</span><span class="op" id="5022096">,</span>&nbsp;<span class="ident" id="5022098">helper</span><span class="op" id="5022104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022114">case</span>&nbsp;<span class="ident" id="5022119">reflect</span><span class="op" id="5022126">.</span><span class="ident" id="5022127">Map</span><span class="op" id="5022130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022135">keyId</span>&nbsp;<span class="op" id="5022141">:=</span>&nbsp;<span class="ident" id="5022144">dec</span><span class="op" id="5022147">.</span><span class="ident" id="5022148">wireType</span><span class="op" id="5022156">[</span><span class="ident" id="5022157">wireId</span><span class="op" id="5022163">]</span><span class="op" id="5022164">.</span><span class="ident" id="5022165">MapT</span><span class="op" id="5022169">.</span><span class="ident" id="5022170">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022177">elemId</span>&nbsp;<span class="op" id="5022184">:=</span>&nbsp;<span class="ident" id="5022187">dec</span><span class="op" id="5022190">.</span><span class="ident" id="5022191">wireType</span><span class="op" id="5022199">[</span><span class="ident" id="5022200">wireId</span><span class="op" id="5022206">]</span><span class="op" id="5022207">.</span><span class="ident" id="5022208">MapT</span><span class="op" id="5022212">.</span><span class="ident" id="5022213">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022221">keyOp</span>&nbsp;<span class="op" id="5022227">:=</span>&nbsp;<span class="ident" id="5022230">dec</span><span class="op" id="5022233">.</span><span class="ident" id="5022234">decOpFor</span><span class="op" id="5022242">(</span><span class="ident" id="5022243">keyId</span><span class="op" id="5022248">,</span>&nbsp;<span class="ident" id="5022250">t</span><span class="op" id="5022251">.</span><span class="ident" id="5022252">Key</span><span class="op" id="5022255">(</span><span class="op" id="5022256">)</span><span class="op" id="5022257">,</span>&nbsp;<span class="string" id="5022259">&#34;key&nbsp;of&nbsp;&#34;</span><span class="op" id="5022268">+</span><span class="ident" id="5022269">name</span><span class="op" id="5022273">,</span>&nbsp;<span class="ident" id="5022275">inProgress</span><span class="op" id="5022285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022290">elemOp</span>&nbsp;<span class="op" id="5022297">:=</span>&nbsp;<span class="ident" id="5022300">dec</span><span class="op" id="5022303">.</span><span class="ident" id="5022304">decOpFor</span><span class="op" id="5022312">(</span><span class="ident" id="5022313">elemId</span><span class="op" id="5022319">,</span>&nbsp;<span class="ident" id="5022321">t</span><span class="op" id="5022322">.</span><span class="ident" id="5022323">Elem</span><span class="op" id="5022327">(</span><span class="op" id="5022328">)</span><span class="op" id="5022329">,</span>&nbsp;<span class="string" id="5022331">&#34;element&nbsp;of&nbsp;&#34;</span><span class="op" id="5022344">+</span><span class="ident" id="5022345">name</span><span class="op" id="5022349">,</span>&nbsp;<span class="ident" id="5022351">inProgress</span><span class="op" id="5022361">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022366">ovfl</span>&nbsp;<span class="op" id="5022371">:=</span>&nbsp;<span class="ident" id="5022374">overflow</span><span class="op" id="5022382">(</span><span class="ident" id="5022383">name</span><span class="op" id="5022387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022392">op</span>&nbsp;<span class="op" id="5022395">=</span>&nbsp;<span class="keyword" id="5022397">func</span><span class="op" id="5022401">(</span><span class="ident" id="5022402">i</span>&nbsp;<span class="op" id="5022404">*</span><span class="ident" id="5022405">decInstr</span><span class="op" id="5022413">,</span>&nbsp;<span class="ident" id="5022415">state</span>&nbsp;<span class="op" id="5022421">*</span><span class="ident" id="5022422">decoderState</span><span class="op" id="5022434">,</span>&nbsp;<span class="ident" id="5022436">value</span>&nbsp;<span class="ident" id="5022442">reflect</span><span class="op" id="5022449">.</span><span class="ident" id="5022450">Value</span><span class="op" id="5022455">)</span>&nbsp;<span class="op" id="5022457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022463">state</span><span class="op" id="5022468">.</span><span class="ident" id="5022469">dec</span><span class="op" id="5022472">.</span><span class="ident" id="5022473">decodeMap</span><span class="op" id="5022482">(</span><span class="ident" id="5022483">t</span><span class="op" id="5022484">,</span>&nbsp;<span class="ident" id="5022486">state</span><span class="op" id="5022491">,</span>&nbsp;<span class="ident" id="5022493">value</span><span class="op" id="5022498">,</span>&nbsp;<span class="op" id="5022500">*</span><span class="ident" id="5022501">keyOp</span><span class="op" id="5022506">,</span>&nbsp;<span class="op" id="5022508">*</span><span class="ident" id="5022509">elemOp</span><span class="op" id="5022515">,</span>&nbsp;<span class="ident" id="5022517">ovfl</span><span class="op" id="5022521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022531">case</span>&nbsp;<span class="ident" id="5022536">reflect</span><span class="op" id="5022543">.</span><span class="ident" id="5022544">Slice</span><span class="op" id="5022549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022554">name</span>&nbsp;<span class="op" id="5022559">=</span>&nbsp;<span class="string" id="5022561">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="5022575">+</span>&nbsp;<span class="ident" id="5022577">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022585">if</span>&nbsp;<span class="ident" id="5022588">t</span><span class="op" id="5022589">.</span><span class="ident" id="5022590">Elem</span><span class="op" id="5022594">(</span><span class="op" id="5022595">)</span><span class="op" id="5022596">.</span><span class="ident" id="5022597">Kind</span><span class="op" id="5022601">(</span><span class="op" id="5022602">)</span>&nbsp;<span class="op" id="5022604">==</span>&nbsp;<span class="ident" id="5022607">reflect</span><span class="op" id="5022614">.</span><span class="ident" id="5022615">Uint8</span>&nbsp;<span class="op" id="5022621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022627">op</span>&nbsp;<span class="op" id="5022630">=</span>&nbsp;<span class="ident" id="5022632">decUint8Slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022650">break</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022664">var</span>&nbsp;<span class="ident" id="5022668">elemId</span>&nbsp;<span class="ident" id="5022675">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022685">if</span>&nbsp;<span class="ident" id="5022688">tt</span><span class="op" id="5022690">,</span>&nbsp;<span class="ident" id="5022692">ok</span>&nbsp;<span class="op" id="5022695">:=</span>&nbsp;<span class="ident" id="5022698">builtinIdToType</span><span class="op" id="5022713">[</span><span class="ident" id="5022714">wireId</span><span class="op" id="5022720">]</span><span class="op" id="5022721">;</span>&nbsp;<span class="ident" id="5022723">ok</span>&nbsp;<span class="op" id="5022726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022732">elemId</span>&nbsp;<span class="op" id="5022739">=</span>&nbsp;<span class="ident" id="5022741">tt</span><span class="op" id="5022743">.</span><span class="op" id="5022744">(</span><span class="op" id="5022745">*</span><span class="ident" id="5022746">sliceType</span><span class="op" id="5022755">)</span><span class="op" id="5022756">.</span><span class="ident" id="5022757">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022765">}</span>&nbsp;<span class="keyword" id="5022767">else</span>&nbsp;<span class="op" id="5022772">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022778">elemId</span>&nbsp;<span class="op" id="5022785">=</span>&nbsp;<span class="ident" id="5022787">dec</span><span class="op" id="5022790">.</span><span class="ident" id="5022791">wireType</span><span class="op" id="5022799">[</span><span class="ident" id="5022800">wireId</span><span class="op" id="5022806">]</span><span class="op" id="5022807">.</span><span class="ident" id="5022808">SliceT</span><span class="op" id="5022814">.</span><span class="ident" id="5022815">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022828">elemOp</span>&nbsp;<span class="op" id="5022835">:=</span>&nbsp;<span class="ident" id="5022838">dec</span><span class="op" id="5022841">.</span><span class="ident" id="5022842">decOpFor</span><span class="op" id="5022850">(</span><span class="ident" id="5022851">elemId</span><span class="op" id="5022857">,</span>&nbsp;<span class="ident" id="5022859">t</span><span class="op" id="5022860">.</span><span class="ident" id="5022861">Elem</span><span class="op" id="5022865">(</span><span class="op" id="5022866">)</span><span class="op" id="5022867">,</span>&nbsp;<span class="ident" id="5022869">name</span><span class="op" id="5022873">,</span>&nbsp;<span class="ident" id="5022875">inProgress</span><span class="op" id="5022885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022890">ovfl</span>&nbsp;<span class="op" id="5022895">:=</span>&nbsp;<span class="ident" id="5022898">overflow</span><span class="op" id="5022906">(</span><span class="ident" id="5022907">name</span><span class="op" id="5022911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022916">helper</span>&nbsp;<span class="op" id="5022923">:=</span>&nbsp;<span class="ident" id="5022926">decSliceHelper</span><span class="op" id="5022940">[</span><span class="ident" id="5022941">t</span><span class="op" id="5022942">.</span><span class="ident" id="5022943">Elem</span><span class="op" id="5022947">(</span><span class="op" id="5022948">)</span><span class="op" id="5022949">.</span><span class="ident" id="5022950">Kind</span><span class="op" id="5022954">(</span><span class="op" id="5022955">)</span><span class="op" id="5022956">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022961">op</span>&nbsp;<span class="op" id="5022964">=</span>&nbsp;<span class="keyword" id="5022966">func</span><span class="op" id="5022970">(</span><span class="ident" id="5022971">i</span>&nbsp;<span class="op" id="5022973">*</span><span class="ident" id="5022974">decInstr</span><span class="op" id="5022982">,</span>&nbsp;<span class="ident" id="5022984">state</span>&nbsp;<span class="op" id="5022990">*</span><span class="ident" id="5022991">decoderState</span><span class="op" id="5023003">,</span>&nbsp;<span class="ident" id="5023005">value</span>&nbsp;<span class="ident" id="5023011">reflect</span><span class="op" id="5023018">.</span><span class="ident" id="5023019">Value</span><span class="op" id="5023024">)</span>&nbsp;<span class="op" id="5023026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023032">state</span><span class="op" id="5023037">.</span><span class="ident" id="5023038">dec</span><span class="op" id="5023041">.</span><span class="ident" id="5023042">decodeSlice</span><span class="op" id="5023053">(</span><span class="ident" id="5023054">state</span><span class="op" id="5023059">,</span>&nbsp;<span class="ident" id="5023061">value</span><span class="op" id="5023066">,</span>&nbsp;<span class="op" id="5023068">*</span><span class="ident" id="5023069">elemOp</span><span class="op" id="5023075">,</span>&nbsp;<span class="ident" id="5023077">ovfl</span><span class="op" id="5023081">,</span>&nbsp;<span class="ident" id="5023083">helper</span><span class="op" id="5023089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023099">case</span>&nbsp;<span class="ident" id="5023104">reflect</span><span class="op" id="5023111">.</span><span class="ident" id="5023112">Struct</span><span class="op" id="5023118">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023123">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023198">ut</span>&nbsp;<span class="op" id="5023201">:=</span>&nbsp;<span class="ident" id="5023204">userType</span><span class="op" id="5023212">(</span><span class="ident" id="5023213">typ</span><span class="op" id="5023216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023221">enginePtr</span><span class="op" id="5023230">,</span>&nbsp;<span class="ident" id="5023232">err</span>&nbsp;<span class="op" id="5023236">:=</span>&nbsp;<span class="ident" id="5023239">dec</span><span class="op" id="5023242">.</span><span class="ident" id="5023243">getDecEnginePtr</span><span class="op" id="5023258">(</span><span class="ident" id="5023259">wireId</span><span class="op" id="5023265">,</span>&nbsp;<span class="ident" id="5023267">ut</span><span class="op" id="5023269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023274">if</span>&nbsp;<span class="ident" id="5023277">err</span>&nbsp;<span class="op" id="5023281">!=</span>&nbsp;<span class="ident" id="5023284">nil</span>&nbsp;<span class="op" id="5023288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023294">error_</span><span class="op" id="5023300">(</span><span class="ident" id="5023301">err</span><span class="op" id="5023304">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023314">op</span>&nbsp;<span class="op" id="5023317">=</span>&nbsp;<span class="keyword" id="5023319">func</span><span class="op" id="5023323">(</span><span class="ident" id="5023324">i</span>&nbsp;<span class="op" id="5023326">*</span><span class="ident" id="5023327">decInstr</span><span class="op" id="5023335">,</span>&nbsp;<span class="ident" id="5023337">state</span>&nbsp;<span class="op" id="5023343">*</span><span class="ident" id="5023344">decoderState</span><span class="op" id="5023356">,</span>&nbsp;<span class="ident" id="5023358">value</span>&nbsp;<span class="ident" id="5023364">reflect</span><span class="op" id="5023371">.</span><span class="ident" id="5023372">Value</span><span class="op" id="5023377">)</span>&nbsp;<span class="op" id="5023379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023385">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023462">dec</span><span class="op" id="5023465">.</span><span class="ident" id="5023466">decodeStruct</span><span class="op" id="5023478">(</span><span class="op" id="5023479">*</span><span class="ident" id="5023480">enginePtr</span><span class="op" id="5023489">,</span>&nbsp;<span class="ident" id="5023491">ut</span><span class="op" id="5023493">,</span>&nbsp;<span class="ident" id="5023495">value</span><span class="op" id="5023500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023505">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023509">case</span>&nbsp;<span class="ident" id="5023514">reflect</span><span class="op" id="5023521">.</span><span class="ident" id="5023522">Interface</span><span class="op" id="5023531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023536">op</span>&nbsp;<span class="op" id="5023539">=</span>&nbsp;<span class="keyword" id="5023541">func</span><span class="op" id="5023545">(</span><span class="ident" id="5023546">i</span>&nbsp;<span class="op" id="5023548">*</span><span class="ident" id="5023549">decInstr</span><span class="op" id="5023557">,</span>&nbsp;<span class="ident" id="5023559">state</span>&nbsp;<span class="op" id="5023565">*</span><span class="ident" id="5023566">decoderState</span><span class="op" id="5023578">,</span>&nbsp;<span class="ident" id="5023580">value</span>&nbsp;<span class="ident" id="5023586">reflect</span><span class="op" id="5023593">.</span><span class="ident" id="5023594">Value</span><span class="op" id="5023599">)</span>&nbsp;<span class="op" id="5023601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023607">state</span><span class="op" id="5023612">.</span><span class="ident" id="5023613">dec</span><span class="op" id="5023616">.</span><span class="ident" id="5023617">decodeInterface</span><span class="op" id="5023632">(</span><span class="ident" id="5023633">t</span><span class="op" id="5023634">,</span>&nbsp;<span class="ident" id="5023636">state</span><span class="op" id="5023641">,</span>&nbsp;<span class="ident" id="5023643">value</span><span class="op" id="5023648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023657">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023663">if</span>&nbsp;<span class="ident" id="5023666">op</span>&nbsp;<span class="op" id="5023669">==</span>&nbsp;<span class="ident" id="5023672">nil</span>&nbsp;<span class="op" id="5023676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023680">errorf</span><span class="op" id="5023686">(</span><span class="string" id="5023687">&#34;decode&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5023716">,</span>&nbsp;<span class="ident" id="5023718">rt</span><span class="op" id="5023720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023726">return</span>&nbsp;<span class="op" id="5023733">&amp;</span><span class="ident" id="5023734">op</span><br>
<span class="lineno">840</span><span class="op" id="5023737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5023740">//&nbsp;decIgnoreOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;a&nbsp;field&nbsp;that&nbsp;has&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5023819">func</span>&nbsp;<span class="op" id="5023824">(</span><span class="ident" id="5023825">dec</span>&nbsp;<span class="op" id="5023829">*</span><span class="ident" id="5023830">Decoder</span><span class="op" id="5023837">)</span>&nbsp;<span class="ident" id="5023839">decIgnoreOpFor</span><span class="op" id="5023853">(</span><span class="ident" id="5023854">wireId</span>&nbsp;<span class="ident" id="5023861">typeId</span><span class="op" id="5023867">)</span>&nbsp;<span class="ident" id="5023869">decOp</span>&nbsp;<span class="op" id="5023875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023878">op</span><span class="op" id="5023880">,</span>&nbsp;<span class="ident" id="5023882">ok</span>&nbsp;<span class="op" id="5023885">:=</span>&nbsp;<span class="ident" id="5023888">decIgnoreOpMap</span><span class="op" id="5023902">[</span><span class="ident" id="5023903">wireId</span><span class="op" id="5023909">]</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023912">if</span>&nbsp;<span class="op" id="5023915">!</span><span class="ident" id="5023916">ok</span>&nbsp;<span class="op" id="5023919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023923">if</span>&nbsp;<span class="ident" id="5023926">wireId</span>&nbsp;<span class="op" id="5023933">==</span>&nbsp;<span class="ident" id="5023936">tInterface</span>&nbsp;<span class="op" id="5023947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023952">//&nbsp;Special&nbsp;case&nbsp;because&nbsp;it&#39;s&nbsp;a&nbsp;method:&nbsp;the&nbsp;ignored&nbsp;item&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024017">//&nbsp;define&nbsp;types&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;record&nbsp;their&nbsp;state&nbsp;in&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024086">op</span>&nbsp;<span class="op" id="5024089">=</span>&nbsp;<span class="keyword" id="5024091">func</span><span class="op" id="5024095">(</span><span class="ident" id="5024096">i</span>&nbsp;<span class="op" id="5024098">*</span><span class="ident" id="5024099">decInstr</span><span class="op" id="5024107">,</span>&nbsp;<span class="ident" id="5024109">state</span>&nbsp;<span class="op" id="5024115">*</span><span class="ident" id="5024116">decoderState</span><span class="op" id="5024128">,</span>&nbsp;<span class="ident" id="5024130">value</span>&nbsp;<span class="ident" id="5024136">reflect</span><span class="op" id="5024143">.</span><span class="ident" id="5024144">Value</span><span class="op" id="5024149">)</span>&nbsp;<span class="op" id="5024151">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024157">state</span><span class="op" id="5024162">.</span><span class="ident" id="5024163">dec</span><span class="op" id="5024166">.</span><span class="ident" id="5024167">ignoreInterface</span><span class="op" id="5024182">(</span><span class="ident" id="5024183">state</span><span class="op" id="5024188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024198">return</span>&nbsp;<span class="ident" id="5024205">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024214">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024233">wire</span>&nbsp;<span class="op" id="5024238">:=</span>&nbsp;<span class="ident" id="5024241">dec</span><span class="op" id="5024244">.</span><span class="ident" id="5024245">wireType</span><span class="op" id="5024253">[</span><span class="ident" id="5024254">wireId</span><span class="op" id="5024260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024264">switch</span>&nbsp;<span class="op" id="5024271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024275">case</span>&nbsp;<span class="ident" id="5024280">wire</span>&nbsp;<span class="op" id="5024285">==</span>&nbsp;<span class="ident" id="5024288">nil</span><span class="op" id="5024291">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024296">errorf</span><span class="op" id="5024302">(</span><span class="string" id="5024303">&#34;bad&nbsp;data:&nbsp;undefined&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5024332">,</span>&nbsp;<span class="ident" id="5024334">wireId</span><span class="op" id="5024340">.</span><span class="builtintype" id="5024341">string</span><span class="op" id="5024347">(</span><span class="op" id="5024348">)</span><span class="op" id="5024349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024353">case</span>&nbsp;<span class="ident" id="5024358">wire</span><span class="op" id="5024362">.</span><span class="ident" id="5024363">ArrayT</span>&nbsp;<span class="op" id="5024370">!=</span>&nbsp;<span class="ident" id="5024373">nil</span><span class="op" id="5024376">:</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024381">elemId</span>&nbsp;<span class="op" id="5024388">:=</span>&nbsp;<span class="ident" id="5024391">wire</span><span class="op" id="5024395">.</span><span class="ident" id="5024396">ArrayT</span><span class="op" id="5024402">.</span><span class="ident" id="5024403">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024411">elemOp</span>&nbsp;<span class="op" id="5024418">:=</span>&nbsp;<span class="ident" id="5024421">dec</span><span class="op" id="5024424">.</span><span class="ident" id="5024425">decIgnoreOpFor</span><span class="op" id="5024439">(</span><span class="ident" id="5024440">elemId</span><span class="op" id="5024446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024451">op</span>&nbsp;<span class="op" id="5024454">=</span>&nbsp;<span class="keyword" id="5024456">func</span><span class="op" id="5024460">(</span><span class="ident" id="5024461">i</span>&nbsp;<span class="op" id="5024463">*</span><span class="ident" id="5024464">decInstr</span><span class="op" id="5024472">,</span>&nbsp;<span class="ident" id="5024474">state</span>&nbsp;<span class="op" id="5024480">*</span><span class="ident" id="5024481">decoderState</span><span class="op" id="5024493">,</span>&nbsp;<span class="ident" id="5024495">value</span>&nbsp;<span class="ident" id="5024501">reflect</span><span class="op" id="5024508">.</span><span class="ident" id="5024509">Value</span><span class="op" id="5024514">)</span>&nbsp;<span class="op" id="5024516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024522">state</span><span class="op" id="5024527">.</span><span class="ident" id="5024528">dec</span><span class="op" id="5024531">.</span><span class="ident" id="5024532">ignoreArray</span><span class="op" id="5024543">(</span><span class="ident" id="5024544">state</span><span class="op" id="5024549">,</span>&nbsp;<span class="ident" id="5024551">elemOp</span><span class="op" id="5024557">,</span>&nbsp;<span class="ident" id="5024559">wire</span><span class="op" id="5024563">.</span><span class="ident" id="5024564">ArrayT</span><span class="op" id="5024570">.</span><span class="ident" id="5024571">Len</span><span class="op" id="5024574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024579">}</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024584">case</span>&nbsp;<span class="ident" id="5024589">wire</span><span class="op" id="5024593">.</span><span class="ident" id="5024594">MapT</span>&nbsp;<span class="op" id="5024599">!=</span>&nbsp;<span class="ident" id="5024602">nil</span><span class="op" id="5024605">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024610">keyId</span>&nbsp;<span class="op" id="5024616">:=</span>&nbsp;<span class="ident" id="5024619">dec</span><span class="op" id="5024622">.</span><span class="ident" id="5024623">wireType</span><span class="op" id="5024631">[</span><span class="ident" id="5024632">wireId</span><span class="op" id="5024638">]</span><span class="op" id="5024639">.</span><span class="ident" id="5024640">MapT</span><span class="op" id="5024644">.</span><span class="ident" id="5024645">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024652">elemId</span>&nbsp;<span class="op" id="5024659">:=</span>&nbsp;<span class="ident" id="5024662">dec</span><span class="op" id="5024665">.</span><span class="ident" id="5024666">wireType</span><span class="op" id="5024674">[</span><span class="ident" id="5024675">wireId</span><span class="op" id="5024681">]</span><span class="op" id="5024682">.</span><span class="ident" id="5024683">MapT</span><span class="op" id="5024687">.</span><span class="ident" id="5024688">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024696">keyOp</span>&nbsp;<span class="op" id="5024702">:=</span>&nbsp;<span class="ident" id="5024705">dec</span><span class="op" id="5024708">.</span><span class="ident" id="5024709">decIgnoreOpFor</span><span class="op" id="5024723">(</span><span class="ident" id="5024724">keyId</span><span class="op" id="5024729">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024734">elemOp</span>&nbsp;<span class="op" id="5024741">:=</span>&nbsp;<span class="ident" id="5024744">dec</span><span class="op" id="5024747">.</span><span class="ident" id="5024748">decIgnoreOpFor</span><span class="op" id="5024762">(</span><span class="ident" id="5024763">elemId</span><span class="op" id="5024769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024774">op</span>&nbsp;<span class="op" id="5024777">=</span>&nbsp;<span class="keyword" id="5024779">func</span><span class="op" id="5024783">(</span><span class="ident" id="5024784">i</span>&nbsp;<span class="op" id="5024786">*</span><span class="ident" id="5024787">decInstr</span><span class="op" id="5024795">,</span>&nbsp;<span class="ident" id="5024797">state</span>&nbsp;<span class="op" id="5024803">*</span><span class="ident" id="5024804">decoderState</span><span class="op" id="5024816">,</span>&nbsp;<span class="ident" id="5024818">value</span>&nbsp;<span class="ident" id="5024824">reflect</span><span class="op" id="5024831">.</span><span class="ident" id="5024832">Value</span><span class="op" id="5024837">)</span>&nbsp;<span class="op" id="5024839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024845">state</span><span class="op" id="5024850">.</span><span class="ident" id="5024851">dec</span><span class="op" id="5024854">.</span><span class="ident" id="5024855">ignoreMap</span><span class="op" id="5024864">(</span><span class="ident" id="5024865">state</span><span class="op" id="5024870">,</span>&nbsp;<span class="ident" id="5024872">keyOp</span><span class="op" id="5024877">,</span>&nbsp;<span class="ident" id="5024879">elemOp</span><span class="op" id="5024885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024895">case</span>&nbsp;<span class="ident" id="5024900">wire</span><span class="op" id="5024904">.</span><span class="ident" id="5024905">SliceT</span>&nbsp;<span class="op" id="5024912">!=</span>&nbsp;<span class="ident" id="5024915">nil</span><span class="op" id="5024918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024923">elemId</span>&nbsp;<span class="op" id="5024930">:=</span>&nbsp;<span class="ident" id="5024933">wire</span><span class="op" id="5024937">.</span><span class="ident" id="5024938">SliceT</span><span class="op" id="5024944">.</span><span class="ident" id="5024945">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024953">elemOp</span>&nbsp;<span class="op" id="5024960">:=</span>&nbsp;<span class="ident" id="5024963">dec</span><span class="op" id="5024966">.</span><span class="ident" id="5024967">decIgnoreOpFor</span><span class="op" id="5024981">(</span><span class="ident" id="5024982">elemId</span><span class="op" id="5024988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024993">op</span>&nbsp;<span class="op" id="5024996">=</span>&nbsp;<span class="keyword" id="5024998">func</span><span class="op" id="5025002">(</span><span class="ident" id="5025003">i</span>&nbsp;<span class="op" id="5025005">*</span><span class="ident" id="5025006">decInstr</span><span class="op" id="5025014">,</span>&nbsp;<span class="ident" id="5025016">state</span>&nbsp;<span class="op" id="5025022">*</span><span class="ident" id="5025023">decoderState</span><span class="op" id="5025035">,</span>&nbsp;<span class="ident" id="5025037">value</span>&nbsp;<span class="ident" id="5025043">reflect</span><span class="op" id="5025050">.</span><span class="ident" id="5025051">Value</span><span class="op" id="5025056">)</span>&nbsp;<span class="op" id="5025058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025064">state</span><span class="op" id="5025069">.</span><span class="ident" id="5025070">dec</span><span class="op" id="5025073">.</span><span class="ident" id="5025074">ignoreSlice</span><span class="op" id="5025085">(</span><span class="ident" id="5025086">state</span><span class="op" id="5025091">,</span>&nbsp;<span class="ident" id="5025093">elemOp</span><span class="op" id="5025099">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025109">case</span>&nbsp;<span class="ident" id="5025114">wire</span><span class="op" id="5025118">.</span><span class="ident" id="5025119">StructT</span>&nbsp;<span class="op" id="5025127">!=</span>&nbsp;<span class="ident" id="5025130">nil</span><span class="op" id="5025133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5025138">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025213">enginePtr</span><span class="op" id="5025222">,</span>&nbsp;<span class="ident" id="5025224">err</span>&nbsp;<span class="op" id="5025228">:=</span>&nbsp;<span class="ident" id="5025231">dec</span><span class="op" id="5025234">.</span><span class="ident" id="5025235">getIgnoreEnginePtr</span><span class="op" id="5025253">(</span><span class="ident" id="5025254">wireId</span><span class="op" id="5025260">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025265">if</span>&nbsp;<span class="ident" id="5025268">err</span>&nbsp;<span class="op" id="5025272">!=</span>&nbsp;<span class="ident" id="5025275">nil</span>&nbsp;<span class="op" id="5025279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025285">error_</span><span class="op" id="5025291">(</span><span class="ident" id="5025292">err</span><span class="op" id="5025295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025305">op</span>&nbsp;<span class="op" id="5025308">=</span>&nbsp;<span class="keyword" id="5025310">func</span><span class="op" id="5025314">(</span><span class="ident" id="5025315">i</span>&nbsp;<span class="op" id="5025317">*</span><span class="ident" id="5025318">decInstr</span><span class="op" id="5025326">,</span>&nbsp;<span class="ident" id="5025328">state</span>&nbsp;<span class="op" id="5025334">*</span><span class="ident" id="5025335">decoderState</span><span class="op" id="5025347">,</span>&nbsp;<span class="ident" id="5025349">value</span>&nbsp;<span class="ident" id="5025355">reflect</span><span class="op" id="5025362">.</span><span class="ident" id="5025363">Value</span><span class="op" id="5025368">)</span>&nbsp;<span class="op" id="5025370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5025376">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025452">state</span><span class="op" id="5025457">.</span><span class="ident" id="5025458">dec</span><span class="op" id="5025461">.</span><span class="ident" id="5025462">ignoreStruct</span><span class="op" id="5025474">(</span><span class="op" id="5025475">*</span><span class="ident" id="5025476">enginePtr</span><span class="op" id="5025485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025495">case</span>&nbsp;<span class="ident" id="5025500">wire</span><span class="op" id="5025504">.</span><span class="ident" id="5025505">GobEncoderT</span>&nbsp;<span class="op" id="5025517">!=</span>&nbsp;<span class="ident" id="5025520">nil</span><span class="op" id="5025523">,</span>&nbsp;<span class="ident" id="5025525">wire</span><span class="op" id="5025529">.</span><span class="ident" id="5025530">BinaryMarshalerT</span>&nbsp;<span class="op" id="5025547">!=</span>&nbsp;<span class="ident" id="5025550">nil</span><span class="op" id="5025553">,</span>&nbsp;<span class="ident" id="5025555">wire</span><span class="op" id="5025559">.</span><span class="ident" id="5025560">TextMarshalerT</span>&nbsp;<span class="op" id="5025575">!=</span>&nbsp;<span class="ident" id="5025578">nil</span><span class="op" id="5025581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025586">op</span>&nbsp;<span class="op" id="5025589">=</span>&nbsp;<span class="keyword" id="5025591">func</span><span class="op" id="5025595">(</span><span class="ident" id="5025596">i</span>&nbsp;<span class="op" id="5025598">*</span><span class="ident" id="5025599">decInstr</span><span class="op" id="5025607">,</span>&nbsp;<span class="ident" id="5025609">state</span>&nbsp;<span class="op" id="5025615">*</span><span class="ident" id="5025616">decoderState</span><span class="op" id="5025628">,</span>&nbsp;<span class="ident" id="5025630">value</span>&nbsp;<span class="ident" id="5025636">reflect</span><span class="op" id="5025643">.</span><span class="ident" id="5025644">Value</span><span class="op" id="5025649">)</span>&nbsp;<span class="op" id="5025651">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025657">state</span><span class="op" id="5025662">.</span><span class="ident" id="5025663">dec</span><span class="op" id="5025666">.</span><span class="ident" id="5025667">ignoreGobDecoder</span><span class="op" id="5025683">(</span><span class="ident" id="5025684">state</span><span class="op" id="5025689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025704">if</span>&nbsp;<span class="ident" id="5025707">op</span>&nbsp;<span class="op" id="5025710">==</span>&nbsp;<span class="ident" id="5025713">nil</span>&nbsp;<span class="op" id="5025717">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025721">errorf</span><span class="op" id="5025727">(</span><span class="string" id="5025728">&#34;bad&nbsp;data:&nbsp;ignore&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5025767">,</span>&nbsp;<span class="ident" id="5025769">wireId</span><span class="op" id="5025775">.</span><span class="builtintype" id="5025776">string</span><span class="op" id="5025782">(</span><span class="op" id="5025783">)</span><span class="op" id="5025784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025790">return</span>&nbsp;<span class="ident" id="5025797">op</span><br>
<span class="lineno"></span><span class="op" id="5025800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="5025803">//&nbsp;gobDecodeOpFor&nbsp;returns&nbsp;the&nbsp;op&nbsp;for&nbsp;a&nbsp;type&nbsp;that&nbsp;is&nbsp;known&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="5025874">//&nbsp;GobDecoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5025889">func</span>&nbsp;<span class="op" id="5025894">(</span><span class="ident" id="5025895">dec</span>&nbsp;<span class="op" id="5025899">*</span><span class="ident" id="5025900">Decoder</span><span class="op" id="5025907">)</span>&nbsp;<span class="ident" id="5025909">gobDecodeOpFor</span><span class="op" id="5025923">(</span><span class="ident" id="5025924">ut</span>&nbsp;<span class="op" id="5025927">*</span><span class="ident" id="5025928">userTypeInfo</span><span class="op" id="5025940">)</span>&nbsp;<span class="op" id="5025942">*</span><span class="ident" id="5025943">decOp</span>&nbsp;<span class="op" id="5025949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025952">rcvrType</span>&nbsp;<span class="op" id="5025961">:=</span>&nbsp;<span class="ident" id="5025964">ut</span><span class="op" id="5025966">.</span><span class="ident" id="5025967">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025973">if</span>&nbsp;<span class="ident" id="5025976">ut</span><span class="op" id="5025978">.</span><span class="ident" id="5025979">decIndir</span>&nbsp;<span class="op" id="5025988">==</span>&nbsp;<span class="op" id="5025991">-</span><span class="num" id="5025992">1</span>&nbsp;<span class="op" id="5025994">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025998">rcvrType</span>&nbsp;<span class="op" id="5026007">=</span>&nbsp;<span class="ident" id="5026009">reflect</span><span class="op" id="5026016">.</span><span class="ident" id="5026017">PtrTo</span><span class="op" id="5026022">(</span><span class="ident" id="5026023">rcvrType</span><span class="op" id="5026031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026034">}</span>&nbsp;<span class="keyword" id="5026036">else</span>&nbsp;<span class="keyword" id="5026041">if</span>&nbsp;<span class="ident" id="5026044">ut</span><span class="op" id="5026046">.</span><span class="ident" id="5026047">decIndir</span>&nbsp;<span class="op" id="5026056">&gt;</span>&nbsp;<span class="num" id="5026058">0</span>&nbsp;<span class="op" id="5026060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026064">for</span>&nbsp;<span class="ident" id="5026068">i</span>&nbsp;<span class="op" id="5026070">:=</span>&nbsp;<span class="builtintype" id="5026073">int8</span><span class="op" id="5026077">(</span><span class="num" id="5026078">0</span><span class="op" id="5026079">)</span><span class="op" id="5026080">;</span>&nbsp;<span class="ident" id="5026082">i</span>&nbsp;<span class="op" id="5026084">&lt;</span>&nbsp;<span class="ident" id="5026086">ut</span><span class="op" id="5026088">.</span><span class="ident" id="5026089">decIndir</span><span class="op" id="5026097">;</span>&nbsp;<span class="ident" id="5026099">i</span><span class="op" id="5026100">++</span>&nbsp;<span class="op" id="5026103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026108">rcvrType</span>&nbsp;<span class="op" id="5026117">=</span>&nbsp;<span class="ident" id="5026119">rcvrType</span><span class="op" id="5026127">.</span><span class="ident" id="5026128">Elem</span><span class="op" id="5026132">(</span><span class="op" id="5026133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026137">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026143">var</span>&nbsp;<span class="ident" id="5026147">op</span>&nbsp;<span class="ident" id="5026150">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026157">op</span>&nbsp;<span class="op" id="5026160">=</span>&nbsp;<span class="keyword" id="5026162">func</span><span class="op" id="5026166">(</span><span class="ident" id="5026167">i</span>&nbsp;<span class="op" id="5026169">*</span><span class="ident" id="5026170">decInstr</span><span class="op" id="5026178">,</span>&nbsp;<span class="ident" id="5026180">state</span>&nbsp;<span class="op" id="5026186">*</span><span class="ident" id="5026187">decoderState</span><span class="op" id="5026199">,</span>&nbsp;<span class="ident" id="5026201">value</span>&nbsp;<span class="ident" id="5026207">reflect</span><span class="op" id="5026214">.</span><span class="ident" id="5026215">Value</span><span class="op" id="5026220">)</span>&nbsp;<span class="op" id="5026222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5026226">//&nbsp;We&nbsp;now&nbsp;have&nbsp;the&nbsp;base&nbsp;type.&nbsp;We&nbsp;need&nbsp;its&nbsp;address&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026308">if</span>&nbsp;<span class="ident" id="5026311">value</span><span class="op" id="5026316">.</span><span class="ident" id="5026317">Kind</span><span class="op" id="5026321">(</span><span class="op" id="5026322">)</span>&nbsp;<span class="op" id="5026324">!=</span>&nbsp;<span class="ident" id="5026327">reflect</span><span class="op" id="5026334">.</span><span class="ident" id="5026335">Ptr</span>&nbsp;<span class="op" id="5026339">&amp;&amp;</span>&nbsp;<span class="ident" id="5026342">rcvrType</span><span class="op" id="5026350">.</span><span class="ident" id="5026351">Kind</span><span class="op" id="5026355">(</span><span class="op" id="5026356">)</span>&nbsp;<span class="op" id="5026358">==</span>&nbsp;<span class="ident" id="5026361">reflect</span><span class="op" id="5026368">.</span><span class="ident" id="5026369">Ptr</span>&nbsp;<span class="op" id="5026373">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026378">value</span>&nbsp;<span class="op" id="5026384">=</span>&nbsp;<span class="ident" id="5026386">value</span><span class="op" id="5026391">.</span><span class="ident" id="5026392">Addr</span><span class="op" id="5026396">(</span><span class="op" id="5026397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026405">state</span><span class="op" id="5026410">.</span><span class="ident" id="5026411">dec</span><span class="op" id="5026414">.</span><span class="ident" id="5026415">decodeGobDecoder</span><span class="op" id="5026431">(</span><span class="ident" id="5026432">ut</span><span class="op" id="5026434">,</span>&nbsp;<span class="ident" id="5026436">state</span><span class="op" id="5026441">,</span>&nbsp;<span class="ident" id="5026443">value</span><span class="op" id="5026448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026454">return</span>&nbsp;<span class="op" id="5026461">&amp;</span><span class="ident" id="5026462">op</span><br>
<span class="lineno">925</span><span class="op" id="5026465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5026468">//&nbsp;compatibleType&nbsp;asks:&nbsp;Are&nbsp;these&nbsp;two&nbsp;gob&nbsp;Types&nbsp;compatible?</span><br>
<span class="lineno"></span><span class="comment" id="5026528">//&nbsp;Answers&nbsp;the&nbsp;question&nbsp;for&nbsp;basic&nbsp;types,&nbsp;arrays,&nbsp;maps&nbsp;and&nbsp;slices,&nbsp;plus</span><br>
<span class="lineno"></span><span class="comment" id="5026599">//&nbsp;GobEncoder/Decoder&nbsp;pairs.</span><br>
<span class="lineno">930</span><span class="comment" id="5026628">//&nbsp;Structs&nbsp;are&nbsp;considered&nbsp;ok;&nbsp;fields&nbsp;will&nbsp;be&nbsp;checked&nbsp;later.</span><br>
<span class="lineno"></span><span class="keyword" id="5026688">func</span>&nbsp;<span class="op" id="5026693">(</span><span class="ident" id="5026694">dec</span>&nbsp;<span class="op" id="5026698">*</span><span class="ident" id="5026699">Decoder</span><span class="op" id="5026706">)</span>&nbsp;<span class="ident" id="5026708">compatibleType</span><span class="op" id="5026722">(</span><span class="ident" id="5026723">fr</span>&nbsp;<span class="ident" id="5026726">reflect</span><span class="op" id="5026733">.</span><span class="ident" id="5026734">Type</span><span class="op" id="5026738">,</span>&nbsp;<span class="ident" id="5026740">fw</span>&nbsp;<span class="ident" id="5026743">typeId</span><span class="op" id="5026749">,</span>&nbsp;<span class="ident" id="5026751">inProgress</span>&nbsp;<span class="keyword" id="5026762">map</span><span class="op" id="5026765">[</span><span class="ident" id="5026766">reflect</span><span class="op" id="5026773">.</span><span class="ident" id="5026774">Type</span><span class="op" id="5026778">]</span><span class="ident" id="5026779">typeId</span><span class="op" id="5026785">)</span>&nbsp;<span class="builtintype" id="5026787">bool</span>&nbsp;<span class="op" id="5026792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026795">if</span>&nbsp;<span class="ident" id="5026798">rhs</span><span class="op" id="5026801">,</span>&nbsp;<span class="ident" id="5026803">ok</span>&nbsp;<span class="op" id="5026806">:=</span>&nbsp;<span class="ident" id="5026809">inProgress</span><span class="op" id="5026819">[</span><span class="ident" id="5026820">fr</span><span class="op" id="5026822">]</span><span class="op" id="5026823">;</span>&nbsp;<span class="ident" id="5026825">ok</span>&nbsp;<span class="op" id="5026828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026832">return</span>&nbsp;<span class="ident" id="5026839">rhs</span>&nbsp;<span class="op" id="5026843">==</span>&nbsp;<span class="ident" id="5026846">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026850">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026853">inProgress</span><span class="op" id="5026863">[</span><span class="ident" id="5026864">fr</span><span class="op" id="5026866">]</span>&nbsp;<span class="op" id="5026868">=</span>&nbsp;<span class="ident" id="5026870">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026874">ut</span>&nbsp;<span class="op" id="5026877">:=</span>&nbsp;<span class="ident" id="5026880">userType</span><span class="op" id="5026888">(</span><span class="ident" id="5026889">fr</span><span class="op" id="5026891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026894">wire</span><span class="op" id="5026898">,</span>&nbsp;<span class="ident" id="5026900">ok</span>&nbsp;<span class="op" id="5026903">:=</span>&nbsp;<span class="ident" id="5026906">dec</span><span class="op" id="5026909">.</span><span class="ident" id="5026910">wireType</span><span class="op" id="5026918">[</span><span class="ident" id="5026919">fw</span><span class="op" id="5026921">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5026924">//&nbsp;If&nbsp;wire&nbsp;was&nbsp;encoded&nbsp;with&nbsp;an&nbsp;encoding&nbsp;method,&nbsp;fr&nbsp;must&nbsp;have&nbsp;that&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5026999">//&nbsp;And&nbsp;if&nbsp;not,&nbsp;it&nbsp;must&nbsp;not.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027028">//&nbsp;At&nbsp;most&nbsp;one&nbsp;of&nbsp;the&nbsp;booleans&nbsp;in&nbsp;ut&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027074">//&nbsp;We&nbsp;could&nbsp;possibly&nbsp;relax&nbsp;this&nbsp;constraint&nbsp;in&nbsp;the&nbsp;future&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027144">//&nbsp;choose&nbsp;the&nbsp;decoding&nbsp;method&nbsp;using&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;wireType.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027207">//&nbsp;The&nbsp;parentheses&nbsp;look&nbsp;odd&nbsp;but&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027253">if</span>&nbsp;<span class="op" id="5027256">(</span><span class="ident" id="5027257">ut</span><span class="op" id="5027259">.</span><span class="ident" id="5027260">externalDec</span>&nbsp;<span class="op" id="5027272">==</span>&nbsp;<span class="ident" id="5027275">xGob</span><span class="op" id="5027279">)</span>&nbsp;<span class="op" id="5027281">!=</span>&nbsp;<span class="op" id="5027284">(</span><span class="ident" id="5027285">ok</span>&nbsp;<span class="op" id="5027288">&amp;&amp;</span>&nbsp;<span class="ident" id="5027291">wire</span><span class="op" id="5027295">.</span><span class="ident" id="5027296">GobEncoderT</span>&nbsp;<span class="op" id="5027308">!=</span>&nbsp;<span class="ident" id="5027311">nil</span><span class="op" id="5027314">)</span>&nbsp;<span class="op" id="5027316">||</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027321">(</span><span class="ident" id="5027322">ut</span><span class="op" id="5027324">.</span><span class="ident" id="5027325">externalDec</span>&nbsp;<span class="op" id="5027337">==</span>&nbsp;<span class="ident" id="5027340">xBinary</span><span class="op" id="5027347">)</span>&nbsp;<span class="op" id="5027349">!=</span>&nbsp;<span class="op" id="5027352">(</span><span class="ident" id="5027353">ok</span>&nbsp;<span class="op" id="5027356">&amp;&amp;</span>&nbsp;<span class="ident" id="5027359">wire</span><span class="op" id="5027363">.</span><span class="ident" id="5027364">BinaryMarshalerT</span>&nbsp;<span class="op" id="5027381">!=</span>&nbsp;<span class="ident" id="5027384">nil</span><span class="op" id="5027387">)</span>&nbsp;<span class="op" id="5027389">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027394">(</span><span class="ident" id="5027395">ut</span><span class="op" id="5027397">.</span><span class="ident" id="5027398">externalDec</span>&nbsp;<span class="op" id="5027410">==</span>&nbsp;<span class="ident" id="5027413">xText</span><span class="op" id="5027418">)</span>&nbsp;<span class="op" id="5027420">!=</span>&nbsp;<span class="op" id="5027423">(</span><span class="ident" id="5027424">ok</span>&nbsp;<span class="op" id="5027427">&amp;&amp;</span>&nbsp;<span class="ident" id="5027430">wire</span><span class="op" id="5027434">.</span><span class="ident" id="5027435">TextMarshalerT</span>&nbsp;<span class="op" id="5027450">!=</span>&nbsp;<span class="ident" id="5027453">nil</span><span class="op" id="5027456">)</span>&nbsp;<span class="op" id="5027458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027462">return</span>&nbsp;<span class="builtintype" id="5027469">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027479">if</span>&nbsp;<span class="ident" id="5027482">ut</span><span class="op" id="5027484">.</span><span class="ident" id="5027485">externalDec</span>&nbsp;<span class="op" id="5027497">!=</span>&nbsp;<span class="num" id="5027500">0</span>&nbsp;<span class="op" id="5027502">{</span>&nbsp;<span class="comment" id="5027504">//&nbsp;This&nbsp;test&nbsp;trumps&nbsp;all&nbsp;others.</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027538">return</span>&nbsp;<span class="builtintype" id="5027545">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027554">switch</span>&nbsp;<span class="ident" id="5027561">t</span>&nbsp;<span class="op" id="5027563">:=</span>&nbsp;<span class="ident" id="5027566">ut</span><span class="op" id="5027568">.</span><span class="ident" id="5027569">base</span><span class="op" id="5027573">;</span>&nbsp;<span class="ident" id="5027575">t</span><span class="op" id="5027576">.</span><span class="ident" id="5027577">Kind</span><span class="op" id="5027581">(</span><span class="op" id="5027582">)</span>&nbsp;<span class="op" id="5027584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027587">default</span><span class="op" id="5027594">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027598">//&nbsp;chan,&nbsp;etc:&nbsp;cannot&nbsp;handle.</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027629">return</span>&nbsp;<span class="builtintype" id="5027636">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027643">case</span>&nbsp;<span class="ident" id="5027648">reflect</span><span class="op" id="5027655">.</span><span class="ident" id="5027656">Bool</span><span class="op" id="5027660">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027664">return</span>&nbsp;<span class="ident" id="5027671">fw</span>&nbsp;<span class="op" id="5027674">==</span>&nbsp;<span class="ident" id="5027677">tBool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027684">case</span>&nbsp;<span class="ident" id="5027689">reflect</span><span class="op" id="5027696">.</span><span class="ident" id="5027697">Int</span><span class="op" id="5027700">,</span>&nbsp;<span class="ident" id="5027702">reflect</span><span class="op" id="5027709">.</span><span class="ident" id="5027710">Int8</span><span class="op" id="5027714">,</span>&nbsp;<span class="ident" id="5027716">reflect</span><span class="op" id="5027723">.</span><span class="ident" id="5027724">Int16</span><span class="op" id="5027729">,</span>&nbsp;<span class="ident" id="5027731">reflect</span><span class="op" id="5027738">.</span><span class="ident" id="5027739">Int32</span><span class="op" id="5027744">,</span>&nbsp;<span class="ident" id="5027746">reflect</span><span class="op" id="5027753">.</span><span class="ident" id="5027754">Int64</span><span class="op" id="5027759">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027763">return</span>&nbsp;<span class="ident" id="5027770">fw</span>&nbsp;<span class="op" id="5027773">==</span>&nbsp;<span class="ident" id="5027776">tInt</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027782">case</span>&nbsp;<span class="ident" id="5027787">reflect</span><span class="op" id="5027794">.</span><span class="ident" id="5027795">Uint</span><span class="op" id="5027799">,</span>&nbsp;<span class="ident" id="5027801">reflect</span><span class="op" id="5027808">.</span><span class="ident" id="5027809">Uint8</span><span class="op" id="5027814">,</span>&nbsp;<span class="ident" id="5027816">reflect</span><span class="op" id="5027823">.</span><span class="ident" id="5027824">Uint16</span><span class="op" id="5027830">,</span>&nbsp;<span class="ident" id="5027832">reflect</span><span class="op" id="5027839">.</span><span class="ident" id="5027840">Uint32</span><span class="op" id="5027846">,</span>&nbsp;<span class="ident" id="5027848">reflect</span><span class="op" id="5027855">.</span><span class="ident" id="5027856">Uint64</span><span class="op" id="5027862">,</span>&nbsp;<span class="ident" id="5027864">reflect</span><span class="op" id="5027871">.</span><span class="ident" id="5027872">Uintptr</span><span class="op" id="5027879">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027883">return</span>&nbsp;<span class="ident" id="5027890">fw</span>&nbsp;<span class="op" id="5027893">==</span>&nbsp;<span class="ident" id="5027896">tUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027903">case</span>&nbsp;<span class="ident" id="5027908">reflect</span><span class="op" id="5027915">.</span><span class="ident" id="5027916">Float32</span><span class="op" id="5027923">,</span>&nbsp;<span class="ident" id="5027925">reflect</span><span class="op" id="5027932">.</span><span class="ident" id="5027933">Float64</span><span class="op" id="5027940">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027944">return</span>&nbsp;<span class="ident" id="5027951">fw</span>&nbsp;<span class="op" id="5027954">==</span>&nbsp;<span class="ident" id="5027957">tFloat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027965">case</span>&nbsp;<span class="ident" id="5027970">reflect</span><span class="op" id="5027977">.</span><span class="ident" id="5027978">Complex64</span><span class="op" id="5027987">,</span>&nbsp;<span class="ident" id="5027989">reflect</span><span class="op" id="5027996">.</span><span class="ident" id="5027997">Complex128</span><span class="op" id="5028007">:</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028011">return</span>&nbsp;<span class="ident" id="5028018">fw</span>&nbsp;<span class="op" id="5028021">==</span>&nbsp;<span class="ident" id="5028024">tComplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028034">case</span>&nbsp;<span class="ident" id="5028039">reflect</span><span class="op" id="5028046">.</span><span class="ident" id="5028047">String</span><span class="op" id="5028053">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028057">return</span>&nbsp;<span class="ident" id="5028064">fw</span>&nbsp;<span class="op" id="5028067">==</span>&nbsp;<span class="ident" id="5028070">tString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028079">case</span>&nbsp;<span class="ident" id="5028084">reflect</span><span class="op" id="5028091">.</span><span class="ident" id="5028092">Interface</span><span class="op" id="5028101">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028105">return</span>&nbsp;<span class="ident" id="5028112">fw</span>&nbsp;<span class="op" id="5028115">==</span>&nbsp;<span class="ident" id="5028118">tInterface</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028130">case</span>&nbsp;<span class="ident" id="5028135">reflect</span><span class="op" id="5028142">.</span><span class="ident" id="5028143">Array</span><span class="op" id="5028148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028152">if</span>&nbsp;<span class="op" id="5028155">!</span><span class="ident" id="5028156">ok</span>&nbsp;<span class="op" id="5028159">||</span>&nbsp;<span class="ident" id="5028162">wire</span><span class="op" id="5028166">.</span><span class="ident" id="5028167">ArrayT</span>&nbsp;<span class="op" id="5028174">==</span>&nbsp;<span class="ident" id="5028177">nil</span>&nbsp;<span class="op" id="5028181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028186">return</span>&nbsp;<span class="builtintype" id="5028193">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028205">array</span>&nbsp;<span class="op" id="5028211">:=</span>&nbsp;<span class="ident" id="5028214">wire</span><span class="op" id="5028218">.</span><span class="ident" id="5028219">ArrayT</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028228">return</span>&nbsp;<span class="ident" id="5028235">t</span><span class="op" id="5028236">.</span><span class="ident" id="5028237">Len</span><span class="op" id="5028240">(</span><span class="op" id="5028241">)</span>&nbsp;<span class="op" id="5028243">==</span>&nbsp;<span class="ident" id="5028246">array</span><span class="op" id="5028251">.</span><span class="ident" id="5028252">Len</span>&nbsp;<span class="op" id="5028256">&amp;&amp;</span>&nbsp;<span class="ident" id="5028259">dec</span><span class="op" id="5028262">.</span><span class="ident" id="5028263">compatibleType</span><span class="op" id="5028277">(</span><span class="ident" id="5028278">t</span><span class="op" id="5028279">.</span><span class="ident" id="5028280">Elem</span><span class="op" id="5028284">(</span><span class="op" id="5028285">)</span><span class="op" id="5028286">,</span>&nbsp;<span class="ident" id="5028288">array</span><span class="op" id="5028293">.</span><span class="ident" id="5028294">Elem</span><span class="op" id="5028298">,</span>&nbsp;<span class="ident" id="5028300">inProgress</span><span class="op" id="5028310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028313">case</span>&nbsp;<span class="ident" id="5028318">reflect</span><span class="op" id="5028325">.</span><span class="ident" id="5028326">Map</span><span class="op" id="5028329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028333">if</span>&nbsp;<span class="op" id="5028336">!</span><span class="ident" id="5028337">ok</span>&nbsp;<span class="op" id="5028340">||</span>&nbsp;<span class="ident" id="5028343">wire</span><span class="op" id="5028347">.</span><span class="ident" id="5028348">MapT</span>&nbsp;<span class="op" id="5028353">==</span>&nbsp;<span class="ident" id="5028356">nil</span>&nbsp;<span class="op" id="5028360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028365">return</span>&nbsp;<span class="builtintype" id="5028372">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028380">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028384">MapType</span>&nbsp;<span class="op" id="5028392">:=</span>&nbsp;<span class="ident" id="5028395">wire</span><span class="op" id="5028399">.</span><span class="ident" id="5028400">MapT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028407">return</span>&nbsp;<span class="ident" id="5028414">dec</span><span class="op" id="5028417">.</span><span class="ident" id="5028418">compatibleType</span><span class="op" id="5028432">(</span><span class="ident" id="5028433">t</span><span class="op" id="5028434">.</span><span class="ident" id="5028435">Key</span><span class="op" id="5028438">(</span><span class="op" id="5028439">)</span><span class="op" id="5028440">,</span>&nbsp;<span class="ident" id="5028442">MapType</span><span class="op" id="5028449">.</span><span class="ident" id="5028450">Key</span><span class="op" id="5028453">,</span>&nbsp;<span class="ident" id="5028455">inProgress</span><span class="op" id="5028465">)</span>&nbsp;<span class="op" id="5028467">&amp;&amp;</span>&nbsp;<span class="ident" id="5028470">dec</span><span class="op" id="5028473">.</span><span class="ident" id="5028474">compatibleType</span><span class="op" id="5028488">(</span><span class="ident" id="5028489">t</span><span class="op" id="5028490">.</span><span class="ident" id="5028491">Elem</span><span class="op" id="5028495">(</span><span class="op" id="5028496">)</span><span class="op" id="5028497">,</span>&nbsp;<span class="ident" id="5028499">MapType</span><span class="op" id="5028506">.</span><span class="ident" id="5028507">Elem</span><span class="op" id="5028511">,</span>&nbsp;<span class="ident" id="5028513">inProgress</span><span class="op" id="5028523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028526">case</span>&nbsp;<span class="ident" id="5028531">reflect</span><span class="op" id="5028538">.</span><span class="ident" id="5028539">Slice</span><span class="op" id="5028544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5028548">//&nbsp;Is&nbsp;it&nbsp;an&nbsp;array&nbsp;of&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028578">if</span>&nbsp;<span class="ident" id="5028581">t</span><span class="op" id="5028582">.</span><span class="ident" id="5028583">Elem</span><span class="op" id="5028587">(</span><span class="op" id="5028588">)</span><span class="op" id="5028589">.</span><span class="ident" id="5028590">Kind</span><span class="op" id="5028594">(</span><span class="op" id="5028595">)</span>&nbsp;<span class="op" id="5028597">==</span>&nbsp;<span class="ident" id="5028600">reflect</span><span class="op" id="5028607">.</span><span class="ident" id="5028608">Uint8</span>&nbsp;<span class="op" id="5028614">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028619">return</span>&nbsp;<span class="ident" id="5028626">fw</span>&nbsp;<span class="op" id="5028629">==</span>&nbsp;<span class="ident" id="5028632">tBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5028645">//&nbsp;Extract&nbsp;and&nbsp;compare&nbsp;element&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028685">var</span>&nbsp;<span class="ident" id="5028689">sw</span>&nbsp;<span class="op" id="5028692">*</span><span class="ident" id="5028693">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028705">if</span>&nbsp;<span class="ident" id="5028708">tt</span><span class="op" id="5028710">,</span>&nbsp;<span class="ident" id="5028712">ok</span>&nbsp;<span class="op" id="5028715">:=</span>&nbsp;<span class="ident" id="5028718">builtinIdToType</span><span class="op" id="5028733">[</span><span class="ident" id="5028734">fw</span><span class="op" id="5028736">]</span><span class="op" id="5028737">;</span>&nbsp;<span class="ident" id="5028739">ok</span>&nbsp;<span class="op" id="5028742">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028747">sw</span><span class="op" id="5028749">,</span>&nbsp;<span class="ident" id="5028751">_</span>&nbsp;<span class="op" id="5028753">=</span>&nbsp;<span class="ident" id="5028755">tt</span><span class="op" id="5028757">.</span><span class="op" id="5028758">(</span><span class="op" id="5028759">*</span><span class="ident" id="5028760">sliceType</span><span class="op" id="5028769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028773">}</span>&nbsp;<span class="keyword" id="5028775">else</span>&nbsp;<span class="keyword" id="5028780">if</span>&nbsp;<span class="ident" id="5028783">wire</span>&nbsp;<span class="op" id="5028788">!=</span>&nbsp;<span class="ident" id="5028791">nil</span>&nbsp;<span class="op" id="5028795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028800">sw</span>&nbsp;<span class="op" id="5028803">=</span>&nbsp;<span class="ident" id="5028805">wire</span><span class="op" id="5028809">.</span><span class="ident" id="5028810">SliceT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028823">elem</span>&nbsp;<span class="op" id="5028828">:=</span>&nbsp;<span class="ident" id="5028831">userType</span><span class="op" id="5028839">(</span><span class="ident" id="5028840">t</span><span class="op" id="5028841">.</span><span class="ident" id="5028842">Elem</span><span class="op" id="5028846">(</span><span class="op" id="5028847">)</span><span class="op" id="5028848">)</span><span class="op" id="5028849">.</span><span class="ident" id="5028850">base</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028857">return</span>&nbsp;<span class="ident" id="5028864">sw</span>&nbsp;<span class="op" id="5028867">!=</span>&nbsp;<span class="ident" id="5028870">nil</span>&nbsp;<span class="op" id="5028874">&amp;&amp;</span>&nbsp;<span class="ident" id="5028877">dec</span><span class="op" id="5028880">.</span><span class="ident" id="5028881">compatibleType</span><span class="op" id="5028895">(</span><span class="ident" id="5028896">elem</span><span class="op" id="5028900">,</span>&nbsp;<span class="ident" id="5028902">sw</span><span class="op" id="5028904">.</span><span class="ident" id="5028905">Elem</span><span class="op" id="5028909">,</span>&nbsp;<span class="ident" id="5028911">inProgress</span><span class="op" id="5028921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028924">case</span>&nbsp;<span class="ident" id="5028929">reflect</span><span class="op" id="5028936">.</span><span class="ident" id="5028937">Struct</span><span class="op" id="5028943">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028947">return</span>&nbsp;<span class="builtintype" id="5028954">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028960">}</span><br>
<span class="lineno"></span><span class="op" id="5028962">}</span><br>
<span class="lineno">1000</span><br>
<span class="lineno"></span><span class="comment" id="5028965">//&nbsp;typeString&nbsp;returns&nbsp;a&nbsp;human-readable&nbsp;description&nbsp;of&nbsp;the&nbsp;type&nbsp;identified&nbsp;by&nbsp;remoteId.</span><br>
<span class="lineno"></span><span class="keyword" id="5029052">func</span>&nbsp;<span class="op" id="5029057">(</span><span class="ident" id="5029058">dec</span>&nbsp;<span class="op" id="5029062">*</span><span class="ident" id="5029063">Decoder</span><span class="op" id="5029070">)</span>&nbsp;<span class="ident" id="5029072">typeString</span><span class="op" id="5029082">(</span><span class="ident" id="5029083">remoteId</span>&nbsp;<span class="ident" id="5029092">typeId</span><span class="op" id="5029098">)</span>&nbsp;<span class="builtintype" id="5029100">string</span>&nbsp;<span class="op" id="5029107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5029110">if</span>&nbsp;<span class="ident" id="5029113">t</span>&nbsp;<span class="op" id="5029115">:=</span>&nbsp;<span class="ident" id="5029118">idToType</span><span class="op" id="5029126">[</span><span class="ident" id="5029127">remoteId</span><span class="op" id="5029135">]</span><span class="op" id="5029136">;</span>&nbsp;<span class="ident" id="5029138">t</span>&nbsp;<span class="op" id="5029140">!=</span>&nbsp;<span class="ident" id="5029143">nil</span>&nbsp;<span class="op" id="5029147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5029151">//&nbsp;globally&nbsp;known&nbsp;type.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5029177">return</span>&nbsp;<span class="ident" id="5029184">t</span><span class="op" id="5029185">.</span><span class="builtintype" id="5029186">string</span><span class="op" id="5029192">(</span><span class="op" id="5029193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5029196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5029199">return</span>&nbsp;<span class="ident" id="5029206">dec</span><span class="op" id="5029209">.</span><span class="ident" id="5029210">wireType</span><span class="op" id="5029218">[</span><span class="ident" id="5029219">remoteId</span><span class="op" id="5029227">]</span><span class="op" id="5029228">.</span><span class="builtintype" id="5029229">string</span><span class="op" id="5029235">(</span><span class="op" id="5029236">)</span><br>
<span class="lineno"></span><span class="op" id="5029238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="5029241">//&nbsp;compileSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value,&nbsp;including</span><br>
<span class="lineno"></span><span class="comment" id="5029330">//&nbsp;GobDecoders.</span><br>
<span class="lineno"></span><span class="keyword" id="5029346">func</span>&nbsp;<span class="op" id="5029351">(</span><span class="ident" id="5029352">dec</span>&nbsp;<span class="op" id="5029356">*</span><span class="ident" id="5029357">Decoder</span><span class="op" id="5029364">)</span>&nbsp;<span class="ident" id="5029366">compileSingle</span><span class="op" id="5029379">(</span><span class="ident" id="5029380">remoteId</span>&nbsp;<span class="ident" id="5029389">typeId</span><span class="op" id="5029395">,</span>&nbsp;<span class="ident" id="5029397">ut</span>&nbsp;<span class="op" id="5029400">*</span><span class="ident" id="5029401">userTypeInfo</span><span class="op" id="5029413">)</span>&nbsp;<span class="op" id="5029415">(</span><span class="ident" id="5029416">engine</span>&nbsp;<span class="op" id="5029423">*</span><span class="ident" id="5029424">decEngine</span><span class="op" id="5029433">,</span>&nbsp;<span class="ident" id="5029435">err</span>&nbsp;<span class="builtintype" id="5029439">error</span><span class="op" id="5029444">)</span>&nbsp;<span class="op" id="5029446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5029449">rt</span>&nbsp;<span class="op" id="5029452">:=</span>&nbsp;<span class="ident" id="5029455">ut</span><span class="op" id="5029457">.</span><span class="ident" id="5029458">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5029464">engine</span>&nbsp;<span class="op" id="5029471">=</span>&nbsp;<span class="builtinfunc" id="5029473">new</span><span class="op" id="5029476">(</span><span class="ident" id="5029477">decEngine</span><span class="op" id="5029486">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5029489">engine</span><span class="op" id="5029495">.</span><span class="ident" id="5029496">instr</span>&nbsp;<span class="op" id="5029502">=</span>&nbsp;<span class="builtinfunc" id="5029504">make</span><span class="op" id="5029508">(</span><span class="op" id="5029509">[</span><span class="op" id="5029510">]</span><span class="ident" id="5029511">decInstr</span><span class="op" id="5029519">,</span>&nbsp;<span class="num" id="5029521">1</span><span class="op" id="5029522">)</span>&nbsp;<span class="comment" id="5029524">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5029537">name</span>&nbsp;<span class="op" id="5029542">:=</span>&nbsp;<span class="ident" id="5029545">rt</span><span class="op" id="5029547">.</span><span class="ident" id="5029548">String</span><span class="op" id="5029554">(</span><span class="op" id="5029555">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5029572">//&nbsp;best&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5029591">if</span>&nbsp;<span class="op" id="5029594">!</span><span class="ident" id="5029595">dec</span><span class="op" id="5029598">.</span><span class="ident" id="5029599">compatibleType</span><span class="op" id="5029613">(</span><span class="ident" id="5029614">rt</span><span class="op" id="5029616">,</span>&nbsp;<span class="ident" id="5029618">remoteId</span><span class="op" id="5029626">,</span>&nbsp;<span class="builtinfunc" id="5029628">make</span><span class="op" id="5029632">(</span><span class="keyword" id="5029633">map</span><span class="op" id="5029636">[</span><span class="ident" id="5029637">reflect</span><span class="op" id="5029644">.</span><span class="ident" id="5029645">Type</span><span class="op" id="5029649">]</span><span class="ident" id="5029650">typeId</span><span class="op" id="5029656">)</span><span class="op" id="5029657">)</span>&nbsp;<span class="op" id="5029659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5029663">remoteType</span>&nbsp;<span class="op" id="5029674">:=</span>&nbsp;<span class="ident" id="5029677">dec</span><span class="op" id="5029680">.</span><span class="ident" id="5029681">typeString</span><span class="op" id="5029691">(</span><span class="ident" id="5029692">remoteId</span><span class="op" id="5029700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5029704">//&nbsp;Common&nbsp;confusing&nbsp;case:&nbsp;local&nbsp;interface&nbsp;type,&nbsp;remote&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5029776">if</span>&nbsp;<span class="ident" id="5029779">ut</span><span class="op" id="5029781">.</span><span class="ident" id="5029782">base</span><span class="op" id="5029786">.</span><span class="ident" id="5029787">Kind</span><span class="op" id="5029791">(</span><span class="op" id="5029792">)</span>&nbsp;<span class="op" id="5029794">==</span>&nbsp;<span class="ident" id="5029797">reflect</span><span class="op" id="5029804">.</span><span class="ident" id="5029805">Interface</span>&nbsp;<span class="op" id="5029815">&amp;&amp;</span>&nbsp;<span class="ident" id="5029818">remoteId</span>&nbsp;<span class="op" id="5029827">!=</span>&nbsp;<span class="ident" id="5029830">tInterface</span>&nbsp;<span class="op" id="5029841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5029846">return</span>&nbsp;<span class="ident" id="5029853">nil</span><span class="op" id="5029856">,</span>&nbsp;<span class="ident" id="5029858">errors</span><span class="op" id="5029864">.</span><span class="ident" id="5029865">New</span><span class="op" id="5029868">(</span><span class="string" id="5029869">&#34;gob:&nbsp;local&nbsp;interface&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5029898">+</span>&nbsp;<span class="ident" id="5029900">name</span>&nbsp;<span class="op" id="5029905">+</span>&nbsp;<span class="string" id="5029907">&#34;&nbsp;can&nbsp;only&nbsp;be&nbsp;decoded&nbsp;from&nbsp;remote&nbsp;interface&nbsp;type;&nbsp;received&nbsp;concrete&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5029982">+</span>&nbsp;<span class="ident" id="5029984">remoteType</span><span class="op" id="5029994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5029998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5030002">return</span>&nbsp;<span class="ident" id="5030009">nil</span><span class="op" id="5030012">,</span>&nbsp;<span class="ident" id="5030014">errors</span><span class="op" id="5030020">.</span><span class="ident" id="5030021">New</span><span class="op" id="5030024">(</span><span class="string" id="5030025">&#34;gob:&nbsp;decoding&nbsp;into&nbsp;local&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5030058">+</span>&nbsp;<span class="ident" id="5030060">name</span>&nbsp;<span class="op" id="5030065">+</span>&nbsp;<span class="string" id="5030067">&#34;,&nbsp;received&nbsp;remote&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5030093">+</span>&nbsp;<span class="ident" id="5030095">remoteType</span><span class="op" id="5030105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5030108">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030111">op</span>&nbsp;<span class="op" id="5030114">:=</span>&nbsp;<span class="ident" id="5030117">dec</span><span class="op" id="5030120">.</span><span class="ident" id="5030121">decOpFor</span><span class="op" id="5030129">(</span><span class="ident" id="5030130">remoteId</span><span class="op" id="5030138">,</span>&nbsp;<span class="ident" id="5030140">rt</span><span class="op" id="5030142">,</span>&nbsp;<span class="ident" id="5030144">name</span><span class="op" id="5030148">,</span>&nbsp;<span class="builtinfunc" id="5030150">make</span><span class="op" id="5030154">(</span><span class="keyword" id="5030155">map</span><span class="op" id="5030158">[</span><span class="ident" id="5030159">reflect</span><span class="op" id="5030166">.</span><span class="ident" id="5030167">Type</span><span class="op" id="5030171">]</span><span class="op" id="5030172">*</span><span class="ident" id="5030173">decOp</span><span class="op" id="5030178">)</span><span class="op" id="5030179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030182">ovfl</span>&nbsp;<span class="op" id="5030187">:=</span>&nbsp;<span class="ident" id="5030190">errors</span><span class="op" id="5030196">.</span><span class="ident" id="5030197">New</span><span class="op" id="5030200">(</span><span class="string" id="5030201">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="5030215">+</span>&nbsp;<span class="ident" id="5030217">name</span>&nbsp;<span class="op" id="5030222">+</span>&nbsp;<span class="string" id="5030224">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="5030240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030243">engine</span><span class="op" id="5030249">.</span><span class="ident" id="5030250">instr</span><span class="op" id="5030255">[</span><span class="ident" id="5030256">singletonField</span><span class="op" id="5030270">]</span>&nbsp;<span class="op" id="5030272">=</span>&nbsp;<span class="ident" id="5030274">decInstr</span><span class="op" id="5030282">{</span><span class="op" id="5030283">*</span><span class="ident" id="5030284">op</span><span class="op" id="5030286">,</span>&nbsp;<span class="ident" id="5030288">singletonField</span><span class="op" id="5030302">,</span>&nbsp;<span class="ident" id="5030304">nil</span><span class="op" id="5030307">,</span>&nbsp;<span class="ident" id="5030309">ovfl</span><span class="op" id="5030313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030316">engine</span><span class="op" id="5030322">.</span><span class="ident" id="5030323">numInstr</span>&nbsp;<span class="op" id="5030332">=</span>&nbsp;<span class="num" id="5030334">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5030337">return</span><br>
<span class="lineno">1030</span><span class="op" id="5030344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5030347">//&nbsp;compileIgnoreSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value&nbsp;that&nbsp;will&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5030455">func</span>&nbsp;<span class="op" id="5030460">(</span><span class="ident" id="5030461">dec</span>&nbsp;<span class="op" id="5030465">*</span><span class="ident" id="5030466">Decoder</span><span class="op" id="5030473">)</span>&nbsp;<span class="ident" id="5030475">compileIgnoreSingle</span><span class="op" id="5030494">(</span><span class="ident" id="5030495">remoteId</span>&nbsp;<span class="ident" id="5030504">typeId</span><span class="op" id="5030510">)</span>&nbsp;<span class="op" id="5030512">(</span><span class="ident" id="5030513">engine</span>&nbsp;<span class="op" id="5030520">*</span><span class="ident" id="5030521">decEngine</span><span class="op" id="5030530">,</span>&nbsp;<span class="ident" id="5030532">err</span>&nbsp;<span class="builtintype" id="5030536">error</span><span class="op" id="5030541">)</span>&nbsp;<span class="op" id="5030543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030546">engine</span>&nbsp;<span class="op" id="5030553">=</span>&nbsp;<span class="builtinfunc" id="5030555">new</span><span class="op" id="5030558">(</span><span class="ident" id="5030559">decEngine</span><span class="op" id="5030568">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030571">engine</span><span class="op" id="5030577">.</span><span class="ident" id="5030578">instr</span>&nbsp;<span class="op" id="5030584">=</span>&nbsp;<span class="builtinfunc" id="5030586">make</span><span class="op" id="5030590">(</span><span class="op" id="5030591">[</span><span class="op" id="5030592">]</span><span class="ident" id="5030593">decInstr</span><span class="op" id="5030601">,</span>&nbsp;<span class="num" id="5030603">1</span><span class="op" id="5030604">)</span>&nbsp;<span class="comment" id="5030606">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030619">op</span>&nbsp;<span class="op" id="5030622">:=</span>&nbsp;<span class="ident" id="5030625">dec</span><span class="op" id="5030628">.</span><span class="ident" id="5030629">decIgnoreOpFor</span><span class="op" id="5030643">(</span><span class="ident" id="5030644">remoteId</span><span class="op" id="5030652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030655">ovfl</span>&nbsp;<span class="op" id="5030660">:=</span>&nbsp;<span class="ident" id="5030663">overflow</span><span class="op" id="5030671">(</span><span class="ident" id="5030672">dec</span><span class="op" id="5030675">.</span><span class="ident" id="5030676">typeString</span><span class="op" id="5030686">(</span><span class="ident" id="5030687">remoteId</span><span class="op" id="5030695">)</span><span class="op" id="5030696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030699">engine</span><span class="op" id="5030705">.</span><span class="ident" id="5030706">instr</span><span class="op" id="5030711">[</span><span class="num" id="5030712">0</span><span class="op" id="5030713">]</span>&nbsp;<span class="op" id="5030715">=</span>&nbsp;<span class="ident" id="5030717">decInstr</span><span class="op" id="5030725">{</span><span class="ident" id="5030726">op</span><span class="op" id="5030728">,</span>&nbsp;<span class="num" id="5030730">0</span><span class="op" id="5030731">,</span>&nbsp;<span class="ident" id="5030733">nil</span><span class="op" id="5030736">,</span>&nbsp;<span class="ident" id="5030738">ovfl</span><span class="op" id="5030742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030745">engine</span><span class="op" id="5030751">.</span><span class="ident" id="5030752">numInstr</span>&nbsp;<span class="op" id="5030761">=</span>&nbsp;<span class="num" id="5030763">1</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5030766">return</span><br>
<span class="lineno"></span><span class="op" id="5030773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5030776">//&nbsp;compileDec&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;value.&nbsp;&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;a&nbsp;struct,</span><br>
<span class="lineno"></span><span class="comment" id="5030862">//&nbsp;it&nbsp;calls&nbsp;out&nbsp;to&nbsp;compileSingle.</span><br>
<span class="lineno">1045</span><span class="keyword" id="5030896">func</span>&nbsp;<span class="op" id="5030901">(</span><span class="ident" id="5030902">dec</span>&nbsp;<span class="op" id="5030906">*</span><span class="ident" id="5030907">Decoder</span><span class="op" id="5030914">)</span>&nbsp;<span class="ident" id="5030916">compileDec</span><span class="op" id="5030926">(</span><span class="ident" id="5030927">remoteId</span>&nbsp;<span class="ident" id="5030936">typeId</span><span class="op" id="5030942">,</span>&nbsp;<span class="ident" id="5030944">ut</span>&nbsp;<span class="op" id="5030947">*</span><span class="ident" id="5030948">userTypeInfo</span><span class="op" id="5030960">)</span>&nbsp;<span class="op" id="5030962">(</span><span class="ident" id="5030963">engine</span>&nbsp;<span class="op" id="5030970">*</span><span class="ident" id="5030971">decEngine</span><span class="op" id="5030980">,</span>&nbsp;<span class="ident" id="5030982">err</span>&nbsp;<span class="builtintype" id="5030986">error</span><span class="op" id="5030991">)</span>&nbsp;<span class="op" id="5030993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030996">rt</span>&nbsp;<span class="op" id="5030999">:=</span>&nbsp;<span class="ident" id="5031002">ut</span><span class="op" id="5031004">.</span><span class="ident" id="5031005">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031011">srt</span>&nbsp;<span class="op" id="5031015">:=</span>&nbsp;<span class="ident" id="5031018">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5031022">if</span>&nbsp;<span class="ident" id="5031025">srt</span><span class="op" id="5031028">.</span><span class="ident" id="5031029">Kind</span><span class="op" id="5031033">(</span><span class="op" id="5031034">)</span>&nbsp;<span class="op" id="5031036">!=</span>&nbsp;<span class="ident" id="5031039">reflect</span><span class="op" id="5031046">.</span><span class="ident" id="5031047">Struct</span>&nbsp;<span class="op" id="5031054">||</span>&nbsp;<span class="ident" id="5031057">ut</span><span class="op" id="5031059">.</span><span class="ident" id="5031060">externalDec</span>&nbsp;<span class="op" id="5031072">!=</span>&nbsp;<span class="num" id="5031075">0</span>&nbsp;<span class="op" id="5031077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5031081">return</span>&nbsp;<span class="ident" id="5031088">dec</span><span class="op" id="5031091">.</span><span class="ident" id="5031092">compileSingle</span><span class="op" id="5031105">(</span><span class="ident" id="5031106">remoteId</span><span class="op" id="5031114">,</span>&nbsp;<span class="ident" id="5031116">ut</span><span class="op" id="5031118">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5031121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5031124">var</span>&nbsp;<span class="ident" id="5031128">wireStruct</span>&nbsp;<span class="op" id="5031139">*</span><span class="ident" id="5031140">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5031152">//&nbsp;Builtin&nbsp;types&nbsp;can&nbsp;come&nbsp;from&nbsp;global&nbsp;pool;&nbsp;the&nbsp;rest&nbsp;must&nbsp;be&nbsp;defined&nbsp;by&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5031238">//&nbsp;Also&nbsp;we&nbsp;know&nbsp;we&#39;re&nbsp;decoding&nbsp;a&nbsp;struct&nbsp;now,&nbsp;so&nbsp;the&nbsp;client&nbsp;must&nbsp;have&nbsp;sent&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5031318">if</span>&nbsp;<span class="ident" id="5031321">t</span><span class="op" id="5031322">,</span>&nbsp;<span class="ident" id="5031324">ok</span>&nbsp;<span class="op" id="5031327">:=</span>&nbsp;<span class="ident" id="5031330">builtinIdToType</span><span class="op" id="5031345">[</span><span class="ident" id="5031346">remoteId</span><span class="op" id="5031354">]</span><span class="op" id="5031355">;</span>&nbsp;<span class="ident" id="5031357">ok</span>&nbsp;<span class="op" id="5031360">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031364">wireStruct</span><span class="op" id="5031374">,</span>&nbsp;<span class="ident" id="5031376">_</span>&nbsp;<span class="op" id="5031378">=</span>&nbsp;<span class="ident" id="5031380">t</span><span class="op" id="5031381">.</span><span class="op" id="5031382">(</span><span class="op" id="5031383">*</span><span class="ident" id="5031384">structType</span><span class="op" id="5031394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5031397">}</span>&nbsp;<span class="keyword" id="5031399">else</span>&nbsp;<span class="op" id="5031404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031408">wire</span>&nbsp;<span class="op" id="5031413">:=</span>&nbsp;<span class="ident" id="5031416">dec</span><span class="op" id="5031419">.</span><span class="ident" id="5031420">wireType</span><span class="op" id="5031428">[</span><span class="ident" id="5031429">remoteId</span><span class="op" id="5031437">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5031441">if</span>&nbsp;<span class="ident" id="5031444">wire</span>&nbsp;<span class="op" id="5031449">==</span>&nbsp;<span class="ident" id="5031452">nil</span>&nbsp;<span class="op" id="5031456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031461">error_</span><span class="op" id="5031467">(</span><span class="ident" id="5031468">errBadType</span><span class="op" id="5031478">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5031482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031486">wireStruct</span>&nbsp;<span class="op" id="5031497">=</span>&nbsp;<span class="ident" id="5031499">wire</span><span class="op" id="5031503">.</span><span class="ident" id="5031504">StructT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5031513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5031516">if</span>&nbsp;<span class="ident" id="5031519">wireStruct</span>&nbsp;<span class="op" id="5031530">==</span>&nbsp;<span class="ident" id="5031533">nil</span>&nbsp;<span class="op" id="5031537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031541">errorf</span><span class="op" id="5031547">(</span><span class="string" id="5031548">&#34;type&nbsp;mismatch&nbsp;in&nbsp;decoder:&nbsp;want&nbsp;struct&nbsp;type&nbsp;%s;&nbsp;got&nbsp;non-struct&#34;</span><span class="op" id="5031611">,</span>&nbsp;<span class="ident" id="5031613">rt</span><span class="op" id="5031615">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5031618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031621">engine</span>&nbsp;<span class="op" id="5031628">=</span>&nbsp;<span class="builtinfunc" id="5031630">new</span><span class="op" id="5031633">(</span><span class="ident" id="5031634">decEngine</span><span class="op" id="5031643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031646">engine</span><span class="op" id="5031652">.</span><span class="ident" id="5031653">instr</span>&nbsp;<span class="op" id="5031659">=</span>&nbsp;<span class="builtinfunc" id="5031661">make</span><span class="op" id="5031665">(</span><span class="op" id="5031666">[</span><span class="op" id="5031667">]</span><span class="ident" id="5031668">decInstr</span><span class="op" id="5031676">,</span>&nbsp;<span class="builtinfunc" id="5031678">len</span><span class="op" id="5031681">(</span><span class="ident" id="5031682">wireStruct</span><span class="op" id="5031692">.</span><span class="ident" id="5031693">Field</span><span class="op" id="5031698">)</span><span class="op" id="5031699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031702">seen</span>&nbsp;<span class="op" id="5031707">:=</span>&nbsp;<span class="builtinfunc" id="5031710">make</span><span class="op" id="5031714">(</span><span class="keyword" id="5031715">map</span><span class="op" id="5031718">[</span><span class="ident" id="5031719">reflect</span><span class="op" id="5031726">.</span><span class="ident" id="5031727">Type</span><span class="op" id="5031731">]</span><span class="op" id="5031732">*</span><span class="ident" id="5031733">decOp</span><span class="op" id="5031738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5031741">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;wire&nbsp;type.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5031784">for</span>&nbsp;<span class="ident" id="5031788">fieldnum</span>&nbsp;<span class="op" id="5031797">:=</span>&nbsp;<span class="num" id="5031800">0</span><span class="op" id="5031801">;</span>&nbsp;<span class="ident" id="5031803">fieldnum</span>&nbsp;<span class="op" id="5031812">&lt;</span>&nbsp;<span class="builtinfunc" id="5031814">len</span><span class="op" id="5031817">(</span><span class="ident" id="5031818">wireStruct</span><span class="op" id="5031828">.</span><span class="ident" id="5031829">Field</span><span class="op" id="5031834">)</span><span class="op" id="5031835">;</span>&nbsp;<span class="ident" id="5031837">fieldnum</span><span class="op" id="5031845">++</span>&nbsp;<span class="op" id="5031848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031852">wireField</span>&nbsp;<span class="op" id="5031862">:=</span>&nbsp;<span class="ident" id="5031865">wireStruct</span><span class="op" id="5031875">.</span><span class="ident" id="5031876">Field</span><span class="op" id="5031881">[</span><span class="ident" id="5031882">fieldnum</span><span class="op" id="5031890">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5031894">if</span>&nbsp;<span class="ident" id="5031897">wireField</span><span class="op" id="5031906">.</span><span class="ident" id="5031907">Name</span>&nbsp;<span class="op" id="5031912">==</span>&nbsp;<span class="string" id="5031915">&#34;&#34;</span>&nbsp;<span class="op" id="5031918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031923">errorf</span><span class="op" id="5031929">(</span><span class="string" id="5031930">&#34;empty&nbsp;name&nbsp;for&nbsp;remote&nbsp;field&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5031970">,</span>&nbsp;<span class="ident" id="5031972">wireStruct</span><span class="op" id="5031982">.</span><span class="ident" id="5031983">Name</span><span class="op" id="5031987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5031991">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031995">ovfl</span>&nbsp;<span class="op" id="5032000">:=</span>&nbsp;<span class="ident" id="5032003">overflow</span><span class="op" id="5032011">(</span><span class="ident" id="5032012">wireField</span><span class="op" id="5032021">.</span><span class="ident" id="5032022">Name</span><span class="op" id="5032026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5032030">//&nbsp;Find&nbsp;the&nbsp;field&nbsp;of&nbsp;the&nbsp;local&nbsp;type&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032088">localField</span><span class="op" id="5032098">,</span>&nbsp;<span class="ident" id="5032100">present</span>&nbsp;<span class="op" id="5032108">:=</span>&nbsp;<span class="ident" id="5032111">srt</span><span class="op" id="5032114">.</span><span class="ident" id="5032115">FieldByName</span><span class="op" id="5032126">(</span><span class="ident" id="5032127">wireField</span><span class="op" id="5032136">.</span><span class="ident" id="5032137">Name</span><span class="op" id="5032141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5032145">//&nbsp;TODO(r):&nbsp;anonymous&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5032175">if</span>&nbsp;<span class="op" id="5032178">!</span><span class="ident" id="5032179">present</span>&nbsp;<span class="op" id="5032187">||</span>&nbsp;<span class="op" id="5032190">!</span><span class="ident" id="5032191">isExported</span><span class="op" id="5032201">(</span><span class="ident" id="5032202">wireField</span><span class="op" id="5032211">.</span><span class="ident" id="5032212">Name</span><span class="op" id="5032216">)</span>&nbsp;<span class="op" id="5032218">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032223">op</span>&nbsp;<span class="op" id="5032226">:=</span>&nbsp;<span class="ident" id="5032229">dec</span><span class="op" id="5032232">.</span><span class="ident" id="5032233">decIgnoreOpFor</span><span class="op" id="5032247">(</span><span class="ident" id="5032248">wireField</span><span class="op" id="5032257">.</span><span class="ident" id="5032258">Id</span><span class="op" id="5032260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032265">engine</span><span class="op" id="5032271">.</span><span class="ident" id="5032272">instr</span><span class="op" id="5032277">[</span><span class="ident" id="5032278">fieldnum</span><span class="op" id="5032286">]</span>&nbsp;<span class="op" id="5032288">=</span>&nbsp;<span class="ident" id="5032290">decInstr</span><span class="op" id="5032298">{</span><span class="ident" id="5032299">op</span><span class="op" id="5032301">,</span>&nbsp;<span class="ident" id="5032303">fieldnum</span><span class="op" id="5032311">,</span>&nbsp;<span class="ident" id="5032313">nil</span><span class="op" id="5032316">,</span>&nbsp;<span class="ident" id="5032318">ovfl</span><span class="op" id="5032322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5032327">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5032338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5032342">if</span>&nbsp;<span class="op" id="5032345">!</span><span class="ident" id="5032346">dec</span><span class="op" id="5032349">.</span><span class="ident" id="5032350">compatibleType</span><span class="op" id="5032364">(</span><span class="ident" id="5032365">localField</span><span class="op" id="5032375">.</span><span class="ident" id="5032376">Type</span><span class="op" id="5032380">,</span>&nbsp;<span class="ident" id="5032382">wireField</span><span class="op" id="5032391">.</span><span class="ident" id="5032392">Id</span><span class="op" id="5032394">,</span>&nbsp;<span class="builtinfunc" id="5032396">make</span><span class="op" id="5032400">(</span><span class="keyword" id="5032401">map</span><span class="op" id="5032404">[</span><span class="ident" id="5032405">reflect</span><span class="op" id="5032412">.</span><span class="ident" id="5032413">Type</span><span class="op" id="5032417">]</span><span class="ident" id="5032418">typeId</span><span class="op" id="5032424">)</span><span class="op" id="5032425">)</span>&nbsp;<span class="op" id="5032427">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032432">errorf</span><span class="op" id="5032438">(</span><span class="string" id="5032439">&#34;wrong&nbsp;type&nbsp;(%s)&nbsp;for&nbsp;received&nbsp;field&nbsp;%s.%s&#34;</span><span class="op" id="5032481">,</span>&nbsp;<span class="ident" id="5032483">localField</span><span class="op" id="5032493">.</span><span class="ident" id="5032494">Type</span><span class="op" id="5032498">,</span>&nbsp;<span class="ident" id="5032500">wireStruct</span><span class="op" id="5032510">.</span><span class="ident" id="5032511">Name</span><span class="op" id="5032515">,</span>&nbsp;<span class="ident" id="5032517">wireField</span><span class="op" id="5032526">.</span><span class="ident" id="5032527">Name</span><span class="op" id="5032531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5032535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032539">op</span>&nbsp;<span class="op" id="5032542">:=</span>&nbsp;<span class="ident" id="5032545">dec</span><span class="op" id="5032548">.</span><span class="ident" id="5032549">decOpFor</span><span class="op" id="5032557">(</span><span class="ident" id="5032558">wireField</span><span class="op" id="5032567">.</span><span class="ident" id="5032568">Id</span><span class="op" id="5032570">,</span>&nbsp;<span class="ident" id="5032572">localField</span><span class="op" id="5032582">.</span><span class="ident" id="5032583">Type</span><span class="op" id="5032587">,</span>&nbsp;<span class="ident" id="5032589">localField</span><span class="op" id="5032599">.</span><span class="ident" id="5032600">Name</span><span class="op" id="5032604">,</span>&nbsp;<span class="ident" id="5032606">seen</span><span class="op" id="5032610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032614">engine</span><span class="op" id="5032620">.</span><span class="ident" id="5032621">instr</span><span class="op" id="5032626">[</span><span class="ident" id="5032627">fieldnum</span><span class="op" id="5032635">]</span>&nbsp;<span class="op" id="5032637">=</span>&nbsp;<span class="ident" id="5032639">decInstr</span><span class="op" id="5032647">{</span><span class="op" id="5032648">*</span><span class="ident" id="5032649">op</span><span class="op" id="5032651">,</span>&nbsp;<span class="ident" id="5032653">fieldnum</span><span class="op" id="5032661">,</span>&nbsp;<span class="ident" id="5032663">localField</span><span class="op" id="5032673">.</span><span class="ident" id="5032674">Index</span><span class="op" id="5032679">,</span>&nbsp;<span class="ident" id="5032681">ovfl</span><span class="op" id="5032685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032689">engine</span><span class="op" id="5032695">.</span><span class="ident" id="5032696">numInstr</span><span class="op" id="5032704">++</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5032708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5032711">return</span><br>
<span class="lineno"></span><span class="op" id="5032718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5032721">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type.</span><br>
<span class="lineno">1095</span><span class="keyword" id="5032783">func</span>&nbsp;<span class="op" id="5032788">(</span><span class="ident" id="5032789">dec</span>&nbsp;<span class="op" id="5032793">*</span><span class="ident" id="5032794">Decoder</span><span class="op" id="5032801">)</span>&nbsp;<span class="ident" id="5032803">getDecEnginePtr</span><span class="op" id="5032818">(</span><span class="ident" id="5032819">remoteId</span>&nbsp;<span class="ident" id="5032828">typeId</span><span class="op" id="5032834">,</span>&nbsp;<span class="ident" id="5032836">ut</span>&nbsp;<span class="op" id="5032839">*</span><span class="ident" id="5032840">userTypeInfo</span><span class="op" id="5032852">)</span>&nbsp;<span class="op" id="5032854">(</span><span class="ident" id="5032855">enginePtr</span>&nbsp;<span class="op" id="5032865">*</span><span class="op" id="5032866">*</span><span class="ident" id="5032867">decEngine</span><span class="op" id="5032876">,</span>&nbsp;<span class="ident" id="5032878">err</span>&nbsp;<span class="builtintype" id="5032882">error</span><span class="op" id="5032887">)</span>&nbsp;<span class="op" id="5032889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032892">rt</span>&nbsp;<span class="op" id="5032895">:=</span>&nbsp;<span class="ident" id="5032898">ut</span><span class="op" id="5032900">.</span><span class="ident" id="5032901">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032907">decoderMap</span><span class="op" id="5032917">,</span>&nbsp;<span class="ident" id="5032919">ok</span>&nbsp;<span class="op" id="5032922">:=</span>&nbsp;<span class="ident" id="5032925">dec</span><span class="op" id="5032928">.</span><span class="ident" id="5032929">decoderCache</span><span class="op" id="5032941">[</span><span class="ident" id="5032942">rt</span><span class="op" id="5032944">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5032947">if</span>&nbsp;<span class="op" id="5032950">!</span><span class="ident" id="5032951">ok</span>&nbsp;<span class="op" id="5032954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032958">decoderMap</span>&nbsp;<span class="op" id="5032969">=</span>&nbsp;<span class="builtinfunc" id="5032971">make</span><span class="op" id="5032975">(</span><span class="keyword" id="5032976">map</span><span class="op" id="5032979">[</span><span class="ident" id="5032980">typeId</span><span class="op" id="5032986">]</span><span class="op" id="5032987">*</span><span class="op" id="5032988">*</span><span class="ident" id="5032989">decEngine</span><span class="op" id="5032998">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033002">dec</span><span class="op" id="5033005">.</span><span class="ident" id="5033006">decoderCache</span><span class="op" id="5033018">[</span><span class="ident" id="5033019">rt</span><span class="op" id="5033021">]</span>&nbsp;<span class="op" id="5033023">=</span>&nbsp;<span class="ident" id="5033025">decoderMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5033037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5033040">if</span>&nbsp;<span class="ident" id="5033043">enginePtr</span><span class="op" id="5033052">,</span>&nbsp;<span class="ident" id="5033054">ok</span>&nbsp;<span class="op" id="5033057">=</span>&nbsp;<span class="ident" id="5033059">decoderMap</span><span class="op" id="5033069">[</span><span class="ident" id="5033070">remoteId</span><span class="op" id="5033078">]</span><span class="op" id="5033079">;</span>&nbsp;<span class="op" id="5033081">!</span><span class="ident" id="5033082">ok</span>&nbsp;<span class="op" id="5033085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5033089">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033168">enginePtr</span>&nbsp;<span class="op" id="5033178">=</span>&nbsp;<span class="builtinfunc" id="5033180">new</span><span class="op" id="5033183">(</span><span class="op" id="5033184">*</span><span class="ident" id="5033185">decEngine</span><span class="op" id="5033194">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033198">decoderMap</span><span class="op" id="5033208">[</span><span class="ident" id="5033209">remoteId</span><span class="op" id="5033217">]</span>&nbsp;<span class="op" id="5033219">=</span>&nbsp;<span class="ident" id="5033221">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5033233">*</span><span class="ident" id="5033234">enginePtr</span><span class="op" id="5033243">,</span>&nbsp;<span class="ident" id="5033245">err</span>&nbsp;<span class="op" id="5033249">=</span>&nbsp;<span class="ident" id="5033251">dec</span><span class="op" id="5033254">.</span><span class="ident" id="5033255">compileDec</span><span class="op" id="5033265">(</span><span class="ident" id="5033266">remoteId</span><span class="op" id="5033274">,</span>&nbsp;<span class="ident" id="5033276">ut</span><span class="op" id="5033278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5033282">if</span>&nbsp;<span class="ident" id="5033285">err</span>&nbsp;<span class="op" id="5033289">!=</span>&nbsp;<span class="ident" id="5033292">nil</span>&nbsp;<span class="op" id="5033296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5033301">delete</span><span class="op" id="5033307">(</span><span class="ident" id="5033308">decoderMap</span><span class="op" id="5033318">,</span>&nbsp;<span class="ident" id="5033320">remoteId</span><span class="op" id="5033328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5033332">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5033335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5033338">return</span><br>
<span class="lineno"></span><span class="op" id="5033345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5033348">//&nbsp;emptyStruct&nbsp;is&nbsp;the&nbsp;type&nbsp;we&nbsp;compile&nbsp;into&nbsp;when&nbsp;ignoring&nbsp;a&nbsp;struct&nbsp;value.</span><br>
<span class="lineno">1115</span><span class="keyword" id="5033421">type</span>&nbsp;<span class="ident" id="5033426">emptyStruct</span>&nbsp;<span class="keyword" id="5033438">struct</span><span class="op" id="5033444">{</span><span class="op" id="5033445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5033448">var</span>&nbsp;<span class="ident" id="5033452">emptyStructType</span>&nbsp;<span class="op" id="5033468">=</span>&nbsp;<span class="ident" id="5033470">reflect</span><span class="op" id="5033477">.</span><span class="ident" id="5033478">TypeOf</span><span class="op" id="5033484">(</span><span class="ident" id="5033485">emptyStruct</span><span class="op" id="5033496">{</span><span class="op" id="5033497">}</span><span class="op" id="5033498">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5033501">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;to&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">1120</span><span class="keyword" id="5033597">func</span>&nbsp;<span class="op" id="5033602">(</span><span class="ident" id="5033603">dec</span>&nbsp;<span class="op" id="5033607">*</span><span class="ident" id="5033608">Decoder</span><span class="op" id="5033615">)</span>&nbsp;<span class="ident" id="5033617">getIgnoreEnginePtr</span><span class="op" id="5033635">(</span><span class="ident" id="5033636">wireId</span>&nbsp;<span class="ident" id="5033643">typeId</span><span class="op" id="5033649">)</span>&nbsp;<span class="op" id="5033651">(</span><span class="ident" id="5033652">enginePtr</span>&nbsp;<span class="op" id="5033662">*</span><span class="op" id="5033663">*</span><span class="ident" id="5033664">decEngine</span><span class="op" id="5033673">,</span>&nbsp;<span class="ident" id="5033675">err</span>&nbsp;<span class="builtintype" id="5033679">error</span><span class="op" id="5033684">)</span>&nbsp;<span class="op" id="5033686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5033689">var</span>&nbsp;<span class="ident" id="5033693">ok</span>&nbsp;<span class="builtintype" id="5033696">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5033702">if</span>&nbsp;<span class="ident" id="5033705">enginePtr</span><span class="op" id="5033714">,</span>&nbsp;<span class="ident" id="5033716">ok</span>&nbsp;<span class="op" id="5033719">=</span>&nbsp;<span class="ident" id="5033721">dec</span><span class="op" id="5033724">.</span><span class="ident" id="5033725">ignorerCache</span><span class="op" id="5033737">[</span><span class="ident" id="5033738">wireId</span><span class="op" id="5033744">]</span><span class="op" id="5033745">;</span>&nbsp;<span class="op" id="5033747">!</span><span class="ident" id="5033748">ok</span>&nbsp;<span class="op" id="5033751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5033755">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033834">enginePtr</span>&nbsp;<span class="op" id="5033844">=</span>&nbsp;<span class="builtinfunc" id="5033846">new</span><span class="op" id="5033849">(</span><span class="op" id="5033850">*</span><span class="ident" id="5033851">decEngine</span><span class="op" id="5033860">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033864">dec</span><span class="op" id="5033867">.</span><span class="ident" id="5033868">ignorerCache</span><span class="op" id="5033880">[</span><span class="ident" id="5033881">wireId</span><span class="op" id="5033887">]</span>&nbsp;<span class="op" id="5033889">=</span>&nbsp;<span class="ident" id="5033891">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033903">wire</span>&nbsp;<span class="op" id="5033908">:=</span>&nbsp;<span class="ident" id="5033911">dec</span><span class="op" id="5033914">.</span><span class="ident" id="5033915">wireType</span><span class="op" id="5033923">[</span><span class="ident" id="5033924">wireId</span><span class="op" id="5033930">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5033934">if</span>&nbsp;<span class="ident" id="5033937">wire</span>&nbsp;<span class="op" id="5033942">!=</span>&nbsp;<span class="ident" id="5033945">nil</span>&nbsp;<span class="op" id="5033949">&amp;&amp;</span>&nbsp;<span class="ident" id="5033952">wire</span><span class="op" id="5033956">.</span><span class="ident" id="5033957">StructT</span>&nbsp;<span class="op" id="5033965">!=</span>&nbsp;<span class="ident" id="5033968">nil</span>&nbsp;<span class="op" id="5033972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5033977">*</span><span class="ident" id="5033978">enginePtr</span><span class="op" id="5033987">,</span>&nbsp;<span class="ident" id="5033989">err</span>&nbsp;<span class="op" id="5033993">=</span>&nbsp;<span class="ident" id="5033995">dec</span><span class="op" id="5033998">.</span><span class="ident" id="5033999">compileDec</span><span class="op" id="5034009">(</span><span class="ident" id="5034010">wireId</span><span class="op" id="5034016">,</span>&nbsp;<span class="ident" id="5034018">userType</span><span class="op" id="5034026">(</span><span class="ident" id="5034027">emptyStructType</span><span class="op" id="5034042">)</span><span class="op" id="5034043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5034047">}</span>&nbsp;<span class="keyword" id="5034049">else</span>&nbsp;<span class="op" id="5034054">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5034059">*</span><span class="ident" id="5034060">enginePtr</span><span class="op" id="5034069">,</span>&nbsp;<span class="ident" id="5034071">err</span>&nbsp;<span class="op" id="5034075">=</span>&nbsp;<span class="ident" id="5034077">dec</span><span class="op" id="5034080">.</span><span class="ident" id="5034081">compileIgnoreSingle</span><span class="op" id="5034100">(</span><span class="ident" id="5034101">wireId</span><span class="op" id="5034107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5034111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034115">if</span>&nbsp;<span class="ident" id="5034118">err</span>&nbsp;<span class="op" id="5034122">!=</span>&nbsp;<span class="ident" id="5034125">nil</span>&nbsp;<span class="op" id="5034129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5034134">delete</span><span class="op" id="5034140">(</span><span class="ident" id="5034141">dec</span><span class="op" id="5034144">.</span><span class="ident" id="5034145">ignorerCache</span><span class="op" id="5034157">,</span>&nbsp;<span class="ident" id="5034159">wireId</span><span class="op" id="5034165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5034169">}</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5034172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034175">return</span><br>
<span class="lineno"></span><span class="op" id="5034182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5034185">//&nbsp;decodeValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">1140</span><span class="keyword" id="5034269">func</span>&nbsp;<span class="op" id="5034274">(</span><span class="ident" id="5034275">dec</span>&nbsp;<span class="op" id="5034279">*</span><span class="ident" id="5034280">Decoder</span><span class="op" id="5034287">)</span>&nbsp;<span class="ident" id="5034289">decodeValue</span><span class="op" id="5034300">(</span><span class="ident" id="5034301">wireId</span>&nbsp;<span class="ident" id="5034308">typeId</span><span class="op" id="5034314">,</span>&nbsp;<span class="ident" id="5034316">value</span>&nbsp;<span class="ident" id="5034322">reflect</span><span class="op" id="5034329">.</span><span class="ident" id="5034330">Value</span><span class="op" id="5034335">)</span>&nbsp;<span class="op" id="5034337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034340">defer</span>&nbsp;<span class="ident" id="5034346">catchError</span><span class="op" id="5034356">(</span><span class="op" id="5034357">&amp;</span><span class="ident" id="5034358">dec</span><span class="op" id="5034361">.</span><span class="ident" id="5034362">err</span><span class="op" id="5034365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5034368">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;nil,&nbsp;it&nbsp;means&nbsp;we&nbsp;should&nbsp;just&nbsp;ignore&nbsp;this&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034435">if</span>&nbsp;<span class="op" id="5034438">!</span><span class="ident" id="5034439">value</span><span class="op" id="5034444">.</span><span class="ident" id="5034445">IsValid</span><span class="op" id="5034452">(</span><span class="op" id="5034453">)</span>&nbsp;<span class="op" id="5034455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034459">dec</span><span class="op" id="5034462">.</span><span class="ident" id="5034463">decodeIgnoredValue</span><span class="op" id="5034481">(</span><span class="ident" id="5034482">wireId</span><span class="op" id="5034488">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034492">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5034500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5034503">//&nbsp;Dereference&nbsp;down&nbsp;to&nbsp;the&nbsp;underlying&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034548">ut</span>&nbsp;<span class="op" id="5034551">:=</span>&nbsp;<span class="ident" id="5034554">userType</span><span class="op" id="5034562">(</span><span class="ident" id="5034563">value</span><span class="op" id="5034568">.</span><span class="ident" id="5034569">Type</span><span class="op" id="5034573">(</span><span class="op" id="5034574">)</span><span class="op" id="5034575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034578">base</span>&nbsp;<span class="op" id="5034583">:=</span>&nbsp;<span class="ident" id="5034586">ut</span><span class="op" id="5034588">.</span><span class="ident" id="5034589">base</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034595">var</span>&nbsp;<span class="ident" id="5034599">enginePtr</span>&nbsp;<span class="op" id="5034609">*</span><span class="op" id="5034610">*</span><span class="ident" id="5034611">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034622">enginePtr</span><span class="op" id="5034631">,</span>&nbsp;<span class="ident" id="5034633">dec</span><span class="op" id="5034636">.</span><span class="ident" id="5034637">err</span>&nbsp;<span class="op" id="5034641">=</span>&nbsp;<span class="ident" id="5034643">dec</span><span class="op" id="5034646">.</span><span class="ident" id="5034647">getDecEnginePtr</span><span class="op" id="5034662">(</span><span class="ident" id="5034663">wireId</span><span class="op" id="5034669">,</span>&nbsp;<span class="ident" id="5034671">ut</span><span class="op" id="5034673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034676">if</span>&nbsp;<span class="ident" id="5034679">dec</span><span class="op" id="5034682">.</span><span class="ident" id="5034683">err</span>&nbsp;<span class="op" id="5034687">!=</span>&nbsp;<span class="ident" id="5034690">nil</span>&nbsp;<span class="op" id="5034694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034698">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5034706">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034709">value</span>&nbsp;<span class="op" id="5034715">=</span>&nbsp;<span class="ident" id="5034717">decAlloc</span><span class="op" id="5034725">(</span><span class="ident" id="5034726">value</span><span class="op" id="5034731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034734">engine</span>&nbsp;<span class="op" id="5034741">:=</span>&nbsp;<span class="op" id="5034744">*</span><span class="ident" id="5034745">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034756">if</span>&nbsp;<span class="ident" id="5034759">st</span>&nbsp;<span class="op" id="5034762">:=</span>&nbsp;<span class="ident" id="5034765">base</span><span class="op" id="5034769">;</span>&nbsp;<span class="ident" id="5034771">st</span><span class="op" id="5034773">.</span><span class="ident" id="5034774">Kind</span><span class="op" id="5034778">(</span><span class="op" id="5034779">)</span>&nbsp;<span class="op" id="5034781">==</span>&nbsp;<span class="ident" id="5034784">reflect</span><span class="op" id="5034791">.</span><span class="ident" id="5034792">Struct</span>&nbsp;<span class="op" id="5034799">&amp;&amp;</span>&nbsp;<span class="ident" id="5034802">ut</span><span class="op" id="5034804">.</span><span class="ident" id="5034805">externalDec</span>&nbsp;<span class="op" id="5034817">==</span>&nbsp;<span class="num" id="5034820">0</span>&nbsp;<span class="op" id="5034822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034826">if</span>&nbsp;<span class="ident" id="5034829">engine</span><span class="op" id="5034835">.</span><span class="ident" id="5034836">numInstr</span>&nbsp;<span class="op" id="5034845">==</span>&nbsp;<span class="num" id="5034848">0</span>&nbsp;<span class="op" id="5034850">&amp;&amp;</span>&nbsp;<span class="ident" id="5034853">st</span><span class="op" id="5034855">.</span><span class="ident" id="5034856">NumField</span><span class="op" id="5034864">(</span><span class="op" id="5034865">)</span>&nbsp;<span class="op" id="5034867">&gt;</span>&nbsp;<span class="num" id="5034869">0</span>&nbsp;<span class="op" id="5034871">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034877">dec</span><span class="op" id="5034880">.</span><span class="ident" id="5034881">wireType</span><span class="op" id="5034889">[</span><span class="ident" id="5034890">wireId</span><span class="op" id="5034896">]</span>&nbsp;<span class="op" id="5034898">!=</span>&nbsp;<span class="ident" id="5034901">nil</span>&nbsp;<span class="op" id="5034905">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5034908">len</span><span class="op" id="5034911">(</span><span class="ident" id="5034912">dec</span><span class="op" id="5034915">.</span><span class="ident" id="5034916">wireType</span><span class="op" id="5034924">[</span><span class="ident" id="5034925">wireId</span><span class="op" id="5034931">]</span><span class="op" id="5034932">.</span><span class="ident" id="5034933">StructT</span><span class="op" id="5034940">.</span><span class="ident" id="5034941">Field</span><span class="op" id="5034946">)</span>&nbsp;<span class="op" id="5034948">&gt;</span>&nbsp;<span class="num" id="5034950">0</span>&nbsp;<span class="op" id="5034952">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034957">name</span>&nbsp;<span class="op" id="5034962">:=</span>&nbsp;<span class="ident" id="5034965">base</span><span class="op" id="5034969">.</span><span class="ident" id="5034970">Name</span><span class="op" id="5034974">(</span><span class="op" id="5034975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034980">errorf</span><span class="op" id="5034986">(</span><span class="string" id="5034987">&#34;type&nbsp;mismatch:&nbsp;no&nbsp;fields&nbsp;matched&nbsp;compiling&nbsp;decoder&nbsp;for&nbsp;%s&#34;</span><span class="op" id="5035046">,</span>&nbsp;<span class="ident" id="5035048">name</span><span class="op" id="5035052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5035056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035060">dec</span><span class="op" id="5035063">.</span><span class="ident" id="5035064">decodeStruct</span><span class="op" id="5035076">(</span><span class="ident" id="5035077">engine</span><span class="op" id="5035083">,</span>&nbsp;<span class="ident" id="5035085">ut</span><span class="op" id="5035087">,</span>&nbsp;<span class="ident" id="5035089">value</span><span class="op" id="5035094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5035097">}</span>&nbsp;<span class="keyword" id="5035099">else</span>&nbsp;<span class="op" id="5035104">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035108">dec</span><span class="op" id="5035111">.</span><span class="ident" id="5035112">decodeSingle</span><span class="op" id="5035124">(</span><span class="ident" id="5035125">engine</span><span class="op" id="5035131">,</span>&nbsp;<span class="ident" id="5035133">ut</span><span class="op" id="5035135">,</span>&nbsp;<span class="ident" id="5035137">value</span><span class="op" id="5035142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5035145">}</span><br>
<span class="lineno"></span><span class="op" id="5035147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5035150">//&nbsp;decodeIgnoredValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;and&nbsp;discards&nbsp;it.</span><br>
<span class="lineno">1170</span><span class="keyword" id="5035256">func</span>&nbsp;<span class="op" id="5035261">(</span><span class="ident" id="5035262">dec</span>&nbsp;<span class="op" id="5035266">*</span><span class="ident" id="5035267">Decoder</span><span class="op" id="5035274">)</span>&nbsp;<span class="ident" id="5035276">decodeIgnoredValue</span><span class="op" id="5035294">(</span><span class="ident" id="5035295">wireId</span>&nbsp;<span class="ident" id="5035302">typeId</span><span class="op" id="5035308">)</span>&nbsp;<span class="op" id="5035310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035313">var</span>&nbsp;<span class="ident" id="5035317">enginePtr</span>&nbsp;<span class="op" id="5035327">*</span><span class="op" id="5035328">*</span><span class="ident" id="5035329">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035340">enginePtr</span><span class="op" id="5035349">,</span>&nbsp;<span class="ident" id="5035351">dec</span><span class="op" id="5035354">.</span><span class="ident" id="5035355">err</span>&nbsp;<span class="op" id="5035359">=</span>&nbsp;<span class="ident" id="5035361">dec</span><span class="op" id="5035364">.</span><span class="ident" id="5035365">getIgnoreEnginePtr</span><span class="op" id="5035383">(</span><span class="ident" id="5035384">wireId</span><span class="op" id="5035390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035393">if</span>&nbsp;<span class="ident" id="5035396">dec</span><span class="op" id="5035399">.</span><span class="ident" id="5035400">err</span>&nbsp;<span class="op" id="5035404">!=</span>&nbsp;<span class="ident" id="5035407">nil</span>&nbsp;<span class="op" id="5035411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035415">return</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5035423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035426">wire</span>&nbsp;<span class="op" id="5035431">:=</span>&nbsp;<span class="ident" id="5035434">dec</span><span class="op" id="5035437">.</span><span class="ident" id="5035438">wireType</span><span class="op" id="5035446">[</span><span class="ident" id="5035447">wireId</span><span class="op" id="5035453">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035456">if</span>&nbsp;<span class="ident" id="5035459">wire</span>&nbsp;<span class="op" id="5035464">!=</span>&nbsp;<span class="ident" id="5035467">nil</span>&nbsp;<span class="op" id="5035471">&amp;&amp;</span>&nbsp;<span class="ident" id="5035474">wire</span><span class="op" id="5035478">.</span><span class="ident" id="5035479">StructT</span>&nbsp;<span class="op" id="5035487">!=</span>&nbsp;<span class="ident" id="5035490">nil</span>&nbsp;<span class="op" id="5035494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035498">dec</span><span class="op" id="5035501">.</span><span class="ident" id="5035502">ignoreStruct</span><span class="op" id="5035514">(</span><span class="op" id="5035515">*</span><span class="ident" id="5035516">enginePtr</span><span class="op" id="5035525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5035528">}</span>&nbsp;<span class="keyword" id="5035530">else</span>&nbsp;<span class="op" id="5035535">{</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035539">dec</span><span class="op" id="5035542">.</span><span class="ident" id="5035543">ignoreSingle</span><span class="op" id="5035555">(</span><span class="op" id="5035556">*</span><span class="ident" id="5035557">enginePtr</span><span class="op" id="5035566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5035569">}</span><br>
<span class="lineno"></span><span class="op" id="5035571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5035574">func</span>&nbsp;<span class="ident" id="5035579">init</span><span class="op" id="5035583">(</span><span class="op" id="5035584">)</span>&nbsp;<span class="op" id="5035586">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035589">var</span>&nbsp;<span class="ident" id="5035593">iop</span><span class="op" id="5035596">,</span>&nbsp;<span class="ident" id="5035598">uop</span>&nbsp;<span class="ident" id="5035602">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035609">switch</span>&nbsp;<span class="ident" id="5035616">reflect</span><span class="op" id="5035623">.</span><span class="ident" id="5035624">TypeOf</span><span class="op" id="5035630">(</span><span class="builtintype" id="5035631">int</span><span class="op" id="5035634">(</span><span class="num" id="5035635">0</span><span class="op" id="5035636">)</span><span class="op" id="5035637">)</span><span class="op" id="5035638">.</span><span class="ident" id="5035639">Bits</span><span class="op" id="5035643">(</span><span class="op" id="5035644">)</span>&nbsp;<span class="op" id="5035646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035649">case</span>&nbsp;<span class="num" id="5035654">32</span><span class="op" id="5035656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035660">iop</span>&nbsp;<span class="op" id="5035664">=</span>&nbsp;<span class="ident" id="5035666">decInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035677">uop</span>&nbsp;<span class="op" id="5035681">=</span>&nbsp;<span class="ident" id="5035683">decUint32</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035694">case</span>&nbsp;<span class="num" id="5035699">64</span><span class="op" id="5035701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035705">iop</span>&nbsp;<span class="op" id="5035709">=</span>&nbsp;<span class="ident" id="5035711">decInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035722">uop</span>&nbsp;<span class="op" id="5035726">=</span>&nbsp;<span class="ident" id="5035728">decUint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035739">default</span><span class="op" id="5035746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5035750">panic</span><span class="op" id="5035755">(</span><span class="string" id="5035756">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;int/uint&#34;</span><span class="op" id="5035787">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5035790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035793">decOpTable</span><span class="op" id="5035803">[</span><span class="ident" id="5035804">reflect</span><span class="op" id="5035811">.</span><span class="ident" id="5035812">Int</span><span class="op" id="5035815">]</span>&nbsp;<span class="op" id="5035817">=</span>&nbsp;<span class="ident" id="5035819">iop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035824">decOpTable</span><span class="op" id="5035834">[</span><span class="ident" id="5035835">reflect</span><span class="op" id="5035842">.</span><span class="ident" id="5035843">Uint</span><span class="op" id="5035847">]</span>&nbsp;<span class="op" id="5035849">=</span>&nbsp;<span class="ident" id="5035851">uop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5035857">//&nbsp;Finally&nbsp;uintptr</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035877">switch</span>&nbsp;<span class="ident" id="5035884">reflect</span><span class="op" id="5035891">.</span><span class="ident" id="5035892">TypeOf</span><span class="op" id="5035898">(</span><span class="builtintype" id="5035899">uintptr</span><span class="op" id="5035906">(</span><span class="num" id="5035907">0</span><span class="op" id="5035908">)</span><span class="op" id="5035909">)</span><span class="op" id="5035910">.</span><span class="ident" id="5035911">Bits</span><span class="op" id="5035915">(</span><span class="op" id="5035916">)</span>&nbsp;<span class="op" id="5035918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035921">case</span>&nbsp;<span class="num" id="5035926">32</span><span class="op" id="5035928">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035932">uop</span>&nbsp;<span class="op" id="5035936">=</span>&nbsp;<span class="ident" id="5035938">decUint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035949">case</span>&nbsp;<span class="num" id="5035954">64</span><span class="op" id="5035956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035960">uop</span>&nbsp;<span class="op" id="5035964">=</span>&nbsp;<span class="ident" id="5035966">decUint64</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035977">default</span><span class="op" id="5035984">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5035988">panic</span><span class="op" id="5035993">(</span><span class="string" id="5035994">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;uintptr&#34;</span><span class="op" id="5036024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5036027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036030">decOpTable</span><span class="op" id="5036040">[</span><span class="ident" id="5036041">reflect</span><span class="op" id="5036048">.</span><span class="ident" id="5036049">Uintptr</span><span class="op" id="5036056">]</span>&nbsp;<span class="op" id="5036058">=</span>&nbsp;<span class="ident" id="5036060">uop</span><br>
<span class="lineno"></span><span class="op" id="5036064">}</span><br>
<span class="lineno">1210</span><br>
<span class="lineno"></span><span class="comment" id="5036067">//&nbsp;Gob&nbsp;depends&nbsp;on&nbsp;being&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="5036116">//&nbsp;of&nbsp;zeroed&nbsp;Values&nbsp;it&nbsp;creates,&nbsp;so&nbsp;use&nbsp;this&nbsp;wrapper&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5036176">//&nbsp;of&nbsp;the&nbsp;standard&nbsp;reflect.Zero.</span><br>
<span class="lineno"></span><span class="comment" id="5036209">//&nbsp;Each&nbsp;call&nbsp;allocates&nbsp;once.</span><br>
<span class="lineno">1215</span><span class="keyword" id="5036238">func</span>&nbsp;<span class="ident" id="5036243">allocValue</span><span class="op" id="5036253">(</span><span class="ident" id="5036254">t</span>&nbsp;<span class="ident" id="5036256">reflect</span><span class="op" id="5036263">.</span><span class="ident" id="5036264">Type</span><span class="op" id="5036268">)</span>&nbsp;<span class="ident" id="5036270">reflect</span><span class="op" id="5036277">.</span><span class="ident" id="5036278">Value</span>&nbsp;<span class="op" id="5036284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5036287">return</span>&nbsp;<span class="ident" id="5036294">reflect</span><span class="op" id="5036301">.</span><span class="ident" id="5036302">New</span><span class="op" id="5036305">(</span><span class="ident" id="5036306">t</span><span class="op" id="5036307">)</span><span class="op" id="5036308">.</span><span class="ident" id="5036309">Elem</span><span class="op" id="5036313">(</span><span class="op" id="5036314">)</span><br>
<span class="lineno"></span><span class="op" id="5036316">}</span>
</div>
</body>
</html>
