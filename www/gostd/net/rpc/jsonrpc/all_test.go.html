<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6892658">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6892714">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6892768">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6892819">package</span>&nbsp;<span class="ident" id="6892827">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6892836">import</span>&nbsp;<span class="op" id="6892843">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6892846">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6892855">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6892872">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6892882">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6892889">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6892895">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6892908">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6892915">&#34;net/rpc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6892926">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6892937">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6892947">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6892950">type</span>&nbsp;<span class="ident" id="6892955">Args</span>&nbsp;<span class="keyword" id="6892960">struct</span>&nbsp;<span class="op" id="6892967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6892970">A</span><span class="op" id="6892971">,</span>&nbsp;<span class="ident" id="6892973">B</span>&nbsp;<span class="builtintype" id="6892975">int</span><br>
<span class="lineno"></span><span class="op" id="6892979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6892982">type</span>&nbsp;<span class="ident" id="6892987">Reply</span>&nbsp;<span class="keyword" id="6892993">struct</span>&nbsp;<span class="op" id="6893000">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6893003">C</span>&nbsp;<span class="builtintype" id="6893005">int</span><br>
<span class="lineno"></span><span class="op" id="6893009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6893012">type</span>&nbsp;<span class="ident" id="6893017">Arith</span>&nbsp;<span class="builtintype" id="6893023">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6893028">type</span>&nbsp;<span class="ident" id="6893033">ArithAddResp</span>&nbsp;<span class="keyword" id="6893046">struct</span>&nbsp;<span class="op" id="6893053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6893056">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6893063">interface</span><span class="op" id="6893072">{</span><span class="op" id="6893073">}</span>&nbsp;<span class="string" id="6893075">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6893088">Result</span>&nbsp;<span class="ident" id="6893095">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6893107">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6893124">Error</span>&nbsp;&nbsp;<span class="keyword" id="6893131">interface</span><span class="op" id="6893140">{</span><span class="op" id="6893141">}</span>&nbsp;<span class="string" id="6893143">`json:&#34;error&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6893158">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6893161">func</span>&nbsp;<span class="op" id="6893166">(</span><span class="ident" id="6893167">t</span>&nbsp;<span class="op" id="6893169">*</span><span class="ident" id="6893170">Arith</span><span class="op" id="6893175">)</span>&nbsp;<span class="ident" id="6893177">Add</span><span class="op" id="6893180">(</span><span class="ident" id="6893181">args</span>&nbsp;<span class="op" id="6893186">*</span><span class="ident" id="6893187">Args</span><span class="op" id="6893191">,</span>&nbsp;<span class="ident" id="6893193">reply</span>&nbsp;<span class="op" id="6893199">*</span><span class="ident" id="6893200">Reply</span><span class="op" id="6893205">)</span>&nbsp;<span class="builtintype" id="6893207">error</span>&nbsp;<span class="op" id="6893213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6893216">reply</span><span class="op" id="6893221">.</span><span class="ident" id="6893222">C</span>&nbsp;<span class="op" id="6893224">=</span>&nbsp;<span class="ident" id="6893226">args</span><span class="op" id="6893230">.</span><span class="ident" id="6893231">A</span>&nbsp;<span class="op" id="6893233">+</span>&nbsp;<span class="ident" id="6893235">args</span><span class="op" id="6893239">.</span><span class="ident" id="6893240">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6893243">return</span>&nbsp;<span class="ident" id="6893250">nil</span><br>
<span class="lineno"></span><span class="op" id="6893254">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6893257">func</span>&nbsp;<span class="op" id="6893262">(</span><span class="ident" id="6893263">t</span>&nbsp;<span class="op" id="6893265">*</span><span class="ident" id="6893266">Arith</span><span class="op" id="6893271">)</span>&nbsp;<span class="ident" id="6893273">Mul</span><span class="op" id="6893276">(</span><span class="ident" id="6893277">args</span>&nbsp;<span class="op" id="6893282">*</span><span class="ident" id="6893283">Args</span><span class="op" id="6893287">,</span>&nbsp;<span class="ident" id="6893289">reply</span>&nbsp;<span class="op" id="6893295">*</span><span class="ident" id="6893296">Reply</span><span class="op" id="6893301">)</span>&nbsp;<span class="builtintype" id="6893303">error</span>&nbsp;<span class="op" id="6893309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6893312">reply</span><span class="op" id="6893317">.</span><span class="ident" id="6893318">C</span>&nbsp;<span class="op" id="6893320">=</span>&nbsp;<span class="ident" id="6893322">args</span><span class="op" id="6893326">.</span><span class="ident" id="6893327">A</span>&nbsp;<span class="op" id="6893329">*</span>&nbsp;<span class="ident" id="6893331">args</span><span class="op" id="6893335">.</span><span class="ident" id="6893336">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6893339">return</span>&nbsp;<span class="ident" id="6893346">nil</span><br>
<span class="lineno"></span><span class="op" id="6893350">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6893353">func</span>&nbsp;<span class="op" id="6893358">(</span><span class="ident" id="6893359">t</span>&nbsp;<span class="op" id="6893361">*</span><span class="ident" id="6893362">Arith</span><span class="op" id="6893367">)</span>&nbsp;<span class="ident" id="6893369">Div</span><span class="op" id="6893372">(</span><span class="ident" id="6893373">args</span>&nbsp;<span class="op" id="6893378">*</span><span class="ident" id="6893379">Args</span><span class="op" id="6893383">,</span>&nbsp;<span class="ident" id="6893385">reply</span>&nbsp;<span class="op" id="6893391">*</span><span class="ident" id="6893392">Reply</span><span class="op" id="6893397">)</span>&nbsp;<span class="builtintype" id="6893399">error</span>&nbsp;<span class="op" id="6893405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6893408">if</span>&nbsp;<span class="ident" id="6893411">args</span><span class="op" id="6893415">.</span><span class="ident" id="6893416">B</span>&nbsp;<span class="op" id="6893418">==</span>&nbsp;<span class="num" id="6893421">0</span>&nbsp;<span class="op" id="6893423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6893427">return</span>&nbsp;<span class="ident" id="6893434">errors</span><span class="op" id="6893440">.</span><span class="ident" id="6893441">New</span><span class="op" id="6893444">(</span><span class="string" id="6893445">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="6893461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6893464">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6893467">reply</span><span class="op" id="6893472">.</span><span class="ident" id="6893473">C</span>&nbsp;<span class="op" id="6893475">=</span>&nbsp;<span class="ident" id="6893477">args</span><span class="op" id="6893481">.</span><span class="ident" id="6893482">A</span>&nbsp;<span class="op" id="6893484">/</span>&nbsp;<span class="ident" id="6893486">args</span><span class="op" id="6893490">.</span><span class="ident" id="6893491">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6893494">return</span>&nbsp;<span class="ident" id="6893501">nil</span><br>
<span class="lineno"></span><span class="op" id="6893505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6893508">func</span>&nbsp;<span class="op" id="6893513">(</span><span class="ident" id="6893514">t</span>&nbsp;<span class="op" id="6893516">*</span><span class="ident" id="6893517">Arith</span><span class="op" id="6893522">)</span>&nbsp;<span class="ident" id="6893524">Error</span><span class="op" id="6893529">(</span><span class="ident" id="6893530">args</span>&nbsp;<span class="op" id="6893535">*</span><span class="ident" id="6893536">Args</span><span class="op" id="6893540">,</span>&nbsp;<span class="ident" id="6893542">reply</span>&nbsp;<span class="op" id="6893548">*</span><span class="ident" id="6893549">Reply</span><span class="op" id="6893554">)</span>&nbsp;<span class="builtintype" id="6893556">error</span>&nbsp;<span class="op" id="6893562">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6893565">panic</span><span class="op" id="6893570">(</span><span class="string" id="6893571">&#34;ERROR&#34;</span><span class="op" id="6893578">)</span><br>
<span class="lineno"></span><span class="op" id="6893580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6893583">func</span>&nbsp;<span class="ident" id="6893588">init</span><span class="op" id="6893592">(</span><span class="op" id="6893593">)</span>&nbsp;<span class="op" id="6893595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6893598">rpc</span><span class="op" id="6893601">.</span><span class="ident" id="6893602">Register</span><span class="op" id="6893610">(</span><span class="builtinfunc" id="6893611">new</span><span class="op" id="6893614">(</span><span class="ident" id="6893615">Arith</span><span class="op" id="6893620">)</span><span class="op" id="6893621">)</span><br>
<span class="lineno">60</span><span class="op" id="6893623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6893626">func</span>&nbsp;<span class="ident" id="6893631">TestServerNoParams</span><span class="op" id="6893649">(</span><span class="ident" id="6893650">t</span>&nbsp;<span class="op" id="6893652">*</span><span class="ident" id="6893653">testing</span><span class="op" id="6893660">.</span><span class="ident" id="6893661">T</span><span class="op" id="6893662">)</span>&nbsp;<span class="op" id="6893664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6893667">cli</span><span class="op" id="6893670">,</span>&nbsp;<span class="ident" id="6893672">srv</span>&nbsp;<span class="op" id="6893676">:=</span>&nbsp;<span class="ident" id="6893679">net</span><span class="op" id="6893682">.</span><span class="ident" id="6893683">Pipe</span><span class="op" id="6893687">(</span><span class="op" id="6893688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6893691">defer</span>&nbsp;<span class="ident" id="6893697">cli</span><span class="op" id="6893700">.</span><span class="ident" id="6893701">Close</span><span class="op" id="6893706">(</span><span class="op" id="6893707">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6893710">go</span>&nbsp;<span class="ident" id="6893713">ServeConn</span><span class="op" id="6893722">(</span><span class="ident" id="6893723">srv</span><span class="op" id="6893726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6893729">dec</span>&nbsp;<span class="op" id="6893733">:=</span>&nbsp;<span class="ident" id="6893736">json</span><span class="op" id="6893740">.</span><span class="ident" id="6893741">NewDecoder</span><span class="op" id="6893751">(</span><span class="ident" id="6893752">cli</span><span class="op" id="6893755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6893759">fmt</span><span class="op" id="6893762">.</span><span class="ident" id="6893763">Fprintf</span><span class="op" id="6893770">(</span><span class="ident" id="6893771">cli</span><span class="op" id="6893774">,</span>&nbsp;<span class="string" id="6893776">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;}`</span><span class="op" id="6893814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6893817">var</span>&nbsp;<span class="ident" id="6893821">resp</span>&nbsp;<span class="ident" id="6893826">ArithAddResp</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6893840">if</span>&nbsp;<span class="ident" id="6893843">err</span>&nbsp;<span class="op" id="6893847">:=</span>&nbsp;<span class="ident" id="6893850">dec</span><span class="op" id="6893853">.</span><span class="ident" id="6893854">Decode</span><span class="op" id="6893860">(</span><span class="op" id="6893861">&amp;</span><span class="ident" id="6893862">resp</span><span class="op" id="6893866">)</span><span class="op" id="6893867">;</span>&nbsp;<span class="ident" id="6893869">err</span>&nbsp;<span class="op" id="6893873">!=</span>&nbsp;<span class="ident" id="6893876">nil</span>&nbsp;<span class="op" id="6893880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6893884">t</span><span class="op" id="6893885">.</span><span class="ident" id="6893886">Fatalf</span><span class="op" id="6893892">(</span><span class="string" id="6893893">&#34;Decode&nbsp;after&nbsp;no&nbsp;params:&nbsp;%s&#34;</span><span class="op" id="6893921">,</span>&nbsp;<span class="ident" id="6893923">err</span><span class="op" id="6893926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6893929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6893932">if</span>&nbsp;<span class="ident" id="6893935">resp</span><span class="op" id="6893939">.</span><span class="ident" id="6893940">Error</span>&nbsp;<span class="op" id="6893946">==</span>&nbsp;<span class="ident" id="6893949">nil</span>&nbsp;<span class="op" id="6893953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6893957">t</span><span class="op" id="6893958">.</span><span class="ident" id="6893959">Fatalf</span><span class="op" id="6893965">(</span><span class="string" id="6893966">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="6893991">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6893994">}</span><br>
<span class="lineno"></span><span class="op" id="6893996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6893999">func</span>&nbsp;<span class="ident" id="6894004">TestServerEmptyMessage</span><span class="op" id="6894026">(</span><span class="ident" id="6894027">t</span>&nbsp;<span class="op" id="6894029">*</span><span class="ident" id="6894030">testing</span><span class="op" id="6894037">.</span><span class="ident" id="6894038">T</span><span class="op" id="6894039">)</span>&nbsp;<span class="op" id="6894041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6894044">cli</span><span class="op" id="6894047">,</span>&nbsp;<span class="ident" id="6894049">srv</span>&nbsp;<span class="op" id="6894053">:=</span>&nbsp;<span class="ident" id="6894056">net</span><span class="op" id="6894059">.</span><span class="ident" id="6894060">Pipe</span><span class="op" id="6894064">(</span><span class="op" id="6894065">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6894068">defer</span>&nbsp;<span class="ident" id="6894074">cli</span><span class="op" id="6894077">.</span><span class="ident" id="6894078">Close</span><span class="op" id="6894083">(</span><span class="op" id="6894084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6894087">go</span>&nbsp;<span class="ident" id="6894090">ServeConn</span><span class="op" id="6894099">(</span><span class="ident" id="6894100">srv</span><span class="op" id="6894103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6894106">dec</span>&nbsp;<span class="op" id="6894110">:=</span>&nbsp;<span class="ident" id="6894113">json</span><span class="op" id="6894117">.</span><span class="ident" id="6894118">NewDecoder</span><span class="op" id="6894128">(</span><span class="ident" id="6894129">cli</span><span class="op" id="6894132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6894136">fmt</span><span class="op" id="6894139">.</span><span class="ident" id="6894140">Fprintf</span><span class="op" id="6894147">(</span><span class="ident" id="6894148">cli</span><span class="op" id="6894151">,</span>&nbsp;<span class="string" id="6894153">&#34;{}&#34;</span><span class="op" id="6894157">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6894160">var</span>&nbsp;<span class="ident" id="6894164">resp</span>&nbsp;<span class="ident" id="6894169">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6894183">if</span>&nbsp;<span class="ident" id="6894186">err</span>&nbsp;<span class="op" id="6894190">:=</span>&nbsp;<span class="ident" id="6894193">dec</span><span class="op" id="6894196">.</span><span class="ident" id="6894197">Decode</span><span class="op" id="6894203">(</span><span class="op" id="6894204">&amp;</span><span class="ident" id="6894205">resp</span><span class="op" id="6894209">)</span><span class="op" id="6894210">;</span>&nbsp;<span class="ident" id="6894212">err</span>&nbsp;<span class="op" id="6894216">!=</span>&nbsp;<span class="ident" id="6894219">nil</span>&nbsp;<span class="op" id="6894223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6894227">t</span><span class="op" id="6894228">.</span><span class="ident" id="6894229">Fatalf</span><span class="op" id="6894235">(</span><span class="string" id="6894236">&#34;Decode&nbsp;after&nbsp;empty:&nbsp;%s&#34;</span><span class="op" id="6894260">,</span>&nbsp;<span class="ident" id="6894262">err</span><span class="op" id="6894265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6894268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6894271">if</span>&nbsp;<span class="ident" id="6894274">resp</span><span class="op" id="6894278">.</span><span class="ident" id="6894279">Error</span>&nbsp;<span class="op" id="6894285">==</span>&nbsp;<span class="ident" id="6894288">nil</span>&nbsp;<span class="op" id="6894292">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6894296">t</span><span class="op" id="6894297">.</span><span class="ident" id="6894298">Fatalf</span><span class="op" id="6894304">(</span><span class="string" id="6894305">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="6894330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6894333">}</span><br>
<span class="lineno"></span><span class="op" id="6894335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6894338">func</span>&nbsp;<span class="ident" id="6894343">TestServer</span><span class="op" id="6894353">(</span><span class="ident" id="6894354">t</span>&nbsp;<span class="op" id="6894356">*</span><span class="ident" id="6894357">testing</span><span class="op" id="6894364">.</span><span class="ident" id="6894365">T</span><span class="op" id="6894366">)</span>&nbsp;<span class="op" id="6894368">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6894371">cli</span><span class="op" id="6894374">,</span>&nbsp;<span class="ident" id="6894376">srv</span>&nbsp;<span class="op" id="6894380">:=</span>&nbsp;<span class="ident" id="6894383">net</span><span class="op" id="6894386">.</span><span class="ident" id="6894387">Pipe</span><span class="op" id="6894391">(</span><span class="op" id="6894392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6894395">defer</span>&nbsp;<span class="ident" id="6894401">cli</span><span class="op" id="6894404">.</span><span class="ident" id="6894405">Close</span><span class="op" id="6894410">(</span><span class="op" id="6894411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6894414">go</span>&nbsp;<span class="ident" id="6894417">ServeConn</span><span class="op" id="6894426">(</span><span class="ident" id="6894427">srv</span><span class="op" id="6894430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6894433">dec</span>&nbsp;<span class="op" id="6894437">:=</span>&nbsp;<span class="ident" id="6894440">json</span><span class="op" id="6894444">.</span><span class="ident" id="6894445">NewDecoder</span><span class="op" id="6894455">(</span><span class="ident" id="6894456">cli</span><span class="op" id="6894459">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6894463">//&nbsp;Send&nbsp;hand-coded&nbsp;requests&nbsp;to&nbsp;server,&nbsp;parse&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6894520">for</span>&nbsp;<span class="ident" id="6894524">i</span>&nbsp;<span class="op" id="6894526">:=</span>&nbsp;<span class="num" id="6894529">0</span><span class="op" id="6894530">;</span>&nbsp;<span class="ident" id="6894532">i</span>&nbsp;<span class="op" id="6894534">&lt;</span>&nbsp;<span class="num" id="6894536">10</span><span class="op" id="6894538">;</span>&nbsp;<span class="ident" id="6894540">i</span><span class="op" id="6894541">++</span>&nbsp;<span class="op" id="6894544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6894548">fmt</span><span class="op" id="6894551">.</span><span class="ident" id="6894552">Fprintf</span><span class="op" id="6894559">(</span><span class="ident" id="6894560">cli</span><span class="op" id="6894563">,</span>&nbsp;<span class="string" id="6894565">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;\u%04d&#34;,&nbsp;&#34;params&#34;:&nbsp;[{&#34;A&#34;:&nbsp;%d,&nbsp;&#34;B&#34;:&nbsp;%d}]}`</span><span class="op" id="6894638">,</span>&nbsp;<span class="ident" id="6894640">i</span><span class="op" id="6894641">,</span>&nbsp;<span class="ident" id="6894643">i</span><span class="op" id="6894644">,</span>&nbsp;<span class="ident" id="6894646">i</span><span class="op" id="6894647">+</span><span class="num" id="6894648">1</span><span class="op" id="6894649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6894653">var</span>&nbsp;<span class="ident" id="6894657">resp</span>&nbsp;<span class="ident" id="6894662">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6894677">err</span>&nbsp;<span class="op" id="6894681">:=</span>&nbsp;<span class="ident" id="6894684">dec</span><span class="op" id="6894687">.</span><span class="ident" id="6894688">Decode</span><span class="op" id="6894694">(</span><span class="op" id="6894695">&amp;</span><span class="ident" id="6894696">resp</span><span class="op" id="6894700">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6894704">if</span>&nbsp;<span class="ident" id="6894707">err</span>&nbsp;<span class="op" id="6894711">!=</span>&nbsp;<span class="ident" id="6894714">nil</span>&nbsp;<span class="op" id="6894718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6894723">t</span><span class="op" id="6894724">.</span><span class="ident" id="6894725">Fatalf</span><span class="op" id="6894731">(</span><span class="string" id="6894732">&#34;Decode:&nbsp;%s&#34;</span><span class="op" id="6894744">,</span>&nbsp;<span class="ident" id="6894746">err</span><span class="op" id="6894749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6894753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6894757">if</span>&nbsp;<span class="ident" id="6894760">resp</span><span class="op" id="6894764">.</span><span class="ident" id="6894765">Error</span>&nbsp;<span class="op" id="6894771">!=</span>&nbsp;<span class="ident" id="6894774">nil</span>&nbsp;<span class="op" id="6894778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6894783">t</span><span class="op" id="6894784">.</span><span class="ident" id="6894785">Fatalf</span><span class="op" id="6894791">(</span><span class="string" id="6894792">&#34;resp.Error:&nbsp;%s&#34;</span><span class="op" id="6894808">,</span>&nbsp;<span class="ident" id="6894810">resp</span><span class="op" id="6894814">.</span><span class="ident" id="6894815">Error</span><span class="op" id="6894820">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6894824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6894828">if</span>&nbsp;<span class="ident" id="6894831">resp</span><span class="op" id="6894835">.</span><span class="ident" id="6894836">Id</span><span class="op" id="6894838">.</span><span class="op" id="6894839">(</span><span class="builtintype" id="6894840">string</span><span class="op" id="6894846">)</span>&nbsp;<span class="op" id="6894848">!=</span>&nbsp;<span class="builtintype" id="6894851">string</span><span class="op" id="6894857">(</span><span class="ident" id="6894858">i</span><span class="op" id="6894859">)</span>&nbsp;<span class="op" id="6894861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6894866">t</span><span class="op" id="6894867">.</span><span class="ident" id="6894868">Fatalf</span><span class="op" id="6894874">(</span><span class="string" id="6894875">&#34;resp:&nbsp;bad&nbsp;id&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6894900">,</span>&nbsp;<span class="ident" id="6894902">resp</span><span class="op" id="6894906">.</span><span class="ident" id="6894907">Id</span><span class="op" id="6894909">.</span><span class="op" id="6894910">(</span><span class="builtintype" id="6894911">string</span><span class="op" id="6894917">)</span><span class="op" id="6894918">,</span>&nbsp;<span class="builtintype" id="6894920">string</span><span class="op" id="6894926">(</span><span class="ident" id="6894927">i</span><span class="op" id="6894928">)</span><span class="op" id="6894929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6894933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6894937">if</span>&nbsp;<span class="ident" id="6894940">resp</span><span class="op" id="6894944">.</span><span class="ident" id="6894945">Result</span><span class="op" id="6894951">.</span><span class="ident" id="6894952">C</span>&nbsp;<span class="op" id="6894954">!=</span>&nbsp;<span class="num" id="6894957">2</span><span class="op" id="6894958">*</span><span class="ident" id="6894959">i</span><span class="op" id="6894960">+</span><span class="num" id="6894961">1</span>&nbsp;<span class="op" id="6894963">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6894968">t</span><span class="op" id="6894969">.</span><span class="ident" id="6894970">Fatalf</span><span class="op" id="6894976">(</span><span class="string" id="6894977">&#34;resp:&nbsp;bad&nbsp;result:&nbsp;%d+%d=%d&#34;</span><span class="op" id="6895005">,</span>&nbsp;<span class="ident" id="6895007">i</span><span class="op" id="6895008">,</span>&nbsp;<span class="ident" id="6895010">i</span><span class="op" id="6895011">+</span><span class="num" id="6895012">1</span><span class="op" id="6895013">,</span>&nbsp;<span class="ident" id="6895015">resp</span><span class="op" id="6895019">.</span><span class="ident" id="6895020">Result</span><span class="op" id="6895026">.</span><span class="ident" id="6895027">C</span><span class="op" id="6895028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6895032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6895035">}</span><br>
<span class="lineno"></span><span class="op" id="6895037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6895040">func</span>&nbsp;<span class="ident" id="6895045">TestClient</span><span class="op" id="6895055">(</span><span class="ident" id="6895056">t</span>&nbsp;<span class="op" id="6895058">*</span><span class="ident" id="6895059">testing</span><span class="op" id="6895066">.</span><span class="ident" id="6895067">T</span><span class="op" id="6895068">)</span>&nbsp;<span class="op" id="6895070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6895073">//&nbsp;Assume&nbsp;server&nbsp;is&nbsp;okay&nbsp;(TestServer&nbsp;is&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6895122">//&nbsp;Test&nbsp;client&nbsp;against&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895154">cli</span><span class="op" id="6895157">,</span>&nbsp;<span class="ident" id="6895159">srv</span>&nbsp;<span class="op" id="6895163">:=</span>&nbsp;<span class="ident" id="6895166">net</span><span class="op" id="6895169">.</span><span class="ident" id="6895170">Pipe</span><span class="op" id="6895174">(</span><span class="op" id="6895175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6895178">go</span>&nbsp;<span class="ident" id="6895181">ServeConn</span><span class="op" id="6895190">(</span><span class="ident" id="6895191">srv</span><span class="op" id="6895194">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895198">client</span>&nbsp;<span class="op" id="6895205">:=</span>&nbsp;<span class="ident" id="6895208">NewClient</span><span class="op" id="6895217">(</span><span class="ident" id="6895218">cli</span><span class="op" id="6895221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6895224">defer</span>&nbsp;<span class="ident" id="6895230">client</span><span class="op" id="6895236">.</span><span class="ident" id="6895237">Close</span><span class="op" id="6895242">(</span><span class="op" id="6895243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6895247">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895269">args</span>&nbsp;<span class="op" id="6895274">:=</span>&nbsp;<span class="op" id="6895277">&amp;</span><span class="ident" id="6895278">Args</span><span class="op" id="6895282">{</span><span class="num" id="6895283">7</span><span class="op" id="6895284">,</span>&nbsp;<span class="num" id="6895286">8</span><span class="op" id="6895287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895290">reply</span>&nbsp;<span class="op" id="6895296">:=</span>&nbsp;<span class="builtinfunc" id="6895299">new</span><span class="op" id="6895302">(</span><span class="ident" id="6895303">Reply</span><span class="op" id="6895308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895311">err</span>&nbsp;<span class="op" id="6895315">:=</span>&nbsp;<span class="ident" id="6895318">client</span><span class="op" id="6895324">.</span><span class="ident" id="6895325">Call</span><span class="op" id="6895329">(</span><span class="string" id="6895330">&#34;Arith.Add&#34;</span><span class="op" id="6895341">,</span>&nbsp;<span class="ident" id="6895343">args</span><span class="op" id="6895347">,</span>&nbsp;<span class="ident" id="6895349">reply</span><span class="op" id="6895354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6895357">if</span>&nbsp;<span class="ident" id="6895360">err</span>&nbsp;<span class="op" id="6895364">!=</span>&nbsp;<span class="ident" id="6895367">nil</span>&nbsp;<span class="op" id="6895371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895375">t</span><span class="op" id="6895376">.</span><span class="ident" id="6895377">Errorf</span><span class="op" id="6895383">(</span><span class="string" id="6895384">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6895426">,</span>&nbsp;<span class="ident" id="6895428">err</span><span class="op" id="6895431">.</span><span class="ident" id="6895432">Error</span><span class="op" id="6895437">(</span><span class="op" id="6895438">)</span><span class="op" id="6895439">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6895442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6895445">if</span>&nbsp;<span class="ident" id="6895448">reply</span><span class="op" id="6895453">.</span><span class="ident" id="6895454">C</span>&nbsp;<span class="op" id="6895456">!=</span>&nbsp;<span class="ident" id="6895459">args</span><span class="op" id="6895463">.</span><span class="ident" id="6895464">A</span><span class="op" id="6895465">+</span><span class="ident" id="6895466">args</span><span class="op" id="6895470">.</span><span class="ident" id="6895471">B</span>&nbsp;<span class="op" id="6895473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895477">t</span><span class="op" id="6895478">.</span><span class="ident" id="6895479">Errorf</span><span class="op" id="6895485">(</span><span class="string" id="6895486">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6895511">,</span>&nbsp;<span class="ident" id="6895513">reply</span><span class="op" id="6895518">.</span><span class="ident" id="6895519">C</span><span class="op" id="6895520">,</span>&nbsp;<span class="ident" id="6895522">args</span><span class="op" id="6895526">.</span><span class="ident" id="6895527">A</span><span class="op" id="6895528">+</span><span class="ident" id="6895529">args</span><span class="op" id="6895533">.</span><span class="ident" id="6895534">B</span><span class="op" id="6895535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6895538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895542">args</span>&nbsp;<span class="op" id="6895547">=</span>&nbsp;<span class="op" id="6895549">&amp;</span><span class="ident" id="6895550">Args</span><span class="op" id="6895554">{</span><span class="num" id="6895555">7</span><span class="op" id="6895556">,</span>&nbsp;<span class="num" id="6895558">8</span><span class="op" id="6895559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895562">reply</span>&nbsp;<span class="op" id="6895568">=</span>&nbsp;<span class="builtinfunc" id="6895570">new</span><span class="op" id="6895573">(</span><span class="ident" id="6895574">Reply</span><span class="op" id="6895579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895582">err</span>&nbsp;<span class="op" id="6895586">=</span>&nbsp;<span class="ident" id="6895588">client</span><span class="op" id="6895594">.</span><span class="ident" id="6895595">Call</span><span class="op" id="6895599">(</span><span class="string" id="6895600">&#34;Arith.Mul&#34;</span><span class="op" id="6895611">,</span>&nbsp;<span class="ident" id="6895613">args</span><span class="op" id="6895617">,</span>&nbsp;<span class="ident" id="6895619">reply</span><span class="op" id="6895624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6895627">if</span>&nbsp;<span class="ident" id="6895630">err</span>&nbsp;<span class="op" id="6895634">!=</span>&nbsp;<span class="ident" id="6895637">nil</span>&nbsp;<span class="op" id="6895641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895645">t</span><span class="op" id="6895646">.</span><span class="ident" id="6895647">Errorf</span><span class="op" id="6895653">(</span><span class="string" id="6895654">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6895696">,</span>&nbsp;<span class="ident" id="6895698">err</span><span class="op" id="6895701">.</span><span class="ident" id="6895702">Error</span><span class="op" id="6895707">(</span><span class="op" id="6895708">)</span><span class="op" id="6895709">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6895712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6895715">if</span>&nbsp;<span class="ident" id="6895718">reply</span><span class="op" id="6895723">.</span><span class="ident" id="6895724">C</span>&nbsp;<span class="op" id="6895726">!=</span>&nbsp;<span class="ident" id="6895729">args</span><span class="op" id="6895733">.</span><span class="ident" id="6895734">A</span><span class="op" id="6895735">*</span><span class="ident" id="6895736">args</span><span class="op" id="6895740">.</span><span class="ident" id="6895741">B</span>&nbsp;<span class="op" id="6895743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895747">t</span><span class="op" id="6895748">.</span><span class="ident" id="6895749">Errorf</span><span class="op" id="6895755">(</span><span class="string" id="6895756">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6895781">,</span>&nbsp;<span class="ident" id="6895783">reply</span><span class="op" id="6895788">.</span><span class="ident" id="6895789">C</span><span class="op" id="6895790">,</span>&nbsp;<span class="ident" id="6895792">args</span><span class="op" id="6895796">.</span><span class="ident" id="6895797">A</span><span class="op" id="6895798">*</span><span class="ident" id="6895799">args</span><span class="op" id="6895803">.</span><span class="ident" id="6895804">B</span><span class="op" id="6895805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6895808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6895812">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895830">args</span>&nbsp;<span class="op" id="6895835">=</span>&nbsp;<span class="op" id="6895837">&amp;</span><span class="ident" id="6895838">Args</span><span class="op" id="6895842">{</span><span class="num" id="6895843">7</span><span class="op" id="6895844">,</span>&nbsp;<span class="num" id="6895846">8</span><span class="op" id="6895847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895850">mulReply</span>&nbsp;<span class="op" id="6895859">:=</span>&nbsp;<span class="builtinfunc" id="6895862">new</span><span class="op" id="6895865">(</span><span class="ident" id="6895866">Reply</span><span class="op" id="6895871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895874">mulCall</span>&nbsp;<span class="op" id="6895882">:=</span>&nbsp;<span class="ident" id="6895885">client</span><span class="op" id="6895891">.</span><span class="ident" id="6895892">Go</span><span class="op" id="6895894">(</span><span class="string" id="6895895">&#34;Arith.Mul&#34;</span><span class="op" id="6895906">,</span>&nbsp;<span class="ident" id="6895908">args</span><span class="op" id="6895912">,</span>&nbsp;<span class="ident" id="6895914">mulReply</span><span class="op" id="6895922">,</span>&nbsp;<span class="ident" id="6895924">nil</span><span class="op" id="6895927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895930">addReply</span>&nbsp;<span class="op" id="6895939">:=</span>&nbsp;<span class="builtinfunc" id="6895942">new</span><span class="op" id="6895945">(</span><span class="ident" id="6895946">Reply</span><span class="op" id="6895951">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6895954">addCall</span>&nbsp;<span class="op" id="6895962">:=</span>&nbsp;<span class="ident" id="6895965">client</span><span class="op" id="6895971">.</span><span class="ident" id="6895972">Go</span><span class="op" id="6895974">(</span><span class="string" id="6895975">&#34;Arith.Add&#34;</span><span class="op" id="6895986">,</span>&nbsp;<span class="ident" id="6895988">args</span><span class="op" id="6895992">,</span>&nbsp;<span class="ident" id="6895994">addReply</span><span class="op" id="6896002">,</span>&nbsp;<span class="ident" id="6896004">nil</span><span class="op" id="6896007">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896011">addCall</span>&nbsp;<span class="op" id="6896019">=</span>&nbsp;<span class="op" id="6896021">&lt;-</span><span class="ident" id="6896023">addCall</span><span class="op" id="6896030">.</span><span class="ident" id="6896031">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6896037">if</span>&nbsp;<span class="ident" id="6896040">addCall</span><span class="op" id="6896047">.</span><span class="ident" id="6896048">Error</span>&nbsp;<span class="op" id="6896054">!=</span>&nbsp;<span class="ident" id="6896057">nil</span>&nbsp;<span class="op" id="6896061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896065">t</span><span class="op" id="6896066">.</span><span class="ident" id="6896067">Errorf</span><span class="op" id="6896073">(</span><span class="string" id="6896074">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6896116">,</span>&nbsp;<span class="ident" id="6896118">addCall</span><span class="op" id="6896125">.</span><span class="ident" id="6896126">Error</span><span class="op" id="6896131">.</span><span class="ident" id="6896132">Error</span><span class="op" id="6896137">(</span><span class="op" id="6896138">)</span><span class="op" id="6896139">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6896142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6896145">if</span>&nbsp;<span class="ident" id="6896148">addReply</span><span class="op" id="6896156">.</span><span class="ident" id="6896157">C</span>&nbsp;<span class="op" id="6896159">!=</span>&nbsp;<span class="ident" id="6896162">args</span><span class="op" id="6896166">.</span><span class="ident" id="6896167">A</span><span class="op" id="6896168">+</span><span class="ident" id="6896169">args</span><span class="op" id="6896173">.</span><span class="ident" id="6896174">B</span>&nbsp;<span class="op" id="6896176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896180">t</span><span class="op" id="6896181">.</span><span class="ident" id="6896182">Errorf</span><span class="op" id="6896188">(</span><span class="string" id="6896189">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6896214">,</span>&nbsp;<span class="ident" id="6896216">addReply</span><span class="op" id="6896224">.</span><span class="ident" id="6896225">C</span><span class="op" id="6896226">,</span>&nbsp;<span class="ident" id="6896228">args</span><span class="op" id="6896232">.</span><span class="ident" id="6896233">A</span><span class="op" id="6896234">+</span><span class="ident" id="6896235">args</span><span class="op" id="6896239">.</span><span class="ident" id="6896240">B</span><span class="op" id="6896241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6896244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896248">mulCall</span>&nbsp;<span class="op" id="6896256">=</span>&nbsp;<span class="op" id="6896258">&lt;-</span><span class="ident" id="6896260">mulCall</span><span class="op" id="6896267">.</span><span class="ident" id="6896268">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6896274">if</span>&nbsp;<span class="ident" id="6896277">mulCall</span><span class="op" id="6896284">.</span><span class="ident" id="6896285">Error</span>&nbsp;<span class="op" id="6896291">!=</span>&nbsp;<span class="ident" id="6896294">nil</span>&nbsp;<span class="op" id="6896298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896302">t</span><span class="op" id="6896303">.</span><span class="ident" id="6896304">Errorf</span><span class="op" id="6896310">(</span><span class="string" id="6896311">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6896353">,</span>&nbsp;<span class="ident" id="6896355">mulCall</span><span class="op" id="6896362">.</span><span class="ident" id="6896363">Error</span><span class="op" id="6896368">.</span><span class="ident" id="6896369">Error</span><span class="op" id="6896374">(</span><span class="op" id="6896375">)</span><span class="op" id="6896376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6896379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6896382">if</span>&nbsp;<span class="ident" id="6896385">mulReply</span><span class="op" id="6896393">.</span><span class="ident" id="6896394">C</span>&nbsp;<span class="op" id="6896396">!=</span>&nbsp;<span class="ident" id="6896399">args</span><span class="op" id="6896403">.</span><span class="ident" id="6896404">A</span><span class="op" id="6896405">*</span><span class="ident" id="6896406">args</span><span class="op" id="6896410">.</span><span class="ident" id="6896411">B</span>&nbsp;<span class="op" id="6896413">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896417">t</span><span class="op" id="6896418">.</span><span class="ident" id="6896419">Errorf</span><span class="op" id="6896425">(</span><span class="string" id="6896426">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6896451">,</span>&nbsp;<span class="ident" id="6896453">mulReply</span><span class="op" id="6896461">.</span><span class="ident" id="6896462">C</span><span class="op" id="6896463">,</span>&nbsp;<span class="ident" id="6896465">args</span><span class="op" id="6896469">.</span><span class="ident" id="6896470">A</span><span class="op" id="6896471">*</span><span class="ident" id="6896472">args</span><span class="op" id="6896476">.</span><span class="ident" id="6896477">B</span><span class="op" id="6896478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6896481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6896485">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896500">args</span>&nbsp;<span class="op" id="6896505">=</span>&nbsp;<span class="op" id="6896507">&amp;</span><span class="ident" id="6896508">Args</span><span class="op" id="6896512">{</span><span class="num" id="6896513">7</span><span class="op" id="6896514">,</span>&nbsp;<span class="num" id="6896516">0</span><span class="op" id="6896517">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896520">reply</span>&nbsp;<span class="op" id="6896526">=</span>&nbsp;<span class="builtinfunc" id="6896528">new</span><span class="op" id="6896531">(</span><span class="ident" id="6896532">Reply</span><span class="op" id="6896537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896540">err</span>&nbsp;<span class="op" id="6896544">=</span>&nbsp;<span class="ident" id="6896546">client</span><span class="op" id="6896552">.</span><span class="ident" id="6896553">Call</span><span class="op" id="6896557">(</span><span class="string" id="6896558">&#34;Arith.Div&#34;</span><span class="op" id="6896569">,</span>&nbsp;<span class="ident" id="6896571">args</span><span class="op" id="6896575">,</span>&nbsp;<span class="ident" id="6896577">reply</span><span class="op" id="6896582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6896585">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6896618">if</span>&nbsp;<span class="ident" id="6896621">err</span>&nbsp;<span class="op" id="6896625">==</span>&nbsp;<span class="ident" id="6896628">nil</span>&nbsp;<span class="op" id="6896632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896636">t</span><span class="op" id="6896637">.</span><span class="ident" id="6896638">Error</span><span class="op" id="6896643">(</span><span class="string" id="6896644">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6896665">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6896668">}</span>&nbsp;<span class="keyword" id="6896670">else</span>&nbsp;<span class="keyword" id="6896675">if</span>&nbsp;<span class="ident" id="6896678">err</span><span class="op" id="6896681">.</span><span class="ident" id="6896682">Error</span><span class="op" id="6896687">(</span><span class="op" id="6896688">)</span>&nbsp;<span class="op" id="6896690">!=</span>&nbsp;<span class="string" id="6896693">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="6896710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896714">t</span><span class="op" id="6896715">.</span><span class="ident" id="6896716">Error</span><span class="op" id="6896721">(</span><span class="string" id="6896722">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="6896763">,</span>&nbsp;<span class="ident" id="6896765">err</span><span class="op" id="6896768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6896771">}</span><br>
<span class="lineno"></span><span class="op" id="6896773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="6896776">func</span>&nbsp;<span class="ident" id="6896781">TestMalformedInput</span><span class="op" id="6896799">(</span><span class="ident" id="6896800">t</span>&nbsp;<span class="op" id="6896802">*</span><span class="ident" id="6896803">testing</span><span class="op" id="6896810">.</span><span class="ident" id="6896811">T</span><span class="op" id="6896812">)</span>&nbsp;<span class="op" id="6896814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896817">cli</span><span class="op" id="6896820">,</span>&nbsp;<span class="ident" id="6896822">srv</span>&nbsp;<span class="op" id="6896826">:=</span>&nbsp;<span class="ident" id="6896829">net</span><span class="op" id="6896832">.</span><span class="ident" id="6896833">Pipe</span><span class="op" id="6896837">(</span><span class="op" id="6896838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6896841">go</span>&nbsp;<span class="ident" id="6896844">cli</span><span class="op" id="6896847">.</span><span class="ident" id="6896848">Write</span><span class="op" id="6896853">(</span><span class="op" id="6896854">[</span><span class="op" id="6896855">]</span><span class="builtintype" id="6896856">byte</span><span class="op" id="6896860">(</span><span class="string" id="6896861">`{id:1}`</span><span class="op" id="6896869">)</span><span class="op" id="6896870">)</span>&nbsp;<span class="comment" id="6896872">//&nbsp;invalid&nbsp;json</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896889">ServeConn</span><span class="op" id="6896898">(</span><span class="ident" id="6896899">srv</span><span class="op" id="6896902">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6896920">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="6896945">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="6896948">func</span>&nbsp;<span class="ident" id="6896953">TestMalformedOutput</span><span class="op" id="6896972">(</span><span class="ident" id="6896973">t</span>&nbsp;<span class="op" id="6896975">*</span><span class="ident" id="6896976">testing</span><span class="op" id="6896983">.</span><span class="ident" id="6896984">T</span><span class="op" id="6896985">)</span>&nbsp;<span class="op" id="6896987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6896990">cli</span><span class="op" id="6896993">,</span>&nbsp;<span class="ident" id="6896995">srv</span>&nbsp;<span class="op" id="6896999">:=</span>&nbsp;<span class="ident" id="6897002">net</span><span class="op" id="6897005">.</span><span class="ident" id="6897006">Pipe</span><span class="op" id="6897010">(</span><span class="op" id="6897011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6897014">go</span>&nbsp;<span class="ident" id="6897017">srv</span><span class="op" id="6897020">.</span><span class="ident" id="6897021">Write</span><span class="op" id="6897026">(</span><span class="op" id="6897027">[</span><span class="op" id="6897028">]</span><span class="builtintype" id="6897029">byte</span><span class="op" id="6897033">(</span><span class="string" id="6897034">`{&#34;id&#34;:0,&#34;result&#34;:null,&#34;error&#34;:null}`</span><span class="op" id="6897071">)</span><span class="op" id="6897072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6897075">go</span>&nbsp;<span class="ident" id="6897078">ioutil</span><span class="op" id="6897084">.</span><span class="ident" id="6897085">ReadAll</span><span class="op" id="6897092">(</span><span class="ident" id="6897093">srv</span><span class="op" id="6897096">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897100">client</span>&nbsp;<span class="op" id="6897107">:=</span>&nbsp;<span class="ident" id="6897110">NewClient</span><span class="op" id="6897119">(</span><span class="ident" id="6897120">cli</span><span class="op" id="6897123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6897126">defer</span>&nbsp;<span class="ident" id="6897132">client</span><span class="op" id="6897138">.</span><span class="ident" id="6897139">Close</span><span class="op" id="6897144">(</span><span class="op" id="6897145">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897149">args</span>&nbsp;<span class="op" id="6897154">:=</span>&nbsp;<span class="op" id="6897157">&amp;</span><span class="ident" id="6897158">Args</span><span class="op" id="6897162">{</span><span class="num" id="6897163">7</span><span class="op" id="6897164">,</span>&nbsp;<span class="num" id="6897166">8</span><span class="op" id="6897167">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897170">reply</span>&nbsp;<span class="op" id="6897176">:=</span>&nbsp;<span class="builtinfunc" id="6897179">new</span><span class="op" id="6897182">(</span><span class="ident" id="6897183">Reply</span><span class="op" id="6897188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897191">err</span>&nbsp;<span class="op" id="6897195">:=</span>&nbsp;<span class="ident" id="6897198">client</span><span class="op" id="6897204">.</span><span class="ident" id="6897205">Call</span><span class="op" id="6897209">(</span><span class="string" id="6897210">&#34;Arith.Add&#34;</span><span class="op" id="6897221">,</span>&nbsp;<span class="ident" id="6897223">args</span><span class="op" id="6897227">,</span>&nbsp;<span class="ident" id="6897229">reply</span><span class="op" id="6897234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6897237">if</span>&nbsp;<span class="ident" id="6897240">err</span>&nbsp;<span class="op" id="6897244">==</span>&nbsp;<span class="ident" id="6897247">nil</span>&nbsp;<span class="op" id="6897251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897255">t</span><span class="op" id="6897256">.</span><span class="ident" id="6897257">Error</span><span class="op" id="6897262">(</span><span class="string" id="6897263">&#34;expected&nbsp;error&#34;</span><span class="op" id="6897279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6897282">}</span><br>
<span class="lineno">205</span><span class="op" id="6897284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6897287">func</span>&nbsp;<span class="ident" id="6897292">TestServerErrorHasNullResult</span><span class="op" id="6897320">(</span><span class="ident" id="6897321">t</span>&nbsp;<span class="op" id="6897323">*</span><span class="ident" id="6897324">testing</span><span class="op" id="6897331">.</span><span class="ident" id="6897332">T</span><span class="op" id="6897333">)</span>&nbsp;<span class="op" id="6897335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6897338">var</span>&nbsp;<span class="ident" id="6897342">out</span>&nbsp;<span class="ident" id="6897346">bytes</span><span class="op" id="6897351">.</span><span class="ident" id="6897352">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897360">sc</span>&nbsp;<span class="op" id="6897363">:=</span>&nbsp;<span class="ident" id="6897366">NewServerCodec</span><span class="op" id="6897380">(</span><span class="keyword" id="6897381">struct</span>&nbsp;<span class="op" id="6897388">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897392">io</span><span class="op" id="6897394">.</span><span class="ident" id="6897395">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897404">io</span><span class="op" id="6897406">.</span><span class="ident" id="6897407">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897416">io</span><span class="op" id="6897418">.</span><span class="ident" id="6897419">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6897427">}</span><span class="op" id="6897428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897432">Reader</span><span class="op" id="6897438">:</span>&nbsp;<span class="ident" id="6897440">strings</span><span class="op" id="6897447">.</span><span class="ident" id="6897448">NewReader</span><span class="op" id="6897457">(</span><span class="string" id="6897458">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;,&nbsp;&#34;params&#34;:&nbsp;[]}`</span><span class="op" id="6897510">)</span><span class="op" id="6897511">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897515">Writer</span><span class="op" id="6897521">:</span>&nbsp;<span class="op" id="6897523">&amp;</span><span class="ident" id="6897524">out</span><span class="op" id="6897527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897531">Closer</span><span class="op" id="6897537">:</span>&nbsp;<span class="ident" id="6897539">ioutil</span><span class="op" id="6897545">.</span><span class="ident" id="6897546">NopCloser</span><span class="op" id="6897555">(</span><span class="ident" id="6897556">nil</span><span class="op" id="6897559">)</span><span class="op" id="6897560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6897563">}</span><span class="op" id="6897564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897567">r</span>&nbsp;<span class="op" id="6897569">:=</span>&nbsp;<span class="builtinfunc" id="6897572">new</span><span class="op" id="6897575">(</span><span class="ident" id="6897576">rpc</span><span class="op" id="6897579">.</span><span class="ident" id="6897580">Request</span><span class="op" id="6897587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6897590">if</span>&nbsp;<span class="ident" id="6897593">err</span>&nbsp;<span class="op" id="6897597">:=</span>&nbsp;<span class="ident" id="6897600">sc</span><span class="op" id="6897602">.</span><span class="ident" id="6897603">ReadRequestHeader</span><span class="op" id="6897620">(</span><span class="ident" id="6897621">r</span><span class="op" id="6897622">)</span><span class="op" id="6897623">;</span>&nbsp;<span class="ident" id="6897625">err</span>&nbsp;<span class="op" id="6897629">!=</span>&nbsp;<span class="ident" id="6897632">nil</span>&nbsp;<span class="op" id="6897636">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897640">t</span><span class="op" id="6897641">.</span><span class="ident" id="6897642">Fatal</span><span class="op" id="6897647">(</span><span class="ident" id="6897648">err</span><span class="op" id="6897651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6897654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6897657">const</span>&nbsp;<span class="ident" id="6897663">valueText</span>&nbsp;<span class="op" id="6897673">=</span>&nbsp;<span class="string" id="6897675">&#34;the&nbsp;value&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;see&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6897709">const</span>&nbsp;<span class="ident" id="6897715">errorText</span>&nbsp;<span class="op" id="6897725">=</span>&nbsp;<span class="string" id="6897727">&#34;some&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897741">err</span>&nbsp;<span class="op" id="6897745">:=</span>&nbsp;<span class="ident" id="6897748">sc</span><span class="op" id="6897750">.</span><span class="ident" id="6897751">WriteResponse</span><span class="op" id="6897764">(</span><span class="op" id="6897765">&amp;</span><span class="ident" id="6897766">rpc</span><span class="op" id="6897769">.</span><span class="ident" id="6897770">Response</span><span class="op" id="6897778">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897782">ServiceMethod</span><span class="op" id="6897795">:</span>&nbsp;<span class="string" id="6897797">&#34;Method&#34;</span><span class="op" id="6897805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897809">Seq</span><span class="op" id="6897812">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6897824">1</span><span class="op" id="6897825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897829">Error</span><span class="op" id="6897834">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6897844">errorText</span><span class="op" id="6897853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6897856">}</span><span class="op" id="6897857">,</span>&nbsp;<span class="ident" id="6897859">valueText</span><span class="op" id="6897868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6897871">if</span>&nbsp;<span class="ident" id="6897874">err</span>&nbsp;<span class="op" id="6897878">!=</span>&nbsp;<span class="ident" id="6897881">nil</span>&nbsp;<span class="op" id="6897885">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897889">t</span><span class="op" id="6897890">.</span><span class="ident" id="6897891">Fatal</span><span class="op" id="6897896">(</span><span class="ident" id="6897897">err</span><span class="op" id="6897900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6897903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6897906">if</span>&nbsp;<span class="op" id="6897909">!</span><span class="ident" id="6897910">strings</span><span class="op" id="6897917">.</span><span class="ident" id="6897918">Contains</span><span class="op" id="6897926">(</span><span class="ident" id="6897927">out</span><span class="op" id="6897930">.</span><span class="ident" id="6897931">String</span><span class="op" id="6897937">(</span><span class="op" id="6897938">)</span><span class="op" id="6897939">,</span>&nbsp;<span class="ident" id="6897941">errorText</span><span class="op" id="6897950">)</span>&nbsp;<span class="op" id="6897952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6897956">t</span><span class="op" id="6897957">.</span><span class="ident" id="6897958">Fatalf</span><span class="op" id="6897964">(</span><span class="string" id="6897965">&#34;Response&nbsp;didn&#39;t&nbsp;contain&nbsp;expected&nbsp;error&nbsp;%q:&nbsp;%s&#34;</span><span class="op" id="6898012">,</span>&nbsp;<span class="ident" id="6898014">errorText</span><span class="op" id="6898023">,</span>&nbsp;<span class="op" id="6898025">&amp;</span><span class="ident" id="6898026">out</span><span class="op" id="6898029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6898032">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6898035">if</span>&nbsp;<span class="ident" id="6898038">strings</span><span class="op" id="6898045">.</span><span class="ident" id="6898046">Contains</span><span class="op" id="6898054">(</span><span class="ident" id="6898055">out</span><span class="op" id="6898058">.</span><span class="ident" id="6898059">String</span><span class="op" id="6898065">(</span><span class="op" id="6898066">)</span><span class="op" id="6898067">,</span>&nbsp;<span class="ident" id="6898069">valueText</span><span class="op" id="6898078">)</span>&nbsp;<span class="op" id="6898080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898084">t</span><span class="op" id="6898085">.</span><span class="ident" id="6898086">Errorf</span><span class="op" id="6898092">(</span><span class="string" id="6898093">&#34;Response&nbsp;contains&nbsp;both&nbsp;an&nbsp;error&nbsp;and&nbsp;value:&nbsp;%s&#34;</span><span class="op" id="6898140">,</span>&nbsp;<span class="op" id="6898142">&amp;</span><span class="ident" id="6898143">out</span><span class="op" id="6898146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6898149">}</span><br>
<span class="lineno"></span><span class="op" id="6898151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="6898154">func</span>&nbsp;<span class="ident" id="6898159">TestUnexpectedError</span><span class="op" id="6898178">(</span><span class="ident" id="6898179">t</span>&nbsp;<span class="op" id="6898181">*</span><span class="ident" id="6898182">testing</span><span class="op" id="6898189">.</span><span class="ident" id="6898190">T</span><span class="op" id="6898191">)</span>&nbsp;<span class="op" id="6898193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898196">cli</span><span class="op" id="6898199">,</span>&nbsp;<span class="ident" id="6898201">srv</span>&nbsp;<span class="op" id="6898205">:=</span>&nbsp;<span class="ident" id="6898208">myPipe</span><span class="op" id="6898214">(</span><span class="op" id="6898215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6898218">go</span>&nbsp;<span class="ident" id="6898221">cli</span><span class="op" id="6898224">.</span><span class="ident" id="6898225">PipeWriter</span><span class="op" id="6898235">.</span><span class="ident" id="6898236">CloseWithError</span><span class="op" id="6898250">(</span><span class="ident" id="6898251">errors</span><span class="op" id="6898257">.</span><span class="ident" id="6898258">New</span><span class="op" id="6898261">(</span><span class="string" id="6898262">&#34;unexpected&nbsp;error!&#34;</span><span class="op" id="6898281">)</span><span class="op" id="6898282">)</span>&nbsp;<span class="comment" id="6898284">//&nbsp;reader&nbsp;will&nbsp;get&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898315">ServeConn</span><span class="op" id="6898324">(</span><span class="ident" id="6898325">srv</span><span class="op" id="6898328">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6898381">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="6898406">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6898409">//&nbsp;Copied&nbsp;from&nbsp;package&nbsp;net.</span><br>
<span class="lineno"></span><span class="keyword" id="6898437">func</span>&nbsp;<span class="ident" id="6898442">myPipe</span><span class="op" id="6898448">(</span><span class="op" id="6898449">)</span>&nbsp;<span class="op" id="6898451">(</span><span class="op" id="6898452">*</span><span class="ident" id="6898453">pipe</span><span class="op" id="6898457">,</span>&nbsp;<span class="op" id="6898459">*</span><span class="ident" id="6898460">pipe</span><span class="op" id="6898464">)</span>&nbsp;<span class="op" id="6898466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898469">r1</span><span class="op" id="6898471">,</span>&nbsp;<span class="ident" id="6898473">w1</span>&nbsp;<span class="op" id="6898476">:=</span>&nbsp;<span class="ident" id="6898479">io</span><span class="op" id="6898481">.</span><span class="ident" id="6898482">Pipe</span><span class="op" id="6898486">(</span><span class="op" id="6898487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898490">r2</span><span class="op" id="6898492">,</span>&nbsp;<span class="ident" id="6898494">w2</span>&nbsp;<span class="op" id="6898497">:=</span>&nbsp;<span class="ident" id="6898500">io</span><span class="op" id="6898502">.</span><span class="ident" id="6898503">Pipe</span><span class="op" id="6898507">(</span><span class="op" id="6898508">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6898512">return</span>&nbsp;<span class="op" id="6898519">&amp;</span><span class="ident" id="6898520">pipe</span><span class="op" id="6898524">{</span><span class="ident" id="6898525">r1</span><span class="op" id="6898527">,</span>&nbsp;<span class="ident" id="6898529">w2</span><span class="op" id="6898531">}</span><span class="op" id="6898532">,</span>&nbsp;<span class="op" id="6898534">&amp;</span><span class="ident" id="6898535">pipe</span><span class="op" id="6898539">{</span><span class="ident" id="6898540">r2</span><span class="op" id="6898542">,</span>&nbsp;<span class="ident" id="6898544">w1</span><span class="op" id="6898546">}</span><br>
<span class="lineno"></span><span class="op" id="6898548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6898551">type</span>&nbsp;<span class="ident" id="6898556">pipe</span>&nbsp;<span class="keyword" id="6898561">struct</span>&nbsp;<span class="op" id="6898568">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6898571">*</span><span class="ident" id="6898572">io</span><span class="op" id="6898574">.</span><span class="ident" id="6898575">PipeReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6898587">*</span><span class="ident" id="6898588">io</span><span class="op" id="6898590">.</span><span class="ident" id="6898591">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="6898602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6898605">type</span>&nbsp;<span class="ident" id="6898610">pipeAddr</span>&nbsp;<span class="builtintype" id="6898619">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="6898624">func</span>&nbsp;<span class="op" id="6898629">(</span><span class="ident" id="6898630">pipeAddr</span><span class="op" id="6898638">)</span>&nbsp;<span class="ident" id="6898640">Network</span><span class="op" id="6898647">(</span><span class="op" id="6898648">)</span>&nbsp;<span class="builtintype" id="6898650">string</span>&nbsp;<span class="op" id="6898657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6898660">return</span>&nbsp;<span class="string" id="6898667">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="6898674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="6898677">func</span>&nbsp;<span class="op" id="6898682">(</span><span class="ident" id="6898683">pipeAddr</span><span class="op" id="6898691">)</span>&nbsp;<span class="ident" id="6898693">String</span><span class="op" id="6898699">(</span><span class="op" id="6898700">)</span>&nbsp;<span class="builtintype" id="6898702">string</span>&nbsp;<span class="op" id="6898709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6898712">return</span>&nbsp;<span class="string" id="6898719">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="6898726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6898729">func</span>&nbsp;<span class="op" id="6898734">(</span><span class="ident" id="6898735">p</span>&nbsp;<span class="op" id="6898737">*</span><span class="ident" id="6898738">pipe</span><span class="op" id="6898742">)</span>&nbsp;<span class="ident" id="6898744">Close</span><span class="op" id="6898749">(</span><span class="op" id="6898750">)</span>&nbsp;<span class="builtintype" id="6898752">error</span>&nbsp;<span class="op" id="6898758">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898761">err</span>&nbsp;<span class="op" id="6898765">:=</span>&nbsp;<span class="ident" id="6898768">p</span><span class="op" id="6898769">.</span><span class="ident" id="6898770">PipeReader</span><span class="op" id="6898780">.</span><span class="ident" id="6898781">Close</span><span class="op" id="6898786">(</span><span class="op" id="6898787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898790">err1</span>&nbsp;<span class="op" id="6898795">:=</span>&nbsp;<span class="ident" id="6898798">p</span><span class="op" id="6898799">.</span><span class="ident" id="6898800">PipeWriter</span><span class="op" id="6898810">.</span><span class="ident" id="6898811">Close</span><span class="op" id="6898816">(</span><span class="op" id="6898817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6898820">if</span>&nbsp;<span class="ident" id="6898823">err</span>&nbsp;<span class="op" id="6898827">==</span>&nbsp;<span class="ident" id="6898830">nil</span>&nbsp;<span class="op" id="6898834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898838">err</span>&nbsp;<span class="op" id="6898842">=</span>&nbsp;<span class="ident" id="6898844">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6898850">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6898853">return</span>&nbsp;<span class="ident" id="6898860">err</span><br>
<span class="lineno"></span><span class="op" id="6898864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6898867">func</span>&nbsp;<span class="op" id="6898872">(</span><span class="ident" id="6898873">p</span>&nbsp;<span class="op" id="6898875">*</span><span class="ident" id="6898876">pipe</span><span class="op" id="6898880">)</span>&nbsp;<span class="ident" id="6898882">LocalAddr</span><span class="op" id="6898891">(</span><span class="op" id="6898892">)</span>&nbsp;<span class="ident" id="6898894">net</span><span class="op" id="6898897">.</span><span class="ident" id="6898898">Addr</span>&nbsp;<span class="op" id="6898903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6898906">return</span>&nbsp;<span class="ident" id="6898913">pipeAddr</span><span class="op" id="6898921">(</span><span class="num" id="6898922">0</span><span class="op" id="6898923">)</span><br>
<span class="lineno">280</span><span class="op" id="6898925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6898928">func</span>&nbsp;<span class="op" id="6898933">(</span><span class="ident" id="6898934">p</span>&nbsp;<span class="op" id="6898936">*</span><span class="ident" id="6898937">pipe</span><span class="op" id="6898941">)</span>&nbsp;<span class="ident" id="6898943">RemoteAddr</span><span class="op" id="6898953">(</span><span class="op" id="6898954">)</span>&nbsp;<span class="ident" id="6898956">net</span><span class="op" id="6898959">.</span><span class="ident" id="6898960">Addr</span>&nbsp;<span class="op" id="6898965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6898968">return</span>&nbsp;<span class="ident" id="6898975">pipeAddr</span><span class="op" id="6898983">(</span><span class="num" id="6898984">0</span><span class="op" id="6898985">)</span><br>
<span class="lineno"></span><span class="op" id="6898987">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="6898990">func</span>&nbsp;<span class="op" id="6898995">(</span><span class="ident" id="6898996">p</span>&nbsp;<span class="op" id="6898998">*</span><span class="ident" id="6898999">pipe</span><span class="op" id="6899003">)</span>&nbsp;<span class="ident" id="6899005">SetTimeout</span><span class="op" id="6899015">(</span><span class="ident" id="6899016">nsec</span>&nbsp;<span class="ident" id="6899021">int64</span><span class="op" id="6899026">)</span>&nbsp;<span class="builtintype" id="6899028">error</span>&nbsp;<span class="op" id="6899034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6899037">return</span>&nbsp;<span class="ident" id="6899044">errors</span><span class="op" id="6899050">.</span><span class="ident" id="6899051">New</span><span class="op" id="6899054">(</span><span class="string" id="6899055">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="6899091">)</span><br>
<span class="lineno"></span><span class="op" id="6899093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="6899096">func</span>&nbsp;<span class="op" id="6899101">(</span><span class="ident" id="6899102">p</span>&nbsp;<span class="op" id="6899104">*</span><span class="ident" id="6899105">pipe</span><span class="op" id="6899109">)</span>&nbsp;<span class="ident" id="6899111">SetReadTimeout</span><span class="op" id="6899125">(</span><span class="ident" id="6899126">nsec</span>&nbsp;<span class="ident" id="6899131">int64</span><span class="op" id="6899136">)</span>&nbsp;<span class="builtintype" id="6899138">error</span>&nbsp;<span class="op" id="6899144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6899147">return</span>&nbsp;<span class="ident" id="6899154">errors</span><span class="op" id="6899160">.</span><span class="ident" id="6899161">New</span><span class="op" id="6899164">(</span><span class="string" id="6899165">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="6899201">)</span><br>
<span class="lineno"></span><span class="op" id="6899203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6899206">func</span>&nbsp;<span class="op" id="6899211">(</span><span class="ident" id="6899212">p</span>&nbsp;<span class="op" id="6899214">*</span><span class="ident" id="6899215">pipe</span><span class="op" id="6899219">)</span>&nbsp;<span class="ident" id="6899221">SetWriteTimeout</span><span class="op" id="6899236">(</span><span class="ident" id="6899237">nsec</span>&nbsp;<span class="ident" id="6899242">int64</span><span class="op" id="6899247">)</span>&nbsp;<span class="builtintype" id="6899249">error</span>&nbsp;<span class="op" id="6899255">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6899258">return</span>&nbsp;<span class="ident" id="6899265">errors</span><span class="op" id="6899271">.</span><span class="ident" id="6899272">New</span><span class="op" id="6899275">(</span><span class="string" id="6899276">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="6899312">)</span><br>
<span class="lineno"></span><span class="op" id="6899314">}</span>
</div>
</body>
</html>
