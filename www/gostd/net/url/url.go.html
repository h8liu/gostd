<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/url</h2>
<ul>
<li><a href="/gostd/net/url/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/url/url.go.html" class="current">url.go</a></li>
<li><a href="/gostd/net/url/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3063583">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3063638">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3063692">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3063743">//&nbsp;Package&nbsp;url&nbsp;parses&nbsp;URLs&nbsp;and&nbsp;implements&nbsp;query&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="comment" id="3063801">//&nbsp;See&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3063818">package</span>&nbsp;<span class="ident" id="3063826">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3063831">import</span>&nbsp;<span class="op" id="3063838">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3063841">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3063850">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3063860">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3063868">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3063879">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3063889">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3063892">//&nbsp;Error&nbsp;reports&nbsp;an&nbsp;error&nbsp;and&nbsp;the&nbsp;operation&nbsp;and&nbsp;URL&nbsp;that&nbsp;caused&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3063960">type</span>&nbsp;<span class="ident" id="3063965">Error</span>&nbsp;<span class="keyword" id="3063971">struct</span>&nbsp;<span class="op" id="3063978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063981">Op</span>&nbsp;&nbsp;<span class="builtintype" id="3063985">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063993">URL</span>&nbsp;<span class="builtintype" id="3063997">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064005">Err</span>&nbsp;<span class="builtintype" id="3064009">error</span><br>
<span class="lineno"></span><span class="op" id="3064015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3064018">func</span>&nbsp;<span class="op" id="3064023">(</span><span class="ident" id="3064024">e</span>&nbsp;<span class="op" id="3064026">*</span><span class="ident" id="3064027">Error</span><span class="op" id="3064032">)</span>&nbsp;<span class="ident" id="3064034">Error</span><span class="op" id="3064039">(</span><span class="op" id="3064040">)</span>&nbsp;<span class="builtintype" id="3064042">string</span>&nbsp;<span class="op" id="3064049">{</span>&nbsp;<span class="keyword" id="3064051">return</span>&nbsp;<span class="ident" id="3064058">e</span><span class="op" id="3064059">.</span><span class="ident" id="3064060">Op</span>&nbsp;<span class="op" id="3064063">+</span>&nbsp;<span class="string" id="3064065">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3064069">+</span>&nbsp;<span class="ident" id="3064071">e</span><span class="op" id="3064072">.</span><span class="ident" id="3064073">URL</span>&nbsp;<span class="op" id="3064077">+</span>&nbsp;<span class="string" id="3064079">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3064084">+</span>&nbsp;<span class="ident" id="3064086">e</span><span class="op" id="3064087">.</span><span class="ident" id="3064088">Err</span><span class="op" id="3064091">.</span><span class="ident" id="3064092">Error</span><span class="op" id="3064097">(</span><span class="op" id="3064098">)</span>&nbsp;<span class="op" id="3064100">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3064103">func</span>&nbsp;<span class="ident" id="3064108">ishex</span><span class="op" id="3064113">(</span><span class="ident" id="3064114">c</span>&nbsp;<span class="builtintype" id="3064116">byte</span><span class="op" id="3064120">)</span>&nbsp;<span class="builtintype" id="3064122">bool</span>&nbsp;<span class="op" id="3064127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064130">switch</span>&nbsp;<span class="op" id="3064137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064140">case</span>&nbsp;<span class="string" id="3064145">&#39;0&#39;</span>&nbsp;<span class="op" id="3064149">&lt;=</span>&nbsp;<span class="ident" id="3064152">c</span>&nbsp;<span class="op" id="3064154">&amp;&amp;</span>&nbsp;<span class="ident" id="3064157">c</span>&nbsp;<span class="op" id="3064159">&lt;=</span>&nbsp;<span class="string" id="3064162">&#39;9&#39;</span><span class="op" id="3064165">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064169">return</span>&nbsp;<span class="builtintype" id="3064176">true</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064182">case</span>&nbsp;<span class="string" id="3064187">&#39;a&#39;</span>&nbsp;<span class="op" id="3064191">&lt;=</span>&nbsp;<span class="ident" id="3064194">c</span>&nbsp;<span class="op" id="3064196">&amp;&amp;</span>&nbsp;<span class="ident" id="3064199">c</span>&nbsp;<span class="op" id="3064201">&lt;=</span>&nbsp;<span class="string" id="3064204">&#39;f&#39;</span><span class="op" id="3064207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064211">return</span>&nbsp;<span class="builtintype" id="3064218">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064224">case</span>&nbsp;<span class="string" id="3064229">&#39;A&#39;</span>&nbsp;<span class="op" id="3064233">&lt;=</span>&nbsp;<span class="ident" id="3064236">c</span>&nbsp;<span class="op" id="3064238">&amp;&amp;</span>&nbsp;<span class="ident" id="3064241">c</span>&nbsp;<span class="op" id="3064243">&lt;=</span>&nbsp;<span class="string" id="3064246">&#39;F&#39;</span><span class="op" id="3064249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064253">return</span>&nbsp;<span class="builtintype" id="3064260">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064266">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064269">return</span>&nbsp;<span class="builtintype" id="3064276">false</span><br>
<span class="lineno"></span><span class="op" id="3064282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3064285">func</span>&nbsp;<span class="ident" id="3064290">unhex</span><span class="op" id="3064295">(</span><span class="ident" id="3064296">c</span>&nbsp;<span class="builtintype" id="3064298">byte</span><span class="op" id="3064302">)</span>&nbsp;<span class="builtintype" id="3064304">byte</span>&nbsp;<span class="op" id="3064309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064312">switch</span>&nbsp;<span class="op" id="3064319">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064322">case</span>&nbsp;<span class="string" id="3064327">&#39;0&#39;</span>&nbsp;<span class="op" id="3064331">&lt;=</span>&nbsp;<span class="ident" id="3064334">c</span>&nbsp;<span class="op" id="3064336">&amp;&amp;</span>&nbsp;<span class="ident" id="3064339">c</span>&nbsp;<span class="op" id="3064341">&lt;=</span>&nbsp;<span class="string" id="3064344">&#39;9&#39;</span><span class="op" id="3064347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064351">return</span>&nbsp;<span class="ident" id="3064358">c</span>&nbsp;<span class="op" id="3064360">-</span>&nbsp;<span class="string" id="3064362">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064367">case</span>&nbsp;<span class="string" id="3064372">&#39;a&#39;</span>&nbsp;<span class="op" id="3064376">&lt;=</span>&nbsp;<span class="ident" id="3064379">c</span>&nbsp;<span class="op" id="3064381">&amp;&amp;</span>&nbsp;<span class="ident" id="3064384">c</span>&nbsp;<span class="op" id="3064386">&lt;=</span>&nbsp;<span class="string" id="3064389">&#39;f&#39;</span><span class="op" id="3064392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064396">return</span>&nbsp;<span class="ident" id="3064403">c</span>&nbsp;<span class="op" id="3064405">-</span>&nbsp;<span class="string" id="3064407">&#39;a&#39;</span>&nbsp;<span class="op" id="3064411">+</span>&nbsp;<span class="num" id="3064413">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064417">case</span>&nbsp;<span class="string" id="3064422">&#39;A&#39;</span>&nbsp;<span class="op" id="3064426">&lt;=</span>&nbsp;<span class="ident" id="3064429">c</span>&nbsp;<span class="op" id="3064431">&amp;&amp;</span>&nbsp;<span class="ident" id="3064434">c</span>&nbsp;<span class="op" id="3064436">&lt;=</span>&nbsp;<span class="string" id="3064439">&#39;F&#39;</span><span class="op" id="3064442">:</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064446">return</span>&nbsp;<span class="ident" id="3064453">c</span>&nbsp;<span class="op" id="3064455">-</span>&nbsp;<span class="string" id="3064457">&#39;A&#39;</span>&nbsp;<span class="op" id="3064461">+</span>&nbsp;<span class="num" id="3064463">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064470">return</span>&nbsp;<span class="num" id="3064477">0</span><br>
<span class="lineno"></span><span class="op" id="3064479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="3064482">type</span>&nbsp;<span class="ident" id="3064487">encoding</span>&nbsp;<span class="builtintype" id="3064496">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3064501">const</span>&nbsp;<span class="op" id="3064507">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064510">encodePath</span>&nbsp;<span class="ident" id="3064521">encoding</span>&nbsp;<span class="op" id="3064530">=</span>&nbsp;<span class="num" id="3064532">1</span>&nbsp;<span class="op" id="3064534">+</span>&nbsp;<span class="ident" id="3064536">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064542">encodeUserPassword</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064562">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064584">encodeFragment</span><br>
<span class="lineno"></span><span class="op" id="3064599">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3064602">type</span>&nbsp;<span class="ident" id="3064607">EscapeError</span>&nbsp;<span class="builtintype" id="3064619">string</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3064627">func</span>&nbsp;<span class="op" id="3064632">(</span><span class="ident" id="3064633">e</span>&nbsp;<span class="ident" id="3064635">EscapeError</span><span class="op" id="3064646">)</span>&nbsp;<span class="ident" id="3064648">Error</span><span class="op" id="3064653">(</span><span class="op" id="3064654">)</span>&nbsp;<span class="builtintype" id="3064656">string</span>&nbsp;<span class="op" id="3064663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064666">return</span>&nbsp;<span class="string" id="3064673">&#34;invalid&nbsp;URL&nbsp;escape&nbsp;&#34;</span>&nbsp;<span class="op" id="3064695">+</span>&nbsp;<span class="ident" id="3064697">strconv</span><span class="op" id="3064704">.</span><span class="ident" id="3064705">Quote</span><span class="op" id="3064710">(</span><span class="builtintype" id="3064711">string</span><span class="op" id="3064717">(</span><span class="ident" id="3064718">e</span><span class="op" id="3064719">)</span><span class="op" id="3064720">)</span><br>
<span class="lineno"></span><span class="op" id="3064722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3064725">//&nbsp;Return&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;character&nbsp;should&nbsp;be&nbsp;escaped&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3064790">//&nbsp;appearing&nbsp;in&nbsp;a&nbsp;URL&nbsp;string,&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3064843">func</span>&nbsp;<span class="ident" id="3064848">shouldEscape</span><span class="op" id="3064860">(</span><span class="ident" id="3064861">c</span>&nbsp;<span class="builtintype" id="3064863">byte</span><span class="op" id="3064867">,</span>&nbsp;<span class="ident" id="3064869">mode</span>&nbsp;<span class="ident" id="3064874">encoding</span><span class="op" id="3064882">)</span>&nbsp;<span class="builtintype" id="3064884">bool</span>&nbsp;<span class="op" id="3064889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3064892">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(alphanum)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064935">if</span>&nbsp;<span class="string" id="3064938">&#39;A&#39;</span>&nbsp;<span class="op" id="3064942">&lt;=</span>&nbsp;<span class="ident" id="3064945">c</span>&nbsp;<span class="op" id="3064947">&amp;&amp;</span>&nbsp;<span class="ident" id="3064950">c</span>&nbsp;<span class="op" id="3064952">&lt;=</span>&nbsp;<span class="string" id="3064955">&#39;Z&#39;</span>&nbsp;<span class="op" id="3064959">||</span>&nbsp;<span class="string" id="3064962">&#39;a&#39;</span>&nbsp;<span class="op" id="3064966">&lt;=</span>&nbsp;<span class="ident" id="3064969">c</span>&nbsp;<span class="op" id="3064971">&amp;&amp;</span>&nbsp;<span class="ident" id="3064974">c</span>&nbsp;<span class="op" id="3064976">&lt;=</span>&nbsp;<span class="string" id="3064979">&#39;z&#39;</span>&nbsp;<span class="op" id="3064983">||</span>&nbsp;<span class="string" id="3064986">&#39;0&#39;</span>&nbsp;<span class="op" id="3064990">&lt;=</span>&nbsp;<span class="ident" id="3064993">c</span>&nbsp;<span class="op" id="3064995">&amp;&amp;</span>&nbsp;<span class="ident" id="3064998">c</span>&nbsp;<span class="op" id="3065000">&lt;=</span>&nbsp;<span class="string" id="3065003">&#39;9&#39;</span>&nbsp;<span class="op" id="3065007">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065011">return</span>&nbsp;<span class="builtintype" id="3065018">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3065025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065029">switch</span>&nbsp;<span class="ident" id="3065036">c</span>&nbsp;<span class="op" id="3065038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065041">case</span>&nbsp;<span class="string" id="3065046">&#39;-&#39;</span><span class="op" id="3065049">,</span>&nbsp;<span class="string" id="3065051">&#39;_&#39;</span><span class="op" id="3065054">,</span>&nbsp;<span class="string" id="3065056">&#39;.&#39;</span><span class="op" id="3065059">,</span>&nbsp;<span class="string" id="3065061">&#39;~&#39;</span><span class="op" id="3065064">:</span>&nbsp;<span class="comment" id="3065066">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(mark)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065106">return</span>&nbsp;<span class="builtintype" id="3065113">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065121">case</span>&nbsp;<span class="string" id="3065126">&#39;$&#39;</span><span class="op" id="3065129">,</span>&nbsp;<span class="string" id="3065131">&#39;&amp;&#39;</span><span class="op" id="3065134">,</span>&nbsp;<span class="string" id="3065136">&#39;+&#39;</span><span class="op" id="3065139">,</span>&nbsp;<span class="string" id="3065141">&#39;,&#39;</span><span class="op" id="3065144">,</span>&nbsp;<span class="string" id="3065146">&#39;/&#39;</span><span class="op" id="3065149">,</span>&nbsp;<span class="string" id="3065151">&#39;:&#39;</span><span class="op" id="3065154">,</span>&nbsp;<span class="string" id="3065156">&#39;;&#39;</span><span class="op" id="3065159">,</span>&nbsp;<span class="string" id="3065161">&#39;=&#39;</span><span class="op" id="3065164">,</span>&nbsp;<span class="string" id="3065166">&#39;?&#39;</span><span class="op" id="3065169">,</span>&nbsp;<span class="string" id="3065171">&#39;@&#39;</span><span class="op" id="3065174">:</span>&nbsp;<span class="comment" id="3065176">//&nbsp;§2.2&nbsp;Reserved&nbsp;characters&nbsp;(reserved)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065218">//&nbsp;Different&nbsp;sections&nbsp;of&nbsp;the&nbsp;URL&nbsp;allow&nbsp;a&nbsp;few&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065268">//&nbsp;the&nbsp;reserved&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065318">switch</span>&nbsp;<span class="ident" id="3065325">mode</span>&nbsp;<span class="op" id="3065330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065334">case</span>&nbsp;<span class="ident" id="3065339">encodePath</span><span class="op" id="3065349">:</span>&nbsp;<span class="comment" id="3065351">//&nbsp;§3.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065363">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;:&nbsp;@&nbsp;&amp;&nbsp;=&nbsp;+&nbsp;$&nbsp;but&nbsp;saves&nbsp;/&nbsp;;&nbsp;,&nbsp;for&nbsp;assigning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065426">//&nbsp;meaning&nbsp;to&nbsp;individual&nbsp;path&nbsp;segments.&nbsp;This&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065482">//&nbsp;only&nbsp;manipulates&nbsp;the&nbsp;path&nbsp;as&nbsp;a&nbsp;whole,&nbsp;so&nbsp;we&nbsp;allow&nbsp;those</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065544">//&nbsp;last&nbsp;two&nbsp;as&nbsp;well.&nbsp;That&nbsp;leaves&nbsp;only&nbsp;?&nbsp;to&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065598">return</span>&nbsp;<span class="ident" id="3065605">c</span>&nbsp;<span class="op" id="3065607">==</span>&nbsp;<span class="string" id="3065610">&#39;?&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065617">case</span>&nbsp;<span class="ident" id="3065622">encodeUserPassword</span><span class="op" id="3065640">:</span>&nbsp;<span class="comment" id="3065642">//&nbsp;§3.2.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065656">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;&#39;;&#39;,&nbsp;&#39;:&#39;,&nbsp;&#39;&amp;&#39;,&nbsp;&#39;=&#39;,&nbsp;&#39;+&#39;,&nbsp;&#39;$&#39;,&nbsp;and&nbsp;&#39;,&#39;&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065718">//&nbsp;userinfo,&nbsp;so&nbsp;we&nbsp;must&nbsp;escape&nbsp;only&nbsp;&#39;@&#39;,&nbsp;&#39;/&#39;,&nbsp;and&nbsp;&#39;?&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065776">//&nbsp;The&nbsp;parsing&nbsp;of&nbsp;userinfo&nbsp;treats&nbsp;&#39;:&#39;&nbsp;as&nbsp;special&nbsp;so&nbsp;we&nbsp;must&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065846">//&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065862">return</span>&nbsp;<span class="ident" id="3065869">c</span>&nbsp;<span class="op" id="3065871">==</span>&nbsp;<span class="string" id="3065874">&#39;@&#39;</span>&nbsp;<span class="op" id="3065878">||</span>&nbsp;<span class="ident" id="3065881">c</span>&nbsp;<span class="op" id="3065883">==</span>&nbsp;<span class="string" id="3065886">&#39;/&#39;</span>&nbsp;<span class="op" id="3065890">||</span>&nbsp;<span class="ident" id="3065893">c</span>&nbsp;<span class="op" id="3065895">==</span>&nbsp;<span class="string" id="3065898">&#39;?&#39;</span>&nbsp;<span class="op" id="3065902">||</span>&nbsp;<span class="ident" id="3065905">c</span>&nbsp;<span class="op" id="3065907">==</span>&nbsp;<span class="string" id="3065910">&#39;:&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065917">case</span>&nbsp;<span class="ident" id="3065922">encodeQueryComponent</span><span class="op" id="3065942">:</span>&nbsp;<span class="comment" id="3065944">//&nbsp;§3.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065956">//&nbsp;The&nbsp;RFC&nbsp;reserves&nbsp;(so&nbsp;we&nbsp;must&nbsp;escape)&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066011">return</span>&nbsp;<span class="builtintype" id="3066018">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066026">case</span>&nbsp;<span class="ident" id="3066031">encodeFragment</span><span class="op" id="3066045">:</span>&nbsp;<span class="comment" id="3066047">//&nbsp;§4.1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3066059">//&nbsp;The&nbsp;RFC&nbsp;text&nbsp;is&nbsp;silent&nbsp;but&nbsp;the&nbsp;grammar&nbsp;allows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3066111">//&nbsp;everything,&nbsp;so&nbsp;escape&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066148">return</span>&nbsp;<span class="builtintype" id="3066155">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066166">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3066170">//&nbsp;Everything&nbsp;else&nbsp;must&nbsp;be&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066207">return</span>&nbsp;<span class="builtintype" id="3066214">true</span><br>
<span class="lineno"></span><span class="op" id="3066219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3066222">//&nbsp;QueryUnescape&nbsp;does&nbsp;the&nbsp;inverse&nbsp;transformation&nbsp;of&nbsp;QueryEscape,&nbsp;converting</span><br>
<span class="lineno"></span><span class="comment" id="3066298">//&nbsp;%AB&nbsp;into&nbsp;the&nbsp;byte&nbsp;0xAB&nbsp;and&nbsp;&#39;+&#39;&nbsp;into&nbsp;&#39;&nbsp;&#39;&nbsp;(space).&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3066373">//&nbsp;any&nbsp;%&nbsp;is&nbsp;not&nbsp;followed&nbsp;by&nbsp;two&nbsp;hexadecimal&nbsp;digits.</span><br>
<span class="lineno"></span><span class="keyword" id="3066425">func</span>&nbsp;<span class="ident" id="3066430">QueryUnescape</span><span class="op" id="3066443">(</span><span class="ident" id="3066444">s</span>&nbsp;<span class="builtintype" id="3066446">string</span><span class="op" id="3066452">)</span>&nbsp;<span class="op" id="3066454">(</span><span class="builtintype" id="3066455">string</span><span class="op" id="3066461">,</span>&nbsp;<span class="builtintype" id="3066463">error</span><span class="op" id="3066468">)</span>&nbsp;<span class="op" id="3066470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066473">return</span>&nbsp;<span class="ident" id="3066480">unescape</span><span class="op" id="3066488">(</span><span class="ident" id="3066489">s</span><span class="op" id="3066490">,</span>&nbsp;<span class="ident" id="3066492">encodeQueryComponent</span><span class="op" id="3066512">)</span><br>
<span class="lineno">115</span><span class="op" id="3066514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3066517">//&nbsp;unescape&nbsp;unescapes&nbsp;a&nbsp;string;&nbsp;the&nbsp;mode&nbsp;specifies</span><br>
<span class="lineno"></span><span class="comment" id="3066568">//&nbsp;which&nbsp;section&nbsp;of&nbsp;the&nbsp;URL&nbsp;string&nbsp;is&nbsp;being&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3066623">func</span>&nbsp;<span class="ident" id="3066628">unescape</span><span class="op" id="3066636">(</span><span class="ident" id="3066637">s</span>&nbsp;<span class="builtintype" id="3066639">string</span><span class="op" id="3066645">,</span>&nbsp;<span class="ident" id="3066647">mode</span>&nbsp;<span class="ident" id="3066652">encoding</span><span class="op" id="3066660">)</span>&nbsp;<span class="op" id="3066662">(</span><span class="builtintype" id="3066663">string</span><span class="op" id="3066669">,</span>&nbsp;<span class="builtintype" id="3066671">error</span><span class="op" id="3066676">)</span>&nbsp;<span class="op" id="3066678">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3066681">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066726">n</span>&nbsp;<span class="op" id="3066728">:=</span>&nbsp;<span class="num" id="3066731">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066734">hasPlus</span>&nbsp;<span class="op" id="3066742">:=</span>&nbsp;<span class="builtintype" id="3066745">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066752">for</span>&nbsp;<span class="ident" id="3066756">i</span>&nbsp;<span class="op" id="3066758">:=</span>&nbsp;<span class="num" id="3066761">0</span><span class="op" id="3066762">;</span>&nbsp;<span class="ident" id="3066764">i</span>&nbsp;<span class="op" id="3066766">&lt;</span>&nbsp;<span class="builtinfunc" id="3066768">len</span><span class="op" id="3066771">(</span><span class="ident" id="3066772">s</span><span class="op" id="3066773">)</span><span class="op" id="3066774">;</span>&nbsp;<span class="op" id="3066776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066780">switch</span>&nbsp;<span class="ident" id="3066787">s</span><span class="op" id="3066788">[</span><span class="ident" id="3066789">i</span><span class="op" id="3066790">]</span>&nbsp;<span class="op" id="3066792">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066796">case</span>&nbsp;<span class="string" id="3066801">&#39;%&#39;</span><span class="op" id="3066804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066809">n</span><span class="op" id="3066810">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066816">if</span>&nbsp;<span class="ident" id="3066819">i</span><span class="op" id="3066820">+</span><span class="num" id="3066821">2</span>&nbsp;<span class="op" id="3066823">&gt;=</span>&nbsp;<span class="builtinfunc" id="3066826">len</span><span class="op" id="3066829">(</span><span class="ident" id="3066830">s</span><span class="op" id="3066831">)</span>&nbsp;<span class="op" id="3066833">||</span>&nbsp;<span class="op" id="3066836">!</span><span class="ident" id="3066837">ishex</span><span class="op" id="3066842">(</span><span class="ident" id="3066843">s</span><span class="op" id="3066844">[</span><span class="ident" id="3066845">i</span><span class="op" id="3066846">+</span><span class="num" id="3066847">1</span><span class="op" id="3066848">]</span><span class="op" id="3066849">)</span>&nbsp;<span class="op" id="3066851">||</span>&nbsp;<span class="op" id="3066854">!</span><span class="ident" id="3066855">ishex</span><span class="op" id="3066860">(</span><span class="ident" id="3066861">s</span><span class="op" id="3066862">[</span><span class="ident" id="3066863">i</span><span class="op" id="3066864">+</span><span class="num" id="3066865">2</span><span class="op" id="3066866">]</span><span class="op" id="3066867">)</span>&nbsp;<span class="op" id="3066869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066875">s</span>&nbsp;<span class="op" id="3066877">=</span>&nbsp;<span class="ident" id="3066879">s</span><span class="op" id="3066880">[</span><span class="ident" id="3066881">i</span><span class="op" id="3066882">:</span><span class="op" id="3066883">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066889">if</span>&nbsp;<span class="builtinfunc" id="3066892">len</span><span class="op" id="3066895">(</span><span class="ident" id="3066896">s</span><span class="op" id="3066897">)</span>&nbsp;<span class="op" id="3066899">&gt;</span>&nbsp;<span class="num" id="3066901">3</span>&nbsp;<span class="op" id="3066903">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066910">s</span>&nbsp;<span class="op" id="3066912">=</span>&nbsp;<span class="ident" id="3066914">s</span><span class="op" id="3066915">[</span><span class="num" id="3066916">0</span><span class="op" id="3066917">:</span><span class="num" id="3066918">3</span><span class="op" id="3066919">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066931">return</span>&nbsp;<span class="string" id="3066938">&#34;&#34;</span><span class="op" id="3066940">,</span>&nbsp;<span class="ident" id="3066942">EscapeError</span><span class="op" id="3066953">(</span><span class="ident" id="3066954">s</span><span class="op" id="3066955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066965">i</span>&nbsp;<span class="op" id="3066967">+=</span>&nbsp;<span class="num" id="3066970">3</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066974">case</span>&nbsp;<span class="string" id="3066979">&#39;+&#39;</span><span class="op" id="3066982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066987">hasPlus</span>&nbsp;<span class="op" id="3066995">=</span>&nbsp;<span class="ident" id="3066997">mode</span>&nbsp;<span class="op" id="3067002">==</span>&nbsp;<span class="ident" id="3067005">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067029">i</span><span class="op" id="3067030">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067035">default</span><span class="op" id="3067042">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067047">i</span><span class="op" id="3067048">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067060">if</span>&nbsp;<span class="ident" id="3067063">n</span>&nbsp;<span class="op" id="3067065">==</span>&nbsp;<span class="num" id="3067068">0</span>&nbsp;<span class="op" id="3067070">&amp;&amp;</span>&nbsp;<span class="op" id="3067073">!</span><span class="ident" id="3067074">hasPlus</span>&nbsp;<span class="op" id="3067082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067086">return</span>&nbsp;<span class="ident" id="3067093">s</span><span class="op" id="3067094">,</span>&nbsp;<span class="ident" id="3067096">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067105">t</span>&nbsp;<span class="op" id="3067107">:=</span>&nbsp;<span class="builtinfunc" id="3067110">make</span><span class="op" id="3067114">(</span><span class="op" id="3067115">[</span><span class="op" id="3067116">]</span><span class="builtintype" id="3067117">byte</span><span class="op" id="3067121">,</span>&nbsp;<span class="builtinfunc" id="3067123">len</span><span class="op" id="3067126">(</span><span class="ident" id="3067127">s</span><span class="op" id="3067128">)</span><span class="op" id="3067129">-</span><span class="num" id="3067130">2</span><span class="op" id="3067131">*</span><span class="ident" id="3067132">n</span><span class="op" id="3067133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067136">j</span>&nbsp;<span class="op" id="3067138">:=</span>&nbsp;<span class="num" id="3067141">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067144">for</span>&nbsp;<span class="ident" id="3067148">i</span>&nbsp;<span class="op" id="3067150">:=</span>&nbsp;<span class="num" id="3067153">0</span><span class="op" id="3067154">;</span>&nbsp;<span class="ident" id="3067156">i</span>&nbsp;<span class="op" id="3067158">&lt;</span>&nbsp;<span class="builtinfunc" id="3067160">len</span><span class="op" id="3067163">(</span><span class="ident" id="3067164">s</span><span class="op" id="3067165">)</span><span class="op" id="3067166">;</span>&nbsp;<span class="op" id="3067168">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067172">switch</span>&nbsp;<span class="ident" id="3067179">s</span><span class="op" id="3067180">[</span><span class="ident" id="3067181">i</span><span class="op" id="3067182">]</span>&nbsp;<span class="op" id="3067184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067188">case</span>&nbsp;<span class="string" id="3067193">&#39;%&#39;</span><span class="op" id="3067196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067201">t</span><span class="op" id="3067202">[</span><span class="ident" id="3067203">j</span><span class="op" id="3067204">]</span>&nbsp;<span class="op" id="3067206">=</span>&nbsp;<span class="ident" id="3067208">unhex</span><span class="op" id="3067213">(</span><span class="ident" id="3067214">s</span><span class="op" id="3067215">[</span><span class="ident" id="3067216">i</span><span class="op" id="3067217">+</span><span class="num" id="3067218">1</span><span class="op" id="3067219">]</span><span class="op" id="3067220">)</span><span class="op" id="3067221">&lt;&lt;</span><span class="num" id="3067223">4</span>&nbsp;<span class="op" id="3067225">|</span>&nbsp;<span class="ident" id="3067227">unhex</span><span class="op" id="3067232">(</span><span class="ident" id="3067233">s</span><span class="op" id="3067234">[</span><span class="ident" id="3067235">i</span><span class="op" id="3067236">+</span><span class="num" id="3067237">2</span><span class="op" id="3067238">]</span><span class="op" id="3067239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067244">j</span><span class="op" id="3067245">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067251">i</span>&nbsp;<span class="op" id="3067253">+=</span>&nbsp;<span class="num" id="3067256">3</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067260">case</span>&nbsp;<span class="string" id="3067265">&#39;+&#39;</span><span class="op" id="3067268">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067273">if</span>&nbsp;<span class="ident" id="3067276">mode</span>&nbsp;<span class="op" id="3067281">==</span>&nbsp;<span class="ident" id="3067284">encodeQueryComponent</span>&nbsp;<span class="op" id="3067305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067311">t</span><span class="op" id="3067312">[</span><span class="ident" id="3067313">j</span><span class="op" id="3067314">]</span>&nbsp;<span class="op" id="3067316">=</span>&nbsp;<span class="string" id="3067318">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067325">}</span>&nbsp;<span class="keyword" id="3067327">else</span>&nbsp;<span class="op" id="3067332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067338">t</span><span class="op" id="3067339">[</span><span class="ident" id="3067340">j</span><span class="op" id="3067341">]</span>&nbsp;<span class="op" id="3067343">=</span>&nbsp;<span class="string" id="3067345">&#39;+&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067357">j</span><span class="op" id="3067358">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067364">i</span><span class="op" id="3067365">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067370">default</span><span class="op" id="3067377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067382">t</span><span class="op" id="3067383">[</span><span class="ident" id="3067384">j</span><span class="op" id="3067385">]</span>&nbsp;<span class="op" id="3067387">=</span>&nbsp;<span class="ident" id="3067389">s</span><span class="op" id="3067390">[</span><span class="ident" id="3067391">i</span><span class="op" id="3067392">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067397">j</span><span class="op" id="3067398">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067404">i</span><span class="op" id="3067405">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067416">return</span>&nbsp;<span class="builtintype" id="3067423">string</span><span class="op" id="3067429">(</span><span class="ident" id="3067430">t</span><span class="op" id="3067431">)</span><span class="op" id="3067432">,</span>&nbsp;<span class="ident" id="3067434">nil</span><br>
<span class="lineno">170</span><span class="op" id="3067438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3067441">//&nbsp;QueryEscape&nbsp;escapes&nbsp;the&nbsp;string&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;safely&nbsp;placed</span><br>
<span class="lineno"></span><span class="comment" id="3067502">//&nbsp;inside&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="3067525">func</span>&nbsp;<span class="ident" id="3067530">QueryEscape</span><span class="op" id="3067541">(</span><span class="ident" id="3067542">s</span>&nbsp;<span class="builtintype" id="3067544">string</span><span class="op" id="3067550">)</span>&nbsp;<span class="builtintype" id="3067552">string</span>&nbsp;<span class="op" id="3067559">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067562">return</span>&nbsp;<span class="ident" id="3067569">escape</span><span class="op" id="3067575">(</span><span class="ident" id="3067576">s</span><span class="op" id="3067577">,</span>&nbsp;<span class="ident" id="3067579">encodeQueryComponent</span><span class="op" id="3067599">)</span><br>
<span class="lineno"></span><span class="op" id="3067601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3067604">func</span>&nbsp;<span class="ident" id="3067609">escape</span><span class="op" id="3067615">(</span><span class="ident" id="3067616">s</span>&nbsp;<span class="builtintype" id="3067618">string</span><span class="op" id="3067624">,</span>&nbsp;<span class="ident" id="3067626">mode</span>&nbsp;<span class="ident" id="3067631">encoding</span><span class="op" id="3067639">)</span>&nbsp;<span class="builtintype" id="3067641">string</span>&nbsp;<span class="op" id="3067648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067651">spaceCount</span><span class="op" id="3067661">,</span>&nbsp;<span class="ident" id="3067663">hexCount</span>&nbsp;<span class="op" id="3067672">:=</span>&nbsp;<span class="num" id="3067675">0</span><span class="op" id="3067676">,</span>&nbsp;<span class="num" id="3067678">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067681">for</span>&nbsp;<span class="ident" id="3067685">i</span>&nbsp;<span class="op" id="3067687">:=</span>&nbsp;<span class="num" id="3067690">0</span><span class="op" id="3067691">;</span>&nbsp;<span class="ident" id="3067693">i</span>&nbsp;<span class="op" id="3067695">&lt;</span>&nbsp;<span class="builtinfunc" id="3067697">len</span><span class="op" id="3067700">(</span><span class="ident" id="3067701">s</span><span class="op" id="3067702">)</span><span class="op" id="3067703">;</span>&nbsp;<span class="ident" id="3067705">i</span><span class="op" id="3067706">++</span>&nbsp;<span class="op" id="3067709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067713">c</span>&nbsp;<span class="op" id="3067715">:=</span>&nbsp;<span class="ident" id="3067718">s</span><span class="op" id="3067719">[</span><span class="ident" id="3067720">i</span><span class="op" id="3067721">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067725">if</span>&nbsp;<span class="ident" id="3067728">shouldEscape</span><span class="op" id="3067740">(</span><span class="ident" id="3067741">c</span><span class="op" id="3067742">,</span>&nbsp;<span class="ident" id="3067744">mode</span><span class="op" id="3067748">)</span>&nbsp;<span class="op" id="3067750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067755">if</span>&nbsp;<span class="ident" id="3067758">c</span>&nbsp;<span class="op" id="3067760">==</span>&nbsp;<span class="string" id="3067763">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3067767">&amp;&amp;</span>&nbsp;<span class="ident" id="3067770">mode</span>&nbsp;<span class="op" id="3067775">==</span>&nbsp;<span class="ident" id="3067778">encodeQueryComponent</span>&nbsp;<span class="op" id="3067799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067805">spaceCount</span><span class="op" id="3067815">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067821">}</span>&nbsp;<span class="keyword" id="3067823">else</span>&nbsp;<span class="op" id="3067828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067834">hexCount</span><span class="op" id="3067842">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067855">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067859">if</span>&nbsp;<span class="ident" id="3067862">spaceCount</span>&nbsp;<span class="op" id="3067873">==</span>&nbsp;<span class="num" id="3067876">0</span>&nbsp;<span class="op" id="3067878">&amp;&amp;</span>&nbsp;<span class="ident" id="3067881">hexCount</span>&nbsp;<span class="op" id="3067890">==</span>&nbsp;<span class="num" id="3067893">0</span>&nbsp;<span class="op" id="3067895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067899">return</span>&nbsp;<span class="ident" id="3067906">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067913">t</span>&nbsp;<span class="op" id="3067915">:=</span>&nbsp;<span class="builtinfunc" id="3067918">make</span><span class="op" id="3067922">(</span><span class="op" id="3067923">[</span><span class="op" id="3067924">]</span><span class="builtintype" id="3067925">byte</span><span class="op" id="3067929">,</span>&nbsp;<span class="builtinfunc" id="3067931">len</span><span class="op" id="3067934">(</span><span class="ident" id="3067935">s</span><span class="op" id="3067936">)</span><span class="op" id="3067937">+</span><span class="num" id="3067938">2</span><span class="op" id="3067939">*</span><span class="ident" id="3067940">hexCount</span><span class="op" id="3067948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067951">j</span>&nbsp;<span class="op" id="3067953">:=</span>&nbsp;<span class="num" id="3067956">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067959">for</span>&nbsp;<span class="ident" id="3067963">i</span>&nbsp;<span class="op" id="3067965">:=</span>&nbsp;<span class="num" id="3067968">0</span><span class="op" id="3067969">;</span>&nbsp;<span class="ident" id="3067971">i</span>&nbsp;<span class="op" id="3067973">&lt;</span>&nbsp;<span class="builtinfunc" id="3067975">len</span><span class="op" id="3067978">(</span><span class="ident" id="3067979">s</span><span class="op" id="3067980">)</span><span class="op" id="3067981">;</span>&nbsp;<span class="ident" id="3067983">i</span><span class="op" id="3067984">++</span>&nbsp;<span class="op" id="3067987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067991">switch</span>&nbsp;<span class="ident" id="3067998">c</span>&nbsp;<span class="op" id="3068000">:=</span>&nbsp;<span class="ident" id="3068003">s</span><span class="op" id="3068004">[</span><span class="ident" id="3068005">i</span><span class="op" id="3068006">]</span><span class="op" id="3068007">;</span>&nbsp;<span class="op" id="3068009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068013">case</span>&nbsp;<span class="ident" id="3068018">c</span>&nbsp;<span class="op" id="3068020">==</span>&nbsp;<span class="string" id="3068023">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3068027">&amp;&amp;</span>&nbsp;<span class="ident" id="3068030">mode</span>&nbsp;<span class="op" id="3068035">==</span>&nbsp;<span class="ident" id="3068038">encodeQueryComponent</span><span class="op" id="3068058">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068063">t</span><span class="op" id="3068064">[</span><span class="ident" id="3068065">j</span><span class="op" id="3068066">]</span>&nbsp;<span class="op" id="3068068">=</span>&nbsp;<span class="string" id="3068070">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068077">j</span><span class="op" id="3068078">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068083">case</span>&nbsp;<span class="ident" id="3068088">shouldEscape</span><span class="op" id="3068100">(</span><span class="ident" id="3068101">c</span><span class="op" id="3068102">,</span>&nbsp;<span class="ident" id="3068104">mode</span><span class="op" id="3068108">)</span><span class="op" id="3068109">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068114">t</span><span class="op" id="3068115">[</span><span class="ident" id="3068116">j</span><span class="op" id="3068117">]</span>&nbsp;<span class="op" id="3068119">=</span>&nbsp;<span class="string" id="3068121">&#39;%&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068128">t</span><span class="op" id="3068129">[</span><span class="ident" id="3068130">j</span><span class="op" id="3068131">+</span><span class="num" id="3068132">1</span><span class="op" id="3068133">]</span>&nbsp;<span class="op" id="3068135">=</span>&nbsp;<span class="string" id="3068137">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3068155">[</span><span class="ident" id="3068156">c</span><span class="op" id="3068157">&gt;&gt;</span><span class="num" id="3068159">4</span><span class="op" id="3068160">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068165">t</span><span class="op" id="3068166">[</span><span class="ident" id="3068167">j</span><span class="op" id="3068168">+</span><span class="num" id="3068169">2</span><span class="op" id="3068170">]</span>&nbsp;<span class="op" id="3068172">=</span>&nbsp;<span class="string" id="3068174">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3068192">[</span><span class="ident" id="3068193">c</span><span class="op" id="3068194">&amp;</span><span class="num" id="3068195">15</span><span class="op" id="3068197">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068202">j</span>&nbsp;<span class="op" id="3068204">+=</span>&nbsp;<span class="num" id="3068207">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068211">default</span><span class="op" id="3068218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068223">t</span><span class="op" id="3068224">[</span><span class="ident" id="3068225">j</span><span class="op" id="3068226">]</span>&nbsp;<span class="op" id="3068228">=</span>&nbsp;<span class="ident" id="3068230">s</span><span class="op" id="3068231">[</span><span class="ident" id="3068232">i</span><span class="op" id="3068233">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068238">j</span><span class="op" id="3068239">++</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3068244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3068247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068250">return</span>&nbsp;<span class="builtintype" id="3068257">string</span><span class="op" id="3068263">(</span><span class="ident" id="3068264">t</span><span class="op" id="3068265">)</span><br>
<span class="lineno"></span><span class="op" id="3068267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3068270">//&nbsp;A&nbsp;URL&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;URL&nbsp;(technically,&nbsp;a&nbsp;URI&nbsp;reference).</span><br>
<span class="lineno"></span><span class="comment" id="3068335">//&nbsp;The&nbsp;general&nbsp;form&nbsp;represented&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3068371">//</span><br>
<span class="lineno"></span><span class="comment" id="3068374">//&nbsp;&nbsp;&nbsp;&nbspscheme://[userinfo@]host/path[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3068426">//</span><br>
<span class="lineno">220</span><span class="comment" id="3068429">//&nbsp;URLs&nbsp;that&nbsp;do&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;slash&nbsp;after&nbsp;the&nbsp;scheme&nbsp;are&nbsp;interpreted&nbsp;as:</span><br>
<span class="lineno"></span><span class="comment" id="3068505">//</span><br>
<span class="lineno"></span><span class="comment" id="3068508">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3068544">//</span><br>
<span class="lineno"></span><span class="comment" id="3068547">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;Path&nbsp;field&nbsp;is&nbsp;stored&nbsp;in&nbsp;decoded&nbsp;form:&nbsp;/%47%6f%2f&nbsp;becomes&nbsp;/Go/.</span><br>
<span class="lineno">225</span><span class="comment" id="3068627">//&nbsp;A&nbsp;consequence&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;which&nbsp;slashes&nbsp;in&nbsp;the&nbsp;Path&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="3068708">//&nbsp;slashes&nbsp;in&nbsp;the&nbsp;raw&nbsp;URL&nbsp;and&nbsp;which&nbsp;were&nbsp;%2f.&nbsp;This&nbsp;distinction&nbsp;is&nbsp;rarely&nbsp;important,</span><br>
<span class="lineno"></span><span class="comment" id="3068792">//&nbsp;but&nbsp;when&nbsp;it&nbsp;is&nbsp;a&nbsp;client&nbsp;must&nbsp;use&nbsp;other&nbsp;routines&nbsp;to&nbsp;parse&nbsp;the&nbsp;raw&nbsp;URL&nbsp;or&nbsp;construct</span><br>
<span class="lineno"></span><span class="comment" id="3068877">//&nbsp;the&nbsp;parsed&nbsp;URL.&nbsp;For&nbsp;example,&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;consult&nbsp;req.RequestURI,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3068956">//&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;can&nbsp;use&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Opaque:&nbsp;&#34;//example.com/Go%2f&#34;}</span><br>
<span class="lineno">230</span><span class="comment" id="3069038">//&nbsp;instead&nbsp;of&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Path:&nbsp;&#34;/Go/&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="3069092">type</span>&nbsp;<span class="ident" id="3069097">URL</span>&nbsp;<span class="keyword" id="3069101">struct</span>&nbsp;<span class="op" id="3069108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069111">Scheme</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3069120">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069128">Opaque</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3069137">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069147">//&nbsp;encoded&nbsp;opaque&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069171">User</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3069180">*</span><span class="ident" id="3069181">Userinfo</span>&nbsp;<span class="comment" id="3069190">//&nbsp;username&nbsp;and&nbsp;password&nbsp;information</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069228">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3069237">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069247">//&nbsp;host&nbsp;or&nbsp;host:port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069269">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3069278">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069286">RawQuery</span>&nbsp;<span class="builtintype" id="3069295">string</span>&nbsp;<span class="comment" id="3069302">//&nbsp;encoded&nbsp;query&nbsp;values,&nbsp;without&nbsp;&#39;?&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069340">Fragment</span>&nbsp;<span class="builtintype" id="3069349">string</span>&nbsp;<span class="comment" id="3069356">//&nbsp;fragment&nbsp;for&nbsp;references,&nbsp;without&nbsp;&#39;#&#39;</span><br>
<span class="lineno"></span><span class="op" id="3069396">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3069399">//&nbsp;User&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3069459">//&nbsp;and&nbsp;no&nbsp;password&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3069483">func</span>&nbsp;<span class="ident" id="3069488">User</span><span class="op" id="3069492">(</span><span class="ident" id="3069493">username</span>&nbsp;<span class="builtintype" id="3069502">string</span><span class="op" id="3069508">)</span>&nbsp;<span class="op" id="3069510">*</span><span class="ident" id="3069511">Userinfo</span>&nbsp;<span class="op" id="3069520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069523">return</span>&nbsp;<span class="op" id="3069530">&amp;</span><span class="ident" id="3069531">Userinfo</span><span class="op" id="3069539">{</span><span class="ident" id="3069540">username</span><span class="op" id="3069548">,</span>&nbsp;<span class="string" id="3069550">&#34;&#34;</span><span class="op" id="3069552">,</span>&nbsp;<span class="builtintype" id="3069554">false</span><span class="op" id="3069559">}</span><br>
<span class="lineno">245</span><span class="op" id="3069561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3069564">//&nbsp;UserPassword&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3069632">//&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3069649">//&nbsp;This&nbsp;functionality&nbsp;should&nbsp;only&nbsp;be&nbsp;used&nbsp;with&nbsp;legacy&nbsp;web&nbsp;sites.</span><br>
<span class="lineno">250</span><span class="comment" id="3069714">//&nbsp;RFC&nbsp;2396&nbsp;warns&nbsp;that&nbsp;interpreting&nbsp;Userinfo&nbsp;this&nbsp;way</span><br>
<span class="lineno"></span><span class="comment" id="3069768">//&nbsp;``is&nbsp;NOT&nbsp;RECOMMENDED,&nbsp;because&nbsp;the&nbsp;passing&nbsp;of&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="3069831">//&nbsp;information&nbsp;in&nbsp;clear&nbsp;text&nbsp;(such&nbsp;as&nbsp;URI)&nbsp;has&nbsp;proven&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3069893">//&nbsp;security&nbsp;risk&nbsp;in&nbsp;almost&nbsp;every&nbsp;case&nbsp;where&nbsp;it&nbsp;has&nbsp;been&nbsp;used.&#39;&#39;</span><br>
<span class="lineno"></span><span class="keyword" id="3069957">func</span>&nbsp;<span class="ident" id="3069962">UserPassword</span><span class="op" id="3069974">(</span><span class="ident" id="3069975">username</span><span class="op" id="3069983">,</span>&nbsp;<span class="ident" id="3069985">password</span>&nbsp;<span class="builtintype" id="3069994">string</span><span class="op" id="3070000">)</span>&nbsp;<span class="op" id="3070002">*</span><span class="ident" id="3070003">Userinfo</span>&nbsp;<span class="op" id="3070012">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070015">return</span>&nbsp;<span class="op" id="3070022">&amp;</span><span class="ident" id="3070023">Userinfo</span><span class="op" id="3070031">{</span><span class="ident" id="3070032">username</span><span class="op" id="3070040">,</span>&nbsp;<span class="ident" id="3070042">password</span><span class="op" id="3070050">,</span>&nbsp;<span class="builtintype" id="3070052">true</span><span class="op" id="3070056">}</span><br>
<span class="lineno"></span><span class="op" id="3070058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3070061">//&nbsp;The&nbsp;Userinfo&nbsp;type&nbsp;is&nbsp;an&nbsp;immutable&nbsp;encapsulation&nbsp;of&nbsp;username&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3070128">//&nbsp;password&nbsp;details&nbsp;for&nbsp;a&nbsp;URL.&nbsp;An&nbsp;existing&nbsp;Userinfo&nbsp;value&nbsp;is&nbsp;guaranteed</span><br>
<span class="lineno">260</span><span class="comment" id="3070200">//&nbsp;to&nbsp;have&nbsp;a&nbsp;username&nbsp;set&nbsp;(potentially&nbsp;empty,&nbsp;as&nbsp;allowed&nbsp;by&nbsp;RFC&nbsp;2396),</span><br>
<span class="lineno"></span><span class="comment" id="3070271">//&nbsp;and&nbsp;optionally&nbsp;a&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3070301">type</span>&nbsp;<span class="ident" id="3070306">Userinfo</span>&nbsp;<span class="keyword" id="3070315">struct</span>&nbsp;<span class="op" id="3070322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070325">username</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3070337">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070345">password</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3070357">string</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070365">passwordSet</span>&nbsp;<span class="builtintype" id="3070377">bool</span><br>
<span class="lineno"></span><span class="op" id="3070382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3070385">//&nbsp;Username&nbsp;returns&nbsp;the&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="3070419">func</span>&nbsp;<span class="op" id="3070424">(</span><span class="ident" id="3070425">u</span>&nbsp;<span class="op" id="3070427">*</span><span class="ident" id="3070428">Userinfo</span><span class="op" id="3070436">)</span>&nbsp;<span class="ident" id="3070438">Username</span><span class="op" id="3070446">(</span><span class="op" id="3070447">)</span>&nbsp;<span class="builtintype" id="3070449">string</span>&nbsp;<span class="op" id="3070456">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070459">return</span>&nbsp;<span class="ident" id="3070466">u</span><span class="op" id="3070467">.</span><span class="ident" id="3070468">username</span><br>
<span class="lineno"></span><span class="op" id="3070477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3070480">//&nbsp;Password&nbsp;returns&nbsp;the&nbsp;password&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;set,&nbsp;and&nbsp;whether&nbsp;it&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3070555">func</span>&nbsp;<span class="op" id="3070560">(</span><span class="ident" id="3070561">u</span>&nbsp;<span class="op" id="3070563">*</span><span class="ident" id="3070564">Userinfo</span><span class="op" id="3070572">)</span>&nbsp;<span class="ident" id="3070574">Password</span><span class="op" id="3070582">(</span><span class="op" id="3070583">)</span>&nbsp;<span class="op" id="3070585">(</span><span class="builtintype" id="3070586">string</span><span class="op" id="3070592">,</span>&nbsp;<span class="builtintype" id="3070594">bool</span><span class="op" id="3070598">)</span>&nbsp;<span class="op" id="3070600">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070603">if</span>&nbsp;<span class="ident" id="3070606">u</span><span class="op" id="3070607">.</span><span class="ident" id="3070608">passwordSet</span>&nbsp;<span class="op" id="3070620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070624">return</span>&nbsp;<span class="ident" id="3070631">u</span><span class="op" id="3070632">.</span><span class="ident" id="3070633">password</span><span class="op" id="3070641">,</span>&nbsp;<span class="builtintype" id="3070643">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3070649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070652">return</span>&nbsp;<span class="string" id="3070659">&#34;&#34;</span><span class="op" id="3070661">,</span>&nbsp;<span class="builtintype" id="3070663">false</span><br>
<span class="lineno"></span><span class="op" id="3070669">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3070672">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;userinfo&nbsp;information&nbsp;in&nbsp;the&nbsp;standard&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3070744">//&nbsp;of&nbsp;&#34;username[:password]&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3070773">func</span>&nbsp;<span class="op" id="3070778">(</span><span class="ident" id="3070779">u</span>&nbsp;<span class="op" id="3070781">*</span><span class="ident" id="3070782">Userinfo</span><span class="op" id="3070790">)</span>&nbsp;<span class="ident" id="3070792">String</span><span class="op" id="3070798">(</span><span class="op" id="3070799">)</span>&nbsp;<span class="builtintype" id="3070801">string</span>&nbsp;<span class="op" id="3070808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070811">s</span>&nbsp;<span class="op" id="3070813">:=</span>&nbsp;<span class="ident" id="3070816">escape</span><span class="op" id="3070822">(</span><span class="ident" id="3070823">u</span><span class="op" id="3070824">.</span><span class="ident" id="3070825">username</span><span class="op" id="3070833">,</span>&nbsp;<span class="ident" id="3070835">encodeUserPassword</span><span class="op" id="3070853">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070856">if</span>&nbsp;<span class="ident" id="3070859">u</span><span class="op" id="3070860">.</span><span class="ident" id="3070861">passwordSet</span>&nbsp;<span class="op" id="3070873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070877">s</span>&nbsp;<span class="op" id="3070879">+=</span>&nbsp;<span class="string" id="3070882">&#34;:&#34;</span>&nbsp;<span class="op" id="3070886">+</span>&nbsp;<span class="ident" id="3070888">escape</span><span class="op" id="3070894">(</span><span class="ident" id="3070895">u</span><span class="op" id="3070896">.</span><span class="ident" id="3070897">password</span><span class="op" id="3070905">,</span>&nbsp;<span class="ident" id="3070907">encodeUserPassword</span><span class="op" id="3070925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3070928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070931">return</span>&nbsp;<span class="ident" id="3070938">s</span><br>
<span class="lineno"></span><span class="op" id="3070940">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="3070943">//&nbsp;Maybe&nbsp;rawurl&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;scheme:path.</span><br>
<span class="lineno"></span><span class="comment" id="3070987">//&nbsp;(Scheme&nbsp;must&nbsp;be&nbsp;[a-zA-Z][a-zA-Z0-9+-.]*)</span><br>
<span class="lineno"></span><span class="comment" id="3071031">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;scheme,&nbsp;path;&nbsp;else&nbsp;return&nbsp;&#34;&#34;,&nbsp;rawurl.</span><br>
<span class="lineno"></span><span class="keyword" id="3071086">func</span>&nbsp;<span class="ident" id="3071091">getscheme</span><span class="op" id="3071100">(</span><span class="ident" id="3071101">rawurl</span>&nbsp;<span class="builtintype" id="3071108">string</span><span class="op" id="3071114">)</span>&nbsp;<span class="op" id="3071116">(</span><span class="ident" id="3071117">scheme</span><span class="op" id="3071123">,</span>&nbsp;<span class="ident" id="3071125">path</span>&nbsp;<span class="builtintype" id="3071130">string</span><span class="op" id="3071136">,</span>&nbsp;<span class="ident" id="3071138">err</span>&nbsp;<span class="builtintype" id="3071142">error</span><span class="op" id="3071147">)</span>&nbsp;<span class="op" id="3071149">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071152">for</span>&nbsp;<span class="ident" id="3071156">i</span>&nbsp;<span class="op" id="3071158">:=</span>&nbsp;<span class="num" id="3071161">0</span><span class="op" id="3071162">;</span>&nbsp;<span class="ident" id="3071164">i</span>&nbsp;<span class="op" id="3071166">&lt;</span>&nbsp;<span class="builtinfunc" id="3071168">len</span><span class="op" id="3071171">(</span><span class="ident" id="3071172">rawurl</span><span class="op" id="3071178">)</span><span class="op" id="3071179">;</span>&nbsp;<span class="ident" id="3071181">i</span><span class="op" id="3071182">++</span>&nbsp;<span class="op" id="3071185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071189">c</span>&nbsp;<span class="op" id="3071191">:=</span>&nbsp;<span class="ident" id="3071194">rawurl</span><span class="op" id="3071200">[</span><span class="ident" id="3071201">i</span><span class="op" id="3071202">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071206">switch</span>&nbsp;<span class="op" id="3071213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071217">case</span>&nbsp;<span class="string" id="3071222">&#39;a&#39;</span>&nbsp;<span class="op" id="3071226">&lt;=</span>&nbsp;<span class="ident" id="3071229">c</span>&nbsp;<span class="op" id="3071231">&amp;&amp;</span>&nbsp;<span class="ident" id="3071234">c</span>&nbsp;<span class="op" id="3071236">&lt;=</span>&nbsp;<span class="string" id="3071239">&#39;z&#39;</span>&nbsp;<span class="op" id="3071243">||</span>&nbsp;<span class="string" id="3071246">&#39;A&#39;</span>&nbsp;<span class="op" id="3071250">&lt;=</span>&nbsp;<span class="ident" id="3071253">c</span>&nbsp;<span class="op" id="3071255">&amp;&amp;</span>&nbsp;<span class="ident" id="3071258">c</span>&nbsp;<span class="op" id="3071260">&lt;=</span>&nbsp;<span class="string" id="3071263">&#39;Z&#39;</span><span class="op" id="3071266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3071270">//&nbsp;do&nbsp;nothing</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071286">case</span>&nbsp;<span class="string" id="3071291">&#39;0&#39;</span>&nbsp;<span class="op" id="3071295">&lt;=</span>&nbsp;<span class="ident" id="3071298">c</span>&nbsp;<span class="op" id="3071300">&amp;&amp;</span>&nbsp;<span class="ident" id="3071303">c</span>&nbsp;<span class="op" id="3071305">&lt;=</span>&nbsp;<span class="string" id="3071308">&#39;9&#39;</span>&nbsp;<span class="op" id="3071312">||</span>&nbsp;<span class="ident" id="3071315">c</span>&nbsp;<span class="op" id="3071317">==</span>&nbsp;<span class="string" id="3071320">&#39;+&#39;</span>&nbsp;<span class="op" id="3071324">||</span>&nbsp;<span class="ident" id="3071327">c</span>&nbsp;<span class="op" id="3071329">==</span>&nbsp;<span class="string" id="3071332">&#39;-&#39;</span>&nbsp;<span class="op" id="3071336">||</span>&nbsp;<span class="ident" id="3071339">c</span>&nbsp;<span class="op" id="3071341">==</span>&nbsp;<span class="string" id="3071344">&#39;.&#39;</span><span class="op" id="3071347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071352">if</span>&nbsp;<span class="ident" id="3071355">i</span>&nbsp;<span class="op" id="3071357">==</span>&nbsp;<span class="num" id="3071360">0</span>&nbsp;<span class="op" id="3071362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071368">return</span>&nbsp;<span class="string" id="3071375">&#34;&#34;</span><span class="op" id="3071377">,</span>&nbsp;<span class="ident" id="3071379">rawurl</span><span class="op" id="3071385">,</span>&nbsp;<span class="ident" id="3071387">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071398">case</span>&nbsp;<span class="ident" id="3071403">c</span>&nbsp;<span class="op" id="3071405">==</span>&nbsp;<span class="string" id="3071408">&#39;:&#39;</span><span class="op" id="3071411">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071416">if</span>&nbsp;<span class="ident" id="3071419">i</span>&nbsp;<span class="op" id="3071421">==</span>&nbsp;<span class="num" id="3071424">0</span>&nbsp;<span class="op" id="3071426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071432">return</span>&nbsp;<span class="string" id="3071439">&#34;&#34;</span><span class="op" id="3071441">,</span>&nbsp;<span class="string" id="3071443">&#34;&#34;</span><span class="op" id="3071445">,</span>&nbsp;<span class="ident" id="3071447">errors</span><span class="op" id="3071453">.</span><span class="ident" id="3071454">New</span><span class="op" id="3071457">(</span><span class="string" id="3071458">&#34;missing&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="3071483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071493">return</span>&nbsp;<span class="ident" id="3071500">rawurl</span><span class="op" id="3071506">[</span><span class="num" id="3071507">0</span><span class="op" id="3071508">:</span><span class="ident" id="3071509">i</span><span class="op" id="3071510">]</span><span class="op" id="3071511">,</span>&nbsp;<span class="ident" id="3071513">rawurl</span><span class="op" id="3071519">[</span><span class="ident" id="3071520">i</span><span class="op" id="3071521">+</span><span class="num" id="3071522">1</span><span class="op" id="3071523">:</span><span class="op" id="3071524">]</span><span class="op" id="3071525">,</span>&nbsp;<span class="ident" id="3071527">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071533">default</span><span class="op" id="3071540">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3071545">//&nbsp;we&nbsp;have&nbsp;encountered&nbsp;an&nbsp;invalid&nbsp;character,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3071593">//&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;valid&nbsp;scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071627">return</span>&nbsp;<span class="string" id="3071634">&#34;&#34;</span><span class="op" id="3071636">,</span>&nbsp;<span class="ident" id="3071638">rawurl</span><span class="op" id="3071644">,</span>&nbsp;<span class="ident" id="3071646">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071655">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071658">return</span>&nbsp;<span class="string" id="3071665">&#34;&#34;</span><span class="op" id="3071667">,</span>&nbsp;<span class="ident" id="3071669">rawurl</span><span class="op" id="3071675">,</span>&nbsp;<span class="ident" id="3071677">nil</span><br>
<span class="lineno"></span><span class="op" id="3071681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3071684">//&nbsp;Maybe&nbsp;s&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;t&nbsp;c&nbsp;u.</span><br>
<span class="lineno"></span><span class="comment" id="3071717">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;t,&nbsp;c&nbsp;u&nbsp;(or&nbsp;t,&nbsp;u&nbsp;if&nbsp;cutc&nbsp;==&nbsp;true).</span><br>
<span class="lineno">320</span><span class="comment" id="3071768">//&nbsp;If&nbsp;not,&nbsp;return&nbsp;s,&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3071793">func</span>&nbsp;<span class="ident" id="3071798">split</span><span class="op" id="3071803">(</span><span class="ident" id="3071804">s</span>&nbsp;<span class="builtintype" id="3071806">string</span><span class="op" id="3071812">,</span>&nbsp;<span class="ident" id="3071814">c</span>&nbsp;<span class="builtintype" id="3071816">string</span><span class="op" id="3071822">,</span>&nbsp;<span class="ident" id="3071824">cutc</span>&nbsp;<span class="builtintype" id="3071829">bool</span><span class="op" id="3071833">)</span>&nbsp;<span class="op" id="3071835">(</span><span class="builtintype" id="3071836">string</span><span class="op" id="3071842">,</span>&nbsp;<span class="builtintype" id="3071844">string</span><span class="op" id="3071850">)</span>&nbsp;<span class="op" id="3071852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071855">i</span>&nbsp;<span class="op" id="3071857">:=</span>&nbsp;<span class="ident" id="3071860">strings</span><span class="op" id="3071867">.</span><span class="ident" id="3071868">Index</span><span class="op" id="3071873">(</span><span class="ident" id="3071874">s</span><span class="op" id="3071875">,</span>&nbsp;<span class="ident" id="3071877">c</span><span class="op" id="3071878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071881">if</span>&nbsp;<span class="ident" id="3071884">i</span>&nbsp;<span class="op" id="3071886">&lt;</span>&nbsp;<span class="num" id="3071888">0</span>&nbsp;<span class="op" id="3071890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071894">return</span>&nbsp;<span class="ident" id="3071901">s</span><span class="op" id="3071902">,</span>&nbsp;<span class="string" id="3071904">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071911">if</span>&nbsp;<span class="ident" id="3071914">cutc</span>&nbsp;<span class="op" id="3071919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071923">return</span>&nbsp;<span class="ident" id="3071930">s</span><span class="op" id="3071931">[</span><span class="num" id="3071932">0</span><span class="op" id="3071933">:</span><span class="ident" id="3071934">i</span><span class="op" id="3071935">]</span><span class="op" id="3071936">,</span>&nbsp;<span class="ident" id="3071938">s</span><span class="op" id="3071939">[</span><span class="ident" id="3071940">i</span><span class="op" id="3071941">+</span><span class="builtinfunc" id="3071942">len</span><span class="op" id="3071945">(</span><span class="ident" id="3071946">c</span><span class="op" id="3071947">)</span><span class="op" id="3071948">:</span><span class="op" id="3071949">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071955">return</span>&nbsp;<span class="ident" id="3071962">s</span><span class="op" id="3071963">[</span><span class="num" id="3071964">0</span><span class="op" id="3071965">:</span><span class="ident" id="3071966">i</span><span class="op" id="3071967">]</span><span class="op" id="3071968">,</span>&nbsp;<span class="ident" id="3071970">s</span><span class="op" id="3071971">[</span><span class="ident" id="3071972">i</span><span class="op" id="3071973">:</span><span class="op" id="3071974">]</span><br>
<span class="lineno">330</span><span class="op" id="3071976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3071979">//&nbsp;Parse&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3072024">//&nbsp;The&nbsp;rawurl&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3072067">func</span>&nbsp;<span class="ident" id="3072072">Parse</span><span class="op" id="3072077">(</span><span class="ident" id="3072078">rawurl</span>&nbsp;<span class="builtintype" id="3072085">string</span><span class="op" id="3072091">)</span>&nbsp;<span class="op" id="3072093">(</span><span class="ident" id="3072094">url</span>&nbsp;<span class="op" id="3072098">*</span><span class="ident" id="3072099">URL</span><span class="op" id="3072102">,</span>&nbsp;<span class="ident" id="3072104">err</span>&nbsp;<span class="builtintype" id="3072108">error</span><span class="op" id="3072113">)</span>&nbsp;<span class="op" id="3072115">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3072118">//&nbsp;Cut&nbsp;off&nbsp;#frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3072136">u</span><span class="op" id="3072137">,</span>&nbsp;<span class="ident" id="3072139">frag</span>&nbsp;<span class="op" id="3072144">:=</span>&nbsp;<span class="ident" id="3072147">split</span><span class="op" id="3072152">(</span><span class="ident" id="3072153">rawurl</span><span class="op" id="3072159">,</span>&nbsp;<span class="string" id="3072161">&#34;#&#34;</span><span class="op" id="3072164">,</span>&nbsp;<span class="builtintype" id="3072166">true</span><span class="op" id="3072170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072173">if</span>&nbsp;<span class="ident" id="3072176">url</span><span class="op" id="3072179">,</span>&nbsp;<span class="ident" id="3072181">err</span>&nbsp;<span class="op" id="3072185">=</span>&nbsp;<span class="ident" id="3072187">parse</span><span class="op" id="3072192">(</span><span class="ident" id="3072193">u</span><span class="op" id="3072194">,</span>&nbsp;<span class="builtintype" id="3072196">false</span><span class="op" id="3072201">)</span><span class="op" id="3072202">;</span>&nbsp;<span class="ident" id="3072204">err</span>&nbsp;<span class="op" id="3072208">!=</span>&nbsp;<span class="ident" id="3072211">nil</span>&nbsp;<span class="op" id="3072215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072219">return</span>&nbsp;<span class="ident" id="3072226">nil</span><span class="op" id="3072229">,</span>&nbsp;<span class="ident" id="3072231">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3072236">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072239">if</span>&nbsp;<span class="ident" id="3072242">frag</span>&nbsp;<span class="op" id="3072247">==</span>&nbsp;<span class="string" id="3072250">&#34;&#34;</span>&nbsp;<span class="op" id="3072253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072257">return</span>&nbsp;<span class="ident" id="3072264">url</span><span class="op" id="3072267">,</span>&nbsp;<span class="ident" id="3072269">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3072274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072277">if</span>&nbsp;<span class="ident" id="3072280">url</span><span class="op" id="3072283">.</span><span class="ident" id="3072284">Fragment</span><span class="op" id="3072292">,</span>&nbsp;<span class="ident" id="3072294">err</span>&nbsp;<span class="op" id="3072298">=</span>&nbsp;<span class="ident" id="3072300">unescape</span><span class="op" id="3072308">(</span><span class="ident" id="3072309">frag</span><span class="op" id="3072313">,</span>&nbsp;<span class="ident" id="3072315">encodeFragment</span><span class="op" id="3072329">)</span><span class="op" id="3072330">;</span>&nbsp;<span class="ident" id="3072332">err</span>&nbsp;<span class="op" id="3072336">!=</span>&nbsp;<span class="ident" id="3072339">nil</span>&nbsp;<span class="op" id="3072343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072347">return</span>&nbsp;<span class="ident" id="3072354">nil</span><span class="op" id="3072357">,</span>&nbsp;<span class="op" id="3072359">&amp;</span><span class="ident" id="3072360">Error</span><span class="op" id="3072365">{</span><span class="string" id="3072366">&#34;parse&#34;</span><span class="op" id="3072373">,</span>&nbsp;<span class="ident" id="3072375">rawurl</span><span class="op" id="3072381">,</span>&nbsp;<span class="ident" id="3072383">err</span><span class="op" id="3072386">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3072389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072392">return</span>&nbsp;<span class="ident" id="3072399">url</span><span class="op" id="3072402">,</span>&nbsp;<span class="ident" id="3072404">nil</span><br>
<span class="lineno"></span><span class="op" id="3072408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3072411">//&nbsp;ParseRequestURI&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.&nbsp;&nbsp;It&nbsp;assumes&nbsp;that</span><br>
<span class="lineno">350</span><span class="comment" id="3072483">//&nbsp;rawurl&nbsp;was&nbsp;received&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request,&nbsp;so&nbsp;the&nbsp;rawurl&nbsp;is&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="3072555">//&nbsp;only&nbsp;as&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;or&nbsp;an&nbsp;absolute&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3072603">//&nbsp;The&nbsp;string&nbsp;rawurl&nbsp;is&nbsp;assumed&nbsp;not&nbsp;to&nbsp;have&nbsp;a&nbsp;#fragment&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="comment" id="3072667">//&nbsp;(Web&nbsp;browsers&nbsp;strip&nbsp;#fragment&nbsp;before&nbsp;sending&nbsp;the&nbsp;URL&nbsp;to&nbsp;a&nbsp;web&nbsp;server.)</span><br>
<span class="lineno"></span><span class="keyword" id="3072741">func</span>&nbsp;<span class="ident" id="3072746">ParseRequestURI</span><span class="op" id="3072761">(</span><span class="ident" id="3072762">rawurl</span>&nbsp;<span class="builtintype" id="3072769">string</span><span class="op" id="3072775">)</span>&nbsp;<span class="op" id="3072777">(</span><span class="ident" id="3072778">url</span>&nbsp;<span class="op" id="3072782">*</span><span class="ident" id="3072783">URL</span><span class="op" id="3072786">,</span>&nbsp;<span class="ident" id="3072788">err</span>&nbsp;<span class="builtintype" id="3072792">error</span><span class="op" id="3072797">)</span>&nbsp;<span class="op" id="3072799">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072802">return</span>&nbsp;<span class="ident" id="3072809">parse</span><span class="op" id="3072814">(</span><span class="ident" id="3072815">rawurl</span><span class="op" id="3072821">,</span>&nbsp;<span class="builtintype" id="3072823">true</span><span class="op" id="3072827">)</span><br>
<span class="lineno"></span><span class="op" id="3072829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3072832">//&nbsp;parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;from&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;contexts.&nbsp;&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3072896">//&nbsp;viaRequest&nbsp;is&nbsp;true,&nbsp;the&nbsp;URL&nbsp;is&nbsp;assumed&nbsp;to&nbsp;have&nbsp;arrived&nbsp;via&nbsp;an&nbsp;HTTP&nbsp;request,</span><br>
<span class="lineno">360</span><span class="comment" id="3072975">//&nbsp;in&nbsp;which&nbsp;case&nbsp;only&nbsp;absolute&nbsp;URLs&nbsp;or&nbsp;path-absolute&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="3073055">//&nbsp;If&nbsp;viaRequest&nbsp;is&nbsp;false,&nbsp;all&nbsp;forms&nbsp;of&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="keyword" id="3073122">func</span>&nbsp;<span class="ident" id="3073127">parse</span><span class="op" id="3073132">(</span><span class="ident" id="3073133">rawurl</span>&nbsp;<span class="builtintype" id="3073140">string</span><span class="op" id="3073146">,</span>&nbsp;<span class="ident" id="3073148">viaRequest</span>&nbsp;<span class="builtintype" id="3073159">bool</span><span class="op" id="3073163">)</span>&nbsp;<span class="op" id="3073165">(</span><span class="ident" id="3073166">url</span>&nbsp;<span class="op" id="3073170">*</span><span class="ident" id="3073171">URL</span><span class="op" id="3073174">,</span>&nbsp;<span class="ident" id="3073176">err</span>&nbsp;<span class="builtintype" id="3073180">error</span><span class="op" id="3073185">)</span>&nbsp;<span class="op" id="3073187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073190">var</span>&nbsp;<span class="ident" id="3073194">rest</span>&nbsp;<span class="builtintype" id="3073199">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073208">if</span>&nbsp;<span class="ident" id="3073211">rawurl</span>&nbsp;<span class="op" id="3073218">==</span>&nbsp;<span class="string" id="3073221">&#34;&#34;</span>&nbsp;<span class="op" id="3073224">&amp;&amp;</span>&nbsp;<span class="ident" id="3073227">viaRequest</span>&nbsp;<span class="op" id="3073238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073242">err</span>&nbsp;<span class="op" id="3073246">=</span>&nbsp;<span class="ident" id="3073248">errors</span><span class="op" id="3073254">.</span><span class="ident" id="3073255">New</span><span class="op" id="3073258">(</span><span class="string" id="3073259">&#34;empty&nbsp;url&#34;</span><span class="op" id="3073270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073274">goto</span>&nbsp;<span class="ident" id="3073279">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3073286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073289">url</span>&nbsp;<span class="op" id="3073293">=</span>&nbsp;<span class="builtinfunc" id="3073295">new</span><span class="op" id="3073298">(</span><span class="ident" id="3073299">URL</span><span class="op" id="3073302">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073306">if</span>&nbsp;<span class="ident" id="3073309">rawurl</span>&nbsp;<span class="op" id="3073316">==</span>&nbsp;<span class="string" id="3073319">&#34;*&#34;</span>&nbsp;<span class="op" id="3073323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073327">url</span><span class="op" id="3073330">.</span><span class="ident" id="3073331">Path</span>&nbsp;<span class="op" id="3073336">=</span>&nbsp;<span class="string" id="3073338">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073344">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3073352">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3073356">//&nbsp;Split&nbsp;off&nbsp;possible&nbsp;leading&nbsp;&#34;http:&#34;,&nbsp;&#34;mailto:&#34;,&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3073412">//&nbsp;Cannot&nbsp;contain&nbsp;escaped&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073451">if</span>&nbsp;<span class="ident" id="3073454">url</span><span class="op" id="3073457">.</span><span class="ident" id="3073458">Scheme</span><span class="op" id="3073464">,</span>&nbsp;<span class="ident" id="3073466">rest</span><span class="op" id="3073470">,</span>&nbsp;<span class="ident" id="3073472">err</span>&nbsp;<span class="op" id="3073476">=</span>&nbsp;<span class="ident" id="3073478">getscheme</span><span class="op" id="3073487">(</span><span class="ident" id="3073488">rawurl</span><span class="op" id="3073494">)</span><span class="op" id="3073495">;</span>&nbsp;<span class="ident" id="3073497">err</span>&nbsp;<span class="op" id="3073501">!=</span>&nbsp;<span class="ident" id="3073504">nil</span>&nbsp;<span class="op" id="3073508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073512">goto</span>&nbsp;<span class="ident" id="3073517">Error</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3073524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073527">url</span><span class="op" id="3073530">.</span><span class="ident" id="3073531">Scheme</span>&nbsp;<span class="op" id="3073538">=</span>&nbsp;<span class="ident" id="3073540">strings</span><span class="op" id="3073547">.</span><span class="ident" id="3073548">ToLower</span><span class="op" id="3073555">(</span><span class="ident" id="3073556">url</span><span class="op" id="3073559">.</span><span class="ident" id="3073560">Scheme</span><span class="op" id="3073566">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073570">rest</span><span class="op" id="3073574">,</span>&nbsp;<span class="ident" id="3073576">url</span><span class="op" id="3073579">.</span><span class="ident" id="3073580">RawQuery</span>&nbsp;<span class="op" id="3073589">=</span>&nbsp;<span class="ident" id="3073591">split</span><span class="op" id="3073596">(</span><span class="ident" id="3073597">rest</span><span class="op" id="3073601">,</span>&nbsp;<span class="string" id="3073603">&#34;?&#34;</span><span class="op" id="3073606">,</span>&nbsp;<span class="builtintype" id="3073608">true</span><span class="op" id="3073612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073616">if</span>&nbsp;<span class="op" id="3073619">!</span><span class="ident" id="3073620">strings</span><span class="op" id="3073627">.</span><span class="ident" id="3073628">HasPrefix</span><span class="op" id="3073637">(</span><span class="ident" id="3073638">rest</span><span class="op" id="3073642">,</span>&nbsp;<span class="string" id="3073644">&#34;/&#34;</span><span class="op" id="3073647">)</span>&nbsp;<span class="op" id="3073649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073653">if</span>&nbsp;<span class="ident" id="3073656">url</span><span class="op" id="3073659">.</span><span class="ident" id="3073660">Scheme</span>&nbsp;<span class="op" id="3073667">!=</span>&nbsp;<span class="string" id="3073670">&#34;&#34;</span>&nbsp;<span class="op" id="3073673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3073678">//&nbsp;We&nbsp;consider&nbsp;rootless&nbsp;paths&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;as&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073735">url</span><span class="op" id="3073738">.</span><span class="ident" id="3073739">Opaque</span>&nbsp;<span class="op" id="3073746">=</span>&nbsp;<span class="ident" id="3073748">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073756">return</span>&nbsp;<span class="ident" id="3073763">url</span><span class="op" id="3073766">,</span>&nbsp;<span class="ident" id="3073768">nil</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3073774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073778">if</span>&nbsp;<span class="ident" id="3073781">viaRequest</span>&nbsp;<span class="op" id="3073792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073797">err</span>&nbsp;<span class="op" id="3073801">=</span>&nbsp;<span class="ident" id="3073803">errors</span><span class="op" id="3073809">.</span><span class="ident" id="3073810">New</span><span class="op" id="3073813">(</span><span class="string" id="3073814">&#34;invalid&nbsp;URI&nbsp;for&nbsp;request&#34;</span><span class="op" id="3073839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073844">goto</span>&nbsp;<span class="ident" id="3073849">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3073857">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3073860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073864">if</span>&nbsp;<span class="op" id="3073867">(</span><span class="ident" id="3073868">url</span><span class="op" id="3073871">.</span><span class="ident" id="3073872">Scheme</span>&nbsp;<span class="op" id="3073879">!=</span>&nbsp;<span class="string" id="3073882">&#34;&#34;</span>&nbsp;<span class="op" id="3073885">||</span>&nbsp;<span class="op" id="3073888">!</span><span class="ident" id="3073889">viaRequest</span>&nbsp;<span class="op" id="3073900">&amp;&amp;</span>&nbsp;<span class="op" id="3073903">!</span><span class="ident" id="3073904">strings</span><span class="op" id="3073911">.</span><span class="ident" id="3073912">HasPrefix</span><span class="op" id="3073921">(</span><span class="ident" id="3073922">rest</span><span class="op" id="3073926">,</span>&nbsp;<span class="string" id="3073928">&#34;///&#34;</span><span class="op" id="3073933">)</span><span class="op" id="3073934">)</span>&nbsp;<span class="op" id="3073936">&amp;&amp;</span>&nbsp;<span class="ident" id="3073939">strings</span><span class="op" id="3073946">.</span><span class="ident" id="3073947">HasPrefix</span><span class="op" id="3073956">(</span><span class="ident" id="3073957">rest</span><span class="op" id="3073961">,</span>&nbsp;<span class="string" id="3073963">&#34;//&#34;</span><span class="op" id="3073967">)</span>&nbsp;<span class="op" id="3073969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073973">var</span>&nbsp;<span class="ident" id="3073977">authority</span>&nbsp;<span class="builtintype" id="3073987">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073996">authority</span><span class="op" id="3074005">,</span>&nbsp;<span class="ident" id="3074007">rest</span>&nbsp;<span class="op" id="3074012">=</span>&nbsp;<span class="ident" id="3074014">split</span><span class="op" id="3074019">(</span><span class="ident" id="3074020">rest</span><span class="op" id="3074024">[</span><span class="num" id="3074025">2</span><span class="op" id="3074026">:</span><span class="op" id="3074027">]</span><span class="op" id="3074028">,</span>&nbsp;<span class="string" id="3074030">&#34;/&#34;</span><span class="op" id="3074033">,</span>&nbsp;<span class="builtintype" id="3074035">false</span><span class="op" id="3074040">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074044">url</span><span class="op" id="3074047">.</span><span class="ident" id="3074048">User</span><span class="op" id="3074052">,</span>&nbsp;<span class="ident" id="3074054">url</span><span class="op" id="3074057">.</span><span class="ident" id="3074058">Host</span><span class="op" id="3074062">,</span>&nbsp;<span class="ident" id="3074064">err</span>&nbsp;<span class="op" id="3074068">=</span>&nbsp;<span class="ident" id="3074070">parseAuthority</span><span class="op" id="3074084">(</span><span class="ident" id="3074085">authority</span><span class="op" id="3074094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074098">if</span>&nbsp;<span class="ident" id="3074101">err</span>&nbsp;<span class="op" id="3074105">!=</span>&nbsp;<span class="ident" id="3074108">nil</span>&nbsp;<span class="op" id="3074112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074117">goto</span>&nbsp;<span class="ident" id="3074122">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074134">if</span>&nbsp;<span class="ident" id="3074137">strings</span><span class="op" id="3074144">.</span><span class="ident" id="3074145">Contains</span><span class="op" id="3074153">(</span><span class="ident" id="3074154">url</span><span class="op" id="3074157">.</span><span class="ident" id="3074158">Host</span><span class="op" id="3074162">,</span>&nbsp;<span class="string" id="3074164">&#34;%&#34;</span><span class="op" id="3074167">)</span>&nbsp;<span class="op" id="3074169">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074174">err</span>&nbsp;<span class="op" id="3074178">=</span>&nbsp;<span class="ident" id="3074180">errors</span><span class="op" id="3074186">.</span><span class="ident" id="3074187">New</span><span class="op" id="3074190">(</span><span class="string" id="3074191">&#34;hexadecimal&nbsp;escape&nbsp;in&nbsp;host&#34;</span><span class="op" id="3074219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074224">goto</span>&nbsp;<span class="ident" id="3074229">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074243">if</span>&nbsp;<span class="ident" id="3074246">url</span><span class="op" id="3074249">.</span><span class="ident" id="3074250">Path</span><span class="op" id="3074254">,</span>&nbsp;<span class="ident" id="3074256">err</span>&nbsp;<span class="op" id="3074260">=</span>&nbsp;<span class="ident" id="3074262">unescape</span><span class="op" id="3074270">(</span><span class="ident" id="3074271">rest</span><span class="op" id="3074275">,</span>&nbsp;<span class="ident" id="3074277">encodePath</span><span class="op" id="3074287">)</span><span class="op" id="3074288">;</span>&nbsp;<span class="ident" id="3074290">err</span>&nbsp;<span class="op" id="3074294">!=</span>&nbsp;<span class="ident" id="3074297">nil</span>&nbsp;<span class="op" id="3074301">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074305">goto</span>&nbsp;<span class="ident" id="3074310">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074320">return</span>&nbsp;<span class="ident" id="3074327">url</span><span class="op" id="3074330">,</span>&nbsp;<span class="ident" id="3074332">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3074337">Error</span><span class="op" id="3074342">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074345">return</span>&nbsp;<span class="ident" id="3074352">nil</span><span class="op" id="3074355">,</span>&nbsp;<span class="op" id="3074357">&amp;</span><span class="ident" id="3074358">Error</span><span class="op" id="3074363">{</span><span class="string" id="3074364">&#34;parse&#34;</span><span class="op" id="3074371">,</span>&nbsp;<span class="ident" id="3074373">rawurl</span><span class="op" id="3074379">,</span>&nbsp;<span class="ident" id="3074381">err</span><span class="op" id="3074384">}</span><br>
<span class="lineno"></span><span class="op" id="3074386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3074389">func</span>&nbsp;<span class="ident" id="3074394">parseAuthority</span><span class="op" id="3074408">(</span><span class="ident" id="3074409">authority</span>&nbsp;<span class="builtintype" id="3074419">string</span><span class="op" id="3074425">)</span>&nbsp;<span class="op" id="3074427">(</span><span class="ident" id="3074428">user</span>&nbsp;<span class="op" id="3074433">*</span><span class="ident" id="3074434">Userinfo</span><span class="op" id="3074442">,</span>&nbsp;<span class="ident" id="3074444">host</span>&nbsp;<span class="builtintype" id="3074449">string</span><span class="op" id="3074455">,</span>&nbsp;<span class="ident" id="3074457">err</span>&nbsp;<span class="builtintype" id="3074461">error</span><span class="op" id="3074466">)</span>&nbsp;<span class="op" id="3074468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074471">i</span>&nbsp;<span class="op" id="3074473">:=</span>&nbsp;<span class="ident" id="3074476">strings</span><span class="op" id="3074483">.</span><span class="ident" id="3074484">LastIndex</span><span class="op" id="3074493">(</span><span class="ident" id="3074494">authority</span><span class="op" id="3074503">,</span>&nbsp;<span class="string" id="3074505">&#34;@&#34;</span><span class="op" id="3074508">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074511">if</span>&nbsp;<span class="ident" id="3074514">i</span>&nbsp;<span class="op" id="3074516">&lt;</span>&nbsp;<span class="num" id="3074518">0</span>&nbsp;<span class="op" id="3074520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074524">host</span>&nbsp;<span class="op" id="3074529">=</span>&nbsp;<span class="ident" id="3074531">authority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074543">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074554">userinfo</span><span class="op" id="3074562">,</span>&nbsp;<span class="ident" id="3074564">host</span>&nbsp;<span class="op" id="3074569">:=</span>&nbsp;<span class="ident" id="3074572">authority</span><span class="op" id="3074581">[</span><span class="op" id="3074582">:</span><span class="ident" id="3074583">i</span><span class="op" id="3074584">]</span><span class="op" id="3074585">,</span>&nbsp;<span class="ident" id="3074587">authority</span><span class="op" id="3074596">[</span><span class="ident" id="3074597">i</span><span class="op" id="3074598">+</span><span class="num" id="3074599">1</span><span class="op" id="3074600">:</span><span class="op" id="3074601">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074604">if</span>&nbsp;<span class="ident" id="3074607">strings</span><span class="op" id="3074614">.</span><span class="ident" id="3074615">Index</span><span class="op" id="3074620">(</span><span class="ident" id="3074621">userinfo</span><span class="op" id="3074629">,</span>&nbsp;<span class="string" id="3074631">&#34;:&#34;</span><span class="op" id="3074634">)</span>&nbsp;<span class="op" id="3074636">&lt;</span>&nbsp;<span class="num" id="3074638">0</span>&nbsp;<span class="op" id="3074640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074644">if</span>&nbsp;<span class="ident" id="3074647">userinfo</span><span class="op" id="3074655">,</span>&nbsp;<span class="ident" id="3074657">err</span>&nbsp;<span class="op" id="3074661">=</span>&nbsp;<span class="ident" id="3074663">unescape</span><span class="op" id="3074671">(</span><span class="ident" id="3074672">userinfo</span><span class="op" id="3074680">,</span>&nbsp;<span class="ident" id="3074682">encodeUserPassword</span><span class="op" id="3074700">)</span><span class="op" id="3074701">;</span>&nbsp;<span class="ident" id="3074703">err</span>&nbsp;<span class="op" id="3074707">!=</span>&nbsp;<span class="ident" id="3074710">nil</span>&nbsp;<span class="op" id="3074714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074719">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074732">user</span>&nbsp;<span class="op" id="3074737">=</span>&nbsp;<span class="ident" id="3074739">User</span><span class="op" id="3074743">(</span><span class="ident" id="3074744">userinfo</span><span class="op" id="3074752">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074755">}</span>&nbsp;<span class="keyword" id="3074757">else</span>&nbsp;<span class="op" id="3074762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074766">username</span><span class="op" id="3074774">,</span>&nbsp;<span class="ident" id="3074776">password</span>&nbsp;<span class="op" id="3074785">:=</span>&nbsp;<span class="ident" id="3074788">split</span><span class="op" id="3074793">(</span><span class="ident" id="3074794">userinfo</span><span class="op" id="3074802">,</span>&nbsp;<span class="string" id="3074804">&#34;:&#34;</span><span class="op" id="3074807">,</span>&nbsp;<span class="builtintype" id="3074809">true</span><span class="op" id="3074813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074817">if</span>&nbsp;<span class="ident" id="3074820">username</span><span class="op" id="3074828">,</span>&nbsp;<span class="ident" id="3074830">err</span>&nbsp;<span class="op" id="3074834">=</span>&nbsp;<span class="ident" id="3074836">unescape</span><span class="op" id="3074844">(</span><span class="ident" id="3074845">username</span><span class="op" id="3074853">,</span>&nbsp;<span class="ident" id="3074855">encodeUserPassword</span><span class="op" id="3074873">)</span><span class="op" id="3074874">;</span>&nbsp;<span class="ident" id="3074876">err</span>&nbsp;<span class="op" id="3074880">!=</span>&nbsp;<span class="ident" id="3074883">nil</span>&nbsp;<span class="op" id="3074887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074892">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074901">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074905">if</span>&nbsp;<span class="ident" id="3074908">password</span><span class="op" id="3074916">,</span>&nbsp;<span class="ident" id="3074918">err</span>&nbsp;<span class="op" id="3074922">=</span>&nbsp;<span class="ident" id="3074924">unescape</span><span class="op" id="3074932">(</span><span class="ident" id="3074933">password</span><span class="op" id="3074941">,</span>&nbsp;<span class="ident" id="3074943">encodeUserPassword</span><span class="op" id="3074961">)</span><span class="op" id="3074962">;</span>&nbsp;<span class="ident" id="3074964">err</span>&nbsp;<span class="op" id="3074968">!=</span>&nbsp;<span class="ident" id="3074971">nil</span>&nbsp;<span class="op" id="3074975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074980">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074993">user</span>&nbsp;<span class="op" id="3074998">=</span>&nbsp;<span class="ident" id="3075000">UserPassword</span><span class="op" id="3075012">(</span><span class="ident" id="3075013">username</span><span class="op" id="3075021">,</span>&nbsp;<span class="ident" id="3075023">password</span><span class="op" id="3075031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3075034">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3075037">return</span><br>
<span class="lineno"></span><span class="op" id="3075044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3075047">//&nbsp;String&nbsp;reassembles&nbsp;the&nbsp;URL&nbsp;into&nbsp;a&nbsp;valid&nbsp;URL&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3075102">//&nbsp;The&nbsp;general&nbsp;form&nbsp;of&nbsp;the&nbsp;result&nbsp;is&nbsp;one&nbsp;of:</span><br>
<span class="lineno">445</span><span class="comment" id="3075147">//</span><br>
<span class="lineno"></span><span class="comment" id="3075150">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque</span><br>
<span class="lineno"></span><span class="comment" id="3075167">//&nbsp;&nbsp;&nbsp;&nbspscheme://userinfo@host/path?query#fragment</span><br>
<span class="lineno"></span><span class="comment" id="3075213">//</span><br>
<span class="lineno"></span><span class="comment" id="3075216">//&nbsp;If&nbsp;u.Opaque&nbsp;is&nbsp;non-empty,&nbsp;String&nbsp;uses&nbsp;the&nbsp;first&nbsp;form;</span><br>
<span class="lineno">450</span><span class="comment" id="3075273">//&nbsp;otherwise&nbsp;it&nbsp;uses&nbsp;the&nbsp;second&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3075311">//</span><br>
<span class="lineno"></span><span class="comment" id="3075314">//&nbsp;In&nbsp;the&nbsp;second&nbsp;form,&nbsp;the&nbsp;following&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="3075364">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;is&nbsp;empty,&nbsp;scheme:&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3075411">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.User&nbsp;is&nbsp;nil,&nbsp;userinfo@&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">455</span><span class="comment" id="3075456">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;empty,&nbsp;host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3075499">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;and&nbsp;u.Host&nbsp;are&nbsp;empty&nbsp;and&nbsp;u.User&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="3075556">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;entire&nbsp;scheme://userinfo@host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3075609">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;non-empty&nbsp;and&nbsp;u.Path&nbsp;begins&nbsp;with&nbsp;a&nbsp;/,</span><br>
<span class="lineno"></span><span class="comment" id="3075665">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;form&nbsp;host/path&nbsp;does&nbsp;not&nbsp;add&nbsp;its&nbsp;own&nbsp;/.</span><br>
<span class="lineno">460</span><span class="comment" id="3075714">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.RawQuery&nbsp;is&nbsp;empty,&nbsp;?query&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3075762">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Fragment&nbsp;is&nbsp;empty,&nbsp;#fragment&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="keyword" id="3075813">func</span>&nbsp;<span class="op" id="3075818">(</span><span class="ident" id="3075819">u</span>&nbsp;<span class="op" id="3075821">*</span><span class="ident" id="3075822">URL</span><span class="op" id="3075825">)</span>&nbsp;<span class="ident" id="3075827">String</span><span class="op" id="3075833">(</span><span class="op" id="3075834">)</span>&nbsp;<span class="builtintype" id="3075836">string</span>&nbsp;<span class="op" id="3075843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3075846">var</span>&nbsp;<span class="ident" id="3075850">buf</span>&nbsp;<span class="ident" id="3075854">bytes</span><span class="op" id="3075859">.</span><span class="ident" id="3075860">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3075868">if</span>&nbsp;<span class="ident" id="3075871">u</span><span class="op" id="3075872">.</span><span class="ident" id="3075873">Scheme</span>&nbsp;<span class="op" id="3075880">!=</span>&nbsp;<span class="string" id="3075883">&#34;&#34;</span>&nbsp;<span class="op" id="3075886">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075890">buf</span><span class="op" id="3075893">.</span><span class="ident" id="3075894">WriteString</span><span class="op" id="3075905">(</span><span class="ident" id="3075906">u</span><span class="op" id="3075907">.</span><span class="ident" id="3075908">Scheme</span><span class="op" id="3075914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075918">buf</span><span class="op" id="3075921">.</span><span class="ident" id="3075922">WriteByte</span><span class="op" id="3075931">(</span><span class="string" id="3075932">&#39;:&#39;</span><span class="op" id="3075935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3075938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3075941">if</span>&nbsp;<span class="ident" id="3075944">u</span><span class="op" id="3075945">.</span><span class="ident" id="3075946">Opaque</span>&nbsp;<span class="op" id="3075953">!=</span>&nbsp;<span class="string" id="3075956">&#34;&#34;</span>&nbsp;<span class="op" id="3075959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075963">buf</span><span class="op" id="3075966">.</span><span class="ident" id="3075967">WriteString</span><span class="op" id="3075978">(</span><span class="ident" id="3075979">u</span><span class="op" id="3075980">.</span><span class="ident" id="3075981">Opaque</span><span class="op" id="3075987">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3075990">}</span>&nbsp;<span class="keyword" id="3075992">else</span>&nbsp;<span class="op" id="3075997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3076001">if</span>&nbsp;<span class="ident" id="3076004">u</span><span class="op" id="3076005">.</span><span class="ident" id="3076006">Scheme</span>&nbsp;<span class="op" id="3076013">!=</span>&nbsp;<span class="string" id="3076016">&#34;&#34;</span>&nbsp;<span class="op" id="3076019">||</span>&nbsp;<span class="ident" id="3076022">u</span><span class="op" id="3076023">.</span><span class="ident" id="3076024">Host</span>&nbsp;<span class="op" id="3076029">!=</span>&nbsp;<span class="string" id="3076032">&#34;&#34;</span>&nbsp;<span class="op" id="3076035">||</span>&nbsp;<span class="ident" id="3076038">u</span><span class="op" id="3076039">.</span><span class="ident" id="3076040">User</span>&nbsp;<span class="op" id="3076045">!=</span>&nbsp;<span class="ident" id="3076048">nil</span>&nbsp;<span class="op" id="3076052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076057">buf</span><span class="op" id="3076060">.</span><span class="ident" id="3076061">WriteString</span><span class="op" id="3076072">(</span><span class="string" id="3076073">&#34;//&#34;</span><span class="op" id="3076077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3076082">if</span>&nbsp;<span class="ident" id="3076085">ui</span>&nbsp;<span class="op" id="3076088">:=</span>&nbsp;<span class="ident" id="3076091">u</span><span class="op" id="3076092">.</span><span class="ident" id="3076093">User</span><span class="op" id="3076097">;</span>&nbsp;<span class="ident" id="3076099">ui</span>&nbsp;<span class="op" id="3076102">!=</span>&nbsp;<span class="ident" id="3076105">nil</span>&nbsp;<span class="op" id="3076109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076115">buf</span><span class="op" id="3076118">.</span><span class="ident" id="3076119">WriteString</span><span class="op" id="3076130">(</span><span class="ident" id="3076131">ui</span><span class="op" id="3076133">.</span><span class="ident" id="3076134">String</span><span class="op" id="3076140">(</span><span class="op" id="3076141">)</span><span class="op" id="3076142">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076148">buf</span><span class="op" id="3076151">.</span><span class="ident" id="3076152">WriteByte</span><span class="op" id="3076161">(</span><span class="string" id="3076162">&#39;@&#39;</span><span class="op" id="3076165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3076170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3076175">if</span>&nbsp;<span class="ident" id="3076178">h</span>&nbsp;<span class="op" id="3076180">:=</span>&nbsp;<span class="ident" id="3076183">u</span><span class="op" id="3076184">.</span><span class="ident" id="3076185">Host</span><span class="op" id="3076189">;</span>&nbsp;<span class="ident" id="3076191">h</span>&nbsp;<span class="op" id="3076193">!=</span>&nbsp;<span class="string" id="3076196">&#34;&#34;</span>&nbsp;<span class="op" id="3076199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076205">buf</span><span class="op" id="3076208">.</span><span class="ident" id="3076209">WriteString</span><span class="op" id="3076220">(</span><span class="ident" id="3076221">h</span><span class="op" id="3076222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3076227">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3076231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3076235">if</span>&nbsp;<span class="ident" id="3076238">u</span><span class="op" id="3076239">.</span><span class="ident" id="3076240">Path</span>&nbsp;<span class="op" id="3076245">!=</span>&nbsp;<span class="string" id="3076248">&#34;&#34;</span>&nbsp;<span class="op" id="3076251">&amp;&amp;</span>&nbsp;<span class="ident" id="3076254">u</span><span class="op" id="3076255">.</span><span class="ident" id="3076256">Path</span><span class="op" id="3076260">[</span><span class="num" id="3076261">0</span><span class="op" id="3076262">]</span>&nbsp;<span class="op" id="3076264">!=</span>&nbsp;<span class="string" id="3076267">&#39;/&#39;</span>&nbsp;<span class="op" id="3076271">&amp;&amp;</span>&nbsp;<span class="ident" id="3076274">u</span><span class="op" id="3076275">.</span><span class="ident" id="3076276">Host</span>&nbsp;<span class="op" id="3076281">!=</span>&nbsp;<span class="string" id="3076284">&#34;&#34;</span>&nbsp;<span class="op" id="3076287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076292">buf</span><span class="op" id="3076295">.</span><span class="ident" id="3076296">WriteByte</span><span class="op" id="3076305">(</span><span class="string" id="3076306">&#39;/&#39;</span><span class="op" id="3076309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3076313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076317">buf</span><span class="op" id="3076320">.</span><span class="ident" id="3076321">WriteString</span><span class="op" id="3076332">(</span><span class="ident" id="3076333">escape</span><span class="op" id="3076339">(</span><span class="ident" id="3076340">u</span><span class="op" id="3076341">.</span><span class="ident" id="3076342">Path</span><span class="op" id="3076346">,</span>&nbsp;<span class="ident" id="3076348">encodePath</span><span class="op" id="3076358">)</span><span class="op" id="3076359">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3076362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3076365">if</span>&nbsp;<span class="ident" id="3076368">u</span><span class="op" id="3076369">.</span><span class="ident" id="3076370">RawQuery</span>&nbsp;<span class="op" id="3076379">!=</span>&nbsp;<span class="string" id="3076382">&#34;&#34;</span>&nbsp;<span class="op" id="3076385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076389">buf</span><span class="op" id="3076392">.</span><span class="ident" id="3076393">WriteByte</span><span class="op" id="3076402">(</span><span class="string" id="3076403">&#39;?&#39;</span><span class="op" id="3076406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076410">buf</span><span class="op" id="3076413">.</span><span class="ident" id="3076414">WriteString</span><span class="op" id="3076425">(</span><span class="ident" id="3076426">u</span><span class="op" id="3076427">.</span><span class="ident" id="3076428">RawQuery</span><span class="op" id="3076436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3076439">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3076442">if</span>&nbsp;<span class="ident" id="3076445">u</span><span class="op" id="3076446">.</span><span class="ident" id="3076447">Fragment</span>&nbsp;<span class="op" id="3076456">!=</span>&nbsp;<span class="string" id="3076459">&#34;&#34;</span>&nbsp;<span class="op" id="3076462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076466">buf</span><span class="op" id="3076469">.</span><span class="ident" id="3076470">WriteByte</span><span class="op" id="3076479">(</span><span class="string" id="3076480">&#39;#&#39;</span><span class="op" id="3076483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076487">buf</span><span class="op" id="3076490">.</span><span class="ident" id="3076491">WriteString</span><span class="op" id="3076502">(</span><span class="ident" id="3076503">escape</span><span class="op" id="3076509">(</span><span class="ident" id="3076510">u</span><span class="op" id="3076511">.</span><span class="ident" id="3076512">Fragment</span><span class="op" id="3076520">,</span>&nbsp;<span class="ident" id="3076522">encodeFragment</span><span class="op" id="3076536">)</span><span class="op" id="3076537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3076540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3076543">return</span>&nbsp;<span class="ident" id="3076550">buf</span><span class="op" id="3076553">.</span><span class="ident" id="3076554">String</span><span class="op" id="3076560">(</span><span class="op" id="3076561">)</span><br>
<span class="lineno">495</span><span class="op" id="3076563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3076566">//&nbsp;Values&nbsp;maps&nbsp;a&nbsp;string&nbsp;key&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3076615">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;for&nbsp;query&nbsp;parameters&nbsp;and&nbsp;form&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3076677">//&nbsp;Unlike&nbsp;in&nbsp;the&nbsp;http.Header&nbsp;map,&nbsp;the&nbsp;keys&nbsp;in&nbsp;a&nbsp;Values&nbsp;map</span><br>
<span class="lineno">500</span><span class="comment" id="3076736">//&nbsp;are&nbsp;case-sensitive.</span><br>
<span class="lineno"></span><span class="keyword" id="3076759">type</span>&nbsp;<span class="ident" id="3076764">Values</span>&nbsp;<span class="keyword" id="3076771">map</span><span class="op" id="3076774">[</span><span class="builtintype" id="3076775">string</span><span class="op" id="3076781">]</span><span class="op" id="3076782">[</span><span class="op" id="3076783">]</span><span class="builtintype" id="3076784">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3076792">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3076851">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns</span><br>
<span class="lineno">505</span><span class="comment" id="3076914">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values,&nbsp;use&nbsp;the&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3076974">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3076987">func</span>&nbsp;<span class="op" id="3076992">(</span><span class="ident" id="3076993">v</span>&nbsp;<span class="ident" id="3076995">Values</span><span class="op" id="3077001">)</span>&nbsp;<span class="ident" id="3077003">Get</span><span class="op" id="3077006">(</span><span class="ident" id="3077007">key</span>&nbsp;<span class="builtintype" id="3077011">string</span><span class="op" id="3077017">)</span>&nbsp;<span class="builtintype" id="3077019">string</span>&nbsp;<span class="op" id="3077026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077029">if</span>&nbsp;<span class="ident" id="3077032">v</span>&nbsp;<span class="op" id="3077034">==</span>&nbsp;<span class="ident" id="3077037">nil</span>&nbsp;<span class="op" id="3077041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077045">return</span>&nbsp;<span class="string" id="3077052">&#34;&#34;</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3077056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077059">vs</span><span class="op" id="3077061">,</span>&nbsp;<span class="ident" id="3077063">ok</span>&nbsp;<span class="op" id="3077066">:=</span>&nbsp;<span class="ident" id="3077069">v</span><span class="op" id="3077070">[</span><span class="ident" id="3077071">key</span><span class="op" id="3077074">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077077">if</span>&nbsp;<span class="op" id="3077080">!</span><span class="ident" id="3077081">ok</span>&nbsp;<span class="op" id="3077084">||</span>&nbsp;<span class="builtinfunc" id="3077087">len</span><span class="op" id="3077090">(</span><span class="ident" id="3077091">vs</span><span class="op" id="3077093">)</span>&nbsp;<span class="op" id="3077095">==</span>&nbsp;<span class="num" id="3077098">0</span>&nbsp;<span class="op" id="3077100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077104">return</span>&nbsp;<span class="string" id="3077111">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3077115">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077118">return</span>&nbsp;<span class="ident" id="3077125">vs</span><span class="op" id="3077127">[</span><span class="num" id="3077128">0</span><span class="op" id="3077129">]</span><br>
<span class="lineno"></span><span class="op" id="3077131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3077134">//&nbsp;Set&nbsp;sets&nbsp;the&nbsp;key&nbsp;to&nbsp;value.&nbsp;It&nbsp;replaces&nbsp;any&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="3077189">//&nbsp;values.</span><br>
<span class="lineno">520</span><span class="keyword" id="3077200">func</span>&nbsp;<span class="op" id="3077205">(</span><span class="ident" id="3077206">v</span>&nbsp;<span class="ident" id="3077208">Values</span><span class="op" id="3077214">)</span>&nbsp;<span class="ident" id="3077216">Set</span><span class="op" id="3077219">(</span><span class="ident" id="3077220">key</span><span class="op" id="3077223">,</span>&nbsp;<span class="ident" id="3077225">value</span>&nbsp;<span class="builtintype" id="3077231">string</span><span class="op" id="3077237">)</span>&nbsp;<span class="op" id="3077239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077242">v</span><span class="op" id="3077243">[</span><span class="ident" id="3077244">key</span><span class="op" id="3077247">]</span>&nbsp;<span class="op" id="3077249">=</span>&nbsp;<span class="op" id="3077251">[</span><span class="op" id="3077252">]</span><span class="builtintype" id="3077253">string</span><span class="op" id="3077259">{</span><span class="ident" id="3077260">value</span><span class="op" id="3077265">}</span><br>
<span class="lineno"></span><span class="op" id="3077267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3077270">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;value&nbsp;to&nbsp;key.&nbsp;It&nbsp;appends&nbsp;to&nbsp;any&nbsp;existing</span><br>
<span class="lineno">525</span><span class="comment" id="3077327">//&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3077358">func</span>&nbsp;<span class="op" id="3077363">(</span><span class="ident" id="3077364">v</span>&nbsp;<span class="ident" id="3077366">Values</span><span class="op" id="3077372">)</span>&nbsp;<span class="ident" id="3077374">Add</span><span class="op" id="3077377">(</span><span class="ident" id="3077378">key</span><span class="op" id="3077381">,</span>&nbsp;<span class="ident" id="3077383">value</span>&nbsp;<span class="builtintype" id="3077389">string</span><span class="op" id="3077395">)</span>&nbsp;<span class="op" id="3077397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077400">v</span><span class="op" id="3077401">[</span><span class="ident" id="3077402">key</span><span class="op" id="3077405">]</span>&nbsp;<span class="op" id="3077407">=</span>&nbsp;<span class="builtinfunc" id="3077409">append</span><span class="op" id="3077415">(</span><span class="ident" id="3077416">v</span><span class="op" id="3077417">[</span><span class="ident" id="3077418">key</span><span class="op" id="3077421">]</span><span class="op" id="3077422">,</span>&nbsp;<span class="ident" id="3077424">value</span><span class="op" id="3077429">)</span><br>
<span class="lineno"></span><span class="op" id="3077431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3077434">//&nbsp;Del&nbsp;deletes&nbsp;the&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3077481">func</span>&nbsp;<span class="op" id="3077486">(</span><span class="ident" id="3077487">v</span>&nbsp;<span class="ident" id="3077489">Values</span><span class="op" id="3077495">)</span>&nbsp;<span class="ident" id="3077497">Del</span><span class="op" id="3077500">(</span><span class="ident" id="3077501">key</span>&nbsp;<span class="builtintype" id="3077505">string</span><span class="op" id="3077511">)</span>&nbsp;<span class="op" id="3077513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3077516">delete</span><span class="op" id="3077522">(</span><span class="ident" id="3077523">v</span><span class="op" id="3077524">,</span>&nbsp;<span class="ident" id="3077526">key</span><span class="op" id="3077529">)</span><br>
<span class="lineno"></span><span class="op" id="3077531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3077534">//&nbsp;ParseQuery&nbsp;parses&nbsp;the&nbsp;URL-encoded&nbsp;query&nbsp;string&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3077596">//&nbsp;a&nbsp;map&nbsp;listing&nbsp;the&nbsp;values&nbsp;specified&nbsp;for&nbsp;each&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3077648">//&nbsp;ParseQuery&nbsp;always&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;map&nbsp;containing&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3077710">//&nbsp;valid&nbsp;query&nbsp;parameters&nbsp;found;&nbsp;err&nbsp;describes&nbsp;the&nbsp;first&nbsp;decoding&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3077782">//&nbsp;encountered,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">540</span><span class="keyword" id="3077806">func</span>&nbsp;<span class="ident" id="3077811">ParseQuery</span><span class="op" id="3077821">(</span><span class="ident" id="3077822">query</span>&nbsp;<span class="builtintype" id="3077828">string</span><span class="op" id="3077834">)</span>&nbsp;<span class="op" id="3077836">(</span><span class="ident" id="3077837">m</span>&nbsp;<span class="ident" id="3077839">Values</span><span class="op" id="3077845">,</span>&nbsp;<span class="ident" id="3077847">err</span>&nbsp;<span class="builtintype" id="3077851">error</span><span class="op" id="3077856">)</span>&nbsp;<span class="op" id="3077858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077861">m</span>&nbsp;<span class="op" id="3077863">=</span>&nbsp;<span class="builtinfunc" id="3077865">make</span><span class="op" id="3077869">(</span><span class="ident" id="3077870">Values</span><span class="op" id="3077876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077879">err</span>&nbsp;<span class="op" id="3077883">=</span>&nbsp;<span class="ident" id="3077885">parseQuery</span><span class="op" id="3077895">(</span><span class="ident" id="3077896">m</span><span class="op" id="3077897">,</span>&nbsp;<span class="ident" id="3077899">query</span><span class="op" id="3077904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077907">return</span><br>
<span class="lineno"></span><span class="op" id="3077914">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="keyword" id="3077917">func</span>&nbsp;<span class="ident" id="3077922">parseQuery</span><span class="op" id="3077932">(</span><span class="ident" id="3077933">m</span>&nbsp;<span class="ident" id="3077935">Values</span><span class="op" id="3077941">,</span>&nbsp;<span class="ident" id="3077943">query</span>&nbsp;<span class="builtintype" id="3077949">string</span><span class="op" id="3077955">)</span>&nbsp;<span class="op" id="3077957">(</span><span class="ident" id="3077958">err</span>&nbsp;<span class="builtintype" id="3077962">error</span><span class="op" id="3077967">)</span>&nbsp;<span class="op" id="3077969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077972">for</span>&nbsp;<span class="ident" id="3077976">query</span>&nbsp;<span class="op" id="3077982">!=</span>&nbsp;<span class="string" id="3077985">&#34;&#34;</span>&nbsp;<span class="op" id="3077988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077992">key</span>&nbsp;<span class="op" id="3077996">:=</span>&nbsp;<span class="ident" id="3077999">query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078007">if</span>&nbsp;<span class="ident" id="3078010">i</span>&nbsp;<span class="op" id="3078012">:=</span>&nbsp;<span class="ident" id="3078015">strings</span><span class="op" id="3078022">.</span><span class="ident" id="3078023">IndexAny</span><span class="op" id="3078031">(</span><span class="ident" id="3078032">key</span><span class="op" id="3078035">,</span>&nbsp;<span class="string" id="3078037">&#34;&amp;;&#34;</span><span class="op" id="3078041">)</span><span class="op" id="3078042">;</span>&nbsp;<span class="ident" id="3078044">i</span>&nbsp;<span class="op" id="3078046">&gt;=</span>&nbsp;<span class="num" id="3078049">0</span>&nbsp;<span class="op" id="3078051">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078056">key</span><span class="op" id="3078059">,</span>&nbsp;<span class="ident" id="3078061">query</span>&nbsp;<span class="op" id="3078067">=</span>&nbsp;<span class="ident" id="3078069">key</span><span class="op" id="3078072">[</span><span class="op" id="3078073">:</span><span class="ident" id="3078074">i</span><span class="op" id="3078075">]</span><span class="op" id="3078076">,</span>&nbsp;<span class="ident" id="3078078">key</span><span class="op" id="3078081">[</span><span class="ident" id="3078082">i</span><span class="op" id="3078083">+</span><span class="num" id="3078084">1</span><span class="op" id="3078085">:</span><span class="op" id="3078086">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078090">}</span>&nbsp;<span class="keyword" id="3078092">else</span>&nbsp;<span class="op" id="3078097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078102">query</span>&nbsp;<span class="op" id="3078108">=</span>&nbsp;<span class="string" id="3078110">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078119">if</span>&nbsp;<span class="ident" id="3078122">key</span>&nbsp;<span class="op" id="3078126">==</span>&nbsp;<span class="string" id="3078129">&#34;&#34;</span>&nbsp;<span class="op" id="3078132">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078137">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078152">value</span>&nbsp;<span class="op" id="3078158">:=</span>&nbsp;<span class="string" id="3078161">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078166">if</span>&nbsp;<span class="ident" id="3078169">i</span>&nbsp;<span class="op" id="3078171">:=</span>&nbsp;<span class="ident" id="3078174">strings</span><span class="op" id="3078181">.</span><span class="ident" id="3078182">Index</span><span class="op" id="3078187">(</span><span class="ident" id="3078188">key</span><span class="op" id="3078191">,</span>&nbsp;<span class="string" id="3078193">&#34;=&#34;</span><span class="op" id="3078196">)</span><span class="op" id="3078197">;</span>&nbsp;<span class="ident" id="3078199">i</span>&nbsp;<span class="op" id="3078201">&gt;=</span>&nbsp;<span class="num" id="3078204">0</span>&nbsp;<span class="op" id="3078206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078211">key</span><span class="op" id="3078214">,</span>&nbsp;<span class="ident" id="3078216">value</span>&nbsp;<span class="op" id="3078222">=</span>&nbsp;<span class="ident" id="3078224">key</span><span class="op" id="3078227">[</span><span class="op" id="3078228">:</span><span class="ident" id="3078229">i</span><span class="op" id="3078230">]</span><span class="op" id="3078231">,</span>&nbsp;<span class="ident" id="3078233">key</span><span class="op" id="3078236">[</span><span class="ident" id="3078237">i</span><span class="op" id="3078238">+</span><span class="num" id="3078239">1</span><span class="op" id="3078240">:</span><span class="op" id="3078241">]</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078249">key</span><span class="op" id="3078252">,</span>&nbsp;<span class="ident" id="3078254">err1</span>&nbsp;<span class="op" id="3078259">:=</span>&nbsp;<span class="ident" id="3078262">QueryUnescape</span><span class="op" id="3078275">(</span><span class="ident" id="3078276">key</span><span class="op" id="3078279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078283">if</span>&nbsp;<span class="ident" id="3078286">err1</span>&nbsp;<span class="op" id="3078291">!=</span>&nbsp;<span class="ident" id="3078294">nil</span>&nbsp;<span class="op" id="3078298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078303">if</span>&nbsp;<span class="ident" id="3078306">err</span>&nbsp;<span class="op" id="3078310">==</span>&nbsp;<span class="ident" id="3078313">nil</span>&nbsp;<span class="op" id="3078317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078323">err</span>&nbsp;<span class="op" id="3078327">=</span>&nbsp;<span class="ident" id="3078329">err1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078342">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078357">value</span><span class="op" id="3078362">,</span>&nbsp;<span class="ident" id="3078364">err1</span>&nbsp;<span class="op" id="3078369">=</span>&nbsp;<span class="ident" id="3078371">QueryUnescape</span><span class="op" id="3078384">(</span><span class="ident" id="3078385">value</span><span class="op" id="3078390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078394">if</span>&nbsp;<span class="ident" id="3078397">err1</span>&nbsp;<span class="op" id="3078402">!=</span>&nbsp;<span class="ident" id="3078405">nil</span>&nbsp;<span class="op" id="3078409">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078414">if</span>&nbsp;<span class="ident" id="3078417">err</span>&nbsp;<span class="op" id="3078421">==</span>&nbsp;<span class="ident" id="3078424">nil</span>&nbsp;<span class="op" id="3078428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078434">err</span>&nbsp;<span class="op" id="3078438">=</span>&nbsp;<span class="ident" id="3078440">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078453">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078464">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078468">m</span><span class="op" id="3078469">[</span><span class="ident" id="3078470">key</span><span class="op" id="3078473">]</span>&nbsp;<span class="op" id="3078475">=</span>&nbsp;<span class="builtinfunc" id="3078477">append</span><span class="op" id="3078483">(</span><span class="ident" id="3078484">m</span><span class="op" id="3078485">[</span><span class="ident" id="3078486">key</span><span class="op" id="3078489">]</span><span class="op" id="3078490">,</span>&nbsp;<span class="ident" id="3078492">value</span><span class="op" id="3078497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078503">return</span>&nbsp;<span class="ident" id="3078510">err</span><br>
<span class="lineno"></span><span class="op" id="3078514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3078517">//&nbsp;Encode&nbsp;encodes&nbsp;the&nbsp;values&nbsp;into&nbsp;``URL&nbsp;encoded&#39;&#39;&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3078572">//&nbsp;(&#34;bar=baz&amp;foo=quux&#34;)&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3078611">func</span>&nbsp;<span class="op" id="3078616">(</span><span class="ident" id="3078617">v</span>&nbsp;<span class="ident" id="3078619">Values</span><span class="op" id="3078625">)</span>&nbsp;<span class="ident" id="3078627">Encode</span><span class="op" id="3078633">(</span><span class="op" id="3078634">)</span>&nbsp;<span class="builtintype" id="3078636">string</span>&nbsp;<span class="op" id="3078643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078646">if</span>&nbsp;<span class="ident" id="3078649">v</span>&nbsp;<span class="op" id="3078651">==</span>&nbsp;<span class="ident" id="3078654">nil</span>&nbsp;<span class="op" id="3078658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078662">return</span>&nbsp;<span class="string" id="3078669">&#34;&#34;</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078676">var</span>&nbsp;<span class="ident" id="3078680">buf</span>&nbsp;<span class="ident" id="3078684">bytes</span><span class="op" id="3078689">.</span><span class="ident" id="3078690">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078698">keys</span>&nbsp;<span class="op" id="3078703">:=</span>&nbsp;<span class="builtinfunc" id="3078706">make</span><span class="op" id="3078710">(</span><span class="op" id="3078711">[</span><span class="op" id="3078712">]</span><span class="builtintype" id="3078713">string</span><span class="op" id="3078719">,</span>&nbsp;<span class="num" id="3078721">0</span><span class="op" id="3078722">,</span>&nbsp;<span class="builtinfunc" id="3078724">len</span><span class="op" id="3078727">(</span><span class="ident" id="3078728">v</span><span class="op" id="3078729">)</span><span class="op" id="3078730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078733">for</span>&nbsp;<span class="ident" id="3078737">k</span>&nbsp;<span class="op" id="3078739">:=</span>&nbsp;<span class="keyword" id="3078742">range</span>&nbsp;<span class="ident" id="3078748">v</span>&nbsp;<span class="op" id="3078750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078754">keys</span>&nbsp;<span class="op" id="3078759">=</span>&nbsp;<span class="builtinfunc" id="3078761">append</span><span class="op" id="3078767">(</span><span class="ident" id="3078768">keys</span><span class="op" id="3078772">,</span>&nbsp;<span class="ident" id="3078774">k</span><span class="op" id="3078775">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078781">sort</span><span class="op" id="3078785">.</span><span class="ident" id="3078786">Strings</span><span class="op" id="3078793">(</span><span class="ident" id="3078794">keys</span><span class="op" id="3078798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078801">for</span>&nbsp;<span class="ident" id="3078805">_</span><span class="op" id="3078806">,</span>&nbsp;<span class="ident" id="3078808">k</span>&nbsp;<span class="op" id="3078810">:=</span>&nbsp;<span class="keyword" id="3078813">range</span>&nbsp;<span class="ident" id="3078819">keys</span>&nbsp;<span class="op" id="3078824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078828">vs</span>&nbsp;<span class="op" id="3078831">:=</span>&nbsp;<span class="ident" id="3078834">v</span><span class="op" id="3078835">[</span><span class="ident" id="3078836">k</span><span class="op" id="3078837">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078841">prefix</span>&nbsp;<span class="op" id="3078848">:=</span>&nbsp;<span class="ident" id="3078851">QueryEscape</span><span class="op" id="3078862">(</span><span class="ident" id="3078863">k</span><span class="op" id="3078864">)</span>&nbsp;<span class="op" id="3078866">+</span>&nbsp;<span class="string" id="3078868">&#34;=&#34;</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078874">for</span>&nbsp;<span class="ident" id="3078878">_</span><span class="op" id="3078879">,</span>&nbsp;<span class="ident" id="3078881">v</span>&nbsp;<span class="op" id="3078883">:=</span>&nbsp;<span class="keyword" id="3078886">range</span>&nbsp;<span class="ident" id="3078892">vs</span>&nbsp;<span class="op" id="3078895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078900">if</span>&nbsp;<span class="ident" id="3078903">buf</span><span class="op" id="3078906">.</span><span class="ident" id="3078907">Len</span><span class="op" id="3078910">(</span><span class="op" id="3078911">)</span>&nbsp;<span class="op" id="3078913">&gt;</span>&nbsp;<span class="num" id="3078915">0</span>&nbsp;<span class="op" id="3078917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078923">buf</span><span class="op" id="3078926">.</span><span class="ident" id="3078927">WriteByte</span><span class="op" id="3078936">(</span><span class="string" id="3078937">&#39;&amp;&#39;</span><span class="op" id="3078940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078950">buf</span><span class="op" id="3078953">.</span><span class="ident" id="3078954">WriteString</span><span class="op" id="3078965">(</span><span class="ident" id="3078966">prefix</span><span class="op" id="3078972">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078977">buf</span><span class="op" id="3078980">.</span><span class="ident" id="3078981">WriteString</span><span class="op" id="3078992">(</span><span class="ident" id="3078993">QueryEscape</span><span class="op" id="3079004">(</span><span class="ident" id="3079005">v</span><span class="op" id="3079006">)</span><span class="op" id="3079007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079017">return</span>&nbsp;<span class="ident" id="3079024">buf</span><span class="op" id="3079027">.</span><span class="ident" id="3079028">String</span><span class="op" id="3079034">(</span><span class="op" id="3079035">)</span><br>
<span class="lineno"></span><span class="op" id="3079037">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="comment" id="3079040">//&nbsp;resolvePath&nbsp;applies&nbsp;special&nbsp;path&nbsp;segments&nbsp;from&nbsp;refs&nbsp;and&nbsp;applies</span><br>
<span class="lineno"></span><span class="comment" id="3079107">//&nbsp;them&nbsp;to&nbsp;base,&nbsp;per&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3079138">func</span>&nbsp;<span class="ident" id="3079143">resolvePath</span><span class="op" id="3079154">(</span><span class="ident" id="3079155">base</span><span class="op" id="3079159">,</span>&nbsp;<span class="ident" id="3079161">ref</span>&nbsp;<span class="builtintype" id="3079165">string</span><span class="op" id="3079171">)</span>&nbsp;<span class="builtintype" id="3079173">string</span>&nbsp;<span class="op" id="3079180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079183">var</span>&nbsp;<span class="ident" id="3079187">full</span>&nbsp;<span class="builtintype" id="3079192">string</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079200">if</span>&nbsp;<span class="ident" id="3079203">ref</span>&nbsp;<span class="op" id="3079207">==</span>&nbsp;<span class="string" id="3079210">&#34;&#34;</span>&nbsp;<span class="op" id="3079213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079217">full</span>&nbsp;<span class="op" id="3079222">=</span>&nbsp;<span class="ident" id="3079224">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079230">}</span>&nbsp;<span class="keyword" id="3079232">else</span>&nbsp;<span class="keyword" id="3079237">if</span>&nbsp;<span class="ident" id="3079240">ref</span><span class="op" id="3079243">[</span><span class="num" id="3079244">0</span><span class="op" id="3079245">]</span>&nbsp;<span class="op" id="3079247">!=</span>&nbsp;<span class="string" id="3079250">&#39;/&#39;</span>&nbsp;<span class="op" id="3079254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079258">i</span>&nbsp;<span class="op" id="3079260">:=</span>&nbsp;<span class="ident" id="3079263">strings</span><span class="op" id="3079270">.</span><span class="ident" id="3079271">LastIndex</span><span class="op" id="3079280">(</span><span class="ident" id="3079281">base</span><span class="op" id="3079285">,</span>&nbsp;<span class="string" id="3079287">&#34;/&#34;</span><span class="op" id="3079290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079294">full</span>&nbsp;<span class="op" id="3079299">=</span>&nbsp;<span class="ident" id="3079301">base</span><span class="op" id="3079305">[</span><span class="op" id="3079306">:</span><span class="ident" id="3079307">i</span><span class="op" id="3079308">+</span><span class="num" id="3079309">1</span><span class="op" id="3079310">]</span>&nbsp;<span class="op" id="3079312">+</span>&nbsp;<span class="ident" id="3079314">ref</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079319">}</span>&nbsp;<span class="keyword" id="3079321">else</span>&nbsp;<span class="op" id="3079326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079330">full</span>&nbsp;<span class="op" id="3079335">=</span>&nbsp;<span class="ident" id="3079337">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079345">if</span>&nbsp;<span class="ident" id="3079348">full</span>&nbsp;<span class="op" id="3079353">==</span>&nbsp;<span class="string" id="3079356">&#34;&#34;</span>&nbsp;<span class="op" id="3079359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079363">return</span>&nbsp;<span class="string" id="3079370">&#34;&#34;</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079377">var</span>&nbsp;<span class="ident" id="3079381">dst</span>&nbsp;<span class="op" id="3079385">[</span><span class="op" id="3079386">]</span><span class="builtintype" id="3079387">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079395">src</span>&nbsp;<span class="op" id="3079399">:=</span>&nbsp;<span class="ident" id="3079402">strings</span><span class="op" id="3079409">.</span><span class="ident" id="3079410">Split</span><span class="op" id="3079415">(</span><span class="ident" id="3079416">full</span><span class="op" id="3079420">,</span>&nbsp;<span class="string" id="3079422">&#34;/&#34;</span><span class="op" id="3079425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079428">for</span>&nbsp;<span class="ident" id="3079432">_</span><span class="op" id="3079433">,</span>&nbsp;<span class="ident" id="3079435">elem</span>&nbsp;<span class="op" id="3079440">:=</span>&nbsp;<span class="keyword" id="3079443">range</span>&nbsp;<span class="ident" id="3079449">src</span>&nbsp;<span class="op" id="3079453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079457">switch</span>&nbsp;<span class="ident" id="3079464">elem</span>&nbsp;<span class="op" id="3079469">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079473">case</span>&nbsp;<span class="string" id="3079478">&#34;.&#34;</span><span class="op" id="3079481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3079486">//&nbsp;drop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079496">case</span>&nbsp;<span class="string" id="3079501">&#34;..&#34;</span><span class="op" id="3079505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079510">if</span>&nbsp;<span class="builtinfunc" id="3079513">len</span><span class="op" id="3079516">(</span><span class="ident" id="3079517">dst</span><span class="op" id="3079520">)</span>&nbsp;<span class="op" id="3079522">&gt;</span>&nbsp;<span class="num" id="3079524">0</span>&nbsp;<span class="op" id="3079526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079532">dst</span>&nbsp;<span class="op" id="3079536">=</span>&nbsp;<span class="ident" id="3079538">dst</span><span class="op" id="3079541">[</span><span class="op" id="3079542">:</span><span class="builtinfunc" id="3079543">len</span><span class="op" id="3079546">(</span><span class="ident" id="3079547">dst</span><span class="op" id="3079550">)</span><span class="op" id="3079551">-</span><span class="num" id="3079552">1</span><span class="op" id="3079553">]</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079562">default</span><span class="op" id="3079569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079574">dst</span>&nbsp;<span class="op" id="3079578">=</span>&nbsp;<span class="builtinfunc" id="3079580">append</span><span class="op" id="3079586">(</span><span class="ident" id="3079587">dst</span><span class="op" id="3079590">,</span>&nbsp;<span class="ident" id="3079592">elem</span><span class="op" id="3079596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079603">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079606">if</span>&nbsp;<span class="ident" id="3079609">last</span>&nbsp;<span class="op" id="3079614">:=</span>&nbsp;<span class="ident" id="3079617">src</span><span class="op" id="3079620">[</span><span class="builtinfunc" id="3079621">len</span><span class="op" id="3079624">(</span><span class="ident" id="3079625">src</span><span class="op" id="3079628">)</span><span class="op" id="3079629">-</span><span class="num" id="3079630">1</span><span class="op" id="3079631">]</span><span class="op" id="3079632">;</span>&nbsp;<span class="ident" id="3079634">last</span>&nbsp;<span class="op" id="3079639">==</span>&nbsp;<span class="string" id="3079642">&#34;.&#34;</span>&nbsp;<span class="op" id="3079646">||</span>&nbsp;<span class="ident" id="3079649">last</span>&nbsp;<span class="op" id="3079654">==</span>&nbsp;<span class="string" id="3079657">&#34;..&#34;</span>&nbsp;<span class="op" id="3079662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3079666">//&nbsp;Add&nbsp;final&nbsp;slash&nbsp;to&nbsp;the&nbsp;joined&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079707">dst</span>&nbsp;<span class="op" id="3079711">=</span>&nbsp;<span class="builtinfunc" id="3079713">append</span><span class="op" id="3079719">(</span><span class="ident" id="3079720">dst</span><span class="op" id="3079723">,</span>&nbsp;<span class="string" id="3079725">&#34;&#34;</span><span class="op" id="3079727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079733">return</span>&nbsp;<span class="string" id="3079740">&#34;/&#34;</span>&nbsp;<span class="op" id="3079744">+</span>&nbsp;<span class="ident" id="3079746">strings</span><span class="op" id="3079753">.</span><span class="ident" id="3079754">TrimLeft</span><span class="op" id="3079762">(</span><span class="ident" id="3079763">strings</span><span class="op" id="3079770">.</span><span class="ident" id="3079771">Join</span><span class="op" id="3079775">(</span><span class="ident" id="3079776">dst</span><span class="op" id="3079779">,</span>&nbsp;<span class="string" id="3079781">&#34;/&#34;</span><span class="op" id="3079784">)</span><span class="op" id="3079785">,</span>&nbsp;<span class="string" id="3079787">&#34;/&#34;</span><span class="op" id="3079790">)</span><br>
<span class="lineno">640</span><span class="op" id="3079792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3079795">//&nbsp;IsAbs&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;URL&nbsp;is&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3079841">func</span>&nbsp;<span class="op" id="3079846">(</span><span class="ident" id="3079847">u</span>&nbsp;<span class="op" id="3079849">*</span><span class="ident" id="3079850">URL</span><span class="op" id="3079853">)</span>&nbsp;<span class="ident" id="3079855">IsAbs</span><span class="op" id="3079860">(</span><span class="op" id="3079861">)</span>&nbsp;<span class="builtintype" id="3079863">bool</span>&nbsp;<span class="op" id="3079868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079871">return</span>&nbsp;<span class="ident" id="3079878">u</span><span class="op" id="3079879">.</span><span class="ident" id="3079880">Scheme</span>&nbsp;<span class="op" id="3079887">!=</span>&nbsp;<span class="string" id="3079890">&#34;&#34;</span><br>
<span class="lineno">645</span><span class="op" id="3079893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3079896">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;receiver.&nbsp;&nbsp;The&nbsp;provided&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3079968">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;Parse&nbsp;returns&nbsp;nil,&nbsp;err&nbsp;on&nbsp;parse</span><br>
<span class="lineno"></span><span class="comment" id="3080033">//&nbsp;failure,&nbsp;otherwise&nbsp;its&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;ResolveReference.</span><br>
<span class="lineno">650</span><span class="keyword" id="3080105">func</span>&nbsp;<span class="op" id="3080110">(</span><span class="ident" id="3080111">u</span>&nbsp;<span class="op" id="3080113">*</span><span class="ident" id="3080114">URL</span><span class="op" id="3080117">)</span>&nbsp;<span class="ident" id="3080119">Parse</span><span class="op" id="3080124">(</span><span class="ident" id="3080125">ref</span>&nbsp;<span class="builtintype" id="3080129">string</span><span class="op" id="3080135">)</span>&nbsp;<span class="op" id="3080137">(</span><span class="op" id="3080138">*</span><span class="ident" id="3080139">URL</span><span class="op" id="3080142">,</span>&nbsp;<span class="builtintype" id="3080144">error</span><span class="op" id="3080149">)</span>&nbsp;<span class="op" id="3080151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080154">refurl</span><span class="op" id="3080160">,</span>&nbsp;<span class="ident" id="3080162">err</span>&nbsp;<span class="op" id="3080166">:=</span>&nbsp;<span class="ident" id="3080169">Parse</span><span class="op" id="3080174">(</span><span class="ident" id="3080175">ref</span><span class="op" id="3080178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080181">if</span>&nbsp;<span class="ident" id="3080184">err</span>&nbsp;<span class="op" id="3080188">!=</span>&nbsp;<span class="ident" id="3080191">nil</span>&nbsp;<span class="op" id="3080195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080199">return</span>&nbsp;<span class="ident" id="3080206">nil</span><span class="op" id="3080209">,</span>&nbsp;<span class="ident" id="3080211">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3080216">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080219">return</span>&nbsp;<span class="ident" id="3080226">u</span><span class="op" id="3080227">.</span><span class="ident" id="3080228">ResolveReference</span><span class="op" id="3080244">(</span><span class="ident" id="3080245">refurl</span><span class="op" id="3080251">)</span><span class="op" id="3080252">,</span>&nbsp;<span class="ident" id="3080254">nil</span><br>
<span class="lineno"></span><span class="op" id="3080258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3080261">//&nbsp;ResolveReference&nbsp;resolves&nbsp;a&nbsp;URI&nbsp;reference&nbsp;to&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3080330">//&nbsp;an&nbsp;absolute&nbsp;base&nbsp;URI,&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;Section&nbsp;5.2.&nbsp;&nbsp;The&nbsp;URI&nbsp;reference</span><br>
<span class="lineno">660</span><span class="comment" id="3080400">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;ResolveReference&nbsp;always&nbsp;returns&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3080471">//&nbsp;URL&nbsp;instance,&nbsp;even&nbsp;if&nbsp;the&nbsp;returned&nbsp;URL&nbsp;is&nbsp;identical&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3080540">//&nbsp;base&nbsp;or&nbsp;reference.&nbsp;If&nbsp;ref&nbsp;is&nbsp;an&nbsp;absolute&nbsp;URL,&nbsp;then&nbsp;ResolveReference</span><br>
<span class="lineno"></span><span class="comment" id="3080611">//&nbsp;ignores&nbsp;base&nbsp;and&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;ref.</span><br>
<span class="lineno"></span><span class="keyword" id="3080654">func</span>&nbsp;<span class="op" id="3080659">(</span><span class="ident" id="3080660">u</span>&nbsp;<span class="op" id="3080662">*</span><span class="ident" id="3080663">URL</span><span class="op" id="3080666">)</span>&nbsp;<span class="ident" id="3080668">ResolveReference</span><span class="op" id="3080684">(</span><span class="ident" id="3080685">ref</span>&nbsp;<span class="op" id="3080689">*</span><span class="ident" id="3080690">URL</span><span class="op" id="3080693">)</span>&nbsp;<span class="op" id="3080695">*</span><span class="ident" id="3080696">URL</span>&nbsp;<span class="op" id="3080700">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080703">url</span>&nbsp;<span class="op" id="3080707">:=</span>&nbsp;<span class="op" id="3080710">*</span><span class="ident" id="3080711">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080716">if</span>&nbsp;<span class="ident" id="3080719">ref</span><span class="op" id="3080722">.</span><span class="ident" id="3080723">Scheme</span>&nbsp;<span class="op" id="3080730">==</span>&nbsp;<span class="string" id="3080733">&#34;&#34;</span>&nbsp;<span class="op" id="3080736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080740">url</span><span class="op" id="3080743">.</span><span class="ident" id="3080744">Scheme</span>&nbsp;<span class="op" id="3080751">=</span>&nbsp;<span class="ident" id="3080753">u</span><span class="op" id="3080754">.</span><span class="ident" id="3080755">Scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3080763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080766">if</span>&nbsp;<span class="ident" id="3080769">ref</span><span class="op" id="3080772">.</span><span class="ident" id="3080773">Scheme</span>&nbsp;<span class="op" id="3080780">!=</span>&nbsp;<span class="string" id="3080783">&#34;&#34;</span>&nbsp;<span class="op" id="3080786">||</span>&nbsp;<span class="ident" id="3080789">ref</span><span class="op" id="3080792">.</span><span class="ident" id="3080793">Host</span>&nbsp;<span class="op" id="3080798">!=</span>&nbsp;<span class="string" id="3080801">&#34;&#34;</span>&nbsp;<span class="op" id="3080804">||</span>&nbsp;<span class="ident" id="3080807">ref</span><span class="op" id="3080810">.</span><span class="ident" id="3080811">User</span>&nbsp;<span class="op" id="3080816">!=</span>&nbsp;<span class="ident" id="3080819">nil</span>&nbsp;<span class="op" id="3080823">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3080827">//&nbsp;The&nbsp;&#34;absoluteURI&#34;&nbsp;or&nbsp;&#34;net_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080871">url</span><span class="op" id="3080874">.</span><span class="ident" id="3080875">Path</span>&nbsp;<span class="op" id="3080880">=</span>&nbsp;<span class="ident" id="3080882">resolvePath</span><span class="op" id="3080893">(</span><span class="ident" id="3080894">ref</span><span class="op" id="3080897">.</span><span class="ident" id="3080898">Path</span><span class="op" id="3080902">,</span>&nbsp;<span class="string" id="3080904">&#34;&#34;</span><span class="op" id="3080906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080910">return</span>&nbsp;<span class="op" id="3080917">&amp;</span><span class="ident" id="3080918">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3080923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080926">if</span>&nbsp;<span class="ident" id="3080929">ref</span><span class="op" id="3080932">.</span><span class="ident" id="3080933">Opaque</span>&nbsp;<span class="op" id="3080940">!=</span>&nbsp;<span class="string" id="3080943">&#34;&#34;</span>&nbsp;<span class="op" id="3080946">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080950">url</span><span class="op" id="3080953">.</span><span class="ident" id="3080954">User</span>&nbsp;<span class="op" id="3080959">=</span>&nbsp;<span class="ident" id="3080961">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080967">url</span><span class="op" id="3080970">.</span><span class="ident" id="3080971">Host</span>&nbsp;<span class="op" id="3080976">=</span>&nbsp;<span class="string" id="3080978">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080983">url</span><span class="op" id="3080986">.</span><span class="ident" id="3080987">Path</span>&nbsp;<span class="op" id="3080992">=</span>&nbsp;<span class="string" id="3080994">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080999">return</span>&nbsp;<span class="op" id="3081006">&amp;</span><span class="ident" id="3081007">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081012">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081015">if</span>&nbsp;<span class="ident" id="3081018">ref</span><span class="op" id="3081021">.</span><span class="ident" id="3081022">Path</span>&nbsp;<span class="op" id="3081027">==</span>&nbsp;<span class="string" id="3081030">&#34;&#34;</span>&nbsp;<span class="op" id="3081033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081037">if</span>&nbsp;<span class="ident" id="3081040">ref</span><span class="op" id="3081043">.</span><span class="ident" id="3081044">RawQuery</span>&nbsp;<span class="op" id="3081053">==</span>&nbsp;<span class="string" id="3081056">&#34;&#34;</span>&nbsp;<span class="op" id="3081059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081064">url</span><span class="op" id="3081067">.</span><span class="ident" id="3081068">RawQuery</span>&nbsp;<span class="op" id="3081077">=</span>&nbsp;<span class="ident" id="3081079">u</span><span class="op" id="3081080">.</span><span class="ident" id="3081081">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081093">if</span>&nbsp;<span class="ident" id="3081096">ref</span><span class="op" id="3081099">.</span><span class="ident" id="3081100">Fragment</span>&nbsp;<span class="op" id="3081109">==</span>&nbsp;<span class="string" id="3081112">&#34;&#34;</span>&nbsp;<span class="op" id="3081115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081121">url</span><span class="op" id="3081124">.</span><span class="ident" id="3081125">Fragment</span>&nbsp;<span class="op" id="3081134">=</span>&nbsp;<span class="ident" id="3081136">u</span><span class="op" id="3081137">.</span><span class="ident" id="3081138">Fragment</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3081160">//&nbsp;The&nbsp;&#34;abs_path&#34;&nbsp;or&nbsp;&#34;rel_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081200">url</span><span class="op" id="3081203">.</span><span class="ident" id="3081204">Host</span>&nbsp;<span class="op" id="3081209">=</span>&nbsp;<span class="ident" id="3081211">u</span><span class="op" id="3081212">.</span><span class="ident" id="3081213">Host</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081219">url</span><span class="op" id="3081222">.</span><span class="ident" id="3081223">User</span>&nbsp;<span class="op" id="3081228">=</span>&nbsp;<span class="ident" id="3081230">u</span><span class="op" id="3081231">.</span><span class="ident" id="3081232">User</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081238">url</span><span class="op" id="3081241">.</span><span class="ident" id="3081242">Path</span>&nbsp;<span class="op" id="3081247">=</span>&nbsp;<span class="ident" id="3081249">resolvePath</span><span class="op" id="3081260">(</span><span class="ident" id="3081261">u</span><span class="op" id="3081262">.</span><span class="ident" id="3081263">Path</span><span class="op" id="3081267">,</span>&nbsp;<span class="ident" id="3081269">ref</span><span class="op" id="3081272">.</span><span class="ident" id="3081273">Path</span><span class="op" id="3081277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081280">return</span>&nbsp;<span class="op" id="3081287">&amp;</span><span class="ident" id="3081288">url</span><br>
<span class="lineno"></span><span class="op" id="3081292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3081295">//&nbsp;Query&nbsp;parses&nbsp;RawQuery&nbsp;and&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3081358">func</span>&nbsp;<span class="op" id="3081363">(</span><span class="ident" id="3081364">u</span>&nbsp;<span class="op" id="3081366">*</span><span class="ident" id="3081367">URL</span><span class="op" id="3081370">)</span>&nbsp;<span class="ident" id="3081372">Query</span><span class="op" id="3081377">(</span><span class="op" id="3081378">)</span>&nbsp;<span class="ident" id="3081380">Values</span>&nbsp;<span class="op" id="3081387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081390">v</span><span class="op" id="3081391">,</span>&nbsp;<span class="ident" id="3081393">_</span>&nbsp;<span class="op" id="3081395">:=</span>&nbsp;<span class="ident" id="3081398">ParseQuery</span><span class="op" id="3081408">(</span><span class="ident" id="3081409">u</span><span class="op" id="3081410">.</span><span class="ident" id="3081411">RawQuery</span><span class="op" id="3081419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081422">return</span>&nbsp;<span class="ident" id="3081429">v</span><br>
<span class="lineno"></span><span class="op" id="3081431">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="comment" id="3081434">//&nbsp;RequestURI&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;path?query&nbsp;or&nbsp;opaque?query</span><br>
<span class="lineno"></span><span class="comment" id="3081495">//&nbsp;string&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;for&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword" id="3081550">func</span>&nbsp;<span class="op" id="3081555">(</span><span class="ident" id="3081556">u</span>&nbsp;<span class="op" id="3081558">*</span><span class="ident" id="3081559">URL</span><span class="op" id="3081562">)</span>&nbsp;<span class="ident" id="3081564">RequestURI</span><span class="op" id="3081574">(</span><span class="op" id="3081575">)</span>&nbsp;<span class="builtintype" id="3081577">string</span>&nbsp;<span class="op" id="3081584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081587">result</span>&nbsp;<span class="op" id="3081594">:=</span>&nbsp;<span class="ident" id="3081597">u</span><span class="op" id="3081598">.</span><span class="ident" id="3081599">Opaque</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081607">if</span>&nbsp;<span class="ident" id="3081610">result</span>&nbsp;<span class="op" id="3081617">==</span>&nbsp;<span class="string" id="3081620">&#34;&#34;</span>&nbsp;<span class="op" id="3081623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081627">result</span>&nbsp;<span class="op" id="3081634">=</span>&nbsp;<span class="ident" id="3081636">escape</span><span class="op" id="3081642">(</span><span class="ident" id="3081643">u</span><span class="op" id="3081644">.</span><span class="ident" id="3081645">Path</span><span class="op" id="3081649">,</span>&nbsp;<span class="ident" id="3081651">encodePath</span><span class="op" id="3081661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081665">if</span>&nbsp;<span class="ident" id="3081668">result</span>&nbsp;<span class="op" id="3081675">==</span>&nbsp;<span class="string" id="3081678">&#34;&#34;</span>&nbsp;<span class="op" id="3081681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081686">result</span>&nbsp;<span class="op" id="3081693">=</span>&nbsp;<span class="string" id="3081695">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081701">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081704">}</span>&nbsp;<span class="keyword" id="3081706">else</span>&nbsp;<span class="op" id="3081711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081715">if</span>&nbsp;<span class="ident" id="3081718">strings</span><span class="op" id="3081725">.</span><span class="ident" id="3081726">HasPrefix</span><span class="op" id="3081735">(</span><span class="ident" id="3081736">result</span><span class="op" id="3081742">,</span>&nbsp;<span class="string" id="3081744">&#34;//&#34;</span><span class="op" id="3081748">)</span>&nbsp;<span class="op" id="3081750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081755">result</span>&nbsp;<span class="op" id="3081762">=</span>&nbsp;<span class="ident" id="3081764">u</span><span class="op" id="3081765">.</span><span class="ident" id="3081766">Scheme</span>&nbsp;<span class="op" id="3081773">+</span>&nbsp;<span class="string" id="3081775">&#34;:&#34;</span>&nbsp;<span class="op" id="3081779">+</span>&nbsp;<span class="ident" id="3081781">result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081793">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081796">if</span>&nbsp;<span class="ident" id="3081799">u</span><span class="op" id="3081800">.</span><span class="ident" id="3081801">RawQuery</span>&nbsp;<span class="op" id="3081810">!=</span>&nbsp;<span class="string" id="3081813">&#34;&#34;</span>&nbsp;<span class="op" id="3081816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081820">result</span>&nbsp;<span class="op" id="3081827">+=</span>&nbsp;<span class="string" id="3081830">&#34;?&#34;</span>&nbsp;<span class="op" id="3081834">+</span>&nbsp;<span class="ident" id="3081836">u</span><span class="op" id="3081837">.</span><span class="ident" id="3081838">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081851">return</span>&nbsp;<span class="ident" id="3081858">result</span><br>
<span class="lineno"></span><span class="op" id="3081865">}</span>
</div>
</body>
</html>
