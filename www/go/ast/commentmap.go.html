<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5123150">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5123205">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5123259">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5123310">package</span>&nbsp;<span class="ident" id="5123318">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5123323">import</span>&nbsp;<span class="op" id="5123330">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5123333">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5123342">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5123349">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5123361">&#34;sort&#34;</span><br>
<span class="lineno"></span><span class="op" id="5123368">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5123371">type</span>&nbsp;<span class="ident" id="5123376">byPos</span>&nbsp;<span class="op" id="5123382">[</span><span class="op" id="5123383">]</span><span class="op" id="5123384">*</span><span class="ident" id="5123385"><a href="/go/ast/ast.go.html#5094179">CommentGroup</a></span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="5123399">func</span>&nbsp;<span class="op" id="5123404">(</span><span class="ident" id="5123405">a</span>&nbsp;<span class="ident" id="5123407"><a href="/go/ast/commentmap.go.html#5123376">byPos</a></span><span class="op" id="5123412">)</span>&nbsp;<span class="ident" id="5123414">Len</span><span class="op" id="5123417">(</span><span class="op" id="5123418">)</span>&nbsp;<span class="builtintype" id="5123420">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5123434">{</span>&nbsp;<span class="keyword" id="5123436">return</span>&nbsp;<span class="builtinfunc" id="5123443">len</span><span class="op" id="5123446">(</span><span class="ident" id="5123447"><a href="/go/ast/commentmap.go.html#5123405">a</a></span><span class="op" id="5123448">)</span>&nbsp;<span class="op" id="5123450">}</span><br>
<span class="lineno"></span><span class="keyword" id="5123452">func</span>&nbsp;<span class="op" id="5123457">(</span><span class="ident" id="5123458">a</span>&nbsp;<span class="ident" id="5123460"><a href="/go/ast/commentmap.go.html#5123376">byPos</a></span><span class="op" id="5123465">)</span>&nbsp;<span class="ident" id="5123467">Less</span><span class="op" id="5123471">(</span><span class="ident" id="5123472">i</span><span class="op" id="5123473">,</span>&nbsp;<span class="ident" id="5123475">j</span>&nbsp;<span class="builtintype" id="5123477">int</span><span class="op" id="5123480">)</span>&nbsp;<span class="builtintype" id="5123482">bool</span>&nbsp;<span class="op" id="5123487">{</span>&nbsp;<span class="keyword" id="5123489">return</span>&nbsp;<span class="ident" id="5123496"><a href="/go/ast/commentmap.go.html#5123458">a</a></span><span class="op" id="5123497">[</span><span class="ident" id="5123498"><a href="/go/ast/commentmap.go.html#5123472">i</a></span><span class="op" id="5123499">]</span><span class="op" id="5123500">.</span><span class="ident" id="5123501">Pos</span><span class="op" id="5123504">(</span><span class="op" id="5123505">)</span>&nbsp;<span class="op" id="5123507">&lt;</span>&nbsp;<span class="ident" id="5123509"><a href="/go/ast/commentmap.go.html#5123458">a</a></span><span class="op" id="5123510">[</span><span class="ident" id="5123511"><a href="/go/ast/commentmap.go.html#5123475">j</a></span><span class="op" id="5123512">]</span><span class="op" id="5123513">.</span><span class="ident" id="5123514">Pos</span><span class="op" id="5123517">(</span><span class="op" id="5123518">)</span>&nbsp;<span class="op" id="5123520">}</span><br>
<span class="lineno"></span><span class="keyword" id="5123522">func</span>&nbsp;<span class="op" id="5123527">(</span><span class="ident" id="5123528">a</span>&nbsp;<span class="ident" id="5123530"><a href="/go/ast/commentmap.go.html#5123376">byPos</a></span><span class="op" id="5123535">)</span>&nbsp;<span class="ident" id="5123537">Swap</span><span class="op" id="5123541">(</span><span class="ident" id="5123542">i</span><span class="op" id="5123543">,</span>&nbsp;<span class="ident" id="5123545">j</span>&nbsp;<span class="builtintype" id="5123547">int</span><span class="op" id="5123550">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5123557">{</span>&nbsp;<span class="ident" id="5123559"><a href="/go/ast/commentmap.go.html#5123528">a</a></span><span class="op" id="5123560">[</span><span class="ident" id="5123561"><a href="/go/ast/commentmap.go.html#5123542">i</a></span><span class="op" id="5123562">]</span><span class="op" id="5123563">,</span>&nbsp;<span class="ident" id="5123565"><a href="/go/ast/commentmap.go.html#5123528">a</a></span><span class="op" id="5123566">[</span><span class="ident" id="5123567"><a href="/go/ast/commentmap.go.html#5123545">j</a></span><span class="op" id="5123568">]</span>&nbsp;<span class="op" id="5123570">=</span>&nbsp;<span class="ident" id="5123572"><a href="/go/ast/commentmap.go.html#5123528">a</a></span><span class="op" id="5123573">[</span><span class="ident" id="5123574"><a href="/go/ast/commentmap.go.html#5123545">j</a></span><span class="op" id="5123575">]</span><span class="op" id="5123576">,</span>&nbsp;<span class="ident" id="5123578"><a href="/go/ast/commentmap.go.html#5123528">a</a></span><span class="op" id="5123579">[</span><span class="ident" id="5123580"><a href="/go/ast/commentmap.go.html#5123542">i</a></span><span class="op" id="5123581">]</span>&nbsp;<span class="op" id="5123583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5123586">//&nbsp;sortComments&nbsp;sorts&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="5123652">//</span><br>
<span class="lineno"></span><span class="keyword" id="5123655">func</span>&nbsp;<span class="ident" id="5123660">sortComments</span><span class="op" id="5123672">(</span><span class="ident" id="5123673">list</span>&nbsp;<span class="op" id="5123678">[</span><span class="op" id="5123679">]</span><span class="op" id="5123680">*</span><span class="ident" id="5123681"><a href="/go/ast/ast.go.html#5094179">CommentGroup</a></span><span class="op" id="5123693">)</span>&nbsp;<span class="op" id="5123695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123698">//&nbsp;TODO(gri):&nbsp;Does&nbsp;it&nbsp;make&nbsp;sense&nbsp;to&nbsp;check&nbsp;for&nbsp;sorted-ness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123757">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first&nbsp;(because&nbsp;we&nbsp;know&nbsp;that&nbsp;sorted-ness&nbsp;is</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5123815">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;very&nbsp;likely)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5123844">if</span>&nbsp;<span class="ident" id="5123847">orderedList</span>&nbsp;<span class="op" id="5123859">:=</span>&nbsp;<span class="ident" id="5123862"><a href="/go/ast/commentmap.go.html#5123376">byPos</a></span><span class="op" id="5123867">(</span><span class="ident" id="5123868"><a href="/go/ast/commentmap.go.html#5123673">list</a></span><span class="op" id="5123872">)</span><span class="op" id="5123873">;</span>&nbsp;<span class="op" id="5123875">!</span><span class="ident" id="5123876"><a href="/go/ast/commentmap.go.html#5123361">sort</a></span><span class="op" id="5123880">.</span><span class="ident" id="5123881">IsSorted</span><span class="op" id="5123889">(</span><span class="ident" id="5123890"><a href="/go/ast/commentmap.go.html#5123847">orderedList</a></span><span class="op" id="5123901">)</span>&nbsp;<span class="op" id="5123903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5123907"><a href="/go/ast/commentmap.go.html#5123361">sort</a></span><span class="op" id="5123911">.</span><span class="ident" id="5123912">Sort</span><span class="op" id="5123916">(</span><span class="ident" id="5123917"><a href="/go/ast/commentmap.go.html#5123847">orderedList</a></span><span class="op" id="5123928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5123931">}</span><br>
<span class="lineno"></span><span class="op" id="5123933">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5123936">//&nbsp;A&nbsp;CommentMap&nbsp;maps&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="5123997">//&nbsp;associated&nbsp;with&nbsp;it.&nbsp;See&nbsp;NewCommentMap&nbsp;for&nbsp;a&nbsp;description&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5124059">//&nbsp;the&nbsp;association.</span><br>
<span class="lineno"></span><span class="comment" id="5124079">//</span><br>
<span class="lineno">35</span><span class="keyword" id="5124082">type</span>&nbsp;<span class="ident" id="5124087">CommentMap</span>&nbsp;<span class="keyword" id="5124098">map</span><span class="op" id="5124101">[</span><span class="ident" id="5124102"><a href="/go/ast/ast.go.html#5093159">Node</a></span><span class="op" id="5124106">]</span><span class="op" id="5124107">[</span><span class="op" id="5124108">]</span><span class="op" id="5124109">*</span><span class="ident" id="5124110"><a href="/go/ast/ast.go.html#5094179">CommentGroup</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5124124">func</span>&nbsp;<span class="op" id="5124129">(</span><span class="ident" id="5124130">cmap</span>&nbsp;<span class="ident" id="5124135"><a href="/go/ast/commentmap.go.html#5124087">CommentMap</a></span><span class="op" id="5124145">)</span>&nbsp;<span class="ident" id="5124147">addComment</span><span class="op" id="5124157">(</span><span class="ident" id="5124158">n</span>&nbsp;<span class="ident" id="5124160"><a href="/go/ast/ast.go.html#5093159">Node</a></span><span class="op" id="5124164">,</span>&nbsp;<span class="ident" id="5124166">c</span>&nbsp;<span class="op" id="5124168">*</span><span class="ident" id="5124169"><a href="/go/ast/ast.go.html#5094179">CommentGroup</a></span><span class="op" id="5124181">)</span>&nbsp;<span class="op" id="5124183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124186">list</span>&nbsp;<span class="op" id="5124191">:=</span>&nbsp;<span class="ident" id="5124194"><a href="/go/ast/commentmap.go.html#5124130">cmap</a></span><span class="op" id="5124198">[</span><span class="ident" id="5124199"><a href="/go/ast/commentmap.go.html#5124158">n</a></span><span class="op" id="5124200">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124203">if</span>&nbsp;<span class="builtinfunc" id="5124206">len</span><span class="op" id="5124209">(</span><span class="ident" id="5124210"><a href="/go/ast/commentmap.go.html#5124186">list</a></span><span class="op" id="5124214">)</span>&nbsp;<span class="op" id="5124216">==</span>&nbsp;<span class="num" id="5124219">0</span>&nbsp;<span class="op" id="5124221">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124225"><a href="/go/ast/commentmap.go.html#5124186">list</a></span>&nbsp;<span class="op" id="5124230">=</span>&nbsp;<span class="op" id="5124232">[</span><span class="op" id="5124233">]</span><span class="op" id="5124234">*</span><span class="ident" id="5124235"><a href="/go/ast/ast.go.html#5094179">CommentGroup</a></span><span class="op" id="5124247">{</span><span class="ident" id="5124248"><a href="/go/ast/commentmap.go.html#5124166">c</a></span><span class="op" id="5124249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124252">}</span>&nbsp;<span class="keyword" id="5124254">else</span>&nbsp;<span class="op" id="5124259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124263"><a href="/go/ast/commentmap.go.html#5124186">list</a></span>&nbsp;<span class="op" id="5124268">=</span>&nbsp;<span class="builtinfunc" id="5124270">append</span><span class="op" id="5124276">(</span><span class="ident" id="5124277"><a href="/go/ast/commentmap.go.html#5124186">list</a></span><span class="op" id="5124281">,</span>&nbsp;<span class="ident" id="5124283"><a href="/go/ast/commentmap.go.html#5124166">c</a></span><span class="op" id="5124284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124290"><a href="/go/ast/commentmap.go.html#5124130">cmap</a></span><span class="op" id="5124294">[</span><span class="ident" id="5124295"><a href="/go/ast/commentmap.go.html#5124158">n</a></span><span class="op" id="5124296">]</span>&nbsp;<span class="op" id="5124298">=</span>&nbsp;<span class="ident" id="5124300"><a href="/go/ast/commentmap.go.html#5124186">list</a></span><br>
<span class="lineno">45</span><span class="op" id="5124305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5124308">type</span>&nbsp;<span class="ident" id="5124313">byInterval</span>&nbsp;<span class="op" id="5124324">[</span><span class="op" id="5124325">]</span><span class="ident" id="5124326"><a href="/go/ast/ast.go.html#5093159">Node</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5124332">func</span>&nbsp;<span class="op" id="5124337">(</span><span class="ident" id="5124338">a</span>&nbsp;<span class="ident" id="5124340"><a href="/go/ast/commentmap.go.html#5124313">byInterval</a></span><span class="op" id="5124350">)</span>&nbsp;<span class="ident" id="5124352">Len</span><span class="op" id="5124355">(</span><span class="op" id="5124356">)</span>&nbsp;<span class="builtintype" id="5124358">int</span>&nbsp;<span class="op" id="5124362">{</span>&nbsp;<span class="keyword" id="5124364">return</span>&nbsp;<span class="builtinfunc" id="5124371">len</span><span class="op" id="5124374">(</span><span class="ident" id="5124375"><a href="/go/ast/commentmap.go.html#5124338">a</a></span><span class="op" id="5124376">)</span>&nbsp;<span class="op" id="5124378">}</span><br>
<span class="lineno">50</span><span class="keyword" id="5124380">func</span>&nbsp;<span class="op" id="5124385">(</span><span class="ident" id="5124386">a</span>&nbsp;<span class="ident" id="5124388"><a href="/go/ast/commentmap.go.html#5124313">byInterval</a></span><span class="op" id="5124398">)</span>&nbsp;<span class="ident" id="5124400">Less</span><span class="op" id="5124404">(</span><span class="ident" id="5124405">i</span><span class="op" id="5124406">,</span>&nbsp;<span class="ident" id="5124408">j</span>&nbsp;<span class="builtintype" id="5124410">int</span><span class="op" id="5124413">)</span>&nbsp;<span class="builtintype" id="5124415">bool</span>&nbsp;<span class="op" id="5124420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124423">pi</span><span class="op" id="5124425">,</span>&nbsp;<span class="ident" id="5124427">pj</span>&nbsp;<span class="op" id="5124430">:=</span>&nbsp;<span class="ident" id="5124433"><a href="/go/ast/commentmap.go.html#5124386">a</a></span><span class="op" id="5124434">[</span><span class="ident" id="5124435"><a href="/go/ast/commentmap.go.html#5124405">i</a></span><span class="op" id="5124436">]</span><span class="op" id="5124437">.</span><span class="ident" id="5124438">Pos</span><span class="op" id="5124441">(</span><span class="op" id="5124442">)</span><span class="op" id="5124443">,</span>&nbsp;<span class="ident" id="5124445"><a href="/go/ast/commentmap.go.html#5124386">a</a></span><span class="op" id="5124446">[</span><span class="ident" id="5124447"><a href="/go/ast/commentmap.go.html#5124408">j</a></span><span class="op" id="5124448">]</span><span class="op" id="5124449">.</span><span class="ident" id="5124450">Pos</span><span class="op" id="5124453">(</span><span class="op" id="5124454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124457">return</span>&nbsp;<span class="ident" id="5124464"><a href="/go/ast/commentmap.go.html#5124423">pi</a></span>&nbsp;<span class="op" id="5124467">&lt;</span>&nbsp;<span class="ident" id="5124469"><a href="/go/ast/commentmap.go.html#5124427">pj</a></span>&nbsp;<span class="op" id="5124472">||</span>&nbsp;<span class="ident" id="5124475"><a href="/go/ast/commentmap.go.html#5124423">pi</a></span>&nbsp;<span class="op" id="5124478">==</span>&nbsp;<span class="ident" id="5124481"><a href="/go/ast/commentmap.go.html#5124427">pj</a></span>&nbsp;<span class="op" id="5124484">&amp;&amp;</span>&nbsp;<span class="ident" id="5124487"><a href="/go/ast/commentmap.go.html#5124386">a</a></span><span class="op" id="5124488">[</span><span class="ident" id="5124489"><a href="/go/ast/commentmap.go.html#5124405">i</a></span><span class="op" id="5124490">]</span><span class="op" id="5124491">.</span><span class="ident" id="5124492">End</span><span class="op" id="5124495">(</span><span class="op" id="5124496">)</span>&nbsp;<span class="op" id="5124498">&gt;</span>&nbsp;<span class="ident" id="5124500"><a href="/go/ast/commentmap.go.html#5124386">a</a></span><span class="op" id="5124501">[</span><span class="ident" id="5124502"><a href="/go/ast/commentmap.go.html#5124408">j</a></span><span class="op" id="5124503">]</span><span class="op" id="5124504">.</span><span class="ident" id="5124505">End</span><span class="op" id="5124508">(</span><span class="op" id="5124509">)</span><br>
<span class="lineno"></span><span class="op" id="5124511">}</span><br>
<span class="lineno"></span><span class="keyword" id="5124513">func</span>&nbsp;<span class="op" id="5124518">(</span><span class="ident" id="5124519">a</span>&nbsp;<span class="ident" id="5124521"><a href="/go/ast/commentmap.go.html#5124313">byInterval</a></span><span class="op" id="5124531">)</span>&nbsp;<span class="ident" id="5124533">Swap</span><span class="op" id="5124537">(</span><span class="ident" id="5124538">i</span><span class="op" id="5124539">,</span>&nbsp;<span class="ident" id="5124541">j</span>&nbsp;<span class="builtintype" id="5124543">int</span><span class="op" id="5124546">)</span>&nbsp;<span class="op" id="5124548">{</span>&nbsp;<span class="ident" id="5124550"><a href="/go/ast/commentmap.go.html#5124519">a</a></span><span class="op" id="5124551">[</span><span class="ident" id="5124552"><a href="/go/ast/commentmap.go.html#5124538">i</a></span><span class="op" id="5124553">]</span><span class="op" id="5124554">,</span>&nbsp;<span class="ident" id="5124556"><a href="/go/ast/commentmap.go.html#5124519">a</a></span><span class="op" id="5124557">[</span><span class="ident" id="5124558"><a href="/go/ast/commentmap.go.html#5124541">j</a></span><span class="op" id="5124559">]</span>&nbsp;<span class="op" id="5124561">=</span>&nbsp;<span class="ident" id="5124563"><a href="/go/ast/commentmap.go.html#5124519">a</a></span><span class="op" id="5124564">[</span><span class="ident" id="5124565"><a href="/go/ast/commentmap.go.html#5124541">j</a></span><span class="op" id="5124566">]</span><span class="op" id="5124567">,</span>&nbsp;<span class="ident" id="5124569"><a href="/go/ast/commentmap.go.html#5124519">a</a></span><span class="op" id="5124570">[</span><span class="ident" id="5124571"><a href="/go/ast/commentmap.go.html#5124538">i</a></span><span class="op" id="5124572">]</span>&nbsp;<span class="op" id="5124574">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="5124577">//&nbsp;nodeList&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;n&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="5124645">//</span><br>
<span class="lineno"></span><span class="keyword" id="5124648">func</span>&nbsp;<span class="ident" id="5124653">nodeList</span><span class="op" id="5124661">(</span><span class="ident" id="5124662">n</span>&nbsp;<span class="ident" id="5124664"><a href="/go/ast/ast.go.html#5093159">Node</a></span><span class="op" id="5124668">)</span>&nbsp;<span class="op" id="5124670">[</span><span class="op" id="5124671">]</span><span class="ident" id="5124672"><a href="/go/ast/ast.go.html#5093159">Node</a></span>&nbsp;<span class="op" id="5124677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124680">var</span>&nbsp;<span class="ident" id="5124684">list</span>&nbsp;<span class="op" id="5124689">[</span><span class="op" id="5124690">]</span><span class="ident" id="5124691"><a href="/go/ast/ast.go.html#5093159">Node</a></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124697"><a href="/go/ast/walk.go.html#5171576">Inspect</a></span><span class="op" id="5124704">(</span><span class="ident" id="5124705"><a href="/go/ast/commentmap.go.html#5124662">n</a></span><span class="op" id="5124706">,</span>&nbsp;<span class="keyword" id="5124708">func</span><span class="op" id="5124712">(</span><span class="ident" id="5124713">n</span>&nbsp;<span class="ident" id="5124715"><a href="/go/ast/ast.go.html#5093159">Node</a></span><span class="op" id="5124719">)</span>&nbsp;<span class="builtintype" id="5124721">bool</span>&nbsp;<span class="op" id="5124726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124730">//&nbsp;don&#39;t&nbsp;collect&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124758">switch</span>&nbsp;<span class="ident" id="5124765"><a href="/go/ast/commentmap.go.html#5124713">n</a></span><span class="op" id="5124766">.</span><span class="op" id="5124767">(</span><span class="keyword" id="5124768">type</span><span class="op" id="5124772">)</span>&nbsp;<span class="op" id="5124774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124778">case</span>&nbsp;<span class="ident" id="5124783">nil</span><span class="op" id="5124786">,</span>&nbsp;<span class="op" id="5124788">*</span><span class="ident" id="5124789"><a href="/go/ast/ast.go.html#5094179">CommentGroup</a></span><span class="op" id="5124801">,</span>&nbsp;<span class="op" id="5124803">*</span><span class="ident" id="5124804"><a href="/go/ast/ast.go.html#5093781">Comment</a></span><span class="op" id="5124811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124816">return</span>&nbsp;<span class="builtintype" id="5124823">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5124835"><a href="/go/ast/commentmap.go.html#5124684">list</a></span>&nbsp;<span class="op" id="5124840">=</span>&nbsp;<span class="builtinfunc" id="5124842">append</span><span class="op" id="5124848">(</span><span class="ident" id="5124849"><a href="/go/ast/commentmap.go.html#5124684">list</a></span><span class="op" id="5124853">,</span>&nbsp;<span class="ident" id="5124855"><a href="/go/ast/commentmap.go.html#5124713">n</a></span><span class="op" id="5124856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5124860">return</span>&nbsp;<span class="builtintype" id="5124867">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5124873">}</span><span class="op" id="5124874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124877">//&nbsp;Note:&nbsp;The&nbsp;current&nbsp;implementation&nbsp;assumes&nbsp;that&nbsp;Inspect&nbsp;traverses&nbsp;the</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5124949">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AST&nbsp;in&nbsp;depth-first&nbsp;and&nbsp;thus&nbsp;_source_&nbsp;order.&nbsp;If&nbsp;AST&nbsp;traversal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5125020">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;does&nbsp;not&nbsp;follow&nbsp;source&nbsp;order,&nbsp;the&nbsp;sorting&nbsp;call&nbsp;below&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5125091">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5125111">//&nbsp;sort.Sort(byInterval(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125143">return</span>&nbsp;<span class="ident" id="5125150"><a href="/go/ast/commentmap.go.html#5124684">list</a></span><br>
<span class="lineno">75</span><span class="op" id="5125155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5125158">//&nbsp;A&nbsp;commentListReader&nbsp;helps&nbsp;iterating&nbsp;through&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups.</span><br>
<span class="lineno"></span><span class="comment" id="5125231">//</span><br>
<span class="lineno"></span><span class="keyword" id="5125234">type</span>&nbsp;<span class="ident" id="5125239">commentListReader</span>&nbsp;<span class="keyword" id="5125257">struct</span>&nbsp;<span class="op" id="5125264">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125267">fset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5125276">*</span><span class="ident" id="5125277"><a href="/go/ast/commentmap.go.html#5123349">token</a></span><span class="op" id="5125282">.</span><span class="ident" id="5125283">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125292">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5125301">[</span><span class="op" id="5125302">]</span><span class="op" id="5125303">*</span><span class="ident" id="5125304"><a href="/go/ast/ast.go.html#5094179">CommentGroup</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125318">index</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5125327">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125332">comment</span>&nbsp;&nbsp;<span class="op" id="5125341">*</span><span class="ident" id="5125342"><a href="/go/ast/ast.go.html#5094179">CommentGroup</a></span>&nbsp;&nbsp;<span class="comment" id="5125356">//&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125391">pos</span><span class="op" id="5125394">,</span>&nbsp;<span class="ident" id="5125396">end</span>&nbsp;<span class="ident" id="5125400"><a href="/go/ast/commentmap.go.html#5123349">token</a></span><span class="op" id="5125405">.</span><span class="ident" id="5125406">Position</span>&nbsp;<span class="comment" id="5125415">//&nbsp;source&nbsp;interval&nbsp;of&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno">85</span><span class="op" id="5125468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5125471">func</span>&nbsp;<span class="op" id="5125476">(</span><span class="ident" id="5125477">r</span>&nbsp;<span class="op" id="5125479">*</span><span class="ident" id="5125480"><a href="/go/ast/commentmap.go.html#5125239">commentListReader</a></span><span class="op" id="5125497">)</span>&nbsp;<span class="ident" id="5125499">eol</span><span class="op" id="5125502">(</span><span class="op" id="5125503">)</span>&nbsp;<span class="builtintype" id="5125505">bool</span>&nbsp;<span class="op" id="5125510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125513">return</span>&nbsp;<span class="ident" id="5125520"><a href="/go/ast/commentmap.go.html#5125477">r</a></span><span class="op" id="5125521">.</span><span class="ident" id="5125522">index</span>&nbsp;<span class="op" id="5125528">&gt;=</span>&nbsp;<span class="builtinfunc" id="5125531">len</span><span class="op" id="5125534">(</span><span class="ident" id="5125535"><a href="/go/ast/commentmap.go.html#5125477">r</a></span><span class="op" id="5125536">.</span><span class="ident" id="5125537">list</span><span class="op" id="5125541">)</span><br>
<span class="lineno"></span><span class="op" id="5125543">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="5125546">func</span>&nbsp;<span class="op" id="5125551">(</span><span class="ident" id="5125552">r</span>&nbsp;<span class="op" id="5125554">*</span><span class="ident" id="5125555"><a href="/go/ast/commentmap.go.html#5125239">commentListReader</a></span><span class="op" id="5125572">)</span>&nbsp;<span class="ident" id="5125574">next</span><span class="op" id="5125578">(</span><span class="op" id="5125579">)</span>&nbsp;<span class="op" id="5125581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5125584">if</span>&nbsp;<span class="op" id="5125587">!</span><span class="ident" id="5125588"><a href="/go/ast/commentmap.go.html#5125552">r</a></span><span class="op" id="5125589">.</span><span class="ident" id="5125590">eol</span><span class="op" id="5125593">(</span><span class="op" id="5125594">)</span>&nbsp;<span class="op" id="5125596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125600"><a href="/go/ast/commentmap.go.html#5125552">r</a></span><span class="op" id="5125601">.</span><span class="ident" id="5125602">comment</span>&nbsp;<span class="op" id="5125610">=</span>&nbsp;<span class="ident" id="5125612"><a href="/go/ast/commentmap.go.html#5125552">r</a></span><span class="op" id="5125613">.</span><span class="ident" id="5125614">list</span><span class="op" id="5125618">[</span><span class="ident" id="5125619"><a href="/go/ast/commentmap.go.html#5125552">r</a></span><span class="op" id="5125620">.</span><span class="ident" id="5125621">index</span><span class="op" id="5125626">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125630"><a href="/go/ast/commentmap.go.html#5125552">r</a></span><span class="op" id="5125631">.</span><span class="ident" id="5125632">pos</span>&nbsp;<span class="op" id="5125636">=</span>&nbsp;<span class="ident" id="5125638"><a href="/go/ast/commentmap.go.html#5125552">r</a></span><span class="op" id="5125639">.</span><span class="ident" id="5125640">fset</span><span class="op" id="5125644">.</span><span class="ident" id="5125645">Position</span><span class="op" id="5125653">(</span><span class="ident" id="5125654"><a href="/go/ast/commentmap.go.html#5125552">r</a></span><span class="op" id="5125655">.</span><span class="ident" id="5125656">comment</span><span class="op" id="5125663">.</span><span class="ident" id="5125664">Pos</span><span class="op" id="5125667">(</span><span class="op" id="5125668">)</span><span class="op" id="5125669">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125673"><a href="/go/ast/commentmap.go.html#5125552">r</a></span><span class="op" id="5125674">.</span><span class="ident" id="5125675">end</span>&nbsp;<span class="op" id="5125679">=</span>&nbsp;<span class="ident" id="5125681"><a href="/go/ast/commentmap.go.html#5125552">r</a></span><span class="op" id="5125682">.</span><span class="ident" id="5125683">fset</span><span class="op" id="5125687">.</span><span class="ident" id="5125688">Position</span><span class="op" id="5125696">(</span><span class="ident" id="5125697"><a href="/go/ast/commentmap.go.html#5125552">r</a></span><span class="op" id="5125698">.</span><span class="ident" id="5125699">comment</span><span class="op" id="5125706">.</span><span class="ident" id="5125707">End</span><span class="op" id="5125710">(</span><span class="op" id="5125711">)</span><span class="op" id="5125712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5125716"><a href="/go/ast/commentmap.go.html#5125552">r</a></span><span class="op" id="5125717">.</span><span class="ident" id="5125718">index</span><span class="op" id="5125723">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5125727">}</span><br>
<span class="lineno"></span><span class="op" id="5125729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5125732">//&nbsp;A&nbsp;nodeStack&nbsp;keeps&nbsp;track&nbsp;of&nbsp;nested&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="5125776">//&nbsp;A&nbsp;node&nbsp;lower&nbsp;on&nbsp;the&nbsp;stack&nbsp;lexically&nbsp;contains&nbsp;the&nbsp;nodes&nbsp;higher&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="5125855">//</span><br>
<span class="lineno"></span><span class="keyword" id="5125858">type</span>&nbsp;<span class="ident" id="5125863">nodeStack</span>&nbsp;<span class="op" id="5125873">[</span><span class="op" id="5125874">]</span><span class="ident" id="5125875"><a href="/go/ast/ast.go.html#5093159">Node</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5125881">//&nbsp;push&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5125935">//&nbsp;and&nbsp;then&nbsp;pushes&nbsp;n&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="5125970">//</span><br>
<span class="lineno"></span><span class="keyword" id="5125973">func</span>&nbsp;<span class="op" id="5125978">(</span><span class="ident" id="5125979">s</span>&nbsp;<span class="op" id="5125981">*</span><span class="ident" id="5125982"><a href="/go/ast/commentmap.go.html#5125863">nodeStack</a></span><span class="op" id="5125991">)</span>&nbsp;<span class="ident" id="5125993">push</span><span class="op" id="5125997">(</span><span class="ident" id="5125998">n</span>&nbsp;<span class="ident" id="5126000"><a href="/go/ast/ast.go.html#5093159">Node</a></span><span class="op" id="5126004">)</span>&nbsp;<span class="op" id="5126006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126009"><a href="/go/ast/commentmap.go.html#5125979">s</a></span><span class="op" id="5126010">.</span><span class="ident" id="5126011">pop</span><span class="op" id="5126014">(</span><span class="ident" id="5126015"><a href="/go/ast/commentmap.go.html#5125998">n</a></span><span class="op" id="5126016">.</span><span class="ident" id="5126017">Pos</span><span class="op" id="5126020">(</span><span class="op" id="5126021">)</span><span class="op" id="5126022">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5126025">*</span><span class="ident" id="5126026"><a href="/go/ast/commentmap.go.html#5125979">s</a></span>&nbsp;<span class="op" id="5126028">=</span>&nbsp;<span class="builtinfunc" id="5126030">append</span><span class="op" id="5126036">(</span><span class="op" id="5126037">(</span><span class="op" id="5126038">*</span><span class="ident" id="5126039"><a href="/go/ast/commentmap.go.html#5125979">s</a></span><span class="op" id="5126040">)</span><span class="op" id="5126041">,</span>&nbsp;<span class="ident" id="5126043"><a href="/go/ast/commentmap.go.html#5125998">n</a></span><span class="op" id="5126044">)</span><br>
<span class="lineno"></span><span class="op" id="5126046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5126049">//&nbsp;pop&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="5126104">//&nbsp;(i.e.,&nbsp;whose&nbsp;lexical&nbsp;extent&nbsp;has&nbsp;ended&nbsp;before&nbsp;or&nbsp;at&nbsp;pos).</span><br>
<span class="lineno">115</span><span class="comment" id="5126164">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;last&nbsp;node&nbsp;popped.</span><br>
<span class="lineno"></span><span class="comment" id="5126200">//</span><br>
<span class="lineno"></span><span class="keyword" id="5126203">func</span>&nbsp;<span class="op" id="5126208">(</span><span class="ident" id="5126209">s</span>&nbsp;<span class="op" id="5126211">*</span><span class="ident" id="5126212"><a href="/go/ast/commentmap.go.html#5125863">nodeStack</a></span><span class="op" id="5126221">)</span>&nbsp;<span class="ident" id="5126223">pop</span><span class="op" id="5126226">(</span><span class="ident" id="5126227">pos</span>&nbsp;<span class="ident" id="5126231"><a href="/go/ast/commentmap.go.html#5123349">token</a></span><span class="op" id="5126236">.</span><span class="ident" id="5126237">Pos</span><span class="op" id="5126240">)</span>&nbsp;<span class="op" id="5126242">(</span><span class="ident" id="5126243">top</span>&nbsp;<span class="ident" id="5126247"><a href="/go/ast/ast.go.html#5093159">Node</a></span><span class="op" id="5126251">)</span>&nbsp;<span class="op" id="5126253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126256">i</span>&nbsp;<span class="op" id="5126258">:=</span>&nbsp;<span class="builtinfunc" id="5126261">len</span><span class="op" id="5126264">(</span><span class="op" id="5126265">*</span><span class="ident" id="5126266"><a href="/go/ast/commentmap.go.html#5126209">s</a></span><span class="op" id="5126267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126270">for</span>&nbsp;<span class="ident" id="5126274"><a href="/go/ast/commentmap.go.html#5126256">i</a></span>&nbsp;<span class="op" id="5126276">&gt;</span>&nbsp;<span class="num" id="5126278">0</span>&nbsp;<span class="op" id="5126280">&amp;&amp;</span>&nbsp;<span class="op" id="5126283">(</span><span class="op" id="5126284">*</span><span class="ident" id="5126285"><a href="/go/ast/commentmap.go.html#5126209">s</a></span><span class="op" id="5126286">)</span><span class="op" id="5126287">[</span><span class="ident" id="5126288"><a href="/go/ast/commentmap.go.html#5126256">i</a></span><span class="op" id="5126289">-</span><span class="num" id="5126290">1</span><span class="op" id="5126291">]</span><span class="op" id="5126292">.</span><span class="ident" id="5126293">End</span><span class="op" id="5126296">(</span><span class="op" id="5126297">)</span>&nbsp;<span class="op" id="5126299">&lt;=</span>&nbsp;<span class="ident" id="5126302"><a href="/go/ast/commentmap.go.html#5126227">pos</a></span>&nbsp;<span class="op" id="5126306">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126310"><a href="/go/ast/commentmap.go.html#5126243">top</a></span>&nbsp;<span class="op" id="5126314">=</span>&nbsp;<span class="op" id="5126316">(</span><span class="op" id="5126317">*</span><span class="ident" id="5126318"><a href="/go/ast/commentmap.go.html#5126209">s</a></span><span class="op" id="5126319">)</span><span class="op" id="5126320">[</span><span class="ident" id="5126321"><a href="/go/ast/commentmap.go.html#5126256">i</a></span><span class="op" id="5126322">-</span><span class="num" id="5126323">1</span><span class="op" id="5126324">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5126328"><a href="/go/ast/commentmap.go.html#5126256">i</a></span><span class="op" id="5126329">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5126333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5126336">*</span><span class="ident" id="5126337"><a href="/go/ast/commentmap.go.html#5126209">s</a></span>&nbsp;<span class="op" id="5126339">=</span>&nbsp;<span class="op" id="5126341">(</span><span class="op" id="5126342">*</span><span class="ident" id="5126343"><a href="/go/ast/commentmap.go.html#5126209">s</a></span><span class="op" id="5126344">)</span><span class="op" id="5126345">[</span><span class="num" id="5126346">0</span><span class="op" id="5126347">:</span><span class="ident" id="5126348"><a href="/go/ast/commentmap.go.html#5126256">i</a></span><span class="op" id="5126349">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5126352">return</span>&nbsp;<span class="ident" id="5126359"><a href="/go/ast/commentmap.go.html#5126243">top</a></span><br>
<span class="lineno">125</span><span class="op" id="5126363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5126366">//&nbsp;NewCommentMap&nbsp;creates&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;by&nbsp;associating&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="5126439">//&nbsp;of&nbsp;the&nbsp;comments&nbsp;list&nbsp;with&nbsp;the&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="5126508">//</span><br>
<span class="lineno">130</span><span class="comment" id="5126511">//&nbsp;A&nbsp;comment&nbsp;group&nbsp;g&nbsp;is&nbsp;associated&nbsp;with&nbsp;a&nbsp;node&nbsp;n&nbsp;if:</span><br>
<span class="lineno"></span><span class="comment" id="5126564">//</span><br>
<span class="lineno"></span><span class="comment" id="5126567">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;n&nbsp;ends</span><br>
<span class="lineno"></span><span class="comment" id="5126610">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;following&nbsp;n,&nbsp;and&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5126676">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;least&nbsp;one&nbsp;empty&nbsp;line&nbsp;after&nbsp;g&nbsp;and&nbsp;before&nbsp;the&nbsp;next&nbsp;node</span><br>
<span class="lineno">135</span><span class="comment" id="5126740">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;before&nbsp;n&nbsp;and&nbsp;is&nbsp;not&nbsp;associated&nbsp;to&nbsp;the&nbsp;node&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5126808">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;via&nbsp;the&nbsp;previous&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="5126838">//</span><br>
<span class="lineno"></span><span class="comment" id="5126841">//&nbsp;NewCommentMap&nbsp;tries&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;&#34;largest&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5126910">//&nbsp;node&nbsp;possible:&nbsp;For&nbsp;instance,&nbsp;if&nbsp;the&nbsp;comment&nbsp;is&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno">140</span><span class="comment" id="5126975">//&nbsp;trailing&nbsp;an&nbsp;assignment,&nbsp;the&nbsp;comment&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="5127044">//&nbsp;assignment&nbsp;rather&nbsp;than&nbsp;just&nbsp;the&nbsp;last&nbsp;operand&nbsp;in&nbsp;the&nbsp;assignment.</span><br>
<span class="lineno"></span><span class="comment" id="5127111">//</span><br>
<span class="lineno"></span><span class="keyword" id="5127114">func</span>&nbsp;<span class="ident" id="5127119">NewCommentMap</span><span class="op" id="5127132">(</span><span class="ident" id="5127133">fset</span>&nbsp;<span class="op" id="5127138">*</span><span class="ident" id="5127139"><a href="/go/ast/commentmap.go.html#5123349">token</a></span><span class="op" id="5127144">.</span><span class="ident" id="5127145">FileSet</span><span class="op" id="5127152">,</span>&nbsp;<span class="ident" id="5127154">node</span>&nbsp;<span class="ident" id="5127159"><a href="/go/ast/ast.go.html#5093159">Node</a></span><span class="op" id="5127163">,</span>&nbsp;<span class="ident" id="5127165">comments</span>&nbsp;<span class="op" id="5127174">[</span><span class="op" id="5127175">]</span><span class="op" id="5127176">*</span><span class="ident" id="5127177"><a href="/go/ast/ast.go.html#5094179">CommentGroup</a></span><span class="op" id="5127189">)</span>&nbsp;<span class="ident" id="5127191"><a href="/go/ast/commentmap.go.html#5124087">CommentMap</a></span>&nbsp;<span class="op" id="5127202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5127205">if</span>&nbsp;<span class="builtinfunc" id="5127208">len</span><span class="op" id="5127211">(</span><span class="ident" id="5127212"><a href="/go/ast/commentmap.go.html#5127165">comments</a></span><span class="op" id="5127220">)</span>&nbsp;<span class="op" id="5127222">==</span>&nbsp;<span class="num" id="5127225">0</span>&nbsp;<span class="op" id="5127227">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5127231">return</span>&nbsp;<span class="ident" id="5127238">nil</span>&nbsp;<span class="comment" id="5127242">//&nbsp;no&nbsp;comments&nbsp;to&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5127265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5127269">cmap</span>&nbsp;<span class="op" id="5127274">:=</span>&nbsp;<span class="builtinfunc" id="5127277">make</span><span class="op" id="5127281">(</span><span class="ident" id="5127282"><a href="/go/ast/commentmap.go.html#5124087">CommentMap</a></span><span class="op" id="5127292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5127296">//&nbsp;set&nbsp;up&nbsp;comment&nbsp;reader&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5127324">tmp</span>&nbsp;<span class="op" id="5127328">:=</span>&nbsp;<span class="builtinfunc" id="5127331">make</span><span class="op" id="5127335">(</span><span class="op" id="5127336">[</span><span class="op" id="5127337">]</span><span class="op" id="5127338">*</span><span class="ident" id="5127339"><a href="/go/ast/ast.go.html#5094179">CommentGroup</a></span><span class="op" id="5127351">,</span>&nbsp;<span class="builtinfunc" id="5127353">len</span><span class="op" id="5127356">(</span><span class="ident" id="5127357"><a href="/go/ast/commentmap.go.html#5127165">comments</a></span><span class="op" id="5127365">)</span><span class="op" id="5127366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5127369">copy</span><span class="op" id="5127373">(</span><span class="ident" id="5127374"><a href="/go/ast/commentmap.go.html#5127324">tmp</a></span><span class="op" id="5127377">,</span>&nbsp;<span class="ident" id="5127379"><a href="/go/ast/commentmap.go.html#5127165">comments</a></span><span class="op" id="5127387">)</span>&nbsp;<span class="comment" id="5127389">//&nbsp;don&#39;t&nbsp;change&nbsp;incoming&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5127424"><a href="/go/ast/commentmap.go.html#5123660">sortComments</a></span><span class="op" id="5127436">(</span><span class="ident" id="5127437"><a href="/go/ast/commentmap.go.html#5127324">tmp</a></span><span class="op" id="5127440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5127443">r</span>&nbsp;<span class="op" id="5127445">:=</span>&nbsp;<span class="ident" id="5127448"><a href="/go/ast/commentmap.go.html#5125239">commentListReader</a></span><span class="op" id="5127465">{</span><span class="ident" id="5127466">fset</span><span class="op" id="5127470">:</span>&nbsp;<span class="ident" id="5127472"><a href="/go/ast/commentmap.go.html#5127133">fset</a></span><span class="op" id="5127476">,</span>&nbsp;<span class="ident" id="5127478">list</span><span class="op" id="5127482">:</span>&nbsp;<span class="ident" id="5127484"><a href="/go/ast/commentmap.go.html#5127324">tmp</a></span><span class="op" id="5127487">}</span>&nbsp;<span class="comment" id="5127489">//&nbsp;!r.eol()&nbsp;because&nbsp;len(comments)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5127528"><a href="/go/ast/commentmap.go.html#5127443">r</a></span><span class="op" id="5127529">.</span><span class="ident" id="5127530">next</span><span class="op" id="5127534">(</span><span class="op" id="5127535">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5127539">//&nbsp;create&nbsp;node&nbsp;list&nbsp;in&nbsp;lexical&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5127577">nodes</span>&nbsp;<span class="op" id="5127583">:=</span>&nbsp;<span class="ident" id="5127586"><a href="/go/ast/commentmap.go.html#5124653">nodeList</a></span><span class="op" id="5127594">(</span><span class="ident" id="5127595"><a href="/go/ast/commentmap.go.html#5127154">node</a></span><span class="op" id="5127599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5127602"><a href="/go/ast/commentmap.go.html#5127577">nodes</a></span>&nbsp;<span class="op" id="5127608">=</span>&nbsp;<span class="builtinfunc" id="5127610">append</span><span class="op" id="5127616">(</span><span class="ident" id="5127617"><a href="/go/ast/commentmap.go.html#5127577">nodes</a></span><span class="op" id="5127622">,</span>&nbsp;<span class="ident" id="5127624">nil</span><span class="op" id="5127627">)</span>&nbsp;<span class="comment" id="5127629">//&nbsp;append&nbsp;sentinel</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5127650">//&nbsp;set&nbsp;up&nbsp;iteration&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5127681">var</span>&nbsp;<span class="op" id="5127685">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5127689">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5127695"><a href="/go/ast/ast.go.html#5093159">Node</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5127710">//&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5127729">pend</span>&nbsp;&nbsp;<span class="ident" id="5127735"><a href="/go/ast/commentmap.go.html#5123349">token</a></span><span class="op" id="5127740">.</span><span class="ident" id="5127741">Position</span>&nbsp;<span class="comment" id="5127750">//&nbsp;end&nbsp;of&nbsp;p</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5127764">pg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5127770"><a href="/go/ast/ast.go.html#5093159">Node</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5127785">//&nbsp;previous&nbsp;node&nbsp;group&nbsp;(enclosing&nbsp;nodes&nbsp;of&nbsp;&#34;importance&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5127844">pgend</span>&nbsp;<span class="ident" id="5127850"><a href="/go/ast/commentmap.go.html#5123349">token</a></span><span class="op" id="5127855">.</span><span class="ident" id="5127856">Position</span>&nbsp;<span class="comment" id="5127865">//&nbsp;end&nbsp;of&nbsp;pg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5127880">stack</span>&nbsp;<span class="ident" id="5127886"><a href="/go/ast/commentmap.go.html#5125863">nodeStack</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5127901">//&nbsp;stack&nbsp;of&nbsp;node&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5127926">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5127930">for</span>&nbsp;<span class="ident" id="5127934">_</span><span class="op" id="5127935">,</span>&nbsp;<span class="ident" id="5127937">q</span>&nbsp;<span class="op" id="5127939">:=</span>&nbsp;<span class="keyword" id="5127942">range</span>&nbsp;<span class="ident" id="5127948"><a href="/go/ast/commentmap.go.html#5127577">nodes</a></span>&nbsp;<span class="op" id="5127954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5127958">var</span>&nbsp;<span class="ident" id="5127962">qpos</span>&nbsp;<span class="ident" id="5127967"><a href="/go/ast/commentmap.go.html#5123349">token</a></span><span class="op" id="5127972">.</span><span class="ident" id="5127973">Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5127984">if</span>&nbsp;<span class="ident" id="5127987"><a href="/go/ast/commentmap.go.html#5127937">q</a></span>&nbsp;<span class="op" id="5127989">!=</span>&nbsp;<span class="ident" id="5127992">nil</span>&nbsp;<span class="op" id="5127996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5128001"><a href="/go/ast/commentmap.go.html#5127962">qpos</a></span>&nbsp;<span class="op" id="5128006">=</span>&nbsp;<span class="ident" id="5128008"><a href="/go/ast/commentmap.go.html#5127133">fset</a></span><span class="op" id="5128012">.</span><span class="ident" id="5128013">Position</span><span class="op" id="5128021">(</span><span class="ident" id="5128022"><a href="/go/ast/commentmap.go.html#5127937">q</a></span><span class="op" id="5128023">.</span><span class="ident" id="5128024">Pos</span><span class="op" id="5128027">(</span><span class="op" id="5128028">)</span><span class="op" id="5128029">)</span>&nbsp;<span class="comment" id="5128031">//&nbsp;current&nbsp;node&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5128058">}</span>&nbsp;<span class="keyword" id="5128060">else</span>&nbsp;<span class="op" id="5128065">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5128070">//&nbsp;set&nbsp;fake&nbsp;sentinel&nbsp;position&nbsp;to&nbsp;infinity&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5128123">//&nbsp;all&nbsp;comments&nbsp;get&nbsp;processed&nbsp;before&nbsp;the&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5128176">const</span>&nbsp;<span class="ident" id="5128182">infinity</span>&nbsp;<span class="op" id="5128191">=</span>&nbsp;<span class="num" id="5128193">1</span>&nbsp;<span class="op" id="5128195">&lt;&lt;</span>&nbsp;<span class="num" id="5128198">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5128204"><a href="/go/ast/commentmap.go.html#5127962">qpos</a></span><span class="op" id="5128208">.</span><span class="ident" id="5128209">Offset</span>&nbsp;<span class="op" id="5128216">=</span>&nbsp;<span class="ident" id="5128218"><a href="/go/ast/commentmap.go.html#5128182">infinity</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5128230"><a href="/go/ast/commentmap.go.html#5127962">qpos</a></span><span class="op" id="5128234">.</span><span class="ident" id="5128235">Line</span>&nbsp;<span class="op" id="5128240">=</span>&nbsp;<span class="ident" id="5128242"><a href="/go/ast/commentmap.go.html#5128182">infinity</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5128253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5128258">//&nbsp;process&nbsp;comments&nbsp;before&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5128300">for</span>&nbsp;<span class="ident" id="5128304"><a href="/go/ast/commentmap.go.html#5127443">r</a></span><span class="op" id="5128305">.</span><span class="ident" id="5128306">end</span><span class="op" id="5128309">.</span><span class="ident" id="5128310">Offset</span>&nbsp;<span class="op" id="5128317">&lt;=</span>&nbsp;<span class="ident" id="5128320"><a href="/go/ast/commentmap.go.html#5127962">qpos</a></span><span class="op" id="5128324">.</span><span class="ident" id="5128325">Offset</span>&nbsp;<span class="op" id="5128332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5128337">//&nbsp;determine&nbsp;recent&nbsp;node&nbsp;group</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5128371">if</span>&nbsp;<span class="ident" id="5128374">top</span>&nbsp;<span class="op" id="5128378">:=</span>&nbsp;<span class="ident" id="5128381"><a href="/go/ast/commentmap.go.html#5127880">stack</a></span><span class="op" id="5128386">.</span><span class="ident" id="5128387">pop</span><span class="op" id="5128390">(</span><span class="ident" id="5128391"><a href="/go/ast/commentmap.go.html#5127443">r</a></span><span class="op" id="5128392">.</span><span class="ident" id="5128393">comment</span><span class="op" id="5128400">.</span><span class="ident" id="5128401">Pos</span><span class="op" id="5128404">(</span><span class="op" id="5128405">)</span><span class="op" id="5128406">)</span><span class="op" id="5128407">;</span>&nbsp;<span class="ident" id="5128409"><a href="/go/ast/commentmap.go.html#5128374">top</a></span>&nbsp;<span class="op" id="5128413">!=</span>&nbsp;<span class="ident" id="5128416">nil</span>&nbsp;<span class="op" id="5128420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5128426"><a href="/go/ast/commentmap.go.html#5127764">pg</a></span>&nbsp;<span class="op" id="5128429">=</span>&nbsp;<span class="ident" id="5128431"><a href="/go/ast/commentmap.go.html#5128374">top</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5128439"><a href="/go/ast/commentmap.go.html#5127844">pgend</a></span>&nbsp;<span class="op" id="5128445">=</span>&nbsp;<span class="ident" id="5128447"><a href="/go/ast/commentmap.go.html#5127133">fset</a></span><span class="op" id="5128451">.</span><span class="ident" id="5128452">Position</span><span class="op" id="5128460">(</span><span class="ident" id="5128461"><a href="/go/ast/commentmap.go.html#5127764">pg</a></span><span class="op" id="5128463">.</span><span class="ident" id="5128464">End</span><span class="op" id="5128467">(</span><span class="op" id="5128468">)</span><span class="op" id="5128469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5128474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5128479">//&nbsp;Try&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;first&nbsp;with&nbsp;a&nbsp;node&nbsp;group</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5128536">//&nbsp;(i.e.,&nbsp;a&nbsp;node&nbsp;of&nbsp;&#34;importance&#34;&nbsp;such&nbsp;as&nbsp;a&nbsp;declaration);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5128596">//&nbsp;if&nbsp;that&nbsp;fails,&nbsp;try&nbsp;to&nbsp;associate&nbsp;it&nbsp;with&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5128658">//&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5128670">//&nbsp;TODO(gri)&nbsp;try&nbsp;to&nbsp;simplify&nbsp;the&nbsp;logic&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5128718">var</span>&nbsp;<span class="ident" id="5128722">assoc</span>&nbsp;<span class="ident" id="5128728"><a href="/go/ast/ast.go.html#5093159">Node</a></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5128736">switch</span>&nbsp;<span class="op" id="5128743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5128748">case</span>&nbsp;<span class="ident" id="5128753"><a href="/go/ast/commentmap.go.html#5127764">pg</a></span>&nbsp;<span class="op" id="5128756">!=</span>&nbsp;<span class="ident" id="5128759">nil</span>&nbsp;<span class="op" id="5128763">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5128770">(</span><span class="ident" id="5128771"><a href="/go/ast/commentmap.go.html#5127844">pgend</a></span><span class="op" id="5128776">.</span><span class="ident" id="5128777">Line</span>&nbsp;<span class="op" id="5128782">==</span>&nbsp;<span class="ident" id="5128785"><a href="/go/ast/commentmap.go.html#5127443">r</a></span><span class="op" id="5128786">.</span><span class="ident" id="5128787">pos</span><span class="op" id="5128790">.</span><span class="ident" id="5128791">Line</span>&nbsp;<span class="op" id="5128796">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5128804"><a href="/go/ast/commentmap.go.html#5127844">pgend</a></span><span class="op" id="5128809">.</span><span class="ident" id="5128810">Line</span><span class="op" id="5128814">+</span><span class="num" id="5128815">1</span>&nbsp;<span class="op" id="5128817">==</span>&nbsp;<span class="ident" id="5128820"><a href="/go/ast/commentmap.go.html#5127443">r</a></span><span class="op" id="5128821">.</span><span class="ident" id="5128822">pos</span><span class="op" id="5128825">.</span><span class="ident" id="5128826">Line</span>&nbsp;<span class="op" id="5128831">&amp;&amp;</span>&nbsp;<span class="ident" id="5128834"><a href="/go/ast/commentmap.go.html#5127443">r</a></span><span class="op" id="5128835">.</span><span class="ident" id="5128836">end</span><span class="op" id="5128839">.</span><span class="ident" id="5128840">Line</span><span class="op" id="5128844">+</span><span class="num" id="5128845">1</span>&nbsp;<span class="op" id="5128847">&lt;</span>&nbsp;<span class="ident" id="5128849"><a href="/go/ast/commentmap.go.html#5127962">qpos</a></span><span class="op" id="5128853">.</span><span class="ident" id="5128854">Line</span><span class="op" id="5128858">)</span><span class="op" id="5128859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5128865">//&nbsp;1)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;previous&nbsp;node&nbsp;group&nbsp;ends,&nbsp;or</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5128935">//&nbsp;2)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5128994">//&nbsp;&nbsp;&nbsp;&nbsp;previous&nbsp;node&nbsp;group&nbsp;and&nbsp;there&nbsp;is&nbsp;an&nbsp;empty&nbsp;line&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5129058">//&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5129085">//&nbsp;=&gt;&nbsp;associate&nbsp;comment&nbsp;with&nbsp;previous&nbsp;node&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129138"><a href="/go/ast/commentmap.go.html#5128722">assoc</a></span>&nbsp;<span class="op" id="5129144">=</span>&nbsp;<span class="ident" id="5129146"><a href="/go/ast/commentmap.go.html#5127764">pg</a></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5129152">case</span>&nbsp;<span class="ident" id="5129157"><a href="/go/ast/commentmap.go.html#5127689">p</a></span>&nbsp;<span class="op" id="5129159">!=</span>&nbsp;<span class="ident" id="5129162">nil</span>&nbsp;<span class="op" id="5129166">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5129173">(</span><span class="ident" id="5129174"><a href="/go/ast/commentmap.go.html#5127729">pend</a></span><span class="op" id="5129178">.</span><span class="ident" id="5129179">Line</span>&nbsp;<span class="op" id="5129184">==</span>&nbsp;<span class="ident" id="5129187"><a href="/go/ast/commentmap.go.html#5127443">r</a></span><span class="op" id="5129188">.</span><span class="ident" id="5129189">pos</span><span class="op" id="5129192">.</span><span class="ident" id="5129193">Line</span>&nbsp;<span class="op" id="5129198">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129206"><a href="/go/ast/commentmap.go.html#5127729">pend</a></span><span class="op" id="5129210">.</span><span class="ident" id="5129211">Line</span><span class="op" id="5129215">+</span><span class="num" id="5129216">1</span>&nbsp;<span class="op" id="5129218">==</span>&nbsp;<span class="ident" id="5129221"><a href="/go/ast/commentmap.go.html#5127443">r</a></span><span class="op" id="5129222">.</span><span class="ident" id="5129223">pos</span><span class="op" id="5129226">.</span><span class="ident" id="5129227">Line</span>&nbsp;<span class="op" id="5129232">&amp;&amp;</span>&nbsp;<span class="ident" id="5129235"><a href="/go/ast/commentmap.go.html#5127443">r</a></span><span class="op" id="5129236">.</span><span class="ident" id="5129237">end</span><span class="op" id="5129240">.</span><span class="ident" id="5129241">Line</span><span class="op" id="5129245">+</span><span class="num" id="5129246">1</span>&nbsp;<span class="op" id="5129248">&lt;</span>&nbsp;<span class="ident" id="5129250"><a href="/go/ast/commentmap.go.html#5127962">qpos</a></span><span class="op" id="5129254">.</span><span class="ident" id="5129255">Line</span>&nbsp;<span class="op" id="5129260">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129268"><a href="/go/ast/commentmap.go.html#5127937">q</a></span>&nbsp;<span class="op" id="5129270">==</span>&nbsp;<span class="ident" id="5129273">nil</span><span class="op" id="5129276">)</span><span class="op" id="5129277">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5129283">//&nbsp;same&nbsp;rules&nbsp;apply&nbsp;as&nbsp;above&nbsp;for&nbsp;p&nbsp;rather&nbsp;than&nbsp;pg,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5129338">//&nbsp;but&nbsp;also&nbsp;associate&nbsp;with&nbsp;p&nbsp;if&nbsp;we&nbsp;are&nbsp;at&nbsp;the&nbsp;end&nbsp;(q&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129403"><a href="/go/ast/commentmap.go.html#5128722">assoc</a></span>&nbsp;<span class="op" id="5129409">=</span>&nbsp;<span class="ident" id="5129411"><a href="/go/ast/commentmap.go.html#5127689">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5129416">default</span><span class="op" id="5129423">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5129429">//&nbsp;otherwise,&nbsp;associate&nbsp;comment&nbsp;with&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5129483">if</span>&nbsp;<span class="ident" id="5129486"><a href="/go/ast/commentmap.go.html#5127937">q</a></span>&nbsp;<span class="op" id="5129488">==</span>&nbsp;<span class="ident" id="5129491">nil</span>&nbsp;<span class="op" id="5129495">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5129502">//&nbsp;we&nbsp;can&nbsp;only&nbsp;reach&nbsp;here&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5129551">//&nbsp;which&nbsp;would&nbsp;imply&nbsp;that&nbsp;there&nbsp;were&nbsp;no&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5129602">panic</span><span class="op" id="5129607">(</span><span class="string" id="5129608">&#34;internal&nbsp;error:&nbsp;no&nbsp;comments&nbsp;should&nbsp;be&nbsp;associated&nbsp;with&nbsp;sentinel&#34;</span><span class="op" id="5129672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5129678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129684"><a href="/go/ast/commentmap.go.html#5128722">assoc</a></span>&nbsp;<span class="op" id="5129690">=</span>&nbsp;<span class="ident" id="5129692"><a href="/go/ast/commentmap.go.html#5127937">q</a></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5129697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129702"><a href="/go/ast/commentmap.go.html#5127269">cmap</a></span><span class="op" id="5129706">.</span><span class="ident" id="5129707">addComment</span><span class="op" id="5129717">(</span><span class="ident" id="5129718"><a href="/go/ast/commentmap.go.html#5128722">assoc</a></span><span class="op" id="5129723">,</span>&nbsp;<span class="ident" id="5129725"><a href="/go/ast/commentmap.go.html#5127443">r</a></span><span class="op" id="5129726">.</span><span class="ident" id="5129727">comment</span><span class="op" id="5129734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5129739">if</span>&nbsp;<span class="ident" id="5129742"><a href="/go/ast/commentmap.go.html#5127443">r</a></span><span class="op" id="5129743">.</span><span class="ident" id="5129744">eol</span><span class="op" id="5129747">(</span><span class="op" id="5129748">)</span>&nbsp;<span class="op" id="5129750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5129756">return</span>&nbsp;<span class="ident" id="5129763"><a href="/go/ast/commentmap.go.html#5127269">cmap</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5129771">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129776"><a href="/go/ast/commentmap.go.html#5127443">r</a></span><span class="op" id="5129777">.</span><span class="ident" id="5129778">next</span><span class="op" id="5129782">(</span><span class="op" id="5129783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5129787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5129792">//&nbsp;update&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129818"><a href="/go/ast/commentmap.go.html#5127689">p</a></span>&nbsp;<span class="op" id="5129820">=</span>&nbsp;<span class="ident" id="5129822"><a href="/go/ast/commentmap.go.html#5127937">q</a></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129826"><a href="/go/ast/commentmap.go.html#5127729">pend</a></span>&nbsp;<span class="op" id="5129831">=</span>&nbsp;<span class="ident" id="5129833"><a href="/go/ast/commentmap.go.html#5127133">fset</a></span><span class="op" id="5129837">.</span><span class="ident" id="5129838">Position</span><span class="op" id="5129846">(</span><span class="ident" id="5129847"><a href="/go/ast/commentmap.go.html#5127689">p</a></span><span class="op" id="5129848">.</span><span class="ident" id="5129849">End</span><span class="op" id="5129852">(</span><span class="op" id="5129853">)</span><span class="op" id="5129854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5129859">//&nbsp;update&nbsp;previous&nbsp;node&nbsp;group&nbsp;if&nbsp;we&nbsp;see&nbsp;an&nbsp;&#34;important&#34;&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5129921">switch</span>&nbsp;<span class="ident" id="5129928"><a href="/go/ast/commentmap.go.html#5127937">q</a></span><span class="op" id="5129929">.</span><span class="op" id="5129930">(</span><span class="keyword" id="5129931">type</span><span class="op" id="5129935">)</span>&nbsp;<span class="op" id="5129937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5129941">case</span>&nbsp;<span class="op" id="5129946">*</span><span class="ident" id="5129947"><a href="/go/ast/ast.go.html#5122014">File</a></span><span class="op" id="5129951">,</span>&nbsp;<span class="op" id="5129953">*</span><span class="ident" id="5129954"><a href="/go/ast/ast.go.html#5096403">Field</a></span><span class="op" id="5129959">,</span>&nbsp;<span class="ident" id="5129961"><a href="/go/ast/ast.go.html#5093577">Decl</a></span><span class="op" id="5129965">,</span>&nbsp;<span class="ident" id="5129967"><a href="/go/ast/ast.go.html#5117653">Spec</a></span><span class="op" id="5129971">,</span>&nbsp;<span class="ident" id="5129973"><a href="/go/ast/ast.go.html#5093479">Stmt</a></span><span class="op" id="5129977">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129982"><a href="/go/ast/commentmap.go.html#5127880">stack</a></span><span class="op" id="5129987">.</span><span class="ident" id="5129988">push</span><span class="op" id="5129992">(</span><span class="ident" id="5129993"><a href="/go/ast/commentmap.go.html#5127937">q</a></span><span class="op" id="5129994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5129998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5130001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130005">return</span>&nbsp;<span class="ident" id="5130012"><a href="/go/ast/commentmap.go.html#5127269">cmap</a></span><br>
<span class="lineno">240</span><span class="op" id="5130017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5130020">//&nbsp;Update&nbsp;replaces&nbsp;an&nbsp;old&nbsp;node&nbsp;in&nbsp;the&nbsp;comment&nbsp;map&nbsp;with&nbsp;the&nbsp;new&nbsp;node</span><br>
<span class="lineno"></span><span class="comment" id="5130088">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;node.&nbsp;Comments&nbsp;that&nbsp;were&nbsp;associated&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5130156">//&nbsp;old&nbsp;node&nbsp;are&nbsp;associated&nbsp;with&nbsp;the&nbsp;new&nbsp;node.</span><br>
<span class="lineno">245</span><span class="comment" id="5130202">//</span><br>
<span class="lineno"></span><span class="keyword" id="5130205">func</span>&nbsp;<span class="op" id="5130210">(</span><span class="ident" id="5130211">cmap</span>&nbsp;<span class="ident" id="5130216"><a href="/go/ast/commentmap.go.html#5124087">CommentMap</a></span><span class="op" id="5130226">)</span>&nbsp;<span class="ident" id="5130228">Update</span><span class="op" id="5130234">(</span><span class="ident" id="5130235">old</span><span class="op" id="5130238">,</span>&nbsp;<span class="builtinfunc" id="5130240">new</span>&nbsp;<span class="ident" id="5130244"><a href="/go/ast/ast.go.html#5093159">Node</a></span><span class="op" id="5130248">)</span>&nbsp;<span class="ident" id="5130250"><a href="/go/ast/ast.go.html#5093159">Node</a></span>&nbsp;<span class="op" id="5130255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130258">if</span>&nbsp;<span class="ident" id="5130261">list</span>&nbsp;<span class="op" id="5130266">:=</span>&nbsp;<span class="ident" id="5130269"><a href="/go/ast/commentmap.go.html#5130211">cmap</a></span><span class="op" id="5130273">[</span><span class="ident" id="5130274"><a href="/go/ast/commentmap.go.html#5130235">old</a></span><span class="op" id="5130277">]</span><span class="op" id="5130278">;</span>&nbsp;<span class="builtinfunc" id="5130280">len</span><span class="op" id="5130283">(</span><span class="ident" id="5130284"><a href="/go/ast/commentmap.go.html#5130261">list</a></span><span class="op" id="5130288">)</span>&nbsp;<span class="op" id="5130290">&gt;</span>&nbsp;<span class="num" id="5130292">0</span>&nbsp;<span class="op" id="5130294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5130298">delete</span><span class="op" id="5130304">(</span><span class="ident" id="5130305"><a href="/go/ast/commentmap.go.html#5130211">cmap</a></span><span class="op" id="5130309">,</span>&nbsp;<span class="ident" id="5130311"><a href="/go/ast/commentmap.go.html#5130235">old</a></span><span class="op" id="5130314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130318"><a href="/go/ast/commentmap.go.html#5130211">cmap</a></span><span class="op" id="5130322">[</span><span class="builtinfunc" id="5130323"><a href="/go/ast/commentmap.go.html#5130240">new</a></span><span class="op" id="5130326">]</span>&nbsp;<span class="op" id="5130328">=</span>&nbsp;<span class="builtinfunc" id="5130330">append</span><span class="op" id="5130336">(</span><span class="ident" id="5130337"><a href="/go/ast/commentmap.go.html#5130211">cmap</a></span><span class="op" id="5130341">[</span><span class="builtinfunc" id="5130342"><a href="/go/ast/commentmap.go.html#5130240">new</a></span><span class="op" id="5130345">]</span><span class="op" id="5130346">,</span>&nbsp;<span class="ident" id="5130348"><a href="/go/ast/commentmap.go.html#5130261">list</a></span><span class="op" id="5130352">...</span><span class="op" id="5130355">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5130358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130361">return</span>&nbsp;<span class="builtinfunc" id="5130368"><a href="/go/ast/commentmap.go.html#5130240">new</a></span><br>
<span class="lineno"></span><span class="op" id="5130372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5130375">//&nbsp;Filter&nbsp;returns&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;consisting&nbsp;of&nbsp;only&nbsp;those</span><br>
<span class="lineno">255</span><span class="comment" id="5130436">//&nbsp;entries&nbsp;of&nbsp;cmap&nbsp;for&nbsp;which&nbsp;a&nbsp;corresponding&nbsp;node&nbsp;exists&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5130496">//&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="5130526">//</span><br>
<span class="lineno"></span><span class="keyword" id="5130529">func</span>&nbsp;<span class="op" id="5130534">(</span><span class="ident" id="5130535">cmap</span>&nbsp;<span class="ident" id="5130540"><a href="/go/ast/commentmap.go.html#5124087">CommentMap</a></span><span class="op" id="5130550">)</span>&nbsp;<span class="ident" id="5130552">Filter</span><span class="op" id="5130558">(</span><span class="ident" id="5130559">node</span>&nbsp;<span class="ident" id="5130564"><a href="/go/ast/ast.go.html#5093159">Node</a></span><span class="op" id="5130568">)</span>&nbsp;<span class="ident" id="5130570"><a href="/go/ast/commentmap.go.html#5124087">CommentMap</a></span>&nbsp;<span class="op" id="5130581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130584">umap</span>&nbsp;<span class="op" id="5130589">:=</span>&nbsp;<span class="builtinfunc" id="5130592">make</span><span class="op" id="5130596">(</span><span class="ident" id="5130597"><a href="/go/ast/commentmap.go.html#5124087">CommentMap</a></span><span class="op" id="5130607">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130610"><a href="/go/ast/walk.go.html#5171576">Inspect</a></span><span class="op" id="5130617">(</span><span class="ident" id="5130618"><a href="/go/ast/commentmap.go.html#5130559">node</a></span><span class="op" id="5130622">,</span>&nbsp;<span class="keyword" id="5130624">func</span><span class="op" id="5130628">(</span><span class="ident" id="5130629">n</span>&nbsp;<span class="ident" id="5130631"><a href="/go/ast/ast.go.html#5093159">Node</a></span><span class="op" id="5130635">)</span>&nbsp;<span class="builtintype" id="5130637">bool</span>&nbsp;<span class="op" id="5130642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130646">if</span>&nbsp;<span class="ident" id="5130649">g</span>&nbsp;<span class="op" id="5130651">:=</span>&nbsp;<span class="ident" id="5130654"><a href="/go/ast/commentmap.go.html#5130535">cmap</a></span><span class="op" id="5130658">[</span><span class="ident" id="5130659"><a href="/go/ast/commentmap.go.html#5130629">n</a></span><span class="op" id="5130660">]</span><span class="op" id="5130661">;</span>&nbsp;<span class="builtinfunc" id="5130663">len</span><span class="op" id="5130666">(</span><span class="ident" id="5130667"><a href="/go/ast/commentmap.go.html#5130649">g</a></span><span class="op" id="5130668">)</span>&nbsp;<span class="op" id="5130670">&gt;</span>&nbsp;<span class="num" id="5130672">0</span>&nbsp;<span class="op" id="5130674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130679"><a href="/go/ast/commentmap.go.html#5130584">umap</a></span><span class="op" id="5130683">[</span><span class="ident" id="5130684"><a href="/go/ast/commentmap.go.html#5130629">n</a></span><span class="op" id="5130685">]</span>&nbsp;<span class="op" id="5130687">=</span>&nbsp;<span class="ident" id="5130689"><a href="/go/ast/commentmap.go.html#5130649">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5130693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130697">return</span>&nbsp;<span class="builtintype" id="5130704">true</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5130710">}</span><span class="op" id="5130711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130714">return</span>&nbsp;<span class="ident" id="5130721"><a href="/go/ast/commentmap.go.html#5130584">umap</a></span><br>
<span class="lineno"></span><span class="op" id="5130726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5130729">//&nbsp;Comments&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;the&nbsp;comment&nbsp;map.</span><br>
<span class="lineno">270</span><span class="comment" id="5130796">//&nbsp;The&nbsp;result&nbsp;is&nbsp;sorted&nbsp;is&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="5130837">//</span><br>
<span class="lineno"></span><span class="keyword" id="5130840">func</span>&nbsp;<span class="op" id="5130845">(</span><span class="ident" id="5130846">cmap</span>&nbsp;<span class="ident" id="5130851"><a href="/go/ast/commentmap.go.html#5124087">CommentMap</a></span><span class="op" id="5130861">)</span>&nbsp;<span class="ident" id="5130863">Comments</span><span class="op" id="5130871">(</span><span class="op" id="5130872">)</span>&nbsp;<span class="op" id="5130874">[</span><span class="op" id="5130875">]</span><span class="op" id="5130876">*</span><span class="ident" id="5130877"><a href="/go/ast/ast.go.html#5094179">CommentGroup</a></span>&nbsp;<span class="op" id="5130890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130893">list</span>&nbsp;<span class="op" id="5130898">:=</span>&nbsp;<span class="builtinfunc" id="5130901">make</span><span class="op" id="5130905">(</span><span class="op" id="5130906">[</span><span class="op" id="5130907">]</span><span class="op" id="5130908">*</span><span class="ident" id="5130909"><a href="/go/ast/ast.go.html#5094179">CommentGroup</a></span><span class="op" id="5130921">,</span>&nbsp;<span class="num" id="5130923">0</span><span class="op" id="5130924">,</span>&nbsp;<span class="builtinfunc" id="5130926">len</span><span class="op" id="5130929">(</span><span class="ident" id="5130930"><a href="/go/ast/commentmap.go.html#5130846">cmap</a></span><span class="op" id="5130934">)</span><span class="op" id="5130935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130938">for</span>&nbsp;<span class="ident" id="5130942">_</span><span class="op" id="5130943">,</span>&nbsp;<span class="ident" id="5130945">e</span>&nbsp;<span class="op" id="5130947">:=</span>&nbsp;<span class="keyword" id="5130950">range</span>&nbsp;<span class="ident" id="5130956"><a href="/go/ast/commentmap.go.html#5130846">cmap</a></span>&nbsp;<span class="op" id="5130961">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130965"><a href="/go/ast/commentmap.go.html#5130893">list</a></span>&nbsp;<span class="op" id="5130970">=</span>&nbsp;<span class="builtinfunc" id="5130972">append</span><span class="op" id="5130978">(</span><span class="ident" id="5130979"><a href="/go/ast/commentmap.go.html#5130893">list</a></span><span class="op" id="5130983">,</span>&nbsp;<span class="ident" id="5130985"><a href="/go/ast/commentmap.go.html#5130945">e</a></span><span class="op" id="5130986">...</span><span class="op" id="5130989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5130992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130995"><a href="/go/ast/commentmap.go.html#5123660">sortComments</a></span><span class="op" id="5131007">(</span><span class="ident" id="5131008"><a href="/go/ast/commentmap.go.html#5130893">list</a></span><span class="op" id="5131012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131015">return</span>&nbsp;<span class="ident" id="5131022"><a href="/go/ast/commentmap.go.html#5130893">list</a></span><br>
<span class="lineno"></span><span class="op" id="5131027">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="5131030">func</span>&nbsp;<span class="ident" id="5131035">summary</span><span class="op" id="5131042">(</span><span class="ident" id="5131043">list</span>&nbsp;<span class="op" id="5131048">[</span><span class="op" id="5131049">]</span><span class="op" id="5131050">*</span><span class="ident" id="5131051"><a href="/go/ast/ast.go.html#5094179">CommentGroup</a></span><span class="op" id="5131063">)</span>&nbsp;<span class="builtintype" id="5131065">string</span>&nbsp;<span class="op" id="5131072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131075">const</span>&nbsp;<span class="ident" id="5131081">maxLen</span>&nbsp;<span class="op" id="5131088">=</span>&nbsp;<span class="num" id="5131090">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131094">var</span>&nbsp;<span class="ident" id="5131098">buf</span>&nbsp;<span class="ident" id="5131102"><a href="/go/ast/commentmap.go.html#5123333">bytes</a></span><span class="op" id="5131107">.</span><span class="ident" id="5131108">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131117">//&nbsp;collect&nbsp;comments&nbsp;text</span><br>
<span class="lineno"></span><span class="ident" id="5131142">loop</span><span class="op" id="5131146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131149">for</span>&nbsp;<span class="ident" id="5131153">_</span><span class="op" id="5131154">,</span>&nbsp;<span class="ident" id="5131156">group</span>&nbsp;<span class="op" id="5131162">:=</span>&nbsp;<span class="keyword" id="5131165">range</span>&nbsp;<span class="ident" id="5131171"><a href="/go/ast/commentmap.go.html#5131043">list</a></span>&nbsp;<span class="op" id="5131176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131180">//&nbsp;Note:&nbsp;CommentGroup.Text()&nbsp;does&nbsp;too&nbsp;much&nbsp;work&nbsp;for&nbsp;what&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131242">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;need&nbsp;and&nbsp;would&nbsp;only&nbsp;replace&nbsp;this&nbsp;innermost&nbsp;loop.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131302">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;do&nbsp;it&nbsp;explicitly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131336">for</span>&nbsp;<span class="ident" id="5131340">_</span><span class="op" id="5131341">,</span>&nbsp;<span class="ident" id="5131343">comment</span>&nbsp;<span class="op" id="5131351">:=</span>&nbsp;<span class="keyword" id="5131354">range</span>&nbsp;<span class="ident" id="5131360"><a href="/go/ast/commentmap.go.html#5131156">group</a></span><span class="op" id="5131365">.</span><span class="ident" id="5131366">List</span>&nbsp;<span class="op" id="5131371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131376">if</span>&nbsp;<span class="ident" id="5131379"><a href="/go/ast/commentmap.go.html#5131098">buf</a></span><span class="op" id="5131382">.</span><span class="ident" id="5131383">Len</span><span class="op" id="5131386">(</span><span class="op" id="5131387">)</span>&nbsp;<span class="op" id="5131389">&gt;=</span>&nbsp;<span class="ident" id="5131392"><a href="/go/ast/commentmap.go.html#5131081">maxLen</a></span>&nbsp;<span class="op" id="5131399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131405">break</span>&nbsp;<span class="ident" id="5131411">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5131419">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131424"><a href="/go/ast/commentmap.go.html#5131098">buf</a></span><span class="op" id="5131427">.</span><span class="ident" id="5131428">WriteString</span><span class="op" id="5131439">(</span><span class="ident" id="5131440"><a href="/go/ast/commentmap.go.html#5131343">comment</a></span><span class="op" id="5131447">.</span><span class="ident" id="5131448">Text</span><span class="op" id="5131452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5131456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5131459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131463">//&nbsp;truncate&nbsp;if&nbsp;too&nbsp;long</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131488">if</span>&nbsp;<span class="ident" id="5131491"><a href="/go/ast/commentmap.go.html#5131098">buf</a></span><span class="op" id="5131494">.</span><span class="ident" id="5131495">Len</span><span class="op" id="5131498">(</span><span class="op" id="5131499">)</span>&nbsp;<span class="op" id="5131501">&gt;</span>&nbsp;<span class="ident" id="5131503"><a href="/go/ast/commentmap.go.html#5131081">maxLen</a></span>&nbsp;<span class="op" id="5131510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131514"><a href="/go/ast/commentmap.go.html#5131098">buf</a></span><span class="op" id="5131517">.</span><span class="ident" id="5131518">Truncate</span><span class="op" id="5131526">(</span><span class="ident" id="5131527"><a href="/go/ast/commentmap.go.html#5131081">maxLen</a></span>&nbsp;<span class="op" id="5131534">-</span>&nbsp;<span class="num" id="5131536">3</span><span class="op" id="5131537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131541"><a href="/go/ast/commentmap.go.html#5131098">buf</a></span><span class="op" id="5131544">.</span><span class="ident" id="5131545">WriteString</span><span class="op" id="5131556">(</span><span class="string" id="5131557">&#34;...&#34;</span><span class="op" id="5131562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5131565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131569">//&nbsp;replace&nbsp;any&nbsp;invisibles&nbsp;with&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131608">bytes</span>&nbsp;<span class="op" id="5131614">:=</span>&nbsp;<span class="ident" id="5131617"><a href="/go/ast/commentmap.go.html#5131098">buf</a></span><span class="op" id="5131620">.</span><span class="ident" id="5131621">Bytes</span><span class="op" id="5131626">(</span><span class="op" id="5131627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131630">for</span>&nbsp;<span class="ident" id="5131634">i</span><span class="op" id="5131635">,</span>&nbsp;<span class="ident" id="5131637">b</span>&nbsp;<span class="op" id="5131639">:=</span>&nbsp;<span class="keyword" id="5131642">range</span>&nbsp;<span class="ident" id="5131648"><a href="/go/ast/commentmap.go.html#5131608">bytes</a></span>&nbsp;<span class="op" id="5131654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131658">switch</span>&nbsp;<span class="ident" id="5131665"><a href="/go/ast/commentmap.go.html#5131637">b</a></span>&nbsp;<span class="op" id="5131667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131671">case</span>&nbsp;<span class="string" id="5131676">&#39;\t&#39;</span><span class="op" id="5131680">,</span>&nbsp;<span class="string" id="5131682">&#39;\n&#39;</span><span class="op" id="5131686">,</span>&nbsp;<span class="string" id="5131688">&#39;\r&#39;</span><span class="op" id="5131692">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131697"><a href="/go/ast/commentmap.go.html#5131608">bytes</a></span><span class="op" id="5131702">[</span><span class="ident" id="5131703"><a href="/go/ast/commentmap.go.html#5131634">i</a></span><span class="op" id="5131704">]</span>&nbsp;<span class="op" id="5131706">=</span>&nbsp;<span class="string" id="5131708">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5131714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5131717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131721">return</span>&nbsp;<span class="builtintype" id="5131728">string</span><span class="op" id="5131734">(</span><span class="ident" id="5131735"><a href="/go/ast/commentmap.go.html#5131608">bytes</a></span><span class="op" id="5131740">)</span><br>
<span class="lineno">315</span><span class="op" id="5131742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5131745">func</span>&nbsp;<span class="op" id="5131750">(</span><span class="ident" id="5131751">cmap</span>&nbsp;<span class="ident" id="5131756"><a href="/go/ast/commentmap.go.html#5124087">CommentMap</a></span><span class="op" id="5131766">)</span>&nbsp;<span class="ident" id="5131768">String</span><span class="op" id="5131774">(</span><span class="op" id="5131775">)</span>&nbsp;<span class="builtintype" id="5131777">string</span>&nbsp;<span class="op" id="5131784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131787">var</span>&nbsp;<span class="ident" id="5131791">buf</span>&nbsp;<span class="ident" id="5131795"><a href="/go/ast/commentmap.go.html#5123333">bytes</a></span><span class="op" id="5131800">.</span><span class="ident" id="5131801">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131809"><a href="/go/ast/commentmap.go.html#5123342">fmt</a></span><span class="op" id="5131812">.</span><span class="ident" id="5131813">Fprintln</span><span class="op" id="5131821">(</span><span class="op" id="5131822">&amp;</span><span class="ident" id="5131823"><a href="/go/ast/commentmap.go.html#5131791">buf</a></span><span class="op" id="5131826">,</span>&nbsp;<span class="string" id="5131828">&#34;CommentMap&nbsp;{&#34;</span><span class="op" id="5131842">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131845">for</span>&nbsp;<span class="ident" id="5131849">node</span><span class="op" id="5131853">,</span>&nbsp;<span class="ident" id="5131855">comment</span>&nbsp;<span class="op" id="5131863">:=</span>&nbsp;<span class="keyword" id="5131866">range</span>&nbsp;<span class="ident" id="5131872"><a href="/go/ast/commentmap.go.html#5131751">cmap</a></span>&nbsp;<span class="op" id="5131877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131881">//&nbsp;print&nbsp;name&nbsp;of&nbsp;identifiers;&nbsp;print&nbsp;node&nbsp;type&nbsp;for&nbsp;other&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131945">var</span>&nbsp;<span class="ident" id="5131949">s</span>&nbsp;<span class="builtintype" id="5131951">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131960">if</span>&nbsp;<span class="ident" id="5131963">ident</span><span class="op" id="5131968">,</span>&nbsp;<span class="ident" id="5131970">ok</span>&nbsp;<span class="op" id="5131973">:=</span>&nbsp;<span class="ident" id="5131976"><a href="/go/ast/commentmap.go.html#5131849">node</a></span><span class="op" id="5131980">.</span><span class="op" id="5131981">(</span><span class="op" id="5131982">*</span><span class="ident" id="5131983"><a href="/go/ast/ast.go.html#5098384">Ident</a></span><span class="op" id="5131988">)</span><span class="op" id="5131989">;</span>&nbsp;<span class="ident" id="5131991"><a href="/go/ast/commentmap.go.html#5131970">ok</a></span>&nbsp;<span class="op" id="5131994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131999"><a href="/go/ast/commentmap.go.html#5131949">s</a></span>&nbsp;<span class="op" id="5132001">=</span>&nbsp;<span class="ident" id="5132003"><a href="/go/ast/commentmap.go.html#5131963">ident</a></span><span class="op" id="5132008">.</span><span class="ident" id="5132009">Name</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5132016">}</span>&nbsp;<span class="keyword" id="5132018">else</span>&nbsp;<span class="op" id="5132023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132028"><a href="/go/ast/commentmap.go.html#5131949">s</a></span>&nbsp;<span class="op" id="5132030">=</span>&nbsp;<span class="ident" id="5132032"><a href="/go/ast/commentmap.go.html#5123342">fmt</a></span><span class="op" id="5132035">.</span><span class="ident" id="5132036">Sprintf</span><span class="op" id="5132043">(</span><span class="string" id="5132044">&#34;%T&#34;</span><span class="op" id="5132048">,</span>&nbsp;<span class="ident" id="5132050"><a href="/go/ast/commentmap.go.html#5131849">node</a></span><span class="op" id="5132054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5132058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132062"><a href="/go/ast/commentmap.go.html#5123342">fmt</a></span><span class="op" id="5132065">.</span><span class="ident" id="5132066">Fprintf</span><span class="op" id="5132073">(</span><span class="op" id="5132074">&amp;</span><span class="ident" id="5132075"><a href="/go/ast/commentmap.go.html#5131791">buf</a></span><span class="op" id="5132078">,</span>&nbsp;<span class="string" id="5132080">&#34;\t%p&nbsp;&nbsp;%20s:&nbsp;&nbsp;%s\n&#34;</span><span class="op" id="5132099">,</span>&nbsp;<span class="ident" id="5132101"><a href="/go/ast/commentmap.go.html#5131849">node</a></span><span class="op" id="5132105">,</span>&nbsp;<span class="ident" id="5132107"><a href="/go/ast/commentmap.go.html#5131949">s</a></span><span class="op" id="5132108">,</span>&nbsp;<span class="ident" id="5132110"><a href="/go/ast/commentmap.go.html#5131035">summary</a></span><span class="op" id="5132117">(</span><span class="ident" id="5132118"><a href="/go/ast/commentmap.go.html#5131855">comment</a></span><span class="op" id="5132125">)</span><span class="op" id="5132126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5132129">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132132"><a href="/go/ast/commentmap.go.html#5123342">fmt</a></span><span class="op" id="5132135">.</span><span class="ident" id="5132136">Fprintln</span><span class="op" id="5132144">(</span><span class="op" id="5132145">&amp;</span><span class="ident" id="5132146"><a href="/go/ast/commentmap.go.html#5131791">buf</a></span><span class="op" id="5132149">,</span>&nbsp;<span class="string" id="5132151">&#34;}&#34;</span><span class="op" id="5132154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132157">return</span>&nbsp;<span class="ident" id="5132164"><a href="/go/ast/commentmap.go.html#5131791">buf</a></span><span class="op" id="5132167">.</span><span class="ident" id="5132168">String</span><span class="op" id="5132174">(</span><span class="op" id="5132175">)</span><br>
<span class="lineno"></span><span class="op" id="5132177">}</span>
</div>
</body>
</html>
