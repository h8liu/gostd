<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1427686">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1427741">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1427795">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1427846">package</span>&nbsp;<span class="ident" id="1427854">sync</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1427860">import</span>&nbsp;<span class="op" id="1427867">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1427870">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1427885">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><span class="op" id="1427894">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1427897">//&nbsp;Cond&nbsp;implements&nbsp;a&nbsp;condition&nbsp;variable,&nbsp;a&nbsp;rendezvous&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="1427957">//&nbsp;for&nbsp;goroutines&nbsp;waiting&nbsp;for&nbsp;or&nbsp;announcing&nbsp;the&nbsp;occurrence</span><br>
<span class="lineno"></span><span class="comment" id="1428016">//&nbsp;of&nbsp;an&nbsp;event.</span><br>
<span class="lineno">15</span><span class="comment" id="1428032">//</span><br>
<span class="lineno"></span><span class="comment" id="1428035">//&nbsp;Each&nbsp;Cond&nbsp;has&nbsp;an&nbsp;associated&nbsp;Locker&nbsp;L&nbsp;(often&nbsp;a&nbsp;*Mutex&nbsp;or&nbsp;*RWMutex),</span><br>
<span class="lineno"></span><span class="comment" id="1428105">//&nbsp;which&nbsp;must&nbsp;be&nbsp;held&nbsp;when&nbsp;changing&nbsp;the&nbsp;condition&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1428159">//&nbsp;when&nbsp;calling&nbsp;the&nbsp;Wait&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="1428192">//</span><br>
<span class="lineno">20</span><span class="comment" id="1428195">//&nbsp;A&nbsp;Cond&nbsp;can&nbsp;be&nbsp;created&nbsp;as&nbsp;part&nbsp;of&nbsp;other&nbsp;structures.</span><br>
<span class="lineno"></span><span class="comment" id="1428249">//&nbsp;A&nbsp;Cond&nbsp;must&nbsp;not&nbsp;be&nbsp;copied&nbsp;after&nbsp;first&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="1428295">type</span>&nbsp;<span class="ident" id="1428300">Cond</span>&nbsp;<span class="keyword" id="1428305">struct</span>&nbsp;<span class="op" id="1428312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1428315">//&nbsp;L&nbsp;is&nbsp;held&nbsp;while&nbsp;observing&nbsp;or&nbsp;changing&nbsp;the&nbsp;condition</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1428371">L</span>&nbsp;<span class="ident" id="1428373">Locker</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1428382">sema</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1428390">syncSema</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1428400">waiters</span>&nbsp;<span class="builtintype" id="1428408">uint32</span>&nbsp;<span class="comment" id="1428415">//&nbsp;number&nbsp;of&nbsp;waiters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1428437">checker</span>&nbsp;<span class="ident" id="1428445">copyChecker</span><br>
<span class="lineno"></span><span class="op" id="1428457">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="1428460">//&nbsp;NewCond&nbsp;returns&nbsp;a&nbsp;new&nbsp;Cond&nbsp;with&nbsp;Locker&nbsp;l.</span><br>
<span class="lineno"></span><span class="keyword" id="1428505">func</span>&nbsp;<span class="ident" id="1428510">NewCond</span><span class="op" id="1428517">(</span><span class="ident" id="1428518">l</span>&nbsp;<span class="ident" id="1428520">Locker</span><span class="op" id="1428526">)</span>&nbsp;<span class="op" id="1428528">*</span><span class="ident" id="1428529">Cond</span>&nbsp;<span class="op" id="1428534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1428537">return</span>&nbsp;<span class="op" id="1428544">&amp;</span><span class="ident" id="1428545">Cond</span><span class="op" id="1428549">{</span><span class="ident" id="1428550">L</span><span class="op" id="1428551">:</span>&nbsp;<span class="ident" id="1428553">l</span><span class="op" id="1428554">}</span><br>
<span class="lineno"></span><span class="op" id="1428556">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1428559">//&nbsp;Wait&nbsp;atomically&nbsp;unlocks&nbsp;c.L&nbsp;and&nbsp;suspends&nbsp;execution</span><br>
<span class="lineno"></span><span class="comment" id="1428613">//&nbsp;of&nbsp;the&nbsp;calling&nbsp;goroutine.&nbsp;&nbsp;After&nbsp;later&nbsp;resuming&nbsp;execution,</span><br>
<span class="lineno"></span><span class="comment" id="1428675">//&nbsp;Wait&nbsp;locks&nbsp;c.L&nbsp;before&nbsp;returning.&nbsp;&nbsp;Unlike&nbsp;in&nbsp;other&nbsp;systems,</span><br>
<span class="lineno"></span><span class="comment" id="1428737">//&nbsp;Wait&nbsp;cannot&nbsp;return&nbsp;unless&nbsp;awoken&nbsp;by&nbsp;Broadcast&nbsp;or&nbsp;Signal.</span><br>
<span class="lineno">40</span><span class="comment" id="1428797">//</span><br>
<span class="lineno"></span><span class="comment" id="1428800">//&nbsp;Because&nbsp;c.L&nbsp;is&nbsp;not&nbsp;locked&nbsp;when&nbsp;Wait&nbsp;first&nbsp;resumes,&nbsp;the&nbsp;caller</span><br>
<span class="lineno"></span><span class="comment" id="1428865">//&nbsp;typically&nbsp;cannot&nbsp;assume&nbsp;that&nbsp;the&nbsp;condition&nbsp;is&nbsp;true&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="1428924">//&nbsp;Wait&nbsp;returns.&nbsp;&nbsp;Instead,&nbsp;the&nbsp;caller&nbsp;should&nbsp;Wait&nbsp;in&nbsp;a&nbsp;loop:</span><br>
<span class="lineno"></span><span class="comment" id="1428985">//</span><br>
<span class="lineno">45</span><span class="comment" id="1428988">//&nbsp;&nbsp;&nbsp;&nbsp;c.L.Lock()</span><br>
<span class="lineno"></span><span class="comment" id="1429005">//&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;!condition()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1429030">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.Wait()</span><br>
<span class="lineno"></span><span class="comment" id="1429049">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="1429057">//&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;make&nbsp;use&nbsp;of&nbsp;condition&nbsp;...</span><br>
<span class="lineno">50</span><span class="comment" id="1429093">//&nbsp;&nbsp;&nbsp;&nbsp;c.L.Unlock()</span><br>
<span class="lineno"></span><span class="comment" id="1429112">//</span><br>
<span class="lineno"></span><span class="keyword" id="1429115">func</span>&nbsp;<span class="op" id="1429120">(</span><span class="ident" id="1429121">c</span>&nbsp;<span class="op" id="1429123">*</span><span class="ident" id="1429124">Cond</span><span class="op" id="1429128">)</span>&nbsp;<span class="ident" id="1429130">Wait</span><span class="op" id="1429134">(</span><span class="op" id="1429135">)</span>&nbsp;<span class="op" id="1429137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429140">c</span><span class="op" id="1429141">.</span><span class="ident" id="1429142">checker</span><span class="op" id="1429149">.</span><span class="ident" id="1429150">check</span><span class="op" id="1429155">(</span><span class="op" id="1429156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1429159">if</span>&nbsp;<span class="ident" id="1429162">raceenabled</span>&nbsp;<span class="op" id="1429174">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429178">raceDisable</span><span class="op" id="1429189">(</span><span class="op" id="1429190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1429193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429196">atomic</span><span class="op" id="1429202">.</span><span class="ident" id="1429203">AddUint32</span><span class="op" id="1429212">(</span><span class="op" id="1429213">&amp;</span><span class="ident" id="1429214">c</span><span class="op" id="1429215">.</span><span class="ident" id="1429216">waiters</span><span class="op" id="1429223">,</span>&nbsp;<span class="num" id="1429225">1</span><span class="op" id="1429226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1429229">if</span>&nbsp;<span class="ident" id="1429232">raceenabled</span>&nbsp;<span class="op" id="1429244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429248">raceEnable</span><span class="op" id="1429258">(</span><span class="op" id="1429259">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1429262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429265">c</span><span class="op" id="1429266">.</span><span class="ident" id="1429267">L</span><span class="op" id="1429268">.</span><span class="ident" id="1429269">Unlock</span><span class="op" id="1429275">(</span><span class="op" id="1429276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429279">runtime_Syncsemacquire</span><span class="op" id="1429301">(</span><span class="op" id="1429302">&amp;</span><span class="ident" id="1429303">c</span><span class="op" id="1429304">.</span><span class="ident" id="1429305">sema</span><span class="op" id="1429309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429312">c</span><span class="op" id="1429313">.</span><span class="ident" id="1429314">L</span><span class="op" id="1429315">.</span><span class="ident" id="1429316">Lock</span><span class="op" id="1429320">(</span><span class="op" id="1429321">)</span><br>
<span class="lineno"></span><span class="op" id="1429323">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="1429326">//&nbsp;Signal&nbsp;wakes&nbsp;one&nbsp;goroutine&nbsp;waiting&nbsp;on&nbsp;c,&nbsp;if&nbsp;there&nbsp;is&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="1429387">//</span><br>
<span class="lineno"></span><span class="comment" id="1429390">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;but&nbsp;not&nbsp;required&nbsp;for&nbsp;the&nbsp;caller&nbsp;to&nbsp;hold&nbsp;c.L</span><br>
<span class="lineno"></span><span class="comment" id="1429451">//&nbsp;during&nbsp;the&nbsp;call.</span><br>
<span class="lineno">70</span><span class="keyword" id="1429471">func</span>&nbsp;<span class="op" id="1429476">(</span><span class="ident" id="1429477">c</span>&nbsp;<span class="op" id="1429479">*</span><span class="ident" id="1429480">Cond</span><span class="op" id="1429484">)</span>&nbsp;<span class="ident" id="1429486">Signal</span><span class="op" id="1429492">(</span><span class="op" id="1429493">)</span>&nbsp;<span class="op" id="1429495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429498">c</span><span class="op" id="1429499">.</span><span class="ident" id="1429500">signalImpl</span><span class="op" id="1429510">(</span><span class="ident" id="1429511">false</span><span class="op" id="1429516">)</span><br>
<span class="lineno"></span><span class="op" id="1429518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1429521">//&nbsp;Broadcast&nbsp;wakes&nbsp;all&nbsp;goroutines&nbsp;waiting&nbsp;on&nbsp;c.</span><br>
<span class="lineno">75</span><span class="comment" id="1429569">//</span><br>
<span class="lineno"></span><span class="comment" id="1429572">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;but&nbsp;not&nbsp;required&nbsp;for&nbsp;the&nbsp;caller&nbsp;to&nbsp;hold&nbsp;c.L</span><br>
<span class="lineno"></span><span class="comment" id="1429633">//&nbsp;during&nbsp;the&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="1429653">func</span>&nbsp;<span class="op" id="1429658">(</span><span class="ident" id="1429659">c</span>&nbsp;<span class="op" id="1429661">*</span><span class="ident" id="1429662">Cond</span><span class="op" id="1429666">)</span>&nbsp;<span class="ident" id="1429668">Broadcast</span><span class="op" id="1429677">(</span><span class="op" id="1429678">)</span>&nbsp;<span class="op" id="1429680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429683">c</span><span class="op" id="1429684">.</span><span class="ident" id="1429685">signalImpl</span><span class="op" id="1429695">(</span><span class="ident" id="1429696">true</span><span class="op" id="1429700">)</span><br>
<span class="lineno">80</span><span class="op" id="1429702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1429705">func</span>&nbsp;<span class="op" id="1429710">(</span><span class="ident" id="1429711">c</span>&nbsp;<span class="op" id="1429713">*</span><span class="ident" id="1429714">Cond</span><span class="op" id="1429718">)</span>&nbsp;<span class="ident" id="1429720">signalImpl</span><span class="op" id="1429730">(</span><span class="ident" id="1429731">all</span>&nbsp;<span class="builtintype" id="1429735">bool</span><span class="op" id="1429739">)</span>&nbsp;<span class="op" id="1429741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429744">c</span><span class="op" id="1429745">.</span><span class="ident" id="1429746">checker</span><span class="op" id="1429753">.</span><span class="ident" id="1429754">check</span><span class="op" id="1429759">(</span><span class="op" id="1429760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1429763">if</span>&nbsp;<span class="ident" id="1429766">raceenabled</span>&nbsp;<span class="op" id="1429778">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429782">raceDisable</span><span class="op" id="1429793">(</span><span class="op" id="1429794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1429797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1429800">for</span>&nbsp;<span class="op" id="1429804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429808">old</span>&nbsp;<span class="op" id="1429812">:=</span>&nbsp;<span class="ident" id="1429815">atomic</span><span class="op" id="1429821">.</span><span class="ident" id="1429822">LoadUint32</span><span class="op" id="1429832">(</span><span class="op" id="1429833">&amp;</span><span class="ident" id="1429834">c</span><span class="op" id="1429835">.</span><span class="ident" id="1429836">waiters</span><span class="op" id="1429843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1429847">if</span>&nbsp;<span class="ident" id="1429850">old</span>&nbsp;<span class="op" id="1429854">==</span>&nbsp;<span class="num" id="1429857">0</span>&nbsp;<span class="op" id="1429859">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1429864">if</span>&nbsp;<span class="ident" id="1429867">raceenabled</span>&nbsp;<span class="op" id="1429879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1429885">raceEnable</span><span class="op" id="1429895">(</span><span class="op" id="1429896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1429901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1429906">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1429915">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1429919">new</span>&nbsp;<span class="op" id="1429923">:=</span>&nbsp;<span class="ident" id="1429926">old</span>&nbsp;<span class="op" id="1429930">-</span>&nbsp;<span class="num" id="1429932">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1429936">if</span>&nbsp;<span class="ident" id="1429939">all</span>&nbsp;<span class="op" id="1429943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1429948">new</span>&nbsp;<span class="op" id="1429952">=</span>&nbsp;<span class="num" id="1429954">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1429958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1429962">if</span>&nbsp;<span class="ident" id="1429965">atomic</span><span class="op" id="1429971">.</span><span class="ident" id="1429972">CompareAndSwapUint32</span><span class="op" id="1429992">(</span><span class="op" id="1429993">&amp;</span><span class="ident" id="1429994">c</span><span class="op" id="1429995">.</span><span class="ident" id="1429996">waiters</span><span class="op" id="1430003">,</span>&nbsp;<span class="ident" id="1430005">old</span><span class="op" id="1430008">,</span>&nbsp;<span class="builtinfunc" id="1430010">new</span><span class="op" id="1430013">)</span>&nbsp;<span class="op" id="1430015">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1430020">if</span>&nbsp;<span class="ident" id="1430023">raceenabled</span>&nbsp;<span class="op" id="1430035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1430041">raceEnable</span><span class="op" id="1430051">(</span><span class="op" id="1430052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1430057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1430062">runtime_Syncsemrelease</span><span class="op" id="1430084">(</span><span class="op" id="1430085">&amp;</span><span class="ident" id="1430086">c</span><span class="op" id="1430087">.</span><span class="ident" id="1430088">sema</span><span class="op" id="1430092">,</span>&nbsp;<span class="ident" id="1430094">old</span><span class="op" id="1430097">-</span><span class="builtinfunc" id="1430098">new</span><span class="op" id="1430101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1430106">return</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1430115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1430118">}</span><br>
<span class="lineno"></span><span class="op" id="1430120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1430123">//&nbsp;copyChecker&nbsp;holds&nbsp;back&nbsp;pointer&nbsp;to&nbsp;itself&nbsp;to&nbsp;detect&nbsp;object&nbsp;copying.</span><br>
<span class="lineno">110</span><span class="keyword" id="1430193">type</span>&nbsp;<span class="ident" id="1430198">copyChecker</span>&nbsp;<span class="builtintype" id="1430210">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1430219">func</span>&nbsp;<span class="op" id="1430224">(</span><span class="ident" id="1430225">c</span>&nbsp;<span class="op" id="1430227">*</span><span class="ident" id="1430228">copyChecker</span><span class="op" id="1430239">)</span>&nbsp;<span class="ident" id="1430241">check</span><span class="op" id="1430246">(</span><span class="op" id="1430247">)</span>&nbsp;<span class="op" id="1430249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1430252">if</span>&nbsp;<span class="builtintype" id="1430255">uintptr</span><span class="op" id="1430262">(</span><span class="op" id="1430263">*</span><span class="ident" id="1430264">c</span><span class="op" id="1430265">)</span>&nbsp;<span class="op" id="1430267">!=</span>&nbsp;<span class="builtintype" id="1430270">uintptr</span><span class="op" id="1430277">(</span><span class="ident" id="1430278">unsafe</span><span class="op" id="1430284">.</span><span class="ident" id="1430285">Pointer</span><span class="op" id="1430292">(</span><span class="ident" id="1430293">c</span><span class="op" id="1430294">)</span><span class="op" id="1430295">)</span>&nbsp;<span class="op" id="1430297">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1430302">!</span><span class="ident" id="1430303">atomic</span><span class="op" id="1430309">.</span><span class="ident" id="1430310">CompareAndSwapUintptr</span><span class="op" id="1430331">(</span><span class="op" id="1430332">(</span><span class="op" id="1430333">*</span><span class="builtintype" id="1430334">uintptr</span><span class="op" id="1430341">)</span><span class="op" id="1430342">(</span><span class="ident" id="1430343">c</span><span class="op" id="1430344">)</span><span class="op" id="1430345">,</span>&nbsp;<span class="num" id="1430347">0</span><span class="op" id="1430348">,</span>&nbsp;<span class="builtintype" id="1430350">uintptr</span><span class="op" id="1430357">(</span><span class="ident" id="1430358">unsafe</span><span class="op" id="1430364">.</span><span class="ident" id="1430365">Pointer</span><span class="op" id="1430372">(</span><span class="ident" id="1430373">c</span><span class="op" id="1430374">)</span><span class="op" id="1430375">)</span><span class="op" id="1430376">)</span>&nbsp;<span class="op" id="1430378">&amp;&amp;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1430383">uintptr</span><span class="op" id="1430390">(</span><span class="op" id="1430391">*</span><span class="ident" id="1430392">c</span><span class="op" id="1430393">)</span>&nbsp;<span class="op" id="1430395">!=</span>&nbsp;<span class="builtintype" id="1430398">uintptr</span><span class="op" id="1430405">(</span><span class="ident" id="1430406">unsafe</span><span class="op" id="1430412">.</span><span class="ident" id="1430413">Pointer</span><span class="op" id="1430420">(</span><span class="ident" id="1430421">c</span><span class="op" id="1430422">)</span><span class="op" id="1430423">)</span>&nbsp;<span class="op" id="1430425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1430429">panic</span><span class="op" id="1430434">(</span><span class="string" id="1430435">&#34;sync.Cond&nbsp;is&nbsp;copied&#34;</span><span class="op" id="1430456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1430459">}</span><br>
<span class="lineno"></span><span class="op" id="1430461">}</span>
</div>
</body>
</html>
