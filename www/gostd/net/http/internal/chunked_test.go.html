<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7359074">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7359129">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7359183">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7359234">package</span>&nbsp;<span class="ident" id="7359242">internal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7359252">import</span>&nbsp;<span class="op" id="7359259">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7359262">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7359271">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7359280">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7359287">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7359293">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7359306">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7359317">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7359327">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7359330">func</span>&nbsp;<span class="ident" id="7359335">TestChunk</span><span class="op" id="7359344">(</span><span class="ident" id="7359345">t</span>&nbsp;<span class="op" id="7359347">*</span><span class="ident" id="7359348">testing</span><span class="op" id="7359355">.</span><span class="ident" id="7359356">T</span><span class="op" id="7359357">)</span>&nbsp;<span class="op" id="7359359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359362">var</span>&nbsp;<span class="ident" id="7359366">b</span>&nbsp;<span class="ident" id="7359368">bytes</span><span class="op" id="7359373">.</span><span class="ident" id="7359374">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359383">w</span>&nbsp;<span class="op" id="7359385">:=</span>&nbsp;<span class="ident" id="7359388">NewChunkedWriter</span><span class="op" id="7359404">(</span><span class="op" id="7359405">&amp;</span><span class="ident" id="7359406">b</span><span class="op" id="7359407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359410">const</span>&nbsp;<span class="ident" id="7359416">chunk1</span>&nbsp;<span class="op" id="7359423">=</span>&nbsp;<span class="string" id="7359425">&#34;hello,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359436">const</span>&nbsp;<span class="ident" id="7359442">chunk2</span>&nbsp;<span class="op" id="7359449">=</span>&nbsp;<span class="string" id="7359451">&#34;world!&nbsp;0123456789abcdef&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359478">w</span><span class="op" id="7359479">.</span><span class="ident" id="7359480">Write</span><span class="op" id="7359485">(</span><span class="op" id="7359486">[</span><span class="op" id="7359487">]</span><span class="builtintype" id="7359488">byte</span><span class="op" id="7359492">(</span><span class="ident" id="7359493">chunk1</span><span class="op" id="7359499">)</span><span class="op" id="7359500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359503">w</span><span class="op" id="7359504">.</span><span class="ident" id="7359505">Write</span><span class="op" id="7359510">(</span><span class="op" id="7359511">[</span><span class="op" id="7359512">]</span><span class="builtintype" id="7359513">byte</span><span class="op" id="7359517">(</span><span class="ident" id="7359518">chunk2</span><span class="op" id="7359524">)</span><span class="op" id="7359525">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359528">w</span><span class="op" id="7359529">.</span><span class="ident" id="7359530">Close</span><span class="op" id="7359535">(</span><span class="op" id="7359536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359540">if</span>&nbsp;<span class="ident" id="7359543">g</span><span class="op" id="7359544">,</span>&nbsp;<span class="ident" id="7359546">e</span>&nbsp;<span class="op" id="7359548">:=</span>&nbsp;<span class="ident" id="7359551">b</span><span class="op" id="7359552">.</span><span class="ident" id="7359553">String</span><span class="op" id="7359559">(</span><span class="op" id="7359560">)</span><span class="op" id="7359561">,</span>&nbsp;<span class="string" id="7359563">&#34;7\r\nhello,&nbsp;\r\n17\r\nworld!&nbsp;0123456789abcdef\r\n0\r\n&#34;</span><span class="op" id="7359619">;</span>&nbsp;<span class="ident" id="7359621">g</span>&nbsp;<span class="op" id="7359623">!=</span>&nbsp;<span class="ident" id="7359626">e</span>&nbsp;<span class="op" id="7359628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359632">t</span><span class="op" id="7359633">.</span><span class="ident" id="7359634">Fatalf</span><span class="op" id="7359640">(</span><span class="string" id="7359641">&#34;chunk&nbsp;writer&nbsp;wrote&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7359673">,</span>&nbsp;<span class="ident" id="7359675">g</span><span class="op" id="7359676">,</span>&nbsp;<span class="ident" id="7359678">e</span><span class="op" id="7359679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7359682">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359686">r</span>&nbsp;<span class="op" id="7359688">:=</span>&nbsp;<span class="ident" id="7359691">NewChunkedReader</span><span class="op" id="7359707">(</span><span class="op" id="7359708">&amp;</span><span class="ident" id="7359709">b</span><span class="op" id="7359710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359713">data</span><span class="op" id="7359717">,</span>&nbsp;<span class="ident" id="7359719">err</span>&nbsp;<span class="op" id="7359723">:=</span>&nbsp;<span class="ident" id="7359726">ioutil</span><span class="op" id="7359732">.</span><span class="ident" id="7359733">ReadAll</span><span class="op" id="7359740">(</span><span class="ident" id="7359741">r</span><span class="op" id="7359742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359745">if</span>&nbsp;<span class="ident" id="7359748">err</span>&nbsp;<span class="op" id="7359752">!=</span>&nbsp;<span class="ident" id="7359755">nil</span>&nbsp;<span class="op" id="7359759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359763">t</span><span class="op" id="7359764">.</span><span class="ident" id="7359765">Logf</span><span class="op" id="7359769">(</span><span class="string" id="7359770">`data:&nbsp;&#34;%s&#34;`</span><span class="op" id="7359782">,</span>&nbsp;<span class="ident" id="7359784">data</span><span class="op" id="7359788">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359792">t</span><span class="op" id="7359793">.</span><span class="ident" id="7359794">Fatalf</span><span class="op" id="7359800">(</span><span class="string" id="7359801">&#34;ReadAll&nbsp;from&nbsp;reader:&nbsp;%v&#34;</span><span class="op" id="7359826">,</span>&nbsp;<span class="ident" id="7359828">err</span><span class="op" id="7359831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7359834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359837">if</span>&nbsp;<span class="ident" id="7359840">g</span><span class="op" id="7359841">,</span>&nbsp;<span class="ident" id="7359843">e</span>&nbsp;<span class="op" id="7359845">:=</span>&nbsp;<span class="builtintype" id="7359848">string</span><span class="op" id="7359854">(</span><span class="ident" id="7359855">data</span><span class="op" id="7359859">)</span><span class="op" id="7359860">,</span>&nbsp;<span class="ident" id="7359862">chunk1</span><span class="op" id="7359868">+</span><span class="ident" id="7359869">chunk2</span><span class="op" id="7359875">;</span>&nbsp;<span class="ident" id="7359877">g</span>&nbsp;<span class="op" id="7359879">!=</span>&nbsp;<span class="ident" id="7359882">e</span>&nbsp;<span class="op" id="7359884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359888">t</span><span class="op" id="7359889">.</span><span class="ident" id="7359890">Errorf</span><span class="op" id="7359896">(</span><span class="string" id="7359897">&#34;chunk&nbsp;reader&nbsp;read&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7359928">,</span>&nbsp;<span class="ident" id="7359930">g</span><span class="op" id="7359931">,</span>&nbsp;<span class="ident" id="7359933">e</span><span class="op" id="7359934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7359937">}</span><br>
<span class="lineno">40</span><span class="op" id="7359939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7359942">func</span>&nbsp;<span class="ident" id="7359947">TestChunkReadMultiple</span><span class="op" id="7359968">(</span><span class="ident" id="7359969">t</span>&nbsp;<span class="op" id="7359971">*</span><span class="ident" id="7359972">testing</span><span class="op" id="7359979">.</span><span class="ident" id="7359980">T</span><span class="op" id="7359981">)</span>&nbsp;<span class="op" id="7359983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7359986">//&nbsp;Bunch&nbsp;of&nbsp;small&nbsp;chunks,&nbsp;all&nbsp;read&nbsp;together.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7360032">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360036">var</span>&nbsp;<span class="ident" id="7360040">b</span>&nbsp;<span class="ident" id="7360042">bytes</span><span class="op" id="7360047">.</span><span class="ident" id="7360048">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360057">w</span>&nbsp;<span class="op" id="7360059">:=</span>&nbsp;<span class="ident" id="7360062">NewChunkedWriter</span><span class="op" id="7360078">(</span><span class="op" id="7360079">&amp;</span><span class="ident" id="7360080">b</span><span class="op" id="7360081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360085">w</span><span class="op" id="7360086">.</span><span class="ident" id="7360087">Write</span><span class="op" id="7360092">(</span><span class="op" id="7360093">[</span><span class="op" id="7360094">]</span><span class="builtintype" id="7360095">byte</span><span class="op" id="7360099">(</span><span class="string" id="7360100">&#34;foo&#34;</span><span class="op" id="7360105">)</span><span class="op" id="7360106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360110">w</span><span class="op" id="7360111">.</span><span class="ident" id="7360112">Write</span><span class="op" id="7360117">(</span><span class="op" id="7360118">[</span><span class="op" id="7360119">]</span><span class="builtintype" id="7360120">byte</span><span class="op" id="7360124">(</span><span class="string" id="7360125">&#34;bar&#34;</span><span class="op" id="7360130">)</span><span class="op" id="7360131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360135">w</span><span class="op" id="7360136">.</span><span class="ident" id="7360137">Close</span><span class="op" id="7360142">(</span><span class="op" id="7360143">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360148">r</span>&nbsp;<span class="op" id="7360150">:=</span>&nbsp;<span class="ident" id="7360153">NewChunkedReader</span><span class="op" id="7360169">(</span><span class="op" id="7360170">&amp;</span><span class="ident" id="7360171">b</span><span class="op" id="7360172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360176">buf</span>&nbsp;<span class="op" id="7360180">:=</span>&nbsp;<span class="builtinfunc" id="7360183">make</span><span class="op" id="7360187">(</span><span class="op" id="7360188">[</span><span class="op" id="7360189">]</span><span class="builtintype" id="7360190">byte</span><span class="op" id="7360194">,</span>&nbsp;<span class="num" id="7360196">10</span><span class="op" id="7360198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360202">n</span><span class="op" id="7360203">,</span>&nbsp;<span class="ident" id="7360205">err</span>&nbsp;<span class="op" id="7360209">:=</span>&nbsp;<span class="ident" id="7360212">r</span><span class="op" id="7360213">.</span><span class="ident" id="7360214">Read</span><span class="op" id="7360218">(</span><span class="ident" id="7360219">buf</span><span class="op" id="7360222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360226">if</span>&nbsp;<span class="ident" id="7360229">n</span>&nbsp;<span class="op" id="7360231">!=</span>&nbsp;<span class="num" id="7360234">6</span>&nbsp;<span class="op" id="7360236">||</span>&nbsp;<span class="ident" id="7360239">err</span>&nbsp;<span class="op" id="7360243">!=</span>&nbsp;<span class="ident" id="7360246">io</span><span class="op" id="7360248">.</span><span class="ident" id="7360249">EOF</span>&nbsp;<span class="op" id="7360253">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360258">t</span><span class="op" id="7360259">.</span><span class="ident" id="7360260">Errorf</span><span class="op" id="7360266">(</span><span class="string" id="7360267">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;6,&nbsp;EOF&#34;</span><span class="op" id="7360295">,</span>&nbsp;<span class="ident" id="7360297">n</span><span class="op" id="7360298">,</span>&nbsp;<span class="ident" id="7360300">err</span><span class="op" id="7360303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7360307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360311">buf</span>&nbsp;<span class="op" id="7360315">=</span>&nbsp;<span class="ident" id="7360317">buf</span><span class="op" id="7360320">[</span><span class="op" id="7360321">:</span><span class="ident" id="7360322">n</span><span class="op" id="7360323">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360327">if</span>&nbsp;<span class="builtintype" id="7360330">string</span><span class="op" id="7360336">(</span><span class="ident" id="7360337">buf</span><span class="op" id="7360340">)</span>&nbsp;<span class="op" id="7360342">!=</span>&nbsp;<span class="string" id="7360345">&#34;foobar&#34;</span>&nbsp;<span class="op" id="7360354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360359">t</span><span class="op" id="7360360">.</span><span class="ident" id="7360361">Errorf</span><span class="op" id="7360367">(</span><span class="string" id="7360368">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7360388">,</span>&nbsp;<span class="ident" id="7360390">buf</span><span class="op" id="7360393">,</span>&nbsp;<span class="string" id="7360395">&#34;foobar&#34;</span><span class="op" id="7360403">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7360407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7360410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7360414">//&nbsp;One&nbsp;big&nbsp;chunk&nbsp;followed&nbsp;by&nbsp;a&nbsp;little&nbsp;chunk,&nbsp;but&nbsp;the&nbsp;small&nbsp;bufio.Reader&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7360492">//&nbsp;should&nbsp;prevent&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;from&nbsp;being&nbsp;read.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7360552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360556">var</span>&nbsp;<span class="ident" id="7360560">b</span>&nbsp;<span class="ident" id="7360562">bytes</span><span class="op" id="7360567">.</span><span class="ident" id="7360568">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360577">w</span>&nbsp;<span class="op" id="7360579">:=</span>&nbsp;<span class="ident" id="7360582">NewChunkedWriter</span><span class="op" id="7360598">(</span><span class="op" id="7360599">&amp;</span><span class="ident" id="7360600">b</span><span class="op" id="7360601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7360605">//&nbsp;fillBufChunk&nbsp;is&nbsp;11&nbsp;bytes&nbsp;+&nbsp;3&nbsp;bytes&nbsp;header&nbsp;+&nbsp;2&nbsp;bytes&nbsp;footer&nbsp;=&nbsp;16&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7360681">//&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;bufio&nbsp;ReaderSize&nbsp;below&nbsp;(the&nbsp;minimum),&nbsp;so&nbsp;even</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7360748">//&nbsp;though&nbsp;we&#39;re&nbsp;going&nbsp;to&nbsp;try&nbsp;to&nbsp;Read&nbsp;with&nbsp;a&nbsp;buffer&nbsp;larger&nbsp;enough&nbsp;to&nbsp;also</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7360823">//&nbsp;receive&nbsp;&#34;foo&#34;,&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;won&#39;t&nbsp;be&nbsp;read&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360886">const</span>&nbsp;<span class="ident" id="7360892">fillBufChunk</span>&nbsp;<span class="op" id="7360905">=</span>&nbsp;<span class="string" id="7360907">&#34;0123456789a&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360923">const</span>&nbsp;<span class="ident" id="7360929">shortChunk</span>&nbsp;<span class="op" id="7360940">=</span>&nbsp;<span class="string" id="7360942">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360950">w</span><span class="op" id="7360951">.</span><span class="ident" id="7360952">Write</span><span class="op" id="7360957">(</span><span class="op" id="7360958">[</span><span class="op" id="7360959">]</span><span class="builtintype" id="7360960">byte</span><span class="op" id="7360964">(</span><span class="ident" id="7360965">fillBufChunk</span><span class="op" id="7360977">)</span><span class="op" id="7360978">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360982">w</span><span class="op" id="7360983">.</span><span class="ident" id="7360984">Write</span><span class="op" id="7360989">(</span><span class="op" id="7360990">[</span><span class="op" id="7360991">]</span><span class="builtintype" id="7360992">byte</span><span class="op" id="7360996">(</span><span class="ident" id="7360997">shortChunk</span><span class="op" id="7361007">)</span><span class="op" id="7361008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361012">w</span><span class="op" id="7361013">.</span><span class="ident" id="7361014">Close</span><span class="op" id="7361019">(</span><span class="op" id="7361020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361025">r</span>&nbsp;<span class="op" id="7361027">:=</span>&nbsp;<span class="ident" id="7361030">NewChunkedReader</span><span class="op" id="7361046">(</span><span class="ident" id="7361047">bufio</span><span class="op" id="7361052">.</span><span class="ident" id="7361053">NewReaderSize</span><span class="op" id="7361066">(</span><span class="op" id="7361067">&amp;</span><span class="ident" id="7361068">b</span><span class="op" id="7361069">,</span>&nbsp;<span class="num" id="7361071">16</span><span class="op" id="7361073">)</span><span class="op" id="7361074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361078">buf</span>&nbsp;<span class="op" id="7361082">:=</span>&nbsp;<span class="builtinfunc" id="7361085">make</span><span class="op" id="7361089">(</span><span class="op" id="7361090">[</span><span class="op" id="7361091">]</span><span class="builtintype" id="7361092">byte</span><span class="op" id="7361096">,</span>&nbsp;<span class="builtinfunc" id="7361098">len</span><span class="op" id="7361101">(</span><span class="ident" id="7361102">fillBufChunk</span><span class="op" id="7361114">)</span><span class="op" id="7361115">+</span><span class="builtinfunc" id="7361116">len</span><span class="op" id="7361119">(</span><span class="ident" id="7361120">shortChunk</span><span class="op" id="7361130">)</span><span class="op" id="7361131">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361135">n</span><span class="op" id="7361136">,</span>&nbsp;<span class="ident" id="7361138">err</span>&nbsp;<span class="op" id="7361142">:=</span>&nbsp;<span class="ident" id="7361145">r</span><span class="op" id="7361146">.</span><span class="ident" id="7361147">Read</span><span class="op" id="7361151">(</span><span class="ident" id="7361152">buf</span><span class="op" id="7361155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361159">if</span>&nbsp;<span class="ident" id="7361162">n</span>&nbsp;<span class="op" id="7361164">!=</span>&nbsp;<span class="builtinfunc" id="7361167">len</span><span class="op" id="7361170">(</span><span class="ident" id="7361171">fillBufChunk</span><span class="op" id="7361183">)</span>&nbsp;<span class="op" id="7361185">||</span>&nbsp;<span class="ident" id="7361188">err</span>&nbsp;<span class="op" id="7361192">!=</span>&nbsp;<span class="ident" id="7361195">nil</span>&nbsp;<span class="op" id="7361199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361204">t</span><span class="op" id="7361205">.</span><span class="ident" id="7361206">Errorf</span><span class="op" id="7361212">(</span><span class="string" id="7361213">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7361242">,</span>&nbsp;<span class="ident" id="7361244">n</span><span class="op" id="7361245">,</span>&nbsp;<span class="ident" id="7361247">err</span><span class="op" id="7361250">,</span>&nbsp;<span class="builtinfunc" id="7361252">len</span><span class="op" id="7361255">(</span><span class="ident" id="7361256">fillBufChunk</span><span class="op" id="7361268">)</span><span class="op" id="7361269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361277">buf</span>&nbsp;<span class="op" id="7361281">=</span>&nbsp;<span class="ident" id="7361283">buf</span><span class="op" id="7361286">[</span><span class="op" id="7361287">:</span><span class="ident" id="7361288">n</span><span class="op" id="7361289">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361293">if</span>&nbsp;<span class="builtintype" id="7361296">string</span><span class="op" id="7361302">(</span><span class="ident" id="7361303">buf</span><span class="op" id="7361306">)</span>&nbsp;<span class="op" id="7361308">!=</span>&nbsp;<span class="ident" id="7361311">fillBufChunk</span>&nbsp;<span class="op" id="7361324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361329">t</span><span class="op" id="7361330">.</span><span class="ident" id="7361331">Errorf</span><span class="op" id="7361337">(</span><span class="string" id="7361338">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7361358">,</span>&nbsp;<span class="ident" id="7361360">buf</span><span class="op" id="7361363">,</span>&nbsp;<span class="ident" id="7361365">fillBufChunk</span><span class="op" id="7361377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361386">n</span><span class="op" id="7361387">,</span>&nbsp;<span class="ident" id="7361389">err</span>&nbsp;<span class="op" id="7361393">=</span>&nbsp;<span class="ident" id="7361395">r</span><span class="op" id="7361396">.</span><span class="ident" id="7361397">Read</span><span class="op" id="7361401">(</span><span class="ident" id="7361402">buf</span><span class="op" id="7361405">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361409">if</span>&nbsp;<span class="ident" id="7361412">n</span>&nbsp;<span class="op" id="7361414">!=</span>&nbsp;<span class="builtinfunc" id="7361417">len</span><span class="op" id="7361420">(</span><span class="ident" id="7361421">shortChunk</span><span class="op" id="7361431">)</span>&nbsp;<span class="op" id="7361433">||</span>&nbsp;<span class="ident" id="7361436">err</span>&nbsp;<span class="op" id="7361440">!=</span>&nbsp;<span class="ident" id="7361443">io</span><span class="op" id="7361445">.</span><span class="ident" id="7361446">EOF</span>&nbsp;<span class="op" id="7361450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361455">t</span><span class="op" id="7361456">.</span><span class="ident" id="7361457">Errorf</span><span class="op" id="7361463">(</span><span class="string" id="7361464">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;EOF&#34;</span><span class="op" id="7361493">,</span>&nbsp;<span class="ident" id="7361495">n</span><span class="op" id="7361496">,</span>&nbsp;<span class="ident" id="7361498">err</span><span class="op" id="7361501">,</span>&nbsp;<span class="builtinfunc" id="7361503">len</span><span class="op" id="7361506">(</span><span class="ident" id="7361507">shortChunk</span><span class="op" id="7361517">)</span><span class="op" id="7361518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7361529">//&nbsp;And&nbsp;test&nbsp;that&nbsp;we&nbsp;see&nbsp;an&nbsp;EOF&nbsp;chunk,&nbsp;even&nbsp;though&nbsp;our&nbsp;buffer&nbsp;is&nbsp;already&nbsp;full:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361612">r</span>&nbsp;<span class="op" id="7361614">:=</span>&nbsp;<span class="ident" id="7361617">NewChunkedReader</span><span class="op" id="7361633">(</span><span class="ident" id="7361634">bufio</span><span class="op" id="7361639">.</span><span class="ident" id="7361640">NewReader</span><span class="op" id="7361649">(</span><span class="ident" id="7361650">strings</span><span class="op" id="7361657">.</span><span class="ident" id="7361658">NewReader</span><span class="op" id="7361667">(</span><span class="string" id="7361668">&#34;3\r\nfoo\r\n0\r\n&#34;</span><span class="op" id="7361687">)</span><span class="op" id="7361688">)</span><span class="op" id="7361689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361693">buf</span>&nbsp;<span class="op" id="7361697">:=</span>&nbsp;<span class="builtinfunc" id="7361700">make</span><span class="op" id="7361704">(</span><span class="op" id="7361705">[</span><span class="op" id="7361706">]</span><span class="builtintype" id="7361707">byte</span><span class="op" id="7361711">,</span>&nbsp;<span class="num" id="7361713">3</span><span class="op" id="7361714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361718">n</span><span class="op" id="7361719">,</span>&nbsp;<span class="ident" id="7361721">err</span>&nbsp;<span class="op" id="7361725">:=</span>&nbsp;<span class="ident" id="7361728">r</span><span class="op" id="7361729">.</span><span class="ident" id="7361730">Read</span><span class="op" id="7361734">(</span><span class="ident" id="7361735">buf</span><span class="op" id="7361738">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361742">if</span>&nbsp;<span class="ident" id="7361745">n</span>&nbsp;<span class="op" id="7361747">!=</span>&nbsp;<span class="num" id="7361750">3</span>&nbsp;<span class="op" id="7361752">||</span>&nbsp;<span class="ident" id="7361755">err</span>&nbsp;<span class="op" id="7361759">!=</span>&nbsp;<span class="ident" id="7361762">io</span><span class="op" id="7361764">.</span><span class="ident" id="7361765">EOF</span>&nbsp;<span class="op" id="7361769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361774">t</span><span class="op" id="7361775">.</span><span class="ident" id="7361776">Errorf</span><span class="op" id="7361782">(</span><span class="string" id="7361783">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;3,&nbsp;EOF&#34;</span><span class="op" id="7361811">,</span>&nbsp;<span class="ident" id="7361813">n</span><span class="op" id="7361814">,</span>&nbsp;<span class="ident" id="7361816">err</span><span class="op" id="7361819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361827">if</span>&nbsp;<span class="builtintype" id="7361830">string</span><span class="op" id="7361836">(</span><span class="ident" id="7361837">buf</span><span class="op" id="7361840">)</span>&nbsp;<span class="op" id="7361842">!=</span>&nbsp;<span class="string" id="7361845">&#34;foo&#34;</span>&nbsp;<span class="op" id="7361851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361856">t</span><span class="op" id="7361857">.</span><span class="ident" id="7361858">Errorf</span><span class="op" id="7361864">(</span><span class="string" id="7361865">&#34;buf&nbsp;=&nbsp;%q;&nbsp;want&nbsp;foo&#34;</span><span class="op" id="7361885">,</span>&nbsp;<span class="ident" id="7361887">buf</span><span class="op" id="7361890">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361897">}</span><br>
<span class="lineno"></span><span class="op" id="7361899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7361902">func</span>&nbsp;<span class="ident" id="7361907">TestChunkReaderAllocs</span><span class="op" id="7361928">(</span><span class="ident" id="7361929">t</span>&nbsp;<span class="op" id="7361931">*</span><span class="ident" id="7361932">testing</span><span class="op" id="7361939">.</span><span class="ident" id="7361940">T</span><span class="op" id="7361941">)</span>&nbsp;<span class="op" id="7361943">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361946">if</span>&nbsp;<span class="ident" id="7361949">testing</span><span class="op" id="7361956">.</span><span class="ident" id="7361957">Short</span><span class="op" id="7361962">(</span><span class="op" id="7361963">)</span>&nbsp;<span class="op" id="7361965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361969">t</span><span class="op" id="7361970">.</span><span class="ident" id="7361971">Skip</span><span class="op" id="7361975">(</span><span class="string" id="7361976">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7362000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7362003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362006">var</span>&nbsp;<span class="ident" id="7362010">buf</span>&nbsp;<span class="ident" id="7362014">bytes</span><span class="op" id="7362019">.</span><span class="ident" id="7362020">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362028">w</span>&nbsp;<span class="op" id="7362030">:=</span>&nbsp;<span class="ident" id="7362033">NewChunkedWriter</span><span class="op" id="7362049">(</span><span class="op" id="7362050">&amp;</span><span class="ident" id="7362051">buf</span><span class="op" id="7362054">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362057">a</span><span class="op" id="7362058">,</span>&nbsp;<span class="ident" id="7362060">b</span><span class="op" id="7362061">,</span>&nbsp;<span class="ident" id="7362063">c</span>&nbsp;<span class="op" id="7362065">:=</span>&nbsp;<span class="op" id="7362068">[</span><span class="op" id="7362069">]</span><span class="builtintype" id="7362070">byte</span><span class="op" id="7362074">(</span><span class="string" id="7362075">&#34;aaaaaa&#34;</span><span class="op" id="7362083">)</span><span class="op" id="7362084">,</span>&nbsp;<span class="op" id="7362086">[</span><span class="op" id="7362087">]</span><span class="builtintype" id="7362088">byte</span><span class="op" id="7362092">(</span><span class="string" id="7362093">&#34;bbbbbbbbbbbb&#34;</span><span class="op" id="7362107">)</span><span class="op" id="7362108">,</span>&nbsp;<span class="op" id="7362110">[</span><span class="op" id="7362111">]</span><span class="builtintype" id="7362112">byte</span><span class="op" id="7362116">(</span><span class="string" id="7362117">&#34;cccccccccccccccccccccccc&#34;</span><span class="op" id="7362143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362146">w</span><span class="op" id="7362147">.</span><span class="ident" id="7362148">Write</span><span class="op" id="7362153">(</span><span class="ident" id="7362154">a</span><span class="op" id="7362155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362158">w</span><span class="op" id="7362159">.</span><span class="ident" id="7362160">Write</span><span class="op" id="7362165">(</span><span class="ident" id="7362166">b</span><span class="op" id="7362167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362170">w</span><span class="op" id="7362171">.</span><span class="ident" id="7362172">Write</span><span class="op" id="7362177">(</span><span class="ident" id="7362178">c</span><span class="op" id="7362179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362182">w</span><span class="op" id="7362183">.</span><span class="ident" id="7362184">Close</span><span class="op" id="7362189">(</span><span class="op" id="7362190">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362194">readBuf</span>&nbsp;<span class="op" id="7362202">:=</span>&nbsp;<span class="builtinfunc" id="7362205">make</span><span class="op" id="7362209">(</span><span class="op" id="7362210">[</span><span class="op" id="7362211">]</span><span class="builtintype" id="7362212">byte</span><span class="op" id="7362216">,</span>&nbsp;<span class="builtinfunc" id="7362218">len</span><span class="op" id="7362221">(</span><span class="ident" id="7362222">a</span><span class="op" id="7362223">)</span><span class="op" id="7362224">+</span><span class="builtinfunc" id="7362225">len</span><span class="op" id="7362228">(</span><span class="ident" id="7362229">b</span><span class="op" id="7362230">)</span><span class="op" id="7362231">+</span><span class="builtinfunc" id="7362232">len</span><span class="op" id="7362235">(</span><span class="ident" id="7362236">c</span><span class="op" id="7362237">)</span><span class="op" id="7362238">+</span><span class="num" id="7362239">1</span><span class="op" id="7362240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362243">byter</span>&nbsp;<span class="op" id="7362249">:=</span>&nbsp;<span class="ident" id="7362252">bytes</span><span class="op" id="7362257">.</span><span class="ident" id="7362258">NewReader</span><span class="op" id="7362267">(</span><span class="ident" id="7362268">buf</span><span class="op" id="7362271">.</span><span class="ident" id="7362272">Bytes</span><span class="op" id="7362277">(</span><span class="op" id="7362278">)</span><span class="op" id="7362279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362282">bufr</span>&nbsp;<span class="op" id="7362287">:=</span>&nbsp;<span class="ident" id="7362290">bufio</span><span class="op" id="7362295">.</span><span class="ident" id="7362296">NewReader</span><span class="op" id="7362305">(</span><span class="ident" id="7362306">byter</span><span class="op" id="7362311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362314">mallocs</span>&nbsp;<span class="op" id="7362322">:=</span>&nbsp;<span class="ident" id="7362325">testing</span><span class="op" id="7362332">.</span><span class="ident" id="7362333">AllocsPerRun</span><span class="op" id="7362345">(</span><span class="num" id="7362346">100</span><span class="op" id="7362349">,</span>&nbsp;<span class="keyword" id="7362351">func</span><span class="op" id="7362355">(</span><span class="op" id="7362356">)</span>&nbsp;<span class="op" id="7362358">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362362">byter</span><span class="op" id="7362367">.</span><span class="ident" id="7362368">Seek</span><span class="op" id="7362372">(</span><span class="num" id="7362373">0</span><span class="op" id="7362374">,</span>&nbsp;<span class="num" id="7362376">0</span><span class="op" id="7362377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362381">bufr</span><span class="op" id="7362385">.</span><span class="ident" id="7362386">Reset</span><span class="op" id="7362391">(</span><span class="ident" id="7362392">byter</span><span class="op" id="7362397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362401">r</span>&nbsp;<span class="op" id="7362403">:=</span>&nbsp;<span class="ident" id="7362406">NewChunkedReader</span><span class="op" id="7362422">(</span><span class="ident" id="7362423">bufr</span><span class="op" id="7362427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362431">n</span><span class="op" id="7362432">,</span>&nbsp;<span class="ident" id="7362434">err</span>&nbsp;<span class="op" id="7362438">:=</span>&nbsp;<span class="ident" id="7362441">io</span><span class="op" id="7362443">.</span><span class="ident" id="7362444">ReadFull</span><span class="op" id="7362452">(</span><span class="ident" id="7362453">r</span><span class="op" id="7362454">,</span>&nbsp;<span class="ident" id="7362456">readBuf</span><span class="op" id="7362463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362467">if</span>&nbsp;<span class="ident" id="7362470">n</span>&nbsp;<span class="op" id="7362472">!=</span>&nbsp;<span class="builtinfunc" id="7362475">len</span><span class="op" id="7362478">(</span><span class="ident" id="7362479">readBuf</span><span class="op" id="7362486">)</span><span class="op" id="7362487">-</span><span class="num" id="7362488">1</span>&nbsp;<span class="op" id="7362490">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362495">t</span><span class="op" id="7362496">.</span><span class="ident" id="7362497">Fatalf</span><span class="op" id="7362503">(</span><span class="string" id="7362504">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7362528">,</span>&nbsp;<span class="ident" id="7362530">n</span><span class="op" id="7362531">,</span>&nbsp;<span class="builtinfunc" id="7362533">len</span><span class="op" id="7362536">(</span><span class="ident" id="7362537">readBuf</span><span class="op" id="7362544">)</span><span class="op" id="7362545">-</span><span class="num" id="7362546">1</span><span class="op" id="7362547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7362551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362555">if</span>&nbsp;<span class="ident" id="7362558">err</span>&nbsp;<span class="op" id="7362562">!=</span>&nbsp;<span class="ident" id="7362565">io</span><span class="op" id="7362567">.</span><span class="ident" id="7362568">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7362585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362590">t</span><span class="op" id="7362591">.</span><span class="ident" id="7362592">Fatalf</span><span class="op" id="7362598">(</span><span class="string" id="7362599">&#34;read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;ErrUnexpectedEOF&#34;</span><span class="op" id="7362639">,</span>&nbsp;<span class="ident" id="7362641">err</span><span class="op" id="7362644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7362648">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7362651">}</span><span class="op" id="7362652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362655">if</span>&nbsp;<span class="ident" id="7362658">mallocs</span>&nbsp;<span class="op" id="7362666">&gt;</span>&nbsp;<span class="num" id="7362668">1.5</span>&nbsp;<span class="op" id="7362672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362676">t</span><span class="op" id="7362677">.</span><span class="ident" id="7362678">Errorf</span><span class="op" id="7362684">(</span><span class="string" id="7362685">&#34;mallocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7362707">,</span>&nbsp;<span class="ident" id="7362709">mallocs</span><span class="op" id="7362716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7362719">}</span><br>
<span class="lineno"></span><span class="op" id="7362721">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="7362724">func</span>&nbsp;<span class="ident" id="7362729">TestParseHexUint</span><span class="op" id="7362745">(</span><span class="ident" id="7362746">t</span>&nbsp;<span class="op" id="7362748">*</span><span class="ident" id="7362749">testing</span><span class="op" id="7362756">.</span><span class="ident" id="7362757">T</span><span class="op" id="7362758">)</span>&nbsp;<span class="op" id="7362760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362763">for</span>&nbsp;<span class="ident" id="7362767">i</span>&nbsp;<span class="op" id="7362769">:=</span>&nbsp;<span class="ident" id="7362772">uint64</span><span class="op" id="7362778">(</span><span class="num" id="7362779">0</span><span class="op" id="7362780">)</span><span class="op" id="7362781">;</span>&nbsp;<span class="ident" id="7362783">i</span>&nbsp;<span class="op" id="7362785">&lt;=</span>&nbsp;<span class="num" id="7362788">1234</span><span class="op" id="7362792">;</span>&nbsp;<span class="ident" id="7362794">i</span><span class="op" id="7362795">++</span>&nbsp;<span class="op" id="7362798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362802">line</span>&nbsp;<span class="op" id="7362807">:=</span>&nbsp;<span class="op" id="7362810">[</span><span class="op" id="7362811">]</span><span class="builtintype" id="7362812">byte</span><span class="op" id="7362816">(</span><span class="ident" id="7362817">fmt</span><span class="op" id="7362820">.</span><span class="ident" id="7362821">Sprintf</span><span class="op" id="7362828">(</span><span class="string" id="7362829">&#34;%x&#34;</span><span class="op" id="7362833">,</span>&nbsp;<span class="ident" id="7362835">i</span><span class="op" id="7362836">)</span><span class="op" id="7362837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362841">got</span><span class="op" id="7362844">,</span>&nbsp;<span class="ident" id="7362846">err</span>&nbsp;<span class="op" id="7362850">:=</span>&nbsp;<span class="ident" id="7362853">parseHexUint</span><span class="op" id="7362865">(</span><span class="ident" id="7362866">line</span><span class="op" id="7362870">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362874">if</span>&nbsp;<span class="ident" id="7362877">err</span>&nbsp;<span class="op" id="7362881">!=</span>&nbsp;<span class="ident" id="7362884">nil</span>&nbsp;<span class="op" id="7362888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362893">t</span><span class="op" id="7362894">.</span><span class="ident" id="7362895">Fatalf</span><span class="op" id="7362901">(</span><span class="string" id="7362902">&#34;on&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7362913">,</span>&nbsp;<span class="ident" id="7362915">i</span><span class="op" id="7362916">,</span>&nbsp;<span class="ident" id="7362918">err</span><span class="op" id="7362921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7362925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362929">if</span>&nbsp;<span class="ident" id="7362932">got</span>&nbsp;<span class="op" id="7362936">!=</span>&nbsp;<span class="ident" id="7362939">i</span>&nbsp;<span class="op" id="7362941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362946">t</span><span class="op" id="7362947">.</span><span class="ident" id="7362948">Errorf</span><span class="op" id="7362954">(</span><span class="string" id="7362955">&#34;for&nbsp;input&nbsp;%q&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7362983">,</span>&nbsp;<span class="ident" id="7362985">line</span><span class="op" id="7362989">,</span>&nbsp;<span class="ident" id="7362991">got</span><span class="op" id="7362994">,</span>&nbsp;<span class="ident" id="7362996">i</span><span class="op" id="7362997">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7363007">_</span><span class="op" id="7363008">,</span>&nbsp;<span class="ident" id="7363010">err</span>&nbsp;<span class="op" id="7363014">:=</span>&nbsp;<span class="ident" id="7363017">parseHexUint</span><span class="op" id="7363029">(</span><span class="op" id="7363030">[</span><span class="op" id="7363031">]</span><span class="builtintype" id="7363032">byte</span><span class="op" id="7363036">(</span><span class="string" id="7363037">&#34;bogus&#34;</span><span class="op" id="7363044">)</span><span class="op" id="7363045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363048">if</span>&nbsp;<span class="ident" id="7363051">err</span>&nbsp;<span class="op" id="7363055">==</span>&nbsp;<span class="ident" id="7363058">nil</span>&nbsp;<span class="op" id="7363062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7363066">t</span><span class="op" id="7363067">.</span><span class="ident" id="7363068">Error</span><span class="op" id="7363073">(</span><span class="string" id="7363074">&#34;expected&nbsp;error&nbsp;on&nbsp;bogus&nbsp;input&#34;</span><span class="op" id="7363105">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363108">}</span><br>
<span class="lineno"></span><span class="op" id="7363110">}</span>
</div>
</body>
</html>
