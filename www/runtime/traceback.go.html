<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1749968">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1750023">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1750077">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1750128">package</span>&nbsp;<span class="ident" id="1750136">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1750145">import</span>&nbsp;<span class="string" id="1750152">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1750162">//&nbsp;The&nbsp;code&nbsp;in&nbsp;this&nbsp;file&nbsp;implements&nbsp;stack&nbsp;trace&nbsp;walking&nbsp;for&nbsp;all&nbsp;architectures.</span><br>
<span class="lineno">10</span><span class="comment" id="1750241">//&nbsp;The&nbsp;most&nbsp;important&nbsp;fact&nbsp;about&nbsp;a&nbsp;given&nbsp;architecture&nbsp;is&nbsp;whether&nbsp;it&nbsp;uses&nbsp;a&nbsp;link&nbsp;register.</span><br>
<span class="lineno"></span><span class="comment" id="1750331">//&nbsp;On&nbsp;systems&nbsp;with&nbsp;link&nbsp;registers,&nbsp;the&nbsp;prologue&nbsp;for&nbsp;a&nbsp;non-leaf&nbsp;function&nbsp;stores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1750414">//&nbsp;incoming&nbsp;value&nbsp;of&nbsp;LR&nbsp;at&nbsp;the&nbsp;bottom&nbsp;of&nbsp;the&nbsp;newly&nbsp;allocated&nbsp;stack&nbsp;frame.</span><br>
<span class="lineno"></span><span class="comment" id="1750488">//&nbsp;On&nbsp;systems&nbsp;without&nbsp;link&nbsp;registers,&nbsp;the&nbsp;architecture&nbsp;pushes&nbsp;a&nbsp;return&nbsp;PC&nbsp;during</span><br>
<span class="lineno"></span><span class="comment" id="1750569">//&nbsp;the&nbsp;call&nbsp;instruction,&nbsp;so&nbsp;the&nbsp;return&nbsp;PC&nbsp;ends&nbsp;up&nbsp;above&nbsp;the&nbsp;stack&nbsp;frame.</span><br>
<span class="lineno">15</span><span class="comment" id="1750642">//&nbsp;In&nbsp;this&nbsp;file,&nbsp;the&nbsp;return&nbsp;PC&nbsp;is&nbsp;always&nbsp;called&nbsp;LR,&nbsp;no&nbsp;matter&nbsp;how&nbsp;it&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="1750722">//</span><br>
<span class="lineno"></span><span class="comment" id="1750725">//&nbsp;To&nbsp;date,&nbsp;the&nbsp;opposite&nbsp;of&nbsp;a&nbsp;link&nbsp;register&nbsp;architecture&nbsp;is&nbsp;an&nbsp;x86&nbsp;architecture.</span><br>
<span class="lineno"></span><span class="comment" id="1750806">//&nbsp;This&nbsp;code&nbsp;may&nbsp;need&nbsp;to&nbsp;change&nbsp;if&nbsp;some&nbsp;other&nbsp;kind&nbsp;of&nbsp;non-link-register</span><br>
<span class="lineno"></span><span class="comment" id="1750878">//&nbsp;architecture&nbsp;comes&nbsp;along.</span><br>
<span class="lineno">20</span><span class="comment" id="1750907">//</span><br>
<span class="lineno"></span><span class="comment" id="1750910">//&nbsp;The&nbsp;other&nbsp;important&nbsp;fact&nbsp;is&nbsp;the&nbsp;size&nbsp;of&nbsp;a&nbsp;pointer:&nbsp;on&nbsp;32-bit&nbsp;systems&nbsp;the&nbsp;LR</span><br>
<span class="lineno"></span><span class="comment" id="1750989">//&nbsp;takes&nbsp;up&nbsp;only&nbsp;4&nbsp;bytes&nbsp;on&nbsp;the&nbsp;stack,&nbsp;while&nbsp;on&nbsp;64-bit&nbsp;systems&nbsp;it&nbsp;takes&nbsp;up&nbsp;8&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1751073">//&nbsp;Typically&nbsp;this&nbsp;is&nbsp;ptrSize.</span><br>
<span class="lineno"></span><span class="comment" id="1751103">//</span><br>
<span class="lineno">25</span><span class="comment" id="1751106">//&nbsp;As&nbsp;an&nbsp;exception,&nbsp;amd64p32&nbsp;has&nbsp;ptrSize&nbsp;==&nbsp;4&nbsp;but&nbsp;the&nbsp;CALL&nbsp;instruction&nbsp;still</span><br>
<span class="lineno"></span><span class="comment" id="1751183">//&nbsp;stores&nbsp;an&nbsp;8-byte&nbsp;return&nbsp;PC&nbsp;onto&nbsp;the&nbsp;stack.&nbsp;To&nbsp;accommodate&nbsp;this,&nbsp;we&nbsp;use&nbsp;regSize</span><br>
<span class="lineno"></span><span class="comment" id="1751265">//&nbsp;as&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;architecture-pushed&nbsp;return&nbsp;PC.</span><br>
<span class="lineno"></span><span class="comment" id="1751318">//</span><br>
<span class="lineno"></span><span class="comment" id="1751321">//&nbsp;usesLR&nbsp;is&nbsp;defined&nbsp;below.&nbsp;ptrSize&nbsp;and&nbsp;regSize&nbsp;are&nbsp;defined&nbsp;in&nbsp;stubs.go.</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="1751395">const</span>&nbsp;<span class="ident" id="1751401">usesLR</span>&nbsp;<span class="op" id="1751408">=</span>&nbsp;<span class="ident" id="1751410">GOARCH</span>&nbsp;<span class="op" id="1751417">!=</span>&nbsp;<span class="string" id="1751420">&#34;amd64&#34;</span>&nbsp;<span class="op" id="1751428">&amp;&amp;</span>&nbsp;<span class="ident" id="1751431">GOARCH</span>&nbsp;<span class="op" id="1751438">!=</span>&nbsp;<span class="string" id="1751441">&#34;amd64p32&#34;</span>&nbsp;<span class="op" id="1751452">&amp;&amp;</span>&nbsp;<span class="ident" id="1751455">GOARCH</span>&nbsp;<span class="op" id="1751462">!=</span>&nbsp;<span class="string" id="1751465">&#34;386&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1751472">var</span>&nbsp;<span class="op" id="1751476">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1751479">//&nbsp;initialized&nbsp;in&nbsp;tracebackinit</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1751512">deferprocPC</span>&nbsp;<span class="builtintype" id="1751524">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1751533">goexitPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1751545">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1751554">jmpdeferPC</span>&nbsp;&nbsp;<span class="builtintype" id="1751566">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1751575">mcallPC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1751587">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1751596">morestackPC</span>&nbsp;<span class="builtintype" id="1751608">uintptr</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1751617">mstartPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1751629">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1751638">newprocPC</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1751650">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1751659">rt0_goPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1751671">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1751680">sigpanicPC</span>&nbsp;&nbsp;<span class="builtintype" id="1751692">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1751702">externalthreadhandlerp</span>&nbsp;<span class="builtintype" id="1751725">uintptr</span>&nbsp;<span class="comment" id="1751733">//&nbsp;initialized&nbsp;elsewhere</span><br>
<span class="lineno"></span><span class="op" id="1751758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1751761">func</span>&nbsp;<span class="ident" id="1751766">tracebackinit</span><span class="op" id="1751779">(</span><span class="op" id="1751780">)</span>&nbsp;<span class="op" id="1751782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1751785">//&nbsp;Go&nbsp;variable&nbsp;initialization&nbsp;happens&nbsp;late&nbsp;during&nbsp;runtime&nbsp;startup.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1751853">//&nbsp;Instead&nbsp;of&nbsp;initializing&nbsp;the&nbsp;variables&nbsp;above&nbsp;in&nbsp;the&nbsp;declarations,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1751922">//&nbsp;schedinit&nbsp;calls&nbsp;this&nbsp;function&nbsp;so&nbsp;that&nbsp;the&nbsp;variables&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1751982">//&nbsp;initialized&nbsp;and&nbsp;available&nbsp;earlier&nbsp;in&nbsp;the&nbsp;startup&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752045">deferprocPC</span>&nbsp;<span class="op" id="1752057">=</span>&nbsp;<span class="ident" id="1752059">funcPC</span><span class="op" id="1752065">(</span><span class="ident" id="1752066">deferproc</span><span class="op" id="1752075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752078">goexitPC</span>&nbsp;<span class="op" id="1752087">=</span>&nbsp;<span class="ident" id="1752089">funcPC</span><span class="op" id="1752095">(</span><span class="ident" id="1752096">goexit</span><span class="op" id="1752102">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752105">jmpdeferPC</span>&nbsp;<span class="op" id="1752116">=</span>&nbsp;<span class="ident" id="1752118">funcPC</span><span class="op" id="1752124">(</span><span class="ident" id="1752125">jmpdefer</span><span class="op" id="1752133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752136">mcallPC</span>&nbsp;<span class="op" id="1752144">=</span>&nbsp;<span class="ident" id="1752146">funcPC</span><span class="op" id="1752152">(</span><span class="ident" id="1752153">mcall</span><span class="op" id="1752158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752161">morestackPC</span>&nbsp;<span class="op" id="1752173">=</span>&nbsp;<span class="ident" id="1752175">funcPC</span><span class="op" id="1752181">(</span><span class="ident" id="1752182">morestack</span><span class="op" id="1752191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752194">mstartPC</span>&nbsp;<span class="op" id="1752203">=</span>&nbsp;<span class="ident" id="1752205">funcPC</span><span class="op" id="1752211">(</span><span class="ident" id="1752212">mstart</span><span class="op" id="1752218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752221">newprocPC</span>&nbsp;<span class="op" id="1752231">=</span>&nbsp;<span class="ident" id="1752233">funcPC</span><span class="op" id="1752239">(</span><span class="ident" id="1752240">newproc</span><span class="op" id="1752247">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752250">rt0_goPC</span>&nbsp;<span class="op" id="1752259">=</span>&nbsp;<span class="ident" id="1752261">funcPC</span><span class="op" id="1752267">(</span><span class="ident" id="1752268">rt0_go</span><span class="op" id="1752274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752277">sigpanicPC</span>&nbsp;<span class="op" id="1752288">=</span>&nbsp;<span class="ident" id="1752290">funcPC</span><span class="op" id="1752296">(</span><span class="ident" id="1752297">sigpanic</span><span class="op" id="1752305">)</span><br>
<span class="lineno"></span><span class="op" id="1752307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1752310">//&nbsp;Traceback&nbsp;over&nbsp;the&nbsp;deferred&nbsp;function&nbsp;calls.</span><br>
<span class="lineno">65</span><span class="comment" id="1752357">//&nbsp;Report&nbsp;them&nbsp;like&nbsp;calls&nbsp;that&nbsp;have&nbsp;been&nbsp;invoked&nbsp;but&nbsp;not&nbsp;started&nbsp;executing&nbsp;yet.</span><br>
<span class="lineno"></span><span class="keyword" id="1752437">func</span>&nbsp;<span class="ident" id="1752442">tracebackdefers</span><span class="op" id="1752457">(</span><span class="ident" id="1752458">gp</span>&nbsp;<span class="op" id="1752461">*</span><span class="ident" id="1752462">g</span><span class="op" id="1752463">,</span>&nbsp;<span class="ident" id="1752465">callback</span>&nbsp;<span class="keyword" id="1752474">func</span><span class="op" id="1752478">(</span><span class="op" id="1752479">*</span><span class="ident" id="1752480">stkframe</span><span class="op" id="1752488">,</span>&nbsp;<span class="ident" id="1752490">unsafe</span><span class="op" id="1752496">.</span><span class="ident" id="1752497">Pointer</span><span class="op" id="1752504">)</span>&nbsp;<span class="builtintype" id="1752506">bool</span><span class="op" id="1752510">,</span>&nbsp;<span class="ident" id="1752512">v</span>&nbsp;<span class="ident" id="1752514">unsafe</span><span class="op" id="1752520">.</span><span class="ident" id="1752521">Pointer</span><span class="op" id="1752528">)</span>&nbsp;<span class="op" id="1752530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1752533">var</span>&nbsp;<span class="ident" id="1752537">frame</span>&nbsp;<span class="ident" id="1752543">stkframe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1752553">for</span>&nbsp;<span class="ident" id="1752557">d</span>&nbsp;<span class="op" id="1752559">:=</span>&nbsp;<span class="ident" id="1752562">gp</span><span class="op" id="1752564">.</span><span class="ident" id="1752565">_defer</span><span class="op" id="1752571">;</span>&nbsp;<span class="ident" id="1752573">d</span>&nbsp;<span class="op" id="1752575">!=</span>&nbsp;<span class="ident" id="1752578">nil</span><span class="op" id="1752581">;</span>&nbsp;<span class="ident" id="1752583">d</span>&nbsp;<span class="op" id="1752585">=</span>&nbsp;<span class="ident" id="1752587">d</span><span class="op" id="1752588">.</span><span class="ident" id="1752589">link</span>&nbsp;<span class="op" id="1752594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752598">fn</span>&nbsp;<span class="op" id="1752601">:=</span>&nbsp;<span class="ident" id="1752604">d</span><span class="op" id="1752605">.</span><span class="ident" id="1752606">fn</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1752611">if</span>&nbsp;<span class="ident" id="1752614">fn</span>&nbsp;<span class="op" id="1752617">==</span>&nbsp;<span class="ident" id="1752620">nil</span>&nbsp;<span class="op" id="1752624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1752629">//&nbsp;Defer&nbsp;of&nbsp;nil&nbsp;function.&nbsp;Args&nbsp;don&#39;t&nbsp;matter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752677">frame</span><span class="op" id="1752682">.</span><span class="ident" id="1752683">pc</span>&nbsp;<span class="op" id="1752686">=</span>&nbsp;<span class="num" id="1752688">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752693">frame</span><span class="op" id="1752698">.</span><span class="ident" id="1752699">fn</span>&nbsp;<span class="op" id="1752702">=</span>&nbsp;<span class="ident" id="1752704">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752711">frame</span><span class="op" id="1752716">.</span><span class="ident" id="1752717">argp</span>&nbsp;<span class="op" id="1752722">=</span>&nbsp;<span class="num" id="1752724">0</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752729">frame</span><span class="op" id="1752734">.</span><span class="ident" id="1752735">arglen</span>&nbsp;<span class="op" id="1752742">=</span>&nbsp;<span class="num" id="1752744">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752749">frame</span><span class="op" id="1752754">.</span><span class="ident" id="1752755">argmap</span>&nbsp;<span class="op" id="1752762">=</span>&nbsp;<span class="ident" id="1752764">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1752770">}</span>&nbsp;<span class="keyword" id="1752772">else</span>&nbsp;<span class="op" id="1752777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752782">frame</span><span class="op" id="1752787">.</span><span class="ident" id="1752788">pc</span>&nbsp;<span class="op" id="1752791">=</span>&nbsp;<span class="builtintype" id="1752793">uintptr</span><span class="op" id="1752800">(</span><span class="ident" id="1752801">fn</span><span class="op" id="1752803">.</span><span class="ident" id="1752804">fn</span><span class="op" id="1752806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752811">f</span>&nbsp;<span class="op" id="1752813">:=</span>&nbsp;<span class="ident" id="1752816">findfunc</span><span class="op" id="1752824">(</span><span class="ident" id="1752825">frame</span><span class="op" id="1752830">.</span><span class="ident" id="1752831">pc</span><span class="op" id="1752833">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1752838">if</span>&nbsp;<span class="ident" id="1752841">f</span>&nbsp;<span class="op" id="1752843">==</span>&nbsp;<span class="ident" id="1752846">nil</span>&nbsp;<span class="op" id="1752850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1752856">print</span><span class="op" id="1752861">(</span><span class="string" id="1752862">&#34;runtime:&nbsp;unknown&nbsp;pc&nbsp;in&nbsp;defer&nbsp;&#34;</span><span class="op" id="1752893">,</span>&nbsp;<span class="ident" id="1752895">hex</span><span class="op" id="1752898">(</span><span class="ident" id="1752899">frame</span><span class="op" id="1752904">.</span><span class="ident" id="1752905">pc</span><span class="op" id="1752907">)</span><span class="op" id="1752908">,</span>&nbsp;<span class="string" id="1752910">&#34;\n&#34;</span><span class="op" id="1752914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752920">gothrow</span><span class="op" id="1752927">(</span><span class="string" id="1752928">&#34;unknown&nbsp;pc&#34;</span><span class="op" id="1752940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1752945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752950">frame</span><span class="op" id="1752955">.</span><span class="ident" id="1752956">fn</span>&nbsp;<span class="op" id="1752959">=</span>&nbsp;<span class="ident" id="1752961">f</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1752966">frame</span><span class="op" id="1752971">.</span><span class="ident" id="1752972">argp</span>&nbsp;<span class="op" id="1752977">=</span>&nbsp;<span class="builtintype" id="1752979">uintptr</span><span class="op" id="1752986">(</span><span class="ident" id="1752987">deferArgs</span><span class="op" id="1752996">(</span><span class="ident" id="1752997">d</span><span class="op" id="1752998">)</span><span class="op" id="1752999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1753004">setArgInfo</span><span class="op" id="1753014">(</span><span class="op" id="1753015">&amp;</span><span class="ident" id="1753016">frame</span><span class="op" id="1753021">,</span>&nbsp;<span class="ident" id="1753023">f</span><span class="op" id="1753024">,</span>&nbsp;<span class="ident" id="1753026">true</span><span class="op" id="1753030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1753034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1753038">frame</span><span class="op" id="1753043">.</span><span class="ident" id="1753044">continpc</span>&nbsp;<span class="op" id="1753053">=</span>&nbsp;<span class="ident" id="1753055">frame</span><span class="op" id="1753060">.</span><span class="ident" id="1753061">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1753066">if</span>&nbsp;<span class="op" id="1753069">!</span><span class="ident" id="1753070">callback</span><span class="op" id="1753078">(</span><span class="op" id="1753079">(</span><span class="op" id="1753080">*</span><span class="ident" id="1753081">stkframe</span><span class="op" id="1753089">)</span><span class="op" id="1753090">(</span><span class="ident" id="1753091">noescape</span><span class="op" id="1753099">(</span><span class="ident" id="1753100">unsafe</span><span class="op" id="1753106">.</span><span class="ident" id="1753107">Pointer</span><span class="op" id="1753114">(</span><span class="op" id="1753115">&amp;</span><span class="ident" id="1753116">frame</span><span class="op" id="1753121">)</span><span class="op" id="1753122">)</span><span class="op" id="1753123">)</span><span class="op" id="1753124">,</span>&nbsp;<span class="ident" id="1753126">v</span><span class="op" id="1753127">)</span>&nbsp;<span class="op" id="1753129">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1753134">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1753143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1753146">}</span><br>
<span class="lineno"></span><span class="op" id="1753148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="1753151">//&nbsp;Generic&nbsp;traceback.&nbsp;&nbsp;Handles&nbsp;runtime&nbsp;stack&nbsp;prints&nbsp;(pcbuf&nbsp;==&nbsp;nil),</span><br>
<span class="lineno"></span><span class="comment" id="1753219">//&nbsp;the&nbsp;runtime.Callers&nbsp;function&nbsp;(pcbuf&nbsp;!=&nbsp;nil),&nbsp;as&nbsp;well&nbsp;as&nbsp;the&nbsp;garbage</span><br>
<span class="lineno"></span><span class="comment" id="1753290">//&nbsp;collector&nbsp;(callback&nbsp;!=&nbsp;nil).&nbsp;&nbsp;A&nbsp;little&nbsp;clunky&nbsp;to&nbsp;merge&nbsp;these,&nbsp;but&nbsp;avoids</span><br>
<span class="lineno"></span><span class="comment" id="1753366">//&nbsp;duplicating&nbsp;the&nbsp;code&nbsp;and&nbsp;all&nbsp;its&nbsp;subtlety.</span><br>
<span class="lineno"></span><span class="keyword" id="1753412">func</span>&nbsp;<span class="ident" id="1753417">gentraceback</span><span class="op" id="1753429">(</span><span class="ident" id="1753430">pc0</span>&nbsp;<span class="builtintype" id="1753434">uintptr</span><span class="op" id="1753441">,</span>&nbsp;<span class="ident" id="1753443">sp0</span>&nbsp;<span class="builtintype" id="1753447">uintptr</span><span class="op" id="1753454">,</span>&nbsp;<span class="ident" id="1753456">lr0</span>&nbsp;<span class="builtintype" id="1753460">uintptr</span><span class="op" id="1753467">,</span>&nbsp;<span class="ident" id="1753469">gp</span>&nbsp;<span class="op" id="1753472">*</span><span class="ident" id="1753473">g</span><span class="op" id="1753474">,</span>&nbsp;<span class="ident" id="1753476">skip</span>&nbsp;<span class="builtintype" id="1753481">int</span><span class="op" id="1753484">,</span>&nbsp;<span class="ident" id="1753486">pcbuf</span>&nbsp;<span class="op" id="1753492">*</span><span class="builtintype" id="1753493">uintptr</span><span class="op" id="1753500">,</span>&nbsp;<span class="ident" id="1753502">max</span>&nbsp;<span class="builtintype" id="1753506">int</span><span class="op" id="1753509">,</span>&nbsp;<span class="ident" id="1753511">callback</span>&nbsp;<span class="keyword" id="1753520">func</span><span class="op" id="1753524">(</span><span class="op" id="1753525">*</span><span class="ident" id="1753526">stkframe</span><span class="op" id="1753534">,</span>&nbsp;<span class="ident" id="1753536">unsafe</span><span class="op" id="1753542">.</span><span class="ident" id="1753543">Pointer</span><span class="op" id="1753550">)</span>&nbsp;<span class="builtintype" id="1753552">bool</span><span class="op" id="1753556">,</span>&nbsp;<span class="ident" id="1753558">v</span>&nbsp;<span class="ident" id="1753560">unsafe</span><span class="op" id="1753566">.</span><span class="ident" id="1753567">Pointer</span><span class="op" id="1753574">,</span>&nbsp;<span class="ident" id="1753576">flags</span>&nbsp;<span class="builtintype" id="1753582">uint</span><span class="op" id="1753586">)</span>&nbsp;<span class="builtintype" id="1753588">int</span>&nbsp;<span class="op" id="1753592">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1753595">if</span>&nbsp;<span class="ident" id="1753598">goexitPC</span>&nbsp;<span class="op" id="1753607">==</span>&nbsp;<span class="num" id="1753610">0</span>&nbsp;<span class="op" id="1753612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1753616">gothrow</span><span class="op" id="1753623">(</span><span class="string" id="1753624">&#34;gentraceback&nbsp;before&nbsp;goexitPC&nbsp;initialization&#34;</span><span class="op" id="1753669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1753672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1753675">g</span>&nbsp;<span class="op" id="1753677">:=</span>&nbsp;<span class="ident" id="1753680">getg</span><span class="op" id="1753684">(</span><span class="op" id="1753685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1753688">if</span>&nbsp;<span class="ident" id="1753691">g</span>&nbsp;<span class="op" id="1753693">==</span>&nbsp;<span class="ident" id="1753696">gp</span>&nbsp;<span class="op" id="1753699">&amp;&amp;</span>&nbsp;<span class="ident" id="1753702">g</span>&nbsp;<span class="op" id="1753704">==</span>&nbsp;<span class="ident" id="1753707">g</span><span class="op" id="1753708">.</span><span class="ident" id="1753709">m</span><span class="op" id="1753710">.</span><span class="ident" id="1753711">curg</span>&nbsp;<span class="op" id="1753716">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1753720">//&nbsp;The&nbsp;starting&nbsp;sp&nbsp;has&nbsp;been&nbsp;passed&nbsp;in&nbsp;as&nbsp;a&nbsp;uintptr,&nbsp;and&nbsp;the&nbsp;caller&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1753793">//&nbsp;have&nbsp;other&nbsp;uintptr-typed&nbsp;stack&nbsp;references&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1753849">//&nbsp;If&nbsp;during&nbsp;one&nbsp;of&nbsp;the&nbsp;calls&nbsp;that&nbsp;got&nbsp;us&nbsp;here&nbsp;or&nbsp;during&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1753919">//&nbsp;callbacks&nbsp;below&nbsp;the&nbsp;stack&nbsp;must&nbsp;be&nbsp;grown,&nbsp;all&nbsp;these&nbsp;uintptr&nbsp;references</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1753994">//&nbsp;to&nbsp;the&nbsp;stack&nbsp;will&nbsp;not&nbsp;be&nbsp;updated,&nbsp;and&nbsp;gentraceback&nbsp;will&nbsp;continue</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1754064">//&nbsp;to&nbsp;inspect&nbsp;the&nbsp;old&nbsp;stack&nbsp;memory,&nbsp;which&nbsp;may&nbsp;no&nbsp;longer&nbsp;be&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1754132">//&nbsp;Even&nbsp;if&nbsp;all&nbsp;the&nbsp;variables&nbsp;were&nbsp;updated&nbsp;correctly,&nbsp;it&nbsp;is&nbsp;not&nbsp;clear&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1754208">//&nbsp;we&nbsp;want&nbsp;to&nbsp;expose&nbsp;a&nbsp;traceback&nbsp;that&nbsp;begins&nbsp;on&nbsp;one&nbsp;stack&nbsp;and&nbsp;ends</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1754277">//&nbsp;on&nbsp;another&nbsp;stack.&nbsp;That&nbsp;could&nbsp;confuse&nbsp;callers&nbsp;quite&nbsp;a&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1754340">//&nbsp;Instead,&nbsp;we&nbsp;require&nbsp;that&nbsp;gentraceback&nbsp;and&nbsp;any&nbsp;other&nbsp;function&nbsp;that</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1754411">//&nbsp;accepts&nbsp;an&nbsp;sp&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;(typically&nbsp;obtained&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1754479">//&nbsp;calling&nbsp;getcallersp)&nbsp;must&nbsp;not&nbsp;run&nbsp;on&nbsp;that&nbsp;goroutine&#39;s&nbsp;stack&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1754548">//&nbsp;instead&nbsp;on&nbsp;the&nbsp;g0&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754578">gothrow</span><span class="op" id="1754585">(</span><span class="string" id="1754586">&#34;gentraceback&nbsp;cannot&nbsp;trace&nbsp;user&nbsp;goroutine&nbsp;on&nbsp;its&nbsp;own&nbsp;stack&#34;</span><span class="op" id="1754645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1754648">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754651">gotraceback</span>&nbsp;<span class="op" id="1754663">:=</span>&nbsp;<span class="ident" id="1754666">gotraceback</span><span class="op" id="1754677">(</span><span class="ident" id="1754678">nil</span><span class="op" id="1754681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1754684">if</span>&nbsp;<span class="ident" id="1754687">pc0</span>&nbsp;<span class="op" id="1754691">==</span>&nbsp;<span class="op" id="1754694">^</span><span class="builtintype" id="1754695">uintptr</span><span class="op" id="1754702">(</span><span class="num" id="1754703">0</span><span class="op" id="1754704">)</span>&nbsp;<span class="op" id="1754706">&amp;&amp;</span>&nbsp;<span class="ident" id="1754709">sp0</span>&nbsp;<span class="op" id="1754713">==</span>&nbsp;<span class="op" id="1754716">^</span><span class="builtintype" id="1754717">uintptr</span><span class="op" id="1754724">(</span><span class="num" id="1754725">0</span><span class="op" id="1754726">)</span>&nbsp;<span class="op" id="1754728">{</span>&nbsp;<span class="comment" id="1754730">//&nbsp;Signal&nbsp;to&nbsp;fetch&nbsp;saved&nbsp;values&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1754773">if</span>&nbsp;<span class="ident" id="1754776">gp</span><span class="op" id="1754778">.</span><span class="ident" id="1754779">syscallsp</span>&nbsp;<span class="op" id="1754789">!=</span>&nbsp;<span class="num" id="1754792">0</span>&nbsp;<span class="op" id="1754794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754799">pc0</span>&nbsp;<span class="op" id="1754803">=</span>&nbsp;<span class="ident" id="1754805">gp</span><span class="op" id="1754807">.</span><span class="ident" id="1754808">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754821">sp0</span>&nbsp;<span class="op" id="1754825">=</span>&nbsp;<span class="ident" id="1754827">gp</span><span class="op" id="1754829">.</span><span class="ident" id="1754830">syscallsp</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1754843">if</span>&nbsp;<span class="ident" id="1754846">usesLR</span>&nbsp;<span class="op" id="1754853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754859">lr0</span>&nbsp;<span class="op" id="1754863">=</span>&nbsp;<span class="num" id="1754865">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1754870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1754874">}</span>&nbsp;<span class="keyword" id="1754876">else</span>&nbsp;<span class="op" id="1754881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754886">pc0</span>&nbsp;<span class="op" id="1754890">=</span>&nbsp;<span class="ident" id="1754892">gp</span><span class="op" id="1754894">.</span><span class="ident" id="1754895">sched</span><span class="op" id="1754900">.</span><span class="ident" id="1754901">pc</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754907">sp0</span>&nbsp;<span class="op" id="1754911">=</span>&nbsp;<span class="ident" id="1754913">gp</span><span class="op" id="1754915">.</span><span class="ident" id="1754916">sched</span><span class="op" id="1754921">.</span><span class="ident" id="1754922">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1754928">if</span>&nbsp;<span class="ident" id="1754931">usesLR</span>&nbsp;<span class="op" id="1754938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754944">lr0</span>&nbsp;<span class="op" id="1754948">=</span>&nbsp;<span class="ident" id="1754950">gp</span><span class="op" id="1754952">.</span><span class="ident" id="1754953">sched</span><span class="op" id="1754958">.</span><span class="ident" id="1754959">lr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1754965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1754969">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1754972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754976">nprint</span>&nbsp;<span class="op" id="1754983">:=</span>&nbsp;<span class="num" id="1754986">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1754989">var</span>&nbsp;<span class="ident" id="1754993">frame</span>&nbsp;<span class="ident" id="1754999">stkframe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755009">frame</span><span class="op" id="1755014">.</span><span class="ident" id="1755015">pc</span>&nbsp;<span class="op" id="1755018">=</span>&nbsp;<span class="ident" id="1755020">pc0</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755025">frame</span><span class="op" id="1755030">.</span><span class="ident" id="1755031">sp</span>&nbsp;<span class="op" id="1755034">=</span>&nbsp;<span class="ident" id="1755036">sp0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755041">if</span>&nbsp;<span class="ident" id="1755044">usesLR</span>&nbsp;<span class="op" id="1755051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755055">frame</span><span class="op" id="1755060">.</span><span class="ident" id="1755061">lr</span>&nbsp;<span class="op" id="1755064">=</span>&nbsp;<span class="ident" id="1755066">lr0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1755071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755074">waspanic</span>&nbsp;<span class="op" id="1755083">:=</span>&nbsp;<span class="ident" id="1755086">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755093">wasnewproc</span>&nbsp;<span class="op" id="1755104">:=</span>&nbsp;<span class="ident" id="1755107">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755114">printing</span>&nbsp;<span class="op" id="1755123">:=</span>&nbsp;<span class="ident" id="1755126">pcbuf</span>&nbsp;<span class="op" id="1755132">==</span>&nbsp;<span class="ident" id="1755135">nil</span>&nbsp;<span class="op" id="1755139">&amp;&amp;</span>&nbsp;<span class="ident" id="1755142">callback</span>&nbsp;<span class="op" id="1755151">==</span>&nbsp;<span class="ident" id="1755154">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755159">_defer</span>&nbsp;<span class="op" id="1755166">:=</span>&nbsp;<span class="ident" id="1755169">gp</span><span class="op" id="1755171">.</span><span class="ident" id="1755172">_defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755181">for</span>&nbsp;<span class="ident" id="1755185">_defer</span>&nbsp;<span class="op" id="1755192">!=</span>&nbsp;<span class="ident" id="1755195">nil</span>&nbsp;<span class="op" id="1755199">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1755202">uintptr</span><span class="op" id="1755209">(</span><span class="ident" id="1755210">_defer</span><span class="op" id="1755216">.</span><span class="ident" id="1755217">argp</span><span class="op" id="1755221">)</span>&nbsp;<span class="op" id="1755223">==</span>&nbsp;<span class="ident" id="1755226">_NoArgs</span>&nbsp;<span class="op" id="1755234">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755238">_defer</span>&nbsp;<span class="op" id="1755245">=</span>&nbsp;<span class="ident" id="1755247">_defer</span><span class="op" id="1755253">.</span><span class="ident" id="1755254">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1755260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1755264">//&nbsp;If&nbsp;the&nbsp;PC&nbsp;is&nbsp;zero,&nbsp;it&#39;s&nbsp;likely&nbsp;a&nbsp;nil&nbsp;function&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1755320">//&nbsp;Start&nbsp;in&nbsp;the&nbsp;caller&#39;s&nbsp;frame.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755353">if</span>&nbsp;<span class="ident" id="1755356">frame</span><span class="op" id="1755361">.</span><span class="ident" id="1755362">pc</span>&nbsp;<span class="op" id="1755365">==</span>&nbsp;<span class="num" id="1755368">0</span>&nbsp;<span class="op" id="1755370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755374">if</span>&nbsp;<span class="ident" id="1755377">usesLR</span>&nbsp;<span class="op" id="1755384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755389">frame</span><span class="op" id="1755394">.</span><span class="ident" id="1755395">pc</span>&nbsp;<span class="op" id="1755398">=</span>&nbsp;<span class="op" id="1755400">*</span><span class="op" id="1755401">(</span><span class="op" id="1755402">*</span><span class="builtintype" id="1755403">uintptr</span><span class="op" id="1755410">)</span><span class="op" id="1755411">(</span><span class="ident" id="1755412">unsafe</span><span class="op" id="1755418">.</span><span class="ident" id="1755419">Pointer</span><span class="op" id="1755426">(</span><span class="ident" id="1755427">frame</span><span class="op" id="1755432">.</span><span class="ident" id="1755433">sp</span><span class="op" id="1755435">)</span><span class="op" id="1755436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755441">frame</span><span class="op" id="1755446">.</span><span class="ident" id="1755447">lr</span>&nbsp;<span class="op" id="1755450">=</span>&nbsp;<span class="num" id="1755452">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1755456">}</span>&nbsp;<span class="keyword" id="1755458">else</span>&nbsp;<span class="op" id="1755463">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755468">frame</span><span class="op" id="1755473">.</span><span class="ident" id="1755474">pc</span>&nbsp;<span class="op" id="1755477">=</span>&nbsp;<span class="builtintype" id="1755479">uintptr</span><span class="op" id="1755486">(</span><span class="op" id="1755487">*</span><span class="op" id="1755488">(</span><span class="op" id="1755489">*</span><span class="ident" id="1755490">uintreg</span><span class="op" id="1755497">)</span><span class="op" id="1755498">(</span><span class="ident" id="1755499">unsafe</span><span class="op" id="1755505">.</span><span class="ident" id="1755506">Pointer</span><span class="op" id="1755513">(</span><span class="ident" id="1755514">frame</span><span class="op" id="1755519">.</span><span class="ident" id="1755520">sp</span><span class="op" id="1755522">)</span><span class="op" id="1755523">)</span><span class="op" id="1755524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755529">frame</span><span class="op" id="1755534">.</span><span class="ident" id="1755535">sp</span>&nbsp;<span class="op" id="1755538">+=</span>&nbsp;<span class="ident" id="1755541">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1755551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1755554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755558">f</span>&nbsp;<span class="op" id="1755560">:=</span>&nbsp;<span class="ident" id="1755563">findfunc</span><span class="op" id="1755571">(</span><span class="ident" id="1755572">frame</span><span class="op" id="1755577">.</span><span class="ident" id="1755578">pc</span><span class="op" id="1755580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755583">if</span>&nbsp;<span class="ident" id="1755586">f</span>&nbsp;<span class="op" id="1755588">==</span>&nbsp;<span class="ident" id="1755591">nil</span>&nbsp;<span class="op" id="1755595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755599">if</span>&nbsp;<span class="ident" id="1755602">callback</span>&nbsp;<span class="op" id="1755611">!=</span>&nbsp;<span class="ident" id="1755614">nil</span>&nbsp;<span class="op" id="1755618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1755623">print</span><span class="op" id="1755628">(</span><span class="string" id="1755629">&#34;runtime:&nbsp;unknown&nbsp;pc&nbsp;&#34;</span><span class="op" id="1755651">,</span>&nbsp;<span class="ident" id="1755653">hex</span><span class="op" id="1755656">(</span><span class="ident" id="1755657">frame</span><span class="op" id="1755662">.</span><span class="ident" id="1755663">pc</span><span class="op" id="1755665">)</span><span class="op" id="1755666">,</span>&nbsp;<span class="string" id="1755668">&#34;\n&#34;</span><span class="op" id="1755672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755677">gothrow</span><span class="op" id="1755684">(</span><span class="string" id="1755685">&#34;unknown&nbsp;pc&#34;</span><span class="op" id="1755697">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1755701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755705">return</span>&nbsp;<span class="num" id="1755712">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1755715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755718">frame</span><span class="op" id="1755723">.</span><span class="ident" id="1755724">fn</span>&nbsp;<span class="op" id="1755727">=</span>&nbsp;<span class="ident" id="1755729">f</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755733">n</span>&nbsp;<span class="op" id="1755735">:=</span>&nbsp;<span class="num" id="1755738">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755741">for</span>&nbsp;<span class="ident" id="1755745">n</span>&nbsp;<span class="op" id="1755747">&lt;</span>&nbsp;<span class="ident" id="1755749">max</span>&nbsp;<span class="op" id="1755753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1755757">//&nbsp;Typically:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1755773">//&nbsp;&nbsp;&nbsp;&nbsppc&nbsp;is&nbsp;the&nbsp;PC&nbsp;of&nbsp;the&nbsp;running&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1755816">//&nbsp;&nbsp;&nbsp;&nbspsp&nbsp;is&nbsp;the&nbsp;stack&nbsp;pointer&nbsp;at&nbsp;that&nbsp;program&nbsp;counter.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1755870">//&nbsp;&nbsp;&nbsp;&nbspfp&nbsp;is&nbsp;the&nbsp;frame&nbsp;pointer&nbsp;(caller&#39;s&nbsp;stack&nbsp;pointer)&nbsp;at&nbsp;that&nbsp;program&nbsp;counter,&nbsp;or&nbsp;nil&nbsp;if&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1755968">//&nbsp;&nbsp;&nbsp;&nbspstk&nbsp;is&nbsp;the&nbsp;stack&nbsp;containing&nbsp;sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756005">//&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;caller&#39;s&nbsp;program&nbsp;counter&nbsp;is&nbsp;lr,&nbsp;unless&nbsp;lr&nbsp;is&nbsp;zero,&nbsp;in&nbsp;which&nbsp;case&nbsp;it&nbsp;is&nbsp;*(uintptr*)sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1756100">f</span>&nbsp;<span class="op" id="1756102">=</span>&nbsp;<span class="ident" id="1756104">frame</span><span class="op" id="1756109">.</span><span class="ident" id="1756110">fn</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756116">//&nbsp;Found&nbsp;an&nbsp;actual&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756147">//&nbsp;Derive&nbsp;frame&nbsp;pointer&nbsp;and&nbsp;link&nbsp;register.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1756192">if</span>&nbsp;<span class="ident" id="1756195">frame</span><span class="op" id="1756200">.</span><span class="ident" id="1756201">fp</span>&nbsp;<span class="op" id="1756204">==</span>&nbsp;<span class="num" id="1756207">0</span>&nbsp;<span class="op" id="1756209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1756214">frame</span><span class="op" id="1756219">.</span><span class="ident" id="1756220">fp</span>&nbsp;<span class="op" id="1756223">=</span>&nbsp;<span class="ident" id="1756225">frame</span><span class="op" id="1756230">.</span><span class="ident" id="1756231">sp</span>&nbsp;<span class="op" id="1756234">+</span>&nbsp;<span class="builtintype" id="1756236">uintptr</span><span class="op" id="1756243">(</span><span class="ident" id="1756244">funcspdelta</span><span class="op" id="1756255">(</span><span class="ident" id="1756256">f</span><span class="op" id="1756257">,</span>&nbsp;<span class="ident" id="1756259">frame</span><span class="op" id="1756264">.</span><span class="ident" id="1756265">pc</span><span class="op" id="1756267">)</span><span class="op" id="1756268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1756273">if</span>&nbsp;<span class="op" id="1756276">!</span><span class="ident" id="1756277">usesLR</span>&nbsp;<span class="op" id="1756284">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756290">//&nbsp;On&nbsp;x86,&nbsp;call&nbsp;instruction&nbsp;pushes&nbsp;return&nbsp;PC&nbsp;before&nbsp;entering&nbsp;new&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1756369">frame</span><span class="op" id="1756374">.</span><span class="ident" id="1756375">fp</span>&nbsp;<span class="op" id="1756378">+=</span>&nbsp;<span class="ident" id="1756381">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1756392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1756396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1756400">var</span>&nbsp;<span class="ident" id="1756404">flr</span>&nbsp;<span class="op" id="1756408">*</span><span class="ident" id="1756409">_func</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1756417">if</span>&nbsp;<span class="ident" id="1756420">topofstack</span><span class="op" id="1756430">(</span><span class="ident" id="1756431">f</span><span class="op" id="1756432">)</span>&nbsp;<span class="op" id="1756434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1756439">frame</span><span class="op" id="1756444">.</span><span class="ident" id="1756445">lr</span>&nbsp;<span class="op" id="1756448">=</span>&nbsp;<span class="num" id="1756450">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1756455">flr</span>&nbsp;<span class="op" id="1756459">=</span>&nbsp;<span class="ident" id="1756461">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1756467">}</span>&nbsp;<span class="keyword" id="1756469">else</span>&nbsp;<span class="keyword" id="1756474">if</span>&nbsp;<span class="ident" id="1756477">usesLR</span>&nbsp;<span class="op" id="1756484">&amp;&amp;</span>&nbsp;<span class="ident" id="1756487">f</span><span class="op" id="1756488">.</span><span class="ident" id="1756489">entry</span>&nbsp;<span class="op" id="1756495">==</span>&nbsp;<span class="ident" id="1756498">jmpdeferPC</span>&nbsp;<span class="op" id="1756509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756514">//&nbsp;jmpdefer&nbsp;modifies&nbsp;SP/LR/PC&nbsp;non-atomically.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756563">//&nbsp;If&nbsp;a&nbsp;profiling&nbsp;interrupt&nbsp;arrives&nbsp;during&nbsp;jmpdefer,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756619">//&nbsp;the&nbsp;stack&nbsp;unwind&nbsp;may&nbsp;see&nbsp;a&nbsp;mismatched&nbsp;register&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756676">//&nbsp;and&nbsp;get&nbsp;confused.&nbsp;Stop&nbsp;if&nbsp;we&nbsp;see&nbsp;PC&nbsp;within&nbsp;jmpdefer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756734">//&nbsp;to&nbsp;avoid&nbsp;that&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756765">//&nbsp;See&nbsp;golang.org/issue/8153.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1756798">if</span>&nbsp;<span class="ident" id="1756801">callback</span>&nbsp;<span class="op" id="1756810">!=</span>&nbsp;<span class="ident" id="1756813">nil</span>&nbsp;<span class="op" id="1756817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1756823">gothrow</span><span class="op" id="1756830">(</span><span class="string" id="1756831">&#34;traceback_arm:&nbsp;found&nbsp;jmpdefer&nbsp;when&nbsp;tracing&nbsp;with&nbsp;callback&#34;</span><span class="op" id="1756889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1756894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1756899">frame</span><span class="op" id="1756904">.</span><span class="ident" id="1756905">lr</span>&nbsp;<span class="op" id="1756908">=</span>&nbsp;<span class="num" id="1756910">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1756914">}</span>&nbsp;<span class="keyword" id="1756916">else</span>&nbsp;<span class="op" id="1756921">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1756926">if</span>&nbsp;<span class="ident" id="1756929">usesLR</span>&nbsp;<span class="op" id="1756936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1756942">if</span>&nbsp;<span class="ident" id="1756945">n</span>&nbsp;<span class="op" id="1756947">==</span>&nbsp;<span class="num" id="1756950">0</span>&nbsp;<span class="op" id="1756952">&amp;&amp;</span>&nbsp;<span class="ident" id="1756955">frame</span><span class="op" id="1756960">.</span><span class="ident" id="1756961">sp</span>&nbsp;<span class="op" id="1756964">&lt;</span>&nbsp;<span class="ident" id="1756966">frame</span><span class="op" id="1756971">.</span><span class="ident" id="1756972">fp</span>&nbsp;<span class="op" id="1756975">||</span>&nbsp;<span class="ident" id="1756978">frame</span><span class="op" id="1756983">.</span><span class="ident" id="1756984">lr</span>&nbsp;<span class="op" id="1756987">==</span>&nbsp;<span class="num" id="1756990">0</span>&nbsp;<span class="op" id="1756992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1756999">frame</span><span class="op" id="1757004">.</span><span class="ident" id="1757005">lr</span>&nbsp;<span class="op" id="1757008">=</span>&nbsp;<span class="op" id="1757010">*</span><span class="op" id="1757011">(</span><span class="op" id="1757012">*</span><span class="builtintype" id="1757013">uintptr</span><span class="op" id="1757020">)</span><span class="op" id="1757021">(</span><span class="ident" id="1757022">unsafe</span><span class="op" id="1757028">.</span><span class="ident" id="1757029">Pointer</span><span class="op" id="1757036">(</span><span class="ident" id="1757037">frame</span><span class="op" id="1757042">.</span><span class="ident" id="1757043">sp</span><span class="op" id="1757045">)</span><span class="op" id="1757046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757057">}</span>&nbsp;<span class="keyword" id="1757059">else</span>&nbsp;<span class="op" id="1757064">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1757070">if</span>&nbsp;<span class="ident" id="1757073">frame</span><span class="op" id="1757078">.</span><span class="ident" id="1757079">lr</span>&nbsp;<span class="op" id="1757082">==</span>&nbsp;<span class="num" id="1757085">0</span>&nbsp;<span class="op" id="1757087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757094">frame</span><span class="op" id="1757099">.</span><span class="ident" id="1757100">lr</span>&nbsp;<span class="op" id="1757103">=</span>&nbsp;<span class="builtintype" id="1757105">uintptr</span><span class="op" id="1757112">(</span><span class="op" id="1757113">*</span><span class="op" id="1757114">(</span><span class="op" id="1757115">*</span><span class="ident" id="1757116">uintreg</span><span class="op" id="1757123">)</span><span class="op" id="1757124">(</span><span class="ident" id="1757125">unsafe</span><span class="op" id="1757131">.</span><span class="ident" id="1757132">Pointer</span><span class="op" id="1757139">(</span><span class="ident" id="1757140">frame</span><span class="op" id="1757145">.</span><span class="ident" id="1757146">fp</span>&nbsp;<span class="op" id="1757149">-</span>&nbsp;<span class="ident" id="1757151">regSize</span><span class="op" id="1757158">)</span><span class="op" id="1757159">)</span><span class="op" id="1757160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757176">flr</span>&nbsp;<span class="op" id="1757180">=</span>&nbsp;<span class="ident" id="1757182">findfunc</span><span class="op" id="1757190">(</span><span class="ident" id="1757191">frame</span><span class="op" id="1757196">.</span><span class="ident" id="1757197">lr</span><span class="op" id="1757199">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1757204">if</span>&nbsp;<span class="ident" id="1757207">flr</span>&nbsp;<span class="op" id="1757211">==</span>&nbsp;<span class="ident" id="1757214">nil</span>&nbsp;<span class="op" id="1757218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757224">//&nbsp;This&nbsp;happens&nbsp;if&nbsp;you&nbsp;get&nbsp;a&nbsp;profiling&nbsp;interrupt&nbsp;at&nbsp;just&nbsp;the&nbsp;wrong&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757301">//&nbsp;In&nbsp;that&nbsp;context&nbsp;it&nbsp;is&nbsp;okay&nbsp;to&nbsp;stop&nbsp;early.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757350">//&nbsp;But&nbsp;if&nbsp;callback&nbsp;is&nbsp;set,&nbsp;we&#39;re&nbsp;doing&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;and&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757423">//&nbsp;get&nbsp;everything,&nbsp;so&nbsp;crash&nbsp;loudly.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1757463">if</span>&nbsp;<span class="ident" id="1757466">callback</span>&nbsp;<span class="op" id="1757475">!=</span>&nbsp;<span class="ident" id="1757478">nil</span>&nbsp;<span class="op" id="1757482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1757489">print</span><span class="op" id="1757494">(</span><span class="string" id="1757495">&#34;runtime:&nbsp;unexpected&nbsp;return&nbsp;pc&nbsp;for&nbsp;&#34;</span><span class="op" id="1757531">,</span>&nbsp;<span class="ident" id="1757533">gofuncname</span><span class="op" id="1757543">(</span><span class="ident" id="1757544">f</span><span class="op" id="1757545">)</span><span class="op" id="1757546">,</span>&nbsp;<span class="string" id="1757548">&#34;&nbsp;called&nbsp;from&nbsp;&#34;</span><span class="op" id="1757563">,</span>&nbsp;<span class="ident" id="1757565">hex</span><span class="op" id="1757568">(</span><span class="ident" id="1757569">frame</span><span class="op" id="1757574">.</span><span class="ident" id="1757575">lr</span><span class="op" id="1757577">)</span><span class="op" id="1757578">,</span>&nbsp;<span class="string" id="1757580">&#34;\n&#34;</span><span class="op" id="1757584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757591">gothrow</span><span class="op" id="1757598">(</span><span class="string" id="1757599">&#34;unknown&nbsp;caller&nbsp;pc&#34;</span><span class="op" id="1757618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757629">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757638">frame</span><span class="op" id="1757643">.</span><span class="ident" id="1757644">varp</span>&nbsp;<span class="op" id="1757649">=</span>&nbsp;<span class="ident" id="1757651">frame</span><span class="op" id="1757656">.</span><span class="ident" id="1757657">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1757662">if</span>&nbsp;<span class="op" id="1757665">!</span><span class="ident" id="1757666">usesLR</span>&nbsp;<span class="op" id="1757673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757678">//&nbsp;On&nbsp;x86,&nbsp;call&nbsp;instruction&nbsp;pushes&nbsp;return&nbsp;PC&nbsp;before&nbsp;entering&nbsp;new&nbsp;function.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757756">frame</span><span class="op" id="1757761">.</span><span class="ident" id="1757762">varp</span>&nbsp;<span class="op" id="1757767">-=</span>&nbsp;<span class="ident" id="1757770">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757785">//&nbsp;Derive&nbsp;size&nbsp;of&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757816">//&nbsp;Most&nbsp;functions&nbsp;have&nbsp;a&nbsp;fixed-size&nbsp;argument&nbsp;block,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757870">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;metadata&nbsp;about&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757920">//&nbsp;Not&nbsp;all,&nbsp;though:&nbsp;there&nbsp;are&nbsp;some&nbsp;variadic&nbsp;functions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757976">//&nbsp;in&nbsp;package&nbsp;runtime&nbsp;and&nbsp;reflect,&nbsp;and&nbsp;for&nbsp;those&nbsp;we&nbsp;use&nbsp;call-specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758048">//&nbsp;metadata&nbsp;recorded&nbsp;by&nbsp;f&#39;s&nbsp;caller.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1758086">if</span>&nbsp;<span class="ident" id="1758089">callback</span>&nbsp;<span class="op" id="1758098">!=</span>&nbsp;<span class="ident" id="1758101">nil</span>&nbsp;<span class="op" id="1758105">||</span>&nbsp;<span class="ident" id="1758108">printing</span>&nbsp;<span class="op" id="1758117">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758122">frame</span><span class="op" id="1758127">.</span><span class="ident" id="1758128">argp</span>&nbsp;<span class="op" id="1758133">=</span>&nbsp;<span class="ident" id="1758135">frame</span><span class="op" id="1758140">.</span><span class="ident" id="1758141">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1758147">if</span>&nbsp;<span class="ident" id="1758150">usesLR</span>&nbsp;<span class="op" id="1758157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758163">frame</span><span class="op" id="1758168">.</span><span class="ident" id="1758169">argp</span>&nbsp;<span class="op" id="1758174">+=</span>&nbsp;<span class="ident" id="1758177">ptrSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1758188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758193">setArgInfo</span><span class="op" id="1758203">(</span><span class="op" id="1758204">&amp;</span><span class="ident" id="1758205">frame</span><span class="op" id="1758210">,</span>&nbsp;<span class="ident" id="1758212">f</span><span class="op" id="1758213">,</span>&nbsp;<span class="ident" id="1758215">callback</span>&nbsp;<span class="op" id="1758224">!=</span>&nbsp;<span class="ident" id="1758227">nil</span><span class="op" id="1758230">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1758234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758239">//&nbsp;Determine&nbsp;function&nbsp;SP&nbsp;where&nbsp;deferproc&nbsp;would&nbsp;find&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1758308">var</span>&nbsp;<span class="ident" id="1758312">sparg</span>&nbsp;<span class="builtintype" id="1758318">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1758328">if</span>&nbsp;<span class="ident" id="1758331">usesLR</span>&nbsp;<span class="op" id="1758338">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758343">//&nbsp;On&nbsp;link&nbsp;register&nbsp;architectures,&nbsp;that&#39;s&nbsp;the&nbsp;standard&nbsp;bottom-of-stack&nbsp;plus&nbsp;1&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758429">//&nbsp;for&nbsp;the&nbsp;saved&nbsp;LR.&nbsp;If&nbsp;the&nbsp;previous&nbsp;frame&nbsp;was&nbsp;a&nbsp;direct&nbsp;call&nbsp;to&nbsp;newproc/deferproc,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758515">//&nbsp;however,&nbsp;the&nbsp;SP&nbsp;is&nbsp;three&nbsp;words&nbsp;lower&nbsp;than&nbsp;normal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758571">//&nbsp;If&nbsp;the&nbsp;function&nbsp;has&nbsp;no&nbsp;frame&nbsp;at&nbsp;all&nbsp;-&nbsp;perhaps&nbsp;it&nbsp;just&nbsp;started,&nbsp;or&nbsp;perhaps</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758651">//&nbsp;it&nbsp;is&nbsp;a&nbsp;leaf&nbsp;with&nbsp;no&nbsp;local&nbsp;variables&nbsp;-&nbsp;then&nbsp;we&nbsp;cannot&nbsp;possibly&nbsp;find&nbsp;its</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758729">//&nbsp;SP&nbsp;in&nbsp;a&nbsp;defer,&nbsp;and&nbsp;we&nbsp;might&nbsp;confuse&nbsp;its&nbsp;SP&nbsp;for&nbsp;its&nbsp;caller&#39;s&nbsp;SP,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758802">//&nbsp;leave&nbsp;sparg=0&nbsp;in&nbsp;that&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1758836">if</span>&nbsp;<span class="ident" id="1758839">frame</span><span class="op" id="1758844">.</span><span class="ident" id="1758845">fp</span>&nbsp;<span class="op" id="1758848">!=</span>&nbsp;<span class="ident" id="1758851">frame</span><span class="op" id="1758856">.</span><span class="ident" id="1758857">sp</span>&nbsp;<span class="op" id="1758860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758866">sparg</span>&nbsp;<span class="op" id="1758872">=</span>&nbsp;<span class="ident" id="1758874">frame</span><span class="op" id="1758879">.</span><span class="ident" id="1758880">sp</span>&nbsp;<span class="op" id="1758883">+</span>&nbsp;<span class="ident" id="1758885">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1758897">if</span>&nbsp;<span class="ident" id="1758900">wasnewproc</span>&nbsp;<span class="op" id="1758911">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758918">sparg</span>&nbsp;<span class="op" id="1758924">+=</span>&nbsp;<span class="num" id="1758927">3</span>&nbsp;<span class="op" id="1758929">*</span>&nbsp;<span class="ident" id="1758931">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1758943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1758948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1758952">}</span>&nbsp;<span class="keyword" id="1758954">else</span>&nbsp;<span class="op" id="1758959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758964">//&nbsp;On&nbsp;x86&nbsp;that&#39;s&nbsp;the&nbsp;standard&nbsp;bottom-of-stack,&nbsp;so&nbsp;SP&nbsp;exactly.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759029">//&nbsp;If&nbsp;the&nbsp;previous&nbsp;frame&nbsp;was&nbsp;a&nbsp;direct&nbsp;call&nbsp;to&nbsp;newproc/deferproc,&nbsp;however,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759106">//&nbsp;the&nbsp;SP&nbsp;is&nbsp;two&nbsp;words&nbsp;lower&nbsp;than&nbsp;normal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1759151">sparg</span>&nbsp;<span class="op" id="1759157">=</span>&nbsp;<span class="ident" id="1759159">frame</span><span class="op" id="1759164">.</span><span class="ident" id="1759165">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1759171">if</span>&nbsp;<span class="ident" id="1759174">wasnewproc</span>&nbsp;<span class="op" id="1759185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1759191">sparg</span>&nbsp;<span class="op" id="1759197">+=</span>&nbsp;<span class="num" id="1759200">2</span>&nbsp;<span class="op" id="1759202">*</span>&nbsp;<span class="ident" id="1759204">ptrSize</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1759215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1759219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759224">//&nbsp;Determine&nbsp;frame&#39;s&nbsp;&#39;continuation&nbsp;PC&#39;,&nbsp;where&nbsp;it&nbsp;can&nbsp;continue.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759289">//&nbsp;Normally&nbsp;this&nbsp;is&nbsp;the&nbsp;return&nbsp;address&nbsp;on&nbsp;the&nbsp;stack,&nbsp;but&nbsp;if&nbsp;sigpanic</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759360">//&nbsp;is&nbsp;immediately&nbsp;below&nbsp;this&nbsp;function&nbsp;on&nbsp;the&nbsp;stack,&nbsp;then&nbsp;the&nbsp;frame</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759429">//&nbsp;stopped&nbsp;executing&nbsp;due&nbsp;to&nbsp;a&nbsp;trap,&nbsp;and&nbsp;frame.pc&nbsp;is&nbsp;probably&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759496">//&nbsp;a&nbsp;safe&nbsp;point&nbsp;for&nbsp;looking&nbsp;up&nbsp;liveness&nbsp;information.&nbsp;In&nbsp;this&nbsp;panicking&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759575">//&nbsp;the&nbsp;function&nbsp;either&nbsp;doesn&#39;t&nbsp;return&nbsp;at&nbsp;all&nbsp;(if&nbsp;it&nbsp;has&nbsp;no&nbsp;defers&nbsp;or&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759653">//&nbsp;defers&nbsp;do&nbsp;not&nbsp;recover)&nbsp;or&nbsp;it&nbsp;returns&nbsp;from&nbsp;one&nbsp;of&nbsp;the&nbsp;calls&nbsp;to</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759720">//&nbsp;deferproc&nbsp;a&nbsp;second&nbsp;time&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;deferred&nbsp;func&nbsp;recovers).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759796">//&nbsp;It&nbsp;suffices&nbsp;to&nbsp;assume&nbsp;that&nbsp;the&nbsp;most&nbsp;recent&nbsp;deferproc&nbsp;is&nbsp;the&nbsp;one&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759870">//&nbsp;returns;&nbsp;everything&nbsp;live&nbsp;at&nbsp;earlier&nbsp;deferprocs&nbsp;is&nbsp;still&nbsp;live&nbsp;at&nbsp;that&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1759949">frame</span><span class="op" id="1759954">.</span><span class="ident" id="1759955">continpc</span>&nbsp;<span class="op" id="1759964">=</span>&nbsp;<span class="ident" id="1759966">frame</span><span class="op" id="1759971">.</span><span class="ident" id="1759972">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1759977">if</span>&nbsp;<span class="ident" id="1759980">waspanic</span>&nbsp;<span class="op" id="1759989">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1759994">if</span>&nbsp;<span class="ident" id="1759997">_defer</span>&nbsp;<span class="op" id="1760004">!=</span>&nbsp;<span class="ident" id="1760007">nil</span>&nbsp;<span class="op" id="1760011">&amp;&amp;</span>&nbsp;<span class="ident" id="1760014">_defer</span><span class="op" id="1760020">.</span><span class="ident" id="1760021">argp</span>&nbsp;<span class="op" id="1760026">==</span>&nbsp;<span class="ident" id="1760029">sparg</span>&nbsp;<span class="op" id="1760035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1760041">frame</span><span class="op" id="1760046">.</span><span class="ident" id="1760047">continpc</span>&nbsp;<span class="op" id="1760056">=</span>&nbsp;<span class="ident" id="1760058">_defer</span><span class="op" id="1760064">.</span><span class="ident" id="1760065">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760071">}</span>&nbsp;<span class="keyword" id="1760073">else</span>&nbsp;<span class="op" id="1760078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1760084">frame</span><span class="op" id="1760089">.</span><span class="ident" id="1760090">continpc</span>&nbsp;<span class="op" id="1760099">=</span>&nbsp;<span class="num" id="1760101">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760106">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760115">//&nbsp;Unwind&nbsp;our&nbsp;local&nbsp;defer&nbsp;stack&nbsp;past&nbsp;this&nbsp;frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760166">for</span>&nbsp;<span class="ident" id="1760170">_defer</span>&nbsp;<span class="op" id="1760177">!=</span>&nbsp;<span class="ident" id="1760180">nil</span>&nbsp;<span class="op" id="1760184">&amp;&amp;</span>&nbsp;<span class="op" id="1760187">(</span><span class="ident" id="1760188">_defer</span><span class="op" id="1760194">.</span><span class="ident" id="1760195">argp</span>&nbsp;<span class="op" id="1760200">==</span>&nbsp;<span class="ident" id="1760203">sparg</span>&nbsp;<span class="op" id="1760209">||</span>&nbsp;<span class="ident" id="1760212">_defer</span><span class="op" id="1760218">.</span><span class="ident" id="1760219">argp</span>&nbsp;<span class="op" id="1760224">==</span>&nbsp;<span class="ident" id="1760227">_NoArgs</span><span class="op" id="1760234">)</span>&nbsp;<span class="op" id="1760236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1760241">_defer</span>&nbsp;<span class="op" id="1760248">=</span>&nbsp;<span class="ident" id="1760250">_defer</span><span class="op" id="1760256">.</span><span class="ident" id="1760257">link</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760269">if</span>&nbsp;<span class="ident" id="1760272">skip</span>&nbsp;<span class="op" id="1760277">&gt;</span>&nbsp;<span class="num" id="1760279">0</span>&nbsp;<span class="op" id="1760281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1760286">skip</span><span class="op" id="1760290">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760296">goto</span>&nbsp;<span class="ident" id="1760301">skipped</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760316">if</span>&nbsp;<span class="ident" id="1760319">pcbuf</span>&nbsp;<span class="op" id="1760325">!=</span>&nbsp;<span class="ident" id="1760328">nil</span>&nbsp;<span class="op" id="1760332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760337">(</span><span class="op" id="1760338">*</span><span class="op" id="1760339">[</span><span class="num" id="1760340">1</span>&nbsp;<span class="op" id="1760342">&lt;&lt;</span>&nbsp;<span class="num" id="1760345">20</span><span class="op" id="1760347">]</span><span class="builtintype" id="1760348">uintptr</span><span class="op" id="1760355">)</span><span class="op" id="1760356">(</span><span class="ident" id="1760357">unsafe</span><span class="op" id="1760363">.</span><span class="ident" id="1760364">Pointer</span><span class="op" id="1760371">(</span><span class="ident" id="1760372">pcbuf</span><span class="op" id="1760377">)</span><span class="op" id="1760378">)</span><span class="op" id="1760379">[</span><span class="ident" id="1760380">n</span><span class="op" id="1760381">]</span>&nbsp;<span class="op" id="1760383">=</span>&nbsp;<span class="ident" id="1760385">frame</span><span class="op" id="1760390">.</span><span class="ident" id="1760391">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760396">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760400">if</span>&nbsp;<span class="ident" id="1760403">callback</span>&nbsp;<span class="op" id="1760412">!=</span>&nbsp;<span class="ident" id="1760415">nil</span>&nbsp;<span class="op" id="1760419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760424">if</span>&nbsp;<span class="op" id="1760427">!</span><span class="ident" id="1760428">callback</span><span class="op" id="1760436">(</span><span class="op" id="1760437">(</span><span class="op" id="1760438">*</span><span class="ident" id="1760439">stkframe</span><span class="op" id="1760447">)</span><span class="op" id="1760448">(</span><span class="ident" id="1760449">noescape</span><span class="op" id="1760457">(</span><span class="ident" id="1760458">unsafe</span><span class="op" id="1760464">.</span><span class="ident" id="1760465">Pointer</span><span class="op" id="1760472">(</span><span class="op" id="1760473">&amp;</span><span class="ident" id="1760474">frame</span><span class="op" id="1760479">)</span><span class="op" id="1760480">)</span><span class="op" id="1760481">)</span><span class="op" id="1760482">,</span>&nbsp;<span class="ident" id="1760484">v</span><span class="op" id="1760485">)</span>&nbsp;<span class="op" id="1760487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760493">return</span>&nbsp;<span class="ident" id="1760500">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760509">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760513">if</span>&nbsp;<span class="ident" id="1760516">printing</span>&nbsp;<span class="op" id="1760525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760530">if</span>&nbsp;<span class="op" id="1760533">(</span><span class="ident" id="1760534">flags</span><span class="op" id="1760539">&amp;</span><span class="ident" id="1760540">_TraceRuntimeFrames</span><span class="op" id="1760559">)</span>&nbsp;<span class="op" id="1760561">!=</span>&nbsp;<span class="num" id="1760564">0</span>&nbsp;<span class="op" id="1760566">||</span>&nbsp;<span class="ident" id="1760569">showframe</span><span class="op" id="1760578">(</span><span class="ident" id="1760579">f</span><span class="op" id="1760580">,</span>&nbsp;<span class="ident" id="1760582">gp</span><span class="op" id="1760584">)</span>&nbsp;<span class="op" id="1760586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760592">//&nbsp;Print&nbsp;during&nbsp;crash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760619">//&nbsp;&nbsp;&nbsp;&nbspmain(0x1,&nbsp;0x2,&nbsp;0x3)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760646">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/home/rsc/go/src/runtime/x.go:23&nbsp;+0xf</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760692">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1760699">tracepc</span>&nbsp;<span class="op" id="1760707">:=</span>&nbsp;<span class="ident" id="1760710">frame</span><span class="op" id="1760715">.</span><span class="ident" id="1760716">pc</span>&nbsp;<span class="comment" id="1760719">//&nbsp;back&nbsp;up&nbsp;to&nbsp;CALL&nbsp;instruction&nbsp;for&nbsp;funcline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760768">if</span>&nbsp;<span class="op" id="1760771">(</span><span class="ident" id="1760772">n</span>&nbsp;<span class="op" id="1760774">&gt;</span>&nbsp;<span class="num" id="1760776">0</span>&nbsp;<span class="op" id="1760778">||</span>&nbsp;<span class="ident" id="1760781">flags</span><span class="op" id="1760786">&amp;</span><span class="ident" id="1760787">_TraceTrap</span>&nbsp;<span class="op" id="1760798">==</span>&nbsp;<span class="num" id="1760801">0</span><span class="op" id="1760802">)</span>&nbsp;<span class="op" id="1760804">&amp;&amp;</span>&nbsp;<span class="ident" id="1760807">frame</span><span class="op" id="1760812">.</span><span class="ident" id="1760813">pc</span>&nbsp;<span class="op" id="1760816">&gt;</span>&nbsp;<span class="ident" id="1760818">f</span><span class="op" id="1760819">.</span><span class="ident" id="1760820">entry</span>&nbsp;<span class="op" id="1760826">&amp;&amp;</span>&nbsp;<span class="op" id="1760829">!</span><span class="ident" id="1760830">waspanic</span>&nbsp;<span class="op" id="1760839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1760846">tracepc</span><span class="op" id="1760853">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760860">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1760866">print</span><span class="op" id="1760871">(</span><span class="ident" id="1760872">gofuncname</span><span class="op" id="1760882">(</span><span class="ident" id="1760883">f</span><span class="op" id="1760884">)</span><span class="op" id="1760885">,</span>&nbsp;<span class="string" id="1760887">&#34;(&#34;</span><span class="op" id="1760890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1760896">argp</span>&nbsp;<span class="op" id="1760901">:=</span>&nbsp;<span class="op" id="1760904">(</span><span class="op" id="1760905">*</span><span class="op" id="1760906">[</span><span class="num" id="1760907">100</span><span class="op" id="1760910">]</span><span class="builtintype" id="1760911">uintptr</span><span class="op" id="1760918">)</span><span class="op" id="1760919">(</span><span class="ident" id="1760920">unsafe</span><span class="op" id="1760926">.</span><span class="ident" id="1760927">Pointer</span><span class="op" id="1760934">(</span><span class="ident" id="1760935">frame</span><span class="op" id="1760940">.</span><span class="ident" id="1760941">argp</span><span class="op" id="1760945">)</span><span class="op" id="1760946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760952">for</span>&nbsp;<span class="ident" id="1760956">i</span>&nbsp;<span class="op" id="1760958">:=</span>&nbsp;<span class="builtintype" id="1760961">uintptr</span><span class="op" id="1760968">(</span><span class="num" id="1760969">0</span><span class="op" id="1760970">)</span><span class="op" id="1760971">;</span>&nbsp;<span class="ident" id="1760973">i</span>&nbsp;<span class="op" id="1760975">&lt;</span>&nbsp;<span class="ident" id="1760977">frame</span><span class="op" id="1760982">.</span><span class="ident" id="1760983">arglen</span><span class="op" id="1760989">/</span><span class="ident" id="1760990">ptrSize</span><span class="op" id="1760997">;</span>&nbsp;<span class="ident" id="1760999">i</span><span class="op" id="1761000">++</span>&nbsp;<span class="op" id="1761003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1761010">if</span>&nbsp;<span class="ident" id="1761013">i</span>&nbsp;<span class="op" id="1761015">&gt;=</span>&nbsp;<span class="num" id="1761018">10</span>&nbsp;<span class="op" id="1761021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1761029">print</span><span class="op" id="1761034">(</span><span class="string" id="1761035">&#34;,&nbsp;...&#34;</span><span class="op" id="1761042">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1761050">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1761061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1761068">if</span>&nbsp;<span class="ident" id="1761071">i</span>&nbsp;<span class="op" id="1761073">!=</span>&nbsp;<span class="num" id="1761076">0</span>&nbsp;<span class="op" id="1761078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1761086">print</span><span class="op" id="1761091">(</span><span class="string" id="1761092">&#34;,&nbsp;&#34;</span><span class="op" id="1761096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1761103">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1761110">print</span><span class="op" id="1761115">(</span><span class="ident" id="1761116">hex</span><span class="op" id="1761119">(</span><span class="ident" id="1761120">argp</span><span class="op" id="1761124">[</span><span class="ident" id="1761125">i</span><span class="op" id="1761126">]</span><span class="op" id="1761127">)</span><span class="op" id="1761128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1761134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1761140">print</span><span class="op" id="1761145">(</span><span class="string" id="1761146">&#34;)\n&#34;</span><span class="op" id="1761151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1761157">var</span>&nbsp;<span class="ident" id="1761161">file</span>&nbsp;<span class="builtintype" id="1761166">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761177">line</span>&nbsp;<span class="op" id="1761182">:=</span>&nbsp;<span class="ident" id="1761185">funcline</span><span class="op" id="1761193">(</span><span class="ident" id="1761194">f</span><span class="op" id="1761195">,</span>&nbsp;<span class="ident" id="1761197">tracepc</span><span class="op" id="1761204">,</span>&nbsp;<span class="op" id="1761206">&amp;</span><span class="ident" id="1761207">file</span><span class="op" id="1761211">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1761217">print</span><span class="op" id="1761222">(</span><span class="string" id="1761223">&#34;\t&#34;</span><span class="op" id="1761227">,</span>&nbsp;<span class="ident" id="1761229">file</span><span class="op" id="1761233">,</span>&nbsp;<span class="string" id="1761235">&#34;:&#34;</span><span class="op" id="1761238">,</span>&nbsp;<span class="ident" id="1761240">line</span><span class="op" id="1761244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1761250">if</span>&nbsp;<span class="ident" id="1761253">frame</span><span class="op" id="1761258">.</span><span class="ident" id="1761259">pc</span>&nbsp;<span class="op" id="1761262">&gt;</span>&nbsp;<span class="ident" id="1761264">f</span><span class="op" id="1761265">.</span><span class="ident" id="1761266">entry</span>&nbsp;<span class="op" id="1761272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1761279">print</span><span class="op" id="1761284">(</span><span class="string" id="1761285">&#34;&nbsp;+&#34;</span><span class="op" id="1761289">,</span>&nbsp;<span class="ident" id="1761291">hex</span><span class="op" id="1761294">(</span><span class="ident" id="1761295">frame</span><span class="op" id="1761300">.</span><span class="ident" id="1761301">pc</span><span class="op" id="1761303">-</span><span class="ident" id="1761304">f</span><span class="op" id="1761305">.</span><span class="ident" id="1761306">entry</span><span class="op" id="1761311">)</span><span class="op" id="1761312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1761318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1761324">if</span>&nbsp;<span class="ident" id="1761327">g</span><span class="op" id="1761328">.</span><span class="ident" id="1761329">m</span><span class="op" id="1761330">.</span><span class="ident" id="1761331">throwing</span>&nbsp;<span class="op" id="1761340">&gt;</span>&nbsp;<span class="num" id="1761342">0</span>&nbsp;<span class="op" id="1761344">&amp;&amp;</span>&nbsp;<span class="ident" id="1761347">gp</span>&nbsp;<span class="op" id="1761350">==</span>&nbsp;<span class="ident" id="1761353">g</span><span class="op" id="1761354">.</span><span class="ident" id="1761355">m</span><span class="op" id="1761356">.</span><span class="ident" id="1761357">curg</span>&nbsp;<span class="op" id="1761362">||</span>&nbsp;<span class="ident" id="1761365">gotraceback</span>&nbsp;<span class="op" id="1761377">&gt;=</span>&nbsp;<span class="num" id="1761380">2</span>&nbsp;<span class="op" id="1761382">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1761389">print</span><span class="op" id="1761394">(</span><span class="string" id="1761395">&#34;&nbsp;fp=&#34;</span><span class="op" id="1761401">,</span>&nbsp;<span class="ident" id="1761403">hex</span><span class="op" id="1761406">(</span><span class="ident" id="1761407">frame</span><span class="op" id="1761412">.</span><span class="ident" id="1761413">fp</span><span class="op" id="1761415">)</span><span class="op" id="1761416">,</span>&nbsp;<span class="string" id="1761418">&#34;&nbsp;sp=&#34;</span><span class="op" id="1761424">,</span>&nbsp;<span class="ident" id="1761426">hex</span><span class="op" id="1761429">(</span><span class="ident" id="1761430">frame</span><span class="op" id="1761435">.</span><span class="ident" id="1761436">sp</span><span class="op" id="1761438">)</span><span class="op" id="1761439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1761445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1761451">print</span><span class="op" id="1761456">(</span><span class="string" id="1761457">&#34;\n&#34;</span><span class="op" id="1761461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761467">nprint</span><span class="op" id="1761473">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1761479">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1761483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761487">n</span><span class="op" id="1761488">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761493">skipped</span><span class="op" id="1761500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761504">waspanic</span>&nbsp;<span class="op" id="1761513">=</span>&nbsp;<span class="ident" id="1761515">f</span><span class="op" id="1761516">.</span><span class="ident" id="1761517">entry</span>&nbsp;<span class="op" id="1761523">==</span>&nbsp;<span class="ident" id="1761526">sigpanicPC</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761539">wasnewproc</span>&nbsp;<span class="op" id="1761550">=</span>&nbsp;<span class="ident" id="1761552">f</span><span class="op" id="1761553">.</span><span class="ident" id="1761554">entry</span>&nbsp;<span class="op" id="1761560">==</span>&nbsp;<span class="ident" id="1761563">newprocPC</span>&nbsp;<span class="op" id="1761573">||</span>&nbsp;<span class="ident" id="1761576">f</span><span class="op" id="1761577">.</span><span class="ident" id="1761578">entry</span>&nbsp;<span class="op" id="1761584">==</span>&nbsp;<span class="ident" id="1761587">deferprocPC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761602">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;past&nbsp;the&nbsp;bottom&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1761651">if</span>&nbsp;<span class="ident" id="1761654">flr</span>&nbsp;<span class="op" id="1761658">==</span>&nbsp;<span class="ident" id="1761661">nil</span>&nbsp;<span class="op" id="1761665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1761670">break</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1761678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761683">//&nbsp;Unwind&nbsp;to&nbsp;next&nbsp;frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761710">frame</span><span class="op" id="1761715">.</span><span class="ident" id="1761716">fn</span>&nbsp;<span class="op" id="1761719">=</span>&nbsp;<span class="ident" id="1761721">flr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761727">frame</span><span class="op" id="1761732">.</span><span class="ident" id="1761733">pc</span>&nbsp;<span class="op" id="1761736">=</span>&nbsp;<span class="ident" id="1761738">frame</span><span class="op" id="1761743">.</span><span class="ident" id="1761744">lr</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761749">frame</span><span class="op" id="1761754">.</span><span class="ident" id="1761755">lr</span>&nbsp;<span class="op" id="1761758">=</span>&nbsp;<span class="num" id="1761760">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761764">frame</span><span class="op" id="1761769">.</span><span class="ident" id="1761770">sp</span>&nbsp;<span class="op" id="1761773">=</span>&nbsp;<span class="ident" id="1761775">frame</span><span class="op" id="1761780">.</span><span class="ident" id="1761781">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761786">frame</span><span class="op" id="1761791">.</span><span class="ident" id="1761792">fp</span>&nbsp;<span class="op" id="1761795">=</span>&nbsp;<span class="num" id="1761797">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761801">frame</span><span class="op" id="1761806">.</span><span class="ident" id="1761807">argmap</span>&nbsp;<span class="op" id="1761814">=</span>&nbsp;<span class="ident" id="1761816">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761823">//&nbsp;On&nbsp;link&nbsp;register&nbsp;architectures,&nbsp;sighandler&nbsp;saves&nbsp;the&nbsp;LR&nbsp;on&nbsp;stack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761893">//&nbsp;before&nbsp;faking&nbsp;a&nbsp;call&nbsp;to&nbsp;sigpanic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1761932">if</span>&nbsp;<span class="ident" id="1761935">usesLR</span>&nbsp;<span class="op" id="1761942">&amp;&amp;</span>&nbsp;<span class="ident" id="1761945">waspanic</span>&nbsp;<span class="op" id="1761954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761959">x</span>&nbsp;<span class="op" id="1761961">:=</span>&nbsp;<span class="op" id="1761964">*</span><span class="op" id="1761965">(</span><span class="op" id="1761966">*</span><span class="builtintype" id="1761967">uintptr</span><span class="op" id="1761974">)</span><span class="op" id="1761975">(</span><span class="ident" id="1761976">unsafe</span><span class="op" id="1761982">.</span><span class="ident" id="1761983">Pointer</span><span class="op" id="1761990">(</span><span class="ident" id="1761991">frame</span><span class="op" id="1761996">.</span><span class="ident" id="1761997">sp</span><span class="op" id="1761999">)</span><span class="op" id="1762000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762005">frame</span><span class="op" id="1762010">.</span><span class="ident" id="1762011">sp</span>&nbsp;<span class="op" id="1762014">+=</span>&nbsp;<span class="ident" id="1762017">ptrSize</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762028">f</span>&nbsp;<span class="op" id="1762030">=</span>&nbsp;<span class="ident" id="1762032">findfunc</span><span class="op" id="1762040">(</span><span class="ident" id="1762041">frame</span><span class="op" id="1762046">.</span><span class="ident" id="1762047">pc</span><span class="op" id="1762049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762054">frame</span><span class="op" id="1762059">.</span><span class="ident" id="1762060">fn</span>&nbsp;<span class="op" id="1762063">=</span>&nbsp;<span class="ident" id="1762065">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762070">if</span>&nbsp;<span class="ident" id="1762073">f</span>&nbsp;<span class="op" id="1762075">==</span>&nbsp;<span class="ident" id="1762078">nil</span>&nbsp;<span class="op" id="1762082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762088">frame</span><span class="op" id="1762093">.</span><span class="ident" id="1762094">pc</span>&nbsp;<span class="op" id="1762097">=</span>&nbsp;<span class="ident" id="1762099">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762104">}</span>&nbsp;<span class="keyword" id="1762106">else</span>&nbsp;<span class="keyword" id="1762111">if</span>&nbsp;<span class="ident" id="1762114">f</span><span class="op" id="1762115">.</span><span class="ident" id="1762116">frame</span>&nbsp;<span class="op" id="1762122">==</span>&nbsp;<span class="num" id="1762125">0</span>&nbsp;<span class="op" id="1762127">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762133">frame</span><span class="op" id="1762138">.</span><span class="ident" id="1762139">lr</span>&nbsp;<span class="op" id="1762142">=</span>&nbsp;<span class="ident" id="1762144">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762160">if</span>&nbsp;<span class="ident" id="1762163">pcbuf</span>&nbsp;<span class="op" id="1762169">==</span>&nbsp;<span class="ident" id="1762172">nil</span>&nbsp;<span class="op" id="1762176">&amp;&amp;</span>&nbsp;<span class="ident" id="1762179">callback</span>&nbsp;<span class="op" id="1762188">==</span>&nbsp;<span class="ident" id="1762191">nil</span>&nbsp;<span class="op" id="1762195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762199">n</span>&nbsp;<span class="op" id="1762201">=</span>&nbsp;<span class="ident" id="1762203">nprint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762215">//&nbsp;If&nbsp;callback&nbsp;!=&nbsp;nil,&nbsp;we&#39;re&nbsp;being&nbsp;called&nbsp;to&nbsp;gather&nbsp;stack&nbsp;information&nbsp;during</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762293">//&nbsp;garbage&nbsp;collection&nbsp;or&nbsp;stack&nbsp;growth.&nbsp;In&nbsp;that&nbsp;context,&nbsp;require&nbsp;that&nbsp;we&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762371">//&nbsp;up&nbsp;the&nbsp;entire&nbsp;defer&nbsp;stack.&nbsp;If&nbsp;not,&nbsp;then&nbsp;there&nbsp;is&nbsp;a&nbsp;bug&nbsp;somewhere&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762448">//&nbsp;garbage&nbsp;collection&nbsp;or&nbsp;stack&nbsp;growth&nbsp;may&nbsp;not&nbsp;have&nbsp;seen&nbsp;the&nbsp;correct&nbsp;picture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762525">//&nbsp;of&nbsp;the&nbsp;stack.&nbsp;Crash&nbsp;now&nbsp;instead&nbsp;of&nbsp;silently&nbsp;executing&nbsp;the&nbsp;garbage&nbsp;collection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762606">//&nbsp;or&nbsp;stack&nbsp;copy&nbsp;incorrectly&nbsp;and&nbsp;setting&nbsp;up&nbsp;for&nbsp;a&nbsp;mysterious&nbsp;crash&nbsp;later.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762681">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762685">//&nbsp;Note&nbsp;that&nbsp;panic&nbsp;!=&nbsp;nil&nbsp;is&nbsp;okay&nbsp;here:&nbsp;there&nbsp;can&nbsp;be&nbsp;leftover&nbsp;panics,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762756">//&nbsp;because&nbsp;the&nbsp;defers&nbsp;on&nbsp;the&nbsp;panic&nbsp;stack&nbsp;do&nbsp;not&nbsp;nest&nbsp;in&nbsp;frame&nbsp;order&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762828">//&nbsp;they&nbsp;do&nbsp;on&nbsp;the&nbsp;defer&nbsp;stack.&nbsp;If&nbsp;you&nbsp;have:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762873">//</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762877">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;1&nbsp;defers&nbsp;d1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762899">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;2&nbsp;defers&nbsp;d2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762921">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;3&nbsp;defers&nbsp;d3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762943">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;4&nbsp;panics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762962">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;4&#39;s&nbsp;panic&nbsp;starts&nbsp;running&nbsp;defers</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763004">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5,&nbsp;running&nbsp;d3,&nbsp;defers&nbsp;d4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763039">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5&nbsp;panics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763058">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5&#39;s&nbsp;panic&nbsp;starts&nbsp;running&nbsp;defers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763100">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;6,&nbsp;running&nbsp;d4,&nbsp;garbage&nbsp;collects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763142">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;6,&nbsp;running&nbsp;d2,&nbsp;garbage&nbsp;collects</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763184">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763188">//&nbsp;During&nbsp;the&nbsp;execution&nbsp;of&nbsp;d4,&nbsp;the&nbsp;panic&nbsp;stack&nbsp;is&nbsp;d4&nbsp;-&gt;&nbsp;d3,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763255">//&nbsp;is&nbsp;nested&nbsp;properly,&nbsp;and&nbsp;we&#39;ll&nbsp;treat&nbsp;frame&nbsp;3&nbsp;as&nbsp;resumable,&nbsp;because&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763328">//&nbsp;can&nbsp;find&nbsp;d3.&nbsp;(And&nbsp;in&nbsp;fact&nbsp;frame&nbsp;3&nbsp;is&nbsp;resumable.&nbsp;If&nbsp;d4&nbsp;recovers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763395">//&nbsp;and&nbsp;frame&nbsp;5&nbsp;continues&nbsp;running,&nbsp;d3,&nbsp;d3&nbsp;can&nbsp;recover&nbsp;and&nbsp;we&#39;ll</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763459">//&nbsp;resume&nbsp;execution&nbsp;in&nbsp;(returning&nbsp;from)&nbsp;frame&nbsp;3.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763510">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763514">//&nbsp;During&nbsp;the&nbsp;execution&nbsp;of&nbsp;d2,&nbsp;however,&nbsp;the&nbsp;panic&nbsp;stack&nbsp;is&nbsp;d2&nbsp;-&gt;&nbsp;d3,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763584">//&nbsp;which&nbsp;is&nbsp;inverted.&nbsp;The&nbsp;scan&nbsp;will&nbsp;match&nbsp;d2&nbsp;to&nbsp;frame&nbsp;2&nbsp;but&nbsp;having</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763652">//&nbsp;d2&nbsp;on&nbsp;the&nbsp;stack&nbsp;until&nbsp;then&nbsp;means&nbsp;it&nbsp;will&nbsp;not&nbsp;match&nbsp;d3&nbsp;to&nbsp;frame&nbsp;3.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763722">//&nbsp;This&nbsp;is&nbsp;okay:&nbsp;if&nbsp;we&#39;re&nbsp;running&nbsp;d2,&nbsp;then&nbsp;all&nbsp;the&nbsp;defers&nbsp;after&nbsp;d2&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763795">//&nbsp;completed&nbsp;and&nbsp;their&nbsp;corresponding&nbsp;frames&nbsp;are&nbsp;dead.&nbsp;Not&nbsp;finding&nbsp;d3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763865">//&nbsp;for&nbsp;frame&nbsp;3&nbsp;means&nbsp;we&#39;ll&nbsp;set&nbsp;frame&nbsp;3&#39;s&nbsp;continpc&nbsp;==&nbsp;0,&nbsp;which&nbsp;is&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763939">//&nbsp;(frame&nbsp;3&nbsp;is&nbsp;dead).&nbsp;At&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;walk&nbsp;the&nbsp;panic&nbsp;stack&nbsp;can&nbsp;thus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764010">//&nbsp;contain&nbsp;defers&nbsp;(d3&nbsp;in&nbsp;this&nbsp;case)&nbsp;for&nbsp;dead&nbsp;frames.&nbsp;The&nbsp;inversion&nbsp;here</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764083">//&nbsp;always&nbsp;indicates&nbsp;a&nbsp;dead&nbsp;frame,&nbsp;and&nbsp;the&nbsp;effect&nbsp;of&nbsp;the&nbsp;inversion&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764157">//&nbsp;scan&nbsp;is&nbsp;to&nbsp;hide&nbsp;those&nbsp;dead&nbsp;frames,&nbsp;so&nbsp;the&nbsp;scan&nbsp;is&nbsp;still&nbsp;okay:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764223">//&nbsp;what&#39;s&nbsp;left&nbsp;on&nbsp;the&nbsp;panic&nbsp;stack&nbsp;are&nbsp;exactly&nbsp;(and&nbsp;only)&nbsp;the&nbsp;dead&nbsp;frames.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764298">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764302">//&nbsp;We&nbsp;require&nbsp;callback&nbsp;!=&nbsp;nil&nbsp;here&nbsp;because&nbsp;only&nbsp;when&nbsp;callback&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764372">//&nbsp;do&nbsp;we&nbsp;know&nbsp;that&nbsp;gentraceback&nbsp;is&nbsp;being&nbsp;called&nbsp;in&nbsp;a&nbsp;&#34;must&nbsp;be&nbsp;correct&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764444">//&nbsp;context&nbsp;as&nbsp;opposed&nbsp;to&nbsp;a&nbsp;&#34;best&nbsp;effort&#34;&nbsp;context.&nbsp;The&nbsp;tracebacks&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764515">//&nbsp;callbacks&nbsp;only&nbsp;happen&nbsp;when&nbsp;everything&nbsp;is&nbsp;stopped&nbsp;nicely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764576">//&nbsp;At&nbsp;other&nbsp;times,&nbsp;such&nbsp;as&nbsp;when&nbsp;gathering&nbsp;a&nbsp;stack&nbsp;for&nbsp;a&nbsp;profiling&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764650">//&nbsp;or&nbsp;when&nbsp;printing&nbsp;a&nbsp;traceback&nbsp;during&nbsp;a&nbsp;crash,&nbsp;everything&nbsp;may&nbsp;not&nbsp;be</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764721">//&nbsp;stopped&nbsp;nicely,&nbsp;and&nbsp;the&nbsp;stack&nbsp;walk&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;complete.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764789">//&nbsp;It&#39;s&nbsp;okay&nbsp;in&nbsp;those&nbsp;situations&nbsp;not&nbsp;to&nbsp;use&nbsp;up&nbsp;the&nbsp;entire&nbsp;defer&nbsp;stack:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764861">//&nbsp;incomplete&nbsp;information&nbsp;then&nbsp;is&nbsp;still&nbsp;better&nbsp;than&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764923">if</span>&nbsp;<span class="ident" id="1764926">callback</span>&nbsp;<span class="op" id="1764935">!=</span>&nbsp;<span class="ident" id="1764938">nil</span>&nbsp;<span class="op" id="1764942">&amp;&amp;</span>&nbsp;<span class="ident" id="1764945">n</span>&nbsp;<span class="op" id="1764947">&lt;</span>&nbsp;<span class="ident" id="1764949">max</span>&nbsp;<span class="op" id="1764953">&amp;&amp;</span>&nbsp;<span class="ident" id="1764956">_defer</span>&nbsp;<span class="op" id="1764963">!=</span>&nbsp;<span class="ident" id="1764966">nil</span>&nbsp;<span class="op" id="1764970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764974">if</span>&nbsp;<span class="ident" id="1764977">_defer</span>&nbsp;<span class="op" id="1764984">!=</span>&nbsp;<span class="ident" id="1764987">nil</span>&nbsp;<span class="op" id="1764991">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1764996">print</span><span class="op" id="1765001">(</span><span class="string" id="1765002">&#34;runtime:&nbsp;g&#34;</span><span class="op" id="1765014">,</span>&nbsp;<span class="ident" id="1765016">gp</span><span class="op" id="1765018">.</span><span class="ident" id="1765019">goid</span><span class="op" id="1765023">,</span>&nbsp;<span class="string" id="1765025">&#34;:&nbsp;leftover&nbsp;defer&nbsp;argp=&#34;</span><span class="op" id="1765049">,</span>&nbsp;<span class="ident" id="1765051">hex</span><span class="op" id="1765054">(</span><span class="ident" id="1765055">_defer</span><span class="op" id="1765061">.</span><span class="ident" id="1765062">argp</span><span class="op" id="1765066">)</span><span class="op" id="1765067">,</span>&nbsp;<span class="string" id="1765069">&#34;&nbsp;pc=&#34;</span><span class="op" id="1765075">,</span>&nbsp;<span class="ident" id="1765077">hex</span><span class="op" id="1765080">(</span><span class="ident" id="1765081">_defer</span><span class="op" id="1765087">.</span><span class="ident" id="1765088">pc</span><span class="op" id="1765090">)</span><span class="op" id="1765091">,</span>&nbsp;<span class="string" id="1765093">&#34;\n&#34;</span><span class="op" id="1765097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765105">for</span>&nbsp;<span class="ident" id="1765109">_defer</span>&nbsp;<span class="op" id="1765116">=</span>&nbsp;<span class="ident" id="1765118">gp</span><span class="op" id="1765120">.</span><span class="ident" id="1765121">_defer</span><span class="op" id="1765127">;</span>&nbsp;<span class="ident" id="1765129">_defer</span>&nbsp;<span class="op" id="1765136">!=</span>&nbsp;<span class="ident" id="1765139">nil</span><span class="op" id="1765142">;</span>&nbsp;<span class="ident" id="1765144">_defer</span>&nbsp;<span class="op" id="1765151">=</span>&nbsp;<span class="ident" id="1765153">_defer</span><span class="op" id="1765159">.</span><span class="ident" id="1765160">link</span>&nbsp;<span class="op" id="1765165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1765170">print</span><span class="op" id="1765175">(</span><span class="string" id="1765176">&#34;\tdefer&nbsp;&#34;</span><span class="op" id="1765186">,</span>&nbsp;<span class="ident" id="1765188">_defer</span><span class="op" id="1765194">,</span>&nbsp;<span class="string" id="1765196">&#34;&nbsp;argp=&#34;</span><span class="op" id="1765204">,</span>&nbsp;<span class="ident" id="1765206">hex</span><span class="op" id="1765209">(</span><span class="ident" id="1765210">_defer</span><span class="op" id="1765216">.</span><span class="ident" id="1765217">argp</span><span class="op" id="1765221">)</span><span class="op" id="1765222">,</span>&nbsp;<span class="string" id="1765224">&#34;&nbsp;pc=&#34;</span><span class="op" id="1765230">,</span>&nbsp;<span class="ident" id="1765232">hex</span><span class="op" id="1765235">(</span><span class="ident" id="1765236">_defer</span><span class="op" id="1765242">.</span><span class="ident" id="1765243">pc</span><span class="op" id="1765245">)</span><span class="op" id="1765246">,</span>&nbsp;<span class="string" id="1765248">&#34;\n&#34;</span><span class="op" id="1765252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765256">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765260">gothrow</span><span class="op" id="1765267">(</span><span class="string" id="1765268">&#34;traceback&nbsp;has&nbsp;leftover&nbsp;defers&#34;</span><span class="op" id="1765299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765306">return</span>&nbsp;<span class="ident" id="1765313">n</span><br>
<span class="lineno"></span><span class="op" id="1765315">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="keyword" id="1765318">func</span>&nbsp;<span class="ident" id="1765323">setArgInfo</span><span class="op" id="1765333">(</span><span class="ident" id="1765334">frame</span>&nbsp;<span class="op" id="1765340">*</span><span class="ident" id="1765341">stkframe</span><span class="op" id="1765349">,</span>&nbsp;<span class="ident" id="1765351">f</span>&nbsp;<span class="op" id="1765353">*</span><span class="ident" id="1765354">_func</span><span class="op" id="1765359">,</span>&nbsp;<span class="ident" id="1765361">needArgMap</span>&nbsp;<span class="builtintype" id="1765372">bool</span><span class="op" id="1765376">)</span>&nbsp;<span class="op" id="1765378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765381">frame</span><span class="op" id="1765386">.</span><span class="ident" id="1765387">arglen</span>&nbsp;<span class="op" id="1765394">=</span>&nbsp;<span class="builtintype" id="1765396">uintptr</span><span class="op" id="1765403">(</span><span class="ident" id="1765404">f</span><span class="op" id="1765405">.</span><span class="ident" id="1765406">args</span><span class="op" id="1765410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765413">if</span>&nbsp;<span class="ident" id="1765416">needArgMap</span>&nbsp;<span class="op" id="1765427">&amp;&amp;</span>&nbsp;<span class="ident" id="1765430">f</span><span class="op" id="1765431">.</span><span class="ident" id="1765432">args</span>&nbsp;<span class="op" id="1765437">==</span>&nbsp;<span class="ident" id="1765440">_ArgsSizeUnknown</span>&nbsp;<span class="op" id="1765457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765461">//&nbsp;Extract&nbsp;argument&nbsp;bitmaps&nbsp;for&nbsp;reflect&nbsp;stubs&nbsp;from&nbsp;the&nbsp;calls&nbsp;they&nbsp;made&nbsp;to&nbsp;reflect.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765546">switch</span>&nbsp;<span class="ident" id="1765553">gofuncname</span><span class="op" id="1765563">(</span><span class="ident" id="1765564">f</span><span class="op" id="1765565">)</span>&nbsp;<span class="op" id="1765567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765571">case</span>&nbsp;<span class="string" id="1765576">&#34;reflect.makeFuncStub&#34;</span><span class="op" id="1765598">,</span>&nbsp;<span class="string" id="1765600">&#34;reflect.methodValueCall&#34;</span><span class="op" id="1765625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765630">arg0</span>&nbsp;<span class="op" id="1765635">:=</span>&nbsp;<span class="ident" id="1765638">frame</span><span class="op" id="1765643">.</span><span class="ident" id="1765644">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765650">if</span>&nbsp;<span class="ident" id="1765653">usesLR</span>&nbsp;<span class="op" id="1765660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765666">arg0</span>&nbsp;<span class="op" id="1765671">+=</span>&nbsp;<span class="ident" id="1765674">ptrSize</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765690">fn</span>&nbsp;<span class="op" id="1765693">:=</span>&nbsp;<span class="op" id="1765696">*</span><span class="op" id="1765697">(</span><span class="op" id="1765698">*</span><span class="op" id="1765699">*</span><span class="op" id="1765700">[</span><span class="num" id="1765701">2</span><span class="op" id="1765702">]</span><span class="builtintype" id="1765703">uintptr</span><span class="op" id="1765710">)</span><span class="op" id="1765711">(</span><span class="ident" id="1765712">unsafe</span><span class="op" id="1765718">.</span><span class="ident" id="1765719">Pointer</span><span class="op" id="1765726">(</span><span class="ident" id="1765727">arg0</span><span class="op" id="1765731">)</span><span class="op" id="1765732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765737">if</span>&nbsp;<span class="ident" id="1765740">fn</span><span class="op" id="1765742">[</span><span class="num" id="1765743">0</span><span class="op" id="1765744">]</span>&nbsp;<span class="op" id="1765746">!=</span>&nbsp;<span class="ident" id="1765749">f</span><span class="op" id="1765750">.</span><span class="ident" id="1765751">entry</span>&nbsp;<span class="op" id="1765757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1765763">print</span><span class="op" id="1765768">(</span><span class="string" id="1765769">&#34;runtime:&nbsp;confused&nbsp;by&nbsp;&#34;</span><span class="op" id="1765792">,</span>&nbsp;<span class="ident" id="1765794">gofuncname</span><span class="op" id="1765804">(</span><span class="ident" id="1765805">f</span><span class="op" id="1765806">)</span><span class="op" id="1765807">,</span>&nbsp;<span class="string" id="1765809">&#34;\n&#34;</span><span class="op" id="1765813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765819">gothrow</span><span class="op" id="1765826">(</span><span class="string" id="1765827">&#34;reflect&nbsp;mismatch&#34;</span><span class="op" id="1765845">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765855">bv</span>&nbsp;<span class="op" id="1765858">:=</span>&nbsp;<span class="op" id="1765861">(</span><span class="op" id="1765862">*</span><span class="ident" id="1765863">bitvector</span><span class="op" id="1765872">)</span><span class="op" id="1765873">(</span><span class="ident" id="1765874">unsafe</span><span class="op" id="1765880">.</span><span class="ident" id="1765881">Pointer</span><span class="op" id="1765888">(</span><span class="ident" id="1765889">fn</span><span class="op" id="1765891">[</span><span class="num" id="1765892">1</span><span class="op" id="1765893">]</span><span class="op" id="1765894">)</span><span class="op" id="1765895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765900">frame</span><span class="op" id="1765905">.</span><span class="ident" id="1765906">arglen</span>&nbsp;<span class="op" id="1765913">=</span>&nbsp;<span class="builtintype" id="1765915">uintptr</span><span class="op" id="1765922">(</span><span class="ident" id="1765923">bv</span><span class="op" id="1765925">.</span><span class="ident" id="1765926">n</span>&nbsp;<span class="op" id="1765928">/</span>&nbsp;<span class="num" id="1765930">2</span>&nbsp;<span class="op" id="1765932">*</span>&nbsp;<span class="ident" id="1765934">ptrSize</span><span class="op" id="1765941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765946">frame</span><span class="op" id="1765951">.</span><span class="ident" id="1765952">argmap</span>&nbsp;<span class="op" id="1765959">=</span>&nbsp;<span class="ident" id="1765961">bv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765966">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1765969">}</span><br>
<span class="lineno"></span><span class="op" id="1765971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1765974">func</span>&nbsp;<span class="ident" id="1765979">printcreatedby</span><span class="op" id="1765993">(</span><span class="ident" id="1765994">gp</span>&nbsp;<span class="op" id="1765997">*</span><span class="ident" id="1765998">g</span><span class="op" id="1765999">)</span>&nbsp;<span class="op" id="1766001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766004">//&nbsp;Show&nbsp;what&nbsp;created&nbsp;goroutine,&nbsp;except&nbsp;main&nbsp;goroutine&nbsp;(goid&nbsp;1).</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1766069">pc</span>&nbsp;<span class="op" id="1766072">:=</span>&nbsp;<span class="ident" id="1766075">gp</span><span class="op" id="1766077">.</span><span class="ident" id="1766078">gopc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1766084">f</span>&nbsp;<span class="op" id="1766086">:=</span>&nbsp;<span class="ident" id="1766089">findfunc</span><span class="op" id="1766097">(</span><span class="ident" id="1766098">pc</span><span class="op" id="1766100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1766103">if</span>&nbsp;<span class="ident" id="1766106">f</span>&nbsp;<span class="op" id="1766108">!=</span>&nbsp;<span class="ident" id="1766111">nil</span>&nbsp;<span class="op" id="1766115">&amp;&amp;</span>&nbsp;<span class="ident" id="1766118">showframe</span><span class="op" id="1766127">(</span><span class="ident" id="1766128">f</span><span class="op" id="1766129">,</span>&nbsp;<span class="ident" id="1766131">gp</span><span class="op" id="1766133">)</span>&nbsp;<span class="op" id="1766135">&amp;&amp;</span>&nbsp;<span class="ident" id="1766138">gp</span><span class="op" id="1766140">.</span><span class="ident" id="1766141">goid</span>&nbsp;<span class="op" id="1766146">!=</span>&nbsp;<span class="num" id="1766149">1</span>&nbsp;<span class="op" id="1766151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1766155">print</span><span class="op" id="1766160">(</span><span class="string" id="1766161">&#34;created&nbsp;by&nbsp;&#34;</span><span class="op" id="1766174">,</span>&nbsp;<span class="ident" id="1766176">gofuncname</span><span class="op" id="1766186">(</span><span class="ident" id="1766187">f</span><span class="op" id="1766188">)</span><span class="op" id="1766189">,</span>&nbsp;<span class="string" id="1766191">&#34;\n&#34;</span><span class="op" id="1766195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1766199">tracepc</span>&nbsp;<span class="op" id="1766207">:=</span>&nbsp;<span class="ident" id="1766210">pc</span>&nbsp;<span class="comment" id="1766213">//&nbsp;back&nbsp;up&nbsp;to&nbsp;CALL&nbsp;instruction&nbsp;for&nbsp;funcline.</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1766260">if</span>&nbsp;<span class="ident" id="1766263">pc</span>&nbsp;<span class="op" id="1766266">&gt;</span>&nbsp;<span class="ident" id="1766268">f</span><span class="op" id="1766269">.</span><span class="ident" id="1766270">entry</span>&nbsp;<span class="op" id="1766276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1766281">tracepc</span>&nbsp;<span class="op" id="1766289">-=</span>&nbsp;<span class="ident" id="1766292">_PCQuantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1766305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1766309">var</span>&nbsp;<span class="ident" id="1766313">file</span>&nbsp;<span class="builtintype" id="1766318">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1766327">line</span>&nbsp;<span class="op" id="1766332">:=</span>&nbsp;<span class="ident" id="1766335">funcline</span><span class="op" id="1766343">(</span><span class="ident" id="1766344">f</span><span class="op" id="1766345">,</span>&nbsp;<span class="ident" id="1766347">tracepc</span><span class="op" id="1766354">,</span>&nbsp;<span class="op" id="1766356">&amp;</span><span class="ident" id="1766357">file</span><span class="op" id="1766361">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1766365">print</span><span class="op" id="1766370">(</span><span class="string" id="1766371">&#34;\t&#34;</span><span class="op" id="1766375">,</span>&nbsp;<span class="ident" id="1766377">file</span><span class="op" id="1766381">,</span>&nbsp;<span class="string" id="1766383">&#34;:&#34;</span><span class="op" id="1766386">,</span>&nbsp;<span class="ident" id="1766388">line</span><span class="op" id="1766392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1766396">if</span>&nbsp;<span class="ident" id="1766399">pc</span>&nbsp;<span class="op" id="1766402">&gt;</span>&nbsp;<span class="ident" id="1766404">f</span><span class="op" id="1766405">.</span><span class="ident" id="1766406">entry</span>&nbsp;<span class="op" id="1766412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1766417">print</span><span class="op" id="1766422">(</span><span class="string" id="1766423">&#34;&nbsp;+&#34;</span><span class="op" id="1766427">,</span>&nbsp;<span class="ident" id="1766429">hex</span><span class="op" id="1766432">(</span><span class="ident" id="1766433">pc</span><span class="op" id="1766435">-</span><span class="ident" id="1766436">f</span><span class="op" id="1766437">.</span><span class="ident" id="1766438">entry</span><span class="op" id="1766443">)</span><span class="op" id="1766444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1766448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1766452">print</span><span class="op" id="1766457">(</span><span class="string" id="1766458">&#34;\n&#34;</span><span class="op" id="1766462">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1766465">}</span><br>
<span class="lineno"></span><span class="op" id="1766467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1766470">func</span>&nbsp;<span class="ident" id="1766475">traceback</span><span class="op" id="1766484">(</span><span class="ident" id="1766485">pc</span>&nbsp;<span class="builtintype" id="1766488">uintptr</span><span class="op" id="1766495">,</span>&nbsp;<span class="ident" id="1766497">sp</span>&nbsp;<span class="builtintype" id="1766500">uintptr</span><span class="op" id="1766507">,</span>&nbsp;<span class="ident" id="1766509">lr</span>&nbsp;<span class="builtintype" id="1766512">uintptr</span><span class="op" id="1766519">,</span>&nbsp;<span class="ident" id="1766521">gp</span>&nbsp;<span class="op" id="1766524">*</span><span class="ident" id="1766525">g</span><span class="op" id="1766526">)</span>&nbsp;<span class="op" id="1766528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1766531">traceback1</span><span class="op" id="1766541">(</span><span class="ident" id="1766542">pc</span><span class="op" id="1766544">,</span>&nbsp;<span class="ident" id="1766546">sp</span><span class="op" id="1766548">,</span>&nbsp;<span class="ident" id="1766550">lr</span><span class="op" id="1766552">,</span>&nbsp;<span class="ident" id="1766554">gp</span><span class="op" id="1766556">,</span>&nbsp;<span class="num" id="1766558">0</span><span class="op" id="1766559">)</span><br>
<span class="lineno">495</span><span class="op" id="1766561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1766564">//&nbsp;tracebacktrap&nbsp;is&nbsp;like&nbsp;traceback&nbsp;but&nbsp;expects&nbsp;that&nbsp;the&nbsp;PC&nbsp;and&nbsp;SP&nbsp;were&nbsp;obtained</span><br>
<span class="lineno"></span><span class="comment" id="1766644">//&nbsp;from&nbsp;a&nbsp;trap,&nbsp;not&nbsp;from&nbsp;gp-&gt;sched&nbsp;or&nbsp;gp-&gt;syscallpc/gp-&gt;syscallsp&nbsp;or&nbsp;getcallerpc/getcallersp.</span><br>
<span class="lineno"></span><span class="comment" id="1766738">//&nbsp;Because&nbsp;they&nbsp;are&nbsp;from&nbsp;a&nbsp;trap&nbsp;instead&nbsp;of&nbsp;from&nbsp;a&nbsp;saved&nbsp;pair,</span><br>
<span class="lineno">500</span><span class="comment" id="1766800">//&nbsp;the&nbsp;initial&nbsp;PC&nbsp;must&nbsp;not&nbsp;be&nbsp;rewound&nbsp;to&nbsp;the&nbsp;previous&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="1766867">//&nbsp;(All&nbsp;the&nbsp;saved&nbsp;pairs&nbsp;record&nbsp;a&nbsp;PC&nbsp;that&nbsp;is&nbsp;a&nbsp;return&nbsp;address,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="1766935">//&nbsp;rewind&nbsp;it&nbsp;into&nbsp;the&nbsp;CALL&nbsp;instruction.)</span><br>
<span class="lineno"></span><span class="keyword" id="1766976">func</span>&nbsp;<span class="ident" id="1766981">tracebacktrap</span><span class="op" id="1766994">(</span><span class="ident" id="1766995">pc</span>&nbsp;<span class="builtintype" id="1766998">uintptr</span><span class="op" id="1767005">,</span>&nbsp;<span class="ident" id="1767007">sp</span>&nbsp;<span class="builtintype" id="1767010">uintptr</span><span class="op" id="1767017">,</span>&nbsp;<span class="ident" id="1767019">lr</span>&nbsp;<span class="builtintype" id="1767022">uintptr</span><span class="op" id="1767029">,</span>&nbsp;<span class="ident" id="1767031">gp</span>&nbsp;<span class="op" id="1767034">*</span><span class="ident" id="1767035">g</span><span class="op" id="1767036">)</span>&nbsp;<span class="op" id="1767038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767041">traceback1</span><span class="op" id="1767051">(</span><span class="ident" id="1767052">pc</span><span class="op" id="1767054">,</span>&nbsp;<span class="ident" id="1767056">sp</span><span class="op" id="1767058">,</span>&nbsp;<span class="ident" id="1767060">lr</span><span class="op" id="1767062">,</span>&nbsp;<span class="ident" id="1767064">gp</span><span class="op" id="1767066">,</span>&nbsp;<span class="ident" id="1767068">_TraceTrap</span><span class="op" id="1767078">)</span><br>
<span class="lineno">505</span><span class="op" id="1767080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1767083">func</span>&nbsp;<span class="ident" id="1767088">traceback1</span><span class="op" id="1767098">(</span><span class="ident" id="1767099">pc</span>&nbsp;<span class="builtintype" id="1767102">uintptr</span><span class="op" id="1767109">,</span>&nbsp;<span class="ident" id="1767111">sp</span>&nbsp;<span class="builtintype" id="1767114">uintptr</span><span class="op" id="1767121">,</span>&nbsp;<span class="ident" id="1767123">lr</span>&nbsp;<span class="builtintype" id="1767126">uintptr</span><span class="op" id="1767133">,</span>&nbsp;<span class="ident" id="1767135">gp</span>&nbsp;<span class="op" id="1767138">*</span><span class="ident" id="1767139">g</span><span class="op" id="1767140">,</span>&nbsp;<span class="ident" id="1767142">flags</span>&nbsp;<span class="builtintype" id="1767148">uint</span><span class="op" id="1767152">)</span>&nbsp;<span class="op" id="1767154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767157">var</span>&nbsp;<span class="ident" id="1767161">n</span>&nbsp;<span class="builtintype" id="1767163">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767168">if</span>&nbsp;<span class="ident" id="1767171">readgstatus</span><span class="op" id="1767182">(</span><span class="ident" id="1767183">gp</span><span class="op" id="1767185">)</span><span class="op" id="1767186">&amp;^</span><span class="ident" id="1767188">_Gscan</span>&nbsp;<span class="op" id="1767195">==</span>&nbsp;<span class="ident" id="1767198">_Gsyscall</span>&nbsp;<span class="op" id="1767208">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767212">//&nbsp;Override&nbsp;registers&nbsp;if&nbsp;blocked&nbsp;in&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767263">pc</span>&nbsp;<span class="op" id="1767266">=</span>&nbsp;<span class="ident" id="1767268">gp</span><span class="op" id="1767270">.</span><span class="ident" id="1767271">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767283">sp</span>&nbsp;<span class="op" id="1767286">=</span>&nbsp;<span class="ident" id="1767288">gp</span><span class="op" id="1767290">.</span><span class="ident" id="1767291">syscallsp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767303">flags</span>&nbsp;<span class="op" id="1767309">&amp;^=</span>&nbsp;<span class="ident" id="1767313">_TraceTrap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767325">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767328">//&nbsp;Print&nbsp;traceback.&nbsp;By&nbsp;default,&nbsp;omits&nbsp;runtime&nbsp;frames.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767383">//&nbsp;If&nbsp;that&nbsp;means&nbsp;we&nbsp;print&nbsp;nothing&nbsp;at&nbsp;all,&nbsp;repeat&nbsp;forcing&nbsp;all&nbsp;frames&nbsp;printed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767461">n</span>&nbsp;<span class="op" id="1767463">=</span>&nbsp;<span class="ident" id="1767465">gentraceback</span><span class="op" id="1767477">(</span><span class="ident" id="1767478">pc</span><span class="op" id="1767480">,</span>&nbsp;<span class="ident" id="1767482">sp</span><span class="op" id="1767484">,</span>&nbsp;<span class="ident" id="1767486">lr</span><span class="op" id="1767488">,</span>&nbsp;<span class="ident" id="1767490">gp</span><span class="op" id="1767492">,</span>&nbsp;<span class="num" id="1767494">0</span><span class="op" id="1767495">,</span>&nbsp;<span class="ident" id="1767497">nil</span><span class="op" id="1767500">,</span>&nbsp;<span class="ident" id="1767502">_TracebackMaxFrames</span><span class="op" id="1767521">,</span>&nbsp;<span class="ident" id="1767523">nil</span><span class="op" id="1767526">,</span>&nbsp;<span class="ident" id="1767528">nil</span><span class="op" id="1767531">,</span>&nbsp;<span class="ident" id="1767533">flags</span><span class="op" id="1767538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767541">if</span>&nbsp;<span class="ident" id="1767544">n</span>&nbsp;<span class="op" id="1767546">==</span>&nbsp;<span class="num" id="1767549">0</span>&nbsp;<span class="op" id="1767551">&amp;&amp;</span>&nbsp;<span class="op" id="1767554">(</span><span class="ident" id="1767555">flags</span><span class="op" id="1767560">&amp;</span><span class="ident" id="1767561">_TraceRuntimeFrames</span><span class="op" id="1767580">)</span>&nbsp;<span class="op" id="1767582">==</span>&nbsp;<span class="num" id="1767585">0</span>&nbsp;<span class="op" id="1767587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767591">n</span>&nbsp;<span class="op" id="1767593">=</span>&nbsp;<span class="ident" id="1767595">gentraceback</span><span class="op" id="1767607">(</span><span class="ident" id="1767608">pc</span><span class="op" id="1767610">,</span>&nbsp;<span class="ident" id="1767612">sp</span><span class="op" id="1767614">,</span>&nbsp;<span class="ident" id="1767616">lr</span><span class="op" id="1767618">,</span>&nbsp;<span class="ident" id="1767620">gp</span><span class="op" id="1767622">,</span>&nbsp;<span class="num" id="1767624">0</span><span class="op" id="1767625">,</span>&nbsp;<span class="ident" id="1767627">nil</span><span class="op" id="1767630">,</span>&nbsp;<span class="ident" id="1767632">_TracebackMaxFrames</span><span class="op" id="1767651">,</span>&nbsp;<span class="ident" id="1767653">nil</span><span class="op" id="1767656">,</span>&nbsp;<span class="ident" id="1767658">nil</span><span class="op" id="1767661">,</span>&nbsp;<span class="ident" id="1767663">flags</span><span class="op" id="1767668">|</span><span class="ident" id="1767669">_TraceRuntimeFrames</span><span class="op" id="1767688">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767694">if</span>&nbsp;<span class="ident" id="1767697">n</span>&nbsp;<span class="op" id="1767699">==</span>&nbsp;<span class="ident" id="1767702">_TracebackMaxFrames</span>&nbsp;<span class="op" id="1767722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1767726">print</span><span class="op" id="1767731">(</span><span class="string" id="1767732">&#34;...additional&nbsp;frames&nbsp;elided...\n&#34;</span><span class="op" id="1767766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767772">printcreatedby</span><span class="op" id="1767786">(</span><span class="ident" id="1767787">gp</span><span class="op" id="1767789">)</span><br>
<span class="lineno">525</span><span class="op" id="1767791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1767794">func</span>&nbsp;<span class="ident" id="1767799">callers</span><span class="op" id="1767806">(</span><span class="ident" id="1767807">skip</span>&nbsp;<span class="builtintype" id="1767812">int</span><span class="op" id="1767815">,</span>&nbsp;<span class="ident" id="1767817">pcbuf</span>&nbsp;<span class="op" id="1767823">*</span><span class="builtintype" id="1767824">uintptr</span><span class="op" id="1767831">,</span>&nbsp;<span class="ident" id="1767833">m</span>&nbsp;<span class="builtintype" id="1767835">int</span><span class="op" id="1767838">)</span>&nbsp;<span class="builtintype" id="1767840">int</span>&nbsp;<span class="op" id="1767844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767847">sp</span>&nbsp;<span class="op" id="1767850">:=</span>&nbsp;<span class="ident" id="1767853">getcallersp</span><span class="op" id="1767864">(</span><span class="ident" id="1767865">unsafe</span><span class="op" id="1767871">.</span><span class="ident" id="1767872">Pointer</span><span class="op" id="1767879">(</span><span class="op" id="1767880">&amp;</span><span class="ident" id="1767881">skip</span><span class="op" id="1767885">)</span><span class="op" id="1767886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767889">pc</span>&nbsp;<span class="op" id="1767892">:=</span>&nbsp;<span class="builtintype" id="1767895">uintptr</span><span class="op" id="1767902">(</span><span class="ident" id="1767903">getcallerpc</span><span class="op" id="1767914">(</span><span class="ident" id="1767915">unsafe</span><span class="op" id="1767921">.</span><span class="ident" id="1767922">Pointer</span><span class="op" id="1767929">(</span><span class="op" id="1767930">&amp;</span><span class="ident" id="1767931">skip</span><span class="op" id="1767935">)</span><span class="op" id="1767936">)</span><span class="op" id="1767937">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767940">var</span>&nbsp;<span class="ident" id="1767944">n</span>&nbsp;<span class="builtintype" id="1767946">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767951">onM</span><span class="op" id="1767954">(</span><span class="keyword" id="1767955">func</span><span class="op" id="1767959">(</span><span class="op" id="1767960">)</span>&nbsp;<span class="op" id="1767962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767966">n</span>&nbsp;<span class="op" id="1767968">=</span>&nbsp;<span class="ident" id="1767970">gentraceback</span><span class="op" id="1767982">(</span><span class="ident" id="1767983">pc</span><span class="op" id="1767985">,</span>&nbsp;<span class="ident" id="1767987">sp</span><span class="op" id="1767989">,</span>&nbsp;<span class="num" id="1767991">0</span><span class="op" id="1767992">,</span>&nbsp;<span class="ident" id="1767994">getg</span><span class="op" id="1767998">(</span><span class="op" id="1767999">)</span><span class="op" id="1768000">,</span>&nbsp;<span class="ident" id="1768002">skip</span><span class="op" id="1768006">,</span>&nbsp;<span class="ident" id="1768008">pcbuf</span><span class="op" id="1768013">,</span>&nbsp;<span class="ident" id="1768015">m</span><span class="op" id="1768016">,</span>&nbsp;<span class="ident" id="1768018">nil</span><span class="op" id="1768021">,</span>&nbsp;<span class="ident" id="1768023">nil</span><span class="op" id="1768026">,</span>&nbsp;<span class="num" id="1768028">0</span><span class="op" id="1768029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768032">}</span><span class="op" id="1768033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768036">return</span>&nbsp;<span class="ident" id="1768043">n</span><br>
<span class="lineno">535</span><span class="op" id="1768045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1768048">func</span>&nbsp;<span class="ident" id="1768053">gcallers</span><span class="op" id="1768061">(</span><span class="ident" id="1768062">gp</span>&nbsp;<span class="op" id="1768065">*</span><span class="ident" id="1768066">g</span><span class="op" id="1768067">,</span>&nbsp;<span class="ident" id="1768069">skip</span>&nbsp;<span class="builtintype" id="1768074">int</span><span class="op" id="1768077">,</span>&nbsp;<span class="ident" id="1768079">pcbuf</span>&nbsp;<span class="op" id="1768085">*</span><span class="builtintype" id="1768086">uintptr</span><span class="op" id="1768093">,</span>&nbsp;<span class="ident" id="1768095">m</span>&nbsp;<span class="builtintype" id="1768097">int</span><span class="op" id="1768100">)</span>&nbsp;<span class="builtintype" id="1768102">int</span>&nbsp;<span class="op" id="1768106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768109">return</span>&nbsp;<span class="ident" id="1768116">gentraceback</span><span class="op" id="1768128">(</span><span class="op" id="1768129">^</span><span class="builtintype" id="1768130">uintptr</span><span class="op" id="1768137">(</span><span class="num" id="1768138">0</span><span class="op" id="1768139">)</span><span class="op" id="1768140">,</span>&nbsp;<span class="op" id="1768142">^</span><span class="builtintype" id="1768143">uintptr</span><span class="op" id="1768150">(</span><span class="num" id="1768151">0</span><span class="op" id="1768152">)</span><span class="op" id="1768153">,</span>&nbsp;<span class="num" id="1768155">0</span><span class="op" id="1768156">,</span>&nbsp;<span class="ident" id="1768158">gp</span><span class="op" id="1768160">,</span>&nbsp;<span class="ident" id="1768162">skip</span><span class="op" id="1768166">,</span>&nbsp;<span class="ident" id="1768168">pcbuf</span><span class="op" id="1768173">,</span>&nbsp;<span class="ident" id="1768175">m</span><span class="op" id="1768176">,</span>&nbsp;<span class="ident" id="1768178">nil</span><span class="op" id="1768181">,</span>&nbsp;<span class="ident" id="1768183">nil</span><span class="op" id="1768186">,</span>&nbsp;<span class="num" id="1768188">0</span><span class="op" id="1768189">)</span><br>
<span class="lineno"></span><span class="op" id="1768191">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span><span class="keyword" id="1768194">func</span>&nbsp;<span class="ident" id="1768199">showframe</span><span class="op" id="1768208">(</span><span class="ident" id="1768209">f</span>&nbsp;<span class="op" id="1768211">*</span><span class="ident" id="1768212">_func</span><span class="op" id="1768217">,</span>&nbsp;<span class="ident" id="1768219">gp</span>&nbsp;<span class="op" id="1768222">*</span><span class="ident" id="1768223">g</span><span class="op" id="1768224">)</span>&nbsp;<span class="builtintype" id="1768226">bool</span>&nbsp;<span class="op" id="1768231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768234">g</span>&nbsp;<span class="op" id="1768236">:=</span>&nbsp;<span class="ident" id="1768239">getg</span><span class="op" id="1768243">(</span><span class="op" id="1768244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768247">if</span>&nbsp;<span class="ident" id="1768250">g</span><span class="op" id="1768251">.</span><span class="ident" id="1768252">m</span><span class="op" id="1768253">.</span><span class="ident" id="1768254">throwing</span>&nbsp;<span class="op" id="1768263">&gt;</span>&nbsp;<span class="num" id="1768265">0</span>&nbsp;<span class="op" id="1768267">&amp;&amp;</span>&nbsp;<span class="ident" id="1768270">gp</span>&nbsp;<span class="op" id="1768273">!=</span>&nbsp;<span class="ident" id="1768276">nil</span>&nbsp;<span class="op" id="1768280">&amp;&amp;</span>&nbsp;<span class="op" id="1768283">(</span><span class="ident" id="1768284">gp</span>&nbsp;<span class="op" id="1768287">==</span>&nbsp;<span class="ident" id="1768290">g</span><span class="op" id="1768291">.</span><span class="ident" id="1768292">m</span><span class="op" id="1768293">.</span><span class="ident" id="1768294">curg</span>&nbsp;<span class="op" id="1768299">||</span>&nbsp;<span class="ident" id="1768302">gp</span>&nbsp;<span class="op" id="1768305">==</span>&nbsp;<span class="ident" id="1768308">g</span><span class="op" id="1768309">.</span><span class="ident" id="1768310">m</span><span class="op" id="1768311">.</span><span class="ident" id="1768312">caughtsig</span><span class="op" id="1768321">)</span>&nbsp;<span class="op" id="1768323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768327">return</span>&nbsp;<span class="ident" id="1768334">true</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768343">traceback</span>&nbsp;<span class="op" id="1768353">:=</span>&nbsp;<span class="ident" id="1768356">gotraceback</span><span class="op" id="1768367">(</span><span class="ident" id="1768368">nil</span><span class="op" id="1768371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768374">name</span>&nbsp;<span class="op" id="1768379">:=</span>&nbsp;<span class="ident" id="1768382">gostringnocopy</span><span class="op" id="1768396">(</span><span class="ident" id="1768397">funcname</span><span class="op" id="1768405">(</span><span class="ident" id="1768406">f</span><span class="op" id="1768407">)</span><span class="op" id="1768408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768412">//&nbsp;Special&nbsp;case:&nbsp;always&nbsp;show&nbsp;runtime.panic&nbsp;frame,&nbsp;so&nbsp;that&nbsp;we&nbsp;can</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768478">//&nbsp;see&nbsp;where&nbsp;a&nbsp;panic&nbsp;started&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;a&nbsp;stack&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768540">//&nbsp;See&nbsp;golang.org/issue/5832.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768571">if</span>&nbsp;<span class="ident" id="1768574">name</span>&nbsp;<span class="op" id="1768579">==</span>&nbsp;<span class="string" id="1768582">&#34;runtime.panic&#34;</span>&nbsp;<span class="op" id="1768598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768602">return</span>&nbsp;<span class="ident" id="1768609">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768615">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768619">return</span>&nbsp;<span class="ident" id="1768626">traceback</span>&nbsp;<span class="op" id="1768636">&gt;</span>&nbsp;<span class="num" id="1768638">1</span>&nbsp;<span class="op" id="1768640">||</span>&nbsp;<span class="ident" id="1768643">f</span>&nbsp;<span class="op" id="1768645">!=</span>&nbsp;<span class="ident" id="1768648">nil</span>&nbsp;<span class="op" id="1768652">&amp;&amp;</span>&nbsp;<span class="ident" id="1768655">contains</span><span class="op" id="1768663">(</span><span class="ident" id="1768664">name</span><span class="op" id="1768668">,</span>&nbsp;<span class="string" id="1768670">&#34;.&#34;</span><span class="op" id="1768673">)</span>&nbsp;<span class="op" id="1768675">&amp;&amp;</span>&nbsp;<span class="op" id="1768678">(</span><span class="op" id="1768679">!</span><span class="ident" id="1768680">hasprefix</span><span class="op" id="1768689">(</span><span class="ident" id="1768690">name</span><span class="op" id="1768694">,</span>&nbsp;<span class="string" id="1768696">&#34;runtime.&#34;</span><span class="op" id="1768706">)</span>&nbsp;<span class="op" id="1768708">||</span>&nbsp;<span class="ident" id="1768711">isExportedRuntime</span><span class="op" id="1768728">(</span><span class="ident" id="1768729">name</span><span class="op" id="1768733">)</span><span class="op" id="1768734">)</span><br>
<span class="lineno"></span><span class="op" id="1768736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1768739">//&nbsp;isExportedRuntime&nbsp;reports&nbsp;whether&nbsp;name&nbsp;is&nbsp;an&nbsp;exported&nbsp;runtime&nbsp;function.</span><br>
<span class="lineno">560</span><span class="comment" id="1768814">//&nbsp;It&nbsp;is&nbsp;only&nbsp;for&nbsp;runtime&nbsp;functions,&nbsp;so&nbsp;ASCII&nbsp;A-Z&nbsp;is&nbsp;fine.</span><br>
<span class="lineno"></span><span class="keyword" id="1768873">func</span>&nbsp;<span class="ident" id="1768878">isExportedRuntime</span><span class="op" id="1768895">(</span><span class="ident" id="1768896">name</span>&nbsp;<span class="builtintype" id="1768901">string</span><span class="op" id="1768907">)</span>&nbsp;<span class="builtintype" id="1768909">bool</span>&nbsp;<span class="op" id="1768914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768917">const</span>&nbsp;<span class="ident" id="1768923">n</span>&nbsp;<span class="op" id="1768925">=</span>&nbsp;<span class="builtinfunc" id="1768927">len</span><span class="op" id="1768930">(</span><span class="string" id="1768931">&#34;runtime.&#34;</span><span class="op" id="1768941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768944">return</span>&nbsp;<span class="builtinfunc" id="1768951">len</span><span class="op" id="1768954">(</span><span class="ident" id="1768955">name</span><span class="op" id="1768959">)</span>&nbsp;<span class="op" id="1768961">&gt;</span>&nbsp;<span class="ident" id="1768963">n</span>&nbsp;<span class="op" id="1768965">&amp;&amp;</span>&nbsp;<span class="ident" id="1768968">name</span><span class="op" id="1768972">[</span><span class="op" id="1768973">:</span><span class="ident" id="1768974">n</span><span class="op" id="1768975">]</span>&nbsp;<span class="op" id="1768977">==</span>&nbsp;<span class="string" id="1768980">&#34;runtime.&#34;</span>&nbsp;<span class="op" id="1768991">&amp;&amp;</span>&nbsp;<span class="string" id="1768994">&#39;A&#39;</span>&nbsp;<span class="op" id="1768998">&lt;=</span>&nbsp;<span class="ident" id="1769001">name</span><span class="op" id="1769005">[</span><span class="ident" id="1769006">n</span><span class="op" id="1769007">]</span>&nbsp;<span class="op" id="1769009">&amp;&amp;</span>&nbsp;<span class="ident" id="1769012">name</span><span class="op" id="1769016">[</span><span class="ident" id="1769017">n</span><span class="op" id="1769018">]</span>&nbsp;<span class="op" id="1769020">&lt;=</span>&nbsp;<span class="string" id="1769023">&#39;Z&#39;</span><br>
<span class="lineno"></span><span class="op" id="1769027">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="keyword" id="1769030">var</span>&nbsp;<span class="ident" id="1769034">gStatusStrings</span>&nbsp;<span class="op" id="1769049">=</span>&nbsp;<span class="op" id="1769051">[</span><span class="op" id="1769052">...</span><span class="op" id="1769055">]</span><span class="builtintype" id="1769056">string</span><span class="op" id="1769062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769065">_Gidle</span><span class="op" id="1769071">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1769078">&#34;idle&#34;</span><span class="op" id="1769084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769087">_Grunnable</span><span class="op" id="1769097">:</span>&nbsp;&nbsp;<span class="string" id="1769100">&#34;runnable&#34;</span><span class="op" id="1769110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769113">_Grunning</span><span class="op" id="1769122">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1769126">&#34;running&#34;</span><span class="op" id="1769135">,</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769138">_Gsyscall</span><span class="op" id="1769147">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1769151">&#34;syscall&#34;</span><span class="op" id="1769160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769163">_Gwaiting</span><span class="op" id="1769172">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1769176">&#34;waiting&#34;</span><span class="op" id="1769185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769188">_Gdead</span><span class="op" id="1769194">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1769201">&#34;dead&#34;</span><span class="op" id="1769207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769210">_Genqueue</span><span class="op" id="1769219">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1769223">&#34;enqueue&#34;</span><span class="op" id="1769232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769235">_Gcopystack</span><span class="op" id="1769246">:</span>&nbsp;<span class="string" id="1769248">&#34;copystack&#34;</span><span class="op" id="1769259">,</span><br>
<span class="lineno">575</span><span class="op" id="1769261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1769264">var</span>&nbsp;<span class="ident" id="1769268">gScanStatusStrings</span>&nbsp;<span class="op" id="1769287">=</span>&nbsp;<span class="op" id="1769289">[</span><span class="op" id="1769290">...</span><span class="op" id="1769293">]</span><span class="builtintype" id="1769294">string</span><span class="op" id="1769300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="1769303">0</span><span class="op" id="1769304">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1769315">&#34;scan&#34;</span><span class="op" id="1769321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769324">_Grunnable</span><span class="op" id="1769334">:</span>&nbsp;<span class="string" id="1769336">&#34;scanrunnable&#34;</span><span class="op" id="1769350">,</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769353">_Grunning</span><span class="op" id="1769362">:</span>&nbsp;&nbsp;<span class="string" id="1769365">&#34;scanrunning&#34;</span><span class="op" id="1769378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769381">_Gsyscall</span><span class="op" id="1769390">:</span>&nbsp;&nbsp;<span class="string" id="1769393">&#34;scansyscall&#34;</span><span class="op" id="1769406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769409">_Gwaiting</span><span class="op" id="1769418">:</span>&nbsp;&nbsp;<span class="string" id="1769421">&#34;scanwaiting&#34;</span><span class="op" id="1769434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769437">_Gdead</span><span class="op" id="1769443">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1769449">&#34;scandead&#34;</span><span class="op" id="1769459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769462">_Genqueue</span><span class="op" id="1769471">:</span>&nbsp;&nbsp;<span class="string" id="1769474">&#34;scanenqueue&#34;</span><span class="op" id="1769487">,</span><br>
<span class="lineno">585</span><span class="op" id="1769489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1769492">func</span>&nbsp;<span class="ident" id="1769497">goroutineheader</span><span class="op" id="1769512">(</span><span class="ident" id="1769513">gp</span>&nbsp;<span class="op" id="1769516">*</span><span class="ident" id="1769517">g</span><span class="op" id="1769518">)</span>&nbsp;<span class="op" id="1769520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769523">gpstatus</span>&nbsp;<span class="op" id="1769532">:=</span>&nbsp;<span class="ident" id="1769535">readgstatus</span><span class="op" id="1769546">(</span><span class="ident" id="1769547">gp</span><span class="op" id="1769549">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1769553">//&nbsp;Basic&nbsp;string&nbsp;status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769577">var</span>&nbsp;<span class="ident" id="1769581">status</span>&nbsp;<span class="builtintype" id="1769588">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769596">if</span>&nbsp;<span class="num" id="1769599">0</span>&nbsp;<span class="op" id="1769601">&lt;=</span>&nbsp;<span class="ident" id="1769604">gpstatus</span>&nbsp;<span class="op" id="1769613">&amp;&amp;</span>&nbsp;<span class="ident" id="1769616">gpstatus</span>&nbsp;<span class="op" id="1769625">&lt;</span>&nbsp;<span class="builtintype" id="1769627">uint32</span><span class="op" id="1769633">(</span><span class="builtinfunc" id="1769634">len</span><span class="op" id="1769637">(</span><span class="ident" id="1769638">gStatusStrings</span><span class="op" id="1769652">)</span><span class="op" id="1769653">)</span>&nbsp;<span class="op" id="1769655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769659">status</span>&nbsp;<span class="op" id="1769666">=</span>&nbsp;<span class="ident" id="1769668">gStatusStrings</span><span class="op" id="1769682">[</span><span class="ident" id="1769683">gpstatus</span><span class="op" id="1769691">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769694">}</span>&nbsp;<span class="keyword" id="1769696">else</span>&nbsp;<span class="keyword" id="1769701">if</span>&nbsp;<span class="ident" id="1769704">gpstatus</span><span class="op" id="1769712">&amp;</span><span class="ident" id="1769713">_Gscan</span>&nbsp;<span class="op" id="1769720">!=</span>&nbsp;<span class="num" id="1769723">0</span>&nbsp;<span class="op" id="1769725">&amp;&amp;</span>&nbsp;<span class="num" id="1769728">0</span>&nbsp;<span class="op" id="1769730">&lt;=</span>&nbsp;<span class="ident" id="1769733">gpstatus</span><span class="op" id="1769741">&amp;^</span><span class="ident" id="1769743">_Gscan</span>&nbsp;<span class="op" id="1769750">&amp;&amp;</span>&nbsp;<span class="ident" id="1769753">gpstatus</span><span class="op" id="1769761">&amp;^</span><span class="ident" id="1769763">_Gscan</span>&nbsp;<span class="op" id="1769770">&lt;</span>&nbsp;<span class="builtintype" id="1769772">uint32</span><span class="op" id="1769778">(</span><span class="builtinfunc" id="1769779">len</span><span class="op" id="1769782">(</span><span class="ident" id="1769783">gStatusStrings</span><span class="op" id="1769797">)</span><span class="op" id="1769798">)</span>&nbsp;<span class="op" id="1769800">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769804">status</span>&nbsp;<span class="op" id="1769811">=</span>&nbsp;<span class="ident" id="1769813">gStatusStrings</span><span class="op" id="1769827">[</span><span class="ident" id="1769828">gpstatus</span><span class="op" id="1769836">&amp;^</span><span class="ident" id="1769838">_Gscan</span><span class="op" id="1769844">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769847">}</span>&nbsp;<span class="keyword" id="1769849">else</span>&nbsp;<span class="op" id="1769854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769858">status</span>&nbsp;<span class="op" id="1769865">=</span>&nbsp;<span class="string" id="1769867">&#34;???&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1769878">//&nbsp;Override.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769892">if</span>&nbsp;<span class="op" id="1769895">(</span><span class="ident" id="1769896">gpstatus</span>&nbsp;<span class="op" id="1769905">==</span>&nbsp;<span class="ident" id="1769908">_Gwaiting</span>&nbsp;<span class="op" id="1769918">||</span>&nbsp;<span class="ident" id="1769921">gpstatus</span>&nbsp;<span class="op" id="1769930">==</span>&nbsp;<span class="ident" id="1769933">_Gscanwaiting</span><span class="op" id="1769946">)</span>&nbsp;<span class="op" id="1769948">&amp;&amp;</span>&nbsp;<span class="ident" id="1769951">gp</span><span class="op" id="1769953">.</span><span class="ident" id="1769954">waitreason</span>&nbsp;<span class="op" id="1769965">!=</span>&nbsp;<span class="string" id="1769968">&#34;&#34;</span>&nbsp;<span class="op" id="1769971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769975">status</span>&nbsp;<span class="op" id="1769982">=</span>&nbsp;<span class="ident" id="1769984">gp</span><span class="op" id="1769986">.</span><span class="ident" id="1769987">waitreason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1770003">//&nbsp;approx&nbsp;time&nbsp;the&nbsp;G&nbsp;is&nbsp;blocked,&nbsp;in&nbsp;minutes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770048">var</span>&nbsp;<span class="ident" id="1770052">waitfor</span>&nbsp;<span class="ident" id="1770060">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770067">gpstatus</span>&nbsp;<span class="op" id="1770076">&amp;^=</span>&nbsp;<span class="ident" id="1770080">_Gscan</span>&nbsp;<span class="comment" id="1770087">//&nbsp;drop&nbsp;the&nbsp;scan&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770109">if</span>&nbsp;<span class="op" id="1770112">(</span><span class="ident" id="1770113">gpstatus</span>&nbsp;<span class="op" id="1770122">==</span>&nbsp;<span class="ident" id="1770125">_Gwaiting</span>&nbsp;<span class="op" id="1770135">||</span>&nbsp;<span class="ident" id="1770138">gpstatus</span>&nbsp;<span class="op" id="1770147">==</span>&nbsp;<span class="ident" id="1770150">_Gsyscall</span><span class="op" id="1770159">)</span>&nbsp;<span class="op" id="1770161">&amp;&amp;</span>&nbsp;<span class="ident" id="1770164">gp</span><span class="op" id="1770166">.</span><span class="ident" id="1770167">waitsince</span>&nbsp;<span class="op" id="1770177">!=</span>&nbsp;<span class="num" id="1770180">0</span>&nbsp;<span class="op" id="1770182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770186">waitfor</span>&nbsp;<span class="op" id="1770194">=</span>&nbsp;<span class="op" id="1770196">(</span><span class="ident" id="1770197">nanotime</span><span class="op" id="1770205">(</span><span class="op" id="1770206">)</span>&nbsp;<span class="op" id="1770208">-</span>&nbsp;<span class="ident" id="1770210">gp</span><span class="op" id="1770212">.</span><span class="ident" id="1770213">waitsince</span><span class="op" id="1770222">)</span>&nbsp;<span class="op" id="1770224">/</span>&nbsp;<span class="num" id="1770226">60e9</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770235">print</span><span class="op" id="1770240">(</span><span class="string" id="1770241">&#34;goroutine&nbsp;&#34;</span><span class="op" id="1770253">,</span>&nbsp;<span class="ident" id="1770255">gp</span><span class="op" id="1770257">.</span><span class="ident" id="1770258">goid</span><span class="op" id="1770262">,</span>&nbsp;<span class="string" id="1770264">&#34;&nbsp;[&#34;</span><span class="op" id="1770268">,</span>&nbsp;<span class="ident" id="1770270">status</span><span class="op" id="1770276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770279">if</span>&nbsp;<span class="ident" id="1770282">waitfor</span>&nbsp;<span class="op" id="1770290">&gt;=</span>&nbsp;<span class="num" id="1770293">1</span>&nbsp;<span class="op" id="1770295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770299">print</span><span class="op" id="1770304">(</span><span class="string" id="1770305">&#34;,&nbsp;&#34;</span><span class="op" id="1770309">,</span>&nbsp;<span class="ident" id="1770311">waitfor</span><span class="op" id="1770318">,</span>&nbsp;<span class="string" id="1770320">&#34;&nbsp;minutes&#34;</span><span class="op" id="1770330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770333">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770336">if</span>&nbsp;<span class="ident" id="1770339">gp</span><span class="op" id="1770341">.</span><span class="ident" id="1770342">lockedm</span>&nbsp;<span class="op" id="1770350">!=</span>&nbsp;<span class="ident" id="1770353">nil</span>&nbsp;<span class="op" id="1770357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770361">print</span><span class="op" id="1770366">(</span><span class="string" id="1770367">&#34;,&nbsp;locked&nbsp;to&nbsp;thread&#34;</span><span class="op" id="1770387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770393">print</span><span class="op" id="1770398">(</span><span class="string" id="1770399">&#34;]:\n&#34;</span><span class="op" id="1770405">)</span><br>
<span class="lineno"></span><span class="op" id="1770407">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="keyword" id="1770410">func</span>&nbsp;<span class="ident" id="1770415">tracebackothers</span><span class="op" id="1770430">(</span><span class="ident" id="1770431">me</span>&nbsp;<span class="op" id="1770434">*</span><span class="ident" id="1770435">g</span><span class="op" id="1770436">)</span>&nbsp;<span class="op" id="1770438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770441">level</span>&nbsp;<span class="op" id="1770447">:=</span>&nbsp;<span class="ident" id="1770450">gotraceback</span><span class="op" id="1770461">(</span><span class="ident" id="1770462">nil</span><span class="op" id="1770465">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1770469">//&nbsp;Show&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;first,&nbsp;if&nbsp;we&nbsp;haven&#39;t&nbsp;already.</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770530">g</span>&nbsp;<span class="op" id="1770532">:=</span>&nbsp;<span class="ident" id="1770535">getg</span><span class="op" id="1770539">(</span><span class="op" id="1770540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770543">gp</span>&nbsp;<span class="op" id="1770546">:=</span>&nbsp;<span class="ident" id="1770549">g</span><span class="op" id="1770550">.</span><span class="ident" id="1770551">m</span><span class="op" id="1770552">.</span><span class="ident" id="1770553">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770559">if</span>&nbsp;<span class="ident" id="1770562">gp</span>&nbsp;<span class="op" id="1770565">!=</span>&nbsp;<span class="ident" id="1770568">nil</span>&nbsp;<span class="op" id="1770572">&amp;&amp;</span>&nbsp;<span class="ident" id="1770575">gp</span>&nbsp;<span class="op" id="1770578">!=</span>&nbsp;<span class="ident" id="1770581">me</span>&nbsp;<span class="op" id="1770584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770588">print</span><span class="op" id="1770593">(</span><span class="string" id="1770594">&#34;\n&#34;</span><span class="op" id="1770598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770602">goroutineheader</span><span class="op" id="1770617">(</span><span class="ident" id="1770618">gp</span><span class="op" id="1770620">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770624">traceback</span><span class="op" id="1770633">(</span><span class="op" id="1770634">^</span><span class="builtintype" id="1770635">uintptr</span><span class="op" id="1770642">(</span><span class="num" id="1770643">0</span><span class="op" id="1770644">)</span><span class="op" id="1770645">,</span>&nbsp;<span class="op" id="1770647">^</span><span class="builtintype" id="1770648">uintptr</span><span class="op" id="1770655">(</span><span class="num" id="1770656">0</span><span class="op" id="1770657">)</span><span class="op" id="1770658">,</span>&nbsp;<span class="num" id="1770660">0</span><span class="op" id="1770661">,</span>&nbsp;<span class="ident" id="1770663">gp</span><span class="op" id="1770665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770672">lock</span><span class="op" id="1770676">(</span><span class="op" id="1770677">&amp;</span><span class="ident" id="1770678">allglock</span><span class="op" id="1770686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770689">for</span>&nbsp;<span class="ident" id="1770693">_</span><span class="op" id="1770694">,</span>&nbsp;<span class="ident" id="1770696">gp</span>&nbsp;<span class="op" id="1770699">:=</span>&nbsp;<span class="keyword" id="1770702">range</span>&nbsp;<span class="ident" id="1770708">allgs</span>&nbsp;<span class="op" id="1770714">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770718">if</span>&nbsp;<span class="ident" id="1770721">gp</span>&nbsp;<span class="op" id="1770724">==</span>&nbsp;<span class="ident" id="1770727">me</span>&nbsp;<span class="op" id="1770730">||</span>&nbsp;<span class="ident" id="1770733">gp</span>&nbsp;<span class="op" id="1770736">==</span>&nbsp;<span class="ident" id="1770739">g</span><span class="op" id="1770740">.</span><span class="ident" id="1770741">m</span><span class="op" id="1770742">.</span><span class="ident" id="1770743">curg</span>&nbsp;<span class="op" id="1770748">||</span>&nbsp;<span class="ident" id="1770751">readgstatus</span><span class="op" id="1770762">(</span><span class="ident" id="1770763">gp</span><span class="op" id="1770765">)</span>&nbsp;<span class="op" id="1770767">==</span>&nbsp;<span class="ident" id="1770770">_Gdead</span>&nbsp;<span class="op" id="1770777">||</span>&nbsp;<span class="ident" id="1770780">gp</span><span class="op" id="1770782">.</span><span class="ident" id="1770783">issystem</span>&nbsp;<span class="op" id="1770792">&amp;&amp;</span>&nbsp;<span class="ident" id="1770795">level</span>&nbsp;<span class="op" id="1770801">&lt;</span>&nbsp;<span class="num" id="1770803">2</span>&nbsp;<span class="op" id="1770805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770810">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770825">print</span><span class="op" id="1770830">(</span><span class="string" id="1770831">&#34;\n&#34;</span><span class="op" id="1770835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770839">goroutineheader</span><span class="op" id="1770854">(</span><span class="ident" id="1770855">gp</span><span class="op" id="1770857">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770861">if</span>&nbsp;<span class="ident" id="1770864">readgstatus</span><span class="op" id="1770875">(</span><span class="ident" id="1770876">gp</span><span class="op" id="1770878">)</span><span class="op" id="1770879">&amp;^</span><span class="ident" id="1770881">_Gscan</span>&nbsp;<span class="op" id="1770888">==</span>&nbsp;<span class="ident" id="1770891">_Grunning</span>&nbsp;<span class="op" id="1770901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770906">print</span><span class="op" id="1770911">(</span><span class="string" id="1770912">&#34;\tgoroutine&nbsp;running&nbsp;on&nbsp;other&nbsp;thread;&nbsp;stack&nbsp;unavailable\n&#34;</span><span class="op" id="1770970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770975">printcreatedby</span><span class="op" id="1770989">(</span><span class="ident" id="1770990">gp</span><span class="op" id="1770992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770996">}</span>&nbsp;<span class="keyword" id="1770998">else</span>&nbsp;<span class="op" id="1771003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771008">traceback</span><span class="op" id="1771017">(</span><span class="op" id="1771018">^</span><span class="builtintype" id="1771019">uintptr</span><span class="op" id="1771026">(</span><span class="num" id="1771027">0</span><span class="op" id="1771028">)</span><span class="op" id="1771029">,</span>&nbsp;<span class="op" id="1771031">^</span><span class="builtintype" id="1771032">uintptr</span><span class="op" id="1771039">(</span><span class="num" id="1771040">0</span><span class="op" id="1771041">)</span><span class="op" id="1771042">,</span>&nbsp;<span class="num" id="1771044">0</span><span class="op" id="1771045">,</span>&nbsp;<span class="ident" id="1771047">gp</span><span class="op" id="1771049">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771059">unlock</span><span class="op" id="1771065">(</span><span class="op" id="1771066">&amp;</span><span class="ident" id="1771067">allglock</span><span class="op" id="1771075">)</span><br>
<span class="lineno"></span><span class="op" id="1771077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="1771080">//&nbsp;Does&nbsp;f&nbsp;mark&nbsp;the&nbsp;top&nbsp;of&nbsp;a&nbsp;goroutine&nbsp;stack?</span><br>
<span class="lineno"></span><span class="keyword" id="1771125">func</span>&nbsp;<span class="ident" id="1771130">topofstack</span><span class="op" id="1771140">(</span><span class="ident" id="1771141">f</span>&nbsp;<span class="op" id="1771143">*</span><span class="ident" id="1771144">_func</span><span class="op" id="1771149">)</span>&nbsp;<span class="builtintype" id="1771151">bool</span>&nbsp;<span class="op" id="1771156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771159">pc</span>&nbsp;<span class="op" id="1771162">:=</span>&nbsp;<span class="ident" id="1771165">f</span><span class="op" id="1771166">.</span><span class="ident" id="1771167">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771174">return</span>&nbsp;<span class="ident" id="1771181">pc</span>&nbsp;<span class="op" id="1771184">==</span>&nbsp;<span class="ident" id="1771187">goexitPC</span>&nbsp;<span class="op" id="1771196">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771201">pc</span>&nbsp;<span class="op" id="1771204">==</span>&nbsp;<span class="ident" id="1771207">mstartPC</span>&nbsp;<span class="op" id="1771216">||</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771221">pc</span>&nbsp;<span class="op" id="1771224">==</span>&nbsp;<span class="ident" id="1771227">mcallPC</span>&nbsp;<span class="op" id="1771235">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771240">pc</span>&nbsp;<span class="op" id="1771243">==</span>&nbsp;<span class="ident" id="1771246">morestackPC</span>&nbsp;<span class="op" id="1771258">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771263">pc</span>&nbsp;<span class="op" id="1771266">==</span>&nbsp;<span class="ident" id="1771269">rt0_goPC</span>&nbsp;<span class="op" id="1771278">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771283">externalthreadhandlerp</span>&nbsp;<span class="op" id="1771306">!=</span>&nbsp;<span class="num" id="1771309">0</span>&nbsp;<span class="op" id="1771311">&amp;&amp;</span>&nbsp;<span class="ident" id="1771314">pc</span>&nbsp;<span class="op" id="1771317">==</span>&nbsp;<span class="ident" id="1771320">externalthreadhandlerp</span><br>
<span class="lineno"></span><span class="op" id="1771343">}</span>
</div>
</body>
</html>
