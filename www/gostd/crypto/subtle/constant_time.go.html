<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2326433">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2326488">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2326542">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2326593">//&nbsp;Package&nbsp;subtle&nbsp;implements&nbsp;functions&nbsp;that&nbsp;are&nbsp;often&nbsp;useful&nbsp;in&nbsp;cryptographic</span><br>
<span class="lineno"></span><span class="comment" id="2326671">//&nbsp;code&nbsp;but&nbsp;require&nbsp;careful&nbsp;thought&nbsp;to&nbsp;use&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="keyword" id="2326725">package</span>&nbsp;<span class="ident" id="2326733">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2326741">//&nbsp;ConstantTimeCompare&nbsp;returns&nbsp;1&nbsp;iff&nbsp;the&nbsp;two&nbsp;slices,&nbsp;x</span><br>
<span class="lineno">10</span><span class="comment" id="2326796">//&nbsp;and&nbsp;y,&nbsp;have&nbsp;equal&nbsp;contents.&nbsp;The&nbsp;time&nbsp;taken&nbsp;is&nbsp;a&nbsp;function&nbsp;of&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2326873">//&nbsp;the&nbsp;slices&nbsp;and&nbsp;is&nbsp;independent&nbsp;of&nbsp;the&nbsp;contents.</span><br>
<span class="lineno"></span><span class="keyword" id="2326923">func</span>&nbsp;<span class="ident" id="2326928">ConstantTimeCompare</span><span class="op" id="2326947">(</span><span class="ident" id="2326948">x</span><span class="op" id="2326949">,</span>&nbsp;<span class="ident" id="2326951">y</span>&nbsp;<span class="op" id="2326953">[</span><span class="op" id="2326954">]</span><span class="builtintype" id="2326955">byte</span><span class="op" id="2326959">)</span>&nbsp;<span class="builtintype" id="2326961">int</span>&nbsp;<span class="op" id="2326965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2326968">if</span>&nbsp;<span class="builtinfunc" id="2326971">len</span><span class="op" id="2326974">(</span><span class="ident" id="2326975">x</span><span class="op" id="2326976">)</span>&nbsp;<span class="op" id="2326978">!=</span>&nbsp;<span class="builtinfunc" id="2326981">len</span><span class="op" id="2326984">(</span><span class="ident" id="2326985">y</span><span class="op" id="2326986">)</span>&nbsp;<span class="op" id="2326988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2326992">return</span>&nbsp;<span class="num" id="2326999">0</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2327002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2327006">var</span>&nbsp;<span class="ident" id="2327010">v</span>&nbsp;<span class="builtintype" id="2327012">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2327019">for</span>&nbsp;<span class="ident" id="2327023">i</span>&nbsp;<span class="op" id="2327025">:=</span>&nbsp;<span class="num" id="2327028">0</span><span class="op" id="2327029">;</span>&nbsp;<span class="ident" id="2327031">i</span>&nbsp;<span class="op" id="2327033">&lt;</span>&nbsp;<span class="builtinfunc" id="2327035">len</span><span class="op" id="2327038">(</span><span class="ident" id="2327039">x</span><span class="op" id="2327040">)</span><span class="op" id="2327041">;</span>&nbsp;<span class="ident" id="2327043">i</span><span class="op" id="2327044">++</span>&nbsp;<span class="op" id="2327047">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2327051">v</span>&nbsp;<span class="op" id="2327053">|=</span>&nbsp;<span class="ident" id="2327056">x</span><span class="op" id="2327057">[</span><span class="ident" id="2327058">i</span><span class="op" id="2327059">]</span>&nbsp;<span class="op" id="2327061">^</span>&nbsp;<span class="ident" id="2327063">y</span><span class="op" id="2327064">[</span><span class="ident" id="2327065">i</span><span class="op" id="2327066">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2327069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2327073">return</span>&nbsp;<span class="ident" id="2327080">ConstantTimeByteEq</span><span class="op" id="2327098">(</span><span class="ident" id="2327099">v</span><span class="op" id="2327100">,</span>&nbsp;<span class="num" id="2327102">0</span><span class="op" id="2327103">)</span><br>
<span class="lineno"></span><span class="op" id="2327105">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="2327108">//&nbsp;ConstantTimeSelect&nbsp;returns&nbsp;x&nbsp;if&nbsp;v&nbsp;is&nbsp;1&nbsp;and&nbsp;y&nbsp;if&nbsp;v&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="2327167">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="2327224">func</span>&nbsp;<span class="ident" id="2327229">ConstantTimeSelect</span><span class="op" id="2327247">(</span><span class="ident" id="2327248">v</span><span class="op" id="2327249">,</span>&nbsp;<span class="ident" id="2327251">x</span><span class="op" id="2327252">,</span>&nbsp;<span class="ident" id="2327254">y</span>&nbsp;<span class="builtintype" id="2327256">int</span><span class="op" id="2327259">)</span>&nbsp;<span class="builtintype" id="2327261">int</span>&nbsp;<span class="op" id="2327265">{</span>&nbsp;<span class="keyword" id="2327267">return</span>&nbsp;<span class="op" id="2327274">^</span><span class="op" id="2327275">(</span><span class="ident" id="2327276">v</span><span class="op" id="2327277">-</span><span class="num" id="2327278">1</span><span class="op" id="2327279">)</span><span class="op" id="2327280">&amp;</span><span class="ident" id="2327281">x</span>&nbsp;<span class="op" id="2327283">|</span>&nbsp;<span class="op" id="2327285">(</span><span class="ident" id="2327286">v</span><span class="op" id="2327287">-</span><span class="num" id="2327288">1</span><span class="op" id="2327289">)</span><span class="op" id="2327290">&amp;</span><span class="ident" id="2327291">y</span>&nbsp;<span class="op" id="2327293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2327296">//&nbsp;ConstantTimeByteEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="2327355">func</span>&nbsp;<span class="ident" id="2327360">ConstantTimeByteEq</span><span class="op" id="2327378">(</span><span class="ident" id="2327379">x</span><span class="op" id="2327380">,</span>&nbsp;<span class="ident" id="2327382">y</span>&nbsp;<span class="builtintype" id="2327384">uint8</span><span class="op" id="2327389">)</span>&nbsp;<span class="builtintype" id="2327391">int</span>&nbsp;<span class="op" id="2327395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2327398">z</span>&nbsp;<span class="op" id="2327400">:=</span>&nbsp;<span class="op" id="2327403">^</span><span class="op" id="2327404">(</span><span class="ident" id="2327405">x</span>&nbsp;<span class="op" id="2327407">^</span>&nbsp;<span class="ident" id="2327409">y</span><span class="op" id="2327410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2327413">z</span>&nbsp;<span class="op" id="2327415">&amp;=</span>&nbsp;<span class="ident" id="2327418">z</span>&nbsp;<span class="op" id="2327420">&gt;&gt;</span>&nbsp;<span class="num" id="2327423">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2327426">z</span>&nbsp;<span class="op" id="2327428">&amp;=</span>&nbsp;<span class="ident" id="2327431">z</span>&nbsp;<span class="op" id="2327433">&gt;&gt;</span>&nbsp;<span class="num" id="2327436">2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2327439">z</span>&nbsp;<span class="op" id="2327441">&amp;=</span>&nbsp;<span class="ident" id="2327444">z</span>&nbsp;<span class="op" id="2327446">&gt;&gt;</span>&nbsp;<span class="num" id="2327449">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2327453">return</span>&nbsp;<span class="builtintype" id="2327460">int</span><span class="op" id="2327463">(</span><span class="ident" id="2327464">z</span><span class="op" id="2327465">)</span><br>
<span class="lineno"></span><span class="op" id="2327467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2327470">//&nbsp;ConstantTimeEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="2327525">func</span>&nbsp;<span class="ident" id="2327530">ConstantTimeEq</span><span class="op" id="2327544">(</span><span class="ident" id="2327545">x</span><span class="op" id="2327546">,</span>&nbsp;<span class="ident" id="2327548">y</span>&nbsp;<span class="builtintype" id="2327550">int32</span><span class="op" id="2327555">)</span>&nbsp;<span class="builtintype" id="2327557">int</span>&nbsp;<span class="op" id="2327561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2327564">z</span>&nbsp;<span class="op" id="2327566">:=</span>&nbsp;<span class="op" id="2327569">^</span><span class="op" id="2327570">(</span><span class="ident" id="2327571">x</span>&nbsp;<span class="op" id="2327573">^</span>&nbsp;<span class="ident" id="2327575">y</span><span class="op" id="2327576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2327579">z</span>&nbsp;<span class="op" id="2327581">&amp;=</span>&nbsp;<span class="ident" id="2327584">z</span>&nbsp;<span class="op" id="2327586">&gt;&gt;</span>&nbsp;<span class="num" id="2327589">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2327593">z</span>&nbsp;<span class="op" id="2327595">&amp;=</span>&nbsp;<span class="ident" id="2327598">z</span>&nbsp;<span class="op" id="2327600">&gt;&gt;</span>&nbsp;<span class="num" id="2327603">8</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2327606">z</span>&nbsp;<span class="op" id="2327608">&amp;=</span>&nbsp;<span class="ident" id="2327611">z</span>&nbsp;<span class="op" id="2327613">&gt;&gt;</span>&nbsp;<span class="num" id="2327616">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2327619">z</span>&nbsp;<span class="op" id="2327621">&amp;=</span>&nbsp;<span class="ident" id="2327624">z</span>&nbsp;<span class="op" id="2327626">&gt;&gt;</span>&nbsp;<span class="num" id="2327629">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2327632">z</span>&nbsp;<span class="op" id="2327634">&amp;=</span>&nbsp;<span class="ident" id="2327637">z</span>&nbsp;<span class="op" id="2327639">&gt;&gt;</span>&nbsp;<span class="num" id="2327642">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2327646">return</span>&nbsp;<span class="builtintype" id="2327653">int</span><span class="op" id="2327656">(</span><span class="ident" id="2327657">z</span>&nbsp;<span class="op" id="2327659">&amp;</span>&nbsp;<span class="num" id="2327661">1</span><span class="op" id="2327662">)</span><br>
<span class="lineno">50</span><span class="op" id="2327664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2327667">//&nbsp;ConstantTimeCopy&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;y&nbsp;into&nbsp;x&nbsp;(a&nbsp;slice&nbsp;of&nbsp;equal&nbsp;length)</span><br>
<span class="lineno"></span><span class="comment" id="2327745">//&nbsp;if&nbsp;v&nbsp;==&nbsp;1.&nbsp;If&nbsp;v&nbsp;==&nbsp;0,&nbsp;x&nbsp;is&nbsp;left&nbsp;unchanged.&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v</span><br>
<span class="lineno"></span><span class="comment" id="2327822">//&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno">55</span><span class="keyword" id="2327848">func</span>&nbsp;<span class="ident" id="2327853">ConstantTimeCopy</span><span class="op" id="2327869">(</span><span class="ident" id="2327870">v</span>&nbsp;<span class="builtintype" id="2327872">int</span><span class="op" id="2327875">,</span>&nbsp;<span class="ident" id="2327877">x</span><span class="op" id="2327878">,</span>&nbsp;<span class="ident" id="2327880">y</span>&nbsp;<span class="op" id="2327882">[</span><span class="op" id="2327883">]</span><span class="builtintype" id="2327884">byte</span><span class="op" id="2327888">)</span>&nbsp;<span class="op" id="2327890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2327893">if</span>&nbsp;<span class="builtinfunc" id="2327896">len</span><span class="op" id="2327899">(</span><span class="ident" id="2327900">x</span><span class="op" id="2327901">)</span>&nbsp;<span class="op" id="2327903">!=</span>&nbsp;<span class="builtinfunc" id="2327906">len</span><span class="op" id="2327909">(</span><span class="ident" id="2327910">y</span><span class="op" id="2327911">)</span>&nbsp;<span class="op" id="2327913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2327917">panic</span><span class="op" id="2327922">(</span><span class="string" id="2327923">&#34;subtle:&nbsp;slices&nbsp;have&nbsp;different&nbsp;lengths&#34;</span><span class="op" id="2327962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2327965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2327969">xmask</span>&nbsp;<span class="op" id="2327975">:=</span>&nbsp;<span class="builtintype" id="2327978">byte</span><span class="op" id="2327982">(</span><span class="ident" id="2327983">v</span>&nbsp;<span class="op" id="2327985">-</span>&nbsp;<span class="num" id="2327987">1</span><span class="op" id="2327988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2327991">ymask</span>&nbsp;<span class="op" id="2327997">:=</span>&nbsp;<span class="builtintype" id="2328000">byte</span><span class="op" id="2328004">(</span><span class="op" id="2328005">^</span><span class="op" id="2328006">(</span><span class="ident" id="2328007">v</span>&nbsp;<span class="op" id="2328009">-</span>&nbsp;<span class="num" id="2328011">1</span><span class="op" id="2328012">)</span><span class="op" id="2328013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2328016">for</span>&nbsp;<span class="ident" id="2328020">i</span>&nbsp;<span class="op" id="2328022">:=</span>&nbsp;<span class="num" id="2328025">0</span><span class="op" id="2328026">;</span>&nbsp;<span class="ident" id="2328028">i</span>&nbsp;<span class="op" id="2328030">&lt;</span>&nbsp;<span class="builtinfunc" id="2328032">len</span><span class="op" id="2328035">(</span><span class="ident" id="2328036">x</span><span class="op" id="2328037">)</span><span class="op" id="2328038">;</span>&nbsp;<span class="ident" id="2328040">i</span><span class="op" id="2328041">++</span>&nbsp;<span class="op" id="2328044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2328048">x</span><span class="op" id="2328049">[</span><span class="ident" id="2328050">i</span><span class="op" id="2328051">]</span>&nbsp;<span class="op" id="2328053">=</span>&nbsp;<span class="ident" id="2328055">x</span><span class="op" id="2328056">[</span><span class="ident" id="2328057">i</span><span class="op" id="2328058">]</span><span class="op" id="2328059">&amp;</span><span class="ident" id="2328060">xmask</span>&nbsp;<span class="op" id="2328066">|</span>&nbsp;<span class="ident" id="2328068">y</span><span class="op" id="2328069">[</span><span class="ident" id="2328070">i</span><span class="op" id="2328071">]</span><span class="op" id="2328072">&amp;</span><span class="ident" id="2328073">ymask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2328080">}</span><br>
<span class="lineno">65</span><span class="op" id="2328082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2328085">//&nbsp;ConstantTimeLessOrEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;&lt;=&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="2328146">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;x&nbsp;or&nbsp;y&nbsp;are&nbsp;negative&nbsp;or&nbsp;&gt;&nbsp;2**31&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="2328214">func</span>&nbsp;<span class="ident" id="2328219">ConstantTimeLessOrEq</span><span class="op" id="2328239">(</span><span class="ident" id="2328240">x</span><span class="op" id="2328241">,</span>&nbsp;<span class="ident" id="2328243">y</span>&nbsp;<span class="builtintype" id="2328245">int</span><span class="op" id="2328248">)</span>&nbsp;<span class="builtintype" id="2328250">int</span>&nbsp;<span class="op" id="2328254">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2328257">x32</span>&nbsp;<span class="op" id="2328261">:=</span>&nbsp;<span class="builtintype" id="2328264">int32</span><span class="op" id="2328269">(</span><span class="ident" id="2328270">x</span><span class="op" id="2328271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2328274">y32</span>&nbsp;<span class="op" id="2328278">:=</span>&nbsp;<span class="builtintype" id="2328281">int32</span><span class="op" id="2328286">(</span><span class="ident" id="2328287">y</span><span class="op" id="2328288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2328291">return</span>&nbsp;<span class="builtintype" id="2328298">int</span><span class="op" id="2328301">(</span><span class="op" id="2328302">(</span><span class="op" id="2328303">(</span><span class="ident" id="2328304">x32</span>&nbsp;<span class="op" id="2328308">-</span>&nbsp;<span class="ident" id="2328310">y32</span>&nbsp;<span class="op" id="2328314">-</span>&nbsp;<span class="num" id="2328316">1</span><span class="op" id="2328317">)</span>&nbsp;<span class="op" id="2328319">&gt;&gt;</span>&nbsp;<span class="num" id="2328322">31</span><span class="op" id="2328324">)</span>&nbsp;<span class="op" id="2328326">&amp;</span>&nbsp;<span class="num" id="2328328">1</span><span class="op" id="2328329">)</span><br>
<span class="lineno"></span><span class="op" id="2328331">}</span>
</div>
</body>
</html>
