<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2315522">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2315577">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2315631">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2315682">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2315747">package</span>&nbsp;<span class="ident" id="2315755">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2315764">import</span>&nbsp;<span class="op" id="2315771">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2315774">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2315785">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2315793">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2315802">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2315805">var</span>&nbsp;<span class="op" id="2315809">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315812">Stdin</span>&nbsp;&nbsp;<span class="op" id="2315819">=</span>&nbsp;<span class="num" id="2315821">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315824">Stdout</span>&nbsp;<span class="op" id="2315831">=</span>&nbsp;<span class="num" id="2315833">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315836">Stderr</span>&nbsp;<span class="op" id="2315843">=</span>&nbsp;<span class="num" id="2315845">2</span><br>
<span class="lineno"></span><span class="op" id="2315847">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2315850">const</span>&nbsp;<span class="op" id="2315856">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315859">darwin64Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2315874">=</span>&nbsp;<span class="ident" id="2315876">runtime</span><span class="op" id="2315883">.</span><span class="ident" id="2315884">GOOS</span>&nbsp;<span class="op" id="2315889">==</span>&nbsp;<span class="string" id="2315892">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2315901">&amp;&amp;</span>&nbsp;<span class="ident" id="2315904">sizeofPtr</span>&nbsp;<span class="op" id="2315914">==</span>&nbsp;<span class="num" id="2315917">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315920">dragonfly64Bit</span>&nbsp;<span class="op" id="2315935">=</span>&nbsp;<span class="ident" id="2315937">runtime</span><span class="op" id="2315944">.</span><span class="ident" id="2315945">GOOS</span>&nbsp;<span class="op" id="2315950">==</span>&nbsp;<span class="string" id="2315953">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="2315965">&amp;&amp;</span>&nbsp;<span class="ident" id="2315968">sizeofPtr</span>&nbsp;<span class="op" id="2315978">==</span>&nbsp;<span class="num" id="2315981">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315984">netbsd32Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2315999">=</span>&nbsp;<span class="ident" id="2316001">runtime</span><span class="op" id="2316008">.</span><span class="ident" id="2316009">GOOS</span>&nbsp;<span class="op" id="2316014">==</span>&nbsp;<span class="string" id="2316017">&#34;netbsd&#34;</span>&nbsp;<span class="op" id="2316026">&amp;&amp;</span>&nbsp;<span class="ident" id="2316029">sizeofPtr</span>&nbsp;<span class="op" id="2316039">==</span>&nbsp;<span class="num" id="2316042">4</span><br>
<span class="lineno">25</span><span class="op" id="2316044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2316047">func</span>&nbsp;<span class="ident" id="2316052">Syscall</span><span class="op" id="2316059">(</span><span class="ident" id="2316060">trap</span><span class="op" id="2316064">,</span>&nbsp;<span class="ident" id="2316066">a1</span><span class="op" id="2316068">,</span>&nbsp;<span class="ident" id="2316070">a2</span><span class="op" id="2316072">,</span>&nbsp;<span class="ident" id="2316074">a3</span>&nbsp;<span class="builtintype" id="2316077">uintptr</span><span class="op" id="2316084">)</span>&nbsp;<span class="op" id="2316086">(</span><span class="ident" id="2316087">r1</span><span class="op" id="2316089">,</span>&nbsp;<span class="ident" id="2316091">r2</span>&nbsp;<span class="builtintype" id="2316094">uintptr</span><span class="op" id="2316101">,</span>&nbsp;<span class="ident" id="2316103">err</span>&nbsp;<span class="ident" id="2316107">Errno</span><span class="op" id="2316112">)</span><br>
<span class="lineno"></span><span class="keyword" id="2316114">func</span>&nbsp;<span class="ident" id="2316119">Syscall6</span><span class="op" id="2316127">(</span><span class="ident" id="2316128">trap</span><span class="op" id="2316132">,</span>&nbsp;<span class="ident" id="2316134">a1</span><span class="op" id="2316136">,</span>&nbsp;<span class="ident" id="2316138">a2</span><span class="op" id="2316140">,</span>&nbsp;<span class="ident" id="2316142">a3</span><span class="op" id="2316144">,</span>&nbsp;<span class="ident" id="2316146">a4</span><span class="op" id="2316148">,</span>&nbsp;<span class="ident" id="2316150">a5</span><span class="op" id="2316152">,</span>&nbsp;<span class="ident" id="2316154">a6</span>&nbsp;<span class="builtintype" id="2316157">uintptr</span><span class="op" id="2316164">)</span>&nbsp;<span class="op" id="2316166">(</span><span class="ident" id="2316167">r1</span><span class="op" id="2316169">,</span>&nbsp;<span class="ident" id="2316171">r2</span>&nbsp;<span class="builtintype" id="2316174">uintptr</span><span class="op" id="2316181">,</span>&nbsp;<span class="ident" id="2316183">err</span>&nbsp;<span class="ident" id="2316187">Errno</span><span class="op" id="2316192">)</span><br>
<span class="lineno"></span><span class="keyword" id="2316194">func</span>&nbsp;<span class="ident" id="2316199">RawSyscall</span><span class="op" id="2316209">(</span><span class="ident" id="2316210">trap</span><span class="op" id="2316214">,</span>&nbsp;<span class="ident" id="2316216">a1</span><span class="op" id="2316218">,</span>&nbsp;<span class="ident" id="2316220">a2</span><span class="op" id="2316222">,</span>&nbsp;<span class="ident" id="2316224">a3</span>&nbsp;<span class="builtintype" id="2316227">uintptr</span><span class="op" id="2316234">)</span>&nbsp;<span class="op" id="2316236">(</span><span class="ident" id="2316237">r1</span><span class="op" id="2316239">,</span>&nbsp;<span class="ident" id="2316241">r2</span>&nbsp;<span class="builtintype" id="2316244">uintptr</span><span class="op" id="2316251">,</span>&nbsp;<span class="ident" id="2316253">err</span>&nbsp;<span class="ident" id="2316257">Errno</span><span class="op" id="2316262">)</span><br>
<span class="lineno">30</span><span class="keyword" id="2316264">func</span>&nbsp;<span class="ident" id="2316269">RawSyscall6</span><span class="op" id="2316280">(</span><span class="ident" id="2316281">trap</span><span class="op" id="2316285">,</span>&nbsp;<span class="ident" id="2316287">a1</span><span class="op" id="2316289">,</span>&nbsp;<span class="ident" id="2316291">a2</span><span class="op" id="2316293">,</span>&nbsp;<span class="ident" id="2316295">a3</span><span class="op" id="2316297">,</span>&nbsp;<span class="ident" id="2316299">a4</span><span class="op" id="2316301">,</span>&nbsp;<span class="ident" id="2316303">a5</span><span class="op" id="2316305">,</span>&nbsp;<span class="ident" id="2316307">a6</span>&nbsp;<span class="builtintype" id="2316310">uintptr</span><span class="op" id="2316317">)</span>&nbsp;<span class="op" id="2316319">(</span><span class="ident" id="2316320">r1</span><span class="op" id="2316322">,</span>&nbsp;<span class="ident" id="2316324">r2</span>&nbsp;<span class="builtintype" id="2316327">uintptr</span><span class="op" id="2316334">,</span>&nbsp;<span class="ident" id="2316336">err</span>&nbsp;<span class="ident" id="2316340">Errno</span><span class="op" id="2316345">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2316348">//&nbsp;Mmap&nbsp;manager,&nbsp;for&nbsp;use&nbsp;by&nbsp;operating&nbsp;system-specific&nbsp;implementations.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2316420">type</span>&nbsp;<span class="ident" id="2316425">mmapper</span>&nbsp;<span class="keyword" id="2316433">struct</span>&nbsp;<span class="op" id="2316440">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2316443">sync</span><span class="op" id="2316447">.</span><span class="ident" id="2316448">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2316455">active</span>&nbsp;<span class="keyword" id="2316462">map</span><span class="op" id="2316465">[</span><span class="op" id="2316466">*</span><span class="builtintype" id="2316467">byte</span><span class="op" id="2316471">]</span><span class="op" id="2316472">[</span><span class="op" id="2316473">]</span><span class="builtintype" id="2316474">byte</span>&nbsp;<span class="comment" id="2316479">//&nbsp;active&nbsp;mappings;&nbsp;key&nbsp;is&nbsp;last&nbsp;byte&nbsp;in&nbsp;mapping</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2316528">mmap</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="2316535">func</span><span class="op" id="2316539">(</span><span class="ident" id="2316540">addr</span><span class="op" id="2316544">,</span>&nbsp;<span class="ident" id="2316546">length</span>&nbsp;<span class="builtintype" id="2316553">uintptr</span><span class="op" id="2316560">,</span>&nbsp;<span class="ident" id="2316562">prot</span><span class="op" id="2316566">,</span>&nbsp;<span class="ident" id="2316568">flags</span><span class="op" id="2316573">,</span>&nbsp;<span class="ident" id="2316575">fd</span>&nbsp;<span class="builtintype" id="2316578">int</span><span class="op" id="2316581">,</span>&nbsp;<span class="ident" id="2316583">offset</span>&nbsp;<span class="ident" id="2316590">int64</span><span class="op" id="2316595">)</span>&nbsp;<span class="op" id="2316597">(</span><span class="builtintype" id="2316598">uintptr</span><span class="op" id="2316605">,</span>&nbsp;<span class="builtintype" id="2316607">error</span><span class="op" id="2316612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2316615">munmap</span>&nbsp;<span class="keyword" id="2316622">func</span><span class="op" id="2316626">(</span><span class="ident" id="2316627">addr</span>&nbsp;<span class="builtintype" id="2316632">uintptr</span><span class="op" id="2316639">,</span>&nbsp;<span class="ident" id="2316641">length</span>&nbsp;<span class="builtintype" id="2316648">uintptr</span><span class="op" id="2316655">)</span>&nbsp;<span class="builtintype" id="2316657">error</span><br>
<span class="lineno"></span><span class="op" id="2316663">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2316666">func</span>&nbsp;<span class="op" id="2316671">(</span><span class="ident" id="2316672">m</span>&nbsp;<span class="op" id="2316674">*</span><span class="ident" id="2316675">mmapper</span><span class="op" id="2316682">)</span>&nbsp;<span class="ident" id="2316684">Mmap</span><span class="op" id="2316688">(</span><span class="ident" id="2316689">fd</span>&nbsp;<span class="builtintype" id="2316692">int</span><span class="op" id="2316695">,</span>&nbsp;<span class="ident" id="2316697">offset</span>&nbsp;<span class="ident" id="2316704">int64</span><span class="op" id="2316709">,</span>&nbsp;<span class="ident" id="2316711">length</span>&nbsp;<span class="builtintype" id="2316718">int</span><span class="op" id="2316721">,</span>&nbsp;<span class="ident" id="2316723">prot</span>&nbsp;<span class="builtintype" id="2316728">int</span><span class="op" id="2316731">,</span>&nbsp;<span class="ident" id="2316733">flags</span>&nbsp;<span class="builtintype" id="2316739">int</span><span class="op" id="2316742">)</span>&nbsp;<span class="op" id="2316744">(</span><span class="ident" id="2316745">data</span>&nbsp;<span class="op" id="2316750">[</span><span class="op" id="2316751">]</span><span class="builtintype" id="2316752">byte</span><span class="op" id="2316756">,</span>&nbsp;<span class="ident" id="2316758">err</span>&nbsp;<span class="builtintype" id="2316762">error</span><span class="op" id="2316767">)</span>&nbsp;<span class="op" id="2316769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2316772">if</span>&nbsp;<span class="ident" id="2316775">length</span>&nbsp;<span class="op" id="2316782">&lt;=</span>&nbsp;<span class="num" id="2316785">0</span>&nbsp;<span class="op" id="2316787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2316791">return</span>&nbsp;<span class="ident" id="2316798">nil</span><span class="op" id="2316801">,</span>&nbsp;<span class="ident" id="2316803">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2316811">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316815">//&nbsp;Map&nbsp;the&nbsp;requested&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2316845">addr</span><span class="op" id="2316849">,</span>&nbsp;<span class="ident" id="2316851">errno</span>&nbsp;<span class="op" id="2316857">:=</span>&nbsp;<span class="ident" id="2316860">m</span><span class="op" id="2316861">.</span><span class="ident" id="2316862">mmap</span><span class="op" id="2316866">(</span><span class="num" id="2316867">0</span><span class="op" id="2316868">,</span>&nbsp;<span class="builtintype" id="2316870">uintptr</span><span class="op" id="2316877">(</span><span class="ident" id="2316878">length</span><span class="op" id="2316884">)</span><span class="op" id="2316885">,</span>&nbsp;<span class="ident" id="2316887">prot</span><span class="op" id="2316891">,</span>&nbsp;<span class="ident" id="2316893">flags</span><span class="op" id="2316898">,</span>&nbsp;<span class="ident" id="2316900">fd</span><span class="op" id="2316902">,</span>&nbsp;<span class="ident" id="2316904">offset</span><span class="op" id="2316910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2316913">if</span>&nbsp;<span class="ident" id="2316916">errno</span>&nbsp;<span class="op" id="2316922">!=</span>&nbsp;<span class="ident" id="2316925">nil</span>&nbsp;<span class="op" id="2316929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2316933">return</span>&nbsp;<span class="ident" id="2316940">nil</span><span class="op" id="2316943">,</span>&nbsp;<span class="ident" id="2316945">errno</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2316952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316956">//&nbsp;Slice&nbsp;memory&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2316980">var</span>&nbsp;<span class="ident" id="2316984">sl</span>&nbsp;<span class="op" id="2316987">=</span>&nbsp;<span class="keyword" id="2316989">struct</span>&nbsp;<span class="op" id="2316996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317000">addr</span>&nbsp;<span class="builtintype" id="2317005">uintptr</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2317015">len</span>&nbsp;&nbsp;<span class="builtintype" id="2317020">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2317026">cap</span>&nbsp;&nbsp;<span class="builtintype" id="2317031">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317036">}</span><span class="op" id="2317037">{</span><span class="ident" id="2317038">addr</span><span class="op" id="2317042">,</span>&nbsp;<span class="ident" id="2317044">length</span><span class="op" id="2317050">,</span>&nbsp;<span class="ident" id="2317052">length</span><span class="op" id="2317058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317062">//&nbsp;Use&nbsp;unsafe&nbsp;to&nbsp;turn&nbsp;sl&nbsp;into&nbsp;a&nbsp;[]byte.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317103">b</span>&nbsp;<span class="op" id="2317105">:=</span>&nbsp;<span class="op" id="2317108">*</span><span class="op" id="2317109">(</span><span class="op" id="2317110">*</span><span class="op" id="2317111">[</span><span class="op" id="2317112">]</span><span class="builtintype" id="2317113">byte</span><span class="op" id="2317117">)</span><span class="op" id="2317118">(</span><span class="ident" id="2317119">unsafe</span><span class="op" id="2317125">.</span><span class="ident" id="2317126">Pointer</span><span class="op" id="2317133">(</span><span class="op" id="2317134">&amp;</span><span class="ident" id="2317135">sl</span><span class="op" id="2317137">)</span><span class="op" id="2317138">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317142">//&nbsp;Register&nbsp;mapping&nbsp;in&nbsp;m&nbsp;and&nbsp;return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317183">p</span>&nbsp;<span class="op" id="2317185">:=</span>&nbsp;<span class="op" id="2317188">&amp;</span><span class="ident" id="2317189">b</span><span class="op" id="2317190">[</span><span class="builtinfunc" id="2317191">cap</span><span class="op" id="2317194">(</span><span class="ident" id="2317195">b</span><span class="op" id="2317196">)</span><span class="op" id="2317197">-</span><span class="num" id="2317198">1</span><span class="op" id="2317199">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317202">m</span><span class="op" id="2317203">.</span><span class="ident" id="2317204">Lock</span><span class="op" id="2317208">(</span><span class="op" id="2317209">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317212">defer</span>&nbsp;<span class="ident" id="2317218">m</span><span class="op" id="2317219">.</span><span class="ident" id="2317220">Unlock</span><span class="op" id="2317226">(</span><span class="op" id="2317227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317230">m</span><span class="op" id="2317231">.</span><span class="ident" id="2317232">active</span><span class="op" id="2317238">[</span><span class="ident" id="2317239">p</span><span class="op" id="2317240">]</span>&nbsp;<span class="op" id="2317242">=</span>&nbsp;<span class="ident" id="2317244">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317247">return</span>&nbsp;<span class="ident" id="2317254">b</span><span class="op" id="2317255">,</span>&nbsp;<span class="ident" id="2317257">nil</span><br>
<span class="lineno"></span><span class="op" id="2317261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2317264">func</span>&nbsp;<span class="op" id="2317269">(</span><span class="ident" id="2317270">m</span>&nbsp;<span class="op" id="2317272">*</span><span class="ident" id="2317273">mmapper</span><span class="op" id="2317280">)</span>&nbsp;<span class="ident" id="2317282">Munmap</span><span class="op" id="2317288">(</span><span class="ident" id="2317289">data</span>&nbsp;<span class="op" id="2317294">[</span><span class="op" id="2317295">]</span><span class="builtintype" id="2317296">byte</span><span class="op" id="2317300">)</span>&nbsp;<span class="op" id="2317302">(</span><span class="ident" id="2317303">err</span>&nbsp;<span class="builtintype" id="2317307">error</span><span class="op" id="2317312">)</span>&nbsp;<span class="op" id="2317314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317317">if</span>&nbsp;<span class="builtinfunc" id="2317320">len</span><span class="op" id="2317323">(</span><span class="ident" id="2317324">data</span><span class="op" id="2317328">)</span>&nbsp;<span class="op" id="2317330">==</span>&nbsp;<span class="num" id="2317333">0</span>&nbsp;<span class="op" id="2317335">||</span>&nbsp;<span class="builtinfunc" id="2317338">len</span><span class="op" id="2317341">(</span><span class="ident" id="2317342">data</span><span class="op" id="2317346">)</span>&nbsp;<span class="op" id="2317348">!=</span>&nbsp;<span class="builtinfunc" id="2317351">cap</span><span class="op" id="2317354">(</span><span class="ident" id="2317355">data</span><span class="op" id="2317359">)</span>&nbsp;<span class="op" id="2317361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317365">return</span>&nbsp;<span class="ident" id="2317372">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317384">//&nbsp;Find&nbsp;the&nbsp;base&nbsp;of&nbsp;the&nbsp;mapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317418">p</span>&nbsp;<span class="op" id="2317420">:=</span>&nbsp;<span class="op" id="2317423">&amp;</span><span class="ident" id="2317424">data</span><span class="op" id="2317428">[</span><span class="builtinfunc" id="2317429">cap</span><span class="op" id="2317432">(</span><span class="ident" id="2317433">data</span><span class="op" id="2317437">)</span><span class="op" id="2317438">-</span><span class="num" id="2317439">1</span><span class="op" id="2317440">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317443">m</span><span class="op" id="2317444">.</span><span class="ident" id="2317445">Lock</span><span class="op" id="2317449">(</span><span class="op" id="2317450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317453">defer</span>&nbsp;<span class="ident" id="2317459">m</span><span class="op" id="2317460">.</span><span class="ident" id="2317461">Unlock</span><span class="op" id="2317467">(</span><span class="op" id="2317468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317471">b</span>&nbsp;<span class="op" id="2317473">:=</span>&nbsp;<span class="ident" id="2317476">m</span><span class="op" id="2317477">.</span><span class="ident" id="2317478">active</span><span class="op" id="2317484">[</span><span class="ident" id="2317485">p</span><span class="op" id="2317486">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317489">if</span>&nbsp;<span class="ident" id="2317492">b</span>&nbsp;<span class="op" id="2317494">==</span>&nbsp;<span class="ident" id="2317497">nil</span>&nbsp;<span class="op" id="2317501">||</span>&nbsp;<span class="op" id="2317504">&amp;</span><span class="ident" id="2317505">b</span><span class="op" id="2317506">[</span><span class="num" id="2317507">0</span><span class="op" id="2317508">]</span>&nbsp;<span class="op" id="2317510">!=</span>&nbsp;<span class="op" id="2317513">&amp;</span><span class="ident" id="2317514">data</span><span class="op" id="2317518">[</span><span class="num" id="2317519">0</span><span class="op" id="2317520">]</span>&nbsp;<span class="op" id="2317522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317526">return</span>&nbsp;<span class="ident" id="2317533">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317545">//&nbsp;Unmap&nbsp;the&nbsp;memory&nbsp;and&nbsp;update&nbsp;m.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317580">if</span>&nbsp;<span class="ident" id="2317583">errno</span>&nbsp;<span class="op" id="2317589">:=</span>&nbsp;<span class="ident" id="2317592">m</span><span class="op" id="2317593">.</span><span class="ident" id="2317594">munmap</span><span class="op" id="2317600">(</span><span class="builtintype" id="2317601">uintptr</span><span class="op" id="2317608">(</span><span class="ident" id="2317609">unsafe</span><span class="op" id="2317615">.</span><span class="ident" id="2317616">Pointer</span><span class="op" id="2317623">(</span><span class="op" id="2317624">&amp;</span><span class="ident" id="2317625">b</span><span class="op" id="2317626">[</span><span class="num" id="2317627">0</span><span class="op" id="2317628">]</span><span class="op" id="2317629">)</span><span class="op" id="2317630">)</span><span class="op" id="2317631">,</span>&nbsp;<span class="builtintype" id="2317633">uintptr</span><span class="op" id="2317640">(</span><span class="builtinfunc" id="2317641">len</span><span class="op" id="2317644">(</span><span class="ident" id="2317645">b</span><span class="op" id="2317646">)</span><span class="op" id="2317647">)</span><span class="op" id="2317648">)</span><span class="op" id="2317649">;</span>&nbsp;<span class="ident" id="2317651">errno</span>&nbsp;<span class="op" id="2317657">!=</span>&nbsp;<span class="ident" id="2317660">nil</span>&nbsp;<span class="op" id="2317664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317668">return</span>&nbsp;<span class="ident" id="2317675">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2317685">delete</span><span class="op" id="2317691">(</span><span class="ident" id="2317692">m</span><span class="op" id="2317693">.</span><span class="ident" id="2317694">active</span><span class="op" id="2317700">,</span>&nbsp;<span class="ident" id="2317702">p</span><span class="op" id="2317703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317706">return</span>&nbsp;<span class="ident" id="2317713">nil</span><br>
<span class="lineno">90</span><span class="op" id="2317717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2317720">//&nbsp;An&nbsp;Errno&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;number&nbsp;describing&nbsp;an&nbsp;error&nbsp;condition.</span><br>
<span class="lineno"></span><span class="comment" id="2317785">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;error&nbsp;interface.&nbsp;&nbsp;The&nbsp;zero&nbsp;Errno&nbsp;is&nbsp;by&nbsp;convention</span><br>
<span class="lineno"></span><span class="comment" id="2317856">//&nbsp;a&nbsp;non-error,&nbsp;so&nbsp;code&nbsp;to&nbsp;convert&nbsp;from&nbsp;Errno&nbsp;to&nbsp;error&nbsp;should&nbsp;use:</span><br>
<span class="lineno">95</span><span class="comment" id="2317923">//&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span><span class="comment" id="2317936">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;errno&nbsp;!=&nbsp;0&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2317955">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;errno</span><br>
<span class="lineno"></span><span class="comment" id="2317971">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="keyword" id="2317976">type</span>&nbsp;<span class="ident" id="2317981">Errno</span>&nbsp;<span class="builtintype" id="2317987">uintptr</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2317996">func</span>&nbsp;<span class="op" id="2318001">(</span><span class="ident" id="2318002">e</span>&nbsp;<span class="ident" id="2318004">Errno</span><span class="op" id="2318009">)</span>&nbsp;<span class="ident" id="2318011">Error</span><span class="op" id="2318016">(</span><span class="op" id="2318017">)</span>&nbsp;<span class="builtintype" id="2318019">string</span>&nbsp;<span class="op" id="2318026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318029">if</span>&nbsp;<span class="num" id="2318032">0</span>&nbsp;<span class="op" id="2318034">&lt;=</span>&nbsp;<span class="builtintype" id="2318037">int</span><span class="op" id="2318040">(</span><span class="ident" id="2318041">e</span><span class="op" id="2318042">)</span>&nbsp;<span class="op" id="2318044">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2318047">int</span><span class="op" id="2318050">(</span><span class="ident" id="2318051">e</span><span class="op" id="2318052">)</span>&nbsp;<span class="op" id="2318054">&lt;</span>&nbsp;<span class="builtinfunc" id="2318056">len</span><span class="op" id="2318059">(</span><span class="ident" id="2318060">errors</span><span class="op" id="2318066">)</span>&nbsp;<span class="op" id="2318068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318072">s</span>&nbsp;<span class="op" id="2318074">:=</span>&nbsp;<span class="ident" id="2318077">errors</span><span class="op" id="2318083">[</span><span class="ident" id="2318084">e</span><span class="op" id="2318085">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318089">if</span>&nbsp;<span class="ident" id="2318092">s</span>&nbsp;<span class="op" id="2318094">!=</span>&nbsp;<span class="string" id="2318097">&#34;&#34;</span>&nbsp;<span class="op" id="2318100">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318105">return</span>&nbsp;<span class="ident" id="2318112">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2318116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2318119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318122">return</span>&nbsp;<span class="string" id="2318129">&#34;errno&nbsp;&#34;</span>&nbsp;<span class="op" id="2318138">+</span>&nbsp;<span class="ident" id="2318140">itoa</span><span class="op" id="2318144">(</span><span class="builtintype" id="2318145">int</span><span class="op" id="2318148">(</span><span class="ident" id="2318149">e</span><span class="op" id="2318150">)</span><span class="op" id="2318151">)</span><br>
<span class="lineno"></span><span class="op" id="2318153">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="2318156">func</span>&nbsp;<span class="op" id="2318161">(</span><span class="ident" id="2318162">e</span>&nbsp;<span class="ident" id="2318164">Errno</span><span class="op" id="2318169">)</span>&nbsp;<span class="ident" id="2318171">Temporary</span><span class="op" id="2318180">(</span><span class="op" id="2318181">)</span>&nbsp;<span class="builtintype" id="2318183">bool</span>&nbsp;<span class="op" id="2318188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318191">return</span>&nbsp;<span class="ident" id="2318198">e</span>&nbsp;<span class="op" id="2318200">==</span>&nbsp;<span class="ident" id="2318203">EINTR</span>&nbsp;<span class="op" id="2318209">||</span>&nbsp;<span class="ident" id="2318212">e</span>&nbsp;<span class="op" id="2318214">==</span>&nbsp;<span class="ident" id="2318217">EMFILE</span>&nbsp;<span class="op" id="2318224">||</span>&nbsp;<span class="ident" id="2318227">e</span>&nbsp;<span class="op" id="2318229">==</span>&nbsp;<span class="ident" id="2318232">ECONNRESET</span>&nbsp;<span class="op" id="2318243">||</span>&nbsp;<span class="ident" id="2318246">e</span>&nbsp;<span class="op" id="2318248">==</span>&nbsp;<span class="ident" id="2318251">ECONNABORTED</span>&nbsp;<span class="op" id="2318264">||</span>&nbsp;<span class="ident" id="2318267">e</span><span class="op" id="2318268">.</span><span class="ident" id="2318269">Timeout</span><span class="op" id="2318276">(</span><span class="op" id="2318277">)</span><br>
<span class="lineno"></span><span class="op" id="2318279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="2318282">func</span>&nbsp;<span class="op" id="2318287">(</span><span class="ident" id="2318288">e</span>&nbsp;<span class="ident" id="2318290">Errno</span><span class="op" id="2318295">)</span>&nbsp;<span class="ident" id="2318297">Timeout</span><span class="op" id="2318304">(</span><span class="op" id="2318305">)</span>&nbsp;<span class="builtintype" id="2318307">bool</span>&nbsp;<span class="op" id="2318312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318315">return</span>&nbsp;<span class="ident" id="2318322">e</span>&nbsp;<span class="op" id="2318324">==</span>&nbsp;<span class="ident" id="2318327">EAGAIN</span>&nbsp;<span class="op" id="2318334">||</span>&nbsp;<span class="ident" id="2318337">e</span>&nbsp;<span class="op" id="2318339">==</span>&nbsp;<span class="ident" id="2318342">EWOULDBLOCK</span>&nbsp;<span class="op" id="2318354">||</span>&nbsp;<span class="ident" id="2318357">e</span>&nbsp;<span class="op" id="2318359">==</span>&nbsp;<span class="ident" id="2318362">ETIMEDOUT</span><br>
<span class="lineno"></span><span class="op" id="2318372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2318375">//&nbsp;A&nbsp;Signal&nbsp;is&nbsp;a&nbsp;number&nbsp;describing&nbsp;a&nbsp;process&nbsp;signal.</span><br>
<span class="lineno">120</span><span class="comment" id="2318428">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;os.Signal&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="2318470">type</span>&nbsp;<span class="ident" id="2318475">Signal</span>&nbsp;<span class="builtintype" id="2318482">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2318487">func</span>&nbsp;<span class="op" id="2318492">(</span><span class="ident" id="2318493">s</span>&nbsp;<span class="ident" id="2318495">Signal</span><span class="op" id="2318501">)</span>&nbsp;<span class="ident" id="2318503">Signal</span><span class="op" id="2318509">(</span><span class="op" id="2318510">)</span>&nbsp;<span class="op" id="2318512">{</span><span class="op" id="2318513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2318516">func</span>&nbsp;<span class="op" id="2318521">(</span><span class="ident" id="2318522">s</span>&nbsp;<span class="ident" id="2318524">Signal</span><span class="op" id="2318530">)</span>&nbsp;<span class="ident" id="2318532">String</span><span class="op" id="2318538">(</span><span class="op" id="2318539">)</span>&nbsp;<span class="builtintype" id="2318541">string</span>&nbsp;<span class="op" id="2318548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318551">if</span>&nbsp;<span class="num" id="2318554">0</span>&nbsp;<span class="op" id="2318556">&lt;=</span>&nbsp;<span class="ident" id="2318559">s</span>&nbsp;<span class="op" id="2318561">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2318564">int</span><span class="op" id="2318567">(</span><span class="ident" id="2318568">s</span><span class="op" id="2318569">)</span>&nbsp;<span class="op" id="2318571">&lt;</span>&nbsp;<span class="builtinfunc" id="2318573">len</span><span class="op" id="2318576">(</span><span class="ident" id="2318577">signals</span><span class="op" id="2318584">)</span>&nbsp;<span class="op" id="2318586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318590">str</span>&nbsp;<span class="op" id="2318594">:=</span>&nbsp;<span class="ident" id="2318597">signals</span><span class="op" id="2318604">[</span><span class="ident" id="2318605">s</span><span class="op" id="2318606">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318610">if</span>&nbsp;<span class="ident" id="2318613">str</span>&nbsp;<span class="op" id="2318617">!=</span>&nbsp;<span class="string" id="2318620">&#34;&#34;</span>&nbsp;<span class="op" id="2318623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318628">return</span>&nbsp;<span class="ident" id="2318635">str</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2318641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2318644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318647">return</span>&nbsp;<span class="string" id="2318654">&#34;signal&nbsp;&#34;</span>&nbsp;<span class="op" id="2318664">+</span>&nbsp;<span class="ident" id="2318666">itoa</span><span class="op" id="2318670">(</span><span class="builtintype" id="2318671">int</span><span class="op" id="2318674">(</span><span class="ident" id="2318675">s</span><span class="op" id="2318676">)</span><span class="op" id="2318677">)</span><br>
<span class="lineno"></span><span class="op" id="2318679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="2318682">func</span>&nbsp;<span class="ident" id="2318687">Read</span><span class="op" id="2318691">(</span><span class="ident" id="2318692">fd</span>&nbsp;<span class="builtintype" id="2318695">int</span><span class="op" id="2318698">,</span>&nbsp;<span class="ident" id="2318700">p</span>&nbsp;<span class="op" id="2318702">[</span><span class="op" id="2318703">]</span><span class="builtintype" id="2318704">byte</span><span class="op" id="2318708">)</span>&nbsp;<span class="op" id="2318710">(</span><span class="ident" id="2318711">n</span>&nbsp;<span class="builtintype" id="2318713">int</span><span class="op" id="2318716">,</span>&nbsp;<span class="ident" id="2318718">err</span>&nbsp;<span class="builtintype" id="2318722">error</span><span class="op" id="2318727">)</span>&nbsp;<span class="op" id="2318729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318732">n</span><span class="op" id="2318733">,</span>&nbsp;<span class="ident" id="2318735">err</span>&nbsp;<span class="op" id="2318739">=</span>&nbsp;<span class="ident" id="2318741">read</span><span class="op" id="2318745">(</span><span class="ident" id="2318746">fd</span><span class="op" id="2318748">,</span>&nbsp;<span class="ident" id="2318750">p</span><span class="op" id="2318751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318754">if</span>&nbsp;<span class="ident" id="2318757">raceenabled</span>&nbsp;<span class="op" id="2318769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318773">if</span>&nbsp;<span class="ident" id="2318776">n</span>&nbsp;<span class="op" id="2318778">&gt;</span>&nbsp;<span class="num" id="2318780">0</span>&nbsp;<span class="op" id="2318782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318787">raceWriteRange</span><span class="op" id="2318801">(</span><span class="ident" id="2318802">unsafe</span><span class="op" id="2318808">.</span><span class="ident" id="2318809">Pointer</span><span class="op" id="2318816">(</span><span class="op" id="2318817">&amp;</span><span class="ident" id="2318818">p</span><span class="op" id="2318819">[</span><span class="num" id="2318820">0</span><span class="op" id="2318821">]</span><span class="op" id="2318822">)</span><span class="op" id="2318823">,</span>&nbsp;<span class="ident" id="2318825">n</span><span class="op" id="2318826">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2318830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318834">if</span>&nbsp;<span class="ident" id="2318837">err</span>&nbsp;<span class="op" id="2318841">==</span>&nbsp;<span class="ident" id="2318844">nil</span>&nbsp;<span class="op" id="2318848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318853">raceAcquire</span><span class="op" id="2318864">(</span><span class="ident" id="2318865">unsafe</span><span class="op" id="2318871">.</span><span class="ident" id="2318872">Pointer</span><span class="op" id="2318879">(</span><span class="op" id="2318880">&amp;</span><span class="ident" id="2318881">ioSync</span><span class="op" id="2318887">)</span><span class="op" id="2318888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2318892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2318895">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318898">return</span><br>
<span class="lineno"></span><span class="op" id="2318905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2318908">func</span>&nbsp;<span class="ident" id="2318913">Write</span><span class="op" id="2318918">(</span><span class="ident" id="2318919">fd</span>&nbsp;<span class="builtintype" id="2318922">int</span><span class="op" id="2318925">,</span>&nbsp;<span class="ident" id="2318927">p</span>&nbsp;<span class="op" id="2318929">[</span><span class="op" id="2318930">]</span><span class="builtintype" id="2318931">byte</span><span class="op" id="2318935">)</span>&nbsp;<span class="op" id="2318937">(</span><span class="ident" id="2318938">n</span>&nbsp;<span class="builtintype" id="2318940">int</span><span class="op" id="2318943">,</span>&nbsp;<span class="ident" id="2318945">err</span>&nbsp;<span class="builtintype" id="2318949">error</span><span class="op" id="2318954">)</span>&nbsp;<span class="op" id="2318956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318959">if</span>&nbsp;<span class="ident" id="2318962">raceenabled</span>&nbsp;<span class="op" id="2318974">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318978">raceReleaseMerge</span><span class="op" id="2318994">(</span><span class="ident" id="2318995">unsafe</span><span class="op" id="2319001">.</span><span class="ident" id="2319002">Pointer</span><span class="op" id="2319009">(</span><span class="op" id="2319010">&amp;</span><span class="ident" id="2319011">ioSync</span><span class="op" id="2319017">)</span><span class="op" id="2319018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2319021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319024">n</span><span class="op" id="2319025">,</span>&nbsp;<span class="ident" id="2319027">err</span>&nbsp;<span class="op" id="2319031">=</span>&nbsp;<span class="ident" id="2319033">write</span><span class="op" id="2319038">(</span><span class="ident" id="2319039">fd</span><span class="op" id="2319041">,</span>&nbsp;<span class="ident" id="2319043">p</span><span class="op" id="2319044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2319047">if</span>&nbsp;<span class="ident" id="2319050">raceenabled</span>&nbsp;<span class="op" id="2319062">&amp;&amp;</span>&nbsp;<span class="ident" id="2319065">n</span>&nbsp;<span class="op" id="2319067">&gt;</span>&nbsp;<span class="num" id="2319069">0</span>&nbsp;<span class="op" id="2319071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319075">raceReadRange</span><span class="op" id="2319088">(</span><span class="ident" id="2319089">unsafe</span><span class="op" id="2319095">.</span><span class="ident" id="2319096">Pointer</span><span class="op" id="2319103">(</span><span class="op" id="2319104">&amp;</span><span class="ident" id="2319105">p</span><span class="op" id="2319106">[</span><span class="num" id="2319107">0</span><span class="op" id="2319108">]</span><span class="op" id="2319109">)</span><span class="op" id="2319110">,</span>&nbsp;<span class="ident" id="2319112">n</span><span class="op" id="2319113">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2319116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2319119">return</span><br>
<span class="lineno"></span><span class="op" id="2319126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2319129">//&nbsp;For&nbsp;testing:&nbsp;clients&nbsp;can&nbsp;set&nbsp;this&nbsp;flag&nbsp;to&nbsp;force</span><br>
<span class="lineno">160</span><span class="comment" id="2319180">//&nbsp;creation&nbsp;of&nbsp;IPv6&nbsp;sockets&nbsp;to&nbsp;return&nbsp;EAFNOSUPPORT.</span><br>
<span class="lineno"></span><span class="keyword" id="2319232">var</span>&nbsp;<span class="ident" id="2319236">SocketDisableIPv6</span>&nbsp;<span class="builtintype" id="2319254">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2319260">type</span>&nbsp;<span class="ident" id="2319265">Sockaddr</span>&nbsp;<span class="keyword" id="2319274">interface</span>&nbsp;<span class="op" id="2319284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319287">sockaddr</span><span class="op" id="2319295">(</span><span class="op" id="2319296">)</span>&nbsp;<span class="op" id="2319298">(</span><span class="ident" id="2319299">ptr</span>&nbsp;<span class="ident" id="2319303">unsafe</span><span class="op" id="2319309">.</span><span class="ident" id="2319310">Pointer</span><span class="op" id="2319317">,</span>&nbsp;<span class="builtinfunc" id="2319319">len</span>&nbsp;<span class="ident" id="2319323">_Socklen</span><span class="op" id="2319331">,</span>&nbsp;<span class="ident" id="2319333">err</span>&nbsp;<span class="builtintype" id="2319337">error</span><span class="op" id="2319342">)</span>&nbsp;<span class="comment" id="2319344">//&nbsp;lowercase;&nbsp;only&nbsp;we&nbsp;can&nbsp;define&nbsp;Sockaddrs</span><br>
<span class="lineno">165</span><span class="op" id="2319387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2319390">type</span>&nbsp;<span class="ident" id="2319395">SockaddrInet4</span>&nbsp;<span class="keyword" id="2319409">struct</span>&nbsp;<span class="op" id="2319416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319419">Port</span>&nbsp;<span class="builtintype" id="2319424">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319429">Addr</span>&nbsp;<span class="op" id="2319434">[</span><span class="num" id="2319435">4</span><span class="op" id="2319436">]</span><span class="builtintype" id="2319437">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319443">raw</span>&nbsp;&nbsp;<span class="ident" id="2319448">RawSockaddrInet4</span><br>
<span class="lineno"></span><span class="op" id="2319465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2319468">type</span>&nbsp;<span class="ident" id="2319473">SockaddrInet6</span>&nbsp;<span class="keyword" id="2319487">struct</span>&nbsp;<span class="op" id="2319494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319497">Port</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2319504">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319509">ZoneId</span>&nbsp;<span class="builtintype" id="2319516">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319524">Addr</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2319531">[</span><span class="num" id="2319532">16</span><span class="op" id="2319534">]</span><span class="builtintype" id="2319535">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319541">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2319548">RawSockaddrInet6</span><br>
<span class="lineno"></span><span class="op" id="2319565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="2319568">type</span>&nbsp;<span class="ident" id="2319573">SockaddrUnix</span>&nbsp;<span class="keyword" id="2319586">struct</span>&nbsp;<span class="op" id="2319593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319596">Name</span>&nbsp;<span class="builtintype" id="2319601">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319609">raw</span>&nbsp;&nbsp;<span class="ident" id="2319614">RawSockaddrUnix</span><br>
<span class="lineno"></span><span class="op" id="2319630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="2319633">func</span>&nbsp;<span class="ident" id="2319638">Bind</span><span class="op" id="2319642">(</span><span class="ident" id="2319643">fd</span>&nbsp;<span class="builtintype" id="2319646">int</span><span class="op" id="2319649">,</span>&nbsp;<span class="ident" id="2319651">sa</span>&nbsp;<span class="ident" id="2319654">Sockaddr</span><span class="op" id="2319662">)</span>&nbsp;<span class="op" id="2319664">(</span><span class="ident" id="2319665">err</span>&nbsp;<span class="builtintype" id="2319669">error</span><span class="op" id="2319674">)</span>&nbsp;<span class="op" id="2319676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319679">ptr</span><span class="op" id="2319682">,</span>&nbsp;<span class="ident" id="2319684">n</span><span class="op" id="2319685">,</span>&nbsp;<span class="ident" id="2319687">err</span>&nbsp;<span class="op" id="2319691">:=</span>&nbsp;<span class="ident" id="2319694">sa</span><span class="op" id="2319696">.</span><span class="ident" id="2319697">sockaddr</span><span class="op" id="2319705">(</span><span class="op" id="2319706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2319709">if</span>&nbsp;<span class="ident" id="2319712">err</span>&nbsp;<span class="op" id="2319716">!=</span>&nbsp;<span class="ident" id="2319719">nil</span>&nbsp;<span class="op" id="2319723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2319727">return</span>&nbsp;<span class="ident" id="2319734">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2319739">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2319742">return</span>&nbsp;<span class="ident" id="2319749">bind</span><span class="op" id="2319753">(</span><span class="ident" id="2319754">fd</span><span class="op" id="2319756">,</span>&nbsp;<span class="ident" id="2319758">ptr</span><span class="op" id="2319761">,</span>&nbsp;<span class="ident" id="2319763">n</span><span class="op" id="2319764">)</span><br>
<span class="lineno"></span><span class="op" id="2319766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2319769">func</span>&nbsp;<span class="ident" id="2319774">Connect</span><span class="op" id="2319781">(</span><span class="ident" id="2319782">fd</span>&nbsp;<span class="builtintype" id="2319785">int</span><span class="op" id="2319788">,</span>&nbsp;<span class="ident" id="2319790">sa</span>&nbsp;<span class="ident" id="2319793">Sockaddr</span><span class="op" id="2319801">)</span>&nbsp;<span class="op" id="2319803">(</span><span class="ident" id="2319804">err</span>&nbsp;<span class="builtintype" id="2319808">error</span><span class="op" id="2319813">)</span>&nbsp;<span class="op" id="2319815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2319818">ptr</span><span class="op" id="2319821">,</span>&nbsp;<span class="ident" id="2319823">n</span><span class="op" id="2319824">,</span>&nbsp;<span class="ident" id="2319826">err</span>&nbsp;<span class="op" id="2319830">:=</span>&nbsp;<span class="ident" id="2319833">sa</span><span class="op" id="2319835">.</span><span class="ident" id="2319836">sockaddr</span><span class="op" id="2319844">(</span><span class="op" id="2319845">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2319848">if</span>&nbsp;<span class="ident" id="2319851">err</span>&nbsp;<span class="op" id="2319855">!=</span>&nbsp;<span class="ident" id="2319858">nil</span>&nbsp;<span class="op" id="2319862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2319866">return</span>&nbsp;<span class="ident" id="2319873">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2319878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2319881">return</span>&nbsp;<span class="ident" id="2319888">connect</span><span class="op" id="2319895">(</span><span class="ident" id="2319896">fd</span><span class="op" id="2319898">,</span>&nbsp;<span class="ident" id="2319900">ptr</span><span class="op" id="2319903">,</span>&nbsp;<span class="ident" id="2319905">n</span><span class="op" id="2319906">)</span><br>
<span class="lineno"></span><span class="op" id="2319908">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="2319911">func</span>&nbsp;<span class="ident" id="2319916">Getpeername</span><span class="op" id="2319927">(</span><span class="ident" id="2319928">fd</span>&nbsp;<span class="builtintype" id="2319931">int</span><span class="op" id="2319934">)</span>&nbsp;<span class="op" id="2319936">(</span><span class="ident" id="2319937">sa</span>&nbsp;<span class="ident" id="2319940">Sockaddr</span><span class="op" id="2319948">,</span>&nbsp;<span class="ident" id="2319950">err</span>&nbsp;<span class="builtintype" id="2319954">error</span><span class="op" id="2319959">)</span>&nbsp;<span class="op" id="2319961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2319964">var</span>&nbsp;<span class="ident" id="2319968">rsa</span>&nbsp;<span class="ident" id="2319972">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2319988">var</span>&nbsp;<span class="builtinfunc" id="2319992">len</span>&nbsp;<span class="ident" id="2319996">_Socklen</span>&nbsp;<span class="op" id="2320005">=</span>&nbsp;<span class="ident" id="2320007">SizeofSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320026">if</span>&nbsp;<span class="ident" id="2320029">err</span>&nbsp;<span class="op" id="2320033">=</span>&nbsp;<span class="ident" id="2320035">getpeername</span><span class="op" id="2320046">(</span><span class="ident" id="2320047">fd</span><span class="op" id="2320049">,</span>&nbsp;<span class="op" id="2320051">&amp;</span><span class="ident" id="2320052">rsa</span><span class="op" id="2320055">,</span>&nbsp;<span class="op" id="2320057">&amp;</span><span class="builtinfunc" id="2320058">len</span><span class="op" id="2320061">)</span><span class="op" id="2320062">;</span>&nbsp;<span class="ident" id="2320064">err</span>&nbsp;<span class="op" id="2320068">!=</span>&nbsp;<span class="ident" id="2320071">nil</span>&nbsp;<span class="op" id="2320075">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320079">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2320087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320090">return</span>&nbsp;<span class="ident" id="2320097">anyToSockaddr</span><span class="op" id="2320110">(</span><span class="op" id="2320111">&amp;</span><span class="ident" id="2320112">rsa</span><span class="op" id="2320115">)</span><br>
<span class="lineno"></span><span class="op" id="2320117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2320120">func</span>&nbsp;<span class="ident" id="2320125">GetsockoptInt</span><span class="op" id="2320138">(</span><span class="ident" id="2320139">fd</span><span class="op" id="2320141">,</span>&nbsp;<span class="ident" id="2320143">level</span><span class="op" id="2320148">,</span>&nbsp;<span class="ident" id="2320150">opt</span>&nbsp;<span class="builtintype" id="2320154">int</span><span class="op" id="2320157">)</span>&nbsp;<span class="op" id="2320159">(</span><span class="ident" id="2320160">value</span>&nbsp;<span class="builtintype" id="2320166">int</span><span class="op" id="2320169">,</span>&nbsp;<span class="ident" id="2320171">err</span>&nbsp;<span class="builtintype" id="2320175">error</span><span class="op" id="2320180">)</span>&nbsp;<span class="op" id="2320182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320185">var</span>&nbsp;<span class="ident" id="2320189">n</span>&nbsp;<span class="builtintype" id="2320191">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2320198">vallen</span>&nbsp;<span class="op" id="2320205">:=</span>&nbsp;<span class="ident" id="2320208">_Socklen</span><span class="op" id="2320216">(</span><span class="num" id="2320217">4</span><span class="op" id="2320218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2320221">err</span>&nbsp;<span class="op" id="2320225">=</span>&nbsp;<span class="ident" id="2320227">getsockopt</span><span class="op" id="2320237">(</span><span class="ident" id="2320238">fd</span><span class="op" id="2320240">,</span>&nbsp;<span class="ident" id="2320242">level</span><span class="op" id="2320247">,</span>&nbsp;<span class="ident" id="2320249">opt</span><span class="op" id="2320252">,</span>&nbsp;<span class="ident" id="2320254">unsafe</span><span class="op" id="2320260">.</span><span class="ident" id="2320261">Pointer</span><span class="op" id="2320268">(</span><span class="op" id="2320269">&amp;</span><span class="ident" id="2320270">n</span><span class="op" id="2320271">)</span><span class="op" id="2320272">,</span>&nbsp;<span class="op" id="2320274">&amp;</span><span class="ident" id="2320275">vallen</span><span class="op" id="2320281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320284">return</span>&nbsp;<span class="builtintype" id="2320291">int</span><span class="op" id="2320294">(</span><span class="ident" id="2320295">n</span><span class="op" id="2320296">)</span><span class="op" id="2320297">,</span>&nbsp;<span class="ident" id="2320299">err</span><br>
<span class="lineno">215</span><span class="op" id="2320303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2320306">func</span>&nbsp;<span class="ident" id="2320311">Recvfrom</span><span class="op" id="2320319">(</span><span class="ident" id="2320320">fd</span>&nbsp;<span class="builtintype" id="2320323">int</span><span class="op" id="2320326">,</span>&nbsp;<span class="ident" id="2320328">p</span>&nbsp;<span class="op" id="2320330">[</span><span class="op" id="2320331">]</span><span class="builtintype" id="2320332">byte</span><span class="op" id="2320336">,</span>&nbsp;<span class="ident" id="2320338">flags</span>&nbsp;<span class="builtintype" id="2320344">int</span><span class="op" id="2320347">)</span>&nbsp;<span class="op" id="2320349">(</span><span class="ident" id="2320350">n</span>&nbsp;<span class="builtintype" id="2320352">int</span><span class="op" id="2320355">,</span>&nbsp;<span class="ident" id="2320357">from</span>&nbsp;<span class="ident" id="2320362">Sockaddr</span><span class="op" id="2320370">,</span>&nbsp;<span class="ident" id="2320372">err</span>&nbsp;<span class="builtintype" id="2320376">error</span><span class="op" id="2320381">)</span>&nbsp;<span class="op" id="2320383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320386">var</span>&nbsp;<span class="ident" id="2320390">rsa</span>&nbsp;<span class="ident" id="2320394">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320410">var</span>&nbsp;<span class="builtinfunc" id="2320414">len</span>&nbsp;<span class="ident" id="2320418">_Socklen</span>&nbsp;<span class="op" id="2320427">=</span>&nbsp;<span class="ident" id="2320429">SizeofSockaddrAny</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320448">if</span>&nbsp;<span class="ident" id="2320451">n</span><span class="op" id="2320452">,</span>&nbsp;<span class="ident" id="2320454">err</span>&nbsp;<span class="op" id="2320458">=</span>&nbsp;<span class="ident" id="2320460">recvfrom</span><span class="op" id="2320468">(</span><span class="ident" id="2320469">fd</span><span class="op" id="2320471">,</span>&nbsp;<span class="ident" id="2320473">p</span><span class="op" id="2320474">,</span>&nbsp;<span class="ident" id="2320476">flags</span><span class="op" id="2320481">,</span>&nbsp;<span class="op" id="2320483">&amp;</span><span class="ident" id="2320484">rsa</span><span class="op" id="2320487">,</span>&nbsp;<span class="op" id="2320489">&amp;</span><span class="builtinfunc" id="2320490">len</span><span class="op" id="2320493">)</span><span class="op" id="2320494">;</span>&nbsp;<span class="ident" id="2320496">err</span>&nbsp;<span class="op" id="2320500">!=</span>&nbsp;<span class="ident" id="2320503">nil</span>&nbsp;<span class="op" id="2320507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320511">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2320519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320522">if</span>&nbsp;<span class="ident" id="2320525">rsa</span><span class="op" id="2320528">.</span><span class="ident" id="2320529">Addr</span><span class="op" id="2320533">.</span><span class="ident" id="2320534">Family</span>&nbsp;<span class="op" id="2320541">!=</span>&nbsp;<span class="ident" id="2320544">AF_UNSPEC</span>&nbsp;<span class="op" id="2320554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2320558">from</span><span class="op" id="2320562">,</span>&nbsp;<span class="ident" id="2320564">err</span>&nbsp;<span class="op" id="2320568">=</span>&nbsp;<span class="ident" id="2320570">anyToSockaddr</span><span class="op" id="2320583">(</span><span class="op" id="2320584">&amp;</span><span class="ident" id="2320585">rsa</span><span class="op" id="2320588">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2320591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320594">return</span><br>
<span class="lineno"></span><span class="op" id="2320601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2320604">func</span>&nbsp;<span class="ident" id="2320609">Sendto</span><span class="op" id="2320615">(</span><span class="ident" id="2320616">fd</span>&nbsp;<span class="builtintype" id="2320619">int</span><span class="op" id="2320622">,</span>&nbsp;<span class="ident" id="2320624">p</span>&nbsp;<span class="op" id="2320626">[</span><span class="op" id="2320627">]</span><span class="builtintype" id="2320628">byte</span><span class="op" id="2320632">,</span>&nbsp;<span class="ident" id="2320634">flags</span>&nbsp;<span class="builtintype" id="2320640">int</span><span class="op" id="2320643">,</span>&nbsp;<span class="ident" id="2320645">to</span>&nbsp;<span class="ident" id="2320648">Sockaddr</span><span class="op" id="2320656">)</span>&nbsp;<span class="op" id="2320658">(</span><span class="ident" id="2320659">err</span>&nbsp;<span class="builtintype" id="2320663">error</span><span class="op" id="2320668">)</span>&nbsp;<span class="op" id="2320670">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2320673">ptr</span><span class="op" id="2320676">,</span>&nbsp;<span class="ident" id="2320678">n</span><span class="op" id="2320679">,</span>&nbsp;<span class="ident" id="2320681">err</span>&nbsp;<span class="op" id="2320685">:=</span>&nbsp;<span class="ident" id="2320688">to</span><span class="op" id="2320690">.</span><span class="ident" id="2320691">sockaddr</span><span class="op" id="2320699">(</span><span class="op" id="2320700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320703">if</span>&nbsp;<span class="ident" id="2320706">err</span>&nbsp;<span class="op" id="2320710">!=</span>&nbsp;<span class="ident" id="2320713">nil</span>&nbsp;<span class="op" id="2320717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320721">return</span>&nbsp;<span class="ident" id="2320728">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2320733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320736">return</span>&nbsp;<span class="ident" id="2320743">sendto</span><span class="op" id="2320749">(</span><span class="ident" id="2320750">fd</span><span class="op" id="2320752">,</span>&nbsp;<span class="ident" id="2320754">p</span><span class="op" id="2320755">,</span>&nbsp;<span class="ident" id="2320757">flags</span><span class="op" id="2320762">,</span>&nbsp;<span class="ident" id="2320764">ptr</span><span class="op" id="2320767">,</span>&nbsp;<span class="ident" id="2320769">n</span><span class="op" id="2320770">)</span><br>
<span class="lineno">235</span><span class="op" id="2320772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2320775">func</span>&nbsp;<span class="ident" id="2320780">SetsockoptByte</span><span class="op" id="2320794">(</span><span class="ident" id="2320795">fd</span><span class="op" id="2320797">,</span>&nbsp;<span class="ident" id="2320799">level</span><span class="op" id="2320804">,</span>&nbsp;<span class="ident" id="2320806">opt</span>&nbsp;<span class="builtintype" id="2320810">int</span><span class="op" id="2320813">,</span>&nbsp;<span class="ident" id="2320815">value</span>&nbsp;<span class="builtintype" id="2320821">byte</span><span class="op" id="2320825">)</span>&nbsp;<span class="op" id="2320827">(</span><span class="ident" id="2320828">err</span>&nbsp;<span class="builtintype" id="2320832">error</span><span class="op" id="2320837">)</span>&nbsp;<span class="op" id="2320839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320842">return</span>&nbsp;<span class="ident" id="2320849">setsockopt</span><span class="op" id="2320859">(</span><span class="ident" id="2320860">fd</span><span class="op" id="2320862">,</span>&nbsp;<span class="ident" id="2320864">level</span><span class="op" id="2320869">,</span>&nbsp;<span class="ident" id="2320871">opt</span><span class="op" id="2320874">,</span>&nbsp;<span class="ident" id="2320876">unsafe</span><span class="op" id="2320882">.</span><span class="ident" id="2320883">Pointer</span><span class="op" id="2320890">(</span><span class="op" id="2320891">&amp;</span><span class="ident" id="2320892">value</span><span class="op" id="2320897">)</span><span class="op" id="2320898">,</span>&nbsp;<span class="num" id="2320900">1</span><span class="op" id="2320901">)</span><br>
<span class="lineno"></span><span class="op" id="2320903">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2320906">func</span>&nbsp;<span class="ident" id="2320911">SetsockoptInt</span><span class="op" id="2320924">(</span><span class="ident" id="2320925">fd</span><span class="op" id="2320927">,</span>&nbsp;<span class="ident" id="2320929">level</span><span class="op" id="2320934">,</span>&nbsp;<span class="ident" id="2320936">opt</span>&nbsp;<span class="builtintype" id="2320940">int</span><span class="op" id="2320943">,</span>&nbsp;<span class="ident" id="2320945">value</span>&nbsp;<span class="builtintype" id="2320951">int</span><span class="op" id="2320954">)</span>&nbsp;<span class="op" id="2320956">(</span><span class="ident" id="2320957">err</span>&nbsp;<span class="builtintype" id="2320961">error</span><span class="op" id="2320966">)</span>&nbsp;<span class="op" id="2320968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320971">var</span>&nbsp;<span class="ident" id="2320975">n</span>&nbsp;<span class="op" id="2320977">=</span>&nbsp;<span class="builtintype" id="2320979">int32</span><span class="op" id="2320984">(</span><span class="ident" id="2320985">value</span><span class="op" id="2320990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2320993">return</span>&nbsp;<span class="ident" id="2321000">setsockopt</span><span class="op" id="2321010">(</span><span class="ident" id="2321011">fd</span><span class="op" id="2321013">,</span>&nbsp;<span class="ident" id="2321015">level</span><span class="op" id="2321020">,</span>&nbsp;<span class="ident" id="2321022">opt</span><span class="op" id="2321025">,</span>&nbsp;<span class="ident" id="2321027">unsafe</span><span class="op" id="2321033">.</span><span class="ident" id="2321034">Pointer</span><span class="op" id="2321041">(</span><span class="op" id="2321042">&amp;</span><span class="ident" id="2321043">n</span><span class="op" id="2321044">)</span><span class="op" id="2321045">,</span>&nbsp;<span class="num" id="2321047">4</span><span class="op" id="2321048">)</span><br>
<span class="lineno"></span><span class="op" id="2321050">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="2321053">func</span>&nbsp;<span class="ident" id="2321058">SetsockoptInet4Addr</span><span class="op" id="2321077">(</span><span class="ident" id="2321078">fd</span><span class="op" id="2321080">,</span>&nbsp;<span class="ident" id="2321082">level</span><span class="op" id="2321087">,</span>&nbsp;<span class="ident" id="2321089">opt</span>&nbsp;<span class="builtintype" id="2321093">int</span><span class="op" id="2321096">,</span>&nbsp;<span class="ident" id="2321098">value</span>&nbsp;<span class="op" id="2321104">[</span><span class="num" id="2321105">4</span><span class="op" id="2321106">]</span><span class="builtintype" id="2321107">byte</span><span class="op" id="2321111">)</span>&nbsp;<span class="op" id="2321113">(</span><span class="ident" id="2321114">err</span>&nbsp;<span class="builtintype" id="2321118">error</span><span class="op" id="2321123">)</span>&nbsp;<span class="op" id="2321125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2321128">return</span>&nbsp;<span class="ident" id="2321135">setsockopt</span><span class="op" id="2321145">(</span><span class="ident" id="2321146">fd</span><span class="op" id="2321148">,</span>&nbsp;<span class="ident" id="2321150">level</span><span class="op" id="2321155">,</span>&nbsp;<span class="ident" id="2321157">opt</span><span class="op" id="2321160">,</span>&nbsp;<span class="ident" id="2321162">unsafe</span><span class="op" id="2321168">.</span><span class="ident" id="2321169">Pointer</span><span class="op" id="2321176">(</span><span class="op" id="2321177">&amp;</span><span class="ident" id="2321178">value</span><span class="op" id="2321183">[</span><span class="num" id="2321184">0</span><span class="op" id="2321185">]</span><span class="op" id="2321186">)</span><span class="op" id="2321187">,</span>&nbsp;<span class="num" id="2321189">4</span><span class="op" id="2321190">)</span><br>
<span class="lineno"></span><span class="op" id="2321192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="2321195">func</span>&nbsp;<span class="ident" id="2321200">SetsockoptIPMreq</span><span class="op" id="2321216">(</span><span class="ident" id="2321217">fd</span><span class="op" id="2321219">,</span>&nbsp;<span class="ident" id="2321221">level</span><span class="op" id="2321226">,</span>&nbsp;<span class="ident" id="2321228">opt</span>&nbsp;<span class="builtintype" id="2321232">int</span><span class="op" id="2321235">,</span>&nbsp;<span class="ident" id="2321237">mreq</span>&nbsp;<span class="op" id="2321242">*</span><span class="ident" id="2321243">IPMreq</span><span class="op" id="2321249">)</span>&nbsp;<span class="op" id="2321251">(</span><span class="ident" id="2321252">err</span>&nbsp;<span class="builtintype" id="2321256">error</span><span class="op" id="2321261">)</span>&nbsp;<span class="op" id="2321263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2321266">return</span>&nbsp;<span class="ident" id="2321273">setsockopt</span><span class="op" id="2321283">(</span><span class="ident" id="2321284">fd</span><span class="op" id="2321286">,</span>&nbsp;<span class="ident" id="2321288">level</span><span class="op" id="2321293">,</span>&nbsp;<span class="ident" id="2321295">opt</span><span class="op" id="2321298">,</span>&nbsp;<span class="ident" id="2321300">unsafe</span><span class="op" id="2321306">.</span><span class="ident" id="2321307">Pointer</span><span class="op" id="2321314">(</span><span class="ident" id="2321315">mreq</span><span class="op" id="2321319">)</span><span class="op" id="2321320">,</span>&nbsp;<span class="ident" id="2321322">SizeofIPMreq</span><span class="op" id="2321334">)</span><br>
<span class="lineno"></span><span class="op" id="2321336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2321339">func</span>&nbsp;<span class="ident" id="2321344">SetsockoptIPv6Mreq</span><span class="op" id="2321362">(</span><span class="ident" id="2321363">fd</span><span class="op" id="2321365">,</span>&nbsp;<span class="ident" id="2321367">level</span><span class="op" id="2321372">,</span>&nbsp;<span class="ident" id="2321374">opt</span>&nbsp;<span class="builtintype" id="2321378">int</span><span class="op" id="2321381">,</span>&nbsp;<span class="ident" id="2321383">mreq</span>&nbsp;<span class="op" id="2321388">*</span><span class="ident" id="2321389">IPv6Mreq</span><span class="op" id="2321397">)</span>&nbsp;<span class="op" id="2321399">(</span><span class="ident" id="2321400">err</span>&nbsp;<span class="builtintype" id="2321404">error</span><span class="op" id="2321409">)</span>&nbsp;<span class="op" id="2321411">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2321414">return</span>&nbsp;<span class="ident" id="2321421">setsockopt</span><span class="op" id="2321431">(</span><span class="ident" id="2321432">fd</span><span class="op" id="2321434">,</span>&nbsp;<span class="ident" id="2321436">level</span><span class="op" id="2321441">,</span>&nbsp;<span class="ident" id="2321443">opt</span><span class="op" id="2321446">,</span>&nbsp;<span class="ident" id="2321448">unsafe</span><span class="op" id="2321454">.</span><span class="ident" id="2321455">Pointer</span><span class="op" id="2321462">(</span><span class="ident" id="2321463">mreq</span><span class="op" id="2321467">)</span><span class="op" id="2321468">,</span>&nbsp;<span class="ident" id="2321470">SizeofIPv6Mreq</span><span class="op" id="2321484">)</span><br>
<span class="lineno"></span><span class="op" id="2321486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2321489">func</span>&nbsp;<span class="ident" id="2321494">SetsockoptICMPv6Filter</span><span class="op" id="2321516">(</span><span class="ident" id="2321517">fd</span><span class="op" id="2321519">,</span>&nbsp;<span class="ident" id="2321521">level</span><span class="op" id="2321526">,</span>&nbsp;<span class="ident" id="2321528">opt</span>&nbsp;<span class="builtintype" id="2321532">int</span><span class="op" id="2321535">,</span>&nbsp;<span class="ident" id="2321537">filter</span>&nbsp;<span class="op" id="2321544">*</span><span class="ident" id="2321545">ICMPv6Filter</span><span class="op" id="2321557">)</span>&nbsp;<span class="builtintype" id="2321559">error</span>&nbsp;<span class="op" id="2321565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2321568">return</span>&nbsp;<span class="ident" id="2321575">setsockopt</span><span class="op" id="2321585">(</span><span class="ident" id="2321586">fd</span><span class="op" id="2321588">,</span>&nbsp;<span class="ident" id="2321590">level</span><span class="op" id="2321595">,</span>&nbsp;<span class="ident" id="2321597">opt</span><span class="op" id="2321600">,</span>&nbsp;<span class="ident" id="2321602">unsafe</span><span class="op" id="2321608">.</span><span class="ident" id="2321609">Pointer</span><span class="op" id="2321616">(</span><span class="ident" id="2321617">filter</span><span class="op" id="2321623">)</span><span class="op" id="2321624">,</span>&nbsp;<span class="ident" id="2321626">SizeofICMPv6Filter</span><span class="op" id="2321644">)</span><br>
<span class="lineno">260</span><span class="op" id="2321646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2321649">func</span>&nbsp;<span class="ident" id="2321654">SetsockoptLinger</span><span class="op" id="2321670">(</span><span class="ident" id="2321671">fd</span><span class="op" id="2321673">,</span>&nbsp;<span class="ident" id="2321675">level</span><span class="op" id="2321680">,</span>&nbsp;<span class="ident" id="2321682">opt</span>&nbsp;<span class="builtintype" id="2321686">int</span><span class="op" id="2321689">,</span>&nbsp;<span class="ident" id="2321691">l</span>&nbsp;<span class="op" id="2321693">*</span><span class="ident" id="2321694">Linger</span><span class="op" id="2321700">)</span>&nbsp;<span class="op" id="2321702">(</span><span class="ident" id="2321703">err</span>&nbsp;<span class="builtintype" id="2321707">error</span><span class="op" id="2321712">)</span>&nbsp;<span class="op" id="2321714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2321717">return</span>&nbsp;<span class="ident" id="2321724">setsockopt</span><span class="op" id="2321734">(</span><span class="ident" id="2321735">fd</span><span class="op" id="2321737">,</span>&nbsp;<span class="ident" id="2321739">level</span><span class="op" id="2321744">,</span>&nbsp;<span class="ident" id="2321746">opt</span><span class="op" id="2321749">,</span>&nbsp;<span class="ident" id="2321751">unsafe</span><span class="op" id="2321757">.</span><span class="ident" id="2321758">Pointer</span><span class="op" id="2321765">(</span><span class="ident" id="2321766">l</span><span class="op" id="2321767">)</span><span class="op" id="2321768">,</span>&nbsp;<span class="ident" id="2321770">SizeofLinger</span><span class="op" id="2321782">)</span><br>
<span class="lineno"></span><span class="op" id="2321784">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2321787">func</span>&nbsp;<span class="ident" id="2321792">SetsockoptString</span><span class="op" id="2321808">(</span><span class="ident" id="2321809">fd</span><span class="op" id="2321811">,</span>&nbsp;<span class="ident" id="2321813">level</span><span class="op" id="2321818">,</span>&nbsp;<span class="ident" id="2321820">opt</span>&nbsp;<span class="builtintype" id="2321824">int</span><span class="op" id="2321827">,</span>&nbsp;<span class="ident" id="2321829">s</span>&nbsp;<span class="builtintype" id="2321831">string</span><span class="op" id="2321837">)</span>&nbsp;<span class="op" id="2321839">(</span><span class="ident" id="2321840">err</span>&nbsp;<span class="builtintype" id="2321844">error</span><span class="op" id="2321849">)</span>&nbsp;<span class="op" id="2321851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2321854">return</span>&nbsp;<span class="ident" id="2321861">setsockopt</span><span class="op" id="2321871">(</span><span class="ident" id="2321872">fd</span><span class="op" id="2321874">,</span>&nbsp;<span class="ident" id="2321876">level</span><span class="op" id="2321881">,</span>&nbsp;<span class="ident" id="2321883">opt</span><span class="op" id="2321886">,</span>&nbsp;<span class="ident" id="2321888">unsafe</span><span class="op" id="2321894">.</span><span class="ident" id="2321895">Pointer</span><span class="op" id="2321902">(</span><span class="op" id="2321903">&amp;</span><span class="op" id="2321904">[</span><span class="op" id="2321905">]</span><span class="builtintype" id="2321906">byte</span><span class="op" id="2321910">(</span><span class="ident" id="2321911">s</span><span class="op" id="2321912">)</span><span class="op" id="2321913">[</span><span class="num" id="2321914">0</span><span class="op" id="2321915">]</span><span class="op" id="2321916">)</span><span class="op" id="2321917">,</span>&nbsp;<span class="builtintype" id="2321919">uintptr</span><span class="op" id="2321926">(</span><span class="builtinfunc" id="2321927">len</span><span class="op" id="2321930">(</span><span class="ident" id="2321931">s</span><span class="op" id="2321932">)</span><span class="op" id="2321933">)</span><span class="op" id="2321934">)</span><br>
<span class="lineno"></span><span class="op" id="2321936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2321939">func</span>&nbsp;<span class="ident" id="2321944">SetsockoptTimeval</span><span class="op" id="2321961">(</span><span class="ident" id="2321962">fd</span><span class="op" id="2321964">,</span>&nbsp;<span class="ident" id="2321966">level</span><span class="op" id="2321971">,</span>&nbsp;<span class="ident" id="2321973">opt</span>&nbsp;<span class="builtintype" id="2321977">int</span><span class="op" id="2321980">,</span>&nbsp;<span class="ident" id="2321982">tv</span>&nbsp;<span class="op" id="2321985">*</span><span class="ident" id="2321986">Timeval</span><span class="op" id="2321993">)</span>&nbsp;<span class="op" id="2321995">(</span><span class="ident" id="2321996">err</span>&nbsp;<span class="builtintype" id="2322000">error</span><span class="op" id="2322005">)</span>&nbsp;<span class="op" id="2322007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2322010">return</span>&nbsp;<span class="ident" id="2322017">setsockopt</span><span class="op" id="2322027">(</span><span class="ident" id="2322028">fd</span><span class="op" id="2322030">,</span>&nbsp;<span class="ident" id="2322032">level</span><span class="op" id="2322037">,</span>&nbsp;<span class="ident" id="2322039">opt</span><span class="op" id="2322042">,</span>&nbsp;<span class="ident" id="2322044">unsafe</span><span class="op" id="2322050">.</span><span class="ident" id="2322051">Pointer</span><span class="op" id="2322058">(</span><span class="ident" id="2322059">tv</span><span class="op" id="2322061">)</span><span class="op" id="2322062">,</span>&nbsp;<span class="ident" id="2322064">unsafe</span><span class="op" id="2322070">.</span><span class="ident" id="2322071">Sizeof</span><span class="op" id="2322077">(</span><span class="op" id="2322078">*</span><span class="ident" id="2322079">tv</span><span class="op" id="2322081">)</span><span class="op" id="2322082">)</span><br>
<span class="lineno"></span><span class="op" id="2322084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2322087">func</span>&nbsp;<span class="ident" id="2322092">Socket</span><span class="op" id="2322098">(</span><span class="ident" id="2322099">domain</span><span class="op" id="2322105">,</span>&nbsp;<span class="ident" id="2322107">typ</span><span class="op" id="2322110">,</span>&nbsp;<span class="ident" id="2322112">proto</span>&nbsp;<span class="builtintype" id="2322118">int</span><span class="op" id="2322121">)</span>&nbsp;<span class="op" id="2322123">(</span><span class="ident" id="2322124">fd</span>&nbsp;<span class="builtintype" id="2322127">int</span><span class="op" id="2322130">,</span>&nbsp;<span class="ident" id="2322132">err</span>&nbsp;<span class="builtintype" id="2322136">error</span><span class="op" id="2322141">)</span>&nbsp;<span class="op" id="2322143">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2322146">if</span>&nbsp;<span class="ident" id="2322149">domain</span>&nbsp;<span class="op" id="2322156">==</span>&nbsp;<span class="ident" id="2322159">AF_INET6</span>&nbsp;<span class="op" id="2322168">&amp;&amp;</span>&nbsp;<span class="ident" id="2322171">SocketDisableIPv6</span>&nbsp;<span class="op" id="2322189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2322193">return</span>&nbsp;<span class="op" id="2322200">-</span><span class="num" id="2322201">1</span><span class="op" id="2322202">,</span>&nbsp;<span class="ident" id="2322204">EAFNOSUPPORT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2322218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2322221">fd</span><span class="op" id="2322223">,</span>&nbsp;<span class="ident" id="2322225">err</span>&nbsp;<span class="op" id="2322229">=</span>&nbsp;<span class="ident" id="2322231">socket</span><span class="op" id="2322237">(</span><span class="ident" id="2322238">domain</span><span class="op" id="2322244">,</span>&nbsp;<span class="ident" id="2322246">typ</span><span class="op" id="2322249">,</span>&nbsp;<span class="ident" id="2322251">proto</span><span class="op" id="2322256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2322259">return</span><br>
<span class="lineno">280</span><span class="op" id="2322266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2322269">func</span>&nbsp;<span class="ident" id="2322274">Socketpair</span><span class="op" id="2322284">(</span><span class="ident" id="2322285">domain</span><span class="op" id="2322291">,</span>&nbsp;<span class="ident" id="2322293">typ</span><span class="op" id="2322296">,</span>&nbsp;<span class="ident" id="2322298">proto</span>&nbsp;<span class="builtintype" id="2322304">int</span><span class="op" id="2322307">)</span>&nbsp;<span class="op" id="2322309">(</span><span class="ident" id="2322310">fd</span>&nbsp;<span class="op" id="2322313">[</span><span class="num" id="2322314">2</span><span class="op" id="2322315">]</span><span class="builtintype" id="2322316">int</span><span class="op" id="2322319">,</span>&nbsp;<span class="ident" id="2322321">err</span>&nbsp;<span class="builtintype" id="2322325">error</span><span class="op" id="2322330">)</span>&nbsp;<span class="op" id="2322332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2322335">var</span>&nbsp;<span class="ident" id="2322339">fdx</span>&nbsp;<span class="op" id="2322343">[</span><span class="num" id="2322344">2</span><span class="op" id="2322345">]</span><span class="builtintype" id="2322346">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2322353">err</span>&nbsp;<span class="op" id="2322357">=</span>&nbsp;<span class="ident" id="2322359">socketpair</span><span class="op" id="2322369">(</span><span class="ident" id="2322370">domain</span><span class="op" id="2322376">,</span>&nbsp;<span class="ident" id="2322378">typ</span><span class="op" id="2322381">,</span>&nbsp;<span class="ident" id="2322383">proto</span><span class="op" id="2322388">,</span>&nbsp;<span class="op" id="2322390">&amp;</span><span class="ident" id="2322391">fdx</span><span class="op" id="2322394">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2322397">if</span>&nbsp;<span class="ident" id="2322400">err</span>&nbsp;<span class="op" id="2322404">==</span>&nbsp;<span class="ident" id="2322407">nil</span>&nbsp;<span class="op" id="2322411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2322415">fd</span><span class="op" id="2322417">[</span><span class="num" id="2322418">0</span><span class="op" id="2322419">]</span>&nbsp;<span class="op" id="2322421">=</span>&nbsp;<span class="builtintype" id="2322423">int</span><span class="op" id="2322426">(</span><span class="ident" id="2322427">fdx</span><span class="op" id="2322430">[</span><span class="num" id="2322431">0</span><span class="op" id="2322432">]</span><span class="op" id="2322433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2322437">fd</span><span class="op" id="2322439">[</span><span class="num" id="2322440">1</span><span class="op" id="2322441">]</span>&nbsp;<span class="op" id="2322443">=</span>&nbsp;<span class="builtintype" id="2322445">int</span><span class="op" id="2322448">(</span><span class="ident" id="2322449">fdx</span><span class="op" id="2322452">[</span><span class="num" id="2322453">1</span><span class="op" id="2322454">]</span><span class="op" id="2322455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2322458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2322461">return</span><br>
<span class="lineno">290</span><span class="op" id="2322468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2322471">func</span>&nbsp;<span class="ident" id="2322476">Sendfile</span><span class="op" id="2322484">(</span><span class="ident" id="2322485">outfd</span>&nbsp;<span class="builtintype" id="2322491">int</span><span class="op" id="2322494">,</span>&nbsp;<span class="ident" id="2322496">infd</span>&nbsp;<span class="builtintype" id="2322501">int</span><span class="op" id="2322504">,</span>&nbsp;<span class="ident" id="2322506">offset</span>&nbsp;<span class="op" id="2322513">*</span><span class="ident" id="2322514">int64</span><span class="op" id="2322519">,</span>&nbsp;<span class="ident" id="2322521">count</span>&nbsp;<span class="builtintype" id="2322527">int</span><span class="op" id="2322530">)</span>&nbsp;<span class="op" id="2322532">(</span><span class="ident" id="2322533">written</span>&nbsp;<span class="builtintype" id="2322541">int</span><span class="op" id="2322544">,</span>&nbsp;<span class="ident" id="2322546">err</span>&nbsp;<span class="builtintype" id="2322550">error</span><span class="op" id="2322555">)</span>&nbsp;<span class="op" id="2322557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2322560">if</span>&nbsp;<span class="ident" id="2322563">raceenabled</span>&nbsp;<span class="op" id="2322575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2322579">raceReleaseMerge</span><span class="op" id="2322595">(</span><span class="ident" id="2322596">unsafe</span><span class="op" id="2322602">.</span><span class="ident" id="2322603">Pointer</span><span class="op" id="2322610">(</span><span class="op" id="2322611">&amp;</span><span class="ident" id="2322612">ioSync</span><span class="op" id="2322618">)</span><span class="op" id="2322619">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2322622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2322625">return</span>&nbsp;<span class="ident" id="2322632">sendfile</span><span class="op" id="2322640">(</span><span class="ident" id="2322641">outfd</span><span class="op" id="2322646">,</span>&nbsp;<span class="ident" id="2322648">infd</span><span class="op" id="2322652">,</span>&nbsp;<span class="ident" id="2322654">offset</span><span class="op" id="2322660">,</span>&nbsp;<span class="ident" id="2322662">count</span><span class="op" id="2322667">)</span><br>
<span class="lineno"></span><span class="op" id="2322669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2322672">var</span>&nbsp;<span class="ident" id="2322676">ioSync</span>&nbsp;<span class="ident" id="2322683">int64</span>
</div>
</body>
</html>
