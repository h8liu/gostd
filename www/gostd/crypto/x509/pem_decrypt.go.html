<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html" class="current">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4041419">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4041474">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4041528">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4041579">package</span>&nbsp;<span class="ident" id="4041587">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4041593">//&nbsp;RFC&nbsp;1423&nbsp;describes&nbsp;the&nbsp;encryption&nbsp;of&nbsp;PEM&nbsp;blocks.&nbsp;The&nbsp;algorithm&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4041667">//&nbsp;generate&nbsp;a&nbsp;key&nbsp;from&nbsp;the&nbsp;password&nbsp;was&nbsp;derived&nbsp;by&nbsp;looking&nbsp;at&nbsp;the&nbsp;OpenSSL</span><br>
<span class="lineno"></span><span class="comment" id="4041741">//&nbsp;implementation.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4041761">import</span>&nbsp;<span class="op" id="4041768">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4041771">&#34;crypto/aes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4041785">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4041802">&#34;crypto/des&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4041816">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4041830">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4041846">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4041862">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4041872">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4041878">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4041888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4041891">type</span>&nbsp;<span class="ident" id="4041896">PEMCipher</span>&nbsp;<span class="builtintype" id="4041906">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4041911">//&nbsp;Possible&nbsp;values&nbsp;for&nbsp;the&nbsp;EncryptPEMBlock&nbsp;encryption&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="4041976">const</span>&nbsp;<span class="op" id="4041982">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041985">_</span>&nbsp;<span class="ident" id="4041987">PEMCipher</span>&nbsp;<span class="op" id="4041997">=</span>&nbsp;<span class="ident" id="4041999">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042005">PEMCipherDES</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042019">PEMCipher3DES</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042034">PEMCipherAES128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042051">PEMCipherAES192</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042068">PEMCipherAES256</span><br>
<span class="lineno"></span><span class="op" id="4042084">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4042087">//&nbsp;rfc1423Algo&nbsp;holds&nbsp;a&nbsp;method&nbsp;for&nbsp;enciphering&nbsp;a&nbsp;PEM&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="4042146">type</span>&nbsp;<span class="ident" id="4042151">rfc1423Algo</span>&nbsp;<span class="keyword" id="4042163">struct</span>&nbsp;<span class="op" id="4042170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042173">cipher</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042184">PEMCipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042195">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4042206">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042214">cipherFunc</span>&nbsp;<span class="keyword" id="4042225">func</span><span class="op" id="4042229">(</span><span class="ident" id="4042230">key</span>&nbsp;<span class="op" id="4042234">[</span><span class="op" id="4042235">]</span><span class="builtintype" id="4042236">byte</span><span class="op" id="4042240">)</span>&nbsp;<span class="op" id="4042242">(</span><span class="ident" id="4042243">cipher</span><span class="op" id="4042249">.</span><span class="ident" id="4042250">Block</span><span class="op" id="4042255">,</span>&nbsp;<span class="builtintype" id="4042257">error</span><span class="op" id="4042262">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042265">keySize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4042276">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042281">blockSize</span>&nbsp;&nbsp;<span class="builtintype" id="4042292">int</span><br>
<span class="lineno"></span><span class="op" id="4042296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4042299">//&nbsp;rfc1423Algos&nbsp;holds&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;possible&nbsp;ways&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;PEM</span><br>
<span class="lineno">45</span><span class="comment" id="4042367">//&nbsp;block.&nbsp;&nbsp;The&nbsp;ivSize&nbsp;numbers&nbsp;were&nbsp;taken&nbsp;from&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4042433">var</span>&nbsp;<span class="ident" id="4042437">rfc1423Algos</span>&nbsp;<span class="op" id="4042450">=</span>&nbsp;<span class="op" id="4042452">[</span><span class="op" id="4042453">]</span><span class="ident" id="4042454">rfc1423Algo</span><span class="op" id="4042465">{</span><span class="op" id="4042466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042469">cipher</span><span class="op" id="4042475">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042481">PEMCipherDES</span><span class="op" id="4042493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042496">name</span><span class="op" id="4042500">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042508">&#34;DES-CBC&#34;</span><span class="op" id="4042517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042520">cipherFunc</span><span class="op" id="4042530">:</span>&nbsp;<span class="ident" id="4042532">des</span><span class="op" id="4042535">.</span><span class="ident" id="4042536">NewCipher</span><span class="op" id="4042545">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042548">keySize</span><span class="op" id="4042555">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4042560">8</span><span class="op" id="4042561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042564">blockSize</span><span class="op" id="4042573">:</span>&nbsp;&nbsp;<span class="ident" id="4042576">des</span><span class="op" id="4042579">.</span><span class="ident" id="4042580">BlockSize</span><span class="op" id="4042589">,</span><br>
<span class="lineno"></span><span class="op" id="4042591">}</span><span class="op" id="4042592">,</span>&nbsp;<span class="op" id="4042594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042597">cipher</span><span class="op" id="4042603">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042609">PEMCipher3DES</span><span class="op" id="4042622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042625">name</span><span class="op" id="4042629">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042637">&#34;DES-EDE3-CBC&#34;</span><span class="op" id="4042651">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042654">cipherFunc</span><span class="op" id="4042664">:</span>&nbsp;<span class="ident" id="4042666">des</span><span class="op" id="4042669">.</span><span class="ident" id="4042670">NewTripleDESCipher</span><span class="op" id="4042688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042691">keySize</span><span class="op" id="4042698">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4042703">24</span><span class="op" id="4042705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042708">blockSize</span><span class="op" id="4042717">:</span>&nbsp;&nbsp;<span class="ident" id="4042720">des</span><span class="op" id="4042723">.</span><span class="ident" id="4042724">BlockSize</span><span class="op" id="4042733">,</span><br>
<span class="lineno"></span><span class="op" id="4042735">}</span><span class="op" id="4042736">,</span>&nbsp;<span class="op" id="4042738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042741">cipher</span><span class="op" id="4042747">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042753">PEMCipherAES128</span><span class="op" id="4042768">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042771">name</span><span class="op" id="4042775">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042783">&#34;AES-128-CBC&#34;</span><span class="op" id="4042796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042799">cipherFunc</span><span class="op" id="4042809">:</span>&nbsp;<span class="ident" id="4042811">aes</span><span class="op" id="4042814">.</span><span class="ident" id="4042815">NewCipher</span><span class="op" id="4042824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042827">keySize</span><span class="op" id="4042834">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4042839">16</span><span class="op" id="4042841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042844">blockSize</span><span class="op" id="4042853">:</span>&nbsp;&nbsp;<span class="ident" id="4042856">aes</span><span class="op" id="4042859">.</span><span class="ident" id="4042860">BlockSize</span><span class="op" id="4042869">,</span><br>
<span class="lineno"></span><span class="op" id="4042871">}</span><span class="op" id="4042872">,</span>&nbsp;<span class="op" id="4042874">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042877">cipher</span><span class="op" id="4042883">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042889">PEMCipherAES192</span><span class="op" id="4042904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042907">name</span><span class="op" id="4042911">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042919">&#34;AES-192-CBC&#34;</span><span class="op" id="4042932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042935">cipherFunc</span><span class="op" id="4042945">:</span>&nbsp;<span class="ident" id="4042947">aes</span><span class="op" id="4042950">.</span><span class="ident" id="4042951">NewCipher</span><span class="op" id="4042960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042963">keySize</span><span class="op" id="4042970">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4042975">24</span><span class="op" id="4042977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042980">blockSize</span><span class="op" id="4042989">:</span>&nbsp;&nbsp;<span class="ident" id="4042992">aes</span><span class="op" id="4042995">.</span><span class="ident" id="4042996">BlockSize</span><span class="op" id="4043005">,</span><br>
<span class="lineno">70</span><span class="op" id="4043007">}</span><span class="op" id="4043008">,</span>&nbsp;<span class="op" id="4043010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043013">cipher</span><span class="op" id="4043019">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043025">PEMCipherAES256</span><span class="op" id="4043040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043043">name</span><span class="op" id="4043047">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4043055">&#34;AES-256-CBC&#34;</span><span class="op" id="4043068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043071">cipherFunc</span><span class="op" id="4043081">:</span>&nbsp;<span class="ident" id="4043083">aes</span><span class="op" id="4043086">.</span><span class="ident" id="4043087">NewCipher</span><span class="op" id="4043096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043099">keySize</span><span class="op" id="4043106">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4043111">32</span><span class="op" id="4043113">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043116">blockSize</span><span class="op" id="4043125">:</span>&nbsp;&nbsp;<span class="ident" id="4043128">aes</span><span class="op" id="4043131">.</span><span class="ident" id="4043132">BlockSize</span><span class="op" id="4043141">,</span><br>
<span class="lineno"></span><span class="op" id="4043143">}</span><span class="op" id="4043144">,</span><br>
<span class="lineno"></span><span class="op" id="4043146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4043149">//&nbsp;deriveKey&nbsp;uses&nbsp;a&nbsp;key&nbsp;derivation&nbsp;function&nbsp;to&nbsp;stretch&nbsp;the&nbsp;password&nbsp;into&nbsp;a&nbsp;key</span><br>
<span class="lineno">80</span><span class="comment" id="4043228">//&nbsp;with&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;our&nbsp;cipher&nbsp;requires.&nbsp;This&nbsp;algorithm&nbsp;was&nbsp;derived&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4043308">//&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4043331">func</span>&nbsp;<span class="op" id="4043336">(</span><span class="ident" id="4043337">c</span>&nbsp;<span class="ident" id="4043339">rfc1423Algo</span><span class="op" id="4043350">)</span>&nbsp;<span class="ident" id="4043352">deriveKey</span><span class="op" id="4043361">(</span><span class="ident" id="4043362">password</span><span class="op" id="4043370">,</span>&nbsp;<span class="ident" id="4043372">salt</span>&nbsp;<span class="op" id="4043377">[</span><span class="op" id="4043378">]</span><span class="builtintype" id="4043379">byte</span><span class="op" id="4043383">)</span>&nbsp;<span class="op" id="4043385">[</span><span class="op" id="4043386">]</span><span class="builtintype" id="4043387">byte</span>&nbsp;<span class="op" id="4043392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043395">hash</span>&nbsp;<span class="op" id="4043400">:=</span>&nbsp;<span class="ident" id="4043403">md5</span><span class="op" id="4043406">.</span><span class="ident" id="4043407">New</span><span class="op" id="4043410">(</span><span class="op" id="4043411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043414">out</span>&nbsp;<span class="op" id="4043418">:=</span>&nbsp;<span class="builtinfunc" id="4043421">make</span><span class="op" id="4043425">(</span><span class="op" id="4043426">[</span><span class="op" id="4043427">]</span><span class="builtintype" id="4043428">byte</span><span class="op" id="4043432">,</span>&nbsp;<span class="ident" id="4043434">c</span><span class="op" id="4043435">.</span><span class="ident" id="4043436">keySize</span><span class="op" id="4043443">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043446">var</span>&nbsp;<span class="ident" id="4043450">digest</span>&nbsp;<span class="op" id="4043457">[</span><span class="op" id="4043458">]</span><span class="builtintype" id="4043459">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043466">for</span>&nbsp;<span class="ident" id="4043470">i</span>&nbsp;<span class="op" id="4043472">:=</span>&nbsp;<span class="num" id="4043475">0</span><span class="op" id="4043476">;</span>&nbsp;<span class="ident" id="4043478">i</span>&nbsp;<span class="op" id="4043480">&lt;</span>&nbsp;<span class="builtinfunc" id="4043482">len</span><span class="op" id="4043485">(</span><span class="ident" id="4043486">out</span><span class="op" id="4043489">)</span><span class="op" id="4043490">;</span>&nbsp;<span class="ident" id="4043492">i</span>&nbsp;<span class="op" id="4043494">+=</span>&nbsp;<span class="builtinfunc" id="4043497">len</span><span class="op" id="4043500">(</span><span class="ident" id="4043501">digest</span><span class="op" id="4043507">)</span>&nbsp;<span class="op" id="4043509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043513">hash</span><span class="op" id="4043517">.</span><span class="ident" id="4043518">Reset</span><span class="op" id="4043523">(</span><span class="op" id="4043524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043528">hash</span><span class="op" id="4043532">.</span><span class="ident" id="4043533">Write</span><span class="op" id="4043538">(</span><span class="ident" id="4043539">digest</span><span class="op" id="4043545">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043549">hash</span><span class="op" id="4043553">.</span><span class="ident" id="4043554">Write</span><span class="op" id="4043559">(</span><span class="ident" id="4043560">password</span><span class="op" id="4043568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043572">hash</span><span class="op" id="4043576">.</span><span class="ident" id="4043577">Write</span><span class="op" id="4043582">(</span><span class="ident" id="4043583">salt</span><span class="op" id="4043587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043591">digest</span>&nbsp;<span class="op" id="4043598">=</span>&nbsp;<span class="ident" id="4043600">hash</span><span class="op" id="4043604">.</span><span class="ident" id="4043605">Sum</span><span class="op" id="4043608">(</span><span class="ident" id="4043609">digest</span><span class="op" id="4043615">[</span><span class="op" id="4043616">:</span><span class="num" id="4043617">0</span><span class="op" id="4043618">]</span><span class="op" id="4043619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4043623">copy</span><span class="op" id="4043627">(</span><span class="ident" id="4043628">out</span><span class="op" id="4043631">[</span><span class="ident" id="4043632">i</span><span class="op" id="4043633">:</span><span class="op" id="4043634">]</span><span class="op" id="4043635">,</span>&nbsp;<span class="ident" id="4043637">digest</span><span class="op" id="4043643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4043646">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043649">return</span>&nbsp;<span class="ident" id="4043656">out</span><br>
<span class="lineno"></span><span class="op" id="4043660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4043663">//&nbsp;IsEncryptedPEMBlock&nbsp;returns&nbsp;if&nbsp;the&nbsp;PEM&nbsp;block&nbsp;is&nbsp;password&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="4043734">func</span>&nbsp;<span class="ident" id="4043739">IsEncryptedPEMBlock</span><span class="op" id="4043758">(</span><span class="ident" id="4043759">b</span>&nbsp;<span class="op" id="4043761">*</span><span class="ident" id="4043762">pem</span><span class="op" id="4043765">.</span><span class="ident" id="4043766">Block</span><span class="op" id="4043771">)</span>&nbsp;<span class="builtintype" id="4043773">bool</span>&nbsp;<span class="op" id="4043778">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043781">_</span><span class="op" id="4043782">,</span>&nbsp;<span class="ident" id="4043784">ok</span>&nbsp;<span class="op" id="4043787">:=</span>&nbsp;<span class="ident" id="4043790">b</span><span class="op" id="4043791">.</span><span class="ident" id="4043792">Headers</span><span class="op" id="4043799">[</span><span class="string" id="4043800">&#34;DEK-Info&#34;</span><span class="op" id="4043810">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4043813">return</span>&nbsp;<span class="ident" id="4043820">ok</span><br>
<span class="lineno"></span><span class="op" id="4043823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4043826">//&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned&nbsp;when&nbsp;an&nbsp;incorrect&nbsp;password&nbsp;is&nbsp;detected.</span><br>
<span class="lineno">105</span><span class="keyword" id="4043904">var</span>&nbsp;<span class="ident" id="4043908">IncorrectPasswordError</span>&nbsp;<span class="op" id="4043931">=</span>&nbsp;<span class="ident" id="4043933">errors</span><span class="op" id="4043939">.</span><span class="ident" id="4043940">New</span><span class="op" id="4043943">(</span><span class="string" id="4043944">&#34;x509:&nbsp;decryption&nbsp;password&nbsp;incorrect&#34;</span><span class="op" id="4043981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4043984">//&nbsp;DecryptPEMBlock&nbsp;takes&nbsp;a&nbsp;password&nbsp;encrypted&nbsp;PEM&nbsp;block&nbsp;and&nbsp;the&nbsp;password&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4044065">//&nbsp;encrypt&nbsp;it&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;decrypted&nbsp;DER&nbsp;encoded&nbsp;bytes.&nbsp;It&nbsp;inspects</span><br>
<span class="lineno"></span><span class="comment" id="4044143">//&nbsp;the&nbsp;DEK-Info&nbsp;header&nbsp;to&nbsp;determine&nbsp;the&nbsp;algorithm&nbsp;used&nbsp;for&nbsp;decryption.&nbsp;If&nbsp;no</span><br>
<span class="lineno">110</span><span class="comment" id="4044220">//&nbsp;DEK-Info&nbsp;header&nbsp;is&nbsp;present,&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;If&nbsp;an&nbsp;incorrect&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="4044298">//&nbsp;is&nbsp;detected&nbsp;an&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="4044352">func</span>&nbsp;<span class="ident" id="4044357">DecryptPEMBlock</span><span class="op" id="4044372">(</span><span class="ident" id="4044373">b</span>&nbsp;<span class="op" id="4044375">*</span><span class="ident" id="4044376">pem</span><span class="op" id="4044379">.</span><span class="ident" id="4044380">Block</span><span class="op" id="4044385">,</span>&nbsp;<span class="ident" id="4044387">password</span>&nbsp;<span class="op" id="4044396">[</span><span class="op" id="4044397">]</span><span class="builtintype" id="4044398">byte</span><span class="op" id="4044402">)</span>&nbsp;<span class="op" id="4044404">(</span><span class="op" id="4044405">[</span><span class="op" id="4044406">]</span><span class="builtintype" id="4044407">byte</span><span class="op" id="4044411">,</span>&nbsp;<span class="builtintype" id="4044413">error</span><span class="op" id="4044418">)</span>&nbsp;<span class="op" id="4044420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044423">dek</span><span class="op" id="4044426">,</span>&nbsp;<span class="ident" id="4044428">ok</span>&nbsp;<span class="op" id="4044431">:=</span>&nbsp;<span class="ident" id="4044434">b</span><span class="op" id="4044435">.</span><span class="ident" id="4044436">Headers</span><span class="op" id="4044443">[</span><span class="string" id="4044444">&#34;DEK-Info&#34;</span><span class="op" id="4044454">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044457">if</span>&nbsp;<span class="op" id="4044460">!</span><span class="ident" id="4044461">ok</span>&nbsp;<span class="op" id="4044464">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044468">return</span>&nbsp;<span class="ident" id="4044475">nil</span><span class="op" id="4044478">,</span>&nbsp;<span class="ident" id="4044480">errors</span><span class="op" id="4044486">.</span><span class="ident" id="4044487">New</span><span class="op" id="4044490">(</span><span class="string" id="4044491">&#34;x509:&nbsp;no&nbsp;DEK-Info&nbsp;header&nbsp;in&nbsp;block&#34;</span><span class="op" id="4044526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4044529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044533">idx</span>&nbsp;<span class="op" id="4044537">:=</span>&nbsp;<span class="ident" id="4044540">strings</span><span class="op" id="4044547">.</span><span class="ident" id="4044548">Index</span><span class="op" id="4044553">(</span><span class="ident" id="4044554">dek</span><span class="op" id="4044557">,</span>&nbsp;<span class="string" id="4044559">&#34;,&#34;</span><span class="op" id="4044562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044565">if</span>&nbsp;<span class="ident" id="4044568">idx</span>&nbsp;<span class="op" id="4044572">==</span>&nbsp;<span class="op" id="4044575">-</span><span class="num" id="4044576">1</span>&nbsp;<span class="op" id="4044578">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044582">return</span>&nbsp;<span class="ident" id="4044589">nil</span><span class="op" id="4044592">,</span>&nbsp;<span class="ident" id="4044594">errors</span><span class="op" id="4044600">.</span><span class="ident" id="4044601">New</span><span class="op" id="4044604">(</span><span class="string" id="4044605">&#34;x509:&nbsp;malformed&nbsp;DEK-Info&nbsp;header&#34;</span><span class="op" id="4044638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4044641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044645">mode</span><span class="op" id="4044649">,</span>&nbsp;<span class="ident" id="4044651">hexIV</span>&nbsp;<span class="op" id="4044657">:=</span>&nbsp;<span class="ident" id="4044660">dek</span><span class="op" id="4044663">[</span><span class="op" id="4044664">:</span><span class="ident" id="4044665">idx</span><span class="op" id="4044668">]</span><span class="op" id="4044669">,</span>&nbsp;<span class="ident" id="4044671">dek</span><span class="op" id="4044674">[</span><span class="ident" id="4044675">idx</span><span class="op" id="4044678">+</span><span class="num" id="4044679">1</span><span class="op" id="4044680">:</span><span class="op" id="4044681">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044684">ciph</span>&nbsp;<span class="op" id="4044689">:=</span>&nbsp;<span class="ident" id="4044692">cipherByName</span><span class="op" id="4044704">(</span><span class="ident" id="4044705">mode</span><span class="op" id="4044709">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044712">if</span>&nbsp;<span class="ident" id="4044715">ciph</span>&nbsp;<span class="op" id="4044720">==</span>&nbsp;<span class="ident" id="4044723">nil</span>&nbsp;<span class="op" id="4044727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044731">return</span>&nbsp;<span class="ident" id="4044738">nil</span><span class="op" id="4044741">,</span>&nbsp;<span class="ident" id="4044743">errors</span><span class="op" id="4044749">.</span><span class="ident" id="4044750">New</span><span class="op" id="4044753">(</span><span class="string" id="4044754">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4044785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4044788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044791">iv</span><span class="op" id="4044793">,</span>&nbsp;<span class="ident" id="4044795">err</span>&nbsp;<span class="op" id="4044799">:=</span>&nbsp;<span class="ident" id="4044802">hex</span><span class="op" id="4044805">.</span><span class="ident" id="4044806">DecodeString</span><span class="op" id="4044818">(</span><span class="ident" id="4044819">hexIV</span><span class="op" id="4044824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044827">if</span>&nbsp;<span class="ident" id="4044830">err</span>&nbsp;<span class="op" id="4044834">!=</span>&nbsp;<span class="ident" id="4044837">nil</span>&nbsp;<span class="op" id="4044841">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044845">return</span>&nbsp;<span class="ident" id="4044852">nil</span><span class="op" id="4044855">,</span>&nbsp;<span class="ident" id="4044857">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4044862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044865">if</span>&nbsp;<span class="builtinfunc" id="4044868">len</span><span class="op" id="4044871">(</span><span class="ident" id="4044872">iv</span><span class="op" id="4044874">)</span>&nbsp;<span class="op" id="4044876">!=</span>&nbsp;<span class="ident" id="4044879">ciph</span><span class="op" id="4044883">.</span><span class="ident" id="4044884">blockSize</span>&nbsp;<span class="op" id="4044894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4044898">return</span>&nbsp;<span class="ident" id="4044905">nil</span><span class="op" id="4044908">,</span>&nbsp;<span class="ident" id="4044910">errors</span><span class="op" id="4044916">.</span><span class="ident" id="4044917">New</span><span class="op" id="4044920">(</span><span class="string" id="4044921">&#34;x509:&nbsp;incorrect&nbsp;IV&nbsp;size&#34;</span><span class="op" id="4044946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4044949">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044953">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;OpenSSL&nbsp;implementation.&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045024">//&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045058">key</span>&nbsp;<span class="op" id="4045062">:=</span>&nbsp;<span class="ident" id="4045065">ciph</span><span class="op" id="4045069">.</span><span class="ident" id="4045070">deriveKey</span><span class="op" id="4045079">(</span><span class="ident" id="4045080">password</span><span class="op" id="4045088">,</span>&nbsp;<span class="ident" id="4045090">iv</span><span class="op" id="4045092">[</span><span class="op" id="4045093">:</span><span class="num" id="4045094">8</span><span class="op" id="4045095">]</span><span class="op" id="4045096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045099">block</span><span class="op" id="4045104">,</span>&nbsp;<span class="ident" id="4045106">err</span>&nbsp;<span class="op" id="4045110">:=</span>&nbsp;<span class="ident" id="4045113">ciph</span><span class="op" id="4045117">.</span><span class="ident" id="4045118">cipherFunc</span><span class="op" id="4045128">(</span><span class="ident" id="4045129">key</span><span class="op" id="4045132">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045135">if</span>&nbsp;<span class="ident" id="4045138">err</span>&nbsp;<span class="op" id="4045142">!=</span>&nbsp;<span class="ident" id="4045145">nil</span>&nbsp;<span class="op" id="4045149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045153">return</span>&nbsp;<span class="ident" id="4045160">nil</span><span class="op" id="4045163">,</span>&nbsp;<span class="ident" id="4045165">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4045170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045174">data</span>&nbsp;<span class="op" id="4045179">:=</span>&nbsp;<span class="builtinfunc" id="4045182">make</span><span class="op" id="4045186">(</span><span class="op" id="4045187">[</span><span class="op" id="4045188">]</span><span class="builtintype" id="4045189">byte</span><span class="op" id="4045193">,</span>&nbsp;<span class="builtinfunc" id="4045195">len</span><span class="op" id="4045198">(</span><span class="ident" id="4045199">b</span><span class="op" id="4045200">.</span><span class="ident" id="4045201">Bytes</span><span class="op" id="4045206">)</span><span class="op" id="4045207">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045210">dec</span>&nbsp;<span class="op" id="4045214">:=</span>&nbsp;<span class="ident" id="4045217">cipher</span><span class="op" id="4045223">.</span><span class="ident" id="4045224">NewCBCDecrypter</span><span class="op" id="4045239">(</span><span class="ident" id="4045240">block</span><span class="op" id="4045245">,</span>&nbsp;<span class="ident" id="4045247">iv</span><span class="op" id="4045249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045252">dec</span><span class="op" id="4045255">.</span><span class="ident" id="4045256">CryptBlocks</span><span class="op" id="4045267">(</span><span class="ident" id="4045268">data</span><span class="op" id="4045272">,</span>&nbsp;<span class="ident" id="4045274">b</span><span class="op" id="4045275">.</span><span class="ident" id="4045276">Bytes</span><span class="op" id="4045281">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045285">//&nbsp;Blocks&nbsp;are&nbsp;padded&nbsp;using&nbsp;a&nbsp;scheme&nbsp;where&nbsp;the&nbsp;last&nbsp;n&nbsp;bytes&nbsp;of&nbsp;padding&nbsp;are&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045364">//&nbsp;equal&nbsp;to&nbsp;n.&nbsp;It&nbsp;can&nbsp;pad&nbsp;from&nbsp;1&nbsp;to&nbsp;blocksize&nbsp;bytes&nbsp;inclusive.&nbsp;See&nbsp;RFC&nbsp;1423.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045442">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045459">//&nbsp;&nbsp;&nbsp;&nbsp;[x&nbsp;y&nbsp;z&nbsp;2&nbsp;2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045475">//&nbsp;&nbsp;&nbsp;&nbsp;[x&nbsp;y&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045499">//&nbsp;If&nbsp;we&nbsp;detect&nbsp;a&nbsp;bad&nbsp;padding,&nbsp;we&nbsp;assume&nbsp;it&nbsp;is&nbsp;an&nbsp;invalid&nbsp;password.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045568">dlen</span>&nbsp;<span class="op" id="4045573">:=</span>&nbsp;<span class="builtinfunc" id="4045576">len</span><span class="op" id="4045579">(</span><span class="ident" id="4045580">data</span><span class="op" id="4045584">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045587">if</span>&nbsp;<span class="ident" id="4045590">dlen</span>&nbsp;<span class="op" id="4045595">==</span>&nbsp;<span class="num" id="4045598">0</span>&nbsp;<span class="op" id="4045600">||</span>&nbsp;<span class="ident" id="4045603">dlen</span><span class="op" id="4045607">%</span><span class="ident" id="4045608">ciph</span><span class="op" id="4045612">.</span><span class="ident" id="4045613">blockSize</span>&nbsp;<span class="op" id="4045623">!=</span>&nbsp;<span class="num" id="4045626">0</span>&nbsp;<span class="op" id="4045628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045632">return</span>&nbsp;<span class="ident" id="4045639">nil</span><span class="op" id="4045642">,</span>&nbsp;<span class="ident" id="4045644">errors</span><span class="op" id="4045650">.</span><span class="ident" id="4045651">New</span><span class="op" id="4045654">(</span><span class="string" id="4045655">&#34;x509:&nbsp;invalid&nbsp;padding&#34;</span><span class="op" id="4045678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4045681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045684">last</span>&nbsp;<span class="op" id="4045689">:=</span>&nbsp;<span class="builtintype" id="4045692">int</span><span class="op" id="4045695">(</span><span class="ident" id="4045696">data</span><span class="op" id="4045700">[</span><span class="ident" id="4045701">dlen</span><span class="op" id="4045705">-</span><span class="num" id="4045706">1</span><span class="op" id="4045707">]</span><span class="op" id="4045708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045711">if</span>&nbsp;<span class="ident" id="4045714">dlen</span>&nbsp;<span class="op" id="4045719">&lt;</span>&nbsp;<span class="ident" id="4045721">last</span>&nbsp;<span class="op" id="4045726">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045730">return</span>&nbsp;<span class="ident" id="4045737">nil</span><span class="op" id="4045740">,</span>&nbsp;<span class="ident" id="4045742">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4045766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045769">if</span>&nbsp;<span class="ident" id="4045772">last</span>&nbsp;<span class="op" id="4045777">==</span>&nbsp;<span class="num" id="4045780">0</span>&nbsp;<span class="op" id="4045782">||</span>&nbsp;<span class="ident" id="4045785">last</span>&nbsp;<span class="op" id="4045790">&gt;</span>&nbsp;<span class="ident" id="4045792">ciph</span><span class="op" id="4045796">.</span><span class="ident" id="4045797">blockSize</span>&nbsp;<span class="op" id="4045807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045811">return</span>&nbsp;<span class="ident" id="4045818">nil</span><span class="op" id="4045821">,</span>&nbsp;<span class="ident" id="4045823">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4045847">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045850">for</span>&nbsp;<span class="ident" id="4045854">_</span><span class="op" id="4045855">,</span>&nbsp;<span class="ident" id="4045857">val</span>&nbsp;<span class="op" id="4045861">:=</span>&nbsp;<span class="keyword" id="4045864">range</span>&nbsp;<span class="ident" id="4045870">data</span><span class="op" id="4045874">[</span><span class="ident" id="4045875">dlen</span><span class="op" id="4045879">-</span><span class="ident" id="4045880">last</span><span class="op" id="4045884">:</span><span class="op" id="4045885">]</span>&nbsp;<span class="op" id="4045887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045891">if</span>&nbsp;<span class="builtintype" id="4045894">int</span><span class="op" id="4045897">(</span><span class="ident" id="4045898">val</span><span class="op" id="4045901">)</span>&nbsp;<span class="op" id="4045903">!=</span>&nbsp;<span class="ident" id="4045906">last</span>&nbsp;<span class="op" id="4045911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045916">return</span>&nbsp;<span class="ident" id="4045923">nil</span><span class="op" id="4045926">,</span>&nbsp;<span class="ident" id="4045928">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4045953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4045956">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045959">return</span>&nbsp;<span class="ident" id="4045966">data</span><span class="op" id="4045970">[</span><span class="op" id="4045971">:</span><span class="ident" id="4045972">dlen</span><span class="op" id="4045976">-</span><span class="ident" id="4045977">last</span><span class="op" id="4045981">]</span><span class="op" id="4045982">,</span>&nbsp;<span class="ident" id="4045984">nil</span><br>
<span class="lineno"></span><span class="op" id="4045988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4045991">//&nbsp;EncryptPEMBlock&nbsp;returns&nbsp;a&nbsp;PEM&nbsp;block&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;holding&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4046064">//&nbsp;given&nbsp;DER-encoded&nbsp;data&nbsp;encrypted&nbsp;with&nbsp;the&nbsp;specified&nbsp;algorithm&nbsp;and</span><br>
<span class="lineno">175</span><span class="comment" id="4046133">//&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="4046146">func</span>&nbsp;<span class="ident" id="4046151">EncryptPEMBlock</span><span class="op" id="4046166">(</span><span class="ident" id="4046167">rand</span>&nbsp;<span class="ident" id="4046172">io</span><span class="op" id="4046174">.</span><span class="ident" id="4046175">Reader</span><span class="op" id="4046181">,</span>&nbsp;<span class="ident" id="4046183">blockType</span>&nbsp;<span class="builtintype" id="4046193">string</span><span class="op" id="4046199">,</span>&nbsp;<span class="ident" id="4046201">data</span><span class="op" id="4046205">,</span>&nbsp;<span class="ident" id="4046207">password</span>&nbsp;<span class="op" id="4046216">[</span><span class="op" id="4046217">]</span><span class="builtintype" id="4046218">byte</span><span class="op" id="4046222">,</span>&nbsp;<span class="ident" id="4046224">alg</span>&nbsp;<span class="ident" id="4046228">PEMCipher</span><span class="op" id="4046237">)</span>&nbsp;<span class="op" id="4046239">(</span><span class="op" id="4046240">*</span><span class="ident" id="4046241">pem</span><span class="op" id="4046244">.</span><span class="ident" id="4046245">Block</span><span class="op" id="4046250">,</span>&nbsp;<span class="builtintype" id="4046252">error</span><span class="op" id="4046257">)</span>&nbsp;<span class="op" id="4046259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046262">ciph</span>&nbsp;<span class="op" id="4046267">:=</span>&nbsp;<span class="ident" id="4046270">cipherByKey</span><span class="op" id="4046281">(</span><span class="ident" id="4046282">alg</span><span class="op" id="4046285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046288">if</span>&nbsp;<span class="ident" id="4046291">ciph</span>&nbsp;<span class="op" id="4046296">==</span>&nbsp;<span class="ident" id="4046299">nil</span>&nbsp;<span class="op" id="4046303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046307">return</span>&nbsp;<span class="ident" id="4046314">nil</span><span class="op" id="4046317">,</span>&nbsp;<span class="ident" id="4046319">errors</span><span class="op" id="4046325">.</span><span class="ident" id="4046326">New</span><span class="op" id="4046329">(</span><span class="string" id="4046330">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4046361">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046367">iv</span>&nbsp;<span class="op" id="4046370">:=</span>&nbsp;<span class="builtinfunc" id="4046373">make</span><span class="op" id="4046377">(</span><span class="op" id="4046378">[</span><span class="op" id="4046379">]</span><span class="builtintype" id="4046380">byte</span><span class="op" id="4046384">,</span>&nbsp;<span class="ident" id="4046386">ciph</span><span class="op" id="4046390">.</span><span class="ident" id="4046391">blockSize</span><span class="op" id="4046400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046403">if</span>&nbsp;<span class="ident" id="4046406">_</span><span class="op" id="4046407">,</span>&nbsp;<span class="ident" id="4046409">err</span>&nbsp;<span class="op" id="4046413">:=</span>&nbsp;<span class="ident" id="4046416">io</span><span class="op" id="4046418">.</span><span class="ident" id="4046419">ReadFull</span><span class="op" id="4046427">(</span><span class="ident" id="4046428">rand</span><span class="op" id="4046432">,</span>&nbsp;<span class="ident" id="4046434">iv</span><span class="op" id="4046436">)</span><span class="op" id="4046437">;</span>&nbsp;<span class="ident" id="4046439">err</span>&nbsp;<span class="op" id="4046443">!=</span>&nbsp;<span class="ident" id="4046446">nil</span>&nbsp;<span class="op" id="4046450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046454">return</span>&nbsp;<span class="ident" id="4046461">nil</span><span class="op" id="4046464">,</span>&nbsp;<span class="ident" id="4046466">errors</span><span class="op" id="4046472">.</span><span class="ident" id="4046473">New</span><span class="op" id="4046476">(</span><span class="string" id="4046477">&#34;x509:&nbsp;cannot&nbsp;generate&nbsp;IV:&nbsp;&#34;</span>&nbsp;<span class="op" id="4046506">+</span>&nbsp;<span class="ident" id="4046508">err</span><span class="op" id="4046511">.</span><span class="ident" id="4046512">Error</span><span class="op" id="4046517">(</span><span class="op" id="4046518">)</span><span class="op" id="4046519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046522">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4046525">//&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4046589">//&nbsp;matching&nbsp;the&nbsp;key&nbsp;derivation&nbsp;in&nbsp;DecryptPEMBlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046641">key</span>&nbsp;<span class="op" id="4046645">:=</span>&nbsp;<span class="ident" id="4046648">ciph</span><span class="op" id="4046652">.</span><span class="ident" id="4046653">deriveKey</span><span class="op" id="4046662">(</span><span class="ident" id="4046663">password</span><span class="op" id="4046671">,</span>&nbsp;<span class="ident" id="4046673">iv</span><span class="op" id="4046675">[</span><span class="op" id="4046676">:</span><span class="num" id="4046677">8</span><span class="op" id="4046678">]</span><span class="op" id="4046679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046682">block</span><span class="op" id="4046687">,</span>&nbsp;<span class="ident" id="4046689">err</span>&nbsp;<span class="op" id="4046693">:=</span>&nbsp;<span class="ident" id="4046696">ciph</span><span class="op" id="4046700">.</span><span class="ident" id="4046701">cipherFunc</span><span class="op" id="4046711">(</span><span class="ident" id="4046712">key</span><span class="op" id="4046715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046718">if</span>&nbsp;<span class="ident" id="4046721">err</span>&nbsp;<span class="op" id="4046725">!=</span>&nbsp;<span class="ident" id="4046728">nil</span>&nbsp;<span class="op" id="4046732">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046736">return</span>&nbsp;<span class="ident" id="4046743">nil</span><span class="op" id="4046746">,</span>&nbsp;<span class="ident" id="4046748">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046756">enc</span>&nbsp;<span class="op" id="4046760">:=</span>&nbsp;<span class="ident" id="4046763">cipher</span><span class="op" id="4046769">.</span><span class="ident" id="4046770">NewCBCEncrypter</span><span class="op" id="4046785">(</span><span class="ident" id="4046786">block</span><span class="op" id="4046791">,</span>&nbsp;<span class="ident" id="4046793">iv</span><span class="op" id="4046795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046798">pad</span>&nbsp;<span class="op" id="4046802">:=</span>&nbsp;<span class="ident" id="4046805">ciph</span><span class="op" id="4046809">.</span><span class="ident" id="4046810">blockSize</span>&nbsp;<span class="op" id="4046820">-</span>&nbsp;<span class="builtinfunc" id="4046822">len</span><span class="op" id="4046825">(</span><span class="ident" id="4046826">data</span><span class="op" id="4046830">)</span><span class="op" id="4046831">%</span><span class="ident" id="4046832">ciph</span><span class="op" id="4046836">.</span><span class="ident" id="4046837">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046848">encrypted</span>&nbsp;<span class="op" id="4046858">:=</span>&nbsp;<span class="builtinfunc" id="4046861">make</span><span class="op" id="4046865">(</span><span class="op" id="4046866">[</span><span class="op" id="4046867">]</span><span class="builtintype" id="4046868">byte</span><span class="op" id="4046872">,</span>&nbsp;<span class="builtinfunc" id="4046874">len</span><span class="op" id="4046877">(</span><span class="ident" id="4046878">data</span><span class="op" id="4046882">)</span><span class="op" id="4046883">,</span>&nbsp;<span class="builtinfunc" id="4046885">len</span><span class="op" id="4046888">(</span><span class="ident" id="4046889">data</span><span class="op" id="4046893">)</span><span class="op" id="4046894">+</span><span class="ident" id="4046895">pad</span><span class="op" id="4046898">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4046901">//&nbsp;We&nbsp;could&nbsp;save&nbsp;this&nbsp;copy&nbsp;by&nbsp;encrypting&nbsp;all&nbsp;the&nbsp;whole&nbsp;blocks&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4046967">//&nbsp;the&nbsp;data&nbsp;separately,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;seem&nbsp;worth&nbsp;the&nbsp;additional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4047033">//&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4047043">copy</span><span class="op" id="4047047">(</span><span class="ident" id="4047048">encrypted</span><span class="op" id="4047057">,</span>&nbsp;<span class="ident" id="4047059">data</span><span class="op" id="4047063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4047066">//&nbsp;See&nbsp;RFC&nbsp;1423,&nbsp;section&nbsp;1.1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047096">for</span>&nbsp;<span class="ident" id="4047100">i</span>&nbsp;<span class="op" id="4047102">:=</span>&nbsp;<span class="num" id="4047105">0</span><span class="op" id="4047106">;</span>&nbsp;<span class="ident" id="4047108">i</span>&nbsp;<span class="op" id="4047110">&lt;</span>&nbsp;<span class="ident" id="4047112">pad</span><span class="op" id="4047115">;</span>&nbsp;<span class="ident" id="4047117">i</span><span class="op" id="4047118">++</span>&nbsp;<span class="op" id="4047121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4047125">encrypted</span>&nbsp;<span class="op" id="4047135">=</span>&nbsp;<span class="builtinfunc" id="4047137">append</span><span class="op" id="4047143">(</span><span class="ident" id="4047144">encrypted</span><span class="op" id="4047153">,</span>&nbsp;<span class="builtintype" id="4047155">byte</span><span class="op" id="4047159">(</span><span class="ident" id="4047160">pad</span><span class="op" id="4047163">)</span><span class="op" id="4047164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4047167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4047170">enc</span><span class="op" id="4047173">.</span><span class="ident" id="4047174">CryptBlocks</span><span class="op" id="4047185">(</span><span class="ident" id="4047186">encrypted</span><span class="op" id="4047195">,</span>&nbsp;<span class="ident" id="4047197">encrypted</span><span class="op" id="4047206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047210">return</span>&nbsp;<span class="op" id="4047217">&amp;</span><span class="ident" id="4047218">pem</span><span class="op" id="4047221">.</span><span class="ident" id="4047222">Block</span><span class="op" id="4047227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4047231">Type</span><span class="op" id="4047235">:</span>&nbsp;<span class="ident" id="4047237">blockType</span><span class="op" id="4047246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4047250">Headers</span><span class="op" id="4047257">:</span>&nbsp;<span class="keyword" id="4047259">map</span><span class="op" id="4047262">[</span><span class="builtintype" id="4047263">string</span><span class="op" id="4047269">]</span><span class="builtintype" id="4047270">string</span><span class="op" id="4047276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4047281">&#34;Proc-Type&#34;</span><span class="op" id="4047292">:</span>&nbsp;<span class="string" id="4047294">&#34;4,ENCRYPTED&#34;</span><span class="op" id="4047307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4047312">&#34;DEK-Info&#34;</span><span class="op" id="4047322">:</span>&nbsp;&nbsp;<span class="ident" id="4047325">ciph</span><span class="op" id="4047329">.</span><span class="ident" id="4047330">name</span>&nbsp;<span class="op" id="4047335">+</span>&nbsp;<span class="string" id="4047337">&#34;,&#34;</span>&nbsp;<span class="op" id="4047341">+</span>&nbsp;<span class="ident" id="4047343">hex</span><span class="op" id="4047346">.</span><span class="ident" id="4047347">EncodeToString</span><span class="op" id="4047361">(</span><span class="ident" id="4047362">iv</span><span class="op" id="4047364">)</span><span class="op" id="4047365">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4047369">}</span><span class="op" id="4047370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4047374">Bytes</span><span class="op" id="4047379">:</span>&nbsp;<span class="ident" id="4047381">encrypted</span><span class="op" id="4047390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4047393">}</span><span class="op" id="4047394">,</span>&nbsp;<span class="ident" id="4047396">nil</span><br>
<span class="lineno"></span><span class="op" id="4047400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="4047403">func</span>&nbsp;<span class="ident" id="4047408">cipherByName</span><span class="op" id="4047420">(</span><span class="ident" id="4047421">name</span>&nbsp;<span class="builtintype" id="4047426">string</span><span class="op" id="4047432">)</span>&nbsp;<span class="op" id="4047434">*</span><span class="ident" id="4047435">rfc1423Algo</span>&nbsp;<span class="op" id="4047447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047450">for</span>&nbsp;<span class="ident" id="4047454">i</span>&nbsp;<span class="op" id="4047456">:=</span>&nbsp;<span class="keyword" id="4047459">range</span>&nbsp;<span class="ident" id="4047465">rfc1423Algos</span>&nbsp;<span class="op" id="4047478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4047482">alg</span>&nbsp;<span class="op" id="4047486">:=</span>&nbsp;<span class="op" id="4047489">&amp;</span><span class="ident" id="4047490">rfc1423Algos</span><span class="op" id="4047502">[</span><span class="ident" id="4047503">i</span><span class="op" id="4047504">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047508">if</span>&nbsp;<span class="ident" id="4047511">alg</span><span class="op" id="4047514">.</span><span class="ident" id="4047515">name</span>&nbsp;<span class="op" id="4047520">==</span>&nbsp;<span class="ident" id="4047523">name</span>&nbsp;<span class="op" id="4047528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047533">return</span>&nbsp;<span class="ident" id="4047540">alg</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4047546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4047549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047552">return</span>&nbsp;<span class="ident" id="4047559">nil</span><br>
<span class="lineno"></span><span class="op" id="4047563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="4047566">func</span>&nbsp;<span class="ident" id="4047571">cipherByKey</span><span class="op" id="4047582">(</span><span class="ident" id="4047583">key</span>&nbsp;<span class="ident" id="4047587">PEMCipher</span><span class="op" id="4047596">)</span>&nbsp;<span class="op" id="4047598">*</span><span class="ident" id="4047599">rfc1423Algo</span>&nbsp;<span class="op" id="4047611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047614">for</span>&nbsp;<span class="ident" id="4047618">i</span>&nbsp;<span class="op" id="4047620">:=</span>&nbsp;<span class="keyword" id="4047623">range</span>&nbsp;<span class="ident" id="4047629">rfc1423Algos</span>&nbsp;<span class="op" id="4047642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4047646">alg</span>&nbsp;<span class="op" id="4047650">:=</span>&nbsp;<span class="op" id="4047653">&amp;</span><span class="ident" id="4047654">rfc1423Algos</span><span class="op" id="4047666">[</span><span class="ident" id="4047667">i</span><span class="op" id="4047668">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047672">if</span>&nbsp;<span class="ident" id="4047675">alg</span><span class="op" id="4047678">.</span><span class="ident" id="4047679">cipher</span>&nbsp;<span class="op" id="4047686">==</span>&nbsp;<span class="ident" id="4047689">key</span>&nbsp;<span class="op" id="4047693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047698">return</span>&nbsp;<span class="ident" id="4047705">alg</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4047711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4047714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047717">return</span>&nbsp;<span class="ident" id="4047724">nil</span><br>
<span class="lineno"></span><span class="op" id="4047728">}</span>
</div>
</body>
</html>
