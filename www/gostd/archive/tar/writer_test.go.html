<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7978701">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7978756">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7978810">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7978861">package</span>&nbsp;<span class="ident" id="7978869">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7978874">import</span>&nbsp;<span class="op" id="7978881">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7978884">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7978893">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7978900">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7978906">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7978919">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7978925">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7978936">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7978947">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7978958">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7978976">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7978983">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7978986">type</span>&nbsp;<span class="ident" id="7978991">writerTestEntry</span>&nbsp;<span class="keyword" id="7979007">struct</span>&nbsp;<span class="op" id="7979014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979017">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7979026">*</span><span class="ident" id="7979027">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979035">contents</span>&nbsp;<span class="builtintype" id="7979044">string</span><br>
<span class="lineno"></span><span class="op" id="7979051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7979054">type</span>&nbsp;<span class="ident" id="7979059">writerTest</span>&nbsp;<span class="keyword" id="7979070">struct</span>&nbsp;<span class="op" id="7979077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979080">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7979088">string</span>&nbsp;<span class="comment" id="7979095">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979127">entries</span>&nbsp;<span class="op" id="7979135">[</span><span class="op" id="7979136">]</span><span class="op" id="7979137">*</span><span class="ident" id="7979138">writerTestEntry</span><br>
<span class="lineno"></span><span class="op" id="7979154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7979157">var</span>&nbsp;<span class="ident" id="7979161">writerTests</span>&nbsp;<span class="op" id="7979173">=</span>&nbsp;<span class="op" id="7979175">[</span><span class="op" id="7979176">]</span><span class="op" id="7979177">*</span><span class="ident" id="7979178">writerTest</span><span class="op" id="7979188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7979191">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7979248">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7979271">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7979302">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979383">file</span><span class="op" id="7979387">:</span>&nbsp;<span class="string" id="7979389">&#34;testdata/writer.tar&#34;</span><span class="op" id="7979410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979414">entries</span><span class="op" id="7979421">:</span>&nbsp;<span class="op" id="7979423">[</span><span class="op" id="7979424">]</span><span class="op" id="7979425">*</span><span class="ident" id="7979426">writerTestEntry</span><span class="op" id="7979441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979452">header</span><span class="op" id="7979458">:</span>&nbsp;<span class="op" id="7979460">&amp;</span><span class="ident" id="7979461">Header</span><span class="op" id="7979467">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979474">Name</span><span class="op" id="7979478">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7979484">&#34;small.txt&#34;</span><span class="op" id="7979495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979502">Mode</span><span class="op" id="7979506">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7979512">0640</span><span class="op" id="7979516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979523">Uid</span><span class="op" id="7979526">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7979533">73025</span><span class="op" id="7979538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979545">Gid</span><span class="op" id="7979548">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7979555">5000</span><span class="op" id="7979559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979566">Size</span><span class="op" id="7979570">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7979576">5</span><span class="op" id="7979577">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979584">ModTime</span><span class="op" id="7979591">:</span>&nbsp;&nbsp;<span class="ident" id="7979594">time</span><span class="op" id="7979598">.</span><span class="ident" id="7979599">Unix</span><span class="op" id="7979603">(</span><span class="num" id="7979604">1246508266</span><span class="op" id="7979614">,</span>&nbsp;<span class="num" id="7979616">0</span><span class="op" id="7979617">)</span><span class="op" id="7979618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979625">Typeflag</span><span class="op" id="7979633">:</span>&nbsp;<span class="string" id="7979635">&#39;0&#39;</span><span class="op" id="7979638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979645">Uname</span><span class="op" id="7979650">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7979655">&#34;dsymonds&#34;</span><span class="op" id="7979665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979672">Gname</span><span class="op" id="7979677">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7979682">&#34;eng&#34;</span><span class="op" id="7979687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979693">}</span><span class="op" id="7979694">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979700">contents</span><span class="op" id="7979708">:</span>&nbsp;<span class="string" id="7979710">&#34;Kilts&#34;</span><span class="op" id="7979717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979722">}</span><span class="op" id="7979723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979734">header</span><span class="op" id="7979740">:</span>&nbsp;<span class="op" id="7979742">&amp;</span><span class="ident" id="7979743">Header</span><span class="op" id="7979749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979756">Name</span><span class="op" id="7979760">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7979766">&#34;small2.txt&#34;</span><span class="op" id="7979778">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979785">Mode</span><span class="op" id="7979789">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7979795">0640</span><span class="op" id="7979799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979806">Uid</span><span class="op" id="7979809">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7979816">73025</span><span class="op" id="7979821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979828">Gid</span><span class="op" id="7979831">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7979838">5000</span><span class="op" id="7979842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979849">Size</span><span class="op" id="7979853">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7979859">11</span><span class="op" id="7979861">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979868">ModTime</span><span class="op" id="7979875">:</span>&nbsp;&nbsp;<span class="ident" id="7979878">time</span><span class="op" id="7979882">.</span><span class="ident" id="7979883">Unix</span><span class="op" id="7979887">(</span><span class="num" id="7979888">1245217492</span><span class="op" id="7979898">,</span>&nbsp;<span class="num" id="7979900">0</span><span class="op" id="7979901">)</span><span class="op" id="7979902">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979909">Typeflag</span><span class="op" id="7979917">:</span>&nbsp;<span class="string" id="7979919">&#39;0&#39;</span><span class="op" id="7979922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979929">Uname</span><span class="op" id="7979934">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7979939">&#34;dsymonds&#34;</span><span class="op" id="7979949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979956">Gname</span><span class="op" id="7979961">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7979966">&#34;eng&#34;</span><span class="op" id="7979971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979977">}</span><span class="op" id="7979978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979984">contents</span><span class="op" id="7979992">:</span>&nbsp;<span class="string" id="7979994">&#34;Google.com\n&#34;</span><span class="op" id="7980008">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980013">}</span><span class="op" id="7980014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980025">header</span><span class="op" id="7980031">:</span>&nbsp;<span class="op" id="7980033">&amp;</span><span class="ident" id="7980034">Header</span><span class="op" id="7980040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980047">Name</span><span class="op" id="7980051">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980057">&#34;link.txt&#34;</span><span class="op" id="7980067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980074">Mode</span><span class="op" id="7980078">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7980084">0777</span><span class="op" id="7980088">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980095">Uid</span><span class="op" id="7980098">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7980105">1000</span><span class="op" id="7980109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980116">Gid</span><span class="op" id="7980119">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7980126">1000</span><span class="op" id="7980130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980137">Size</span><span class="op" id="7980141">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7980147">0</span><span class="op" id="7980148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980155">ModTime</span><span class="op" id="7980162">:</span>&nbsp;&nbsp;<span class="ident" id="7980165">time</span><span class="op" id="7980169">.</span><span class="ident" id="7980170">Unix</span><span class="op" id="7980174">(</span><span class="num" id="7980175">1314603082</span><span class="op" id="7980185">,</span>&nbsp;<span class="num" id="7980187">0</span><span class="op" id="7980188">)</span><span class="op" id="7980189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980196">Typeflag</span><span class="op" id="7980204">:</span>&nbsp;<span class="string" id="7980206">&#39;2&#39;</span><span class="op" id="7980209">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980216">Linkname</span><span class="op" id="7980224">:</span>&nbsp;<span class="string" id="7980226">&#34;small.txt&#34;</span><span class="op" id="7980237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980244">Uname</span><span class="op" id="7980249">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980254">&#34;strings&#34;</span><span class="op" id="7980263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980270">Gname</span><span class="op" id="7980275">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980280">&#34;strings&#34;</span><span class="op" id="7980289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980295">}</span><span class="op" id="7980296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7980302">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980320">}</span><span class="op" id="7980321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980325">}</span><span class="op" id="7980326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980329">}</span><span class="op" id="7980330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7980333">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7980396">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7980458">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980536">file</span><span class="op" id="7980540">:</span>&nbsp;<span class="string" id="7980542">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="7980567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980571">entries</span><span class="op" id="7980578">:</span>&nbsp;<span class="op" id="7980580">[</span><span class="op" id="7980581">]</span><span class="op" id="7980582">*</span><span class="ident" id="7980583">writerTestEntry</span><span class="op" id="7980598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980603">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980609">header</span><span class="op" id="7980615">:</span>&nbsp;<span class="op" id="7980617">&amp;</span><span class="ident" id="7980618">Header</span><span class="op" id="7980624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980631">Name</span><span class="op" id="7980635">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980641">&#34;tmp/16gig.txt&#34;</span><span class="op" id="7980656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980663">Mode</span><span class="op" id="7980667">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7980673">0640</span><span class="op" id="7980677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980684">Uid</span><span class="op" id="7980687">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7980694">73025</span><span class="op" id="7980699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980706">Gid</span><span class="op" id="7980709">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7980716">5000</span><span class="op" id="7980720">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980727">Size</span><span class="op" id="7980731">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7980737">16</span>&nbsp;<span class="op" id="7980740">&lt;&lt;</span>&nbsp;<span class="num" id="7980743">30</span><span class="op" id="7980745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980752">ModTime</span><span class="op" id="7980759">:</span>&nbsp;&nbsp;<span class="ident" id="7980762">time</span><span class="op" id="7980766">.</span><span class="ident" id="7980767">Unix</span><span class="op" id="7980771">(</span><span class="num" id="7980772">1254699560</span><span class="op" id="7980782">,</span>&nbsp;<span class="num" id="7980784">0</span><span class="op" id="7980785">)</span><span class="op" id="7980786">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980793">Typeflag</span><span class="op" id="7980801">:</span>&nbsp;<span class="string" id="7980803">&#39;0&#39;</span><span class="op" id="7980806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980813">Uname</span><span class="op" id="7980818">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980823">&#34;dsymonds&#34;</span><span class="op" id="7980833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980840">Gname</span><span class="op" id="7980845">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7980850">&#34;eng&#34;</span><span class="op" id="7980855">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980861">}</span><span class="op" id="7980862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7980868">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980889">contents</span><span class="op" id="7980897">:</span>&nbsp;<span class="ident" id="7980899">strings</span><span class="op" id="7980906">.</span><span class="ident" id="7980907">Repeat</span><span class="op" id="7980913">(</span><span class="string" id="7980914">&#34;\x00&#34;</span><span class="op" id="7980920">,</span>&nbsp;<span class="num" id="7980922">4</span><span class="op" id="7980923">&lt;&lt;</span><span class="num" id="7980925">10</span><span class="op" id="7980927">)</span><span class="op" id="7980928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980933">}</span><span class="op" id="7980934">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980938">}</span><span class="op" id="7980939">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980942">}</span><span class="op" id="7980943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7980946">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7981009">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7981082">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981172">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981176">file</span><span class="op" id="7981180">:</span>&nbsp;<span class="string" id="7981182">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="7981212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981216">entries</span><span class="op" id="7981223">:</span>&nbsp;<span class="op" id="7981225">[</span><span class="op" id="7981226">]</span><span class="op" id="7981227">*</span><span class="ident" id="7981228">writerTestEntry</span><span class="op" id="7981243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981254">header</span><span class="op" id="7981260">:</span>&nbsp;<span class="op" id="7981262">&amp;</span><span class="ident" id="7981263">Header</span><span class="op" id="7981269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981276">Name</span><span class="op" id="7981280">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7981286">strings</span><span class="op" id="7981293">.</span><span class="ident" id="7981294">Repeat</span><span class="op" id="7981300">(</span><span class="string" id="7981301">&#34;longname/&#34;</span><span class="op" id="7981312">,</span>&nbsp;<span class="num" id="7981314">15</span><span class="op" id="7981316">)</span>&nbsp;<span class="op" id="7981318">+</span>&nbsp;<span class="string" id="7981320">&#34;16gig.txt&#34;</span><span class="op" id="7981331">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981338">Mode</span><span class="op" id="7981342">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7981348">0644</span><span class="op" id="7981352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981359">Uid</span><span class="op" id="7981362">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7981369">1000</span><span class="op" id="7981373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981380">Gid</span><span class="op" id="7981383">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7981390">1000</span><span class="op" id="7981394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981401">Size</span><span class="op" id="7981405">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7981411">16</span>&nbsp;<span class="op" id="7981414">&lt;&lt;</span>&nbsp;<span class="num" id="7981417">30</span><span class="op" id="7981419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981426">ModTime</span><span class="op" id="7981433">:</span>&nbsp;&nbsp;<span class="ident" id="7981436">time</span><span class="op" id="7981440">.</span><span class="ident" id="7981441">Unix</span><span class="op" id="7981445">(</span><span class="num" id="7981446">1399583047</span><span class="op" id="7981456">,</span>&nbsp;<span class="num" id="7981458">0</span><span class="op" id="7981459">)</span><span class="op" id="7981460">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981467">Typeflag</span><span class="op" id="7981475">:</span>&nbsp;<span class="string" id="7981477">&#39;0&#39;</span><span class="op" id="7981480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981487">Uname</span><span class="op" id="7981492">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7981497">&#34;guillaume&#34;</span><span class="op" id="7981508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981515">Gname</span><span class="op" id="7981520">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7981525">&#34;guillaume&#34;</span><span class="op" id="7981536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981542">}</span><span class="op" id="7981543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7981549">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981570">contents</span><span class="op" id="7981578">:</span>&nbsp;<span class="ident" id="7981580">strings</span><span class="op" id="7981587">.</span><span class="ident" id="7981588">Repeat</span><span class="op" id="7981594">(</span><span class="string" id="7981595">&#34;\x00&#34;</span><span class="op" id="7981601">,</span>&nbsp;<span class="num" id="7981603">4</span><span class="op" id="7981604">&lt;&lt;</span><span class="num" id="7981606">10</span><span class="op" id="7981608">)</span><span class="op" id="7981609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981614">}</span><span class="op" id="7981615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981619">}</span><span class="op" id="7981620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981623">}</span><span class="op" id="7981624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7981627">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7981673">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981735">file</span><span class="op" id="7981739">:</span>&nbsp;<span class="string" id="7981741">&#34;testdata/ustar.tar&#34;</span><span class="op" id="7981761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981765">entries</span><span class="op" id="7981772">:</span>&nbsp;<span class="op" id="7981774">[</span><span class="op" id="7981775">]</span><span class="op" id="7981776">*</span><span class="ident" id="7981777">writerTestEntry</span><span class="op" id="7981792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981797">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981803">header</span><span class="op" id="7981809">:</span>&nbsp;<span class="op" id="7981811">&amp;</span><span class="ident" id="7981812">Header</span><span class="op" id="7981818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981825">Name</span><span class="op" id="7981829">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7981835">strings</span><span class="op" id="7981842">.</span><span class="ident" id="7981843">Repeat</span><span class="op" id="7981849">(</span><span class="string" id="7981850">&#34;longname/&#34;</span><span class="op" id="7981861">,</span>&nbsp;<span class="num" id="7981863">15</span><span class="op" id="7981865">)</span>&nbsp;<span class="op" id="7981867">+</span>&nbsp;<span class="string" id="7981869">&#34;file.txt&#34;</span><span class="op" id="7981879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981886">Mode</span><span class="op" id="7981890">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7981896">0644</span><span class="op" id="7981900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981907">Uid</span><span class="op" id="7981910">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7981917">0765</span><span class="op" id="7981921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981928">Gid</span><span class="op" id="7981931">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7981938">024</span><span class="op" id="7981941">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981948">Size</span><span class="op" id="7981952">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7981958">06</span><span class="op" id="7981960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981967">ModTime</span><span class="op" id="7981974">:</span>&nbsp;&nbsp;<span class="ident" id="7981977">time</span><span class="op" id="7981981">.</span><span class="ident" id="7981982">Unix</span><span class="op" id="7981986">(</span><span class="num" id="7981987">1360135598</span><span class="op" id="7981997">,</span>&nbsp;<span class="num" id="7981999">0</span><span class="op" id="7982000">)</span><span class="op" id="7982001">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982008">Typeflag</span><span class="op" id="7982016">:</span>&nbsp;<span class="string" id="7982018">&#39;0&#39;</span><span class="op" id="7982021">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982028">Uname</span><span class="op" id="7982033">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7982038">&#34;shane&#34;</span><span class="op" id="7982045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982052">Gname</span><span class="op" id="7982057">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7982062">&#34;staff&#34;</span><span class="op" id="7982069">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982075">}</span><span class="op" id="7982076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982082">contents</span><span class="op" id="7982090">:</span>&nbsp;<span class="string" id="7982092">&#34;hello\n&#34;</span><span class="op" id="7982101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982106">}</span><span class="op" id="7982107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982111">}</span><span class="op" id="7982112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982115">}</span><span class="op" id="7982116">,</span><br>
<span class="lineno">150</span><span class="op" id="7982118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7982121">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="7982216">func</span>&nbsp;<span class="ident" id="7982221">bytestr</span><span class="op" id="7982228">(</span><span class="ident" id="7982229">offset</span>&nbsp;<span class="builtintype" id="7982236">int</span><span class="op" id="7982239">,</span>&nbsp;<span class="ident" id="7982241">b</span>&nbsp;<span class="op" id="7982243">[</span><span class="op" id="7982244">]</span><span class="builtintype" id="7982245">byte</span><span class="op" id="7982249">)</span>&nbsp;<span class="builtintype" id="7982251">string</span>&nbsp;<span class="op" id="7982258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982261">const</span>&nbsp;<span class="ident" id="7982267">rowLen</span>&nbsp;<span class="op" id="7982274">=</span>&nbsp;<span class="num" id="7982276">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982280">s</span>&nbsp;<span class="op" id="7982282">:=</span>&nbsp;<span class="ident" id="7982285">fmt</span><span class="op" id="7982288">.</span><span class="ident" id="7982289">Sprintf</span><span class="op" id="7982296">(</span><span class="string" id="7982297">&#34;%04x&nbsp;&#34;</span><span class="op" id="7982304">,</span>&nbsp;<span class="ident" id="7982306">offset</span><span class="op" id="7982312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982315">for</span>&nbsp;<span class="ident" id="7982319">_</span><span class="op" id="7982320">,</span>&nbsp;<span class="ident" id="7982322">ch</span>&nbsp;<span class="op" id="7982325">:=</span>&nbsp;<span class="keyword" id="7982328">range</span>&nbsp;<span class="ident" id="7982334">b</span>&nbsp;<span class="op" id="7982336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982340">switch</span>&nbsp;<span class="op" id="7982347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982351">case</span>&nbsp;<span class="string" id="7982356">&#39;0&#39;</span>&nbsp;<span class="op" id="7982360">&lt;=</span>&nbsp;<span class="ident" id="7982363">ch</span>&nbsp;<span class="op" id="7982366">&amp;&amp;</span>&nbsp;<span class="ident" id="7982369">ch</span>&nbsp;<span class="op" id="7982372">&lt;=</span>&nbsp;<span class="string" id="7982375">&#39;9&#39;</span><span class="op" id="7982378">,</span>&nbsp;<span class="string" id="7982380">&#39;A&#39;</span>&nbsp;<span class="op" id="7982384">&lt;=</span>&nbsp;<span class="ident" id="7982387">ch</span>&nbsp;<span class="op" id="7982390">&amp;&amp;</span>&nbsp;<span class="ident" id="7982393">ch</span>&nbsp;<span class="op" id="7982396">&lt;=</span>&nbsp;<span class="string" id="7982399">&#39;Z&#39;</span><span class="op" id="7982402">,</span>&nbsp;<span class="string" id="7982404">&#39;a&#39;</span>&nbsp;<span class="op" id="7982408">&lt;=</span>&nbsp;<span class="ident" id="7982411">ch</span>&nbsp;<span class="op" id="7982414">&amp;&amp;</span>&nbsp;<span class="ident" id="7982417">ch</span>&nbsp;<span class="op" id="7982420">&lt;=</span>&nbsp;<span class="string" id="7982423">&#39;z&#39;</span><span class="op" id="7982426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982431">s</span>&nbsp;<span class="op" id="7982433">+=</span>&nbsp;<span class="ident" id="7982436">fmt</span><span class="op" id="7982439">.</span><span class="ident" id="7982440">Sprintf</span><span class="op" id="7982447">(</span><span class="string" id="7982448">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="7982454">,</span>&nbsp;<span class="ident" id="7982456">ch</span><span class="op" id="7982458">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982462">default</span><span class="op" id="7982469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982474">s</span>&nbsp;<span class="op" id="7982476">+=</span>&nbsp;<span class="ident" id="7982479">fmt</span><span class="op" id="7982482">.</span><span class="ident" id="7982483">Sprintf</span><span class="op" id="7982490">(</span><span class="string" id="7982491">&#34;&nbsp;%02x&#34;</span><span class="op" id="7982498">,</span>&nbsp;<span class="ident" id="7982500">ch</span><span class="op" id="7982502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982512">return</span>&nbsp;<span class="ident" id="7982519">s</span><br>
<span class="lineno">165</span><span class="op" id="7982521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7982524">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7982577">func</span>&nbsp;<span class="ident" id="7982582">bytediff</span><span class="op" id="7982590">(</span><span class="ident" id="7982591">a</span>&nbsp;<span class="op" id="7982593">[</span><span class="op" id="7982594">]</span><span class="builtintype" id="7982595">byte</span><span class="op" id="7982599">,</span>&nbsp;<span class="ident" id="7982601">b</span>&nbsp;<span class="op" id="7982603">[</span><span class="op" id="7982604">]</span><span class="builtintype" id="7982605">byte</span><span class="op" id="7982609">)</span>&nbsp;<span class="builtintype" id="7982611">string</span>&nbsp;<span class="op" id="7982618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982621">const</span>&nbsp;<span class="ident" id="7982627">rowLen</span>&nbsp;<span class="op" id="7982634">=</span>&nbsp;<span class="num" id="7982636">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982640">s</span>&nbsp;<span class="op" id="7982642">:=</span>&nbsp;<span class="ident" id="7982645">fmt</span><span class="op" id="7982648">.</span><span class="ident" id="7982649">Sprintf</span><span class="op" id="7982656">(</span><span class="string" id="7982657">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="7982684">,</span>&nbsp;<span class="builtinfunc" id="7982686">len</span><span class="op" id="7982689">(</span><span class="ident" id="7982690">a</span><span class="op" id="7982691">)</span><span class="op" id="7982692">,</span>&nbsp;<span class="builtinfunc" id="7982694">len</span><span class="op" id="7982697">(</span><span class="ident" id="7982698">b</span><span class="op" id="7982699">)</span><span class="op" id="7982700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982703">for</span>&nbsp;<span class="ident" id="7982707">offset</span>&nbsp;<span class="op" id="7982714">:=</span>&nbsp;<span class="num" id="7982717">0</span><span class="op" id="7982718">;</span>&nbsp;<span class="builtinfunc" id="7982720">len</span><span class="op" id="7982723">(</span><span class="ident" id="7982724">a</span><span class="op" id="7982725">)</span><span class="op" id="7982726">+</span><span class="builtinfunc" id="7982727">len</span><span class="op" id="7982730">(</span><span class="ident" id="7982731">b</span><span class="op" id="7982732">)</span>&nbsp;<span class="op" id="7982734">&gt;</span>&nbsp;<span class="num" id="7982736">0</span><span class="op" id="7982737">;</span>&nbsp;<span class="ident" id="7982739">offset</span>&nbsp;<span class="op" id="7982746">+=</span>&nbsp;<span class="ident" id="7982749">rowLen</span>&nbsp;<span class="op" id="7982756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982760">na</span><span class="op" id="7982762">,</span>&nbsp;<span class="ident" id="7982764">nb</span>&nbsp;<span class="op" id="7982767">:=</span>&nbsp;<span class="ident" id="7982770">rowLen</span><span class="op" id="7982776">,</span>&nbsp;<span class="ident" id="7982778">rowLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982787">if</span>&nbsp;<span class="ident" id="7982790">na</span>&nbsp;<span class="op" id="7982793">&gt;</span>&nbsp;<span class="builtinfunc" id="7982795">len</span><span class="op" id="7982798">(</span><span class="ident" id="7982799">a</span><span class="op" id="7982800">)</span>&nbsp;<span class="op" id="7982802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982807">na</span>&nbsp;<span class="op" id="7982810">=</span>&nbsp;<span class="builtinfunc" id="7982812">len</span><span class="op" id="7982815">(</span><span class="ident" id="7982816">a</span><span class="op" id="7982817">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982825">if</span>&nbsp;<span class="ident" id="7982828">nb</span>&nbsp;<span class="op" id="7982831">&gt;</span>&nbsp;<span class="builtinfunc" id="7982833">len</span><span class="op" id="7982836">(</span><span class="ident" id="7982837">b</span><span class="op" id="7982838">)</span>&nbsp;<span class="op" id="7982840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982845">nb</span>&nbsp;<span class="op" id="7982848">=</span>&nbsp;<span class="builtinfunc" id="7982850">len</span><span class="op" id="7982853">(</span><span class="ident" id="7982854">b</span><span class="op" id="7982855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982863">sa</span>&nbsp;<span class="op" id="7982866">:=</span>&nbsp;<span class="ident" id="7982869">bytestr</span><span class="op" id="7982876">(</span><span class="ident" id="7982877">offset</span><span class="op" id="7982883">,</span>&nbsp;<span class="ident" id="7982885">a</span><span class="op" id="7982886">[</span><span class="num" id="7982887">0</span><span class="op" id="7982888">:</span><span class="ident" id="7982889">na</span><span class="op" id="7982891">]</span><span class="op" id="7982892">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982896">sb</span>&nbsp;<span class="op" id="7982899">:=</span>&nbsp;<span class="ident" id="7982902">bytestr</span><span class="op" id="7982909">(</span><span class="ident" id="7982910">offset</span><span class="op" id="7982916">,</span>&nbsp;<span class="ident" id="7982918">b</span><span class="op" id="7982919">[</span><span class="num" id="7982920">0</span><span class="op" id="7982921">:</span><span class="ident" id="7982922">nb</span><span class="op" id="7982924">]</span><span class="op" id="7982925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982929">if</span>&nbsp;<span class="ident" id="7982932">sa</span>&nbsp;<span class="op" id="7982935">!=</span>&nbsp;<span class="ident" id="7982938">sb</span>&nbsp;<span class="op" id="7982941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982946">s</span>&nbsp;<span class="op" id="7982948">+=</span>&nbsp;<span class="ident" id="7982951">fmt</span><span class="op" id="7982954">.</span><span class="ident" id="7982955">Sprintf</span><span class="op" id="7982962">(</span><span class="string" id="7982963">&#34;-%v\n+%v\n&#34;</span><span class="op" id="7982975">,</span>&nbsp;<span class="ident" id="7982977">sa</span><span class="op" id="7982979">,</span>&nbsp;<span class="ident" id="7982981">sb</span><span class="op" id="7982983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982991">a</span>&nbsp;<span class="op" id="7982993">=</span>&nbsp;<span class="ident" id="7982995">a</span><span class="op" id="7982996">[</span><span class="ident" id="7982997">na</span><span class="op" id="7982999">:</span><span class="op" id="7983000">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983004">b</span>&nbsp;<span class="op" id="7983006">=</span>&nbsp;<span class="ident" id="7983008">b</span><span class="op" id="7983009">[</span><span class="ident" id="7983010">nb</span><span class="op" id="7983012">:</span><span class="op" id="7983013">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983019">return</span>&nbsp;<span class="ident" id="7983026">s</span><br>
<span class="lineno"></span><span class="op" id="7983028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="7983031">func</span>&nbsp;<span class="ident" id="7983036">TestWriter</span><span class="op" id="7983046">(</span><span class="ident" id="7983047">t</span>&nbsp;<span class="op" id="7983049">*</span><span class="ident" id="7983050">testing</span><span class="op" id="7983057">.</span><span class="ident" id="7983058">T</span><span class="op" id="7983059">)</span>&nbsp;<span class="op" id="7983061">{</span><br>
<span class="lineno"></span><span class="ident" id="7983063">testLoop</span><span class="op" id="7983071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983074">for</span>&nbsp;<span class="ident" id="7983078">i</span><span class="op" id="7983079">,</span>&nbsp;<span class="ident" id="7983081">test</span>&nbsp;<span class="op" id="7983086">:=</span>&nbsp;<span class="keyword" id="7983089">range</span>&nbsp;<span class="ident" id="7983095">writerTests</span>&nbsp;<span class="op" id="7983107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983111">expected</span><span class="op" id="7983119">,</span>&nbsp;<span class="ident" id="7983121">err</span>&nbsp;<span class="op" id="7983125">:=</span>&nbsp;<span class="ident" id="7983128">ioutil</span><span class="op" id="7983134">.</span><span class="ident" id="7983135">ReadFile</span><span class="op" id="7983143">(</span><span class="ident" id="7983144">test</span><span class="op" id="7983148">.</span><span class="ident" id="7983149">file</span><span class="op" id="7983153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983157">if</span>&nbsp;<span class="ident" id="7983160">err</span>&nbsp;<span class="op" id="7983164">!=</span>&nbsp;<span class="ident" id="7983167">nil</span>&nbsp;<span class="op" id="7983171">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983176">t</span><span class="op" id="7983177">.</span><span class="ident" id="7983178">Errorf</span><span class="op" id="7983184">(</span><span class="string" id="7983185">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7983216">,</span>&nbsp;<span class="ident" id="7983218">i</span><span class="op" id="7983219">,</span>&nbsp;<span class="ident" id="7983221">err</span><span class="op" id="7983224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983229">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983245">buf</span>&nbsp;<span class="op" id="7983249">:=</span>&nbsp;<span class="builtinfunc" id="7983252">new</span><span class="op" id="7983255">(</span><span class="ident" id="7983256">bytes</span><span class="op" id="7983261">.</span><span class="ident" id="7983262">Buffer</span><span class="op" id="7983268">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983272">tw</span>&nbsp;<span class="op" id="7983275">:=</span>&nbsp;<span class="ident" id="7983278">NewWriter</span><span class="op" id="7983287">(</span><span class="ident" id="7983288">iotest</span><span class="op" id="7983294">.</span><span class="ident" id="7983295">TruncateWriter</span><span class="op" id="7983309">(</span><span class="ident" id="7983310">buf</span><span class="op" id="7983313">,</span>&nbsp;<span class="num" id="7983315">4</span><span class="op" id="7983316">&lt;&lt;</span><span class="num" id="7983318">10</span><span class="op" id="7983320">)</span><span class="op" id="7983321">)</span>&nbsp;<span class="comment" id="7983323">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983354">big</span>&nbsp;<span class="op" id="7983358">:=</span>&nbsp;<span class="builtintype" id="7983361">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983369">for</span>&nbsp;<span class="ident" id="7983373">j</span><span class="op" id="7983374">,</span>&nbsp;<span class="ident" id="7983376">entry</span>&nbsp;<span class="op" id="7983382">:=</span>&nbsp;<span class="keyword" id="7983385">range</span>&nbsp;<span class="ident" id="7983391">test</span><span class="op" id="7983395">.</span><span class="ident" id="7983396">entries</span>&nbsp;<span class="op" id="7983404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983409">big</span>&nbsp;<span class="op" id="7983413">=</span>&nbsp;<span class="ident" id="7983415">big</span>&nbsp;<span class="op" id="7983419">||</span>&nbsp;<span class="ident" id="7983422">entry</span><span class="op" id="7983427">.</span><span class="ident" id="7983428">header</span><span class="op" id="7983434">.</span><span class="ident" id="7983435">Size</span>&nbsp;<span class="op" id="7983440">&gt;</span>&nbsp;<span class="num" id="7983442">1</span><span class="op" id="7983443">&lt;&lt;</span><span class="num" id="7983445">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983451">if</span>&nbsp;<span class="ident" id="7983454">err</span>&nbsp;<span class="op" id="7983458">:=</span>&nbsp;<span class="ident" id="7983461">tw</span><span class="op" id="7983463">.</span><span class="ident" id="7983464">WriteHeader</span><span class="op" id="7983475">(</span><span class="ident" id="7983476">entry</span><span class="op" id="7983481">.</span><span class="ident" id="7983482">header</span><span class="op" id="7983488">)</span><span class="op" id="7983489">;</span>&nbsp;<span class="ident" id="7983491">err</span>&nbsp;<span class="op" id="7983495">!=</span>&nbsp;<span class="ident" id="7983498">nil</span>&nbsp;<span class="op" id="7983502">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983508">t</span><span class="op" id="7983509">.</span><span class="ident" id="7983510">Errorf</span><span class="op" id="7983516">(</span><span class="string" id="7983517">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7983563">,</span>&nbsp;<span class="ident" id="7983565">i</span><span class="op" id="7983566">,</span>&nbsp;<span class="ident" id="7983568">j</span><span class="op" id="7983569">,</span>&nbsp;<span class="ident" id="7983571">err</span><span class="op" id="7983574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983580">continue</span>&nbsp;<span class="ident" id="7983589">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983606">if</span>&nbsp;<span class="ident" id="7983609">_</span><span class="op" id="7983610">,</span>&nbsp;<span class="ident" id="7983612">err</span>&nbsp;<span class="op" id="7983616">:=</span>&nbsp;<span class="ident" id="7983619">io</span><span class="op" id="7983621">.</span><span class="ident" id="7983622">WriteString</span><span class="op" id="7983633">(</span><span class="ident" id="7983634">tw</span><span class="op" id="7983636">,</span>&nbsp;<span class="ident" id="7983638">entry</span><span class="op" id="7983643">.</span><span class="ident" id="7983644">contents</span><span class="op" id="7983652">)</span><span class="op" id="7983653">;</span>&nbsp;<span class="ident" id="7983655">err</span>&nbsp;<span class="op" id="7983659">!=</span>&nbsp;<span class="ident" id="7983662">nil</span>&nbsp;<span class="op" id="7983666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983672">t</span><span class="op" id="7983673">.</span><span class="ident" id="7983674">Errorf</span><span class="op" id="7983680">(</span><span class="string" id="7983681">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="7983729">,</span>&nbsp;<span class="ident" id="7983731">i</span><span class="op" id="7983732">,</span>&nbsp;<span class="ident" id="7983734">j</span><span class="op" id="7983735">,</span>&nbsp;<span class="ident" id="7983737">err</span><span class="op" id="7983740">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983746">continue</span>&nbsp;<span class="ident" id="7983755">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7983775">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983835">if</span>&nbsp;<span class="ident" id="7983838">err</span>&nbsp;<span class="op" id="7983842">:=</span>&nbsp;<span class="ident" id="7983845">tw</span><span class="op" id="7983847">.</span><span class="ident" id="7983848">Close</span><span class="op" id="7983853">(</span><span class="op" id="7983854">)</span><span class="op" id="7983855">;</span>&nbsp;<span class="ident" id="7983857">err</span>&nbsp;<span class="op" id="7983861">!=</span>&nbsp;<span class="ident" id="7983864">nil</span>&nbsp;<span class="op" id="7983868">&amp;&amp;</span>&nbsp;<span class="op" id="7983871">!</span><span class="ident" id="7983872">big</span>&nbsp;<span class="op" id="7983876">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983881">t</span><span class="op" id="7983882">.</span><span class="ident" id="7983883">Errorf</span><span class="op" id="7983889">(</span><span class="string" id="7983890">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="7983927">,</span>&nbsp;<span class="ident" id="7983929">i</span><span class="op" id="7983930">,</span>&nbsp;<span class="ident" id="7983932">err</span><span class="op" id="7983935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983940">continue</span>&nbsp;<span class="ident" id="7983949">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983965">actual</span>&nbsp;<span class="op" id="7983972">:=</span>&nbsp;<span class="ident" id="7983975">buf</span><span class="op" id="7983978">.</span><span class="ident" id="7983979">Bytes</span><span class="op" id="7983984">(</span><span class="op" id="7983985">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983989">if</span>&nbsp;<span class="op" id="7983992">!</span><span class="ident" id="7983993">bytes</span><span class="op" id="7983998">.</span><span class="ident" id="7983999">Equal</span><span class="op" id="7984004">(</span><span class="ident" id="7984005">expected</span><span class="op" id="7984013">,</span>&nbsp;<span class="ident" id="7984015">actual</span><span class="op" id="7984021">)</span>&nbsp;<span class="op" id="7984023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984028">t</span><span class="op" id="7984029">.</span><span class="ident" id="7984030">Errorf</span><span class="op" id="7984036">(</span><span class="string" id="7984037">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="7984092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984098">i</span><span class="op" id="7984099">,</span>&nbsp;<span class="ident" id="7984101">bytediff</span><span class="op" id="7984109">(</span><span class="ident" id="7984110">expected</span><span class="op" id="7984118">,</span>&nbsp;<span class="ident" id="7984120">actual</span><span class="op" id="7984126">)</span><span class="op" id="7984127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984135">if</span>&nbsp;<span class="ident" id="7984138">testing</span><span class="op" id="7984145">.</span><span class="ident" id="7984146">Short</span><span class="op" id="7984151">(</span><span class="op" id="7984152">)</span>&nbsp;<span class="op" id="7984154">{</span>&nbsp;<span class="comment" id="7984156">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984192">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984203">}</span><br>
<span class="lineno"></span><span class="op" id="7984205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="7984208">func</span>&nbsp;<span class="ident" id="7984213">TestPax</span><span class="op" id="7984220">(</span><span class="ident" id="7984221">t</span>&nbsp;<span class="op" id="7984223">*</span><span class="ident" id="7984224">testing</span><span class="op" id="7984231">.</span><span class="ident" id="7984232">T</span><span class="op" id="7984233">)</span>&nbsp;<span class="op" id="7984235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7984238">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984278">fileinfo</span><span class="op" id="7984286">,</span>&nbsp;<span class="ident" id="7984288">err</span>&nbsp;<span class="op" id="7984292">:=</span>&nbsp;<span class="ident" id="7984295">os</span><span class="op" id="7984297">.</span><span class="ident" id="7984298">Stat</span><span class="op" id="7984302">(</span><span class="string" id="7984303">&#34;testdata/small.txt&#34;</span><span class="op" id="7984323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984326">if</span>&nbsp;<span class="ident" id="7984329">err</span>&nbsp;<span class="op" id="7984333">!=</span>&nbsp;<span class="ident" id="7984336">nil</span>&nbsp;<span class="op" id="7984340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984344">t</span><span class="op" id="7984345">.</span><span class="ident" id="7984346">Fatal</span><span class="op" id="7984351">(</span><span class="ident" id="7984352">err</span><span class="op" id="7984355">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984361">hdr</span><span class="op" id="7984364">,</span>&nbsp;<span class="ident" id="7984366">err</span>&nbsp;<span class="op" id="7984370">:=</span>&nbsp;<span class="ident" id="7984373">FileInfoHeader</span><span class="op" id="7984387">(</span><span class="ident" id="7984388">fileinfo</span><span class="op" id="7984396">,</span>&nbsp;<span class="string" id="7984398">&#34;&#34;</span><span class="op" id="7984400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984403">if</span>&nbsp;<span class="ident" id="7984406">err</span>&nbsp;<span class="op" id="7984410">!=</span>&nbsp;<span class="ident" id="7984413">nil</span>&nbsp;<span class="op" id="7984417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984421">t</span><span class="op" id="7984422">.</span><span class="ident" id="7984423">Fatalf</span><span class="op" id="7984429">(</span><span class="string" id="7984430">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7984443">,</span>&nbsp;<span class="ident" id="7984445">err</span><span class="op" id="7984448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984451">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7984454">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984494">longName</span>&nbsp;<span class="op" id="7984503">:=</span>&nbsp;<span class="ident" id="7984506">strings</span><span class="op" id="7984513">.</span><span class="ident" id="7984514">Repeat</span><span class="op" id="7984520">(</span><span class="string" id="7984521">&#34;ab&#34;</span><span class="op" id="7984525">,</span>&nbsp;<span class="num" id="7984527">100</span><span class="op" id="7984530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984533">contents</span>&nbsp;<span class="op" id="7984542">:=</span>&nbsp;<span class="ident" id="7984545">strings</span><span class="op" id="7984552">.</span><span class="ident" id="7984553">Repeat</span><span class="op" id="7984559">(</span><span class="string" id="7984560">&#34;&nbsp;&#34;</span><span class="op" id="7984563">,</span>&nbsp;<span class="builtintype" id="7984565">int</span><span class="op" id="7984568">(</span><span class="ident" id="7984569">hdr</span><span class="op" id="7984572">.</span><span class="ident" id="7984573">Size</span><span class="op" id="7984577">)</span><span class="op" id="7984578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984581">hdr</span><span class="op" id="7984584">.</span><span class="ident" id="7984585">Name</span>&nbsp;<span class="op" id="7984590">=</span>&nbsp;<span class="ident" id="7984592">longName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984602">var</span>&nbsp;<span class="ident" id="7984606">buf</span>&nbsp;<span class="ident" id="7984610">bytes</span><span class="op" id="7984615">.</span><span class="ident" id="7984616">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984624">writer</span>&nbsp;<span class="op" id="7984631">:=</span>&nbsp;<span class="ident" id="7984634">NewWriter</span><span class="op" id="7984643">(</span><span class="op" id="7984644">&amp;</span><span class="ident" id="7984645">buf</span><span class="op" id="7984648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984651">if</span>&nbsp;<span class="ident" id="7984654">err</span>&nbsp;<span class="op" id="7984658">:=</span>&nbsp;<span class="ident" id="7984661">writer</span><span class="op" id="7984667">.</span><span class="ident" id="7984668">WriteHeader</span><span class="op" id="7984679">(</span><span class="ident" id="7984680">hdr</span><span class="op" id="7984683">)</span><span class="op" id="7984684">;</span>&nbsp;<span class="ident" id="7984686">err</span>&nbsp;<span class="op" id="7984690">!=</span>&nbsp;<span class="ident" id="7984693">nil</span>&nbsp;<span class="op" id="7984697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984701">t</span><span class="op" id="7984702">.</span><span class="ident" id="7984703">Fatal</span><span class="op" id="7984708">(</span><span class="ident" id="7984709">err</span><span class="op" id="7984712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984718">if</span>&nbsp;<span class="ident" id="7984721">_</span><span class="op" id="7984722">,</span>&nbsp;<span class="ident" id="7984724">err</span>&nbsp;<span class="op" id="7984728">=</span>&nbsp;<span class="ident" id="7984730">writer</span><span class="op" id="7984736">.</span><span class="ident" id="7984737">Write</span><span class="op" id="7984742">(</span><span class="op" id="7984743">[</span><span class="op" id="7984744">]</span><span class="builtintype" id="7984745">byte</span><span class="op" id="7984749">(</span><span class="ident" id="7984750">contents</span><span class="op" id="7984758">)</span><span class="op" id="7984759">)</span><span class="op" id="7984760">;</span>&nbsp;<span class="ident" id="7984762">err</span>&nbsp;<span class="op" id="7984766">!=</span>&nbsp;<span class="ident" id="7984769">nil</span>&nbsp;<span class="op" id="7984773">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984777">t</span><span class="op" id="7984778">.</span><span class="ident" id="7984779">Fatal</span><span class="op" id="7984784">(</span><span class="ident" id="7984785">err</span><span class="op" id="7984788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984794">if</span>&nbsp;<span class="ident" id="7984797">err</span>&nbsp;<span class="op" id="7984801">:=</span>&nbsp;<span class="ident" id="7984804">writer</span><span class="op" id="7984810">.</span><span class="ident" id="7984811">Close</span><span class="op" id="7984816">(</span><span class="op" id="7984817">)</span><span class="op" id="7984818">;</span>&nbsp;<span class="ident" id="7984820">err</span>&nbsp;<span class="op" id="7984824">!=</span>&nbsp;<span class="ident" id="7984827">nil</span>&nbsp;<span class="op" id="7984831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984835">t</span><span class="op" id="7984836">.</span><span class="ident" id="7984837">Fatal</span><span class="op" id="7984842">(</span><span class="ident" id="7984843">err</span><span class="op" id="7984846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984849">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7984852">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984910">if</span>&nbsp;<span class="op" id="7984913">!</span><span class="ident" id="7984914">bytes</span><span class="op" id="7984919">.</span><span class="ident" id="7984920">Contains</span><span class="op" id="7984928">(</span><span class="ident" id="7984929">buf</span><span class="op" id="7984932">.</span><span class="ident" id="7984933">Bytes</span><span class="op" id="7984938">(</span><span class="op" id="7984939">)</span><span class="op" id="7984940">,</span>&nbsp;<span class="op" id="7984942">[</span><span class="op" id="7984943">]</span><span class="builtintype" id="7984944">byte</span><span class="op" id="7984948">(</span><span class="string" id="7984949">&#34;PaxHeaders.&#34;</span><span class="op" id="7984962">)</span><span class="op" id="7984963">)</span>&nbsp;<span class="op" id="7984965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984969">t</span><span class="op" id="7984970">.</span><span class="ident" id="7984971">Fatal</span><span class="op" id="7984976">(</span><span class="string" id="7984977">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7985026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7985032">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985094">reader</span>&nbsp;<span class="op" id="7985101">:=</span>&nbsp;<span class="ident" id="7985104">NewReader</span><span class="op" id="7985113">(</span><span class="op" id="7985114">&amp;</span><span class="ident" id="7985115">buf</span><span class="op" id="7985118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985121">hdr</span><span class="op" id="7985124">,</span>&nbsp;<span class="ident" id="7985126">err</span>&nbsp;<span class="op" id="7985130">=</span>&nbsp;<span class="ident" id="7985132">reader</span><span class="op" id="7985138">.</span><span class="ident" id="7985139">Next</span><span class="op" id="7985143">(</span><span class="op" id="7985144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985147">if</span>&nbsp;<span class="ident" id="7985150">err</span>&nbsp;<span class="op" id="7985154">!=</span>&nbsp;<span class="ident" id="7985157">nil</span>&nbsp;<span class="op" id="7985161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985165">t</span><span class="op" id="7985166">.</span><span class="ident" id="7985167">Fatal</span><span class="op" id="7985172">(</span><span class="ident" id="7985173">err</span><span class="op" id="7985176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985179">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985182">if</span>&nbsp;<span class="ident" id="7985185">hdr</span><span class="op" id="7985188">.</span><span class="ident" id="7985189">Name</span>&nbsp;<span class="op" id="7985194">!=</span>&nbsp;<span class="ident" id="7985197">longName</span>&nbsp;<span class="op" id="7985206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985210">t</span><span class="op" id="7985211">.</span><span class="ident" id="7985212">Fatal</span><span class="op" id="7985217">(</span><span class="string" id="7985218">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="7985251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985254">}</span><br>
<span class="lineno"></span><span class="op" id="7985256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="7985259">func</span>&nbsp;<span class="ident" id="7985264">TestPaxSymlink</span><span class="op" id="7985278">(</span><span class="ident" id="7985279">t</span>&nbsp;<span class="op" id="7985281">*</span><span class="ident" id="7985282">testing</span><span class="op" id="7985289">.</span><span class="ident" id="7985290">T</span><span class="op" id="7985291">)</span>&nbsp;<span class="op" id="7985293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7985296">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985340">fileinfo</span><span class="op" id="7985348">,</span>&nbsp;<span class="ident" id="7985350">err</span>&nbsp;<span class="op" id="7985354">:=</span>&nbsp;<span class="ident" id="7985357">os</span><span class="op" id="7985359">.</span><span class="ident" id="7985360">Stat</span><span class="op" id="7985364">(</span><span class="string" id="7985365">&#34;testdata/small.txt&#34;</span><span class="op" id="7985385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985388">if</span>&nbsp;<span class="ident" id="7985391">err</span>&nbsp;<span class="op" id="7985395">!=</span>&nbsp;<span class="ident" id="7985398">nil</span>&nbsp;<span class="op" id="7985402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985406">t</span><span class="op" id="7985407">.</span><span class="ident" id="7985408">Fatal</span><span class="op" id="7985413">(</span><span class="ident" id="7985414">err</span><span class="op" id="7985417">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985423">hdr</span><span class="op" id="7985426">,</span>&nbsp;<span class="ident" id="7985428">err</span>&nbsp;<span class="op" id="7985432">:=</span>&nbsp;<span class="ident" id="7985435">FileInfoHeader</span><span class="op" id="7985449">(</span><span class="ident" id="7985450">fileinfo</span><span class="op" id="7985458">,</span>&nbsp;<span class="string" id="7985460">&#34;&#34;</span><span class="op" id="7985462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985465">hdr</span><span class="op" id="7985468">.</span><span class="ident" id="7985469">Typeflag</span>&nbsp;<span class="op" id="7985478">=</span>&nbsp;<span class="ident" id="7985480">TypeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985493">if</span>&nbsp;<span class="ident" id="7985496">err</span>&nbsp;<span class="op" id="7985500">!=</span>&nbsp;<span class="ident" id="7985503">nil</span>&nbsp;<span class="op" id="7985507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985511">t</span><span class="op" id="7985512">.</span><span class="ident" id="7985513">Fatalf</span><span class="op" id="7985519">(</span><span class="string" id="7985520">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7985534">,</span>&nbsp;<span class="ident" id="7985536">err</span><span class="op" id="7985539">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7985545">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985589">longLinkname</span>&nbsp;<span class="op" id="7985602">:=</span>&nbsp;<span class="ident" id="7985605">strings</span><span class="op" id="7985612">.</span><span class="ident" id="7985613">Repeat</span><span class="op" id="7985619">(</span><span class="string" id="7985620">&#34;1234567890/1234567890&#34;</span><span class="op" id="7985643">,</span>&nbsp;<span class="num" id="7985645">10</span><span class="op" id="7985647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985650">hdr</span><span class="op" id="7985653">.</span><span class="ident" id="7985654">Linkname</span>&nbsp;<span class="op" id="7985663">=</span>&nbsp;<span class="ident" id="7985665">longLinkname</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985680">hdr</span><span class="op" id="7985683">.</span><span class="ident" id="7985684">Size</span>&nbsp;<span class="op" id="7985689">=</span>&nbsp;<span class="num" id="7985691">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985694">var</span>&nbsp;<span class="ident" id="7985698">buf</span>&nbsp;<span class="ident" id="7985702">bytes</span><span class="op" id="7985707">.</span><span class="ident" id="7985708">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985716">writer</span>&nbsp;<span class="op" id="7985723">:=</span>&nbsp;<span class="ident" id="7985726">NewWriter</span><span class="op" id="7985735">(</span><span class="op" id="7985736">&amp;</span><span class="ident" id="7985737">buf</span><span class="op" id="7985740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985743">if</span>&nbsp;<span class="ident" id="7985746">err</span>&nbsp;<span class="op" id="7985750">:=</span>&nbsp;<span class="ident" id="7985753">writer</span><span class="op" id="7985759">.</span><span class="ident" id="7985760">WriteHeader</span><span class="op" id="7985771">(</span><span class="ident" id="7985772">hdr</span><span class="op" id="7985775">)</span><span class="op" id="7985776">;</span>&nbsp;<span class="ident" id="7985778">err</span>&nbsp;<span class="op" id="7985782">!=</span>&nbsp;<span class="ident" id="7985785">nil</span>&nbsp;<span class="op" id="7985789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985793">t</span><span class="op" id="7985794">.</span><span class="ident" id="7985795">Fatal</span><span class="op" id="7985800">(</span><span class="ident" id="7985801">err</span><span class="op" id="7985804">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985810">if</span>&nbsp;<span class="ident" id="7985813">err</span>&nbsp;<span class="op" id="7985817">:=</span>&nbsp;<span class="ident" id="7985820">writer</span><span class="op" id="7985826">.</span><span class="ident" id="7985827">Close</span><span class="op" id="7985832">(</span><span class="op" id="7985833">)</span><span class="op" id="7985834">;</span>&nbsp;<span class="ident" id="7985836">err</span>&nbsp;<span class="op" id="7985840">!=</span>&nbsp;<span class="ident" id="7985843">nil</span>&nbsp;<span class="op" id="7985847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985851">t</span><span class="op" id="7985852">.</span><span class="ident" id="7985853">Fatal</span><span class="op" id="7985858">(</span><span class="ident" id="7985859">err</span><span class="op" id="7985862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7985868">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985926">if</span>&nbsp;<span class="op" id="7985929">!</span><span class="ident" id="7985930">bytes</span><span class="op" id="7985935">.</span><span class="ident" id="7985936">Contains</span><span class="op" id="7985944">(</span><span class="ident" id="7985945">buf</span><span class="op" id="7985948">.</span><span class="ident" id="7985949">Bytes</span><span class="op" id="7985954">(</span><span class="op" id="7985955">)</span><span class="op" id="7985956">,</span>&nbsp;<span class="op" id="7985958">[</span><span class="op" id="7985959">]</span><span class="builtintype" id="7985960">byte</span><span class="op" id="7985964">(</span><span class="string" id="7985965">&#34;PaxHeaders.&#34;</span><span class="op" id="7985978">)</span><span class="op" id="7985979">)</span>&nbsp;<span class="op" id="7985981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985985">t</span><span class="op" id="7985986">.</span><span class="ident" id="7985987">Fatal</span><span class="op" id="7985992">(</span><span class="string" id="7985993">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7986042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7986045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7986048">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986110">reader</span>&nbsp;<span class="op" id="7986117">:=</span>&nbsp;<span class="ident" id="7986120">NewReader</span><span class="op" id="7986129">(</span><span class="op" id="7986130">&amp;</span><span class="ident" id="7986131">buf</span><span class="op" id="7986134">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986137">hdr</span><span class="op" id="7986140">,</span>&nbsp;<span class="ident" id="7986142">err</span>&nbsp;<span class="op" id="7986146">=</span>&nbsp;<span class="ident" id="7986148">reader</span><span class="op" id="7986154">.</span><span class="ident" id="7986155">Next</span><span class="op" id="7986159">(</span><span class="op" id="7986160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986163">if</span>&nbsp;<span class="ident" id="7986166">err</span>&nbsp;<span class="op" id="7986170">!=</span>&nbsp;<span class="ident" id="7986173">nil</span>&nbsp;<span class="op" id="7986177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986181">t</span><span class="op" id="7986182">.</span><span class="ident" id="7986183">Fatal</span><span class="op" id="7986188">(</span><span class="ident" id="7986189">err</span><span class="op" id="7986192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7986195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986198">if</span>&nbsp;<span class="ident" id="7986201">hdr</span><span class="op" id="7986204">.</span><span class="ident" id="7986205">Linkname</span>&nbsp;<span class="op" id="7986214">!=</span>&nbsp;<span class="ident" id="7986217">longLinkname</span>&nbsp;<span class="op" id="7986230">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986234">t</span><span class="op" id="7986235">.</span><span class="ident" id="7986236">Fatal</span><span class="op" id="7986241">(</span><span class="string" id="7986242">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="7986275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7986278">}</span><br>
<span class="lineno"></span><span class="op" id="7986280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7986283">func</span>&nbsp;<span class="ident" id="7986288">TestPaxNonAscii</span><span class="op" id="7986303">(</span><span class="ident" id="7986304">t</span>&nbsp;<span class="op" id="7986306">*</span><span class="ident" id="7986307">testing</span><span class="op" id="7986314">.</span><span class="ident" id="7986315">T</span><span class="op" id="7986316">)</span>&nbsp;<span class="op" id="7986318">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7986321">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7986393">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986448">fileinfo</span><span class="op" id="7986456">,</span>&nbsp;<span class="ident" id="7986458">err</span>&nbsp;<span class="op" id="7986462">:=</span>&nbsp;<span class="ident" id="7986465">os</span><span class="op" id="7986467">.</span><span class="ident" id="7986468">Stat</span><span class="op" id="7986472">(</span><span class="string" id="7986473">&#34;testdata/small.txt&#34;</span><span class="op" id="7986493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986496">if</span>&nbsp;<span class="ident" id="7986499">err</span>&nbsp;<span class="op" id="7986503">!=</span>&nbsp;<span class="ident" id="7986506">nil</span>&nbsp;<span class="op" id="7986510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986514">t</span><span class="op" id="7986515">.</span><span class="ident" id="7986516">Fatal</span><span class="op" id="7986521">(</span><span class="ident" id="7986522">err</span><span class="op" id="7986525">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7986528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986532">hdr</span><span class="op" id="7986535">,</span>&nbsp;<span class="ident" id="7986537">err</span>&nbsp;<span class="op" id="7986541">:=</span>&nbsp;<span class="ident" id="7986544">FileInfoHeader</span><span class="op" id="7986558">(</span><span class="ident" id="7986559">fileinfo</span><span class="op" id="7986567">,</span>&nbsp;<span class="string" id="7986569">&#34;&#34;</span><span class="op" id="7986571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986574">if</span>&nbsp;<span class="ident" id="7986577">err</span>&nbsp;<span class="op" id="7986581">!=</span>&nbsp;<span class="ident" id="7986584">nil</span>&nbsp;<span class="op" id="7986588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986592">t</span><span class="op" id="7986593">.</span><span class="ident" id="7986594">Fatalf</span><span class="op" id="7986600">(</span><span class="string" id="7986601">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7986615">,</span>&nbsp;<span class="ident" id="7986617">err</span><span class="op" id="7986620">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7986623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7986627">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986648">chineseFilename</span>&nbsp;<span class="op" id="7986664">:=</span>&nbsp;<span class="string" id="7986667">&#34;文件名&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986680">chineseGroupname</span>&nbsp;<span class="op" id="7986697">:=</span>&nbsp;<span class="string" id="7986700">&#34;組&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986707">chineseUsername</span>&nbsp;<span class="op" id="7986723">:=</span>&nbsp;<span class="string" id="7986726">&#34;用戶名&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986740">hdr</span><span class="op" id="7986743">.</span><span class="ident" id="7986744">Name</span>&nbsp;<span class="op" id="7986749">=</span>&nbsp;<span class="ident" id="7986751">chineseFilename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986768">hdr</span><span class="op" id="7986771">.</span><span class="ident" id="7986772">Gname</span>&nbsp;<span class="op" id="7986778">=</span>&nbsp;<span class="ident" id="7986780">chineseGroupname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986798">hdr</span><span class="op" id="7986801">.</span><span class="ident" id="7986802">Uname</span>&nbsp;<span class="op" id="7986808">=</span>&nbsp;<span class="ident" id="7986810">chineseUsername</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986828">contents</span>&nbsp;<span class="op" id="7986837">:=</span>&nbsp;<span class="ident" id="7986840">strings</span><span class="op" id="7986847">.</span><span class="ident" id="7986848">Repeat</span><span class="op" id="7986854">(</span><span class="string" id="7986855">&#34;&nbsp;&#34;</span><span class="op" id="7986858">,</span>&nbsp;<span class="builtintype" id="7986860">int</span><span class="op" id="7986863">(</span><span class="ident" id="7986864">hdr</span><span class="op" id="7986867">.</span><span class="ident" id="7986868">Size</span><span class="op" id="7986872">)</span><span class="op" id="7986873">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986877">var</span>&nbsp;<span class="ident" id="7986881">buf</span>&nbsp;<span class="ident" id="7986885">bytes</span><span class="op" id="7986890">.</span><span class="ident" id="7986891">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986899">writer</span>&nbsp;<span class="op" id="7986906">:=</span>&nbsp;<span class="ident" id="7986909">NewWriter</span><span class="op" id="7986918">(</span><span class="op" id="7986919">&amp;</span><span class="ident" id="7986920">buf</span><span class="op" id="7986923">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986926">if</span>&nbsp;<span class="ident" id="7986929">err</span>&nbsp;<span class="op" id="7986933">:=</span>&nbsp;<span class="ident" id="7986936">writer</span><span class="op" id="7986942">.</span><span class="ident" id="7986943">WriteHeader</span><span class="op" id="7986954">(</span><span class="ident" id="7986955">hdr</span><span class="op" id="7986958">)</span><span class="op" id="7986959">;</span>&nbsp;<span class="ident" id="7986961">err</span>&nbsp;<span class="op" id="7986965">!=</span>&nbsp;<span class="ident" id="7986968">nil</span>&nbsp;<span class="op" id="7986972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986976">t</span><span class="op" id="7986977">.</span><span class="ident" id="7986978">Fatal</span><span class="op" id="7986983">(</span><span class="ident" id="7986984">err</span><span class="op" id="7986987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7986990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986993">if</span>&nbsp;<span class="ident" id="7986996">_</span><span class="op" id="7986997">,</span>&nbsp;<span class="ident" id="7986999">err</span>&nbsp;<span class="op" id="7987003">=</span>&nbsp;<span class="ident" id="7987005">writer</span><span class="op" id="7987011">.</span><span class="ident" id="7987012">Write</span><span class="op" id="7987017">(</span><span class="op" id="7987018">[</span><span class="op" id="7987019">]</span><span class="builtintype" id="7987020">byte</span><span class="op" id="7987024">(</span><span class="ident" id="7987025">contents</span><span class="op" id="7987033">)</span><span class="op" id="7987034">)</span><span class="op" id="7987035">;</span>&nbsp;<span class="ident" id="7987037">err</span>&nbsp;<span class="op" id="7987041">!=</span>&nbsp;<span class="ident" id="7987044">nil</span>&nbsp;<span class="op" id="7987048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987052">t</span><span class="op" id="7987053">.</span><span class="ident" id="7987054">Fatal</span><span class="op" id="7987059">(</span><span class="ident" id="7987060">err</span><span class="op" id="7987063">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987069">if</span>&nbsp;<span class="ident" id="7987072">err</span>&nbsp;<span class="op" id="7987076">:=</span>&nbsp;<span class="ident" id="7987079">writer</span><span class="op" id="7987085">.</span><span class="ident" id="7987086">Close</span><span class="op" id="7987091">(</span><span class="op" id="7987092">)</span><span class="op" id="7987093">;</span>&nbsp;<span class="ident" id="7987095">err</span>&nbsp;<span class="op" id="7987099">!=</span>&nbsp;<span class="ident" id="7987102">nil</span>&nbsp;<span class="op" id="7987106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987110">t</span><span class="op" id="7987111">.</span><span class="ident" id="7987112">Fatal</span><span class="op" id="7987117">(</span><span class="ident" id="7987118">err</span><span class="op" id="7987121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7987127">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987185">if</span>&nbsp;<span class="op" id="7987188">!</span><span class="ident" id="7987189">bytes</span><span class="op" id="7987194">.</span><span class="ident" id="7987195">Contains</span><span class="op" id="7987203">(</span><span class="ident" id="7987204">buf</span><span class="op" id="7987207">.</span><span class="ident" id="7987208">Bytes</span><span class="op" id="7987213">(</span><span class="op" id="7987214">)</span><span class="op" id="7987215">,</span>&nbsp;<span class="op" id="7987217">[</span><span class="op" id="7987218">]</span><span class="builtintype" id="7987219">byte</span><span class="op" id="7987223">(</span><span class="string" id="7987224">&#34;PaxHeaders.&#34;</span><span class="op" id="7987237">)</span><span class="op" id="7987238">)</span>&nbsp;<span class="op" id="7987240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987244">t</span><span class="op" id="7987245">.</span><span class="ident" id="7987246">Fatal</span><span class="op" id="7987251">(</span><span class="string" id="7987252">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7987301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7987307">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987369">reader</span>&nbsp;<span class="op" id="7987376">:=</span>&nbsp;<span class="ident" id="7987379">NewReader</span><span class="op" id="7987388">(</span><span class="op" id="7987389">&amp;</span><span class="ident" id="7987390">buf</span><span class="op" id="7987393">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987396">hdr</span><span class="op" id="7987399">,</span>&nbsp;<span class="ident" id="7987401">err</span>&nbsp;<span class="op" id="7987405">=</span>&nbsp;<span class="ident" id="7987407">reader</span><span class="op" id="7987413">.</span><span class="ident" id="7987414">Next</span><span class="op" id="7987418">(</span><span class="op" id="7987419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987422">if</span>&nbsp;<span class="ident" id="7987425">err</span>&nbsp;<span class="op" id="7987429">!=</span>&nbsp;<span class="ident" id="7987432">nil</span>&nbsp;<span class="op" id="7987436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987440">t</span><span class="op" id="7987441">.</span><span class="ident" id="7987442">Fatal</span><span class="op" id="7987447">(</span><span class="ident" id="7987448">err</span><span class="op" id="7987451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987457">if</span>&nbsp;<span class="ident" id="7987460">hdr</span><span class="op" id="7987463">.</span><span class="ident" id="7987464">Name</span>&nbsp;<span class="op" id="7987469">!=</span>&nbsp;<span class="ident" id="7987472">chineseFilename</span>&nbsp;<span class="op" id="7987488">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987492">t</span><span class="op" id="7987493">.</span><span class="ident" id="7987494">Fatal</span><span class="op" id="7987499">(</span><span class="string" id="7987500">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="7987531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987537">if</span>&nbsp;<span class="ident" id="7987540">hdr</span><span class="op" id="7987543">.</span><span class="ident" id="7987544">Gname</span>&nbsp;<span class="op" id="7987550">!=</span>&nbsp;<span class="ident" id="7987553">chineseGroupname</span>&nbsp;<span class="op" id="7987570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987574">t</span><span class="op" id="7987575">.</span><span class="ident" id="7987576">Fatal</span><span class="op" id="7987581">(</span><span class="string" id="7987582">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="7987614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987617">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987620">if</span>&nbsp;<span class="ident" id="7987623">hdr</span><span class="op" id="7987626">.</span><span class="ident" id="7987627">Uname</span>&nbsp;<span class="op" id="7987633">!=</span>&nbsp;<span class="ident" id="7987636">chineseUsername</span>&nbsp;<span class="op" id="7987652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987656">t</span><span class="op" id="7987657">.</span><span class="ident" id="7987658">Fatal</span><span class="op" id="7987663">(</span><span class="string" id="7987664">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="7987695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987698">}</span><br>
<span class="lineno"></span><span class="op" id="7987700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="7987703">func</span>&nbsp;<span class="ident" id="7987708">TestPaxXattrs</span><span class="op" id="7987721">(</span><span class="ident" id="7987722">t</span>&nbsp;<span class="op" id="7987724">*</span><span class="ident" id="7987725">testing</span><span class="op" id="7987732">.</span><span class="ident" id="7987733">T</span><span class="op" id="7987734">)</span>&nbsp;<span class="op" id="7987736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987739">xattrs</span>&nbsp;<span class="op" id="7987746">:=</span>&nbsp;<span class="keyword" id="7987749">map</span><span class="op" id="7987752">[</span><span class="builtintype" id="7987753">string</span><span class="op" id="7987759">]</span><span class="builtintype" id="7987760">string</span><span class="op" id="7987766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7987770">&#34;user.key&#34;</span><span class="op" id="7987780">:</span>&nbsp;<span class="string" id="7987782">&#34;value&#34;</span><span class="op" id="7987789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7987796">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987832">fileinfo</span><span class="op" id="7987840">,</span>&nbsp;<span class="ident" id="7987842">err</span>&nbsp;<span class="op" id="7987846">:=</span>&nbsp;<span class="ident" id="7987849">os</span><span class="op" id="7987851">.</span><span class="ident" id="7987852">Stat</span><span class="op" id="7987856">(</span><span class="string" id="7987857">&#34;testdata/small.txt&#34;</span><span class="op" id="7987877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987880">if</span>&nbsp;<span class="ident" id="7987883">err</span>&nbsp;<span class="op" id="7987887">!=</span>&nbsp;<span class="ident" id="7987890">nil</span>&nbsp;<span class="op" id="7987894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987898">t</span><span class="op" id="7987899">.</span><span class="ident" id="7987900">Fatal</span><span class="op" id="7987905">(</span><span class="ident" id="7987906">err</span><span class="op" id="7987909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987912">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987915">hdr</span><span class="op" id="7987918">,</span>&nbsp;<span class="ident" id="7987920">err</span>&nbsp;<span class="op" id="7987924">:=</span>&nbsp;<span class="ident" id="7987927">FileInfoHeader</span><span class="op" id="7987941">(</span><span class="ident" id="7987942">fileinfo</span><span class="op" id="7987950">,</span>&nbsp;<span class="string" id="7987952">&#34;&#34;</span><span class="op" id="7987954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987957">if</span>&nbsp;<span class="ident" id="7987960">err</span>&nbsp;<span class="op" id="7987964">!=</span>&nbsp;<span class="ident" id="7987967">nil</span>&nbsp;<span class="op" id="7987971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987975">t</span><span class="op" id="7987976">.</span><span class="ident" id="7987977">Fatalf</span><span class="op" id="7987983">(</span><span class="string" id="7987984">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7987997">,</span>&nbsp;<span class="ident" id="7987999">err</span><span class="op" id="7988002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988008">contents</span>&nbsp;<span class="op" id="7988017">:=</span>&nbsp;<span class="string" id="7988020">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988029">hdr</span><span class="op" id="7988032">.</span><span class="ident" id="7988033">Xattrs</span>&nbsp;<span class="op" id="7988040">=</span>&nbsp;<span class="ident" id="7988042">xattrs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988050">var</span>&nbsp;<span class="ident" id="7988054">buf</span>&nbsp;<span class="ident" id="7988058">bytes</span><span class="op" id="7988063">.</span><span class="ident" id="7988064">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988072">writer</span>&nbsp;<span class="op" id="7988079">:=</span>&nbsp;<span class="ident" id="7988082">NewWriter</span><span class="op" id="7988091">(</span><span class="op" id="7988092">&amp;</span><span class="ident" id="7988093">buf</span><span class="op" id="7988096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988099">if</span>&nbsp;<span class="ident" id="7988102">err</span>&nbsp;<span class="op" id="7988106">:=</span>&nbsp;<span class="ident" id="7988109">writer</span><span class="op" id="7988115">.</span><span class="ident" id="7988116">WriteHeader</span><span class="op" id="7988127">(</span><span class="ident" id="7988128">hdr</span><span class="op" id="7988131">)</span><span class="op" id="7988132">;</span>&nbsp;<span class="ident" id="7988134">err</span>&nbsp;<span class="op" id="7988138">!=</span>&nbsp;<span class="ident" id="7988141">nil</span>&nbsp;<span class="op" id="7988145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988149">t</span><span class="op" id="7988150">.</span><span class="ident" id="7988151">Fatal</span><span class="op" id="7988156">(</span><span class="ident" id="7988157">err</span><span class="op" id="7988160">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988166">if</span>&nbsp;<span class="ident" id="7988169">_</span><span class="op" id="7988170">,</span>&nbsp;<span class="ident" id="7988172">err</span>&nbsp;<span class="op" id="7988176">=</span>&nbsp;<span class="ident" id="7988178">writer</span><span class="op" id="7988184">.</span><span class="ident" id="7988185">Write</span><span class="op" id="7988190">(</span><span class="op" id="7988191">[</span><span class="op" id="7988192">]</span><span class="builtintype" id="7988193">byte</span><span class="op" id="7988197">(</span><span class="ident" id="7988198">contents</span><span class="op" id="7988206">)</span><span class="op" id="7988207">)</span><span class="op" id="7988208">;</span>&nbsp;<span class="ident" id="7988210">err</span>&nbsp;<span class="op" id="7988214">!=</span>&nbsp;<span class="ident" id="7988217">nil</span>&nbsp;<span class="op" id="7988221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988225">t</span><span class="op" id="7988226">.</span><span class="ident" id="7988227">Fatal</span><span class="op" id="7988232">(</span><span class="ident" id="7988233">err</span><span class="op" id="7988236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988242">if</span>&nbsp;<span class="ident" id="7988245">err</span>&nbsp;<span class="op" id="7988249">:=</span>&nbsp;<span class="ident" id="7988252">writer</span><span class="op" id="7988258">.</span><span class="ident" id="7988259">Close</span><span class="op" id="7988264">(</span><span class="op" id="7988265">)</span><span class="op" id="7988266">;</span>&nbsp;<span class="ident" id="7988268">err</span>&nbsp;<span class="op" id="7988272">!=</span>&nbsp;<span class="ident" id="7988275">nil</span>&nbsp;<span class="op" id="7988279">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988283">t</span><span class="op" id="7988284">.</span><span class="ident" id="7988285">Fatal</span><span class="op" id="7988290">(</span><span class="ident" id="7988291">err</span><span class="op" id="7988294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7988300">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988361">reader</span>&nbsp;<span class="op" id="7988368">:=</span>&nbsp;<span class="ident" id="7988371">NewReader</span><span class="op" id="7988380">(</span><span class="op" id="7988381">&amp;</span><span class="ident" id="7988382">buf</span><span class="op" id="7988385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988388">hdr</span><span class="op" id="7988391">,</span>&nbsp;<span class="ident" id="7988393">err</span>&nbsp;<span class="op" id="7988397">=</span>&nbsp;<span class="ident" id="7988399">reader</span><span class="op" id="7988405">.</span><span class="ident" id="7988406">Next</span><span class="op" id="7988410">(</span><span class="op" id="7988411">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988414">if</span>&nbsp;<span class="ident" id="7988417">err</span>&nbsp;<span class="op" id="7988421">!=</span>&nbsp;<span class="ident" id="7988424">nil</span>&nbsp;<span class="op" id="7988428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988432">t</span><span class="op" id="7988433">.</span><span class="ident" id="7988434">Fatal</span><span class="op" id="7988439">(</span><span class="ident" id="7988440">err</span><span class="op" id="7988443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988449">if</span>&nbsp;<span class="op" id="7988452">!</span><span class="ident" id="7988453">reflect</span><span class="op" id="7988460">.</span><span class="ident" id="7988461">DeepEqual</span><span class="op" id="7988470">(</span><span class="ident" id="7988471">hdr</span><span class="op" id="7988474">.</span><span class="ident" id="7988475">Xattrs</span><span class="op" id="7988481">,</span>&nbsp;<span class="ident" id="7988483">xattrs</span><span class="op" id="7988489">)</span>&nbsp;<span class="op" id="7988491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988495">t</span><span class="op" id="7988496">.</span><span class="ident" id="7988497">Fatalf</span><span class="op" id="7988503">(</span><span class="string" id="7988504">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="7988558">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988563">hdr</span><span class="op" id="7988566">.</span><span class="ident" id="7988567">Xattrs</span><span class="op" id="7988573">,</span>&nbsp;<span class="ident" id="7988575">xattrs</span><span class="op" id="7988581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988584">}</span><br>
<span class="lineno"></span><span class="op" id="7988586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7988589">func</span>&nbsp;<span class="ident" id="7988594">TestPAXHeader</span><span class="op" id="7988607">(</span><span class="ident" id="7988608">t</span>&nbsp;<span class="op" id="7988610">*</span><span class="ident" id="7988611">testing</span><span class="op" id="7988618">.</span><span class="ident" id="7988619">T</span><span class="op" id="7988620">)</span>&nbsp;<span class="op" id="7988622">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988625">medName</span>&nbsp;<span class="op" id="7988633">:=</span>&nbsp;<span class="ident" id="7988636">strings</span><span class="op" id="7988643">.</span><span class="ident" id="7988644">Repeat</span><span class="op" id="7988650">(</span><span class="string" id="7988651">&#34;CD&#34;</span><span class="op" id="7988655">,</span>&nbsp;<span class="num" id="7988657">50</span><span class="op" id="7988659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988662">longName</span>&nbsp;<span class="op" id="7988671">:=</span>&nbsp;<span class="ident" id="7988674">strings</span><span class="op" id="7988681">.</span><span class="ident" id="7988682">Repeat</span><span class="op" id="7988688">(</span><span class="string" id="7988689">&#34;AB&#34;</span><span class="op" id="7988693">,</span>&nbsp;<span class="num" id="7988695">100</span><span class="op" id="7988698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988701">paxTests</span>&nbsp;<span class="op" id="7988710">:=</span>&nbsp;<span class="op" id="7988713">[</span><span class="op" id="7988714">]</span><span class="op" id="7988715">[</span><span class="num" id="7988716">2</span><span class="op" id="7988717">]</span><span class="builtintype" id="7988718">string</span><span class="op" id="7988724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988728">{</span><span class="ident" id="7988729">paxPath</span>&nbsp;<span class="op" id="7988737">+</span>&nbsp;<span class="string" id="7988739">&#34;=/etc/hosts&#34;</span><span class="op" id="7988752">,</span>&nbsp;<span class="string" id="7988754">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="7988776">}</span><span class="op" id="7988777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988781">{</span><span class="string" id="7988782">&#34;a=b&#34;</span><span class="op" id="7988787">,</span>&nbsp;<span class="string" id="7988789">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="7988798">}</span><span class="op" id="7988799">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7988810">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988835">{</span><span class="string" id="7988836">&#34;a=names&#34;</span><span class="op" id="7988845">,</span>&nbsp;<span class="string" id="7988847">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="7988861">}</span><span class="op" id="7988862">,</span>&nbsp;<span class="comment" id="7988864">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988897">{</span><span class="ident" id="7988898">paxPath</span>&nbsp;<span class="op" id="7988906">+</span>&nbsp;<span class="string" id="7988908">&#34;=&#34;</span>&nbsp;<span class="op" id="7988912">+</span>&nbsp;<span class="ident" id="7988914">longName</span><span class="op" id="7988922">,</span>&nbsp;<span class="ident" id="7988924">fmt</span><span class="op" id="7988927">.</span><span class="ident" id="7988928">Sprintf</span><span class="op" id="7988935">(</span><span class="string" id="7988936">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="7988951">,</span>&nbsp;<span class="ident" id="7988953">longName</span><span class="op" id="7988961">)</span><span class="op" id="7988962">}</span><span class="op" id="7988963">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988967">{</span><span class="ident" id="7988968">paxPath</span>&nbsp;<span class="op" id="7988976">+</span>&nbsp;<span class="string" id="7988978">&#34;=&#34;</span>&nbsp;<span class="op" id="7988982">+</span>&nbsp;<span class="ident" id="7988984">medName</span><span class="op" id="7988991">,</span>&nbsp;<span class="ident" id="7988993">fmt</span><span class="op" id="7988996">.</span><span class="ident" id="7988997">Sprintf</span><span class="op" id="7989004">(</span><span class="string" id="7989005">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="7989020">,</span>&nbsp;<span class="ident" id="7989022">medName</span><span class="op" id="7989029">)</span><span class="op" id="7989030">}</span><span class="op" id="7989031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989035">for</span>&nbsp;<span class="ident" id="7989039">_</span><span class="op" id="7989040">,</span>&nbsp;<span class="ident" id="7989042">test</span>&nbsp;<span class="op" id="7989047">:=</span>&nbsp;<span class="keyword" id="7989050">range</span>&nbsp;<span class="ident" id="7989056">paxTests</span>&nbsp;<span class="op" id="7989065">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989069">key</span><span class="op" id="7989072">,</span>&nbsp;<span class="ident" id="7989074">expected</span>&nbsp;<span class="op" id="7989083">:=</span>&nbsp;<span class="ident" id="7989086">test</span><span class="op" id="7989090">[</span><span class="num" id="7989091">0</span><span class="op" id="7989092">]</span><span class="op" id="7989093">,</span>&nbsp;<span class="ident" id="7989095">test</span><span class="op" id="7989099">[</span><span class="num" id="7989100">1</span><span class="op" id="7989101">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989105">if</span>&nbsp;<span class="ident" id="7989108">result</span>&nbsp;<span class="op" id="7989115">:=</span>&nbsp;<span class="ident" id="7989118">paxHeader</span><span class="op" id="7989127">(</span><span class="ident" id="7989128">key</span><span class="op" id="7989131">)</span><span class="op" id="7989132">;</span>&nbsp;<span class="ident" id="7989134">result</span>&nbsp;<span class="op" id="7989141">!=</span>&nbsp;<span class="ident" id="7989144">expected</span>&nbsp;<span class="op" id="7989153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989158">t</span><span class="op" id="7989159">.</span><span class="ident" id="7989160">Fatalf</span><span class="op" id="7989166">(</span><span class="string" id="7989167">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7989199">,</span>&nbsp;<span class="ident" id="7989201">result</span><span class="op" id="7989207">,</span>&nbsp;<span class="ident" id="7989209">expected</span><span class="op" id="7989217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7989221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7989224">}</span><br>
<span class="lineno">420</span><span class="op" id="7989226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7989229">func</span>&nbsp;<span class="ident" id="7989234">TestUSTARLongName</span><span class="op" id="7989251">(</span><span class="ident" id="7989252">t</span>&nbsp;<span class="op" id="7989254">*</span><span class="ident" id="7989255">testing</span><span class="op" id="7989262">.</span><span class="ident" id="7989263">T</span><span class="op" id="7989264">)</span>&nbsp;<span class="op" id="7989266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7989269">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989367">fileinfo</span><span class="op" id="7989375">,</span>&nbsp;<span class="ident" id="7989377">err</span>&nbsp;<span class="op" id="7989381">:=</span>&nbsp;<span class="ident" id="7989384">os</span><span class="op" id="7989386">.</span><span class="ident" id="7989387">Stat</span><span class="op" id="7989391">(</span><span class="string" id="7989392">&#34;testdata/small.txt&#34;</span><span class="op" id="7989412">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989415">if</span>&nbsp;<span class="ident" id="7989418">err</span>&nbsp;<span class="op" id="7989422">!=</span>&nbsp;<span class="ident" id="7989425">nil</span>&nbsp;<span class="op" id="7989429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989433">t</span><span class="op" id="7989434">.</span><span class="ident" id="7989435">Fatal</span><span class="op" id="7989440">(</span><span class="ident" id="7989441">err</span><span class="op" id="7989444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7989447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989450">hdr</span><span class="op" id="7989453">,</span>&nbsp;<span class="ident" id="7989455">err</span>&nbsp;<span class="op" id="7989459">:=</span>&nbsp;<span class="ident" id="7989462">FileInfoHeader</span><span class="op" id="7989476">(</span><span class="ident" id="7989477">fileinfo</span><span class="op" id="7989485">,</span>&nbsp;<span class="string" id="7989487">&#34;&#34;</span><span class="op" id="7989489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989492">hdr</span><span class="op" id="7989495">.</span><span class="ident" id="7989496">Typeflag</span>&nbsp;<span class="op" id="7989505">=</span>&nbsp;<span class="ident" id="7989507">TypeDir</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989516">if</span>&nbsp;<span class="ident" id="7989519">err</span>&nbsp;<span class="op" id="7989523">!=</span>&nbsp;<span class="ident" id="7989526">nil</span>&nbsp;<span class="op" id="7989530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989534">t</span><span class="op" id="7989535">.</span><span class="ident" id="7989536">Fatalf</span><span class="op" id="7989542">(</span><span class="string" id="7989543">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7989557">,</span>&nbsp;<span class="ident" id="7989559">err</span><span class="op" id="7989562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7989565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7989568">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7989653">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989732">longName</span>&nbsp;<span class="op" id="7989741">:=</span>&nbsp;<span class="string" id="7989744">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990003">hdr</span><span class="op" id="7990006">.</span><span class="ident" id="7990007">Name</span>&nbsp;<span class="op" id="7990012">=</span>&nbsp;<span class="ident" id="7990014">longName</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990025">hdr</span><span class="op" id="7990028">.</span><span class="ident" id="7990029">Size</span>&nbsp;<span class="op" id="7990034">=</span>&nbsp;<span class="num" id="7990036">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990039">var</span>&nbsp;<span class="ident" id="7990043">buf</span>&nbsp;<span class="ident" id="7990047">bytes</span><span class="op" id="7990052">.</span><span class="ident" id="7990053">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990061">writer</span>&nbsp;<span class="op" id="7990068">:=</span>&nbsp;<span class="ident" id="7990071">NewWriter</span><span class="op" id="7990080">(</span><span class="op" id="7990081">&amp;</span><span class="ident" id="7990082">buf</span><span class="op" id="7990085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990088">if</span>&nbsp;<span class="ident" id="7990091">err</span>&nbsp;<span class="op" id="7990095">:=</span>&nbsp;<span class="ident" id="7990098">writer</span><span class="op" id="7990104">.</span><span class="ident" id="7990105">WriteHeader</span><span class="op" id="7990116">(</span><span class="ident" id="7990117">hdr</span><span class="op" id="7990120">)</span><span class="op" id="7990121">;</span>&nbsp;<span class="ident" id="7990123">err</span>&nbsp;<span class="op" id="7990127">!=</span>&nbsp;<span class="ident" id="7990130">nil</span>&nbsp;<span class="op" id="7990134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990138">t</span><span class="op" id="7990139">.</span><span class="ident" id="7990140">Fatal</span><span class="op" id="7990145">(</span><span class="ident" id="7990146">err</span><span class="op" id="7990149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990155">if</span>&nbsp;<span class="ident" id="7990158">err</span>&nbsp;<span class="op" id="7990162">:=</span>&nbsp;<span class="ident" id="7990165">writer</span><span class="op" id="7990171">.</span><span class="ident" id="7990172">Close</span><span class="op" id="7990177">(</span><span class="op" id="7990178">)</span><span class="op" id="7990179">;</span>&nbsp;<span class="ident" id="7990181">err</span>&nbsp;<span class="op" id="7990185">!=</span>&nbsp;<span class="ident" id="7990188">nil</span>&nbsp;<span class="op" id="7990192">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990196">t</span><span class="op" id="7990197">.</span><span class="ident" id="7990198">Fatal</span><span class="op" id="7990203">(</span><span class="ident" id="7990204">err</span><span class="op" id="7990207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7990213">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990275">reader</span>&nbsp;<span class="op" id="7990282">:=</span>&nbsp;<span class="ident" id="7990285">NewReader</span><span class="op" id="7990294">(</span><span class="op" id="7990295">&amp;</span><span class="ident" id="7990296">buf</span><span class="op" id="7990299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990302">hdr</span><span class="op" id="7990305">,</span>&nbsp;<span class="ident" id="7990307">err</span>&nbsp;<span class="op" id="7990311">=</span>&nbsp;<span class="ident" id="7990313">reader</span><span class="op" id="7990319">.</span><span class="ident" id="7990320">Next</span><span class="op" id="7990324">(</span><span class="op" id="7990325">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990328">if</span>&nbsp;<span class="ident" id="7990331">err</span>&nbsp;<span class="op" id="7990335">!=</span>&nbsp;<span class="ident" id="7990338">nil</span>&nbsp;<span class="op" id="7990342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990346">t</span><span class="op" id="7990347">.</span><span class="ident" id="7990348">Fatal</span><span class="op" id="7990353">(</span><span class="ident" id="7990354">err</span><span class="op" id="7990357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990363">if</span>&nbsp;<span class="ident" id="7990366">hdr</span><span class="op" id="7990369">.</span><span class="ident" id="7990370">Name</span>&nbsp;<span class="op" id="7990375">!=</span>&nbsp;<span class="ident" id="7990378">longName</span>&nbsp;<span class="op" id="7990387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990391">t</span><span class="op" id="7990392">.</span><span class="ident" id="7990393">Fatal</span><span class="op" id="7990398">(</span><span class="string" id="7990399">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="7990427">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990430">}</span><br>
<span class="lineno"></span><span class="op" id="7990432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7990435">func</span>&nbsp;<span class="ident" id="7990440">TestValidTypeflagWithPAXHeader</span><span class="op" id="7990470">(</span><span class="ident" id="7990471">t</span>&nbsp;<span class="op" id="7990473">*</span><span class="ident" id="7990474">testing</span><span class="op" id="7990481">.</span><span class="ident" id="7990482">T</span><span class="op" id="7990483">)</span>&nbsp;<span class="op" id="7990485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990488">var</span>&nbsp;<span class="ident" id="7990492">buffer</span>&nbsp;<span class="ident" id="7990499">bytes</span><span class="op" id="7990504">.</span><span class="ident" id="7990505">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990513">tw</span>&nbsp;<span class="op" id="7990516">:=</span>&nbsp;<span class="ident" id="7990519">NewWriter</span><span class="op" id="7990528">(</span><span class="op" id="7990529">&amp;</span><span class="ident" id="7990530">buffer</span><span class="op" id="7990536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990540">fileName</span>&nbsp;<span class="op" id="7990549">:=</span>&nbsp;<span class="ident" id="7990552">strings</span><span class="op" id="7990559">.</span><span class="ident" id="7990560">Repeat</span><span class="op" id="7990566">(</span><span class="string" id="7990567">&#34;ab&#34;</span><span class="op" id="7990571">,</span>&nbsp;<span class="num" id="7990573">100</span><span class="op" id="7990576">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990580">hdr</span>&nbsp;<span class="op" id="7990584">:=</span>&nbsp;<span class="op" id="7990587">&amp;</span><span class="ident" id="7990588">Header</span><span class="op" id="7990594">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990598">Name</span><span class="op" id="7990602">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7990608">fileName</span><span class="op" id="7990616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990620">Size</span><span class="op" id="7990624">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7990630">4</span><span class="op" id="7990631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990635">Typeflag</span><span class="op" id="7990643">:</span>&nbsp;<span class="num" id="7990645">0</span><span class="op" id="7990646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990652">if</span>&nbsp;<span class="ident" id="7990655">err</span>&nbsp;<span class="op" id="7990659">:=</span>&nbsp;<span class="ident" id="7990662">tw</span><span class="op" id="7990664">.</span><span class="ident" id="7990665">WriteHeader</span><span class="op" id="7990676">(</span><span class="ident" id="7990677">hdr</span><span class="op" id="7990680">)</span><span class="op" id="7990681">;</span>&nbsp;<span class="ident" id="7990683">err</span>&nbsp;<span class="op" id="7990687">!=</span>&nbsp;<span class="ident" id="7990690">nil</span>&nbsp;<span class="op" id="7990694">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990698">t</span><span class="op" id="7990699">.</span><span class="ident" id="7990700">Fatalf</span><span class="op" id="7990706">(</span><span class="string" id="7990707">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7990735">,</span>&nbsp;<span class="ident" id="7990737">err</span><span class="op" id="7990740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990746">if</span>&nbsp;<span class="ident" id="7990749">_</span><span class="op" id="7990750">,</span>&nbsp;<span class="ident" id="7990752">err</span>&nbsp;<span class="op" id="7990756">:=</span>&nbsp;<span class="ident" id="7990759">tw</span><span class="op" id="7990761">.</span><span class="ident" id="7990762">Write</span><span class="op" id="7990767">(</span><span class="op" id="7990768">[</span><span class="op" id="7990769">]</span><span class="builtintype" id="7990770">byte</span><span class="op" id="7990774">(</span><span class="string" id="7990775">&#34;fooo&#34;</span><span class="op" id="7990781">)</span><span class="op" id="7990782">)</span><span class="op" id="7990783">;</span>&nbsp;<span class="ident" id="7990785">err</span>&nbsp;<span class="op" id="7990789">!=</span>&nbsp;<span class="ident" id="7990792">nil</span>&nbsp;<span class="op" id="7990796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990800">t</span><span class="op" id="7990801">.</span><span class="ident" id="7990802">Fatalf</span><span class="op" id="7990808">(</span><span class="string" id="7990809">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="7990846">,</span>&nbsp;<span class="ident" id="7990848">err</span><span class="op" id="7990851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990854">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990857">tw</span><span class="op" id="7990859">.</span><span class="ident" id="7990860">Close</span><span class="op" id="7990865">(</span><span class="op" id="7990866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990870">tr</span>&nbsp;<span class="op" id="7990873">:=</span>&nbsp;<span class="ident" id="7990876">NewReader</span><span class="op" id="7990885">(</span><span class="op" id="7990886">&amp;</span><span class="ident" id="7990887">buffer</span><span class="op" id="7990893">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990897">for</span>&nbsp;<span class="op" id="7990901">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990905">header</span><span class="op" id="7990911">,</span>&nbsp;<span class="ident" id="7990913">err</span>&nbsp;<span class="op" id="7990917">:=</span>&nbsp;<span class="ident" id="7990920">tr</span><span class="op" id="7990922">.</span><span class="ident" id="7990923">Next</span><span class="op" id="7990927">(</span><span class="op" id="7990928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990932">if</span>&nbsp;<span class="ident" id="7990935">err</span>&nbsp;<span class="op" id="7990939">==</span>&nbsp;<span class="ident" id="7990942">io</span><span class="op" id="7990944">.</span><span class="ident" id="7990945">EOF</span>&nbsp;<span class="op" id="7990949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990954">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990966">if</span>&nbsp;<span class="ident" id="7990969">err</span>&nbsp;<span class="op" id="7990973">!=</span>&nbsp;<span class="ident" id="7990976">nil</span>&nbsp;<span class="op" id="7990980">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990985">t</span><span class="op" id="7990986">.</span><span class="ident" id="7990987">Fatalf</span><span class="op" id="7990993">(</span><span class="string" id="7990994">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7991021">,</span>&nbsp;<span class="ident" id="7991023">err</span><span class="op" id="7991026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7991030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7991034">if</span>&nbsp;<span class="ident" id="7991037">header</span><span class="op" id="7991043">.</span><span class="ident" id="7991044">Typeflag</span>&nbsp;<span class="op" id="7991053">!=</span>&nbsp;<span class="num" id="7991056">0</span>&nbsp;<span class="op" id="7991058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991063">t</span><span class="op" id="7991064">.</span><span class="ident" id="7991065">Fatalf</span><span class="op" id="7991071">(</span><span class="string" id="7991072">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="7991109">,</span>&nbsp;<span class="ident" id="7991111">header</span><span class="op" id="7991117">.</span><span class="ident" id="7991118">Typeflag</span><span class="op" id="7991126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7991130">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7991133">}</span><br>
<span class="lineno"></span><span class="op" id="7991135">}</span>
</div>
</body>
</html>
