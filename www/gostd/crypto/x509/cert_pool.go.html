<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3573267">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3573322">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3573376">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3573427">package</span>&nbsp;<span class="ident" id="3573435">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3573441">import</span>&nbsp;<span class="op" id="3573448">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3573451">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span><span class="op" id="3573466">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="3573469">//&nbsp;CertPool&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="3573507">type</span>&nbsp;<span class="ident" id="3573512">CertPool</span>&nbsp;<span class="keyword" id="3573521">struct</span>&nbsp;<span class="op" id="3573528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573531">bySubjectKeyId</span>&nbsp;<span class="keyword" id="3573546">map</span><span class="op" id="3573549">[</span><span class="builtintype" id="3573550">string</span><span class="op" id="3573556">]</span><span class="op" id="3573557">[</span><span class="op" id="3573558">]</span><span class="builtintype" id="3573559">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573564">byName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3573579">map</span><span class="op" id="3573582">[</span><span class="builtintype" id="3573583">string</span><span class="op" id="3573589">]</span><span class="op" id="3573590">[</span><span class="op" id="3573591">]</span><span class="builtintype" id="3573592">int</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573597">certs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3573612">[</span><span class="op" id="3573613">]</span><span class="op" id="3573614">*</span><span class="ident" id="3573615">Certificate</span><br>
<span class="lineno"></span><span class="op" id="3573627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3573630">//&nbsp;NewCertPool&nbsp;returns&nbsp;a&nbsp;new,&nbsp;empty&nbsp;CertPool.</span><br>
<span class="lineno"></span><span class="keyword" id="3573676">func</span>&nbsp;<span class="ident" id="3573681">NewCertPool</span><span class="op" id="3573692">(</span><span class="op" id="3573693">)</span>&nbsp;<span class="op" id="3573695">*</span><span class="ident" id="3573696">CertPool</span>&nbsp;<span class="op" id="3573705">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573708">return</span>&nbsp;<span class="op" id="3573715">&amp;</span><span class="ident" id="3573716">CertPool</span><span class="op" id="3573724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3573728">make</span><span class="op" id="3573732">(</span><span class="keyword" id="3573733">map</span><span class="op" id="3573736">[</span><span class="builtintype" id="3573737">string</span><span class="op" id="3573743">]</span><span class="op" id="3573744">[</span><span class="op" id="3573745">]</span><span class="builtintype" id="3573746">int</span><span class="op" id="3573749">)</span><span class="op" id="3573750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3573754">make</span><span class="op" id="3573758">(</span><span class="keyword" id="3573759">map</span><span class="op" id="3573762">[</span><span class="builtintype" id="3573763">string</span><span class="op" id="3573769">]</span><span class="op" id="3573770">[</span><span class="op" id="3573771">]</span><span class="builtintype" id="3573772">int</span><span class="op" id="3573775">)</span><span class="op" id="3573776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573780">nil</span><span class="op" id="3573783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573786">}</span><br>
<span class="lineno">25</span><span class="op" id="3573788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3573791">//&nbsp;findVerifiedParents&nbsp;attempts&nbsp;to&nbsp;find&nbsp;certificates&nbsp;in&nbsp;s&nbsp;which&nbsp;have&nbsp;signed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3573871">//&nbsp;given&nbsp;certificate.&nbsp;If&nbsp;any&nbsp;candidates&nbsp;were&nbsp;rejected&nbsp;then&nbsp;errCert&nbsp;will&nbsp;be&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="3573950">//&nbsp;to&nbsp;one&nbsp;of&nbsp;them,&nbsp;arbitrarily,&nbsp;and&nbsp;err&nbsp;will&nbsp;contain&nbsp;the&nbsp;reason&nbsp;that&nbsp;it&nbsp;was</span><br>
<span class="lineno">30</span><span class="comment" id="3574026">//&nbsp;rejected.</span><br>
<span class="lineno"></span><span class="keyword" id="3574039">func</span>&nbsp;<span class="op" id="3574044">(</span><span class="ident" id="3574045">s</span>&nbsp;<span class="op" id="3574047">*</span><span class="ident" id="3574048">CertPool</span><span class="op" id="3574056">)</span>&nbsp;<span class="ident" id="3574058">findVerifiedParents</span><span class="op" id="3574077">(</span><span class="ident" id="3574078">cert</span>&nbsp;<span class="op" id="3574083">*</span><span class="ident" id="3574084">Certificate</span><span class="op" id="3574095">)</span>&nbsp;<span class="op" id="3574097">(</span><span class="ident" id="3574098">parents</span>&nbsp;<span class="op" id="3574106">[</span><span class="op" id="3574107">]</span><span class="builtintype" id="3574108">int</span><span class="op" id="3574111">,</span>&nbsp;<span class="ident" id="3574113">errCert</span>&nbsp;<span class="op" id="3574121">*</span><span class="ident" id="3574122">Certificate</span><span class="op" id="3574133">,</span>&nbsp;<span class="ident" id="3574135">err</span>&nbsp;<span class="builtintype" id="3574139">error</span><span class="op" id="3574144">)</span>&nbsp;<span class="op" id="3574146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574149">if</span>&nbsp;<span class="ident" id="3574152">s</span>&nbsp;<span class="op" id="3574154">==</span>&nbsp;<span class="ident" id="3574157">nil</span>&nbsp;<span class="op" id="3574161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574165">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3574173">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574176">var</span>&nbsp;<span class="ident" id="3574180">candidates</span>&nbsp;<span class="op" id="3574191">[</span><span class="op" id="3574192">]</span><span class="builtintype" id="3574193">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574199">if</span>&nbsp;<span class="builtinfunc" id="3574202">len</span><span class="op" id="3574205">(</span><span class="ident" id="3574206">cert</span><span class="op" id="3574210">.</span><span class="ident" id="3574211">AuthorityKeyId</span><span class="op" id="3574225">)</span>&nbsp;<span class="op" id="3574227">&gt;</span>&nbsp;<span class="num" id="3574229">0</span>&nbsp;<span class="op" id="3574231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574235">candidates</span>&nbsp;<span class="op" id="3574246">=</span>&nbsp;<span class="ident" id="3574248">s</span><span class="op" id="3574249">.</span><span class="ident" id="3574250">bySubjectKeyId</span><span class="op" id="3574264">[</span><span class="builtintype" id="3574265">string</span><span class="op" id="3574271">(</span><span class="ident" id="3574272">cert</span><span class="op" id="3574276">.</span><span class="ident" id="3574277">AuthorityKeyId</span><span class="op" id="3574291">)</span><span class="op" id="3574292">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3574295">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574298">if</span>&nbsp;<span class="builtinfunc" id="3574301">len</span><span class="op" id="3574304">(</span><span class="ident" id="3574305">candidates</span><span class="op" id="3574315">)</span>&nbsp;<span class="op" id="3574317">==</span>&nbsp;<span class="num" id="3574320">0</span>&nbsp;<span class="op" id="3574322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574326">candidates</span>&nbsp;<span class="op" id="3574337">=</span>&nbsp;<span class="ident" id="3574339">s</span><span class="op" id="3574340">.</span><span class="ident" id="3574341">byName</span><span class="op" id="3574347">[</span><span class="builtintype" id="3574348">string</span><span class="op" id="3574354">(</span><span class="ident" id="3574355">cert</span><span class="op" id="3574359">.</span><span class="ident" id="3574360">RawIssuer</span><span class="op" id="3574369">)</span><span class="op" id="3574370">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3574373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574377">for</span>&nbsp;<span class="ident" id="3574381">_</span><span class="op" id="3574382">,</span>&nbsp;<span class="ident" id="3574384">c</span>&nbsp;<span class="op" id="3574386">:=</span>&nbsp;<span class="keyword" id="3574389">range</span>&nbsp;<span class="ident" id="3574395">candidates</span>&nbsp;<span class="op" id="3574406">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574410">if</span>&nbsp;<span class="ident" id="3574413">err</span>&nbsp;<span class="op" id="3574417">=</span>&nbsp;<span class="ident" id="3574419">cert</span><span class="op" id="3574423">.</span><span class="ident" id="3574424">CheckSignatureFrom</span><span class="op" id="3574442">(</span><span class="ident" id="3574443">s</span><span class="op" id="3574444">.</span><span class="ident" id="3574445">certs</span><span class="op" id="3574450">[</span><span class="ident" id="3574451">c</span><span class="op" id="3574452">]</span><span class="op" id="3574453">)</span><span class="op" id="3574454">;</span>&nbsp;<span class="ident" id="3574456">err</span>&nbsp;<span class="op" id="3574460">==</span>&nbsp;<span class="ident" id="3574463">nil</span>&nbsp;<span class="op" id="3574467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574472">parents</span>&nbsp;<span class="op" id="3574480">=</span>&nbsp;<span class="builtinfunc" id="3574482">append</span><span class="op" id="3574488">(</span><span class="ident" id="3574489">parents</span><span class="op" id="3574496">,</span>&nbsp;<span class="ident" id="3574498">c</span><span class="op" id="3574499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3574503">}</span>&nbsp;<span class="keyword" id="3574505">else</span>&nbsp;<span class="op" id="3574510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574515">errCert</span>&nbsp;<span class="op" id="3574523">=</span>&nbsp;<span class="ident" id="3574525">s</span><span class="op" id="3574526">.</span><span class="ident" id="3574527">certs</span><span class="op" id="3574532">[</span><span class="ident" id="3574533">c</span><span class="op" id="3574534">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3574538">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3574541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574545">return</span><br>
<span class="lineno"></span><span class="op" id="3574552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3574555">//&nbsp;AddCert&nbsp;adds&nbsp;a&nbsp;certificate&nbsp;to&nbsp;a&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="3574596">func</span>&nbsp;<span class="op" id="3574601">(</span><span class="ident" id="3574602">s</span>&nbsp;<span class="op" id="3574604">*</span><span class="ident" id="3574605">CertPool</span><span class="op" id="3574613">)</span>&nbsp;<span class="ident" id="3574615">AddCert</span><span class="op" id="3574622">(</span><span class="ident" id="3574623">cert</span>&nbsp;<span class="op" id="3574628">*</span><span class="ident" id="3574629">Certificate</span><span class="op" id="3574640">)</span>&nbsp;<span class="op" id="3574642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574645">if</span>&nbsp;<span class="ident" id="3574648">cert</span>&nbsp;<span class="op" id="3574653">==</span>&nbsp;<span class="ident" id="3574656">nil</span>&nbsp;<span class="op" id="3574660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3574664">panic</span><span class="op" id="3574669">(</span><span class="string" id="3574670">&#34;adding&nbsp;nil&nbsp;Certificate&nbsp;to&nbsp;CertPool&#34;</span><span class="op" id="3574706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3574709">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574713">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;certificate&nbsp;isn&#39;t&nbsp;being&nbsp;added&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574769">for</span>&nbsp;<span class="ident" id="3574773">_</span><span class="op" id="3574774">,</span>&nbsp;<span class="ident" id="3574776">c</span>&nbsp;<span class="op" id="3574778">:=</span>&nbsp;<span class="keyword" id="3574781">range</span>&nbsp;<span class="ident" id="3574787">s</span><span class="op" id="3574788">.</span><span class="ident" id="3574789">certs</span>&nbsp;<span class="op" id="3574795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574799">if</span>&nbsp;<span class="ident" id="3574802">c</span><span class="op" id="3574803">.</span><span class="ident" id="3574804">Equal</span><span class="op" id="3574809">(</span><span class="ident" id="3574810">cert</span><span class="op" id="3574814">)</span>&nbsp;<span class="op" id="3574816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574821">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3574830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3574833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574837">n</span>&nbsp;<span class="op" id="3574839">:=</span>&nbsp;<span class="builtinfunc" id="3574842">len</span><span class="op" id="3574845">(</span><span class="ident" id="3574846">s</span><span class="op" id="3574847">.</span><span class="ident" id="3574848">certs</span><span class="op" id="3574853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574856">s</span><span class="op" id="3574857">.</span><span class="ident" id="3574858">certs</span>&nbsp;<span class="op" id="3574864">=</span>&nbsp;<span class="builtinfunc" id="3574866">append</span><span class="op" id="3574872">(</span><span class="ident" id="3574873">s</span><span class="op" id="3574874">.</span><span class="ident" id="3574875">certs</span><span class="op" id="3574880">,</span>&nbsp;<span class="ident" id="3574882">cert</span><span class="op" id="3574886">)</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574890">if</span>&nbsp;<span class="builtinfunc" id="3574893">len</span><span class="op" id="3574896">(</span><span class="ident" id="3574897">cert</span><span class="op" id="3574901">.</span><span class="ident" id="3574902">SubjectKeyId</span><span class="op" id="3574914">)</span>&nbsp;<span class="op" id="3574916">&gt;</span>&nbsp;<span class="num" id="3574918">0</span>&nbsp;<span class="op" id="3574920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574924">keyId</span>&nbsp;<span class="op" id="3574930">:=</span>&nbsp;<span class="builtintype" id="3574933">string</span><span class="op" id="3574939">(</span><span class="ident" id="3574940">cert</span><span class="op" id="3574944">.</span><span class="ident" id="3574945">SubjectKeyId</span><span class="op" id="3574957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574961">s</span><span class="op" id="3574962">.</span><span class="ident" id="3574963">bySubjectKeyId</span><span class="op" id="3574977">[</span><span class="ident" id="3574978">keyId</span><span class="op" id="3574983">]</span>&nbsp;<span class="op" id="3574985">=</span>&nbsp;<span class="builtinfunc" id="3574987">append</span><span class="op" id="3574993">(</span><span class="ident" id="3574994">s</span><span class="op" id="3574995">.</span><span class="ident" id="3574996">bySubjectKeyId</span><span class="op" id="3575010">[</span><span class="ident" id="3575011">keyId</span><span class="op" id="3575016">]</span><span class="op" id="3575017">,</span>&nbsp;<span class="ident" id="3575019">n</span><span class="op" id="3575020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3575023">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575026">name</span>&nbsp;<span class="op" id="3575031">:=</span>&nbsp;<span class="builtintype" id="3575034">string</span><span class="op" id="3575040">(</span><span class="ident" id="3575041">cert</span><span class="op" id="3575045">.</span><span class="ident" id="3575046">RawSubject</span><span class="op" id="3575056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575059">s</span><span class="op" id="3575060">.</span><span class="ident" id="3575061">byName</span><span class="op" id="3575067">[</span><span class="ident" id="3575068">name</span><span class="op" id="3575072">]</span>&nbsp;<span class="op" id="3575074">=</span>&nbsp;<span class="builtinfunc" id="3575076">append</span><span class="op" id="3575082">(</span><span class="ident" id="3575083">s</span><span class="op" id="3575084">.</span><span class="ident" id="3575085">byName</span><span class="op" id="3575091">[</span><span class="ident" id="3575092">name</span><span class="op" id="3575096">]</span><span class="op" id="3575097">,</span>&nbsp;<span class="ident" id="3575099">n</span><span class="op" id="3575100">)</span><br>
<span class="lineno"></span><span class="op" id="3575102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3575105">//&nbsp;AppendCertsFromPEM&nbsp;attempts&nbsp;to&nbsp;parse&nbsp;a&nbsp;series&nbsp;of&nbsp;PEM&nbsp;encoded&nbsp;certificates.</span><br>
<span class="lineno">80</span><span class="comment" id="3575183">//&nbsp;It&nbsp;appends&nbsp;any&nbsp;certificates&nbsp;found&nbsp;to&nbsp;s&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;certificates</span><br>
<span class="lineno"></span><span class="comment" id="3575262">//&nbsp;were&nbsp;successfully&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="3575291">//</span><br>
<span class="lineno"></span><span class="comment" id="3575294">//&nbsp;On&nbsp;many&nbsp;Linux&nbsp;systems,&nbsp;/etc/ssl/cert.pem&nbsp;will&nbsp;contain&nbsp;the&nbsp;system&nbsp;wide&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="3575371">//&nbsp;of&nbsp;root&nbsp;CAs&nbsp;in&nbsp;a&nbsp;format&nbsp;suitable&nbsp;for&nbsp;this&nbsp;function.</span><br>
<span class="lineno">85</span><span class="keyword" id="3575426">func</span>&nbsp;<span class="op" id="3575431">(</span><span class="ident" id="3575432">s</span>&nbsp;<span class="op" id="3575434">*</span><span class="ident" id="3575435">CertPool</span><span class="op" id="3575443">)</span>&nbsp;<span class="ident" id="3575445">AppendCertsFromPEM</span><span class="op" id="3575463">(</span><span class="ident" id="3575464">pemCerts</span>&nbsp;<span class="op" id="3575473">[</span><span class="op" id="3575474">]</span><span class="builtintype" id="3575475">byte</span><span class="op" id="3575479">)</span>&nbsp;<span class="op" id="3575481">(</span><span class="ident" id="3575482">ok</span>&nbsp;<span class="builtintype" id="3575485">bool</span><span class="op" id="3575489">)</span>&nbsp;<span class="op" id="3575491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575494">for</span>&nbsp;<span class="builtinfunc" id="3575498">len</span><span class="op" id="3575501">(</span><span class="ident" id="3575502">pemCerts</span><span class="op" id="3575510">)</span>&nbsp;<span class="op" id="3575512">&gt;</span>&nbsp;<span class="num" id="3575514">0</span>&nbsp;<span class="op" id="3575516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575520">var</span>&nbsp;<span class="ident" id="3575524">block</span>&nbsp;<span class="op" id="3575530">*</span><span class="ident" id="3575531">pem</span><span class="op" id="3575534">.</span><span class="ident" id="3575535">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575543">block</span><span class="op" id="3575548">,</span>&nbsp;<span class="ident" id="3575550">pemCerts</span>&nbsp;<span class="op" id="3575559">=</span>&nbsp;<span class="ident" id="3575561">pem</span><span class="op" id="3575564">.</span><span class="ident" id="3575565">Decode</span><span class="op" id="3575571">(</span><span class="ident" id="3575572">pemCerts</span><span class="op" id="3575580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575584">if</span>&nbsp;<span class="ident" id="3575587">block</span>&nbsp;<span class="op" id="3575593">==</span>&nbsp;<span class="ident" id="3575596">nil</span>&nbsp;<span class="op" id="3575600">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575605">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3575613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575617">if</span>&nbsp;<span class="ident" id="3575620">block</span><span class="op" id="3575625">.</span><span class="ident" id="3575626">Type</span>&nbsp;<span class="op" id="3575631">!=</span>&nbsp;<span class="string" id="3575634">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="3575648">||</span>&nbsp;<span class="builtinfunc" id="3575651">len</span><span class="op" id="3575654">(</span><span class="ident" id="3575655">block</span><span class="op" id="3575660">.</span><span class="ident" id="3575661">Headers</span><span class="op" id="3575668">)</span>&nbsp;<span class="op" id="3575670">!=</span>&nbsp;<span class="num" id="3575673">0</span>&nbsp;<span class="op" id="3575675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575680">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3575691">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575696">cert</span><span class="op" id="3575700">,</span>&nbsp;<span class="ident" id="3575702">err</span>&nbsp;<span class="op" id="3575706">:=</span>&nbsp;<span class="ident" id="3575709">ParseCertificate</span><span class="op" id="3575725">(</span><span class="ident" id="3575726">block</span><span class="op" id="3575731">.</span><span class="ident" id="3575732">Bytes</span><span class="op" id="3575737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575741">if</span>&nbsp;<span class="ident" id="3575744">err</span>&nbsp;<span class="op" id="3575748">!=</span>&nbsp;<span class="ident" id="3575751">nil</span>&nbsp;<span class="op" id="3575755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575760">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3575771">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575776">s</span><span class="op" id="3575777">.</span><span class="ident" id="3575778">AddCert</span><span class="op" id="3575785">(</span><span class="ident" id="3575786">cert</span><span class="op" id="3575790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575794">ok</span>&nbsp;<span class="op" id="3575797">=</span>&nbsp;<span class="builtintype" id="3575799">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3575805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575809">return</span><br>
<span class="lineno"></span><span class="op" id="3575816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3575819">//&nbsp;Subjects&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;DER-encoded&nbsp;subjects&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3575877">//&nbsp;all&nbsp;of&nbsp;the&nbsp;certificates&nbsp;in&nbsp;the&nbsp;pool.</span><br>
<span class="lineno">110</span><span class="keyword" id="3575917">func</span>&nbsp;<span class="op" id="3575922">(</span><span class="ident" id="3575923">s</span>&nbsp;<span class="op" id="3575925">*</span><span class="ident" id="3575926">CertPool</span><span class="op" id="3575934">)</span>&nbsp;<span class="ident" id="3575936">Subjects</span><span class="op" id="3575944">(</span><span class="op" id="3575945">)</span>&nbsp;<span class="op" id="3575947">(</span><span class="ident" id="3575948">res</span>&nbsp;<span class="op" id="3575952">[</span><span class="op" id="3575953">]</span><span class="op" id="3575954">[</span><span class="op" id="3575955">]</span><span class="builtintype" id="3575956">byte</span><span class="op" id="3575960">)</span>&nbsp;<span class="op" id="3575962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575965">res</span>&nbsp;<span class="op" id="3575969">=</span>&nbsp;<span class="builtinfunc" id="3575971">make</span><span class="op" id="3575975">(</span><span class="op" id="3575976">[</span><span class="op" id="3575977">]</span><span class="op" id="3575978">[</span><span class="op" id="3575979">]</span><span class="builtintype" id="3575980">byte</span><span class="op" id="3575984">,</span>&nbsp;<span class="builtinfunc" id="3575986">len</span><span class="op" id="3575989">(</span><span class="ident" id="3575990">s</span><span class="op" id="3575991">.</span><span class="ident" id="3575992">certs</span><span class="op" id="3575997">)</span><span class="op" id="3575998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576001">for</span>&nbsp;<span class="ident" id="3576005">i</span><span class="op" id="3576006">,</span>&nbsp;<span class="ident" id="3576008">c</span>&nbsp;<span class="op" id="3576010">:=</span>&nbsp;<span class="keyword" id="3576013">range</span>&nbsp;<span class="ident" id="3576019">s</span><span class="op" id="3576020">.</span><span class="ident" id="3576021">certs</span>&nbsp;<span class="op" id="3576027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576031">res</span><span class="op" id="3576034">[</span><span class="ident" id="3576035">i</span><span class="op" id="3576036">]</span>&nbsp;<span class="op" id="3576038">=</span>&nbsp;<span class="ident" id="3576040">c</span><span class="op" id="3576041">.</span><span class="ident" id="3576042">RawSubject</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576054">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576057">return</span><br>
<span class="lineno"></span><span class="op" id="3576064">}</span>
</div>
</body>
</html>
