<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4950526">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4950582">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4950636">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4950687">package</span>&nbsp;<span class="ident" id="4950695">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4950701">import</span>&nbsp;<span class="op" id="4950708">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4950711">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4950720">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4950730">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4950735">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4950738">//&nbsp;A&nbsp;Decoder&nbsp;reads&nbsp;and&nbsp;decodes&nbsp;JSON&nbsp;objects&nbsp;from&nbsp;an&nbsp;input&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="4950804">type</span>&nbsp;<span class="ident" id="4950809">Decoder</span>&nbsp;<span class="keyword" id="4950817">struct</span>&nbsp;<span class="op" id="4950824">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950827">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4950832">io</span><span class="op" id="4950834">.</span><span class="ident" id="4950835">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950843">buf</span>&nbsp;&nbsp;<span class="op" id="4950848">[</span><span class="op" id="4950849">]</span><span class="builtintype" id="4950850">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950856">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4950861">decodeState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950874">scan</span>&nbsp;<span class="ident" id="4950879">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950888">err</span>&nbsp;&nbsp;<span class="builtintype" id="4950893">error</span><br>
<span class="lineno">20</span><span class="op" id="4950899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4950902">//&nbsp;NewDecoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;decoder&nbsp;that&nbsp;reads&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4950957">//</span><br>
<span class="lineno"></span><span class="comment" id="4950960">//&nbsp;The&nbsp;decoder&nbsp;introduces&nbsp;its&nbsp;own&nbsp;buffering&nbsp;and&nbsp;may</span><br>
<span class="lineno">25</span><span class="comment" id="4951012">//&nbsp;read&nbsp;data&nbsp;from&nbsp;r&nbsp;beyond&nbsp;the&nbsp;JSON&nbsp;values&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="4951066">func</span>&nbsp;<span class="ident" id="4951071">NewDecoder</span><span class="op" id="4951081">(</span><span class="ident" id="4951082">r</span>&nbsp;<span class="ident" id="4951084">io</span><span class="op" id="4951086">.</span><span class="ident" id="4951087">Reader</span><span class="op" id="4951093">)</span>&nbsp;<span class="op" id="4951095">*</span><span class="ident" id="4951096">Decoder</span>&nbsp;<span class="op" id="4951104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951107">return</span>&nbsp;<span class="op" id="4951114">&amp;</span><span class="ident" id="4951115">Decoder</span><span class="op" id="4951122">{</span><span class="ident" id="4951123">r</span><span class="op" id="4951124">:</span>&nbsp;<span class="ident" id="4951126">r</span><span class="op" id="4951127">}</span><br>
<span class="lineno"></span><span class="op" id="4951129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4951132">//&nbsp;UseNumber&nbsp;causes&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;unmarshal&nbsp;a&nbsp;number&nbsp;into&nbsp;an&nbsp;interface{}&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4951211">//&nbsp;Number&nbsp;instead&nbsp;of&nbsp;as&nbsp;a&nbsp;float64.</span><br>
<span class="lineno"></span><span class="keyword" id="4951246">func</span>&nbsp;<span class="op" id="4951251">(</span><span class="ident" id="4951252">dec</span>&nbsp;<span class="op" id="4951256">*</span><span class="ident" id="4951257">Decoder</span><span class="op" id="4951264">)</span>&nbsp;<span class="ident" id="4951266">UseNumber</span><span class="op" id="4951275">(</span><span class="op" id="4951276">)</span>&nbsp;<span class="op" id="4951278">{</span>&nbsp;<span class="ident" id="4951280">dec</span><span class="op" id="4951283">.</span><span class="ident" id="4951284">d</span><span class="op" id="4951285">.</span><span class="ident" id="4951286">useNumber</span>&nbsp;<span class="op" id="4951296">=</span>&nbsp;<span class="builtintype" id="4951298">true</span>&nbsp;<span class="op" id="4951303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4951306">//&nbsp;Decode&nbsp;reads&nbsp;the&nbsp;next&nbsp;JSON-encoded&nbsp;value&nbsp;from&nbsp;its</span><br>
<span class="lineno">35</span><span class="comment" id="4951359">//&nbsp;input&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to&nbsp;by&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="4951412">//</span><br>
<span class="lineno"></span><span class="comment" id="4951415">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Unmarshal&nbsp;for&nbsp;details&nbsp;about</span><br>
<span class="lineno"></span><span class="comment" id="4951472">//&nbsp;the&nbsp;conversion&nbsp;of&nbsp;JSON&nbsp;into&nbsp;a&nbsp;Go&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4951515">func</span>&nbsp;<span class="op" id="4951520">(</span><span class="ident" id="4951521">dec</span>&nbsp;<span class="op" id="4951525">*</span><span class="ident" id="4951526">Decoder</span><span class="op" id="4951533">)</span>&nbsp;<span class="ident" id="4951535">Decode</span><span class="op" id="4951541">(</span><span class="ident" id="4951542">v</span>&nbsp;<span class="keyword" id="4951544">interface</span><span class="op" id="4951553">{</span><span class="op" id="4951554">}</span><span class="op" id="4951555">)</span>&nbsp;<span class="builtintype" id="4951557">error</span>&nbsp;<span class="op" id="4951563">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951566">if</span>&nbsp;<span class="ident" id="4951569">dec</span><span class="op" id="4951572">.</span><span class="ident" id="4951573">err</span>&nbsp;<span class="op" id="4951577">!=</span>&nbsp;<span class="ident" id="4951580">nil</span>&nbsp;<span class="op" id="4951584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951588">return</span>&nbsp;<span class="ident" id="4951595">dec</span><span class="op" id="4951598">.</span><span class="ident" id="4951599">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4951604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951608">n</span><span class="op" id="4951609">,</span>&nbsp;<span class="ident" id="4951611">err</span>&nbsp;<span class="op" id="4951615">:=</span>&nbsp;<span class="ident" id="4951618">dec</span><span class="op" id="4951621">.</span><span class="ident" id="4951622">readValue</span><span class="op" id="4951631">(</span><span class="op" id="4951632">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951635">if</span>&nbsp;<span class="ident" id="4951638">err</span>&nbsp;<span class="op" id="4951642">!=</span>&nbsp;<span class="ident" id="4951645">nil</span>&nbsp;<span class="op" id="4951649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951653">return</span>&nbsp;<span class="ident" id="4951660">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4951665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4951669">//&nbsp;Don&#39;t&nbsp;save&nbsp;err&nbsp;from&nbsp;unmarshal&nbsp;into&nbsp;dec.err:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4951717">//&nbsp;the&nbsp;connection&nbsp;is&nbsp;still&nbsp;usable&nbsp;since&nbsp;we&nbsp;read&nbsp;a&nbsp;complete&nbsp;JSON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4951782">//&nbsp;object&nbsp;from&nbsp;it&nbsp;before&nbsp;the&nbsp;error&nbsp;happened.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951828">dec</span><span class="op" id="4951831">.</span><span class="ident" id="4951832">d</span><span class="op" id="4951833">.</span><span class="ident" id="4951834">init</span><span class="op" id="4951838">(</span><span class="ident" id="4951839">dec</span><span class="op" id="4951842">.</span><span class="ident" id="4951843">buf</span><span class="op" id="4951846">[</span><span class="num" id="4951847">0</span><span class="op" id="4951848">:</span><span class="ident" id="4951849">n</span><span class="op" id="4951850">]</span><span class="op" id="4951851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951854">err</span>&nbsp;<span class="op" id="4951858">=</span>&nbsp;<span class="ident" id="4951860">dec</span><span class="op" id="4951863">.</span><span class="ident" id="4951864">d</span><span class="op" id="4951865">.</span><span class="ident" id="4951866">unmarshal</span><span class="op" id="4951875">(</span><span class="ident" id="4951876">v</span><span class="op" id="4951877">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4951881">//&nbsp;Slide&nbsp;rest&nbsp;of&nbsp;data&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951910">rest</span>&nbsp;<span class="op" id="4951915">:=</span>&nbsp;<span class="builtinfunc" id="4951918">copy</span><span class="op" id="4951922">(</span><span class="ident" id="4951923">dec</span><span class="op" id="4951926">.</span><span class="ident" id="4951927">buf</span><span class="op" id="4951930">,</span>&nbsp;<span class="ident" id="4951932">dec</span><span class="op" id="4951935">.</span><span class="ident" id="4951936">buf</span><span class="op" id="4951939">[</span><span class="ident" id="4951940">n</span><span class="op" id="4951941">:</span><span class="op" id="4951942">]</span><span class="op" id="4951943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951946">dec</span><span class="op" id="4951949">.</span><span class="ident" id="4951950">buf</span>&nbsp;<span class="op" id="4951954">=</span>&nbsp;<span class="ident" id="4951956">dec</span><span class="op" id="4951959">.</span><span class="ident" id="4951960">buf</span><span class="op" id="4951963">[</span><span class="num" id="4951964">0</span><span class="op" id="4951965">:</span><span class="ident" id="4951966">rest</span><span class="op" id="4951970">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951974">return</span>&nbsp;<span class="ident" id="4951981">err</span><br>
<span class="lineno">60</span><span class="op" id="4951985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4951988">//&nbsp;Buffered&nbsp;returns&nbsp;a&nbsp;reader&nbsp;of&nbsp;the&nbsp;data&nbsp;remaining&nbsp;in&nbsp;the&nbsp;Decoder&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4952056">//&nbsp;buffer.&nbsp;The&nbsp;reader&nbsp;is&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="keyword" id="4952118">func</span>&nbsp;<span class="op" id="4952123">(</span><span class="ident" id="4952124">dec</span>&nbsp;<span class="op" id="4952128">*</span><span class="ident" id="4952129">Decoder</span><span class="op" id="4952136">)</span>&nbsp;<span class="ident" id="4952138">Buffered</span><span class="op" id="4952146">(</span><span class="op" id="4952147">)</span>&nbsp;<span class="ident" id="4952149">io</span><span class="op" id="4952151">.</span><span class="ident" id="4952152">Reader</span>&nbsp;<span class="op" id="4952159">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952162">return</span>&nbsp;<span class="ident" id="4952169">bytes</span><span class="op" id="4952174">.</span><span class="ident" id="4952175">NewReader</span><span class="op" id="4952184">(</span><span class="ident" id="4952185">dec</span><span class="op" id="4952188">.</span><span class="ident" id="4952189">buf</span><span class="op" id="4952192">)</span><br>
<span class="lineno"></span><span class="op" id="4952194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4952197">//&nbsp;readValue&nbsp;reads&nbsp;a&nbsp;JSON&nbsp;value&nbsp;into&nbsp;dec.buf.</span><br>
<span class="lineno"></span><span class="comment" id="4952243">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno">70</span><span class="keyword" id="4952285">func</span>&nbsp;<span class="op" id="4952290">(</span><span class="ident" id="4952291">dec</span>&nbsp;<span class="op" id="4952295">*</span><span class="ident" id="4952296">Decoder</span><span class="op" id="4952303">)</span>&nbsp;<span class="ident" id="4952305">readValue</span><span class="op" id="4952314">(</span><span class="op" id="4952315">)</span>&nbsp;<span class="op" id="4952317">(</span><span class="builtintype" id="4952318">int</span><span class="op" id="4952321">,</span>&nbsp;<span class="builtintype" id="4952323">error</span><span class="op" id="4952328">)</span>&nbsp;<span class="op" id="4952330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952333">dec</span><span class="op" id="4952336">.</span><span class="ident" id="4952337">scan</span><span class="op" id="4952341">.</span><span class="ident" id="4952342">reset</span><span class="op" id="4952347">(</span><span class="op" id="4952348">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952352">scanp</span>&nbsp;<span class="op" id="4952358">:=</span>&nbsp;<span class="num" id="4952361">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952364">var</span>&nbsp;<span class="ident" id="4952368">err</span>&nbsp;<span class="builtintype" id="4952372">error</span><br>
<span class="lineno">75</span><span class="ident" id="4952378">Input</span><span class="op" id="4952383">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952386">for</span>&nbsp;<span class="op" id="4952390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952394">//&nbsp;Look&nbsp;in&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952435">for</span>&nbsp;<span class="ident" id="4952439">i</span><span class="op" id="4952440">,</span>&nbsp;<span class="ident" id="4952442">c</span>&nbsp;<span class="op" id="4952444">:=</span>&nbsp;<span class="keyword" id="4952447">range</span>&nbsp;<span class="ident" id="4952453">dec</span><span class="op" id="4952456">.</span><span class="ident" id="4952457">buf</span><span class="op" id="4952460">[</span><span class="ident" id="4952461">scanp</span><span class="op" id="4952466">:</span><span class="op" id="4952467">]</span>&nbsp;<span class="op" id="4952469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952474">dec</span><span class="op" id="4952477">.</span><span class="ident" id="4952478">scan</span><span class="op" id="4952482">.</span><span class="ident" id="4952483">bytes</span><span class="op" id="4952488">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952494">v</span>&nbsp;<span class="op" id="4952496">:=</span>&nbsp;<span class="ident" id="4952499">dec</span><span class="op" id="4952502">.</span><span class="ident" id="4952503">scan</span><span class="op" id="4952507">.</span><span class="ident" id="4952508">step</span><span class="op" id="4952512">(</span><span class="op" id="4952513">&amp;</span><span class="ident" id="4952514">dec</span><span class="op" id="4952517">.</span><span class="ident" id="4952518">scan</span><span class="op" id="4952522">,</span>&nbsp;<span class="builtintype" id="4952524">int</span><span class="op" id="4952527">(</span><span class="ident" id="4952528">c</span><span class="op" id="4952529">)</span><span class="op" id="4952530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952535">if</span>&nbsp;<span class="ident" id="4952538">v</span>&nbsp;<span class="op" id="4952540">==</span>&nbsp;<span class="ident" id="4952543">scanEnd</span>&nbsp;<span class="op" id="4952551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952557">scanp</span>&nbsp;<span class="op" id="4952563">+=</span>&nbsp;<span class="ident" id="4952566">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952572">break</span>&nbsp;<span class="ident" id="4952578">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4952587">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952592">//&nbsp;scanEnd&nbsp;is&nbsp;delayed&nbsp;one&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952627">//&nbsp;We&nbsp;might&nbsp;block&nbsp;trying&nbsp;to&nbsp;get&nbsp;that&nbsp;byte&nbsp;from&nbsp;src,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952682">//&nbsp;so&nbsp;instead&nbsp;invent&nbsp;a&nbsp;space&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952720">if</span>&nbsp;<span class="op" id="4952723">(</span><span class="ident" id="4952724">v</span>&nbsp;<span class="op" id="4952726">==</span>&nbsp;<span class="ident" id="4952729">scanEndObject</span>&nbsp;<span class="op" id="4952743">||</span>&nbsp;<span class="ident" id="4952746">v</span>&nbsp;<span class="op" id="4952748">==</span>&nbsp;<span class="ident" id="4952751">scanEndArray</span><span class="op" id="4952763">)</span>&nbsp;<span class="op" id="4952765">&amp;&amp;</span>&nbsp;<span class="ident" id="4952768">dec</span><span class="op" id="4952771">.</span><span class="ident" id="4952772">scan</span><span class="op" id="4952776">.</span><span class="ident" id="4952777">step</span><span class="op" id="4952781">(</span><span class="op" id="4952782">&amp;</span><span class="ident" id="4952783">dec</span><span class="op" id="4952786">.</span><span class="ident" id="4952787">scan</span><span class="op" id="4952791">,</span>&nbsp;<span class="string" id="4952793">&#39;&nbsp;&#39;</span><span class="op" id="4952796">)</span>&nbsp;<span class="op" id="4952798">==</span>&nbsp;<span class="ident" id="4952801">scanEnd</span>&nbsp;<span class="op" id="4952809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952815">scanp</span>&nbsp;<span class="op" id="4952821">+=</span>&nbsp;<span class="ident" id="4952824">i</span>&nbsp;<span class="op" id="4952826">+</span>&nbsp;<span class="num" id="4952828">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952834">break</span>&nbsp;<span class="ident" id="4952840">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4952849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952854">if</span>&nbsp;<span class="ident" id="4952857">v</span>&nbsp;<span class="op" id="4952859">==</span>&nbsp;<span class="ident" id="4952862">scanError</span>&nbsp;<span class="op" id="4952872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952878">dec</span><span class="op" id="4952881">.</span><span class="ident" id="4952882">err</span>&nbsp;<span class="op" id="4952886">=</span>&nbsp;<span class="ident" id="4952888">dec</span><span class="op" id="4952891">.</span><span class="ident" id="4952892">scan</span><span class="op" id="4952896">.</span><span class="ident" id="4952897">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952905">return</span>&nbsp;<span class="num" id="4952912">0</span><span class="op" id="4952913">,</span>&nbsp;<span class="ident" id="4952915">dec</span><span class="op" id="4952918">.</span><span class="ident" id="4952919">scan</span><span class="op" id="4952923">.</span><span class="ident" id="4952924">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4952931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4952935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952939">scanp</span>&nbsp;<span class="op" id="4952945">=</span>&nbsp;<span class="builtinfunc" id="4952947">len</span><span class="op" id="4952950">(</span><span class="ident" id="4952951">dec</span><span class="op" id="4952954">.</span><span class="ident" id="4952955">buf</span><span class="op" id="4952958">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952963">//&nbsp;Did&nbsp;the&nbsp;last&nbsp;read&nbsp;have&nbsp;an&nbsp;error?</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4953001">//&nbsp;Delayed&nbsp;until&nbsp;now&nbsp;to&nbsp;allow&nbsp;buffer&nbsp;scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953046">if</span>&nbsp;<span class="ident" id="4953049">err</span>&nbsp;<span class="op" id="4953053">!=</span>&nbsp;<span class="ident" id="4953056">nil</span>&nbsp;<span class="op" id="4953060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953065">if</span>&nbsp;<span class="ident" id="4953068">err</span>&nbsp;<span class="op" id="4953072">==</span>&nbsp;<span class="ident" id="4953075">io</span><span class="op" id="4953077">.</span><span class="ident" id="4953078">EOF</span>&nbsp;<span class="op" id="4953082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953088">if</span>&nbsp;<span class="ident" id="4953091">dec</span><span class="op" id="4953094">.</span><span class="ident" id="4953095">scan</span><span class="op" id="4953099">.</span><span class="ident" id="4953100">step</span><span class="op" id="4953104">(</span><span class="op" id="4953105">&amp;</span><span class="ident" id="4953106">dec</span><span class="op" id="4953109">.</span><span class="ident" id="4953110">scan</span><span class="op" id="4953114">,</span>&nbsp;<span class="string" id="4953116">&#39;&nbsp;&#39;</span><span class="op" id="4953119">)</span>&nbsp;<span class="op" id="4953121">==</span>&nbsp;<span class="ident" id="4953124">scanEnd</span>&nbsp;<span class="op" id="4953132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953139">break</span>&nbsp;<span class="ident" id="4953145">Input</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953161">if</span>&nbsp;<span class="ident" id="4953164">nonSpace</span><span class="op" id="4953172">(</span><span class="ident" id="4953173">dec</span><span class="op" id="4953176">.</span><span class="ident" id="4953177">buf</span><span class="op" id="4953180">)</span>&nbsp;<span class="op" id="4953182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953189">err</span>&nbsp;<span class="op" id="4953193">=</span>&nbsp;<span class="ident" id="4953195">io</span><span class="op" id="4953197">.</span><span class="ident" id="4953198">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953224">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953229">dec</span><span class="op" id="4953232">.</span><span class="ident" id="4953233">err</span>&nbsp;<span class="op" id="4953237">=</span>&nbsp;<span class="ident" id="4953239">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953246">return</span>&nbsp;<span class="num" id="4953253">0</span><span class="op" id="4953254">,</span>&nbsp;<span class="ident" id="4953256">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4953267">//&nbsp;Make&nbsp;room&nbsp;to&nbsp;read&nbsp;more&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953312">const</span>&nbsp;<span class="ident" id="4953318">minRead</span>&nbsp;<span class="op" id="4953326">=</span>&nbsp;<span class="num" id="4953328">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953334">if</span>&nbsp;<span class="builtinfunc" id="4953337">cap</span><span class="op" id="4953340">(</span><span class="ident" id="4953341">dec</span><span class="op" id="4953344">.</span><span class="ident" id="4953345">buf</span><span class="op" id="4953348">)</span><span class="op" id="4953349">-</span><span class="builtinfunc" id="4953350">len</span><span class="op" id="4953353">(</span><span class="ident" id="4953354">dec</span><span class="op" id="4953357">.</span><span class="ident" id="4953358">buf</span><span class="op" id="4953361">)</span>&nbsp;<span class="op" id="4953363">&lt;</span>&nbsp;<span class="ident" id="4953365">minRead</span>&nbsp;<span class="op" id="4953373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953378">newBuf</span>&nbsp;<span class="op" id="4953385">:=</span>&nbsp;<span class="builtinfunc" id="4953388">make</span><span class="op" id="4953392">(</span><span class="op" id="4953393">[</span><span class="op" id="4953394">]</span><span class="builtintype" id="4953395">byte</span><span class="op" id="4953399">,</span>&nbsp;<span class="builtinfunc" id="4953401">len</span><span class="op" id="4953404">(</span><span class="ident" id="4953405">dec</span><span class="op" id="4953408">.</span><span class="ident" id="4953409">buf</span><span class="op" id="4953412">)</span><span class="op" id="4953413">,</span>&nbsp;<span class="num" id="4953415">2</span><span class="op" id="4953416">*</span><span class="builtinfunc" id="4953417">cap</span><span class="op" id="4953420">(</span><span class="ident" id="4953421">dec</span><span class="op" id="4953424">.</span><span class="ident" id="4953425">buf</span><span class="op" id="4953428">)</span><span class="op" id="4953429">+</span><span class="ident" id="4953430">minRead</span><span class="op" id="4953437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4953442">copy</span><span class="op" id="4953446">(</span><span class="ident" id="4953447">newBuf</span><span class="op" id="4953453">,</span>&nbsp;<span class="ident" id="4953455">dec</span><span class="op" id="4953458">.</span><span class="ident" id="4953459">buf</span><span class="op" id="4953462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953467">dec</span><span class="op" id="4953470">.</span><span class="ident" id="4953471">buf</span>&nbsp;<span class="op" id="4953475">=</span>&nbsp;<span class="ident" id="4953477">newBuf</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4953491">//&nbsp;Read.&nbsp;&nbsp;Delay&nbsp;error&nbsp;for&nbsp;next&nbsp;iteration&nbsp;(after&nbsp;scan).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953548">var</span>&nbsp;<span class="ident" id="4953552">n</span>&nbsp;<span class="builtintype" id="4953554">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953560">n</span><span class="op" id="4953561">,</span>&nbsp;<span class="ident" id="4953563">err</span>&nbsp;<span class="op" id="4953567">=</span>&nbsp;<span class="ident" id="4953569">dec</span><span class="op" id="4953572">.</span><span class="ident" id="4953573">r</span><span class="op" id="4953574">.</span><span class="ident" id="4953575">Read</span><span class="op" id="4953579">(</span><span class="ident" id="4953580">dec</span><span class="op" id="4953583">.</span><span class="ident" id="4953584">buf</span><span class="op" id="4953587">[</span><span class="builtinfunc" id="4953588">len</span><span class="op" id="4953591">(</span><span class="ident" id="4953592">dec</span><span class="op" id="4953595">.</span><span class="ident" id="4953596">buf</span><span class="op" id="4953599">)</span><span class="op" id="4953600">:</span><span class="builtinfunc" id="4953601">cap</span><span class="op" id="4953604">(</span><span class="ident" id="4953605">dec</span><span class="op" id="4953608">.</span><span class="ident" id="4953609">buf</span><span class="op" id="4953612">)</span><span class="op" id="4953613">]</span><span class="op" id="4953614">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953618">dec</span><span class="op" id="4953621">.</span><span class="ident" id="4953622">buf</span>&nbsp;<span class="op" id="4953626">=</span>&nbsp;<span class="ident" id="4953628">dec</span><span class="op" id="4953631">.</span><span class="ident" id="4953632">buf</span><span class="op" id="4953635">[</span><span class="num" id="4953636">0</span>&nbsp;<span class="op" id="4953638">:</span>&nbsp;<span class="builtinfunc" id="4953640">len</span><span class="op" id="4953643">(</span><span class="ident" id="4953644">dec</span><span class="op" id="4953647">.</span><span class="ident" id="4953648">buf</span><span class="op" id="4953651">)</span><span class="op" id="4953652">+</span><span class="ident" id="4953653">n</span><span class="op" id="4953654">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953660">return</span>&nbsp;<span class="ident" id="4953667">scanp</span><span class="op" id="4953672">,</span>&nbsp;<span class="ident" id="4953674">nil</span><br>
<span class="lineno"></span><span class="op" id="4953678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="4953681">func</span>&nbsp;<span class="ident" id="4953686">nonSpace</span><span class="op" id="4953694">(</span><span class="ident" id="4953695">b</span>&nbsp;<span class="op" id="4953697">[</span><span class="op" id="4953698">]</span><span class="builtintype" id="4953699">byte</span><span class="op" id="4953703">)</span>&nbsp;<span class="builtintype" id="4953705">bool</span>&nbsp;<span class="op" id="4953710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953713">for</span>&nbsp;<span class="ident" id="4953717">_</span><span class="op" id="4953718">,</span>&nbsp;<span class="ident" id="4953720">c</span>&nbsp;<span class="op" id="4953722">:=</span>&nbsp;<span class="keyword" id="4953725">range</span>&nbsp;<span class="ident" id="4953731">b</span>&nbsp;<span class="op" id="4953733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953737">if</span>&nbsp;<span class="op" id="4953740">!</span><span class="ident" id="4953741">isSpace</span><span class="op" id="4953748">(</span><span class="builtintype" id="4953749">rune</span><span class="op" id="4953753">(</span><span class="ident" id="4953754">c</span><span class="op" id="4953755">)</span><span class="op" id="4953756">)</span>&nbsp;<span class="op" id="4953758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953763">return</span>&nbsp;<span class="builtintype" id="4953770">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953777">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953783">return</span>&nbsp;<span class="builtintype" id="4953790">false</span><br>
<span class="lineno"></span><span class="op" id="4953796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4953799">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;JSON&nbsp;objects&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">140</span><span class="keyword" id="4953854">type</span>&nbsp;<span class="ident" id="4953859">Encoder</span>&nbsp;<span class="keyword" id="4953867">struct</span>&nbsp;<span class="op" id="4953874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953877">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4953881">io</span><span class="op" id="4953883">.</span><span class="ident" id="4953884">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953892">err</span>&nbsp;<span class="builtintype" id="4953896">error</span><br>
<span class="lineno"></span><span class="op" id="4953902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="4953905">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4953959">func</span>&nbsp;<span class="ident" id="4953964">NewEncoder</span><span class="op" id="4953974">(</span><span class="ident" id="4953975">w</span>&nbsp;<span class="ident" id="4953977">io</span><span class="op" id="4953979">.</span><span class="ident" id="4953980">Writer</span><span class="op" id="4953986">)</span>&nbsp;<span class="op" id="4953988">*</span><span class="ident" id="4953989">Encoder</span>&nbsp;<span class="op" id="4953997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954000">return</span>&nbsp;<span class="op" id="4954007">&amp;</span><span class="ident" id="4954008">Encoder</span><span class="op" id="4954015">{</span><span class="ident" id="4954016">w</span><span class="op" id="4954017">:</span>&nbsp;<span class="ident" id="4954019">w</span><span class="op" id="4954020">}</span><br>
<span class="lineno"></span><span class="op" id="4954022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="4954025">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4954080">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="4954116">//</span><br>
<span class="lineno"></span><span class="comment" id="4954119">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4954178">//&nbsp;conversion&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;JSON.</span><br>
<span class="lineno">155</span><span class="keyword" id="4954214">func</span>&nbsp;<span class="op" id="4954219">(</span><span class="ident" id="4954220">enc</span>&nbsp;<span class="op" id="4954224">*</span><span class="ident" id="4954225">Encoder</span><span class="op" id="4954232">)</span>&nbsp;<span class="ident" id="4954234">Encode</span><span class="op" id="4954240">(</span><span class="ident" id="4954241">v</span>&nbsp;<span class="keyword" id="4954243">interface</span><span class="op" id="4954252">{</span><span class="op" id="4954253">}</span><span class="op" id="4954254">)</span>&nbsp;<span class="builtintype" id="4954256">error</span>&nbsp;<span class="op" id="4954262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954265">if</span>&nbsp;<span class="ident" id="4954268">enc</span><span class="op" id="4954271">.</span><span class="ident" id="4954272">err</span>&nbsp;<span class="op" id="4954276">!=</span>&nbsp;<span class="ident" id="4954279">nil</span>&nbsp;<span class="op" id="4954283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954287">return</span>&nbsp;<span class="ident" id="4954294">enc</span><span class="op" id="4954297">.</span><span class="ident" id="4954298">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954306">e</span>&nbsp;<span class="op" id="4954308">:=</span>&nbsp;<span class="ident" id="4954311">newEncodeState</span><span class="op" id="4954325">(</span><span class="op" id="4954326">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954329">err</span>&nbsp;<span class="op" id="4954333">:=</span>&nbsp;<span class="ident" id="4954336">e</span><span class="op" id="4954337">.</span><span class="ident" id="4954338">marshal</span><span class="op" id="4954345">(</span><span class="ident" id="4954346">v</span><span class="op" id="4954347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954350">if</span>&nbsp;<span class="ident" id="4954353">err</span>&nbsp;<span class="op" id="4954357">!=</span>&nbsp;<span class="ident" id="4954360">nil</span>&nbsp;<span class="op" id="4954364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954368">return</span>&nbsp;<span class="ident" id="4954375">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4954384">//&nbsp;Terminate&nbsp;each&nbsp;value&nbsp;with&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4954425">//&nbsp;This&nbsp;makes&nbsp;the&nbsp;output&nbsp;look&nbsp;a&nbsp;little&nbsp;nicer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4954471">//&nbsp;when&nbsp;debugging,&nbsp;and&nbsp;some&nbsp;kind&nbsp;of&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4954514">//&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;encoded&nbsp;value&nbsp;was&nbsp;a&nbsp;number,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4954565">//&nbsp;so&nbsp;that&nbsp;the&nbsp;reader&nbsp;knows&nbsp;there&nbsp;aren&#39;t&nbsp;more</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4954612">//&nbsp;digits&nbsp;coming.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954631">e</span><span class="op" id="4954632">.</span><span class="ident" id="4954633">WriteByte</span><span class="op" id="4954642">(</span><span class="string" id="4954643">&#39;\n&#39;</span><span class="op" id="4954647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954651">if</span>&nbsp;<span class="ident" id="4954654">_</span><span class="op" id="4954655">,</span>&nbsp;<span class="ident" id="4954657">err</span>&nbsp;<span class="op" id="4954661">=</span>&nbsp;<span class="ident" id="4954663">enc</span><span class="op" id="4954666">.</span><span class="ident" id="4954667">w</span><span class="op" id="4954668">.</span><span class="ident" id="4954669">Write</span><span class="op" id="4954674">(</span><span class="ident" id="4954675">e</span><span class="op" id="4954676">.</span><span class="ident" id="4954677">Bytes</span><span class="op" id="4954682">(</span><span class="op" id="4954683">)</span><span class="op" id="4954684">)</span><span class="op" id="4954685">;</span>&nbsp;<span class="ident" id="4954687">err</span>&nbsp;<span class="op" id="4954691">!=</span>&nbsp;<span class="ident" id="4954694">nil</span>&nbsp;<span class="op" id="4954698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954702">enc</span><span class="op" id="4954705">.</span><span class="ident" id="4954706">err</span>&nbsp;<span class="op" id="4954710">=</span>&nbsp;<span class="ident" id="4954712">err</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954720">encodeStatePool</span><span class="op" id="4954735">.</span><span class="ident" id="4954736">Put</span><span class="op" id="4954739">(</span><span class="ident" id="4954740">e</span><span class="op" id="4954741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954744">return</span>&nbsp;<span class="ident" id="4954751">err</span><br>
<span class="lineno"></span><span class="op" id="4954755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="4954758">//&nbsp;RawMessage&nbsp;is&nbsp;a&nbsp;raw&nbsp;encoded&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4954802">//&nbsp;It&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="4954853">//&nbsp;be&nbsp;used&nbsp;to&nbsp;delay&nbsp;JSON&nbsp;decoding&nbsp;or&nbsp;precompute&nbsp;a&nbsp;JSON&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4954918">type</span>&nbsp;<span class="ident" id="4954923">RawMessage</span>&nbsp;<span class="op" id="4954934">[</span><span class="op" id="4954935">]</span><span class="builtintype" id="4954936">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="4954942">//&nbsp;MarshalJSON&nbsp;returns&nbsp;*m&nbsp;as&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="4954995">func</span>&nbsp;<span class="op" id="4955000">(</span><span class="ident" id="4955001">m</span>&nbsp;<span class="op" id="4955003">*</span><span class="ident" id="4955004">RawMessage</span><span class="op" id="4955014">)</span>&nbsp;<span class="ident" id="4955016">MarshalJSON</span><span class="op" id="4955027">(</span><span class="op" id="4955028">)</span>&nbsp;<span class="op" id="4955030">(</span><span class="op" id="4955031">[</span><span class="op" id="4955032">]</span><span class="builtintype" id="4955033">byte</span><span class="op" id="4955037">,</span>&nbsp;<span class="builtintype" id="4955039">error</span><span class="op" id="4955044">)</span>&nbsp;<span class="op" id="4955046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955049">return</span>&nbsp;<span class="op" id="4955056">*</span><span class="ident" id="4955057">m</span><span class="op" id="4955058">,</span>&nbsp;<span class="ident" id="4955060">nil</span><br>
<span class="lineno"></span><span class="op" id="4955064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4955067">//&nbsp;UnmarshalJSON&nbsp;sets&nbsp;*m&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4955111">func</span>&nbsp;<span class="op" id="4955116">(</span><span class="ident" id="4955117">m</span>&nbsp;<span class="op" id="4955119">*</span><span class="ident" id="4955120">RawMessage</span><span class="op" id="4955130">)</span>&nbsp;<span class="ident" id="4955132">UnmarshalJSON</span><span class="op" id="4955145">(</span><span class="ident" id="4955146">data</span>&nbsp;<span class="op" id="4955151">[</span><span class="op" id="4955152">]</span><span class="builtintype" id="4955153">byte</span><span class="op" id="4955157">)</span>&nbsp;<span class="builtintype" id="4955159">error</span>&nbsp;<span class="op" id="4955165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955168">if</span>&nbsp;<span class="ident" id="4955171">m</span>&nbsp;<span class="op" id="4955173">==</span>&nbsp;<span class="ident" id="4955176">nil</span>&nbsp;<span class="op" id="4955180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955184">return</span>&nbsp;<span class="ident" id="4955191">errors</span><span class="op" id="4955197">.</span><span class="ident" id="4955198">New</span><span class="op" id="4955201">(</span><span class="string" id="4955202">&#34;json.RawMessage:&nbsp;UnmarshalJSON&nbsp;on&nbsp;nil&nbsp;pointer&#34;</span><span class="op" id="4955249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4955252">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4955255">*</span><span class="ident" id="4955256">m</span>&nbsp;<span class="op" id="4955258">=</span>&nbsp;<span class="builtinfunc" id="4955260">append</span><span class="op" id="4955266">(</span><span class="op" id="4955267">(</span><span class="op" id="4955268">*</span><span class="ident" id="4955269">m</span><span class="op" id="4955270">)</span><span class="op" id="4955271">[</span><span class="num" id="4955272">0</span><span class="op" id="4955273">:</span><span class="num" id="4955274">0</span><span class="op" id="4955275">]</span><span class="op" id="4955276">,</span>&nbsp;<span class="ident" id="4955278">data</span><span class="op" id="4955282">...</span><span class="op" id="4955285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955288">return</span>&nbsp;<span class="ident" id="4955295">nil</span><br>
<span class="lineno"></span><span class="op" id="4955299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4955302">var</span>&nbsp;<span class="ident" id="4955306">_</span>&nbsp;<span class="ident" id="4955308">Marshaler</span>&nbsp;<span class="op" id="4955318">=</span>&nbsp;<span class="op" id="4955320">(</span><span class="op" id="4955321">*</span><span class="ident" id="4955322">RawMessage</span><span class="op" id="4955332">)</span><span class="op" id="4955333">(</span><span class="ident" id="4955334">nil</span><span class="op" id="4955337">)</span><br>
<span class="lineno">200</span><span class="keyword" id="4955339">var</span>&nbsp;<span class="ident" id="4955343">_</span>&nbsp;<span class="ident" id="4955345">Unmarshaler</span>&nbsp;<span class="op" id="4955357">=</span>&nbsp;<span class="op" id="4955359">(</span><span class="op" id="4955360">*</span><span class="ident" id="4955361">RawMessage</span><span class="op" id="4955371">)</span><span class="op" id="4955372">(</span><span class="ident" id="4955373">nil</span><span class="op" id="4955376">)</span>
</div>
</body>
</html>
