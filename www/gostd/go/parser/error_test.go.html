<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6677847">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6677902">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6677956">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6678007">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;parser&nbsp;test&nbsp;harness.&nbsp;The&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata</span><br>
<span class="lineno"></span><span class="comment" id="6678080">//&nbsp;directory&nbsp;are&nbsp;parsed&nbsp;and&nbsp;the&nbsp;errors&nbsp;reported&nbsp;are&nbsp;compared&nbsp;against&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6678153">//&nbsp;error&nbsp;messages&nbsp;expected&nbsp;in&nbsp;the&nbsp;test&nbsp;files.&nbsp;The&nbsp;test&nbsp;files&nbsp;must&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6678226">//&nbsp;.src&nbsp;rather&nbsp;than&nbsp;.go&nbsp;so&nbsp;that&nbsp;they&nbsp;are&nbsp;not&nbsp;disturbed&nbsp;by&nbsp;gofmt&nbsp;runs.</span><br>
<span class="lineno"></span><span class="comment" id="6678296">//</span><br>
<span class="lineno">10</span><span class="comment" id="6678299">//&nbsp;Expected&nbsp;errors&nbsp;are&nbsp;indicated&nbsp;in&nbsp;the&nbsp;test&nbsp;files&nbsp;by&nbsp;putting&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="6678371">//&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;immediately&nbsp;following&nbsp;an&nbsp;offending&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="6678445">//&nbsp;The&nbsp;harness&nbsp;will&nbsp;verify&nbsp;that&nbsp;an&nbsp;error&nbsp;matching&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="6678518">//&nbsp;rx&nbsp;is&nbsp;reported&nbsp;at&nbsp;that&nbsp;source&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="6678561">//</span><br>
<span class="lineno">15</span><span class="comment" id="6678564">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;following&nbsp;test&nbsp;file&nbsp;indicates&nbsp;that&nbsp;a&nbsp;&#34;not&nbsp;declared&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6678637">//&nbsp;error&nbsp;should&nbsp;be&nbsp;reported&nbsp;for&nbsp;the&nbsp;undeclared&nbsp;variable&nbsp;x:</span><br>
<span class="lineno"></span><span class="comment" id="6678696">//</span><br>
<span class="lineno"></span><span class="comment" id="6678699">//&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="6678712">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;f()&nbsp;{</span><br>
<span class="lineno">20</span><span class="comment" id="6678726">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp_&nbsp;=&nbsp;x&nbsp;/*&nbsp;ERROR&nbsp;&#34;not&nbsp;declared&#34;&nbsp;*/&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="6678767">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6678773">package</span>&nbsp;<span class="ident" id="6678781">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6678789">import</span>&nbsp;<span class="op" id="6678796">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6678799">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6678813">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6678825">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6678838">&#34;path/filepath&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6678855">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6678865">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6678876">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6678886">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="6678889">const</span>&nbsp;<span class="ident" id="6678895">testdata</span>&nbsp;<span class="op" id="6678904">=</span>&nbsp;<span class="string" id="6678906">&#34;testdata&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6678918">var</span>&nbsp;<span class="ident" id="6678922">fsetErrs</span>&nbsp;<span class="op" id="6678931">=</span>&nbsp;<span class="ident" id="6678933">token</span><span class="op" id="6678938">.</span><span class="ident" id="6678939">NewFileSet</span><span class="op" id="6678949">(</span><span class="op" id="6678950">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6678953">//&nbsp;getFile&nbsp;assumes&nbsp;that&nbsp;each&nbsp;filename&nbsp;occurs&nbsp;at&nbsp;most&nbsp;once</span><br>
<span class="lineno">40</span><span class="keyword" id="6679011">func</span>&nbsp;<span class="ident" id="6679016">getFile</span><span class="op" id="6679023">(</span><span class="ident" id="6679024">filename</span>&nbsp;<span class="builtintype" id="6679033">string</span><span class="op" id="6679039">)</span>&nbsp;<span class="op" id="6679041">(</span><span class="ident" id="6679042">file</span>&nbsp;<span class="op" id="6679047">*</span><span class="ident" id="6679048">token</span><span class="op" id="6679053">.</span><span class="ident" id="6679054">File</span><span class="op" id="6679058">)</span>&nbsp;<span class="op" id="6679060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679063">fsetErrs</span><span class="op" id="6679071">.</span><span class="ident" id="6679072">Iterate</span><span class="op" id="6679079">(</span><span class="keyword" id="6679080">func</span><span class="op" id="6679084">(</span><span class="ident" id="6679085">f</span>&nbsp;<span class="op" id="6679087">*</span><span class="ident" id="6679088">token</span><span class="op" id="6679093">.</span><span class="ident" id="6679094">File</span><span class="op" id="6679098">)</span>&nbsp;<span class="builtintype" id="6679100">bool</span>&nbsp;<span class="op" id="6679105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679109">if</span>&nbsp;<span class="ident" id="6679112">f</span><span class="op" id="6679113">.</span><span class="ident" id="6679114">Name</span><span class="op" id="6679118">(</span><span class="op" id="6679119">)</span>&nbsp;<span class="op" id="6679121">==</span>&nbsp;<span class="ident" id="6679124">filename</span>&nbsp;<span class="op" id="6679133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679138">if</span>&nbsp;<span class="ident" id="6679141">file</span>&nbsp;<span class="op" id="6679146">!=</span>&nbsp;<span class="ident" id="6679149">nil</span>&nbsp;<span class="op" id="6679153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6679159">panic</span><span class="op" id="6679164">(</span><span class="ident" id="6679165">filename</span>&nbsp;<span class="op" id="6679174">+</span>&nbsp;<span class="string" id="6679176">&#34;&nbsp;used&nbsp;multiple&nbsp;times&#34;</span><span class="op" id="6679198">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679208">file</span>&nbsp;<span class="op" id="6679213">=</span>&nbsp;<span class="ident" id="6679215">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679223">return</span>&nbsp;<span class="builtintype" id="6679230">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679236">}</span><span class="op" id="6679237">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679240">return</span>&nbsp;<span class="ident" id="6679247">file</span><br>
<span class="lineno"></span><span class="op" id="6679252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6679255">func</span>&nbsp;<span class="ident" id="6679260">getPos</span><span class="op" id="6679266">(</span><span class="ident" id="6679267">filename</span>&nbsp;<span class="builtintype" id="6679276">string</span><span class="op" id="6679282">,</span>&nbsp;<span class="ident" id="6679284">offset</span>&nbsp;<span class="builtintype" id="6679291">int</span><span class="op" id="6679294">)</span>&nbsp;<span class="ident" id="6679296">token</span><span class="op" id="6679301">.</span><span class="ident" id="6679302">Pos</span>&nbsp;<span class="op" id="6679306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679309">if</span>&nbsp;<span class="ident" id="6679312">f</span>&nbsp;<span class="op" id="6679314">:=</span>&nbsp;<span class="ident" id="6679317">getFile</span><span class="op" id="6679324">(</span><span class="ident" id="6679325">filename</span><span class="op" id="6679333">)</span><span class="op" id="6679334">;</span>&nbsp;<span class="ident" id="6679336">f</span>&nbsp;<span class="op" id="6679338">!=</span>&nbsp;<span class="ident" id="6679341">nil</span>&nbsp;<span class="op" id="6679345">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679349">return</span>&nbsp;<span class="ident" id="6679356">f</span><span class="op" id="6679357">.</span><span class="ident" id="6679358">Pos</span><span class="op" id="6679361">(</span><span class="ident" id="6679362">offset</span><span class="op" id="6679368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6679371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6679374">return</span>&nbsp;<span class="ident" id="6679381">token</span><span class="op" id="6679386">.</span><span class="ident" id="6679387">NoPos</span><br>
<span class="lineno"></span><span class="op" id="6679393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6679396">//&nbsp;ERROR&nbsp;comments&nbsp;must&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;and&nbsp;rx&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="6679461">//&nbsp;a&nbsp;regular&nbsp;expression&nbsp;that&nbsp;matches&nbsp;the&nbsp;expected&nbsp;error&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="6679526">//&nbsp;The&nbsp;special&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;HERE&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;must&nbsp;be&nbsp;used&nbsp;for&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="6679591">//&nbsp;messages&nbsp;that&nbsp;appear&nbsp;immediately&nbsp;after&nbsp;a&nbsp;token,&nbsp;rather&nbsp;than&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="6679657">//&nbsp;a&nbsp;token&#39;s&nbsp;position.</span><br>
<span class="lineno">65</span><span class="comment" id="6679680">//</span><br>
<span class="lineno"></span><span class="keyword" id="6679683">var</span>&nbsp;<span class="ident" id="6679687">errRx</span>&nbsp;<span class="op" id="6679693">=</span>&nbsp;<span class="ident" id="6679695">regexp</span><span class="op" id="6679701">.</span><span class="ident" id="6679702">MustCompile</span><span class="op" id="6679713">(</span><span class="string" id="6679714">`^/\*&nbsp;*ERROR&nbsp;*(HERE)?&nbsp;*&#34;([^&#34;]*)&#34;&nbsp;*\*/$`</span><span class="op" id="6679753">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6679756">//&nbsp;expectedErrors&nbsp;collects&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;of&nbsp;ERROR&nbsp;comments&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="6679831">//&nbsp;in&nbsp;files&nbsp;and&nbsp;returns&nbsp;them&nbsp;as&nbsp;a&nbsp;map&nbsp;of&nbsp;error&nbsp;positions&nbsp;to&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">70</span><span class="comment" id="6679907">//</span><br>
<span class="lineno"></span><span class="keyword" id="6679910">func</span>&nbsp;<span class="ident" id="6679915">expectedErrors</span><span class="op" id="6679929">(</span><span class="ident" id="6679930">t</span>&nbsp;<span class="op" id="6679932">*</span><span class="ident" id="6679933">testing</span><span class="op" id="6679940">.</span><span class="ident" id="6679941">T</span><span class="op" id="6679942">,</span>&nbsp;<span class="ident" id="6679944">filename</span>&nbsp;<span class="builtintype" id="6679953">string</span><span class="op" id="6679959">,</span>&nbsp;<span class="ident" id="6679961">src</span>&nbsp;<span class="op" id="6679965">[</span><span class="op" id="6679966">]</span><span class="builtintype" id="6679967">byte</span><span class="op" id="6679971">)</span>&nbsp;<span class="keyword" id="6679973">map</span><span class="op" id="6679976">[</span><span class="ident" id="6679977">token</span><span class="op" id="6679982">.</span><span class="ident" id="6679983">Pos</span><span class="op" id="6679986">]</span><span class="builtintype" id="6679987">string</span>&nbsp;<span class="op" id="6679994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6679997">errors</span>&nbsp;<span class="op" id="6680004">:=</span>&nbsp;<span class="builtinfunc" id="6680007">make</span><span class="op" id="6680011">(</span><span class="keyword" id="6680012">map</span><span class="op" id="6680015">[</span><span class="ident" id="6680016">token</span><span class="op" id="6680021">.</span><span class="ident" id="6680022">Pos</span><span class="op" id="6680025">]</span><span class="builtintype" id="6680026">string</span><span class="op" id="6680032">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680036">var</span>&nbsp;<span class="ident" id="6680040">s</span>&nbsp;<span class="ident" id="6680042">scanner</span><span class="op" id="6680049">.</span><span class="ident" id="6680050">Scanner</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6680059">//&nbsp;file&nbsp;was&nbsp;parsed&nbsp;already&nbsp;-&nbsp;do&nbsp;not&nbsp;add&nbsp;it&nbsp;again&nbsp;to&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6680121">//&nbsp;set&nbsp;otherwise&nbsp;the&nbsp;position&nbsp;information&nbsp;returned&nbsp;here&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6680183">//&nbsp;not&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;collected&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680246">s</span><span class="op" id="6680247">.</span><span class="ident" id="6680248">Init</span><span class="op" id="6680252">(</span><span class="ident" id="6680253">getFile</span><span class="op" id="6680260">(</span><span class="ident" id="6680261">filename</span><span class="op" id="6680269">)</span><span class="op" id="6680270">,</span>&nbsp;<span class="ident" id="6680272">src</span><span class="op" id="6680275">,</span>&nbsp;<span class="ident" id="6680277">nil</span><span class="op" id="6680280">,</span>&nbsp;<span class="ident" id="6680282">scanner</span><span class="op" id="6680289">.</span><span class="ident" id="6680290">ScanComments</span><span class="op" id="6680302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680305">var</span>&nbsp;<span class="ident" id="6680309">prev</span>&nbsp;<span class="ident" id="6680314">token</span><span class="op" id="6680319">.</span><span class="ident" id="6680320">Pos</span>&nbsp;<span class="comment" id="6680324">//&nbsp;position&nbsp;of&nbsp;last&nbsp;non-comment,&nbsp;non-semicolon&nbsp;token</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680378">var</span>&nbsp;<span class="ident" id="6680382">here</span>&nbsp;<span class="ident" id="6680387">token</span><span class="op" id="6680392">.</span><span class="ident" id="6680393">Pos</span>&nbsp;<span class="comment" id="6680397">//&nbsp;position&nbsp;immediately&nbsp;after&nbsp;the&nbsp;token&nbsp;at&nbsp;position&nbsp;prev</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680456">for</span>&nbsp;<span class="op" id="6680460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680464">pos</span><span class="op" id="6680467">,</span>&nbsp;<span class="ident" id="6680469">tok</span><span class="op" id="6680472">,</span>&nbsp;<span class="ident" id="6680474">lit</span>&nbsp;<span class="op" id="6680478">:=</span>&nbsp;<span class="ident" id="6680481">s</span><span class="op" id="6680482">.</span><span class="ident" id="6680483">Scan</span><span class="op" id="6680487">(</span><span class="op" id="6680488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680492">switch</span>&nbsp;<span class="ident" id="6680499">tok</span>&nbsp;<span class="op" id="6680503">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680507">case</span>&nbsp;<span class="ident" id="6680512">token</span><span class="op" id="6680517">.</span><span class="ident" id="6680518">EOF</span><span class="op" id="6680521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680526">return</span>&nbsp;<span class="ident" id="6680533">errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680542">case</span>&nbsp;<span class="ident" id="6680547">token</span><span class="op" id="6680552">.</span><span class="ident" id="6680553">COMMENT</span><span class="op" id="6680560">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680565">s</span>&nbsp;<span class="op" id="6680567">:=</span>&nbsp;<span class="ident" id="6680570">errRx</span><span class="op" id="6680575">.</span><span class="ident" id="6680576">FindStringSubmatch</span><span class="op" id="6680594">(</span><span class="ident" id="6680595">lit</span><span class="op" id="6680598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680603">if</span>&nbsp;<span class="builtinfunc" id="6680606">len</span><span class="op" id="6680609">(</span><span class="ident" id="6680610">s</span><span class="op" id="6680611">)</span>&nbsp;<span class="op" id="6680613">==</span>&nbsp;<span class="num" id="6680616">3</span>&nbsp;<span class="op" id="6680618">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680624">pos</span>&nbsp;<span class="op" id="6680628">:=</span>&nbsp;<span class="ident" id="6680631">prev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680640">if</span>&nbsp;<span class="ident" id="6680643">s</span><span class="op" id="6680644">[</span><span class="num" id="6680645">1</span><span class="op" id="6680646">]</span>&nbsp;<span class="op" id="6680648">==</span>&nbsp;<span class="string" id="6680651">&#34;HERE&#34;</span>&nbsp;<span class="op" id="6680658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680665">pos</span>&nbsp;<span class="op" id="6680669">=</span>&nbsp;<span class="ident" id="6680671">here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680686">errors</span><span class="op" id="6680692">[</span><span class="ident" id="6680693">pos</span><span class="op" id="6680696">]</span>&nbsp;<span class="op" id="6680698">=</span>&nbsp;<span class="builtintype" id="6680700">string</span><span class="op" id="6680706">(</span><span class="ident" id="6680707">s</span><span class="op" id="6680708">[</span><span class="num" id="6680709">2</span><span class="op" id="6680710">]</span><span class="op" id="6680711">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680720">default</span><span class="op" id="6680727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680732">prev</span>&nbsp;<span class="op" id="6680737">=</span>&nbsp;<span class="ident" id="6680739">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680746">var</span>&nbsp;<span class="ident" id="6680750">l</span>&nbsp;<span class="builtintype" id="6680752">int</span>&nbsp;<span class="comment" id="6680756">//&nbsp;token&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6680775">if</span>&nbsp;<span class="ident" id="6680778">tok</span><span class="op" id="6680781">.</span><span class="ident" id="6680782">IsLiteral</span><span class="op" id="6680791">(</span><span class="op" id="6680792">)</span>&nbsp;<span class="op" id="6680794">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680800">l</span>&nbsp;<span class="op" id="6680802">=</span>&nbsp;<span class="builtinfunc" id="6680804">len</span><span class="op" id="6680807">(</span><span class="ident" id="6680808">lit</span><span class="op" id="6680811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680816">}</span>&nbsp;<span class="keyword" id="6680818">else</span>&nbsp;<span class="op" id="6680823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680829">l</span>&nbsp;<span class="op" id="6680831">=</span>&nbsp;<span class="builtinfunc" id="6680833">len</span><span class="op" id="6680836">(</span><span class="ident" id="6680837">tok</span><span class="op" id="6680840">.</span><span class="ident" id="6680841">String</span><span class="op" id="6680847">(</span><span class="op" id="6680848">)</span><span class="op" id="6680849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6680859">here</span>&nbsp;<span class="op" id="6680864">=</span>&nbsp;<span class="ident" id="6680866">prev</span>&nbsp;<span class="op" id="6680871">+</span>&nbsp;<span class="ident" id="6680873">token</span><span class="op" id="6680878">.</span><span class="ident" id="6680879">Pos</span><span class="op" id="6680882">(</span><span class="ident" id="6680883">l</span><span class="op" id="6680884">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6680891">}</span><br>
<span class="lineno"></span><span class="op" id="6680893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6680896">//&nbsp;compareErrors&nbsp;compares&nbsp;the&nbsp;map&nbsp;of&nbsp;expected&nbsp;error&nbsp;messages&nbsp;with&nbsp;the&nbsp;list</span><br>
<span class="lineno">110</span><span class="comment" id="6680971">//&nbsp;of&nbsp;found&nbsp;errors&nbsp;and&nbsp;reports&nbsp;discrepancies.</span><br>
<span class="lineno"></span><span class="comment" id="6681017">//</span><br>
<span class="lineno"></span><span class="keyword" id="6681020">func</span>&nbsp;<span class="ident" id="6681025">compareErrors</span><span class="op" id="6681038">(</span><span class="ident" id="6681039">t</span>&nbsp;<span class="op" id="6681041">*</span><span class="ident" id="6681042">testing</span><span class="op" id="6681049">.</span><span class="ident" id="6681050">T</span><span class="op" id="6681051">,</span>&nbsp;<span class="ident" id="6681053">expected</span>&nbsp;<span class="keyword" id="6681062">map</span><span class="op" id="6681065">[</span><span class="ident" id="6681066">token</span><span class="op" id="6681071">.</span><span class="ident" id="6681072">Pos</span><span class="op" id="6681075">]</span><span class="builtintype" id="6681076">string</span><span class="op" id="6681082">,</span>&nbsp;<span class="ident" id="6681084">found</span>&nbsp;<span class="ident" id="6681090">scanner</span><span class="op" id="6681097">.</span><span class="ident" id="6681098">ErrorList</span><span class="op" id="6681107">)</span>&nbsp;<span class="op" id="6681109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681112">for</span>&nbsp;<span class="ident" id="6681116">_</span><span class="op" id="6681117">,</span>&nbsp;<span class="builtintype" id="6681119">error</span>&nbsp;<span class="op" id="6681125">:=</span>&nbsp;<span class="keyword" id="6681128">range</span>&nbsp;<span class="ident" id="6681134">found</span>&nbsp;<span class="op" id="6681140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6681144">//&nbsp;error.Pos&nbsp;is&nbsp;a&nbsp;token.Position,&nbsp;but&nbsp;we&nbsp;want</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6681192">//&nbsp;a&nbsp;token.Pos&nbsp;so&nbsp;we&nbsp;can&nbsp;do&nbsp;a&nbsp;map&nbsp;lookup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681235">pos</span>&nbsp;<span class="op" id="6681239">:=</span>&nbsp;<span class="ident" id="6681242">getPos</span><span class="op" id="6681248">(</span><span class="builtintype" id="6681249">error</span><span class="op" id="6681254">.</span><span class="ident" id="6681255">Pos</span><span class="op" id="6681258">.</span><span class="ident" id="6681259">Filename</span><span class="op" id="6681267">,</span>&nbsp;<span class="builtintype" id="6681269">error</span><span class="op" id="6681274">.</span><span class="ident" id="6681275">Pos</span><span class="op" id="6681278">.</span><span class="ident" id="6681279">Offset</span><span class="op" id="6681285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681289">if</span>&nbsp;<span class="ident" id="6681292">msg</span><span class="op" id="6681295">,</span>&nbsp;<span class="ident" id="6681297">found</span>&nbsp;<span class="op" id="6681303">:=</span>&nbsp;<span class="ident" id="6681306">expected</span><span class="op" id="6681314">[</span><span class="ident" id="6681315">pos</span><span class="op" id="6681318">]</span><span class="op" id="6681319">;</span>&nbsp;<span class="ident" id="6681321">found</span>&nbsp;<span class="op" id="6681327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6681332">//&nbsp;we&nbsp;expect&nbsp;a&nbsp;message&nbsp;at&nbsp;pos;&nbsp;check&nbsp;if&nbsp;it&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681386">rx</span><span class="op" id="6681388">,</span>&nbsp;<span class="ident" id="6681390">err</span>&nbsp;<span class="op" id="6681394">:=</span>&nbsp;<span class="ident" id="6681397">regexp</span><span class="op" id="6681403">.</span><span class="ident" id="6681404">Compile</span><span class="op" id="6681411">(</span><span class="ident" id="6681412">msg</span><span class="op" id="6681415">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681420">if</span>&nbsp;<span class="ident" id="6681423">err</span>&nbsp;<span class="op" id="6681427">!=</span>&nbsp;<span class="ident" id="6681430">nil</span>&nbsp;<span class="op" id="6681434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681440">t</span><span class="op" id="6681441">.</span><span class="ident" id="6681442">Errorf</span><span class="op" id="6681448">(</span><span class="string" id="6681449">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="6681457">,</span>&nbsp;<span class="builtintype" id="6681459">error</span><span class="op" id="6681464">.</span><span class="ident" id="6681465">Pos</span><span class="op" id="6681468">,</span>&nbsp;<span class="ident" id="6681470">err</span><span class="op" id="6681473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681479">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681496">if</span>&nbsp;<span class="ident" id="6681499">match</span>&nbsp;<span class="op" id="6681505">:=</span>&nbsp;<span class="ident" id="6681508">rx</span><span class="op" id="6681510">.</span><span class="ident" id="6681511">MatchString</span><span class="op" id="6681522">(</span><span class="builtintype" id="6681523">error</span><span class="op" id="6681528">.</span><span class="ident" id="6681529">Msg</span><span class="op" id="6681532">)</span><span class="op" id="6681533">;</span>&nbsp;<span class="op" id="6681535">!</span><span class="ident" id="6681536">match</span>&nbsp;<span class="op" id="6681542">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681548">t</span><span class="op" id="6681549">.</span><span class="ident" id="6681550">Errorf</span><span class="op" id="6681556">(</span><span class="string" id="6681557">&#34;%s:&nbsp;%q&nbsp;does&nbsp;not&nbsp;match&nbsp;%q&#34;</span><span class="op" id="6681583">,</span>&nbsp;<span class="builtintype" id="6681585">error</span><span class="op" id="6681590">.</span><span class="ident" id="6681591">Pos</span><span class="op" id="6681594">,</span>&nbsp;<span class="builtintype" id="6681596">error</span><span class="op" id="6681601">.</span><span class="ident" id="6681602">Msg</span><span class="op" id="6681605">,</span>&nbsp;<span class="ident" id="6681607">msg</span><span class="op" id="6681610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6681616">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6681633">//&nbsp;we&nbsp;have&nbsp;a&nbsp;match&nbsp;-&nbsp;eliminate&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6681678">delete</span><span class="op" id="6681684">(</span><span class="ident" id="6681685">expected</span><span class="op" id="6681693">,</span>&nbsp;<span class="ident" id="6681695">pos</span><span class="op" id="6681698">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6681702">}</span>&nbsp;<span class="keyword" id="6681704">else</span>&nbsp;<span class="op" id="6681709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6681714">//&nbsp;To&nbsp;keep&nbsp;in&nbsp;mind&nbsp;when&nbsp;analyzing&nbsp;failed&nbsp;test&nbsp;output:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6681771">//&nbsp;If&nbsp;the&nbsp;same&nbsp;error&nbsp;position&nbsp;occurs&nbsp;multiple&nbsp;times&nbsp;in&nbsp;errors,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6681837">//&nbsp;this&nbsp;message&nbsp;will&nbsp;be&nbsp;triggered&nbsp;(because&nbsp;the&nbsp;first&nbsp;error&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6681902">//&nbsp;the&nbsp;position&nbsp;removes&nbsp;this&nbsp;position&nbsp;from&nbsp;the&nbsp;expected&nbsp;errors).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6681970">t</span><span class="op" id="6681971">.</span><span class="ident" id="6681972">Errorf</span><span class="op" id="6681978">(</span><span class="string" id="6681979">&#34;%s:&nbsp;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6682005">,</span>&nbsp;<span class="builtintype" id="6682007">error</span><span class="op" id="6682012">.</span><span class="ident" id="6682013">Pos</span><span class="op" id="6682016">,</span>&nbsp;<span class="builtintype" id="6682018">error</span><span class="op" id="6682023">.</span><span class="ident" id="6682024">Msg</span><span class="op" id="6682027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6682038">//&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;expected&nbsp;errors&nbsp;left</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682082">if</span>&nbsp;<span class="builtinfunc" id="6682085">len</span><span class="op" id="6682088">(</span><span class="ident" id="6682089">expected</span><span class="op" id="6682097">)</span>&nbsp;<span class="op" id="6682099">&gt;</span>&nbsp;<span class="num" id="6682101">0</span>&nbsp;<span class="op" id="6682103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682107">t</span><span class="op" id="6682108">.</span><span class="ident" id="6682109">Errorf</span><span class="op" id="6682115">(</span><span class="string" id="6682116">&#34;%d&nbsp;errors&nbsp;not&nbsp;reported:&#34;</span><span class="op" id="6682141">,</span>&nbsp;<span class="builtinfunc" id="6682143">len</span><span class="op" id="6682146">(</span><span class="ident" id="6682147">expected</span><span class="op" id="6682155">)</span><span class="op" id="6682156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682160">for</span>&nbsp;<span class="ident" id="6682164">pos</span><span class="op" id="6682167">,</span>&nbsp;<span class="ident" id="6682169">msg</span>&nbsp;<span class="op" id="6682173">:=</span>&nbsp;<span class="keyword" id="6682176">range</span>&nbsp;<span class="ident" id="6682182">expected</span>&nbsp;<span class="op" id="6682191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682196">t</span><span class="op" id="6682197">.</span><span class="ident" id="6682198">Errorf</span><span class="op" id="6682204">(</span><span class="string" id="6682205">&#34;%s:&nbsp;%s\n&#34;</span><span class="op" id="6682215">,</span>&nbsp;<span class="ident" id="6682217">fsetErrs</span><span class="op" id="6682225">.</span><span class="ident" id="6682226">Position</span><span class="op" id="6682234">(</span><span class="ident" id="6682235">pos</span><span class="op" id="6682238">)</span><span class="op" id="6682239">,</span>&nbsp;<span class="ident" id="6682241">msg</span><span class="op" id="6682244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682248">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682251">}</span><br>
<span class="lineno"></span><span class="op" id="6682253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6682256">func</span>&nbsp;<span class="ident" id="6682261">checkErrors</span><span class="op" id="6682272">(</span><span class="ident" id="6682273">t</span>&nbsp;<span class="op" id="6682275">*</span><span class="ident" id="6682276">testing</span><span class="op" id="6682283">.</span><span class="ident" id="6682284">T</span><span class="op" id="6682285">,</span>&nbsp;<span class="ident" id="6682287">filename</span>&nbsp;<span class="builtintype" id="6682296">string</span><span class="op" id="6682302">,</span>&nbsp;<span class="ident" id="6682304">input</span>&nbsp;<span class="keyword" id="6682310">interface</span><span class="op" id="6682319">{</span><span class="op" id="6682320">}</span><span class="op" id="6682321">)</span>&nbsp;<span class="op" id="6682323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682326">src</span><span class="op" id="6682329">,</span>&nbsp;<span class="ident" id="6682331">err</span>&nbsp;<span class="op" id="6682335">:=</span>&nbsp;<span class="ident" id="6682338">readSource</span><span class="op" id="6682348">(</span><span class="ident" id="6682349">filename</span><span class="op" id="6682357">,</span>&nbsp;<span class="ident" id="6682359">input</span><span class="op" id="6682364">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682367">if</span>&nbsp;<span class="ident" id="6682370">err</span>&nbsp;<span class="op" id="6682374">!=</span>&nbsp;<span class="ident" id="6682377">nil</span>&nbsp;<span class="op" id="6682381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682385">t</span><span class="op" id="6682386">.</span><span class="ident" id="6682387">Error</span><span class="op" id="6682392">(</span><span class="ident" id="6682393">err</span><span class="op" id="6682396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682400">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682412">_</span><span class="op" id="6682413">,</span>&nbsp;<span class="ident" id="6682415">err</span>&nbsp;<span class="op" id="6682419">=</span>&nbsp;<span class="ident" id="6682421">ParseFile</span><span class="op" id="6682430">(</span><span class="ident" id="6682431">fsetErrs</span><span class="op" id="6682439">,</span>&nbsp;<span class="ident" id="6682441">filename</span><span class="op" id="6682449">,</span>&nbsp;<span class="ident" id="6682451">src</span><span class="op" id="6682454">,</span>&nbsp;<span class="ident" id="6682456">DeclarationErrors</span><span class="op" id="6682473">|</span><span class="ident" id="6682474">AllErrors</span><span class="op" id="6682483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682486">found</span><span class="op" id="6682491">,</span>&nbsp;<span class="ident" id="6682493">ok</span>&nbsp;<span class="op" id="6682496">:=</span>&nbsp;<span class="ident" id="6682499">err</span><span class="op" id="6682502">.</span><span class="op" id="6682503">(</span><span class="ident" id="6682504">scanner</span><span class="op" id="6682511">.</span><span class="ident" id="6682512">ErrorList</span><span class="op" id="6682521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682524">if</span>&nbsp;<span class="ident" id="6682527">err</span>&nbsp;<span class="op" id="6682531">!=</span>&nbsp;<span class="ident" id="6682534">nil</span>&nbsp;<span class="op" id="6682538">&amp;&amp;</span>&nbsp;<span class="op" id="6682541">!</span><span class="ident" id="6682542">ok</span>&nbsp;<span class="op" id="6682545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682549">t</span><span class="op" id="6682550">.</span><span class="ident" id="6682551">Error</span><span class="op" id="6682556">(</span><span class="ident" id="6682557">err</span><span class="op" id="6682560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682564">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682575">found</span><span class="op" id="6682580">.</span><span class="ident" id="6682581">RemoveMultiples</span><span class="op" id="6682596">(</span><span class="op" id="6682597">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6682601">//&nbsp;we&nbsp;are&nbsp;expecting&nbsp;the&nbsp;following&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6682643">//&nbsp;(collect&nbsp;these&nbsp;after&nbsp;parsing&nbsp;a&nbsp;file&nbsp;so&nbsp;that&nbsp;it&nbsp;is&nbsp;found&nbsp;in&nbsp;the&nbsp;file&nbsp;set)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682720">expected</span>&nbsp;<span class="op" id="6682729">:=</span>&nbsp;<span class="ident" id="6682732">expectedErrors</span><span class="op" id="6682746">(</span><span class="ident" id="6682747">t</span><span class="op" id="6682748">,</span>&nbsp;<span class="ident" id="6682750">filename</span><span class="op" id="6682758">,</span>&nbsp;<span class="ident" id="6682760">src</span><span class="op" id="6682763">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6682767">//&nbsp;verify&nbsp;errors&nbsp;returned&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682808">compareErrors</span><span class="op" id="6682821">(</span><span class="ident" id="6682822">t</span><span class="op" id="6682823">,</span>&nbsp;<span class="ident" id="6682825">expected</span><span class="op" id="6682833">,</span>&nbsp;<span class="ident" id="6682835">found</span><span class="op" id="6682840">)</span><br>
<span class="lineno"></span><span class="op" id="6682842">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6682845">func</span>&nbsp;<span class="ident" id="6682850">TestErrors</span><span class="op" id="6682860">(</span><span class="ident" id="6682861">t</span>&nbsp;<span class="op" id="6682863">*</span><span class="ident" id="6682864">testing</span><span class="op" id="6682871">.</span><span class="ident" id="6682872">T</span><span class="op" id="6682873">)</span>&nbsp;<span class="op" id="6682875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682878">list</span><span class="op" id="6682882">,</span>&nbsp;<span class="ident" id="6682884">err</span>&nbsp;<span class="op" id="6682888">:=</span>&nbsp;<span class="ident" id="6682891">ioutil</span><span class="op" id="6682897">.</span><span class="ident" id="6682898">ReadDir</span><span class="op" id="6682905">(</span><span class="ident" id="6682906">testdata</span><span class="op" id="6682914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682917">if</span>&nbsp;<span class="ident" id="6682920">err</span>&nbsp;<span class="op" id="6682924">!=</span>&nbsp;<span class="ident" id="6682927">nil</span>&nbsp;<span class="op" id="6682931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682935">t</span><span class="op" id="6682936">.</span><span class="ident" id="6682937">Fatal</span><span class="op" id="6682942">(</span><span class="ident" id="6682943">err</span><span class="op" id="6682946">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6682949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6682952">for</span>&nbsp;<span class="ident" id="6682956">_</span><span class="op" id="6682957">,</span>&nbsp;<span class="ident" id="6682959">fi</span>&nbsp;<span class="op" id="6682962">:=</span>&nbsp;<span class="keyword" id="6682965">range</span>&nbsp;<span class="ident" id="6682971">list</span>&nbsp;<span class="op" id="6682976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6682980">name</span>&nbsp;<span class="op" id="6682985">:=</span>&nbsp;<span class="ident" id="6682988">fi</span><span class="op" id="6682990">.</span><span class="ident" id="6682991">Name</span><span class="op" id="6682995">(</span><span class="op" id="6682996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6683000">if</span>&nbsp;<span class="op" id="6683003">!</span><span class="ident" id="6683004">fi</span><span class="op" id="6683006">.</span><span class="ident" id="6683007">IsDir</span><span class="op" id="6683012">(</span><span class="op" id="6683013">)</span>&nbsp;<span class="op" id="6683015">&amp;&amp;</span>&nbsp;<span class="op" id="6683018">!</span><span class="ident" id="6683019">strings</span><span class="op" id="6683026">.</span><span class="ident" id="6683027">HasPrefix</span><span class="op" id="6683036">(</span><span class="ident" id="6683037">name</span><span class="op" id="6683041">,</span>&nbsp;<span class="string" id="6683043">&#34;.&#34;</span><span class="op" id="6683046">)</span>&nbsp;<span class="op" id="6683048">&amp;&amp;</span>&nbsp;<span class="ident" id="6683051">strings</span><span class="op" id="6683058">.</span><span class="ident" id="6683059">HasSuffix</span><span class="op" id="6683068">(</span><span class="ident" id="6683069">name</span><span class="op" id="6683073">,</span>&nbsp;<span class="string" id="6683075">&#34;.src&#34;</span><span class="op" id="6683081">)</span>&nbsp;<span class="op" id="6683083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6683088">checkErrors</span><span class="op" id="6683099">(</span><span class="ident" id="6683100">t</span><span class="op" id="6683101">,</span>&nbsp;<span class="ident" id="6683103">filepath</span><span class="op" id="6683111">.</span><span class="ident" id="6683112">Join</span><span class="op" id="6683116">(</span><span class="ident" id="6683117">testdata</span><span class="op" id="6683125">,</span>&nbsp;<span class="ident" id="6683127">name</span><span class="op" id="6683131">)</span><span class="op" id="6683132">,</span>&nbsp;<span class="ident" id="6683134">nil</span><span class="op" id="6683137">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6683144">}</span><br>
<span class="lineno"></span><span class="op" id="6683146">}</span>
</div>
</body>
</html>
