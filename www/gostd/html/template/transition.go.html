<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5495845">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5495900">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5495954">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5496005">package</span>&nbsp;<span class="ident" id="5496013">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5496023">import</span>&nbsp;<span class="op" id="5496030">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5496033">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5496042">&#34;strings&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5496052">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5496055">//&nbsp;transitionFunc&nbsp;is&nbsp;the&nbsp;array&nbsp;of&nbsp;context&nbsp;transition&nbsp;functions&nbsp;for&nbsp;text&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="5496134">//&nbsp;A&nbsp;transition&nbsp;function&nbsp;takes&nbsp;a&nbsp;context&nbsp;and&nbsp;template&nbsp;text&nbsp;input,&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5496212">//&nbsp;the&nbsp;updated&nbsp;context&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;consumed&nbsp;from&nbsp;the&nbsp;front&nbsp;of&nbsp;the</span><br>
<span class="lineno">15</span><span class="comment" id="5496290">//&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5496300">var</span>&nbsp;<span class="ident" id="5496304">transitionFunc</span>&nbsp;<span class="op" id="5496319">=</span>&nbsp;<span class="op" id="5496321">[</span><span class="op" id="5496322">...</span><span class="op" id="5496325">]</span><span class="keyword" id="5496326">func</span><span class="op" id="5496330">(</span><span class="ident" id="5496331">context</span><span class="op" id="5496338">,</span>&nbsp;<span class="op" id="5496340">[</span><span class="op" id="5496341">]</span><span class="builtintype" id="5496342">byte</span><span class="op" id="5496346">)</span>&nbsp;<span class="op" id="5496348">(</span><span class="ident" id="5496349">context</span><span class="op" id="5496356">,</span>&nbsp;<span class="builtintype" id="5496358">int</span><span class="op" id="5496361">)</span><span class="op" id="5496362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496365">stateText</span><span class="op" id="5496374">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496383">tText</span><span class="op" id="5496388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496391">stateTag</span><span class="op" id="5496399">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496409">tTag</span><span class="op" id="5496413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496416">stateAttrName</span><span class="op" id="5496429">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496434">tAttrName</span><span class="op" id="5496443">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496446">stateAfterName</span><span class="op" id="5496460">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5496464">tAfterName</span><span class="op" id="5496474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496477">stateBeforeValue</span><span class="op" id="5496493">:</span>&nbsp;<span class="ident" id="5496495">tBeforeValue</span><span class="op" id="5496507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496510">stateHTMLCmt</span><span class="op" id="5496522">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496528">tHTMLCmt</span><span class="op" id="5496536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496539">stateRCDATA</span><span class="op" id="5496550">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496557">tSpecialTagEnd</span><span class="op" id="5496571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496574">stateAttr</span><span class="op" id="5496583">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496592">tAttr</span><span class="op" id="5496597">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496600">stateURL</span><span class="op" id="5496608">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496618">tURL</span><span class="op" id="5496622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496625">stateJS</span><span class="op" id="5496632">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496643">tJS</span><span class="op" id="5496646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496649">stateJSDqStr</span><span class="op" id="5496661">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496667">tJSDelimited</span><span class="op" id="5496679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496682">stateJSSqStr</span><span class="op" id="5496694">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496700">tJSDelimited</span><span class="op" id="5496712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496715">stateJSRegexp</span><span class="op" id="5496728">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496733">tJSDelimited</span><span class="op" id="5496745">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496748">stateJSBlockCmt</span><span class="op" id="5496763">:</span>&nbsp;&nbsp;<span class="ident" id="5496766">tBlockCmt</span><span class="op" id="5496775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496778">stateJSLineCmt</span><span class="op" id="5496792">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5496796">tLineCmt</span><span class="op" id="5496804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496807">stateCSS</span><span class="op" id="5496815">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496825">tCSS</span><span class="op" id="5496829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496832">stateCSSDqStr</span><span class="op" id="5496845">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496850">tCSSStr</span><span class="op" id="5496857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496860">stateCSSSqStr</span><span class="op" id="5496873">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496878">tCSSStr</span><span class="op" id="5496885">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496888">stateCSSDqURL</span><span class="op" id="5496901">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496906">tCSSStr</span><span class="op" id="5496913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496916">stateCSSSqURL</span><span class="op" id="5496929">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496934">tCSSStr</span><span class="op" id="5496941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496944">stateCSSURL</span><span class="op" id="5496955">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496962">tCSSStr</span><span class="op" id="5496969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5496972">stateCSSBlockCmt</span><span class="op" id="5496988">:</span>&nbsp;<span class="ident" id="5496990">tBlockCmt</span><span class="op" id="5496999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497002">stateCSSLineCmt</span><span class="op" id="5497017">:</span>&nbsp;&nbsp;<span class="ident" id="5497020">tLineCmt</span><span class="op" id="5497028">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497031">stateError</span><span class="op" id="5497041">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497049">tError</span><span class="op" id="5497055">,</span><br>
<span class="lineno"></span><span class="op" id="5497057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5497060">var</span>&nbsp;<span class="ident" id="5497064">commentStart</span>&nbsp;<span class="op" id="5497077">=</span>&nbsp;<span class="op" id="5497079">[</span><span class="op" id="5497080">]</span><span class="builtintype" id="5497081">byte</span><span class="op" id="5497085">(</span><span class="string" id="5497086">&#34;&lt;!--&#34;</span><span class="op" id="5497092">)</span><br>
<span class="lineno"></span><span class="keyword" id="5497094">var</span>&nbsp;<span class="ident" id="5497098">commentEnd</span>&nbsp;<span class="op" id="5497109">=</span>&nbsp;<span class="op" id="5497111">[</span><span class="op" id="5497112">]</span><span class="builtintype" id="5497113">byte</span><span class="op" id="5497117">(</span><span class="string" id="5497118">&#34;--&gt;&#34;</span><span class="op" id="5497123">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5497126">//&nbsp;tText&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;text&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5497190">func</span>&nbsp;<span class="ident" id="5497195">tText</span><span class="op" id="5497200">(</span><span class="ident" id="5497201">c</span>&nbsp;<span class="ident" id="5497203">context</span><span class="op" id="5497210">,</span>&nbsp;<span class="ident" id="5497212">s</span>&nbsp;<span class="op" id="5497214">[</span><span class="op" id="5497215">]</span><span class="builtintype" id="5497216">byte</span><span class="op" id="5497220">)</span>&nbsp;<span class="op" id="5497222">(</span><span class="ident" id="5497223">context</span><span class="op" id="5497230">,</span>&nbsp;<span class="builtintype" id="5497232">int</span><span class="op" id="5497235">)</span>&nbsp;<span class="op" id="5497237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497240">k</span>&nbsp;<span class="op" id="5497242">:=</span>&nbsp;<span class="num" id="5497245">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497248">for</span>&nbsp;<span class="op" id="5497252">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497256">i</span>&nbsp;<span class="op" id="5497258">:=</span>&nbsp;<span class="ident" id="5497261">k</span>&nbsp;<span class="op" id="5497263">+</span>&nbsp;<span class="ident" id="5497265">bytes</span><span class="op" id="5497270">.</span><span class="ident" id="5497271">IndexByte</span><span class="op" id="5497280">(</span><span class="ident" id="5497281">s</span><span class="op" id="5497282">[</span><span class="ident" id="5497283">k</span><span class="op" id="5497284">:</span><span class="op" id="5497285">]</span><span class="op" id="5497286">,</span>&nbsp;<span class="string" id="5497288">&#39;&lt;&#39;</span><span class="op" id="5497291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497295">if</span>&nbsp;<span class="ident" id="5497298">i</span>&nbsp;<span class="op" id="5497300">&lt;</span>&nbsp;<span class="ident" id="5497302">k</span>&nbsp;<span class="op" id="5497304">||</span>&nbsp;<span class="ident" id="5497307">i</span><span class="op" id="5497308">+</span><span class="num" id="5497309">1</span>&nbsp;<span class="op" id="5497311">==</span>&nbsp;<span class="builtinfunc" id="5497314">len</span><span class="op" id="5497317">(</span><span class="ident" id="5497318">s</span><span class="op" id="5497319">)</span>&nbsp;<span class="op" id="5497321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497326">return</span>&nbsp;<span class="ident" id="5497333">c</span><span class="op" id="5497334">,</span>&nbsp;<span class="builtinfunc" id="5497336">len</span><span class="op" id="5497339">(</span><span class="ident" id="5497340">s</span><span class="op" id="5497341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497345">}</span>&nbsp;<span class="keyword" id="5497347">else</span>&nbsp;<span class="keyword" id="5497352">if</span>&nbsp;<span class="ident" id="5497355">i</span><span class="op" id="5497356">+</span><span class="num" id="5497357">4</span>&nbsp;<span class="op" id="5497359">&lt;=</span>&nbsp;<span class="builtinfunc" id="5497362">len</span><span class="op" id="5497365">(</span><span class="ident" id="5497366">s</span><span class="op" id="5497367">)</span>&nbsp;<span class="op" id="5497369">&amp;&amp;</span>&nbsp;<span class="ident" id="5497372">bytes</span><span class="op" id="5497377">.</span><span class="ident" id="5497378">Equal</span><span class="op" id="5497383">(</span><span class="ident" id="5497384">commentStart</span><span class="op" id="5497396">,</span>&nbsp;<span class="ident" id="5497398">s</span><span class="op" id="5497399">[</span><span class="ident" id="5497400">i</span><span class="op" id="5497401">:</span><span class="ident" id="5497402">i</span><span class="op" id="5497403">+</span><span class="num" id="5497404">4</span><span class="op" id="5497405">]</span><span class="op" id="5497406">)</span>&nbsp;<span class="op" id="5497408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497413">return</span>&nbsp;<span class="ident" id="5497420">context</span><span class="op" id="5497427">{</span><span class="ident" id="5497428">state</span><span class="op" id="5497433">:</span>&nbsp;<span class="ident" id="5497435">stateHTMLCmt</span><span class="op" id="5497447">}</span><span class="op" id="5497448">,</span>&nbsp;<span class="ident" id="5497450">i</span>&nbsp;<span class="op" id="5497452">+</span>&nbsp;<span class="num" id="5497454">4</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497462">i</span><span class="op" id="5497463">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497468">end</span>&nbsp;<span class="op" id="5497472">:=</span>&nbsp;<span class="builtintype" id="5497475">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497483">if</span>&nbsp;<span class="ident" id="5497486">s</span><span class="op" id="5497487">[</span><span class="ident" id="5497488">i</span><span class="op" id="5497489">]</span>&nbsp;<span class="op" id="5497491">==</span>&nbsp;<span class="string" id="5497494">&#39;/&#39;</span>&nbsp;<span class="op" id="5497498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497503">if</span>&nbsp;<span class="ident" id="5497506">i</span><span class="op" id="5497507">+</span><span class="num" id="5497508">1</span>&nbsp;<span class="op" id="5497510">==</span>&nbsp;<span class="builtinfunc" id="5497513">len</span><span class="op" id="5497516">(</span><span class="ident" id="5497517">s</span><span class="op" id="5497518">)</span>&nbsp;<span class="op" id="5497520">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497526">return</span>&nbsp;<span class="ident" id="5497533">c</span><span class="op" id="5497534">,</span>&nbsp;<span class="builtinfunc" id="5497536">len</span><span class="op" id="5497539">(</span><span class="ident" id="5497540">s</span><span class="op" id="5497541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497551">end</span><span class="op" id="5497554">,</span>&nbsp;<span class="ident" id="5497556">i</span>&nbsp;<span class="op" id="5497558">=</span>&nbsp;<span class="builtintype" id="5497560">true</span><span class="op" id="5497564">,</span>&nbsp;<span class="ident" id="5497566">i</span><span class="op" id="5497567">+</span><span class="num" id="5497568">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497576">j</span><span class="op" id="5497577">,</span>&nbsp;<span class="ident" id="5497579">e</span>&nbsp;<span class="op" id="5497581">:=</span>&nbsp;<span class="ident" id="5497584">eatTagName</span><span class="op" id="5497594">(</span><span class="ident" id="5497595">s</span><span class="op" id="5497596">,</span>&nbsp;<span class="ident" id="5497598">i</span><span class="op" id="5497599">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497603">if</span>&nbsp;<span class="ident" id="5497606">j</span>&nbsp;<span class="op" id="5497608">!=</span>&nbsp;<span class="ident" id="5497611">i</span>&nbsp;<span class="op" id="5497613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497618">if</span>&nbsp;<span class="ident" id="5497621">end</span>&nbsp;<span class="op" id="5497625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497631">e</span>&nbsp;<span class="op" id="5497633">=</span>&nbsp;<span class="ident" id="5497635">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497655">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5497686">return</span>&nbsp;<span class="ident" id="5497693">context</span><span class="op" id="5497700">{</span><span class="ident" id="5497701">state</span><span class="op" id="5497706">:</span>&nbsp;<span class="ident" id="5497708">stateTag</span><span class="op" id="5497716">,</span>&nbsp;<span class="ident" id="5497718">element</span><span class="op" id="5497725">:</span>&nbsp;<span class="ident" id="5497727">e</span><span class="op" id="5497728">}</span><span class="op" id="5497729">,</span>&nbsp;<span class="ident" id="5497731">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497739">k</span>&nbsp;<span class="op" id="5497741">=</span>&nbsp;<span class="ident" id="5497743">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5497746">}</span><br>
<span class="lineno"></span><span class="op" id="5497748">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="5497751">var</span>&nbsp;<span class="ident" id="5497755">elementContentType</span>&nbsp;<span class="op" id="5497774">=</span>&nbsp;<span class="op" id="5497776">[</span><span class="op" id="5497777">...</span><span class="op" id="5497780">]</span><span class="ident" id="5497781">state</span><span class="op" id="5497786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497789">elementNone</span><span class="op" id="5497800">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497806">stateText</span><span class="op" id="5497815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497818">elementScript</span><span class="op" id="5497831">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5497835">stateJS</span><span class="op" id="5497842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497845">elementStyle</span><span class="op" id="5497857">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497862">stateCSS</span><span class="op" id="5497870">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497873">elementTextarea</span><span class="op" id="5497888">:</span>&nbsp;<span class="ident" id="5497890">stateRCDATA</span><span class="op" id="5497901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497904">elementTitle</span><span class="op" id="5497916">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497921">stateRCDATA</span><span class="op" id="5497932">,</span><br>
<span class="lineno"></span><span class="op" id="5497934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5497937">//&nbsp;tTag&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;tag&nbsp;state.</span><br>
<span class="lineno">85</span><span class="keyword" id="5497999">func</span>&nbsp;<span class="ident" id="5498004">tTag</span><span class="op" id="5498008">(</span><span class="ident" id="5498009">c</span>&nbsp;<span class="ident" id="5498011">context</span><span class="op" id="5498018">,</span>&nbsp;<span class="ident" id="5498020">s</span>&nbsp;<span class="op" id="5498022">[</span><span class="op" id="5498023">]</span><span class="builtintype" id="5498024">byte</span><span class="op" id="5498028">)</span>&nbsp;<span class="op" id="5498030">(</span><span class="ident" id="5498031">context</span><span class="op" id="5498038">,</span>&nbsp;<span class="builtintype" id="5498040">int</span><span class="op" id="5498043">)</span>&nbsp;<span class="op" id="5498045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498048">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498077">i</span>&nbsp;<span class="op" id="5498079">:=</span>&nbsp;<span class="ident" id="5498082">eatWhiteSpace</span><span class="op" id="5498095">(</span><span class="ident" id="5498096">s</span><span class="op" id="5498097">,</span>&nbsp;<span class="num" id="5498099">0</span><span class="op" id="5498100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498103">if</span>&nbsp;<span class="ident" id="5498106">i</span>&nbsp;<span class="op" id="5498108">==</span>&nbsp;<span class="builtinfunc" id="5498111">len</span><span class="op" id="5498114">(</span><span class="ident" id="5498115">s</span><span class="op" id="5498116">)</span>&nbsp;<span class="op" id="5498118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498122">return</span>&nbsp;<span class="ident" id="5498129">c</span><span class="op" id="5498130">,</span>&nbsp;<span class="builtinfunc" id="5498132">len</span><span class="op" id="5498135">(</span><span class="ident" id="5498136">s</span><span class="op" id="5498137">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498143">if</span>&nbsp;<span class="ident" id="5498146">s</span><span class="op" id="5498147">[</span><span class="ident" id="5498148">i</span><span class="op" id="5498149">]</span>&nbsp;<span class="op" id="5498151">==</span>&nbsp;<span class="string" id="5498154">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="5498158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498162">return</span>&nbsp;<span class="ident" id="5498169">context</span><span class="op" id="5498176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498181">state</span><span class="op" id="5498186">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5498190">elementContentType</span><span class="op" id="5498208">[</span><span class="ident" id="5498209">c</span><span class="op" id="5498210">.</span><span class="ident" id="5498211">element</span><span class="op" id="5498218">]</span><span class="op" id="5498219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498224">element</span><span class="op" id="5498231">:</span>&nbsp;<span class="ident" id="5498233">c</span><span class="op" id="5498234">.</span><span class="ident" id="5498235">element</span><span class="op" id="5498242">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498246">}</span><span class="op" id="5498247">,</span>&nbsp;<span class="ident" id="5498249">i</span>&nbsp;<span class="op" id="5498251">+</span>&nbsp;<span class="num" id="5498253">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498259">j</span><span class="op" id="5498260">,</span>&nbsp;<span class="ident" id="5498262">err</span>&nbsp;<span class="op" id="5498266">:=</span>&nbsp;<span class="ident" id="5498269">eatAttrName</span><span class="op" id="5498280">(</span><span class="ident" id="5498281">s</span><span class="op" id="5498282">,</span>&nbsp;<span class="ident" id="5498284">i</span><span class="op" id="5498285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498288">if</span>&nbsp;<span class="ident" id="5498291">err</span>&nbsp;<span class="op" id="5498295">!=</span>&nbsp;<span class="ident" id="5498298">nil</span>&nbsp;<span class="op" id="5498302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498306">return</span>&nbsp;<span class="ident" id="5498313">context</span><span class="op" id="5498320">{</span><span class="ident" id="5498321">state</span><span class="op" id="5498326">:</span>&nbsp;<span class="ident" id="5498328">stateError</span><span class="op" id="5498338">,</span>&nbsp;<span class="ident" id="5498340">err</span><span class="op" id="5498343">:</span>&nbsp;<span class="ident" id="5498345">err</span><span class="op" id="5498348">}</span><span class="op" id="5498349">,</span>&nbsp;<span class="builtinfunc" id="5498351">len</span><span class="op" id="5498354">(</span><span class="ident" id="5498355">s</span><span class="op" id="5498356">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498362">state</span><span class="op" id="5498367">,</span>&nbsp;<span class="ident" id="5498369">attr</span>&nbsp;<span class="op" id="5498374">:=</span>&nbsp;<span class="ident" id="5498377">stateTag</span><span class="op" id="5498385">,</span>&nbsp;<span class="ident" id="5498387">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498397">if</span>&nbsp;<span class="ident" id="5498400">i</span>&nbsp;<span class="op" id="5498402">==</span>&nbsp;<span class="ident" id="5498405">j</span>&nbsp;<span class="op" id="5498407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498411">return</span>&nbsp;<span class="ident" id="5498418">context</span><span class="op" id="5498425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498430">state</span><span class="op" id="5498435">:</span>&nbsp;<span class="ident" id="5498437">stateError</span><span class="op" id="5498447">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498452">err</span><span class="op" id="5498455">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5498459">errorf</span><span class="op" id="5498465">(</span><span class="ident" id="5498466">ErrBadHTML</span><span class="op" id="5498476">,</span>&nbsp;<span class="ident" id="5498478">nil</span><span class="op" id="5498481">,</span>&nbsp;<span class="num" id="5498483">0</span><span class="op" id="5498484">,</span>&nbsp;<span class="string" id="5498486">&#34;expected&nbsp;space,&nbsp;attr&nbsp;name,&nbsp;or&nbsp;end&nbsp;of&nbsp;tag,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="5498540">,</span>&nbsp;<span class="ident" id="5498542">s</span><span class="op" id="5498543">[</span><span class="ident" id="5498544">i</span><span class="op" id="5498545">:</span><span class="op" id="5498546">]</span><span class="op" id="5498547">)</span><span class="op" id="5498548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498552">}</span><span class="op" id="5498553">,</span>&nbsp;<span class="builtinfunc" id="5498555">len</span><span class="op" id="5498558">(</span><span class="ident" id="5498559">s</span><span class="op" id="5498560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498566">switch</span>&nbsp;<span class="ident" id="5498573">attrType</span><span class="op" id="5498581">(</span><span class="builtintype" id="5498582">string</span><span class="op" id="5498588">(</span><span class="ident" id="5498589">s</span><span class="op" id="5498590">[</span><span class="ident" id="5498591">i</span><span class="op" id="5498592">:</span><span class="ident" id="5498593">j</span><span class="op" id="5498594">]</span><span class="op" id="5498595">)</span><span class="op" id="5498596">)</span>&nbsp;<span class="op" id="5498598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498601">case</span>&nbsp;<span class="ident" id="5498606">contentTypeURL</span><span class="op" id="5498620">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498624">attr</span>&nbsp;<span class="op" id="5498629">=</span>&nbsp;<span class="ident" id="5498631">attrURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498640">case</span>&nbsp;<span class="ident" id="5498645">contentTypeCSS</span><span class="op" id="5498659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498663">attr</span>&nbsp;<span class="op" id="5498668">=</span>&nbsp;<span class="ident" id="5498670">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498681">case</span>&nbsp;<span class="ident" id="5498686">contentTypeJS</span><span class="op" id="5498699">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498703">attr</span>&nbsp;<span class="op" id="5498708">=</span>&nbsp;<span class="ident" id="5498710">attrScript</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498725">if</span>&nbsp;<span class="ident" id="5498728">j</span>&nbsp;<span class="op" id="5498730">==</span>&nbsp;<span class="builtinfunc" id="5498733">len</span><span class="op" id="5498736">(</span><span class="ident" id="5498737">s</span><span class="op" id="5498738">)</span>&nbsp;<span class="op" id="5498740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498744">state</span>&nbsp;<span class="op" id="5498750">=</span>&nbsp;<span class="ident" id="5498752">stateAttrName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498767">}</span>&nbsp;<span class="keyword" id="5498769">else</span>&nbsp;<span class="op" id="5498774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498778">state</span>&nbsp;<span class="op" id="5498784">=</span>&nbsp;<span class="ident" id="5498786">stateAfterName</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5498802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5498805">return</span>&nbsp;<span class="ident" id="5498812">context</span><span class="op" id="5498819">{</span><span class="ident" id="5498820">state</span><span class="op" id="5498825">:</span>&nbsp;<span class="ident" id="5498827">state</span><span class="op" id="5498832">,</span>&nbsp;<span class="ident" id="5498834">element</span><span class="op" id="5498841">:</span>&nbsp;<span class="ident" id="5498843">c</span><span class="op" id="5498844">.</span><span class="ident" id="5498845">element</span><span class="op" id="5498852">,</span>&nbsp;<span class="ident" id="5498854">attr</span><span class="op" id="5498858">:</span>&nbsp;<span class="ident" id="5498860">attr</span><span class="op" id="5498864">}</span><span class="op" id="5498865">,</span>&nbsp;<span class="ident" id="5498867">j</span><br>
<span class="lineno"></span><span class="op" id="5498869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5498872">//&nbsp;tAttrName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAttrName.</span><br>
<span class="lineno">125</span><span class="keyword" id="5498939">func</span>&nbsp;<span class="ident" id="5498944">tAttrName</span><span class="op" id="5498953">(</span><span class="ident" id="5498954">c</span>&nbsp;<span class="ident" id="5498956">context</span><span class="op" id="5498963">,</span>&nbsp;<span class="ident" id="5498965">s</span>&nbsp;<span class="op" id="5498967">[</span><span class="op" id="5498968">]</span><span class="builtintype" id="5498969">byte</span><span class="op" id="5498973">)</span>&nbsp;<span class="op" id="5498975">(</span><span class="ident" id="5498976">context</span><span class="op" id="5498983">,</span>&nbsp;<span class="builtintype" id="5498985">int</span><span class="op" id="5498988">)</span>&nbsp;<span class="op" id="5498990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498993">i</span><span class="op" id="5498994">,</span>&nbsp;<span class="ident" id="5498996">err</span>&nbsp;<span class="op" id="5499000">:=</span>&nbsp;<span class="ident" id="5499003">eatAttrName</span><span class="op" id="5499014">(</span><span class="ident" id="5499015">s</span><span class="op" id="5499016">,</span>&nbsp;<span class="num" id="5499018">0</span><span class="op" id="5499019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499022">if</span>&nbsp;<span class="ident" id="5499025">err</span>&nbsp;<span class="op" id="5499029">!=</span>&nbsp;<span class="ident" id="5499032">nil</span>&nbsp;<span class="op" id="5499036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499040">return</span>&nbsp;<span class="ident" id="5499047">context</span><span class="op" id="5499054">{</span><span class="ident" id="5499055">state</span><span class="op" id="5499060">:</span>&nbsp;<span class="ident" id="5499062">stateError</span><span class="op" id="5499072">,</span>&nbsp;<span class="ident" id="5499074">err</span><span class="op" id="5499077">:</span>&nbsp;<span class="ident" id="5499079">err</span><span class="op" id="5499082">}</span><span class="op" id="5499083">,</span>&nbsp;<span class="builtinfunc" id="5499085">len</span><span class="op" id="5499088">(</span><span class="ident" id="5499089">s</span><span class="op" id="5499090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499093">}</span>&nbsp;<span class="keyword" id="5499095">else</span>&nbsp;<span class="keyword" id="5499100">if</span>&nbsp;<span class="ident" id="5499103">i</span>&nbsp;<span class="op" id="5499105">!=</span>&nbsp;<span class="builtinfunc" id="5499108">len</span><span class="op" id="5499111">(</span><span class="ident" id="5499112">s</span><span class="op" id="5499113">)</span>&nbsp;<span class="op" id="5499115">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499119">c</span><span class="op" id="5499120">.</span><span class="ident" id="5499121">state</span>&nbsp;<span class="op" id="5499127">=</span>&nbsp;<span class="ident" id="5499129">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499148">return</span>&nbsp;<span class="ident" id="5499155">c</span><span class="op" id="5499156">,</span>&nbsp;<span class="ident" id="5499158">i</span><br>
<span class="lineno"></span><span class="op" id="5499160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="5499163">//&nbsp;tAfterName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAfterName.</span><br>
<span class="lineno"></span><span class="keyword" id="5499232">func</span>&nbsp;<span class="ident" id="5499237">tAfterName</span><span class="op" id="5499247">(</span><span class="ident" id="5499248">c</span>&nbsp;<span class="ident" id="5499250">context</span><span class="op" id="5499257">,</span>&nbsp;<span class="ident" id="5499259">s</span>&nbsp;<span class="op" id="5499261">[</span><span class="op" id="5499262">]</span><span class="builtintype" id="5499263">byte</span><span class="op" id="5499267">)</span>&nbsp;<span class="op" id="5499269">(</span><span class="ident" id="5499270">context</span><span class="op" id="5499277">,</span>&nbsp;<span class="builtintype" id="5499279">int</span><span class="op" id="5499282">)</span>&nbsp;<span class="op" id="5499284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499287">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499324">i</span>&nbsp;<span class="op" id="5499326">:=</span>&nbsp;<span class="ident" id="5499329">eatWhiteSpace</span><span class="op" id="5499342">(</span><span class="ident" id="5499343">s</span><span class="op" id="5499344">,</span>&nbsp;<span class="num" id="5499346">0</span><span class="op" id="5499347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499350">if</span>&nbsp;<span class="ident" id="5499353">i</span>&nbsp;<span class="op" id="5499355">==</span>&nbsp;<span class="builtinfunc" id="5499358">len</span><span class="op" id="5499361">(</span><span class="ident" id="5499362">s</span><span class="op" id="5499363">)</span>&nbsp;<span class="op" id="5499365">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499369">return</span>&nbsp;<span class="ident" id="5499376">c</span><span class="op" id="5499377">,</span>&nbsp;<span class="builtinfunc" id="5499379">len</span><span class="op" id="5499382">(</span><span class="ident" id="5499383">s</span><span class="op" id="5499384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499387">}</span>&nbsp;<span class="keyword" id="5499389">else</span>&nbsp;<span class="keyword" id="5499394">if</span>&nbsp;<span class="ident" id="5499397">s</span><span class="op" id="5499398">[</span><span class="ident" id="5499399">i</span><span class="op" id="5499400">]</span>&nbsp;<span class="op" id="5499402">!=</span>&nbsp;<span class="string" id="5499405">&#39;=&#39;</span>&nbsp;<span class="op" id="5499409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499413">//&nbsp;Occurs&nbsp;due&nbsp;to&nbsp;tag&nbsp;ending&nbsp;&#39;&gt;&#39;,&nbsp;and&nbsp;valueless&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499473">c</span><span class="op" id="5499474">.</span><span class="ident" id="5499475">state</span>&nbsp;<span class="op" id="5499481">=</span>&nbsp;<span class="ident" id="5499483">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499494">return</span>&nbsp;<span class="ident" id="5499501">c</span><span class="op" id="5499502">,</span>&nbsp;<span class="ident" id="5499504">i</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499510">c</span><span class="op" id="5499511">.</span><span class="ident" id="5499512">state</span>&nbsp;<span class="op" id="5499518">=</span>&nbsp;<span class="ident" id="5499520">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499538">//&nbsp;Consume&nbsp;the&nbsp;&#34;=&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499559">return</span>&nbsp;<span class="ident" id="5499566">c</span><span class="op" id="5499567">,</span>&nbsp;<span class="ident" id="5499569">i</span>&nbsp;<span class="op" id="5499571">+</span>&nbsp;<span class="num" id="5499573">1</span><br>
<span class="lineno"></span><span class="op" id="5499575">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="5499578">var</span>&nbsp;<span class="ident" id="5499582">attrStartStates</span>&nbsp;<span class="op" id="5499598">=</span>&nbsp;<span class="op" id="5499600">[</span><span class="op" id="5499601">...</span><span class="op" id="5499604">]</span><span class="ident" id="5499605">state</span><span class="op" id="5499610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499613">attrNone</span><span class="op" id="5499621">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5499625">stateAttr</span><span class="op" id="5499634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499637">attrScript</span><span class="op" id="5499647">:</span>&nbsp;<span class="ident" id="5499649">stateJS</span><span class="op" id="5499656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499659">attrStyle</span><span class="op" id="5499668">:</span>&nbsp;&nbsp;<span class="ident" id="5499671">stateCSS</span><span class="op" id="5499679">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499682">attrURL</span><span class="op" id="5499689">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5499694">stateURL</span><span class="op" id="5499702">,</span><br>
<span class="lineno"></span><span class="op" id="5499704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5499707">//&nbsp;tBeforeValue&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateBeforeValue.</span><br>
<span class="lineno"></span><span class="keyword" id="5499780">func</span>&nbsp;<span class="ident" id="5499785">tBeforeValue</span><span class="op" id="5499797">(</span><span class="ident" id="5499798">c</span>&nbsp;<span class="ident" id="5499800">context</span><span class="op" id="5499807">,</span>&nbsp;<span class="ident" id="5499809">s</span>&nbsp;<span class="op" id="5499811">[</span><span class="op" id="5499812">]</span><span class="builtintype" id="5499813">byte</span><span class="op" id="5499817">)</span>&nbsp;<span class="op" id="5499819">(</span><span class="ident" id="5499820">context</span><span class="op" id="5499827">,</span>&nbsp;<span class="builtintype" id="5499829">int</span><span class="op" id="5499832">)</span>&nbsp;<span class="op" id="5499834">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499837">i</span>&nbsp;<span class="op" id="5499839">:=</span>&nbsp;<span class="ident" id="5499842">eatWhiteSpace</span><span class="op" id="5499855">(</span><span class="ident" id="5499856">s</span><span class="op" id="5499857">,</span>&nbsp;<span class="num" id="5499859">0</span><span class="op" id="5499860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499863">if</span>&nbsp;<span class="ident" id="5499866">i</span>&nbsp;<span class="op" id="5499868">==</span>&nbsp;<span class="builtinfunc" id="5499871">len</span><span class="op" id="5499874">(</span><span class="ident" id="5499875">s</span><span class="op" id="5499876">)</span>&nbsp;<span class="op" id="5499878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499882">return</span>&nbsp;<span class="ident" id="5499889">c</span><span class="op" id="5499890">,</span>&nbsp;<span class="builtinfunc" id="5499892">len</span><span class="op" id="5499895">(</span><span class="ident" id="5499896">s</span><span class="op" id="5499897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499903">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;delimiter.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499937">delim</span>&nbsp;<span class="op" id="5499943">:=</span>&nbsp;<span class="ident" id="5499946">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499966">switch</span>&nbsp;<span class="ident" id="5499973">s</span><span class="op" id="5499974">[</span><span class="ident" id="5499975">i</span><span class="op" id="5499976">]</span>&nbsp;<span class="op" id="5499978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499981">case</span>&nbsp;<span class="string" id="5499986">&#39;\&#39;&#39;</span><span class="op" id="5499990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499994">delim</span><span class="op" id="5499999">,</span>&nbsp;<span class="ident" id="5500001">i</span>&nbsp;<span class="op" id="5500003">=</span>&nbsp;<span class="ident" id="5500005">delimSingleQuote</span><span class="op" id="5500021">,</span>&nbsp;<span class="ident" id="5500023">i</span><span class="op" id="5500024">+</span><span class="num" id="5500025">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500028">case</span>&nbsp;<span class="string" id="5500033">&#39;&#34;&#39;</span><span class="op" id="5500036">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500040">delim</span><span class="op" id="5500045">,</span>&nbsp;<span class="ident" id="5500047">i</span>&nbsp;<span class="op" id="5500049">=</span>&nbsp;<span class="ident" id="5500051">delimDoubleQuote</span><span class="op" id="5500067">,</span>&nbsp;<span class="ident" id="5500069">i</span><span class="op" id="5500070">+</span><span class="num" id="5500071">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500077">c</span><span class="op" id="5500078">.</span><span class="ident" id="5500079">state</span><span class="op" id="5500084">,</span>&nbsp;<span class="ident" id="5500086">c</span><span class="op" id="5500087">.</span><span class="ident" id="5500088">delim</span><span class="op" id="5500093">,</span>&nbsp;<span class="ident" id="5500095">c</span><span class="op" id="5500096">.</span><span class="ident" id="5500097">attr</span>&nbsp;<span class="op" id="5500102">=</span>&nbsp;<span class="ident" id="5500104">attrStartStates</span><span class="op" id="5500119">[</span><span class="ident" id="5500120">c</span><span class="op" id="5500121">.</span><span class="ident" id="5500122">attr</span><span class="op" id="5500126">]</span><span class="op" id="5500127">,</span>&nbsp;<span class="ident" id="5500129">delim</span><span class="op" id="5500134">,</span>&nbsp;<span class="ident" id="5500136">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500146">return</span>&nbsp;<span class="ident" id="5500153">c</span><span class="op" id="5500154">,</span>&nbsp;<span class="ident" id="5500156">i</span><br>
<span class="lineno"></span><span class="op" id="5500158">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="5500161">//&nbsp;tHTMLCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateHTMLCmt.</span><br>
<span class="lineno"></span><span class="keyword" id="5500226">func</span>&nbsp;<span class="ident" id="5500231">tHTMLCmt</span><span class="op" id="5500239">(</span><span class="ident" id="5500240">c</span>&nbsp;<span class="ident" id="5500242">context</span><span class="op" id="5500249">,</span>&nbsp;<span class="ident" id="5500251">s</span>&nbsp;<span class="op" id="5500253">[</span><span class="op" id="5500254">]</span><span class="builtintype" id="5500255">byte</span><span class="op" id="5500259">)</span>&nbsp;<span class="op" id="5500261">(</span><span class="ident" id="5500262">context</span><span class="op" id="5500269">,</span>&nbsp;<span class="builtintype" id="5500271">int</span><span class="op" id="5500274">)</span>&nbsp;<span class="op" id="5500276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500279">if</span>&nbsp;<span class="ident" id="5500282">i</span>&nbsp;<span class="op" id="5500284">:=</span>&nbsp;<span class="ident" id="5500287">bytes</span><span class="op" id="5500292">.</span><span class="ident" id="5500293">Index</span><span class="op" id="5500298">(</span><span class="ident" id="5500299">s</span><span class="op" id="5500300">,</span>&nbsp;<span class="ident" id="5500302">commentEnd</span><span class="op" id="5500312">)</span><span class="op" id="5500313">;</span>&nbsp;<span class="ident" id="5500315">i</span>&nbsp;<span class="op" id="5500317">!=</span>&nbsp;<span class="op" id="5500320">-</span><span class="num" id="5500321">1</span>&nbsp;<span class="op" id="5500323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500327">return</span>&nbsp;<span class="ident" id="5500334">context</span><span class="op" id="5500341">{</span><span class="op" id="5500342">}</span><span class="op" id="5500343">,</span>&nbsp;<span class="ident" id="5500345">i</span>&nbsp;<span class="op" id="5500347">+</span>&nbsp;<span class="num" id="5500349">3</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500355">return</span>&nbsp;<span class="ident" id="5500362">c</span><span class="op" id="5500363">,</span>&nbsp;<span class="builtinfunc" id="5500365">len</span><span class="op" id="5500368">(</span><span class="ident" id="5500369">s</span><span class="op" id="5500370">)</span><br>
<span class="lineno"></span><span class="op" id="5500372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5500375">//&nbsp;specialTagEndMarkers&nbsp;maps&nbsp;element&nbsp;types&nbsp;to&nbsp;the&nbsp;character&nbsp;sequence&nbsp;that</span><br>
<span class="lineno">185</span><span class="comment" id="5500449">//&nbsp;case-insensitively&nbsp;signals&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;special&nbsp;tag&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="5500512">var</span>&nbsp;<span class="ident" id="5500516">specialTagEndMarkers</span>&nbsp;<span class="op" id="5500537">=</span>&nbsp;<span class="op" id="5500539">[</span><span class="op" id="5500540">...</span><span class="op" id="5500543">]</span><span class="builtintype" id="5500544">string</span><span class="op" id="5500550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500553">elementScript</span><span class="op" id="5500566">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5500570">&#34;&lt;/script&#34;</span><span class="op" id="5500580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500583">elementStyle</span><span class="op" id="5500595">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5500600">&#34;&lt;/style&#34;</span><span class="op" id="5500609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500612">elementTextarea</span><span class="op" id="5500627">:</span>&nbsp;<span class="string" id="5500629">&#34;&lt;/textarea&#34;</span><span class="op" id="5500641">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500644">elementTitle</span><span class="op" id="5500656">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5500661">&#34;&lt;/title&#34;</span><span class="op" id="5500670">,</span><br>
<span class="lineno"></span><span class="op" id="5500672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5500675">//&nbsp;tSpecialTagEnd&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;raw&nbsp;text&nbsp;and&nbsp;RCDATA</span><br>
<span class="lineno"></span><span class="comment" id="5500752">//&nbsp;element&nbsp;states.</span><br>
<span class="lineno">195</span><span class="keyword" id="5500771">func</span>&nbsp;<span class="ident" id="5500776">tSpecialTagEnd</span><span class="op" id="5500790">(</span><span class="ident" id="5500791">c</span>&nbsp;<span class="ident" id="5500793">context</span><span class="op" id="5500800">,</span>&nbsp;<span class="ident" id="5500802">s</span>&nbsp;<span class="op" id="5500804">[</span><span class="op" id="5500805">]</span><span class="builtintype" id="5500806">byte</span><span class="op" id="5500810">)</span>&nbsp;<span class="op" id="5500812">(</span><span class="ident" id="5500813">context</span><span class="op" id="5500820">,</span>&nbsp;<span class="builtintype" id="5500822">int</span><span class="op" id="5500825">)</span>&nbsp;<span class="op" id="5500827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500830">if</span>&nbsp;<span class="ident" id="5500833">c</span><span class="op" id="5500834">.</span><span class="ident" id="5500835">element</span>&nbsp;<span class="op" id="5500843">!=</span>&nbsp;<span class="ident" id="5500846">elementNone</span>&nbsp;<span class="op" id="5500858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500862">if</span>&nbsp;<span class="ident" id="5500865">i</span>&nbsp;<span class="op" id="5500867">:=</span>&nbsp;<span class="ident" id="5500870">strings</span><span class="op" id="5500877">.</span><span class="ident" id="5500878">Index</span><span class="op" id="5500883">(</span><span class="ident" id="5500884">strings</span><span class="op" id="5500891">.</span><span class="ident" id="5500892">ToLower</span><span class="op" id="5500899">(</span><span class="builtintype" id="5500900">string</span><span class="op" id="5500906">(</span><span class="ident" id="5500907">s</span><span class="op" id="5500908">)</span><span class="op" id="5500909">)</span><span class="op" id="5500910">,</span>&nbsp;<span class="ident" id="5500912">specialTagEndMarkers</span><span class="op" id="5500932">[</span><span class="ident" id="5500933">c</span><span class="op" id="5500934">.</span><span class="ident" id="5500935">element</span><span class="op" id="5500942">]</span><span class="op" id="5500943">)</span><span class="op" id="5500944">;</span>&nbsp;<span class="ident" id="5500946">i</span>&nbsp;<span class="op" id="5500948">!=</span>&nbsp;<span class="op" id="5500951">-</span><span class="num" id="5500952">1</span>&nbsp;<span class="op" id="5500954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500959">return</span>&nbsp;<span class="ident" id="5500966">context</span><span class="op" id="5500973">{</span><span class="op" id="5500974">}</span><span class="op" id="5500975">,</span>&nbsp;<span class="ident" id="5500977">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500981">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500987">return</span>&nbsp;<span class="ident" id="5500994">c</span><span class="op" id="5500995">,</span>&nbsp;<span class="builtinfunc" id="5500997">len</span><span class="op" id="5501000">(</span><span class="ident" id="5501001">s</span><span class="op" id="5501002">)</span><br>
<span class="lineno"></span><span class="op" id="5501004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5501007">//&nbsp;tAttr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;attribute&nbsp;state.</span><br>
<span class="lineno">205</span><span class="keyword" id="5501076">func</span>&nbsp;<span class="ident" id="5501081">tAttr</span><span class="op" id="5501086">(</span><span class="ident" id="5501087">c</span>&nbsp;<span class="ident" id="5501089">context</span><span class="op" id="5501096">,</span>&nbsp;<span class="ident" id="5501098">s</span>&nbsp;<span class="op" id="5501100">[</span><span class="op" id="5501101">]</span><span class="builtintype" id="5501102">byte</span><span class="op" id="5501106">)</span>&nbsp;<span class="op" id="5501108">(</span><span class="ident" id="5501109">context</span><span class="op" id="5501116">,</span>&nbsp;<span class="builtintype" id="5501118">int</span><span class="op" id="5501121">)</span>&nbsp;<span class="op" id="5501123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501126">return</span>&nbsp;<span class="ident" id="5501133">c</span><span class="op" id="5501134">,</span>&nbsp;<span class="builtinfunc" id="5501136">len</span><span class="op" id="5501139">(</span><span class="ident" id="5501140">s</span><span class="op" id="5501141">)</span><br>
<span class="lineno"></span><span class="op" id="5501143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5501146">//&nbsp;tURL&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;URL&nbsp;state.</span><br>
<span class="lineno">210</span><span class="keyword" id="5501208">func</span>&nbsp;<span class="ident" id="5501213">tURL</span><span class="op" id="5501217">(</span><span class="ident" id="5501218">c</span>&nbsp;<span class="ident" id="5501220">context</span><span class="op" id="5501227">,</span>&nbsp;<span class="ident" id="5501229">s</span>&nbsp;<span class="op" id="5501231">[</span><span class="op" id="5501232">]</span><span class="builtintype" id="5501233">byte</span><span class="op" id="5501237">)</span>&nbsp;<span class="op" id="5501239">(</span><span class="ident" id="5501240">context</span><span class="op" id="5501247">,</span>&nbsp;<span class="builtintype" id="5501249">int</span><span class="op" id="5501252">)</span>&nbsp;<span class="op" id="5501254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501257">if</span>&nbsp;<span class="ident" id="5501260">bytes</span><span class="op" id="5501265">.</span><span class="ident" id="5501266">IndexAny</span><span class="op" id="5501274">(</span><span class="ident" id="5501275">s</span><span class="op" id="5501276">,</span>&nbsp;<span class="string" id="5501278">&#34;#?&#34;</span><span class="op" id="5501282">)</span>&nbsp;<span class="op" id="5501284">&gt;=</span>&nbsp;<span class="num" id="5501287">0</span>&nbsp;<span class="op" id="5501289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501293">c</span><span class="op" id="5501294">.</span><span class="ident" id="5501295">urlPart</span>&nbsp;<span class="op" id="5501303">=</span>&nbsp;<span class="ident" id="5501305">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501325">}</span>&nbsp;<span class="keyword" id="5501327">else</span>&nbsp;<span class="keyword" id="5501332">if</span>&nbsp;<span class="builtinfunc" id="5501335">len</span><span class="op" id="5501338">(</span><span class="ident" id="5501339">s</span><span class="op" id="5501340">)</span>&nbsp;<span class="op" id="5501342">!=</span>&nbsp;<span class="ident" id="5501345">eatWhiteSpace</span><span class="op" id="5501358">(</span><span class="ident" id="5501359">s</span><span class="op" id="5501360">,</span>&nbsp;<span class="num" id="5501362">0</span><span class="op" id="5501363">)</span>&nbsp;<span class="op" id="5501365">&amp;&amp;</span>&nbsp;<span class="ident" id="5501368">c</span><span class="op" id="5501369">.</span><span class="ident" id="5501370">urlPart</span>&nbsp;<span class="op" id="5501378">==</span>&nbsp;<span class="ident" id="5501381">urlPartNone</span>&nbsp;<span class="op" id="5501393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501397">//&nbsp;HTML5&nbsp;uses&nbsp;&#34;Valid&nbsp;URL&nbsp;potentially&nbsp;surrounded&nbsp;by&nbsp;spaces&#34;&nbsp;for</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501462">//&nbsp;attrs:&nbsp;http://www.w3.org/TR/html5/index.html#attributes-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501525">c</span><span class="op" id="5501526">.</span><span class="ident" id="5501527">urlPart</span>&nbsp;<span class="op" id="5501535">=</span>&nbsp;<span class="ident" id="5501537">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501557">return</span>&nbsp;<span class="ident" id="5501564">c</span><span class="op" id="5501565">,</span>&nbsp;<span class="builtinfunc" id="5501567">len</span><span class="op" id="5501570">(</span><span class="ident" id="5501571">s</span><span class="op" id="5501572">)</span><br>
<span class="lineno"></span><span class="op" id="5501574">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5501577">//&nbsp;tJS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5501637">func</span>&nbsp;<span class="ident" id="5501642">tJS</span><span class="op" id="5501645">(</span><span class="ident" id="5501646">c</span>&nbsp;<span class="ident" id="5501648">context</span><span class="op" id="5501655">,</span>&nbsp;<span class="ident" id="5501657">s</span>&nbsp;<span class="op" id="5501659">[</span><span class="op" id="5501660">]</span><span class="builtintype" id="5501661">byte</span><span class="op" id="5501665">)</span>&nbsp;<span class="op" id="5501667">(</span><span class="ident" id="5501668">context</span><span class="op" id="5501675">,</span>&nbsp;<span class="builtintype" id="5501677">int</span><span class="op" id="5501680">)</span>&nbsp;<span class="op" id="5501682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501685">i</span>&nbsp;<span class="op" id="5501687">:=</span>&nbsp;<span class="ident" id="5501690">bytes</span><span class="op" id="5501695">.</span><span class="ident" id="5501696">IndexAny</span><span class="op" id="5501704">(</span><span class="ident" id="5501705">s</span><span class="op" id="5501706">,</span>&nbsp;<span class="string" id="5501708">`&#34;&#39;/`</span><span class="op" id="5501713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501716">if</span>&nbsp;<span class="ident" id="5501719">i</span>&nbsp;<span class="op" id="5501721">==</span>&nbsp;<span class="op" id="5501724">-</span><span class="num" id="5501725">1</span>&nbsp;<span class="op" id="5501727">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501731">//&nbsp;Entire&nbsp;input&nbsp;is&nbsp;non&nbsp;string,&nbsp;comment,&nbsp;regexp&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501788">c</span><span class="op" id="5501789">.</span><span class="ident" id="5501790">jsCtx</span>&nbsp;<span class="op" id="5501796">=</span>&nbsp;<span class="ident" id="5501798">nextJSCtx</span><span class="op" id="5501807">(</span><span class="ident" id="5501808">s</span><span class="op" id="5501809">,</span>&nbsp;<span class="ident" id="5501811">c</span><span class="op" id="5501812">.</span><span class="ident" id="5501813">jsCtx</span><span class="op" id="5501818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501822">return</span>&nbsp;<span class="ident" id="5501829">c</span><span class="op" id="5501830">,</span>&nbsp;<span class="builtinfunc" id="5501832">len</span><span class="op" id="5501835">(</span><span class="ident" id="5501836">s</span><span class="op" id="5501837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501843">c</span><span class="op" id="5501844">.</span><span class="ident" id="5501845">jsCtx</span>&nbsp;<span class="op" id="5501851">=</span>&nbsp;<span class="ident" id="5501853">nextJSCtx</span><span class="op" id="5501862">(</span><span class="ident" id="5501863">s</span><span class="op" id="5501864">[</span><span class="op" id="5501865">:</span><span class="ident" id="5501866">i</span><span class="op" id="5501867">]</span><span class="op" id="5501868">,</span>&nbsp;<span class="ident" id="5501870">c</span><span class="op" id="5501871">.</span><span class="ident" id="5501872">jsCtx</span><span class="op" id="5501877">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501880">switch</span>&nbsp;<span class="ident" id="5501887">s</span><span class="op" id="5501888">[</span><span class="ident" id="5501889">i</span><span class="op" id="5501890">]</span>&nbsp;<span class="op" id="5501892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501895">case</span>&nbsp;<span class="string" id="5501900">&#39;&#34;&#39;</span><span class="op" id="5501903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501907">c</span><span class="op" id="5501908">.</span><span class="ident" id="5501909">state</span><span class="op" id="5501914">,</span>&nbsp;<span class="ident" id="5501916">c</span><span class="op" id="5501917">.</span><span class="ident" id="5501918">jsCtx</span>&nbsp;<span class="op" id="5501924">=</span>&nbsp;<span class="ident" id="5501926">stateJSDqStr</span><span class="op" id="5501938">,</span>&nbsp;<span class="ident" id="5501940">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501953">case</span>&nbsp;<span class="string" id="5501958">&#39;\&#39;&#39;</span><span class="op" id="5501962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501966">c</span><span class="op" id="5501967">.</span><span class="ident" id="5501968">state</span><span class="op" id="5501973">,</span>&nbsp;<span class="ident" id="5501975">c</span><span class="op" id="5501976">.</span><span class="ident" id="5501977">jsCtx</span>&nbsp;<span class="op" id="5501983">=</span>&nbsp;<span class="ident" id="5501985">stateJSSqStr</span><span class="op" id="5501997">,</span>&nbsp;<span class="ident" id="5501999">jsCtxRegexp</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502012">case</span>&nbsp;<span class="string" id="5502017">&#39;/&#39;</span><span class="op" id="5502020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502024">switch</span>&nbsp;<span class="op" id="5502031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502035">case</span>&nbsp;<span class="ident" id="5502040">i</span><span class="op" id="5502041">+</span><span class="num" id="5502042">1</span>&nbsp;<span class="op" id="5502044">&lt;</span>&nbsp;<span class="builtinfunc" id="5502046">len</span><span class="op" id="5502049">(</span><span class="ident" id="5502050">s</span><span class="op" id="5502051">)</span>&nbsp;<span class="op" id="5502053">&amp;&amp;</span>&nbsp;<span class="ident" id="5502056">s</span><span class="op" id="5502057">[</span><span class="ident" id="5502058">i</span><span class="op" id="5502059">+</span><span class="num" id="5502060">1</span><span class="op" id="5502061">]</span>&nbsp;<span class="op" id="5502063">==</span>&nbsp;<span class="string" id="5502066">&#39;/&#39;</span><span class="op" id="5502069">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502074">c</span><span class="op" id="5502075">.</span><span class="ident" id="5502076">state</span><span class="op" id="5502081">,</span>&nbsp;<span class="ident" id="5502083">i</span>&nbsp;<span class="op" id="5502085">=</span>&nbsp;<span class="ident" id="5502087">stateJSLineCmt</span><span class="op" id="5502101">,</span>&nbsp;<span class="ident" id="5502103">i</span><span class="op" id="5502104">+</span><span class="num" id="5502105">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502109">case</span>&nbsp;<span class="ident" id="5502114">i</span><span class="op" id="5502115">+</span><span class="num" id="5502116">1</span>&nbsp;<span class="op" id="5502118">&lt;</span>&nbsp;<span class="builtinfunc" id="5502120">len</span><span class="op" id="5502123">(</span><span class="ident" id="5502124">s</span><span class="op" id="5502125">)</span>&nbsp;<span class="op" id="5502127">&amp;&amp;</span>&nbsp;<span class="ident" id="5502130">s</span><span class="op" id="5502131">[</span><span class="ident" id="5502132">i</span><span class="op" id="5502133">+</span><span class="num" id="5502134">1</span><span class="op" id="5502135">]</span>&nbsp;<span class="op" id="5502137">==</span>&nbsp;<span class="string" id="5502140">&#39;*&#39;</span><span class="op" id="5502143">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502148">c</span><span class="op" id="5502149">.</span><span class="ident" id="5502150">state</span><span class="op" id="5502155">,</span>&nbsp;<span class="ident" id="5502157">i</span>&nbsp;<span class="op" id="5502159">=</span>&nbsp;<span class="ident" id="5502161">stateJSBlockCmt</span><span class="op" id="5502176">,</span>&nbsp;<span class="ident" id="5502178">i</span><span class="op" id="5502179">+</span><span class="num" id="5502180">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502184">case</span>&nbsp;<span class="ident" id="5502189">c</span><span class="op" id="5502190">.</span><span class="ident" id="5502191">jsCtx</span>&nbsp;<span class="op" id="5502197">==</span>&nbsp;<span class="ident" id="5502200">jsCtxRegexp</span><span class="op" id="5502211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502216">c</span><span class="op" id="5502217">.</span><span class="ident" id="5502218">state</span>&nbsp;<span class="op" id="5502224">=</span>&nbsp;<span class="ident" id="5502226">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502242">case</span>&nbsp;<span class="ident" id="5502247">c</span><span class="op" id="5502248">.</span><span class="ident" id="5502249">jsCtx</span>&nbsp;<span class="op" id="5502255">==</span>&nbsp;<span class="ident" id="5502258">jsCtxDivOp</span><span class="op" id="5502268">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502273">c</span><span class="op" id="5502274">.</span><span class="ident" id="5502275">jsCtx</span>&nbsp;<span class="op" id="5502281">=</span>&nbsp;<span class="ident" id="5502283">jsCtxRegexp</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502297">default</span><span class="op" id="5502304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502309">return</span>&nbsp;<span class="ident" id="5502316">context</span><span class="op" id="5502323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502329">state</span><span class="op" id="5502334">:</span>&nbsp;<span class="ident" id="5502336">stateError</span><span class="op" id="5502346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502352">err</span><span class="op" id="5502355">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5502359">errorf</span><span class="op" id="5502365">(</span><span class="ident" id="5502366">ErrSlashAmbig</span><span class="op" id="5502379">,</span>&nbsp;<span class="ident" id="5502381">nil</span><span class="op" id="5502384">,</span>&nbsp;<span class="num" id="5502386">0</span><span class="op" id="5502387">,</span>&nbsp;<span class="string" id="5502389">&#34;&#39;/&#39;&nbsp;could&nbsp;start&nbsp;a&nbsp;division&nbsp;or&nbsp;regexp:&nbsp;%.32q&#34;</span><span class="op" id="5502434">,</span>&nbsp;<span class="ident" id="5502436">s</span><span class="op" id="5502437">[</span><span class="ident" id="5502438">i</span><span class="op" id="5502439">:</span><span class="op" id="5502440">]</span><span class="op" id="5502441">)</span><span class="op" id="5502442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502447">}</span><span class="op" id="5502448">,</span>&nbsp;<span class="builtinfunc" id="5502450">len</span><span class="op" id="5502453">(</span><span class="ident" id="5502454">s</span><span class="op" id="5502455">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502462">default</span><span class="op" id="5502469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5502473">panic</span><span class="op" id="5502478">(</span><span class="string" id="5502479">&#34;unreachable&#34;</span><span class="op" id="5502492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502498">return</span>&nbsp;<span class="ident" id="5502505">c</span><span class="op" id="5502506">,</span>&nbsp;<span class="ident" id="5502508">i</span>&nbsp;<span class="op" id="5502510">+</span>&nbsp;<span class="num" id="5502512">1</span><br>
<span class="lineno">255</span><span class="op" id="5502514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5502517">//&nbsp;tJSDelimited&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;string&nbsp;and&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5502597">//&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5502608">func</span>&nbsp;<span class="ident" id="5502613">tJSDelimited</span><span class="op" id="5502625">(</span><span class="ident" id="5502626">c</span>&nbsp;<span class="ident" id="5502628">context</span><span class="op" id="5502635">,</span>&nbsp;<span class="ident" id="5502637">s</span>&nbsp;<span class="op" id="5502639">[</span><span class="op" id="5502640">]</span><span class="builtintype" id="5502641">byte</span><span class="op" id="5502645">)</span>&nbsp;<span class="op" id="5502647">(</span><span class="ident" id="5502648">context</span><span class="op" id="5502655">,</span>&nbsp;<span class="builtintype" id="5502657">int</span><span class="op" id="5502660">)</span>&nbsp;<span class="op" id="5502662">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502665">specials</span>&nbsp;<span class="op" id="5502674">:=</span>&nbsp;<span class="string" id="5502677">`\&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502683">switch</span>&nbsp;<span class="ident" id="5502690">c</span><span class="op" id="5502691">.</span><span class="ident" id="5502692">state</span>&nbsp;<span class="op" id="5502698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502701">case</span>&nbsp;<span class="ident" id="5502706">stateJSSqStr</span><span class="op" id="5502718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502722">specials</span>&nbsp;<span class="op" id="5502731">=</span>&nbsp;<span class="string" id="5502733">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502739">case</span>&nbsp;<span class="ident" id="5502744">stateJSRegexp</span><span class="op" id="5502757">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502761">specials</span>&nbsp;<span class="op" id="5502770">=</span>&nbsp;<span class="string" id="5502772">`\/[]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502784">k</span><span class="op" id="5502785">,</span>&nbsp;<span class="ident" id="5502787">inCharset</span>&nbsp;<span class="op" id="5502797">:=</span>&nbsp;<span class="num" id="5502800">0</span><span class="op" id="5502801">,</span>&nbsp;<span class="builtintype" id="5502803">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502810">for</span>&nbsp;<span class="op" id="5502814">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502818">i</span>&nbsp;<span class="op" id="5502820">:=</span>&nbsp;<span class="ident" id="5502823">k</span>&nbsp;<span class="op" id="5502825">+</span>&nbsp;<span class="ident" id="5502827">bytes</span><span class="op" id="5502832">.</span><span class="ident" id="5502833">IndexAny</span><span class="op" id="5502841">(</span><span class="ident" id="5502842">s</span><span class="op" id="5502843">[</span><span class="ident" id="5502844">k</span><span class="op" id="5502845">:</span><span class="op" id="5502846">]</span><span class="op" id="5502847">,</span>&nbsp;<span class="ident" id="5502849">specials</span><span class="op" id="5502857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502861">if</span>&nbsp;<span class="ident" id="5502864">i</span>&nbsp;<span class="op" id="5502866">&lt;</span>&nbsp;<span class="ident" id="5502868">k</span>&nbsp;<span class="op" id="5502870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502875">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502887">switch</span>&nbsp;<span class="ident" id="5502894">s</span><span class="op" id="5502895">[</span><span class="ident" id="5502896">i</span><span class="op" id="5502897">]</span>&nbsp;<span class="op" id="5502899">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502903">case</span>&nbsp;<span class="string" id="5502908">&#39;\\&#39;</span><span class="op" id="5502912">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502917">i</span><span class="op" id="5502918">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502924">if</span>&nbsp;<span class="ident" id="5502927">i</span>&nbsp;<span class="op" id="5502929">==</span>&nbsp;<span class="builtinfunc" id="5502932">len</span><span class="op" id="5502935">(</span><span class="ident" id="5502936">s</span><span class="op" id="5502937">)</span>&nbsp;<span class="op" id="5502939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502945">return</span>&nbsp;<span class="ident" id="5502952">context</span><span class="op" id="5502959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502966">state</span><span class="op" id="5502971">:</span>&nbsp;<span class="ident" id="5502973">stateError</span><span class="op" id="5502983">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502990">err</span><span class="op" id="5502993">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5502997">errorf</span><span class="op" id="5503003">(</span><span class="ident" id="5503004">ErrPartialEscape</span><span class="op" id="5503020">,</span>&nbsp;<span class="ident" id="5503022">nil</span><span class="op" id="5503025">,</span>&nbsp;<span class="num" id="5503027">0</span><span class="op" id="5503028">,</span>&nbsp;<span class="string" id="5503030">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;JS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="5503075">,</span>&nbsp;<span class="ident" id="5503077">s</span><span class="op" id="5503078">)</span><span class="op" id="5503079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503085">}</span><span class="op" id="5503086">,</span>&nbsp;<span class="builtinfunc" id="5503088">len</span><span class="op" id="5503091">(</span><span class="ident" id="5503092">s</span><span class="op" id="5503093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503102">case</span>&nbsp;<span class="string" id="5503107">&#39;[&#39;</span><span class="op" id="5503110">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503115">inCharset</span>&nbsp;<span class="op" id="5503125">=</span>&nbsp;<span class="builtintype" id="5503127">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503134">case</span>&nbsp;<span class="string" id="5503139">&#39;]&#39;</span><span class="op" id="5503142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503147">inCharset</span>&nbsp;<span class="op" id="5503157">=</span>&nbsp;<span class="builtintype" id="5503159">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503167">default</span><span class="op" id="5503174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5503179">//&nbsp;end&nbsp;delimiter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503199">if</span>&nbsp;<span class="op" id="5503202">!</span><span class="ident" id="5503203">inCharset</span>&nbsp;<span class="op" id="5503213">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503219">c</span><span class="op" id="5503220">.</span><span class="ident" id="5503221">state</span><span class="op" id="5503226">,</span>&nbsp;<span class="ident" id="5503228">c</span><span class="op" id="5503229">.</span><span class="ident" id="5503230">jsCtx</span>&nbsp;<span class="op" id="5503236">=</span>&nbsp;<span class="ident" id="5503238">stateJS</span><span class="op" id="5503245">,</span>&nbsp;<span class="ident" id="5503247">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503262">return</span>&nbsp;<span class="ident" id="5503269">c</span><span class="op" id="5503270">,</span>&nbsp;<span class="ident" id="5503272">i</span>&nbsp;<span class="op" id="5503274">+</span>&nbsp;<span class="num" id="5503276">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503289">k</span>&nbsp;<span class="op" id="5503291">=</span>&nbsp;<span class="ident" id="5503293">i</span>&nbsp;<span class="op" id="5503295">+</span>&nbsp;<span class="num" id="5503297">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503304">if</span>&nbsp;<span class="ident" id="5503307">inCharset</span>&nbsp;<span class="op" id="5503317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5503321">//&nbsp;This&nbsp;can&nbsp;be&nbsp;fixed&nbsp;by&nbsp;making&nbsp;context&nbsp;richer&nbsp;if&nbsp;interpolation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5503386">//&nbsp;into&nbsp;charsets&nbsp;is&nbsp;desired.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503417">return</span>&nbsp;<span class="ident" id="5503424">context</span><span class="op" id="5503431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503436">state</span><span class="op" id="5503441">:</span>&nbsp;<span class="ident" id="5503443">stateError</span><span class="op" id="5503453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503458">err</span><span class="op" id="5503461">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5503465">errorf</span><span class="op" id="5503471">(</span><span class="ident" id="5503472">ErrPartialCharset</span><span class="op" id="5503489">,</span>&nbsp;<span class="ident" id="5503491">nil</span><span class="op" id="5503494">,</span>&nbsp;<span class="num" id="5503496">0</span><span class="op" id="5503497">,</span>&nbsp;<span class="string" id="5503499">&#34;unfinished&nbsp;JS&nbsp;regexp&nbsp;charset:&nbsp;%q&#34;</span><span class="op" id="5503533">,</span>&nbsp;<span class="ident" id="5503535">s</span><span class="op" id="5503536">)</span><span class="op" id="5503537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503541">}</span><span class="op" id="5503542">,</span>&nbsp;<span class="builtinfunc" id="5503544">len</span><span class="op" id="5503547">(</span><span class="ident" id="5503548">s</span><span class="op" id="5503549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503552">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503556">return</span>&nbsp;<span class="ident" id="5503563">c</span><span class="op" id="5503564">,</span>&nbsp;<span class="builtinfunc" id="5503566">len</span><span class="op" id="5503569">(</span><span class="ident" id="5503570">s</span><span class="op" id="5503571">)</span><br>
<span class="lineno"></span><span class="op" id="5503573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5503576">var</span>&nbsp;<span class="ident" id="5503580">blockCommentEnd</span>&nbsp;<span class="op" id="5503596">=</span>&nbsp;<span class="op" id="5503598">[</span><span class="op" id="5503599">]</span><span class="builtintype" id="5503600">byte</span><span class="op" id="5503604">(</span><span class="string" id="5503605">&#34;*/&#34;</span><span class="op" id="5503609">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="comment" id="5503612">//&nbsp;tBlockCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;/*comment*/&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5503684">func</span>&nbsp;<span class="ident" id="5503689">tBlockCmt</span><span class="op" id="5503698">(</span><span class="ident" id="5503699">c</span>&nbsp;<span class="ident" id="5503701">context</span><span class="op" id="5503708">,</span>&nbsp;<span class="ident" id="5503710">s</span>&nbsp;<span class="op" id="5503712">[</span><span class="op" id="5503713">]</span><span class="builtintype" id="5503714">byte</span><span class="op" id="5503718">)</span>&nbsp;<span class="op" id="5503720">(</span><span class="ident" id="5503721">context</span><span class="op" id="5503728">,</span>&nbsp;<span class="builtintype" id="5503730">int</span><span class="op" id="5503733">)</span>&nbsp;<span class="op" id="5503735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503738">i</span>&nbsp;<span class="op" id="5503740">:=</span>&nbsp;<span class="ident" id="5503743">bytes</span><span class="op" id="5503748">.</span><span class="ident" id="5503749">Index</span><span class="op" id="5503754">(</span><span class="ident" id="5503755">s</span><span class="op" id="5503756">,</span>&nbsp;<span class="ident" id="5503758">blockCommentEnd</span><span class="op" id="5503773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503776">if</span>&nbsp;<span class="ident" id="5503779">i</span>&nbsp;<span class="op" id="5503781">==</span>&nbsp;<span class="op" id="5503784">-</span><span class="num" id="5503785">1</span>&nbsp;<span class="op" id="5503787">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503791">return</span>&nbsp;<span class="ident" id="5503798">c</span><span class="op" id="5503799">,</span>&nbsp;<span class="builtinfunc" id="5503801">len</span><span class="op" id="5503804">(</span><span class="ident" id="5503805">s</span><span class="op" id="5503806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503812">switch</span>&nbsp;<span class="ident" id="5503819">c</span><span class="op" id="5503820">.</span><span class="ident" id="5503821">state</span>&nbsp;<span class="op" id="5503827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503830">case</span>&nbsp;<span class="ident" id="5503835">stateJSBlockCmt</span><span class="op" id="5503850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503854">c</span><span class="op" id="5503855">.</span><span class="ident" id="5503856">state</span>&nbsp;<span class="op" id="5503862">=</span>&nbsp;<span class="ident" id="5503864">stateJS</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503873">case</span>&nbsp;<span class="ident" id="5503878">stateCSSBlockCmt</span><span class="op" id="5503894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503898">c</span><span class="op" id="5503899">.</span><span class="ident" id="5503900">state</span>&nbsp;<span class="op" id="5503906">=</span>&nbsp;<span class="ident" id="5503908">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503918">default</span><span class="op" id="5503925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5503929">panic</span><span class="op" id="5503934">(</span><span class="ident" id="5503935">c</span><span class="op" id="5503936">.</span><span class="ident" id="5503937">state</span><span class="op" id="5503942">.</span><span class="ident" id="5503943">String</span><span class="op" id="5503949">(</span><span class="op" id="5503950">)</span><span class="op" id="5503951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503954">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503957">return</span>&nbsp;<span class="ident" id="5503964">c</span><span class="op" id="5503965">,</span>&nbsp;<span class="ident" id="5503967">i</span>&nbsp;<span class="op" id="5503969">+</span>&nbsp;<span class="num" id="5503971">2</span><br>
<span class="lineno"></span><span class="op" id="5503973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5503976">//&nbsp;tLineCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;//comment&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5504045">func</span>&nbsp;<span class="ident" id="5504050">tLineCmt</span><span class="op" id="5504058">(</span><span class="ident" id="5504059">c</span>&nbsp;<span class="ident" id="5504061">context</span><span class="op" id="5504068">,</span>&nbsp;<span class="ident" id="5504070">s</span>&nbsp;<span class="op" id="5504072">[</span><span class="op" id="5504073">]</span><span class="builtintype" id="5504074">byte</span><span class="op" id="5504078">)</span>&nbsp;<span class="op" id="5504080">(</span><span class="ident" id="5504081">context</span><span class="op" id="5504088">,</span>&nbsp;<span class="builtintype" id="5504090">int</span><span class="op" id="5504093">)</span>&nbsp;<span class="op" id="5504095">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5504098">var</span>&nbsp;<span class="ident" id="5504102">lineTerminators</span>&nbsp;<span class="builtintype" id="5504118">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5504126">var</span>&nbsp;<span class="ident" id="5504130">endState</span>&nbsp;<span class="ident" id="5504139">state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5504146">switch</span>&nbsp;<span class="ident" id="5504153">c</span><span class="op" id="5504154">.</span><span class="ident" id="5504155">state</span>&nbsp;<span class="op" id="5504161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5504164">case</span>&nbsp;<span class="ident" id="5504169">stateJSLineCmt</span><span class="op" id="5504183">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504187">lineTerminators</span><span class="op" id="5504202">,</span>&nbsp;<span class="ident" id="5504204">endState</span>&nbsp;<span class="op" id="5504213">=</span>&nbsp;<span class="string" id="5504215">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="5504233">,</span>&nbsp;<span class="ident" id="5504235">stateJS</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5504244">case</span>&nbsp;<span class="ident" id="5504249">stateCSSLineCmt</span><span class="op" id="5504264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504268">lineTerminators</span><span class="op" id="5504283">,</span>&nbsp;<span class="ident" id="5504285">endState</span>&nbsp;<span class="op" id="5504294">=</span>&nbsp;<span class="string" id="5504296">&#34;\n\f\r&#34;</span><span class="op" id="5504304">,</span>&nbsp;<span class="ident" id="5504306">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504317">//&nbsp;Line&nbsp;comments&nbsp;are&nbsp;not&nbsp;part&nbsp;of&nbsp;any&nbsp;published&nbsp;CSS&nbsp;standard&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504383">//&nbsp;are&nbsp;supported&nbsp;by&nbsp;the&nbsp;4&nbsp;major&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504427">//&nbsp;This&nbsp;defines&nbsp;line&nbsp;comments&nbsp;as</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504462">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINECOMMENT&nbsp;::=&nbsp;&#34;//&#34;&nbsp;[^\n\f\d]*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504503">//&nbsp;since&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nl&nbsp;defines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504566">//&nbsp;newlines:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504581">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;::=&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#xC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5504622">default</span><span class="op" id="5504629">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5504633">panic</span><span class="op" id="5504638">(</span><span class="ident" id="5504639">c</span><span class="op" id="5504640">.</span><span class="ident" id="5504641">state</span><span class="op" id="5504646">.</span><span class="ident" id="5504647">String</span><span class="op" id="5504653">(</span><span class="op" id="5504654">)</span><span class="op" id="5504655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5504658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504662">i</span>&nbsp;<span class="op" id="5504664">:=</span>&nbsp;<span class="ident" id="5504667">bytes</span><span class="op" id="5504672">.</span><span class="ident" id="5504673">IndexAny</span><span class="op" id="5504681">(</span><span class="ident" id="5504682">s</span><span class="op" id="5504683">,</span>&nbsp;<span class="ident" id="5504685">lineTerminators</span><span class="op" id="5504700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5504703">if</span>&nbsp;<span class="ident" id="5504706">i</span>&nbsp;<span class="op" id="5504708">==</span>&nbsp;<span class="op" id="5504711">-</span><span class="num" id="5504712">1</span>&nbsp;<span class="op" id="5504714">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5504718">return</span>&nbsp;<span class="ident" id="5504725">c</span><span class="op" id="5504726">,</span>&nbsp;<span class="builtinfunc" id="5504728">len</span><span class="op" id="5504731">(</span><span class="ident" id="5504732">s</span><span class="op" id="5504733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5504736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5504739">c</span><span class="op" id="5504740">.</span><span class="ident" id="5504741">state</span>&nbsp;<span class="op" id="5504747">=</span>&nbsp;<span class="ident" id="5504749">endState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504759">//&nbsp;Per&nbsp;section&nbsp;7.4&nbsp;of&nbsp;EcmaScript&nbsp;5&nbsp;:&nbsp;http://es5.github.com/#x7.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504825">//&nbsp;&#34;However,&nbsp;the&nbsp;LineTerminator&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;not</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504888">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;single-line&nbsp;comment;&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5504948">//&nbsp;recognized&nbsp;separately&nbsp;by&nbsp;the&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;becomes&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505014">//&nbsp;of&nbsp;the&nbsp;stream&nbsp;of&nbsp;input&nbsp;elements&nbsp;for&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5505078">return</span>&nbsp;<span class="ident" id="5505085">c</span><span class="op" id="5505086">,</span>&nbsp;<span class="ident" id="5505088">i</span><br>
<span class="lineno"></span><span class="op" id="5505090">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="5505093">//&nbsp;tCSS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5505155">func</span>&nbsp;<span class="ident" id="5505160">tCSS</span><span class="op" id="5505164">(</span><span class="ident" id="5505165">c</span>&nbsp;<span class="ident" id="5505167">context</span><span class="op" id="5505174">,</span>&nbsp;<span class="ident" id="5505176">s</span>&nbsp;<span class="op" id="5505178">[</span><span class="op" id="5505179">]</span><span class="builtintype" id="5505180">byte</span><span class="op" id="5505184">)</span>&nbsp;<span class="op" id="5505186">(</span><span class="ident" id="5505187">context</span><span class="op" id="5505194">,</span>&nbsp;<span class="builtintype" id="5505196">int</span><span class="op" id="5505199">)</span>&nbsp;<span class="op" id="5505201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505204">//&nbsp;CSS&nbsp;quoted&nbsp;strings&nbsp;are&nbsp;almost&nbsp;never&nbsp;used&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505261">//&nbsp;(1)&nbsp;URLs&nbsp;as&nbsp;in&nbsp;background:&nbsp;&#34;/foo.png&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505303">//&nbsp;(2)&nbsp;Multiword&nbsp;font-names&nbsp;as&nbsp;in&nbsp;font-family:&nbsp;&#34;Times&nbsp;New&nbsp;Roman&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505369">//&nbsp;(3)&nbsp;List&nbsp;separators&nbsp;in&nbsp;content&nbsp;values&nbsp;as&nbsp;in&nbsp;inline-lists:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505431">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505446">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;{&nbsp;list-style:&nbsp;none;&nbsp;padding:0&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505499">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li&nbsp;{&nbsp;display:&nbsp;inline&nbsp;}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505545">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:before&nbsp;{&nbsp;content:&nbsp;&#34;,&nbsp;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505596">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:first-child:before&nbsp;{&nbsp;content:&nbsp;&#34;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505657">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505673">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;class=inlineList&gt;&lt;li&gt;One&lt;li&gt;Two&lt;li&gt;Three&lt;/ul&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505730">//&nbsp;(4)&nbsp;Attribute&nbsp;value&nbsp;selectors&nbsp;as&nbsp;in&nbsp;a[href=&#34;http://example.com/&#34;]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505800">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505804">//&nbsp;We&nbsp;conservatively&nbsp;treat&nbsp;all&nbsp;strings&nbsp;as&nbsp;URLs,&nbsp;but&nbsp;make&nbsp;some</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505867">//&nbsp;allowances&nbsp;to&nbsp;avoid&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505902">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505906">//&nbsp;In&nbsp;(1),&nbsp;our&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;justified.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5505960">//&nbsp;In&nbsp;(2),&nbsp;valid&nbsp;font&nbsp;names&nbsp;do&nbsp;not&nbsp;contain&nbsp;&#39;:&#39;,&nbsp;&#39;?&#39;,&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5506029">//&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;fine&nbsp;since&nbsp;we&nbsp;will&nbsp;never&nbsp;transition&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5506101">//&nbsp;urlPartPreQuery.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5506122">//&nbsp;In&nbsp;(3),&nbsp;our&nbsp;protocol&nbsp;heuristic&nbsp;should&nbsp;not&nbsp;be&nbsp;tripped,&nbsp;and&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5506190">//&nbsp;should&nbsp;not&nbsp;be&nbsp;non-space&nbsp;content&nbsp;after&nbsp;a&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5506260">//&nbsp;we&nbsp;only&nbsp;%-encode&nbsp;RFC&nbsp;3986&nbsp;reserved&nbsp;characters&nbsp;we&nbsp;are&nbsp;ok.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5506321">//&nbsp;In&nbsp;(4),&nbsp;we&nbsp;should&nbsp;URL&nbsp;escape&nbsp;for&nbsp;URL&nbsp;attributes,&nbsp;and&nbsp;for&nbsp;others&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5506392">//&nbsp;have&nbsp;the&nbsp;attribute&nbsp;name&nbsp;available&nbsp;if&nbsp;our&nbsp;conservative&nbsp;assumption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5506461">//&nbsp;proves&nbsp;problematic&nbsp;for&nbsp;real&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5506500">k</span>&nbsp;<span class="op" id="5506502">:=</span>&nbsp;<span class="num" id="5506505">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506508">for</span>&nbsp;<span class="op" id="5506512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5506516">i</span>&nbsp;<span class="op" id="5506518">:=</span>&nbsp;<span class="ident" id="5506521">k</span>&nbsp;<span class="op" id="5506523">+</span>&nbsp;<span class="ident" id="5506525">bytes</span><span class="op" id="5506530">.</span><span class="ident" id="5506531">IndexAny</span><span class="op" id="5506539">(</span><span class="ident" id="5506540">s</span><span class="op" id="5506541">[</span><span class="ident" id="5506542">k</span><span class="op" id="5506543">:</span><span class="op" id="5506544">]</span><span class="op" id="5506545">,</span>&nbsp;<span class="string" id="5506547">`(&#34;&#39;/`</span><span class="op" id="5506553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506557">if</span>&nbsp;<span class="ident" id="5506560">i</span>&nbsp;<span class="op" id="5506562">&lt;</span>&nbsp;<span class="ident" id="5506564">k</span>&nbsp;<span class="op" id="5506566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506571">return</span>&nbsp;<span class="ident" id="5506578">c</span><span class="op" id="5506579">,</span>&nbsp;<span class="builtinfunc" id="5506581">len</span><span class="op" id="5506584">(</span><span class="ident" id="5506585">s</span><span class="op" id="5506586">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5506590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506594">switch</span>&nbsp;<span class="ident" id="5506601">s</span><span class="op" id="5506602">[</span><span class="ident" id="5506603">i</span><span class="op" id="5506604">]</span>&nbsp;<span class="op" id="5506606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506610">case</span>&nbsp;<span class="string" id="5506615">&#39;(&#39;</span><span class="op" id="5506618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5506623">//&nbsp;Look&nbsp;for&nbsp;url&nbsp;to&nbsp;the&nbsp;left.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5506655">p</span>&nbsp;<span class="op" id="5506657">:=</span>&nbsp;<span class="ident" id="5506660">bytes</span><span class="op" id="5506665">.</span><span class="ident" id="5506666">TrimRight</span><span class="op" id="5506675">(</span><span class="ident" id="5506676">s</span><span class="op" id="5506677">[</span><span class="op" id="5506678">:</span><span class="ident" id="5506679">i</span><span class="op" id="5506680">]</span><span class="op" id="5506681">,</span>&nbsp;<span class="string" id="5506683">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="5506694">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506699">if</span>&nbsp;<span class="ident" id="5506702">endsWithCSSKeyword</span><span class="op" id="5506720">(</span><span class="ident" id="5506721">p</span><span class="op" id="5506722">,</span>&nbsp;<span class="string" id="5506724">&#34;url&#34;</span><span class="op" id="5506729">)</span>&nbsp;<span class="op" id="5506731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5506737">j</span>&nbsp;<span class="op" id="5506739">:=</span>&nbsp;<span class="builtinfunc" id="5506742">len</span><span class="op" id="5506745">(</span><span class="ident" id="5506746">s</span><span class="op" id="5506747">)</span>&nbsp;<span class="op" id="5506749">-</span>&nbsp;<span class="builtinfunc" id="5506751">len</span><span class="op" id="5506754">(</span><span class="ident" id="5506755">bytes</span><span class="op" id="5506760">.</span><span class="ident" id="5506761">TrimLeft</span><span class="op" id="5506769">(</span><span class="ident" id="5506770">s</span><span class="op" id="5506771">[</span><span class="ident" id="5506772">i</span><span class="op" id="5506773">+</span><span class="num" id="5506774">1</span><span class="op" id="5506775">:</span><span class="op" id="5506776">]</span><span class="op" id="5506777">,</span>&nbsp;<span class="string" id="5506779">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="5506790">)</span><span class="op" id="5506791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506797">switch</span>&nbsp;<span class="op" id="5506804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506810">case</span>&nbsp;<span class="ident" id="5506815">j</span>&nbsp;<span class="op" id="5506817">!=</span>&nbsp;<span class="builtinfunc" id="5506820">len</span><span class="op" id="5506823">(</span><span class="ident" id="5506824">s</span><span class="op" id="5506825">)</span>&nbsp;<span class="op" id="5506827">&amp;&amp;</span>&nbsp;<span class="ident" id="5506830">s</span><span class="op" id="5506831">[</span><span class="ident" id="5506832">j</span><span class="op" id="5506833">]</span>&nbsp;<span class="op" id="5506835">==</span>&nbsp;<span class="string" id="5506838">&#39;&#34;&#39;</span><span class="op" id="5506841">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5506848">c</span><span class="op" id="5506849">.</span><span class="ident" id="5506850">state</span><span class="op" id="5506855">,</span>&nbsp;<span class="ident" id="5506857">j</span>&nbsp;<span class="op" id="5506859">=</span>&nbsp;<span class="ident" id="5506861">stateCSSDqURL</span><span class="op" id="5506874">,</span>&nbsp;<span class="ident" id="5506876">j</span><span class="op" id="5506877">+</span><span class="num" id="5506878">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506884">case</span>&nbsp;<span class="ident" id="5506889">j</span>&nbsp;<span class="op" id="5506891">!=</span>&nbsp;<span class="builtinfunc" id="5506894">len</span><span class="op" id="5506897">(</span><span class="ident" id="5506898">s</span><span class="op" id="5506899">)</span>&nbsp;<span class="op" id="5506901">&amp;&amp;</span>&nbsp;<span class="ident" id="5506904">s</span><span class="op" id="5506905">[</span><span class="ident" id="5506906">j</span><span class="op" id="5506907">]</span>&nbsp;<span class="op" id="5506909">==</span>&nbsp;<span class="string" id="5506912">&#39;\&#39;&#39;</span><span class="op" id="5506916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5506923">c</span><span class="op" id="5506924">.</span><span class="ident" id="5506925">state</span><span class="op" id="5506930">,</span>&nbsp;<span class="ident" id="5506932">j</span>&nbsp;<span class="op" id="5506934">=</span>&nbsp;<span class="ident" id="5506936">stateCSSSqURL</span><span class="op" id="5506949">,</span>&nbsp;<span class="ident" id="5506951">j</span><span class="op" id="5506952">+</span><span class="num" id="5506953">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5506959">default</span><span class="op" id="5506966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5506973">c</span><span class="op" id="5506974">.</span><span class="ident" id="5506975">state</span>&nbsp;<span class="op" id="5506981">=</span>&nbsp;<span class="ident" id="5506983">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5506999">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507005">return</span>&nbsp;<span class="ident" id="5507012">c</span><span class="op" id="5507013">,</span>&nbsp;<span class="ident" id="5507015">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5507020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507024">case</span>&nbsp;<span class="string" id="5507029">&#39;/&#39;</span><span class="op" id="5507032">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507037">if</span>&nbsp;<span class="ident" id="5507040">i</span><span class="op" id="5507041">+</span><span class="num" id="5507042">1</span>&nbsp;<span class="op" id="5507044">&lt;</span>&nbsp;<span class="builtinfunc" id="5507046">len</span><span class="op" id="5507049">(</span><span class="ident" id="5507050">s</span><span class="op" id="5507051">)</span>&nbsp;<span class="op" id="5507053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507059">switch</span>&nbsp;<span class="ident" id="5507066">s</span><span class="op" id="5507067">[</span><span class="ident" id="5507068">i</span><span class="op" id="5507069">+</span><span class="num" id="5507070">1</span><span class="op" id="5507071">]</span>&nbsp;<span class="op" id="5507073">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507079">case</span>&nbsp;<span class="string" id="5507084">&#39;/&#39;</span><span class="op" id="5507087">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507094">c</span><span class="op" id="5507095">.</span><span class="ident" id="5507096">state</span>&nbsp;<span class="op" id="5507102">=</span>&nbsp;<span class="ident" id="5507104">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507125">return</span>&nbsp;<span class="ident" id="5507132">c</span><span class="op" id="5507133">,</span>&nbsp;<span class="ident" id="5507135">i</span>&nbsp;<span class="op" id="5507137">+</span>&nbsp;<span class="num" id="5507139">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507145">case</span>&nbsp;<span class="string" id="5507150">&#39;*&#39;</span><span class="op" id="5507153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507160">c</span><span class="op" id="5507161">.</span><span class="ident" id="5507162">state</span>&nbsp;<span class="op" id="5507168">=</span>&nbsp;<span class="ident" id="5507170">stateCSSBlockCmt</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507192">return</span>&nbsp;<span class="ident" id="5507199">c</span><span class="op" id="5507200">,</span>&nbsp;<span class="ident" id="5507202">i</span>&nbsp;<span class="op" id="5507204">+</span>&nbsp;<span class="num" id="5507206">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5507212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5507217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507221">case</span>&nbsp;<span class="string" id="5507226">&#39;&#34;&#39;</span><span class="op" id="5507229">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507234">c</span><span class="op" id="5507235">.</span><span class="ident" id="5507236">state</span>&nbsp;<span class="op" id="5507242">=</span>&nbsp;<span class="ident" id="5507244">stateCSSDqStr</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507261">return</span>&nbsp;<span class="ident" id="5507268">c</span><span class="op" id="5507269">,</span>&nbsp;<span class="ident" id="5507271">i</span>&nbsp;<span class="op" id="5507273">+</span>&nbsp;<span class="num" id="5507275">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507279">case</span>&nbsp;<span class="string" id="5507284">&#39;\&#39;&#39;</span><span class="op" id="5507288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507293">c</span><span class="op" id="5507294">.</span><span class="ident" id="5507295">state</span>&nbsp;<span class="op" id="5507301">=</span>&nbsp;<span class="ident" id="5507303">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507320">return</span>&nbsp;<span class="ident" id="5507327">c</span><span class="op" id="5507328">,</span>&nbsp;<span class="ident" id="5507330">i</span>&nbsp;<span class="op" id="5507332">+</span>&nbsp;<span class="num" id="5507334">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5507338">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507342">k</span>&nbsp;<span class="op" id="5507344">=</span>&nbsp;<span class="ident" id="5507346">i</span>&nbsp;<span class="op" id="5507348">+</span>&nbsp;<span class="num" id="5507350">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5507353">}</span><br>
<span class="lineno"></span><span class="op" id="5507355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5507358">//&nbsp;tCSSStr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;string&nbsp;and&nbsp;URL&nbsp;states.</span><br>
<span class="lineno">435</span><span class="keyword" id="5507439">func</span>&nbsp;<span class="ident" id="5507444">tCSSStr</span><span class="op" id="5507451">(</span><span class="ident" id="5507452">c</span>&nbsp;<span class="ident" id="5507454">context</span><span class="op" id="5507461">,</span>&nbsp;<span class="ident" id="5507463">s</span>&nbsp;<span class="op" id="5507465">[</span><span class="op" id="5507466">]</span><span class="builtintype" id="5507467">byte</span><span class="op" id="5507471">)</span>&nbsp;<span class="op" id="5507473">(</span><span class="ident" id="5507474">context</span><span class="op" id="5507481">,</span>&nbsp;<span class="builtintype" id="5507483">int</span><span class="op" id="5507486">)</span>&nbsp;<span class="op" id="5507488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507491">var</span>&nbsp;<span class="ident" id="5507495">endAndEsc</span>&nbsp;<span class="builtintype" id="5507505">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507513">switch</span>&nbsp;<span class="ident" id="5507520">c</span><span class="op" id="5507521">.</span><span class="ident" id="5507522">state</span>&nbsp;<span class="op" id="5507528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507531">case</span>&nbsp;<span class="ident" id="5507536">stateCSSDqStr</span><span class="op" id="5507549">,</span>&nbsp;<span class="ident" id="5507551">stateCSSDqURL</span><span class="op" id="5507564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507568">endAndEsc</span>&nbsp;<span class="op" id="5507578">=</span>&nbsp;<span class="string" id="5507580">`\&#34;`</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507586">case</span>&nbsp;<span class="ident" id="5507591">stateCSSSqStr</span><span class="op" id="5507604">,</span>&nbsp;<span class="ident" id="5507606">stateCSSSqURL</span><span class="op" id="5507619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507623">endAndEsc</span>&nbsp;<span class="op" id="5507633">=</span>&nbsp;<span class="string" id="5507635">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507641">case</span>&nbsp;<span class="ident" id="5507646">stateCSSURL</span><span class="op" id="5507657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5507661">//&nbsp;Unquoted&nbsp;URLs&nbsp;end&nbsp;with&nbsp;a&nbsp;newline&nbsp;or&nbsp;close&nbsp;parenthesis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5507721">//&nbsp;The&nbsp;below&nbsp;includes&nbsp;the&nbsp;wc&nbsp;(whitespace&nbsp;character)&nbsp;and&nbsp;nl.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507783">endAndEsc</span>&nbsp;<span class="op" id="5507793">=</span>&nbsp;<span class="string" id="5507795">&#34;\\\t\n\f\r&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507811">default</span><span class="op" id="5507818">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5507822">panic</span><span class="op" id="5507827">(</span><span class="ident" id="5507828">c</span><span class="op" id="5507829">.</span><span class="ident" id="5507830">state</span><span class="op" id="5507835">.</span><span class="ident" id="5507836">String</span><span class="op" id="5507842">(</span><span class="op" id="5507843">)</span><span class="op" id="5507844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5507847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507851">k</span>&nbsp;<span class="op" id="5507853">:=</span>&nbsp;<span class="num" id="5507856">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507859">for</span>&nbsp;<span class="op" id="5507863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507867">i</span>&nbsp;<span class="op" id="5507869">:=</span>&nbsp;<span class="ident" id="5507872">k</span>&nbsp;<span class="op" id="5507874">+</span>&nbsp;<span class="ident" id="5507876">bytes</span><span class="op" id="5507881">.</span><span class="ident" id="5507882">IndexAny</span><span class="op" id="5507890">(</span><span class="ident" id="5507891">s</span><span class="op" id="5507892">[</span><span class="ident" id="5507893">k</span><span class="op" id="5507894">:</span><span class="op" id="5507895">]</span><span class="op" id="5507896">,</span>&nbsp;<span class="ident" id="5507898">endAndEsc</span><span class="op" id="5507907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507911">if</span>&nbsp;<span class="ident" id="5507914">i</span>&nbsp;<span class="op" id="5507916">&lt;</span>&nbsp;<span class="ident" id="5507918">k</span>&nbsp;<span class="op" id="5507920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5507925">c</span><span class="op" id="5507926">,</span>&nbsp;<span class="ident" id="5507928">nread</span>&nbsp;<span class="op" id="5507934">:=</span>&nbsp;<span class="ident" id="5507937">tURL</span><span class="op" id="5507941">(</span><span class="ident" id="5507942">c</span><span class="op" id="5507943">,</span>&nbsp;<span class="ident" id="5507945">decodeCSS</span><span class="op" id="5507954">(</span><span class="ident" id="5507955">s</span><span class="op" id="5507956">[</span><span class="ident" id="5507957">k</span><span class="op" id="5507958">:</span><span class="op" id="5507959">]</span><span class="op" id="5507960">)</span><span class="op" id="5507961">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507966">return</span>&nbsp;<span class="ident" id="5507973">c</span><span class="op" id="5507974">,</span>&nbsp;<span class="ident" id="5507976">k</span>&nbsp;<span class="op" id="5507978">+</span>&nbsp;<span class="ident" id="5507980">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5507988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5507992">if</span>&nbsp;<span class="ident" id="5507995">s</span><span class="op" id="5507996">[</span><span class="ident" id="5507997">i</span><span class="op" id="5507998">]</span>&nbsp;<span class="op" id="5508000">==</span>&nbsp;<span class="string" id="5508003">&#39;\\&#39;</span>&nbsp;<span class="op" id="5508008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5508013">i</span><span class="op" id="5508014">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508020">if</span>&nbsp;<span class="ident" id="5508023">i</span>&nbsp;<span class="op" id="5508025">==</span>&nbsp;<span class="builtinfunc" id="5508028">len</span><span class="op" id="5508031">(</span><span class="ident" id="5508032">s</span><span class="op" id="5508033">)</span>&nbsp;<span class="op" id="5508035">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508041">return</span>&nbsp;<span class="ident" id="5508048">context</span><span class="op" id="5508055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5508062">state</span><span class="op" id="5508067">:</span>&nbsp;<span class="ident" id="5508069">stateError</span><span class="op" id="5508079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5508086">err</span><span class="op" id="5508089">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5508093">errorf</span><span class="op" id="5508099">(</span><span class="ident" id="5508100">ErrPartialEscape</span><span class="op" id="5508116">,</span>&nbsp;<span class="ident" id="5508118">nil</span><span class="op" id="5508121">,</span>&nbsp;<span class="num" id="5508123">0</span><span class="op" id="5508124">,</span>&nbsp;<span class="string" id="5508126">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;CSS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="5508172">,</span>&nbsp;<span class="ident" id="5508174">s</span><span class="op" id="5508175">)</span><span class="op" id="5508176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5508182">}</span><span class="op" id="5508183">,</span>&nbsp;<span class="builtinfunc" id="5508185">len</span><span class="op" id="5508188">(</span><span class="ident" id="5508189">s</span><span class="op" id="5508190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5508195">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5508199">}</span>&nbsp;<span class="keyword" id="5508201">else</span>&nbsp;<span class="op" id="5508206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5508211">c</span><span class="op" id="5508212">.</span><span class="ident" id="5508213">state</span>&nbsp;<span class="op" id="5508219">=</span>&nbsp;<span class="ident" id="5508221">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508233">return</span>&nbsp;<span class="ident" id="5508240">c</span><span class="op" id="5508241">,</span>&nbsp;<span class="ident" id="5508243">i</span>&nbsp;<span class="op" id="5508245">+</span>&nbsp;<span class="num" id="5508247">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5508251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5508255">c</span><span class="op" id="5508256">,</span>&nbsp;<span class="ident" id="5508258">_</span>&nbsp;<span class="op" id="5508260">=</span>&nbsp;<span class="ident" id="5508262">tURL</span><span class="op" id="5508266">(</span><span class="ident" id="5508267">c</span><span class="op" id="5508268">,</span>&nbsp;<span class="ident" id="5508270">decodeCSS</span><span class="op" id="5508279">(</span><span class="ident" id="5508280">s</span><span class="op" id="5508281">[</span><span class="op" id="5508282">:</span><span class="ident" id="5508283">i</span><span class="op" id="5508284">+</span><span class="num" id="5508285">1</span><span class="op" id="5508286">]</span><span class="op" id="5508287">)</span><span class="op" id="5508288">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5508292">k</span>&nbsp;<span class="op" id="5508294">=</span>&nbsp;<span class="ident" id="5508296">i</span>&nbsp;<span class="op" id="5508298">+</span>&nbsp;<span class="num" id="5508300">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5508303">}</span><br>
<span class="lineno"></span><span class="op" id="5508305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5508308">//&nbsp;tError&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;error&nbsp;state.</span><br>
<span class="lineno">475</span><span class="keyword" id="5508374">func</span>&nbsp;<span class="ident" id="5508379">tError</span><span class="op" id="5508385">(</span><span class="ident" id="5508386">c</span>&nbsp;<span class="ident" id="5508388">context</span><span class="op" id="5508395">,</span>&nbsp;<span class="ident" id="5508397">s</span>&nbsp;<span class="op" id="5508399">[</span><span class="op" id="5508400">]</span><span class="builtintype" id="5508401">byte</span><span class="op" id="5508405">)</span>&nbsp;<span class="op" id="5508407">(</span><span class="ident" id="5508408">context</span><span class="op" id="5508415">,</span>&nbsp;<span class="builtintype" id="5508417">int</span><span class="op" id="5508420">)</span>&nbsp;<span class="op" id="5508422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508425">return</span>&nbsp;<span class="ident" id="5508432">c</span><span class="op" id="5508433">,</span>&nbsp;<span class="builtinfunc" id="5508435">len</span><span class="op" id="5508438">(</span><span class="ident" id="5508439">s</span><span class="op" id="5508440">)</span><br>
<span class="lineno"></span><span class="op" id="5508442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5508445">//&nbsp;eatAttrName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">480</span><span class="comment" id="5508521">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;s[i:]&nbsp;does&nbsp;not&nbsp;look&nbsp;like&nbsp;it&nbsp;begins&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5508590">//&nbsp;attribute&nbsp;name,&nbsp;such&nbsp;as&nbsp;encountering&nbsp;a&nbsp;quote&nbsp;mark&nbsp;without&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="5508663">//&nbsp;equals&nbsp;sign.</span><br>
<span class="lineno"></span><span class="keyword" id="5508679">func</span>&nbsp;<span class="ident" id="5508684">eatAttrName</span><span class="op" id="5508695">(</span><span class="ident" id="5508696">s</span>&nbsp;<span class="op" id="5508698">[</span><span class="op" id="5508699">]</span><span class="builtintype" id="5508700">byte</span><span class="op" id="5508704">,</span>&nbsp;<span class="ident" id="5508706">i</span>&nbsp;<span class="builtintype" id="5508708">int</span><span class="op" id="5508711">)</span>&nbsp;<span class="op" id="5508713">(</span><span class="builtintype" id="5508714">int</span><span class="op" id="5508717">,</span>&nbsp;<span class="op" id="5508719">*</span><span class="ident" id="5508720">Error</span><span class="op" id="5508725">)</span>&nbsp;<span class="op" id="5508727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508730">for</span>&nbsp;<span class="ident" id="5508734">j</span>&nbsp;<span class="op" id="5508736">:=</span>&nbsp;<span class="ident" id="5508739">i</span><span class="op" id="5508740">;</span>&nbsp;<span class="ident" id="5508742">j</span>&nbsp;<span class="op" id="5508744">&lt;</span>&nbsp;<span class="builtinfunc" id="5508746">len</span><span class="op" id="5508749">(</span><span class="ident" id="5508750">s</span><span class="op" id="5508751">)</span><span class="op" id="5508752">;</span>&nbsp;<span class="ident" id="5508754">j</span><span class="op" id="5508755">++</span>&nbsp;<span class="op" id="5508758">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508762">switch</span>&nbsp;<span class="ident" id="5508769">s</span><span class="op" id="5508770">[</span><span class="ident" id="5508771">j</span><span class="op" id="5508772">]</span>&nbsp;<span class="op" id="5508774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508778">case</span>&nbsp;<span class="string" id="5508783">&#39;&nbsp;&#39;</span><span class="op" id="5508786">,</span>&nbsp;<span class="string" id="5508788">&#39;\t&#39;</span><span class="op" id="5508792">,</span>&nbsp;<span class="string" id="5508794">&#39;\n&#39;</span><span class="op" id="5508798">,</span>&nbsp;<span class="string" id="5508800">&#39;\f&#39;</span><span class="op" id="5508804">,</span>&nbsp;<span class="string" id="5508806">&#39;\r&#39;</span><span class="op" id="5508810">,</span>&nbsp;<span class="string" id="5508812">&#39;=&#39;</span><span class="op" id="5508815">,</span>&nbsp;<span class="string" id="5508817">&#39;&gt;&#39;</span><span class="op" id="5508820">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508825">return</span>&nbsp;<span class="ident" id="5508832">j</span><span class="op" id="5508833">,</span>&nbsp;<span class="ident" id="5508835">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5508841">case</span>&nbsp;<span class="string" id="5508846">&#39;\&#39;&#39;</span><span class="op" id="5508850">,</span>&nbsp;<span class="string" id="5508852">&#39;&#34;&#39;</span><span class="op" id="5508855">,</span>&nbsp;<span class="string" id="5508857">&#39;&lt;&#39;</span><span class="op" id="5508860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5508865">//&nbsp;These&nbsp;result&nbsp;in&nbsp;a&nbsp;parse&nbsp;warning&nbsp;in&nbsp;HTML5&nbsp;and&nbsp;are</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5508920">//&nbsp;indicative&nbsp;of&nbsp;serious&nbsp;problems&nbsp;if&nbsp;seen&nbsp;in&nbsp;an&nbsp;attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5508976">//&nbsp;name&nbsp;in&nbsp;a&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509002">return</span>&nbsp;<span class="op" id="5509009">-</span><span class="num" id="5509010">1</span><span class="op" id="5509011">,</span>&nbsp;<span class="ident" id="5509013">errorf</span><span class="op" id="5509019">(</span><span class="ident" id="5509020">ErrBadHTML</span><span class="op" id="5509030">,</span>&nbsp;<span class="ident" id="5509032">nil</span><span class="op" id="5509035">,</span>&nbsp;<span class="num" id="5509037">0</span><span class="op" id="5509038">,</span>&nbsp;<span class="string" id="5509040">&#34;%q&nbsp;in&nbsp;attribute&nbsp;name:&nbsp;%.32q&#34;</span><span class="op" id="5509069">,</span>&nbsp;<span class="ident" id="5509071">s</span><span class="op" id="5509072">[</span><span class="ident" id="5509073">j</span><span class="op" id="5509074">:</span><span class="ident" id="5509075">j</span><span class="op" id="5509076">+</span><span class="num" id="5509077">1</span><span class="op" id="5509078">]</span><span class="op" id="5509079">,</span>&nbsp;<span class="ident" id="5509081">s</span><span class="op" id="5509082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509086">default</span><span class="op" id="5509093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5509098">//&nbsp;No-op.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5509110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5509113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509116">return</span>&nbsp;<span class="builtinfunc" id="5509123">len</span><span class="op" id="5509126">(</span><span class="ident" id="5509127">s</span><span class="op" id="5509128">)</span><span class="op" id="5509129">,</span>&nbsp;<span class="ident" id="5509131">nil</span><br>
<span class="lineno"></span><span class="op" id="5509135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5509138">var</span>&nbsp;<span class="ident" id="5509142">elementNameMap</span>&nbsp;<span class="op" id="5509157">=</span>&nbsp;<span class="keyword" id="5509159">map</span><span class="op" id="5509162">[</span><span class="builtintype" id="5509163">string</span><span class="op" id="5509169">]</span><span class="ident" id="5509170">element</span><span class="op" id="5509177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5509180">&#34;script&#34;</span><span class="op" id="5509188">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5509192">elementScript</span><span class="op" id="5509205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5509208">&#34;style&#34;</span><span class="op" id="5509215">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509220">elementStyle</span><span class="op" id="5509232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5509235">&#34;textarea&#34;</span><span class="op" id="5509245">:</span>&nbsp;<span class="ident" id="5509247">elementTextarea</span><span class="op" id="5509262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5509265">&#34;title&#34;</span><span class="op" id="5509272">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509277">elementTitle</span><span class="op" id="5509289">,</span><br>
<span class="lineno">505</span><span class="op" id="5509291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5509294">//&nbsp;asciiAlpha&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="5509346">func</span>&nbsp;<span class="ident" id="5509351">asciiAlpha</span><span class="op" id="5509361">(</span><span class="ident" id="5509362">c</span>&nbsp;<span class="builtintype" id="5509364">byte</span><span class="op" id="5509368">)</span>&nbsp;<span class="builtintype" id="5509370">bool</span>&nbsp;<span class="op" id="5509375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509378">return</span>&nbsp;<span class="string" id="5509385">&#39;A&#39;</span>&nbsp;<span class="op" id="5509389">&lt;=</span>&nbsp;<span class="ident" id="5509392">c</span>&nbsp;<span class="op" id="5509394">&amp;&amp;</span>&nbsp;<span class="ident" id="5509397">c</span>&nbsp;<span class="op" id="5509399">&lt;=</span>&nbsp;<span class="string" id="5509402">&#39;Z&#39;</span>&nbsp;<span class="op" id="5509406">||</span>&nbsp;<span class="string" id="5509409">&#39;a&#39;</span>&nbsp;<span class="op" id="5509413">&lt;=</span>&nbsp;<span class="ident" id="5509416">c</span>&nbsp;<span class="op" id="5509418">&amp;&amp;</span>&nbsp;<span class="ident" id="5509421">c</span>&nbsp;<span class="op" id="5509423">&lt;=</span>&nbsp;<span class="string" id="5509426">&#39;z&#39;</span><br>
<span class="lineno">510</span><span class="op" id="5509430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5509433">//&nbsp;asciiAlphaNum&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;or&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="5509497">func</span>&nbsp;<span class="ident" id="5509502">asciiAlphaNum</span><span class="op" id="5509515">(</span><span class="ident" id="5509516">c</span>&nbsp;<span class="builtintype" id="5509518">byte</span><span class="op" id="5509522">)</span>&nbsp;<span class="builtintype" id="5509524">bool</span>&nbsp;<span class="op" id="5509529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509532">return</span>&nbsp;<span class="ident" id="5509539">asciiAlpha</span><span class="op" id="5509549">(</span><span class="ident" id="5509550">c</span><span class="op" id="5509551">)</span>&nbsp;<span class="op" id="5509553">||</span>&nbsp;<span class="string" id="5509556">&#39;0&#39;</span>&nbsp;<span class="op" id="5509560">&lt;=</span>&nbsp;<span class="ident" id="5509563">c</span>&nbsp;<span class="op" id="5509565">&amp;&amp;</span>&nbsp;<span class="ident" id="5509568">c</span>&nbsp;<span class="op" id="5509570">&lt;=</span>&nbsp;<span class="string" id="5509573">&#39;9&#39;</span><br>
<span class="lineno">515</span><span class="op" id="5509577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5509580">//&nbsp;eatTagName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;a&nbsp;tag&nbsp;name&nbsp;and&nbsp;the&nbsp;tag&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5509665">func</span>&nbsp;<span class="ident" id="5509670">eatTagName</span><span class="op" id="5509680">(</span><span class="ident" id="5509681">s</span>&nbsp;<span class="op" id="5509683">[</span><span class="op" id="5509684">]</span><span class="builtintype" id="5509685">byte</span><span class="op" id="5509689">,</span>&nbsp;<span class="ident" id="5509691">i</span>&nbsp;<span class="builtintype" id="5509693">int</span><span class="op" id="5509696">)</span>&nbsp;<span class="op" id="5509698">(</span><span class="builtintype" id="5509699">int</span><span class="op" id="5509702">,</span>&nbsp;<span class="ident" id="5509704">element</span><span class="op" id="5509711">)</span>&nbsp;<span class="op" id="5509713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509716">if</span>&nbsp;<span class="ident" id="5509719">i</span>&nbsp;<span class="op" id="5509721">==</span>&nbsp;<span class="builtinfunc" id="5509724">len</span><span class="op" id="5509727">(</span><span class="ident" id="5509728">s</span><span class="op" id="5509729">)</span>&nbsp;<span class="op" id="5509731">||</span>&nbsp;<span class="op" id="5509734">!</span><span class="ident" id="5509735">asciiAlpha</span><span class="op" id="5509745">(</span><span class="ident" id="5509746">s</span><span class="op" id="5509747">[</span><span class="ident" id="5509748">i</span><span class="op" id="5509749">]</span><span class="op" id="5509750">)</span>&nbsp;<span class="op" id="5509752">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509756">return</span>&nbsp;<span class="ident" id="5509763">i</span><span class="op" id="5509764">,</span>&nbsp;<span class="ident" id="5509766">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5509779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509782">j</span>&nbsp;<span class="op" id="5509784">:=</span>&nbsp;<span class="ident" id="5509787">i</span>&nbsp;<span class="op" id="5509789">+</span>&nbsp;<span class="num" id="5509791">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509794">for</span>&nbsp;<span class="ident" id="5509798">j</span>&nbsp;<span class="op" id="5509800">&lt;</span>&nbsp;<span class="builtinfunc" id="5509802">len</span><span class="op" id="5509805">(</span><span class="ident" id="5509806">s</span><span class="op" id="5509807">)</span>&nbsp;<span class="op" id="5509809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509813">x</span>&nbsp;<span class="op" id="5509815">:=</span>&nbsp;<span class="ident" id="5509818">s</span><span class="op" id="5509819">[</span><span class="ident" id="5509820">j</span><span class="op" id="5509821">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509825">if</span>&nbsp;<span class="ident" id="5509828">asciiAlphaNum</span><span class="op" id="5509841">(</span><span class="ident" id="5509842">x</span><span class="op" id="5509843">)</span>&nbsp;<span class="op" id="5509845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5509850">j</span><span class="op" id="5509851">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509857">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5509868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5509872">//&nbsp;Allow&nbsp;&#34;x-y&#34;&nbsp;or&nbsp;&#34;x:y&#34;&nbsp;but&nbsp;not&nbsp;&#34;x-&#34;,&nbsp;&#34;-y&#34;,&nbsp;or&nbsp;&#34;x--y&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5509929">if</span>&nbsp;<span class="op" id="5509932">(</span><span class="ident" id="5509933">x</span>&nbsp;<span class="op" id="5509935">==</span>&nbsp;<span class="string" id="5509938">&#39;:&#39;</span>&nbsp;<span class="op" id="5509942">||</span>&nbsp;<span class="ident" id="5509945">x</span>&nbsp;<span class="op" id="5509947">==</span>&nbsp;<span class="string" id="5509950">&#39;-&#39;</span><span class="op" id="5509953">)</span>&nbsp;<span class="op" id="5509955">&amp;&amp;</span>&nbsp;<span class="ident" id="5509958">j</span><span class="op" id="5509959">+</span><span class="num" id="5509960">1</span>&nbsp;<span class="op" id="5509962">&lt;</span>&nbsp;<span class="builtinfunc" id="5509964">len</span><span class="op" id="5509967">(</span><span class="ident" id="5509968">s</span><span class="op" id="5509969">)</span>&nbsp;<span class="op" id="5509971">&amp;&amp;</span>&nbsp;<span class="ident" id="5509974">asciiAlphaNum</span><span class="op" id="5509987">(</span><span class="ident" id="5509988">s</span><span class="op" id="5509989">[</span><span class="ident" id="5509990">j</span><span class="op" id="5509991">+</span><span class="num" id="5509992">1</span><span class="op" id="5509993">]</span><span class="op" id="5509994">)</span>&nbsp;<span class="op" id="5509996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5510001">j</span>&nbsp;<span class="op" id="5510003">+=</span>&nbsp;<span class="num" id="5510006">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510011">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5510022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510026">break</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5510033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510036">return</span>&nbsp;<span class="ident" id="5510043">j</span><span class="op" id="5510044">,</span>&nbsp;<span class="ident" id="5510046">elementNameMap</span><span class="op" id="5510060">[</span><span class="ident" id="5510061">strings</span><span class="op" id="5510068">.</span><span class="ident" id="5510069">ToLower</span><span class="op" id="5510076">(</span><span class="builtintype" id="5510077">string</span><span class="op" id="5510083">(</span><span class="ident" id="5510084">s</span><span class="op" id="5510085">[</span><span class="ident" id="5510086">i</span><span class="op" id="5510087">:</span><span class="ident" id="5510088">j</span><span class="op" id="5510089">]</span><span class="op" id="5510090">)</span><span class="op" id="5510091">)</span><span class="op" id="5510092">]</span><br>
<span class="lineno"></span><span class="op" id="5510094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5510097">//&nbsp;eatWhiteSpace&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;white&nbsp;space.</span><br>
<span class="lineno">540</span><span class="keyword" id="5510169">func</span>&nbsp;<span class="ident" id="5510174">eatWhiteSpace</span><span class="op" id="5510187">(</span><span class="ident" id="5510188">s</span>&nbsp;<span class="op" id="5510190">[</span><span class="op" id="5510191">]</span><span class="builtintype" id="5510192">byte</span><span class="op" id="5510196">,</span>&nbsp;<span class="ident" id="5510198">i</span>&nbsp;<span class="builtintype" id="5510200">int</span><span class="op" id="5510203">)</span>&nbsp;<span class="builtintype" id="5510205">int</span>&nbsp;<span class="op" id="5510209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510212">for</span>&nbsp;<span class="ident" id="5510216">j</span>&nbsp;<span class="op" id="5510218">:=</span>&nbsp;<span class="ident" id="5510221">i</span><span class="op" id="5510222">;</span>&nbsp;<span class="ident" id="5510224">j</span>&nbsp;<span class="op" id="5510226">&lt;</span>&nbsp;<span class="builtinfunc" id="5510228">len</span><span class="op" id="5510231">(</span><span class="ident" id="5510232">s</span><span class="op" id="5510233">)</span><span class="op" id="5510234">;</span>&nbsp;<span class="ident" id="5510236">j</span><span class="op" id="5510237">++</span>&nbsp;<span class="op" id="5510240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510244">switch</span>&nbsp;<span class="ident" id="5510251">s</span><span class="op" id="5510252">[</span><span class="ident" id="5510253">j</span><span class="op" id="5510254">]</span>&nbsp;<span class="op" id="5510256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510260">case</span>&nbsp;<span class="string" id="5510265">&#39;&nbsp;&#39;</span><span class="op" id="5510268">,</span>&nbsp;<span class="string" id="5510270">&#39;\t&#39;</span><span class="op" id="5510274">,</span>&nbsp;<span class="string" id="5510276">&#39;\n&#39;</span><span class="op" id="5510280">,</span>&nbsp;<span class="string" id="5510282">&#39;\f&#39;</span><span class="op" id="5510286">,</span>&nbsp;<span class="string" id="5510288">&#39;\r&#39;</span><span class="op" id="5510292">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5510297">//&nbsp;No-op.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510309">default</span><span class="op" id="5510316">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510321">return</span>&nbsp;<span class="ident" id="5510328">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5510332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5510335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5510338">return</span>&nbsp;<span class="builtinfunc" id="5510345">len</span><span class="op" id="5510348">(</span><span class="ident" id="5510349">s</span><span class="op" id="5510350">)</span><br>
<span class="lineno">550</span><span class="op" id="5510352">}</span>
</div>
</body>
</html>
