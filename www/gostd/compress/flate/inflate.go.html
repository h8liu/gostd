<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4287992">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4288047">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4288101">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4288152">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-output&nbsp;fixedhuff.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4288202">//&nbsp;Package&nbsp;flate&nbsp;implements&nbsp;the&nbsp;DEFLATE&nbsp;compressed&nbsp;data&nbsp;format,&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4288279">//&nbsp;RFC&nbsp;1951.&nbsp;&nbsp;The&nbsp;gzip&nbsp;and&nbsp;zlib&nbsp;packages&nbsp;implement&nbsp;access&nbsp;to&nbsp;DEFLATE-based&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="4288359">//&nbsp;formats.</span><br>
<span class="lineno">10</span><span class="keyword" id="4288371">package</span>&nbsp;<span class="ident" id="4288379">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4288386">import</span>&nbsp;<span class="op" id="4288393">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4288396">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4288405">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4288411">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4288421">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4288424">const</span>&nbsp;<span class="op" id="4288430">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288433">maxCodeLen</span>&nbsp;<span class="op" id="4288444">=</span>&nbsp;<span class="num" id="4288446">16</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288452">//&nbsp;max&nbsp;length&nbsp;of&nbsp;Huffman&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288483">maxHist</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4288494">=</span>&nbsp;<span class="num" id="4288496">32768</span>&nbsp;<span class="comment" id="4288502">//&nbsp;max&nbsp;history&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288527">//&nbsp;The&nbsp;next&nbsp;three&nbsp;numbers&nbsp;come&nbsp;from&nbsp;the&nbsp;RFC,&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288588">maxLit</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4288597">=</span>&nbsp;<span class="num" id="4288599">286</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288604">maxDist</span>&nbsp;&nbsp;<span class="op" id="4288613">=</span>&nbsp;<span class="num" id="4288615">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288619">numCodes</span>&nbsp;<span class="op" id="4288628">=</span>&nbsp;<span class="num" id="4288630">19</span>&nbsp;<span class="comment" id="4288633">//&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;Huffman&nbsp;meta-code</span><br>
<span class="lineno">25</span><span class="op" id="4288673">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4288676">//&nbsp;A&nbsp;CorruptInputError&nbsp;reports&nbsp;the&nbsp;presence&nbsp;of&nbsp;corrupt&nbsp;input&nbsp;at&nbsp;a&nbsp;given&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4288756">type</span>&nbsp;<span class="ident" id="4288761">CorruptInputError</span>&nbsp;<span class="ident" id="4288779">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4288786">func</span>&nbsp;<span class="op" id="4288791">(</span><span class="ident" id="4288792">e</span>&nbsp;<span class="ident" id="4288794">CorruptInputError</span><span class="op" id="4288811">)</span>&nbsp;<span class="ident" id="4288813">Error</span><span class="op" id="4288818">(</span><span class="op" id="4288819">)</span>&nbsp;<span class="builtintype" id="4288821">string</span>&nbsp;<span class="op" id="4288828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288831">return</span>&nbsp;<span class="string" id="4288838">&#34;flate:&nbsp;corrupt&nbsp;input&nbsp;before&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4288876">+</span>&nbsp;<span class="ident" id="4288878">strconv</span><span class="op" id="4288885">.</span><span class="ident" id="4288886">FormatInt</span><span class="op" id="4288895">(</span><span class="ident" id="4288896">int64</span><span class="op" id="4288901">(</span><span class="ident" id="4288902">e</span><span class="op" id="4288903">)</span><span class="op" id="4288904">,</span>&nbsp;<span class="num" id="4288906">10</span><span class="op" id="4288908">)</span><br>
<span class="lineno"></span><span class="op" id="4288910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4288913">//&nbsp;An&nbsp;InternalError&nbsp;reports&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;flate&nbsp;code&nbsp;itself.</span><br>
<span class="lineno">35</span><span class="keyword" id="4288976">type</span>&nbsp;<span class="ident" id="4288981">InternalError</span>&nbsp;<span class="builtintype" id="4288995">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4289003">func</span>&nbsp;<span class="op" id="4289008">(</span><span class="ident" id="4289009">e</span>&nbsp;<span class="ident" id="4289011">InternalError</span><span class="op" id="4289024">)</span>&nbsp;<span class="ident" id="4289026">Error</span><span class="op" id="4289031">(</span><span class="op" id="4289032">)</span>&nbsp;<span class="builtintype" id="4289034">string</span>&nbsp;<span class="op" id="4289041">{</span>&nbsp;<span class="keyword" id="4289043">return</span>&nbsp;<span class="string" id="4289050">&#34;flate:&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4289076">+</span>&nbsp;<span class="builtintype" id="4289078">string</span><span class="op" id="4289084">(</span><span class="ident" id="4289085">e</span><span class="op" id="4289086">)</span>&nbsp;<span class="op" id="4289088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4289091">//&nbsp;A&nbsp;ReadError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;reading&nbsp;input.</span><br>
<span class="lineno">40</span><span class="keyword" id="4289156">type</span>&nbsp;<span class="ident" id="4289161">ReadError</span>&nbsp;<span class="keyword" id="4289171">struct</span>&nbsp;<span class="op" id="4289178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289181">Offset</span>&nbsp;<span class="ident" id="4289188">int64</span>&nbsp;<span class="comment" id="4289194">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289231">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4289238">error</span>&nbsp;<span class="comment" id="4289244">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="4289281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4289284">func</span>&nbsp;<span class="op" id="4289289">(</span><span class="ident" id="4289290">e</span>&nbsp;<span class="op" id="4289292">*</span><span class="ident" id="4289293">ReadError</span><span class="op" id="4289302">)</span>&nbsp;<span class="ident" id="4289304">Error</span><span class="op" id="4289309">(</span><span class="op" id="4289310">)</span>&nbsp;<span class="builtintype" id="4289312">string</span>&nbsp;<span class="op" id="4289319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289322">return</span>&nbsp;<span class="string" id="4289329">&#34;flate:&nbsp;read&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4289360">+</span>&nbsp;<span class="ident" id="4289362">strconv</span><span class="op" id="4289369">.</span><span class="ident" id="4289370">FormatInt</span><span class="op" id="4289379">(</span><span class="ident" id="4289380">e</span><span class="op" id="4289381">.</span><span class="ident" id="4289382">Offset</span><span class="op" id="4289388">,</span>&nbsp;<span class="num" id="4289390">10</span><span class="op" id="4289392">)</span>&nbsp;<span class="op" id="4289394">+</span>&nbsp;<span class="string" id="4289396">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4289401">+</span>&nbsp;<span class="ident" id="4289403">e</span><span class="op" id="4289404">.</span><span class="ident" id="4289405">Err</span><span class="op" id="4289408">.</span><span class="ident" id="4289409">Error</span><span class="op" id="4289414">(</span><span class="op" id="4289415">)</span><br>
<span class="lineno"></span><span class="op" id="4289417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4289420">//&nbsp;A&nbsp;WriteError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;writing&nbsp;output.</span><br>
<span class="lineno">50</span><span class="keyword" id="4289487">type</span>&nbsp;<span class="ident" id="4289492">WriteError</span>&nbsp;<span class="keyword" id="4289503">struct</span>&nbsp;<span class="op" id="4289510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289513">Offset</span>&nbsp;<span class="ident" id="4289520">int64</span>&nbsp;<span class="comment" id="4289526">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289563">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4289570">error</span>&nbsp;<span class="comment" id="4289576">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="4289614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4289617">func</span>&nbsp;<span class="op" id="4289622">(</span><span class="ident" id="4289623">e</span>&nbsp;<span class="op" id="4289625">*</span><span class="ident" id="4289626">WriteError</span><span class="op" id="4289636">)</span>&nbsp;<span class="ident" id="4289638">Error</span><span class="op" id="4289643">(</span><span class="op" id="4289644">)</span>&nbsp;<span class="builtintype" id="4289646">string</span>&nbsp;<span class="op" id="4289653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289656">return</span>&nbsp;<span class="string" id="4289663">&#34;flate:&nbsp;write&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4289695">+</span>&nbsp;<span class="ident" id="4289697">strconv</span><span class="op" id="4289704">.</span><span class="ident" id="4289705">FormatInt</span><span class="op" id="4289714">(</span><span class="ident" id="4289715">e</span><span class="op" id="4289716">.</span><span class="ident" id="4289717">Offset</span><span class="op" id="4289723">,</span>&nbsp;<span class="num" id="4289725">10</span><span class="op" id="4289727">)</span>&nbsp;<span class="op" id="4289729">+</span>&nbsp;<span class="string" id="4289731">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4289736">+</span>&nbsp;<span class="ident" id="4289738">e</span><span class="op" id="4289739">.</span><span class="ident" id="4289740">Err</span><span class="op" id="4289743">.</span><span class="ident" id="4289744">Error</span><span class="op" id="4289749">(</span><span class="op" id="4289750">)</span><br>
<span class="lineno"></span><span class="op" id="4289752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4289755">//&nbsp;Resetter&nbsp;resets&nbsp;a&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;or&nbsp;NewReaderDict&nbsp;to</span><br>
<span class="lineno">60</span><span class="comment" id="4289829">//&nbsp;to&nbsp;switch&nbsp;to&nbsp;a&nbsp;new&nbsp;underlying&nbsp;Reader.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;ReadCloser</span><br>
<span class="lineno"></span><span class="comment" id="4289904">//&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4289940">type</span>&nbsp;<span class="ident" id="4289945">Resetter</span>&nbsp;<span class="keyword" id="4289954">interface</span>&nbsp;<span class="op" id="4289964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289967">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data&nbsp;and&nbsp;resets&nbsp;the&nbsp;Resetter&nbsp;as&nbsp;if&nbsp;it&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290041">//&nbsp;newly&nbsp;initialized&nbsp;with&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290086">Reset</span><span class="op" id="4290091">(</span><span class="ident" id="4290092">r</span>&nbsp;<span class="ident" id="4290094">io</span><span class="op" id="4290096">.</span><span class="ident" id="4290097">Reader</span><span class="op" id="4290103">,</span>&nbsp;<span class="ident" id="4290105">dict</span>&nbsp;<span class="op" id="4290110">[</span><span class="op" id="4290111">]</span><span class="builtintype" id="4290112">byte</span><span class="op" id="4290116">)</span>&nbsp;<span class="builtintype" id="4290118">error</span><br>
<span class="lineno"></span><span class="op" id="4290124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4290127">//&nbsp;Note&nbsp;that&nbsp;much&nbsp;of&nbsp;the&nbsp;implementation&nbsp;of&nbsp;huffmanDecoder&nbsp;is&nbsp;also&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="4290200">//&nbsp;into&nbsp;gen.go&nbsp;(in&nbsp;package&nbsp;main)&nbsp;for&nbsp;the&nbsp;purpose&nbsp;of&nbsp;precomputing&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="4290269">//&nbsp;fixed&nbsp;huffman&nbsp;tables&nbsp;so&nbsp;they&nbsp;can&nbsp;be&nbsp;included&nbsp;statically.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4290330">//&nbsp;The&nbsp;data&nbsp;structure&nbsp;for&nbsp;decoding&nbsp;Huffman&nbsp;tables&nbsp;is&nbsp;based&nbsp;on&nbsp;that&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4290400">//&nbsp;zlib.&nbsp;There&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;of&nbsp;a&nbsp;fixed&nbsp;bit&nbsp;width&nbsp;(huffmanChunkBits),</span><br>
<span class="lineno"></span><span class="comment" id="4290474">//&nbsp;For&nbsp;codes&nbsp;smaller&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;there&nbsp;are&nbsp;multiple&nbsp;entries</span><br>
<span class="lineno">75</span><span class="comment" id="4290544">//&nbsp;(each&nbsp;combination&nbsp;of&nbsp;trailing&nbsp;bits&nbsp;has&nbsp;the&nbsp;same&nbsp;value).&nbsp;For&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4290613">//&nbsp;larger&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;the&nbsp;table&nbsp;contains&nbsp;a&nbsp;link&nbsp;to&nbsp;an&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="4290686">//&nbsp;table.&nbsp;The&nbsp;width&nbsp;of&nbsp;each&nbsp;entry&nbsp;in&nbsp;the&nbsp;link&nbsp;table&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="4290758">//&nbsp;size&nbsp;minus&nbsp;the&nbsp;chunk&nbsp;width.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4290790">//&nbsp;Note&nbsp;that&nbsp;you&nbsp;can&nbsp;do&nbsp;a&nbsp;lookup&nbsp;in&nbsp;the&nbsp;table&nbsp;even&nbsp;without&nbsp;all&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4290858">//&nbsp;filled.&nbsp;Since&nbsp;the&nbsp;extra&nbsp;bits&nbsp;are&nbsp;zero,&nbsp;and&nbsp;the&nbsp;DEFLATE&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4290930">//&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;shorter&nbsp;codes&nbsp;come&nbsp;before&nbsp;longer&nbsp;ones,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4290999">//&nbsp;bit&nbsp;length&nbsp;estimate&nbsp;in&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;lower&nbsp;bound&nbsp;on&nbsp;the&nbsp;actual</span><br>
<span class="lineno"></span><span class="comment" id="4291067">//&nbsp;number&nbsp;of&nbsp;bits.</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4291087">//&nbsp;chunk&nbsp;&amp;&nbsp;15&nbsp;is&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4291119">//&nbsp;chunk&nbsp;&gt;&gt;&nbsp;4&nbsp;is&nbsp;value,&nbsp;including&nbsp;table&nbsp;link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4291165">const</span>&nbsp;<span class="op" id="4291171">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291174">huffmanChunkBits</span>&nbsp;&nbsp;<span class="op" id="4291192">=</span>&nbsp;<span class="num" id="4291194">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291197">huffmanNumChunks</span>&nbsp;&nbsp;<span class="op" id="4291215">=</span>&nbsp;<span class="num" id="4291217">1</span>&nbsp;<span class="op" id="4291219">&lt;&lt;</span>&nbsp;<span class="ident" id="4291222">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291240">huffmanCountMask</span>&nbsp;&nbsp;<span class="op" id="4291258">=</span>&nbsp;<span class="num" id="4291260">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291264">huffmanValueShift</span>&nbsp;<span class="op" id="4291282">=</span>&nbsp;<span class="num" id="4291284">4</span><br>
<span class="lineno"></span><span class="op" id="4291286">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="4291289">type</span>&nbsp;<span class="ident" id="4291294">huffmanDecoder</span>&nbsp;<span class="keyword" id="4291309">struct</span>&nbsp;<span class="op" id="4291316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291319">min</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4291328">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4291353">//&nbsp;the&nbsp;minimum&nbsp;code&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291381">chunks</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4291390">[</span><span class="ident" id="4291391">huffmanNumChunks</span><span class="op" id="4291407">]</span><span class="builtintype" id="4291408">uint32</span>&nbsp;<span class="comment" id="4291415">//&nbsp;chunks&nbsp;as&nbsp;described&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291445">links</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4291454">[</span><span class="op" id="4291455">]</span><span class="op" id="4291456">[</span><span class="op" id="4291457">]</span><span class="builtintype" id="4291458">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4291479">//&nbsp;overflow&nbsp;links</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291498">linkMask</span>&nbsp;<span class="builtintype" id="4291507">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4291532">//&nbsp;mask&nbsp;the&nbsp;width&nbsp;of&nbsp;the&nbsp;link&nbsp;table</span><br>
<span class="lineno"></span><span class="op" id="4291568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4291571">//&nbsp;Initialize&nbsp;Huffman&nbsp;decoding&nbsp;tables&nbsp;from&nbsp;array&nbsp;of&nbsp;code&nbsp;lengths.</span><br>
<span class="lineno"></span><span class="keyword" id="4291637">func</span>&nbsp;<span class="op" id="4291642">(</span><span class="ident" id="4291643">h</span>&nbsp;<span class="op" id="4291645">*</span><span class="ident" id="4291646">huffmanDecoder</span><span class="op" id="4291660">)</span>&nbsp;<span class="ident" id="4291662">init</span><span class="op" id="4291666">(</span><span class="ident" id="4291667">bits</span>&nbsp;<span class="op" id="4291672">[</span><span class="op" id="4291673">]</span><span class="builtintype" id="4291674">int</span><span class="op" id="4291677">)</span>&nbsp;<span class="builtintype" id="4291679">bool</span>&nbsp;<span class="op" id="4291684">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291687">if</span>&nbsp;<span class="ident" id="4291690">h</span><span class="op" id="4291691">.</span><span class="ident" id="4291692">min</span>&nbsp;<span class="op" id="4291696">!=</span>&nbsp;<span class="num" id="4291699">0</span>&nbsp;<span class="op" id="4291701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4291705">*</span><span class="ident" id="4291706">h</span>&nbsp;<span class="op" id="4291708">=</span>&nbsp;<span class="ident" id="4291710">huffmanDecoder</span><span class="op" id="4291724">{</span><span class="op" id="4291725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4291728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4291732">//&nbsp;Count&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;each&nbsp;length,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4291774">//&nbsp;compute&nbsp;min&nbsp;and&nbsp;max&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291806">var</span>&nbsp;<span class="ident" id="4291810">count</span>&nbsp;<span class="op" id="4291816">[</span><span class="ident" id="4291817">maxCodeLen</span><span class="op" id="4291827">]</span><span class="builtintype" id="4291828">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291833">var</span>&nbsp;<span class="ident" id="4291837">min</span><span class="op" id="4291840">,</span>&nbsp;<span class="ident" id="4291842">max</span>&nbsp;<span class="builtintype" id="4291846">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291851">for</span>&nbsp;<span class="ident" id="4291855">_</span><span class="op" id="4291856">,</span>&nbsp;<span class="ident" id="4291858">n</span>&nbsp;<span class="op" id="4291860">:=</span>&nbsp;<span class="keyword" id="4291863">range</span>&nbsp;<span class="ident" id="4291869">bits</span>&nbsp;<span class="op" id="4291874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291878">if</span>&nbsp;<span class="ident" id="4291881">n</span>&nbsp;<span class="op" id="4291883">==</span>&nbsp;<span class="num" id="4291886">0</span>&nbsp;<span class="op" id="4291888">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291893">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4291904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291908">if</span>&nbsp;<span class="ident" id="4291911">min</span>&nbsp;<span class="op" id="4291915">==</span>&nbsp;<span class="num" id="4291918">0</span>&nbsp;<span class="op" id="4291920">||</span>&nbsp;<span class="ident" id="4291923">n</span>&nbsp;<span class="op" id="4291925">&lt;</span>&nbsp;<span class="ident" id="4291927">min</span>&nbsp;<span class="op" id="4291931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291936">min</span>&nbsp;<span class="op" id="4291940">=</span>&nbsp;<span class="ident" id="4291942">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4291946">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291950">if</span>&nbsp;<span class="ident" id="4291953">n</span>&nbsp;<span class="op" id="4291955">&gt;</span>&nbsp;<span class="ident" id="4291957">max</span>&nbsp;<span class="op" id="4291961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291966">max</span>&nbsp;<span class="op" id="4291970">=</span>&nbsp;<span class="ident" id="4291972">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4291976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291980">count</span><span class="op" id="4291985">[</span><span class="ident" id="4291986">n</span><span class="op" id="4291987">]</span><span class="op" id="4291988">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4291992">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291995">if</span>&nbsp;<span class="ident" id="4291998">max</span>&nbsp;<span class="op" id="4292002">==</span>&nbsp;<span class="num" id="4292005">0</span>&nbsp;<span class="op" id="4292007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292011">return</span>&nbsp;<span class="builtintype" id="4292018">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292029">h</span><span class="op" id="4292030">.</span><span class="ident" id="4292031">min</span>&nbsp;<span class="op" id="4292035">=</span>&nbsp;<span class="ident" id="4292037">min</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292042">var</span>&nbsp;<span class="ident" id="4292046">linkBits</span>&nbsp;<span class="builtintype" id="4292055">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292061">var</span>&nbsp;<span class="ident" id="4292065">numLinks</span>&nbsp;<span class="builtintype" id="4292074">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292079">if</span>&nbsp;<span class="ident" id="4292082">max</span>&nbsp;<span class="op" id="4292086">&gt;</span>&nbsp;<span class="ident" id="4292088">huffmanChunkBits</span>&nbsp;<span class="op" id="4292105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292109">linkBits</span>&nbsp;<span class="op" id="4292118">=</span>&nbsp;<span class="builtintype" id="4292120">uint</span><span class="op" id="4292124">(</span><span class="ident" id="4292125">max</span><span class="op" id="4292128">)</span>&nbsp;<span class="op" id="4292130">-</span>&nbsp;<span class="ident" id="4292132">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292151">numLinks</span>&nbsp;<span class="op" id="4292160">=</span>&nbsp;<span class="num" id="4292162">1</span>&nbsp;<span class="op" id="4292164">&lt;&lt;</span>&nbsp;<span class="ident" id="4292167">linkBits</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292178">h</span><span class="op" id="4292179">.</span><span class="ident" id="4292180">linkMask</span>&nbsp;<span class="op" id="4292189">=</span>&nbsp;<span class="builtintype" id="4292191">uint32</span><span class="op" id="4292197">(</span><span class="ident" id="4292198">numLinks</span>&nbsp;<span class="op" id="4292207">-</span>&nbsp;<span class="num" id="4292209">1</span><span class="op" id="4292210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292216">code</span>&nbsp;<span class="op" id="4292221">:=</span>&nbsp;<span class="num" id="4292224">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292227">var</span>&nbsp;<span class="ident" id="4292231">nextcode</span>&nbsp;<span class="op" id="4292240">[</span><span class="ident" id="4292241">maxCodeLen</span><span class="op" id="4292251">]</span><span class="builtintype" id="4292252">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292257">for</span>&nbsp;<span class="ident" id="4292261">i</span>&nbsp;<span class="op" id="4292263">:=</span>&nbsp;<span class="ident" id="4292266">min</span><span class="op" id="4292269">;</span>&nbsp;<span class="ident" id="4292271">i</span>&nbsp;<span class="op" id="4292273">&lt;=</span>&nbsp;<span class="ident" id="4292276">max</span><span class="op" id="4292279">;</span>&nbsp;<span class="ident" id="4292281">i</span><span class="op" id="4292282">++</span>&nbsp;<span class="op" id="4292285">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292289">if</span>&nbsp;<span class="ident" id="4292292">i</span>&nbsp;<span class="op" id="4292294">==</span>&nbsp;<span class="ident" id="4292297">huffmanChunkBits</span><span class="op" id="4292313">+</span><span class="num" id="4292314">1</span>&nbsp;<span class="op" id="4292316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4292321">//&nbsp;create&nbsp;link&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292346">link</span>&nbsp;<span class="op" id="4292351">:=</span>&nbsp;<span class="ident" id="4292354">code</span>&nbsp;<span class="op" id="4292359">&gt;&gt;</span>&nbsp;<span class="num" id="4292362">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292367">if</span>&nbsp;<span class="ident" id="4292370">huffmanNumChunks</span>&nbsp;<span class="op" id="4292387">&lt;</span>&nbsp;<span class="ident" id="4292389">link</span>&nbsp;<span class="op" id="4292394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292400">return</span>&nbsp;<span class="builtintype" id="4292407">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292421">h</span><span class="op" id="4292422">.</span><span class="ident" id="4292423">links</span>&nbsp;<span class="op" id="4292429">=</span>&nbsp;<span class="builtinfunc" id="4292431">make</span><span class="op" id="4292435">(</span><span class="op" id="4292436">[</span><span class="op" id="4292437">]</span><span class="op" id="4292438">[</span><span class="op" id="4292439">]</span><span class="builtintype" id="4292440">uint32</span><span class="op" id="4292446">,</span>&nbsp;<span class="ident" id="4292448">huffmanNumChunks</span><span class="op" id="4292464">-</span><span class="ident" id="4292465">link</span><span class="op" id="4292469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292474">for</span>&nbsp;<span class="ident" id="4292478">j</span>&nbsp;<span class="op" id="4292480">:=</span>&nbsp;<span class="builtintype" id="4292483">uint</span><span class="op" id="4292487">(</span><span class="ident" id="4292488">link</span><span class="op" id="4292492">)</span><span class="op" id="4292493">;</span>&nbsp;<span class="ident" id="4292495">j</span>&nbsp;<span class="op" id="4292497">&lt;</span>&nbsp;<span class="ident" id="4292499">huffmanNumChunks</span><span class="op" id="4292515">;</span>&nbsp;<span class="ident" id="4292517">j</span><span class="op" id="4292518">++</span>&nbsp;<span class="op" id="4292521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292527">reverse</span>&nbsp;<span class="op" id="4292535">:=</span>&nbsp;<span class="builtintype" id="4292538">int</span><span class="op" id="4292541">(</span><span class="ident" id="4292542">reverseByte</span><span class="op" id="4292553">[</span><span class="ident" id="4292554">j</span><span class="op" id="4292555">&gt;&gt;</span><span class="num" id="4292557">8</span><span class="op" id="4292558">]</span><span class="op" id="4292559">)</span>&nbsp;<span class="op" id="4292561">|</span>&nbsp;<span class="builtintype" id="4292563">int</span><span class="op" id="4292566">(</span><span class="ident" id="4292567">reverseByte</span><span class="op" id="4292578">[</span><span class="ident" id="4292579">j</span><span class="op" id="4292580">&amp;</span><span class="num" id="4292581">0xff</span><span class="op" id="4292585">]</span><span class="op" id="4292586">)</span><span class="op" id="4292587">&lt;&lt;</span><span class="num" id="4292589">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292595">reverse</span>&nbsp;<span class="op" id="4292603">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4292607">uint</span><span class="op" id="4292611">(</span><span class="num" id="4292612">16</span>&nbsp;<span class="op" id="4292615">-</span>&nbsp;<span class="ident" id="4292617">huffmanChunkBits</span><span class="op" id="4292633">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292639">off</span>&nbsp;<span class="op" id="4292643">:=</span>&nbsp;<span class="ident" id="4292646">j</span>&nbsp;<span class="op" id="4292648">-</span>&nbsp;<span class="builtintype" id="4292650">uint</span><span class="op" id="4292654">(</span><span class="ident" id="4292655">link</span><span class="op" id="4292659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292665">h</span><span class="op" id="4292666">.</span><span class="ident" id="4292667">chunks</span><span class="op" id="4292673">[</span><span class="ident" id="4292674">reverse</span><span class="op" id="4292681">]</span>&nbsp;<span class="op" id="4292683">=</span>&nbsp;<span class="builtintype" id="4292685">uint32</span><span class="op" id="4292691">(</span><span class="ident" id="4292692">off</span><span class="op" id="4292695">&lt;&lt;</span><span class="ident" id="4292697">huffmanValueShift</span>&nbsp;<span class="op" id="4292715">+</span>&nbsp;<span class="builtintype" id="4292717">uint</span><span class="op" id="4292721">(</span><span class="ident" id="4292722">i</span><span class="op" id="4292723">)</span><span class="op" id="4292724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292730">h</span><span class="op" id="4292731">.</span><span class="ident" id="4292732">links</span><span class="op" id="4292737">[</span><span class="ident" id="4292738">off</span><span class="op" id="4292741">]</span>&nbsp;<span class="op" id="4292743">=</span>&nbsp;<span class="builtinfunc" id="4292745">make</span><span class="op" id="4292749">(</span><span class="op" id="4292750">[</span><span class="op" id="4292751">]</span><span class="builtintype" id="4292752">uint32</span><span class="op" id="4292758">,</span>&nbsp;<span class="num" id="4292760">1</span><span class="op" id="4292761">&lt;&lt;</span><span class="ident" id="4292763">linkBits</span><span class="op" id="4292771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292780">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292784">n</span>&nbsp;<span class="op" id="4292786">:=</span>&nbsp;<span class="ident" id="4292789">count</span><span class="op" id="4292794">[</span><span class="ident" id="4292795">i</span><span class="op" id="4292796">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292800">nextcode</span><span class="op" id="4292808">[</span><span class="ident" id="4292809">i</span><span class="op" id="4292810">]</span>&nbsp;<span class="op" id="4292812">=</span>&nbsp;<span class="ident" id="4292814">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292821">code</span>&nbsp;<span class="op" id="4292826">+=</span>&nbsp;<span class="ident" id="4292829">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292833">code</span>&nbsp;<span class="op" id="4292838">&lt;&lt;=</span>&nbsp;<span class="num" id="4292842">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292845">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292849">for</span>&nbsp;<span class="ident" id="4292853">i</span><span class="op" id="4292854">,</span>&nbsp;<span class="ident" id="4292856">n</span>&nbsp;<span class="op" id="4292858">:=</span>&nbsp;<span class="keyword" id="4292861">range</span>&nbsp;<span class="ident" id="4292867">bits</span>&nbsp;<span class="op" id="4292872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292876">if</span>&nbsp;<span class="ident" id="4292879">n</span>&nbsp;<span class="op" id="4292881">==</span>&nbsp;<span class="num" id="4292884">0</span>&nbsp;<span class="op" id="4292886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292891">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292902">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292906">code</span>&nbsp;<span class="op" id="4292911">:=</span>&nbsp;<span class="ident" id="4292914">nextcode</span><span class="op" id="4292922">[</span><span class="ident" id="4292923">n</span><span class="op" id="4292924">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292928">nextcode</span><span class="op" id="4292936">[</span><span class="ident" id="4292937">n</span><span class="op" id="4292938">]</span><span class="op" id="4292939">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292944">chunk</span>&nbsp;<span class="op" id="4292950">:=</span>&nbsp;<span class="builtintype" id="4292953">uint32</span><span class="op" id="4292959">(</span><span class="ident" id="4292960">i</span><span class="op" id="4292961">&lt;&lt;</span><span class="ident" id="4292963">huffmanValueShift</span>&nbsp;<span class="op" id="4292981">|</span>&nbsp;<span class="ident" id="4292983">n</span><span class="op" id="4292984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292988">reverse</span>&nbsp;<span class="op" id="4292996">:=</span>&nbsp;<span class="builtintype" id="4292999">int</span><span class="op" id="4293002">(</span><span class="ident" id="4293003">reverseByte</span><span class="op" id="4293014">[</span><span class="ident" id="4293015">code</span><span class="op" id="4293019">&gt;&gt;</span><span class="num" id="4293021">8</span><span class="op" id="4293022">]</span><span class="op" id="4293023">)</span>&nbsp;<span class="op" id="4293025">|</span>&nbsp;<span class="builtintype" id="4293027">int</span><span class="op" id="4293030">(</span><span class="ident" id="4293031">reverseByte</span><span class="op" id="4293042">[</span><span class="ident" id="4293043">code</span><span class="op" id="4293047">&amp;</span><span class="num" id="4293048">0xff</span><span class="op" id="4293052">]</span><span class="op" id="4293053">)</span><span class="op" id="4293054">&lt;&lt;</span><span class="num" id="4293056">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293060">reverse</span>&nbsp;<span class="op" id="4293068">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4293072">uint</span><span class="op" id="4293076">(</span><span class="num" id="4293077">16</span>&nbsp;<span class="op" id="4293080">-</span>&nbsp;<span class="ident" id="4293082">n</span><span class="op" id="4293083">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293087">if</span>&nbsp;<span class="ident" id="4293090">n</span>&nbsp;<span class="op" id="4293092">&lt;=</span>&nbsp;<span class="ident" id="4293095">huffmanChunkBits</span>&nbsp;<span class="op" id="4293112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293117">for</span>&nbsp;<span class="ident" id="4293121">off</span>&nbsp;<span class="op" id="4293125">:=</span>&nbsp;<span class="ident" id="4293128">reverse</span><span class="op" id="4293135">;</span>&nbsp;<span class="ident" id="4293137">off</span>&nbsp;<span class="op" id="4293141">&lt;</span>&nbsp;<span class="ident" id="4293143">huffmanNumChunks</span><span class="op" id="4293159">;</span>&nbsp;<span class="ident" id="4293161">off</span>&nbsp;<span class="op" id="4293165">+=</span>&nbsp;<span class="num" id="4293168">1</span>&nbsp;<span class="op" id="4293170">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4293173">uint</span><span class="op" id="4293177">(</span><span class="ident" id="4293178">n</span><span class="op" id="4293179">)</span>&nbsp;<span class="op" id="4293181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293187">h</span><span class="op" id="4293188">.</span><span class="ident" id="4293189">chunks</span><span class="op" id="4293195">[</span><span class="ident" id="4293196">off</span><span class="op" id="4293199">]</span>&nbsp;<span class="op" id="4293201">=</span>&nbsp;<span class="ident" id="4293203">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293216">}</span>&nbsp;<span class="keyword" id="4293218">else</span>&nbsp;<span class="op" id="4293223">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293228">value</span>&nbsp;<span class="op" id="4293234">:=</span>&nbsp;<span class="ident" id="4293237">h</span><span class="op" id="4293238">.</span><span class="ident" id="4293239">chunks</span><span class="op" id="4293245">[</span><span class="ident" id="4293246">reverse</span><span class="op" id="4293253">&amp;</span><span class="op" id="4293254">(</span><span class="ident" id="4293255">huffmanNumChunks</span><span class="op" id="4293271">-</span><span class="num" id="4293272">1</span><span class="op" id="4293273">)</span><span class="op" id="4293274">]</span>&nbsp;<span class="op" id="4293276">&gt;&gt;</span>&nbsp;<span class="ident" id="4293279">huffmanValueShift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293300">if</span>&nbsp;<span class="ident" id="4293303">value</span>&nbsp;<span class="op" id="4293309">&gt;=</span>&nbsp;<span class="builtintype" id="4293312">uint32</span><span class="op" id="4293318">(</span><span class="builtinfunc" id="4293319">len</span><span class="op" id="4293322">(</span><span class="ident" id="4293323">h</span><span class="op" id="4293324">.</span><span class="ident" id="4293325">links</span><span class="op" id="4293330">)</span><span class="op" id="4293331">)</span>&nbsp;<span class="op" id="4293333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293339">return</span>&nbsp;<span class="builtintype" id="4293346">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293360">linktab</span>&nbsp;<span class="op" id="4293368">:=</span>&nbsp;<span class="ident" id="4293371">h</span><span class="op" id="4293372">.</span><span class="ident" id="4293373">links</span><span class="op" id="4293378">[</span><span class="ident" id="4293379">value</span><span class="op" id="4293384">]</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293389">reverse</span>&nbsp;<span class="op" id="4293397">&gt;&gt;=</span>&nbsp;<span class="ident" id="4293401">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293421">for</span>&nbsp;<span class="ident" id="4293425">off</span>&nbsp;<span class="op" id="4293429">:=</span>&nbsp;<span class="ident" id="4293432">reverse</span><span class="op" id="4293439">;</span>&nbsp;<span class="ident" id="4293441">off</span>&nbsp;<span class="op" id="4293445">&lt;</span>&nbsp;<span class="ident" id="4293447">numLinks</span><span class="op" id="4293455">;</span>&nbsp;<span class="ident" id="4293457">off</span>&nbsp;<span class="op" id="4293461">+=</span>&nbsp;<span class="num" id="4293464">1</span>&nbsp;<span class="op" id="4293466">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4293469">uint</span><span class="op" id="4293473">(</span><span class="ident" id="4293474">n</span><span class="op" id="4293475">-</span><span class="ident" id="4293476">huffmanChunkBits</span><span class="op" id="4293492">)</span>&nbsp;<span class="op" id="4293494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293500">linktab</span><span class="op" id="4293507">[</span><span class="ident" id="4293508">off</span><span class="op" id="4293511">]</span>&nbsp;<span class="op" id="4293513">=</span>&nbsp;<span class="ident" id="4293515">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293528">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293534">return</span>&nbsp;<span class="builtintype" id="4293541">true</span><br>
<span class="lineno"></span><span class="op" id="4293546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4293549">//&nbsp;The&nbsp;actual&nbsp;read&nbsp;interface&nbsp;needed&nbsp;by&nbsp;NewReader.</span><br>
<span class="lineno">190</span><span class="comment" id="4293599">//&nbsp;If&nbsp;the&nbsp;passed&nbsp;in&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,</span><br>
<span class="lineno"></span><span class="comment" id="4293658">//&nbsp;the&nbsp;NewReader&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="4293709">type</span>&nbsp;<span class="ident" id="4293714">Reader</span>&nbsp;<span class="keyword" id="4293721">interface</span>&nbsp;<span class="op" id="4293731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293734">io</span><span class="op" id="4293736">.</span><span class="ident" id="4293737">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293745">io</span><span class="op" id="4293747">.</span><span class="ident" id="4293748">ByteReader</span><br>
<span class="lineno">195</span><span class="op" id="4293759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4293762">//&nbsp;Decompress&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4293783">type</span>&nbsp;<span class="ident" id="4293788">decompressor</span>&nbsp;<span class="keyword" id="4293801">struct</span>&nbsp;<span class="op" id="4293808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4293811">//&nbsp;Input&nbsp;source.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293829">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293837">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293845">roffset</span>&nbsp;<span class="ident" id="4293853">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293860">woffset</span>&nbsp;<span class="ident" id="4293868">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4293876">//&nbsp;Input&nbsp;bits,&nbsp;in&nbsp;top&nbsp;of&nbsp;b.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293905">b</span>&nbsp;&nbsp;<span class="builtintype" id="4293908">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293916">nb</span>&nbsp;<span class="builtintype" id="4293919">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4293926">//&nbsp;Huffman&nbsp;decoders&nbsp;for&nbsp;literal/length,&nbsp;distance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293977">h1</span><span class="op" id="4293979">,</span>&nbsp;<span class="ident" id="4293981">h2</span>&nbsp;<span class="ident" id="4293984">huffmanDecoder</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4294001">//&nbsp;Length&nbsp;arrays&nbsp;used&nbsp;to&nbsp;define&nbsp;Huffman&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294049">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4294058">*</span><span class="op" id="4294059">[</span><span class="ident" id="4294060">maxLit</span>&nbsp;<span class="op" id="4294067">+</span>&nbsp;<span class="ident" id="4294069">maxDist</span><span class="op" id="4294076">]</span><span class="builtintype" id="4294077">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294082">codebits</span>&nbsp;<span class="op" id="4294091">*</span><span class="op" id="4294092">[</span><span class="ident" id="4294093">numCodes</span><span class="op" id="4294101">]</span><span class="builtintype" id="4294102">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4294108">//&nbsp;Output&nbsp;history,&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294136">hist</span>&nbsp;&nbsp;<span class="op" id="4294142">*</span><span class="op" id="4294143">[</span><span class="ident" id="4294144">maxHist</span><span class="op" id="4294151">]</span><span class="builtintype" id="4294152">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294158">hp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4294164">int</span>&nbsp;&nbsp;<span class="comment" id="4294169">//&nbsp;current&nbsp;output&nbsp;position&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294207">hw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4294213">int</span>&nbsp;&nbsp;<span class="comment" id="4294218">//&nbsp;have&nbsp;written&nbsp;hist[0:hw]&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294254">hfull</span>&nbsp;<span class="builtintype" id="4294260">bool</span>&nbsp;<span class="comment" id="4294265">//&nbsp;buffer&nbsp;has&nbsp;filled&nbsp;at&nbsp;least&nbsp;once</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4294302">//&nbsp;Temporary&nbsp;buffer&nbsp;(avoids&nbsp;repeated&nbsp;allocation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294353">buf</span>&nbsp;<span class="op" id="4294357">[</span><span class="num" id="4294358">4</span><span class="op" id="4294359">]</span><span class="builtintype" id="4294360">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4294367">//&nbsp;Next&nbsp;step&nbsp;in&nbsp;the&nbsp;decompression,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4294403">//&nbsp;and&nbsp;decompression&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294432">step</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294441">func</span><span class="op" id="4294445">(</span><span class="op" id="4294446">*</span><span class="ident" id="4294447">decompressor</span><span class="op" id="4294459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294462">final</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4294471">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294477">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4294486">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294493">toRead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4294502">[</span><span class="op" id="4294503">]</span><span class="builtintype" id="4294504">byte</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294510">hl</span><span class="op" id="4294512">,</span>&nbsp;<span class="ident" id="4294514">hd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4294519">*</span><span class="ident" id="4294520">huffmanDecoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294536">copyLen</span>&nbsp;&nbsp;<span class="builtintype" id="4294545">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294550">copyDist</span>&nbsp;<span class="builtintype" id="4294559">int</span><br>
<span class="lineno"></span><span class="op" id="4294563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4294566">func</span>&nbsp;<span class="op" id="4294571">(</span><span class="ident" id="4294572">f</span>&nbsp;<span class="op" id="4294574">*</span><span class="ident" id="4294575">decompressor</span><span class="op" id="4294587">)</span>&nbsp;<span class="ident" id="4294589">nextBlock</span><span class="op" id="4294598">(</span><span class="op" id="4294599">)</span>&nbsp;<span class="op" id="4294601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294604">if</span>&nbsp;<span class="ident" id="4294607">f</span><span class="op" id="4294608">.</span><span class="ident" id="4294609">final</span>&nbsp;<span class="op" id="4294615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294619">if</span>&nbsp;<span class="ident" id="4294622">f</span><span class="op" id="4294623">.</span><span class="ident" id="4294624">hw</span>&nbsp;<span class="op" id="4294627">!=</span>&nbsp;<span class="ident" id="4294630">f</span><span class="op" id="4294631">.</span><span class="ident" id="4294632">hp</span>&nbsp;<span class="op" id="4294635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294640">f</span><span class="op" id="4294641">.</span><span class="ident" id="4294642">flush</span><span class="op" id="4294647">(</span><span class="op" id="4294648">(</span><span class="op" id="4294649">*</span><span class="ident" id="4294650">decompressor</span><span class="op" id="4294662">)</span><span class="op" id="4294663">.</span><span class="ident" id="4294664">nextBlock</span><span class="op" id="4294673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294678">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294691">f</span><span class="op" id="4294692">.</span><span class="ident" id="4294693">err</span>&nbsp;<span class="op" id="4294697">=</span>&nbsp;<span class="ident" id="4294699">io</span><span class="op" id="4294701">.</span><span class="ident" id="4294702">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294708">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294719">for</span>&nbsp;<span class="ident" id="4294723">f</span><span class="op" id="4294724">.</span><span class="ident" id="4294725">nb</span>&nbsp;<span class="op" id="4294728">&lt;</span>&nbsp;<span class="num" id="4294730">1</span><span class="op" id="4294731">+</span><span class="num" id="4294732">2</span>&nbsp;<span class="op" id="4294734">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294738">if</span>&nbsp;<span class="ident" id="4294741">f</span><span class="op" id="4294742">.</span><span class="ident" id="4294743">err</span>&nbsp;<span class="op" id="4294747">=</span>&nbsp;<span class="ident" id="4294749">f</span><span class="op" id="4294750">.</span><span class="ident" id="4294751">moreBits</span><span class="op" id="4294759">(</span><span class="op" id="4294760">)</span><span class="op" id="4294761">;</span>&nbsp;<span class="ident" id="4294763">f</span><span class="op" id="4294764">.</span><span class="ident" id="4294765">err</span>&nbsp;<span class="op" id="4294769">!=</span>&nbsp;<span class="ident" id="4294772">nil</span>&nbsp;<span class="op" id="4294776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294781">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4294793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294796">f</span><span class="op" id="4294797">.</span><span class="ident" id="4294798">final</span>&nbsp;<span class="op" id="4294804">=</span>&nbsp;<span class="ident" id="4294806">f</span><span class="op" id="4294807">.</span><span class="ident" id="4294808">b</span><span class="op" id="4294809">&amp;</span><span class="num" id="4294810">1</span>&nbsp;<span class="op" id="4294812">==</span>&nbsp;<span class="num" id="4294815">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294818">f</span><span class="op" id="4294819">.</span><span class="ident" id="4294820">b</span>&nbsp;<span class="op" id="4294822">&gt;&gt;=</span>&nbsp;<span class="num" id="4294826">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294829">typ</span>&nbsp;<span class="op" id="4294833">:=</span>&nbsp;<span class="ident" id="4294836">f</span><span class="op" id="4294837">.</span><span class="ident" id="4294838">b</span>&nbsp;<span class="op" id="4294840">&amp;</span>&nbsp;<span class="num" id="4294842">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294845">f</span><span class="op" id="4294846">.</span><span class="ident" id="4294847">b</span>&nbsp;<span class="op" id="4294849">&gt;&gt;=</span>&nbsp;<span class="num" id="4294853">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294856">f</span><span class="op" id="4294857">.</span><span class="ident" id="4294858">nb</span>&nbsp;<span class="op" id="4294861">-=</span>&nbsp;<span class="num" id="4294864">1</span>&nbsp;<span class="op" id="4294866">+</span>&nbsp;<span class="num" id="4294868">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294871">switch</span>&nbsp;<span class="ident" id="4294878">typ</span>&nbsp;<span class="op" id="4294882">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294885">case</span>&nbsp;<span class="num" id="4294890">0</span><span class="op" id="4294891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294895">f</span><span class="op" id="4294896">.</span><span class="ident" id="4294897">dataBlock</span><span class="op" id="4294906">(</span><span class="op" id="4294907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294910">case</span>&nbsp;<span class="num" id="4294915">1</span><span class="op" id="4294916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4294920">//&nbsp;compressed,&nbsp;fixed&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294958">f</span><span class="op" id="4294959">.</span><span class="ident" id="4294960">hl</span>&nbsp;<span class="op" id="4294963">=</span>&nbsp;<span class="op" id="4294965">&amp;</span><span class="ident" id="4294966">fixedHuffmanDecoder</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294988">f</span><span class="op" id="4294989">.</span><span class="ident" id="4294990">hd</span>&nbsp;<span class="op" id="4294993">=</span>&nbsp;<span class="ident" id="4294995">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295001">f</span><span class="op" id="4295002">.</span><span class="ident" id="4295003">huffmanBlock</span><span class="op" id="4295015">(</span><span class="op" id="4295016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295019">case</span>&nbsp;<span class="num" id="4295024">2</span><span class="op" id="4295025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4295029">//&nbsp;compressed,&nbsp;dynamic&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295069">if</span>&nbsp;<span class="ident" id="4295072">f</span><span class="op" id="4295073">.</span><span class="ident" id="4295074">err</span>&nbsp;<span class="op" id="4295078">=</span>&nbsp;<span class="ident" id="4295080">f</span><span class="op" id="4295081">.</span><span class="ident" id="4295082">readHuffman</span><span class="op" id="4295093">(</span><span class="op" id="4295094">)</span><span class="op" id="4295095">;</span>&nbsp;<span class="ident" id="4295097">f</span><span class="op" id="4295098">.</span><span class="ident" id="4295099">err</span>&nbsp;<span class="op" id="4295103">!=</span>&nbsp;<span class="ident" id="4295106">nil</span>&nbsp;<span class="op" id="4295110">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295115">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295127">f</span><span class="op" id="4295128">.</span><span class="ident" id="4295129">hl</span>&nbsp;<span class="op" id="4295132">=</span>&nbsp;<span class="op" id="4295134">&amp;</span><span class="ident" id="4295135">f</span><span class="op" id="4295136">.</span><span class="ident" id="4295137">h1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295142">f</span><span class="op" id="4295143">.</span><span class="ident" id="4295144">hd</span>&nbsp;<span class="op" id="4295147">=</span>&nbsp;<span class="op" id="4295149">&amp;</span><span class="ident" id="4295150">f</span><span class="op" id="4295151">.</span><span class="ident" id="4295152">h2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295157">f</span><span class="op" id="4295158">.</span><span class="ident" id="4295159">huffmanBlock</span><span class="op" id="4295171">(</span><span class="op" id="4295172">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295175">default</span><span class="op" id="4295182">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4295186">//&nbsp;3&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295206">f</span><span class="op" id="4295207">.</span><span class="ident" id="4295208">err</span>&nbsp;<span class="op" id="4295212">=</span>&nbsp;<span class="ident" id="4295214">CorruptInputError</span><span class="op" id="4295231">(</span><span class="ident" id="4295232">f</span><span class="op" id="4295233">.</span><span class="ident" id="4295234">roffset</span><span class="op" id="4295241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295244">}</span><br>
<span class="lineno"></span><span class="op" id="4295246">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="4295249">func</span>&nbsp;<span class="op" id="4295254">(</span><span class="ident" id="4295255">f</span>&nbsp;<span class="op" id="4295257">*</span><span class="ident" id="4295258">decompressor</span><span class="op" id="4295270">)</span>&nbsp;<span class="ident" id="4295272">Read</span><span class="op" id="4295276">(</span><span class="ident" id="4295277">b</span>&nbsp;<span class="op" id="4295279">[</span><span class="op" id="4295280">]</span><span class="builtintype" id="4295281">byte</span><span class="op" id="4295285">)</span>&nbsp;<span class="op" id="4295287">(</span><span class="builtintype" id="4295288">int</span><span class="op" id="4295291">,</span>&nbsp;<span class="builtintype" id="4295293">error</span><span class="op" id="4295298">)</span>&nbsp;<span class="op" id="4295300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295303">for</span>&nbsp;<span class="op" id="4295307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295311">if</span>&nbsp;<span class="builtinfunc" id="4295314">len</span><span class="op" id="4295317">(</span><span class="ident" id="4295318">f</span><span class="op" id="4295319">.</span><span class="ident" id="4295320">toRead</span><span class="op" id="4295326">)</span>&nbsp;<span class="op" id="4295328">&gt;</span>&nbsp;<span class="num" id="4295330">0</span>&nbsp;<span class="op" id="4295332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295337">n</span>&nbsp;<span class="op" id="4295339">:=</span>&nbsp;<span class="builtinfunc" id="4295342">copy</span><span class="op" id="4295346">(</span><span class="ident" id="4295347">b</span><span class="op" id="4295348">,</span>&nbsp;<span class="ident" id="4295350">f</span><span class="op" id="4295351">.</span><span class="ident" id="4295352">toRead</span><span class="op" id="4295358">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295363">f</span><span class="op" id="4295364">.</span><span class="ident" id="4295365">toRead</span>&nbsp;<span class="op" id="4295372">=</span>&nbsp;<span class="ident" id="4295374">f</span><span class="op" id="4295375">.</span><span class="ident" id="4295376">toRead</span><span class="op" id="4295382">[</span><span class="ident" id="4295383">n</span><span class="op" id="4295384">:</span><span class="op" id="4295385">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295390">return</span>&nbsp;<span class="ident" id="4295397">n</span><span class="op" id="4295398">,</span>&nbsp;<span class="ident" id="4295400">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295410">if</span>&nbsp;<span class="ident" id="4295413">f</span><span class="op" id="4295414">.</span><span class="ident" id="4295415">err</span>&nbsp;<span class="op" id="4295419">!=</span>&nbsp;<span class="ident" id="4295422">nil</span>&nbsp;<span class="op" id="4295426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295431">return</span>&nbsp;<span class="num" id="4295438">0</span><span class="op" id="4295439">,</span>&nbsp;<span class="ident" id="4295441">f</span><span class="op" id="4295442">.</span><span class="ident" id="4295443">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295453">f</span><span class="op" id="4295454">.</span><span class="ident" id="4295455">step</span><span class="op" id="4295459">(</span><span class="ident" id="4295460">f</span><span class="op" id="4295461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295464">}</span><br>
<span class="lineno"></span><span class="op" id="4295466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="4295469">func</span>&nbsp;<span class="op" id="4295474">(</span><span class="ident" id="4295475">f</span>&nbsp;<span class="op" id="4295477">*</span><span class="ident" id="4295478">decompressor</span><span class="op" id="4295490">)</span>&nbsp;<span class="ident" id="4295492">Close</span><span class="op" id="4295497">(</span><span class="op" id="4295498">)</span>&nbsp;<span class="builtintype" id="4295500">error</span>&nbsp;<span class="op" id="4295506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295509">if</span>&nbsp;<span class="ident" id="4295512">f</span><span class="op" id="4295513">.</span><span class="ident" id="4295514">err</span>&nbsp;<span class="op" id="4295518">==</span>&nbsp;<span class="ident" id="4295521">io</span><span class="op" id="4295523">.</span><span class="ident" id="4295524">EOF</span>&nbsp;<span class="op" id="4295528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295532">return</span>&nbsp;<span class="ident" id="4295539">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295547">return</span>&nbsp;<span class="ident" id="4295554">f</span><span class="op" id="4295555">.</span><span class="ident" id="4295556">err</span><br>
<span class="lineno">295</span><span class="op" id="4295560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4295563">//&nbsp;RFC&nbsp;1951&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span><span class="comment" id="4295590">//&nbsp;Compression&nbsp;with&nbsp;dynamic&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="4295633">var</span>&nbsp;<span class="ident" id="4295637">codeOrder</span>&nbsp;<span class="op" id="4295647">=</span>&nbsp;<span class="op" id="4295649">[</span><span class="op" id="4295650">...</span><span class="op" id="4295653">]</span><span class="builtintype" id="4295654">int</span><span class="op" id="4295657">{</span><span class="num" id="4295658">16</span><span class="op" id="4295660">,</span>&nbsp;<span class="num" id="4295662">17</span><span class="op" id="4295664">,</span>&nbsp;<span class="num" id="4295666">18</span><span class="op" id="4295668">,</span>&nbsp;<span class="num" id="4295670">0</span><span class="op" id="4295671">,</span>&nbsp;<span class="num" id="4295673">8</span><span class="op" id="4295674">,</span>&nbsp;<span class="num" id="4295676">7</span><span class="op" id="4295677">,</span>&nbsp;<span class="num" id="4295679">9</span><span class="op" id="4295680">,</span>&nbsp;<span class="num" id="4295682">6</span><span class="op" id="4295683">,</span>&nbsp;<span class="num" id="4295685">10</span><span class="op" id="4295687">,</span>&nbsp;<span class="num" id="4295689">5</span><span class="op" id="4295690">,</span>&nbsp;<span class="num" id="4295692">11</span><span class="op" id="4295694">,</span>&nbsp;<span class="num" id="4295696">4</span><span class="op" id="4295697">,</span>&nbsp;<span class="num" id="4295699">12</span><span class="op" id="4295701">,</span>&nbsp;<span class="num" id="4295703">3</span><span class="op" id="4295704">,</span>&nbsp;<span class="num" id="4295706">13</span><span class="op" id="4295708">,</span>&nbsp;<span class="num" id="4295710">2</span><span class="op" id="4295711">,</span>&nbsp;<span class="num" id="4295713">14</span><span class="op" id="4295715">,</span>&nbsp;<span class="num" id="4295717">1</span><span class="op" id="4295718">,</span>&nbsp;<span class="num" id="4295720">15</span><span class="op" id="4295722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4295725">func</span>&nbsp;<span class="op" id="4295730">(</span><span class="ident" id="4295731">f</span>&nbsp;<span class="op" id="4295733">*</span><span class="ident" id="4295734">decompressor</span><span class="op" id="4295746">)</span>&nbsp;<span class="ident" id="4295748">readHuffman</span><span class="op" id="4295759">(</span><span class="op" id="4295760">)</span>&nbsp;<span class="builtintype" id="4295762">error</span>&nbsp;<span class="op" id="4295768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4295771">//&nbsp;HLIT[5],&nbsp;HDIST[5],&nbsp;HCLEN[4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295804">for</span>&nbsp;<span class="ident" id="4295808">f</span><span class="op" id="4295809">.</span><span class="ident" id="4295810">nb</span>&nbsp;<span class="op" id="4295813">&lt;</span>&nbsp;<span class="num" id="4295815">5</span><span class="op" id="4295816">+</span><span class="num" id="4295817">5</span><span class="op" id="4295818">+</span><span class="num" id="4295819">4</span>&nbsp;<span class="op" id="4295821">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295825">if</span>&nbsp;<span class="ident" id="4295828">err</span>&nbsp;<span class="op" id="4295832">:=</span>&nbsp;<span class="ident" id="4295835">f</span><span class="op" id="4295836">.</span><span class="ident" id="4295837">moreBits</span><span class="op" id="4295845">(</span><span class="op" id="4295846">)</span><span class="op" id="4295847">;</span>&nbsp;<span class="ident" id="4295849">err</span>&nbsp;<span class="op" id="4295853">!=</span>&nbsp;<span class="ident" id="4295856">nil</span>&nbsp;<span class="op" id="4295860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295865">return</span>&nbsp;<span class="ident" id="4295872">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295884">nlit</span>&nbsp;<span class="op" id="4295889">:=</span>&nbsp;<span class="builtintype" id="4295892">int</span><span class="op" id="4295895">(</span><span class="ident" id="4295896">f</span><span class="op" id="4295897">.</span><span class="ident" id="4295898">b</span><span class="op" id="4295899">&amp;</span><span class="num" id="4295900">0x1F</span><span class="op" id="4295904">)</span>&nbsp;<span class="op" id="4295906">+</span>&nbsp;<span class="num" id="4295908">257</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295913">if</span>&nbsp;<span class="ident" id="4295916">nlit</span>&nbsp;<span class="op" id="4295921">&gt;</span>&nbsp;<span class="ident" id="4295923">maxLit</span>&nbsp;<span class="op" id="4295930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295934">return</span>&nbsp;<span class="ident" id="4295941">CorruptInputError</span><span class="op" id="4295958">(</span><span class="ident" id="4295959">f</span><span class="op" id="4295960">.</span><span class="ident" id="4295961">roffset</span><span class="op" id="4295968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4295971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295974">f</span><span class="op" id="4295975">.</span><span class="ident" id="4295976">b</span>&nbsp;<span class="op" id="4295978">&gt;&gt;=</span>&nbsp;<span class="num" id="4295982">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295985">ndist</span>&nbsp;<span class="op" id="4295991">:=</span>&nbsp;<span class="builtintype" id="4295994">int</span><span class="op" id="4295997">(</span><span class="ident" id="4295998">f</span><span class="op" id="4295999">.</span><span class="ident" id="4296000">b</span><span class="op" id="4296001">&amp;</span><span class="num" id="4296002">0x1F</span><span class="op" id="4296006">)</span>&nbsp;<span class="op" id="4296008">+</span>&nbsp;<span class="num" id="4296010">1</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4296013">//&nbsp;maxDist&nbsp;is&nbsp;32,&nbsp;so&nbsp;ndist&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296058">f</span><span class="op" id="4296059">.</span><span class="ident" id="4296060">b</span>&nbsp;<span class="op" id="4296062">&gt;&gt;=</span>&nbsp;<span class="num" id="4296066">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296069">nclen</span>&nbsp;<span class="op" id="4296075">:=</span>&nbsp;<span class="builtintype" id="4296078">int</span><span class="op" id="4296081">(</span><span class="ident" id="4296082">f</span><span class="op" id="4296083">.</span><span class="ident" id="4296084">b</span><span class="op" id="4296085">&amp;</span><span class="num" id="4296086">0xF</span><span class="op" id="4296089">)</span>&nbsp;<span class="op" id="4296091">+</span>&nbsp;<span class="num" id="4296093">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4296096">//&nbsp;numCodes&nbsp;is&nbsp;19,&nbsp;so&nbsp;nclen&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296142">f</span><span class="op" id="4296143">.</span><span class="ident" id="4296144">b</span>&nbsp;<span class="op" id="4296146">&gt;&gt;=</span>&nbsp;<span class="num" id="4296150">4</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296153">f</span><span class="op" id="4296154">.</span><span class="ident" id="4296155">nb</span>&nbsp;<span class="op" id="4296158">-=</span>&nbsp;<span class="num" id="4296161">5</span>&nbsp;<span class="op" id="4296163">+</span>&nbsp;<span class="num" id="4296165">5</span>&nbsp;<span class="op" id="4296167">+</span>&nbsp;<span class="num" id="4296169">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4296173">//&nbsp;(HCLEN+4)*3&nbsp;bits:&nbsp;code&nbsp;lengths&nbsp;in&nbsp;the&nbsp;magic&nbsp;codeOrder&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296238">for</span>&nbsp;<span class="ident" id="4296242">i</span>&nbsp;<span class="op" id="4296244">:=</span>&nbsp;<span class="num" id="4296247">0</span><span class="op" id="4296248">;</span>&nbsp;<span class="ident" id="4296250">i</span>&nbsp;<span class="op" id="4296252">&lt;</span>&nbsp;<span class="ident" id="4296254">nclen</span><span class="op" id="4296259">;</span>&nbsp;<span class="ident" id="4296261">i</span><span class="op" id="4296262">++</span>&nbsp;<span class="op" id="4296265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296269">for</span>&nbsp;<span class="ident" id="4296273">f</span><span class="op" id="4296274">.</span><span class="ident" id="4296275">nb</span>&nbsp;<span class="op" id="4296278">&lt;</span>&nbsp;<span class="num" id="4296280">3</span>&nbsp;<span class="op" id="4296282">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296287">if</span>&nbsp;<span class="ident" id="4296290">err</span>&nbsp;<span class="op" id="4296294">:=</span>&nbsp;<span class="ident" id="4296297">f</span><span class="op" id="4296298">.</span><span class="ident" id="4296299">moreBits</span><span class="op" id="4296307">(</span><span class="op" id="4296308">)</span><span class="op" id="4296309">;</span>&nbsp;<span class="ident" id="4296311">err</span>&nbsp;<span class="op" id="4296315">!=</span>&nbsp;<span class="ident" id="4296318">nil</span>&nbsp;<span class="op" id="4296322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296328">return</span>&nbsp;<span class="ident" id="4296335">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296350">f</span><span class="op" id="4296351">.</span><span class="ident" id="4296352">codebits</span><span class="op" id="4296360">[</span><span class="ident" id="4296361">codeOrder</span><span class="op" id="4296370">[</span><span class="ident" id="4296371">i</span><span class="op" id="4296372">]</span><span class="op" id="4296373">]</span>&nbsp;<span class="op" id="4296375">=</span>&nbsp;<span class="builtintype" id="4296377">int</span><span class="op" id="4296380">(</span><span class="ident" id="4296381">f</span><span class="op" id="4296382">.</span><span class="ident" id="4296383">b</span>&nbsp;<span class="op" id="4296385">&amp;</span>&nbsp;<span class="num" id="4296387">0x7</span><span class="op" id="4296390">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296394">f</span><span class="op" id="4296395">.</span><span class="ident" id="4296396">b</span>&nbsp;<span class="op" id="4296398">&gt;&gt;=</span>&nbsp;<span class="num" id="4296402">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296406">f</span><span class="op" id="4296407">.</span><span class="ident" id="4296408">nb</span>&nbsp;<span class="op" id="4296411">-=</span>&nbsp;<span class="num" id="4296414">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296420">for</span>&nbsp;<span class="ident" id="4296424">i</span>&nbsp;<span class="op" id="4296426">:=</span>&nbsp;<span class="ident" id="4296429">nclen</span><span class="op" id="4296434">;</span>&nbsp;<span class="ident" id="4296436">i</span>&nbsp;<span class="op" id="4296438">&lt;</span>&nbsp;<span class="builtinfunc" id="4296440">len</span><span class="op" id="4296443">(</span><span class="ident" id="4296444">codeOrder</span><span class="op" id="4296453">)</span><span class="op" id="4296454">;</span>&nbsp;<span class="ident" id="4296456">i</span><span class="op" id="4296457">++</span>&nbsp;<span class="op" id="4296460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296464">f</span><span class="op" id="4296465">.</span><span class="ident" id="4296466">codebits</span><span class="op" id="4296474">[</span><span class="ident" id="4296475">codeOrder</span><span class="op" id="4296484">[</span><span class="ident" id="4296485">i</span><span class="op" id="4296486">]</span><span class="op" id="4296487">]</span>&nbsp;<span class="op" id="4296489">=</span>&nbsp;<span class="num" id="4296491">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296497">if</span>&nbsp;<span class="op" id="4296500">!</span><span class="ident" id="4296501">f</span><span class="op" id="4296502">.</span><span class="ident" id="4296503">h1</span><span class="op" id="4296505">.</span><span class="ident" id="4296506">init</span><span class="op" id="4296510">(</span><span class="ident" id="4296511">f</span><span class="op" id="4296512">.</span><span class="ident" id="4296513">codebits</span><span class="op" id="4296521">[</span><span class="num" id="4296522">0</span><span class="op" id="4296523">:</span><span class="op" id="4296524">]</span><span class="op" id="4296525">)</span>&nbsp;<span class="op" id="4296527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296531">return</span>&nbsp;<span class="ident" id="4296538">CorruptInputError</span><span class="op" id="4296555">(</span><span class="ident" id="4296556">f</span><span class="op" id="4296557">.</span><span class="ident" id="4296558">roffset</span><span class="op" id="4296565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4296572">//&nbsp;HLIT&nbsp;+&nbsp;257&nbsp;code&nbsp;lengths,&nbsp;HDIST&nbsp;+&nbsp;1&nbsp;code&nbsp;lengths,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4296625">//&nbsp;using&nbsp;the&nbsp;code&nbsp;length&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296665">for</span>&nbsp;<span class="ident" id="4296669">i</span><span class="op" id="4296670">,</span>&nbsp;<span class="ident" id="4296672">n</span>&nbsp;<span class="op" id="4296674">:=</span>&nbsp;<span class="num" id="4296677">0</span><span class="op" id="4296678">,</span>&nbsp;<span class="ident" id="4296680">nlit</span><span class="op" id="4296684">+</span><span class="ident" id="4296685">ndist</span><span class="op" id="4296690">;</span>&nbsp;<span class="ident" id="4296692">i</span>&nbsp;<span class="op" id="4296694">&lt;</span>&nbsp;<span class="ident" id="4296696">n</span><span class="op" id="4296697">;</span>&nbsp;<span class="op" id="4296699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296703">x</span><span class="op" id="4296704">,</span>&nbsp;<span class="ident" id="4296706">err</span>&nbsp;<span class="op" id="4296710">:=</span>&nbsp;<span class="ident" id="4296713">f</span><span class="op" id="4296714">.</span><span class="ident" id="4296715">huffSym</span><span class="op" id="4296722">(</span><span class="op" id="4296723">&amp;</span><span class="ident" id="4296724">f</span><span class="op" id="4296725">.</span><span class="ident" id="4296726">h1</span><span class="op" id="4296728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296732">if</span>&nbsp;<span class="ident" id="4296735">err</span>&nbsp;<span class="op" id="4296739">!=</span>&nbsp;<span class="ident" id="4296742">nil</span>&nbsp;<span class="op" id="4296746">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296751">return</span>&nbsp;<span class="ident" id="4296758">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296768">if</span>&nbsp;<span class="ident" id="4296771">x</span>&nbsp;<span class="op" id="4296773">&lt;</span>&nbsp;<span class="num" id="4296775">16</span>&nbsp;<span class="op" id="4296778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4296783">//&nbsp;Actual&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296804">f</span><span class="op" id="4296805">.</span><span class="ident" id="4296806">bits</span><span class="op" id="4296810">[</span><span class="ident" id="4296811">i</span><span class="op" id="4296812">]</span>&nbsp;<span class="op" id="4296814">=</span>&nbsp;<span class="ident" id="4296816">x</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296821">i</span><span class="op" id="4296822">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296828">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4296839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4296843">//&nbsp;Repeat&nbsp;previous&nbsp;length&nbsp;or&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296880">var</span>&nbsp;<span class="ident" id="4296884">rep</span>&nbsp;<span class="builtintype" id="4296888">int</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296894">var</span>&nbsp;<span class="ident" id="4296898">nb</span>&nbsp;<span class="builtintype" id="4296901">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296908">var</span>&nbsp;<span class="ident" id="4296912">b</span>&nbsp;<span class="builtintype" id="4296914">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296920">switch</span>&nbsp;<span class="ident" id="4296927">x</span>&nbsp;<span class="op" id="4296929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296933">default</span><span class="op" id="4296940">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296945">return</span>&nbsp;<span class="ident" id="4296952">InternalError</span><span class="op" id="4296965">(</span><span class="string" id="4296966">&#34;unexpected&nbsp;length&nbsp;code&#34;</span><span class="op" id="4296990">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4296994">case</span>&nbsp;<span class="num" id="4296999">16</span><span class="op" id="4297001">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297006">rep</span>&nbsp;<span class="op" id="4297010">=</span>&nbsp;<span class="num" id="4297012">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297017">nb</span>&nbsp;<span class="op" id="4297020">=</span>&nbsp;<span class="num" id="4297022">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297027">if</span>&nbsp;<span class="ident" id="4297030">i</span>&nbsp;<span class="op" id="4297032">==</span>&nbsp;<span class="num" id="4297035">0</span>&nbsp;<span class="op" id="4297037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297043">return</span>&nbsp;<span class="ident" id="4297050">CorruptInputError</span><span class="op" id="4297067">(</span><span class="ident" id="4297068">f</span><span class="op" id="4297069">.</span><span class="ident" id="4297070">roffset</span><span class="op" id="4297077">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297087">b</span>&nbsp;<span class="op" id="4297089">=</span>&nbsp;<span class="ident" id="4297091">f</span><span class="op" id="4297092">.</span><span class="ident" id="4297093">bits</span><span class="op" id="4297097">[</span><span class="ident" id="4297098">i</span><span class="op" id="4297099">-</span><span class="num" id="4297100">1</span><span class="op" id="4297101">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297105">case</span>&nbsp;<span class="num" id="4297110">17</span><span class="op" id="4297112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297117">rep</span>&nbsp;<span class="op" id="4297121">=</span>&nbsp;<span class="num" id="4297123">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297128">nb</span>&nbsp;<span class="op" id="4297131">=</span>&nbsp;<span class="num" id="4297133">3</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297138">b</span>&nbsp;<span class="op" id="4297140">=</span>&nbsp;<span class="num" id="4297142">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297146">case</span>&nbsp;<span class="num" id="4297151">18</span><span class="op" id="4297153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297158">rep</span>&nbsp;<span class="op" id="4297162">=</span>&nbsp;<span class="num" id="4297164">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297170">nb</span>&nbsp;<span class="op" id="4297173">=</span>&nbsp;<span class="num" id="4297175">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297180">b</span>&nbsp;<span class="op" id="4297182">=</span>&nbsp;<span class="num" id="4297184">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297192">for</span>&nbsp;<span class="ident" id="4297196">f</span><span class="op" id="4297197">.</span><span class="ident" id="4297198">nb</span>&nbsp;<span class="op" id="4297201">&lt;</span>&nbsp;<span class="ident" id="4297203">nb</span>&nbsp;<span class="op" id="4297206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297211">if</span>&nbsp;<span class="ident" id="4297214">err</span>&nbsp;<span class="op" id="4297218">:=</span>&nbsp;<span class="ident" id="4297221">f</span><span class="op" id="4297222">.</span><span class="ident" id="4297223">moreBits</span><span class="op" id="4297231">(</span><span class="op" id="4297232">)</span><span class="op" id="4297233">;</span>&nbsp;<span class="ident" id="4297235">err</span>&nbsp;<span class="op" id="4297239">!=</span>&nbsp;<span class="ident" id="4297242">nil</span>&nbsp;<span class="op" id="4297246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297252">return</span>&nbsp;<span class="ident" id="4297259">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297266">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297274">rep</span>&nbsp;<span class="op" id="4297278">+=</span>&nbsp;<span class="builtintype" id="4297281">int</span><span class="op" id="4297284">(</span><span class="ident" id="4297285">f</span><span class="op" id="4297286">.</span><span class="ident" id="4297287">b</span>&nbsp;<span class="op" id="4297289">&amp;</span>&nbsp;<span class="builtintype" id="4297291">uint32</span><span class="op" id="4297297">(</span><span class="num" id="4297298">1</span><span class="op" id="4297299">&lt;&lt;</span><span class="ident" id="4297301">nb</span><span class="op" id="4297303">-</span><span class="num" id="4297304">1</span><span class="op" id="4297305">)</span><span class="op" id="4297306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297310">f</span><span class="op" id="4297311">.</span><span class="ident" id="4297312">b</span>&nbsp;<span class="op" id="4297314">&gt;&gt;=</span>&nbsp;<span class="ident" id="4297318">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297323">f</span><span class="op" id="4297324">.</span><span class="ident" id="4297325">nb</span>&nbsp;<span class="op" id="4297328">-=</span>&nbsp;<span class="ident" id="4297331">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297336">if</span>&nbsp;<span class="ident" id="4297339">i</span><span class="op" id="4297340">+</span><span class="ident" id="4297341">rep</span>&nbsp;<span class="op" id="4297345">&gt;</span>&nbsp;<span class="ident" id="4297347">n</span>&nbsp;<span class="op" id="4297349">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297354">return</span>&nbsp;<span class="ident" id="4297361">CorruptInputError</span><span class="op" id="4297378">(</span><span class="ident" id="4297379">f</span><span class="op" id="4297380">.</span><span class="ident" id="4297381">roffset</span><span class="op" id="4297388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297396">for</span>&nbsp;<span class="ident" id="4297400">j</span>&nbsp;<span class="op" id="4297402">:=</span>&nbsp;<span class="num" id="4297405">0</span><span class="op" id="4297406">;</span>&nbsp;<span class="ident" id="4297408">j</span>&nbsp;<span class="op" id="4297410">&lt;</span>&nbsp;<span class="ident" id="4297412">rep</span><span class="op" id="4297415">;</span>&nbsp;<span class="ident" id="4297417">j</span><span class="op" id="4297418">++</span>&nbsp;<span class="op" id="4297421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297426">f</span><span class="op" id="4297427">.</span><span class="ident" id="4297428">bits</span><span class="op" id="4297432">[</span><span class="ident" id="4297433">i</span><span class="op" id="4297434">]</span>&nbsp;<span class="op" id="4297436">=</span>&nbsp;<span class="ident" id="4297438">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297443">i</span><span class="op" id="4297444">++</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297456">if</span>&nbsp;<span class="op" id="4297459">!</span><span class="ident" id="4297460">f</span><span class="op" id="4297461">.</span><span class="ident" id="4297462">h1</span><span class="op" id="4297464">.</span><span class="ident" id="4297465">init</span><span class="op" id="4297469">(</span><span class="ident" id="4297470">f</span><span class="op" id="4297471">.</span><span class="ident" id="4297472">bits</span><span class="op" id="4297476">[</span><span class="num" id="4297477">0</span><span class="op" id="4297478">:</span><span class="ident" id="4297479">nlit</span><span class="op" id="4297483">]</span><span class="op" id="4297484">)</span>&nbsp;<span class="op" id="4297486">||</span>&nbsp;<span class="op" id="4297489">!</span><span class="ident" id="4297490">f</span><span class="op" id="4297491">.</span><span class="ident" id="4297492">h2</span><span class="op" id="4297494">.</span><span class="ident" id="4297495">init</span><span class="op" id="4297499">(</span><span class="ident" id="4297500">f</span><span class="op" id="4297501">.</span><span class="ident" id="4297502">bits</span><span class="op" id="4297506">[</span><span class="ident" id="4297507">nlit</span><span class="op" id="4297511">:</span><span class="ident" id="4297512">nlit</span><span class="op" id="4297516">+</span><span class="ident" id="4297517">ndist</span><span class="op" id="4297522">]</span><span class="op" id="4297523">)</span>&nbsp;<span class="op" id="4297525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297529">return</span>&nbsp;<span class="ident" id="4297536">CorruptInputError</span><span class="op" id="4297553">(</span><span class="ident" id="4297554">f</span><span class="op" id="4297555">.</span><span class="ident" id="4297556">roffset</span><span class="op" id="4297563">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297570">return</span>&nbsp;<span class="ident" id="4297577">nil</span><br>
<span class="lineno"></span><span class="op" id="4297581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="4297584">//&nbsp;Decode&nbsp;a&nbsp;single&nbsp;Huffman&nbsp;block&nbsp;from&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="4297625">//&nbsp;hl&nbsp;and&nbsp;hd&nbsp;are&nbsp;the&nbsp;Huffman&nbsp;states&nbsp;for&nbsp;the&nbsp;lit/length&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4297687">//&nbsp;and&nbsp;the&nbsp;distance&nbsp;values,&nbsp;respectively.&nbsp;&nbsp;If&nbsp;hd&nbsp;==&nbsp;nil,&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4297754">//&nbsp;fixed&nbsp;distance&nbsp;encoding&nbsp;associated&nbsp;with&nbsp;fixed&nbsp;Huffman&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="4297819">func</span>&nbsp;<span class="op" id="4297824">(</span><span class="ident" id="4297825">f</span>&nbsp;<span class="op" id="4297827">*</span><span class="ident" id="4297828">decompressor</span><span class="op" id="4297840">)</span>&nbsp;<span class="ident" id="4297842">huffmanBlock</span><span class="op" id="4297854">(</span><span class="op" id="4297855">)</span>&nbsp;<span class="op" id="4297857">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297860">for</span>&nbsp;<span class="op" id="4297864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297868">v</span><span class="op" id="4297869">,</span>&nbsp;<span class="ident" id="4297871">err</span>&nbsp;<span class="op" id="4297875">:=</span>&nbsp;<span class="ident" id="4297878">f</span><span class="op" id="4297879">.</span><span class="ident" id="4297880">huffSym</span><span class="op" id="4297887">(</span><span class="ident" id="4297888">f</span><span class="op" id="4297889">.</span><span class="ident" id="4297890">hl</span><span class="op" id="4297892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297896">if</span>&nbsp;<span class="ident" id="4297899">err</span>&nbsp;<span class="op" id="4297903">!=</span>&nbsp;<span class="ident" id="4297906">nil</span>&nbsp;<span class="op" id="4297910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297915">f</span><span class="op" id="4297916">.</span><span class="ident" id="4297917">err</span>&nbsp;<span class="op" id="4297921">=</span>&nbsp;<span class="ident" id="4297923">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297930">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297943">var</span>&nbsp;<span class="ident" id="4297947">n</span>&nbsp;<span class="builtintype" id="4297949">uint</span>&nbsp;<span class="comment" id="4297954">//&nbsp;number&nbsp;of&nbsp;bits&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297980">var</span>&nbsp;<span class="ident" id="4297984">length</span>&nbsp;<span class="builtintype" id="4297991">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297997">switch</span>&nbsp;<span class="op" id="4298004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298008">case</span>&nbsp;<span class="ident" id="4298013">v</span>&nbsp;<span class="op" id="4298015">&lt;</span>&nbsp;<span class="num" id="4298017">256</span><span class="op" id="4298020">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298025">f</span><span class="op" id="4298026">.</span><span class="ident" id="4298027">hist</span><span class="op" id="4298031">[</span><span class="ident" id="4298032">f</span><span class="op" id="4298033">.</span><span class="ident" id="4298034">hp</span><span class="op" id="4298036">]</span>&nbsp;<span class="op" id="4298038">=</span>&nbsp;<span class="builtintype" id="4298040">byte</span><span class="op" id="4298044">(</span><span class="ident" id="4298045">v</span><span class="op" id="4298046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298051">f</span><span class="op" id="4298052">.</span><span class="ident" id="4298053">hp</span><span class="op" id="4298055">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298061">if</span>&nbsp;<span class="ident" id="4298064">f</span><span class="op" id="4298065">.</span><span class="ident" id="4298066">hp</span>&nbsp;<span class="op" id="4298069">==</span>&nbsp;<span class="builtinfunc" id="4298072">len</span><span class="op" id="4298075">(</span><span class="ident" id="4298076">f</span><span class="op" id="4298077">.</span><span class="ident" id="4298078">hist</span><span class="op" id="4298082">)</span>&nbsp;<span class="op" id="4298084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4298090">//&nbsp;After&nbsp;the&nbsp;flush,&nbsp;continue&nbsp;this&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298134">f</span><span class="op" id="4298135">.</span><span class="ident" id="4298136">flush</span><span class="op" id="4298141">(</span><span class="op" id="4298142">(</span><span class="op" id="4298143">*</span><span class="ident" id="4298144">decompressor</span><span class="op" id="4298156">)</span><span class="op" id="4298157">.</span><span class="ident" id="4298158">huffmanBlock</span><span class="op" id="4298170">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298176">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298191">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298202">case</span>&nbsp;<span class="ident" id="4298207">v</span>&nbsp;<span class="op" id="4298209">==</span>&nbsp;<span class="num" id="4298212">256</span><span class="op" id="4298215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4298220">//&nbsp;Done&nbsp;with&nbsp;huffman&nbsp;block;&nbsp;read&nbsp;next&nbsp;block.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298268">f</span><span class="op" id="4298269">.</span><span class="ident" id="4298270">step</span>&nbsp;<span class="op" id="4298275">=</span>&nbsp;<span class="op" id="4298277">(</span><span class="op" id="4298278">*</span><span class="ident" id="4298279">decompressor</span><span class="op" id="4298291">)</span><span class="op" id="4298292">.</span><span class="ident" id="4298293">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298306">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4298315">//&nbsp;otherwise,&nbsp;reference&nbsp;to&nbsp;older&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298355">case</span>&nbsp;<span class="ident" id="4298360">v</span>&nbsp;<span class="op" id="4298362">&lt;</span>&nbsp;<span class="num" id="4298364">265</span><span class="op" id="4298367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298372">length</span>&nbsp;<span class="op" id="4298379">=</span>&nbsp;<span class="ident" id="4298381">v</span>&nbsp;<span class="op" id="4298383">-</span>&nbsp;<span class="op" id="4298385">(</span><span class="num" id="4298386">257</span>&nbsp;<span class="op" id="4298390">-</span>&nbsp;<span class="num" id="4298392">3</span><span class="op" id="4298393">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298398">n</span>&nbsp;<span class="op" id="4298400">=</span>&nbsp;<span class="num" id="4298402">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298406">case</span>&nbsp;<span class="ident" id="4298411">v</span>&nbsp;<span class="op" id="4298413">&lt;</span>&nbsp;<span class="num" id="4298415">269</span><span class="op" id="4298418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298423">length</span>&nbsp;<span class="op" id="4298430">=</span>&nbsp;<span class="ident" id="4298432">v</span><span class="op" id="4298433">*</span><span class="num" id="4298434">2</span>&nbsp;<span class="op" id="4298436">-</span>&nbsp;<span class="op" id="4298438">(</span><span class="num" id="4298439">265</span><span class="op" id="4298442">*</span><span class="num" id="4298443">2</span>&nbsp;<span class="op" id="4298445">-</span>&nbsp;<span class="num" id="4298447">11</span><span class="op" id="4298449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298454">n</span>&nbsp;<span class="op" id="4298456">=</span>&nbsp;<span class="num" id="4298458">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298462">case</span>&nbsp;<span class="ident" id="4298467">v</span>&nbsp;<span class="op" id="4298469">&lt;</span>&nbsp;<span class="num" id="4298471">273</span><span class="op" id="4298474">:</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298479">length</span>&nbsp;<span class="op" id="4298486">=</span>&nbsp;<span class="ident" id="4298488">v</span><span class="op" id="4298489">*</span><span class="num" id="4298490">4</span>&nbsp;<span class="op" id="4298492">-</span>&nbsp;<span class="op" id="4298494">(</span><span class="num" id="4298495">269</span><span class="op" id="4298498">*</span><span class="num" id="4298499">4</span>&nbsp;<span class="op" id="4298501">-</span>&nbsp;<span class="num" id="4298503">19</span><span class="op" id="4298505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298510">n</span>&nbsp;<span class="op" id="4298512">=</span>&nbsp;<span class="num" id="4298514">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298518">case</span>&nbsp;<span class="ident" id="4298523">v</span>&nbsp;<span class="op" id="4298525">&lt;</span>&nbsp;<span class="num" id="4298527">277</span><span class="op" id="4298530">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298535">length</span>&nbsp;<span class="op" id="4298542">=</span>&nbsp;<span class="ident" id="4298544">v</span><span class="op" id="4298545">*</span><span class="num" id="4298546">8</span>&nbsp;<span class="op" id="4298548">-</span>&nbsp;<span class="op" id="4298550">(</span><span class="num" id="4298551">273</span><span class="op" id="4298554">*</span><span class="num" id="4298555">8</span>&nbsp;<span class="op" id="4298557">-</span>&nbsp;<span class="num" id="4298559">35</span><span class="op" id="4298561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298566">n</span>&nbsp;<span class="op" id="4298568">=</span>&nbsp;<span class="num" id="4298570">3</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298574">case</span>&nbsp;<span class="ident" id="4298579">v</span>&nbsp;<span class="op" id="4298581">&lt;</span>&nbsp;<span class="num" id="4298583">281</span><span class="op" id="4298586">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298591">length</span>&nbsp;<span class="op" id="4298598">=</span>&nbsp;<span class="ident" id="4298600">v</span><span class="op" id="4298601">*</span><span class="num" id="4298602">16</span>&nbsp;<span class="op" id="4298605">-</span>&nbsp;<span class="op" id="4298607">(</span><span class="num" id="4298608">277</span><span class="op" id="4298611">*</span><span class="num" id="4298612">16</span>&nbsp;<span class="op" id="4298615">-</span>&nbsp;<span class="num" id="4298617">67</span><span class="op" id="4298619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298624">n</span>&nbsp;<span class="op" id="4298626">=</span>&nbsp;<span class="num" id="4298628">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298632">case</span>&nbsp;<span class="ident" id="4298637">v</span>&nbsp;<span class="op" id="4298639">&lt;</span>&nbsp;<span class="num" id="4298641">285</span><span class="op" id="4298644">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298649">length</span>&nbsp;<span class="op" id="4298656">=</span>&nbsp;<span class="ident" id="4298658">v</span><span class="op" id="4298659">*</span><span class="num" id="4298660">32</span>&nbsp;<span class="op" id="4298663">-</span>&nbsp;<span class="op" id="4298665">(</span><span class="num" id="4298666">281</span><span class="op" id="4298669">*</span><span class="num" id="4298670">32</span>&nbsp;<span class="op" id="4298673">-</span>&nbsp;<span class="num" id="4298675">131</span><span class="op" id="4298678">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298683">n</span>&nbsp;<span class="op" id="4298685">=</span>&nbsp;<span class="num" id="4298687">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298691">default</span><span class="op" id="4298698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298703">length</span>&nbsp;<span class="op" id="4298710">=</span>&nbsp;<span class="num" id="4298712">258</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298719">n</span>&nbsp;<span class="op" id="4298721">=</span>&nbsp;<span class="num" id="4298723">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298727">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298731">if</span>&nbsp;<span class="ident" id="4298734">n</span>&nbsp;<span class="op" id="4298736">&gt;</span>&nbsp;<span class="num" id="4298738">0</span>&nbsp;<span class="op" id="4298740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298745">for</span>&nbsp;<span class="ident" id="4298749">f</span><span class="op" id="4298750">.</span><span class="ident" id="4298751">nb</span>&nbsp;<span class="op" id="4298754">&lt;</span>&nbsp;<span class="ident" id="4298756">n</span>&nbsp;<span class="op" id="4298758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298764">if</span>&nbsp;<span class="ident" id="4298767">err</span>&nbsp;<span class="op" id="4298771">=</span>&nbsp;<span class="ident" id="4298773">f</span><span class="op" id="4298774">.</span><span class="ident" id="4298775">moreBits</span><span class="op" id="4298783">(</span><span class="op" id="4298784">)</span><span class="op" id="4298785">;</span>&nbsp;<span class="ident" id="4298787">err</span>&nbsp;<span class="op" id="4298791">!=</span>&nbsp;<span class="ident" id="4298794">nil</span>&nbsp;<span class="op" id="4298798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298805">f</span><span class="op" id="4298806">.</span><span class="ident" id="4298807">err</span>&nbsp;<span class="op" id="4298811">=</span>&nbsp;<span class="ident" id="4298813">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298822">return</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298843">length</span>&nbsp;<span class="op" id="4298850">+=</span>&nbsp;<span class="builtintype" id="4298853">int</span><span class="op" id="4298856">(</span><span class="ident" id="4298857">f</span><span class="op" id="4298858">.</span><span class="ident" id="4298859">b</span>&nbsp;<span class="op" id="4298861">&amp;</span>&nbsp;<span class="builtintype" id="4298863">uint32</span><span class="op" id="4298869">(</span><span class="num" id="4298870">1</span><span class="op" id="4298871">&lt;&lt;</span><span class="ident" id="4298873">n</span><span class="op" id="4298874">-</span><span class="num" id="4298875">1</span><span class="op" id="4298876">)</span><span class="op" id="4298877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298882">f</span><span class="op" id="4298883">.</span><span class="ident" id="4298884">b</span>&nbsp;<span class="op" id="4298886">&gt;&gt;=</span>&nbsp;<span class="ident" id="4298890">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298895">f</span><span class="op" id="4298896">.</span><span class="ident" id="4298897">nb</span>&nbsp;<span class="op" id="4298900">-=</span>&nbsp;<span class="ident" id="4298903">n</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298912">var</span>&nbsp;<span class="ident" id="4298916">dist</span>&nbsp;<span class="builtintype" id="4298921">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298927">if</span>&nbsp;<span class="ident" id="4298930">f</span><span class="op" id="4298931">.</span><span class="ident" id="4298932">hd</span>&nbsp;<span class="op" id="4298935">==</span>&nbsp;<span class="ident" id="4298938">nil</span>&nbsp;<span class="op" id="4298942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298947">for</span>&nbsp;<span class="ident" id="4298951">f</span><span class="op" id="4298952">.</span><span class="ident" id="4298953">nb</span>&nbsp;<span class="op" id="4298956">&lt;</span>&nbsp;<span class="num" id="4298958">5</span>&nbsp;<span class="op" id="4298960">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298966">if</span>&nbsp;<span class="ident" id="4298969">err</span>&nbsp;<span class="op" id="4298973">=</span>&nbsp;<span class="ident" id="4298975">f</span><span class="op" id="4298976">.</span><span class="ident" id="4298977">moreBits</span><span class="op" id="4298985">(</span><span class="op" id="4298986">)</span><span class="op" id="4298987">;</span>&nbsp;<span class="ident" id="4298989">err</span>&nbsp;<span class="op" id="4298993">!=</span>&nbsp;<span class="ident" id="4298996">nil</span>&nbsp;<span class="op" id="4299000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299007">f</span><span class="op" id="4299008">.</span><span class="ident" id="4299009">err</span>&nbsp;<span class="op" id="4299013">=</span>&nbsp;<span class="ident" id="4299015">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299024">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299040">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299045">dist</span>&nbsp;<span class="op" id="4299050">=</span>&nbsp;<span class="builtintype" id="4299052">int</span><span class="op" id="4299055">(</span><span class="ident" id="4299056">reverseByte</span><span class="op" id="4299067">[</span><span class="op" id="4299068">(</span><span class="ident" id="4299069">f</span><span class="op" id="4299070">.</span><span class="ident" id="4299071">b</span><span class="op" id="4299072">&amp;</span><span class="num" id="4299073">0x1F</span><span class="op" id="4299077">)</span><span class="op" id="4299078">&lt;&lt;</span><span class="num" id="4299080">3</span><span class="op" id="4299081">]</span><span class="op" id="4299082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299087">f</span><span class="op" id="4299088">.</span><span class="ident" id="4299089">b</span>&nbsp;<span class="op" id="4299091">&gt;&gt;=</span>&nbsp;<span class="num" id="4299095">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299100">f</span><span class="op" id="4299101">.</span><span class="ident" id="4299102">nb</span>&nbsp;<span class="op" id="4299105">-=</span>&nbsp;<span class="num" id="4299108">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299112">}</span>&nbsp;<span class="keyword" id="4299114">else</span>&nbsp;<span class="op" id="4299119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299124">if</span>&nbsp;<span class="ident" id="4299127">dist</span><span class="op" id="4299131">,</span>&nbsp;<span class="ident" id="4299133">err</span>&nbsp;<span class="op" id="4299137">=</span>&nbsp;<span class="ident" id="4299139">f</span><span class="op" id="4299140">.</span><span class="ident" id="4299141">huffSym</span><span class="op" id="4299148">(</span><span class="ident" id="4299149">f</span><span class="op" id="4299150">.</span><span class="ident" id="4299151">hd</span><span class="op" id="4299153">)</span><span class="op" id="4299154">;</span>&nbsp;<span class="ident" id="4299156">err</span>&nbsp;<span class="op" id="4299160">!=</span>&nbsp;<span class="ident" id="4299163">nil</span>&nbsp;<span class="op" id="4299167">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299173">f</span><span class="op" id="4299174">.</span><span class="ident" id="4299175">err</span>&nbsp;<span class="op" id="4299179">=</span>&nbsp;<span class="ident" id="4299181">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299189">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299208">switch</span>&nbsp;<span class="op" id="4299215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299219">case</span>&nbsp;<span class="ident" id="4299224">dist</span>&nbsp;<span class="op" id="4299229">&lt;</span>&nbsp;<span class="num" id="4299231">4</span><span class="op" id="4299232">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299237">dist</span><span class="op" id="4299241">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299246">case</span>&nbsp;<span class="ident" id="4299251">dist</span>&nbsp;<span class="op" id="4299256">&gt;=</span>&nbsp;<span class="num" id="4299259">30</span><span class="op" id="4299261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299266">f</span><span class="op" id="4299267">.</span><span class="ident" id="4299268">err</span>&nbsp;<span class="op" id="4299272">=</span>&nbsp;<span class="ident" id="4299274">CorruptInputError</span><span class="op" id="4299291">(</span><span class="ident" id="4299292">f</span><span class="op" id="4299293">.</span><span class="ident" id="4299294">roffset</span><span class="op" id="4299301">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299306">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299315">default</span><span class="op" id="4299322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299327">nb</span>&nbsp;<span class="op" id="4299330">:=</span>&nbsp;<span class="builtintype" id="4299333">uint</span><span class="op" id="4299337">(</span><span class="ident" id="4299338">dist</span><span class="op" id="4299342">-</span><span class="num" id="4299343">2</span><span class="op" id="4299344">)</span>&nbsp;<span class="op" id="4299346">&gt;&gt;</span>&nbsp;<span class="num" id="4299349">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4299354">//&nbsp;have&nbsp;1&nbsp;bit&nbsp;in&nbsp;bottom&nbsp;of&nbsp;dist,&nbsp;need&nbsp;nb&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299404">extra</span>&nbsp;<span class="op" id="4299410">:=</span>&nbsp;<span class="op" id="4299413">(</span><span class="ident" id="4299414">dist</span>&nbsp;<span class="op" id="4299419">&amp;</span>&nbsp;<span class="num" id="4299421">1</span><span class="op" id="4299422">)</span>&nbsp;<span class="op" id="4299424">&lt;&lt;</span>&nbsp;<span class="ident" id="4299427">nb</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299433">for</span>&nbsp;<span class="ident" id="4299437">f</span><span class="op" id="4299438">.</span><span class="ident" id="4299439">nb</span>&nbsp;<span class="op" id="4299442">&lt;</span>&nbsp;<span class="ident" id="4299444">nb</span>&nbsp;<span class="op" id="4299447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299453">if</span>&nbsp;<span class="ident" id="4299456">err</span>&nbsp;<span class="op" id="4299460">=</span>&nbsp;<span class="ident" id="4299462">f</span><span class="op" id="4299463">.</span><span class="ident" id="4299464">moreBits</span><span class="op" id="4299472">(</span><span class="op" id="4299473">)</span><span class="op" id="4299474">;</span>&nbsp;<span class="ident" id="4299476">err</span>&nbsp;<span class="op" id="4299480">!=</span>&nbsp;<span class="ident" id="4299483">nil</span>&nbsp;<span class="op" id="4299487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299494">f</span><span class="op" id="4299495">.</span><span class="ident" id="4299496">err</span>&nbsp;<span class="op" id="4299500">=</span>&nbsp;<span class="ident" id="4299502">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299511">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299522">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299532">extra</span>&nbsp;<span class="op" id="4299538">|=</span>&nbsp;<span class="builtintype" id="4299541">int</span><span class="op" id="4299544">(</span><span class="ident" id="4299545">f</span><span class="op" id="4299546">.</span><span class="ident" id="4299547">b</span>&nbsp;<span class="op" id="4299549">&amp;</span>&nbsp;<span class="builtintype" id="4299551">uint32</span><span class="op" id="4299557">(</span><span class="num" id="4299558">1</span><span class="op" id="4299559">&lt;&lt;</span><span class="ident" id="4299561">nb</span><span class="op" id="4299563">-</span><span class="num" id="4299564">1</span><span class="op" id="4299565">)</span><span class="op" id="4299566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299571">f</span><span class="op" id="4299572">.</span><span class="ident" id="4299573">b</span>&nbsp;<span class="op" id="4299575">&gt;&gt;=</span>&nbsp;<span class="ident" id="4299579">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299585">f</span><span class="op" id="4299586">.</span><span class="ident" id="4299587">nb</span>&nbsp;<span class="op" id="4299590">-=</span>&nbsp;<span class="ident" id="4299593">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299599">dist</span>&nbsp;<span class="op" id="4299604">=</span>&nbsp;<span class="num" id="4299606">1</span><span class="op" id="4299607">&lt;&lt;</span><span class="op" id="4299609">(</span><span class="ident" id="4299610">nb</span><span class="op" id="4299612">+</span><span class="num" id="4299613">1</span><span class="op" id="4299614">)</span>&nbsp;<span class="op" id="4299616">+</span>&nbsp;<span class="num" id="4299618">1</span>&nbsp;<span class="op" id="4299620">+</span>&nbsp;<span class="ident" id="4299622">extra</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4299635">//&nbsp;Copy&nbsp;history[-dist:-dist+length]&nbsp;into&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299686">if</span>&nbsp;<span class="ident" id="4299689">dist</span>&nbsp;<span class="op" id="4299694">&gt;</span>&nbsp;<span class="builtinfunc" id="4299696">len</span><span class="op" id="4299699">(</span><span class="ident" id="4299700">f</span><span class="op" id="4299701">.</span><span class="ident" id="4299702">hist</span><span class="op" id="4299706">)</span>&nbsp;<span class="op" id="4299708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299713">f</span><span class="op" id="4299714">.</span><span class="ident" id="4299715">err</span>&nbsp;<span class="op" id="4299719">=</span>&nbsp;<span class="ident" id="4299721">InternalError</span><span class="op" id="4299734">(</span><span class="string" id="4299735">&#34;bad&nbsp;history&nbsp;distance&#34;</span><span class="op" id="4299757">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299762">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4299776">//&nbsp;No&nbsp;check&nbsp;on&nbsp;length;&nbsp;encoding&nbsp;can&nbsp;be&nbsp;prescient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299828">if</span>&nbsp;<span class="op" id="4299831">!</span><span class="ident" id="4299832">f</span><span class="op" id="4299833">.</span><span class="ident" id="4299834">hfull</span>&nbsp;<span class="op" id="4299840">&amp;&amp;</span>&nbsp;<span class="ident" id="4299843">dist</span>&nbsp;<span class="op" id="4299848">&gt;</span>&nbsp;<span class="ident" id="4299850">f</span><span class="op" id="4299851">.</span><span class="ident" id="4299852">hp</span>&nbsp;<span class="op" id="4299855">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299860">f</span><span class="op" id="4299861">.</span><span class="ident" id="4299862">err</span>&nbsp;<span class="op" id="4299866">=</span>&nbsp;<span class="ident" id="4299868">CorruptInputError</span><span class="op" id="4299885">(</span><span class="ident" id="4299886">f</span><span class="op" id="4299887">.</span><span class="ident" id="4299888">roffset</span><span class="op" id="4299895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299900">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299914">f</span><span class="op" id="4299915">.</span><span class="ident" id="4299916">copyLen</span><span class="op" id="4299923">,</span>&nbsp;<span class="ident" id="4299925">f</span><span class="op" id="4299926">.</span><span class="ident" id="4299927">copyDist</span>&nbsp;<span class="op" id="4299936">=</span>&nbsp;<span class="ident" id="4299938">length</span><span class="op" id="4299944">,</span>&nbsp;<span class="ident" id="4299946">dist</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299953">if</span>&nbsp;<span class="ident" id="4299956">f</span><span class="op" id="4299957">.</span><span class="ident" id="4299958">copyHist</span><span class="op" id="4299966">(</span><span class="op" id="4299967">)</span>&nbsp;<span class="op" id="4299969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299974">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299986">}</span><br>
<span class="lineno"></span><span class="op" id="4299988">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="comment" id="4299991">//&nbsp;copyHist&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;f.hist&nbsp;(f.copyDist&nbsp;bytes&nbsp;ago)&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="4300072">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;f.hist&nbsp;buffer&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4300121">func</span>&nbsp;<span class="op" id="4300126">(</span><span class="ident" id="4300127">f</span>&nbsp;<span class="op" id="4300129">*</span><span class="ident" id="4300130">decompressor</span><span class="op" id="4300142">)</span>&nbsp;<span class="ident" id="4300144">copyHist</span><span class="op" id="4300152">(</span><span class="op" id="4300153">)</span>&nbsp;<span class="builtintype" id="4300155">bool</span>&nbsp;<span class="op" id="4300160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300163">p</span>&nbsp;<span class="op" id="4300165">:=</span>&nbsp;<span class="ident" id="4300168">f</span><span class="op" id="4300169">.</span><span class="ident" id="4300170">hp</span>&nbsp;<span class="op" id="4300173">-</span>&nbsp;<span class="ident" id="4300175">f</span><span class="op" id="4300176">.</span><span class="ident" id="4300177">copyDist</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300187">if</span>&nbsp;<span class="ident" id="4300190">p</span>&nbsp;<span class="op" id="4300192">&lt;</span>&nbsp;<span class="num" id="4300194">0</span>&nbsp;<span class="op" id="4300196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300200">p</span>&nbsp;<span class="op" id="4300202">+=</span>&nbsp;<span class="builtinfunc" id="4300205">len</span><span class="op" id="4300208">(</span><span class="ident" id="4300209">f</span><span class="op" id="4300210">.</span><span class="ident" id="4300211">hist</span><span class="op" id="4300215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300221">for</span>&nbsp;<span class="ident" id="4300225">f</span><span class="op" id="4300226">.</span><span class="ident" id="4300227">copyLen</span>&nbsp;<span class="op" id="4300235">&gt;</span>&nbsp;<span class="num" id="4300237">0</span>&nbsp;<span class="op" id="4300239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300243">n</span>&nbsp;<span class="op" id="4300245">:=</span>&nbsp;<span class="ident" id="4300248">f</span><span class="op" id="4300249">.</span><span class="ident" id="4300250">copyLen</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300260">if</span>&nbsp;<span class="ident" id="4300263">x</span>&nbsp;<span class="op" id="4300265">:=</span>&nbsp;<span class="builtinfunc" id="4300268">len</span><span class="op" id="4300271">(</span><span class="ident" id="4300272">f</span><span class="op" id="4300273">.</span><span class="ident" id="4300274">hist</span><span class="op" id="4300278">)</span>&nbsp;<span class="op" id="4300280">-</span>&nbsp;<span class="ident" id="4300282">f</span><span class="op" id="4300283">.</span><span class="ident" id="4300284">hp</span><span class="op" id="4300286">;</span>&nbsp;<span class="ident" id="4300288">n</span>&nbsp;<span class="op" id="4300290">&gt;</span>&nbsp;<span class="ident" id="4300292">x</span>&nbsp;<span class="op" id="4300294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300299">n</span>&nbsp;<span class="op" id="4300301">=</span>&nbsp;<span class="ident" id="4300303">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300311">if</span>&nbsp;<span class="ident" id="4300314">x</span>&nbsp;<span class="op" id="4300316">:=</span>&nbsp;<span class="builtinfunc" id="4300319">len</span><span class="op" id="4300322">(</span><span class="ident" id="4300323">f</span><span class="op" id="4300324">.</span><span class="ident" id="4300325">hist</span><span class="op" id="4300329">)</span>&nbsp;<span class="op" id="4300331">-</span>&nbsp;<span class="ident" id="4300333">p</span><span class="op" id="4300334">;</span>&nbsp;<span class="ident" id="4300336">n</span>&nbsp;<span class="op" id="4300338">&gt;</span>&nbsp;<span class="ident" id="4300340">x</span>&nbsp;<span class="op" id="4300342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300347">n</span>&nbsp;<span class="op" id="4300349">=</span>&nbsp;<span class="ident" id="4300351">x</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300359">forwardCopy</span><span class="op" id="4300370">(</span><span class="ident" id="4300371">f</span><span class="op" id="4300372">.</span><span class="ident" id="4300373">hist</span><span class="op" id="4300377">[</span><span class="op" id="4300378">:</span><span class="op" id="4300379">]</span><span class="op" id="4300380">,</span>&nbsp;<span class="ident" id="4300382">f</span><span class="op" id="4300383">.</span><span class="ident" id="4300384">hp</span><span class="op" id="4300386">,</span>&nbsp;<span class="ident" id="4300388">p</span><span class="op" id="4300389">,</span>&nbsp;<span class="ident" id="4300391">n</span><span class="op" id="4300392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300396">p</span>&nbsp;<span class="op" id="4300398">+=</span>&nbsp;<span class="ident" id="4300401">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300405">f</span><span class="op" id="4300406">.</span><span class="ident" id="4300407">hp</span>&nbsp;<span class="op" id="4300410">+=</span>&nbsp;<span class="ident" id="4300413">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300417">f</span><span class="op" id="4300418">.</span><span class="ident" id="4300419">copyLen</span>&nbsp;<span class="op" id="4300427">-=</span>&nbsp;<span class="ident" id="4300430">n</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300434">if</span>&nbsp;<span class="ident" id="4300437">f</span><span class="op" id="4300438">.</span><span class="ident" id="4300439">hp</span>&nbsp;<span class="op" id="4300442">==</span>&nbsp;<span class="builtinfunc" id="4300445">len</span><span class="op" id="4300448">(</span><span class="ident" id="4300449">f</span><span class="op" id="4300450">.</span><span class="ident" id="4300451">hist</span><span class="op" id="4300455">)</span>&nbsp;<span class="op" id="4300457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300462">//&nbsp;After&nbsp;flush&nbsp;continue&nbsp;copying&nbsp;out&nbsp;of&nbsp;history.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300513">f</span><span class="op" id="4300514">.</span><span class="ident" id="4300515">flush</span><span class="op" id="4300520">(</span><span class="op" id="4300521">(</span><span class="op" id="4300522">*</span><span class="ident" id="4300523">decompressor</span><span class="op" id="4300535">)</span><span class="op" id="4300536">.</span><span class="ident" id="4300537">copyHuff</span><span class="op" id="4300545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300550">return</span>&nbsp;<span class="builtintype" id="4300557">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300564">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300568">if</span>&nbsp;<span class="ident" id="4300571">p</span>&nbsp;<span class="op" id="4300573">==</span>&nbsp;<span class="builtinfunc" id="4300576">len</span><span class="op" id="4300579">(</span><span class="ident" id="4300580">f</span><span class="op" id="4300581">.</span><span class="ident" id="4300582">hist</span><span class="op" id="4300586">)</span>&nbsp;<span class="op" id="4300588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300593">p</span>&nbsp;<span class="op" id="4300595">=</span>&nbsp;<span class="num" id="4300597">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300607">return</span>&nbsp;<span class="builtintype" id="4300614">false</span><br>
<span class="lineno">550</span><span class="op" id="4300620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4300623">func</span>&nbsp;<span class="op" id="4300628">(</span><span class="ident" id="4300629">f</span>&nbsp;<span class="op" id="4300631">*</span><span class="ident" id="4300632">decompressor</span><span class="op" id="4300644">)</span>&nbsp;<span class="ident" id="4300646">copyHuff</span><span class="op" id="4300654">(</span><span class="op" id="4300655">)</span>&nbsp;<span class="op" id="4300657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300660">if</span>&nbsp;<span class="ident" id="4300663">f</span><span class="op" id="4300664">.</span><span class="ident" id="4300665">copyHist</span><span class="op" id="4300673">(</span><span class="op" id="4300674">)</span>&nbsp;<span class="op" id="4300676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300680">return</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300691">f</span><span class="op" id="4300692">.</span><span class="ident" id="4300693">huffmanBlock</span><span class="op" id="4300705">(</span><span class="op" id="4300706">)</span><br>
<span class="lineno"></span><span class="op" id="4300708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4300711">//&nbsp;Copy&nbsp;a&nbsp;single&nbsp;uncompressed&nbsp;data&nbsp;block&nbsp;from&nbsp;input&nbsp;to&nbsp;output.</span><br>
<span class="lineno">560</span><span class="keyword" id="4300774">func</span>&nbsp;<span class="op" id="4300779">(</span><span class="ident" id="4300780">f</span>&nbsp;<span class="op" id="4300782">*</span><span class="ident" id="4300783">decompressor</span><span class="op" id="4300795">)</span>&nbsp;<span class="ident" id="4300797">dataBlock</span><span class="op" id="4300806">(</span><span class="op" id="4300807">)</span>&nbsp;<span class="op" id="4300809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300812">//&nbsp;Uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300830">//&nbsp;Discard&nbsp;current&nbsp;half-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300861">f</span><span class="op" id="4300862">.</span><span class="ident" id="4300863">nb</span>&nbsp;<span class="op" id="4300866">=</span>&nbsp;<span class="num" id="4300868">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300871">f</span><span class="op" id="4300872">.</span><span class="ident" id="4300873">b</span>&nbsp;<span class="op" id="4300875">=</span>&nbsp;<span class="num" id="4300877">0</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300881">//&nbsp;Length&nbsp;then&nbsp;ones-complement&nbsp;of&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300924">nr</span><span class="op" id="4300926">,</span>&nbsp;<span class="ident" id="4300928">err</span>&nbsp;<span class="op" id="4300932">:=</span>&nbsp;<span class="ident" id="4300935">io</span><span class="op" id="4300937">.</span><span class="ident" id="4300938">ReadFull</span><span class="op" id="4300946">(</span><span class="ident" id="4300947">f</span><span class="op" id="4300948">.</span><span class="ident" id="4300949">r</span><span class="op" id="4300950">,</span>&nbsp;<span class="ident" id="4300952">f</span><span class="op" id="4300953">.</span><span class="ident" id="4300954">buf</span><span class="op" id="4300957">[</span><span class="num" id="4300958">0</span><span class="op" id="4300959">:</span><span class="num" id="4300960">4</span><span class="op" id="4300961">]</span><span class="op" id="4300962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300965">f</span><span class="op" id="4300966">.</span><span class="ident" id="4300967">roffset</span>&nbsp;<span class="op" id="4300975">+=</span>&nbsp;<span class="ident" id="4300978">int64</span><span class="op" id="4300983">(</span><span class="ident" id="4300984">nr</span><span class="op" id="4300986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300989">if</span>&nbsp;<span class="ident" id="4300992">err</span>&nbsp;<span class="op" id="4300996">!=</span>&nbsp;<span class="ident" id="4300999">nil</span>&nbsp;<span class="op" id="4301003">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301007">f</span><span class="op" id="4301008">.</span><span class="ident" id="4301009">err</span>&nbsp;<span class="op" id="4301013">=</span>&nbsp;<span class="op" id="4301015">&amp;</span><span class="ident" id="4301016">ReadError</span><span class="op" id="4301025">{</span><span class="ident" id="4301026">f</span><span class="op" id="4301027">.</span><span class="ident" id="4301028">roffset</span><span class="op" id="4301035">,</span>&nbsp;<span class="ident" id="4301037">err</span><span class="op" id="4301040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301044">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301055">n</span>&nbsp;<span class="op" id="4301057">:=</span>&nbsp;<span class="builtintype" id="4301060">int</span><span class="op" id="4301063">(</span><span class="ident" id="4301064">f</span><span class="op" id="4301065">.</span><span class="ident" id="4301066">buf</span><span class="op" id="4301069">[</span><span class="num" id="4301070">0</span><span class="op" id="4301071">]</span><span class="op" id="4301072">)</span>&nbsp;<span class="op" id="4301074">|</span>&nbsp;<span class="builtintype" id="4301076">int</span><span class="op" id="4301079">(</span><span class="ident" id="4301080">f</span><span class="op" id="4301081">.</span><span class="ident" id="4301082">buf</span><span class="op" id="4301085">[</span><span class="num" id="4301086">1</span><span class="op" id="4301087">]</span><span class="op" id="4301088">)</span><span class="op" id="4301089">&lt;&lt;</span><span class="num" id="4301091">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301094">nn</span>&nbsp;<span class="op" id="4301097">:=</span>&nbsp;<span class="builtintype" id="4301100">int</span><span class="op" id="4301103">(</span><span class="ident" id="4301104">f</span><span class="op" id="4301105">.</span><span class="ident" id="4301106">buf</span><span class="op" id="4301109">[</span><span class="num" id="4301110">2</span><span class="op" id="4301111">]</span><span class="op" id="4301112">)</span>&nbsp;<span class="op" id="4301114">|</span>&nbsp;<span class="builtintype" id="4301116">int</span><span class="op" id="4301119">(</span><span class="ident" id="4301120">f</span><span class="op" id="4301121">.</span><span class="ident" id="4301122">buf</span><span class="op" id="4301125">[</span><span class="num" id="4301126">3</span><span class="op" id="4301127">]</span><span class="op" id="4301128">)</span><span class="op" id="4301129">&lt;&lt;</span><span class="num" id="4301131">8</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301134">if</span>&nbsp;<span class="builtintype" id="4301137">uint16</span><span class="op" id="4301143">(</span><span class="ident" id="4301144">nn</span><span class="op" id="4301146">)</span>&nbsp;<span class="op" id="4301148">!=</span>&nbsp;<span class="builtintype" id="4301151">uint16</span><span class="op" id="4301157">(</span><span class="op" id="4301158">^</span><span class="ident" id="4301159">n</span><span class="op" id="4301160">)</span>&nbsp;<span class="op" id="4301162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301166">f</span><span class="op" id="4301167">.</span><span class="ident" id="4301168">err</span>&nbsp;<span class="op" id="4301172">=</span>&nbsp;<span class="ident" id="4301174">CorruptInputError</span><span class="op" id="4301191">(</span><span class="ident" id="4301192">f</span><span class="op" id="4301193">.</span><span class="ident" id="4301194">roffset</span><span class="op" id="4301201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301205">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301217">if</span>&nbsp;<span class="ident" id="4301220">n</span>&nbsp;<span class="op" id="4301222">==</span>&nbsp;<span class="num" id="4301225">0</span>&nbsp;<span class="op" id="4301227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4301231">//&nbsp;0-length&nbsp;block&nbsp;means&nbsp;sync</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301262">f</span><span class="op" id="4301263">.</span><span class="ident" id="4301264">flush</span><span class="op" id="4301269">(</span><span class="op" id="4301270">(</span><span class="op" id="4301271">*</span><span class="ident" id="4301272">decompressor</span><span class="op" id="4301284">)</span><span class="op" id="4301285">.</span><span class="ident" id="4301286">nextBlock</span><span class="op" id="4301295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301299">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301307">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301311">f</span><span class="op" id="4301312">.</span><span class="ident" id="4301313">copyLen</span>&nbsp;<span class="op" id="4301321">=</span>&nbsp;<span class="ident" id="4301323">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301326">f</span><span class="op" id="4301327">.</span><span class="ident" id="4301328">copyData</span><span class="op" id="4301336">(</span><span class="op" id="4301337">)</span><br>
<span class="lineno"></span><span class="op" id="4301339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4301342">//&nbsp;copyData&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;into&nbsp;f.hist.</span><br>
<span class="lineno"></span><span class="comment" id="4301417">//&nbsp;It&nbsp;pauses&nbsp;for&nbsp;reads&nbsp;when&nbsp;f.hist&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4301461">func</span>&nbsp;<span class="op" id="4301466">(</span><span class="ident" id="4301467">f</span>&nbsp;<span class="op" id="4301469">*</span><span class="ident" id="4301470">decompressor</span><span class="op" id="4301482">)</span>&nbsp;<span class="ident" id="4301484">copyData</span><span class="op" id="4301492">(</span><span class="op" id="4301493">)</span>&nbsp;<span class="op" id="4301495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301498">n</span>&nbsp;<span class="op" id="4301500">:=</span>&nbsp;<span class="ident" id="4301503">f</span><span class="op" id="4301504">.</span><span class="ident" id="4301505">copyLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301514">for</span>&nbsp;<span class="ident" id="4301518">n</span>&nbsp;<span class="op" id="4301520">&gt;</span>&nbsp;<span class="num" id="4301522">0</span>&nbsp;<span class="op" id="4301524">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301528">m</span>&nbsp;<span class="op" id="4301530">:=</span>&nbsp;<span class="builtinfunc" id="4301533">len</span><span class="op" id="4301536">(</span><span class="ident" id="4301537">f</span><span class="op" id="4301538">.</span><span class="ident" id="4301539">hist</span><span class="op" id="4301543">)</span>&nbsp;<span class="op" id="4301545">-</span>&nbsp;<span class="ident" id="4301547">f</span><span class="op" id="4301548">.</span><span class="ident" id="4301549">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301554">if</span>&nbsp;<span class="ident" id="4301557">m</span>&nbsp;<span class="op" id="4301559">&gt;</span>&nbsp;<span class="ident" id="4301561">n</span>&nbsp;<span class="op" id="4301563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301568">m</span>&nbsp;<span class="op" id="4301570">=</span>&nbsp;<span class="ident" id="4301572">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301580">m</span><span class="op" id="4301581">,</span>&nbsp;<span class="ident" id="4301583">err</span>&nbsp;<span class="op" id="4301587">:=</span>&nbsp;<span class="ident" id="4301590">io</span><span class="op" id="4301592">.</span><span class="ident" id="4301593">ReadFull</span><span class="op" id="4301601">(</span><span class="ident" id="4301602">f</span><span class="op" id="4301603">.</span><span class="ident" id="4301604">r</span><span class="op" id="4301605">,</span>&nbsp;<span class="ident" id="4301607">f</span><span class="op" id="4301608">.</span><span class="ident" id="4301609">hist</span><span class="op" id="4301613">[</span><span class="ident" id="4301614">f</span><span class="op" id="4301615">.</span><span class="ident" id="4301616">hp</span><span class="op" id="4301618">:</span><span class="ident" id="4301619">f</span><span class="op" id="4301620">.</span><span class="ident" id="4301621">hp</span><span class="op" id="4301623">+</span><span class="ident" id="4301624">m</span><span class="op" id="4301625">]</span><span class="op" id="4301626">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301630">f</span><span class="op" id="4301631">.</span><span class="ident" id="4301632">roffset</span>&nbsp;<span class="op" id="4301640">+=</span>&nbsp;<span class="ident" id="4301643">int64</span><span class="op" id="4301648">(</span><span class="ident" id="4301649">m</span><span class="op" id="4301650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301654">if</span>&nbsp;<span class="ident" id="4301657">err</span>&nbsp;<span class="op" id="4301661">!=</span>&nbsp;<span class="ident" id="4301664">nil</span>&nbsp;<span class="op" id="4301668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301673">f</span><span class="op" id="4301674">.</span><span class="ident" id="4301675">err</span>&nbsp;<span class="op" id="4301679">=</span>&nbsp;<span class="op" id="4301681">&amp;</span><span class="ident" id="4301682">ReadError</span><span class="op" id="4301691">{</span><span class="ident" id="4301692">f</span><span class="op" id="4301693">.</span><span class="ident" id="4301694">roffset</span><span class="op" id="4301701">,</span>&nbsp;<span class="ident" id="4301703">err</span><span class="op" id="4301706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301711">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301720">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301724">n</span>&nbsp;<span class="op" id="4301726">-=</span>&nbsp;<span class="ident" id="4301729">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301733">f</span><span class="op" id="4301734">.</span><span class="ident" id="4301735">hp</span>&nbsp;<span class="op" id="4301738">+=</span>&nbsp;<span class="ident" id="4301741">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301745">if</span>&nbsp;<span class="ident" id="4301748">f</span><span class="op" id="4301749">.</span><span class="ident" id="4301750">hp</span>&nbsp;<span class="op" id="4301753">==</span>&nbsp;<span class="builtinfunc" id="4301756">len</span><span class="op" id="4301759">(</span><span class="ident" id="4301760">f</span><span class="op" id="4301761">.</span><span class="ident" id="4301762">hist</span><span class="op" id="4301766">)</span>&nbsp;<span class="op" id="4301768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301773">f</span><span class="op" id="4301774">.</span><span class="ident" id="4301775">copyLen</span>&nbsp;<span class="op" id="4301783">=</span>&nbsp;<span class="ident" id="4301785">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301790">f</span><span class="op" id="4301791">.</span><span class="ident" id="4301792">flush</span><span class="op" id="4301797">(</span><span class="op" id="4301798">(</span><span class="op" id="4301799">*</span><span class="ident" id="4301800">decompressor</span><span class="op" id="4301812">)</span><span class="op" id="4301813">.</span><span class="ident" id="4301814">copyData</span><span class="op" id="4301822">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301827">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301842">f</span><span class="op" id="4301843">.</span><span class="ident" id="4301844">step</span>&nbsp;<span class="op" id="4301849">=</span>&nbsp;<span class="op" id="4301851">(</span><span class="op" id="4301852">*</span><span class="ident" id="4301853">decompressor</span><span class="op" id="4301865">)</span><span class="op" id="4301866">.</span><span class="ident" id="4301867">nextBlock</span><br>
<span class="lineno"></span><span class="op" id="4301877">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4301880">func</span>&nbsp;<span class="op" id="4301885">(</span><span class="ident" id="4301886">f</span>&nbsp;<span class="op" id="4301888">*</span><span class="ident" id="4301889">decompressor</span><span class="op" id="4301901">)</span>&nbsp;<span class="ident" id="4301903">setDict</span><span class="op" id="4301910">(</span><span class="ident" id="4301911">dict</span>&nbsp;<span class="op" id="4301916">[</span><span class="op" id="4301917">]</span><span class="builtintype" id="4301918">byte</span><span class="op" id="4301922">)</span>&nbsp;<span class="op" id="4301924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301927">if</span>&nbsp;<span class="builtinfunc" id="4301930">len</span><span class="op" id="4301933">(</span><span class="ident" id="4301934">dict</span><span class="op" id="4301938">)</span>&nbsp;<span class="op" id="4301940">&gt;</span>&nbsp;<span class="builtinfunc" id="4301942">len</span><span class="op" id="4301945">(</span><span class="ident" id="4301946">f</span><span class="op" id="4301947">.</span><span class="ident" id="4301948">hist</span><span class="op" id="4301952">)</span>&nbsp;<span class="op" id="4301954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4301958">//&nbsp;Will&nbsp;only&nbsp;remember&nbsp;the&nbsp;tail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301992">dict</span>&nbsp;<span class="op" id="4301997">=</span>&nbsp;<span class="ident" id="4301999">dict</span><span class="op" id="4302003">[</span><span class="builtinfunc" id="4302004">len</span><span class="op" id="4302007">(</span><span class="ident" id="4302008">dict</span><span class="op" id="4302012">)</span><span class="op" id="4302013">-</span><span class="builtinfunc" id="4302014">len</span><span class="op" id="4302017">(</span><span class="ident" id="4302018">f</span><span class="op" id="4302019">.</span><span class="ident" id="4302020">hist</span><span class="op" id="4302024">)</span><span class="op" id="4302025">:</span><span class="op" id="4302026">]</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302033">f</span><span class="op" id="4302034">.</span><span class="ident" id="4302035">hp</span>&nbsp;<span class="op" id="4302038">=</span>&nbsp;<span class="builtinfunc" id="4302040">copy</span><span class="op" id="4302044">(</span><span class="ident" id="4302045">f</span><span class="op" id="4302046">.</span><span class="ident" id="4302047">hist</span><span class="op" id="4302051">[</span><span class="op" id="4302052">:</span><span class="op" id="4302053">]</span><span class="op" id="4302054">,</span>&nbsp;<span class="ident" id="4302056">dict</span><span class="op" id="4302060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302063">if</span>&nbsp;<span class="ident" id="4302066">f</span><span class="op" id="4302067">.</span><span class="ident" id="4302068">hp</span>&nbsp;<span class="op" id="4302071">==</span>&nbsp;<span class="builtinfunc" id="4302074">len</span><span class="op" id="4302077">(</span><span class="ident" id="4302078">f</span><span class="op" id="4302079">.</span><span class="ident" id="4302080">hist</span><span class="op" id="4302084">)</span>&nbsp;<span class="op" id="4302086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302090">f</span><span class="op" id="4302091">.</span><span class="ident" id="4302092">hp</span>&nbsp;<span class="op" id="4302095">=</span>&nbsp;<span class="num" id="4302097">0</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302101">f</span><span class="op" id="4302102">.</span><span class="ident" id="4302103">hfull</span>&nbsp;<span class="op" id="4302109">=</span>&nbsp;<span class="builtintype" id="4302111">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302120">f</span><span class="op" id="4302121">.</span><span class="ident" id="4302122">hw</span>&nbsp;<span class="op" id="4302125">=</span>&nbsp;<span class="ident" id="4302127">f</span><span class="op" id="4302128">.</span><span class="ident" id="4302129">hp</span><br>
<span class="lineno"></span><span class="op" id="4302132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="4302135">func</span>&nbsp;<span class="op" id="4302140">(</span><span class="ident" id="4302141">f</span>&nbsp;<span class="op" id="4302143">*</span><span class="ident" id="4302144">decompressor</span><span class="op" id="4302156">)</span>&nbsp;<span class="ident" id="4302158">moreBits</span><span class="op" id="4302166">(</span><span class="op" id="4302167">)</span>&nbsp;<span class="builtintype" id="4302169">error</span>&nbsp;<span class="op" id="4302175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302178">c</span><span class="op" id="4302179">,</span>&nbsp;<span class="ident" id="4302181">err</span>&nbsp;<span class="op" id="4302185">:=</span>&nbsp;<span class="ident" id="4302188">f</span><span class="op" id="4302189">.</span><span class="ident" id="4302190">r</span><span class="op" id="4302191">.</span><span class="ident" id="4302192">ReadByte</span><span class="op" id="4302200">(</span><span class="op" id="4302201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302204">if</span>&nbsp;<span class="ident" id="4302207">err</span>&nbsp;<span class="op" id="4302211">!=</span>&nbsp;<span class="ident" id="4302214">nil</span>&nbsp;<span class="op" id="4302218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302222">if</span>&nbsp;<span class="ident" id="4302225">err</span>&nbsp;<span class="op" id="4302229">==</span>&nbsp;<span class="ident" id="4302232">io</span><span class="op" id="4302234">.</span><span class="ident" id="4302235">EOF</span>&nbsp;<span class="op" id="4302239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302244">err</span>&nbsp;<span class="op" id="4302248">=</span>&nbsp;<span class="ident" id="4302250">io</span><span class="op" id="4302252">.</span><span class="ident" id="4302253">ErrUnexpectedEOF</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302276">return</span>&nbsp;<span class="ident" id="4302283">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302291">f</span><span class="op" id="4302292">.</span><span class="ident" id="4302293">roffset</span><span class="op" id="4302300">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302304">f</span><span class="op" id="4302305">.</span><span class="ident" id="4302306">b</span>&nbsp;<span class="op" id="4302308">|=</span>&nbsp;<span class="builtintype" id="4302311">uint32</span><span class="op" id="4302317">(</span><span class="ident" id="4302318">c</span><span class="op" id="4302319">)</span>&nbsp;<span class="op" id="4302321">&lt;&lt;</span>&nbsp;<span class="ident" id="4302324">f</span><span class="op" id="4302325">.</span><span class="ident" id="4302326">nb</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302330">f</span><span class="op" id="4302331">.</span><span class="ident" id="4302332">nb</span>&nbsp;<span class="op" id="4302335">+=</span>&nbsp;<span class="num" id="4302338">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302341">return</span>&nbsp;<span class="ident" id="4302348">nil</span><br>
<span class="lineno"></span><span class="op" id="4302352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4302355">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Huffman-encoded&nbsp;symbol&nbsp;from&nbsp;f&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno">645</span><span class="keyword" id="4302418">func</span>&nbsp;<span class="op" id="4302423">(</span><span class="ident" id="4302424">f</span>&nbsp;<span class="op" id="4302426">*</span><span class="ident" id="4302427">decompressor</span><span class="op" id="4302439">)</span>&nbsp;<span class="ident" id="4302441">huffSym</span><span class="op" id="4302448">(</span><span class="ident" id="4302449">h</span>&nbsp;<span class="op" id="4302451">*</span><span class="ident" id="4302452">huffmanDecoder</span><span class="op" id="4302466">)</span>&nbsp;<span class="op" id="4302468">(</span><span class="builtintype" id="4302469">int</span><span class="op" id="4302472">,</span>&nbsp;<span class="builtintype" id="4302474">error</span><span class="op" id="4302479">)</span>&nbsp;<span class="op" id="4302481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302484">n</span>&nbsp;<span class="op" id="4302486">:=</span>&nbsp;<span class="builtintype" id="4302489">uint</span><span class="op" id="4302493">(</span><span class="ident" id="4302494">h</span><span class="op" id="4302495">.</span><span class="ident" id="4302496">min</span><span class="op" id="4302499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302502">for</span>&nbsp;<span class="op" id="4302506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302510">for</span>&nbsp;<span class="ident" id="4302514">f</span><span class="op" id="4302515">.</span><span class="ident" id="4302516">nb</span>&nbsp;<span class="op" id="4302519">&lt;</span>&nbsp;<span class="ident" id="4302521">n</span>&nbsp;<span class="op" id="4302523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302528">if</span>&nbsp;<span class="ident" id="4302531">err</span>&nbsp;<span class="op" id="4302535">:=</span>&nbsp;<span class="ident" id="4302538">f</span><span class="op" id="4302539">.</span><span class="ident" id="4302540">moreBits</span><span class="op" id="4302548">(</span><span class="op" id="4302549">)</span><span class="op" id="4302550">;</span>&nbsp;<span class="ident" id="4302552">err</span>&nbsp;<span class="op" id="4302556">!=</span>&nbsp;<span class="ident" id="4302559">nil</span>&nbsp;<span class="op" id="4302563">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302569">return</span>&nbsp;<span class="num" id="4302576">0</span><span class="op" id="4302577">,</span>&nbsp;<span class="ident" id="4302579">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302594">chunk</span>&nbsp;<span class="op" id="4302600">:=</span>&nbsp;<span class="ident" id="4302603">h</span><span class="op" id="4302604">.</span><span class="ident" id="4302605">chunks</span><span class="op" id="4302611">[</span><span class="ident" id="4302612">f</span><span class="op" id="4302613">.</span><span class="ident" id="4302614">b</span><span class="op" id="4302615">&amp;</span><span class="op" id="4302616">(</span><span class="ident" id="4302617">huffmanNumChunks</span><span class="op" id="4302633">-</span><span class="num" id="4302634">1</span><span class="op" id="4302635">)</span><span class="op" id="4302636">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302640">n</span>&nbsp;<span class="op" id="4302642">=</span>&nbsp;<span class="builtintype" id="4302644">uint</span><span class="op" id="4302648">(</span><span class="ident" id="4302649">chunk</span>&nbsp;<span class="op" id="4302655">&amp;</span>&nbsp;<span class="ident" id="4302657">huffmanCountMask</span><span class="op" id="4302673">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302677">if</span>&nbsp;<span class="ident" id="4302680">n</span>&nbsp;<span class="op" id="4302682">&gt;</span>&nbsp;<span class="ident" id="4302684">huffmanChunkBits</span>&nbsp;<span class="op" id="4302701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302706">chunk</span>&nbsp;<span class="op" id="4302712">=</span>&nbsp;<span class="ident" id="4302714">h</span><span class="op" id="4302715">.</span><span class="ident" id="4302716">links</span><span class="op" id="4302721">[</span><span class="ident" id="4302722">chunk</span><span class="op" id="4302727">&gt;&gt;</span><span class="ident" id="4302729">huffmanValueShift</span><span class="op" id="4302746">]</span><span class="op" id="4302747">[</span><span class="op" id="4302748">(</span><span class="ident" id="4302749">f</span><span class="op" id="4302750">.</span><span class="ident" id="4302751">b</span><span class="op" id="4302752">&gt;&gt;</span><span class="ident" id="4302754">huffmanChunkBits</span><span class="op" id="4302770">)</span><span class="op" id="4302771">&amp;</span><span class="ident" id="4302772">h</span><span class="op" id="4302773">.</span><span class="ident" id="4302774">linkMask</span><span class="op" id="4302782">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302787">n</span>&nbsp;<span class="op" id="4302789">=</span>&nbsp;<span class="builtintype" id="4302791">uint</span><span class="op" id="4302795">(</span><span class="ident" id="4302796">chunk</span>&nbsp;<span class="op" id="4302802">&amp;</span>&nbsp;<span class="ident" id="4302804">huffmanCountMask</span><span class="op" id="4302820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302825">if</span>&nbsp;<span class="ident" id="4302828">n</span>&nbsp;<span class="op" id="4302830">==</span>&nbsp;<span class="num" id="4302833">0</span>&nbsp;<span class="op" id="4302835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302841">f</span><span class="op" id="4302842">.</span><span class="ident" id="4302843">err</span>&nbsp;<span class="op" id="4302847">=</span>&nbsp;<span class="ident" id="4302849">CorruptInputError</span><span class="op" id="4302866">(</span><span class="ident" id="4302867">f</span><span class="op" id="4302868">.</span><span class="ident" id="4302869">roffset</span><span class="op" id="4302876">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302882">return</span>&nbsp;<span class="num" id="4302889">0</span><span class="op" id="4302890">,</span>&nbsp;<span class="ident" id="4302892">f</span><span class="op" id="4302893">.</span><span class="ident" id="4302894">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302909">if</span>&nbsp;<span class="ident" id="4302912">n</span>&nbsp;<span class="op" id="4302914">&lt;=</span>&nbsp;<span class="ident" id="4302917">f</span><span class="op" id="4302918">.</span><span class="ident" id="4302919">nb</span>&nbsp;<span class="op" id="4302922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302927">f</span><span class="op" id="4302928">.</span><span class="ident" id="4302929">b</span>&nbsp;<span class="op" id="4302931">&gt;&gt;=</span>&nbsp;<span class="ident" id="4302935">n</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302940">f</span><span class="op" id="4302941">.</span><span class="ident" id="4302942">nb</span>&nbsp;<span class="op" id="4302945">-=</span>&nbsp;<span class="ident" id="4302948">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302953">return</span>&nbsp;<span class="builtintype" id="4302960">int</span><span class="op" id="4302963">(</span><span class="ident" id="4302964">chunk</span>&nbsp;<span class="op" id="4302970">&gt;&gt;</span>&nbsp;<span class="ident" id="4302973">huffmanValueShift</span><span class="op" id="4302990">)</span><span class="op" id="4302991">,</span>&nbsp;<span class="ident" id="4302993">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303002">}</span><br>
<span class="lineno"></span><span class="op" id="4303004">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4303007">//&nbsp;Flush&nbsp;any&nbsp;buffered&nbsp;output&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4303062">func</span>&nbsp;<span class="op" id="4303067">(</span><span class="ident" id="4303068">f</span>&nbsp;<span class="op" id="4303070">*</span><span class="ident" id="4303071">decompressor</span><span class="op" id="4303083">)</span>&nbsp;<span class="ident" id="4303085">flush</span><span class="op" id="4303090">(</span><span class="ident" id="4303091">step</span>&nbsp;<span class="keyword" id="4303096">func</span><span class="op" id="4303100">(</span><span class="op" id="4303101">*</span><span class="ident" id="4303102">decompressor</span><span class="op" id="4303114">)</span><span class="op" id="4303115">)</span>&nbsp;<span class="op" id="4303117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303120">f</span><span class="op" id="4303121">.</span><span class="ident" id="4303122">toRead</span>&nbsp;<span class="op" id="4303129">=</span>&nbsp;<span class="ident" id="4303131">f</span><span class="op" id="4303132">.</span><span class="ident" id="4303133">hist</span><span class="op" id="4303137">[</span><span class="ident" id="4303138">f</span><span class="op" id="4303139">.</span><span class="ident" id="4303140">hw</span><span class="op" id="4303142">:</span><span class="ident" id="4303143">f</span><span class="op" id="4303144">.</span><span class="ident" id="4303145">hp</span><span class="op" id="4303147">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303150">f</span><span class="op" id="4303151">.</span><span class="ident" id="4303152">woffset</span>&nbsp;<span class="op" id="4303160">+=</span>&nbsp;<span class="ident" id="4303163">int64</span><span class="op" id="4303168">(</span><span class="ident" id="4303169">f</span><span class="op" id="4303170">.</span><span class="ident" id="4303171">hp</span>&nbsp;<span class="op" id="4303174">-</span>&nbsp;<span class="ident" id="4303176">f</span><span class="op" id="4303177">.</span><span class="ident" id="4303178">hw</span><span class="op" id="4303180">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303183">f</span><span class="op" id="4303184">.</span><span class="ident" id="4303185">hw</span>&nbsp;<span class="op" id="4303188">=</span>&nbsp;<span class="ident" id="4303190">f</span><span class="op" id="4303191">.</span><span class="ident" id="4303192">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303196">if</span>&nbsp;<span class="ident" id="4303199">f</span><span class="op" id="4303200">.</span><span class="ident" id="4303201">hp</span>&nbsp;<span class="op" id="4303204">==</span>&nbsp;<span class="builtinfunc" id="4303207">len</span><span class="op" id="4303210">(</span><span class="ident" id="4303211">f</span><span class="op" id="4303212">.</span><span class="ident" id="4303213">hist</span><span class="op" id="4303217">)</span>&nbsp;<span class="op" id="4303219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303223">f</span><span class="op" id="4303224">.</span><span class="ident" id="4303225">hp</span>&nbsp;<span class="op" id="4303228">=</span>&nbsp;<span class="num" id="4303230">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303234">f</span><span class="op" id="4303235">.</span><span class="ident" id="4303236">hw</span>&nbsp;<span class="op" id="4303239">=</span>&nbsp;<span class="num" id="4303241">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303245">f</span><span class="op" id="4303246">.</span><span class="ident" id="4303247">hfull</span>&nbsp;<span class="op" id="4303253">=</span>&nbsp;<span class="builtintype" id="4303255">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303264">f</span><span class="op" id="4303265">.</span><span class="ident" id="4303266">step</span>&nbsp;<span class="op" id="4303271">=</span>&nbsp;<span class="ident" id="4303273">step</span><br>
<span class="lineno"></span><span class="op" id="4303278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4303281">func</span>&nbsp;<span class="ident" id="4303286">makeReader</span><span class="op" id="4303296">(</span><span class="ident" id="4303297">r</span>&nbsp;<span class="ident" id="4303299">io</span><span class="op" id="4303301">.</span><span class="ident" id="4303302">Reader</span><span class="op" id="4303308">)</span>&nbsp;<span class="ident" id="4303310">Reader</span>&nbsp;<span class="op" id="4303317">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303320">if</span>&nbsp;<span class="ident" id="4303323">rr</span><span class="op" id="4303325">,</span>&nbsp;<span class="ident" id="4303327">ok</span>&nbsp;<span class="op" id="4303330">:=</span>&nbsp;<span class="ident" id="4303333">r</span><span class="op" id="4303334">.</span><span class="op" id="4303335">(</span><span class="ident" id="4303336">Reader</span><span class="op" id="4303342">)</span><span class="op" id="4303343">;</span>&nbsp;<span class="ident" id="4303345">ok</span>&nbsp;<span class="op" id="4303348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303352">return</span>&nbsp;<span class="ident" id="4303359">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303366">return</span>&nbsp;<span class="ident" id="4303373">bufio</span><span class="op" id="4303378">.</span><span class="ident" id="4303379">NewReader</span><span class="op" id="4303388">(</span><span class="ident" id="4303389">r</span><span class="op" id="4303390">)</span><br>
<span class="lineno"></span><span class="op" id="4303392">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4303395">func</span>&nbsp;<span class="op" id="4303400">(</span><span class="ident" id="4303401">f</span>&nbsp;<span class="op" id="4303403">*</span><span class="ident" id="4303404">decompressor</span><span class="op" id="4303416">)</span>&nbsp;<span class="ident" id="4303418">Reset</span><span class="op" id="4303423">(</span><span class="ident" id="4303424">r</span>&nbsp;<span class="ident" id="4303426">io</span><span class="op" id="4303428">.</span><span class="ident" id="4303429">Reader</span><span class="op" id="4303435">,</span>&nbsp;<span class="ident" id="4303437">dict</span>&nbsp;<span class="op" id="4303442">[</span><span class="op" id="4303443">]</span><span class="builtintype" id="4303444">byte</span><span class="op" id="4303448">)</span>&nbsp;<span class="builtintype" id="4303450">error</span>&nbsp;<span class="op" id="4303456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303459">*</span><span class="ident" id="4303460">f</span>&nbsp;<span class="op" id="4303462">=</span>&nbsp;<span class="ident" id="4303464">decompressor</span><span class="op" id="4303476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303480">r</span><span class="op" id="4303481">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303490">makeReader</span><span class="op" id="4303500">(</span><span class="ident" id="4303501">r</span><span class="op" id="4303502">)</span><span class="op" id="4303503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303507">bits</span><span class="op" id="4303511">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303517">f</span><span class="op" id="4303518">.</span><span class="ident" id="4303519">bits</span><span class="op" id="4303523">,</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303527">codebits</span><span class="op" id="4303535">:</span>&nbsp;<span class="ident" id="4303537">f</span><span class="op" id="4303538">.</span><span class="ident" id="4303539">codebits</span><span class="op" id="4303547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303551">hist</span><span class="op" id="4303555">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303561">f</span><span class="op" id="4303562">.</span><span class="ident" id="4303563">hist</span><span class="op" id="4303567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303571">step</span><span class="op" id="4303575">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4303581">(</span><span class="op" id="4303582">*</span><span class="ident" id="4303583">decompressor</span><span class="op" id="4303595">)</span><span class="op" id="4303596">.</span><span class="ident" id="4303597">nextBlock</span><span class="op" id="4303606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303612">if</span>&nbsp;<span class="ident" id="4303615">dict</span>&nbsp;<span class="op" id="4303620">!=</span>&nbsp;<span class="ident" id="4303623">nil</span>&nbsp;<span class="op" id="4303627">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303631">f</span><span class="op" id="4303632">.</span><span class="ident" id="4303633">setDict</span><span class="op" id="4303640">(</span><span class="ident" id="4303641">dict</span><span class="op" id="4303645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303651">return</span>&nbsp;<span class="ident" id="4303658">nil</span><br>
<span class="lineno"></span><span class="op" id="4303662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4303665">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;ReadCloser&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4303720">//&nbsp;to&nbsp;read&nbsp;the&nbsp;uncompressed&nbsp;version&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4303762">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4303809">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4303871">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser</span><br>
<span class="lineno">710</span><span class="comment" id="4303940">//&nbsp;when&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="4303966">//</span><br>
<span class="lineno"></span><span class="comment" id="4303969">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno"></span><span class="keyword" id="4304035">func</span>&nbsp;<span class="ident" id="4304040">NewReader</span><span class="op" id="4304049">(</span><span class="ident" id="4304050">r</span>&nbsp;<span class="ident" id="4304052">io</span><span class="op" id="4304054">.</span><span class="ident" id="4304055">Reader</span><span class="op" id="4304061">)</span>&nbsp;<span class="ident" id="4304063">io</span><span class="op" id="4304065">.</span><span class="ident" id="4304066">ReadCloser</span>&nbsp;<span class="op" id="4304077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304080">var</span>&nbsp;<span class="ident" id="4304084">f</span>&nbsp;<span class="ident" id="4304086">decompressor</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304100">f</span><span class="op" id="4304101">.</span><span class="ident" id="4304102">bits</span>&nbsp;<span class="op" id="4304107">=</span>&nbsp;<span class="builtinfunc" id="4304109">new</span><span class="op" id="4304112">(</span><span class="op" id="4304113">[</span><span class="ident" id="4304114">maxLit</span>&nbsp;<span class="op" id="4304121">+</span>&nbsp;<span class="ident" id="4304123">maxDist</span><span class="op" id="4304130">]</span><span class="builtintype" id="4304131">int</span><span class="op" id="4304134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304137">f</span><span class="op" id="4304138">.</span><span class="ident" id="4304139">codebits</span>&nbsp;<span class="op" id="4304148">=</span>&nbsp;<span class="builtinfunc" id="4304150">new</span><span class="op" id="4304153">(</span><span class="op" id="4304154">[</span><span class="ident" id="4304155">numCodes</span><span class="op" id="4304163">]</span><span class="builtintype" id="4304164">int</span><span class="op" id="4304167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304170">f</span><span class="op" id="4304171">.</span><span class="ident" id="4304172">r</span>&nbsp;<span class="op" id="4304174">=</span>&nbsp;<span class="ident" id="4304176">makeReader</span><span class="op" id="4304186">(</span><span class="ident" id="4304187">r</span><span class="op" id="4304188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304191">f</span><span class="op" id="4304192">.</span><span class="ident" id="4304193">hist</span>&nbsp;<span class="op" id="4304198">=</span>&nbsp;<span class="builtinfunc" id="4304200">new</span><span class="op" id="4304203">(</span><span class="op" id="4304204">[</span><span class="ident" id="4304205">maxHist</span><span class="op" id="4304212">]</span><span class="builtintype" id="4304213">byte</span><span class="op" id="4304217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304220">f</span><span class="op" id="4304221">.</span><span class="ident" id="4304222">step</span>&nbsp;<span class="op" id="4304227">=</span>&nbsp;<span class="op" id="4304229">(</span><span class="op" id="4304230">*</span><span class="ident" id="4304231">decompressor</span><span class="op" id="4304243">)</span><span class="op" id="4304244">.</span><span class="ident" id="4304245">nextBlock</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304256">return</span>&nbsp;<span class="op" id="4304263">&amp;</span><span class="ident" id="4304264">f</span><br>
<span class="lineno"></span><span class="op" id="4304266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4304269">//&nbsp;NewReaderDict&nbsp;is&nbsp;like&nbsp;NewReader&nbsp;but&nbsp;initializes&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="4304331">//&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;behaves&nbsp;as&nbsp;if</span><br>
<span class="lineno">725</span><span class="comment" id="4304395">//&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;stream&nbsp;started&nbsp;with&nbsp;the&nbsp;given&nbsp;dictionary,</span><br>
<span class="lineno"></span><span class="comment" id="4304462">//&nbsp;which&nbsp;has&nbsp;already&nbsp;been&nbsp;read.&nbsp;&nbsp;NewReaderDict&nbsp;is&nbsp;typically&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4304527">//&nbsp;to&nbsp;read&nbsp;data&nbsp;compressed&nbsp;by&nbsp;NewWriterDict.</span><br>
<span class="lineno"></span><span class="comment" id="4304572">//</span><br>
<span class="lineno"></span><span class="comment" id="4304575">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno">730</span><span class="keyword" id="4304641">func</span>&nbsp;<span class="ident" id="4304646">NewReaderDict</span><span class="op" id="4304659">(</span><span class="ident" id="4304660">r</span>&nbsp;<span class="ident" id="4304662">io</span><span class="op" id="4304664">.</span><span class="ident" id="4304665">Reader</span><span class="op" id="4304671">,</span>&nbsp;<span class="ident" id="4304673">dict</span>&nbsp;<span class="op" id="4304678">[</span><span class="op" id="4304679">]</span><span class="builtintype" id="4304680">byte</span><span class="op" id="4304684">)</span>&nbsp;<span class="ident" id="4304686">io</span><span class="op" id="4304688">.</span><span class="ident" id="4304689">ReadCloser</span>&nbsp;<span class="op" id="4304700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304703">var</span>&nbsp;<span class="ident" id="4304707">f</span>&nbsp;<span class="ident" id="4304709">decompressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304723">f</span><span class="op" id="4304724">.</span><span class="ident" id="4304725">r</span>&nbsp;<span class="op" id="4304727">=</span>&nbsp;<span class="ident" id="4304729">makeReader</span><span class="op" id="4304739">(</span><span class="ident" id="4304740">r</span><span class="op" id="4304741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304744">f</span><span class="op" id="4304745">.</span><span class="ident" id="4304746">hist</span>&nbsp;<span class="op" id="4304751">=</span>&nbsp;<span class="builtinfunc" id="4304753">new</span><span class="op" id="4304756">(</span><span class="op" id="4304757">[</span><span class="ident" id="4304758">maxHist</span><span class="op" id="4304765">]</span><span class="builtintype" id="4304766">byte</span><span class="op" id="4304770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304773">f</span><span class="op" id="4304774">.</span><span class="ident" id="4304775">bits</span>&nbsp;<span class="op" id="4304780">=</span>&nbsp;<span class="builtinfunc" id="4304782">new</span><span class="op" id="4304785">(</span><span class="op" id="4304786">[</span><span class="ident" id="4304787">maxLit</span>&nbsp;<span class="op" id="4304794">+</span>&nbsp;<span class="ident" id="4304796">maxDist</span><span class="op" id="4304803">]</span><span class="builtintype" id="4304804">int</span><span class="op" id="4304807">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304810">f</span><span class="op" id="4304811">.</span><span class="ident" id="4304812">codebits</span>&nbsp;<span class="op" id="4304821">=</span>&nbsp;<span class="builtinfunc" id="4304823">new</span><span class="op" id="4304826">(</span><span class="op" id="4304827">[</span><span class="ident" id="4304828">numCodes</span><span class="op" id="4304836">]</span><span class="builtintype" id="4304837">int</span><span class="op" id="4304840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304843">f</span><span class="op" id="4304844">.</span><span class="ident" id="4304845">step</span>&nbsp;<span class="op" id="4304850">=</span>&nbsp;<span class="op" id="4304852">(</span><span class="op" id="4304853">*</span><span class="ident" id="4304854">decompressor</span><span class="op" id="4304866">)</span><span class="op" id="4304867">.</span><span class="ident" id="4304868">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304879">f</span><span class="op" id="4304880">.</span><span class="ident" id="4304881">setDict</span><span class="op" id="4304888">(</span><span class="ident" id="4304889">dict</span><span class="op" id="4304893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304896">return</span>&nbsp;<span class="op" id="4304903">&amp;</span><span class="ident" id="4304904">f</span><br>
<span class="lineno"></span><span class="op" id="4304906">}</span>
</div>
</body>
</html>
