<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5113043">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5113098">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5113152">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5113203">//&nbsp;Package&nbsp;gzip&nbsp;implements&nbsp;reading&nbsp;and&nbsp;writing&nbsp;of&nbsp;gzip&nbsp;format&nbsp;compressed&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="5113283">//&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;1952.</span><br>
<span class="lineno"></span><span class="keyword" id="5113312">package</span>&nbsp;<span class="ident" id="5113320">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5113326">import</span>&nbsp;<span class="op" id="5113333">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5113336">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5113345">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5113363">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5113373">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5113381">&#34;hash/crc32&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5113395">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5113401">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5113408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5113411">const</span>&nbsp;<span class="op" id="5113417">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113420">gzipID1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5113432">=</span>&nbsp;<span class="num" id="5113434">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113440">gzipID2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5113452">=</span>&nbsp;<span class="num" id="5113454">0x8b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113460">gzipDeflate</span>&nbsp;<span class="op" id="5113472">=</span>&nbsp;<span class="num" id="5113474">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113477">flagText</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5113489">=</span>&nbsp;<span class="num" id="5113491">1</span>&nbsp;<span class="op" id="5113493">&lt;&lt;</span>&nbsp;<span class="num" id="5113496">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113499">flagHdrCrc</span>&nbsp;&nbsp;<span class="op" id="5113511">=</span>&nbsp;<span class="num" id="5113513">1</span>&nbsp;<span class="op" id="5113515">&lt;&lt;</span>&nbsp;<span class="num" id="5113518">1</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113521">flagExtra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5113533">=</span>&nbsp;<span class="num" id="5113535">1</span>&nbsp;<span class="op" id="5113537">&lt;&lt;</span>&nbsp;<span class="num" id="5113540">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113543">flagName</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5113555">=</span>&nbsp;<span class="num" id="5113557">1</span>&nbsp;<span class="op" id="5113559">&lt;&lt;</span>&nbsp;<span class="num" id="5113562">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113565">flagComment</span>&nbsp;<span class="op" id="5113577">=</span>&nbsp;<span class="num" id="5113579">1</span>&nbsp;<span class="op" id="5113581">&lt;&lt;</span>&nbsp;<span class="num" id="5113584">4</span><br>
<span class="lineno"></span><span class="op" id="5113586">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="5113589">func</span>&nbsp;<span class="ident" id="5113594">makeReader</span><span class="op" id="5113604">(</span><span class="ident" id="5113605">r</span>&nbsp;<span class="ident" id="5113607">io</span><span class="op" id="5113609">.</span><span class="ident" id="5113610">Reader</span><span class="op" id="5113616">)</span>&nbsp;<span class="ident" id="5113618">flate</span><span class="op" id="5113623">.</span><span class="ident" id="5113624">Reader</span>&nbsp;<span class="op" id="5113631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113634">if</span>&nbsp;<span class="ident" id="5113637">rr</span><span class="op" id="5113639">,</span>&nbsp;<span class="ident" id="5113641">ok</span>&nbsp;<span class="op" id="5113644">:=</span>&nbsp;<span class="ident" id="5113647">r</span><span class="op" id="5113648">.</span><span class="op" id="5113649">(</span><span class="ident" id="5113650">flate</span><span class="op" id="5113655">.</span><span class="ident" id="5113656">Reader</span><span class="op" id="5113662">)</span><span class="op" id="5113663">;</span>&nbsp;<span class="ident" id="5113665">ok</span>&nbsp;<span class="op" id="5113668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113672">return</span>&nbsp;<span class="ident" id="5113679">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5113683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113686">return</span>&nbsp;<span class="ident" id="5113693">bufio</span><span class="op" id="5113698">.</span><span class="ident" id="5113699">NewReader</span><span class="op" id="5113708">(</span><span class="ident" id="5113709">r</span><span class="op" id="5113710">)</span><br>
<span class="lineno">35</span><span class="op" id="5113712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5113715">var</span>&nbsp;<span class="op" id="5113719">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113722">//&nbsp;ErrChecksum&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113803">ErrChecksum</span>&nbsp;<span class="op" id="5113815">=</span>&nbsp;<span class="ident" id="5113817">errors</span><span class="op" id="5113823">.</span><span class="ident" id="5113824">New</span><span class="op" id="5113827">(</span><span class="string" id="5113828">&#34;gzip:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="5113852">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113855">//&nbsp;ErrHeader&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113932">ErrHeader</span>&nbsp;<span class="op" id="5113942">=</span>&nbsp;<span class="ident" id="5113944">errors</span><span class="op" id="5113950">.</span><span class="ident" id="5113951">New</span><span class="op" id="5113954">(</span><span class="string" id="5113955">&#34;gzip:&nbsp;invalid&nbsp;header&#34;</span><span class="op" id="5113977">)</span><br>
<span class="lineno"></span><span class="op" id="5113979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5113982">//&nbsp;The&nbsp;gzip&nbsp;file&nbsp;stores&nbsp;a&nbsp;header&nbsp;giving&nbsp;metadata&nbsp;about&nbsp;the&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno">45</span><span class="comment" id="5114058">//&nbsp;That&nbsp;header&nbsp;is&nbsp;exposed&nbsp;as&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;Writer&nbsp;and&nbsp;Reader&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="5114132">type</span>&nbsp;<span class="ident" id="5114137">Header</span>&nbsp;<span class="keyword" id="5114144">struct</span>&nbsp;<span class="op" id="5114151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5114154">Comment</span>&nbsp;<span class="builtintype" id="5114162">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5114172">//&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5114184">Extra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5114192">[</span><span class="op" id="5114193">]</span><span class="builtintype" id="5114194">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5114202">//&nbsp;&#34;extra&nbsp;data&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5114219">ModTime</span>&nbsp;<span class="ident" id="5114227">time</span><span class="op" id="5114231">.</span><span class="ident" id="5114232">Time</span>&nbsp;<span class="comment" id="5114237">//&nbsp;modification&nbsp;time</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5114259">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5114267">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5114277">//&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5114291">OS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5114299">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5114309">//&nbsp;operating&nbsp;system&nbsp;type</span><br>
<span class="lineno"></span><span class="op" id="5114334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5114337">//&nbsp;A&nbsp;Reader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;to&nbsp;retrieve</span><br>
<span class="lineno">55</span><span class="comment" id="5114394">//&nbsp;uncompressed&nbsp;data&nbsp;from&nbsp;a&nbsp;gzip-format&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5114451">//</span><br>
<span class="lineno"></span><span class="comment" id="5114454">//&nbsp;In&nbsp;general,&nbsp;a&nbsp;gzip&nbsp;file&nbsp;can&nbsp;be&nbsp;a&nbsp;concatenation&nbsp;of&nbsp;gzip&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="5114519">//&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header.&nbsp;&nbsp;Reads&nbsp;from&nbsp;the&nbsp;Reader</span><br>
<span class="lineno"></span><span class="comment" id="5114571">//&nbsp;return&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;of&nbsp;each.</span><br>
<span class="lineno">60</span><span class="comment" id="5114633">//&nbsp;Only&nbsp;the&nbsp;first&nbsp;header&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the&nbsp;Reader&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="5114692">//</span><br>
<span class="lineno"></span><span class="comment" id="5114695">//&nbsp;Gzip&nbsp;files&nbsp;store&nbsp;a&nbsp;length&nbsp;and&nbsp;checksum&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5114763">//&nbsp;The&nbsp;Reader&nbsp;will&nbsp;return&nbsp;a&nbsp;ErrChecksum&nbsp;when&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="5114813">//&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;if&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno">65</span><span class="comment" id="5114872">//&nbsp;have&nbsp;the&nbsp;expected&nbsp;length&nbsp;or&nbsp;checksum.&nbsp;&nbsp;Clients&nbsp;should&nbsp;treat&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5114940">//&nbsp;returned&nbsp;by&nbsp;Read&nbsp;as&nbsp;tentative&nbsp;until&nbsp;they&nbsp;receive&nbsp;the&nbsp;io.EOF</span><br>
<span class="lineno"></span><span class="comment" id="5115003">//&nbsp;marking&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5115035">type</span>&nbsp;<span class="ident" id="5115040">Reader</span>&nbsp;<span class="keyword" id="5115047">struct</span>&nbsp;<span class="op" id="5115054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115057">Header</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115065">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5115078">flate</span><span class="op" id="5115083">.</span><span class="ident" id="5115084">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115092">decompressor</span>&nbsp;<span class="ident" id="5115105">io</span><span class="op" id="5115107">.</span><span class="ident" id="5115108">ReadCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115120">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5115133">hash</span><span class="op" id="5115137">.</span><span class="ident" id="5115138">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115146">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5115159">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115167">flg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5115180">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115186">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5115199">[</span><span class="num" id="5115200">512</span><span class="op" id="5115203">]</span><span class="builtintype" id="5115204">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115210">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5115223">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115230">multistream</span>&nbsp;&nbsp;<span class="builtintype" id="5115243">bool</span><br>
<span class="lineno"></span><span class="op" id="5115248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5115251">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno"></span><span class="comment" id="5115311">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="5115358">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5115420">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;Reader&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="5115496">func</span>&nbsp;<span class="ident" id="5115501">NewReader</span><span class="op" id="5115510">(</span><span class="ident" id="5115511">r</span>&nbsp;<span class="ident" id="5115513">io</span><span class="op" id="5115515">.</span><span class="ident" id="5115516">Reader</span><span class="op" id="5115522">)</span>&nbsp;<span class="op" id="5115524">(</span><span class="op" id="5115525">*</span><span class="ident" id="5115526">Reader</span><span class="op" id="5115532">,</span>&nbsp;<span class="builtintype" id="5115534">error</span><span class="op" id="5115539">)</span>&nbsp;<span class="op" id="5115541">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115544">z</span>&nbsp;<span class="op" id="5115546">:=</span>&nbsp;<span class="builtinfunc" id="5115549">new</span><span class="op" id="5115552">(</span><span class="ident" id="5115553">Reader</span><span class="op" id="5115559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115562">z</span><span class="op" id="5115563">.</span><span class="ident" id="5115564">r</span>&nbsp;<span class="op" id="5115566">=</span>&nbsp;<span class="ident" id="5115568">makeReader</span><span class="op" id="5115578">(</span><span class="ident" id="5115579">r</span><span class="op" id="5115580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115583">z</span><span class="op" id="5115584">.</span><span class="ident" id="5115585">multistream</span>&nbsp;<span class="op" id="5115597">=</span>&nbsp;<span class="builtintype" id="5115599">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115605">z</span><span class="op" id="5115606">.</span><span class="ident" id="5115607">digest</span>&nbsp;<span class="op" id="5115614">=</span>&nbsp;<span class="ident" id="5115616">crc32</span><span class="op" id="5115621">.</span><span class="ident" id="5115622">NewIEEE</span><span class="op" id="5115629">(</span><span class="op" id="5115630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115633">if</span>&nbsp;<span class="ident" id="5115636">err</span>&nbsp;<span class="op" id="5115640">:=</span>&nbsp;<span class="ident" id="5115643">z</span><span class="op" id="5115644">.</span><span class="ident" id="5115645">readHeader</span><span class="op" id="5115655">(</span><span class="builtintype" id="5115656">true</span><span class="op" id="5115660">)</span><span class="op" id="5115661">;</span>&nbsp;<span class="ident" id="5115663">err</span>&nbsp;<span class="op" id="5115667">!=</span>&nbsp;<span class="ident" id="5115670">nil</span>&nbsp;<span class="op" id="5115674">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115678">return</span>&nbsp;<span class="ident" id="5115685">nil</span><span class="op" id="5115688">,</span>&nbsp;<span class="ident" id="5115690">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5115695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115698">return</span>&nbsp;<span class="ident" id="5115705">z</span><span class="op" id="5115706">,</span>&nbsp;<span class="ident" id="5115708">nil</span><br>
<span class="lineno"></span><span class="op" id="5115712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5115715">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Reader&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5115785">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewReader,&nbsp;but&nbsp;reading&nbsp;from&nbsp;r&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5115861">//&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Reader&nbsp;rather&nbsp;than&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="5115928">func</span>&nbsp;<span class="op" id="5115933">(</span><span class="ident" id="5115934">z</span>&nbsp;<span class="op" id="5115936">*</span><span class="ident" id="5115937">Reader</span><span class="op" id="5115943">)</span>&nbsp;<span class="ident" id="5115945">Reset</span><span class="op" id="5115950">(</span><span class="ident" id="5115951">r</span>&nbsp;<span class="ident" id="5115953">io</span><span class="op" id="5115955">.</span><span class="ident" id="5115956">Reader</span><span class="op" id="5115962">)</span>&nbsp;<span class="builtintype" id="5115964">error</span>&nbsp;<span class="op" id="5115970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115973">z</span><span class="op" id="5115974">.</span><span class="ident" id="5115975">r</span>&nbsp;<span class="op" id="5115977">=</span>&nbsp;<span class="ident" id="5115979">makeReader</span><span class="op" id="5115989">(</span><span class="ident" id="5115990">r</span><span class="op" id="5115991">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115994">if</span>&nbsp;<span class="ident" id="5115997">z</span><span class="op" id="5115998">.</span><span class="ident" id="5115999">digest</span>&nbsp;<span class="op" id="5116006">==</span>&nbsp;<span class="ident" id="5116009">nil</span>&nbsp;<span class="op" id="5116013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116017">z</span><span class="op" id="5116018">.</span><span class="ident" id="5116019">digest</span>&nbsp;<span class="op" id="5116026">=</span>&nbsp;<span class="ident" id="5116028">crc32</span><span class="op" id="5116033">.</span><span class="ident" id="5116034">NewIEEE</span><span class="op" id="5116041">(</span><span class="op" id="5116042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5116045">}</span>&nbsp;<span class="keyword" id="5116047">else</span>&nbsp;<span class="op" id="5116052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116056">z</span><span class="op" id="5116057">.</span><span class="ident" id="5116058">digest</span><span class="op" id="5116064">.</span><span class="ident" id="5116065">Reset</span><span class="op" id="5116070">(</span><span class="op" id="5116071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5116074">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116077">z</span><span class="op" id="5116078">.</span><span class="ident" id="5116079">size</span>&nbsp;<span class="op" id="5116084">=</span>&nbsp;<span class="num" id="5116086">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116089">z</span><span class="op" id="5116090">.</span><span class="ident" id="5116091">err</span>&nbsp;<span class="op" id="5116095">=</span>&nbsp;<span class="ident" id="5116097">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116102">z</span><span class="op" id="5116103">.</span><span class="ident" id="5116104">multistream</span>&nbsp;<span class="op" id="5116116">=</span>&nbsp;<span class="builtintype" id="5116118">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116124">return</span>&nbsp;<span class="ident" id="5116131">z</span><span class="op" id="5116132">.</span><span class="ident" id="5116133">readHeader</span><span class="op" id="5116143">(</span><span class="builtintype" id="5116144">true</span><span class="op" id="5116148">)</span><br>
<span class="lineno"></span><span class="op" id="5116150">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="5116153">//&nbsp;Multistream&nbsp;controls&nbsp;whether&nbsp;the&nbsp;reader&nbsp;supports&nbsp;multistream&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5116224">//</span><br>
<span class="lineno"></span><span class="comment" id="5116227">//&nbsp;If&nbsp;enabled&nbsp;(the&nbsp;default),&nbsp;the&nbsp;Reader&nbsp;expects&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="5116302">//&nbsp;of&nbsp;individually&nbsp;gzipped&nbsp;data&nbsp;streams,&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="5116372">//&nbsp;trailer,&nbsp;ending&nbsp;at&nbsp;EOF.&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="5116450">//&nbsp;of&nbsp;gzipped&nbsp;files&nbsp;is&nbsp;treated&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;gzip&nbsp;of&nbsp;the&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="5116528">//&nbsp;of&nbsp;the&nbsp;sequence.&nbsp;This&nbsp;is&nbsp;standard&nbsp;behavior&nbsp;for&nbsp;gzip&nbsp;readers.</span><br>
<span class="lineno"></span><span class="comment" id="5116592">//</span><br>
<span class="lineno"></span><span class="comment" id="5116595">//&nbsp;Calling&nbsp;Multistream(false)&nbsp;disables&nbsp;this&nbsp;behavior;&nbsp;disabling&nbsp;the&nbsp;behavior</span><br>
<span class="lineno">120</span><span class="comment" id="5116672">//&nbsp;can&nbsp;be&nbsp;useful&nbsp;when&nbsp;reading&nbsp;file&nbsp;formats&nbsp;that&nbsp;distinguish&nbsp;individual&nbsp;gzip</span><br>
<span class="lineno"></span><span class="comment" id="5116748">//&nbsp;data&nbsp;streams&nbsp;or&nbsp;mix&nbsp;gzip&nbsp;data&nbsp;streams&nbsp;with&nbsp;other&nbsp;data&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="5116814">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;when&nbsp;the&nbsp;Reader&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="5116883">//&nbsp;Read&nbsp;returns&nbsp;io.EOF.&nbsp;If&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;implements&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="5116958">//&nbsp;it&nbsp;will&nbsp;be&nbsp;left&nbsp;positioned&nbsp;just&nbsp;after&nbsp;the&nbsp;gzip&nbsp;stream.</span><br>
<span class="lineno">125</span><span class="comment" id="5117016">//&nbsp;To&nbsp;start&nbsp;the&nbsp;next&nbsp;stream,&nbsp;call&nbsp;z.Reset(r)&nbsp;followed&nbsp;by&nbsp;z.Multistream(false).</span><br>
<span class="lineno"></span><span class="comment" id="5117095">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;stream,&nbsp;z.Reset(r)&nbsp;will&nbsp;return&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="5117157">func</span>&nbsp;<span class="op" id="5117162">(</span><span class="ident" id="5117163">z</span>&nbsp;<span class="op" id="5117165">*</span><span class="ident" id="5117166">Reader</span><span class="op" id="5117172">)</span>&nbsp;<span class="ident" id="5117174">Multistream</span><span class="op" id="5117185">(</span><span class="ident" id="5117186">ok</span>&nbsp;<span class="builtintype" id="5117189">bool</span><span class="op" id="5117193">)</span>&nbsp;<span class="op" id="5117195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117198">z</span><span class="op" id="5117199">.</span><span class="ident" id="5117200">multistream</span>&nbsp;<span class="op" id="5117212">=</span>&nbsp;<span class="ident" id="5117214">ok</span><br>
<span class="lineno"></span><span class="op" id="5117217">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="5117220">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="5117281">func</span>&nbsp;<span class="ident" id="5117286">get4</span><span class="op" id="5117290">(</span><span class="ident" id="5117291">p</span>&nbsp;<span class="op" id="5117293">[</span><span class="op" id="5117294">]</span><span class="builtintype" id="5117295">byte</span><span class="op" id="5117299">)</span>&nbsp;<span class="builtintype" id="5117301">uint32</span>&nbsp;<span class="op" id="5117308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117311">return</span>&nbsp;<span class="builtintype" id="5117318">uint32</span><span class="op" id="5117324">(</span><span class="ident" id="5117325">p</span><span class="op" id="5117326">[</span><span class="num" id="5117327">0</span><span class="op" id="5117328">]</span><span class="op" id="5117329">)</span>&nbsp;<span class="op" id="5117331">|</span>&nbsp;<span class="builtintype" id="5117333">uint32</span><span class="op" id="5117339">(</span><span class="ident" id="5117340">p</span><span class="op" id="5117341">[</span><span class="num" id="5117342">1</span><span class="op" id="5117343">]</span><span class="op" id="5117344">)</span><span class="op" id="5117345">&lt;&lt;</span><span class="num" id="5117347">8</span>&nbsp;<span class="op" id="5117349">|</span>&nbsp;<span class="builtintype" id="5117351">uint32</span><span class="op" id="5117357">(</span><span class="ident" id="5117358">p</span><span class="op" id="5117359">[</span><span class="num" id="5117360">2</span><span class="op" id="5117361">]</span><span class="op" id="5117362">)</span><span class="op" id="5117363">&lt;&lt;</span><span class="num" id="5117365">16</span>&nbsp;<span class="op" id="5117368">|</span>&nbsp;<span class="builtintype" id="5117370">uint32</span><span class="op" id="5117376">(</span><span class="ident" id="5117377">p</span><span class="op" id="5117378">[</span><span class="num" id="5117379">3</span><span class="op" id="5117380">]</span><span class="op" id="5117381">)</span><span class="op" id="5117382">&lt;&lt;</span><span class="num" id="5117384">24</span><br>
<span class="lineno"></span><span class="op" id="5117387">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="5117390">func</span>&nbsp;<span class="op" id="5117395">(</span><span class="ident" id="5117396">z</span>&nbsp;<span class="op" id="5117398">*</span><span class="ident" id="5117399">Reader</span><span class="op" id="5117405">)</span>&nbsp;<span class="ident" id="5117407">readString</span><span class="op" id="5117417">(</span><span class="op" id="5117418">)</span>&nbsp;<span class="op" id="5117420">(</span><span class="builtintype" id="5117421">string</span><span class="op" id="5117427">,</span>&nbsp;<span class="builtintype" id="5117429">error</span><span class="op" id="5117434">)</span>&nbsp;<span class="op" id="5117436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117439">var</span>&nbsp;<span class="ident" id="5117443">err</span>&nbsp;<span class="builtintype" id="5117447">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117454">needconv</span>&nbsp;<span class="op" id="5117463">:=</span>&nbsp;<span class="builtintype" id="5117466">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117473">for</span>&nbsp;<span class="ident" id="5117477">i</span>&nbsp;<span class="op" id="5117479">:=</span>&nbsp;<span class="num" id="5117482">0</span><span class="op" id="5117483">;</span>&nbsp;<span class="op" id="5117485">;</span>&nbsp;<span class="ident" id="5117487">i</span><span class="op" id="5117488">++</span>&nbsp;<span class="op" id="5117491">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117495">if</span>&nbsp;<span class="ident" id="5117498">i</span>&nbsp;<span class="op" id="5117500">&gt;=</span>&nbsp;<span class="builtinfunc" id="5117503">len</span><span class="op" id="5117506">(</span><span class="ident" id="5117507">z</span><span class="op" id="5117508">.</span><span class="ident" id="5117509">buf</span><span class="op" id="5117512">)</span>&nbsp;<span class="op" id="5117514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117519">return</span>&nbsp;<span class="string" id="5117526">&#34;&#34;</span><span class="op" id="5117528">,</span>&nbsp;<span class="ident" id="5117530">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117546">z</span><span class="op" id="5117547">.</span><span class="ident" id="5117548">buf</span><span class="op" id="5117551">[</span><span class="ident" id="5117552">i</span><span class="op" id="5117553">]</span><span class="op" id="5117554">,</span>&nbsp;<span class="ident" id="5117556">err</span>&nbsp;<span class="op" id="5117560">=</span>&nbsp;<span class="ident" id="5117562">z</span><span class="op" id="5117563">.</span><span class="ident" id="5117564">r</span><span class="op" id="5117565">.</span><span class="ident" id="5117566">ReadByte</span><span class="op" id="5117574">(</span><span class="op" id="5117575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117579">if</span>&nbsp;<span class="ident" id="5117582">err</span>&nbsp;<span class="op" id="5117586">!=</span>&nbsp;<span class="ident" id="5117589">nil</span>&nbsp;<span class="op" id="5117593">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117598">return</span>&nbsp;<span class="string" id="5117605">&#34;&#34;</span><span class="op" id="5117607">,</span>&nbsp;<span class="ident" id="5117609">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117619">if</span>&nbsp;<span class="ident" id="5117622">z</span><span class="op" id="5117623">.</span><span class="ident" id="5117624">buf</span><span class="op" id="5117627">[</span><span class="ident" id="5117628">i</span><span class="op" id="5117629">]</span>&nbsp;<span class="op" id="5117631">&gt;</span>&nbsp;<span class="num" id="5117633">0x7f</span>&nbsp;<span class="op" id="5117638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117643">needconv</span>&nbsp;<span class="op" id="5117652">=</span>&nbsp;<span class="builtintype" id="5117654">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117661">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117665">if</span>&nbsp;<span class="ident" id="5117668">z</span><span class="op" id="5117669">.</span><span class="ident" id="5117670">buf</span><span class="op" id="5117673">[</span><span class="ident" id="5117674">i</span><span class="op" id="5117675">]</span>&nbsp;<span class="op" id="5117677">==</span>&nbsp;<span class="num" id="5117680">0</span>&nbsp;<span class="op" id="5117682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117687">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117773">if</span>&nbsp;<span class="ident" id="5117776">needconv</span>&nbsp;<span class="op" id="5117785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117791">s</span>&nbsp;<span class="op" id="5117793">:=</span>&nbsp;<span class="builtinfunc" id="5117796">make</span><span class="op" id="5117800">(</span><span class="op" id="5117801">[</span><span class="op" id="5117802">]</span><span class="builtintype" id="5117803">rune</span><span class="op" id="5117807">,</span>&nbsp;<span class="num" id="5117809">0</span><span class="op" id="5117810">,</span>&nbsp;<span class="ident" id="5117812">i</span><span class="op" id="5117813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117819">for</span>&nbsp;<span class="ident" id="5117823">_</span><span class="op" id="5117824">,</span>&nbsp;<span class="ident" id="5117826">v</span>&nbsp;<span class="op" id="5117828">:=</span>&nbsp;<span class="keyword" id="5117831">range</span>&nbsp;<span class="ident" id="5117837">z</span><span class="op" id="5117838">.</span><span class="ident" id="5117839">buf</span><span class="op" id="5117842">[</span><span class="num" id="5117843">0</span><span class="op" id="5117844">:</span><span class="ident" id="5117845">i</span><span class="op" id="5117846">]</span>&nbsp;<span class="op" id="5117848">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5117855">s</span>&nbsp;<span class="op" id="5117857">=</span>&nbsp;<span class="builtinfunc" id="5117859">append</span><span class="op" id="5117865">(</span><span class="ident" id="5117866">s</span><span class="op" id="5117867">,</span>&nbsp;<span class="builtintype" id="5117869">rune</span><span class="op" id="5117873">(</span><span class="ident" id="5117874">v</span><span class="op" id="5117875">)</span><span class="op" id="5117876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117888">return</span>&nbsp;<span class="builtintype" id="5117895">string</span><span class="op" id="5117901">(</span><span class="ident" id="5117902">s</span><span class="op" id="5117903">)</span><span class="op" id="5117904">,</span>&nbsp;<span class="ident" id="5117906">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117918">return</span>&nbsp;<span class="builtintype" id="5117925">string</span><span class="op" id="5117931">(</span><span class="ident" id="5117932">z</span><span class="op" id="5117933">.</span><span class="ident" id="5117934">buf</span><span class="op" id="5117937">[</span><span class="num" id="5117938">0</span><span class="op" id="5117939">:</span><span class="ident" id="5117940">i</span><span class="op" id="5117941">]</span><span class="op" id="5117942">)</span><span class="op" id="5117943">,</span>&nbsp;<span class="ident" id="5117945">nil</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117954">}</span><br>
<span class="lineno"></span><span class="op" id="5117956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5117959">func</span>&nbsp;<span class="op" id="5117964">(</span><span class="ident" id="5117965">z</span>&nbsp;<span class="op" id="5117967">*</span><span class="ident" id="5117968">Reader</span><span class="op" id="5117974">)</span>&nbsp;<span class="ident" id="5117976">read2</span><span class="op" id="5117981">(</span><span class="op" id="5117982">)</span>&nbsp;<span class="op" id="5117984">(</span><span class="builtintype" id="5117985">uint32</span><span class="op" id="5117991">,</span>&nbsp;<span class="builtintype" id="5117993">error</span><span class="op" id="5117998">)</span>&nbsp;<span class="op" id="5118000">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118003">_</span><span class="op" id="5118004">,</span>&nbsp;<span class="ident" id="5118006">err</span>&nbsp;<span class="op" id="5118010">:=</span>&nbsp;<span class="ident" id="5118013">io</span><span class="op" id="5118015">.</span><span class="ident" id="5118016">ReadFull</span><span class="op" id="5118024">(</span><span class="ident" id="5118025">z</span><span class="op" id="5118026">.</span><span class="ident" id="5118027">r</span><span class="op" id="5118028">,</span>&nbsp;<span class="ident" id="5118030">z</span><span class="op" id="5118031">.</span><span class="ident" id="5118032">buf</span><span class="op" id="5118035">[</span><span class="num" id="5118036">0</span><span class="op" id="5118037">:</span><span class="num" id="5118038">2</span><span class="op" id="5118039">]</span><span class="op" id="5118040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118043">if</span>&nbsp;<span class="ident" id="5118046">err</span>&nbsp;<span class="op" id="5118050">!=</span>&nbsp;<span class="ident" id="5118053">nil</span>&nbsp;<span class="op" id="5118057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118061">return</span>&nbsp;<span class="num" id="5118068">0</span><span class="op" id="5118069">,</span>&nbsp;<span class="ident" id="5118071">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118079">return</span>&nbsp;<span class="builtintype" id="5118086">uint32</span><span class="op" id="5118092">(</span><span class="ident" id="5118093">z</span><span class="op" id="5118094">.</span><span class="ident" id="5118095">buf</span><span class="op" id="5118098">[</span><span class="num" id="5118099">0</span><span class="op" id="5118100">]</span><span class="op" id="5118101">)</span>&nbsp;<span class="op" id="5118103">|</span>&nbsp;<span class="builtintype" id="5118105">uint32</span><span class="op" id="5118111">(</span><span class="ident" id="5118112">z</span><span class="op" id="5118113">.</span><span class="ident" id="5118114">buf</span><span class="op" id="5118117">[</span><span class="num" id="5118118">1</span><span class="op" id="5118119">]</span><span class="op" id="5118120">)</span><span class="op" id="5118121">&lt;&lt;</span><span class="num" id="5118123">8</span><span class="op" id="5118124">,</span>&nbsp;<span class="ident" id="5118126">nil</span><br>
<span class="lineno">170</span><span class="op" id="5118130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5118133">func</span>&nbsp;<span class="op" id="5118138">(</span><span class="ident" id="5118139">z</span>&nbsp;<span class="op" id="5118141">*</span><span class="ident" id="5118142">Reader</span><span class="op" id="5118148">)</span>&nbsp;<span class="ident" id="5118150">readHeader</span><span class="op" id="5118160">(</span><span class="ident" id="5118161">save</span>&nbsp;<span class="builtintype" id="5118166">bool</span><span class="op" id="5118170">)</span>&nbsp;<span class="builtintype" id="5118172">error</span>&nbsp;<span class="op" id="5118178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118181">_</span><span class="op" id="5118182">,</span>&nbsp;<span class="ident" id="5118184">err</span>&nbsp;<span class="op" id="5118188">:=</span>&nbsp;<span class="ident" id="5118191">io</span><span class="op" id="5118193">.</span><span class="ident" id="5118194">ReadFull</span><span class="op" id="5118202">(</span><span class="ident" id="5118203">z</span><span class="op" id="5118204">.</span><span class="ident" id="5118205">r</span><span class="op" id="5118206">,</span>&nbsp;<span class="ident" id="5118208">z</span><span class="op" id="5118209">.</span><span class="ident" id="5118210">buf</span><span class="op" id="5118213">[</span><span class="num" id="5118214">0</span><span class="op" id="5118215">:</span><span class="num" id="5118216">10</span><span class="op" id="5118218">]</span><span class="op" id="5118219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118222">if</span>&nbsp;<span class="ident" id="5118225">err</span>&nbsp;<span class="op" id="5118229">!=</span>&nbsp;<span class="ident" id="5118232">nil</span>&nbsp;<span class="op" id="5118236">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118240">return</span>&nbsp;<span class="ident" id="5118247">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118255">if</span>&nbsp;<span class="ident" id="5118258">z</span><span class="op" id="5118259">.</span><span class="ident" id="5118260">buf</span><span class="op" id="5118263">[</span><span class="num" id="5118264">0</span><span class="op" id="5118265">]</span>&nbsp;<span class="op" id="5118267">!=</span>&nbsp;<span class="ident" id="5118270">gzipID1</span>&nbsp;<span class="op" id="5118278">||</span>&nbsp;<span class="ident" id="5118281">z</span><span class="op" id="5118282">.</span><span class="ident" id="5118283">buf</span><span class="op" id="5118286">[</span><span class="num" id="5118287">1</span><span class="op" id="5118288">]</span>&nbsp;<span class="op" id="5118290">!=</span>&nbsp;<span class="ident" id="5118293">gzipID2</span>&nbsp;<span class="op" id="5118301">||</span>&nbsp;<span class="ident" id="5118304">z</span><span class="op" id="5118305">.</span><span class="ident" id="5118306">buf</span><span class="op" id="5118309">[</span><span class="num" id="5118310">2</span><span class="op" id="5118311">]</span>&nbsp;<span class="op" id="5118313">!=</span>&nbsp;<span class="ident" id="5118316">gzipDeflate</span>&nbsp;<span class="op" id="5118328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118332">return</span>&nbsp;<span class="ident" id="5118339">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118350">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118353">z</span><span class="op" id="5118354">.</span><span class="ident" id="5118355">flg</span>&nbsp;<span class="op" id="5118359">=</span>&nbsp;<span class="ident" id="5118361">z</span><span class="op" id="5118362">.</span><span class="ident" id="5118363">buf</span><span class="op" id="5118366">[</span><span class="num" id="5118367">3</span><span class="op" id="5118368">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118371">if</span>&nbsp;<span class="ident" id="5118374">save</span>&nbsp;<span class="op" id="5118379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118383">z</span><span class="op" id="5118384">.</span><span class="ident" id="5118385">ModTime</span>&nbsp;<span class="op" id="5118393">=</span>&nbsp;<span class="ident" id="5118395">time</span><span class="op" id="5118399">.</span><span class="ident" id="5118400">Unix</span><span class="op" id="5118404">(</span><span class="ident" id="5118405">int64</span><span class="op" id="5118410">(</span><span class="ident" id="5118411">get4</span><span class="op" id="5118415">(</span><span class="ident" id="5118416">z</span><span class="op" id="5118417">.</span><span class="ident" id="5118418">buf</span><span class="op" id="5118421">[</span><span class="num" id="5118422">4</span><span class="op" id="5118423">:</span><span class="num" id="5118424">8</span><span class="op" id="5118425">]</span><span class="op" id="5118426">)</span><span class="op" id="5118427">)</span><span class="op" id="5118428">,</span>&nbsp;<span class="num" id="5118430">0</span><span class="op" id="5118431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5118435">//&nbsp;z.buf[8]&nbsp;is&nbsp;xfl,&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118465">z</span><span class="op" id="5118466">.</span><span class="ident" id="5118467">OS</span>&nbsp;<span class="op" id="5118470">=</span>&nbsp;<span class="ident" id="5118472">z</span><span class="op" id="5118473">.</span><span class="ident" id="5118474">buf</span><span class="op" id="5118477">[</span><span class="num" id="5118478">9</span><span class="op" id="5118479">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118485">z</span><span class="op" id="5118486">.</span><span class="ident" id="5118487">digest</span><span class="op" id="5118493">.</span><span class="ident" id="5118494">Reset</span><span class="op" id="5118499">(</span><span class="op" id="5118500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118503">z</span><span class="op" id="5118504">.</span><span class="ident" id="5118505">digest</span><span class="op" id="5118511">.</span><span class="ident" id="5118512">Write</span><span class="op" id="5118517">(</span><span class="ident" id="5118518">z</span><span class="op" id="5118519">.</span><span class="ident" id="5118520">buf</span><span class="op" id="5118523">[</span><span class="num" id="5118524">0</span><span class="op" id="5118525">:</span><span class="num" id="5118526">10</span><span class="op" id="5118528">]</span><span class="op" id="5118529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118533">if</span>&nbsp;<span class="ident" id="5118536">z</span><span class="op" id="5118537">.</span><span class="ident" id="5118538">flg</span><span class="op" id="5118541">&amp;</span><span class="ident" id="5118542">flagExtra</span>&nbsp;<span class="op" id="5118552">!=</span>&nbsp;<span class="num" id="5118555">0</span>&nbsp;<span class="op" id="5118557">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118561">n</span><span class="op" id="5118562">,</span>&nbsp;<span class="ident" id="5118564">err</span>&nbsp;<span class="op" id="5118568">:=</span>&nbsp;<span class="ident" id="5118571">z</span><span class="op" id="5118572">.</span><span class="ident" id="5118573">read2</span><span class="op" id="5118578">(</span><span class="op" id="5118579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118583">if</span>&nbsp;<span class="ident" id="5118586">err</span>&nbsp;<span class="op" id="5118590">!=</span>&nbsp;<span class="ident" id="5118593">nil</span>&nbsp;<span class="op" id="5118597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118602">return</span>&nbsp;<span class="ident" id="5118609">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118619">data</span>&nbsp;<span class="op" id="5118624">:=</span>&nbsp;<span class="builtinfunc" id="5118627">make</span><span class="op" id="5118631">(</span><span class="op" id="5118632">[</span><span class="op" id="5118633">]</span><span class="builtintype" id="5118634">byte</span><span class="op" id="5118638">,</span>&nbsp;<span class="ident" id="5118640">n</span><span class="op" id="5118641">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118645">if</span>&nbsp;<span class="ident" id="5118648">_</span><span class="op" id="5118649">,</span>&nbsp;<span class="ident" id="5118651">err</span>&nbsp;<span class="op" id="5118655">=</span>&nbsp;<span class="ident" id="5118657">io</span><span class="op" id="5118659">.</span><span class="ident" id="5118660">ReadFull</span><span class="op" id="5118668">(</span><span class="ident" id="5118669">z</span><span class="op" id="5118670">.</span><span class="ident" id="5118671">r</span><span class="op" id="5118672">,</span>&nbsp;<span class="ident" id="5118674">data</span><span class="op" id="5118678">)</span><span class="op" id="5118679">;</span>&nbsp;<span class="ident" id="5118681">err</span>&nbsp;<span class="op" id="5118685">!=</span>&nbsp;<span class="ident" id="5118688">nil</span>&nbsp;<span class="op" id="5118692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118697">return</span>&nbsp;<span class="ident" id="5118704">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118714">if</span>&nbsp;<span class="ident" id="5118717">save</span>&nbsp;<span class="op" id="5118722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118727">z</span><span class="op" id="5118728">.</span><span class="ident" id="5118729">Extra</span>&nbsp;<span class="op" id="5118735">=</span>&nbsp;<span class="ident" id="5118737">data</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118751">var</span>&nbsp;<span class="ident" id="5118755">s</span>&nbsp;<span class="builtintype" id="5118757">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118765">if</span>&nbsp;<span class="ident" id="5118768">z</span><span class="op" id="5118769">.</span><span class="ident" id="5118770">flg</span><span class="op" id="5118773">&amp;</span><span class="ident" id="5118774">flagName</span>&nbsp;<span class="op" id="5118783">!=</span>&nbsp;<span class="num" id="5118786">0</span>&nbsp;<span class="op" id="5118788">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118792">if</span>&nbsp;<span class="ident" id="5118795">s</span><span class="op" id="5118796">,</span>&nbsp;<span class="ident" id="5118798">err</span>&nbsp;<span class="op" id="5118802">=</span>&nbsp;<span class="ident" id="5118804">z</span><span class="op" id="5118805">.</span><span class="ident" id="5118806">readString</span><span class="op" id="5118816">(</span><span class="op" id="5118817">)</span><span class="op" id="5118818">;</span>&nbsp;<span class="ident" id="5118820">err</span>&nbsp;<span class="op" id="5118824">!=</span>&nbsp;<span class="ident" id="5118827">nil</span>&nbsp;<span class="op" id="5118831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118836">return</span>&nbsp;<span class="ident" id="5118843">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118853">if</span>&nbsp;<span class="ident" id="5118856">save</span>&nbsp;<span class="op" id="5118861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118866">z</span><span class="op" id="5118867">.</span><span class="ident" id="5118868">Name</span>&nbsp;<span class="op" id="5118873">=</span>&nbsp;<span class="ident" id="5118875">s</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118886">if</span>&nbsp;<span class="ident" id="5118889">z</span><span class="op" id="5118890">.</span><span class="ident" id="5118891">flg</span><span class="op" id="5118894">&amp;</span><span class="ident" id="5118895">flagComment</span>&nbsp;<span class="op" id="5118907">!=</span>&nbsp;<span class="num" id="5118910">0</span>&nbsp;<span class="op" id="5118912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118916">if</span>&nbsp;<span class="ident" id="5118919">s</span><span class="op" id="5118920">,</span>&nbsp;<span class="ident" id="5118922">err</span>&nbsp;<span class="op" id="5118926">=</span>&nbsp;<span class="ident" id="5118928">z</span><span class="op" id="5118929">.</span><span class="ident" id="5118930">readString</span><span class="op" id="5118940">(</span><span class="op" id="5118941">)</span><span class="op" id="5118942">;</span>&nbsp;<span class="ident" id="5118944">err</span>&nbsp;<span class="op" id="5118948">!=</span>&nbsp;<span class="ident" id="5118951">nil</span>&nbsp;<span class="op" id="5118955">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118960">return</span>&nbsp;<span class="ident" id="5118967">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118977">if</span>&nbsp;<span class="ident" id="5118980">save</span>&nbsp;<span class="op" id="5118985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118990">z</span><span class="op" id="5118991">.</span><span class="ident" id="5118992">Comment</span>&nbsp;<span class="op" id="5119000">=</span>&nbsp;<span class="ident" id="5119002">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119006">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119013">if</span>&nbsp;<span class="ident" id="5119016">z</span><span class="op" id="5119017">.</span><span class="ident" id="5119018">flg</span><span class="op" id="5119021">&amp;</span><span class="ident" id="5119022">flagHdrCrc</span>&nbsp;<span class="op" id="5119033">!=</span>&nbsp;<span class="num" id="5119036">0</span>&nbsp;<span class="op" id="5119038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119042">n</span><span class="op" id="5119043">,</span>&nbsp;<span class="ident" id="5119045">err</span>&nbsp;<span class="op" id="5119049">:=</span>&nbsp;<span class="ident" id="5119052">z</span><span class="op" id="5119053">.</span><span class="ident" id="5119054">read2</span><span class="op" id="5119059">(</span><span class="op" id="5119060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119064">if</span>&nbsp;<span class="ident" id="5119067">err</span>&nbsp;<span class="op" id="5119071">!=</span>&nbsp;<span class="ident" id="5119074">nil</span>&nbsp;<span class="op" id="5119078">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119083">return</span>&nbsp;<span class="ident" id="5119090">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119100">sum</span>&nbsp;<span class="op" id="5119104">:=</span>&nbsp;<span class="ident" id="5119107">z</span><span class="op" id="5119108">.</span><span class="ident" id="5119109">digest</span><span class="op" id="5119115">.</span><span class="ident" id="5119116">Sum32</span><span class="op" id="5119121">(</span><span class="op" id="5119122">)</span>&nbsp;<span class="op" id="5119124">&amp;</span>&nbsp;<span class="num" id="5119126">0xFFFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119135">if</span>&nbsp;<span class="ident" id="5119138">n</span>&nbsp;<span class="op" id="5119140">!=</span>&nbsp;<span class="ident" id="5119143">sum</span>&nbsp;<span class="op" id="5119147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119152">return</span>&nbsp;<span class="ident" id="5119159">ErrHeader</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119178">z</span><span class="op" id="5119179">.</span><span class="ident" id="5119180">digest</span><span class="op" id="5119186">.</span><span class="ident" id="5119187">Reset</span><span class="op" id="5119192">(</span><span class="op" id="5119193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119196">if</span>&nbsp;<span class="ident" id="5119199">z</span><span class="op" id="5119200">.</span><span class="ident" id="5119201">decompressor</span>&nbsp;<span class="op" id="5119214">==</span>&nbsp;<span class="ident" id="5119217">nil</span>&nbsp;<span class="op" id="5119221">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119225">z</span><span class="op" id="5119226">.</span><span class="ident" id="5119227">decompressor</span>&nbsp;<span class="op" id="5119240">=</span>&nbsp;<span class="ident" id="5119242">flate</span><span class="op" id="5119247">.</span><span class="ident" id="5119248">NewReader</span><span class="op" id="5119257">(</span><span class="ident" id="5119258">z</span><span class="op" id="5119259">.</span><span class="ident" id="5119260">r</span><span class="op" id="5119261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119264">}</span>&nbsp;<span class="keyword" id="5119266">else</span>&nbsp;<span class="op" id="5119271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119275">z</span><span class="op" id="5119276">.</span><span class="ident" id="5119277">decompressor</span><span class="op" id="5119289">.</span><span class="op" id="5119290">(</span><span class="ident" id="5119291">flate</span><span class="op" id="5119296">.</span><span class="ident" id="5119297">Resetter</span><span class="op" id="5119305">)</span><span class="op" id="5119306">.</span><span class="ident" id="5119307">Reset</span><span class="op" id="5119312">(</span><span class="ident" id="5119313">z</span><span class="op" id="5119314">.</span><span class="ident" id="5119315">r</span><span class="op" id="5119316">,</span>&nbsp;<span class="ident" id="5119318">nil</span><span class="op" id="5119321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119327">return</span>&nbsp;<span class="ident" id="5119334">nil</span><br>
<span class="lineno">240</span><span class="op" id="5119338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5119341">func</span>&nbsp;<span class="op" id="5119346">(</span><span class="ident" id="5119347">z</span>&nbsp;<span class="op" id="5119349">*</span><span class="ident" id="5119350">Reader</span><span class="op" id="5119356">)</span>&nbsp;<span class="ident" id="5119358">Read</span><span class="op" id="5119362">(</span><span class="ident" id="5119363">p</span>&nbsp;<span class="op" id="5119365">[</span><span class="op" id="5119366">]</span><span class="builtintype" id="5119367">byte</span><span class="op" id="5119371">)</span>&nbsp;<span class="op" id="5119373">(</span><span class="ident" id="5119374">n</span>&nbsp;<span class="builtintype" id="5119376">int</span><span class="op" id="5119379">,</span>&nbsp;<span class="ident" id="5119381">err</span>&nbsp;<span class="builtintype" id="5119385">error</span><span class="op" id="5119390">)</span>&nbsp;<span class="op" id="5119392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119395">if</span>&nbsp;<span class="ident" id="5119398">z</span><span class="op" id="5119399">.</span><span class="ident" id="5119400">err</span>&nbsp;<span class="op" id="5119404">!=</span>&nbsp;<span class="ident" id="5119407">nil</span>&nbsp;<span class="op" id="5119411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119415">return</span>&nbsp;<span class="num" id="5119422">0</span><span class="op" id="5119423">,</span>&nbsp;<span class="ident" id="5119425">z</span><span class="op" id="5119426">.</span><span class="ident" id="5119427">err</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119435">if</span>&nbsp;<span class="builtinfunc" id="5119438">len</span><span class="op" id="5119441">(</span><span class="ident" id="5119442">p</span><span class="op" id="5119443">)</span>&nbsp;<span class="op" id="5119445">==</span>&nbsp;<span class="num" id="5119448">0</span>&nbsp;<span class="op" id="5119450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119454">return</span>&nbsp;<span class="num" id="5119461">0</span><span class="op" id="5119462">,</span>&nbsp;<span class="ident" id="5119464">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119473">n</span><span class="op" id="5119474">,</span>&nbsp;<span class="ident" id="5119476">err</span>&nbsp;<span class="op" id="5119480">=</span>&nbsp;<span class="ident" id="5119482">z</span><span class="op" id="5119483">.</span><span class="ident" id="5119484">decompressor</span><span class="op" id="5119496">.</span><span class="ident" id="5119497">Read</span><span class="op" id="5119501">(</span><span class="ident" id="5119502">p</span><span class="op" id="5119503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119506">z</span><span class="op" id="5119507">.</span><span class="ident" id="5119508">digest</span><span class="op" id="5119514">.</span><span class="ident" id="5119515">Write</span><span class="op" id="5119520">(</span><span class="ident" id="5119521">p</span><span class="op" id="5119522">[</span><span class="num" id="5119523">0</span><span class="op" id="5119524">:</span><span class="ident" id="5119525">n</span><span class="op" id="5119526">]</span><span class="op" id="5119527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119530">z</span><span class="op" id="5119531">.</span><span class="ident" id="5119532">size</span>&nbsp;<span class="op" id="5119537">+=</span>&nbsp;<span class="builtintype" id="5119540">uint32</span><span class="op" id="5119546">(</span><span class="ident" id="5119547">n</span><span class="op" id="5119548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119551">if</span>&nbsp;<span class="ident" id="5119554">n</span>&nbsp;<span class="op" id="5119556">!=</span>&nbsp;<span class="num" id="5119559">0</span>&nbsp;<span class="op" id="5119561">||</span>&nbsp;<span class="ident" id="5119564">err</span>&nbsp;<span class="op" id="5119568">!=</span>&nbsp;<span class="ident" id="5119571">io</span><span class="op" id="5119573">.</span><span class="ident" id="5119574">EOF</span>&nbsp;<span class="op" id="5119578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119582">z</span><span class="op" id="5119583">.</span><span class="ident" id="5119584">err</span>&nbsp;<span class="op" id="5119588">=</span>&nbsp;<span class="ident" id="5119590">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119596">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5119608">//&nbsp;Finished&nbsp;file;&nbsp;check&nbsp;checksum&nbsp;+&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119650">if</span>&nbsp;<span class="ident" id="5119653">_</span><span class="op" id="5119654">,</span>&nbsp;<span class="ident" id="5119656">err</span>&nbsp;<span class="op" id="5119660">:=</span>&nbsp;<span class="ident" id="5119663">io</span><span class="op" id="5119665">.</span><span class="ident" id="5119666">ReadFull</span><span class="op" id="5119674">(</span><span class="ident" id="5119675">z</span><span class="op" id="5119676">.</span><span class="ident" id="5119677">r</span><span class="op" id="5119678">,</span>&nbsp;<span class="ident" id="5119680">z</span><span class="op" id="5119681">.</span><span class="ident" id="5119682">buf</span><span class="op" id="5119685">[</span><span class="num" id="5119686">0</span><span class="op" id="5119687">:</span><span class="num" id="5119688">8</span><span class="op" id="5119689">]</span><span class="op" id="5119690">)</span><span class="op" id="5119691">;</span>&nbsp;<span class="ident" id="5119693">err</span>&nbsp;<span class="op" id="5119697">!=</span>&nbsp;<span class="ident" id="5119700">nil</span>&nbsp;<span class="op" id="5119704">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119708">z</span><span class="op" id="5119709">.</span><span class="ident" id="5119710">err</span>&nbsp;<span class="op" id="5119714">=</span>&nbsp;<span class="ident" id="5119716">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119722">return</span>&nbsp;<span class="num" id="5119729">0</span><span class="op" id="5119730">,</span>&nbsp;<span class="ident" id="5119732">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119740">crc32</span><span class="op" id="5119745">,</span>&nbsp;<span class="ident" id="5119747">isize</span>&nbsp;<span class="op" id="5119753">:=</span>&nbsp;<span class="ident" id="5119756">get4</span><span class="op" id="5119760">(</span><span class="ident" id="5119761">z</span><span class="op" id="5119762">.</span><span class="ident" id="5119763">buf</span><span class="op" id="5119766">[</span><span class="num" id="5119767">0</span><span class="op" id="5119768">:</span><span class="num" id="5119769">4</span><span class="op" id="5119770">]</span><span class="op" id="5119771">)</span><span class="op" id="5119772">,</span>&nbsp;<span class="ident" id="5119774">get4</span><span class="op" id="5119778">(</span><span class="ident" id="5119779">z</span><span class="op" id="5119780">.</span><span class="ident" id="5119781">buf</span><span class="op" id="5119784">[</span><span class="num" id="5119785">4</span><span class="op" id="5119786">:</span><span class="num" id="5119787">8</span><span class="op" id="5119788">]</span><span class="op" id="5119789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119792">sum</span>&nbsp;<span class="op" id="5119796">:=</span>&nbsp;<span class="ident" id="5119799">z</span><span class="op" id="5119800">.</span><span class="ident" id="5119801">digest</span><span class="op" id="5119807">.</span><span class="ident" id="5119808">Sum32</span><span class="op" id="5119813">(</span><span class="op" id="5119814">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119817">if</span>&nbsp;<span class="ident" id="5119820">sum</span>&nbsp;<span class="op" id="5119824">!=</span>&nbsp;<span class="ident" id="5119827">crc32</span>&nbsp;<span class="op" id="5119833">||</span>&nbsp;<span class="ident" id="5119836">isize</span>&nbsp;<span class="op" id="5119842">!=</span>&nbsp;<span class="ident" id="5119845">z</span><span class="op" id="5119846">.</span><span class="ident" id="5119847">size</span>&nbsp;<span class="op" id="5119852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119856">z</span><span class="op" id="5119857">.</span><span class="ident" id="5119858">err</span>&nbsp;<span class="op" id="5119862">=</span>&nbsp;<span class="ident" id="5119864">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119878">return</span>&nbsp;<span class="num" id="5119885">0</span><span class="op" id="5119886">,</span>&nbsp;<span class="ident" id="5119888">z</span><span class="op" id="5119889">.</span><span class="ident" id="5119890">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5119899">//&nbsp;File&nbsp;is&nbsp;ok;&nbsp;is&nbsp;there&nbsp;another?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119933">if</span>&nbsp;<span class="op" id="5119936">!</span><span class="ident" id="5119937">z</span><span class="op" id="5119938">.</span><span class="ident" id="5119939">multistream</span>&nbsp;<span class="op" id="5119951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119955">return</span>&nbsp;<span class="num" id="5119962">0</span><span class="op" id="5119963">,</span>&nbsp;<span class="ident" id="5119965">io</span><span class="op" id="5119967">.</span><span class="ident" id="5119968">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119977">if</span>&nbsp;<span class="ident" id="5119980">err</span>&nbsp;<span class="op" id="5119984">=</span>&nbsp;<span class="ident" id="5119986">z</span><span class="op" id="5119987">.</span><span class="ident" id="5119988">readHeader</span><span class="op" id="5119998">(</span><span class="builtintype" id="5119999">false</span><span class="op" id="5120004">)</span><span class="op" id="5120005">;</span>&nbsp;<span class="ident" id="5120007">err</span>&nbsp;<span class="op" id="5120011">!=</span>&nbsp;<span class="ident" id="5120014">nil</span>&nbsp;<span class="op" id="5120018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120022">z</span><span class="op" id="5120023">.</span><span class="ident" id="5120024">err</span>&nbsp;<span class="op" id="5120028">=</span>&nbsp;<span class="ident" id="5120030">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120036">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120048">//&nbsp;Yes.&nbsp;&nbsp;Reset&nbsp;and&nbsp;read&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120082">z</span><span class="op" id="5120083">.</span><span class="ident" id="5120084">digest</span><span class="op" id="5120090">.</span><span class="ident" id="5120091">Reset</span><span class="op" id="5120096">(</span><span class="op" id="5120097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120100">z</span><span class="op" id="5120101">.</span><span class="ident" id="5120102">size</span>&nbsp;<span class="op" id="5120107">=</span>&nbsp;<span class="num" id="5120109">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120112">return</span>&nbsp;<span class="ident" id="5120119">z</span><span class="op" id="5120120">.</span><span class="ident" id="5120121">Read</span><span class="op" id="5120125">(</span><span class="ident" id="5120126">p</span><span class="op" id="5120127">)</span><br>
<span class="lineno"></span><span class="op" id="5120129">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="5120132">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Reader.&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="5120204">func</span>&nbsp;<span class="op" id="5120209">(</span><span class="ident" id="5120210">z</span>&nbsp;<span class="op" id="5120212">*</span><span class="ident" id="5120213">Reader</span><span class="op" id="5120219">)</span>&nbsp;<span class="ident" id="5120221">Close</span><span class="op" id="5120226">(</span><span class="op" id="5120227">)</span>&nbsp;<span class="builtintype" id="5120229">error</span>&nbsp;<span class="op" id="5120235">{</span>&nbsp;<span class="keyword" id="5120237">return</span>&nbsp;<span class="ident" id="5120244">z</span><span class="op" id="5120245">.</span><span class="ident" id="5120246">decompressor</span><span class="op" id="5120258">.</span><span class="ident" id="5120259">Close</span><span class="op" id="5120264">(</span><span class="op" id="5120265">)</span>&nbsp;<span class="op" id="5120267">}</span>
</div>
</body>
</html>
