<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rc4</h2>
<ul>
<li><a href="/gostd/crypto/rc4/rc4.go.html" class="current">rc4.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_asm.go.html">rc4_asm.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_test.go.html">rc4_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3786362">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3786417">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3786471">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3786522">//&nbsp;Package&nbsp;rc4&nbsp;implements&nbsp;RC4&nbsp;encryption,&nbsp;as&nbsp;defined&nbsp;in&nbsp;Bruce&nbsp;Schneier&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3786595">//&nbsp;Applied&nbsp;Cryptography.</span><br>
<span class="lineno"></span><span class="keyword" id="3786620">package</span>&nbsp;<span class="ident" id="3786628">rc4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3786633">//&nbsp;BUG(agl):&nbsp;RC4&nbsp;is&nbsp;in&nbsp;common&nbsp;use&nbsp;but&nbsp;has&nbsp;design&nbsp;weaknesses&nbsp;that&nbsp;make</span><br>
<span class="lineno">10</span><span class="comment" id="3786703">//&nbsp;it&nbsp;a&nbsp;poor&nbsp;choice&nbsp;for&nbsp;new&nbsp;protocols.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3786743">import</span>&nbsp;<span class="string" id="3786750">&#34;strconv&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3786761">//&nbsp;A&nbsp;Cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;RC4&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno">15</span><span class="keyword" id="3786819">type</span>&nbsp;<span class="ident" id="3786824">Cipher</span>&nbsp;<span class="keyword" id="3786831">struct</span>&nbsp;<span class="op" id="3786838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786841">s</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3786846">[</span><span class="num" id="3786847">256</span><span class="op" id="3786850">]</span><span class="builtintype" id="3786851">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786859">i</span><span class="op" id="3786860">,</span>&nbsp;<span class="ident" id="3786862">j</span>&nbsp;<span class="builtintype" id="3786864">uint8</span><br>
<span class="lineno"></span><span class="op" id="3786870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3786873">type</span>&nbsp;<span class="ident" id="3786878">KeySizeError</span>&nbsp;<span class="builtintype" id="3786891">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3786896">func</span>&nbsp;<span class="op" id="3786901">(</span><span class="ident" id="3786902">k</span>&nbsp;<span class="ident" id="3786904">KeySizeError</span><span class="op" id="3786916">)</span>&nbsp;<span class="ident" id="3786918">Error</span><span class="op" id="3786923">(</span><span class="op" id="3786924">)</span>&nbsp;<span class="builtintype" id="3786926">string</span>&nbsp;<span class="op" id="3786933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786936">return</span>&nbsp;<span class="string" id="3786943">&#34;crypto/rc4:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="3786975">+</span>&nbsp;<span class="ident" id="3786977">strconv</span><span class="op" id="3786984">.</span><span class="ident" id="3786985">Itoa</span><span class="op" id="3786989">(</span><span class="builtintype" id="3786990">int</span><span class="op" id="3786993">(</span><span class="ident" id="3786994">k</span><span class="op" id="3786995">)</span><span class="op" id="3786996">)</span><br>
<span class="lineno"></span><span class="op" id="3786998">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3787001">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;Cipher.&nbsp;&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3787080">//&nbsp;RC4&nbsp;key,&nbsp;at&nbsp;least&nbsp;1&nbsp;byte&nbsp;and&nbsp;at&nbsp;most&nbsp;256&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3787131">func</span>&nbsp;<span class="ident" id="3787136">NewCipher</span><span class="op" id="3787145">(</span><span class="ident" id="3787146">key</span>&nbsp;<span class="op" id="3787150">[</span><span class="op" id="3787151">]</span><span class="builtintype" id="3787152">byte</span><span class="op" id="3787156">)</span>&nbsp;<span class="op" id="3787158">(</span><span class="op" id="3787159">*</span><span class="ident" id="3787160">Cipher</span><span class="op" id="3787166">,</span>&nbsp;<span class="builtintype" id="3787168">error</span><span class="op" id="3787173">)</span>&nbsp;<span class="op" id="3787175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787178">k</span>&nbsp;<span class="op" id="3787180">:=</span>&nbsp;<span class="builtinfunc" id="3787183">len</span><span class="op" id="3787186">(</span><span class="ident" id="3787187">key</span><span class="op" id="3787190">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787193">if</span>&nbsp;<span class="ident" id="3787196">k</span>&nbsp;<span class="op" id="3787198">&lt;</span>&nbsp;<span class="num" id="3787200">1</span>&nbsp;<span class="op" id="3787202">||</span>&nbsp;<span class="ident" id="3787205">k</span>&nbsp;<span class="op" id="3787207">&gt;</span>&nbsp;<span class="num" id="3787209">256</span>&nbsp;<span class="op" id="3787213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787217">return</span>&nbsp;<span class="ident" id="3787224">nil</span><span class="op" id="3787227">,</span>&nbsp;<span class="ident" id="3787229">KeySizeError</span><span class="op" id="3787241">(</span><span class="ident" id="3787242">k</span><span class="op" id="3787243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787249">var</span>&nbsp;<span class="ident" id="3787253">c</span>&nbsp;<span class="ident" id="3787255">Cipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787263">for</span>&nbsp;<span class="ident" id="3787267">i</span>&nbsp;<span class="op" id="3787269">:=</span>&nbsp;<span class="num" id="3787272">0</span><span class="op" id="3787273">;</span>&nbsp;<span class="ident" id="3787275">i</span>&nbsp;<span class="op" id="3787277">&lt;</span>&nbsp;<span class="num" id="3787279">256</span><span class="op" id="3787282">;</span>&nbsp;<span class="ident" id="3787284">i</span><span class="op" id="3787285">++</span>&nbsp;<span class="op" id="3787288">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787292">c</span><span class="op" id="3787293">.</span><span class="ident" id="3787294">s</span><span class="op" id="3787295">[</span><span class="ident" id="3787296">i</span><span class="op" id="3787297">]</span>&nbsp;<span class="op" id="3787299">=</span>&nbsp;<span class="builtintype" id="3787301">uint32</span><span class="op" id="3787307">(</span><span class="ident" id="3787308">i</span><span class="op" id="3787309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787315">var</span>&nbsp;<span class="ident" id="3787319">j</span>&nbsp;<span class="builtintype" id="3787321">uint8</span>&nbsp;<span class="op" id="3787327">=</span>&nbsp;<span class="num" id="3787329">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787332">for</span>&nbsp;<span class="ident" id="3787336">i</span>&nbsp;<span class="op" id="3787338">:=</span>&nbsp;<span class="num" id="3787341">0</span><span class="op" id="3787342">;</span>&nbsp;<span class="ident" id="3787344">i</span>&nbsp;<span class="op" id="3787346">&lt;</span>&nbsp;<span class="num" id="3787348">256</span><span class="op" id="3787351">;</span>&nbsp;<span class="ident" id="3787353">i</span><span class="op" id="3787354">++</span>&nbsp;<span class="op" id="3787357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787361">j</span>&nbsp;<span class="op" id="3787363">+=</span>&nbsp;<span class="builtintype" id="3787366">uint8</span><span class="op" id="3787371">(</span><span class="ident" id="3787372">c</span><span class="op" id="3787373">.</span><span class="ident" id="3787374">s</span><span class="op" id="3787375">[</span><span class="ident" id="3787376">i</span><span class="op" id="3787377">]</span><span class="op" id="3787378">)</span>&nbsp;<span class="op" id="3787380">+</span>&nbsp;<span class="ident" id="3787382">key</span><span class="op" id="3787385">[</span><span class="ident" id="3787386">i</span><span class="op" id="3787387">%</span><span class="ident" id="3787388">k</span><span class="op" id="3787389">]</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787393">c</span><span class="op" id="3787394">.</span><span class="ident" id="3787395">s</span><span class="op" id="3787396">[</span><span class="ident" id="3787397">i</span><span class="op" id="3787398">]</span><span class="op" id="3787399">,</span>&nbsp;<span class="ident" id="3787401">c</span><span class="op" id="3787402">.</span><span class="ident" id="3787403">s</span><span class="op" id="3787404">[</span><span class="ident" id="3787405">j</span><span class="op" id="3787406">]</span>&nbsp;<span class="op" id="3787408">=</span>&nbsp;<span class="ident" id="3787410">c</span><span class="op" id="3787411">.</span><span class="ident" id="3787412">s</span><span class="op" id="3787413">[</span><span class="ident" id="3787414">j</span><span class="op" id="3787415">]</span><span class="op" id="3787416">,</span>&nbsp;<span class="ident" id="3787418">c</span><span class="op" id="3787419">.</span><span class="ident" id="3787420">s</span><span class="op" id="3787421">[</span><span class="ident" id="3787422">i</span><span class="op" id="3787423">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787429">return</span>&nbsp;<span class="op" id="3787436">&amp;</span><span class="ident" id="3787437">c</span><span class="op" id="3787438">,</span>&nbsp;<span class="ident" id="3787440">nil</span><br>
<span class="lineno"></span><span class="op" id="3787444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="3787447">//&nbsp;Reset&nbsp;zeros&nbsp;the&nbsp;key&nbsp;data&nbsp;so&nbsp;that&nbsp;it&nbsp;will&nbsp;no&nbsp;longer&nbsp;appear&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3787515">//&nbsp;process&#39;s&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="3787536">func</span>&nbsp;<span class="op" id="3787541">(</span><span class="ident" id="3787542">c</span>&nbsp;<span class="op" id="3787544">*</span><span class="ident" id="3787545">Cipher</span><span class="op" id="3787551">)</span>&nbsp;<span class="ident" id="3787553">Reset</span><span class="op" id="3787558">(</span><span class="op" id="3787559">)</span>&nbsp;<span class="op" id="3787561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787564">for</span>&nbsp;<span class="ident" id="3787568">i</span>&nbsp;<span class="op" id="3787570">:=</span>&nbsp;<span class="keyword" id="3787573">range</span>&nbsp;<span class="ident" id="3787579">c</span><span class="op" id="3787580">.</span><span class="ident" id="3787581">s</span>&nbsp;<span class="op" id="3787583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787587">c</span><span class="op" id="3787588">.</span><span class="ident" id="3787589">s</span><span class="op" id="3787590">[</span><span class="ident" id="3787591">i</span><span class="op" id="3787592">]</span>&nbsp;<span class="op" id="3787594">=</span>&nbsp;<span class="num" id="3787596">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787602">c</span><span class="op" id="3787603">.</span><span class="ident" id="3787604">i</span><span class="op" id="3787605">,</span>&nbsp;<span class="ident" id="3787607">c</span><span class="op" id="3787608">.</span><span class="ident" id="3787609">j</span>&nbsp;<span class="op" id="3787611">=</span>&nbsp;<span class="num" id="3787613">0</span><span class="op" id="3787614">,</span>&nbsp;<span class="num" id="3787616">0</span><br>
<span class="lineno"></span><span class="op" id="3787618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3787621">//&nbsp;xorKeyStreamGeneric&nbsp;sets&nbsp;dst&nbsp;to&nbsp;the&nbsp;result&nbsp;of&nbsp;XORing&nbsp;src&nbsp;with&nbsp;the</span><br>
<span class="lineno">55</span><span class="comment" id="3787690">//&nbsp;key&nbsp;stream.&nbsp;&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;be&nbsp;the&nbsp;same&nbsp;slice&nbsp;but&nbsp;otherwise&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3787761">//&nbsp;not&nbsp;overlap.</span><br>
<span class="lineno"></span><span class="comment" id="3787777">//</span><br>
<span class="lineno"></span><span class="comment" id="3787780">//&nbsp;This&nbsp;is&nbsp;the&nbsp;pure&nbsp;Go&nbsp;version.&nbsp;rc4_{amd64,386,arm}*&nbsp;contain&nbsp;assembly</span><br>
<span class="lineno"></span><span class="comment" id="3787850">//&nbsp;implementations.&nbsp;This&nbsp;is&nbsp;here&nbsp;for&nbsp;tests&nbsp;and&nbsp;to&nbsp;prevent&nbsp;bitrot.</span><br>
<span class="lineno">60</span><span class="keyword" id="3787916">func</span>&nbsp;<span class="op" id="3787921">(</span><span class="ident" id="3787922">c</span>&nbsp;<span class="op" id="3787924">*</span><span class="ident" id="3787925">Cipher</span><span class="op" id="3787931">)</span>&nbsp;<span class="ident" id="3787933">xorKeyStreamGeneric</span><span class="op" id="3787952">(</span><span class="ident" id="3787953">dst</span><span class="op" id="3787956">,</span>&nbsp;<span class="ident" id="3787958">src</span>&nbsp;<span class="op" id="3787962">[</span><span class="op" id="3787963">]</span><span class="builtintype" id="3787964">byte</span><span class="op" id="3787968">)</span>&nbsp;<span class="op" id="3787970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787973">i</span><span class="op" id="3787974">,</span>&nbsp;<span class="ident" id="3787976">j</span>&nbsp;<span class="op" id="3787978">:=</span>&nbsp;<span class="ident" id="3787981">c</span><span class="op" id="3787982">.</span><span class="ident" id="3787983">i</span><span class="op" id="3787984">,</span>&nbsp;<span class="ident" id="3787986">c</span><span class="op" id="3787987">.</span><span class="ident" id="3787988">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787991">for</span>&nbsp;<span class="ident" id="3787995">k</span><span class="op" id="3787996">,</span>&nbsp;<span class="ident" id="3787998">v</span>&nbsp;<span class="op" id="3788000">:=</span>&nbsp;<span class="keyword" id="3788003">range</span>&nbsp;<span class="ident" id="3788009">src</span>&nbsp;<span class="op" id="3788013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788017">i</span>&nbsp;<span class="op" id="3788019">+=</span>&nbsp;<span class="num" id="3788022">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788026">j</span>&nbsp;<span class="op" id="3788028">+=</span>&nbsp;<span class="builtintype" id="3788031">uint8</span><span class="op" id="3788036">(</span><span class="ident" id="3788037">c</span><span class="op" id="3788038">.</span><span class="ident" id="3788039">s</span><span class="op" id="3788040">[</span><span class="ident" id="3788041">i</span><span class="op" id="3788042">]</span><span class="op" id="3788043">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788047">c</span><span class="op" id="3788048">.</span><span class="ident" id="3788049">s</span><span class="op" id="3788050">[</span><span class="ident" id="3788051">i</span><span class="op" id="3788052">]</span><span class="op" id="3788053">,</span>&nbsp;<span class="ident" id="3788055">c</span><span class="op" id="3788056">.</span><span class="ident" id="3788057">s</span><span class="op" id="3788058">[</span><span class="ident" id="3788059">j</span><span class="op" id="3788060">]</span>&nbsp;<span class="op" id="3788062">=</span>&nbsp;<span class="ident" id="3788064">c</span><span class="op" id="3788065">.</span><span class="ident" id="3788066">s</span><span class="op" id="3788067">[</span><span class="ident" id="3788068">j</span><span class="op" id="3788069">]</span><span class="op" id="3788070">,</span>&nbsp;<span class="ident" id="3788072">c</span><span class="op" id="3788073">.</span><span class="ident" id="3788074">s</span><span class="op" id="3788075">[</span><span class="ident" id="3788076">i</span><span class="op" id="3788077">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788081">dst</span><span class="op" id="3788084">[</span><span class="ident" id="3788085">k</span><span class="op" id="3788086">]</span>&nbsp;<span class="op" id="3788088">=</span>&nbsp;<span class="ident" id="3788090">v</span>&nbsp;<span class="op" id="3788092">^</span>&nbsp;<span class="builtintype" id="3788094">uint8</span><span class="op" id="3788099">(</span><span class="ident" id="3788100">c</span><span class="op" id="3788101">.</span><span class="ident" id="3788102">s</span><span class="op" id="3788103">[</span><span class="builtintype" id="3788104">uint8</span><span class="op" id="3788109">(</span><span class="ident" id="3788110">c</span><span class="op" id="3788111">.</span><span class="ident" id="3788112">s</span><span class="op" id="3788113">[</span><span class="ident" id="3788114">i</span><span class="op" id="3788115">]</span><span class="op" id="3788116">+</span><span class="ident" id="3788117">c</span><span class="op" id="3788118">.</span><span class="ident" id="3788119">s</span><span class="op" id="3788120">[</span><span class="ident" id="3788121">j</span><span class="op" id="3788122">]</span><span class="op" id="3788123">)</span><span class="op" id="3788124">]</span><span class="op" id="3788125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788131">c</span><span class="op" id="3788132">.</span><span class="ident" id="3788133">i</span><span class="op" id="3788134">,</span>&nbsp;<span class="ident" id="3788136">c</span><span class="op" id="3788137">.</span><span class="ident" id="3788138">j</span>&nbsp;<span class="op" id="3788140">=</span>&nbsp;<span class="ident" id="3788142">i</span><span class="op" id="3788143">,</span>&nbsp;<span class="ident" id="3788145">j</span><br>
<span class="lineno"></span><span class="op" id="3788147">}</span>
</div>
</body>
</html>
