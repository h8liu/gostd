<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7906254">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7906309">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7906363">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7906414">package</span>&nbsp;<span class="ident" id="7906422">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7906430">import</span>&nbsp;<span class="op" id="7906437">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7906440">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7906449">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7906459">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7906465">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7906478">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7906489">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7906500">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7906511">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7906518">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7906521">type</span>&nbsp;<span class="ident" id="7906526">testpair</span>&nbsp;<span class="keyword" id="7906535">struct</span>&nbsp;<span class="op" id="7906542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906545">decoded</span><span class="op" id="7906552">,</span>&nbsp;<span class="ident" id="7906554">encoded</span>&nbsp;<span class="builtintype" id="7906562">string</span><br>
<span class="lineno">20</span><span class="op" id="7906569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7906572">var</span>&nbsp;<span class="ident" id="7906576">pairs</span>&nbsp;<span class="op" id="7906582">=</span>&nbsp;<span class="op" id="7906584">[</span><span class="op" id="7906585">]</span><span class="ident" id="7906586">testpair</span><span class="op" id="7906594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7906597">//&nbsp;RFC&nbsp;3548&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906619">{</span><span class="string" id="7906620">&#34;\x14\xfb\x9c\x03\xd9\x7e&#34;</span><span class="op" id="7906646">,</span>&nbsp;<span class="string" id="7906648">&#34;FPucA9l+&#34;</span><span class="op" id="7906658">}</span><span class="op" id="7906659">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906662">{</span><span class="string" id="7906663">&#34;\x14\xfb\x9c\x03\xd9&#34;</span><span class="op" id="7906685">,</span>&nbsp;<span class="string" id="7906687">&#34;FPucA9k=&#34;</span><span class="op" id="7906697">}</span><span class="op" id="7906698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906701">{</span><span class="string" id="7906702">&#34;\x14\xfb\x9c\x03&#34;</span><span class="op" id="7906720">,</span>&nbsp;<span class="string" id="7906722">&#34;FPucAw==&#34;</span><span class="op" id="7906732">}</span><span class="op" id="7906733">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7906737">//&nbsp;RFC&nbsp;4648&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906759">{</span><span class="string" id="7906760">&#34;&#34;</span><span class="op" id="7906762">,</span>&nbsp;<span class="string" id="7906764">&#34;&#34;</span><span class="op" id="7906766">}</span><span class="op" id="7906767">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906770">{</span><span class="string" id="7906771">&#34;f&#34;</span><span class="op" id="7906774">,</span>&nbsp;<span class="string" id="7906776">&#34;Zg==&#34;</span><span class="op" id="7906782">}</span><span class="op" id="7906783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906786">{</span><span class="string" id="7906787">&#34;fo&#34;</span><span class="op" id="7906791">,</span>&nbsp;<span class="string" id="7906793">&#34;Zm8=&#34;</span><span class="op" id="7906799">}</span><span class="op" id="7906800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906803">{</span><span class="string" id="7906804">&#34;foo&#34;</span><span class="op" id="7906809">,</span>&nbsp;<span class="string" id="7906811">&#34;Zm9v&#34;</span><span class="op" id="7906817">}</span><span class="op" id="7906818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906821">{</span><span class="string" id="7906822">&#34;foob&#34;</span><span class="op" id="7906828">,</span>&nbsp;<span class="string" id="7906830">&#34;Zm9vYg==&#34;</span><span class="op" id="7906840">}</span><span class="op" id="7906841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906844">{</span><span class="string" id="7906845">&#34;fooba&#34;</span><span class="op" id="7906852">,</span>&nbsp;<span class="string" id="7906854">&#34;Zm9vYmE=&#34;</span><span class="op" id="7906864">}</span><span class="op" id="7906865">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906868">{</span><span class="string" id="7906869">&#34;foobar&#34;</span><span class="op" id="7906877">,</span>&nbsp;<span class="string" id="7906879">&#34;Zm9vYmFy&#34;</span><span class="op" id="7906889">}</span><span class="op" id="7906890">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7906894">//&nbsp;Wikipedia&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906917">{</span><span class="string" id="7906918">&#34;sure.&#34;</span><span class="op" id="7906925">,</span>&nbsp;<span class="string" id="7906927">&#34;c3VyZS4=&#34;</span><span class="op" id="7906937">}</span><span class="op" id="7906938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906941">{</span><span class="string" id="7906942">&#34;sure&#34;</span><span class="op" id="7906948">,</span>&nbsp;<span class="string" id="7906950">&#34;c3VyZQ==&#34;</span><span class="op" id="7906960">}</span><span class="op" id="7906961">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906964">{</span><span class="string" id="7906965">&#34;sur&#34;</span><span class="op" id="7906970">,</span>&nbsp;<span class="string" id="7906972">&#34;c3Vy&#34;</span><span class="op" id="7906978">}</span><span class="op" id="7906979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906982">{</span><span class="string" id="7906983">&#34;su&#34;</span><span class="op" id="7906987">,</span>&nbsp;<span class="string" id="7906989">&#34;c3U=&#34;</span><span class="op" id="7906995">}</span><span class="op" id="7906996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906999">{</span><span class="string" id="7907000">&#34;leasure.&#34;</span><span class="op" id="7907010">,</span>&nbsp;<span class="string" id="7907012">&#34;bGVhc3VyZS4=&#34;</span><span class="op" id="7907026">}</span><span class="op" id="7907027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907030">{</span><span class="string" id="7907031">&#34;easure.&#34;</span><span class="op" id="7907040">,</span>&nbsp;<span class="string" id="7907042">&#34;ZWFzdXJlLg==&#34;</span><span class="op" id="7907056">}</span><span class="op" id="7907057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907060">{</span><span class="string" id="7907061">&#34;asure.&#34;</span><span class="op" id="7907069">,</span>&nbsp;<span class="string" id="7907071">&#34;YXN1cmUu&#34;</span><span class="op" id="7907081">}</span><span class="op" id="7907082">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907085">{</span><span class="string" id="7907086">&#34;sure.&#34;</span><span class="op" id="7907093">,</span>&nbsp;<span class="string" id="7907095">&#34;c3VyZS4=&#34;</span><span class="op" id="7907105">}</span><span class="op" id="7907106">,</span><br>
<span class="lineno"></span><span class="op" id="7907108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7907111">var</span>&nbsp;<span class="ident" id="7907115">bigtest</span>&nbsp;<span class="op" id="7907123">=</span>&nbsp;<span class="ident" id="7907125">testpair</span><span class="op" id="7907133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7907136">&#34;Twas&nbsp;brillig,&nbsp;and&nbsp;the&nbsp;slithy&nbsp;toves&#34;</span><span class="op" id="7907172">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7907175">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="7907225">,</span><br>
<span class="lineno"></span><span class="op" id="7907227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7907230">func</span>&nbsp;<span class="ident" id="7907235">testEqual</span><span class="op" id="7907244">(</span><span class="ident" id="7907245">t</span>&nbsp;<span class="op" id="7907247">*</span><span class="ident" id="7907248">testing</span><span class="op" id="7907255">.</span><span class="ident" id="7907256">T</span><span class="op" id="7907257">,</span>&nbsp;<span class="ident" id="7907259">msg</span>&nbsp;<span class="builtintype" id="7907263">string</span><span class="op" id="7907269">,</span>&nbsp;<span class="ident" id="7907271">args</span>&nbsp;<span class="op" id="7907276">...</span><span class="keyword" id="7907279">interface</span><span class="op" id="7907288">{</span><span class="op" id="7907289">}</span><span class="op" id="7907290">)</span>&nbsp;<span class="builtintype" id="7907292">bool</span>&nbsp;<span class="op" id="7907297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907300">if</span>&nbsp;<span class="ident" id="7907303">args</span><span class="op" id="7907307">[</span><span class="builtinfunc" id="7907308">len</span><span class="op" id="7907311">(</span><span class="ident" id="7907312">args</span><span class="op" id="7907316">)</span><span class="op" id="7907317">-</span><span class="num" id="7907318">2</span><span class="op" id="7907319">]</span>&nbsp;<span class="op" id="7907321">!=</span>&nbsp;<span class="ident" id="7907324">args</span><span class="op" id="7907328">[</span><span class="builtinfunc" id="7907329">len</span><span class="op" id="7907332">(</span><span class="ident" id="7907333">args</span><span class="op" id="7907337">)</span><span class="op" id="7907338">-</span><span class="num" id="7907339">1</span><span class="op" id="7907340">]</span>&nbsp;<span class="op" id="7907342">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907346">t</span><span class="op" id="7907347">.</span><span class="ident" id="7907348">Errorf</span><span class="op" id="7907354">(</span><span class="ident" id="7907355">msg</span><span class="op" id="7907358">,</span>&nbsp;<span class="ident" id="7907360">args</span><span class="op" id="7907364">...</span><span class="op" id="7907367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907371">return</span>&nbsp;<span class="builtintype" id="7907378">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907388">return</span>&nbsp;<span class="builtintype" id="7907395">true</span><br>
<span class="lineno"></span><span class="op" id="7907400">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="7907403">func</span>&nbsp;<span class="ident" id="7907408">TestEncode</span><span class="op" id="7907418">(</span><span class="ident" id="7907419">t</span>&nbsp;<span class="op" id="7907421">*</span><span class="ident" id="7907422">testing</span><span class="op" id="7907429">.</span><span class="ident" id="7907430">T</span><span class="op" id="7907431">)</span>&nbsp;<span class="op" id="7907433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907436">for</span>&nbsp;<span class="ident" id="7907440">_</span><span class="op" id="7907441">,</span>&nbsp;<span class="ident" id="7907443">p</span>&nbsp;<span class="op" id="7907445">:=</span>&nbsp;<span class="keyword" id="7907448">range</span>&nbsp;<span class="ident" id="7907454">pairs</span>&nbsp;<span class="op" id="7907460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907464">got</span>&nbsp;<span class="op" id="7907468">:=</span>&nbsp;<span class="ident" id="7907471">StdEncoding</span><span class="op" id="7907482">.</span><span class="ident" id="7907483">EncodeToString</span><span class="op" id="7907497">(</span><span class="op" id="7907498">[</span><span class="op" id="7907499">]</span><span class="builtintype" id="7907500">byte</span><span class="op" id="7907504">(</span><span class="ident" id="7907505">p</span><span class="op" id="7907506">.</span><span class="ident" id="7907507">decoded</span><span class="op" id="7907514">)</span><span class="op" id="7907515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907519">testEqual</span><span class="op" id="7907528">(</span><span class="ident" id="7907529">t</span><span class="op" id="7907530">,</span>&nbsp;<span class="string" id="7907532">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7907558">,</span>&nbsp;<span class="ident" id="7907560">p</span><span class="op" id="7907561">.</span><span class="ident" id="7907562">decoded</span><span class="op" id="7907569">,</span>&nbsp;<span class="ident" id="7907571">got</span><span class="op" id="7907574">,</span>&nbsp;<span class="ident" id="7907576">p</span><span class="op" id="7907577">.</span><span class="ident" id="7907578">encoded</span><span class="op" id="7907585">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907588">}</span><br>
<span class="lineno"></span><span class="op" id="7907590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7907593">func</span>&nbsp;<span class="ident" id="7907598">TestEncoder</span><span class="op" id="7907609">(</span><span class="ident" id="7907610">t</span>&nbsp;<span class="op" id="7907612">*</span><span class="ident" id="7907613">testing</span><span class="op" id="7907620">.</span><span class="ident" id="7907621">T</span><span class="op" id="7907622">)</span>&nbsp;<span class="op" id="7907624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907627">for</span>&nbsp;<span class="ident" id="7907631">_</span><span class="op" id="7907632">,</span>&nbsp;<span class="ident" id="7907634">p</span>&nbsp;<span class="op" id="7907636">:=</span>&nbsp;<span class="keyword" id="7907639">range</span>&nbsp;<span class="ident" id="7907645">pairs</span>&nbsp;<span class="op" id="7907651">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907655">bb</span>&nbsp;<span class="op" id="7907658">:=</span>&nbsp;<span class="op" id="7907661">&amp;</span><span class="ident" id="7907662">bytes</span><span class="op" id="7907667">.</span><span class="ident" id="7907668">Buffer</span><span class="op" id="7907674">{</span><span class="op" id="7907675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907679">encoder</span>&nbsp;<span class="op" id="7907687">:=</span>&nbsp;<span class="ident" id="7907690">NewEncoder</span><span class="op" id="7907700">(</span><span class="ident" id="7907701">StdEncoding</span><span class="op" id="7907712">,</span>&nbsp;<span class="ident" id="7907714">bb</span><span class="op" id="7907716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907720">encoder</span><span class="op" id="7907727">.</span><span class="ident" id="7907728">Write</span><span class="op" id="7907733">(</span><span class="op" id="7907734">[</span><span class="op" id="7907735">]</span><span class="builtintype" id="7907736">byte</span><span class="op" id="7907740">(</span><span class="ident" id="7907741">p</span><span class="op" id="7907742">.</span><span class="ident" id="7907743">decoded</span><span class="op" id="7907750">)</span><span class="op" id="7907751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907755">encoder</span><span class="op" id="7907762">.</span><span class="ident" id="7907763">Close</span><span class="op" id="7907768">(</span><span class="op" id="7907769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907773">testEqual</span><span class="op" id="7907782">(</span><span class="ident" id="7907783">t</span><span class="op" id="7907784">,</span>&nbsp;<span class="string" id="7907786">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7907812">,</span>&nbsp;<span class="ident" id="7907814">p</span><span class="op" id="7907815">.</span><span class="ident" id="7907816">decoded</span><span class="op" id="7907823">,</span>&nbsp;<span class="ident" id="7907825">bb</span><span class="op" id="7907827">.</span><span class="ident" id="7907828">String</span><span class="op" id="7907834">(</span><span class="op" id="7907835">)</span><span class="op" id="7907836">,</span>&nbsp;<span class="ident" id="7907838">p</span><span class="op" id="7907839">.</span><span class="ident" id="7907840">encoded</span><span class="op" id="7907847">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907850">}</span><br>
<span class="lineno"></span><span class="op" id="7907852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7907855">func</span>&nbsp;<span class="ident" id="7907860">TestEncoderBuffering</span><span class="op" id="7907880">(</span><span class="ident" id="7907881">t</span>&nbsp;<span class="op" id="7907883">*</span><span class="ident" id="7907884">testing</span><span class="op" id="7907891">.</span><span class="ident" id="7907892">T</span><span class="op" id="7907893">)</span>&nbsp;<span class="op" id="7907895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907898">input</span>&nbsp;<span class="op" id="7907904">:=</span>&nbsp;<span class="op" id="7907907">[</span><span class="op" id="7907908">]</span><span class="builtintype" id="7907909">byte</span><span class="op" id="7907913">(</span><span class="ident" id="7907914">bigtest</span><span class="op" id="7907921">.</span><span class="ident" id="7907922">decoded</span><span class="op" id="7907929">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907932">for</span>&nbsp;<span class="ident" id="7907936">bs</span>&nbsp;<span class="op" id="7907939">:=</span>&nbsp;<span class="num" id="7907942">1</span><span class="op" id="7907943">;</span>&nbsp;<span class="ident" id="7907945">bs</span>&nbsp;<span class="op" id="7907948">&lt;=</span>&nbsp;<span class="num" id="7907951">12</span><span class="op" id="7907953">;</span>&nbsp;<span class="ident" id="7907955">bs</span><span class="op" id="7907957">++</span>&nbsp;<span class="op" id="7907960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907964">bb</span>&nbsp;<span class="op" id="7907967">:=</span>&nbsp;<span class="op" id="7907970">&amp;</span><span class="ident" id="7907971">bytes</span><span class="op" id="7907976">.</span><span class="ident" id="7907977">Buffer</span><span class="op" id="7907983">{</span><span class="op" id="7907984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907988">encoder</span>&nbsp;<span class="op" id="7907996">:=</span>&nbsp;<span class="ident" id="7907999">NewEncoder</span><span class="op" id="7908009">(</span><span class="ident" id="7908010">StdEncoding</span><span class="op" id="7908021">,</span>&nbsp;<span class="ident" id="7908023">bb</span><span class="op" id="7908025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908029">for</span>&nbsp;<span class="ident" id="7908033">pos</span>&nbsp;<span class="op" id="7908037">:=</span>&nbsp;<span class="num" id="7908040">0</span><span class="op" id="7908041">;</span>&nbsp;<span class="ident" id="7908043">pos</span>&nbsp;<span class="op" id="7908047">&lt;</span>&nbsp;<span class="builtinfunc" id="7908049">len</span><span class="op" id="7908052">(</span><span class="ident" id="7908053">input</span><span class="op" id="7908058">)</span><span class="op" id="7908059">;</span>&nbsp;<span class="ident" id="7908061">pos</span>&nbsp;<span class="op" id="7908065">+=</span>&nbsp;<span class="ident" id="7908068">bs</span>&nbsp;<span class="op" id="7908071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908076">end</span>&nbsp;<span class="op" id="7908080">:=</span>&nbsp;<span class="ident" id="7908083">pos</span>&nbsp;<span class="op" id="7908087">+</span>&nbsp;<span class="ident" id="7908089">bs</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908095">if</span>&nbsp;<span class="ident" id="7908098">end</span>&nbsp;<span class="op" id="7908102">&gt;</span>&nbsp;<span class="builtinfunc" id="7908104">len</span><span class="op" id="7908107">(</span><span class="ident" id="7908108">input</span><span class="op" id="7908113">)</span>&nbsp;<span class="op" id="7908115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908121">end</span>&nbsp;<span class="op" id="7908125">=</span>&nbsp;<span class="builtinfunc" id="7908127">len</span><span class="op" id="7908130">(</span><span class="ident" id="7908131">input</span><span class="op" id="7908136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908146">n</span><span class="op" id="7908147">,</span>&nbsp;<span class="ident" id="7908149">err</span>&nbsp;<span class="op" id="7908153">:=</span>&nbsp;<span class="ident" id="7908156">encoder</span><span class="op" id="7908163">.</span><span class="ident" id="7908164">Write</span><span class="op" id="7908169">(</span><span class="ident" id="7908170">input</span><span class="op" id="7908175">[</span><span class="ident" id="7908176">pos</span><span class="op" id="7908179">:</span><span class="ident" id="7908180">end</span><span class="op" id="7908183">]</span><span class="op" id="7908184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908189">testEqual</span><span class="op" id="7908198">(</span><span class="ident" id="7908199">t</span><span class="op" id="7908200">,</span>&nbsp;<span class="string" id="7908202">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7908236">,</span>&nbsp;<span class="ident" id="7908238">input</span><span class="op" id="7908243">[</span><span class="ident" id="7908244">pos</span><span class="op" id="7908247">:</span><span class="ident" id="7908248">end</span><span class="op" id="7908251">]</span><span class="op" id="7908252">,</span>&nbsp;<span class="ident" id="7908254">err</span><span class="op" id="7908257">,</span>&nbsp;<span class="builtintype" id="7908259">error</span><span class="op" id="7908264">(</span><span class="ident" id="7908265">nil</span><span class="op" id="7908268">)</span><span class="op" id="7908269">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908274">testEqual</span><span class="op" id="7908283">(</span><span class="ident" id="7908284">t</span><span class="op" id="7908285">,</span>&nbsp;<span class="string" id="7908287">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7908322">,</span>&nbsp;<span class="ident" id="7908324">input</span><span class="op" id="7908329">[</span><span class="ident" id="7908330">pos</span><span class="op" id="7908333">:</span><span class="ident" id="7908334">end</span><span class="op" id="7908337">]</span><span class="op" id="7908338">,</span>&nbsp;<span class="ident" id="7908340">n</span><span class="op" id="7908341">,</span>&nbsp;<span class="ident" id="7908343">end</span><span class="op" id="7908346">-</span><span class="ident" id="7908347">pos</span><span class="op" id="7908350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908358">err</span>&nbsp;<span class="op" id="7908362">:=</span>&nbsp;<span class="ident" id="7908365">encoder</span><span class="op" id="7908372">.</span><span class="ident" id="7908373">Close</span><span class="op" id="7908378">(</span><span class="op" id="7908379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908383">testEqual</span><span class="op" id="7908392">(</span><span class="ident" id="7908393">t</span><span class="op" id="7908394">,</span>&nbsp;<span class="string" id="7908396">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7908426">,</span>&nbsp;<span class="ident" id="7908428">err</span><span class="op" id="7908431">,</span>&nbsp;<span class="builtintype" id="7908433">error</span><span class="op" id="7908438">(</span><span class="ident" id="7908439">nil</span><span class="op" id="7908442">)</span><span class="op" id="7908443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908447">testEqual</span><span class="op" id="7908456">(</span><span class="ident" id="7908457">t</span><span class="op" id="7908458">,</span>&nbsp;<span class="string" id="7908460">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7908493">,</span>&nbsp;<span class="ident" id="7908495">bs</span><span class="op" id="7908497">,</span>&nbsp;<span class="ident" id="7908499">bigtest</span><span class="op" id="7908506">.</span><span class="ident" id="7908507">decoded</span><span class="op" id="7908514">,</span>&nbsp;<span class="ident" id="7908516">bb</span><span class="op" id="7908518">.</span><span class="ident" id="7908519">String</span><span class="op" id="7908525">(</span><span class="op" id="7908526">)</span><span class="op" id="7908527">,</span>&nbsp;<span class="ident" id="7908529">bigtest</span><span class="op" id="7908536">.</span><span class="ident" id="7908537">encoded</span><span class="op" id="7908544">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908547">}</span><br>
<span class="lineno"></span><span class="op" id="7908549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7908552">func</span>&nbsp;<span class="ident" id="7908557">TestDecode</span><span class="op" id="7908567">(</span><span class="ident" id="7908568">t</span>&nbsp;<span class="op" id="7908570">*</span><span class="ident" id="7908571">testing</span><span class="op" id="7908578">.</span><span class="ident" id="7908579">T</span><span class="op" id="7908580">)</span>&nbsp;<span class="op" id="7908582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908585">for</span>&nbsp;<span class="ident" id="7908589">_</span><span class="op" id="7908590">,</span>&nbsp;<span class="ident" id="7908592">p</span>&nbsp;<span class="op" id="7908594">:=</span>&nbsp;<span class="keyword" id="7908597">range</span>&nbsp;<span class="ident" id="7908603">pairs</span>&nbsp;<span class="op" id="7908609">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908613">dbuf</span>&nbsp;<span class="op" id="7908618">:=</span>&nbsp;<span class="builtinfunc" id="7908621">make</span><span class="op" id="7908625">(</span><span class="op" id="7908626">[</span><span class="op" id="7908627">]</span><span class="builtintype" id="7908628">byte</span><span class="op" id="7908632">,</span>&nbsp;<span class="ident" id="7908634">StdEncoding</span><span class="op" id="7908645">.</span><span class="ident" id="7908646">DecodedLen</span><span class="op" id="7908656">(</span><span class="builtinfunc" id="7908657">len</span><span class="op" id="7908660">(</span><span class="ident" id="7908661">p</span><span class="op" id="7908662">.</span><span class="ident" id="7908663">encoded</span><span class="op" id="7908670">)</span><span class="op" id="7908671">)</span><span class="op" id="7908672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908676">count</span><span class="op" id="7908681">,</span>&nbsp;<span class="ident" id="7908683">end</span><span class="op" id="7908686">,</span>&nbsp;<span class="ident" id="7908688">err</span>&nbsp;<span class="op" id="7908692">:=</span>&nbsp;<span class="ident" id="7908695">StdEncoding</span><span class="op" id="7908706">.</span><span class="ident" id="7908707">decode</span><span class="op" id="7908713">(</span><span class="ident" id="7908714">dbuf</span><span class="op" id="7908718">,</span>&nbsp;<span class="op" id="7908720">[</span><span class="op" id="7908721">]</span><span class="builtintype" id="7908722">byte</span><span class="op" id="7908726">(</span><span class="ident" id="7908727">p</span><span class="op" id="7908728">.</span><span class="ident" id="7908729">encoded</span><span class="op" id="7908736">)</span><span class="op" id="7908737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908741">testEqual</span><span class="op" id="7908750">(</span><span class="ident" id="7908751">t</span><span class="op" id="7908752">,</span>&nbsp;<span class="string" id="7908754">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7908786">,</span>&nbsp;<span class="ident" id="7908788">p</span><span class="op" id="7908789">.</span><span class="ident" id="7908790">encoded</span><span class="op" id="7908797">,</span>&nbsp;<span class="ident" id="7908799">err</span><span class="op" id="7908802">,</span>&nbsp;<span class="builtintype" id="7908804">error</span><span class="op" id="7908809">(</span><span class="ident" id="7908810">nil</span><span class="op" id="7908813">)</span><span class="op" id="7908814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908818">testEqual</span><span class="op" id="7908827">(</span><span class="ident" id="7908828">t</span><span class="op" id="7908829">,</span>&nbsp;<span class="string" id="7908831">&#34;Decode(%q)&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7908864">,</span>&nbsp;<span class="ident" id="7908866">p</span><span class="op" id="7908867">.</span><span class="ident" id="7908868">encoded</span><span class="op" id="7908875">,</span>&nbsp;<span class="ident" id="7908877">count</span><span class="op" id="7908882">,</span>&nbsp;<span class="builtinfunc" id="7908884">len</span><span class="op" id="7908887">(</span><span class="ident" id="7908888">p</span><span class="op" id="7908889">.</span><span class="ident" id="7908890">decoded</span><span class="op" id="7908897">)</span><span class="op" id="7908898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908902">if</span>&nbsp;<span class="builtinfunc" id="7908905">len</span><span class="op" id="7908908">(</span><span class="ident" id="7908909">p</span><span class="op" id="7908910">.</span><span class="ident" id="7908911">encoded</span><span class="op" id="7908918">)</span>&nbsp;<span class="op" id="7908920">&gt;</span>&nbsp;<span class="num" id="7908922">0</span>&nbsp;<span class="op" id="7908924">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908929">testEqual</span><span class="op" id="7908938">(</span><span class="ident" id="7908939">t</span><span class="op" id="7908940">,</span>&nbsp;<span class="string" id="7908942">&#34;Decode(%q)&nbsp;=&nbsp;end&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7908972">,</span>&nbsp;<span class="ident" id="7908974">p</span><span class="op" id="7908975">.</span><span class="ident" id="7908976">encoded</span><span class="op" id="7908983">,</span>&nbsp;<span class="ident" id="7908985">end</span><span class="op" id="7908988">,</span>&nbsp;<span class="op" id="7908990">(</span><span class="ident" id="7908991">p</span><span class="op" id="7908992">.</span><span class="ident" id="7908993">encoded</span><span class="op" id="7909000">[</span><span class="builtinfunc" id="7909001">len</span><span class="op" id="7909004">(</span><span class="ident" id="7909005">p</span><span class="op" id="7909006">.</span><span class="ident" id="7909007">encoded</span><span class="op" id="7909014">)</span><span class="op" id="7909015">-</span><span class="num" id="7909016">1</span><span class="op" id="7909017">]</span>&nbsp;<span class="op" id="7909019">==</span>&nbsp;<span class="string" id="7909022">&#39;=&#39;</span><span class="op" id="7909025">)</span><span class="op" id="7909026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909034">testEqual</span><span class="op" id="7909043">(</span><span class="ident" id="7909044">t</span><span class="op" id="7909045">,</span>&nbsp;<span class="string" id="7909047">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7909073">,</span>&nbsp;<span class="ident" id="7909075">p</span><span class="op" id="7909076">.</span><span class="ident" id="7909077">encoded</span><span class="op" id="7909084">,</span>&nbsp;<span class="builtintype" id="7909086">string</span><span class="op" id="7909092">(</span><span class="ident" id="7909093">dbuf</span><span class="op" id="7909097">[</span><span class="num" id="7909098">0</span><span class="op" id="7909099">:</span><span class="ident" id="7909100">count</span><span class="op" id="7909105">]</span><span class="op" id="7909106">)</span><span class="op" id="7909107">,</span>&nbsp;<span class="ident" id="7909109">p</span><span class="op" id="7909110">.</span><span class="ident" id="7909111">decoded</span><span class="op" id="7909118">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909123">dbuf</span><span class="op" id="7909127">,</span>&nbsp;<span class="ident" id="7909129">err</span>&nbsp;<span class="op" id="7909133">=</span>&nbsp;<span class="ident" id="7909135">StdEncoding</span><span class="op" id="7909146">.</span><span class="ident" id="7909147">DecodeString</span><span class="op" id="7909159">(</span><span class="ident" id="7909160">p</span><span class="op" id="7909161">.</span><span class="ident" id="7909162">encoded</span><span class="op" id="7909169">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909173">testEqual</span><span class="op" id="7909182">(</span><span class="ident" id="7909183">t</span><span class="op" id="7909184">,</span>&nbsp;<span class="string" id="7909186">&#34;DecodeString(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7909224">,</span>&nbsp;<span class="ident" id="7909226">p</span><span class="op" id="7909227">.</span><span class="ident" id="7909228">encoded</span><span class="op" id="7909235">,</span>&nbsp;<span class="ident" id="7909237">err</span><span class="op" id="7909240">,</span>&nbsp;<span class="builtintype" id="7909242">error</span><span class="op" id="7909247">(</span><span class="ident" id="7909248">nil</span><span class="op" id="7909251">)</span><span class="op" id="7909252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909256">testEqual</span><span class="op" id="7909265">(</span><span class="ident" id="7909266">t</span><span class="op" id="7909267">,</span>&nbsp;<span class="string" id="7909269">&#34;DecodeString(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7909301">,</span>&nbsp;<span class="builtintype" id="7909303">string</span><span class="op" id="7909309">(</span><span class="ident" id="7909310">dbuf</span><span class="op" id="7909314">)</span><span class="op" id="7909315">,</span>&nbsp;<span class="ident" id="7909317">p</span><span class="op" id="7909318">.</span><span class="ident" id="7909319">decoded</span><span class="op" id="7909326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909329">}</span><br>
<span class="lineno"></span><span class="op" id="7909331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="7909334">func</span>&nbsp;<span class="ident" id="7909339">TestDecoder</span><span class="op" id="7909350">(</span><span class="ident" id="7909351">t</span>&nbsp;<span class="op" id="7909353">*</span><span class="ident" id="7909354">testing</span><span class="op" id="7909361">.</span><span class="ident" id="7909362">T</span><span class="op" id="7909363">)</span>&nbsp;<span class="op" id="7909365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909368">for</span>&nbsp;<span class="ident" id="7909372">_</span><span class="op" id="7909373">,</span>&nbsp;<span class="ident" id="7909375">p</span>&nbsp;<span class="op" id="7909377">:=</span>&nbsp;<span class="keyword" id="7909380">range</span>&nbsp;<span class="ident" id="7909386">pairs</span>&nbsp;<span class="op" id="7909392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909396">decoder</span>&nbsp;<span class="op" id="7909404">:=</span>&nbsp;<span class="ident" id="7909407">NewDecoder</span><span class="op" id="7909417">(</span><span class="ident" id="7909418">StdEncoding</span><span class="op" id="7909429">,</span>&nbsp;<span class="ident" id="7909431">strings</span><span class="op" id="7909438">.</span><span class="ident" id="7909439">NewReader</span><span class="op" id="7909448">(</span><span class="ident" id="7909449">p</span><span class="op" id="7909450">.</span><span class="ident" id="7909451">encoded</span><span class="op" id="7909458">)</span><span class="op" id="7909459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909463">dbuf</span>&nbsp;<span class="op" id="7909468">:=</span>&nbsp;<span class="builtinfunc" id="7909471">make</span><span class="op" id="7909475">(</span><span class="op" id="7909476">[</span><span class="op" id="7909477">]</span><span class="builtintype" id="7909478">byte</span><span class="op" id="7909482">,</span>&nbsp;<span class="ident" id="7909484">StdEncoding</span><span class="op" id="7909495">.</span><span class="ident" id="7909496">DecodedLen</span><span class="op" id="7909506">(</span><span class="builtinfunc" id="7909507">len</span><span class="op" id="7909510">(</span><span class="ident" id="7909511">p</span><span class="op" id="7909512">.</span><span class="ident" id="7909513">encoded</span><span class="op" id="7909520">)</span><span class="op" id="7909521">)</span><span class="op" id="7909522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909526">count</span><span class="op" id="7909531">,</span>&nbsp;<span class="ident" id="7909533">err</span>&nbsp;<span class="op" id="7909537">:=</span>&nbsp;<span class="ident" id="7909540">decoder</span><span class="op" id="7909547">.</span><span class="ident" id="7909548">Read</span><span class="op" id="7909552">(</span><span class="ident" id="7909553">dbuf</span><span class="op" id="7909557">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909561">if</span>&nbsp;<span class="ident" id="7909564">err</span>&nbsp;<span class="op" id="7909568">!=</span>&nbsp;<span class="ident" id="7909571">nil</span>&nbsp;<span class="op" id="7909575">&amp;&amp;</span>&nbsp;<span class="ident" id="7909578">err</span>&nbsp;<span class="op" id="7909582">!=</span>&nbsp;<span class="ident" id="7909585">io</span><span class="op" id="7909587">.</span><span class="ident" id="7909588">EOF</span>&nbsp;<span class="op" id="7909592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909597">t</span><span class="op" id="7909598">.</span><span class="ident" id="7909599">Fatal</span><span class="op" id="7909604">(</span><span class="string" id="7909605">&#34;Read&nbsp;failed&#34;</span><span class="op" id="7909618">,</span>&nbsp;<span class="ident" id="7909620">err</span><span class="op" id="7909623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909631">testEqual</span><span class="op" id="7909640">(</span><span class="ident" id="7909641">t</span><span class="op" id="7909642">,</span>&nbsp;<span class="string" id="7909644">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7909679">,</span>&nbsp;<span class="ident" id="7909681">p</span><span class="op" id="7909682">.</span><span class="ident" id="7909683">encoded</span><span class="op" id="7909690">,</span>&nbsp;<span class="ident" id="7909692">count</span><span class="op" id="7909697">,</span>&nbsp;<span class="builtinfunc" id="7909699">len</span><span class="op" id="7909702">(</span><span class="ident" id="7909703">p</span><span class="op" id="7909704">.</span><span class="ident" id="7909705">decoded</span><span class="op" id="7909712">)</span><span class="op" id="7909713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909717">testEqual</span><span class="op" id="7909726">(</span><span class="ident" id="7909727">t</span><span class="op" id="7909728">,</span>&nbsp;<span class="string" id="7909730">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7909760">,</span>&nbsp;<span class="ident" id="7909762">p</span><span class="op" id="7909763">.</span><span class="ident" id="7909764">encoded</span><span class="op" id="7909771">,</span>&nbsp;<span class="builtintype" id="7909773">string</span><span class="op" id="7909779">(</span><span class="ident" id="7909780">dbuf</span><span class="op" id="7909784">[</span><span class="num" id="7909785">0</span><span class="op" id="7909786">:</span><span class="ident" id="7909787">count</span><span class="op" id="7909792">]</span><span class="op" id="7909793">)</span><span class="op" id="7909794">,</span>&nbsp;<span class="ident" id="7909796">p</span><span class="op" id="7909797">.</span><span class="ident" id="7909798">decoded</span><span class="op" id="7909805">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909809">if</span>&nbsp;<span class="ident" id="7909812">err</span>&nbsp;<span class="op" id="7909816">!=</span>&nbsp;<span class="ident" id="7909819">io</span><span class="op" id="7909821">.</span><span class="ident" id="7909822">EOF</span>&nbsp;<span class="op" id="7909826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909831">count</span><span class="op" id="7909836">,</span>&nbsp;<span class="ident" id="7909838">err</span>&nbsp;<span class="op" id="7909842">=</span>&nbsp;<span class="ident" id="7909844">decoder</span><span class="op" id="7909851">.</span><span class="ident" id="7909852">Read</span><span class="op" id="7909856">(</span><span class="ident" id="7909857">dbuf</span><span class="op" id="7909861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909869">testEqual</span><span class="op" id="7909878">(</span><span class="ident" id="7909879">t</span><span class="op" id="7909880">,</span>&nbsp;<span class="string" id="7909882">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7909910">,</span>&nbsp;<span class="ident" id="7909912">p</span><span class="op" id="7909913">.</span><span class="ident" id="7909914">encoded</span><span class="op" id="7909921">,</span>&nbsp;<span class="ident" id="7909923">err</span><span class="op" id="7909926">,</span>&nbsp;<span class="ident" id="7909928">io</span><span class="op" id="7909930">.</span><span class="ident" id="7909931">EOF</span><span class="op" id="7909934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909937">}</span><br>
<span class="lineno">130</span><span class="op" id="7909939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7909942">func</span>&nbsp;<span class="ident" id="7909947">TestDecoderBuffering</span><span class="op" id="7909967">(</span><span class="ident" id="7909968">t</span>&nbsp;<span class="op" id="7909970">*</span><span class="ident" id="7909971">testing</span><span class="op" id="7909978">.</span><span class="ident" id="7909979">T</span><span class="op" id="7909980">)</span>&nbsp;<span class="op" id="7909982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909985">for</span>&nbsp;<span class="ident" id="7909989">bs</span>&nbsp;<span class="op" id="7909992">:=</span>&nbsp;<span class="num" id="7909995">1</span><span class="op" id="7909996">;</span>&nbsp;<span class="ident" id="7909998">bs</span>&nbsp;<span class="op" id="7910001">&lt;=</span>&nbsp;<span class="num" id="7910004">12</span><span class="op" id="7910006">;</span>&nbsp;<span class="ident" id="7910008">bs</span><span class="op" id="7910010">++</span>&nbsp;<span class="op" id="7910013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910017">decoder</span>&nbsp;<span class="op" id="7910025">:=</span>&nbsp;<span class="ident" id="7910028">NewDecoder</span><span class="op" id="7910038">(</span><span class="ident" id="7910039">StdEncoding</span><span class="op" id="7910050">,</span>&nbsp;<span class="ident" id="7910052">strings</span><span class="op" id="7910059">.</span><span class="ident" id="7910060">NewReader</span><span class="op" id="7910069">(</span><span class="ident" id="7910070">bigtest</span><span class="op" id="7910077">.</span><span class="ident" id="7910078">encoded</span><span class="op" id="7910085">)</span><span class="op" id="7910086">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910090">buf</span>&nbsp;<span class="op" id="7910094">:=</span>&nbsp;<span class="builtinfunc" id="7910097">make</span><span class="op" id="7910101">(</span><span class="op" id="7910102">[</span><span class="op" id="7910103">]</span><span class="builtintype" id="7910104">byte</span><span class="op" id="7910108">,</span>&nbsp;<span class="builtinfunc" id="7910110">len</span><span class="op" id="7910113">(</span><span class="ident" id="7910114">bigtest</span><span class="op" id="7910121">.</span><span class="ident" id="7910122">decoded</span><span class="op" id="7910129">)</span><span class="op" id="7910130">+</span><span class="num" id="7910131">12</span><span class="op" id="7910133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910137">var</span>&nbsp;<span class="ident" id="7910141">total</span>&nbsp;<span class="builtintype" id="7910147">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910153">for</span>&nbsp;<span class="ident" id="7910157">total</span>&nbsp;<span class="op" id="7910163">=</span>&nbsp;<span class="num" id="7910165">0</span><span class="op" id="7910166">;</span>&nbsp;<span class="ident" id="7910168">total</span>&nbsp;<span class="op" id="7910174">&lt;</span>&nbsp;<span class="builtinfunc" id="7910176">len</span><span class="op" id="7910179">(</span><span class="ident" id="7910180">bigtest</span><span class="op" id="7910187">.</span><span class="ident" id="7910188">decoded</span><span class="op" id="7910195">)</span><span class="op" id="7910196">;</span>&nbsp;<span class="op" id="7910198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910203">n</span><span class="op" id="7910204">,</span>&nbsp;<span class="ident" id="7910206">err</span>&nbsp;<span class="op" id="7910210">:=</span>&nbsp;<span class="ident" id="7910213">decoder</span><span class="op" id="7910220">.</span><span class="ident" id="7910221">Read</span><span class="op" id="7910225">(</span><span class="ident" id="7910226">buf</span><span class="op" id="7910229">[</span><span class="ident" id="7910230">total</span>&nbsp;<span class="op" id="7910236">:</span>&nbsp;<span class="ident" id="7910238">total</span><span class="op" id="7910243">+</span><span class="ident" id="7910244">bs</span><span class="op" id="7910246">]</span><span class="op" id="7910247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910252">testEqual</span><span class="op" id="7910261">(</span><span class="ident" id="7910262">t</span><span class="op" id="7910263">,</span>&nbsp;<span class="string" id="7910265">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7910310">,</span>&nbsp;<span class="ident" id="7910312">bigtest</span><span class="op" id="7910319">.</span><span class="ident" id="7910320">encoded</span><span class="op" id="7910327">,</span>&nbsp;<span class="ident" id="7910329">total</span><span class="op" id="7910334">,</span>&nbsp;<span class="ident" id="7910336">n</span><span class="op" id="7910337">,</span>&nbsp;<span class="ident" id="7910339">err</span><span class="op" id="7910342">,</span>&nbsp;<span class="builtintype" id="7910344">error</span><span class="op" id="7910349">(</span><span class="ident" id="7910350">nil</span><span class="op" id="7910353">)</span><span class="op" id="7910354">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910359">total</span>&nbsp;<span class="op" id="7910365">+=</span>&nbsp;<span class="ident" id="7910368">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910376">testEqual</span><span class="op" id="7910385">(</span><span class="ident" id="7910386">t</span><span class="op" id="7910387">,</span>&nbsp;<span class="string" id="7910389">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7910422">,</span>&nbsp;<span class="ident" id="7910424">bs</span><span class="op" id="7910426">,</span>&nbsp;<span class="ident" id="7910428">bigtest</span><span class="op" id="7910435">.</span><span class="ident" id="7910436">encoded</span><span class="op" id="7910443">,</span>&nbsp;<span class="builtintype" id="7910445">string</span><span class="op" id="7910451">(</span><span class="ident" id="7910452">buf</span><span class="op" id="7910455">[</span><span class="num" id="7910456">0</span><span class="op" id="7910457">:</span><span class="ident" id="7910458">total</span><span class="op" id="7910463">]</span><span class="op" id="7910464">)</span><span class="op" id="7910465">,</span>&nbsp;<span class="ident" id="7910467">bigtest</span><span class="op" id="7910474">.</span><span class="ident" id="7910475">decoded</span><span class="op" id="7910482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910485">}</span><br>
<span class="lineno"></span><span class="op" id="7910487">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="7910490">func</span>&nbsp;<span class="ident" id="7910495">TestDecodeCorrupt</span><span class="op" id="7910512">(</span><span class="ident" id="7910513">t</span>&nbsp;<span class="op" id="7910515">*</span><span class="ident" id="7910516">testing</span><span class="op" id="7910523">.</span><span class="ident" id="7910524">T</span><span class="op" id="7910525">)</span>&nbsp;<span class="op" id="7910527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910530">testCases</span>&nbsp;<span class="op" id="7910540">:=</span>&nbsp;<span class="op" id="7910543">[</span><span class="op" id="7910544">]</span><span class="keyword" id="7910545">struct</span>&nbsp;<span class="op" id="7910552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910556">input</span>&nbsp;&nbsp;<span class="builtintype" id="7910563">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910572">offset</span>&nbsp;<span class="builtintype" id="7910579">int</span>&nbsp;<span class="comment" id="7910583">//&nbsp;-1&nbsp;means&nbsp;no&nbsp;corruption.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910611">}</span><span class="op" id="7910612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910616">{</span><span class="string" id="7910617">&#34;&#34;</span><span class="op" id="7910619">,</span>&nbsp;<span class="op" id="7910621">-</span><span class="num" id="7910622">1</span><span class="op" id="7910623">}</span><span class="op" id="7910624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910628">{</span><span class="string" id="7910629">&#34;!!!!&#34;</span><span class="op" id="7910635">,</span>&nbsp;<span class="num" id="7910637">0</span><span class="op" id="7910638">}</span><span class="op" id="7910639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910643">{</span><span class="string" id="7910644">&#34;====&#34;</span><span class="op" id="7910650">,</span>&nbsp;<span class="num" id="7910652">0</span><span class="op" id="7910653">}</span><span class="op" id="7910654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910658">{</span><span class="string" id="7910659">&#34;x===&#34;</span><span class="op" id="7910665">,</span>&nbsp;<span class="num" id="7910667">1</span><span class="op" id="7910668">}</span><span class="op" id="7910669">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910673">{</span><span class="string" id="7910674">&#34;=AAA&#34;</span><span class="op" id="7910680">,</span>&nbsp;<span class="num" id="7910682">0</span><span class="op" id="7910683">}</span><span class="op" id="7910684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910688">{</span><span class="string" id="7910689">&#34;A=AA&#34;</span><span class="op" id="7910695">,</span>&nbsp;<span class="num" id="7910697">1</span><span class="op" id="7910698">}</span><span class="op" id="7910699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910703">{</span><span class="string" id="7910704">&#34;AA=A&#34;</span><span class="op" id="7910710">,</span>&nbsp;<span class="num" id="7910712">2</span><span class="op" id="7910713">}</span><span class="op" id="7910714">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910718">{</span><span class="string" id="7910719">&#34;AA==A&#34;</span><span class="op" id="7910726">,</span>&nbsp;<span class="num" id="7910728">4</span><span class="op" id="7910729">}</span><span class="op" id="7910730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910734">{</span><span class="string" id="7910735">&#34;AAA=AAAA&#34;</span><span class="op" id="7910745">,</span>&nbsp;<span class="num" id="7910747">4</span><span class="op" id="7910748">}</span><span class="op" id="7910749">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910753">{</span><span class="string" id="7910754">&#34;AAAAA&#34;</span><span class="op" id="7910761">,</span>&nbsp;<span class="num" id="7910763">4</span><span class="op" id="7910764">}</span><span class="op" id="7910765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910769">{</span><span class="string" id="7910770">&#34;AAAAAA&#34;</span><span class="op" id="7910778">,</span>&nbsp;<span class="num" id="7910780">4</span><span class="op" id="7910781">}</span><span class="op" id="7910782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910786">{</span><span class="string" id="7910787">&#34;A=&#34;</span><span class="op" id="7910791">,</span>&nbsp;<span class="num" id="7910793">1</span><span class="op" id="7910794">}</span><span class="op" id="7910795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910799">{</span><span class="string" id="7910800">&#34;A==&#34;</span><span class="op" id="7910805">,</span>&nbsp;<span class="num" id="7910807">1</span><span class="op" id="7910808">}</span><span class="op" id="7910809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910813">{</span><span class="string" id="7910814">&#34;AA=&#34;</span><span class="op" id="7910819">,</span>&nbsp;<span class="num" id="7910821">3</span><span class="op" id="7910822">}</span><span class="op" id="7910823">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910827">{</span><span class="string" id="7910828">&#34;AA==&#34;</span><span class="op" id="7910834">,</span>&nbsp;<span class="op" id="7910836">-</span><span class="num" id="7910837">1</span><span class="op" id="7910838">}</span><span class="op" id="7910839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910843">{</span><span class="string" id="7910844">&#34;AAA=&#34;</span><span class="op" id="7910850">,</span>&nbsp;<span class="op" id="7910852">-</span><span class="num" id="7910853">1</span><span class="op" id="7910854">}</span><span class="op" id="7910855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910859">{</span><span class="string" id="7910860">&#34;AAAA&#34;</span><span class="op" id="7910866">,</span>&nbsp;<span class="op" id="7910868">-</span><span class="num" id="7910869">1</span><span class="op" id="7910870">}</span><span class="op" id="7910871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910875">{</span><span class="string" id="7910876">&#34;AAAAAA=&#34;</span><span class="op" id="7910885">,</span>&nbsp;<span class="num" id="7910887">7</span><span class="op" id="7910888">}</span><span class="op" id="7910889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910893">{</span><span class="string" id="7910894">&#34;YWJjZA=====&#34;</span><span class="op" id="7910907">,</span>&nbsp;<span class="num" id="7910909">8</span><span class="op" id="7910910">}</span><span class="op" id="7910911">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910917">for</span>&nbsp;<span class="ident" id="7910921">_</span><span class="op" id="7910922">,</span>&nbsp;<span class="ident" id="7910924">tc</span>&nbsp;<span class="op" id="7910927">:=</span>&nbsp;<span class="keyword" id="7910930">range</span>&nbsp;<span class="ident" id="7910936">testCases</span>&nbsp;<span class="op" id="7910946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910950">dbuf</span>&nbsp;<span class="op" id="7910955">:=</span>&nbsp;<span class="builtinfunc" id="7910958">make</span><span class="op" id="7910962">(</span><span class="op" id="7910963">[</span><span class="op" id="7910964">]</span><span class="builtintype" id="7910965">byte</span><span class="op" id="7910969">,</span>&nbsp;<span class="ident" id="7910971">StdEncoding</span><span class="op" id="7910982">.</span><span class="ident" id="7910983">DecodedLen</span><span class="op" id="7910993">(</span><span class="builtinfunc" id="7910994">len</span><span class="op" id="7910997">(</span><span class="ident" id="7910998">tc</span><span class="op" id="7911000">.</span><span class="ident" id="7911001">input</span><span class="op" id="7911006">)</span><span class="op" id="7911007">)</span><span class="op" id="7911008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911012">_</span><span class="op" id="7911013">,</span>&nbsp;<span class="ident" id="7911015">err</span>&nbsp;<span class="op" id="7911019">:=</span>&nbsp;<span class="ident" id="7911022">StdEncoding</span><span class="op" id="7911033">.</span><span class="ident" id="7911034">Decode</span><span class="op" id="7911040">(</span><span class="ident" id="7911041">dbuf</span><span class="op" id="7911045">,</span>&nbsp;<span class="op" id="7911047">[</span><span class="op" id="7911048">]</span><span class="builtintype" id="7911049">byte</span><span class="op" id="7911053">(</span><span class="ident" id="7911054">tc</span><span class="op" id="7911056">.</span><span class="ident" id="7911057">input</span><span class="op" id="7911062">)</span><span class="op" id="7911063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911067">if</span>&nbsp;<span class="ident" id="7911070">tc</span><span class="op" id="7911072">.</span><span class="ident" id="7911073">offset</span>&nbsp;<span class="op" id="7911080">==</span>&nbsp;<span class="op" id="7911083">-</span><span class="num" id="7911084">1</span>&nbsp;<span class="op" id="7911086">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911091">if</span>&nbsp;<span class="ident" id="7911094">err</span>&nbsp;<span class="op" id="7911098">!=</span>&nbsp;<span class="ident" id="7911101">nil</span>&nbsp;<span class="op" id="7911105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911111">t</span><span class="op" id="7911112">.</span><span class="ident" id="7911113">Error</span><span class="op" id="7911118">(</span><span class="string" id="7911119">&#34;Decoder&nbsp;wrongly&nbsp;detected&nbsp;coruption&nbsp;in&#34;</span><span class="op" id="7911158">,</span>&nbsp;<span class="ident" id="7911160">tc</span><span class="op" id="7911162">.</span><span class="ident" id="7911163">input</span><span class="op" id="7911168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911178">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911189">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911193">switch</span>&nbsp;<span class="ident" id="7911200">err</span>&nbsp;<span class="op" id="7911204">:=</span>&nbsp;<span class="ident" id="7911207">err</span><span class="op" id="7911210">.</span><span class="op" id="7911211">(</span><span class="keyword" id="7911212">type</span><span class="op" id="7911216">)</span>&nbsp;<span class="op" id="7911218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911222">case</span>&nbsp;<span class="ident" id="7911227">CorruptInputError</span><span class="op" id="7911244">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911249">testEqual</span><span class="op" id="7911258">(</span><span class="ident" id="7911259">t</span><span class="op" id="7911260">,</span>&nbsp;<span class="string" id="7911262">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7911302">,</span>&nbsp;<span class="ident" id="7911304">tc</span><span class="op" id="7911306">.</span><span class="ident" id="7911307">input</span><span class="op" id="7911312">,</span>&nbsp;<span class="builtintype" id="7911314">int</span><span class="op" id="7911317">(</span><span class="ident" id="7911318">err</span><span class="op" id="7911321">)</span><span class="op" id="7911322">,</span>&nbsp;<span class="ident" id="7911324">tc</span><span class="op" id="7911326">.</span><span class="ident" id="7911327">offset</span><span class="op" id="7911333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911337">default</span><span class="op" id="7911344">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911349">t</span><span class="op" id="7911350">.</span><span class="ident" id="7911351">Error</span><span class="op" id="7911356">(</span><span class="string" id="7911357">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="7911397">,</span>&nbsp;<span class="ident" id="7911399">tc</span><span class="op" id="7911401">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911408">}</span><br>
<span class="lineno"></span><span class="op" id="7911410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7911413">func</span>&nbsp;<span class="ident" id="7911418">TestBig</span><span class="op" id="7911425">(</span><span class="ident" id="7911426">t</span>&nbsp;<span class="op" id="7911428">*</span><span class="ident" id="7911429">testing</span><span class="op" id="7911436">.</span><span class="ident" id="7911437">T</span><span class="op" id="7911438">)</span>&nbsp;<span class="op" id="7911440">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911443">n</span>&nbsp;<span class="op" id="7911445">:=</span>&nbsp;<span class="num" id="7911448">3</span><span class="op" id="7911449">*</span><span class="num" id="7911450">1000</span>&nbsp;<span class="op" id="7911455">+</span>&nbsp;<span class="num" id="7911457">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911460">raw</span>&nbsp;<span class="op" id="7911464">:=</span>&nbsp;<span class="builtinfunc" id="7911467">make</span><span class="op" id="7911471">(</span><span class="op" id="7911472">[</span><span class="op" id="7911473">]</span><span class="builtintype" id="7911474">byte</span><span class="op" id="7911478">,</span>&nbsp;<span class="ident" id="7911480">n</span><span class="op" id="7911481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911484">const</span>&nbsp;<span class="ident" id="7911490">alpha</span>&nbsp;<span class="op" id="7911496">=</span>&nbsp;<span class="string" id="7911498">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911564">for</span>&nbsp;<span class="ident" id="7911568">i</span>&nbsp;<span class="op" id="7911570">:=</span>&nbsp;<span class="num" id="7911573">0</span><span class="op" id="7911574">;</span>&nbsp;<span class="ident" id="7911576">i</span>&nbsp;<span class="op" id="7911578">&lt;</span>&nbsp;<span class="ident" id="7911580">n</span><span class="op" id="7911581">;</span>&nbsp;<span class="ident" id="7911583">i</span><span class="op" id="7911584">++</span>&nbsp;<span class="op" id="7911587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911591">raw</span><span class="op" id="7911594">[</span><span class="ident" id="7911595">i</span><span class="op" id="7911596">]</span>&nbsp;<span class="op" id="7911598">=</span>&nbsp;<span class="ident" id="7911600">alpha</span><span class="op" id="7911605">[</span><span class="ident" id="7911606">i</span><span class="op" id="7911607">%</span><span class="builtinfunc" id="7911608">len</span><span class="op" id="7911611">(</span><span class="ident" id="7911612">alpha</span><span class="op" id="7911617">)</span><span class="op" id="7911618">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911624">encoded</span>&nbsp;<span class="op" id="7911632">:=</span>&nbsp;<span class="builtinfunc" id="7911635">new</span><span class="op" id="7911638">(</span><span class="ident" id="7911639">bytes</span><span class="op" id="7911644">.</span><span class="ident" id="7911645">Buffer</span><span class="op" id="7911651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911654">w</span>&nbsp;<span class="op" id="7911656">:=</span>&nbsp;<span class="ident" id="7911659">NewEncoder</span><span class="op" id="7911669">(</span><span class="ident" id="7911670">StdEncoding</span><span class="op" id="7911681">,</span>&nbsp;<span class="ident" id="7911683">encoded</span><span class="op" id="7911690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911693">nn</span><span class="op" id="7911695">,</span>&nbsp;<span class="ident" id="7911697">err</span>&nbsp;<span class="op" id="7911701">:=</span>&nbsp;<span class="ident" id="7911704">w</span><span class="op" id="7911705">.</span><span class="ident" id="7911706">Write</span><span class="op" id="7911711">(</span><span class="ident" id="7911712">raw</span><span class="op" id="7911715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911718">if</span>&nbsp;<span class="ident" id="7911721">nn</span>&nbsp;<span class="op" id="7911724">!=</span>&nbsp;<span class="ident" id="7911727">n</span>&nbsp;<span class="op" id="7911729">||</span>&nbsp;<span class="ident" id="7911732">err</span>&nbsp;<span class="op" id="7911736">!=</span>&nbsp;<span class="ident" id="7911739">nil</span>&nbsp;<span class="op" id="7911743">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911747">t</span><span class="op" id="7911748">.</span><span class="ident" id="7911749">Fatalf</span><span class="op" id="7911755">(</span><span class="string" id="7911756">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7911798">,</span>&nbsp;<span class="ident" id="7911800">nn</span><span class="op" id="7911802">,</span>&nbsp;<span class="ident" id="7911804">err</span><span class="op" id="7911807">,</span>&nbsp;<span class="ident" id="7911809">n</span><span class="op" id="7911810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911816">err</span>&nbsp;<span class="op" id="7911820">=</span>&nbsp;<span class="ident" id="7911822">w</span><span class="op" id="7911823">.</span><span class="ident" id="7911824">Close</span><span class="op" id="7911829">(</span><span class="op" id="7911830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911833">if</span>&nbsp;<span class="ident" id="7911836">err</span>&nbsp;<span class="op" id="7911840">!=</span>&nbsp;<span class="ident" id="7911843">nil</span>&nbsp;<span class="op" id="7911847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911851">t</span><span class="op" id="7911852">.</span><span class="ident" id="7911853">Fatalf</span><span class="op" id="7911859">(</span><span class="string" id="7911860">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7911891">,</span>&nbsp;<span class="ident" id="7911893">err</span><span class="op" id="7911896">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911902">decoded</span><span class="op" id="7911909">,</span>&nbsp;<span class="ident" id="7911911">err</span>&nbsp;<span class="op" id="7911915">:=</span>&nbsp;<span class="ident" id="7911918">ioutil</span><span class="op" id="7911924">.</span><span class="ident" id="7911925">ReadAll</span><span class="op" id="7911932">(</span><span class="ident" id="7911933">NewDecoder</span><span class="op" id="7911943">(</span><span class="ident" id="7911944">StdEncoding</span><span class="op" id="7911955">,</span>&nbsp;<span class="ident" id="7911957">encoded</span><span class="op" id="7911964">)</span><span class="op" id="7911965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911968">if</span>&nbsp;<span class="ident" id="7911971">err</span>&nbsp;<span class="op" id="7911975">!=</span>&nbsp;<span class="ident" id="7911978">nil</span>&nbsp;<span class="op" id="7911982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911986">t</span><span class="op" id="7911987">.</span><span class="ident" id="7911988">Fatalf</span><span class="op" id="7911994">(</span><span class="string" id="7911995">&#34;ioutil.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="7912032">,</span>&nbsp;<span class="ident" id="7912034">err</span><span class="op" id="7912037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912040">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912044">if</span>&nbsp;<span class="op" id="7912047">!</span><span class="ident" id="7912048">bytes</span><span class="op" id="7912053">.</span><span class="ident" id="7912054">Equal</span><span class="op" id="7912059">(</span><span class="ident" id="7912060">raw</span><span class="op" id="7912063">,</span>&nbsp;<span class="ident" id="7912065">decoded</span><span class="op" id="7912072">)</span>&nbsp;<span class="op" id="7912074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912078">var</span>&nbsp;<span class="ident" id="7912082">i</span>&nbsp;<span class="builtintype" id="7912084">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912090">for</span>&nbsp;<span class="ident" id="7912094">i</span>&nbsp;<span class="op" id="7912096">=</span>&nbsp;<span class="num" id="7912098">0</span><span class="op" id="7912099">;</span>&nbsp;<span class="ident" id="7912101">i</span>&nbsp;<span class="op" id="7912103">&lt;</span>&nbsp;<span class="builtinfunc" id="7912105">len</span><span class="op" id="7912108">(</span><span class="ident" id="7912109">decoded</span><span class="op" id="7912116">)</span>&nbsp;<span class="op" id="7912118">&amp;&amp;</span>&nbsp;<span class="ident" id="7912121">i</span>&nbsp;<span class="op" id="7912123">&lt;</span>&nbsp;<span class="builtinfunc" id="7912125">len</span><span class="op" id="7912128">(</span><span class="ident" id="7912129">raw</span><span class="op" id="7912132">)</span><span class="op" id="7912133">;</span>&nbsp;<span class="ident" id="7912135">i</span><span class="op" id="7912136">++</span>&nbsp;<span class="op" id="7912139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912144">if</span>&nbsp;<span class="ident" id="7912147">decoded</span><span class="op" id="7912154">[</span><span class="ident" id="7912155">i</span><span class="op" id="7912156">]</span>&nbsp;<span class="op" id="7912158">!=</span>&nbsp;<span class="ident" id="7912161">raw</span><span class="op" id="7912164">[</span><span class="ident" id="7912165">i</span><span class="op" id="7912166">]</span>&nbsp;<span class="op" id="7912168">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912174">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912191">t</span><span class="op" id="7912192">.</span><span class="ident" id="7912193">Errorf</span><span class="op" id="7912199">(</span><span class="string" id="7912200">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="7912252">,</span>&nbsp;<span class="ident" id="7912254">n</span><span class="op" id="7912255">,</span>&nbsp;<span class="ident" id="7912257">i</span><span class="op" id="7912258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912261">}</span><br>
<span class="lineno">220</span><span class="op" id="7912263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7912266">func</span>&nbsp;<span class="ident" id="7912271">TestNewLineCharacters</span><span class="op" id="7912292">(</span><span class="ident" id="7912293">t</span>&nbsp;<span class="op" id="7912295">*</span><span class="ident" id="7912296">testing</span><span class="op" id="7912303">.</span><span class="ident" id="7912304">T</span><span class="op" id="7912305">)</span>&nbsp;<span class="op" id="7912307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7912310">//&nbsp;Each&nbsp;of&nbsp;these&nbsp;should&nbsp;decode&nbsp;to&nbsp;the&nbsp;string&nbsp;&#34;sure&#34;,&nbsp;without&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912380">const</span>&nbsp;<span class="ident" id="7912386">expected</span>&nbsp;<span class="op" id="7912395">=</span>&nbsp;<span class="string" id="7912397">&#34;sure&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912405">examples</span>&nbsp;<span class="op" id="7912414">:=</span>&nbsp;<span class="op" id="7912417">[</span><span class="op" id="7912418">]</span><span class="builtintype" id="7912419">string</span><span class="op" id="7912425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7912429">&#34;c3VyZQ==&#34;</span><span class="op" id="7912439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7912443">&#34;c3VyZQ==\r&#34;</span><span class="op" id="7912455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7912459">&#34;c3VyZQ==\n&#34;</span><span class="op" id="7912471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7912475">&#34;c3VyZQ==\r\n&#34;</span><span class="op" id="7912489">,</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7912493">&#34;c3VyZ\r\nQ==&#34;</span><span class="op" id="7912507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7912511">&#34;c3V\ryZ\nQ==&#34;</span><span class="op" id="7912525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7912529">&#34;c3V\nyZ\rQ==&#34;</span><span class="op" id="7912543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7912547">&#34;c3VyZ\nQ==&#34;</span><span class="op" id="7912559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7912563">&#34;c3VyZQ\n==&#34;</span><span class="op" id="7912575">,</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7912579">&#34;c3VyZQ=\n=&#34;</span><span class="op" id="7912591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7912595">&#34;c3VyZQ=\r\n\r\n=&#34;</span><span class="op" id="7912613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912619">for</span>&nbsp;<span class="ident" id="7912623">_</span><span class="op" id="7912624">,</span>&nbsp;<span class="ident" id="7912626">e</span>&nbsp;<span class="op" id="7912628">:=</span>&nbsp;<span class="keyword" id="7912631">range</span>&nbsp;<span class="ident" id="7912637">examples</span>&nbsp;<span class="op" id="7912646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912650">buf</span><span class="op" id="7912653">,</span>&nbsp;<span class="ident" id="7912655">err</span>&nbsp;<span class="op" id="7912659">:=</span>&nbsp;<span class="ident" id="7912662">StdEncoding</span><span class="op" id="7912673">.</span><span class="ident" id="7912674">DecodeString</span><span class="op" id="7912686">(</span><span class="ident" id="7912687">e</span><span class="op" id="7912688">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912692">if</span>&nbsp;<span class="ident" id="7912695">err</span>&nbsp;<span class="op" id="7912699">!=</span>&nbsp;<span class="ident" id="7912702">nil</span>&nbsp;<span class="op" id="7912706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912711">t</span><span class="op" id="7912712">.</span><span class="ident" id="7912713">Errorf</span><span class="op" id="7912719">(</span><span class="string" id="7912720">&#34;Decode(%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7912743">,</span>&nbsp;<span class="ident" id="7912745">e</span><span class="op" id="7912746">,</span>&nbsp;<span class="ident" id="7912748">err</span><span class="op" id="7912751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912756">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912771">if</span>&nbsp;<span class="ident" id="7912774">s</span>&nbsp;<span class="op" id="7912776">:=</span>&nbsp;<span class="builtintype" id="7912779">string</span><span class="op" id="7912785">(</span><span class="ident" id="7912786">buf</span><span class="op" id="7912789">)</span><span class="op" id="7912790">;</span>&nbsp;<span class="ident" id="7912792">s</span>&nbsp;<span class="op" id="7912794">!=</span>&nbsp;<span class="ident" id="7912797">expected</span>&nbsp;<span class="op" id="7912806">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912811">t</span><span class="op" id="7912812">.</span><span class="ident" id="7912813">Errorf</span><span class="op" id="7912819">(</span><span class="string" id="7912820">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7912846">,</span>&nbsp;<span class="ident" id="7912848">e</span><span class="op" id="7912849">,</span>&nbsp;<span class="ident" id="7912851">s</span><span class="op" id="7912852">,</span>&nbsp;<span class="ident" id="7912854">expected</span><span class="op" id="7912862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912869">}</span><br>
<span class="lineno"></span><span class="op" id="7912871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="7912874">type</span>&nbsp;<span class="ident" id="7912879">nextRead</span>&nbsp;<span class="keyword" id="7912888">struct</span>&nbsp;<span class="op" id="7912895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912898">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7912902">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7912908">//&nbsp;bytes&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912928">err</span>&nbsp;<span class="builtintype" id="7912932">error</span>&nbsp;<span class="comment" id="7912938">//&nbsp;error&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="op" id="7912957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="7912960">//&nbsp;faultInjectReader&nbsp;returns&nbsp;data&nbsp;from&nbsp;source,&nbsp;rate-limited</span><br>
<span class="lineno"></span><span class="comment" id="7913020">//&nbsp;and&nbsp;with&nbsp;the&nbsp;errors&nbsp;as&nbsp;written&nbsp;to&nbsp;nextc.</span><br>
<span class="lineno"></span><span class="keyword" id="7913064">type</span>&nbsp;<span class="ident" id="7913069">faultInjectReader</span>&nbsp;<span class="keyword" id="7913087">struct</span>&nbsp;<span class="op" id="7913094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913097">source</span>&nbsp;<span class="builtintype" id="7913104">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913112">nextc</span>&nbsp;&nbsp;<span class="op" id="7913119">&lt;-</span><span class="keyword" id="7913121">chan</span>&nbsp;<span class="ident" id="7913126">nextRead</span><br>
<span class="lineno">260</span><span class="op" id="7913135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7913138">func</span>&nbsp;<span class="op" id="7913143">(</span><span class="ident" id="7913144">r</span>&nbsp;<span class="op" id="7913146">*</span><span class="ident" id="7913147">faultInjectReader</span><span class="op" id="7913164">)</span>&nbsp;<span class="ident" id="7913166">Read</span><span class="op" id="7913170">(</span><span class="ident" id="7913171">p</span>&nbsp;<span class="op" id="7913173">[</span><span class="op" id="7913174">]</span><span class="builtintype" id="7913175">byte</span><span class="op" id="7913179">)</span>&nbsp;<span class="op" id="7913181">(</span><span class="builtintype" id="7913182">int</span><span class="op" id="7913185">,</span>&nbsp;<span class="builtintype" id="7913187">error</span><span class="op" id="7913192">)</span>&nbsp;<span class="op" id="7913194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913197">nr</span>&nbsp;<span class="op" id="7913200">:=</span>&nbsp;<span class="op" id="7913203">&lt;-</span><span class="ident" id="7913205">r</span><span class="op" id="7913206">.</span><span class="ident" id="7913207">nextc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913214">if</span>&nbsp;<span class="builtinfunc" id="7913217">len</span><span class="op" id="7913220">(</span><span class="ident" id="7913221">p</span><span class="op" id="7913222">)</span>&nbsp;<span class="op" id="7913224">&gt;</span>&nbsp;<span class="ident" id="7913226">nr</span><span class="op" id="7913228">.</span><span class="ident" id="7913229">n</span>&nbsp;<span class="op" id="7913231">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913235">p</span>&nbsp;<span class="op" id="7913237">=</span>&nbsp;<span class="ident" id="7913239">p</span><span class="op" id="7913240">[</span><span class="op" id="7913241">:</span><span class="ident" id="7913242">nr</span><span class="op" id="7913244">.</span><span class="ident" id="7913245">n</span><span class="op" id="7913246">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913252">n</span>&nbsp;<span class="op" id="7913254">:=</span>&nbsp;<span class="builtinfunc" id="7913257">copy</span><span class="op" id="7913261">(</span><span class="ident" id="7913262">p</span><span class="op" id="7913263">,</span>&nbsp;<span class="ident" id="7913265">r</span><span class="op" id="7913266">.</span><span class="ident" id="7913267">source</span><span class="op" id="7913273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913276">r</span><span class="op" id="7913277">.</span><span class="ident" id="7913278">source</span>&nbsp;<span class="op" id="7913285">=</span>&nbsp;<span class="ident" id="7913287">r</span><span class="op" id="7913288">.</span><span class="ident" id="7913289">source</span><span class="op" id="7913295">[</span><span class="ident" id="7913296">n</span><span class="op" id="7913297">:</span><span class="op" id="7913298">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913301">return</span>&nbsp;<span class="ident" id="7913308">n</span><span class="op" id="7913309">,</span>&nbsp;<span class="ident" id="7913311">nr</span><span class="op" id="7913313">.</span><span class="ident" id="7913314">err</span><br>
<span class="lineno">270</span><span class="op" id="7913318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7913321">//&nbsp;tests&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;ignore&nbsp;errors&nbsp;from&nbsp;our&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span><span class="keyword" id="7913385">func</span>&nbsp;<span class="ident" id="7913390">TestDecoderIssue3577</span><span class="op" id="7913410">(</span><span class="ident" id="7913411">t</span>&nbsp;<span class="op" id="7913413">*</span><span class="ident" id="7913414">testing</span><span class="op" id="7913421">.</span><span class="ident" id="7913422">T</span><span class="op" id="7913423">)</span>&nbsp;<span class="op" id="7913425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913428">next</span>&nbsp;<span class="op" id="7913433">:=</span>&nbsp;<span class="builtinfunc" id="7913436">make</span><span class="op" id="7913440">(</span><span class="keyword" id="7913441">chan</span>&nbsp;<span class="ident" id="7913446">nextRead</span><span class="op" id="7913454">,</span>&nbsp;<span class="num" id="7913456">10</span><span class="op" id="7913458">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913461">wantErr</span>&nbsp;<span class="op" id="7913469">:=</span>&nbsp;<span class="ident" id="7913472">errors</span><span class="op" id="7913478">.</span><span class="ident" id="7913479">New</span><span class="op" id="7913482">(</span><span class="string" id="7913483">&#34;my&nbsp;error&#34;</span><span class="op" id="7913493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913496">next</span>&nbsp;<span class="op" id="7913501">&lt;-</span>&nbsp;<span class="ident" id="7913504">nextRead</span><span class="op" id="7913512">{</span><span class="num" id="7913513">5</span><span class="op" id="7913514">,</span>&nbsp;<span class="ident" id="7913516">nil</span><span class="op" id="7913519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913522">next</span>&nbsp;<span class="op" id="7913527">&lt;-</span>&nbsp;<span class="ident" id="7913530">nextRead</span><span class="op" id="7913538">{</span><span class="num" id="7913539">10</span><span class="op" id="7913541">,</span>&nbsp;<span class="ident" id="7913543">wantErr</span><span class="op" id="7913550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913553">next</span>&nbsp;<span class="op" id="7913558">&lt;-</span>&nbsp;<span class="ident" id="7913561">nextRead</span><span class="op" id="7913569">{</span><span class="num" id="7913570">0</span><span class="op" id="7913571">,</span>&nbsp;<span class="ident" id="7913573">wantErr</span><span class="op" id="7913580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913583">d</span>&nbsp;<span class="op" id="7913585">:=</span>&nbsp;<span class="ident" id="7913588">NewDecoder</span><span class="op" id="7913598">(</span><span class="ident" id="7913599">StdEncoding</span><span class="op" id="7913610">,</span>&nbsp;<span class="op" id="7913612">&amp;</span><span class="ident" id="7913613">faultInjectReader</span><span class="op" id="7913630">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913634">source</span><span class="op" id="7913640">:</span>&nbsp;<span class="string" id="7913642">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="7913692">,</span>&nbsp;<span class="comment" id="7913694">//&nbsp;twas&nbsp;brillig...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913715">nextc</span><span class="op" id="7913720">:</span>&nbsp;&nbsp;<span class="ident" id="7913723">next</span><span class="op" id="7913727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913730">}</span><span class="op" id="7913731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913734">errc</span>&nbsp;<span class="op" id="7913739">:=</span>&nbsp;<span class="builtinfunc" id="7913742">make</span><span class="op" id="7913746">(</span><span class="keyword" id="7913747">chan</span>&nbsp;<span class="builtintype" id="7913752">error</span><span class="op" id="7913757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913760">go</span>&nbsp;<span class="keyword" id="7913763">func</span><span class="op" id="7913767">(</span><span class="op" id="7913768">)</span>&nbsp;<span class="op" id="7913770">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913774">_</span><span class="op" id="7913775">,</span>&nbsp;<span class="ident" id="7913777">err</span>&nbsp;<span class="op" id="7913781">:=</span>&nbsp;<span class="ident" id="7913784">ioutil</span><span class="op" id="7913790">.</span><span class="ident" id="7913791">ReadAll</span><span class="op" id="7913798">(</span><span class="ident" id="7913799">d</span><span class="op" id="7913800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913804">errc</span>&nbsp;<span class="op" id="7913809">&lt;-</span>&nbsp;<span class="ident" id="7913812">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913817">}</span><span class="op" id="7913818">(</span><span class="op" id="7913819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913822">select</span>&nbsp;<span class="op" id="7913829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913832">case</span>&nbsp;<span class="ident" id="7913837">err</span>&nbsp;<span class="op" id="7913841">:=</span>&nbsp;<span class="op" id="7913844">&lt;-</span><span class="ident" id="7913846">errc</span><span class="op" id="7913850">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913854">if</span>&nbsp;<span class="ident" id="7913857">err</span>&nbsp;<span class="op" id="7913861">!=</span>&nbsp;<span class="ident" id="7913864">wantErr</span>&nbsp;<span class="op" id="7913872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913877">t</span><span class="op" id="7913878">.</span><span class="ident" id="7913879">Errorf</span><span class="op" id="7913885">(</span><span class="string" id="7913886">&#34;got&nbsp;error&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7913909">,</span>&nbsp;<span class="ident" id="7913911">err</span><span class="op" id="7913914">,</span>&nbsp;<span class="ident" id="7913916">wantErr</span><span class="op" id="7913923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913930">case</span>&nbsp;<span class="op" id="7913935">&lt;-</span><span class="ident" id="7913937">time</span><span class="op" id="7913941">.</span><span class="ident" id="7913942">After</span><span class="op" id="7913947">(</span><span class="num" id="7913948">5</span>&nbsp;<span class="op" id="7913950">*</span>&nbsp;<span class="ident" id="7913952">time</span><span class="op" id="7913956">.</span><span class="ident" id="7913957">Second</span><span class="op" id="7913963">)</span><span class="op" id="7913964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913968">t</span><span class="op" id="7913969">.</span><span class="ident" id="7913970">Errorf</span><span class="op" id="7913976">(</span><span class="string" id="7913977">&#34;timeout;&nbsp;Decoder&nbsp;blocked&nbsp;without&nbsp;returning&nbsp;an&nbsp;error&#34;</span><span class="op" id="7914030">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914033">}</span><br>
<span class="lineno"></span><span class="op" id="7914035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7914038">func</span>&nbsp;<span class="ident" id="7914043">TestDecoderIssue4779</span><span class="op" id="7914063">(</span><span class="ident" id="7914064">t</span>&nbsp;<span class="op" id="7914066">*</span><span class="ident" id="7914067">testing</span><span class="op" id="7914074">.</span><span class="ident" id="7914075">T</span><span class="op" id="7914076">)</span>&nbsp;<span class="op" id="7914078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914081">encoded</span>&nbsp;<span class="op" id="7914089">:=</span>&nbsp;<span class="string" id="7914092">`CP/EAT8AAAEF<br>
<span class="lineno">300</span>AQEBAQEBAAAAAAAAAAMAAQIEBQYHCAkKCwEAAQUBAQEBAQEAAAAAAAAAAQACAwQFBgcICQoLEAAB<br>
<span class="lineno"></span>BAEDAgQCBQcGCAUDDDMBAAIRAwQhEjEFQVFhEyJxgTIGFJGhsUIjJBVSwWIzNHKC0UMHJZJT8OHx<br>
<span class="lineno"></span>Y3M1FqKygyZEk1RkRcKjdDYX0lXiZfKzhMPTdePzRieUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm<br>
<span class="lineno"></span>9jdHV2d3h5ent8fX5/cRAAICAQIEBAMEBQYHBwYFNQEAAhEDITESBEFRYXEiEwUygZEUobFCI8FS<br>
<span class="lineno"></span>0fAzJGLhcoKSQ1MVY3M08SUGFqKygwcmNcLSRJNUoxdkRVU2dGXi8rOEw9N14/NGlKSFtJXE1OT0<br>
<span class="lineno">305</span>pbXF1eX1VmZ2hpamtsbW5vYnN0dXZ3eHl6e3x//aAAwDAQACEQMRAD8A9VSSSSUpJJJJSkkkJ+Tj<br>
<span class="lineno"></span>1kiy1jCJJDnAcCTykpKkuQ6p/jN6FgmxlNduXawwAzaGH+V6jn/R/wCt71zdn+N/qL3kVYFNYB4N<br>
<span class="lineno"></span>ji6PDVjWpKp9TSXnvTf8bFNjg3qOEa2n6VlLpj/rT/pf567DpX1i6L1hs9Py67X8mqdtg/rUWbbf<br>
<span class="lineno"></span>+gkp0kkkklKSSSSUpJJJJT//0PVUkkklKVLq3WMDpGI7KzrNjADtYNXvI/Mqr/Pd/q9W3vaxjnvM<br>
<span class="lineno"></span>NaCXE9gNSvGPrf8AWS3qmba5jjsJhoB0DAf0NDf6sevf+/lf8Hj0JJATfWT6/dV6oXU1uOLQeKKn<br>
<span class="lineno">310</span>EQP+Hubtfe/+R7Mf/g7f5xcocp++Z11JMCJPgFBxOg7/AOuqDx8I/ikpkXkmSdU8mJIJA/O8EMAy<br>
<span class="lineno"></span>j+mSARB/17pKVXYWHXjsj7yIex0PadzXMO1zT5KHoNA3HT8ietoGhgjsfA+CSnvvqh/jJtqsrwOv<br>
<span class="lineno"></span>2b6NGNzXfTYexzJ+nU7/ALkf4P8Awv6P9KvTQQ4AgyDqCF85Pho3CTB7eHwXoH+LT65uZbX9X+o2<br>
<span class="lineno"></span>bqbPb06551Y4<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915123">encodedShort</span>&nbsp;<span class="op" id="7915136">:=</span>&nbsp;<span class="ident" id="7915139">strings</span><span class="op" id="7915146">.</span><span class="ident" id="7915147">Replace</span><span class="op" id="7915154">(</span><span class="ident" id="7915155">encoded</span><span class="op" id="7915162">,</span>&nbsp;<span class="string" id="7915164">&#34;\n&#34;</span><span class="op" id="7915168">,</span>&nbsp;<span class="string" id="7915170">&#34;&#34;</span><span class="op" id="7915172">,</span>&nbsp;<span class="op" id="7915174">-</span><span class="num" id="7915175">1</span><span class="op" id="7915176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915180">dec</span>&nbsp;<span class="op" id="7915184">:=</span>&nbsp;<span class="ident" id="7915187">NewDecoder</span><span class="op" id="7915197">(</span><span class="ident" id="7915198">StdEncoding</span><span class="op" id="7915209">,</span>&nbsp;<span class="ident" id="7915211">strings</span><span class="op" id="7915218">.</span><span class="ident" id="7915219">NewReader</span><span class="op" id="7915228">(</span><span class="ident" id="7915229">encoded</span><span class="op" id="7915236">)</span><span class="op" id="7915237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915240">res1</span><span class="op" id="7915244">,</span>&nbsp;<span class="ident" id="7915246">err</span>&nbsp;<span class="op" id="7915250">:=</span>&nbsp;<span class="ident" id="7915253">ioutil</span><span class="op" id="7915259">.</span><span class="ident" id="7915260">ReadAll</span><span class="op" id="7915267">(</span><span class="ident" id="7915268">dec</span><span class="op" id="7915271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915274">if</span>&nbsp;<span class="ident" id="7915277">err</span>&nbsp;<span class="op" id="7915281">!=</span>&nbsp;<span class="ident" id="7915284">nil</span>&nbsp;<span class="op" id="7915288">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915292">t</span><span class="op" id="7915293">.</span><span class="ident" id="7915294">Errorf</span><span class="op" id="7915300">(</span><span class="string" id="7915301">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7915321">,</span>&nbsp;<span class="ident" id="7915323">err</span><span class="op" id="7915326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915333">dec</span>&nbsp;<span class="op" id="7915337">=</span>&nbsp;<span class="ident" id="7915339">NewDecoder</span><span class="op" id="7915349">(</span><span class="ident" id="7915350">StdEncoding</span><span class="op" id="7915361">,</span>&nbsp;<span class="ident" id="7915363">strings</span><span class="op" id="7915370">.</span><span class="ident" id="7915371">NewReader</span><span class="op" id="7915380">(</span><span class="ident" id="7915381">encodedShort</span><span class="op" id="7915393">)</span><span class="op" id="7915394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915397">var</span>&nbsp;<span class="ident" id="7915401">res2</span>&nbsp;<span class="op" id="7915406">[</span><span class="op" id="7915407">]</span><span class="builtintype" id="7915408">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915414">res2</span><span class="op" id="7915418">,</span>&nbsp;<span class="ident" id="7915420">err</span>&nbsp;<span class="op" id="7915424">=</span>&nbsp;<span class="ident" id="7915426">ioutil</span><span class="op" id="7915432">.</span><span class="ident" id="7915433">ReadAll</span><span class="op" id="7915440">(</span><span class="ident" id="7915441">dec</span><span class="op" id="7915444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915447">if</span>&nbsp;<span class="ident" id="7915450">err</span>&nbsp;<span class="op" id="7915454">!=</span>&nbsp;<span class="ident" id="7915457">nil</span>&nbsp;<span class="op" id="7915461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915465">t</span><span class="op" id="7915466">.</span><span class="ident" id="7915467">Errorf</span><span class="op" id="7915473">(</span><span class="string" id="7915474">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7915494">,</span>&nbsp;<span class="ident" id="7915496">err</span><span class="op" id="7915499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915506">if</span>&nbsp;<span class="op" id="7915509">!</span><span class="ident" id="7915510">bytes</span><span class="op" id="7915515">.</span><span class="ident" id="7915516">Equal</span><span class="op" id="7915521">(</span><span class="ident" id="7915522">res1</span><span class="op" id="7915526">,</span>&nbsp;<span class="ident" id="7915528">res2</span><span class="op" id="7915532">)</span>&nbsp;<span class="op" id="7915534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915538">t</span><span class="op" id="7915539">.</span><span class="ident" id="7915540">Error</span><span class="op" id="7915545">(</span><span class="string" id="7915546">&#34;Decoded&nbsp;results&nbsp;not&nbsp;equal&#34;</span><span class="op" id="7915573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915576">}</span><br>
<span class="lineno"></span><span class="op" id="7915578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="7915581">func</span>&nbsp;<span class="ident" id="7915586">TestDecoderIssue7733</span><span class="op" id="7915606">(</span><span class="ident" id="7915607">t</span>&nbsp;<span class="op" id="7915609">*</span><span class="ident" id="7915610">testing</span><span class="op" id="7915617">.</span><span class="ident" id="7915618">T</span><span class="op" id="7915619">)</span>&nbsp;<span class="op" id="7915621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915624">s</span><span class="op" id="7915625">,</span>&nbsp;<span class="ident" id="7915627">err</span>&nbsp;<span class="op" id="7915631">:=</span>&nbsp;<span class="ident" id="7915634">StdEncoding</span><span class="op" id="7915645">.</span><span class="ident" id="7915646">DecodeString</span><span class="op" id="7915658">(</span><span class="string" id="7915659">&#34;YWJjZA=====&#34;</span><span class="op" id="7915672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915675">want</span>&nbsp;<span class="op" id="7915680">:=</span>&nbsp;<span class="ident" id="7915683">CorruptInputError</span><span class="op" id="7915700">(</span><span class="num" id="7915701">8</span><span class="op" id="7915702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915705">if</span>&nbsp;<span class="op" id="7915708">!</span><span class="ident" id="7915709">reflect</span><span class="op" id="7915716">.</span><span class="ident" id="7915717">DeepEqual</span><span class="op" id="7915726">(</span><span class="ident" id="7915727">want</span><span class="op" id="7915731">,</span>&nbsp;<span class="ident" id="7915733">err</span><span class="op" id="7915736">)</span>&nbsp;<span class="op" id="7915738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915742">t</span><span class="op" id="7915743">.</span><span class="ident" id="7915744">Errorf</span><span class="op" id="7915750">(</span><span class="string" id="7915751">&#34;Error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;CorruptInputError(8)&#34;</span><span class="op" id="7915790">,</span>&nbsp;<span class="ident" id="7915792">err</span><span class="op" id="7915795">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915801">if</span>&nbsp;<span class="builtintype" id="7915804">string</span><span class="op" id="7915810">(</span><span class="ident" id="7915811">s</span><span class="op" id="7915812">)</span>&nbsp;<span class="op" id="7915814">!=</span>&nbsp;<span class="string" id="7915817">&#34;abcd&#34;</span>&nbsp;<span class="op" id="7915824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915828">t</span><span class="op" id="7915829">.</span><span class="ident" id="7915830">Errorf</span><span class="op" id="7915836">(</span><span class="string" id="7915837">&#34;DecodeString&nbsp;=&nbsp;%q;&nbsp;want&nbsp;abcd&#34;</span><span class="op" id="7915867">,</span>&nbsp;<span class="ident" id="7915869">s</span><span class="op" id="7915870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915873">}</span><br>
<span class="lineno"></span><span class="op" id="7915875">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7915878">func</span>&nbsp;<span class="ident" id="7915883">BenchmarkEncodeToString</span><span class="op" id="7915906">(</span><span class="ident" id="7915907">b</span>&nbsp;<span class="op" id="7915909">*</span><span class="ident" id="7915910">testing</span><span class="op" id="7915917">.</span><span class="ident" id="7915918">B</span><span class="op" id="7915919">)</span>&nbsp;<span class="op" id="7915921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915924">data</span>&nbsp;<span class="op" id="7915929">:=</span>&nbsp;<span class="builtinfunc" id="7915932">make</span><span class="op" id="7915936">(</span><span class="op" id="7915937">[</span><span class="op" id="7915938">]</span><span class="builtintype" id="7915939">byte</span><span class="op" id="7915943">,</span>&nbsp;<span class="num" id="7915945">8192</span><span class="op" id="7915949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915952">b</span><span class="op" id="7915953">.</span><span class="ident" id="7915954">SetBytes</span><span class="op" id="7915962">(</span><span class="ident" id="7915963">int64</span><span class="op" id="7915968">(</span><span class="builtinfunc" id="7915969">len</span><span class="op" id="7915972">(</span><span class="ident" id="7915973">data</span><span class="op" id="7915977">)</span><span class="op" id="7915978">)</span><span class="op" id="7915979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915982">for</span>&nbsp;<span class="ident" id="7915986">i</span>&nbsp;<span class="op" id="7915988">:=</span>&nbsp;<span class="num" id="7915991">0</span><span class="op" id="7915992">;</span>&nbsp;<span class="ident" id="7915994">i</span>&nbsp;<span class="op" id="7915996">&lt;</span>&nbsp;<span class="ident" id="7915998">b</span><span class="op" id="7915999">.</span><span class="ident" id="7916000">N</span><span class="op" id="7916001">;</span>&nbsp;<span class="ident" id="7916003">i</span><span class="op" id="7916004">++</span>&nbsp;<span class="op" id="7916007">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916011">StdEncoding</span><span class="op" id="7916022">.</span><span class="ident" id="7916023">EncodeToString</span><span class="op" id="7916037">(</span><span class="ident" id="7916038">data</span><span class="op" id="7916042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916045">}</span><br>
<span class="lineno"></span><span class="op" id="7916047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7916050">func</span>&nbsp;<span class="ident" id="7916055">BenchmarkDecodeString</span><span class="op" id="7916076">(</span><span class="ident" id="7916077">b</span>&nbsp;<span class="op" id="7916079">*</span><span class="ident" id="7916080">testing</span><span class="op" id="7916087">.</span><span class="ident" id="7916088">B</span><span class="op" id="7916089">)</span>&nbsp;<span class="op" id="7916091">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916094">data</span>&nbsp;<span class="op" id="7916099">:=</span>&nbsp;<span class="ident" id="7916102">StdEncoding</span><span class="op" id="7916113">.</span><span class="ident" id="7916114">EncodeToString</span><span class="op" id="7916128">(</span><span class="builtinfunc" id="7916129">make</span><span class="op" id="7916133">(</span><span class="op" id="7916134">[</span><span class="op" id="7916135">]</span><span class="builtintype" id="7916136">byte</span><span class="op" id="7916140">,</span>&nbsp;<span class="num" id="7916142">8192</span><span class="op" id="7916146">)</span><span class="op" id="7916147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916150">b</span><span class="op" id="7916151">.</span><span class="ident" id="7916152">SetBytes</span><span class="op" id="7916160">(</span><span class="ident" id="7916161">int64</span><span class="op" id="7916166">(</span><span class="builtinfunc" id="7916167">len</span><span class="op" id="7916170">(</span><span class="ident" id="7916171">data</span><span class="op" id="7916175">)</span><span class="op" id="7916176">)</span><span class="op" id="7916177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916180">for</span>&nbsp;<span class="ident" id="7916184">i</span>&nbsp;<span class="op" id="7916186">:=</span>&nbsp;<span class="num" id="7916189">0</span><span class="op" id="7916190">;</span>&nbsp;<span class="ident" id="7916192">i</span>&nbsp;<span class="op" id="7916194">&lt;</span>&nbsp;<span class="ident" id="7916196">b</span><span class="op" id="7916197">.</span><span class="ident" id="7916198">N</span><span class="op" id="7916199">;</span>&nbsp;<span class="ident" id="7916201">i</span><span class="op" id="7916202">++</span>&nbsp;<span class="op" id="7916205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916209">StdEncoding</span><span class="op" id="7916220">.</span><span class="ident" id="7916221">DecodeString</span><span class="op" id="7916233">(</span><span class="ident" id="7916234">data</span><span class="op" id="7916238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916241">}</span><br>
<span class="lineno">360</span><span class="op" id="7916243">}</span>
</div>
</body>
</html>
