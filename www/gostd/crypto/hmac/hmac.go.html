<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/hmac</h2>
<ul>
<li><a href="/gostd/crypto/hmac/hmac.go.html">hmac.go</a></li>
<li><a href="/gostd/crypto/hmac/hmac_test.go.html">hmac_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3559143">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3559198">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3559252">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3559303">/*<br>
<span class="lineno"></span>Package&nbsp;hmac&nbsp;implements&nbsp;the&nbsp;Keyed-Hash&nbsp;Message&nbsp;Authentication&nbsp;Code&nbsp;(HMAC)&nbsp;as<br>
<span class="lineno"></span>defined&nbsp;in&nbsp;U.S.&nbsp;Federal&nbsp;Information&nbsp;Processing&nbsp;Standards&nbsp;Publication&nbsp;198.<br>
<span class="lineno"></span>An&nbsp;HMAC&nbsp;is&nbsp;a&nbsp;cryptographic&nbsp;hash&nbsp;that&nbsp;uses&nbsp;a&nbsp;key&nbsp;to&nbsp;sign&nbsp;a&nbsp;message.<br>
<span class="lineno"></span>The&nbsp;receiver&nbsp;verifies&nbsp;the&nbsp;hash&nbsp;by&nbsp;recomputing&nbsp;it&nbsp;using&nbsp;the&nbsp;same&nbsp;key.<br>
<span class="lineno">10</span><br>
<span class="lineno"></span>Receivers&nbsp;should&nbsp;be&nbsp;careful&nbsp;to&nbsp;use&nbsp;Equal&nbsp;to&nbsp;compare&nbsp;MACs&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>timing&nbsp;side-channels:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;CheckMAC&nbsp;returns&nbsp;true&nbsp;if&nbsp;messageMAC&nbsp;is&nbsp;a&nbsp;valid&nbsp;HMAC&nbsp;tag&nbsp;for&nbsp;message.<br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;CheckMAC(message,&nbsp;messageMAC,&nbsp;key&nbsp;[]byte)&nbsp;bool&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac&nbsp;:=&nbsp;hmac.New(sha256.New,&nbsp;key)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac.Write(message)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspexpectedMAC&nbsp;:=&nbsp;mac.Sum(nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;hmac.Equal(messageMAC,&nbsp;expectedMAC)<br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="3559957">package</span>&nbsp;<span class="ident" id="3559965">hmac</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3559971">import</span>&nbsp;<span class="op" id="3559978">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3559981">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3559998">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3560005">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3560008">//&nbsp;FIPS&nbsp;198:</span><br>
<span class="lineno">30</span><span class="comment" id="3560021">//&nbsp;http://csrc.nist.gov/publications/fips/fips198/fips-198a.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3560086">//&nbsp;key&nbsp;is&nbsp;zero&nbsp;padded&nbsp;to&nbsp;the&nbsp;block&nbsp;size&nbsp;of&nbsp;the&nbsp;hash&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="3560147">//&nbsp;ipad&nbsp;=&nbsp;0x36&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="3560191">//&nbsp;opad&nbsp;=&nbsp;0x5c&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno">35</span><span class="comment" id="3560235">//&nbsp;hmac&nbsp;=&nbsp;H([key&nbsp;^&nbsp;opad]&nbsp;H([key&nbsp;^&nbsp;ipad]&nbsp;text))</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3560283">type</span>&nbsp;<span class="ident" id="3560288">hmac</span>&nbsp;<span class="keyword" id="3560293">struct</span>&nbsp;<span class="op" id="3560300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560303">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3560316">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560321">blocksize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3560334">int</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560339">key</span><span class="op" id="3560342">,</span>&nbsp;<span class="ident" id="3560344">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3560352">[</span><span class="op" id="3560353">]</span><span class="builtintype" id="3560354">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560360">outer</span><span class="op" id="3560365">,</span>&nbsp;<span class="ident" id="3560367">inner</span>&nbsp;<span class="ident" id="3560373">hash</span><span class="op" id="3560377">.</span><span class="ident" id="3560378">Hash</span><br>
<span class="lineno"></span><span class="op" id="3560383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3560386">func</span>&nbsp;<span class="op" id="3560391">(</span><span class="ident" id="3560392">h</span>&nbsp;<span class="op" id="3560394">*</span><span class="ident" id="3560395">hmac</span><span class="op" id="3560399">)</span>&nbsp;<span class="ident" id="3560401">tmpPad</span><span class="op" id="3560407">(</span><span class="ident" id="3560408">xor</span>&nbsp;<span class="builtintype" id="3560412">byte</span><span class="op" id="3560416">)</span>&nbsp;<span class="op" id="3560418">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560421">for</span>&nbsp;<span class="ident" id="3560425">i</span><span class="op" id="3560426">,</span>&nbsp;<span class="ident" id="3560428">k</span>&nbsp;<span class="op" id="3560430">:=</span>&nbsp;<span class="keyword" id="3560433">range</span>&nbsp;<span class="ident" id="3560439">h</span><span class="op" id="3560440">.</span><span class="ident" id="3560441">key</span>&nbsp;<span class="op" id="3560445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560449">h</span><span class="op" id="3560450">.</span><span class="ident" id="3560451">tmp</span><span class="op" id="3560454">[</span><span class="ident" id="3560455">i</span><span class="op" id="3560456">]</span>&nbsp;<span class="op" id="3560458">=</span>&nbsp;<span class="ident" id="3560460">xor</span>&nbsp;<span class="op" id="3560464">^</span>&nbsp;<span class="ident" id="3560466">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560472">for</span>&nbsp;<span class="ident" id="3560476">i</span>&nbsp;<span class="op" id="3560478">:=</span>&nbsp;<span class="builtinfunc" id="3560481">len</span><span class="op" id="3560484">(</span><span class="ident" id="3560485">h</span><span class="op" id="3560486">.</span><span class="ident" id="3560487">key</span><span class="op" id="3560490">)</span><span class="op" id="3560491">;</span>&nbsp;<span class="ident" id="3560493">i</span>&nbsp;<span class="op" id="3560495">&lt;</span>&nbsp;<span class="ident" id="3560497">h</span><span class="op" id="3560498">.</span><span class="ident" id="3560499">blocksize</span><span class="op" id="3560508">;</span>&nbsp;<span class="ident" id="3560510">i</span><span class="op" id="3560511">++</span>&nbsp;<span class="op" id="3560514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560518">h</span><span class="op" id="3560519">.</span><span class="ident" id="3560520">tmp</span><span class="op" id="3560523">[</span><span class="ident" id="3560524">i</span><span class="op" id="3560525">]</span>&nbsp;<span class="op" id="3560527">=</span>&nbsp;<span class="ident" id="3560529">xor</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560534">}</span><br>
<span class="lineno"></span><span class="op" id="3560536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3560539">func</span>&nbsp;<span class="op" id="3560544">(</span><span class="ident" id="3560545">h</span>&nbsp;<span class="op" id="3560547">*</span><span class="ident" id="3560548">hmac</span><span class="op" id="3560552">)</span>&nbsp;<span class="ident" id="3560554">Sum</span><span class="op" id="3560557">(</span><span class="ident" id="3560558">in</span>&nbsp;<span class="op" id="3560561">[</span><span class="op" id="3560562">]</span><span class="builtintype" id="3560563">byte</span><span class="op" id="3560567">)</span>&nbsp;<span class="op" id="3560569">[</span><span class="op" id="3560570">]</span><span class="builtintype" id="3560571">byte</span>&nbsp;<span class="op" id="3560576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560579">origLen</span>&nbsp;<span class="op" id="3560587">:=</span>&nbsp;<span class="builtinfunc" id="3560590">len</span><span class="op" id="3560593">(</span><span class="ident" id="3560594">in</span><span class="op" id="3560596">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560599">in</span>&nbsp;<span class="op" id="3560602">=</span>&nbsp;<span class="ident" id="3560604">h</span><span class="op" id="3560605">.</span><span class="ident" id="3560606">inner</span><span class="op" id="3560611">.</span><span class="ident" id="3560612">Sum</span><span class="op" id="3560615">(</span><span class="ident" id="3560616">in</span><span class="op" id="3560618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560621">h</span><span class="op" id="3560622">.</span><span class="ident" id="3560623">tmpPad</span><span class="op" id="3560629">(</span><span class="num" id="3560630">0x5c</span><span class="op" id="3560634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3560637">copy</span><span class="op" id="3560641">(</span><span class="ident" id="3560642">h</span><span class="op" id="3560643">.</span><span class="ident" id="3560644">tmp</span><span class="op" id="3560647">[</span><span class="ident" id="3560648">h</span><span class="op" id="3560649">.</span><span class="ident" id="3560650">blocksize</span><span class="op" id="3560659">:</span><span class="op" id="3560660">]</span><span class="op" id="3560661">,</span>&nbsp;<span class="ident" id="3560663">in</span><span class="op" id="3560665">[</span><span class="ident" id="3560666">origLen</span><span class="op" id="3560673">:</span><span class="op" id="3560674">]</span><span class="op" id="3560675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560678">h</span><span class="op" id="3560679">.</span><span class="ident" id="3560680">outer</span><span class="op" id="3560685">.</span><span class="ident" id="3560686">Reset</span><span class="op" id="3560691">(</span><span class="op" id="3560692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560695">h</span><span class="op" id="3560696">.</span><span class="ident" id="3560697">outer</span><span class="op" id="3560702">.</span><span class="ident" id="3560703">Write</span><span class="op" id="3560708">(</span><span class="ident" id="3560709">h</span><span class="op" id="3560710">.</span><span class="ident" id="3560711">tmp</span><span class="op" id="3560714">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560717">return</span>&nbsp;<span class="ident" id="3560724">h</span><span class="op" id="3560725">.</span><span class="ident" id="3560726">outer</span><span class="op" id="3560731">.</span><span class="ident" id="3560732">Sum</span><span class="op" id="3560735">(</span><span class="ident" id="3560736">in</span><span class="op" id="3560738">[</span><span class="op" id="3560739">:</span><span class="ident" id="3560740">origLen</span><span class="op" id="3560747">]</span><span class="op" id="3560748">)</span><br>
<span class="lineno"></span><span class="op" id="3560750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3560753">func</span>&nbsp;<span class="op" id="3560758">(</span><span class="ident" id="3560759">h</span>&nbsp;<span class="op" id="3560761">*</span><span class="ident" id="3560762">hmac</span><span class="op" id="3560766">)</span>&nbsp;<span class="ident" id="3560768">Write</span><span class="op" id="3560773">(</span><span class="ident" id="3560774">p</span>&nbsp;<span class="op" id="3560776">[</span><span class="op" id="3560777">]</span><span class="builtintype" id="3560778">byte</span><span class="op" id="3560782">)</span>&nbsp;<span class="op" id="3560784">(</span><span class="ident" id="3560785">n</span>&nbsp;<span class="builtintype" id="3560787">int</span><span class="op" id="3560790">,</span>&nbsp;<span class="ident" id="3560792">err</span>&nbsp;<span class="builtintype" id="3560796">error</span><span class="op" id="3560801">)</span>&nbsp;<span class="op" id="3560803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560806">return</span>&nbsp;<span class="ident" id="3560813">h</span><span class="op" id="3560814">.</span><span class="ident" id="3560815">inner</span><span class="op" id="3560820">.</span><span class="ident" id="3560821">Write</span><span class="op" id="3560826">(</span><span class="ident" id="3560827">p</span><span class="op" id="3560828">)</span><br>
<span class="lineno">65</span><span class="op" id="3560830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3560833">func</span>&nbsp;<span class="op" id="3560838">(</span><span class="ident" id="3560839">h</span>&nbsp;<span class="op" id="3560841">*</span><span class="ident" id="3560842">hmac</span><span class="op" id="3560846">)</span>&nbsp;<span class="ident" id="3560848">Size</span><span class="op" id="3560852">(</span><span class="op" id="3560853">)</span>&nbsp;<span class="builtintype" id="3560855">int</span>&nbsp;<span class="op" id="3560859">{</span>&nbsp;<span class="keyword" id="3560861">return</span>&nbsp;<span class="ident" id="3560868">h</span><span class="op" id="3560869">.</span><span class="ident" id="3560870">size</span>&nbsp;<span class="op" id="3560875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3560878">func</span>&nbsp;<span class="op" id="3560883">(</span><span class="ident" id="3560884">h</span>&nbsp;<span class="op" id="3560886">*</span><span class="ident" id="3560887">hmac</span><span class="op" id="3560891">)</span>&nbsp;<span class="ident" id="3560893">BlockSize</span><span class="op" id="3560902">(</span><span class="op" id="3560903">)</span>&nbsp;<span class="builtintype" id="3560905">int</span>&nbsp;<span class="op" id="3560909">{</span>&nbsp;<span class="keyword" id="3560911">return</span>&nbsp;<span class="ident" id="3560918">h</span><span class="op" id="3560919">.</span><span class="ident" id="3560920">blocksize</span>&nbsp;<span class="op" id="3560930">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3560933">func</span>&nbsp;<span class="op" id="3560938">(</span><span class="ident" id="3560939">h</span>&nbsp;<span class="op" id="3560941">*</span><span class="ident" id="3560942">hmac</span><span class="op" id="3560946">)</span>&nbsp;<span class="ident" id="3560948">Reset</span><span class="op" id="3560953">(</span><span class="op" id="3560954">)</span>&nbsp;<span class="op" id="3560956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560959">h</span><span class="op" id="3560960">.</span><span class="ident" id="3560961">inner</span><span class="op" id="3560966">.</span><span class="ident" id="3560967">Reset</span><span class="op" id="3560972">(</span><span class="op" id="3560973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560976">h</span><span class="op" id="3560977">.</span><span class="ident" id="3560978">tmpPad</span><span class="op" id="3560984">(</span><span class="num" id="3560985">0x36</span><span class="op" id="3560989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560992">h</span><span class="op" id="3560993">.</span><span class="ident" id="3560994">inner</span><span class="op" id="3560999">.</span><span class="ident" id="3561000">Write</span><span class="op" id="3561005">(</span><span class="ident" id="3561006">h</span><span class="op" id="3561007">.</span><span class="ident" id="3561008">tmp</span><span class="op" id="3561011">[</span><span class="op" id="3561012">:</span><span class="ident" id="3561013">h</span><span class="op" id="3561014">.</span><span class="ident" id="3561015">blocksize</span><span class="op" id="3561024">]</span><span class="op" id="3561025">)</span><br>
<span class="lineno">75</span><span class="op" id="3561027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3561030">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;HMAC&nbsp;hash&nbsp;using&nbsp;the&nbsp;given&nbsp;hash.Hash&nbsp;type&nbsp;and&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3561101">func</span>&nbsp;<span class="ident" id="3561106">New</span><span class="op" id="3561109">(</span><span class="ident" id="3561110">h</span>&nbsp;<span class="keyword" id="3561112">func</span><span class="op" id="3561116">(</span><span class="op" id="3561117">)</span>&nbsp;<span class="ident" id="3561119">hash</span><span class="op" id="3561123">.</span><span class="ident" id="3561124">Hash</span><span class="op" id="3561128">,</span>&nbsp;<span class="ident" id="3561130">key</span>&nbsp;<span class="op" id="3561134">[</span><span class="op" id="3561135">]</span><span class="builtintype" id="3561136">byte</span><span class="op" id="3561140">)</span>&nbsp;<span class="ident" id="3561142">hash</span><span class="op" id="3561146">.</span><span class="ident" id="3561147">Hash</span>&nbsp;<span class="op" id="3561152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561155">hm</span>&nbsp;<span class="op" id="3561158">:=</span>&nbsp;<span class="builtinfunc" id="3561161">new</span><span class="op" id="3561164">(</span><span class="ident" id="3561165">hmac</span><span class="op" id="3561169">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561172">hm</span><span class="op" id="3561174">.</span><span class="ident" id="3561175">outer</span>&nbsp;<span class="op" id="3561181">=</span>&nbsp;<span class="ident" id="3561183">h</span><span class="op" id="3561184">(</span><span class="op" id="3561185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561188">hm</span><span class="op" id="3561190">.</span><span class="ident" id="3561191">inner</span>&nbsp;<span class="op" id="3561197">=</span>&nbsp;<span class="ident" id="3561199">h</span><span class="op" id="3561200">(</span><span class="op" id="3561201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561204">hm</span><span class="op" id="3561206">.</span><span class="ident" id="3561207">size</span>&nbsp;<span class="op" id="3561212">=</span>&nbsp;<span class="ident" id="3561214">hm</span><span class="op" id="3561216">.</span><span class="ident" id="3561217">inner</span><span class="op" id="3561222">.</span><span class="ident" id="3561223">Size</span><span class="op" id="3561227">(</span><span class="op" id="3561228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561231">hm</span><span class="op" id="3561233">.</span><span class="ident" id="3561234">blocksize</span>&nbsp;<span class="op" id="3561244">=</span>&nbsp;<span class="ident" id="3561246">hm</span><span class="op" id="3561248">.</span><span class="ident" id="3561249">inner</span><span class="op" id="3561254">.</span><span class="ident" id="3561255">BlockSize</span><span class="op" id="3561264">(</span><span class="op" id="3561265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561268">hm</span><span class="op" id="3561270">.</span><span class="ident" id="3561271">tmp</span>&nbsp;<span class="op" id="3561275">=</span>&nbsp;<span class="builtinfunc" id="3561277">make</span><span class="op" id="3561281">(</span><span class="op" id="3561282">[</span><span class="op" id="3561283">]</span><span class="builtintype" id="3561284">byte</span><span class="op" id="3561288">,</span>&nbsp;<span class="ident" id="3561290">hm</span><span class="op" id="3561292">.</span><span class="ident" id="3561293">blocksize</span><span class="op" id="3561302">+</span><span class="ident" id="3561303">hm</span><span class="op" id="3561305">.</span><span class="ident" id="3561306">size</span><span class="op" id="3561310">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561313">if</span>&nbsp;<span class="builtinfunc" id="3561316">len</span><span class="op" id="3561319">(</span><span class="ident" id="3561320">key</span><span class="op" id="3561323">)</span>&nbsp;<span class="op" id="3561325">&gt;</span>&nbsp;<span class="ident" id="3561327">hm</span><span class="op" id="3561329">.</span><span class="ident" id="3561330">blocksize</span>&nbsp;<span class="op" id="3561340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3561344">//&nbsp;If&nbsp;key&nbsp;is&nbsp;too&nbsp;big,&nbsp;hash&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561377">hm</span><span class="op" id="3561379">.</span><span class="ident" id="3561380">outer</span><span class="op" id="3561385">.</span><span class="ident" id="3561386">Write</span><span class="op" id="3561391">(</span><span class="ident" id="3561392">key</span><span class="op" id="3561395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561399">key</span>&nbsp;<span class="op" id="3561403">=</span>&nbsp;<span class="ident" id="3561405">hm</span><span class="op" id="3561407">.</span><span class="ident" id="3561408">outer</span><span class="op" id="3561413">.</span><span class="ident" id="3561414">Sum</span><span class="op" id="3561417">(</span><span class="ident" id="3561418">nil</span><span class="op" id="3561421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561424">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561427">hm</span><span class="op" id="3561429">.</span><span class="ident" id="3561430">key</span>&nbsp;<span class="op" id="3561434">=</span>&nbsp;<span class="builtinfunc" id="3561436">make</span><span class="op" id="3561440">(</span><span class="op" id="3561441">[</span><span class="op" id="3561442">]</span><span class="builtintype" id="3561443">byte</span><span class="op" id="3561447">,</span>&nbsp;<span class="builtinfunc" id="3561449">len</span><span class="op" id="3561452">(</span><span class="ident" id="3561453">key</span><span class="op" id="3561456">)</span><span class="op" id="3561457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3561460">copy</span><span class="op" id="3561464">(</span><span class="ident" id="3561465">hm</span><span class="op" id="3561467">.</span><span class="ident" id="3561468">key</span><span class="op" id="3561471">,</span>&nbsp;<span class="ident" id="3561473">key</span><span class="op" id="3561476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561479">hm</span><span class="op" id="3561481">.</span><span class="ident" id="3561482">Reset</span><span class="op" id="3561487">(</span><span class="op" id="3561488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561491">return</span>&nbsp;<span class="ident" id="3561498">hm</span><br>
<span class="lineno"></span><span class="op" id="3561501">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="3561504">//&nbsp;Equal&nbsp;compares&nbsp;two&nbsp;MACs&nbsp;for&nbsp;equality&nbsp;without&nbsp;leaking&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="3561580">func</span>&nbsp;<span class="ident" id="3561585">Equal</span><span class="op" id="3561590">(</span><span class="ident" id="3561591">mac1</span><span class="op" id="3561595">,</span>&nbsp;<span class="ident" id="3561597">mac2</span>&nbsp;<span class="op" id="3561602">[</span><span class="op" id="3561603">]</span><span class="builtintype" id="3561604">byte</span><span class="op" id="3561608">)</span>&nbsp;<span class="builtintype" id="3561610">bool</span>&nbsp;<span class="op" id="3561615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3561618">//&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;constant&nbsp;time&nbsp;if&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MACs&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3561687">//&nbsp;different&nbsp;as&nbsp;that&nbsp;suggests&nbsp;that&nbsp;a&nbsp;completely&nbsp;different&nbsp;hash&nbsp;function</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3561760">//&nbsp;was&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561774">return</span>&nbsp;<span class="builtinfunc" id="3561781">len</span><span class="op" id="3561784">(</span><span class="ident" id="3561785">mac1</span><span class="op" id="3561789">)</span>&nbsp;<span class="op" id="3561791">==</span>&nbsp;<span class="builtinfunc" id="3561794">len</span><span class="op" id="3561797">(</span><span class="ident" id="3561798">mac2</span><span class="op" id="3561802">)</span>&nbsp;<span class="op" id="3561804">&amp;&amp;</span>&nbsp;<span class="ident" id="3561807">subtle</span><span class="op" id="3561813">.</span><span class="ident" id="3561814">ConstantTimeCompare</span><span class="op" id="3561833">(</span><span class="ident" id="3561834">mac1</span><span class="op" id="3561838">,</span>&nbsp;<span class="ident" id="3561840">mac2</span><span class="op" id="3561844">)</span>&nbsp;<span class="op" id="3561846">==</span>&nbsp;<span class="num" id="3561849">1</span><br>
<span class="lineno"></span><span class="op" id="3561851">}</span>
</div>
</body>
</html>
