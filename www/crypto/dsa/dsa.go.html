<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4258835">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4258890">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4258944">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4258995">//&nbsp;Package&nbsp;dsa&nbsp;implements&nbsp;the&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4259080">package</span>&nbsp;<span class="ident" id="4259088">dsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4259093">import</span>&nbsp;<span class="op" id="4259100">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4259103">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4259113">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4259119">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4259130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4259133">//&nbsp;Parameters&nbsp;represents&nbsp;the&nbsp;domain&nbsp;parameters&nbsp;for&nbsp;a&nbsp;key.&nbsp;These&nbsp;parameters&nbsp;can</span><br>
<span class="lineno">15</span><span class="comment" id="4259212">//&nbsp;be&nbsp;shared&nbsp;across&nbsp;many&nbsp;keys.&nbsp;The&nbsp;bit&nbsp;length&nbsp;of&nbsp;Q&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="4259288">type</span>&nbsp;<span class="ident" id="4259293">Parameters</span>&nbsp;<span class="keyword" id="4259304">struct</span>&nbsp;<span class="op" id="4259311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259314">P</span><span class="op" id="4259315">,</span>&nbsp;<span class="ident" id="4259317">Q</span><span class="op" id="4259318">,</span>&nbsp;<span class="ident" id="4259320">G</span>&nbsp;<span class="op" id="4259322">*</span><span class="ident" id="4259323">big</span><span class="op" id="4259326">.</span><span class="ident" id="4259327">Int</span><br>
<span class="lineno"></span><span class="op" id="4259331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4259334">//&nbsp;PublicKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4259376">type</span>&nbsp;<span class="ident" id="4259381">PublicKey</span>&nbsp;<span class="keyword" id="4259391">struct</span>&nbsp;<span class="op" id="4259398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259401">Parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259413">Y</span>&nbsp;<span class="op" id="4259415">*</span><span class="ident" id="4259416">big</span><span class="op" id="4259419">.</span><span class="ident" id="4259420">Int</span><br>
<span class="lineno"></span><span class="op" id="4259424">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4259427">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4259471">type</span>&nbsp;<span class="ident" id="4259476">PrivateKey</span>&nbsp;<span class="keyword" id="4259487">struct</span>&nbsp;<span class="op" id="4259494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259497">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259508">X</span>&nbsp;<span class="op" id="4259510">*</span><span class="ident" id="4259511">big</span><span class="op" id="4259514">.</span><span class="ident" id="4259515">Int</span><br>
<span class="lineno">30</span><span class="op" id="4259519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4259522">//&nbsp;ErrInvalidPublicKey&nbsp;results&nbsp;when&nbsp;a&nbsp;public&nbsp;key&nbsp;is&nbsp;not&nbsp;usable&nbsp;by&nbsp;this&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4259599">//&nbsp;FIPS&nbsp;is&nbsp;quite&nbsp;strict&nbsp;about&nbsp;the&nbsp;format&nbsp;of&nbsp;DSA&nbsp;keys,&nbsp;but&nbsp;other&nbsp;code&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4259675">//&nbsp;less&nbsp;so.&nbsp;Thus,&nbsp;when&nbsp;using&nbsp;keys&nbsp;which&nbsp;may&nbsp;have&nbsp;been&nbsp;generated&nbsp;by&nbsp;other&nbsp;code,</span><br>
<span class="lineno">35</span><span class="comment" id="4259754">//&nbsp;this&nbsp;error&nbsp;must&nbsp;be&nbsp;handled.</span><br>
<span class="lineno"></span><span class="keyword" id="4259785">var</span>&nbsp;<span class="ident" id="4259789">ErrInvalidPublicKey</span>&nbsp;<span class="op" id="4259809">=</span>&nbsp;<span class="ident" id="4259811">errors</span><span class="op" id="4259817">.</span><span class="ident" id="4259818">New</span><span class="op" id="4259821">(</span><span class="string" id="4259822">&#34;crypto/dsa:&nbsp;invalid&nbsp;public&nbsp;key&#34;</span><span class="op" id="4259854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4259857">//&nbsp;ParameterSizes&nbsp;is&nbsp;a&nbsp;enumeration&nbsp;of&nbsp;the&nbsp;acceptable&nbsp;bit&nbsp;lengths&nbsp;of&nbsp;the&nbsp;primes</span><br>
<span class="lineno"></span><span class="comment" id="4259936">//&nbsp;in&nbsp;a&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters.&nbsp;See&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno">40</span><span class="keyword" id="4259996">type</span>&nbsp;<span class="ident" id="4260001">ParameterSizes</span>&nbsp;<span class="builtintype" id="4260016">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4260021">const</span>&nbsp;<span class="op" id="4260027">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260030">L1024N160</span>&nbsp;<span class="ident" id="4260040">ParameterSizes</span>&nbsp;<span class="op" id="4260055">=</span>&nbsp;<span class="ident" id="4260057">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260063">L2048N224</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260074">L2048N256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260085">L3072N256</span><br>
<span class="lineno"></span><span class="op" id="4260095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4260098">//&nbsp;numMRTests&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;Miller-Rabin&nbsp;primality&nbsp;tests&nbsp;that&nbsp;we&nbsp;perform.&nbsp;We</span><br>
<span class="lineno">50</span><span class="comment" id="4260178">//&nbsp;pick&nbsp;the&nbsp;largest&nbsp;recommended&nbsp;number&nbsp;from&nbsp;table&nbsp;C.1&nbsp;of&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4260247">const</span>&nbsp;<span class="ident" id="4260253">numMRTests</span>&nbsp;<span class="op" id="4260264">=</span>&nbsp;<span class="num" id="4260266">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4260270">//&nbsp;GenerateParameters&nbsp;puts&nbsp;a&nbsp;random,&nbsp;valid&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters&nbsp;into&nbsp;params.</span><br>
<span class="lineno"></span><span class="comment" id="4260348">//&nbsp;This&nbsp;function&nbsp;takes&nbsp;many&nbsp;seconds,&nbsp;even&nbsp;on&nbsp;fast&nbsp;machines.</span><br>
<span class="lineno">55</span><span class="keyword" id="4260408">func</span>&nbsp;<span class="ident" id="4260413">GenerateParameters</span><span class="op" id="4260431">(</span><span class="ident" id="4260432">params</span>&nbsp;<span class="op" id="4260439">*</span><span class="ident" id="4260440">Parameters</span><span class="op" id="4260450">,</span>&nbsp;<span class="ident" id="4260452">rand</span>&nbsp;<span class="ident" id="4260457">io</span><span class="op" id="4260459">.</span><span class="ident" id="4260460">Reader</span><span class="op" id="4260466">,</span>&nbsp;<span class="ident" id="4260468">sizes</span>&nbsp;<span class="ident" id="4260474">ParameterSizes</span><span class="op" id="4260488">)</span>&nbsp;<span class="op" id="4260490">(</span><span class="ident" id="4260491">err</span>&nbsp;<span class="builtintype" id="4260495">error</span><span class="op" id="4260500">)</span>&nbsp;<span class="op" id="4260502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4260505">//&nbsp;This&nbsp;function&nbsp;doesn&#39;t&nbsp;follow&nbsp;FIPS&nbsp;186-3&nbsp;exactly&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4260576">//&nbsp;use&nbsp;a&nbsp;verification&nbsp;seed&nbsp;to&nbsp;generate&nbsp;the&nbsp;primes.&nbsp;The&nbsp;verification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4260645">//&nbsp;seed&nbsp;doesn&#39;t&nbsp;appear&nbsp;to&nbsp;be&nbsp;exported&nbsp;or&nbsp;used&nbsp;by&nbsp;other&nbsp;code&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4260710">//&nbsp;omitting&nbsp;it&nbsp;makes&nbsp;the&nbsp;code&nbsp;cleaner.</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260751">var</span>&nbsp;<span class="ident" id="4260755">L</span><span class="op" id="4260756">,</span>&nbsp;<span class="ident" id="4260758">N</span>&nbsp;<span class="builtintype" id="4260760">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260765">switch</span>&nbsp;<span class="ident" id="4260772">sizes</span>&nbsp;<span class="op" id="4260778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260781">case</span>&nbsp;<span class="ident" id="4260786">L1024N160</span><span class="op" id="4260795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260799">L</span>&nbsp;<span class="op" id="4260801">=</span>&nbsp;<span class="num" id="4260803">1024</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260810">N</span>&nbsp;<span class="op" id="4260812">=</span>&nbsp;<span class="num" id="4260814">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260819">case</span>&nbsp;<span class="ident" id="4260824">L2048N224</span><span class="op" id="4260833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260837">L</span>&nbsp;<span class="op" id="4260839">=</span>&nbsp;<span class="num" id="4260841">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260848">N</span>&nbsp;<span class="op" id="4260850">=</span>&nbsp;<span class="num" id="4260852">224</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260857">case</span>&nbsp;<span class="ident" id="4260862">L2048N256</span><span class="op" id="4260871">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260875">L</span>&nbsp;<span class="op" id="4260877">=</span>&nbsp;<span class="num" id="4260879">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260886">N</span>&nbsp;<span class="op" id="4260888">=</span>&nbsp;<span class="num" id="4260890">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260895">case</span>&nbsp;<span class="ident" id="4260900">L3072N256</span><span class="op" id="4260909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260913">L</span>&nbsp;<span class="op" id="4260915">=</span>&nbsp;<span class="num" id="4260917">3072</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260924">N</span>&nbsp;<span class="op" id="4260926">=</span>&nbsp;<span class="num" id="4260928">256</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260933">default</span><span class="op" id="4260940">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260944">return</span>&nbsp;<span class="ident" id="4260951">errors</span><span class="op" id="4260957">.</span><span class="ident" id="4260958">New</span><span class="op" id="4260961">(</span><span class="string" id="4260962">&#34;crypto/dsa:&nbsp;invalid&nbsp;ParameterSizes&#34;</span><span class="op" id="4260998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261005">qBytes</span>&nbsp;<span class="op" id="4261012">:=</span>&nbsp;<span class="builtinfunc" id="4261015">make</span><span class="op" id="4261019">(</span><span class="op" id="4261020">[</span><span class="op" id="4261021">]</span><span class="builtintype" id="4261022">byte</span><span class="op" id="4261026">,</span>&nbsp;<span class="ident" id="4261028">N</span><span class="op" id="4261029">/</span><span class="num" id="4261030">8</span><span class="op" id="4261031">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261034">pBytes</span>&nbsp;<span class="op" id="4261041">:=</span>&nbsp;<span class="builtinfunc" id="4261044">make</span><span class="op" id="4261048">(</span><span class="op" id="4261049">[</span><span class="op" id="4261050">]</span><span class="builtintype" id="4261051">byte</span><span class="op" id="4261055">,</span>&nbsp;<span class="ident" id="4261057">L</span><span class="op" id="4261058">/</span><span class="num" id="4261059">8</span><span class="op" id="4261060">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261064">q</span>&nbsp;<span class="op" id="4261066">:=</span>&nbsp;<span class="builtinfunc" id="4261069">new</span><span class="op" id="4261072">(</span><span class="ident" id="4261073">big</span><span class="op" id="4261076">.</span><span class="ident" id="4261077">Int</span><span class="op" id="4261080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261083">p</span>&nbsp;<span class="op" id="4261085">:=</span>&nbsp;<span class="builtinfunc" id="4261088">new</span><span class="op" id="4261091">(</span><span class="ident" id="4261092">big</span><span class="op" id="4261095">.</span><span class="ident" id="4261096">Int</span><span class="op" id="4261099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261102">rem</span>&nbsp;<span class="op" id="4261106">:=</span>&nbsp;<span class="builtinfunc" id="4261109">new</span><span class="op" id="4261112">(</span><span class="ident" id="4261113">big</span><span class="op" id="4261116">.</span><span class="ident" id="4261117">Int</span><span class="op" id="4261120">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261123">one</span>&nbsp;<span class="op" id="4261127">:=</span>&nbsp;<span class="builtinfunc" id="4261130">new</span><span class="op" id="4261133">(</span><span class="ident" id="4261134">big</span><span class="op" id="4261137">.</span><span class="ident" id="4261138">Int</span><span class="op" id="4261141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261144">one</span><span class="op" id="4261147">.</span><span class="ident" id="4261148">SetInt64</span><span class="op" id="4261156">(</span><span class="num" id="4261157">1</span><span class="op" id="4261158">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4261161">GeneratePrimes</span><span class="op" id="4261175">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261178">for</span>&nbsp;<span class="op" id="4261182">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261186">_</span><span class="op" id="4261187">,</span>&nbsp;<span class="ident" id="4261189">err</span>&nbsp;<span class="op" id="4261193">=</span>&nbsp;<span class="ident" id="4261195">io</span><span class="op" id="4261197">.</span><span class="ident" id="4261198">ReadFull</span><span class="op" id="4261206">(</span><span class="ident" id="4261207">rand</span><span class="op" id="4261211">,</span>&nbsp;<span class="ident" id="4261213">qBytes</span><span class="op" id="4261219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261223">if</span>&nbsp;<span class="ident" id="4261226">err</span>&nbsp;<span class="op" id="4261230">!=</span>&nbsp;<span class="ident" id="4261233">nil</span>&nbsp;<span class="op" id="4261237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261242">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261256">qBytes</span><span class="op" id="4261262">[</span><span class="builtinfunc" id="4261263">len</span><span class="op" id="4261266">(</span><span class="ident" id="4261267">qBytes</span><span class="op" id="4261273">)</span><span class="op" id="4261274">-</span><span class="num" id="4261275">1</span><span class="op" id="4261276">]</span>&nbsp;<span class="op" id="4261278">|=</span>&nbsp;<span class="num" id="4261281">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261285">qBytes</span><span class="op" id="4261291">[</span><span class="num" id="4261292">0</span><span class="op" id="4261293">]</span>&nbsp;<span class="op" id="4261295">|=</span>&nbsp;<span class="num" id="4261298">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261305">q</span><span class="op" id="4261306">.</span><span class="ident" id="4261307">SetBytes</span><span class="op" id="4261315">(</span><span class="ident" id="4261316">qBytes</span><span class="op" id="4261322">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261327">if</span>&nbsp;<span class="op" id="4261330">!</span><span class="ident" id="4261331">q</span><span class="op" id="4261332">.</span><span class="ident" id="4261333">ProbablyPrime</span><span class="op" id="4261346">(</span><span class="ident" id="4261347">numMRTests</span><span class="op" id="4261357">)</span>&nbsp;<span class="op" id="4261359">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261364">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261380">for</span>&nbsp;<span class="ident" id="4261384">i</span>&nbsp;<span class="op" id="4261386">:=</span>&nbsp;<span class="num" id="4261389">0</span><span class="op" id="4261390">;</span>&nbsp;<span class="ident" id="4261392">i</span>&nbsp;<span class="op" id="4261394">&lt;</span>&nbsp;<span class="num" id="4261396">4</span><span class="op" id="4261397">*</span><span class="ident" id="4261398">L</span><span class="op" id="4261399">;</span>&nbsp;<span class="ident" id="4261401">i</span><span class="op" id="4261402">++</span>&nbsp;<span class="op" id="4261405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261410">_</span><span class="op" id="4261411">,</span>&nbsp;<span class="ident" id="4261413">err</span>&nbsp;<span class="op" id="4261417">=</span>&nbsp;<span class="ident" id="4261419">io</span><span class="op" id="4261421">.</span><span class="ident" id="4261422">ReadFull</span><span class="op" id="4261430">(</span><span class="ident" id="4261431">rand</span><span class="op" id="4261435">,</span>&nbsp;<span class="ident" id="4261437">pBytes</span><span class="op" id="4261443">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261448">if</span>&nbsp;<span class="ident" id="4261451">err</span>&nbsp;<span class="op" id="4261455">!=</span>&nbsp;<span class="ident" id="4261458">nil</span>&nbsp;<span class="op" id="4261462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261468">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261484">pBytes</span><span class="op" id="4261490">[</span><span class="builtinfunc" id="4261491">len</span><span class="op" id="4261494">(</span><span class="ident" id="4261495">pBytes</span><span class="op" id="4261501">)</span><span class="op" id="4261502">-</span><span class="num" id="4261503">1</span><span class="op" id="4261504">]</span>&nbsp;<span class="op" id="4261506">|=</span>&nbsp;<span class="num" id="4261509">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261514">pBytes</span><span class="op" id="4261520">[</span><span class="num" id="4261521">0</span><span class="op" id="4261522">]</span>&nbsp;<span class="op" id="4261524">|=</span>&nbsp;<span class="num" id="4261527">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261536">p</span><span class="op" id="4261537">.</span><span class="ident" id="4261538">SetBytes</span><span class="op" id="4261546">(</span><span class="ident" id="4261547">pBytes</span><span class="op" id="4261553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261558">rem</span><span class="op" id="4261561">.</span><span class="ident" id="4261562">Mod</span><span class="op" id="4261565">(</span><span class="ident" id="4261566">p</span><span class="op" id="4261567">,</span>&nbsp;<span class="ident" id="4261569">q</span><span class="op" id="4261570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261575">rem</span><span class="op" id="4261578">.</span><span class="ident" id="4261579">Sub</span><span class="op" id="4261582">(</span><span class="ident" id="4261583">rem</span><span class="op" id="4261586">,</span>&nbsp;<span class="ident" id="4261588">one</span><span class="op" id="4261591">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261596">p</span><span class="op" id="4261597">.</span><span class="ident" id="4261598">Sub</span><span class="op" id="4261601">(</span><span class="ident" id="4261602">p</span><span class="op" id="4261603">,</span>&nbsp;<span class="ident" id="4261605">rem</span><span class="op" id="4261608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261613">if</span>&nbsp;<span class="ident" id="4261616">p</span><span class="op" id="4261617">.</span><span class="ident" id="4261618">BitLen</span><span class="op" id="4261624">(</span><span class="op" id="4261625">)</span>&nbsp;<span class="op" id="4261627">&lt;</span>&nbsp;<span class="ident" id="4261629">L</span>&nbsp;<span class="op" id="4261631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261637">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261655">if</span>&nbsp;<span class="op" id="4261658">!</span><span class="ident" id="4261659">p</span><span class="op" id="4261660">.</span><span class="ident" id="4261661">ProbablyPrime</span><span class="op" id="4261674">(</span><span class="ident" id="4261675">numMRTests</span><span class="op" id="4261685">)</span>&nbsp;<span class="op" id="4261687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261693">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261711">params</span><span class="op" id="4261717">.</span><span class="ident" id="4261718">P</span>&nbsp;<span class="op" id="4261720">=</span>&nbsp;<span class="ident" id="4261722">p</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261727">params</span><span class="op" id="4261733">.</span><span class="ident" id="4261734">Q</span>&nbsp;<span class="op" id="4261736">=</span>&nbsp;<span class="ident" id="4261738">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261743">break</span>&nbsp;<span class="ident" id="4261749">GeneratePrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261773">h</span>&nbsp;<span class="op" id="4261775">:=</span>&nbsp;<span class="builtinfunc" id="4261778">new</span><span class="op" id="4261781">(</span><span class="ident" id="4261782">big</span><span class="op" id="4261785">.</span><span class="ident" id="4261786">Int</span><span class="op" id="4261789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261792">h</span><span class="op" id="4261793">.</span><span class="ident" id="4261794">SetInt64</span><span class="op" id="4261802">(</span><span class="num" id="4261803">2</span><span class="op" id="4261804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261807">g</span>&nbsp;<span class="op" id="4261809">:=</span>&nbsp;<span class="builtinfunc" id="4261812">new</span><span class="op" id="4261815">(</span><span class="ident" id="4261816">big</span><span class="op" id="4261819">.</span><span class="ident" id="4261820">Int</span><span class="op" id="4261823">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261827">pm1</span>&nbsp;<span class="op" id="4261831">:=</span>&nbsp;<span class="builtinfunc" id="4261834">new</span><span class="op" id="4261837">(</span><span class="ident" id="4261838">big</span><span class="op" id="4261841">.</span><span class="ident" id="4261842">Int</span><span class="op" id="4261845">)</span><span class="op" id="4261846">.</span><span class="ident" id="4261847">Sub</span><span class="op" id="4261850">(</span><span class="ident" id="4261851">p</span><span class="op" id="4261852">,</span>&nbsp;<span class="ident" id="4261854">one</span><span class="op" id="4261857">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261860">e</span>&nbsp;<span class="op" id="4261862">:=</span>&nbsp;<span class="builtinfunc" id="4261865">new</span><span class="op" id="4261868">(</span><span class="ident" id="4261869">big</span><span class="op" id="4261872">.</span><span class="ident" id="4261873">Int</span><span class="op" id="4261876">)</span><span class="op" id="4261877">.</span><span class="ident" id="4261878">Div</span><span class="op" id="4261881">(</span><span class="ident" id="4261882">pm1</span><span class="op" id="4261885">,</span>&nbsp;<span class="ident" id="4261887">q</span><span class="op" id="4261888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261892">for</span>&nbsp;<span class="op" id="4261896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261900">g</span><span class="op" id="4261901">.</span><span class="ident" id="4261902">Exp</span><span class="op" id="4261905">(</span><span class="ident" id="4261906">h</span><span class="op" id="4261907">,</span>&nbsp;<span class="ident" id="4261909">e</span><span class="op" id="4261910">,</span>&nbsp;<span class="ident" id="4261912">p</span><span class="op" id="4261913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261917">if</span>&nbsp;<span class="ident" id="4261920">g</span><span class="op" id="4261921">.</span><span class="ident" id="4261922">Cmp</span><span class="op" id="4261925">(</span><span class="ident" id="4261926">one</span><span class="op" id="4261929">)</span>&nbsp;<span class="op" id="4261931">==</span>&nbsp;<span class="num" id="4261934">0</span>&nbsp;<span class="op" id="4261936">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261941">h</span><span class="op" id="4261942">.</span><span class="ident" id="4261943">Add</span><span class="op" id="4261946">(</span><span class="ident" id="4261947">h</span><span class="op" id="4261948">,</span>&nbsp;<span class="ident" id="4261950">one</span><span class="op" id="4261953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261958">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261974">params</span><span class="op" id="4261980">.</span><span class="ident" id="4261981">G</span>&nbsp;<span class="op" id="4261983">=</span>&nbsp;<span class="ident" id="4261985">g</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261989">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261997">}</span><br>
<span class="lineno"></span><span class="op" id="4261999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4262002">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&amp;private&nbsp;key&nbsp;pair.&nbsp;The&nbsp;Parameters&nbsp;of&nbsp;the</span><br>
<span class="lineno">150</span><span class="comment" id="4262076">//&nbsp;PrivateKey&nbsp;must&nbsp;already&nbsp;be&nbsp;valid&nbsp;(see&nbsp;GenerateParameters).</span><br>
<span class="lineno"></span><span class="keyword" id="4262138">func</span>&nbsp;<span class="ident" id="4262143">GenerateKey</span><span class="op" id="4262154">(</span><span class="ident" id="4262155">priv</span>&nbsp;<span class="op" id="4262160">*</span><span class="ident" id="4262161">PrivateKey</span><span class="op" id="4262171">,</span>&nbsp;<span class="ident" id="4262173">rand</span>&nbsp;<span class="ident" id="4262178">io</span><span class="op" id="4262180">.</span><span class="ident" id="4262181">Reader</span><span class="op" id="4262187">)</span>&nbsp;<span class="builtintype" id="4262189">error</span>&nbsp;<span class="op" id="4262195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262198">if</span>&nbsp;<span class="ident" id="4262201">priv</span><span class="op" id="4262205">.</span><span class="ident" id="4262206">P</span>&nbsp;<span class="op" id="4262208">==</span>&nbsp;<span class="ident" id="4262211">nil</span>&nbsp;<span class="op" id="4262215">||</span>&nbsp;<span class="ident" id="4262218">priv</span><span class="op" id="4262222">.</span><span class="ident" id="4262223">Q</span>&nbsp;<span class="op" id="4262225">==</span>&nbsp;<span class="ident" id="4262228">nil</span>&nbsp;<span class="op" id="4262232">||</span>&nbsp;<span class="ident" id="4262235">priv</span><span class="op" id="4262239">.</span><span class="ident" id="4262240">G</span>&nbsp;<span class="op" id="4262242">==</span>&nbsp;<span class="ident" id="4262245">nil</span>&nbsp;<span class="op" id="4262249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262253">return</span>&nbsp;<span class="ident" id="4262260">errors</span><span class="op" id="4262266">.</span><span class="ident" id="4262267">New</span><span class="op" id="4262270">(</span><span class="string" id="4262271">&#34;crypto/dsa:&nbsp;parameters&nbsp;not&nbsp;set&nbsp;up&nbsp;before&nbsp;generating&nbsp;key&#34;</span><span class="op" id="4262328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262331">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262335">x</span>&nbsp;<span class="op" id="4262337">:=</span>&nbsp;<span class="builtinfunc" id="4262340">new</span><span class="op" id="4262343">(</span><span class="ident" id="4262344">big</span><span class="op" id="4262347">.</span><span class="ident" id="4262348">Int</span><span class="op" id="4262351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262354">xBytes</span>&nbsp;<span class="op" id="4262361">:=</span>&nbsp;<span class="builtinfunc" id="4262364">make</span><span class="op" id="4262368">(</span><span class="op" id="4262369">[</span><span class="op" id="4262370">]</span><span class="builtintype" id="4262371">byte</span><span class="op" id="4262375">,</span>&nbsp;<span class="ident" id="4262377">priv</span><span class="op" id="4262381">.</span><span class="ident" id="4262382">Q</span><span class="op" id="4262383">.</span><span class="ident" id="4262384">BitLen</span><span class="op" id="4262390">(</span><span class="op" id="4262391">)</span><span class="op" id="4262392">/</span><span class="num" id="4262393">8</span><span class="op" id="4262394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262398">for</span>&nbsp;<span class="op" id="4262402">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262406">_</span><span class="op" id="4262407">,</span>&nbsp;<span class="ident" id="4262409">err</span>&nbsp;<span class="op" id="4262413">:=</span>&nbsp;<span class="ident" id="4262416">io</span><span class="op" id="4262418">.</span><span class="ident" id="4262419">ReadFull</span><span class="op" id="4262427">(</span><span class="ident" id="4262428">rand</span><span class="op" id="4262432">,</span>&nbsp;<span class="ident" id="4262434">xBytes</span><span class="op" id="4262440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262444">if</span>&nbsp;<span class="ident" id="4262447">err</span>&nbsp;<span class="op" id="4262451">!=</span>&nbsp;<span class="ident" id="4262454">nil</span>&nbsp;<span class="op" id="4262458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262463">return</span>&nbsp;<span class="ident" id="4262470">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262480">x</span><span class="op" id="4262481">.</span><span class="ident" id="4262482">SetBytes</span><span class="op" id="4262490">(</span><span class="ident" id="4262491">xBytes</span><span class="op" id="4262497">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262501">if</span>&nbsp;<span class="ident" id="4262504">x</span><span class="op" id="4262505">.</span><span class="ident" id="4262506">Sign</span><span class="op" id="4262510">(</span><span class="op" id="4262511">)</span>&nbsp;<span class="op" id="4262513">!=</span>&nbsp;<span class="num" id="4262516">0</span>&nbsp;<span class="op" id="4262518">&amp;&amp;</span>&nbsp;<span class="ident" id="4262521">x</span><span class="op" id="4262522">.</span><span class="ident" id="4262523">Cmp</span><span class="op" id="4262526">(</span><span class="ident" id="4262527">priv</span><span class="op" id="4262531">.</span><span class="ident" id="4262532">Q</span><span class="op" id="4262533">)</span>&nbsp;<span class="op" id="4262535">&lt;</span>&nbsp;<span class="num" id="4262537">0</span>&nbsp;<span class="op" id="4262539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262544">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262559">priv</span><span class="op" id="4262563">.</span><span class="ident" id="4262564">X</span>&nbsp;<span class="op" id="4262566">=</span>&nbsp;<span class="ident" id="4262568">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262571">priv</span><span class="op" id="4262575">.</span><span class="ident" id="4262576">Y</span>&nbsp;<span class="op" id="4262578">=</span>&nbsp;<span class="builtinfunc" id="4262580">new</span><span class="op" id="4262583">(</span><span class="ident" id="4262584">big</span><span class="op" id="4262587">.</span><span class="ident" id="4262588">Int</span><span class="op" id="4262591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262594">priv</span><span class="op" id="4262598">.</span><span class="ident" id="4262599">Y</span><span class="op" id="4262600">.</span><span class="ident" id="4262601">Exp</span><span class="op" id="4262604">(</span><span class="ident" id="4262605">priv</span><span class="op" id="4262609">.</span><span class="ident" id="4262610">G</span><span class="op" id="4262611">,</span>&nbsp;<span class="ident" id="4262613">x</span><span class="op" id="4262614">,</span>&nbsp;<span class="ident" id="4262616">priv</span><span class="op" id="4262620">.</span><span class="ident" id="4262621">P</span><span class="op" id="4262622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262625">return</span>&nbsp;<span class="ident" id="4262632">nil</span><br>
<span class="lineno"></span><span class="op" id="4262636">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4262639">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4262716">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4262794">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4262865">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">180</span><span class="keyword" id="4262903">func</span>&nbsp;<span class="ident" id="4262908">fermatInverse</span><span class="op" id="4262921">(</span><span class="ident" id="4262922">k</span><span class="op" id="4262923">,</span>&nbsp;<span class="ident" id="4262925">P</span>&nbsp;<span class="op" id="4262927">*</span><span class="ident" id="4262928">big</span><span class="op" id="4262931">.</span><span class="ident" id="4262932">Int</span><span class="op" id="4262935">)</span>&nbsp;<span class="op" id="4262937">*</span><span class="ident" id="4262938">big</span><span class="op" id="4262941">.</span><span class="ident" id="4262942">Int</span>&nbsp;<span class="op" id="4262946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262949">two</span>&nbsp;<span class="op" id="4262953">:=</span>&nbsp;<span class="ident" id="4262956">big</span><span class="op" id="4262959">.</span><span class="ident" id="4262960">NewInt</span><span class="op" id="4262966">(</span><span class="num" id="4262967">2</span><span class="op" id="4262968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262971">pMinus2</span>&nbsp;<span class="op" id="4262979">:=</span>&nbsp;<span class="builtinfunc" id="4262982">new</span><span class="op" id="4262985">(</span><span class="ident" id="4262986">big</span><span class="op" id="4262989">.</span><span class="ident" id="4262990">Int</span><span class="op" id="4262993">)</span><span class="op" id="4262994">.</span><span class="ident" id="4262995">Sub</span><span class="op" id="4262998">(</span><span class="ident" id="4262999">P</span><span class="op" id="4263000">,</span>&nbsp;<span class="ident" id="4263002">two</span><span class="op" id="4263005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263008">return</span>&nbsp;<span class="builtinfunc" id="4263015">new</span><span class="op" id="4263018">(</span><span class="ident" id="4263019">big</span><span class="op" id="4263022">.</span><span class="ident" id="4263023">Int</span><span class="op" id="4263026">)</span><span class="op" id="4263027">.</span><span class="ident" id="4263028">Exp</span><span class="op" id="4263031">(</span><span class="ident" id="4263032">k</span><span class="op" id="4263033">,</span>&nbsp;<span class="ident" id="4263035">pMinus2</span><span class="op" id="4263042">,</span>&nbsp;<span class="ident" id="4263044">P</span><span class="op" id="4263045">)</span><br>
<span class="lineno"></span><span class="op" id="4263047">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="4263050">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4263130">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4263208">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4263287">//&nbsp;rand.</span><br>
<span class="lineno">190</span><span class="comment" id="4263296">//</span><br>
<span class="lineno"></span><span class="comment" id="4263299">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4263379">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4263454">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4263476">func</span>&nbsp;<span class="ident" id="4263481">Sign</span><span class="op" id="4263485">(</span><span class="ident" id="4263486">rand</span>&nbsp;<span class="ident" id="4263491">io</span><span class="op" id="4263493">.</span><span class="ident" id="4263494">Reader</span><span class="op" id="4263500">,</span>&nbsp;<span class="ident" id="4263502">priv</span>&nbsp;<span class="op" id="4263507">*</span><span class="ident" id="4263508">PrivateKey</span><span class="op" id="4263518">,</span>&nbsp;<span class="ident" id="4263520">hash</span>&nbsp;<span class="op" id="4263525">[</span><span class="op" id="4263526">]</span><span class="builtintype" id="4263527">byte</span><span class="op" id="4263531">)</span>&nbsp;<span class="op" id="4263533">(</span><span class="ident" id="4263534">r</span><span class="op" id="4263535">,</span>&nbsp;<span class="ident" id="4263537">s</span>&nbsp;<span class="op" id="4263539">*</span><span class="ident" id="4263540">big</span><span class="op" id="4263543">.</span><span class="ident" id="4263544">Int</span><span class="op" id="4263547">,</span>&nbsp;<span class="ident" id="4263549">err</span>&nbsp;<span class="builtintype" id="4263553">error</span><span class="op" id="4263558">)</span>&nbsp;<span class="op" id="4263560">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263563">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263592">n</span>&nbsp;<span class="op" id="4263594">:=</span>&nbsp;<span class="ident" id="4263597">priv</span><span class="op" id="4263601">.</span><span class="ident" id="4263602">Q</span><span class="op" id="4263603">.</span><span class="ident" id="4263604">BitLen</span><span class="op" id="4263610">(</span><span class="op" id="4263611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263614">if</span>&nbsp;<span class="ident" id="4263617">n</span><span class="op" id="4263618">&amp;</span><span class="num" id="4263619">7</span>&nbsp;<span class="op" id="4263621">!=</span>&nbsp;<span class="num" id="4263624">0</span>&nbsp;<span class="op" id="4263626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263630">err</span>&nbsp;<span class="op" id="4263634">=</span>&nbsp;<span class="ident" id="4263636">ErrInvalidPublicKey</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263658">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263669">n</span>&nbsp;<span class="op" id="4263671">&gt;&gt;=</span>&nbsp;<span class="num" id="4263675">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263679">for</span>&nbsp;<span class="op" id="4263683">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263687">k</span>&nbsp;<span class="op" id="4263689">:=</span>&nbsp;<span class="builtinfunc" id="4263692">new</span><span class="op" id="4263695">(</span><span class="ident" id="4263696">big</span><span class="op" id="4263699">.</span><span class="ident" id="4263700">Int</span><span class="op" id="4263703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263707">buf</span>&nbsp;<span class="op" id="4263711">:=</span>&nbsp;<span class="builtinfunc" id="4263714">make</span><span class="op" id="4263718">(</span><span class="op" id="4263719">[</span><span class="op" id="4263720">]</span><span class="builtintype" id="4263721">byte</span><span class="op" id="4263725">,</span>&nbsp;<span class="ident" id="4263727">n</span><span class="op" id="4263728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263732">for</span>&nbsp;<span class="op" id="4263736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263741">_</span><span class="op" id="4263742">,</span>&nbsp;<span class="ident" id="4263744">err</span>&nbsp;<span class="op" id="4263748">=</span>&nbsp;<span class="ident" id="4263750">io</span><span class="op" id="4263752">.</span><span class="ident" id="4263753">ReadFull</span><span class="op" id="4263761">(</span><span class="ident" id="4263762">rand</span><span class="op" id="4263766">,</span>&nbsp;<span class="ident" id="4263768">buf</span><span class="op" id="4263771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263776">if</span>&nbsp;<span class="ident" id="4263779">err</span>&nbsp;<span class="op" id="4263783">!=</span>&nbsp;<span class="ident" id="4263786">nil</span>&nbsp;<span class="op" id="4263790">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263796">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263811">k</span><span class="op" id="4263812">.</span><span class="ident" id="4263813">SetBytes</span><span class="op" id="4263821">(</span><span class="ident" id="4263822">buf</span><span class="op" id="4263825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263830">if</span>&nbsp;<span class="ident" id="4263833">k</span><span class="op" id="4263834">.</span><span class="ident" id="4263835">Sign</span><span class="op" id="4263839">(</span><span class="op" id="4263840">)</span>&nbsp;<span class="op" id="4263842">&gt;</span>&nbsp;<span class="num" id="4263844">0</span>&nbsp;<span class="op" id="4263846">&amp;&amp;</span>&nbsp;<span class="ident" id="4263849">k</span><span class="op" id="4263850">.</span><span class="ident" id="4263851">Cmp</span><span class="op" id="4263854">(</span><span class="ident" id="4263855">priv</span><span class="op" id="4263859">.</span><span class="ident" id="4263860">Q</span><span class="op" id="4263861">)</span>&nbsp;<span class="op" id="4263863">&lt;</span>&nbsp;<span class="num" id="4263865">0</span>&nbsp;<span class="op" id="4263867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263873">break</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263891">kInv</span>&nbsp;<span class="op" id="4263896">:=</span>&nbsp;<span class="ident" id="4263899">fermatInverse</span><span class="op" id="4263912">(</span><span class="ident" id="4263913">k</span><span class="op" id="4263914">,</span>&nbsp;<span class="ident" id="4263916">priv</span><span class="op" id="4263920">.</span><span class="ident" id="4263921">Q</span><span class="op" id="4263922">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263927">r</span>&nbsp;<span class="op" id="4263929">=</span>&nbsp;<span class="builtinfunc" id="4263931">new</span><span class="op" id="4263934">(</span><span class="ident" id="4263935">big</span><span class="op" id="4263938">.</span><span class="ident" id="4263939">Int</span><span class="op" id="4263942">)</span><span class="op" id="4263943">.</span><span class="ident" id="4263944">Exp</span><span class="op" id="4263947">(</span><span class="ident" id="4263948">priv</span><span class="op" id="4263952">.</span><span class="ident" id="4263953">G</span><span class="op" id="4263954">,</span>&nbsp;<span class="ident" id="4263956">k</span><span class="op" id="4263957">,</span>&nbsp;<span class="ident" id="4263959">priv</span><span class="op" id="4263963">.</span><span class="ident" id="4263964">P</span><span class="op" id="4263965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263969">r</span><span class="op" id="4263970">.</span><span class="ident" id="4263971">Mod</span><span class="op" id="4263974">(</span><span class="ident" id="4263975">r</span><span class="op" id="4263976">,</span>&nbsp;<span class="ident" id="4263978">priv</span><span class="op" id="4263982">.</span><span class="ident" id="4263983">Q</span><span class="op" id="4263984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263989">if</span>&nbsp;<span class="ident" id="4263992">r</span><span class="op" id="4263993">.</span><span class="ident" id="4263994">Sign</span><span class="op" id="4263998">(</span><span class="op" id="4263999">)</span>&nbsp;<span class="op" id="4264001">==</span>&nbsp;<span class="num" id="4264004">0</span>&nbsp;<span class="op" id="4264006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264011">continue</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264027">z</span>&nbsp;<span class="op" id="4264029">:=</span>&nbsp;<span class="ident" id="4264032">k</span><span class="op" id="4264033">.</span><span class="ident" id="4264034">SetBytes</span><span class="op" id="4264042">(</span><span class="ident" id="4264043">hash</span><span class="op" id="4264047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264052">s</span>&nbsp;<span class="op" id="4264054">=</span>&nbsp;<span class="builtinfunc" id="4264056">new</span><span class="op" id="4264059">(</span><span class="ident" id="4264060">big</span><span class="op" id="4264063">.</span><span class="ident" id="4264064">Int</span><span class="op" id="4264067">)</span><span class="op" id="4264068">.</span><span class="ident" id="4264069">Mul</span><span class="op" id="4264072">(</span><span class="ident" id="4264073">priv</span><span class="op" id="4264077">.</span><span class="ident" id="4264078">X</span><span class="op" id="4264079">,</span>&nbsp;<span class="ident" id="4264081">r</span><span class="op" id="4264082">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264086">s</span><span class="op" id="4264087">.</span><span class="ident" id="4264088">Add</span><span class="op" id="4264091">(</span><span class="ident" id="4264092">s</span><span class="op" id="4264093">,</span>&nbsp;<span class="ident" id="4264095">z</span><span class="op" id="4264096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264100">s</span><span class="op" id="4264101">.</span><span class="ident" id="4264102">Mod</span><span class="op" id="4264105">(</span><span class="ident" id="4264106">s</span><span class="op" id="4264107">,</span>&nbsp;<span class="ident" id="4264109">priv</span><span class="op" id="4264113">.</span><span class="ident" id="4264114">Q</span><span class="op" id="4264115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264119">s</span><span class="op" id="4264120">.</span><span class="ident" id="4264121">Mul</span><span class="op" id="4264124">(</span><span class="ident" id="4264125">s</span><span class="op" id="4264126">,</span>&nbsp;<span class="ident" id="4264128">kInv</span><span class="op" id="4264132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264136">s</span><span class="op" id="4264137">.</span><span class="ident" id="4264138">Mod</span><span class="op" id="4264141">(</span><span class="ident" id="4264142">s</span><span class="op" id="4264143">,</span>&nbsp;<span class="ident" id="4264145">priv</span><span class="op" id="4264149">.</span><span class="ident" id="4264150">Q</span><span class="op" id="4264151">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264156">if</span>&nbsp;<span class="ident" id="4264159">s</span><span class="op" id="4264160">.</span><span class="ident" id="4264161">Sign</span><span class="op" id="4264165">(</span><span class="op" id="4264166">)</span>&nbsp;<span class="op" id="4264168">!=</span>&nbsp;<span class="num" id="4264171">0</span>&nbsp;<span class="op" id="4264173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264178">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264193">return</span><br>
<span class="lineno"></span><span class="op" id="4264200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4264203">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4264282">//&nbsp;reports&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno">245</span><span class="comment" id="4264325">//</span><br>
<span class="lineno"></span><span class="comment" id="4264328">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4264408">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4264483">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4264505">func</span>&nbsp;<span class="ident" id="4264510">Verify</span><span class="op" id="4264516">(</span><span class="ident" id="4264517">pub</span>&nbsp;<span class="op" id="4264521">*</span><span class="ident" id="4264522">PublicKey</span><span class="op" id="4264531">,</span>&nbsp;<span class="ident" id="4264533">hash</span>&nbsp;<span class="op" id="4264538">[</span><span class="op" id="4264539">]</span><span class="builtintype" id="4264540">byte</span><span class="op" id="4264544">,</span>&nbsp;<span class="ident" id="4264546">r</span><span class="op" id="4264547">,</span>&nbsp;<span class="ident" id="4264549">s</span>&nbsp;<span class="op" id="4264551">*</span><span class="ident" id="4264552">big</span><span class="op" id="4264555">.</span><span class="ident" id="4264556">Int</span><span class="op" id="4264559">)</span>&nbsp;<span class="builtintype" id="4264561">bool</span>&nbsp;<span class="op" id="4264566">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4264569">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264598">if</span>&nbsp;<span class="ident" id="4264601">r</span><span class="op" id="4264602">.</span><span class="ident" id="4264603">Sign</span><span class="op" id="4264607">(</span><span class="op" id="4264608">)</span>&nbsp;<span class="op" id="4264610">&lt;</span>&nbsp;<span class="num" id="4264612">1</span>&nbsp;<span class="op" id="4264614">||</span>&nbsp;<span class="ident" id="4264617">r</span><span class="op" id="4264618">.</span><span class="ident" id="4264619">Cmp</span><span class="op" id="4264622">(</span><span class="ident" id="4264623">pub</span><span class="op" id="4264626">.</span><span class="ident" id="4264627">Q</span><span class="op" id="4264628">)</span>&nbsp;<span class="op" id="4264630">&gt;=</span>&nbsp;<span class="num" id="4264633">0</span>&nbsp;<span class="op" id="4264635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264639">return</span>&nbsp;<span class="ident" id="4264646">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264653">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264656">if</span>&nbsp;<span class="ident" id="4264659">s</span><span class="op" id="4264660">.</span><span class="ident" id="4264661">Sign</span><span class="op" id="4264665">(</span><span class="op" id="4264666">)</span>&nbsp;<span class="op" id="4264668">&lt;</span>&nbsp;<span class="num" id="4264670">1</span>&nbsp;<span class="op" id="4264672">||</span>&nbsp;<span class="ident" id="4264675">s</span><span class="op" id="4264676">.</span><span class="ident" id="4264677">Cmp</span><span class="op" id="4264680">(</span><span class="ident" id="4264681">pub</span><span class="op" id="4264684">.</span><span class="ident" id="4264685">Q</span><span class="op" id="4264686">)</span>&nbsp;<span class="op" id="4264688">&gt;=</span>&nbsp;<span class="num" id="4264691">0</span>&nbsp;<span class="op" id="4264693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264697">return</span>&nbsp;<span class="ident" id="4264704">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264715">w</span>&nbsp;<span class="op" id="4264717">:=</span>&nbsp;<span class="builtinfunc" id="4264720">new</span><span class="op" id="4264723">(</span><span class="ident" id="4264724">big</span><span class="op" id="4264727">.</span><span class="ident" id="4264728">Int</span><span class="op" id="4264731">)</span><span class="op" id="4264732">.</span><span class="ident" id="4264733">ModInverse</span><span class="op" id="4264743">(</span><span class="ident" id="4264744">s</span><span class="op" id="4264745">,</span>&nbsp;<span class="ident" id="4264747">pub</span><span class="op" id="4264750">.</span><span class="ident" id="4264751">Q</span><span class="op" id="4264752">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264756">n</span>&nbsp;<span class="op" id="4264758">:=</span>&nbsp;<span class="ident" id="4264761">pub</span><span class="op" id="4264764">.</span><span class="ident" id="4264765">Q</span><span class="op" id="4264766">.</span><span class="ident" id="4264767">BitLen</span><span class="op" id="4264773">(</span><span class="op" id="4264774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264777">if</span>&nbsp;<span class="ident" id="4264780">n</span><span class="op" id="4264781">&amp;</span><span class="num" id="4264782">7</span>&nbsp;<span class="op" id="4264784">!=</span>&nbsp;<span class="num" id="4264787">0</span>&nbsp;<span class="op" id="4264789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264793">return</span>&nbsp;<span class="ident" id="4264800">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264807">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264810">z</span>&nbsp;<span class="op" id="4264812">:=</span>&nbsp;<span class="builtinfunc" id="4264815">new</span><span class="op" id="4264818">(</span><span class="ident" id="4264819">big</span><span class="op" id="4264822">.</span><span class="ident" id="4264823">Int</span><span class="op" id="4264826">)</span><span class="op" id="4264827">.</span><span class="ident" id="4264828">SetBytes</span><span class="op" id="4264836">(</span><span class="ident" id="4264837">hash</span><span class="op" id="4264841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264845">u1</span>&nbsp;<span class="op" id="4264848">:=</span>&nbsp;<span class="builtinfunc" id="4264851">new</span><span class="op" id="4264854">(</span><span class="ident" id="4264855">big</span><span class="op" id="4264858">.</span><span class="ident" id="4264859">Int</span><span class="op" id="4264862">)</span><span class="op" id="4264863">.</span><span class="ident" id="4264864">Mul</span><span class="op" id="4264867">(</span><span class="ident" id="4264868">z</span><span class="op" id="4264869">,</span>&nbsp;<span class="ident" id="4264871">w</span><span class="op" id="4264872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264875">u1</span><span class="op" id="4264877">.</span><span class="ident" id="4264878">Mod</span><span class="op" id="4264881">(</span><span class="ident" id="4264882">u1</span><span class="op" id="4264884">,</span>&nbsp;<span class="ident" id="4264886">pub</span><span class="op" id="4264889">.</span><span class="ident" id="4264890">Q</span><span class="op" id="4264891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264894">u2</span>&nbsp;<span class="op" id="4264897">:=</span>&nbsp;<span class="ident" id="4264900">w</span><span class="op" id="4264901">.</span><span class="ident" id="4264902">Mul</span><span class="op" id="4264905">(</span><span class="ident" id="4264906">r</span><span class="op" id="4264907">,</span>&nbsp;<span class="ident" id="4264909">w</span><span class="op" id="4264910">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264913">u2</span><span class="op" id="4264915">.</span><span class="ident" id="4264916">Mod</span><span class="op" id="4264919">(</span><span class="ident" id="4264920">u2</span><span class="op" id="4264922">,</span>&nbsp;<span class="ident" id="4264924">pub</span><span class="op" id="4264927">.</span><span class="ident" id="4264928">Q</span><span class="op" id="4264929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264932">v</span>&nbsp;<span class="op" id="4264934">:=</span>&nbsp;<span class="ident" id="4264937">u1</span><span class="op" id="4264939">.</span><span class="ident" id="4264940">Exp</span><span class="op" id="4264943">(</span><span class="ident" id="4264944">pub</span><span class="op" id="4264947">.</span><span class="ident" id="4264948">G</span><span class="op" id="4264949">,</span>&nbsp;<span class="ident" id="4264951">u1</span><span class="op" id="4264953">,</span>&nbsp;<span class="ident" id="4264955">pub</span><span class="op" id="4264958">.</span><span class="ident" id="4264959">P</span><span class="op" id="4264960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264963">u2</span><span class="op" id="4264965">.</span><span class="ident" id="4264966">Exp</span><span class="op" id="4264969">(</span><span class="ident" id="4264970">pub</span><span class="op" id="4264973">.</span><span class="ident" id="4264974">Y</span><span class="op" id="4264975">,</span>&nbsp;<span class="ident" id="4264977">u2</span><span class="op" id="4264979">,</span>&nbsp;<span class="ident" id="4264981">pub</span><span class="op" id="4264984">.</span><span class="ident" id="4264985">P</span><span class="op" id="4264986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264989">v</span><span class="op" id="4264990">.</span><span class="ident" id="4264991">Mul</span><span class="op" id="4264994">(</span><span class="ident" id="4264995">v</span><span class="op" id="4264996">,</span>&nbsp;<span class="ident" id="4264998">u2</span><span class="op" id="4265000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265003">v</span><span class="op" id="4265004">.</span><span class="ident" id="4265005">Mod</span><span class="op" id="4265008">(</span><span class="ident" id="4265009">v</span><span class="op" id="4265010">,</span>&nbsp;<span class="ident" id="4265012">pub</span><span class="op" id="4265015">.</span><span class="ident" id="4265016">P</span><span class="op" id="4265017">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265020">v</span><span class="op" id="4265021">.</span><span class="ident" id="4265022">Mod</span><span class="op" id="4265025">(</span><span class="ident" id="4265026">v</span><span class="op" id="4265027">,</span>&nbsp;<span class="ident" id="4265029">pub</span><span class="op" id="4265032">.</span><span class="ident" id="4265033">Q</span><span class="op" id="4265034">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265038">return</span>&nbsp;<span class="ident" id="4265045">v</span><span class="op" id="4265046">.</span><span class="ident" id="4265047">Cmp</span><span class="op" id="4265050">(</span><span class="ident" id="4265051">r</span><span class="op" id="4265052">)</span>&nbsp;<span class="op" id="4265054">==</span>&nbsp;<span class="num" id="4265057">0</span><br>
<span class="lineno"></span><span class="op" id="4265059">}</span>
</div>
</body>
</html>
