<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6674544">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6674599">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6674653">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6674704">package</span>&nbsp;<span class="ident" id="6674712">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6674718">import</span>&nbsp;<span class="op" id="6674725">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6674728">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6674737">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6674747">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6674753">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6674763">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6674766">var</span>&nbsp;<span class="ident" id="6674770">sizeTests</span>&nbsp;<span class="op" id="6674780">=</span>&nbsp;<span class="op" id="6674782">[</span><span class="op" id="6674783">]</span><span class="keyword" id="6674784">struct</span>&nbsp;<span class="op" id="6674791">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674794">size</span>&nbsp;&nbsp;<span class="builtintype" id="6674800">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6674808">bytes</span>&nbsp;<span class="op" id="6674814">[</span><span class="op" id="6674815">]</span><span class="builtintype" id="6674816">byte</span><br>
<span class="lineno"></span><span class="op" id="6674821">}</span><span class="op" id="6674822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674825">{</span><span class="num" id="6674826">0</span><span class="op" id="6674827">,</span>&nbsp;<span class="op" id="6674829">[</span><span class="op" id="6674830">]</span><span class="builtintype" id="6674831">byte</span><span class="op" id="6674835">{</span><span class="num" id="6674836">0x00</span><span class="op" id="6674840">}</span><span class="op" id="6674841">}</span><span class="op" id="6674842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674845">{</span><span class="num" id="6674846">127</span><span class="op" id="6674849">,</span>&nbsp;<span class="op" id="6674851">[</span><span class="op" id="6674852">]</span><span class="builtintype" id="6674853">byte</span><span class="op" id="6674857">{</span><span class="num" id="6674858">0x7F</span><span class="op" id="6674862">}</span><span class="op" id="6674863">}</span><span class="op" id="6674864">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674867">{</span><span class="num" id="6674868">128</span><span class="op" id="6674871">,</span>&nbsp;<span class="op" id="6674873">[</span><span class="op" id="6674874">]</span><span class="builtintype" id="6674875">byte</span><span class="op" id="6674879">{</span><span class="num" id="6674880">0x80</span><span class="op" id="6674884">,</span>&nbsp;<span class="num" id="6674886">0x00</span><span class="op" id="6674890">,</span>&nbsp;<span class="num" id="6674892">0x00</span><span class="op" id="6674896">,</span>&nbsp;<span class="num" id="6674898">0x80</span><span class="op" id="6674902">}</span><span class="op" id="6674903">}</span><span class="op" id="6674904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674907">{</span><span class="num" id="6674908">1000</span><span class="op" id="6674912">,</span>&nbsp;<span class="op" id="6674914">[</span><span class="op" id="6674915">]</span><span class="builtintype" id="6674916">byte</span><span class="op" id="6674920">{</span><span class="num" id="6674921">0x80</span><span class="op" id="6674925">,</span>&nbsp;<span class="num" id="6674927">0x00</span><span class="op" id="6674931">,</span>&nbsp;<span class="num" id="6674933">0x03</span><span class="op" id="6674937">,</span>&nbsp;<span class="num" id="6674939">0xE8</span><span class="op" id="6674943">}</span><span class="op" id="6674944">}</span><span class="op" id="6674945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6674948">{</span><span class="num" id="6674949">33554431</span><span class="op" id="6674957">,</span>&nbsp;<span class="op" id="6674959">[</span><span class="op" id="6674960">]</span><span class="builtintype" id="6674961">byte</span><span class="op" id="6674965">{</span><span class="num" id="6674966">0x81</span><span class="op" id="6674970">,</span>&nbsp;<span class="num" id="6674972">0xFF</span><span class="op" id="6674976">,</span>&nbsp;<span class="num" id="6674978">0xFF</span><span class="op" id="6674982">,</span>&nbsp;<span class="num" id="6674984">0xFF</span><span class="op" id="6674988">}</span><span class="op" id="6674989">}</span><span class="op" id="6674990">,</span><br>
<span class="lineno"></span><span class="op" id="6674992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6674995">func</span>&nbsp;<span class="ident" id="6675000">TestSize</span><span class="op" id="6675008">(</span><span class="ident" id="6675009">t</span>&nbsp;<span class="op" id="6675011">*</span><span class="ident" id="6675012">testing</span><span class="op" id="6675019">.</span><span class="ident" id="6675020">T</span><span class="op" id="6675021">)</span>&nbsp;<span class="op" id="6675023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675026">b</span>&nbsp;<span class="op" id="6675028">:=</span>&nbsp;<span class="builtinfunc" id="6675031">make</span><span class="op" id="6675035">(</span><span class="op" id="6675036">[</span><span class="op" id="6675037">]</span><span class="builtintype" id="6675038">byte</span><span class="op" id="6675042">,</span>&nbsp;<span class="num" id="6675044">4</span><span class="op" id="6675045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675048">for</span>&nbsp;<span class="ident" id="6675052">i</span><span class="op" id="6675053">,</span>&nbsp;<span class="ident" id="6675055">test</span>&nbsp;<span class="op" id="6675060">:=</span>&nbsp;<span class="keyword" id="6675063">range</span>&nbsp;<span class="ident" id="6675069">sizeTests</span>&nbsp;<span class="op" id="6675079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675083">n</span>&nbsp;<span class="op" id="6675085">:=</span>&nbsp;<span class="ident" id="6675088">encodeSize</span><span class="op" id="6675098">(</span><span class="ident" id="6675099">b</span><span class="op" id="6675100">,</span>&nbsp;<span class="ident" id="6675102">test</span><span class="op" id="6675106">.</span><span class="ident" id="6675107">size</span><span class="op" id="6675111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675115">if</span>&nbsp;<span class="op" id="6675118">!</span><span class="ident" id="6675119">bytes</span><span class="op" id="6675124">.</span><span class="ident" id="6675125">Equal</span><span class="op" id="6675130">(</span><span class="ident" id="6675131">b</span><span class="op" id="6675132">[</span><span class="op" id="6675133">:</span><span class="ident" id="6675134">n</span><span class="op" id="6675135">]</span><span class="op" id="6675136">,</span>&nbsp;<span class="ident" id="6675138">test</span><span class="op" id="6675142">.</span><span class="ident" id="6675143">bytes</span><span class="op" id="6675148">)</span>&nbsp;<span class="op" id="6675150">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675155">t</span><span class="op" id="6675156">.</span><span class="ident" id="6675157">Errorf</span><span class="op" id="6675163">(</span><span class="string" id="6675164">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="6675192">,</span>&nbsp;<span class="ident" id="6675194">i</span><span class="op" id="6675195">,</span>&nbsp;<span class="ident" id="6675197">test</span><span class="op" id="6675201">.</span><span class="ident" id="6675202">bytes</span><span class="op" id="6675207">,</span>&nbsp;<span class="ident" id="6675209">b</span><span class="op" id="6675210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675218">size</span><span class="op" id="6675222">,</span>&nbsp;<span class="ident" id="6675224">n</span>&nbsp;<span class="op" id="6675226">:=</span>&nbsp;<span class="ident" id="6675229">readSize</span><span class="op" id="6675237">(</span><span class="ident" id="6675238">test</span><span class="op" id="6675242">.</span><span class="ident" id="6675243">bytes</span><span class="op" id="6675248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675252">if</span>&nbsp;<span class="ident" id="6675255">size</span>&nbsp;<span class="op" id="6675260">!=</span>&nbsp;<span class="ident" id="6675263">test</span><span class="op" id="6675267">.</span><span class="ident" id="6675268">size</span>&nbsp;<span class="op" id="6675273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675278">t</span><span class="op" id="6675279">.</span><span class="ident" id="6675280">Errorf</span><span class="op" id="6675286">(</span><span class="string" id="6675287">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6675312">,</span>&nbsp;<span class="ident" id="6675314">i</span><span class="op" id="6675315">,</span>&nbsp;<span class="ident" id="6675317">test</span><span class="op" id="6675321">.</span><span class="ident" id="6675322">size</span><span class="op" id="6675326">,</span>&nbsp;<span class="ident" id="6675328">size</span><span class="op" id="6675332">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6675340">if</span>&nbsp;<span class="builtinfunc" id="6675343">len</span><span class="op" id="6675346">(</span><span class="ident" id="6675347">test</span><span class="op" id="6675351">.</span><span class="ident" id="6675352">bytes</span><span class="op" id="6675357">)</span>&nbsp;<span class="op" id="6675359">!=</span>&nbsp;<span class="ident" id="6675362">n</span>&nbsp;<span class="op" id="6675364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675369">t</span><span class="op" id="6675370">.</span><span class="ident" id="6675371">Errorf</span><span class="op" id="6675377">(</span><span class="string" id="6675378">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="6675412">,</span>&nbsp;<span class="ident" id="6675414">i</span><span class="op" id="6675415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675422">}</span><br>
<span class="lineno">40</span><span class="op" id="6675424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6675427">var</span>&nbsp;<span class="ident" id="6675431">streamTests</span>&nbsp;<span class="op" id="6675443">=</span>&nbsp;<span class="op" id="6675445">[</span><span class="op" id="6675446">]</span><span class="keyword" id="6675447">struct</span>&nbsp;<span class="op" id="6675454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675457">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6675465">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675473">recType</span>&nbsp;<span class="ident" id="6675481">recType</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675490">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6675498">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675506">content</span>&nbsp;<span class="op" id="6675514">[</span><span class="op" id="6675515">]</span><span class="builtintype" id="6675516">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675522">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6675530">[</span><span class="op" id="6675531">]</span><span class="builtintype" id="6675532">byte</span><br>
<span class="lineno"></span><span class="op" id="6675537">}</span><span class="op" id="6675538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675541">{</span><span class="string" id="6675542">&#34;single&nbsp;record&#34;</span><span class="op" id="6675557">,</span>&nbsp;<span class="ident" id="6675559">typeStdout</span><span class="op" id="6675569">,</span>&nbsp;<span class="num" id="6675571">1</span><span class="op" id="6675572">,</span>&nbsp;<span class="ident" id="6675574">nil</span><span class="op" id="6675577">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675581">[</span><span class="op" id="6675582">]</span><span class="builtintype" id="6675583">byte</span><span class="op" id="6675587">{</span><span class="num" id="6675588">1</span><span class="op" id="6675589">,</span>&nbsp;<span class="builtintype" id="6675591">byte</span><span class="op" id="6675595">(</span><span class="ident" id="6675596">typeStdout</span><span class="op" id="6675606">)</span><span class="op" id="6675607">,</span>&nbsp;<span class="num" id="6675609">0</span><span class="op" id="6675610">,</span>&nbsp;<span class="num" id="6675612">1</span><span class="op" id="6675613">,</span>&nbsp;<span class="num" id="6675615">0</span><span class="op" id="6675616">,</span>&nbsp;<span class="num" id="6675618">0</span><span class="op" id="6675619">,</span>&nbsp;<span class="num" id="6675621">0</span><span class="op" id="6675622">,</span>&nbsp;<span class="num" id="6675624">0</span><span class="op" id="6675625">}</span><span class="op" id="6675626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675629">}</span><span class="op" id="6675630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6675633">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675686">{</span><span class="string" id="6675687">&#34;two&nbsp;records&#34;</span><span class="op" id="6675700">,</span>&nbsp;<span class="ident" id="6675702">typeStdin</span><span class="op" id="6675711">,</span>&nbsp;<span class="num" id="6675713">300</span><span class="op" id="6675716">,</span>&nbsp;<span class="builtinfunc" id="6675718">make</span><span class="op" id="6675722">(</span><span class="op" id="6675723">[</span><span class="op" id="6675724">]</span><span class="builtintype" id="6675725">byte</span><span class="op" id="6675729">,</span>&nbsp;<span class="num" id="6675731">66000</span><span class="op" id="6675736">)</span><span class="op" id="6675737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6675741">bytes</span><span class="op" id="6675746">.</span><span class="ident" id="6675747">Join</span><span class="op" id="6675751">(</span><span class="op" id="6675752">[</span><span class="op" id="6675753">]</span><span class="op" id="6675754">[</span><span class="op" id="6675755">]</span><span class="builtintype" id="6675756">byte</span><span class="op" id="6675760">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6675765">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675799">{</span><span class="num" id="6675800">1</span><span class="op" id="6675801">,</span>&nbsp;<span class="builtintype" id="6675803">byte</span><span class="op" id="6675807">(</span><span class="ident" id="6675808">typeStdin</span><span class="op" id="6675817">)</span><span class="op" id="6675818">,</span>&nbsp;<span class="num" id="6675820">0x01</span><span class="op" id="6675824">,</span>&nbsp;<span class="num" id="6675826">0x2C</span><span class="op" id="6675830">,</span>&nbsp;<span class="num" id="6675832">0xFF</span><span class="op" id="6675836">,</span>&nbsp;<span class="num" id="6675838">0xFF</span><span class="op" id="6675842">,</span>&nbsp;<span class="num" id="6675844">1</span><span class="op" id="6675845">,</span>&nbsp;<span class="num" id="6675847">0</span><span class="op" id="6675848">}</span><span class="op" id="6675849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6675854">make</span><span class="op" id="6675858">(</span><span class="op" id="6675859">[</span><span class="op" id="6675860">]</span><span class="builtintype" id="6675861">byte</span><span class="op" id="6675865">,</span>&nbsp;<span class="num" id="6675867">65536</span><span class="op" id="6675872">)</span><span class="op" id="6675873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6675878">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6675906">{</span><span class="num" id="6675907">1</span><span class="op" id="6675908">,</span>&nbsp;<span class="builtintype" id="6675910">byte</span><span class="op" id="6675914">(</span><span class="ident" id="6675915">typeStdin</span><span class="op" id="6675924">)</span><span class="op" id="6675925">,</span>&nbsp;<span class="num" id="6675927">0x01</span><span class="op" id="6675931">,</span>&nbsp;<span class="num" id="6675933">0x2C</span><span class="op" id="6675937">,</span>&nbsp;<span class="num" id="6675939">0x01</span><span class="op" id="6675943">,</span>&nbsp;<span class="num" id="6675945">0xD1</span><span class="op" id="6675949">,</span>&nbsp;<span class="num" id="6675951">7</span><span class="op" id="6675952">,</span>&nbsp;<span class="num" id="6675954">0</span><span class="op" id="6675955">}</span><span class="op" id="6675956">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6675961">make</span><span class="op" id="6675965">(</span><span class="op" id="6675966">[</span><span class="op" id="6675967">]</span><span class="builtintype" id="6675968">byte</span><span class="op" id="6675972">,</span>&nbsp;<span class="num" id="6675974">472</span><span class="op" id="6675977">)</span><span class="op" id="6675978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6675983">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676017">{</span><span class="num" id="6676018">1</span><span class="op" id="6676019">,</span>&nbsp;<span class="builtintype" id="6676021">byte</span><span class="op" id="6676025">(</span><span class="ident" id="6676026">typeStdin</span><span class="op" id="6676035">)</span><span class="op" id="6676036">,</span>&nbsp;<span class="num" id="6676038">0x01</span><span class="op" id="6676042">,</span>&nbsp;<span class="num" id="6676044">0x2C</span><span class="op" id="6676048">,</span>&nbsp;<span class="num" id="6676050">0</span><span class="op" id="6676051">,</span>&nbsp;<span class="num" id="6676053">0</span><span class="op" id="6676054">,</span>&nbsp;<span class="num" id="6676056">0</span><span class="op" id="6676057">,</span>&nbsp;<span class="num" id="6676059">0</span><span class="op" id="6676060">}</span><span class="op" id="6676061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676065">}</span><span class="op" id="6676066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676071">nil</span><span class="op" id="6676074">)</span><span class="op" id="6676075">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676078">}</span><span class="op" id="6676079">,</span><br>
<span class="lineno"></span><span class="op" id="6676081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6676084">type</span>&nbsp;<span class="ident" id="6676089">nilCloser</span>&nbsp;<span class="keyword" id="6676099">struct</span>&nbsp;<span class="op" id="6676106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676109">io</span><span class="op" id="6676111">.</span><span class="ident" id="6676112">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="6676123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6676126">func</span>&nbsp;<span class="op" id="6676131">(</span><span class="ident" id="6676132">c</span>&nbsp;<span class="op" id="6676134">*</span><span class="ident" id="6676135">nilCloser</span><span class="op" id="6676144">)</span>&nbsp;<span class="ident" id="6676146">Close</span><span class="op" id="6676151">(</span><span class="op" id="6676152">)</span>&nbsp;<span class="builtintype" id="6676154">error</span>&nbsp;<span class="op" id="6676160">{</span>&nbsp;<span class="keyword" id="6676162">return</span>&nbsp;<span class="ident" id="6676169">nil</span>&nbsp;<span class="op" id="6676173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6676176">func</span>&nbsp;<span class="ident" id="6676181">TestStreams</span><span class="op" id="6676192">(</span><span class="ident" id="6676193">t</span>&nbsp;<span class="op" id="6676195">*</span><span class="ident" id="6676196">testing</span><span class="op" id="6676203">.</span><span class="ident" id="6676204">T</span><span class="op" id="6676205">)</span>&nbsp;<span class="op" id="6676207">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676210">var</span>&nbsp;<span class="ident" id="6676214">rec</span>&nbsp;<span class="ident" id="6676218">record</span><br>
<span class="lineno"></span><span class="ident" id="6676225">outer</span><span class="op" id="6676230">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676233">for</span>&nbsp;<span class="ident" id="6676237">_</span><span class="op" id="6676238">,</span>&nbsp;<span class="ident" id="6676240">test</span>&nbsp;<span class="op" id="6676245">:=</span>&nbsp;<span class="keyword" id="6676248">range</span>&nbsp;<span class="ident" id="6676254">streamTests</span>&nbsp;<span class="op" id="6676266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676270">buf</span>&nbsp;<span class="op" id="6676274">:=</span>&nbsp;<span class="ident" id="6676277">bytes</span><span class="op" id="6676282">.</span><span class="ident" id="6676283">NewBuffer</span><span class="op" id="6676292">(</span><span class="ident" id="6676293">test</span><span class="op" id="6676297">.</span><span class="ident" id="6676298">raw</span><span class="op" id="6676301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676305">var</span>&nbsp;<span class="ident" id="6676309">content</span>&nbsp;<span class="op" id="6676317">[</span><span class="op" id="6676318">]</span><span class="builtintype" id="6676319">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676326">for</span>&nbsp;<span class="ident" id="6676330">buf</span><span class="op" id="6676333">.</span><span class="ident" id="6676334">Len</span><span class="op" id="6676337">(</span><span class="op" id="6676338">)</span>&nbsp;<span class="op" id="6676340">&gt;</span>&nbsp;<span class="num" id="6676342">0</span>&nbsp;<span class="op" id="6676344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676349">if</span>&nbsp;<span class="ident" id="6676352">err</span>&nbsp;<span class="op" id="6676356">:=</span>&nbsp;<span class="ident" id="6676359">rec</span><span class="op" id="6676362">.</span><span class="ident" id="6676363">read</span><span class="op" id="6676367">(</span><span class="ident" id="6676368">buf</span><span class="op" id="6676371">)</span><span class="op" id="6676372">;</span>&nbsp;<span class="ident" id="6676374">err</span>&nbsp;<span class="op" id="6676378">!=</span>&nbsp;<span class="ident" id="6676381">nil</span>&nbsp;<span class="op" id="6676385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676391">t</span><span class="op" id="6676392">.</span><span class="ident" id="6676393">Errorf</span><span class="op" id="6676399">(</span><span class="string" id="6676400">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="6676430">,</span>&nbsp;<span class="ident" id="6676432">test</span><span class="op" id="6676436">.</span><span class="ident" id="6676437">desc</span><span class="op" id="6676441">,</span>&nbsp;<span class="ident" id="6676443">err</span><span class="op" id="6676446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676452">continue</span>&nbsp;<span class="ident" id="6676461">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676470">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676475">content</span>&nbsp;<span class="op" id="6676483">=</span>&nbsp;<span class="builtinfunc" id="6676485">append</span><span class="op" id="6676491">(</span><span class="ident" id="6676492">content</span><span class="op" id="6676499">,</span>&nbsp;<span class="ident" id="6676501">rec</span><span class="op" id="6676504">.</span><span class="ident" id="6676505">content</span><span class="op" id="6676512">(</span><span class="op" id="6676513">)</span><span class="op" id="6676514">...</span><span class="op" id="6676517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676525">if</span>&nbsp;<span class="ident" id="6676528">rec</span><span class="op" id="6676531">.</span><span class="ident" id="6676532">h</span><span class="op" id="6676533">.</span><span class="ident" id="6676534">Type</span>&nbsp;<span class="op" id="6676539">!=</span>&nbsp;<span class="ident" id="6676542">test</span><span class="op" id="6676546">.</span><span class="ident" id="6676547">recType</span>&nbsp;<span class="op" id="6676555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676560">t</span><span class="op" id="6676561">.</span><span class="ident" id="6676562">Errorf</span><span class="op" id="6676568">(</span><span class="string" id="6676569">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6676598">,</span>&nbsp;<span class="ident" id="6676600">test</span><span class="op" id="6676604">.</span><span class="ident" id="6676605">desc</span><span class="op" id="6676609">,</span>&nbsp;<span class="ident" id="6676611">rec</span><span class="op" id="6676614">.</span><span class="ident" id="6676615">h</span><span class="op" id="6676616">.</span><span class="ident" id="6676617">Type</span><span class="op" id="6676621">,</span>&nbsp;<span class="ident" id="6676623">test</span><span class="op" id="6676627">.</span><span class="ident" id="6676628">recType</span><span class="op" id="6676635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676640">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676655">if</span>&nbsp;<span class="ident" id="6676658">rec</span><span class="op" id="6676661">.</span><span class="ident" id="6676662">h</span><span class="op" id="6676663">.</span><span class="ident" id="6676664">Id</span>&nbsp;<span class="op" id="6676667">!=</span>&nbsp;<span class="ident" id="6676670">test</span><span class="op" id="6676674">.</span><span class="ident" id="6676675">reqId</span>&nbsp;<span class="op" id="6676681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676686">t</span><span class="op" id="6676687">.</span><span class="ident" id="6676688">Errorf</span><span class="op" id="6676694">(</span><span class="string" id="6676695">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6676730">,</span>&nbsp;<span class="ident" id="6676732">test</span><span class="op" id="6676736">.</span><span class="ident" id="6676737">desc</span><span class="op" id="6676741">,</span>&nbsp;<span class="ident" id="6676743">rec</span><span class="op" id="6676746">.</span><span class="ident" id="6676747">h</span><span class="op" id="6676748">.</span><span class="ident" id="6676749">Id</span><span class="op" id="6676751">,</span>&nbsp;<span class="ident" id="6676753">test</span><span class="op" id="6676757">.</span><span class="ident" id="6676758">reqId</span><span class="op" id="6676763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676768">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676779">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676783">if</span>&nbsp;<span class="op" id="6676786">!</span><span class="ident" id="6676787">bytes</span><span class="op" id="6676792">.</span><span class="ident" id="6676793">Equal</span><span class="op" id="6676798">(</span><span class="ident" id="6676799">content</span><span class="op" id="6676806">,</span>&nbsp;<span class="ident" id="6676808">test</span><span class="op" id="6676812">.</span><span class="ident" id="6676813">content</span><span class="op" id="6676820">)</span>&nbsp;<span class="op" id="6676822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676827">t</span><span class="op" id="6676828">.</span><span class="ident" id="6676829">Errorf</span><span class="op" id="6676835">(</span><span class="string" id="6676836">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="6676860">,</span>&nbsp;<span class="ident" id="6676862">test</span><span class="op" id="6676866">.</span><span class="ident" id="6676867">desc</span><span class="op" id="6676871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676876">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6676887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676891">buf</span><span class="op" id="6676894">.</span><span class="ident" id="6676895">Reset</span><span class="op" id="6676900">(</span><span class="op" id="6676901">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676905">c</span>&nbsp;<span class="op" id="6676907">:=</span>&nbsp;<span class="ident" id="6676910">newConn</span><span class="op" id="6676917">(</span><span class="op" id="6676918">&amp;</span><span class="ident" id="6676919">nilCloser</span><span class="op" id="6676928">{</span><span class="ident" id="6676929">buf</span><span class="op" id="6676932">}</span><span class="op" id="6676933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6676937">w</span>&nbsp;<span class="op" id="6676939">:=</span>&nbsp;<span class="ident" id="6676942">newWriter</span><span class="op" id="6676951">(</span><span class="ident" id="6676952">c</span><span class="op" id="6676953">,</span>&nbsp;<span class="ident" id="6676955">test</span><span class="op" id="6676959">.</span><span class="ident" id="6676960">recType</span><span class="op" id="6676967">,</span>&nbsp;<span class="ident" id="6676969">test</span><span class="op" id="6676973">.</span><span class="ident" id="6676974">reqId</span><span class="op" id="6676979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6676983">if</span>&nbsp;<span class="ident" id="6676986">_</span><span class="op" id="6676987">,</span>&nbsp;<span class="ident" id="6676989">err</span>&nbsp;<span class="op" id="6676993">:=</span>&nbsp;<span class="ident" id="6676996">w</span><span class="op" id="6676997">.</span><span class="ident" id="6676998">Write</span><span class="op" id="6677003">(</span><span class="ident" id="6677004">test</span><span class="op" id="6677008">.</span><span class="ident" id="6677009">content</span><span class="op" id="6677016">)</span><span class="op" id="6677017">;</span>&nbsp;<span class="ident" id="6677019">err</span>&nbsp;<span class="op" id="6677023">!=</span>&nbsp;<span class="ident" id="6677026">nil</span>&nbsp;<span class="op" id="6677030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677035">t</span><span class="op" id="6677036">.</span><span class="ident" id="6677037">Errorf</span><span class="op" id="6677043">(</span><span class="string" id="6677044">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="6677074">,</span>&nbsp;<span class="ident" id="6677076">test</span><span class="op" id="6677080">.</span><span class="ident" id="6677081">desc</span><span class="op" id="6677085">,</span>&nbsp;<span class="ident" id="6677087">err</span><span class="op" id="6677090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677095">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677110">if</span>&nbsp;<span class="ident" id="6677113">err</span>&nbsp;<span class="op" id="6677117">:=</span>&nbsp;<span class="ident" id="6677120">w</span><span class="op" id="6677121">.</span><span class="ident" id="6677122">Close</span><span class="op" id="6677127">(</span><span class="op" id="6677128">)</span><span class="op" id="6677129">;</span>&nbsp;<span class="ident" id="6677131">err</span>&nbsp;<span class="op" id="6677135">!=</span>&nbsp;<span class="ident" id="6677138">nil</span>&nbsp;<span class="op" id="6677142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677147">t</span><span class="op" id="6677148">.</span><span class="ident" id="6677149">Errorf</span><span class="op" id="6677155">(</span><span class="string" id="6677156">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="6677186">,</span>&nbsp;<span class="ident" id="6677188">test</span><span class="op" id="6677192">.</span><span class="ident" id="6677193">desc</span><span class="op" id="6677197">,</span>&nbsp;<span class="ident" id="6677199">err</span><span class="op" id="6677202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677207">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677218">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677222">if</span>&nbsp;<span class="op" id="6677225">!</span><span class="ident" id="6677226">bytes</span><span class="op" id="6677231">.</span><span class="ident" id="6677232">Equal</span><span class="op" id="6677237">(</span><span class="ident" id="6677238">buf</span><span class="op" id="6677241">.</span><span class="ident" id="6677242">Bytes</span><span class="op" id="6677247">(</span><span class="op" id="6677248">)</span><span class="op" id="6677249">,</span>&nbsp;<span class="ident" id="6677251">test</span><span class="op" id="6677255">.</span><span class="ident" id="6677256">raw</span><span class="op" id="6677259">)</span>&nbsp;<span class="op" id="6677261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677266">t</span><span class="op" id="6677267">.</span><span class="ident" id="6677268">Errorf</span><span class="op" id="6677274">(</span><span class="string" id="6677275">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="6677300">,</span>&nbsp;<span class="ident" id="6677302">test</span><span class="op" id="6677306">.</span><span class="ident" id="6677307">desc</span><span class="op" id="6677311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677318">}</span><br>
<span class="lineno"></span><span class="op" id="6677320">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="6677323">type</span>&nbsp;<span class="ident" id="6677328">writeOnlyConn</span>&nbsp;<span class="keyword" id="6677342">struct</span>&nbsp;<span class="op" id="6677349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677352">buf</span>&nbsp;<span class="op" id="6677356">[</span><span class="op" id="6677357">]</span><span class="builtintype" id="6677358">byte</span><br>
<span class="lineno"></span><span class="op" id="6677363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6677366">func</span>&nbsp;<span class="op" id="6677371">(</span><span class="ident" id="6677372">c</span>&nbsp;<span class="op" id="6677374">*</span><span class="ident" id="6677375">writeOnlyConn</span><span class="op" id="6677388">)</span>&nbsp;<span class="ident" id="6677390">Write</span><span class="op" id="6677395">(</span><span class="ident" id="6677396">p</span>&nbsp;<span class="op" id="6677398">[</span><span class="op" id="6677399">]</span><span class="builtintype" id="6677400">byte</span><span class="op" id="6677404">)</span>&nbsp;<span class="op" id="6677406">(</span><span class="builtintype" id="6677407">int</span><span class="op" id="6677410">,</span>&nbsp;<span class="builtintype" id="6677412">error</span><span class="op" id="6677417">)</span>&nbsp;<span class="op" id="6677419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677422">c</span><span class="op" id="6677423">.</span><span class="ident" id="6677424">buf</span>&nbsp;<span class="op" id="6677428">=</span>&nbsp;<span class="builtinfunc" id="6677430">append</span><span class="op" id="6677436">(</span><span class="ident" id="6677437">c</span><span class="op" id="6677438">.</span><span class="ident" id="6677439">buf</span><span class="op" id="6677442">,</span>&nbsp;<span class="ident" id="6677444">p</span><span class="op" id="6677445">...</span><span class="op" id="6677448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677451">return</span>&nbsp;<span class="builtinfunc" id="6677458">len</span><span class="op" id="6677461">(</span><span class="ident" id="6677462">p</span><span class="op" id="6677463">)</span><span class="op" id="6677464">,</span>&nbsp;<span class="ident" id="6677466">nil</span><br>
<span class="lineno"></span><span class="op" id="6677470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="6677473">func</span>&nbsp;<span class="op" id="6677478">(</span><span class="ident" id="6677479">c</span>&nbsp;<span class="op" id="6677481">*</span><span class="ident" id="6677482">writeOnlyConn</span><span class="op" id="6677495">)</span>&nbsp;<span class="ident" id="6677497">Read</span><span class="op" id="6677501">(</span><span class="ident" id="6677502">p</span>&nbsp;<span class="op" id="6677504">[</span><span class="op" id="6677505">]</span><span class="builtintype" id="6677506">byte</span><span class="op" id="6677510">)</span>&nbsp;<span class="op" id="6677512">(</span><span class="builtintype" id="6677513">int</span><span class="op" id="6677516">,</span>&nbsp;<span class="builtintype" id="6677518">error</span><span class="op" id="6677523">)</span>&nbsp;<span class="op" id="6677525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677528">return</span>&nbsp;<span class="num" id="6677535">0</span><span class="op" id="6677536">,</span>&nbsp;<span class="ident" id="6677538">errors</span><span class="op" id="6677544">.</span><span class="ident" id="6677545">New</span><span class="op" id="6677548">(</span><span class="string" id="6677549">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="6677569">)</span><br>
<span class="lineno"></span><span class="op" id="6677571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6677574">func</span>&nbsp;<span class="op" id="6677579">(</span><span class="ident" id="6677580">c</span>&nbsp;<span class="op" id="6677582">*</span><span class="ident" id="6677583">writeOnlyConn</span><span class="op" id="6677596">)</span>&nbsp;<span class="ident" id="6677598">Close</span><span class="op" id="6677603">(</span><span class="op" id="6677604">)</span>&nbsp;<span class="builtintype" id="6677606">error</span>&nbsp;<span class="op" id="6677612">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677615">return</span>&nbsp;<span class="ident" id="6677622">nil</span><br>
<span class="lineno"></span><span class="op" id="6677626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6677629">func</span>&nbsp;<span class="ident" id="6677634">TestGetValues</span><span class="op" id="6677647">(</span><span class="ident" id="6677648">t</span>&nbsp;<span class="op" id="6677650">*</span><span class="ident" id="6677651">testing</span><span class="op" id="6677658">.</span><span class="ident" id="6677659">T</span><span class="op" id="6677660">)</span>&nbsp;<span class="op" id="6677662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677665">var</span>&nbsp;<span class="ident" id="6677669">rec</span>&nbsp;<span class="ident" id="6677673">record</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677681">rec</span><span class="op" id="6677684">.</span><span class="ident" id="6677685">h</span><span class="op" id="6677686">.</span><span class="ident" id="6677687">Type</span>&nbsp;<span class="op" id="6677692">=</span>&nbsp;<span class="ident" id="6677694">typeGetValues</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677710">wc</span>&nbsp;<span class="op" id="6677713">:=</span>&nbsp;<span class="builtinfunc" id="6677716">new</span><span class="op" id="6677719">(</span><span class="ident" id="6677720">writeOnlyConn</span><span class="op" id="6677733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677736">c</span>&nbsp;<span class="op" id="6677738">:=</span>&nbsp;<span class="ident" id="6677741">newChild</span><span class="op" id="6677749">(</span><span class="ident" id="6677750">wc</span><span class="op" id="6677752">,</span>&nbsp;<span class="ident" id="6677754">nil</span><span class="op" id="6677757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677760">err</span>&nbsp;<span class="op" id="6677764">:=</span>&nbsp;<span class="ident" id="6677767">c</span><span class="op" id="6677768">.</span><span class="ident" id="6677769">handleRecord</span><span class="op" id="6677781">(</span><span class="op" id="6677782">&amp;</span><span class="ident" id="6677783">rec</span><span class="op" id="6677786">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677789">if</span>&nbsp;<span class="ident" id="6677792">err</span>&nbsp;<span class="op" id="6677796">!=</span>&nbsp;<span class="ident" id="6677799">nil</span>&nbsp;<span class="op" id="6677803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6677807">t</span><span class="op" id="6677808">.</span><span class="ident" id="6677809">Fatalf</span><span class="op" id="6677815">(</span><span class="string" id="6677816">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="6677834">,</span>&nbsp;<span class="ident" id="6677836">err</span><span class="op" id="6677839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6677842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677846">const</span>&nbsp;<span class="ident" id="6677852">want</span>&nbsp;<span class="op" id="6677857">=</span>&nbsp;<span class="string" id="6677859">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="6677892">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6677896">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="6677923">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6677927">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6677985">if</span>&nbsp;<span class="ident" id="6677988">got</span>&nbsp;<span class="op" id="6677992">:=</span>&nbsp;<span class="builtintype" id="6677995">string</span><span class="op" id="6678001">(</span><span class="ident" id="6678002">wc</span><span class="op" id="6678004">.</span><span class="ident" id="6678005">buf</span><span class="op" id="6678008">)</span><span class="op" id="6678009">;</span>&nbsp;<span class="ident" id="6678011">got</span>&nbsp;<span class="op" id="6678015">!=</span>&nbsp;<span class="ident" id="6678018">want</span>&nbsp;<span class="op" id="6678023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6678027">t</span><span class="op" id="6678028">.</span><span class="ident" id="6678029">Errorf</span><span class="op" id="6678035">(</span><span class="string" id="6678036">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="6678058">,</span>&nbsp;<span class="ident" id="6678060">got</span><span class="op" id="6678063">,</span>&nbsp;<span class="ident" id="6678065">want</span><span class="op" id="6678069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6678072">}</span><br>
<span class="lineno">150</span><span class="op" id="6678074">}</span>
</div>
</body>
</html>
