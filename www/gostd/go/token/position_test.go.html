<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7134856">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7134911">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7134965">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7135016">package</span>&nbsp;<span class="ident" id="7135024">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7135031">import</span>&nbsp;<span class="op" id="7135038">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7135041">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7135048">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7135061">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7135069">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7135079">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7135082">func</span>&nbsp;<span class="ident" id="7135087">checkPos</span><span class="op" id="7135095">(</span><span class="ident" id="7135096">t</span>&nbsp;<span class="op" id="7135098">*</span><span class="ident" id="7135099">testing</span><span class="op" id="7135106">.</span><span class="ident" id="7135107">T</span><span class="op" id="7135108">,</span>&nbsp;<span class="ident" id="7135110">msg</span>&nbsp;<span class="builtintype" id="7135114">string</span><span class="op" id="7135120">,</span>&nbsp;<span class="ident" id="7135122">got</span><span class="op" id="7135125">,</span>&nbsp;<span class="ident" id="7135127">want</span>&nbsp;<span class="ident" id="7135132">Position</span><span class="op" id="7135140">)</span>&nbsp;<span class="op" id="7135142">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135145">if</span>&nbsp;<span class="ident" id="7135148">got</span><span class="op" id="7135151">.</span><span class="ident" id="7135152">Filename</span>&nbsp;<span class="op" id="7135161">!=</span>&nbsp;<span class="ident" id="7135164">want</span><span class="op" id="7135168">.</span><span class="ident" id="7135169">Filename</span>&nbsp;<span class="op" id="7135178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135182">t</span><span class="op" id="7135183">.</span><span class="ident" id="7135184">Errorf</span><span class="op" id="7135190">(</span><span class="string" id="7135191">&#34;%s:&nbsp;got&nbsp;filename&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7135223">,</span>&nbsp;<span class="ident" id="7135225">msg</span><span class="op" id="7135228">,</span>&nbsp;<span class="ident" id="7135230">got</span><span class="op" id="7135233">.</span><span class="ident" id="7135234">Filename</span><span class="op" id="7135242">,</span>&nbsp;<span class="ident" id="7135244">want</span><span class="op" id="7135248">.</span><span class="ident" id="7135249">Filename</span><span class="op" id="7135257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135263">if</span>&nbsp;<span class="ident" id="7135266">got</span><span class="op" id="7135269">.</span><span class="ident" id="7135270">Offset</span>&nbsp;<span class="op" id="7135277">!=</span>&nbsp;<span class="ident" id="7135280">want</span><span class="op" id="7135284">.</span><span class="ident" id="7135285">Offset</span>&nbsp;<span class="op" id="7135292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135296">t</span><span class="op" id="7135297">.</span><span class="ident" id="7135298">Errorf</span><span class="op" id="7135304">(</span><span class="string" id="7135305">&#34;%s:&nbsp;got&nbsp;offset&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7135335">,</span>&nbsp;<span class="ident" id="7135337">msg</span><span class="op" id="7135340">,</span>&nbsp;<span class="ident" id="7135342">got</span><span class="op" id="7135345">.</span><span class="ident" id="7135346">Offset</span><span class="op" id="7135352">,</span>&nbsp;<span class="ident" id="7135354">want</span><span class="op" id="7135358">.</span><span class="ident" id="7135359">Offset</span><span class="op" id="7135365">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135371">if</span>&nbsp;<span class="ident" id="7135374">got</span><span class="op" id="7135377">.</span><span class="ident" id="7135378">Line</span>&nbsp;<span class="op" id="7135383">!=</span>&nbsp;<span class="ident" id="7135386">want</span><span class="op" id="7135390">.</span><span class="ident" id="7135391">Line</span>&nbsp;<span class="op" id="7135396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135400">t</span><span class="op" id="7135401">.</span><span class="ident" id="7135402">Errorf</span><span class="op" id="7135408">(</span><span class="string" id="7135409">&#34;%s:&nbsp;got&nbsp;line&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7135437">,</span>&nbsp;<span class="ident" id="7135439">msg</span><span class="op" id="7135442">,</span>&nbsp;<span class="ident" id="7135444">got</span><span class="op" id="7135447">.</span><span class="ident" id="7135448">Line</span><span class="op" id="7135452">,</span>&nbsp;<span class="ident" id="7135454">want</span><span class="op" id="7135458">.</span><span class="ident" id="7135459">Line</span><span class="op" id="7135463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135469">if</span>&nbsp;<span class="ident" id="7135472">got</span><span class="op" id="7135475">.</span><span class="ident" id="7135476">Column</span>&nbsp;<span class="op" id="7135483">!=</span>&nbsp;<span class="ident" id="7135486">want</span><span class="op" id="7135490">.</span><span class="ident" id="7135491">Column</span>&nbsp;<span class="op" id="7135498">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135502">t</span><span class="op" id="7135503">.</span><span class="ident" id="7135504">Errorf</span><span class="op" id="7135510">(</span><span class="string" id="7135511">&#34;%s:&nbsp;got&nbsp;column&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7135541">,</span>&nbsp;<span class="ident" id="7135543">msg</span><span class="op" id="7135546">,</span>&nbsp;<span class="ident" id="7135548">got</span><span class="op" id="7135551">.</span><span class="ident" id="7135552">Column</span><span class="op" id="7135558">,</span>&nbsp;<span class="ident" id="7135560">want</span><span class="op" id="7135564">.</span><span class="ident" id="7135565">Column</span><span class="op" id="7135571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135574">}</span><br>
<span class="lineno"></span><span class="op" id="7135576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7135579">func</span>&nbsp;<span class="ident" id="7135584">TestNoPos</span><span class="op" id="7135593">(</span><span class="ident" id="7135594">t</span>&nbsp;<span class="op" id="7135596">*</span><span class="ident" id="7135597">testing</span><span class="op" id="7135604">.</span><span class="ident" id="7135605">T</span><span class="op" id="7135606">)</span>&nbsp;<span class="op" id="7135608">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135611">if</span>&nbsp;<span class="ident" id="7135614">NoPos</span><span class="op" id="7135619">.</span><span class="ident" id="7135620">IsValid</span><span class="op" id="7135627">(</span><span class="op" id="7135628">)</span>&nbsp;<span class="op" id="7135630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135634">t</span><span class="op" id="7135635">.</span><span class="ident" id="7135636">Errorf</span><span class="op" id="7135642">(</span><span class="string" id="7135643">&#34;NoPos&nbsp;should&nbsp;not&nbsp;be&nbsp;valid&#34;</span><span class="op" id="7135670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135676">var</span>&nbsp;<span class="ident" id="7135680">fset</span>&nbsp;<span class="op" id="7135685">*</span><span class="ident" id="7135686">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135695">checkPos</span><span class="op" id="7135703">(</span><span class="ident" id="7135704">t</span><span class="op" id="7135705">,</span>&nbsp;<span class="string" id="7135707">&#34;nil&nbsp;NoPos&#34;</span><span class="op" id="7135718">,</span>&nbsp;<span class="ident" id="7135720">fset</span><span class="op" id="7135724">.</span><span class="ident" id="7135725">Position</span><span class="op" id="7135733">(</span><span class="ident" id="7135734">NoPos</span><span class="op" id="7135739">)</span><span class="op" id="7135740">,</span>&nbsp;<span class="ident" id="7135742">Position</span><span class="op" id="7135750">{</span><span class="op" id="7135751">}</span><span class="op" id="7135752">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135755">fset</span>&nbsp;<span class="op" id="7135760">=</span>&nbsp;<span class="ident" id="7135762">NewFileSet</span><span class="op" id="7135772">(</span><span class="op" id="7135773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135776">checkPos</span><span class="op" id="7135784">(</span><span class="ident" id="7135785">t</span><span class="op" id="7135786">,</span>&nbsp;<span class="string" id="7135788">&#34;fset&nbsp;NoPos&#34;</span><span class="op" id="7135800">,</span>&nbsp;<span class="ident" id="7135802">fset</span><span class="op" id="7135806">.</span><span class="ident" id="7135807">Position</span><span class="op" id="7135815">(</span><span class="ident" id="7135816">NoPos</span><span class="op" id="7135821">)</span><span class="op" id="7135822">,</span>&nbsp;<span class="ident" id="7135824">Position</span><span class="op" id="7135832">{</span><span class="op" id="7135833">}</span><span class="op" id="7135834">)</span><br>
<span class="lineno"></span><span class="op" id="7135836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7135839">var</span>&nbsp;<span class="ident" id="7135843">tests</span>&nbsp;<span class="op" id="7135849">=</span>&nbsp;<span class="op" id="7135851">[</span><span class="op" id="7135852">]</span><span class="keyword" id="7135853">struct</span>&nbsp;<span class="op" id="7135860">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135863">filename</span>&nbsp;<span class="builtintype" id="7135872">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135880">source</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7135889">[</span><span class="op" id="7135890">]</span><span class="builtintype" id="7135891">byte</span>&nbsp;<span class="comment" id="7135896">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135911">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7135920">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135925">lines</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7135934">[</span><span class="op" id="7135935">]</span><span class="builtintype" id="7135936">int</span><br>
<span class="lineno"></span><span class="op" id="7135940">}</span><span class="op" id="7135941">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135944">{</span><span class="string" id="7135945">&#34;a&#34;</span><span class="op" id="7135948">,</span>&nbsp;<span class="op" id="7135950">[</span><span class="op" id="7135951">]</span><span class="builtintype" id="7135952">byte</span><span class="op" id="7135956">{</span><span class="op" id="7135957">}</span><span class="op" id="7135958">,</span>&nbsp;<span class="num" id="7135960">0</span><span class="op" id="7135961">,</span>&nbsp;<span class="op" id="7135963">[</span><span class="op" id="7135964">]</span><span class="builtintype" id="7135965">int</span><span class="op" id="7135968">{</span><span class="op" id="7135969">}</span><span class="op" id="7135970">}</span><span class="op" id="7135971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135974">{</span><span class="string" id="7135975">&#34;b&#34;</span><span class="op" id="7135978">,</span>&nbsp;<span class="op" id="7135980">[</span><span class="op" id="7135981">]</span><span class="builtintype" id="7135982">byte</span><span class="op" id="7135986">(</span><span class="string" id="7135987">&#34;01234&#34;</span><span class="op" id="7135994">)</span><span class="op" id="7135995">,</span>&nbsp;<span class="num" id="7135997">5</span><span class="op" id="7135998">,</span>&nbsp;<span class="op" id="7136000">[</span><span class="op" id="7136001">]</span><span class="builtintype" id="7136002">int</span><span class="op" id="7136005">{</span><span class="num" id="7136006">0</span><span class="op" id="7136007">}</span><span class="op" id="7136008">}</span><span class="op" id="7136009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136012">{</span><span class="string" id="7136013">&#34;c&#34;</span><span class="op" id="7136016">,</span>&nbsp;<span class="op" id="7136018">[</span><span class="op" id="7136019">]</span><span class="builtintype" id="7136020">byte</span><span class="op" id="7136024">(</span><span class="string" id="7136025">&#34;\n\n\n\n\n\n\n\n\n&#34;</span><span class="op" id="7136045">)</span><span class="op" id="7136046">,</span>&nbsp;<span class="num" id="7136048">9</span><span class="op" id="7136049">,</span>&nbsp;<span class="op" id="7136051">[</span><span class="op" id="7136052">]</span><span class="builtintype" id="7136053">int</span><span class="op" id="7136056">{</span><span class="num" id="7136057">0</span><span class="op" id="7136058">,</span>&nbsp;<span class="num" id="7136060">1</span><span class="op" id="7136061">,</span>&nbsp;<span class="num" id="7136063">2</span><span class="op" id="7136064">,</span>&nbsp;<span class="num" id="7136066">3</span><span class="op" id="7136067">,</span>&nbsp;<span class="num" id="7136069">4</span><span class="op" id="7136070">,</span>&nbsp;<span class="num" id="7136072">5</span><span class="op" id="7136073">,</span>&nbsp;<span class="num" id="7136075">6</span><span class="op" id="7136076">,</span>&nbsp;<span class="num" id="7136078">7</span><span class="op" id="7136079">,</span>&nbsp;<span class="num" id="7136081">8</span><span class="op" id="7136082">}</span><span class="op" id="7136083">}</span><span class="op" id="7136084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136087">{</span><span class="string" id="7136088">&#34;d&#34;</span><span class="op" id="7136091">,</span>&nbsp;<span class="ident" id="7136093">nil</span><span class="op" id="7136096">,</span>&nbsp;<span class="num" id="7136098">100</span><span class="op" id="7136101">,</span>&nbsp;<span class="op" id="7136103">[</span><span class="op" id="7136104">]</span><span class="builtintype" id="7136105">int</span><span class="op" id="7136108">{</span><span class="num" id="7136109">0</span><span class="op" id="7136110">,</span>&nbsp;<span class="num" id="7136112">5</span><span class="op" id="7136113">,</span>&nbsp;<span class="num" id="7136115">10</span><span class="op" id="7136117">,</span>&nbsp;<span class="num" id="7136119">20</span><span class="op" id="7136121">,</span>&nbsp;<span class="num" id="7136123">30</span><span class="op" id="7136125">,</span>&nbsp;<span class="num" id="7136127">70</span><span class="op" id="7136129">,</span>&nbsp;<span class="num" id="7136131">71</span><span class="op" id="7136133">,</span>&nbsp;<span class="num" id="7136135">72</span><span class="op" id="7136137">,</span>&nbsp;<span class="num" id="7136139">80</span><span class="op" id="7136141">,</span>&nbsp;<span class="num" id="7136143">85</span><span class="op" id="7136145">,</span>&nbsp;<span class="num" id="7136147">90</span><span class="op" id="7136149">,</span>&nbsp;<span class="num" id="7136151">99</span><span class="op" id="7136153">}</span><span class="op" id="7136154">}</span><span class="op" id="7136155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136158">{</span><span class="string" id="7136159">&#34;e&#34;</span><span class="op" id="7136162">,</span>&nbsp;<span class="ident" id="7136164">nil</span><span class="op" id="7136167">,</span>&nbsp;<span class="num" id="7136169">777</span><span class="op" id="7136172">,</span>&nbsp;<span class="op" id="7136174">[</span><span class="op" id="7136175">]</span><span class="builtintype" id="7136176">int</span><span class="op" id="7136179">{</span><span class="num" id="7136180">0</span><span class="op" id="7136181">,</span>&nbsp;<span class="num" id="7136183">80</span><span class="op" id="7136185">,</span>&nbsp;<span class="num" id="7136187">100</span><span class="op" id="7136190">,</span>&nbsp;<span class="num" id="7136192">120</span><span class="op" id="7136195">,</span>&nbsp;<span class="num" id="7136197">130</span><span class="op" id="7136200">,</span>&nbsp;<span class="num" id="7136202">180</span><span class="op" id="7136205">,</span>&nbsp;<span class="num" id="7136207">267</span><span class="op" id="7136210">,</span>&nbsp;<span class="num" id="7136212">455</span><span class="op" id="7136215">,</span>&nbsp;<span class="num" id="7136217">500</span><span class="op" id="7136220">,</span>&nbsp;<span class="num" id="7136222">567</span><span class="op" id="7136225">,</span>&nbsp;<span class="num" id="7136227">620</span><span class="op" id="7136230">}</span><span class="op" id="7136231">}</span><span class="op" id="7136232">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136235">{</span><span class="string" id="7136236">&#34;f&#34;</span><span class="op" id="7136239">,</span>&nbsp;<span class="op" id="7136241">[</span><span class="op" id="7136242">]</span><span class="builtintype" id="7136243">byte</span><span class="op" id="7136247">(</span><span class="string" id="7136248">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;&#34;</span><span class="op" id="7136277">)</span><span class="op" id="7136278">,</span>&nbsp;<span class="num" id="7136280">23</span><span class="op" id="7136282">,</span>&nbsp;<span class="op" id="7136284">[</span><span class="op" id="7136285">]</span><span class="builtintype" id="7136286">int</span><span class="op" id="7136289">{</span><span class="num" id="7136290">0</span><span class="op" id="7136291">,</span>&nbsp;<span class="num" id="7136293">10</span><span class="op" id="7136295">,</span>&nbsp;<span class="num" id="7136297">11</span><span class="op" id="7136299">}</span><span class="op" id="7136300">}</span><span class="op" id="7136301">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136304">{</span><span class="string" id="7136305">&#34;g&#34;</span><span class="op" id="7136308">,</span>&nbsp;<span class="op" id="7136310">[</span><span class="op" id="7136311">]</span><span class="builtintype" id="7136312">byte</span><span class="op" id="7136316">(</span><span class="string" id="7136317">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&#34;</span><span class="op" id="7136348">)</span><span class="op" id="7136349">,</span>&nbsp;<span class="num" id="7136351">24</span><span class="op" id="7136353">,</span>&nbsp;<span class="op" id="7136355">[</span><span class="op" id="7136356">]</span><span class="builtintype" id="7136357">int</span><span class="op" id="7136360">{</span><span class="num" id="7136361">0</span><span class="op" id="7136362">,</span>&nbsp;<span class="num" id="7136364">10</span><span class="op" id="7136366">,</span>&nbsp;<span class="num" id="7136368">11</span><span class="op" id="7136370">}</span><span class="op" id="7136371">}</span><span class="op" id="7136372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136375">{</span><span class="string" id="7136376">&#34;h&#34;</span><span class="op" id="7136379">,</span>&nbsp;<span class="op" id="7136381">[</span><span class="op" id="7136382">]</span><span class="builtintype" id="7136383">byte</span><span class="op" id="7136387">(</span><span class="string" id="7136388">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&nbsp;&#34;</span><span class="op" id="7136420">)</span><span class="op" id="7136421">,</span>&nbsp;<span class="num" id="7136423">25</span><span class="op" id="7136425">,</span>&nbsp;<span class="op" id="7136427">[</span><span class="op" id="7136428">]</span><span class="builtintype" id="7136429">int</span><span class="op" id="7136432">{</span><span class="num" id="7136433">0</span><span class="op" id="7136434">,</span>&nbsp;<span class="num" id="7136436">10</span><span class="op" id="7136438">,</span>&nbsp;<span class="num" id="7136440">11</span><span class="op" id="7136442">,</span>&nbsp;<span class="num" id="7136444">24</span><span class="op" id="7136446">}</span><span class="op" id="7136447">}</span><span class="op" id="7136448">,</span><br>
<span class="lineno"></span><span class="op" id="7136450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7136453">func</span>&nbsp;<span class="ident" id="7136458">linecol</span><span class="op" id="7136465">(</span><span class="ident" id="7136466">lines</span>&nbsp;<span class="op" id="7136472">[</span><span class="op" id="7136473">]</span><span class="builtintype" id="7136474">int</span><span class="op" id="7136477">,</span>&nbsp;<span class="ident" id="7136479">offs</span>&nbsp;<span class="builtintype" id="7136484">int</span><span class="op" id="7136487">)</span>&nbsp;<span class="op" id="7136489">(</span><span class="builtintype" id="7136490">int</span><span class="op" id="7136493">,</span>&nbsp;<span class="builtintype" id="7136495">int</span><span class="op" id="7136498">)</span>&nbsp;<span class="op" id="7136500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136503">prevLineOffs</span>&nbsp;<span class="op" id="7136516">:=</span>&nbsp;<span class="num" id="7136519">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7136522">for</span>&nbsp;<span class="ident" id="7136526">line</span><span class="op" id="7136530">,</span>&nbsp;<span class="ident" id="7136532">lineOffs</span>&nbsp;<span class="op" id="7136541">:=</span>&nbsp;<span class="keyword" id="7136544">range</span>&nbsp;<span class="ident" id="7136550">lines</span>&nbsp;<span class="op" id="7136556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7136560">if</span>&nbsp;<span class="ident" id="7136563">offs</span>&nbsp;<span class="op" id="7136568">&lt;</span>&nbsp;<span class="ident" id="7136570">lineOffs</span>&nbsp;<span class="op" id="7136579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7136584">return</span>&nbsp;<span class="ident" id="7136591">line</span><span class="op" id="7136595">,</span>&nbsp;<span class="ident" id="7136597">offs</span>&nbsp;<span class="op" id="7136602">-</span>&nbsp;<span class="ident" id="7136604">prevLineOffs</span>&nbsp;<span class="op" id="7136617">+</span>&nbsp;<span class="num" id="7136619">1</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136627">prevLineOffs</span>&nbsp;<span class="op" id="7136640">=</span>&nbsp;<span class="ident" id="7136642">lineOffs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7136655">return</span>&nbsp;<span class="builtinfunc" id="7136662">len</span><span class="op" id="7136665">(</span><span class="ident" id="7136666">lines</span><span class="op" id="7136671">)</span><span class="op" id="7136672">,</span>&nbsp;<span class="ident" id="7136674">offs</span>&nbsp;<span class="op" id="7136679">-</span>&nbsp;<span class="ident" id="7136681">prevLineOffs</span>&nbsp;<span class="op" id="7136694">+</span>&nbsp;<span class="num" id="7136696">1</span><br>
<span class="lineno"></span><span class="op" id="7136698">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7136701">func</span>&nbsp;<span class="ident" id="7136706">verifyPositions</span><span class="op" id="7136721">(</span><span class="ident" id="7136722">t</span>&nbsp;<span class="op" id="7136724">*</span><span class="ident" id="7136725">testing</span><span class="op" id="7136732">.</span><span class="ident" id="7136733">T</span><span class="op" id="7136734">,</span>&nbsp;<span class="ident" id="7136736">fset</span>&nbsp;<span class="op" id="7136741">*</span><span class="ident" id="7136742">FileSet</span><span class="op" id="7136749">,</span>&nbsp;<span class="ident" id="7136751">f</span>&nbsp;<span class="op" id="7136753">*</span><span class="ident" id="7136754">File</span><span class="op" id="7136758">,</span>&nbsp;<span class="ident" id="7136760">lines</span>&nbsp;<span class="op" id="7136766">[</span><span class="op" id="7136767">]</span><span class="builtintype" id="7136768">int</span><span class="op" id="7136771">)</span>&nbsp;<span class="op" id="7136773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7136776">for</span>&nbsp;<span class="ident" id="7136780">offs</span>&nbsp;<span class="op" id="7136785">:=</span>&nbsp;<span class="num" id="7136788">0</span><span class="op" id="7136789">;</span>&nbsp;<span class="ident" id="7136791">offs</span>&nbsp;<span class="op" id="7136796">&lt;</span>&nbsp;<span class="ident" id="7136798">f</span><span class="op" id="7136799">.</span><span class="ident" id="7136800">Size</span><span class="op" id="7136804">(</span><span class="op" id="7136805">)</span><span class="op" id="7136806">;</span>&nbsp;<span class="ident" id="7136808">offs</span><span class="op" id="7136812">++</span>&nbsp;<span class="op" id="7136815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136819">p</span>&nbsp;<span class="op" id="7136821">:=</span>&nbsp;<span class="ident" id="7136824">f</span><span class="op" id="7136825">.</span><span class="ident" id="7136826">Pos</span><span class="op" id="7136829">(</span><span class="ident" id="7136830">offs</span><span class="op" id="7136834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136838">offs2</span>&nbsp;<span class="op" id="7136844">:=</span>&nbsp;<span class="ident" id="7136847">f</span><span class="op" id="7136848">.</span><span class="ident" id="7136849">Offset</span><span class="op" id="7136855">(</span><span class="ident" id="7136856">p</span><span class="op" id="7136857">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7136861">if</span>&nbsp;<span class="ident" id="7136864">offs2</span>&nbsp;<span class="op" id="7136870">!=</span>&nbsp;<span class="ident" id="7136873">offs</span>&nbsp;<span class="op" id="7136878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136883">t</span><span class="op" id="7136884">.</span><span class="ident" id="7136885">Errorf</span><span class="op" id="7136891">(</span><span class="string" id="7136892">&#34;%s,&nbsp;Offset:&nbsp;got&nbsp;offset&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7136928">,</span>&nbsp;<span class="ident" id="7136930">f</span><span class="op" id="7136931">.</span><span class="ident" id="7136932">Name</span><span class="op" id="7136936">(</span><span class="op" id="7136937">)</span><span class="op" id="7136938">,</span>&nbsp;<span class="ident" id="7136940">offs2</span><span class="op" id="7136945">,</span>&nbsp;<span class="ident" id="7136947">offs</span><span class="op" id="7136951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136959">line</span><span class="op" id="7136963">,</span>&nbsp;<span class="ident" id="7136965">col</span>&nbsp;<span class="op" id="7136969">:=</span>&nbsp;<span class="ident" id="7136972">linecol</span><span class="op" id="7136979">(</span><span class="ident" id="7136980">lines</span><span class="op" id="7136985">,</span>&nbsp;<span class="ident" id="7136987">offs</span><span class="op" id="7136991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136995">msg</span>&nbsp;<span class="op" id="7136999">:=</span>&nbsp;<span class="ident" id="7137002">fmt</span><span class="op" id="7137005">.</span><span class="ident" id="7137006">Sprintf</span><span class="op" id="7137013">(</span><span class="string" id="7137014">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7137038">,</span>&nbsp;<span class="ident" id="7137040">f</span><span class="op" id="7137041">.</span><span class="ident" id="7137042">Name</span><span class="op" id="7137046">(</span><span class="op" id="7137047">)</span><span class="op" id="7137048">,</span>&nbsp;<span class="ident" id="7137050">offs</span><span class="op" id="7137054">,</span>&nbsp;<span class="ident" id="7137056">p</span><span class="op" id="7137057">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137061">checkPos</span><span class="op" id="7137069">(</span><span class="ident" id="7137070">t</span><span class="op" id="7137071">,</span>&nbsp;<span class="ident" id="7137073">msg</span><span class="op" id="7137076">,</span>&nbsp;<span class="ident" id="7137078">f</span><span class="op" id="7137079">.</span><span class="ident" id="7137080">Position</span><span class="op" id="7137088">(</span><span class="ident" id="7137089">f</span><span class="op" id="7137090">.</span><span class="ident" id="7137091">Pos</span><span class="op" id="7137094">(</span><span class="ident" id="7137095">offs</span><span class="op" id="7137099">)</span><span class="op" id="7137100">)</span><span class="op" id="7137101">,</span>&nbsp;<span class="ident" id="7137103">Position</span><span class="op" id="7137111">{</span><span class="ident" id="7137112">f</span><span class="op" id="7137113">.</span><span class="ident" id="7137114">Name</span><span class="op" id="7137118">(</span><span class="op" id="7137119">)</span><span class="op" id="7137120">,</span>&nbsp;<span class="ident" id="7137122">offs</span><span class="op" id="7137126">,</span>&nbsp;<span class="ident" id="7137128">line</span><span class="op" id="7137132">,</span>&nbsp;<span class="ident" id="7137134">col</span><span class="op" id="7137137">}</span><span class="op" id="7137138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137142">checkPos</span><span class="op" id="7137150">(</span><span class="ident" id="7137151">t</span><span class="op" id="7137152">,</span>&nbsp;<span class="ident" id="7137154">msg</span><span class="op" id="7137157">,</span>&nbsp;<span class="ident" id="7137159">fset</span><span class="op" id="7137163">.</span><span class="ident" id="7137164">Position</span><span class="op" id="7137172">(</span><span class="ident" id="7137173">p</span><span class="op" id="7137174">)</span><span class="op" id="7137175">,</span>&nbsp;<span class="ident" id="7137177">Position</span><span class="op" id="7137185">{</span><span class="ident" id="7137186">f</span><span class="op" id="7137187">.</span><span class="ident" id="7137188">Name</span><span class="op" id="7137192">(</span><span class="op" id="7137193">)</span><span class="op" id="7137194">,</span>&nbsp;<span class="ident" id="7137196">offs</span><span class="op" id="7137200">,</span>&nbsp;<span class="ident" id="7137202">line</span><span class="op" id="7137206">,</span>&nbsp;<span class="ident" id="7137208">col</span><span class="op" id="7137211">}</span><span class="op" id="7137212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137215">}</span><br>
<span class="lineno"></span><span class="op" id="7137217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7137220">func</span>&nbsp;<span class="ident" id="7137225">makeTestSource</span><span class="op" id="7137239">(</span><span class="ident" id="7137240">size</span>&nbsp;<span class="builtintype" id="7137245">int</span><span class="op" id="7137248">,</span>&nbsp;<span class="ident" id="7137250">lines</span>&nbsp;<span class="op" id="7137256">[</span><span class="op" id="7137257">]</span><span class="builtintype" id="7137258">int</span><span class="op" id="7137261">)</span>&nbsp;<span class="op" id="7137263">[</span><span class="op" id="7137264">]</span><span class="builtintype" id="7137265">byte</span>&nbsp;<span class="op" id="7137270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137273">src</span>&nbsp;<span class="op" id="7137277">:=</span>&nbsp;<span class="builtinfunc" id="7137280">make</span><span class="op" id="7137284">(</span><span class="op" id="7137285">[</span><span class="op" id="7137286">]</span><span class="builtintype" id="7137287">byte</span><span class="op" id="7137291">,</span>&nbsp;<span class="ident" id="7137293">size</span><span class="op" id="7137297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137300">for</span>&nbsp;<span class="ident" id="7137304">_</span><span class="op" id="7137305">,</span>&nbsp;<span class="ident" id="7137307">offs</span>&nbsp;<span class="op" id="7137312">:=</span>&nbsp;<span class="keyword" id="7137315">range</span>&nbsp;<span class="ident" id="7137321">lines</span>&nbsp;<span class="op" id="7137327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137331">if</span>&nbsp;<span class="ident" id="7137334">offs</span>&nbsp;<span class="op" id="7137339">&gt;</span>&nbsp;<span class="num" id="7137341">0</span>&nbsp;<span class="op" id="7137343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137348">src</span><span class="op" id="7137351">[</span><span class="ident" id="7137352">offs</span><span class="op" id="7137356">-</span><span class="num" id="7137357">1</span><span class="op" id="7137358">]</span>&nbsp;<span class="op" id="7137360">=</span>&nbsp;<span class="string" id="7137362">&#39;\n&#39;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137375">return</span>&nbsp;<span class="ident" id="7137382">src</span><br>
<span class="lineno"></span><span class="op" id="7137386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7137389">func</span>&nbsp;<span class="ident" id="7137394">TestPositions</span><span class="op" id="7137407">(</span><span class="ident" id="7137408">t</span>&nbsp;<span class="op" id="7137410">*</span><span class="ident" id="7137411">testing</span><span class="op" id="7137418">.</span><span class="ident" id="7137419">T</span><span class="op" id="7137420">)</span>&nbsp;<span class="op" id="7137422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137425">const</span>&nbsp;<span class="ident" id="7137431">delta</span>&nbsp;<span class="op" id="7137437">=</span>&nbsp;<span class="num" id="7137439">7</span>&nbsp;<span class="comment" id="7137441">//&nbsp;a&nbsp;non-zero&nbsp;base&nbsp;offset&nbsp;increment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137478">fset</span>&nbsp;<span class="op" id="7137483">:=</span>&nbsp;<span class="ident" id="7137486">NewFileSet</span><span class="op" id="7137496">(</span><span class="op" id="7137497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137500">for</span>&nbsp;<span class="ident" id="7137504">_</span><span class="op" id="7137505">,</span>&nbsp;<span class="ident" id="7137507">test</span>&nbsp;<span class="op" id="7137512">:=</span>&nbsp;<span class="keyword" id="7137515">range</span>&nbsp;<span class="ident" id="7137521">tests</span>&nbsp;<span class="op" id="7137527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7137531">//&nbsp;verify&nbsp;consistency&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137568">if</span>&nbsp;<span class="ident" id="7137571">test</span><span class="op" id="7137575">.</span><span class="ident" id="7137576">source</span>&nbsp;<span class="op" id="7137583">!=</span>&nbsp;<span class="ident" id="7137586">nil</span>&nbsp;<span class="op" id="7137590">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="7137593">len</span><span class="op" id="7137596">(</span><span class="ident" id="7137597">test</span><span class="op" id="7137601">.</span><span class="ident" id="7137602">source</span><span class="op" id="7137608">)</span>&nbsp;<span class="op" id="7137610">!=</span>&nbsp;<span class="ident" id="7137613">test</span><span class="op" id="7137617">.</span><span class="ident" id="7137618">size</span>&nbsp;<span class="op" id="7137623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137628">t</span><span class="op" id="7137629">.</span><span class="ident" id="7137630">Errorf</span><span class="op" id="7137636">(</span><span class="string" id="7137637">&#34;%s:&nbsp;inconsistent&nbsp;test&nbsp;case:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7137692">,</span>&nbsp;<span class="ident" id="7137694">test</span><span class="op" id="7137698">.</span><span class="ident" id="7137699">filename</span><span class="op" id="7137707">,</span>&nbsp;<span class="builtinfunc" id="7137709">len</span><span class="op" id="7137712">(</span><span class="ident" id="7137713">test</span><span class="op" id="7137717">.</span><span class="ident" id="7137718">source</span><span class="op" id="7137724">)</span><span class="op" id="7137725">,</span>&nbsp;<span class="ident" id="7137727">test</span><span class="op" id="7137731">.</span><span class="ident" id="7137732">size</span><span class="op" id="7137736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7137745">//&nbsp;add&nbsp;file&nbsp;and&nbsp;verify&nbsp;name&nbsp;and&nbsp;size</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137784">f</span>&nbsp;<span class="op" id="7137786">:=</span>&nbsp;<span class="ident" id="7137789">fset</span><span class="op" id="7137793">.</span><span class="ident" id="7137794">AddFile</span><span class="op" id="7137801">(</span><span class="ident" id="7137802">test</span><span class="op" id="7137806">.</span><span class="ident" id="7137807">filename</span><span class="op" id="7137815">,</span>&nbsp;<span class="ident" id="7137817">fset</span><span class="op" id="7137821">.</span><span class="ident" id="7137822">Base</span><span class="op" id="7137826">(</span><span class="op" id="7137827">)</span><span class="op" id="7137828">+</span><span class="ident" id="7137829">delta</span><span class="op" id="7137834">,</span>&nbsp;<span class="ident" id="7137836">test</span><span class="op" id="7137840">.</span><span class="ident" id="7137841">size</span><span class="op" id="7137845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137849">if</span>&nbsp;<span class="ident" id="7137852">f</span><span class="op" id="7137853">.</span><span class="ident" id="7137854">Name</span><span class="op" id="7137858">(</span><span class="op" id="7137859">)</span>&nbsp;<span class="op" id="7137861">!=</span>&nbsp;<span class="ident" id="7137864">test</span><span class="op" id="7137868">.</span><span class="ident" id="7137869">filename</span>&nbsp;<span class="op" id="7137878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137883">t</span><span class="op" id="7137884">.</span><span class="ident" id="7137885">Errorf</span><span class="op" id="7137891">(</span><span class="string" id="7137892">&#34;got&nbsp;filename&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7137918">,</span>&nbsp;<span class="ident" id="7137920">f</span><span class="op" id="7137921">.</span><span class="ident" id="7137922">Name</span><span class="op" id="7137926">(</span><span class="op" id="7137927">)</span><span class="op" id="7137928">,</span>&nbsp;<span class="ident" id="7137930">test</span><span class="op" id="7137934">.</span><span class="ident" id="7137935">filename</span><span class="op" id="7137943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137951">if</span>&nbsp;<span class="ident" id="7137954">f</span><span class="op" id="7137955">.</span><span class="ident" id="7137956">Size</span><span class="op" id="7137960">(</span><span class="op" id="7137961">)</span>&nbsp;<span class="op" id="7137963">!=</span>&nbsp;<span class="ident" id="7137966">test</span><span class="op" id="7137970">.</span><span class="ident" id="7137971">size</span>&nbsp;<span class="op" id="7137976">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137981">t</span><span class="op" id="7137982">.</span><span class="ident" id="7137983">Errorf</span><span class="op" id="7137989">(</span><span class="string" id="7137990">&#34;%s:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7138021">,</span>&nbsp;<span class="ident" id="7138023">f</span><span class="op" id="7138024">.</span><span class="ident" id="7138025">Name</span><span class="op" id="7138029">(</span><span class="op" id="7138030">)</span><span class="op" id="7138031">,</span>&nbsp;<span class="ident" id="7138033">f</span><span class="op" id="7138034">.</span><span class="ident" id="7138035">Size</span><span class="op" id="7138039">(</span><span class="op" id="7138040">)</span><span class="op" id="7138041">,</span>&nbsp;<span class="ident" id="7138043">test</span><span class="op" id="7138047">.</span><span class="ident" id="7138048">size</span><span class="op" id="7138052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138060">if</span>&nbsp;<span class="ident" id="7138063">fset</span><span class="op" id="7138067">.</span><span class="ident" id="7138068">File</span><span class="op" id="7138072">(</span><span class="ident" id="7138073">f</span><span class="op" id="7138074">.</span><span class="ident" id="7138075">Pos</span><span class="op" id="7138078">(</span><span class="num" id="7138079">0</span><span class="op" id="7138080">)</span><span class="op" id="7138081">)</span>&nbsp;<span class="op" id="7138083">!=</span>&nbsp;<span class="ident" id="7138086">f</span>&nbsp;<span class="op" id="7138088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138093">t</span><span class="op" id="7138094">.</span><span class="ident" id="7138095">Errorf</span><span class="op" id="7138101">(</span><span class="string" id="7138102">&#34;%s:&nbsp;f.Pos(0)&nbsp;was&nbsp;not&nbsp;found&nbsp;in&nbsp;f&#34;</span><span class="op" id="7138135">,</span>&nbsp;<span class="ident" id="7138137">f</span><span class="op" id="7138138">.</span><span class="ident" id="7138139">Name</span><span class="op" id="7138143">(</span><span class="op" id="7138144">)</span><span class="op" id="7138145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138149">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7138154">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138207">for</span>&nbsp;<span class="ident" id="7138211">i</span><span class="op" id="7138212">,</span>&nbsp;<span class="ident" id="7138214">offset</span>&nbsp;<span class="op" id="7138221">:=</span>&nbsp;<span class="keyword" id="7138224">range</span>&nbsp;<span class="ident" id="7138230">test</span><span class="op" id="7138234">.</span><span class="ident" id="7138235">lines</span>&nbsp;<span class="op" id="7138241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138246">f</span><span class="op" id="7138247">.</span><span class="ident" id="7138248">AddLine</span><span class="op" id="7138255">(</span><span class="ident" id="7138256">offset</span><span class="op" id="7138262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138267">if</span>&nbsp;<span class="ident" id="7138270">f</span><span class="op" id="7138271">.</span><span class="ident" id="7138272">LineCount</span><span class="op" id="7138281">(</span><span class="op" id="7138282">)</span>&nbsp;<span class="op" id="7138284">!=</span>&nbsp;<span class="ident" id="7138287">i</span><span class="op" id="7138288">+</span><span class="num" id="7138289">1</span>&nbsp;<span class="op" id="7138291">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138297">t</span><span class="op" id="7138298">.</span><span class="ident" id="7138299">Errorf</span><span class="op" id="7138305">(</span><span class="string" id="7138306">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7138347">,</span>&nbsp;<span class="ident" id="7138349">f</span><span class="op" id="7138350">.</span><span class="ident" id="7138351">Name</span><span class="op" id="7138355">(</span><span class="op" id="7138356">)</span><span class="op" id="7138357">,</span>&nbsp;<span class="ident" id="7138359">f</span><span class="op" id="7138360">.</span><span class="ident" id="7138361">LineCount</span><span class="op" id="7138370">(</span><span class="op" id="7138371">)</span><span class="op" id="7138372">,</span>&nbsp;<span class="ident" id="7138374">i</span><span class="op" id="7138375">+</span><span class="num" id="7138376">1</span><span class="op" id="7138377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7138387">//&nbsp;adding&nbsp;the&nbsp;same&nbsp;offset&nbsp;again&nbsp;should&nbsp;be&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138440">f</span><span class="op" id="7138441">.</span><span class="ident" id="7138442">AddLine</span><span class="op" id="7138449">(</span><span class="ident" id="7138450">offset</span><span class="op" id="7138456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138461">if</span>&nbsp;<span class="ident" id="7138464">f</span><span class="op" id="7138465">.</span><span class="ident" id="7138466">LineCount</span><span class="op" id="7138475">(</span><span class="op" id="7138476">)</span>&nbsp;<span class="op" id="7138478">!=</span>&nbsp;<span class="ident" id="7138481">i</span><span class="op" id="7138482">+</span><span class="num" id="7138483">1</span>&nbsp;<span class="op" id="7138485">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138491">t</span><span class="op" id="7138492">.</span><span class="ident" id="7138493">Errorf</span><span class="op" id="7138499">(</span><span class="string" id="7138500">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;unchanged&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7138551">,</span>&nbsp;<span class="ident" id="7138553">f</span><span class="op" id="7138554">.</span><span class="ident" id="7138555">Name</span><span class="op" id="7138559">(</span><span class="op" id="7138560">)</span><span class="op" id="7138561">,</span>&nbsp;<span class="ident" id="7138563">f</span><span class="op" id="7138564">.</span><span class="ident" id="7138565">LineCount</span><span class="op" id="7138574">(</span><span class="op" id="7138575">)</span><span class="op" id="7138576">,</span>&nbsp;<span class="ident" id="7138578">i</span><span class="op" id="7138579">+</span><span class="num" id="7138580">1</span><span class="op" id="7138581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138591">verifyPositions</span><span class="op" id="7138606">(</span><span class="ident" id="7138607">t</span><span class="op" id="7138608">,</span>&nbsp;<span class="ident" id="7138610">fset</span><span class="op" id="7138614">,</span>&nbsp;<span class="ident" id="7138616">f</span><span class="op" id="7138617">,</span>&nbsp;<span class="ident" id="7138619">test</span><span class="op" id="7138623">.</span><span class="ident" id="7138624">lines</span><span class="op" id="7138629">[</span><span class="num" id="7138630">0</span><span class="op" id="7138631">:</span><span class="ident" id="7138632">i</span><span class="op" id="7138633">+</span><span class="num" id="7138634">1</span><span class="op" id="7138635">]</span><span class="op" id="7138636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7138645">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLines&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138699">if</span>&nbsp;<span class="ident" id="7138702">ok</span>&nbsp;<span class="op" id="7138705">:=</span>&nbsp;<span class="ident" id="7138708">f</span><span class="op" id="7138709">.</span><span class="ident" id="7138710">SetLines</span><span class="op" id="7138718">(</span><span class="ident" id="7138719">test</span><span class="op" id="7138723">.</span><span class="ident" id="7138724">lines</span><span class="op" id="7138729">)</span><span class="op" id="7138730">;</span>&nbsp;<span class="op" id="7138732">!</span><span class="ident" id="7138733">ok</span>&nbsp;<span class="op" id="7138736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138741">t</span><span class="op" id="7138742">.</span><span class="ident" id="7138743">Errorf</span><span class="op" id="7138749">(</span><span class="string" id="7138750">&#34;%s:&nbsp;SetLines&nbsp;failed&#34;</span><span class="op" id="7138771">,</span>&nbsp;<span class="ident" id="7138773">f</span><span class="op" id="7138774">.</span><span class="ident" id="7138775">Name</span><span class="op" id="7138779">(</span><span class="op" id="7138780">)</span><span class="op" id="7138781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138789">if</span>&nbsp;<span class="ident" id="7138792">f</span><span class="op" id="7138793">.</span><span class="ident" id="7138794">LineCount</span><span class="op" id="7138803">(</span><span class="op" id="7138804">)</span>&nbsp;<span class="op" id="7138806">!=</span>&nbsp;<span class="builtinfunc" id="7138809">len</span><span class="op" id="7138812">(</span><span class="ident" id="7138813">test</span><span class="op" id="7138817">.</span><span class="ident" id="7138818">lines</span><span class="op" id="7138823">)</span>&nbsp;<span class="op" id="7138825">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138830">t</span><span class="op" id="7138831">.</span><span class="ident" id="7138832">Errorf</span><span class="op" id="7138838">(</span><span class="string" id="7138839">&#34;%s,&nbsp;SetLines:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7138881">,</span>&nbsp;<span class="ident" id="7138883">f</span><span class="op" id="7138884">.</span><span class="ident" id="7138885">Name</span><span class="op" id="7138889">(</span><span class="op" id="7138890">)</span><span class="op" id="7138891">,</span>&nbsp;<span class="ident" id="7138893">f</span><span class="op" id="7138894">.</span><span class="ident" id="7138895">LineCount</span><span class="op" id="7138904">(</span><span class="op" id="7138905">)</span><span class="op" id="7138906">,</span>&nbsp;<span class="builtinfunc" id="7138908">len</span><span class="op" id="7138911">(</span><span class="ident" id="7138912">test</span><span class="op" id="7138916">.</span><span class="ident" id="7138917">lines</span><span class="op" id="7138922">)</span><span class="op" id="7138923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138931">verifyPositions</span><span class="op" id="7138946">(</span><span class="ident" id="7138947">t</span><span class="op" id="7138948">,</span>&nbsp;<span class="ident" id="7138950">fset</span><span class="op" id="7138954">,</span>&nbsp;<span class="ident" id="7138956">f</span><span class="op" id="7138957">,</span>&nbsp;<span class="ident" id="7138959">test</span><span class="op" id="7138963">.</span><span class="ident" id="7138964">lines</span><span class="op" id="7138969">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7138974">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLinesForContent&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139038">src</span>&nbsp;<span class="op" id="7139042">:=</span>&nbsp;<span class="ident" id="7139045">test</span><span class="op" id="7139049">.</span><span class="ident" id="7139050">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139059">if</span>&nbsp;<span class="ident" id="7139062">src</span>&nbsp;<span class="op" id="7139066">==</span>&nbsp;<span class="ident" id="7139069">nil</span>&nbsp;<span class="op" id="7139073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7139078">//&nbsp;no&nbsp;test&nbsp;source&nbsp;available&nbsp;-&nbsp;create&nbsp;one&nbsp;from&nbsp;scratch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139135">src</span>&nbsp;<span class="op" id="7139139">=</span>&nbsp;<span class="ident" id="7139141">makeTestSource</span><span class="op" id="7139155">(</span><span class="ident" id="7139156">test</span><span class="op" id="7139160">.</span><span class="ident" id="7139161">size</span><span class="op" id="7139165">,</span>&nbsp;<span class="ident" id="7139167">test</span><span class="op" id="7139171">.</span><span class="ident" id="7139172">lines</span><span class="op" id="7139177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139181">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139185">f</span><span class="op" id="7139186">.</span><span class="ident" id="7139187">SetLinesForContent</span><span class="op" id="7139205">(</span><span class="ident" id="7139206">src</span><span class="op" id="7139209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139213">if</span>&nbsp;<span class="ident" id="7139216">f</span><span class="op" id="7139217">.</span><span class="ident" id="7139218">LineCount</span><span class="op" id="7139227">(</span><span class="op" id="7139228">)</span>&nbsp;<span class="op" id="7139230">!=</span>&nbsp;<span class="builtinfunc" id="7139233">len</span><span class="op" id="7139236">(</span><span class="ident" id="7139237">test</span><span class="op" id="7139241">.</span><span class="ident" id="7139242">lines</span><span class="op" id="7139247">)</span>&nbsp;<span class="op" id="7139249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139254">t</span><span class="op" id="7139255">.</span><span class="ident" id="7139256">Errorf</span><span class="op" id="7139262">(</span><span class="string" id="7139263">&#34;%s,&nbsp;SetLinesForContent:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7139315">,</span>&nbsp;<span class="ident" id="7139317">f</span><span class="op" id="7139318">.</span><span class="ident" id="7139319">Name</span><span class="op" id="7139323">(</span><span class="op" id="7139324">)</span><span class="op" id="7139325">,</span>&nbsp;<span class="ident" id="7139327">f</span><span class="op" id="7139328">.</span><span class="ident" id="7139329">LineCount</span><span class="op" id="7139338">(</span><span class="op" id="7139339">)</span><span class="op" id="7139340">,</span>&nbsp;<span class="builtinfunc" id="7139342">len</span><span class="op" id="7139345">(</span><span class="ident" id="7139346">test</span><span class="op" id="7139350">.</span><span class="ident" id="7139351">lines</span><span class="op" id="7139356">)</span><span class="op" id="7139357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139365">verifyPositions</span><span class="op" id="7139380">(</span><span class="ident" id="7139381">t</span><span class="op" id="7139382">,</span>&nbsp;<span class="ident" id="7139384">fset</span><span class="op" id="7139388">,</span>&nbsp;<span class="ident" id="7139390">f</span><span class="op" id="7139391">,</span>&nbsp;<span class="ident" id="7139393">test</span><span class="op" id="7139397">.</span><span class="ident" id="7139398">lines</span><span class="op" id="7139403">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139406">}</span><br>
<span class="lineno"></span><span class="op" id="7139408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7139411">func</span>&nbsp;<span class="ident" id="7139416">TestLineInfo</span><span class="op" id="7139428">(</span><span class="ident" id="7139429">t</span>&nbsp;<span class="op" id="7139431">*</span><span class="ident" id="7139432">testing</span><span class="op" id="7139439">.</span><span class="ident" id="7139440">T</span><span class="op" id="7139441">)</span>&nbsp;<span class="op" id="7139443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139446">fset</span>&nbsp;<span class="op" id="7139451">:=</span>&nbsp;<span class="ident" id="7139454">NewFileSet</span><span class="op" id="7139464">(</span><span class="op" id="7139465">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139468">f</span>&nbsp;<span class="op" id="7139470">:=</span>&nbsp;<span class="ident" id="7139473">fset</span><span class="op" id="7139477">.</span><span class="ident" id="7139478">AddFile</span><span class="op" id="7139485">(</span><span class="string" id="7139486">&#34;foo&#34;</span><span class="op" id="7139491">,</span>&nbsp;<span class="ident" id="7139493">fset</span><span class="op" id="7139497">.</span><span class="ident" id="7139498">Base</span><span class="op" id="7139502">(</span><span class="op" id="7139503">)</span><span class="op" id="7139504">,</span>&nbsp;<span class="num" id="7139506">500</span><span class="op" id="7139509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139512">lines</span>&nbsp;<span class="op" id="7139518">:=</span>&nbsp;<span class="op" id="7139521">[</span><span class="op" id="7139522">]</span><span class="builtintype" id="7139523">int</span><span class="op" id="7139526">{</span><span class="num" id="7139527">0</span><span class="op" id="7139528">,</span>&nbsp;<span class="num" id="7139530">42</span><span class="op" id="7139532">,</span>&nbsp;<span class="num" id="7139534">77</span><span class="op" id="7139536">,</span>&nbsp;<span class="num" id="7139538">100</span><span class="op" id="7139541">,</span>&nbsp;<span class="num" id="7139543">210</span><span class="op" id="7139546">,</span>&nbsp;<span class="num" id="7139548">220</span><span class="op" id="7139551">,</span>&nbsp;<span class="num" id="7139553">277</span><span class="op" id="7139556">,</span>&nbsp;<span class="num" id="7139558">300</span><span class="op" id="7139561">,</span>&nbsp;<span class="num" id="7139563">333</span><span class="op" id="7139566">,</span>&nbsp;<span class="num" id="7139568">401</span><span class="op" id="7139571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7139574">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;provide&nbsp;alternative&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139642">for</span>&nbsp;<span class="ident" id="7139646">_</span><span class="op" id="7139647">,</span>&nbsp;<span class="ident" id="7139649">offs</span>&nbsp;<span class="op" id="7139654">:=</span>&nbsp;<span class="keyword" id="7139657">range</span>&nbsp;<span class="ident" id="7139663">lines</span>&nbsp;<span class="op" id="7139669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139673">f</span><span class="op" id="7139674">.</span><span class="ident" id="7139675">AddLine</span><span class="op" id="7139682">(</span><span class="ident" id="7139683">offs</span><span class="op" id="7139687">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139691">f</span><span class="op" id="7139692">.</span><span class="ident" id="7139693">AddLineInfo</span><span class="op" id="7139704">(</span><span class="ident" id="7139705">offs</span><span class="op" id="7139709">,</span>&nbsp;<span class="string" id="7139711">&#34;bar&#34;</span><span class="op" id="7139716">,</span>&nbsp;<span class="num" id="7139718">42</span><span class="op" id="7139720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7139723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7139726">//&nbsp;verify&nbsp;positions&nbsp;for&nbsp;all&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7139763">for</span>&nbsp;<span class="ident" id="7139767">offs</span>&nbsp;<span class="op" id="7139772">:=</span>&nbsp;<span class="num" id="7139775">0</span><span class="op" id="7139776">;</span>&nbsp;<span class="ident" id="7139778">offs</span>&nbsp;<span class="op" id="7139783">&lt;=</span>&nbsp;<span class="ident" id="7139786">f</span><span class="op" id="7139787">.</span><span class="ident" id="7139788">Size</span><span class="op" id="7139792">(</span><span class="op" id="7139793">)</span><span class="op" id="7139794">;</span>&nbsp;<span class="ident" id="7139796">offs</span><span class="op" id="7139800">++</span>&nbsp;<span class="op" id="7139803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139807">p</span>&nbsp;<span class="op" id="7139809">:=</span>&nbsp;<span class="ident" id="7139812">f</span><span class="op" id="7139813">.</span><span class="ident" id="7139814">Pos</span><span class="op" id="7139817">(</span><span class="ident" id="7139818">offs</span><span class="op" id="7139822">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139826">_</span><span class="op" id="7139827">,</span>&nbsp;<span class="ident" id="7139829">col</span>&nbsp;<span class="op" id="7139833">:=</span>&nbsp;<span class="ident" id="7139836">linecol</span><span class="op" id="7139843">(</span><span class="ident" id="7139844">lines</span><span class="op" id="7139849">,</span>&nbsp;<span class="ident" id="7139851">offs</span><span class="op" id="7139855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139859">msg</span>&nbsp;<span class="op" id="7139863">:=</span>&nbsp;<span class="ident" id="7139866">fmt</span><span class="op" id="7139869">.</span><span class="ident" id="7139870">Sprintf</span><span class="op" id="7139877">(</span><span class="string" id="7139878">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7139902">,</span>&nbsp;<span class="ident" id="7139904">f</span><span class="op" id="7139905">.</span><span class="ident" id="7139906">Name</span><span class="op" id="7139910">(</span><span class="op" id="7139911">)</span><span class="op" id="7139912">,</span>&nbsp;<span class="ident" id="7139914">offs</span><span class="op" id="7139918">,</span>&nbsp;<span class="ident" id="7139920">p</span><span class="op" id="7139921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7139925">checkPos</span><span class="op" id="7139933">(</span><span class="ident" id="7139934">t</span><span class="op" id="7139935">,</span>&nbsp;<span class="ident" id="7139937">msg</span><span class="op" id="7139940">,</span>&nbsp;<span class="ident" id="7139942">f</span><span class="op" id="7139943">.</span><span class="ident" id="7139944">Position</span><span class="op" id="7139952">(</span><span class="ident" id="7139953">f</span><span class="op" id="7139954">.</span><span class="ident" id="7139955">Pos</span><span class="op" id="7139958">(</span><span class="ident" id="7139959">offs</span><span class="op" id="7139963">)</span><span class="op" id="7139964">)</span><span class="op" id="7139965">,</span>&nbsp;<span class="ident" id="7139967">Position</span><span class="op" id="7139975">{</span><span class="string" id="7139976">&#34;bar&#34;</span><span class="op" id="7139981">,</span>&nbsp;<span class="ident" id="7139983">offs</span><span class="op" id="7139987">,</span>&nbsp;<span class="num" id="7139989">42</span><span class="op" id="7139991">,</span>&nbsp;<span class="ident" id="7139993">col</span><span class="op" id="7139996">}</span><span class="op" id="7139997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140001">checkPos</span><span class="op" id="7140009">(</span><span class="ident" id="7140010">t</span><span class="op" id="7140011">,</span>&nbsp;<span class="ident" id="7140013">msg</span><span class="op" id="7140016">,</span>&nbsp;<span class="ident" id="7140018">fset</span><span class="op" id="7140022">.</span><span class="ident" id="7140023">Position</span><span class="op" id="7140031">(</span><span class="ident" id="7140032">p</span><span class="op" id="7140033">)</span><span class="op" id="7140034">,</span>&nbsp;<span class="ident" id="7140036">Position</span><span class="op" id="7140044">{</span><span class="string" id="7140045">&#34;bar&#34;</span><span class="op" id="7140050">,</span>&nbsp;<span class="ident" id="7140052">offs</span><span class="op" id="7140056">,</span>&nbsp;<span class="num" id="7140058">42</span><span class="op" id="7140060">,</span>&nbsp;<span class="ident" id="7140062">col</span><span class="op" id="7140065">}</span><span class="op" id="7140066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140069">}</span><br>
<span class="lineno">165</span><span class="op" id="7140071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7140074">func</span>&nbsp;<span class="ident" id="7140079">TestFiles</span><span class="op" id="7140088">(</span><span class="ident" id="7140089">t</span>&nbsp;<span class="op" id="7140091">*</span><span class="ident" id="7140092">testing</span><span class="op" id="7140099">.</span><span class="ident" id="7140100">T</span><span class="op" id="7140101">)</span>&nbsp;<span class="op" id="7140103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140106">fset</span>&nbsp;<span class="op" id="7140111">:=</span>&nbsp;<span class="ident" id="7140114">NewFileSet</span><span class="op" id="7140124">(</span><span class="op" id="7140125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140128">for</span>&nbsp;<span class="ident" id="7140132">i</span><span class="op" id="7140133">,</span>&nbsp;<span class="ident" id="7140135">test</span>&nbsp;<span class="op" id="7140140">:=</span>&nbsp;<span class="keyword" id="7140143">range</span>&nbsp;<span class="ident" id="7140149">tests</span>&nbsp;<span class="op" id="7140155">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140159">base</span>&nbsp;<span class="op" id="7140164">:=</span>&nbsp;<span class="ident" id="7140167">fset</span><span class="op" id="7140171">.</span><span class="ident" id="7140172">Base</span><span class="op" id="7140176">(</span><span class="op" id="7140177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140181">if</span>&nbsp;<span class="ident" id="7140184">i</span><span class="op" id="7140185">%</span><span class="num" id="7140186">2</span>&nbsp;<span class="op" id="7140188">==</span>&nbsp;<span class="num" id="7140191">1</span>&nbsp;<span class="op" id="7140193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7140198">//&nbsp;Setting&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7140245">//&nbsp;fset.Base(),&nbsp;so&nbsp;test&nbsp;some&nbsp;of&nbsp;each.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140286">base</span>&nbsp;<span class="op" id="7140291">=</span>&nbsp;<span class="op" id="7140293">-</span><span class="num" id="7140294">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140302">fset</span><span class="op" id="7140306">.</span><span class="ident" id="7140307">AddFile</span><span class="op" id="7140314">(</span><span class="ident" id="7140315">test</span><span class="op" id="7140319">.</span><span class="ident" id="7140320">filename</span><span class="op" id="7140328">,</span>&nbsp;<span class="ident" id="7140330">base</span><span class="op" id="7140334">,</span>&nbsp;<span class="ident" id="7140336">test</span><span class="op" id="7140340">.</span><span class="ident" id="7140341">size</span><span class="op" id="7140345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140349">j</span>&nbsp;<span class="op" id="7140351">:=</span>&nbsp;<span class="num" id="7140354">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140358">fset</span><span class="op" id="7140362">.</span><span class="ident" id="7140363">Iterate</span><span class="op" id="7140370">(</span><span class="keyword" id="7140371">func</span><span class="op" id="7140375">(</span><span class="ident" id="7140376">f</span>&nbsp;<span class="op" id="7140378">*</span><span class="ident" id="7140379">File</span><span class="op" id="7140383">)</span>&nbsp;<span class="builtintype" id="7140385">bool</span>&nbsp;<span class="op" id="7140390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140395">if</span>&nbsp;<span class="ident" id="7140398">f</span><span class="op" id="7140399">.</span><span class="ident" id="7140400">Name</span><span class="op" id="7140404">(</span><span class="op" id="7140405">)</span>&nbsp;<span class="op" id="7140407">!=</span>&nbsp;<span class="ident" id="7140410">tests</span><span class="op" id="7140415">[</span><span class="ident" id="7140416">j</span><span class="op" id="7140417">]</span><span class="op" id="7140418">.</span><span class="ident" id="7140419">filename</span>&nbsp;<span class="op" id="7140428">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140434">t</span><span class="op" id="7140435">.</span><span class="ident" id="7140436">Errorf</span><span class="op" id="7140442">(</span><span class="string" id="7140443">&#34;got&nbsp;filename&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7140471">,</span>&nbsp;<span class="ident" id="7140473">f</span><span class="op" id="7140474">.</span><span class="ident" id="7140475">Name</span><span class="op" id="7140479">(</span><span class="op" id="7140480">)</span><span class="op" id="7140481">,</span>&nbsp;<span class="ident" id="7140483">tests</span><span class="op" id="7140488">[</span><span class="ident" id="7140489">j</span><span class="op" id="7140490">]</span><span class="op" id="7140491">.</span><span class="ident" id="7140492">filename</span><span class="op" id="7140500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140510">j</span><span class="op" id="7140511">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140517">return</span>&nbsp;<span class="builtintype" id="7140524">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140531">}</span><span class="op" id="7140532">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140536">if</span>&nbsp;<span class="ident" id="7140539">j</span>&nbsp;<span class="op" id="7140541">!=</span>&nbsp;<span class="ident" id="7140544">i</span><span class="op" id="7140545">+</span><span class="num" id="7140546">1</span>&nbsp;<span class="op" id="7140548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140553">t</span><span class="op" id="7140554">.</span><span class="ident" id="7140555">Errorf</span><span class="op" id="7140561">(</span><span class="string" id="7140562">&#34;got&nbsp;%d&nbsp;files;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7140585">,</span>&nbsp;<span class="ident" id="7140587">j</span><span class="op" id="7140588">,</span>&nbsp;<span class="ident" id="7140590">i</span><span class="op" id="7140591">+</span><span class="num" id="7140592">1</span><span class="op" id="7140593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140600">}</span><br>
<span class="lineno"></span><span class="op" id="7140602">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="7140605">//&nbsp;FileSet.File&nbsp;should&nbsp;return&nbsp;nil&nbsp;if&nbsp;Pos&nbsp;is&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="keyword" id="7140678">func</span>&nbsp;<span class="ident" id="7140683">TestFileSetPastEnd</span><span class="op" id="7140701">(</span><span class="ident" id="7140702">t</span>&nbsp;<span class="op" id="7140704">*</span><span class="ident" id="7140705">testing</span><span class="op" id="7140712">.</span><span class="ident" id="7140713">T</span><span class="op" id="7140714">)</span>&nbsp;<span class="op" id="7140716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140719">fset</span>&nbsp;<span class="op" id="7140724">:=</span>&nbsp;<span class="ident" id="7140727">NewFileSet</span><span class="op" id="7140737">(</span><span class="op" id="7140738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140741">for</span>&nbsp;<span class="ident" id="7140745">_</span><span class="op" id="7140746">,</span>&nbsp;<span class="ident" id="7140748">test</span>&nbsp;<span class="op" id="7140753">:=</span>&nbsp;<span class="keyword" id="7140756">range</span>&nbsp;<span class="ident" id="7140762">tests</span>&nbsp;<span class="op" id="7140768">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140772">fset</span><span class="op" id="7140776">.</span><span class="ident" id="7140777">AddFile</span><span class="op" id="7140784">(</span><span class="ident" id="7140785">test</span><span class="op" id="7140789">.</span><span class="ident" id="7140790">filename</span><span class="op" id="7140798">,</span>&nbsp;<span class="ident" id="7140800">fset</span><span class="op" id="7140804">.</span><span class="ident" id="7140805">Base</span><span class="op" id="7140809">(</span><span class="op" id="7140810">)</span><span class="op" id="7140811">,</span>&nbsp;<span class="ident" id="7140813">test</span><span class="op" id="7140817">.</span><span class="ident" id="7140818">size</span><span class="op" id="7140822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7140828">if</span>&nbsp;<span class="ident" id="7140831">f</span>&nbsp;<span class="op" id="7140833">:=</span>&nbsp;<span class="ident" id="7140836">fset</span><span class="op" id="7140840">.</span><span class="ident" id="7140841">File</span><span class="op" id="7140845">(</span><span class="ident" id="7140846">Pos</span><span class="op" id="7140849">(</span><span class="ident" id="7140850">fset</span><span class="op" id="7140854">.</span><span class="ident" id="7140855">Base</span><span class="op" id="7140859">(</span><span class="op" id="7140860">)</span><span class="op" id="7140861">)</span><span class="op" id="7140862">)</span><span class="op" id="7140863">;</span>&nbsp;<span class="ident" id="7140865">f</span>&nbsp;<span class="op" id="7140867">!=</span>&nbsp;<span class="ident" id="7140870">nil</span>&nbsp;<span class="op" id="7140874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140878">t</span><span class="op" id="7140879">.</span><span class="ident" id="7140880">Errorf</span><span class="op" id="7140886">(</span><span class="string" id="7140887">&#34;got&nbsp;%v,&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7140905">,</span>&nbsp;<span class="ident" id="7140907">f</span><span class="op" id="7140908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7140911">}</span><br>
<span class="lineno">200</span><span class="op" id="7140913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7140916">func</span>&nbsp;<span class="ident" id="7140921">TestFileSetCacheUnlikely</span><span class="op" id="7140945">(</span><span class="ident" id="7140946">t</span>&nbsp;<span class="op" id="7140948">*</span><span class="ident" id="7140949">testing</span><span class="op" id="7140956">.</span><span class="ident" id="7140957">T</span><span class="op" id="7140958">)</span>&nbsp;<span class="op" id="7140960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140963">fset</span>&nbsp;<span class="op" id="7140968">:=</span>&nbsp;<span class="ident" id="7140971">NewFileSet</span><span class="op" id="7140981">(</span><span class="op" id="7140982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7140985">offsets</span>&nbsp;<span class="op" id="7140993">:=</span>&nbsp;<span class="builtinfunc" id="7140996">make</span><span class="op" id="7141000">(</span><span class="keyword" id="7141001">map</span><span class="op" id="7141004">[</span><span class="builtintype" id="7141005">string</span><span class="op" id="7141011">]</span><span class="builtintype" id="7141012">int</span><span class="op" id="7141015">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141018">for</span>&nbsp;<span class="ident" id="7141022">_</span><span class="op" id="7141023">,</span>&nbsp;<span class="ident" id="7141025">test</span>&nbsp;<span class="op" id="7141030">:=</span>&nbsp;<span class="keyword" id="7141033">range</span>&nbsp;<span class="ident" id="7141039">tests</span>&nbsp;<span class="op" id="7141045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141049">offsets</span><span class="op" id="7141056">[</span><span class="ident" id="7141057">test</span><span class="op" id="7141061">.</span><span class="ident" id="7141062">filename</span><span class="op" id="7141070">]</span>&nbsp;<span class="op" id="7141072">=</span>&nbsp;<span class="ident" id="7141074">fset</span><span class="op" id="7141078">.</span><span class="ident" id="7141079">Base</span><span class="op" id="7141083">(</span><span class="op" id="7141084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141088">fset</span><span class="op" id="7141092">.</span><span class="ident" id="7141093">AddFile</span><span class="op" id="7141100">(</span><span class="ident" id="7141101">test</span><span class="op" id="7141105">.</span><span class="ident" id="7141106">filename</span><span class="op" id="7141114">,</span>&nbsp;<span class="ident" id="7141116">fset</span><span class="op" id="7141120">.</span><span class="ident" id="7141121">Base</span><span class="op" id="7141125">(</span><span class="op" id="7141126">)</span><span class="op" id="7141127">,</span>&nbsp;<span class="ident" id="7141129">test</span><span class="op" id="7141133">.</span><span class="ident" id="7141134">size</span><span class="op" id="7141138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141144">for</span>&nbsp;<span class="ident" id="7141148">file</span><span class="op" id="7141152">,</span>&nbsp;<span class="ident" id="7141154">pos</span>&nbsp;<span class="op" id="7141158">:=</span>&nbsp;<span class="keyword" id="7141161">range</span>&nbsp;<span class="ident" id="7141167">offsets</span>&nbsp;<span class="op" id="7141175">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141179">f</span>&nbsp;<span class="op" id="7141181">:=</span>&nbsp;<span class="ident" id="7141184">fset</span><span class="op" id="7141188">.</span><span class="ident" id="7141189">File</span><span class="op" id="7141193">(</span><span class="ident" id="7141194">Pos</span><span class="op" id="7141197">(</span><span class="ident" id="7141198">pos</span><span class="op" id="7141201">)</span><span class="op" id="7141202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141206">if</span>&nbsp;<span class="ident" id="7141209">f</span><span class="op" id="7141210">.</span><span class="ident" id="7141211">Name</span><span class="op" id="7141215">(</span><span class="op" id="7141216">)</span>&nbsp;<span class="op" id="7141218">!=</span>&nbsp;<span class="ident" id="7141221">file</span>&nbsp;<span class="op" id="7141226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141231">t</span><span class="op" id="7141232">.</span><span class="ident" id="7141233">Errorf</span><span class="op" id="7141239">(</span><span class="string" id="7141240">&#34;got&nbsp;%q&nbsp;at&nbsp;position&nbsp;%d,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7141272">,</span>&nbsp;<span class="ident" id="7141274">f</span><span class="op" id="7141275">.</span><span class="ident" id="7141276">Name</span><span class="op" id="7141280">(</span><span class="op" id="7141281">)</span><span class="op" id="7141282">,</span>&nbsp;<span class="ident" id="7141284">pos</span><span class="op" id="7141287">,</span>&nbsp;<span class="ident" id="7141289">file</span><span class="op" id="7141293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141300">}</span><br>
<span class="lineno">215</span><span class="op" id="7141302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7141305">//&nbsp;issue&nbsp;4345.&nbsp;Test&nbsp;concurrent&nbsp;use&nbsp;of&nbsp;FileSet.Pos&nbsp;does&nbsp;not&nbsp;trigger&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7141374">//&nbsp;race&nbsp;in&nbsp;the&nbsp;FileSet&nbsp;position&nbsp;cache.</span><br>
<span class="lineno"></span><span class="keyword" id="7141413">func</span>&nbsp;<span class="ident" id="7141418">TestFileSetRace</span><span class="op" id="7141433">(</span><span class="ident" id="7141434">t</span>&nbsp;<span class="op" id="7141436">*</span><span class="ident" id="7141437">testing</span><span class="op" id="7141444">.</span><span class="ident" id="7141445">T</span><span class="op" id="7141446">)</span>&nbsp;<span class="op" id="7141448">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141451">fset</span>&nbsp;<span class="op" id="7141456">:=</span>&nbsp;<span class="ident" id="7141459">NewFileSet</span><span class="op" id="7141469">(</span><span class="op" id="7141470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141473">for</span>&nbsp;<span class="ident" id="7141477">i</span>&nbsp;<span class="op" id="7141479">:=</span>&nbsp;<span class="num" id="7141482">0</span><span class="op" id="7141483">;</span>&nbsp;<span class="ident" id="7141485">i</span>&nbsp;<span class="op" id="7141487">&lt;</span>&nbsp;<span class="num" id="7141489">100</span><span class="op" id="7141492">;</span>&nbsp;<span class="ident" id="7141494">i</span><span class="op" id="7141495">++</span>&nbsp;<span class="op" id="7141498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141502">fset</span><span class="op" id="7141506">.</span><span class="ident" id="7141507">AddFile</span><span class="op" id="7141514">(</span><span class="ident" id="7141515">fmt</span><span class="op" id="7141518">.</span><span class="ident" id="7141519">Sprintf</span><span class="op" id="7141526">(</span><span class="string" id="7141527">&#34;file-%d&#34;</span><span class="op" id="7141536">,</span>&nbsp;<span class="ident" id="7141538">i</span><span class="op" id="7141539">)</span><span class="op" id="7141540">,</span>&nbsp;<span class="ident" id="7141542">fset</span><span class="op" id="7141546">.</span><span class="ident" id="7141547">Base</span><span class="op" id="7141551">(</span><span class="op" id="7141552">)</span><span class="op" id="7141553">,</span>&nbsp;<span class="num" id="7141555">1031</span><span class="op" id="7141559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141565">max</span>&nbsp;<span class="op" id="7141569">:=</span>&nbsp;<span class="builtintype" id="7141572">int32</span><span class="op" id="7141577">(</span><span class="ident" id="7141578">fset</span><span class="op" id="7141582">.</span><span class="ident" id="7141583">Base</span><span class="op" id="7141587">(</span><span class="op" id="7141588">)</span><span class="op" id="7141589">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141592">var</span>&nbsp;<span class="ident" id="7141596">stop</span>&nbsp;<span class="ident" id="7141601">sync</span><span class="op" id="7141605">.</span><span class="ident" id="7141606">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141617">r</span>&nbsp;<span class="op" id="7141619">:=</span>&nbsp;<span class="ident" id="7141622">rand</span><span class="op" id="7141626">.</span><span class="ident" id="7141627">New</span><span class="op" id="7141630">(</span><span class="ident" id="7141631">rand</span><span class="op" id="7141635">.</span><span class="ident" id="7141636">NewSource</span><span class="op" id="7141645">(</span><span class="num" id="7141646">7</span><span class="op" id="7141647">)</span><span class="op" id="7141648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141651">for</span>&nbsp;<span class="ident" id="7141655">i</span>&nbsp;<span class="op" id="7141657">:=</span>&nbsp;<span class="num" id="7141660">0</span><span class="op" id="7141661">;</span>&nbsp;<span class="ident" id="7141663">i</span>&nbsp;<span class="op" id="7141665">&lt;</span>&nbsp;<span class="num" id="7141667">2</span><span class="op" id="7141668">;</span>&nbsp;<span class="ident" id="7141670">i</span><span class="op" id="7141671">++</span>&nbsp;<span class="op" id="7141674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141678">r</span>&nbsp;<span class="op" id="7141680">:=</span>&nbsp;<span class="ident" id="7141683">rand</span><span class="op" id="7141687">.</span><span class="ident" id="7141688">New</span><span class="op" id="7141691">(</span><span class="ident" id="7141692">rand</span><span class="op" id="7141696">.</span><span class="ident" id="7141697">NewSource</span><span class="op" id="7141706">(</span><span class="ident" id="7141707">r</span><span class="op" id="7141708">.</span><span class="ident" id="7141709">Int63</span><span class="op" id="7141714">(</span><span class="op" id="7141715">)</span><span class="op" id="7141716">)</span><span class="op" id="7141717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141721">stop</span><span class="op" id="7141725">.</span><span class="ident" id="7141726">Add</span><span class="op" id="7141729">(</span><span class="num" id="7141730">1</span><span class="op" id="7141731">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141735">go</span>&nbsp;<span class="keyword" id="7141738">func</span><span class="op" id="7141742">(</span><span class="op" id="7141743">)</span>&nbsp;<span class="op" id="7141745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141750">for</span>&nbsp;<span class="ident" id="7141754">i</span>&nbsp;<span class="op" id="7141756">:=</span>&nbsp;<span class="num" id="7141759">0</span><span class="op" id="7141760">;</span>&nbsp;<span class="ident" id="7141762">i</span>&nbsp;<span class="op" id="7141764">&lt;</span>&nbsp;<span class="num" id="7141766">1000</span><span class="op" id="7141770">;</span>&nbsp;<span class="ident" id="7141772">i</span><span class="op" id="7141773">++</span>&nbsp;<span class="op" id="7141776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141782">fset</span><span class="op" id="7141786">.</span><span class="ident" id="7141787">Position</span><span class="op" id="7141795">(</span><span class="ident" id="7141796">Pos</span><span class="op" id="7141799">(</span><span class="ident" id="7141800">r</span><span class="op" id="7141801">.</span><span class="ident" id="7141802">Int31n</span><span class="op" id="7141808">(</span><span class="ident" id="7141809">max</span><span class="op" id="7141812">)</span><span class="op" id="7141813">)</span><span class="op" id="7141814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141824">stop</span><span class="op" id="7141828">.</span><span class="ident" id="7141829">Done</span><span class="op" id="7141833">(</span><span class="op" id="7141834">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141838">}</span><span class="op" id="7141839">(</span><span class="op" id="7141840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7141843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141846">stop</span><span class="op" id="7141850">.</span><span class="ident" id="7141851">Wait</span><span class="op" id="7141855">(</span><span class="op" id="7141856">)</span><br>
<span class="lineno"></span><span class="op" id="7141858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7141861">func</span>&nbsp;<span class="ident" id="7141866">TestPositionFor</span><span class="op" id="7141881">(</span><span class="ident" id="7141882">t</span>&nbsp;<span class="op" id="7141884">*</span><span class="ident" id="7141885">testing</span><span class="op" id="7141892">.</span><span class="ident" id="7141893">T</span><span class="op" id="7141894">)</span>&nbsp;<span class="op" id="7141896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141899">src</span>&nbsp;<span class="op" id="7141903">:=</span>&nbsp;<span class="op" id="7141906">[</span><span class="op" id="7141907">]</span><span class="builtintype" id="7141908">byte</span><span class="op" id="7141912">(</span><span class="string" id="7141913">`<br>
<span class="lineno"></span>foo<br>
<span class="lineno"></span>b<br>
<span class="lineno"></span>ar<br>
<span class="lineno">245</span>//line&nbsp;:100<br>
<span class="lineno"></span>foobar<br>
<span class="lineno"></span>//line&nbsp;bar:3<br>
<span class="lineno"></span>done<br>
<span class="lineno"></span>`</span><span class="op" id="7141962">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7141966">const</span>&nbsp;<span class="ident" id="7141972">filename</span>&nbsp;<span class="op" id="7141981">=</span>&nbsp;<span class="string" id="7141983">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7141990">fset</span>&nbsp;<span class="op" id="7141995">:=</span>&nbsp;<span class="ident" id="7141998">NewFileSet</span><span class="op" id="7142008">(</span><span class="op" id="7142009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142012">f</span>&nbsp;<span class="op" id="7142014">:=</span>&nbsp;<span class="ident" id="7142017">fset</span><span class="op" id="7142021">.</span><span class="ident" id="7142022">AddFile</span><span class="op" id="7142029">(</span><span class="ident" id="7142030">filename</span><span class="op" id="7142038">,</span>&nbsp;<span class="ident" id="7142040">fset</span><span class="op" id="7142044">.</span><span class="ident" id="7142045">Base</span><span class="op" id="7142049">(</span><span class="op" id="7142050">)</span><span class="op" id="7142051">,</span>&nbsp;<span class="builtinfunc" id="7142053">len</span><span class="op" id="7142056">(</span><span class="ident" id="7142057">src</span><span class="op" id="7142060">)</span><span class="op" id="7142061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142064">f</span><span class="op" id="7142065">.</span><span class="ident" id="7142066">SetLinesForContent</span><span class="op" id="7142084">(</span><span class="ident" id="7142085">src</span><span class="op" id="7142088">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142092">//&nbsp;verify&nbsp;position&nbsp;info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7142117">for</span>&nbsp;<span class="ident" id="7142121">i</span><span class="op" id="7142122">,</span>&nbsp;<span class="ident" id="7142124">offs</span>&nbsp;<span class="op" id="7142129">:=</span>&nbsp;<span class="keyword" id="7142132">range</span>&nbsp;<span class="ident" id="7142138">f</span><span class="op" id="7142139">.</span><span class="ident" id="7142140">lines</span>&nbsp;<span class="op" id="7142146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142150">got1</span>&nbsp;<span class="op" id="7142155">:=</span>&nbsp;<span class="ident" id="7142158">f</span><span class="op" id="7142159">.</span><span class="ident" id="7142160">PositionFor</span><span class="op" id="7142171">(</span><span class="ident" id="7142172">f</span><span class="op" id="7142173">.</span><span class="ident" id="7142174">Pos</span><span class="op" id="7142177">(</span><span class="ident" id="7142178">offs</span><span class="op" id="7142182">)</span><span class="op" id="7142183">,</span>&nbsp;<span class="builtintype" id="7142185">false</span><span class="op" id="7142190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142194">got2</span>&nbsp;<span class="op" id="7142199">:=</span>&nbsp;<span class="ident" id="7142202">f</span><span class="op" id="7142203">.</span><span class="ident" id="7142204">PositionFor</span><span class="op" id="7142215">(</span><span class="ident" id="7142216">f</span><span class="op" id="7142217">.</span><span class="ident" id="7142218">Pos</span><span class="op" id="7142221">(</span><span class="ident" id="7142222">offs</span><span class="op" id="7142226">)</span><span class="op" id="7142227">,</span>&nbsp;<span class="builtintype" id="7142229">true</span><span class="op" id="7142233">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142237">got3</span>&nbsp;<span class="op" id="7142242">:=</span>&nbsp;<span class="ident" id="7142245">f</span><span class="op" id="7142246">.</span><span class="ident" id="7142247">Position</span><span class="op" id="7142255">(</span><span class="ident" id="7142256">f</span><span class="op" id="7142257">.</span><span class="ident" id="7142258">Pos</span><span class="op" id="7142261">(</span><span class="ident" id="7142262">offs</span><span class="op" id="7142266">)</span><span class="op" id="7142267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142271">want</span>&nbsp;<span class="op" id="7142276">:=</span>&nbsp;<span class="ident" id="7142279">Position</span><span class="op" id="7142287">{</span><span class="ident" id="7142288">filename</span><span class="op" id="7142296">,</span>&nbsp;<span class="ident" id="7142298">offs</span><span class="op" id="7142302">,</span>&nbsp;<span class="ident" id="7142304">i</span>&nbsp;<span class="op" id="7142306">+</span>&nbsp;<span class="num" id="7142308">1</span><span class="op" id="7142309">,</span>&nbsp;<span class="num" id="7142311">1</span><span class="op" id="7142312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142316">checkPos</span><span class="op" id="7142324">(</span><span class="ident" id="7142325">t</span><span class="op" id="7142326">,</span>&nbsp;<span class="string" id="7142328">&#34;1.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7142355">,</span>&nbsp;<span class="ident" id="7142357">got1</span><span class="op" id="7142361">,</span>&nbsp;<span class="ident" id="7142363">want</span><span class="op" id="7142367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142371">checkPos</span><span class="op" id="7142379">(</span><span class="ident" id="7142380">t</span><span class="op" id="7142381">,</span>&nbsp;<span class="string" id="7142383">&#34;1.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7142408">,</span>&nbsp;<span class="ident" id="7142410">got2</span><span class="op" id="7142414">,</span>&nbsp;<span class="ident" id="7142416">want</span><span class="op" id="7142420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142424">checkPos</span><span class="op" id="7142432">(</span><span class="ident" id="7142433">t</span><span class="op" id="7142434">,</span>&nbsp;<span class="string" id="7142436">&#34;1.&nbsp;Position&#34;</span><span class="op" id="7142449">,</span>&nbsp;<span class="ident" id="7142451">got3</span><span class="op" id="7142455">,</span>&nbsp;<span class="ident" id="7142457">want</span><span class="op" id="7142461">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7142464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142468">//&nbsp;manually&nbsp;add&nbsp;//line&nbsp;info&nbsp;on&nbsp;lines&nbsp;l1,&nbsp;l2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7142513">const</span>&nbsp;<span class="ident" id="7142519">l1</span><span class="op" id="7142521">,</span>&nbsp;<span class="ident" id="7142523">l2</span>&nbsp;<span class="op" id="7142526">=</span>&nbsp;<span class="num" id="7142528">5</span><span class="op" id="7142529">,</span>&nbsp;<span class="num" id="7142531">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142534">f</span><span class="op" id="7142535">.</span><span class="ident" id="7142536">AddLineInfo</span><span class="op" id="7142547">(</span><span class="ident" id="7142548">f</span><span class="op" id="7142549">.</span><span class="ident" id="7142550">lines</span><span class="op" id="7142555">[</span><span class="ident" id="7142556">l1</span><span class="op" id="7142558">-</span><span class="num" id="7142559">1</span><span class="op" id="7142560">]</span><span class="op" id="7142561">,</span>&nbsp;<span class="string" id="7142563">&#34;&#34;</span><span class="op" id="7142565">,</span>&nbsp;<span class="num" id="7142567">100</span><span class="op" id="7142570">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142573">f</span><span class="op" id="7142574">.</span><span class="ident" id="7142575">AddLineInfo</span><span class="op" id="7142586">(</span><span class="ident" id="7142587">f</span><span class="op" id="7142588">.</span><span class="ident" id="7142589">lines</span><span class="op" id="7142594">[</span><span class="ident" id="7142595">l2</span><span class="op" id="7142597">-</span><span class="num" id="7142598">1</span><span class="op" id="7142599">]</span><span class="op" id="7142600">,</span>&nbsp;<span class="string" id="7142602">&#34;bar&#34;</span><span class="op" id="7142607">,</span>&nbsp;<span class="num" id="7142609">3</span><span class="op" id="7142610">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142614">//&nbsp;unadjusted&nbsp;position&nbsp;info&nbsp;must&nbsp;remain&nbsp;unchanged</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7142665">for</span>&nbsp;<span class="ident" id="7142669">i</span><span class="op" id="7142670">,</span>&nbsp;<span class="ident" id="7142672">offs</span>&nbsp;<span class="op" id="7142677">:=</span>&nbsp;<span class="keyword" id="7142680">range</span>&nbsp;<span class="ident" id="7142686">f</span><span class="op" id="7142687">.</span><span class="ident" id="7142688">lines</span>&nbsp;<span class="op" id="7142694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142698">got1</span>&nbsp;<span class="op" id="7142703">:=</span>&nbsp;<span class="ident" id="7142706">f</span><span class="op" id="7142707">.</span><span class="ident" id="7142708">PositionFor</span><span class="op" id="7142719">(</span><span class="ident" id="7142720">f</span><span class="op" id="7142721">.</span><span class="ident" id="7142722">Pos</span><span class="op" id="7142725">(</span><span class="ident" id="7142726">offs</span><span class="op" id="7142730">)</span><span class="op" id="7142731">,</span>&nbsp;<span class="builtintype" id="7142733">false</span><span class="op" id="7142738">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142742">want</span>&nbsp;<span class="op" id="7142747">:=</span>&nbsp;<span class="ident" id="7142750">Position</span><span class="op" id="7142758">{</span><span class="ident" id="7142759">filename</span><span class="op" id="7142767">,</span>&nbsp;<span class="ident" id="7142769">offs</span><span class="op" id="7142773">,</span>&nbsp;<span class="ident" id="7142775">i</span>&nbsp;<span class="op" id="7142777">+</span>&nbsp;<span class="num" id="7142779">1</span><span class="op" id="7142780">,</span>&nbsp;<span class="num" id="7142782">1</span><span class="op" id="7142783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142787">checkPos</span><span class="op" id="7142795">(</span><span class="ident" id="7142796">t</span><span class="op" id="7142797">,</span>&nbsp;<span class="string" id="7142799">&#34;2.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7142826">,</span>&nbsp;<span class="ident" id="7142828">got1</span><span class="op" id="7142832">,</span>&nbsp;<span class="ident" id="7142834">want</span><span class="op" id="7142838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7142841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7142845">//&nbsp;adjusted&nbsp;position&nbsp;info&nbsp;should&nbsp;have&nbsp;changed</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7142892">for</span>&nbsp;<span class="ident" id="7142896">i</span><span class="op" id="7142897">,</span>&nbsp;<span class="ident" id="7142899">offs</span>&nbsp;<span class="op" id="7142904">:=</span>&nbsp;<span class="keyword" id="7142907">range</span>&nbsp;<span class="ident" id="7142913">f</span><span class="op" id="7142914">.</span><span class="ident" id="7142915">lines</span>&nbsp;<span class="op" id="7142921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142925">got2</span>&nbsp;<span class="op" id="7142930">:=</span>&nbsp;<span class="ident" id="7142933">f</span><span class="op" id="7142934">.</span><span class="ident" id="7142935">PositionFor</span><span class="op" id="7142946">(</span><span class="ident" id="7142947">f</span><span class="op" id="7142948">.</span><span class="ident" id="7142949">Pos</span><span class="op" id="7142952">(</span><span class="ident" id="7142953">offs</span><span class="op" id="7142957">)</span><span class="op" id="7142958">,</span>&nbsp;<span class="builtintype" id="7142960">true</span><span class="op" id="7142964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7142968">got3</span>&nbsp;<span class="op" id="7142973">:=</span>&nbsp;<span class="ident" id="7142976">f</span><span class="op" id="7142977">.</span><span class="ident" id="7142978">Position</span><span class="op" id="7142986">(</span><span class="ident" id="7142987">f</span><span class="op" id="7142988">.</span><span class="ident" id="7142989">Pos</span><span class="op" id="7142992">(</span><span class="ident" id="7142993">offs</span><span class="op" id="7142997">)</span><span class="op" id="7142998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143002">want</span>&nbsp;<span class="op" id="7143007">:=</span>&nbsp;<span class="ident" id="7143010">Position</span><span class="op" id="7143018">{</span><span class="ident" id="7143019">filename</span><span class="op" id="7143027">,</span>&nbsp;<span class="ident" id="7143029">offs</span><span class="op" id="7143033">,</span>&nbsp;<span class="ident" id="7143035">i</span>&nbsp;<span class="op" id="7143037">+</span>&nbsp;<span class="num" id="7143039">1</span><span class="op" id="7143040">,</span>&nbsp;<span class="num" id="7143042">1</span><span class="op" id="7143043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7143047">//&nbsp;manually&nbsp;compute&nbsp;wanted&nbsp;filename&nbsp;and&nbsp;line</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143094">line</span>&nbsp;<span class="op" id="7143099">:=</span>&nbsp;<span class="ident" id="7143102">want</span><span class="op" id="7143106">.</span><span class="ident" id="7143107">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143114">if</span>&nbsp;<span class="ident" id="7143117">i</span><span class="op" id="7143118">+</span><span class="num" id="7143119">1</span>&nbsp;<span class="op" id="7143121">&gt;=</span>&nbsp;<span class="ident" id="7143124">l1</span>&nbsp;<span class="op" id="7143127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143132">want</span><span class="op" id="7143136">.</span><span class="ident" id="7143137">Filename</span>&nbsp;<span class="op" id="7143146">=</span>&nbsp;<span class="string" id="7143148">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143154">want</span><span class="op" id="7143158">.</span><span class="ident" id="7143159">Line</span>&nbsp;<span class="op" id="7143164">=</span>&nbsp;<span class="ident" id="7143166">line</span>&nbsp;<span class="op" id="7143171">-</span>&nbsp;<span class="ident" id="7143173">l1</span>&nbsp;<span class="op" id="7143176">+</span>&nbsp;<span class="num" id="7143178">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7143184">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143188">if</span>&nbsp;<span class="ident" id="7143191">i</span><span class="op" id="7143192">+</span><span class="num" id="7143193">1</span>&nbsp;<span class="op" id="7143195">&gt;=</span>&nbsp;<span class="ident" id="7143198">l2</span>&nbsp;<span class="op" id="7143201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143206">want</span><span class="op" id="7143210">.</span><span class="ident" id="7143211">Filename</span>&nbsp;<span class="op" id="7143220">=</span>&nbsp;<span class="string" id="7143222">&#34;bar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143231">want</span><span class="op" id="7143235">.</span><span class="ident" id="7143236">Line</span>&nbsp;<span class="op" id="7143241">=</span>&nbsp;<span class="ident" id="7143243">line</span>&nbsp;<span class="op" id="7143248">-</span>&nbsp;<span class="ident" id="7143250">l2</span>&nbsp;<span class="op" id="7143253">+</span>&nbsp;<span class="num" id="7143255">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7143259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143263">checkPos</span><span class="op" id="7143271">(</span><span class="ident" id="7143272">t</span><span class="op" id="7143273">,</span>&nbsp;<span class="string" id="7143275">&#34;3.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7143300">,</span>&nbsp;<span class="ident" id="7143302">got2</span><span class="op" id="7143306">,</span>&nbsp;<span class="ident" id="7143308">want</span><span class="op" id="7143312">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143316">checkPos</span><span class="op" id="7143324">(</span><span class="ident" id="7143325">t</span><span class="op" id="7143326">,</span>&nbsp;<span class="string" id="7143328">&#34;3.&nbsp;Position&#34;</span><span class="op" id="7143341">,</span>&nbsp;<span class="ident" id="7143343">got3</span><span class="op" id="7143347">,</span>&nbsp;<span class="ident" id="7143349">want</span><span class="op" id="7143353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7143356">}</span><br>
<span class="lineno"></span><span class="op" id="7143358">}</span>
</div>
</body>
</html>
