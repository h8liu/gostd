<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>time</h2>
<ul>
<li><a href="/gostd/time/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/time/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/time/format.go.html">format.go</a></li>
<li><a href="/gostd/time/format_test.go.html">format_test.go</a></li>
<li><a href="/gostd/time/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/time/sleep.go.html">sleep.go</a></li>
<li><a href="/gostd/time/sleep_test.go.html">sleep_test.go</a></li>
<li><a href="/gostd/time/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/time/tick.go.html">tick.go</a></li>
<li><a href="/gostd/time/tick_test.go.html">tick_test.go</a></li>
<li><a href="/gostd/time/time.go.html">time.go</a></li>
<li><a href="/gostd/time/time_test.go.html">time_test.go</a></li>
<li><a href="/gostd/time/zoneinfo.go.html">zoneinfo.go</a></li>
<li><a href="/gostd/time/zoneinfo_read.go.html">zoneinfo_read.go</a></li>
<li><a href="/gostd/time/zoneinfo_test.go.html">zoneinfo_test.go</a></li>
<li><a href="/gostd/time/zoneinfo_unix.go.html">zoneinfo_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2740403">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2740458">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2740512">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2740563">package</span>&nbsp;<span class="ident" id="2740571">time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2740577">import</span>&nbsp;<span class="string" id="2740584">&#34;errors&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2740594">//&nbsp;A&nbsp;Ticker&nbsp;holds&nbsp;a&nbsp;channel&nbsp;that&nbsp;delivers&nbsp;`ticks&#39;&nbsp;of&nbsp;a&nbsp;clock</span><br>
<span class="lineno">10</span><span class="comment" id="2740655">//&nbsp;at&nbsp;intervals.</span><br>
<span class="lineno"></span><span class="keyword" id="2740672">type</span>&nbsp;<span class="ident" id="2740677">Ticker</span>&nbsp;<span class="keyword" id="2740684">struct</span>&nbsp;<span class="op" id="2740691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740694">C</span>&nbsp;<span class="op" id="2740696">&lt;-</span><span class="keyword" id="2740698">chan</span>&nbsp;<span class="ident" id="2740703">Time</span>&nbsp;<span class="comment" id="2740708">//&nbsp;The&nbsp;channel&nbsp;on&nbsp;which&nbsp;the&nbsp;ticks&nbsp;are&nbsp;delivered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2740758">r</span>&nbsp;<span class="ident" id="2740760">runtimeTimer</span><br>
<span class="lineno"></span><span class="op" id="2740773">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2740776">//&nbsp;NewTicker&nbsp;returns&nbsp;a&nbsp;new&nbsp;Ticker&nbsp;containing&nbsp;a&nbsp;channel&nbsp;that&nbsp;will&nbsp;send&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2740850">//&nbsp;time&nbsp;with&nbsp;a&nbsp;period&nbsp;specified&nbsp;by&nbsp;the&nbsp;duration&nbsp;argument.</span><br>
<span class="lineno"></span><span class="comment" id="2740908">//&nbsp;It&nbsp;adjusts&nbsp;the&nbsp;intervals&nbsp;or&nbsp;drops&nbsp;ticks&nbsp;to&nbsp;make&nbsp;up&nbsp;for&nbsp;slow&nbsp;receivers.</span><br>
<span class="lineno"></span><span class="comment" id="2740982">//&nbsp;The&nbsp;duration&nbsp;d&nbsp;must&nbsp;be&nbsp;greater&nbsp;than&nbsp;zero;&nbsp;if&nbsp;not,&nbsp;NewTicker&nbsp;will&nbsp;panic.</span><br>
<span class="lineno">20</span><span class="comment" id="2741057">//&nbsp;Stop&nbsp;the&nbsp;ticker&nbsp;to&nbsp;release&nbsp;associated&nbsp;resources.</span><br>
<span class="lineno"></span><span class="keyword" id="2741109">func</span>&nbsp;<span class="ident" id="2741114">NewTicker</span><span class="op" id="2741123">(</span><span class="ident" id="2741124">d</span>&nbsp;<span class="ident" id="2741126">Duration</span><span class="op" id="2741134">)</span>&nbsp;<span class="op" id="2741136">*</span><span class="ident" id="2741137">Ticker</span>&nbsp;<span class="op" id="2741144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741147">if</span>&nbsp;<span class="ident" id="2741150">d</span>&nbsp;<span class="op" id="2741152">&lt;=</span>&nbsp;<span class="num" id="2741155">0</span>&nbsp;<span class="op" id="2741157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2741161">panic</span><span class="op" id="2741166">(</span><span class="ident" id="2741167">errors</span><span class="op" id="2741173">.</span><span class="ident" id="2741174">New</span><span class="op" id="2741177">(</span><span class="string" id="2741178">&#34;non-positive&nbsp;interval&nbsp;for&nbsp;NewTicker&#34;</span><span class="op" id="2741215">)</span><span class="op" id="2741216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2741219">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2741222">//&nbsp;Give&nbsp;the&nbsp;channel&nbsp;a&nbsp;1-element&nbsp;time&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2741268">//&nbsp;If&nbsp;the&nbsp;client&nbsp;falls&nbsp;behind&nbsp;while&nbsp;reading,&nbsp;we&nbsp;drop&nbsp;ticks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2741328">//&nbsp;on&nbsp;the&nbsp;floor&nbsp;until&nbsp;the&nbsp;client&nbsp;catches&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741374">c</span>&nbsp;<span class="op" id="2741376">:=</span>&nbsp;<span class="builtinfunc" id="2741379">make</span><span class="op" id="2741383">(</span><span class="keyword" id="2741384">chan</span>&nbsp;<span class="ident" id="2741389">Time</span><span class="op" id="2741393">,</span>&nbsp;<span class="num" id="2741395">1</span><span class="op" id="2741396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741399">t</span>&nbsp;<span class="op" id="2741401">:=</span>&nbsp;<span class="op" id="2741404">&amp;</span><span class="ident" id="2741405">Ticker</span><span class="op" id="2741411">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741415">C</span><span class="op" id="2741416">:</span>&nbsp;<span class="ident" id="2741418">c</span><span class="op" id="2741419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741423">r</span><span class="op" id="2741424">:</span>&nbsp;<span class="ident" id="2741426">runtimeTimer</span><span class="op" id="2741438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741443">when</span><span class="op" id="2741447">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2741451">when</span><span class="op" id="2741455">(</span><span class="ident" id="2741456">d</span><span class="op" id="2741457">)</span><span class="op" id="2741458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741463">period</span><span class="op" id="2741469">:</span>&nbsp;<span class="ident" id="2741471">int64</span><span class="op" id="2741476">(</span><span class="ident" id="2741477">d</span><span class="op" id="2741478">)</span><span class="op" id="2741479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741484">f</span><span class="op" id="2741485">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2741492">sendTime</span><span class="op" id="2741500">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741505">arg</span><span class="op" id="2741508">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2741513">c</span><span class="op" id="2741514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2741518">}</span><span class="op" id="2741519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2741522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741525">startTimer</span><span class="op" id="2741535">(</span><span class="op" id="2741536">&amp;</span><span class="ident" id="2741537">t</span><span class="op" id="2741538">.</span><span class="ident" id="2741539">r</span><span class="op" id="2741540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741543">return</span>&nbsp;<span class="ident" id="2741550">t</span><br>
<span class="lineno">40</span><span class="op" id="2741552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2741555">//&nbsp;Stop&nbsp;turns&nbsp;off&nbsp;a&nbsp;ticker.&nbsp;&nbsp;After&nbsp;Stop,&nbsp;no&nbsp;more&nbsp;ticks&nbsp;will&nbsp;be&nbsp;sent.</span><br>
<span class="lineno"></span><span class="comment" id="2741624">//&nbsp;Stop&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;channel,&nbsp;to&nbsp;prevent&nbsp;a&nbsp;read&nbsp;from&nbsp;the&nbsp;channel&nbsp;succeeding</span><br>
<span class="lineno"></span><span class="comment" id="2741706">//&nbsp;incorrectly.</span><br>
<span class="lineno">45</span><span class="keyword" id="2741722">func</span>&nbsp;<span class="op" id="2741727">(</span><span class="ident" id="2741728">t</span>&nbsp;<span class="op" id="2741730">*</span><span class="ident" id="2741731">Ticker</span><span class="op" id="2741737">)</span>&nbsp;<span class="ident" id="2741739">Stop</span><span class="op" id="2741743">(</span><span class="op" id="2741744">)</span>&nbsp;<span class="op" id="2741746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2741749">stopTimer</span><span class="op" id="2741758">(</span><span class="op" id="2741759">&amp;</span><span class="ident" id="2741760">t</span><span class="op" id="2741761">.</span><span class="ident" id="2741762">r</span><span class="op" id="2741763">)</span><br>
<span class="lineno"></span><span class="op" id="2741765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2741768">//&nbsp;Tick&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;for&nbsp;NewTicker&nbsp;providing&nbsp;access&nbsp;to&nbsp;the&nbsp;ticking</span><br>
<span class="lineno">50</span><span class="comment" id="2741847">//&nbsp;channel&nbsp;only.&nbsp;&nbsp;Useful&nbsp;for&nbsp;clients&nbsp;that&nbsp;have&nbsp;no&nbsp;need&nbsp;to&nbsp;shut&nbsp;down&nbsp;the&nbsp;ticker.</span><br>
<span class="lineno"></span><span class="keyword" id="2741927">func</span>&nbsp;<span class="ident" id="2741932">Tick</span><span class="op" id="2741936">(</span><span class="ident" id="2741937">d</span>&nbsp;<span class="ident" id="2741939">Duration</span><span class="op" id="2741947">)</span>&nbsp;<span class="op" id="2741949">&lt;-</span><span class="keyword" id="2741951">chan</span>&nbsp;<span class="ident" id="2741956">Time</span>&nbsp;<span class="op" id="2741961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741964">if</span>&nbsp;<span class="ident" id="2741967">d</span>&nbsp;<span class="op" id="2741969">&lt;=</span>&nbsp;<span class="num" id="2741972">0</span>&nbsp;<span class="op" id="2741974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741978">return</span>&nbsp;<span class="ident" id="2741985">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2741990">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2741993">return</span>&nbsp;<span class="ident" id="2742000">NewTicker</span><span class="op" id="2742009">(</span><span class="ident" id="2742010">d</span><span class="op" id="2742011">)</span><span class="op" id="2742012">.</span><span class="ident" id="2742013">C</span><br>
<span class="lineno"></span><span class="op" id="2742015">}</span>
</div>
</body>
</html>
