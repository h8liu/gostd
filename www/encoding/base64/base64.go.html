<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3696615">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3696670">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3696724">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3696775">//&nbsp;Package&nbsp;base64&nbsp;implements&nbsp;base64&nbsp;encoding&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3696846">package</span>&nbsp;<span class="ident" id="3696854">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3696862">import</span>&nbsp;<span class="op" id="3696869">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3696872">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3696881">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3696887">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3696898">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3696908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3696911">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encodings<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3696932">//&nbsp;An&nbsp;Encoding&nbsp;is&nbsp;a&nbsp;radix&nbsp;64&nbsp;encoding/decoding&nbsp;scheme,&nbsp;defined&nbsp;by&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="3697000">//&nbsp;64-character&nbsp;alphabet.&nbsp;&nbsp;The&nbsp;most&nbsp;common&nbsp;encoding&nbsp;is&nbsp;the&nbsp;&#34;base64&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3697068">//&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648&nbsp;and&nbsp;used&nbsp;in&nbsp;MIME&nbsp;(RFC&nbsp;2045)&nbsp;and&nbsp;PEM</span><br>
<span class="lineno"></span><span class="comment" id="3697136">//&nbsp;(RFC&nbsp;1421).&nbsp;&nbsp;RFC&nbsp;4648&nbsp;also&nbsp;defines&nbsp;an&nbsp;alternate&nbsp;encoding,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3697206">//&nbsp;the&nbsp;standard&nbsp;encoding&nbsp;with&nbsp;-&nbsp;and&nbsp;_&nbsp;substituted&nbsp;for&nbsp;+&nbsp;and&nbsp;/.</span><br>
<span class="lineno"></span><span class="keyword" id="3697269">type</span>&nbsp;<span class="ident" id="3697274">Encoding</span>&nbsp;<span class="keyword" id="3697283">struct</span>&nbsp;<span class="op" id="3697290">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697293">encode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3697303">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697311">decodeMap</span>&nbsp;<span class="op" id="3697321">[</span><span class="num" id="3697322">256</span><span class="op" id="3697325">]</span><span class="builtintype" id="3697326">byte</span><br>
<span class="lineno"></span><span class="op" id="3697331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3697334">const</span>&nbsp;<span class="ident" id="3697340">encodeStd</span>&nbsp;<span class="op" id="3697350">=</span>&nbsp;<span class="string" id="3697352">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span><br>
<span class="lineno">30</span><span class="keyword" id="3697419">const</span>&nbsp;<span class="ident" id="3697425">encodeURL</span>&nbsp;<span class="op" id="3697435">=</span>&nbsp;<span class="string" id="3697437">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3697505">//&nbsp;NewEncoding&nbsp;returns&nbsp;a&nbsp;new&nbsp;Encoding&nbsp;defined&nbsp;by&nbsp;the&nbsp;given&nbsp;alphabet,</span><br>
<span class="lineno"></span><span class="comment" id="3697574">//&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;64-byte&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3697609">func</span>&nbsp;<span class="ident" id="3697614">NewEncoding</span><span class="op" id="3697625">(</span><span class="ident" id="3697626">encoder</span>&nbsp;<span class="builtintype" id="3697634">string</span><span class="op" id="3697640">)</span>&nbsp;<span class="op" id="3697642">*</span><span class="ident" id="3697643">Encoding</span>&nbsp;<span class="op" id="3697652">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697655">e</span>&nbsp;<span class="op" id="3697657">:=</span>&nbsp;<span class="builtinfunc" id="3697660">new</span><span class="op" id="3697663">(</span><span class="ident" id="3697664">Encoding</span><span class="op" id="3697672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697675">e</span><span class="op" id="3697676">.</span><span class="ident" id="3697677">encode</span>&nbsp;<span class="op" id="3697684">=</span>&nbsp;<span class="ident" id="3697686">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697695">for</span>&nbsp;<span class="ident" id="3697699">i</span>&nbsp;<span class="op" id="3697701">:=</span>&nbsp;<span class="num" id="3697704">0</span><span class="op" id="3697705">;</span>&nbsp;<span class="ident" id="3697707">i</span>&nbsp;<span class="op" id="3697709">&lt;</span>&nbsp;<span class="builtinfunc" id="3697711">len</span><span class="op" id="3697714">(</span><span class="ident" id="3697715">e</span><span class="op" id="3697716">.</span><span class="ident" id="3697717">decodeMap</span><span class="op" id="3697726">)</span><span class="op" id="3697727">;</span>&nbsp;<span class="ident" id="3697729">i</span><span class="op" id="3697730">++</span>&nbsp;<span class="op" id="3697733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697737">e</span><span class="op" id="3697738">.</span><span class="ident" id="3697739">decodeMap</span><span class="op" id="3697748">[</span><span class="ident" id="3697749">i</span><span class="op" id="3697750">]</span>&nbsp;<span class="op" id="3697752">=</span>&nbsp;<span class="num" id="3697754">0xFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3697760">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697763">for</span>&nbsp;<span class="ident" id="3697767">i</span>&nbsp;<span class="op" id="3697769">:=</span>&nbsp;<span class="num" id="3697772">0</span><span class="op" id="3697773">;</span>&nbsp;<span class="ident" id="3697775">i</span>&nbsp;<span class="op" id="3697777">&lt;</span>&nbsp;<span class="builtinfunc" id="3697779">len</span><span class="op" id="3697782">(</span><span class="ident" id="3697783">encoder</span><span class="op" id="3697790">)</span><span class="op" id="3697791">;</span>&nbsp;<span class="ident" id="3697793">i</span><span class="op" id="3697794">++</span>&nbsp;<span class="op" id="3697797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697801">e</span><span class="op" id="3697802">.</span><span class="ident" id="3697803">decodeMap</span><span class="op" id="3697812">[</span><span class="ident" id="3697813">encoder</span><span class="op" id="3697820">[</span><span class="ident" id="3697821">i</span><span class="op" id="3697822">]</span><span class="op" id="3697823">]</span>&nbsp;<span class="op" id="3697825">=</span>&nbsp;<span class="builtintype" id="3697827">byte</span><span class="op" id="3697831">(</span><span class="ident" id="3697832">i</span><span class="op" id="3697833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3697836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697839">return</span>&nbsp;<span class="ident" id="3697846">e</span><br>
<span class="lineno"></span><span class="op" id="3697848">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3697851">//&nbsp;StdEncoding&nbsp;is&nbsp;the&nbsp;standard&nbsp;base64&nbsp;encoding,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3697913">//&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3697926">var</span>&nbsp;<span class="ident" id="3697930">StdEncoding</span>&nbsp;<span class="op" id="3697942">=</span>&nbsp;<span class="ident" id="3697944">NewEncoding</span><span class="op" id="3697955">(</span><span class="ident" id="3697956">encodeStd</span><span class="op" id="3697965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3697968">//&nbsp;URLEncoding&nbsp;is&nbsp;the&nbsp;alternate&nbsp;base64&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="comment" id="3698037">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;in&nbsp;URLs&nbsp;and&nbsp;file&nbsp;names.</span><br>
<span class="lineno"></span><span class="keyword" id="3698085">var</span>&nbsp;<span class="ident" id="3698089">URLEncoding</span>&nbsp;<span class="op" id="3698101">=</span>&nbsp;<span class="ident" id="3698103">NewEncoding</span><span class="op" id="3698114">(</span><span class="ident" id="3698115">encodeURL</span><span class="op" id="3698124">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3698127">var</span>&nbsp;<span class="ident" id="3698131">removeNewlinesMapper</span>&nbsp;<span class="op" id="3698152">=</span>&nbsp;<span class="keyword" id="3698154">func</span><span class="op" id="3698158">(</span><span class="ident" id="3698159">r</span>&nbsp;<span class="builtintype" id="3698161">rune</span><span class="op" id="3698165">)</span>&nbsp;<span class="builtintype" id="3698167">rune</span>&nbsp;<span class="op" id="3698172">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698175">if</span>&nbsp;<span class="ident" id="3698178">r</span>&nbsp;<span class="op" id="3698180">==</span>&nbsp;<span class="string" id="3698183">&#39;\r&#39;</span>&nbsp;<span class="op" id="3698188">||</span>&nbsp;<span class="ident" id="3698191">r</span>&nbsp;<span class="op" id="3698193">==</span>&nbsp;<span class="string" id="3698196">&#39;\n&#39;</span>&nbsp;<span class="op" id="3698201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698205">return</span>&nbsp;<span class="op" id="3698212">-</span><span class="num" id="3698213">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3698216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698219">return</span>&nbsp;<span class="ident" id="3698226">r</span><br>
<span class="lineno"></span><span class="op" id="3698228">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3698231">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3698250">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc,&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="3698304">//&nbsp;EncodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="3698342">//</span><br>
<span class="lineno"></span><span class="comment" id="3698345">//&nbsp;The&nbsp;encoding&nbsp;pads&nbsp;the&nbsp;output&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;4&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="3698403">//&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on&nbsp;individual&nbsp;blocks</span><br>
<span class="lineno">70</span><span class="comment" id="3698464">//&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3698518">func</span>&nbsp;<span class="op" id="3698523">(</span><span class="ident" id="3698524">enc</span>&nbsp;<span class="op" id="3698528">*</span><span class="ident" id="3698529">Encoding</span><span class="op" id="3698537">)</span>&nbsp;<span class="ident" id="3698539">Encode</span><span class="op" id="3698545">(</span><span class="ident" id="3698546">dst</span><span class="op" id="3698549">,</span>&nbsp;<span class="ident" id="3698551">src</span>&nbsp;<span class="op" id="3698555">[</span><span class="op" id="3698556">]</span><span class="builtintype" id="3698557">byte</span><span class="op" id="3698561">)</span>&nbsp;<span class="op" id="3698563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698566">if</span>&nbsp;<span class="builtinfunc" id="3698569">len</span><span class="op" id="3698572">(</span><span class="ident" id="3698573">src</span><span class="op" id="3698576">)</span>&nbsp;<span class="op" id="3698578">==</span>&nbsp;<span class="num" id="3698581">0</span>&nbsp;<span class="op" id="3698583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698587">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3698595">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698599">for</span>&nbsp;<span class="builtinfunc" id="3698603">len</span><span class="op" id="3698606">(</span><span class="ident" id="3698607">src</span><span class="op" id="3698610">)</span>&nbsp;<span class="op" id="3698612">&gt;</span>&nbsp;<span class="num" id="3698614">0</span>&nbsp;<span class="op" id="3698616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698620">var</span>&nbsp;<span class="ident" id="3698624">b0</span><span class="op" id="3698626">,</span>&nbsp;<span class="ident" id="3698628">b1</span><span class="op" id="3698630">,</span>&nbsp;<span class="ident" id="3698632">b2</span><span class="op" id="3698634">,</span>&nbsp;<span class="ident" id="3698636">b3</span>&nbsp;<span class="builtintype" id="3698639">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698647">//&nbsp;Unpack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;a&nbsp;4&nbsp;byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698696">//&nbsp;destination&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698721">switch</span>&nbsp;<span class="builtinfunc" id="3698728">len</span><span class="op" id="3698731">(</span><span class="ident" id="3698732">src</span><span class="op" id="3698735">)</span>&nbsp;<span class="op" id="3698737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698741">default</span><span class="op" id="3698748">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3698753">b3</span>&nbsp;<span class="op" id="3698756">=</span>&nbsp;<span class="ident" id="3698758">src</span><span class="op" id="3698761">[</span><span class="num" id="3698762">2</span><span class="op" id="3698763">]</span>&nbsp;<span class="op" id="3698765">&amp;</span>&nbsp;<span class="num" id="3698767">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3698775">b2</span>&nbsp;<span class="op" id="3698778">=</span>&nbsp;<span class="ident" id="3698780">src</span><span class="op" id="3698783">[</span><span class="num" id="3698784">2</span><span class="op" id="3698785">]</span>&nbsp;<span class="op" id="3698787">&gt;&gt;</span>&nbsp;<span class="num" id="3698790">6</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698795">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698809">case</span>&nbsp;<span class="num" id="3698814">2</span><span class="op" id="3698815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3698820">b2</span>&nbsp;<span class="op" id="3698823">|=</span>&nbsp;<span class="op" id="3698826">(</span><span class="ident" id="3698827">src</span><span class="op" id="3698830">[</span><span class="num" id="3698831">1</span><span class="op" id="3698832">]</span>&nbsp;<span class="op" id="3698834">&lt;&lt;</span>&nbsp;<span class="num" id="3698837">2</span><span class="op" id="3698838">)</span>&nbsp;<span class="op" id="3698840">&amp;</span>&nbsp;<span class="num" id="3698842">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3698850">b1</span>&nbsp;<span class="op" id="3698853">=</span>&nbsp;<span class="ident" id="3698855">src</span><span class="op" id="3698858">[</span><span class="num" id="3698859">1</span><span class="op" id="3698860">]</span>&nbsp;<span class="op" id="3698862">&gt;&gt;</span>&nbsp;<span class="num" id="3698865">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698870">fallthrough</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698884">case</span>&nbsp;<span class="num" id="3698889">1</span><span class="op" id="3698890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3698895">b1</span>&nbsp;<span class="op" id="3698898">|=</span>&nbsp;<span class="op" id="3698901">(</span><span class="ident" id="3698902">src</span><span class="op" id="3698905">[</span><span class="num" id="3698906">0</span><span class="op" id="3698907">]</span>&nbsp;<span class="op" id="3698909">&lt;&lt;</span>&nbsp;<span class="num" id="3698912">4</span><span class="op" id="3698913">)</span>&nbsp;<span class="op" id="3698915">&amp;</span>&nbsp;<span class="num" id="3698917">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3698925">b0</span>&nbsp;<span class="op" id="3698928">=</span>&nbsp;<span class="ident" id="3698930">src</span><span class="op" id="3698933">[</span><span class="num" id="3698934">0</span><span class="op" id="3698935">]</span>&nbsp;<span class="op" id="3698937">&gt;&gt;</span>&nbsp;<span class="num" id="3698940">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3698944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698949">//&nbsp;Encode&nbsp;6-bit&nbsp;blocks&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699000">dst</span><span class="op" id="3699003">[</span><span class="num" id="3699004">0</span><span class="op" id="3699005">]</span>&nbsp;<span class="op" id="3699007">=</span>&nbsp;<span class="ident" id="3699009">enc</span><span class="op" id="3699012">.</span><span class="ident" id="3699013">encode</span><span class="op" id="3699019">[</span><span class="ident" id="3699020">b0</span><span class="op" id="3699022">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699026">dst</span><span class="op" id="3699029">[</span><span class="num" id="3699030">1</span><span class="op" id="3699031">]</span>&nbsp;<span class="op" id="3699033">=</span>&nbsp;<span class="ident" id="3699035">enc</span><span class="op" id="3699038">.</span><span class="ident" id="3699039">encode</span><span class="op" id="3699045">[</span><span class="ident" id="3699046">b1</span><span class="op" id="3699048">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699052">dst</span><span class="op" id="3699055">[</span><span class="num" id="3699056">2</span><span class="op" id="3699057">]</span>&nbsp;<span class="op" id="3699059">=</span>&nbsp;<span class="ident" id="3699061">enc</span><span class="op" id="3699064">.</span><span class="ident" id="3699065">encode</span><span class="op" id="3699071">[</span><span class="ident" id="3699072">b2</span><span class="op" id="3699074">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699078">dst</span><span class="op" id="3699081">[</span><span class="num" id="3699082">3</span><span class="op" id="3699083">]</span>&nbsp;<span class="op" id="3699085">=</span>&nbsp;<span class="ident" id="3699087">enc</span><span class="op" id="3699090">.</span><span class="ident" id="3699091">encode</span><span class="op" id="3699097">[</span><span class="ident" id="3699098">b3</span><span class="op" id="3699100">]</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3699105">//&nbsp;Pad&nbsp;the&nbsp;final&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699132">if</span>&nbsp;<span class="builtinfunc" id="3699135">len</span><span class="op" id="3699138">(</span><span class="ident" id="3699139">src</span><span class="op" id="3699142">)</span>&nbsp;<span class="op" id="3699144">&lt;</span>&nbsp;<span class="num" id="3699146">3</span>&nbsp;<span class="op" id="3699148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699153">dst</span><span class="op" id="3699156">[</span><span class="num" id="3699157">3</span><span class="op" id="3699158">]</span>&nbsp;<span class="op" id="3699160">=</span>&nbsp;<span class="string" id="3699162">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699169">if</span>&nbsp;<span class="builtinfunc" id="3699172">len</span><span class="op" id="3699175">(</span><span class="ident" id="3699176">src</span><span class="op" id="3699179">)</span>&nbsp;<span class="op" id="3699181">&lt;</span>&nbsp;<span class="num" id="3699183">2</span>&nbsp;<span class="op" id="3699185">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699191">dst</span><span class="op" id="3699194">[</span><span class="num" id="3699195">2</span><span class="op" id="3699196">]</span>&nbsp;<span class="op" id="3699198">=</span>&nbsp;<span class="string" id="3699200">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699212">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699225">src</span>&nbsp;<span class="op" id="3699229">=</span>&nbsp;<span class="ident" id="3699231">src</span><span class="op" id="3699234">[</span><span class="num" id="3699235">3</span><span class="op" id="3699236">:</span><span class="op" id="3699237">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699241">dst</span>&nbsp;<span class="op" id="3699245">=</span>&nbsp;<span class="ident" id="3699247">dst</span><span class="op" id="3699250">[</span><span class="num" id="3699251">4</span><span class="op" id="3699252">:</span><span class="op" id="3699253">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699256">}</span><br>
<span class="lineno"></span><span class="op" id="3699258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="3699261">//&nbsp;EncodeToString&nbsp;returns&nbsp;the&nbsp;base64&nbsp;encoding&nbsp;of&nbsp;src.</span><br>
<span class="lineno"></span><span class="keyword" id="3699315">func</span>&nbsp;<span class="op" id="3699320">(</span><span class="ident" id="3699321">enc</span>&nbsp;<span class="op" id="3699325">*</span><span class="ident" id="3699326">Encoding</span><span class="op" id="3699334">)</span>&nbsp;<span class="ident" id="3699336">EncodeToString</span><span class="op" id="3699350">(</span><span class="ident" id="3699351">src</span>&nbsp;<span class="op" id="3699355">[</span><span class="op" id="3699356">]</span><span class="builtintype" id="3699357">byte</span><span class="op" id="3699361">)</span>&nbsp;<span class="builtintype" id="3699363">string</span>&nbsp;<span class="op" id="3699370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699373">buf</span>&nbsp;<span class="op" id="3699377">:=</span>&nbsp;<span class="builtinfunc" id="3699380">make</span><span class="op" id="3699384">(</span><span class="op" id="3699385">[</span><span class="op" id="3699386">]</span><span class="builtintype" id="3699387">byte</span><span class="op" id="3699391">,</span>&nbsp;<span class="ident" id="3699393">enc</span><span class="op" id="3699396">.</span><span class="ident" id="3699397">EncodedLen</span><span class="op" id="3699407">(</span><span class="builtinfunc" id="3699408">len</span><span class="op" id="3699411">(</span><span class="ident" id="3699412">src</span><span class="op" id="3699415">)</span><span class="op" id="3699416">)</span><span class="op" id="3699417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699420">enc</span><span class="op" id="3699423">.</span><span class="ident" id="3699424">Encode</span><span class="op" id="3699430">(</span><span class="ident" id="3699431">buf</span><span class="op" id="3699434">,</span>&nbsp;<span class="ident" id="3699436">src</span><span class="op" id="3699439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699442">return</span>&nbsp;<span class="builtintype" id="3699449">string</span><span class="op" id="3699455">(</span><span class="ident" id="3699456">buf</span><span class="op" id="3699459">)</span><br>
<span class="lineno">120</span><span class="op" id="3699461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3699464">type</span>&nbsp;<span class="ident" id="3699469">encoder</span>&nbsp;<span class="keyword" id="3699477">struct</span>&nbsp;<span class="op" id="3699484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699487">err</span>&nbsp;&nbsp;<span class="builtintype" id="3699492">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699499">enc</span>&nbsp;&nbsp;<span class="op" id="3699504">*</span><span class="ident" id="3699505">Encoding</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699515">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3699520">io</span><span class="op" id="3699522">.</span><span class="ident" id="3699523">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699531">buf</span>&nbsp;&nbsp;<span class="op" id="3699536">[</span><span class="num" id="3699537">3</span><span class="op" id="3699538">]</span><span class="builtintype" id="3699539">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3699547">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699587">nbuf</span>&nbsp;<span class="builtintype" id="3699592">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3699603">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699630">out</span>&nbsp;&nbsp;<span class="op" id="3699635">[</span><span class="num" id="3699636">1024</span><span class="op" id="3699640">]</span><span class="builtintype" id="3699641">byte</span>&nbsp;<span class="comment" id="3699646">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="3699663">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="3699666">func</span>&nbsp;<span class="op" id="3699671">(</span><span class="ident" id="3699672">e</span>&nbsp;<span class="op" id="3699674">*</span><span class="ident" id="3699675">encoder</span><span class="op" id="3699682">)</span>&nbsp;<span class="ident" id="3699684">Write</span><span class="op" id="3699689">(</span><span class="ident" id="3699690">p</span>&nbsp;<span class="op" id="3699692">[</span><span class="op" id="3699693">]</span><span class="builtintype" id="3699694">byte</span><span class="op" id="3699698">)</span>&nbsp;<span class="op" id="3699700">(</span><span class="ident" id="3699701">n</span>&nbsp;<span class="builtintype" id="3699703">int</span><span class="op" id="3699706">,</span>&nbsp;<span class="ident" id="3699708">err</span>&nbsp;<span class="builtintype" id="3699712">error</span><span class="op" id="3699717">)</span>&nbsp;<span class="op" id="3699719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699722">if</span>&nbsp;<span class="ident" id="3699725">e</span><span class="op" id="3699726">.</span><span class="ident" id="3699727">err</span>&nbsp;<span class="op" id="3699731">!=</span>&nbsp;<span class="ident" id="3699734">nil</span>&nbsp;<span class="op" id="3699738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699742">return</span>&nbsp;<span class="num" id="3699749">0</span><span class="op" id="3699750">,</span>&nbsp;<span class="ident" id="3699752">e</span><span class="op" id="3699753">.</span><span class="ident" id="3699754">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699759">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3699763">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699783">if</span>&nbsp;<span class="ident" id="3699786">e</span><span class="op" id="3699787">.</span><span class="ident" id="3699788">nbuf</span>&nbsp;<span class="op" id="3699793">&gt;</span>&nbsp;<span class="num" id="3699795">0</span>&nbsp;<span class="op" id="3699797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699801">var</span>&nbsp;<span class="ident" id="3699805">i</span>&nbsp;<span class="builtintype" id="3699807">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699813">for</span>&nbsp;<span class="ident" id="3699817">i</span>&nbsp;<span class="op" id="3699819">=</span>&nbsp;<span class="num" id="3699821">0</span><span class="op" id="3699822">;</span>&nbsp;<span class="ident" id="3699824">i</span>&nbsp;<span class="op" id="3699826">&lt;</span>&nbsp;<span class="builtinfunc" id="3699828">len</span><span class="op" id="3699831">(</span><span class="ident" id="3699832">p</span><span class="op" id="3699833">)</span>&nbsp;<span class="op" id="3699835">&amp;&amp;</span>&nbsp;<span class="ident" id="3699838">e</span><span class="op" id="3699839">.</span><span class="ident" id="3699840">nbuf</span>&nbsp;<span class="op" id="3699845">&lt;</span>&nbsp;<span class="num" id="3699847">3</span><span class="op" id="3699848">;</span>&nbsp;<span class="ident" id="3699850">i</span><span class="op" id="3699851">++</span>&nbsp;<span class="op" id="3699854">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699859">e</span><span class="op" id="3699860">.</span><span class="ident" id="3699861">buf</span><span class="op" id="3699864">[</span><span class="ident" id="3699865">e</span><span class="op" id="3699866">.</span><span class="ident" id="3699867">nbuf</span><span class="op" id="3699871">]</span>&nbsp;<span class="op" id="3699873">=</span>&nbsp;<span class="ident" id="3699875">p</span><span class="op" id="3699876">[</span><span class="ident" id="3699877">i</span><span class="op" id="3699878">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699883">e</span><span class="op" id="3699884">.</span><span class="ident" id="3699885">nbuf</span><span class="op" id="3699889">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699898">n</span>&nbsp;<span class="op" id="3699900">+=</span>&nbsp;<span class="ident" id="3699903">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699907">p</span>&nbsp;<span class="op" id="3699909">=</span>&nbsp;<span class="ident" id="3699911">p</span><span class="op" id="3699912">[</span><span class="ident" id="3699913">i</span><span class="op" id="3699914">:</span><span class="op" id="3699915">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699919">if</span>&nbsp;<span class="ident" id="3699922">e</span><span class="op" id="3699923">.</span><span class="ident" id="3699924">nbuf</span>&nbsp;<span class="op" id="3699929">&lt;</span>&nbsp;<span class="num" id="3699931">3</span>&nbsp;<span class="op" id="3699933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699938">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699951">e</span><span class="op" id="3699952">.</span><span class="ident" id="3699953">enc</span><span class="op" id="3699956">.</span><span class="ident" id="3699957">Encode</span><span class="op" id="3699963">(</span><span class="ident" id="3699964">e</span><span class="op" id="3699965">.</span><span class="ident" id="3699966">out</span><span class="op" id="3699969">[</span><span class="num" id="3699970">0</span><span class="op" id="3699971">:</span><span class="op" id="3699972">]</span><span class="op" id="3699973">,</span>&nbsp;<span class="ident" id="3699975">e</span><span class="op" id="3699976">.</span><span class="ident" id="3699977">buf</span><span class="op" id="3699980">[</span><span class="num" id="3699981">0</span><span class="op" id="3699982">:</span><span class="op" id="3699983">]</span><span class="op" id="3699984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699988">if</span>&nbsp;<span class="ident" id="3699991">_</span><span class="op" id="3699992">,</span>&nbsp;<span class="ident" id="3699994">e</span><span class="op" id="3699995">.</span><span class="ident" id="3699996">err</span>&nbsp;<span class="op" id="3700000">=</span>&nbsp;<span class="ident" id="3700002">e</span><span class="op" id="3700003">.</span><span class="ident" id="3700004">w</span><span class="op" id="3700005">.</span><span class="ident" id="3700006">Write</span><span class="op" id="3700011">(</span><span class="ident" id="3700012">e</span><span class="op" id="3700013">.</span><span class="ident" id="3700014">out</span><span class="op" id="3700017">[</span><span class="num" id="3700018">0</span><span class="op" id="3700019">:</span><span class="num" id="3700020">4</span><span class="op" id="3700021">]</span><span class="op" id="3700022">)</span><span class="op" id="3700023">;</span>&nbsp;<span class="ident" id="3700025">e</span><span class="op" id="3700026">.</span><span class="ident" id="3700027">err</span>&nbsp;<span class="op" id="3700031">!=</span>&nbsp;<span class="ident" id="3700034">nil</span>&nbsp;<span class="op" id="3700038">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3700043">return</span>&nbsp;<span class="ident" id="3700050">n</span><span class="op" id="3700051">,</span>&nbsp;<span class="ident" id="3700053">e</span><span class="op" id="3700054">.</span><span class="ident" id="3700055">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700065">e</span><span class="op" id="3700066">.</span><span class="ident" id="3700067">nbuf</span>&nbsp;<span class="op" id="3700072">=</span>&nbsp;<span class="num" id="3700074">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3700081">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3700108">for</span>&nbsp;<span class="builtinfunc" id="3700112">len</span><span class="op" id="3700115">(</span><span class="ident" id="3700116">p</span><span class="op" id="3700117">)</span>&nbsp;<span class="op" id="3700119">&gt;=</span>&nbsp;<span class="num" id="3700122">3</span>&nbsp;<span class="op" id="3700124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700128">nn</span>&nbsp;<span class="op" id="3700131">:=</span>&nbsp;<span class="builtinfunc" id="3700134">len</span><span class="op" id="3700137">(</span><span class="ident" id="3700138">e</span><span class="op" id="3700139">.</span><span class="ident" id="3700140">out</span><span class="op" id="3700143">)</span>&nbsp;<span class="op" id="3700145">/</span>&nbsp;<span class="num" id="3700147">4</span>&nbsp;<span class="op" id="3700149">*</span>&nbsp;<span class="num" id="3700151">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3700155">if</span>&nbsp;<span class="ident" id="3700158">nn</span>&nbsp;<span class="op" id="3700161">&gt;</span>&nbsp;<span class="builtinfunc" id="3700163">len</span><span class="op" id="3700166">(</span><span class="ident" id="3700167">p</span><span class="op" id="3700168">)</span>&nbsp;<span class="op" id="3700170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700175">nn</span>&nbsp;<span class="op" id="3700178">=</span>&nbsp;<span class="builtinfunc" id="3700180">len</span><span class="op" id="3700183">(</span><span class="ident" id="3700184">p</span><span class="op" id="3700185">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700190">nn</span>&nbsp;<span class="op" id="3700193">-=</span>&nbsp;<span class="ident" id="3700196">nn</span>&nbsp;<span class="op" id="3700199">%</span>&nbsp;<span class="num" id="3700201">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700209">e</span><span class="op" id="3700210">.</span><span class="ident" id="3700211">enc</span><span class="op" id="3700214">.</span><span class="ident" id="3700215">Encode</span><span class="op" id="3700221">(</span><span class="ident" id="3700222">e</span><span class="op" id="3700223">.</span><span class="ident" id="3700224">out</span><span class="op" id="3700227">[</span><span class="num" id="3700228">0</span><span class="op" id="3700229">:</span><span class="op" id="3700230">]</span><span class="op" id="3700231">,</span>&nbsp;<span class="ident" id="3700233">p</span><span class="op" id="3700234">[</span><span class="num" id="3700235">0</span><span class="op" id="3700236">:</span><span class="ident" id="3700237">nn</span><span class="op" id="3700239">]</span><span class="op" id="3700240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3700244">if</span>&nbsp;<span class="ident" id="3700247">_</span><span class="op" id="3700248">,</span>&nbsp;<span class="ident" id="3700250">e</span><span class="op" id="3700251">.</span><span class="ident" id="3700252">err</span>&nbsp;<span class="op" id="3700256">=</span>&nbsp;<span class="ident" id="3700258">e</span><span class="op" id="3700259">.</span><span class="ident" id="3700260">w</span><span class="op" id="3700261">.</span><span class="ident" id="3700262">Write</span><span class="op" id="3700267">(</span><span class="ident" id="3700268">e</span><span class="op" id="3700269">.</span><span class="ident" id="3700270">out</span><span class="op" id="3700273">[</span><span class="num" id="3700274">0</span>&nbsp;<span class="op" id="3700276">:</span>&nbsp;<span class="ident" id="3700278">nn</span><span class="op" id="3700280">/</span><span class="num" id="3700281">3</span><span class="op" id="3700282">*</span><span class="num" id="3700283">4</span><span class="op" id="3700284">]</span><span class="op" id="3700285">)</span><span class="op" id="3700286">;</span>&nbsp;<span class="ident" id="3700288">e</span><span class="op" id="3700289">.</span><span class="ident" id="3700290">err</span>&nbsp;<span class="op" id="3700294">!=</span>&nbsp;<span class="ident" id="3700297">nil</span>&nbsp;<span class="op" id="3700301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3700306">return</span>&nbsp;<span class="ident" id="3700313">n</span><span class="op" id="3700314">,</span>&nbsp;<span class="ident" id="3700316">e</span><span class="op" id="3700317">.</span><span class="ident" id="3700318">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700328">n</span>&nbsp;<span class="op" id="3700330">+=</span>&nbsp;<span class="ident" id="3700333">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700338">p</span>&nbsp;<span class="op" id="3700340">=</span>&nbsp;<span class="ident" id="3700342">p</span><span class="op" id="3700343">[</span><span class="ident" id="3700344">nn</span><span class="op" id="3700346">:</span><span class="op" id="3700347">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3700354">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3700375">for</span>&nbsp;<span class="ident" id="3700379">i</span>&nbsp;<span class="op" id="3700381">:=</span>&nbsp;<span class="num" id="3700384">0</span><span class="op" id="3700385">;</span>&nbsp;<span class="ident" id="3700387">i</span>&nbsp;<span class="op" id="3700389">&lt;</span>&nbsp;<span class="builtinfunc" id="3700391">len</span><span class="op" id="3700394">(</span><span class="ident" id="3700395">p</span><span class="op" id="3700396">)</span><span class="op" id="3700397">;</span>&nbsp;<span class="ident" id="3700399">i</span><span class="op" id="3700400">++</span>&nbsp;<span class="op" id="3700403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700407">e</span><span class="op" id="3700408">.</span><span class="ident" id="3700409">buf</span><span class="op" id="3700412">[</span><span class="ident" id="3700413">i</span><span class="op" id="3700414">]</span>&nbsp;<span class="op" id="3700416">=</span>&nbsp;<span class="ident" id="3700418">p</span><span class="op" id="3700419">[</span><span class="ident" id="3700420">i</span><span class="op" id="3700421">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700427">e</span><span class="op" id="3700428">.</span><span class="ident" id="3700429">nbuf</span>&nbsp;<span class="op" id="3700434">=</span>&nbsp;<span class="builtinfunc" id="3700436">len</span><span class="op" id="3700439">(</span><span class="ident" id="3700440">p</span><span class="op" id="3700441">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700444">n</span>&nbsp;<span class="op" id="3700446">+=</span>&nbsp;<span class="builtinfunc" id="3700449">len</span><span class="op" id="3700452">(</span><span class="ident" id="3700453">p</span><span class="op" id="3700454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3700457">return</span><br>
<span class="lineno"></span><span class="op" id="3700464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3700467">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno">180</span><span class="comment" id="3700521">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3700574">func</span>&nbsp;<span class="op" id="3700579">(</span><span class="ident" id="3700580">e</span>&nbsp;<span class="op" id="3700582">*</span><span class="ident" id="3700583">encoder</span><span class="op" id="3700590">)</span>&nbsp;<span class="ident" id="3700592">Close</span><span class="op" id="3700597">(</span><span class="op" id="3700598">)</span>&nbsp;<span class="builtintype" id="3700600">error</span>&nbsp;<span class="op" id="3700606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3700609">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3700666">if</span>&nbsp;<span class="ident" id="3700669">e</span><span class="op" id="3700670">.</span><span class="ident" id="3700671">err</span>&nbsp;<span class="op" id="3700675">==</span>&nbsp;<span class="ident" id="3700678">nil</span>&nbsp;<span class="op" id="3700682">&amp;&amp;</span>&nbsp;<span class="ident" id="3700685">e</span><span class="op" id="3700686">.</span><span class="ident" id="3700687">nbuf</span>&nbsp;<span class="op" id="3700692">&gt;</span>&nbsp;<span class="num" id="3700694">0</span>&nbsp;<span class="op" id="3700696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700700">e</span><span class="op" id="3700701">.</span><span class="ident" id="3700702">enc</span><span class="op" id="3700705">.</span><span class="ident" id="3700706">Encode</span><span class="op" id="3700712">(</span><span class="ident" id="3700713">e</span><span class="op" id="3700714">.</span><span class="ident" id="3700715">out</span><span class="op" id="3700718">[</span><span class="num" id="3700719">0</span><span class="op" id="3700720">:</span><span class="op" id="3700721">]</span><span class="op" id="3700722">,</span>&nbsp;<span class="ident" id="3700724">e</span><span class="op" id="3700725">.</span><span class="ident" id="3700726">buf</span><span class="op" id="3700729">[</span><span class="num" id="3700730">0</span><span class="op" id="3700731">:</span><span class="ident" id="3700732">e</span><span class="op" id="3700733">.</span><span class="ident" id="3700734">nbuf</span><span class="op" id="3700738">]</span><span class="op" id="3700739">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700743">e</span><span class="op" id="3700744">.</span><span class="ident" id="3700745">nbuf</span>&nbsp;<span class="op" id="3700750">=</span>&nbsp;<span class="num" id="3700752">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700756">_</span><span class="op" id="3700757">,</span>&nbsp;<span class="ident" id="3700759">e</span><span class="op" id="3700760">.</span><span class="ident" id="3700761">err</span>&nbsp;<span class="op" id="3700765">=</span>&nbsp;<span class="ident" id="3700767">e</span><span class="op" id="3700768">.</span><span class="ident" id="3700769">w</span><span class="op" id="3700770">.</span><span class="ident" id="3700771">Write</span><span class="op" id="3700776">(</span><span class="ident" id="3700777">e</span><span class="op" id="3700778">.</span><span class="ident" id="3700779">out</span><span class="op" id="3700782">[</span><span class="num" id="3700783">0</span><span class="op" id="3700784">:</span><span class="num" id="3700785">4</span><span class="op" id="3700786">]</span><span class="op" id="3700787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3700793">return</span>&nbsp;<span class="ident" id="3700800">e</span><span class="op" id="3700801">.</span><span class="ident" id="3700802">err</span><br>
<span class="lineno"></span><span class="op" id="3700806">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="3700809">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3700877">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;using&nbsp;enc&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3700949">//&nbsp;Base64&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;4-byte&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="3701009">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno">195</span><span class="comment" id="3701077">//&nbsp;partially&nbsp;written&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="3701106">func</span>&nbsp;<span class="ident" id="3701111">NewEncoder</span><span class="op" id="3701121">(</span><span class="ident" id="3701122">enc</span>&nbsp;<span class="op" id="3701126">*</span><span class="ident" id="3701127">Encoding</span><span class="op" id="3701135">,</span>&nbsp;<span class="ident" id="3701137">w</span>&nbsp;<span class="ident" id="3701139">io</span><span class="op" id="3701141">.</span><span class="ident" id="3701142">Writer</span><span class="op" id="3701148">)</span>&nbsp;<span class="ident" id="3701150">io</span><span class="op" id="3701152">.</span><span class="ident" id="3701153">WriteCloser</span>&nbsp;<span class="op" id="3701165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701168">return</span>&nbsp;<span class="op" id="3701175">&amp;</span><span class="ident" id="3701176">encoder</span><span class="op" id="3701183">{</span><span class="ident" id="3701184">enc</span><span class="op" id="3701187">:</span>&nbsp;<span class="ident" id="3701189">enc</span><span class="op" id="3701192">,</span>&nbsp;<span class="ident" id="3701194">w</span><span class="op" id="3701195">:</span>&nbsp;<span class="ident" id="3701197">w</span><span class="op" id="3701198">}</span><br>
<span class="lineno"></span><span class="op" id="3701200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3701203">//&nbsp;EncodedLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;base64&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="3701268">//&nbsp;of&nbsp;an&nbsp;input&nbsp;buffer&nbsp;of&nbsp;length&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="3701303">func</span>&nbsp;<span class="op" id="3701308">(</span><span class="ident" id="3701309">enc</span>&nbsp;<span class="op" id="3701313">*</span><span class="ident" id="3701314">Encoding</span><span class="op" id="3701322">)</span>&nbsp;<span class="ident" id="3701324">EncodedLen</span><span class="op" id="3701334">(</span><span class="ident" id="3701335">n</span>&nbsp;<span class="builtintype" id="3701337">int</span><span class="op" id="3701340">)</span>&nbsp;<span class="builtintype" id="3701342">int</span>&nbsp;<span class="op" id="3701346">{</span>&nbsp;<span class="keyword" id="3701348">return</span>&nbsp;<span class="op" id="3701355">(</span><span class="ident" id="3701356">n</span>&nbsp;<span class="op" id="3701358">+</span>&nbsp;<span class="num" id="3701360">2</span><span class="op" id="3701361">)</span>&nbsp;<span class="op" id="3701363">/</span>&nbsp;<span class="num" id="3701365">3</span>&nbsp;<span class="op" id="3701367">*</span>&nbsp;<span class="num" id="3701369">4</span>&nbsp;<span class="op" id="3701371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3701374">/*<br>
<span class="lineno">205</span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3701393">type</span>&nbsp;<span class="ident" id="3701398">CorruptInputError</span>&nbsp;<span class="ident" id="3701416">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="3701423">func</span>&nbsp;<span class="op" id="3701428">(</span><span class="ident" id="3701429">e</span>&nbsp;<span class="ident" id="3701431">CorruptInputError</span><span class="op" id="3701448">)</span>&nbsp;<span class="ident" id="3701450">Error</span><span class="op" id="3701455">(</span><span class="op" id="3701456">)</span>&nbsp;<span class="builtintype" id="3701458">string</span>&nbsp;<span class="op" id="3701465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701468">return</span>&nbsp;<span class="string" id="3701475">&#34;illegal&nbsp;base64&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="3701512">+</span>&nbsp;<span class="ident" id="3701514">strconv</span><span class="op" id="3701521">.</span><span class="ident" id="3701522">FormatInt</span><span class="op" id="3701531">(</span><span class="ident" id="3701532">int64</span><span class="op" id="3701537">(</span><span class="ident" id="3701538">e</span><span class="op" id="3701539">)</span><span class="op" id="3701540">,</span>&nbsp;<span class="num" id="3701542">10</span><span class="op" id="3701544">)</span><br>
<span class="lineno"></span><span class="op" id="3701546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3701549">//&nbsp;decode&nbsp;is&nbsp;like&nbsp;Decode&nbsp;but&nbsp;returns&nbsp;an&nbsp;additional&nbsp;&#39;end&#39;&nbsp;value,&nbsp;which</span><br>
<span class="lineno">215</span><span class="comment" id="3701619">//&nbsp;indicates&nbsp;if&nbsp;end-of-message&nbsp;padding&nbsp;was&nbsp;encountered&nbsp;and&nbsp;thus&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="3701687">//&nbsp;additional&nbsp;data&nbsp;is&nbsp;an&nbsp;error.&nbsp;This&nbsp;method&nbsp;assumes&nbsp;that&nbsp;src&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="3701757">//&nbsp;stripped&nbsp;of&nbsp;all&nbsp;supported&nbsp;whitespace&nbsp;(&#39;\r&#39;&nbsp;and&nbsp;&#39;\n&#39;).</span><br>
<span class="lineno"></span><span class="keyword" id="3701814">func</span>&nbsp;<span class="op" id="3701819">(</span><span class="ident" id="3701820">enc</span>&nbsp;<span class="op" id="3701824">*</span><span class="ident" id="3701825">Encoding</span><span class="op" id="3701833">)</span>&nbsp;<span class="ident" id="3701835">decode</span><span class="op" id="3701841">(</span><span class="ident" id="3701842">dst</span><span class="op" id="3701845">,</span>&nbsp;<span class="ident" id="3701847">src</span>&nbsp;<span class="op" id="3701851">[</span><span class="op" id="3701852">]</span><span class="builtintype" id="3701853">byte</span><span class="op" id="3701857">)</span>&nbsp;<span class="op" id="3701859">(</span><span class="ident" id="3701860">n</span>&nbsp;<span class="builtintype" id="3701862">int</span><span class="op" id="3701865">,</span>&nbsp;<span class="ident" id="3701867">end</span>&nbsp;<span class="builtintype" id="3701871">bool</span><span class="op" id="3701875">,</span>&nbsp;<span class="ident" id="3701877">err</span>&nbsp;<span class="builtintype" id="3701881">error</span><span class="op" id="3701886">)</span>&nbsp;<span class="op" id="3701888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3701891">olen</span>&nbsp;<span class="op" id="3701896">:=</span>&nbsp;<span class="builtinfunc" id="3701899">len</span><span class="op" id="3701902">(</span><span class="ident" id="3701903">src</span><span class="op" id="3701906">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701909">for</span>&nbsp;<span class="builtinfunc" id="3701913">len</span><span class="op" id="3701916">(</span><span class="ident" id="3701917">src</span><span class="op" id="3701920">)</span>&nbsp;<span class="op" id="3701922">&gt;</span>&nbsp;<span class="num" id="3701924">0</span>&nbsp;<span class="op" id="3701926">&amp;&amp;</span>&nbsp;<span class="op" id="3701929">!</span><span class="ident" id="3701930">end</span>&nbsp;<span class="op" id="3701934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3701938">//&nbsp;Decode&nbsp;quantum&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701984">var</span>&nbsp;<span class="ident" id="3701988">dbuf</span>&nbsp;<span class="op" id="3701993">[</span><span class="num" id="3701994">4</span><span class="op" id="3701995">]</span><span class="builtintype" id="3701996">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702003">dlen</span>&nbsp;<span class="op" id="3702008">:=</span>&nbsp;<span class="num" id="3702011">4</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702016">for</span>&nbsp;<span class="ident" id="3702020">j</span>&nbsp;<span class="op" id="3702022">:=</span>&nbsp;<span class="keyword" id="3702025">range</span>&nbsp;<span class="ident" id="3702031">dbuf</span>&nbsp;<span class="op" id="3702036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702041">if</span>&nbsp;<span class="builtinfunc" id="3702044">len</span><span class="op" id="3702047">(</span><span class="ident" id="3702048">src</span><span class="op" id="3702051">)</span>&nbsp;<span class="op" id="3702053">==</span>&nbsp;<span class="num" id="3702056">0</span>&nbsp;<span class="op" id="3702058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702064">return</span>&nbsp;<span class="ident" id="3702071">n</span><span class="op" id="3702072">,</span>&nbsp;<span class="ident" id="3702074">false</span><span class="op" id="3702079">,</span>&nbsp;<span class="ident" id="3702081">CorruptInputError</span><span class="op" id="3702098">(</span><span class="ident" id="3702099">olen</span>&nbsp;<span class="op" id="3702104">-</span>&nbsp;<span class="builtinfunc" id="3702106">len</span><span class="op" id="3702109">(</span><span class="ident" id="3702110">src</span><span class="op" id="3702113">)</span>&nbsp;<span class="op" id="3702115">-</span>&nbsp;<span class="ident" id="3702117">j</span><span class="op" id="3702118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702128">in</span>&nbsp;<span class="op" id="3702131">:=</span>&nbsp;<span class="ident" id="3702134">src</span><span class="op" id="3702137">[</span><span class="num" id="3702138">0</span><span class="op" id="3702139">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702144">src</span>&nbsp;<span class="op" id="3702148">=</span>&nbsp;<span class="ident" id="3702150">src</span><span class="op" id="3702153">[</span><span class="num" id="3702154">1</span><span class="op" id="3702155">:</span><span class="op" id="3702156">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702161">if</span>&nbsp;<span class="ident" id="3702164">in</span>&nbsp;<span class="op" id="3702167">==</span>&nbsp;<span class="string" id="3702170">&#39;=&#39;</span>&nbsp;<span class="op" id="3702174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702180">//&nbsp;We&#39;ve&nbsp;reached&nbsp;the&nbsp;end&nbsp;and&nbsp;there&#39;s&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702229">switch</span>&nbsp;<span class="ident" id="3702236">j</span>&nbsp;<span class="op" id="3702238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702244">case</span>&nbsp;<span class="num" id="3702249">0</span><span class="op" id="3702250">,</span>&nbsp;<span class="num" id="3702252">1</span><span class="op" id="3702253">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702260">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702286">return</span>&nbsp;<span class="ident" id="3702293">n</span><span class="op" id="3702294">,</span>&nbsp;<span class="ident" id="3702296">false</span><span class="op" id="3702301">,</span>&nbsp;<span class="ident" id="3702303">CorruptInputError</span><span class="op" id="3702320">(</span><span class="ident" id="3702321">olen</span>&nbsp;<span class="op" id="3702326">-</span>&nbsp;<span class="builtinfunc" id="3702328">len</span><span class="op" id="3702331">(</span><span class="ident" id="3702332">src</span><span class="op" id="3702335">)</span>&nbsp;<span class="op" id="3702337">-</span>&nbsp;<span class="num" id="3702339">1</span><span class="op" id="3702340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702346">case</span>&nbsp;<span class="num" id="3702351">2</span><span class="op" id="3702352">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702359">//&nbsp;&#34;==&#34;&nbsp;is&nbsp;expected,&nbsp;the&nbsp;first&nbsp;&#34;=&#34;&nbsp;is&nbsp;already&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702420">if</span>&nbsp;<span class="builtinfunc" id="3702423">len</span><span class="op" id="3702426">(</span><span class="ident" id="3702427">src</span><span class="op" id="3702430">)</span>&nbsp;<span class="op" id="3702432">==</span>&nbsp;<span class="num" id="3702435">0</span>&nbsp;<span class="op" id="3702437">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702445">//&nbsp;not&nbsp;enough&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702473">return</span>&nbsp;<span class="ident" id="3702480">n</span><span class="op" id="3702481">,</span>&nbsp;<span class="ident" id="3702483">false</span><span class="op" id="3702488">,</span>&nbsp;<span class="ident" id="3702490">CorruptInputError</span><span class="op" id="3702507">(</span><span class="ident" id="3702508">olen</span><span class="op" id="3702512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702526">if</span>&nbsp;<span class="ident" id="3702529">src</span><span class="op" id="3702532">[</span><span class="num" id="3702533">0</span><span class="op" id="3702534">]</span>&nbsp;<span class="op" id="3702536">!=</span>&nbsp;<span class="string" id="3702539">&#39;=&#39;</span>&nbsp;<span class="op" id="3702543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702551">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702578">return</span>&nbsp;<span class="ident" id="3702585">n</span><span class="op" id="3702586">,</span>&nbsp;<span class="ident" id="3702588">false</span><span class="op" id="3702593">,</span>&nbsp;<span class="ident" id="3702595">CorruptInputError</span><span class="op" id="3702612">(</span><span class="ident" id="3702613">olen</span>&nbsp;<span class="op" id="3702618">-</span>&nbsp;<span class="builtinfunc" id="3702620">len</span><span class="op" id="3702623">(</span><span class="ident" id="3702624">src</span><span class="op" id="3702627">)</span>&nbsp;<span class="op" id="3702629">-</span>&nbsp;<span class="num" id="3702631">1</span><span class="op" id="3702632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702646">src</span>&nbsp;<span class="op" id="3702650">=</span>&nbsp;<span class="ident" id="3702652">src</span><span class="op" id="3702655">[</span><span class="num" id="3702656">1</span><span class="op" id="3702657">:</span><span class="op" id="3702658">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702670">if</span>&nbsp;<span class="builtinfunc" id="3702673">len</span><span class="op" id="3702676">(</span><span class="ident" id="3702677">src</span><span class="op" id="3702680">)</span>&nbsp;<span class="op" id="3702682">&gt;</span>&nbsp;<span class="num" id="3702684">0</span>&nbsp;<span class="op" id="3702686">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702693">//&nbsp;trailing&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702718">err</span>&nbsp;<span class="op" id="3702722">=</span>&nbsp;<span class="ident" id="3702724">CorruptInputError</span><span class="op" id="3702741">(</span><span class="ident" id="3702742">olen</span>&nbsp;<span class="op" id="3702747">-</span>&nbsp;<span class="builtinfunc" id="3702749">len</span><span class="op" id="3702752">(</span><span class="ident" id="3702753">src</span><span class="op" id="3702756">)</span><span class="op" id="3702757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702769">dlen</span><span class="op" id="3702773">,</span>&nbsp;<span class="ident" id="3702775">end</span>&nbsp;<span class="op" id="3702779">=</span>&nbsp;<span class="ident" id="3702781">j</span><span class="op" id="3702782">,</span>&nbsp;<span class="ident" id="3702784">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702793">break</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702807">dbuf</span><span class="op" id="3702811">[</span><span class="ident" id="3702812">j</span><span class="op" id="3702813">]</span>&nbsp;<span class="op" id="3702815">=</span>&nbsp;<span class="ident" id="3702817">enc</span><span class="op" id="3702820">.</span><span class="ident" id="3702821">decodeMap</span><span class="op" id="3702830">[</span><span class="ident" id="3702831">in</span><span class="op" id="3702833">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702838">if</span>&nbsp;<span class="ident" id="3702841">dbuf</span><span class="op" id="3702845">[</span><span class="ident" id="3702846">j</span><span class="op" id="3702847">]</span>&nbsp;<span class="op" id="3702849">==</span>&nbsp;<span class="num" id="3702852">0xFF</span>&nbsp;<span class="op" id="3702857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702863">return</span>&nbsp;<span class="ident" id="3702870">n</span><span class="op" id="3702871">,</span>&nbsp;<span class="ident" id="3702873">false</span><span class="op" id="3702878">,</span>&nbsp;<span class="ident" id="3702880">CorruptInputError</span><span class="op" id="3702897">(</span><span class="ident" id="3702898">olen</span>&nbsp;<span class="op" id="3702903">-</span>&nbsp;<span class="builtinfunc" id="3702905">len</span><span class="op" id="3702908">(</span><span class="ident" id="3702909">src</span><span class="op" id="3702912">)</span>&nbsp;<span class="op" id="3702914">-</span>&nbsp;<span class="num" id="3702916">1</span><span class="op" id="3702917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702922">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702931">//&nbsp;Pack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;3&nbsp;byte&nbsp;destination</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702988">//&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703001">switch</span>&nbsp;<span class="ident" id="3703008">dlen</span>&nbsp;<span class="op" id="3703013">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703017">case</span>&nbsp;<span class="num" id="3703022">4</span><span class="op" id="3703023">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703028">dst</span><span class="op" id="3703031">[</span><span class="num" id="3703032">2</span><span class="op" id="3703033">]</span>&nbsp;<span class="op" id="3703035">=</span>&nbsp;<span class="ident" id="3703037">dbuf</span><span class="op" id="3703041">[</span><span class="num" id="3703042">2</span><span class="op" id="3703043">]</span><span class="op" id="3703044">&lt;&lt;</span><span class="num" id="3703046">6</span>&nbsp;<span class="op" id="3703048">|</span>&nbsp;<span class="ident" id="3703050">dbuf</span><span class="op" id="3703054">[</span><span class="num" id="3703055">3</span><span class="op" id="3703056">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703061">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703075">case</span>&nbsp;<span class="num" id="3703080">3</span><span class="op" id="3703081">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703086">dst</span><span class="op" id="3703089">[</span><span class="num" id="3703090">1</span><span class="op" id="3703091">]</span>&nbsp;<span class="op" id="3703093">=</span>&nbsp;<span class="ident" id="3703095">dbuf</span><span class="op" id="3703099">[</span><span class="num" id="3703100">1</span><span class="op" id="3703101">]</span><span class="op" id="3703102">&lt;&lt;</span><span class="num" id="3703104">4</span>&nbsp;<span class="op" id="3703106">|</span>&nbsp;<span class="ident" id="3703108">dbuf</span><span class="op" id="3703112">[</span><span class="num" id="3703113">2</span><span class="op" id="3703114">]</span><span class="op" id="3703115">&gt;&gt;</span><span class="num" id="3703117">2</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703122">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703136">case</span>&nbsp;<span class="num" id="3703141">2</span><span class="op" id="3703142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703147">dst</span><span class="op" id="3703150">[</span><span class="num" id="3703151">0</span><span class="op" id="3703152">]</span>&nbsp;<span class="op" id="3703154">=</span>&nbsp;<span class="ident" id="3703156">dbuf</span><span class="op" id="3703160">[</span><span class="num" id="3703161">0</span><span class="op" id="3703162">]</span><span class="op" id="3703163">&lt;&lt;</span><span class="num" id="3703165">2</span>&nbsp;<span class="op" id="3703167">|</span>&nbsp;<span class="ident" id="3703169">dbuf</span><span class="op" id="3703173">[</span><span class="num" id="3703174">1</span><span class="op" id="3703175">]</span><span class="op" id="3703176">&gt;&gt;</span><span class="num" id="3703178">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3703182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703186">dst</span>&nbsp;<span class="op" id="3703190">=</span>&nbsp;<span class="ident" id="3703192">dst</span><span class="op" id="3703195">[</span><span class="num" id="3703196">3</span><span class="op" id="3703197">:</span><span class="op" id="3703198">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703202">n</span>&nbsp;<span class="op" id="3703204">+=</span>&nbsp;<span class="ident" id="3703207">dlen</span>&nbsp;<span class="op" id="3703212">-</span>&nbsp;<span class="num" id="3703214">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3703217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703221">return</span>&nbsp;<span class="ident" id="3703228">n</span><span class="op" id="3703229">,</span>&nbsp;<span class="ident" id="3703231">end</span><span class="op" id="3703234">,</span>&nbsp;<span class="ident" id="3703236">err</span><br>
<span class="lineno"></span><span class="op" id="3703240">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3703243">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc.&nbsp;&nbsp;It&nbsp;writes&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="3703308">//&nbsp;DecodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span><span class="comment" id="3703377">//&nbsp;written.&nbsp;&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;base64&nbsp;data,&nbsp;it&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3703446">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;CorruptInputError.</span><br>
<span class="lineno">285</span><span class="comment" id="3703509">//&nbsp;New&nbsp;line&nbsp;characters&nbsp;(\r&nbsp;and&nbsp;\n)&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="3703557">func</span>&nbsp;<span class="op" id="3703562">(</span><span class="ident" id="3703563">enc</span>&nbsp;<span class="op" id="3703567">*</span><span class="ident" id="3703568">Encoding</span><span class="op" id="3703576">)</span>&nbsp;<span class="ident" id="3703578">Decode</span><span class="op" id="3703584">(</span><span class="ident" id="3703585">dst</span><span class="op" id="3703588">,</span>&nbsp;<span class="ident" id="3703590">src</span>&nbsp;<span class="op" id="3703594">[</span><span class="op" id="3703595">]</span><span class="builtintype" id="3703596">byte</span><span class="op" id="3703600">)</span>&nbsp;<span class="op" id="3703602">(</span><span class="ident" id="3703603">n</span>&nbsp;<span class="builtintype" id="3703605">int</span><span class="op" id="3703608">,</span>&nbsp;<span class="ident" id="3703610">err</span>&nbsp;<span class="builtintype" id="3703614">error</span><span class="op" id="3703619">)</span>&nbsp;<span class="op" id="3703621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703624">src</span>&nbsp;<span class="op" id="3703628">=</span>&nbsp;<span class="ident" id="3703630">bytes</span><span class="op" id="3703635">.</span><span class="ident" id="3703636">Map</span><span class="op" id="3703639">(</span><span class="ident" id="3703640">removeNewlinesMapper</span><span class="op" id="3703660">,</span>&nbsp;<span class="ident" id="3703662">src</span><span class="op" id="3703665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703668">n</span><span class="op" id="3703669">,</span>&nbsp;<span class="ident" id="3703671">_</span><span class="op" id="3703672">,</span>&nbsp;<span class="ident" id="3703674">err</span>&nbsp;<span class="op" id="3703678">=</span>&nbsp;<span class="ident" id="3703680">enc</span><span class="op" id="3703683">.</span><span class="ident" id="3703684">decode</span><span class="op" id="3703690">(</span><span class="ident" id="3703691">dst</span><span class="op" id="3703694">,</span>&nbsp;<span class="ident" id="3703696">src</span><span class="op" id="3703699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703702">return</span><br>
<span class="lineno">290</span><span class="op" id="3703709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3703712">//&nbsp;DecodeString&nbsp;returns&nbsp;the&nbsp;bytes&nbsp;represented&nbsp;by&nbsp;the&nbsp;base64&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3703782">func</span>&nbsp;<span class="op" id="3703787">(</span><span class="ident" id="3703788">enc</span>&nbsp;<span class="op" id="3703792">*</span><span class="ident" id="3703793">Encoding</span><span class="op" id="3703801">)</span>&nbsp;<span class="ident" id="3703803">DecodeString</span><span class="op" id="3703815">(</span><span class="ident" id="3703816">s</span>&nbsp;<span class="builtintype" id="3703818">string</span><span class="op" id="3703824">)</span>&nbsp;<span class="op" id="3703826">(</span><span class="op" id="3703827">[</span><span class="op" id="3703828">]</span><span class="builtintype" id="3703829">byte</span><span class="op" id="3703833">,</span>&nbsp;<span class="builtintype" id="3703835">error</span><span class="op" id="3703840">)</span>&nbsp;<span class="op" id="3703842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703845">s</span>&nbsp;<span class="op" id="3703847">=</span>&nbsp;<span class="ident" id="3703849">strings</span><span class="op" id="3703856">.</span><span class="ident" id="3703857">Map</span><span class="op" id="3703860">(</span><span class="ident" id="3703861">removeNewlinesMapper</span><span class="op" id="3703881">,</span>&nbsp;<span class="ident" id="3703883">s</span><span class="op" id="3703884">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703887">dbuf</span>&nbsp;<span class="op" id="3703892">:=</span>&nbsp;<span class="builtinfunc" id="3703895">make</span><span class="op" id="3703899">(</span><span class="op" id="3703900">[</span><span class="op" id="3703901">]</span><span class="builtintype" id="3703902">byte</span><span class="op" id="3703906">,</span>&nbsp;<span class="ident" id="3703908">enc</span><span class="op" id="3703911">.</span><span class="ident" id="3703912">DecodedLen</span><span class="op" id="3703922">(</span><span class="builtinfunc" id="3703923">len</span><span class="op" id="3703926">(</span><span class="ident" id="3703927">s</span><span class="op" id="3703928">)</span><span class="op" id="3703929">)</span><span class="op" id="3703930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703933">n</span><span class="op" id="3703934">,</span>&nbsp;<span class="ident" id="3703936">_</span><span class="op" id="3703937">,</span>&nbsp;<span class="ident" id="3703939">err</span>&nbsp;<span class="op" id="3703943">:=</span>&nbsp;<span class="ident" id="3703946">enc</span><span class="op" id="3703949">.</span><span class="ident" id="3703950">decode</span><span class="op" id="3703956">(</span><span class="ident" id="3703957">dbuf</span><span class="op" id="3703961">,</span>&nbsp;<span class="op" id="3703963">[</span><span class="op" id="3703964">]</span><span class="builtintype" id="3703965">byte</span><span class="op" id="3703969">(</span><span class="ident" id="3703970">s</span><span class="op" id="3703971">)</span><span class="op" id="3703972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703975">return</span>&nbsp;<span class="ident" id="3703982">dbuf</span><span class="op" id="3703986">[</span><span class="op" id="3703987">:</span><span class="ident" id="3703988">n</span><span class="op" id="3703989">]</span><span class="op" id="3703990">,</span>&nbsp;<span class="ident" id="3703992">err</span><br>
<span class="lineno"></span><span class="op" id="3703996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="3703999">type</span>&nbsp;<span class="ident" id="3704004">decoder</span>&nbsp;<span class="keyword" id="3704012">struct</span>&nbsp;<span class="op" id="3704019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704022">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3704029">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704036">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3704043">*</span><span class="ident" id="3704044">Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704054">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3704061">io</span><span class="op" id="3704063">.</span><span class="ident" id="3704064">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704072">end</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3704079">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3704090">//&nbsp;saw&nbsp;end&nbsp;of&nbsp;message</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704113">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3704120">[</span><span class="num" id="3704121">1024</span><span class="op" id="3704125">]</span><span class="builtintype" id="3704126">byte</span>&nbsp;<span class="comment" id="3704131">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704150">nbuf</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3704157">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704162">out</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3704169">[</span><span class="op" id="3704170">]</span><span class="builtintype" id="3704171">byte</span>&nbsp;<span class="comment" id="3704176">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704204">outbuf</span>&nbsp;<span class="op" id="3704211">[</span><span class="num" id="3704212">1024</span>&nbsp;<span class="op" id="3704217">/</span>&nbsp;<span class="num" id="3704219">4</span>&nbsp;<span class="op" id="3704221">*</span>&nbsp;<span class="num" id="3704223">3</span><span class="op" id="3704224">]</span><span class="builtintype" id="3704225">byte</span><br>
<span class="lineno"></span><span class="op" id="3704230">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="3704233">func</span>&nbsp;<span class="op" id="3704238">(</span><span class="ident" id="3704239">d</span>&nbsp;<span class="op" id="3704241">*</span><span class="ident" id="3704242">decoder</span><span class="op" id="3704249">)</span>&nbsp;<span class="ident" id="3704251">Read</span><span class="op" id="3704255">(</span><span class="ident" id="3704256">p</span>&nbsp;<span class="op" id="3704258">[</span><span class="op" id="3704259">]</span><span class="builtintype" id="3704260">byte</span><span class="op" id="3704264">)</span>&nbsp;<span class="op" id="3704266">(</span><span class="ident" id="3704267">n</span>&nbsp;<span class="builtintype" id="3704269">int</span><span class="op" id="3704272">,</span>&nbsp;<span class="ident" id="3704274">err</span>&nbsp;<span class="builtintype" id="3704278">error</span><span class="op" id="3704283">)</span>&nbsp;<span class="op" id="3704285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704288">if</span>&nbsp;<span class="ident" id="3704291">d</span><span class="op" id="3704292">.</span><span class="ident" id="3704293">err</span>&nbsp;<span class="op" id="3704297">!=</span>&nbsp;<span class="ident" id="3704300">nil</span>&nbsp;<span class="op" id="3704304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704308">return</span>&nbsp;<span class="num" id="3704315">0</span><span class="op" id="3704316">,</span>&nbsp;<span class="ident" id="3704318">d</span><span class="op" id="3704319">.</span><span class="ident" id="3704320">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704325">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704329">//&nbsp;Use&nbsp;leftover&nbsp;decoded&nbsp;output&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704377">if</span>&nbsp;<span class="builtinfunc" id="3704380">len</span><span class="op" id="3704383">(</span><span class="ident" id="3704384">d</span><span class="op" id="3704385">.</span><span class="ident" id="3704386">out</span><span class="op" id="3704389">)</span>&nbsp;<span class="op" id="3704391">&gt;</span>&nbsp;<span class="num" id="3704393">0</span>&nbsp;<span class="op" id="3704395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704399">n</span>&nbsp;<span class="op" id="3704401">=</span>&nbsp;<span class="builtinfunc" id="3704403">copy</span><span class="op" id="3704407">(</span><span class="ident" id="3704408">p</span><span class="op" id="3704409">,</span>&nbsp;<span class="ident" id="3704411">d</span><span class="op" id="3704412">.</span><span class="ident" id="3704413">out</span><span class="op" id="3704416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704420">d</span><span class="op" id="3704421">.</span><span class="ident" id="3704422">out</span>&nbsp;<span class="op" id="3704426">=</span>&nbsp;<span class="ident" id="3704428">d</span><span class="op" id="3704429">.</span><span class="ident" id="3704430">out</span><span class="op" id="3704433">[</span><span class="ident" id="3704434">n</span><span class="op" id="3704435">:</span><span class="op" id="3704436">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704440">return</span>&nbsp;<span class="ident" id="3704447">n</span><span class="op" id="3704448">,</span>&nbsp;<span class="ident" id="3704450">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704459">//&nbsp;Read&nbsp;a&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704477">nn</span>&nbsp;<span class="op" id="3704480">:=</span>&nbsp;<span class="builtinfunc" id="3704483">len</span><span class="op" id="3704486">(</span><span class="ident" id="3704487">p</span><span class="op" id="3704488">)</span>&nbsp;<span class="op" id="3704490">/</span>&nbsp;<span class="num" id="3704492">3</span>&nbsp;<span class="op" id="3704494">*</span>&nbsp;<span class="num" id="3704496">4</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704499">if</span>&nbsp;<span class="ident" id="3704502">nn</span>&nbsp;<span class="op" id="3704505">&lt;</span>&nbsp;<span class="num" id="3704507">4</span>&nbsp;<span class="op" id="3704509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704513">nn</span>&nbsp;<span class="op" id="3704516">=</span>&nbsp;<span class="num" id="3704518">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704524">if</span>&nbsp;<span class="ident" id="3704527">nn</span>&nbsp;<span class="op" id="3704530">&gt;</span>&nbsp;<span class="builtinfunc" id="3704532">len</span><span class="op" id="3704535">(</span><span class="ident" id="3704536">d</span><span class="op" id="3704537">.</span><span class="ident" id="3704538">buf</span><span class="op" id="3704541">)</span>&nbsp;<span class="op" id="3704543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704547">nn</span>&nbsp;<span class="op" id="3704550">=</span>&nbsp;<span class="builtinfunc" id="3704552">len</span><span class="op" id="3704555">(</span><span class="ident" id="3704556">d</span><span class="op" id="3704557">.</span><span class="ident" id="3704558">buf</span><span class="op" id="3704561">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704567">nn</span><span class="op" id="3704569">,</span>&nbsp;<span class="ident" id="3704571">d</span><span class="op" id="3704572">.</span><span class="ident" id="3704573">err</span>&nbsp;<span class="op" id="3704577">=</span>&nbsp;<span class="ident" id="3704579">io</span><span class="op" id="3704581">.</span><span class="ident" id="3704582">ReadAtLeast</span><span class="op" id="3704593">(</span><span class="ident" id="3704594">d</span><span class="op" id="3704595">.</span><span class="ident" id="3704596">r</span><span class="op" id="3704597">,</span>&nbsp;<span class="ident" id="3704599">d</span><span class="op" id="3704600">.</span><span class="ident" id="3704601">buf</span><span class="op" id="3704604">[</span><span class="ident" id="3704605">d</span><span class="op" id="3704606">.</span><span class="ident" id="3704607">nbuf</span><span class="op" id="3704611">:</span><span class="ident" id="3704612">nn</span><span class="op" id="3704614">]</span><span class="op" id="3704615">,</span>&nbsp;<span class="num" id="3704617">4</span><span class="op" id="3704618">-</span><span class="ident" id="3704619">d</span><span class="op" id="3704620">.</span><span class="ident" id="3704621">nbuf</span><span class="op" id="3704625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704628">d</span><span class="op" id="3704629">.</span><span class="ident" id="3704630">nbuf</span>&nbsp;<span class="op" id="3704635">+=</span>&nbsp;<span class="ident" id="3704638">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704642">if</span>&nbsp;<span class="ident" id="3704645">d</span><span class="op" id="3704646">.</span><span class="ident" id="3704647">err</span>&nbsp;<span class="op" id="3704651">!=</span>&nbsp;<span class="ident" id="3704654">nil</span>&nbsp;<span class="op" id="3704658">||</span>&nbsp;<span class="ident" id="3704661">d</span><span class="op" id="3704662">.</span><span class="ident" id="3704663">nbuf</span>&nbsp;<span class="op" id="3704668">&lt;</span>&nbsp;<span class="num" id="3704670">4</span>&nbsp;<span class="op" id="3704672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704676">return</span>&nbsp;<span class="num" id="3704683">0</span><span class="op" id="3704684">,</span>&nbsp;<span class="ident" id="3704686">d</span><span class="op" id="3704687">.</span><span class="ident" id="3704688">err</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704697">//&nbsp;Decode&nbsp;chunk&nbsp;into&nbsp;p,&nbsp;or&nbsp;d.out&nbsp;and&nbsp;then&nbsp;p&nbsp;if&nbsp;p&nbsp;is&nbsp;too&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704761">nr</span>&nbsp;<span class="op" id="3704764">:=</span>&nbsp;<span class="ident" id="3704767">d</span><span class="op" id="3704768">.</span><span class="ident" id="3704769">nbuf</span>&nbsp;<span class="op" id="3704774">/</span>&nbsp;<span class="num" id="3704776">4</span>&nbsp;<span class="op" id="3704778">*</span>&nbsp;<span class="num" id="3704780">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704783">nw</span>&nbsp;<span class="op" id="3704786">:=</span>&nbsp;<span class="ident" id="3704789">d</span><span class="op" id="3704790">.</span><span class="ident" id="3704791">nbuf</span>&nbsp;<span class="op" id="3704796">/</span>&nbsp;<span class="num" id="3704798">4</span>&nbsp;<span class="op" id="3704800">*</span>&nbsp;<span class="num" id="3704802">3</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704805">if</span>&nbsp;<span class="ident" id="3704808">nw</span>&nbsp;<span class="op" id="3704811">&gt;</span>&nbsp;<span class="builtinfunc" id="3704813">len</span><span class="op" id="3704816">(</span><span class="ident" id="3704817">p</span><span class="op" id="3704818">)</span>&nbsp;<span class="op" id="3704820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704824">nw</span><span class="op" id="3704826">,</span>&nbsp;<span class="ident" id="3704828">d</span><span class="op" id="3704829">.</span><span class="ident" id="3704830">end</span><span class="op" id="3704833">,</span>&nbsp;<span class="ident" id="3704835">d</span><span class="op" id="3704836">.</span><span class="ident" id="3704837">err</span>&nbsp;<span class="op" id="3704841">=</span>&nbsp;<span class="ident" id="3704843">d</span><span class="op" id="3704844">.</span><span class="ident" id="3704845">enc</span><span class="op" id="3704848">.</span><span class="ident" id="3704849">decode</span><span class="op" id="3704855">(</span><span class="ident" id="3704856">d</span><span class="op" id="3704857">.</span><span class="ident" id="3704858">outbuf</span><span class="op" id="3704864">[</span><span class="num" id="3704865">0</span><span class="op" id="3704866">:</span><span class="op" id="3704867">]</span><span class="op" id="3704868">,</span>&nbsp;<span class="ident" id="3704870">d</span><span class="op" id="3704871">.</span><span class="ident" id="3704872">buf</span><span class="op" id="3704875">[</span><span class="num" id="3704876">0</span><span class="op" id="3704877">:</span><span class="ident" id="3704878">nr</span><span class="op" id="3704880">]</span><span class="op" id="3704881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704885">d</span><span class="op" id="3704886">.</span><span class="ident" id="3704887">out</span>&nbsp;<span class="op" id="3704891">=</span>&nbsp;<span class="ident" id="3704893">d</span><span class="op" id="3704894">.</span><span class="ident" id="3704895">outbuf</span><span class="op" id="3704901">[</span><span class="num" id="3704902">0</span><span class="op" id="3704903">:</span><span class="ident" id="3704904">nw</span><span class="op" id="3704906">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704910">n</span>&nbsp;<span class="op" id="3704912">=</span>&nbsp;<span class="builtinfunc" id="3704914">copy</span><span class="op" id="3704918">(</span><span class="ident" id="3704919">p</span><span class="op" id="3704920">,</span>&nbsp;<span class="ident" id="3704922">d</span><span class="op" id="3704923">.</span><span class="ident" id="3704924">out</span><span class="op" id="3704927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704931">d</span><span class="op" id="3704932">.</span><span class="ident" id="3704933">out</span>&nbsp;<span class="op" id="3704937">=</span>&nbsp;<span class="ident" id="3704939">d</span><span class="op" id="3704940">.</span><span class="ident" id="3704941">out</span><span class="op" id="3704944">[</span><span class="ident" id="3704945">n</span><span class="op" id="3704946">:</span><span class="op" id="3704947">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704950">}</span>&nbsp;<span class="keyword" id="3704952">else</span>&nbsp;<span class="op" id="3704957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704961">n</span><span class="op" id="3704962">,</span>&nbsp;<span class="ident" id="3704964">d</span><span class="op" id="3704965">.</span><span class="ident" id="3704966">end</span><span class="op" id="3704969">,</span>&nbsp;<span class="ident" id="3704971">d</span><span class="op" id="3704972">.</span><span class="ident" id="3704973">err</span>&nbsp;<span class="op" id="3704977">=</span>&nbsp;<span class="ident" id="3704979">d</span><span class="op" id="3704980">.</span><span class="ident" id="3704981">enc</span><span class="op" id="3704984">.</span><span class="ident" id="3704985">decode</span><span class="op" id="3704991">(</span><span class="ident" id="3704992">p</span><span class="op" id="3704993">,</span>&nbsp;<span class="ident" id="3704995">d</span><span class="op" id="3704996">.</span><span class="ident" id="3704997">buf</span><span class="op" id="3705000">[</span><span class="num" id="3705001">0</span><span class="op" id="3705002">:</span><span class="ident" id="3705003">nr</span><span class="op" id="3705005">]</span><span class="op" id="3705006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705012">d</span><span class="op" id="3705013">.</span><span class="ident" id="3705014">nbuf</span>&nbsp;<span class="op" id="3705019">-=</span>&nbsp;<span class="ident" id="3705022">nr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705026">for</span>&nbsp;<span class="ident" id="3705030">i</span>&nbsp;<span class="op" id="3705032">:=</span>&nbsp;<span class="num" id="3705035">0</span><span class="op" id="3705036">;</span>&nbsp;<span class="ident" id="3705038">i</span>&nbsp;<span class="op" id="3705040">&lt;</span>&nbsp;<span class="ident" id="3705042">d</span><span class="op" id="3705043">.</span><span class="ident" id="3705044">nbuf</span><span class="op" id="3705048">;</span>&nbsp;<span class="ident" id="3705050">i</span><span class="op" id="3705051">++</span>&nbsp;<span class="op" id="3705054">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705058">d</span><span class="op" id="3705059">.</span><span class="ident" id="3705060">buf</span><span class="op" id="3705063">[</span><span class="ident" id="3705064">i</span><span class="op" id="3705065">]</span>&nbsp;<span class="op" id="3705067">=</span>&nbsp;<span class="ident" id="3705069">d</span><span class="op" id="3705070">.</span><span class="ident" id="3705071">buf</span><span class="op" id="3705074">[</span><span class="ident" id="3705075">i</span><span class="op" id="3705076">+</span><span class="ident" id="3705077">nr</span><span class="op" id="3705079">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705086">if</span>&nbsp;<span class="ident" id="3705089">d</span><span class="op" id="3705090">.</span><span class="ident" id="3705091">err</span>&nbsp;<span class="op" id="3705095">==</span>&nbsp;<span class="ident" id="3705098">nil</span>&nbsp;<span class="op" id="3705102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705106">d</span><span class="op" id="3705107">.</span><span class="ident" id="3705108">err</span>&nbsp;<span class="op" id="3705112">=</span>&nbsp;<span class="ident" id="3705114">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705122">return</span>&nbsp;<span class="ident" id="3705129">n</span><span class="op" id="3705130">,</span>&nbsp;<span class="ident" id="3705132">d</span><span class="op" id="3705133">.</span><span class="ident" id="3705134">err</span><br>
<span class="lineno"></span><span class="op" id="3705138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3705141">type</span>&nbsp;<span class="ident" id="3705146">newlineFilteringReader</span>&nbsp;<span class="keyword" id="3705169">struct</span>&nbsp;<span class="op" id="3705176">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705179">wrapped</span>&nbsp;<span class="ident" id="3705187">io</span><span class="op" id="3705189">.</span><span class="ident" id="3705190">Reader</span><br>
<span class="lineno"></span><span class="op" id="3705197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3705200">func</span>&nbsp;<span class="op" id="3705205">(</span><span class="ident" id="3705206">r</span>&nbsp;<span class="op" id="3705208">*</span><span class="ident" id="3705209">newlineFilteringReader</span><span class="op" id="3705231">)</span>&nbsp;<span class="ident" id="3705233">Read</span><span class="op" id="3705237">(</span><span class="ident" id="3705238">p</span>&nbsp;<span class="op" id="3705240">[</span><span class="op" id="3705241">]</span><span class="builtintype" id="3705242">byte</span><span class="op" id="3705246">)</span>&nbsp;<span class="op" id="3705248">(</span><span class="builtintype" id="3705249">int</span><span class="op" id="3705252">,</span>&nbsp;<span class="builtintype" id="3705254">error</span><span class="op" id="3705259">)</span>&nbsp;<span class="op" id="3705261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705264">n</span><span class="op" id="3705265">,</span>&nbsp;<span class="ident" id="3705267">err</span>&nbsp;<span class="op" id="3705271">:=</span>&nbsp;<span class="ident" id="3705274">r</span><span class="op" id="3705275">.</span><span class="ident" id="3705276">wrapped</span><span class="op" id="3705283">.</span><span class="ident" id="3705284">Read</span><span class="op" id="3705288">(</span><span class="ident" id="3705289">p</span><span class="op" id="3705290">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705293">for</span>&nbsp;<span class="ident" id="3705297">n</span>&nbsp;<span class="op" id="3705299">&gt;</span>&nbsp;<span class="num" id="3705301">0</span>&nbsp;<span class="op" id="3705303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705307">offset</span>&nbsp;<span class="op" id="3705314">:=</span>&nbsp;<span class="num" id="3705317">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705321">for</span>&nbsp;<span class="ident" id="3705325">i</span><span class="op" id="3705326">,</span>&nbsp;<span class="ident" id="3705328">b</span>&nbsp;<span class="op" id="3705330">:=</span>&nbsp;<span class="keyword" id="3705333">range</span>&nbsp;<span class="ident" id="3705339">p</span><span class="op" id="3705340">[</span><span class="num" id="3705341">0</span><span class="op" id="3705342">:</span><span class="ident" id="3705343">n</span><span class="op" id="3705344">]</span>&nbsp;<span class="op" id="3705346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705351">if</span>&nbsp;<span class="ident" id="3705354">b</span>&nbsp;<span class="op" id="3705356">!=</span>&nbsp;<span class="string" id="3705359">&#39;\r&#39;</span>&nbsp;<span class="op" id="3705364">&amp;&amp;</span>&nbsp;<span class="ident" id="3705367">b</span>&nbsp;<span class="op" id="3705369">!=</span>&nbsp;<span class="string" id="3705372">&#39;\n&#39;</span>&nbsp;<span class="op" id="3705377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705383">if</span>&nbsp;<span class="ident" id="3705386">i</span>&nbsp;<span class="op" id="3705388">!=</span>&nbsp;<span class="ident" id="3705391">offset</span>&nbsp;<span class="op" id="3705398">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705405">p</span><span class="op" id="3705406">[</span><span class="ident" id="3705407">offset</span><span class="op" id="3705413">]</span>&nbsp;<span class="op" id="3705415">=</span>&nbsp;<span class="ident" id="3705417">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705429">offset</span><span class="op" id="3705435">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705445">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705449">if</span>&nbsp;<span class="ident" id="3705452">offset</span>&nbsp;<span class="op" id="3705459">&gt;</span>&nbsp;<span class="num" id="3705461">0</span>&nbsp;<span class="op" id="3705463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705468">return</span>&nbsp;<span class="ident" id="3705475">offset</span><span class="op" id="3705481">,</span>&nbsp;<span class="ident" id="3705483">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705493">//&nbsp;Previous&nbsp;buffer&nbsp;entirely&nbsp;whitespace,&nbsp;read&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705546">n</span><span class="op" id="3705547">,</span>&nbsp;<span class="ident" id="3705549">err</span>&nbsp;<span class="op" id="3705553">=</span>&nbsp;<span class="ident" id="3705555">r</span><span class="op" id="3705556">.</span><span class="ident" id="3705557">wrapped</span><span class="op" id="3705564">.</span><span class="ident" id="3705565">Read</span><span class="op" id="3705569">(</span><span class="ident" id="3705570">p</span><span class="op" id="3705571">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705577">return</span>&nbsp;<span class="ident" id="3705584">n</span><span class="op" id="3705585">,</span>&nbsp;<span class="ident" id="3705587">err</span><br>
<span class="lineno"></span><span class="op" id="3705591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3705594">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno">385</span><span class="keyword" id="3705648">func</span>&nbsp;<span class="ident" id="3705653">NewDecoder</span><span class="op" id="3705663">(</span><span class="ident" id="3705664">enc</span>&nbsp;<span class="op" id="3705668">*</span><span class="ident" id="3705669">Encoding</span><span class="op" id="3705677">,</span>&nbsp;<span class="ident" id="3705679">r</span>&nbsp;<span class="ident" id="3705681">io</span><span class="op" id="3705683">.</span><span class="ident" id="3705684">Reader</span><span class="op" id="3705690">)</span>&nbsp;<span class="ident" id="3705692">io</span><span class="op" id="3705694">.</span><span class="ident" id="3705695">Reader</span>&nbsp;<span class="op" id="3705702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705705">return</span>&nbsp;<span class="op" id="3705712">&amp;</span><span class="ident" id="3705713">decoder</span><span class="op" id="3705720">{</span><span class="ident" id="3705721">enc</span><span class="op" id="3705724">:</span>&nbsp;<span class="ident" id="3705726">enc</span><span class="op" id="3705729">,</span>&nbsp;<span class="ident" id="3705731">r</span><span class="op" id="3705732">:</span>&nbsp;<span class="op" id="3705734">&amp;</span><span class="ident" id="3705735">newlineFilteringReader</span><span class="op" id="3705757">{</span><span class="ident" id="3705758">r</span><span class="op" id="3705759">}</span><span class="op" id="3705760">}</span><br>
<span class="lineno"></span><span class="op" id="3705762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3705765">//&nbsp;DecodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;decoded&nbsp;data</span><br>
<span class="lineno">390</span><span class="comment" id="3705835">//&nbsp;corresponding&nbsp;to&nbsp;n&nbsp;bytes&nbsp;of&nbsp;base64-encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3705887">func</span>&nbsp;<span class="op" id="3705892">(</span><span class="ident" id="3705893">enc</span>&nbsp;<span class="op" id="3705897">*</span><span class="ident" id="3705898">Encoding</span><span class="op" id="3705906">)</span>&nbsp;<span class="ident" id="3705908">DecodedLen</span><span class="op" id="3705918">(</span><span class="ident" id="3705919">n</span>&nbsp;<span class="builtintype" id="3705921">int</span><span class="op" id="3705924">)</span>&nbsp;<span class="builtintype" id="3705926">int</span>&nbsp;<span class="op" id="3705930">{</span>&nbsp;<span class="keyword" id="3705932">return</span>&nbsp;<span class="ident" id="3705939">n</span>&nbsp;<span class="op" id="3705941">/</span>&nbsp;<span class="num" id="3705943">4</span>&nbsp;<span class="op" id="3705945">*</span>&nbsp;<span class="num" id="3705947">3</span>&nbsp;<span class="op" id="3705949">}</span>
</div>
</body>
</html>
