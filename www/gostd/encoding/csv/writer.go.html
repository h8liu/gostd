<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6472751">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6472806">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6472860">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6472911">package</span>&nbsp;<span class="ident" id="6472919">csv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6472924">import</span>&nbsp;<span class="op" id="6472931">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472934">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472943">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472949">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472960">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6472971">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="6472986">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6472989">//&nbsp;A&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;to&nbsp;a&nbsp;CSV&nbsp;encoded&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6473039">//</span><br>
<span class="lineno"></span><span class="comment" id="6473042">//&nbsp;As&nbsp;returned&nbsp;by&nbsp;NewWriter,&nbsp;a&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;terminated&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6473111">//&nbsp;newline&nbsp;and&nbsp;uses&nbsp;&#39;,&#39;&nbsp;as&nbsp;the&nbsp;field&nbsp;delimiter.&nbsp;&nbsp;The&nbsp;exported&nbsp;fields&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6473187">//&nbsp;changed&nbsp;to&nbsp;customize&nbsp;the&nbsp;details&nbsp;before&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;WriteAll.</span><br>
<span class="lineno">20</span><span class="comment" id="6473267">//</span><br>
<span class="lineno"></span><span class="comment" id="6473270">//&nbsp;Comma&nbsp;is&nbsp;the&nbsp;field&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="6473303">//</span><br>
<span class="lineno"></span><span class="comment" id="6473306">//&nbsp;If&nbsp;UseCRLF&nbsp;is&nbsp;true,&nbsp;the&nbsp;Writer&nbsp;ends&nbsp;each&nbsp;record&nbsp;with&nbsp;\r\n&nbsp;instead&nbsp;of&nbsp;\n.</span><br>
<span class="lineno"></span><span class="keyword" id="6473382">type</span>&nbsp;<span class="ident" id="6473387">Writer</span>&nbsp;<span class="keyword" id="6473394">struct</span>&nbsp;<span class="op" id="6473401">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473404">Comma</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6473412">rune</span>&nbsp;<span class="comment" id="6473417">//&nbsp;Field&nbsp;delimiter&nbsp;(set&nbsp;to&nbsp;&#39;,&#39;&nbsp;by&nbsp;NewWriter)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473463">UseCRLF</span>&nbsp;<span class="builtintype" id="6473471">bool</span>&nbsp;<span class="comment" id="6473476">//&nbsp;True&nbsp;to&nbsp;use&nbsp;\r\n&nbsp;as&nbsp;the&nbsp;line&nbsp;terminator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473520">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6473528">*</span><span class="ident" id="6473529">bufio</span><span class="op" id="6473534">.</span><span class="ident" id="6473535">Writer</span><br>
<span class="lineno"></span><span class="op" id="6473542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6473545">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6473597">func</span>&nbsp;<span class="ident" id="6473602">NewWriter</span><span class="op" id="6473611">(</span><span class="ident" id="6473612">w</span>&nbsp;<span class="ident" id="6473614">io</span><span class="op" id="6473616">.</span><span class="ident" id="6473617">Writer</span><span class="op" id="6473623">)</span>&nbsp;<span class="op" id="6473625">*</span><span class="ident" id="6473626">Writer</span>&nbsp;<span class="op" id="6473633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6473636">return</span>&nbsp;<span class="op" id="6473643">&amp;</span><span class="ident" id="6473644">Writer</span><span class="op" id="6473650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473654">Comma</span><span class="op" id="6473659">:</span>&nbsp;<span class="string" id="6473661">&#39;,&#39;</span><span class="op" id="6473664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6473668">w</span><span class="op" id="6473669">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6473675">bufio</span><span class="op" id="6473680">.</span><span class="ident" id="6473681">NewWriter</span><span class="op" id="6473690">(</span><span class="ident" id="6473691">w</span><span class="op" id="6473692">)</span><span class="op" id="6473693">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6473696">}</span><br>
<span class="lineno"></span><span class="op" id="6473698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6473701">//&nbsp;Writer&nbsp;writes&nbsp;a&nbsp;single&nbsp;CSV&nbsp;record&nbsp;to&nbsp;w&nbsp;along&nbsp;with&nbsp;any&nbsp;necessary&nbsp;quoting.</span><br>
<span class="lineno"></span><span class="comment" id="6473777">//&nbsp;A&nbsp;record&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;with&nbsp;each&nbsp;string&nbsp;being&nbsp;one&nbsp;field.</span><br>
<span class="lineno">40</span><span class="keyword" id="6473845">func</span>&nbsp;<span class="op" id="6473850">(</span><span class="ident" id="6473851">w</span>&nbsp;<span class="op" id="6473853">*</span><span class="ident" id="6473854">Writer</span><span class="op" id="6473860">)</span>&nbsp;<span class="ident" id="6473862">Write</span><span class="op" id="6473867">(</span><span class="ident" id="6473868">record</span>&nbsp;<span class="op" id="6473875">[</span><span class="op" id="6473876">]</span><span class="builtintype" id="6473877">string</span><span class="op" id="6473883">)</span>&nbsp;<span class="op" id="6473885">(</span><span class="ident" id="6473886">err</span>&nbsp;<span class="builtintype" id="6473890">error</span><span class="op" id="6473895">)</span>&nbsp;<span class="op" id="6473897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6473900">for</span>&nbsp;<span class="ident" id="6473904">n</span><span class="op" id="6473905">,</span>&nbsp;<span class="ident" id="6473907">field</span>&nbsp;<span class="op" id="6473913">:=</span>&nbsp;<span class="keyword" id="6473916">range</span>&nbsp;<span class="ident" id="6473922">record</span>&nbsp;<span class="op" id="6473929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6473933">if</span>&nbsp;<span class="ident" id="6473936">n</span>&nbsp;<span class="op" id="6473938">&gt;</span>&nbsp;<span class="num" id="6473940">0</span>&nbsp;<span class="op" id="6473942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6473947">if</span>&nbsp;<span class="ident" id="6473950">_</span><span class="op" id="6473951">,</span>&nbsp;<span class="ident" id="6473953">err</span>&nbsp;<span class="op" id="6473957">=</span>&nbsp;<span class="ident" id="6473959">w</span><span class="op" id="6473960">.</span><span class="ident" id="6473961">w</span><span class="op" id="6473962">.</span><span class="ident" id="6473963">WriteRune</span><span class="op" id="6473972">(</span><span class="ident" id="6473973">w</span><span class="op" id="6473974">.</span><span class="ident" id="6473975">Comma</span><span class="op" id="6473980">)</span><span class="op" id="6473981">;</span>&nbsp;<span class="ident" id="6473983">err</span>&nbsp;<span class="op" id="6473987">!=</span>&nbsp;<span class="ident" id="6473990">nil</span>&nbsp;<span class="op" id="6473994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474000">return</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6474019">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;have&nbsp;a&nbsp;quoted&nbsp;field&nbsp;then&nbsp;just</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6474074">//&nbsp;write&nbsp;out&nbsp;the&nbsp;field&nbsp;and&nbsp;continue&nbsp;to&nbsp;the&nbsp;next&nbsp;field.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474131">if</span>&nbsp;<span class="op" id="6474134">!</span><span class="ident" id="6474135">w</span><span class="op" id="6474136">.</span><span class="ident" id="6474137">fieldNeedsQuotes</span><span class="op" id="6474153">(</span><span class="ident" id="6474154">field</span><span class="op" id="6474159">)</span>&nbsp;<span class="op" id="6474161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474166">if</span>&nbsp;<span class="ident" id="6474169">_</span><span class="op" id="6474170">,</span>&nbsp;<span class="ident" id="6474172">err</span>&nbsp;<span class="op" id="6474176">=</span>&nbsp;<span class="ident" id="6474178">w</span><span class="op" id="6474179">.</span><span class="ident" id="6474180">w</span><span class="op" id="6474181">.</span><span class="ident" id="6474182">WriteString</span><span class="op" id="6474193">(</span><span class="ident" id="6474194">field</span><span class="op" id="6474199">)</span><span class="op" id="6474200">;</span>&nbsp;<span class="ident" id="6474202">err</span>&nbsp;<span class="op" id="6474206">!=</span>&nbsp;<span class="ident" id="6474209">nil</span>&nbsp;<span class="op" id="6474213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474219">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474234">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474249">if</span>&nbsp;<span class="ident" id="6474252">err</span>&nbsp;<span class="op" id="6474256">=</span>&nbsp;<span class="ident" id="6474258">w</span><span class="op" id="6474259">.</span><span class="ident" id="6474260">w</span><span class="op" id="6474261">.</span><span class="ident" id="6474262">WriteByte</span><span class="op" id="6474271">(</span><span class="string" id="6474272">&#39;&#34;&#39;</span><span class="op" id="6474275">)</span><span class="op" id="6474276">;</span>&nbsp;<span class="ident" id="6474278">err</span>&nbsp;<span class="op" id="6474282">!=</span>&nbsp;<span class="ident" id="6474285">nil</span>&nbsp;<span class="op" id="6474289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474294">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474308">for</span>&nbsp;<span class="ident" id="6474312">_</span><span class="op" id="6474313">,</span>&nbsp;<span class="ident" id="6474315">r1</span>&nbsp;<span class="op" id="6474318">:=</span>&nbsp;<span class="keyword" id="6474321">range</span>&nbsp;<span class="ident" id="6474327">field</span>&nbsp;<span class="op" id="6474333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474338">switch</span>&nbsp;<span class="ident" id="6474345">r1</span>&nbsp;<span class="op" id="6474348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474353">case</span>&nbsp;<span class="string" id="6474358">&#39;&#34;&#39;</span><span class="op" id="6474361">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474367">_</span><span class="op" id="6474368">,</span>&nbsp;<span class="ident" id="6474370">err</span>&nbsp;<span class="op" id="6474374">=</span>&nbsp;<span class="ident" id="6474376">w</span><span class="op" id="6474377">.</span><span class="ident" id="6474378">w</span><span class="op" id="6474379">.</span><span class="ident" id="6474380">WriteString</span><span class="op" id="6474391">(</span><span class="string" id="6474392">`&#34;&#34;`</span><span class="op" id="6474396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474401">case</span>&nbsp;<span class="string" id="6474406">&#39;\r&#39;</span><span class="op" id="6474410">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474416">if</span>&nbsp;<span class="op" id="6474419">!</span><span class="ident" id="6474420">w</span><span class="op" id="6474421">.</span><span class="ident" id="6474422">UseCRLF</span>&nbsp;<span class="op" id="6474430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474437">err</span>&nbsp;<span class="op" id="6474441">=</span>&nbsp;<span class="ident" id="6474443">w</span><span class="op" id="6474444">.</span><span class="ident" id="6474445">w</span><span class="op" id="6474446">.</span><span class="ident" id="6474447">WriteByte</span><span class="op" id="6474456">(</span><span class="string" id="6474457">&#39;\r&#39;</span><span class="op" id="6474461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474472">case</span>&nbsp;<span class="string" id="6474477">&#39;\n&#39;</span><span class="op" id="6474481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474487">if</span>&nbsp;<span class="ident" id="6474490">w</span><span class="op" id="6474491">.</span><span class="ident" id="6474492">UseCRLF</span>&nbsp;<span class="op" id="6474500">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474507">_</span><span class="op" id="6474508">,</span>&nbsp;<span class="ident" id="6474510">err</span>&nbsp;<span class="op" id="6474514">=</span>&nbsp;<span class="ident" id="6474516">w</span><span class="op" id="6474517">.</span><span class="ident" id="6474518">w</span><span class="op" id="6474519">.</span><span class="ident" id="6474520">WriteString</span><span class="op" id="6474531">(</span><span class="string" id="6474532">&#34;\r\n&#34;</span><span class="op" id="6474538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474544">}</span>&nbsp;<span class="keyword" id="6474546">else</span>&nbsp;<span class="op" id="6474551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474558">err</span>&nbsp;<span class="op" id="6474562">=</span>&nbsp;<span class="ident" id="6474564">w</span><span class="op" id="6474565">.</span><span class="ident" id="6474566">w</span><span class="op" id="6474567">.</span><span class="ident" id="6474568">WriteByte</span><span class="op" id="6474577">(</span><span class="string" id="6474578">&#39;\n&#39;</span><span class="op" id="6474582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474593">default</span><span class="op" id="6474600">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474606">_</span><span class="op" id="6474607">,</span>&nbsp;<span class="ident" id="6474609">err</span>&nbsp;<span class="op" id="6474613">=</span>&nbsp;<span class="ident" id="6474615">w</span><span class="op" id="6474616">.</span><span class="ident" id="6474617">w</span><span class="op" id="6474618">.</span><span class="ident" id="6474619">WriteRune</span><span class="op" id="6474628">(</span><span class="ident" id="6474629">r1</span><span class="op" id="6474631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474641">if</span>&nbsp;<span class="ident" id="6474644">err</span>&nbsp;<span class="op" id="6474648">!=</span>&nbsp;<span class="ident" id="6474651">nil</span>&nbsp;<span class="op" id="6474655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474661">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474671">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474680">if</span>&nbsp;<span class="ident" id="6474683">err</span>&nbsp;<span class="op" id="6474687">=</span>&nbsp;<span class="ident" id="6474689">w</span><span class="op" id="6474690">.</span><span class="ident" id="6474691">w</span><span class="op" id="6474692">.</span><span class="ident" id="6474693">WriteByte</span><span class="op" id="6474702">(</span><span class="string" id="6474703">&#39;&#34;&#39;</span><span class="op" id="6474706">)</span><span class="op" id="6474707">;</span>&nbsp;<span class="ident" id="6474709">err</span>&nbsp;<span class="op" id="6474713">!=</span>&nbsp;<span class="ident" id="6474716">nil</span>&nbsp;<span class="op" id="6474720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474725">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474734">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474740">if</span>&nbsp;<span class="ident" id="6474743">w</span><span class="op" id="6474744">.</span><span class="ident" id="6474745">UseCRLF</span>&nbsp;<span class="op" id="6474753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474757">_</span><span class="op" id="6474758">,</span>&nbsp;<span class="ident" id="6474760">err</span>&nbsp;<span class="op" id="6474764">=</span>&nbsp;<span class="ident" id="6474766">w</span><span class="op" id="6474767">.</span><span class="ident" id="6474768">w</span><span class="op" id="6474769">.</span><span class="ident" id="6474770">WriteString</span><span class="op" id="6474781">(</span><span class="string" id="6474782">&#34;\r\n&#34;</span><span class="op" id="6474788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474791">}</span>&nbsp;<span class="keyword" id="6474793">else</span>&nbsp;<span class="op" id="6474798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474802">err</span>&nbsp;<span class="op" id="6474806">=</span>&nbsp;<span class="ident" id="6474808">w</span><span class="op" id="6474809">.</span><span class="ident" id="6474810">w</span><span class="op" id="6474811">.</span><span class="ident" id="6474812">WriteByte</span><span class="op" id="6474821">(</span><span class="string" id="6474822">&#39;\n&#39;</span><span class="op" id="6474826">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6474829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6474832">return</span><br>
<span class="lineno"></span><span class="op" id="6474839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6474842">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">95</span><span class="comment" id="6474905">//&nbsp;To&nbsp;check&nbsp;if&nbsp;an&nbsp;error&nbsp;occurred&nbsp;during&nbsp;the&nbsp;Flush,&nbsp;call&nbsp;Error.</span><br>
<span class="lineno"></span><span class="keyword" id="6474968">func</span>&nbsp;<span class="op" id="6474973">(</span><span class="ident" id="6474974">w</span>&nbsp;<span class="op" id="6474976">*</span><span class="ident" id="6474977">Writer</span><span class="op" id="6474983">)</span>&nbsp;<span class="ident" id="6474985">Flush</span><span class="op" id="6474990">(</span><span class="op" id="6474991">)</span>&nbsp;<span class="op" id="6474993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6474996">w</span><span class="op" id="6474997">.</span><span class="ident" id="6474998">w</span><span class="op" id="6474999">.</span><span class="ident" id="6475000">Flush</span><span class="op" id="6475005">(</span><span class="op" id="6475006">)</span><br>
<span class="lineno"></span><span class="op" id="6475008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="6475011">//&nbsp;Error&nbsp;reports&nbsp;any&nbsp;error&nbsp;that&nbsp;has&nbsp;occurred&nbsp;during&nbsp;a&nbsp;previous&nbsp;Write&nbsp;or&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6475090">func</span>&nbsp;<span class="op" id="6475095">(</span><span class="ident" id="6475096">w</span>&nbsp;<span class="op" id="6475098">*</span><span class="ident" id="6475099">Writer</span><span class="op" id="6475105">)</span>&nbsp;<span class="ident" id="6475107">Error</span><span class="op" id="6475112">(</span><span class="op" id="6475113">)</span>&nbsp;<span class="builtintype" id="6475115">error</span>&nbsp;<span class="op" id="6475121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475124">_</span><span class="op" id="6475125">,</span>&nbsp;<span class="ident" id="6475127">err</span>&nbsp;<span class="op" id="6475131">:=</span>&nbsp;<span class="ident" id="6475134">w</span><span class="op" id="6475135">.</span><span class="ident" id="6475136">w</span><span class="op" id="6475137">.</span><span class="ident" id="6475138">Write</span><span class="op" id="6475143">(</span><span class="ident" id="6475144">nil</span><span class="op" id="6475147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6475150">return</span>&nbsp;<span class="ident" id="6475157">err</span><br>
<span class="lineno"></span><span class="op" id="6475161">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="6475164">//&nbsp;WriteAll&nbsp;writes&nbsp;multiple&nbsp;CSV&nbsp;records&nbsp;to&nbsp;w&nbsp;using&nbsp;Write&nbsp;and&nbsp;then&nbsp;calls&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6475243">func</span>&nbsp;<span class="op" id="6475248">(</span><span class="ident" id="6475249">w</span>&nbsp;<span class="op" id="6475251">*</span><span class="ident" id="6475252">Writer</span><span class="op" id="6475258">)</span>&nbsp;<span class="ident" id="6475260">WriteAll</span><span class="op" id="6475268">(</span><span class="ident" id="6475269">records</span>&nbsp;<span class="op" id="6475277">[</span><span class="op" id="6475278">]</span><span class="op" id="6475279">[</span><span class="op" id="6475280">]</span><span class="builtintype" id="6475281">string</span><span class="op" id="6475287">)</span>&nbsp;<span class="op" id="6475289">(</span><span class="ident" id="6475290">err</span>&nbsp;<span class="builtintype" id="6475294">error</span><span class="op" id="6475299">)</span>&nbsp;<span class="op" id="6475301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6475304">for</span>&nbsp;<span class="ident" id="6475308">_</span><span class="op" id="6475309">,</span>&nbsp;<span class="ident" id="6475311">record</span>&nbsp;<span class="op" id="6475318">:=</span>&nbsp;<span class="keyword" id="6475321">range</span>&nbsp;<span class="ident" id="6475327">records</span>&nbsp;<span class="op" id="6475335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6475339">err</span>&nbsp;<span class="op" id="6475343">=</span>&nbsp;<span class="ident" id="6475345">w</span><span class="op" id="6475346">.</span><span class="ident" id="6475347">Write</span><span class="op" id="6475352">(</span><span class="ident" id="6475353">record</span><span class="op" id="6475359">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6475363">if</span>&nbsp;<span class="ident" id="6475366">err</span>&nbsp;<span class="op" id="6475370">!=</span>&nbsp;<span class="ident" id="6475373">nil</span>&nbsp;<span class="op" id="6475377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6475382">return</span>&nbsp;<span class="ident" id="6475389">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6475395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6475398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6475401">return</span>&nbsp;<span class="ident" id="6475408">w</span><span class="op" id="6475409">.</span><span class="ident" id="6475410">w</span><span class="op" id="6475411">.</span><span class="ident" id="6475412">Flush</span><span class="op" id="6475417">(</span><span class="op" id="6475418">)</span><br>
<span class="lineno">115</span><span class="op" id="6475420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6475423">//&nbsp;fieldNeedsQuotes&nbsp;returns&nbsp;true&nbsp;if&nbsp;our&nbsp;field&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno"></span><span class="comment" id="6475497">//&nbsp;Fields&nbsp;with&nbsp;a&nbsp;Comma,&nbsp;fields&nbsp;with&nbsp;a&nbsp;quote&nbsp;or&nbsp;newline,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6475557">//&nbsp;fields&nbsp;which&nbsp;start&nbsp;with&nbsp;a&nbsp;space&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno">120</span><span class="comment" id="6475620">//&nbsp;We&nbsp;used&nbsp;to&nbsp;quote&nbsp;empty&nbsp;strings,&nbsp;but&nbsp;we&nbsp;do&nbsp;not&nbsp;anymore&nbsp;(as&nbsp;of&nbsp;Go&nbsp;1.4).</span><br>
<span class="lineno"></span><span class="comment" id="6475693">//&nbsp;The&nbsp;two&nbsp;representations&nbsp;should&nbsp;be&nbsp;equivalent,&nbsp;but&nbsp;Postgres&nbsp;distinguishes</span><br>
<span class="lineno"></span><span class="comment" id="6475769">//&nbsp;quoted&nbsp;vs&nbsp;non-quoted&nbsp;empty&nbsp;string&nbsp;during&nbsp;database&nbsp;imports,&nbsp;and&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6475842">//&nbsp;an&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;quoted&nbsp;behavior&nbsp;for&nbsp;non-quoted&nbsp;CSV&nbsp;but&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6475914">//&nbsp;no&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;non-quoted&nbsp;behavior&nbsp;for&nbsp;quoted&nbsp;CSV,&nbsp;making</span><br>
<span class="lineno">125</span><span class="comment" id="6475983">//&nbsp;CSV&nbsp;with&nbsp;quoted&nbsp;empty&nbsp;strings&nbsp;strictly&nbsp;less&nbsp;useful.</span><br>
<span class="lineno"></span><span class="comment" id="6476038">//&nbsp;Not&nbsp;quoting&nbsp;the&nbsp;empty&nbsp;string&nbsp;also&nbsp;makes&nbsp;this&nbsp;package&nbsp;match&nbsp;the&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="6476113">//&nbsp;of&nbsp;Microsoft&nbsp;Excel&nbsp;and&nbsp;Google&nbsp;Drive.</span><br>
<span class="lineno"></span><span class="comment" id="6476153">//&nbsp;For&nbsp;Postgres,&nbsp;quote&nbsp;the&nbsp;data&nbsp;termating&nbsp;string&nbsp;`\.`.</span><br>
<span class="lineno"></span><span class="keyword" id="6476208">func</span>&nbsp;<span class="op" id="6476213">(</span><span class="ident" id="6476214">w</span>&nbsp;<span class="op" id="6476216">*</span><span class="ident" id="6476217">Writer</span><span class="op" id="6476223">)</span>&nbsp;<span class="ident" id="6476225">fieldNeedsQuotes</span><span class="op" id="6476241">(</span><span class="ident" id="6476242">field</span>&nbsp;<span class="builtintype" id="6476248">string</span><span class="op" id="6476254">)</span>&nbsp;<span class="builtintype" id="6476256">bool</span>&nbsp;<span class="op" id="6476261">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476264">if</span>&nbsp;<span class="ident" id="6476267">field</span>&nbsp;<span class="op" id="6476273">==</span>&nbsp;<span class="string" id="6476276">&#34;&#34;</span>&nbsp;<span class="op" id="6476279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476283">return</span>&nbsp;<span class="builtintype" id="6476290">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6476297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476300">if</span>&nbsp;<span class="ident" id="6476303">field</span>&nbsp;<span class="op" id="6476309">==</span>&nbsp;<span class="string" id="6476312">`\.`</span>&nbsp;<span class="op" id="6476317">||</span>&nbsp;<span class="ident" id="6476320">strings</span><span class="op" id="6476327">.</span><span class="ident" id="6476328">IndexRune</span><span class="op" id="6476337">(</span><span class="ident" id="6476338">field</span><span class="op" id="6476343">,</span>&nbsp;<span class="ident" id="6476345">w</span><span class="op" id="6476346">.</span><span class="ident" id="6476347">Comma</span><span class="op" id="6476352">)</span>&nbsp;<span class="op" id="6476354">&gt;=</span>&nbsp;<span class="num" id="6476357">0</span>&nbsp;<span class="op" id="6476359">||</span>&nbsp;<span class="ident" id="6476362">strings</span><span class="op" id="6476369">.</span><span class="ident" id="6476370">IndexAny</span><span class="op" id="6476378">(</span><span class="ident" id="6476379">field</span><span class="op" id="6476384">,</span>&nbsp;<span class="string" id="6476386">&#34;\&#34;\r\n&#34;</span><span class="op" id="6476394">)</span>&nbsp;<span class="op" id="6476396">&gt;=</span>&nbsp;<span class="num" id="6476399">0</span>&nbsp;<span class="op" id="6476401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476405">return</span>&nbsp;<span class="builtintype" id="6476412">true</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6476418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6476422">r1</span><span class="op" id="6476424">,</span>&nbsp;<span class="ident" id="6476426">_</span>&nbsp;<span class="op" id="6476428">:=</span>&nbsp;<span class="ident" id="6476431">utf8</span><span class="op" id="6476435">.</span><span class="ident" id="6476436">DecodeRuneInString</span><span class="op" id="6476454">(</span><span class="ident" id="6476455">field</span><span class="op" id="6476460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6476463">return</span>&nbsp;<span class="ident" id="6476470">unicode</span><span class="op" id="6476477">.</span><span class="ident" id="6476478">IsSpace</span><span class="op" id="6476485">(</span><span class="ident" id="6476486">r1</span><span class="op" id="6476488">)</span><br>
<span class="lineno"></span><span class="op" id="6476490">}</span>
</div>
</body>
</html>
