<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html" class="current">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2872950">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2873005">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2873059">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2873110">package</span>&nbsp;<span class="ident" id="2873118">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2873125">import</span>&nbsp;<span class="op" id="2873132">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2873135">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2873142">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2873150">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="2873157">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2873160">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2873241">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2873255">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="2873306">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="2873356">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="2873406">//</span><br>
<span class="lineno">20</span><span class="keyword" id="2873409">type</span>&nbsp;<span class="ident" id="2873414">Position</span>&nbsp;<span class="keyword" id="2873423">struct</span>&nbsp;<span class="op" id="2873430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2873433">Filename</span>&nbsp;<span class="builtintype" id="2873442">string</span>&nbsp;<span class="comment" id="2873449">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2873470">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2873479">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2873486">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2873512">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2873521">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2873528">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2873559">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2873568">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2873575">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="2873625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2873628">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="2873678">func</span>&nbsp;<span class="op" id="2873683">(</span><span class="ident" id="2873684">pos</span>&nbsp;<span class="op" id="2873688">*</span><span class="ident" id="2873689">Position</span><span class="op" id="2873697">)</span>&nbsp;<span class="ident" id="2873699">IsValid</span><span class="op" id="2873706">(</span><span class="op" id="2873707">)</span>&nbsp;<span class="builtintype" id="2873709">bool</span>&nbsp;<span class="op" id="2873714">{</span>&nbsp;<span class="keyword" id="2873716">return</span>&nbsp;<span class="ident" id="2873723">pos</span><span class="op" id="2873726">.</span><span class="ident" id="2873727">Line</span>&nbsp;<span class="op" id="2873732">&gt;</span>&nbsp;<span class="num" id="2873734">0</span>&nbsp;<span class="op" id="2873736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2873739">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="2873791">//</span><br>
<span class="lineno"></span><span class="comment" id="2873794">//&nbsp;&nbsp;&nbsp;&nbspfile:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="2873847">//&nbsp;&nbsp;&nbsp;&nbspline:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="2873903">//&nbsp;&nbsp;&nbsp;&nbspfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="2873958">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="2874016">//</span><br>
<span class="lineno"></span><span class="keyword" id="2874019">func</span>&nbsp;<span class="op" id="2874024">(</span><span class="ident" id="2874025">pos</span>&nbsp;<span class="ident" id="2874029">Position</span><span class="op" id="2874037">)</span>&nbsp;<span class="ident" id="2874039">String</span><span class="op" id="2874045">(</span><span class="op" id="2874046">)</span>&nbsp;<span class="builtintype" id="2874048">string</span>&nbsp;<span class="op" id="2874055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2874058">s</span>&nbsp;<span class="op" id="2874060">:=</span>&nbsp;<span class="ident" id="2874063">pos</span><span class="op" id="2874066">.</span><span class="ident" id="2874067">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874077">if</span>&nbsp;<span class="ident" id="2874080">pos</span><span class="op" id="2874083">.</span><span class="ident" id="2874084">IsValid</span><span class="op" id="2874091">(</span><span class="op" id="2874092">)</span>&nbsp;<span class="op" id="2874094">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874098">if</span>&nbsp;<span class="ident" id="2874101">s</span>&nbsp;<span class="op" id="2874103">!=</span>&nbsp;<span class="string" id="2874106">&#34;&#34;</span>&nbsp;<span class="op" id="2874109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2874114">s</span>&nbsp;<span class="op" id="2874116">+=</span>&nbsp;<span class="string" id="2874119">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2874129">s</span>&nbsp;<span class="op" id="2874131">+=</span>&nbsp;<span class="ident" id="2874134">fmt</span><span class="op" id="2874137">.</span><span class="ident" id="2874138">Sprintf</span><span class="op" id="2874145">(</span><span class="string" id="2874146">&#34;%d:%d&#34;</span><span class="op" id="2874153">,</span>&nbsp;<span class="ident" id="2874155">pos</span><span class="op" id="2874158">.</span><span class="ident" id="2874159">Line</span><span class="op" id="2874163">,</span>&nbsp;<span class="ident" id="2874165">pos</span><span class="op" id="2874168">.</span><span class="ident" id="2874169">Column</span><span class="op" id="2874175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874178">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874181">if</span>&nbsp;<span class="ident" id="2874184">s</span>&nbsp;<span class="op" id="2874186">==</span>&nbsp;<span class="string" id="2874189">&#34;&#34;</span>&nbsp;<span class="op" id="2874192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2874196">s</span>&nbsp;<span class="op" id="2874198">=</span>&nbsp;<span class="string" id="2874200">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874208">return</span>&nbsp;<span class="ident" id="2874215">s</span><br>
<span class="lineno"></span><span class="op" id="2874217">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2874220">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="2874289">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="2874360">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="2874387">//</span><br>
<span class="lineno">55</span><span class="comment" id="2874390">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="2874468">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="2874546">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="2874558">//</span><br>
<span class="lineno"></span><span class="comment" id="2874561">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="2874628">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="2874697">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="2874766">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2874835">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="2874876">//</span><br>
<span class="lineno">65</span><span class="comment" id="2874879">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="2874955">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2875027">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="2875101">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="2875177">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="2875237">//</span><br>
<span class="lineno"></span><span class="keyword" id="2875240">type</span>&nbsp;<span class="ident" id="2875245">Pos</span>&nbsp;<span class="builtintype" id="2875249">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2875254">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="2875328">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="2875399">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="2875469">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="2875514">//</span><br>
<span class="lineno"></span><span class="keyword" id="2875517">const</span>&nbsp;<span class="ident" id="2875523">NoPos</span>&nbsp;<span class="ident" id="2875529">Pos</span>&nbsp;<span class="op" id="2875533">=</span>&nbsp;<span class="num" id="2875535">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2875538">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="2875588">func</span>&nbsp;<span class="op" id="2875593">(</span><span class="ident" id="2875594">p</span>&nbsp;<span class="ident" id="2875596">Pos</span><span class="op" id="2875599">)</span>&nbsp;<span class="ident" id="2875601">IsValid</span><span class="op" id="2875608">(</span><span class="op" id="2875609">)</span>&nbsp;<span class="builtintype" id="2875611">bool</span>&nbsp;<span class="op" id="2875616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875619">return</span>&nbsp;<span class="ident" id="2875626">p</span>&nbsp;<span class="op" id="2875628">!=</span>&nbsp;<span class="ident" id="2875631">NoPos</span><br>
<span class="lineno"></span><span class="op" id="2875637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="2875640">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2875721">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2875730">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="2875787">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="2875838">//</span><br>
<span class="lineno"></span><span class="keyword" id="2875841">type</span>&nbsp;<span class="ident" id="2875846">File</span>&nbsp;<span class="keyword" id="2875851">struct</span>&nbsp;<span class="op" id="2875858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875861">set</span>&nbsp;&nbsp;<span class="op" id="2875866">*</span><span class="ident" id="2875867">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875876">name</span>&nbsp;<span class="builtintype" id="2875881">string</span>&nbsp;<span class="comment" id="2875888">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875925">base</span>&nbsp;<span class="builtintype" id="2875930">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2875937">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875993">size</span>&nbsp;<span class="builtintype" id="2875998">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2876005">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2876043">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876090">lines</span>&nbsp;<span class="op" id="2876096">[</span><span class="op" id="2876097">]</span><span class="builtintype" id="2876098">int</span>&nbsp;<span class="comment" id="2876102">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876199">infos</span>&nbsp;<span class="op" id="2876205">[</span><span class="op" id="2876206">]</span><span class="ident" id="2876207">lineInfo</span><br>
<span class="lineno">100</span><span class="op" id="2876216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2876219">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="2876287">func</span>&nbsp;<span class="op" id="2876292">(</span><span class="ident" id="2876293">f</span>&nbsp;<span class="op" id="2876295">*</span><span class="ident" id="2876296">File</span><span class="op" id="2876300">)</span>&nbsp;<span class="ident" id="2876302">Name</span><span class="op" id="2876306">(</span><span class="op" id="2876307">)</span>&nbsp;<span class="builtintype" id="2876309">string</span>&nbsp;<span class="op" id="2876316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876319">return</span>&nbsp;<span class="ident" id="2876326">f</span><span class="op" id="2876327">.</span><span class="ident" id="2876328">name</span><br>
<span class="lineno">105</span><span class="op" id="2876333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2876336">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="2876406">func</span>&nbsp;<span class="op" id="2876411">(</span><span class="ident" id="2876412">f</span>&nbsp;<span class="op" id="2876414">*</span><span class="ident" id="2876415">File</span><span class="op" id="2876419">)</span>&nbsp;<span class="ident" id="2876421">Base</span><span class="op" id="2876425">(</span><span class="op" id="2876426">)</span>&nbsp;<span class="builtintype" id="2876428">int</span>&nbsp;<span class="op" id="2876432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876435">return</span>&nbsp;<span class="ident" id="2876442">f</span><span class="op" id="2876443">.</span><span class="ident" id="2876444">base</span><br>
<span class="lineno">110</span><span class="op" id="2876449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2876452">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="2876515">func</span>&nbsp;<span class="op" id="2876520">(</span><span class="ident" id="2876521">f</span>&nbsp;<span class="op" id="2876523">*</span><span class="ident" id="2876524">File</span><span class="op" id="2876528">)</span>&nbsp;<span class="ident" id="2876530">Size</span><span class="op" id="2876534">(</span><span class="op" id="2876535">)</span>&nbsp;<span class="builtintype" id="2876537">int</span>&nbsp;<span class="op" id="2876541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876544">return</span>&nbsp;<span class="ident" id="2876551">f</span><span class="op" id="2876552">.</span><span class="ident" id="2876553">size</span><br>
<span class="lineno">115</span><span class="op" id="2876558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2876561">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="2876613">func</span>&nbsp;<span class="op" id="2876618">(</span><span class="ident" id="2876619">f</span>&nbsp;<span class="op" id="2876621">*</span><span class="ident" id="2876622">File</span><span class="op" id="2876626">)</span>&nbsp;<span class="ident" id="2876628">LineCount</span><span class="op" id="2876637">(</span><span class="op" id="2876638">)</span>&nbsp;<span class="builtintype" id="2876640">int</span>&nbsp;<span class="op" id="2876644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876647">f</span><span class="op" id="2876648">.</span><span class="ident" id="2876649">set</span><span class="op" id="2876652">.</span><span class="ident" id="2876653">mutex</span><span class="op" id="2876658">.</span><span class="ident" id="2876659">RLock</span><span class="op" id="2876664">(</span><span class="op" id="2876665">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876668">n</span>&nbsp;<span class="op" id="2876670">:=</span>&nbsp;<span class="builtinfunc" id="2876673">len</span><span class="op" id="2876676">(</span><span class="ident" id="2876677">f</span><span class="op" id="2876678">.</span><span class="ident" id="2876679">lines</span><span class="op" id="2876684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876687">f</span><span class="op" id="2876688">.</span><span class="ident" id="2876689">set</span><span class="op" id="2876692">.</span><span class="ident" id="2876693">mutex</span><span class="op" id="2876698">.</span><span class="ident" id="2876699">RUnlock</span><span class="op" id="2876706">(</span><span class="op" id="2876707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876710">return</span>&nbsp;<span class="ident" id="2876717">n</span><br>
<span class="lineno"></span><span class="op" id="2876719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="2876722">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="2876770">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="2876842">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="2876915">//</span><br>
<span class="lineno"></span><span class="keyword" id="2876918">func</span>&nbsp;<span class="op" id="2876923">(</span><span class="ident" id="2876924">f</span>&nbsp;<span class="op" id="2876926">*</span><span class="ident" id="2876927">File</span><span class="op" id="2876931">)</span>&nbsp;<span class="ident" id="2876933">AddLine</span><span class="op" id="2876940">(</span><span class="ident" id="2876941">offset</span>&nbsp;<span class="builtintype" id="2876948">int</span><span class="op" id="2876951">)</span>&nbsp;<span class="op" id="2876953">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876956">f</span><span class="op" id="2876957">.</span><span class="ident" id="2876958">set</span><span class="op" id="2876961">.</span><span class="ident" id="2876962">mutex</span><span class="op" id="2876967">.</span><span class="ident" id="2876968">Lock</span><span class="op" id="2876972">(</span><span class="op" id="2876973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876976">if</span>&nbsp;<span class="ident" id="2876979">i</span>&nbsp;<span class="op" id="2876981">:=</span>&nbsp;<span class="builtinfunc" id="2876984">len</span><span class="op" id="2876987">(</span><span class="ident" id="2876988">f</span><span class="op" id="2876989">.</span><span class="ident" id="2876990">lines</span><span class="op" id="2876995">)</span><span class="op" id="2876996">;</span>&nbsp;<span class="op" id="2876998">(</span><span class="ident" id="2876999">i</span>&nbsp;<span class="op" id="2877001">==</span>&nbsp;<span class="num" id="2877004">0</span>&nbsp;<span class="op" id="2877006">||</span>&nbsp;<span class="ident" id="2877009">f</span><span class="op" id="2877010">.</span><span class="ident" id="2877011">lines</span><span class="op" id="2877016">[</span><span class="ident" id="2877017">i</span><span class="op" id="2877018">-</span><span class="num" id="2877019">1</span><span class="op" id="2877020">]</span>&nbsp;<span class="op" id="2877022">&lt;</span>&nbsp;<span class="ident" id="2877024">offset</span><span class="op" id="2877030">)</span>&nbsp;<span class="op" id="2877032">&amp;&amp;</span>&nbsp;<span class="ident" id="2877035">offset</span>&nbsp;<span class="op" id="2877042">&lt;</span>&nbsp;<span class="ident" id="2877044">f</span><span class="op" id="2877045">.</span><span class="ident" id="2877046">size</span>&nbsp;<span class="op" id="2877051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877055">f</span><span class="op" id="2877056">.</span><span class="ident" id="2877057">lines</span>&nbsp;<span class="op" id="2877063">=</span>&nbsp;<span class="builtinfunc" id="2877065">append</span><span class="op" id="2877071">(</span><span class="ident" id="2877072">f</span><span class="op" id="2877073">.</span><span class="ident" id="2877074">lines</span><span class="op" id="2877079">,</span>&nbsp;<span class="ident" id="2877081">offset</span><span class="op" id="2877087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2877090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877093">f</span><span class="op" id="2877094">.</span><span class="ident" id="2877095">set</span><span class="op" id="2877098">.</span><span class="ident" id="2877099">mutex</span><span class="op" id="2877104">.</span><span class="ident" id="2877105">Unlock</span><span class="op" id="2877111">(</span><span class="op" id="2877112">)</span><br>
<span class="lineno">135</span><span class="op" id="2877114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2877117">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="2877193">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2877273">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="2877351">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="2877408">//</span><br>
<span class="lineno"></span><span class="keyword" id="2877411">func</span>&nbsp;<span class="op" id="2877416">(</span><span class="ident" id="2877417">f</span>&nbsp;<span class="op" id="2877419">*</span><span class="ident" id="2877420">File</span><span class="op" id="2877424">)</span>&nbsp;<span class="ident" id="2877426">MergeLine</span><span class="op" id="2877435">(</span><span class="ident" id="2877436">line</span>&nbsp;<span class="builtintype" id="2877441">int</span><span class="op" id="2877444">)</span>&nbsp;<span class="op" id="2877446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877449">if</span>&nbsp;<span class="ident" id="2877452">line</span>&nbsp;<span class="op" id="2877457">&lt;=</span>&nbsp;<span class="num" id="2877460">0</span>&nbsp;<span class="op" id="2877462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2877466">panic</span><span class="op" id="2877471">(</span><span class="string" id="2877472">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="2877522">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2877525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877528">f</span><span class="op" id="2877529">.</span><span class="ident" id="2877530">set</span><span class="op" id="2877533">.</span><span class="ident" id="2877534">mutex</span><span class="op" id="2877539">.</span><span class="ident" id="2877540">Lock</span><span class="op" id="2877544">(</span><span class="op" id="2877545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877548">defer</span>&nbsp;<span class="ident" id="2877554">f</span><span class="op" id="2877555">.</span><span class="ident" id="2877556">set</span><span class="op" id="2877559">.</span><span class="ident" id="2877560">mutex</span><span class="op" id="2877565">.</span><span class="ident" id="2877566">Unlock</span><span class="op" id="2877572">(</span><span class="op" id="2877573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877576">if</span>&nbsp;<span class="ident" id="2877579">line</span>&nbsp;<span class="op" id="2877584">&gt;=</span>&nbsp;<span class="builtinfunc" id="2877587">len</span><span class="op" id="2877590">(</span><span class="ident" id="2877591">f</span><span class="op" id="2877592">.</span><span class="ident" id="2877593">lines</span><span class="op" id="2877598">)</span>&nbsp;<span class="op" id="2877600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2877604">panic</span><span class="op" id="2877609">(</span><span class="string" id="2877610">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="2877631">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2877634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2877637">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2877708">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2877775">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2877843">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2877916">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2877962">copy</span><span class="op" id="2877966">(</span><span class="ident" id="2877967">f</span><span class="op" id="2877968">.</span><span class="ident" id="2877969">lines</span><span class="op" id="2877974">[</span><span class="ident" id="2877975">line</span><span class="op" id="2877979">:</span><span class="op" id="2877980">]</span><span class="op" id="2877981">,</span>&nbsp;<span class="ident" id="2877983">f</span><span class="op" id="2877984">.</span><span class="ident" id="2877985">lines</span><span class="op" id="2877990">[</span><span class="ident" id="2877991">line</span><span class="op" id="2877995">+</span><span class="num" id="2877996">1</span><span class="op" id="2877997">:</span><span class="op" id="2877998">]</span><span class="op" id="2877999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878002">f</span><span class="op" id="2878003">.</span><span class="ident" id="2878004">lines</span>&nbsp;<span class="op" id="2878010">=</span>&nbsp;<span class="ident" id="2878012">f</span><span class="op" id="2878013">.</span><span class="ident" id="2878014">lines</span><span class="op" id="2878019">[</span><span class="op" id="2878020">:</span><span class="builtinfunc" id="2878021">len</span><span class="op" id="2878024">(</span><span class="ident" id="2878025">f</span><span class="op" id="2878026">.</span><span class="ident" id="2878027">lines</span><span class="op" id="2878032">)</span><span class="op" id="2878033">-</span><span class="num" id="2878034">1</span><span class="op" id="2878035">]</span><br>
<span class="lineno"></span><span class="op" id="2878037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="2878040">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="2878117">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="2878190">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="2878261">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="2878310">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="2878383">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="2878455">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="2878465">//</span><br>
<span class="lineno"></span><span class="keyword" id="2878468">func</span>&nbsp;<span class="op" id="2878473">(</span><span class="ident" id="2878474">f</span>&nbsp;<span class="op" id="2878476">*</span><span class="ident" id="2878477">File</span><span class="op" id="2878481">)</span>&nbsp;<span class="ident" id="2878483">SetLines</span><span class="op" id="2878491">(</span><span class="ident" id="2878492">lines</span>&nbsp;<span class="op" id="2878498">[</span><span class="op" id="2878499">]</span><span class="builtintype" id="2878500">int</span><span class="op" id="2878503">)</span>&nbsp;<span class="builtintype" id="2878505">bool</span>&nbsp;<span class="op" id="2878510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2878513">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878548">size</span>&nbsp;<span class="op" id="2878553">:=</span>&nbsp;<span class="ident" id="2878556">f</span><span class="op" id="2878557">.</span><span class="ident" id="2878558">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878564">for</span>&nbsp;<span class="ident" id="2878568">i</span><span class="op" id="2878569">,</span>&nbsp;<span class="ident" id="2878571">offset</span>&nbsp;<span class="op" id="2878578">:=</span>&nbsp;<span class="keyword" id="2878581">range</span>&nbsp;<span class="ident" id="2878587">lines</span>&nbsp;<span class="op" id="2878593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878597">if</span>&nbsp;<span class="ident" id="2878600">i</span>&nbsp;<span class="op" id="2878602">&gt;</span>&nbsp;<span class="num" id="2878604">0</span>&nbsp;<span class="op" id="2878606">&amp;&amp;</span>&nbsp;<span class="ident" id="2878609">offset</span>&nbsp;<span class="op" id="2878616">&lt;=</span>&nbsp;<span class="ident" id="2878619">lines</span><span class="op" id="2878624">[</span><span class="ident" id="2878625">i</span><span class="op" id="2878626">-</span><span class="num" id="2878627">1</span><span class="op" id="2878628">]</span>&nbsp;<span class="op" id="2878630">||</span>&nbsp;<span class="ident" id="2878633">size</span>&nbsp;<span class="op" id="2878638">&lt;=</span>&nbsp;<span class="ident" id="2878641">offset</span>&nbsp;<span class="op" id="2878648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878653">return</span>&nbsp;<span class="builtintype" id="2878660">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2878668">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2878671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2878675">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878695">f</span><span class="op" id="2878696">.</span><span class="ident" id="2878697">set</span><span class="op" id="2878700">.</span><span class="ident" id="2878701">mutex</span><span class="op" id="2878706">.</span><span class="ident" id="2878707">Lock</span><span class="op" id="2878711">(</span><span class="op" id="2878712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878715">f</span><span class="op" id="2878716">.</span><span class="ident" id="2878717">lines</span>&nbsp;<span class="op" id="2878723">=</span>&nbsp;<span class="ident" id="2878725">lines</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878732">f</span><span class="op" id="2878733">.</span><span class="ident" id="2878734">set</span><span class="op" id="2878737">.</span><span class="ident" id="2878738">mutex</span><span class="op" id="2878743">.</span><span class="ident" id="2878744">Unlock</span><span class="op" id="2878750">(</span><span class="op" id="2878751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878754">return</span>&nbsp;<span class="builtintype" id="2878761">true</span><br>
<span class="lineno"></span><span class="op" id="2878766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2878769">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="2878841">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="2878890">func</span>&nbsp;<span class="op" id="2878895">(</span><span class="ident" id="2878896">f</span>&nbsp;<span class="op" id="2878898">*</span><span class="ident" id="2878899">File</span><span class="op" id="2878903">)</span>&nbsp;<span class="ident" id="2878905">SetLinesForContent</span><span class="op" id="2878923">(</span><span class="ident" id="2878924">content</span>&nbsp;<span class="op" id="2878932">[</span><span class="op" id="2878933">]</span><span class="builtintype" id="2878934">byte</span><span class="op" id="2878938">)</span>&nbsp;<span class="op" id="2878940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878943">var</span>&nbsp;<span class="ident" id="2878947">lines</span>&nbsp;<span class="op" id="2878953">[</span><span class="op" id="2878954">]</span><span class="builtintype" id="2878955">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878960">line</span>&nbsp;<span class="op" id="2878965">:=</span>&nbsp;<span class="num" id="2878968">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878971">for</span>&nbsp;<span class="ident" id="2878975">offset</span><span class="op" id="2878981">,</span>&nbsp;<span class="ident" id="2878983">b</span>&nbsp;<span class="op" id="2878985">:=</span>&nbsp;<span class="keyword" id="2878988">range</span>&nbsp;<span class="ident" id="2878994">content</span>&nbsp;<span class="op" id="2879002">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879006">if</span>&nbsp;<span class="ident" id="2879009">line</span>&nbsp;<span class="op" id="2879014">&gt;=</span>&nbsp;<span class="num" id="2879017">0</span>&nbsp;<span class="op" id="2879019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879024">lines</span>&nbsp;<span class="op" id="2879030">=</span>&nbsp;<span class="builtinfunc" id="2879032">append</span><span class="op" id="2879038">(</span><span class="ident" id="2879039">lines</span><span class="op" id="2879044">,</span>&nbsp;<span class="ident" id="2879046">line</span><span class="op" id="2879050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2879054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879058">line</span>&nbsp;<span class="op" id="2879063">=</span>&nbsp;<span class="op" id="2879065">-</span><span class="num" id="2879066">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879070">if</span>&nbsp;<span class="ident" id="2879073">b</span>&nbsp;<span class="op" id="2879075">==</span>&nbsp;<span class="string" id="2879078">&#39;\n&#39;</span>&nbsp;<span class="op" id="2879083">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879088">line</span>&nbsp;<span class="op" id="2879093">=</span>&nbsp;<span class="ident" id="2879095">offset</span>&nbsp;<span class="op" id="2879102">+</span>&nbsp;<span class="num" id="2879104">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2879108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2879111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2879115">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879135">f</span><span class="op" id="2879136">.</span><span class="ident" id="2879137">set</span><span class="op" id="2879140">.</span><span class="ident" id="2879141">mutex</span><span class="op" id="2879146">.</span><span class="ident" id="2879147">Lock</span><span class="op" id="2879151">(</span><span class="op" id="2879152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879155">f</span><span class="op" id="2879156">.</span><span class="ident" id="2879157">lines</span>&nbsp;<span class="op" id="2879163">=</span>&nbsp;<span class="ident" id="2879165">lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879172">f</span><span class="op" id="2879173">.</span><span class="ident" id="2879174">set</span><span class="op" id="2879177">.</span><span class="ident" id="2879178">mutex</span><span class="op" id="2879183">.</span><span class="ident" id="2879184">Unlock</span><span class="op" id="2879190">(</span><span class="op" id="2879191">)</span><br>
<span class="lineno"></span><span class="op" id="2879193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="2879196">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="2879260">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="2879323">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="2879357">type</span>&nbsp;<span class="ident" id="2879362">lineInfo</span>&nbsp;<span class="keyword" id="2879371">struct</span>&nbsp;<span class="op" id="2879378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2879381">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879436">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2879445">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879450">Filename</span>&nbsp;<span class="builtintype" id="2879459">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879467">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2879476">int</span><br>
<span class="lineno"></span><span class="op" id="2879480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="2879483">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2879552">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2879622">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2879689">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="2879741">//</span><br>
<span class="lineno">220</span><span class="comment" id="2879744">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="2879810">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="2879876">//</span><br>
<span class="lineno"></span><span class="keyword" id="2879879">func</span>&nbsp;<span class="op" id="2879884">(</span><span class="ident" id="2879885">f</span>&nbsp;<span class="op" id="2879887">*</span><span class="ident" id="2879888">File</span><span class="op" id="2879892">)</span>&nbsp;<span class="ident" id="2879894">AddLineInfo</span><span class="op" id="2879905">(</span><span class="ident" id="2879906">offset</span>&nbsp;<span class="builtintype" id="2879913">int</span><span class="op" id="2879916">,</span>&nbsp;<span class="ident" id="2879918">filename</span>&nbsp;<span class="builtintype" id="2879927">string</span><span class="op" id="2879933">,</span>&nbsp;<span class="ident" id="2879935">line</span>&nbsp;<span class="builtintype" id="2879940">int</span><span class="op" id="2879943">)</span>&nbsp;<span class="op" id="2879945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879948">f</span><span class="op" id="2879949">.</span><span class="ident" id="2879950">set</span><span class="op" id="2879953">.</span><span class="ident" id="2879954">mutex</span><span class="op" id="2879959">.</span><span class="ident" id="2879960">Lock</span><span class="op" id="2879964">(</span><span class="op" id="2879965">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879968">if</span>&nbsp;<span class="ident" id="2879971">i</span>&nbsp;<span class="op" id="2879973">:=</span>&nbsp;<span class="builtinfunc" id="2879976">len</span><span class="op" id="2879979">(</span><span class="ident" id="2879980">f</span><span class="op" id="2879981">.</span><span class="ident" id="2879982">infos</span><span class="op" id="2879987">)</span><span class="op" id="2879988">;</span>&nbsp;<span class="ident" id="2879990">i</span>&nbsp;<span class="op" id="2879992">==</span>&nbsp;<span class="num" id="2879995">0</span>&nbsp;<span class="op" id="2879997">||</span>&nbsp;<span class="ident" id="2880000">f</span><span class="op" id="2880001">.</span><span class="ident" id="2880002">infos</span><span class="op" id="2880007">[</span><span class="ident" id="2880008">i</span><span class="op" id="2880009">-</span><span class="num" id="2880010">1</span><span class="op" id="2880011">]</span><span class="op" id="2880012">.</span><span class="ident" id="2880013">Offset</span>&nbsp;<span class="op" id="2880020">&lt;</span>&nbsp;<span class="ident" id="2880022">offset</span>&nbsp;<span class="op" id="2880029">&amp;&amp;</span>&nbsp;<span class="ident" id="2880032">offset</span>&nbsp;<span class="op" id="2880039">&lt;</span>&nbsp;<span class="ident" id="2880041">f</span><span class="op" id="2880042">.</span><span class="ident" id="2880043">size</span>&nbsp;<span class="op" id="2880048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880052">f</span><span class="op" id="2880053">.</span><span class="ident" id="2880054">infos</span>&nbsp;<span class="op" id="2880060">=</span>&nbsp;<span class="builtinfunc" id="2880062">append</span><span class="op" id="2880068">(</span><span class="ident" id="2880069">f</span><span class="op" id="2880070">.</span><span class="ident" id="2880071">infos</span><span class="op" id="2880076">,</span>&nbsp;<span class="ident" id="2880078">lineInfo</span><span class="op" id="2880086">{</span><span class="ident" id="2880087">offset</span><span class="op" id="2880093">,</span>&nbsp;<span class="ident" id="2880095">filename</span><span class="op" id="2880103">,</span>&nbsp;<span class="ident" id="2880105">line</span><span class="op" id="2880109">}</span><span class="op" id="2880110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2880113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880116">f</span><span class="op" id="2880117">.</span><span class="ident" id="2880118">set</span><span class="op" id="2880121">.</span><span class="ident" id="2880122">mutex</span><span class="op" id="2880127">.</span><span class="ident" id="2880128">Unlock</span><span class="op" id="2880134">(</span><span class="op" id="2880135">)</span><br>
<span class="lineno"></span><span class="op" id="2880137">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="2880140">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="2880196">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="2880231">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="2880259">//</span><br>
<span class="lineno">235</span><span class="keyword" id="2880262">func</span>&nbsp;<span class="op" id="2880267">(</span><span class="ident" id="2880268">f</span>&nbsp;<span class="op" id="2880270">*</span><span class="ident" id="2880271">File</span><span class="op" id="2880275">)</span>&nbsp;<span class="ident" id="2880277">Pos</span><span class="op" id="2880280">(</span><span class="ident" id="2880281">offset</span>&nbsp;<span class="builtintype" id="2880288">int</span><span class="op" id="2880291">)</span>&nbsp;<span class="ident" id="2880293">Pos</span>&nbsp;<span class="op" id="2880297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880300">if</span>&nbsp;<span class="ident" id="2880303">offset</span>&nbsp;<span class="op" id="2880310">&gt;</span>&nbsp;<span class="ident" id="2880312">f</span><span class="op" id="2880313">.</span><span class="ident" id="2880314">size</span>&nbsp;<span class="op" id="2880319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2880323">panic</span><span class="op" id="2880328">(</span><span class="string" id="2880329">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="2880350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2880353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880356">return</span>&nbsp;<span class="ident" id="2880363">Pos</span><span class="op" id="2880366">(</span><span class="ident" id="2880367">f</span><span class="op" id="2880368">.</span><span class="ident" id="2880369">base</span>&nbsp;<span class="op" id="2880374">+</span>&nbsp;<span class="ident" id="2880376">offset</span><span class="op" id="2880382">)</span><br>
<span class="lineno">240</span><span class="op" id="2880384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2880387">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="2880447">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2880492">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="2880530">//</span><br>
<span class="lineno"></span><span class="keyword" id="2880533">func</span>&nbsp;<span class="op" id="2880538">(</span><span class="ident" id="2880539">f</span>&nbsp;<span class="op" id="2880541">*</span><span class="ident" id="2880542">File</span><span class="op" id="2880546">)</span>&nbsp;<span class="ident" id="2880548">Offset</span><span class="op" id="2880554">(</span><span class="ident" id="2880555">p</span>&nbsp;<span class="ident" id="2880557">Pos</span><span class="op" id="2880560">)</span>&nbsp;<span class="builtintype" id="2880562">int</span>&nbsp;<span class="op" id="2880566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880569">if</span>&nbsp;<span class="builtintype" id="2880572">int</span><span class="op" id="2880575">(</span><span class="ident" id="2880576">p</span><span class="op" id="2880577">)</span>&nbsp;<span class="op" id="2880579">&lt;</span>&nbsp;<span class="ident" id="2880581">f</span><span class="op" id="2880582">.</span><span class="ident" id="2880583">base</span>&nbsp;<span class="op" id="2880588">||</span>&nbsp;<span class="builtintype" id="2880591">int</span><span class="op" id="2880594">(</span><span class="ident" id="2880595">p</span><span class="op" id="2880596">)</span>&nbsp;<span class="op" id="2880598">&gt;</span>&nbsp;<span class="ident" id="2880600">f</span><span class="op" id="2880601">.</span><span class="ident" id="2880602">base</span><span class="op" id="2880606">+</span><span class="ident" id="2880607">f</span><span class="op" id="2880608">.</span><span class="ident" id="2880609">size</span>&nbsp;<span class="op" id="2880614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2880618">panic</span><span class="op" id="2880623">(</span><span class="string" id="2880624">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="2880643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2880646">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880649">return</span>&nbsp;<span class="builtintype" id="2880656">int</span><span class="op" id="2880659">(</span><span class="ident" id="2880660">p</span><span class="op" id="2880661">)</span>&nbsp;<span class="op" id="2880663">-</span>&nbsp;<span class="ident" id="2880665">f</span><span class="op" id="2880666">.</span><span class="ident" id="2880667">base</span><br>
<span class="lineno"></span><span class="op" id="2880672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2880675">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="2880738">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="2880786">//</span><br>
<span class="lineno"></span><span class="keyword" id="2880789">func</span>&nbsp;<span class="op" id="2880794">(</span><span class="ident" id="2880795">f</span>&nbsp;<span class="op" id="2880797">*</span><span class="ident" id="2880798">File</span><span class="op" id="2880802">)</span>&nbsp;<span class="ident" id="2880804">Line</span><span class="op" id="2880808">(</span><span class="ident" id="2880809">p</span>&nbsp;<span class="ident" id="2880811">Pos</span><span class="op" id="2880814">)</span>&nbsp;<span class="builtintype" id="2880816">int</span>&nbsp;<span class="op" id="2880820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880823">return</span>&nbsp;<span class="ident" id="2880830">f</span><span class="op" id="2880831">.</span><span class="ident" id="2880832">Position</span><span class="op" id="2880840">(</span><span class="ident" id="2880841">p</span><span class="op" id="2880842">)</span><span class="op" id="2880843">.</span><span class="ident" id="2880844">Line</span><br>
<span class="lineno"></span><span class="op" id="2880849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="2880852">func</span>&nbsp;<span class="ident" id="2880857">searchLineInfos</span><span class="op" id="2880872">(</span><span class="ident" id="2880873">a</span>&nbsp;<span class="op" id="2880875">[</span><span class="op" id="2880876">]</span><span class="ident" id="2880877">lineInfo</span><span class="op" id="2880885">,</span>&nbsp;<span class="ident" id="2880887">x</span>&nbsp;<span class="builtintype" id="2880889">int</span><span class="op" id="2880892">)</span>&nbsp;<span class="builtintype" id="2880894">int</span>&nbsp;<span class="op" id="2880898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880901">return</span>&nbsp;<span class="ident" id="2880908">sort</span><span class="op" id="2880912">.</span><span class="ident" id="2880913">Search</span><span class="op" id="2880919">(</span><span class="builtinfunc" id="2880920">len</span><span class="op" id="2880923">(</span><span class="ident" id="2880924">a</span><span class="op" id="2880925">)</span><span class="op" id="2880926">,</span>&nbsp;<span class="keyword" id="2880928">func</span><span class="op" id="2880932">(</span><span class="ident" id="2880933">i</span>&nbsp;<span class="builtintype" id="2880935">int</span><span class="op" id="2880938">)</span>&nbsp;<span class="builtintype" id="2880940">bool</span>&nbsp;<span class="op" id="2880945">{</span>&nbsp;<span class="keyword" id="2880947">return</span>&nbsp;<span class="ident" id="2880954">a</span><span class="op" id="2880955">[</span><span class="ident" id="2880956">i</span><span class="op" id="2880957">]</span><span class="op" id="2880958">.</span><span class="ident" id="2880959">Offset</span>&nbsp;<span class="op" id="2880966">&gt;</span>&nbsp;<span class="ident" id="2880968">x</span>&nbsp;<span class="op" id="2880970">}</span><span class="op" id="2880971">)</span>&nbsp;<span class="op" id="2880973">-</span>&nbsp;<span class="num" id="2880975">1</span><br>
<span class="lineno"></span><span class="op" id="2880977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2880980">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="2881057">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="2881133">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="2881212">//</span><br>
<span class="lineno"></span><span class="keyword" id="2881215">func</span>&nbsp;<span class="op" id="2881220">(</span><span class="ident" id="2881221">f</span>&nbsp;<span class="op" id="2881223">*</span><span class="ident" id="2881224">File</span><span class="op" id="2881228">)</span>&nbsp;<span class="ident" id="2881230">unpack</span><span class="op" id="2881236">(</span><span class="ident" id="2881237">offset</span>&nbsp;<span class="builtintype" id="2881244">int</span><span class="op" id="2881247">,</span>&nbsp;<span class="ident" id="2881249">adjusted</span>&nbsp;<span class="builtintype" id="2881258">bool</span><span class="op" id="2881262">)</span>&nbsp;<span class="op" id="2881264">(</span><span class="ident" id="2881265">filename</span>&nbsp;<span class="builtintype" id="2881274">string</span><span class="op" id="2881280">,</span>&nbsp;<span class="ident" id="2881282">line</span><span class="op" id="2881286">,</span>&nbsp;<span class="ident" id="2881288">column</span>&nbsp;<span class="builtintype" id="2881295">int</span><span class="op" id="2881298">)</span>&nbsp;<span class="op" id="2881300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2881303">filename</span>&nbsp;<span class="op" id="2881312">=</span>&nbsp;<span class="ident" id="2881314">f</span><span class="op" id="2881315">.</span><span class="ident" id="2881316">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2881322">if</span>&nbsp;<span class="ident" id="2881325">i</span>&nbsp;<span class="op" id="2881327">:=</span>&nbsp;<span class="ident" id="2881330">searchInts</span><span class="op" id="2881340">(</span><span class="ident" id="2881341">f</span><span class="op" id="2881342">.</span><span class="ident" id="2881343">lines</span><span class="op" id="2881348">,</span>&nbsp;<span class="ident" id="2881350">offset</span><span class="op" id="2881356">)</span><span class="op" id="2881357">;</span>&nbsp;<span class="ident" id="2881359">i</span>&nbsp;<span class="op" id="2881361">&gt;=</span>&nbsp;<span class="num" id="2881364">0</span>&nbsp;<span class="op" id="2881366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2881370">line</span><span class="op" id="2881374">,</span>&nbsp;<span class="ident" id="2881376">column</span>&nbsp;<span class="op" id="2881383">=</span>&nbsp;<span class="ident" id="2881385">i</span><span class="op" id="2881386">+</span><span class="num" id="2881387">1</span><span class="op" id="2881388">,</span>&nbsp;<span class="ident" id="2881390">offset</span><span class="op" id="2881396">-</span><span class="ident" id="2881397">f</span><span class="op" id="2881398">.</span><span class="ident" id="2881399">lines</span><span class="op" id="2881404">[</span><span class="ident" id="2881405">i</span><span class="op" id="2881406">]</span><span class="op" id="2881407">+</span><span class="num" id="2881408">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2881411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2881414">if</span>&nbsp;<span class="ident" id="2881417">adjusted</span>&nbsp;<span class="op" id="2881426">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2881429">len</span><span class="op" id="2881432">(</span><span class="ident" id="2881433">f</span><span class="op" id="2881434">.</span><span class="ident" id="2881435">infos</span><span class="op" id="2881440">)</span>&nbsp;<span class="op" id="2881442">&gt;</span>&nbsp;<span class="num" id="2881444">0</span>&nbsp;<span class="op" id="2881446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2881450">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2881493">if</span>&nbsp;<span class="ident" id="2881496">i</span>&nbsp;<span class="op" id="2881498">:=</span>&nbsp;<span class="ident" id="2881501">searchLineInfos</span><span class="op" id="2881516">(</span><span class="ident" id="2881517">f</span><span class="op" id="2881518">.</span><span class="ident" id="2881519">infos</span><span class="op" id="2881524">,</span>&nbsp;<span class="ident" id="2881526">offset</span><span class="op" id="2881532">)</span><span class="op" id="2881533">;</span>&nbsp;<span class="ident" id="2881535">i</span>&nbsp;<span class="op" id="2881537">&gt;=</span>&nbsp;<span class="num" id="2881540">0</span>&nbsp;<span class="op" id="2881542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2881547">alt</span>&nbsp;<span class="op" id="2881551">:=</span>&nbsp;<span class="op" id="2881554">&amp;</span><span class="ident" id="2881555">f</span><span class="op" id="2881556">.</span><span class="ident" id="2881557">infos</span><span class="op" id="2881562">[</span><span class="ident" id="2881563">i</span><span class="op" id="2881564">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2881569">filename</span>&nbsp;<span class="op" id="2881578">=</span>&nbsp;<span class="ident" id="2881580">alt</span><span class="op" id="2881583">.</span><span class="ident" id="2881584">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2881596">if</span>&nbsp;<span class="ident" id="2881599">i</span>&nbsp;<span class="op" id="2881601">:=</span>&nbsp;<span class="ident" id="2881604">searchInts</span><span class="op" id="2881614">(</span><span class="ident" id="2881615">f</span><span class="op" id="2881616">.</span><span class="ident" id="2881617">lines</span><span class="op" id="2881622">,</span>&nbsp;<span class="ident" id="2881624">alt</span><span class="op" id="2881627">.</span><span class="ident" id="2881628">Offset</span><span class="op" id="2881634">)</span><span class="op" id="2881635">;</span>&nbsp;<span class="ident" id="2881637">i</span>&nbsp;<span class="op" id="2881639">&gt;=</span>&nbsp;<span class="num" id="2881642">0</span>&nbsp;<span class="op" id="2881644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2881650">line</span>&nbsp;<span class="op" id="2881655">+=</span>&nbsp;<span class="ident" id="2881658">alt</span><span class="op" id="2881661">.</span><span class="ident" id="2881662">Line</span>&nbsp;<span class="op" id="2881667">-</span>&nbsp;<span class="ident" id="2881669">i</span>&nbsp;<span class="op" id="2881671">-</span>&nbsp;<span class="num" id="2881673">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2881678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2881682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2881685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2881688">return</span><br>
<span class="lineno"></span><span class="op" id="2881695">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="2881698">func</span>&nbsp;<span class="op" id="2881703">(</span><span class="ident" id="2881704">f</span>&nbsp;<span class="op" id="2881706">*</span><span class="ident" id="2881707">File</span><span class="op" id="2881711">)</span>&nbsp;<span class="ident" id="2881713">position</span><span class="op" id="2881721">(</span><span class="ident" id="2881722">p</span>&nbsp;<span class="ident" id="2881724">Pos</span><span class="op" id="2881727">,</span>&nbsp;<span class="ident" id="2881729">adjusted</span>&nbsp;<span class="builtintype" id="2881738">bool</span><span class="op" id="2881742">)</span>&nbsp;<span class="op" id="2881744">(</span><span class="ident" id="2881745">pos</span>&nbsp;<span class="ident" id="2881749">Position</span><span class="op" id="2881757">)</span>&nbsp;<span class="op" id="2881759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2881762">offset</span>&nbsp;<span class="op" id="2881769">:=</span>&nbsp;<span class="builtintype" id="2881772">int</span><span class="op" id="2881775">(</span><span class="ident" id="2881776">p</span><span class="op" id="2881777">)</span>&nbsp;<span class="op" id="2881779">-</span>&nbsp;<span class="ident" id="2881781">f</span><span class="op" id="2881782">.</span><span class="ident" id="2881783">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2881789">pos</span><span class="op" id="2881792">.</span><span class="ident" id="2881793">Offset</span>&nbsp;<span class="op" id="2881800">=</span>&nbsp;<span class="ident" id="2881802">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2881810">pos</span><span class="op" id="2881813">.</span><span class="ident" id="2881814">Filename</span><span class="op" id="2881822">,</span>&nbsp;<span class="ident" id="2881824">pos</span><span class="op" id="2881827">.</span><span class="ident" id="2881828">Line</span><span class="op" id="2881832">,</span>&nbsp;<span class="ident" id="2881834">pos</span><span class="op" id="2881837">.</span><span class="ident" id="2881838">Column</span>&nbsp;<span class="op" id="2881845">=</span>&nbsp;<span class="ident" id="2881847">f</span><span class="op" id="2881848">.</span><span class="ident" id="2881849">unpack</span><span class="op" id="2881855">(</span><span class="ident" id="2881856">offset</span><span class="op" id="2881862">,</span>&nbsp;<span class="ident" id="2881864">adjusted</span><span class="op" id="2881872">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2881875">return</span><br>
<span class="lineno"></span><span class="op" id="2881882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2881885">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="2881958">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="2882031">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="2882089">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="2882129">//</span><br>
<span class="lineno"></span><span class="keyword" id="2882132">func</span>&nbsp;<span class="op" id="2882137">(</span><span class="ident" id="2882138">f</span>&nbsp;<span class="op" id="2882140">*</span><span class="ident" id="2882141">File</span><span class="op" id="2882145">)</span>&nbsp;<span class="ident" id="2882147">PositionFor</span><span class="op" id="2882158">(</span><span class="ident" id="2882159">p</span>&nbsp;<span class="ident" id="2882161">Pos</span><span class="op" id="2882164">,</span>&nbsp;<span class="ident" id="2882166">adjusted</span>&nbsp;<span class="builtintype" id="2882175">bool</span><span class="op" id="2882179">)</span>&nbsp;<span class="op" id="2882181">(</span><span class="ident" id="2882182">pos</span>&nbsp;<span class="ident" id="2882186">Position</span><span class="op" id="2882194">)</span>&nbsp;<span class="op" id="2882196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2882199">if</span>&nbsp;<span class="ident" id="2882202">p</span>&nbsp;<span class="op" id="2882204">!=</span>&nbsp;<span class="ident" id="2882207">NoPos</span>&nbsp;<span class="op" id="2882213">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2882217">if</span>&nbsp;<span class="builtintype" id="2882220">int</span><span class="op" id="2882223">(</span><span class="ident" id="2882224">p</span><span class="op" id="2882225">)</span>&nbsp;<span class="op" id="2882227">&lt;</span>&nbsp;<span class="ident" id="2882229">f</span><span class="op" id="2882230">.</span><span class="ident" id="2882231">base</span>&nbsp;<span class="op" id="2882236">||</span>&nbsp;<span class="builtintype" id="2882239">int</span><span class="op" id="2882242">(</span><span class="ident" id="2882243">p</span><span class="op" id="2882244">)</span>&nbsp;<span class="op" id="2882246">&gt;</span>&nbsp;<span class="ident" id="2882248">f</span><span class="op" id="2882249">.</span><span class="ident" id="2882250">base</span><span class="op" id="2882254">+</span><span class="ident" id="2882255">f</span><span class="op" id="2882256">.</span><span class="ident" id="2882257">size</span>&nbsp;<span class="op" id="2882262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2882267">panic</span><span class="op" id="2882272">(</span><span class="string" id="2882273">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="2882292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2882296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2882300">pos</span>&nbsp;<span class="op" id="2882304">=</span>&nbsp;<span class="ident" id="2882306">f</span><span class="op" id="2882307">.</span><span class="ident" id="2882308">position</span><span class="op" id="2882316">(</span><span class="ident" id="2882317">p</span><span class="op" id="2882318">,</span>&nbsp;<span class="ident" id="2882320">adjusted</span><span class="op" id="2882328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2882331">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2882334">return</span><br>
<span class="lineno"></span><span class="op" id="2882341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2882344">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="2882414">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="2882488">//</span><br>
<span class="lineno"></span><span class="keyword" id="2882491">func</span>&nbsp;<span class="op" id="2882496">(</span><span class="ident" id="2882497">f</span>&nbsp;<span class="op" id="2882499">*</span><span class="ident" id="2882500">File</span><span class="op" id="2882504">)</span>&nbsp;<span class="ident" id="2882506">Position</span><span class="op" id="2882514">(</span><span class="ident" id="2882515">p</span>&nbsp;<span class="ident" id="2882517">Pos</span><span class="op" id="2882520">)</span>&nbsp;<span class="op" id="2882522">(</span><span class="ident" id="2882523">pos</span>&nbsp;<span class="ident" id="2882527">Position</span><span class="op" id="2882535">)</span>&nbsp;<span class="op" id="2882537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2882540">return</span>&nbsp;<span class="ident" id="2882547">f</span><span class="op" id="2882548">.</span><span class="ident" id="2882549">PositionFor</span><span class="op" id="2882560">(</span><span class="ident" id="2882561">p</span><span class="op" id="2882562">,</span>&nbsp;<span class="builtintype" id="2882564">true</span><span class="op" id="2882568">)</span><br>
<span class="lineno"></span><span class="op" id="2882570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="2882573">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2882654">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2882666">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="2882713">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="2882775">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="2882808">//</span><br>
<span class="lineno"></span><span class="keyword" id="2882811">type</span>&nbsp;<span class="ident" id="2882816">FileSet</span>&nbsp;<span class="keyword" id="2882824">struct</span>&nbsp;<span class="op" id="2882831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2882834">mutex</span>&nbsp;<span class="ident" id="2882840">sync</span><span class="op" id="2882844">.</span><span class="ident" id="2882845">RWMutex</span>&nbsp;<span class="comment" id="2882853">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2882879">base</span>&nbsp;&nbsp;<span class="builtintype" id="2882885">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2882898">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2882932">files</span>&nbsp;<span class="op" id="2882938">[</span><span class="op" id="2882939">]</span><span class="op" id="2882940">*</span><span class="ident" id="2882941">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2882951">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2882999">last</span>&nbsp;&nbsp;<span class="op" id="2883005">*</span><span class="ident" id="2883006">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2883018">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="2883050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2883053">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="2883091">func</span>&nbsp;<span class="ident" id="2883096">NewFileSet</span><span class="op" id="2883106">(</span><span class="op" id="2883107">)</span>&nbsp;<span class="op" id="2883109">*</span><span class="ident" id="2883110">FileSet</span>&nbsp;<span class="op" id="2883118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2883121">return</span>&nbsp;<span class="op" id="2883128">&amp;</span><span class="ident" id="2883129">FileSet</span><span class="op" id="2883136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2883140">base</span><span class="op" id="2883144">:</span>&nbsp;<span class="num" id="2883146">1</span><span class="op" id="2883147">,</span>&nbsp;<span class="comment" id="2883149">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2883164">}</span><br>
<span class="lineno"></span><span class="op" id="2883166">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="2883169">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2883234">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2883272">//</span><br>
<span class="lineno"></span><span class="keyword" id="2883275">func</span>&nbsp;<span class="op" id="2883280">(</span><span class="ident" id="2883281">s</span>&nbsp;<span class="op" id="2883283">*</span><span class="ident" id="2883284">FileSet</span><span class="op" id="2883291">)</span>&nbsp;<span class="ident" id="2883293">Base</span><span class="op" id="2883297">(</span><span class="op" id="2883298">)</span>&nbsp;<span class="builtintype" id="2883300">int</span>&nbsp;<span class="op" id="2883304">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2883307">s</span><span class="op" id="2883308">.</span><span class="ident" id="2883309">mutex</span><span class="op" id="2883314">.</span><span class="ident" id="2883315">RLock</span><span class="op" id="2883320">(</span><span class="op" id="2883321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2883324">b</span>&nbsp;<span class="op" id="2883326">:=</span>&nbsp;<span class="ident" id="2883329">s</span><span class="op" id="2883330">.</span><span class="ident" id="2883331">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2883337">s</span><span class="op" id="2883338">.</span><span class="ident" id="2883339">mutex</span><span class="op" id="2883344">.</span><span class="ident" id="2883345">RUnlock</span><span class="op" id="2883352">(</span><span class="op" id="2883353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2883356">return</span>&nbsp;<span class="ident" id="2883363">b</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="2883366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2883369">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="2883446">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="2883522">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="2883598">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="2883679">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="2883741">//</span><br>
<span class="lineno"></span><span class="comment" id="2883744">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="2883819">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="2883894">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="2883956">//</span><br>
<span class="lineno"></span><span class="comment" id="2883959">//&nbsp;&nbsp;&nbsp;&nbspint(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="2883983">//</span><br>
<span class="lineno"></span><span class="comment" id="2883986">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="2884065">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="2884139">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="2884169">//</span><br>
<span class="lineno"></span><span class="keyword" id="2884172">func</span>&nbsp;<span class="op" id="2884177">(</span><span class="ident" id="2884178">s</span>&nbsp;<span class="op" id="2884180">*</span><span class="ident" id="2884181">FileSet</span><span class="op" id="2884188">)</span>&nbsp;<span class="ident" id="2884190">AddFile</span><span class="op" id="2884197">(</span><span class="ident" id="2884198">filename</span>&nbsp;<span class="builtintype" id="2884207">string</span><span class="op" id="2884213">,</span>&nbsp;<span class="ident" id="2884215">base</span><span class="op" id="2884219">,</span>&nbsp;<span class="ident" id="2884221">size</span>&nbsp;<span class="builtintype" id="2884226">int</span><span class="op" id="2884229">)</span>&nbsp;<span class="op" id="2884231">*</span><span class="ident" id="2884232">File</span>&nbsp;<span class="op" id="2884237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884240">s</span><span class="op" id="2884241">.</span><span class="ident" id="2884242">mutex</span><span class="op" id="2884247">.</span><span class="ident" id="2884248">Lock</span><span class="op" id="2884252">(</span><span class="op" id="2884253">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2884256">defer</span>&nbsp;<span class="ident" id="2884262">s</span><span class="op" id="2884263">.</span><span class="ident" id="2884264">mutex</span><span class="op" id="2884269">.</span><span class="ident" id="2884270">Unlock</span><span class="op" id="2884276">(</span><span class="op" id="2884277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2884280">if</span>&nbsp;<span class="ident" id="2884283">base</span>&nbsp;<span class="op" id="2884288">&lt;</span>&nbsp;<span class="num" id="2884290">0</span>&nbsp;<span class="op" id="2884292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884296">base</span>&nbsp;<span class="op" id="2884301">=</span>&nbsp;<span class="ident" id="2884303">s</span><span class="op" id="2884304">.</span><span class="ident" id="2884305">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2884311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2884314">if</span>&nbsp;<span class="ident" id="2884317">base</span>&nbsp;<span class="op" id="2884322">&lt;</span>&nbsp;<span class="ident" id="2884324">s</span><span class="op" id="2884325">.</span><span class="ident" id="2884326">base</span>&nbsp;<span class="op" id="2884331">||</span>&nbsp;<span class="ident" id="2884334">size</span>&nbsp;<span class="op" id="2884339">&lt;</span>&nbsp;<span class="num" id="2884341">0</span>&nbsp;<span class="op" id="2884343">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2884347">panic</span><span class="op" id="2884352">(</span><span class="string" id="2884353">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="2884375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2884378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2884381">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884413">f</span>&nbsp;<span class="op" id="2884415">:=</span>&nbsp;<span class="op" id="2884418">&amp;</span><span class="ident" id="2884419">File</span><span class="op" id="2884423">{</span><span class="ident" id="2884424">s</span><span class="op" id="2884425">,</span>&nbsp;<span class="ident" id="2884427">filename</span><span class="op" id="2884435">,</span>&nbsp;<span class="ident" id="2884437">base</span><span class="op" id="2884441">,</span>&nbsp;<span class="ident" id="2884443">size</span><span class="op" id="2884447">,</span>&nbsp;<span class="op" id="2884449">[</span><span class="op" id="2884450">]</span><span class="builtintype" id="2884451">int</span><span class="op" id="2884454">{</span><span class="num" id="2884455">0</span><span class="op" id="2884456">}</span><span class="op" id="2884457">,</span>&nbsp;<span class="ident" id="2884459">nil</span><span class="op" id="2884462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884465">base</span>&nbsp;<span class="op" id="2884470">+=</span>&nbsp;<span class="ident" id="2884473">size</span>&nbsp;<span class="op" id="2884478">+</span>&nbsp;<span class="num" id="2884480">1</span>&nbsp;<span class="comment" id="2884482">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2884521">if</span>&nbsp;<span class="ident" id="2884524">base</span>&nbsp;<span class="op" id="2884529">&lt;</span>&nbsp;<span class="num" id="2884531">0</span>&nbsp;<span class="op" id="2884533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2884537">panic</span><span class="op" id="2884542">(</span><span class="string" id="2884543">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="2884604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2884607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2884610">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884643">s</span><span class="op" id="2884644">.</span><span class="ident" id="2884645">base</span>&nbsp;<span class="op" id="2884650">=</span>&nbsp;<span class="ident" id="2884652">base</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884658">s</span><span class="op" id="2884659">.</span><span class="ident" id="2884660">files</span>&nbsp;<span class="op" id="2884666">=</span>&nbsp;<span class="builtinfunc" id="2884668">append</span><span class="op" id="2884674">(</span><span class="ident" id="2884675">s</span><span class="op" id="2884676">.</span><span class="ident" id="2884677">files</span><span class="op" id="2884682">,</span>&nbsp;<span class="ident" id="2884684">f</span><span class="op" id="2884685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884688">s</span><span class="op" id="2884689">.</span><span class="ident" id="2884690">last</span>&nbsp;<span class="op" id="2884695">=</span>&nbsp;<span class="ident" id="2884697">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2884700">return</span>&nbsp;<span class="ident" id="2884707">f</span><br>
<span class="lineno"></span><span class="op" id="2884709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="2884712">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="2884790">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="2884816">//</span><br>
<span class="lineno"></span><span class="keyword" id="2884819">func</span>&nbsp;<span class="op" id="2884824">(</span><span class="ident" id="2884825">s</span>&nbsp;<span class="op" id="2884827">*</span><span class="ident" id="2884828">FileSet</span><span class="op" id="2884835">)</span>&nbsp;<span class="ident" id="2884837">Iterate</span><span class="op" id="2884844">(</span><span class="ident" id="2884845">f</span>&nbsp;<span class="keyword" id="2884847">func</span><span class="op" id="2884851">(</span><span class="op" id="2884852">*</span><span class="ident" id="2884853">File</span><span class="op" id="2884857">)</span>&nbsp;<span class="builtintype" id="2884859">bool</span><span class="op" id="2884863">)</span>&nbsp;<span class="op" id="2884865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2884868">for</span>&nbsp;<span class="ident" id="2884872">i</span>&nbsp;<span class="op" id="2884874">:=</span>&nbsp;<span class="num" id="2884877">0</span><span class="op" id="2884878">;</span>&nbsp;<span class="op" id="2884880">;</span>&nbsp;<span class="ident" id="2884882">i</span><span class="op" id="2884883">++</span>&nbsp;<span class="op" id="2884886">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2884890">var</span>&nbsp;<span class="ident" id="2884894">file</span>&nbsp;<span class="op" id="2884899">*</span><span class="ident" id="2884900">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884907">s</span><span class="op" id="2884908">.</span><span class="ident" id="2884909">mutex</span><span class="op" id="2884914">.</span><span class="ident" id="2884915">RLock</span><span class="op" id="2884920">(</span><span class="op" id="2884921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2884925">if</span>&nbsp;<span class="ident" id="2884928">i</span>&nbsp;<span class="op" id="2884930">&lt;</span>&nbsp;<span class="builtinfunc" id="2884932">len</span><span class="op" id="2884935">(</span><span class="ident" id="2884936">s</span><span class="op" id="2884937">.</span><span class="ident" id="2884938">files</span><span class="op" id="2884943">)</span>&nbsp;<span class="op" id="2884945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884950">file</span>&nbsp;<span class="op" id="2884955">=</span>&nbsp;<span class="ident" id="2884957">s</span><span class="op" id="2884958">.</span><span class="ident" id="2884959">files</span><span class="op" id="2884964">[</span><span class="ident" id="2884965">i</span><span class="op" id="2884966">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2884970">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884974">s</span><span class="op" id="2884975">.</span><span class="ident" id="2884976">mutex</span><span class="op" id="2884981">.</span><span class="ident" id="2884982">RUnlock</span><span class="op" id="2884989">(</span><span class="op" id="2884990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2884994">if</span>&nbsp;<span class="ident" id="2884997">file</span>&nbsp;<span class="op" id="2885002">==</span>&nbsp;<span class="ident" id="2885005">nil</span>&nbsp;<span class="op" id="2885009">||</span>&nbsp;<span class="op" id="2885012">!</span><span class="ident" id="2885013">f</span><span class="op" id="2885014">(</span><span class="ident" id="2885015">file</span><span class="op" id="2885019">)</span>&nbsp;<span class="op" id="2885021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885026">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2885034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2885037">}</span><br>
<span class="lineno">400</span><span class="op" id="2885039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2885042">func</span>&nbsp;<span class="ident" id="2885047">searchFiles</span><span class="op" id="2885058">(</span><span class="ident" id="2885059">a</span>&nbsp;<span class="op" id="2885061">[</span><span class="op" id="2885062">]</span><span class="op" id="2885063">*</span><span class="ident" id="2885064">File</span><span class="op" id="2885068">,</span>&nbsp;<span class="ident" id="2885070">x</span>&nbsp;<span class="builtintype" id="2885072">int</span><span class="op" id="2885075">)</span>&nbsp;<span class="builtintype" id="2885077">int</span>&nbsp;<span class="op" id="2885081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885084">return</span>&nbsp;<span class="ident" id="2885091">sort</span><span class="op" id="2885095">.</span><span class="ident" id="2885096">Search</span><span class="op" id="2885102">(</span><span class="builtinfunc" id="2885103">len</span><span class="op" id="2885106">(</span><span class="ident" id="2885107">a</span><span class="op" id="2885108">)</span><span class="op" id="2885109">,</span>&nbsp;<span class="keyword" id="2885111">func</span><span class="op" id="2885115">(</span><span class="ident" id="2885116">i</span>&nbsp;<span class="builtintype" id="2885118">int</span><span class="op" id="2885121">)</span>&nbsp;<span class="builtintype" id="2885123">bool</span>&nbsp;<span class="op" id="2885128">{</span>&nbsp;<span class="keyword" id="2885130">return</span>&nbsp;<span class="ident" id="2885137">a</span><span class="op" id="2885138">[</span><span class="ident" id="2885139">i</span><span class="op" id="2885140">]</span><span class="op" id="2885141">.</span><span class="ident" id="2885142">base</span>&nbsp;<span class="op" id="2885147">&gt;</span>&nbsp;<span class="ident" id="2885149">x</span>&nbsp;<span class="op" id="2885151">}</span><span class="op" id="2885152">)</span>&nbsp;<span class="op" id="2885154">-</span>&nbsp;<span class="num" id="2885156">1</span><br>
<span class="lineno"></span><span class="op" id="2885158">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="2885161">func</span>&nbsp;<span class="op" id="2885166">(</span><span class="ident" id="2885167">s</span>&nbsp;<span class="op" id="2885169">*</span><span class="ident" id="2885170">FileSet</span><span class="op" id="2885177">)</span>&nbsp;<span class="ident" id="2885179">file</span><span class="op" id="2885183">(</span><span class="ident" id="2885184">p</span>&nbsp;<span class="ident" id="2885186">Pos</span><span class="op" id="2885189">)</span>&nbsp;<span class="op" id="2885191">*</span><span class="ident" id="2885192">File</span>&nbsp;<span class="op" id="2885197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885200">s</span><span class="op" id="2885201">.</span><span class="ident" id="2885202">mutex</span><span class="op" id="2885207">.</span><span class="ident" id="2885208">RLock</span><span class="op" id="2885213">(</span><span class="op" id="2885214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2885217">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885252">if</span>&nbsp;<span class="ident" id="2885255">f</span>&nbsp;<span class="op" id="2885257">:=</span>&nbsp;<span class="ident" id="2885260">s</span><span class="op" id="2885261">.</span><span class="ident" id="2885262">last</span><span class="op" id="2885266">;</span>&nbsp;<span class="ident" id="2885268">f</span>&nbsp;<span class="op" id="2885270">!=</span>&nbsp;<span class="ident" id="2885273">nil</span>&nbsp;<span class="op" id="2885277">&amp;&amp;</span>&nbsp;<span class="ident" id="2885280">f</span><span class="op" id="2885281">.</span><span class="ident" id="2885282">base</span>&nbsp;<span class="op" id="2885287">&lt;=</span>&nbsp;<span class="builtintype" id="2885290">int</span><span class="op" id="2885293">(</span><span class="ident" id="2885294">p</span><span class="op" id="2885295">)</span>&nbsp;<span class="op" id="2885297">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2885300">int</span><span class="op" id="2885303">(</span><span class="ident" id="2885304">p</span><span class="op" id="2885305">)</span>&nbsp;<span class="op" id="2885307">&lt;=</span>&nbsp;<span class="ident" id="2885310">f</span><span class="op" id="2885311">.</span><span class="ident" id="2885312">base</span><span class="op" id="2885316">+</span><span class="ident" id="2885317">f</span><span class="op" id="2885318">.</span><span class="ident" id="2885319">size</span>&nbsp;<span class="op" id="2885324">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885328">s</span><span class="op" id="2885329">.</span><span class="ident" id="2885330">mutex</span><span class="op" id="2885335">.</span><span class="ident" id="2885336">RUnlock</span><span class="op" id="2885343">(</span><span class="op" id="2885344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885348">return</span>&nbsp;<span class="ident" id="2885355">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2885358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2885361">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885406">if</span>&nbsp;<span class="ident" id="2885409">i</span>&nbsp;<span class="op" id="2885411">:=</span>&nbsp;<span class="ident" id="2885414">searchFiles</span><span class="op" id="2885425">(</span><span class="ident" id="2885426">s</span><span class="op" id="2885427">.</span><span class="ident" id="2885428">files</span><span class="op" id="2885433">,</span>&nbsp;<span class="builtintype" id="2885435">int</span><span class="op" id="2885438">(</span><span class="ident" id="2885439">p</span><span class="op" id="2885440">)</span><span class="op" id="2885441">)</span><span class="op" id="2885442">;</span>&nbsp;<span class="ident" id="2885444">i</span>&nbsp;<span class="op" id="2885446">&gt;=</span>&nbsp;<span class="num" id="2885449">0</span>&nbsp;<span class="op" id="2885451">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885455">f</span>&nbsp;<span class="op" id="2885457">:=</span>&nbsp;<span class="ident" id="2885460">s</span><span class="op" id="2885461">.</span><span class="ident" id="2885462">files</span><span class="op" id="2885467">[</span><span class="ident" id="2885468">i</span><span class="op" id="2885469">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2885473">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885524">if</span>&nbsp;<span class="builtintype" id="2885527">int</span><span class="op" id="2885530">(</span><span class="ident" id="2885531">p</span><span class="op" id="2885532">)</span>&nbsp;<span class="op" id="2885534">&lt;=</span>&nbsp;<span class="ident" id="2885537">f</span><span class="op" id="2885538">.</span><span class="ident" id="2885539">base</span><span class="op" id="2885543">+</span><span class="ident" id="2885544">f</span><span class="op" id="2885545">.</span><span class="ident" id="2885546">size</span>&nbsp;<span class="op" id="2885551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885556">s</span><span class="op" id="2885557">.</span><span class="ident" id="2885558">mutex</span><span class="op" id="2885563">.</span><span class="ident" id="2885564">RUnlock</span><span class="op" id="2885571">(</span><span class="op" id="2885572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885577">s</span><span class="op" id="2885578">.</span><span class="ident" id="2885579">mutex</span><span class="op" id="2885584">.</span><span class="ident" id="2885585">Lock</span><span class="op" id="2885589">(</span><span class="op" id="2885590">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885595">s</span><span class="op" id="2885596">.</span><span class="ident" id="2885597">last</span>&nbsp;<span class="op" id="2885602">=</span>&nbsp;<span class="ident" id="2885604">f</span>&nbsp;<span class="comment" id="2885606">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885648">s</span><span class="op" id="2885649">.</span><span class="ident" id="2885650">mutex</span><span class="op" id="2885655">.</span><span class="ident" id="2885656">Unlock</span><span class="op" id="2885662">(</span><span class="op" id="2885663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885668">return</span>&nbsp;<span class="ident" id="2885675">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2885679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2885682">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885685">s</span><span class="op" id="2885686">.</span><span class="ident" id="2885687">mutex</span><span class="op" id="2885692">.</span><span class="ident" id="2885693">RUnlock</span><span class="op" id="2885700">(</span><span class="op" id="2885701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885704">return</span>&nbsp;<span class="ident" id="2885711">nil</span><br>
<span class="lineno"></span><span class="op" id="2885715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2885718">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="2885773">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="2885832">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="2885854">//</span><br>
<span class="lineno"></span><span class="keyword" id="2885857">func</span>&nbsp;<span class="op" id="2885862">(</span><span class="ident" id="2885863">s</span>&nbsp;<span class="op" id="2885865">*</span><span class="ident" id="2885866">FileSet</span><span class="op" id="2885873">)</span>&nbsp;<span class="ident" id="2885875">File</span><span class="op" id="2885879">(</span><span class="ident" id="2885880">p</span>&nbsp;<span class="ident" id="2885882">Pos</span><span class="op" id="2885885">)</span>&nbsp;<span class="op" id="2885887">(</span><span class="ident" id="2885888">f</span>&nbsp;<span class="op" id="2885890">*</span><span class="ident" id="2885891">File</span><span class="op" id="2885895">)</span>&nbsp;<span class="op" id="2885897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885900">if</span>&nbsp;<span class="ident" id="2885903">p</span>&nbsp;<span class="op" id="2885905">!=</span>&nbsp;<span class="ident" id="2885908">NoPos</span>&nbsp;<span class="op" id="2885914">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885918">f</span>&nbsp;<span class="op" id="2885920">=</span>&nbsp;<span class="ident" id="2885922">s</span><span class="op" id="2885923">.</span><span class="ident" id="2885924">file</span><span class="op" id="2885928">(</span><span class="ident" id="2885929">p</span><span class="op" id="2885930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2885933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885936">return</span><br>
<span class="lineno"></span><span class="op" id="2885943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="2885946">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="2886016">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="2886089">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="2886147">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="2886187">//</span><br>
<span class="lineno">445</span><span class="keyword" id="2886190">func</span>&nbsp;<span class="op" id="2886195">(</span><span class="ident" id="2886196">s</span>&nbsp;<span class="op" id="2886198">*</span><span class="ident" id="2886199">FileSet</span><span class="op" id="2886206">)</span>&nbsp;<span class="ident" id="2886208">PositionFor</span><span class="op" id="2886219">(</span><span class="ident" id="2886220">p</span>&nbsp;<span class="ident" id="2886222">Pos</span><span class="op" id="2886225">,</span>&nbsp;<span class="ident" id="2886227">adjusted</span>&nbsp;<span class="builtintype" id="2886236">bool</span><span class="op" id="2886240">)</span>&nbsp;<span class="op" id="2886242">(</span><span class="ident" id="2886243">pos</span>&nbsp;<span class="ident" id="2886247">Position</span><span class="op" id="2886255">)</span>&nbsp;<span class="op" id="2886257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886260">if</span>&nbsp;<span class="ident" id="2886263">p</span>&nbsp;<span class="op" id="2886265">!=</span>&nbsp;<span class="ident" id="2886268">NoPos</span>&nbsp;<span class="op" id="2886274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886278">if</span>&nbsp;<span class="ident" id="2886281">f</span>&nbsp;<span class="op" id="2886283">:=</span>&nbsp;<span class="ident" id="2886286">s</span><span class="op" id="2886287">.</span><span class="ident" id="2886288">file</span><span class="op" id="2886292">(</span><span class="ident" id="2886293">p</span><span class="op" id="2886294">)</span><span class="op" id="2886295">;</span>&nbsp;<span class="ident" id="2886297">f</span>&nbsp;<span class="op" id="2886299">!=</span>&nbsp;<span class="ident" id="2886302">nil</span>&nbsp;<span class="op" id="2886306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886311">pos</span>&nbsp;<span class="op" id="2886315">=</span>&nbsp;<span class="ident" id="2886317">f</span><span class="op" id="2886318">.</span><span class="ident" id="2886319">position</span><span class="op" id="2886327">(</span><span class="ident" id="2886328">p</span><span class="op" id="2886329">,</span>&nbsp;<span class="ident" id="2886331">adjusted</span><span class="op" id="2886339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2886343">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2886346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886349">return</span><br>
<span class="lineno"></span><span class="op" id="2886356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2886359">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="2886426">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="2886500">//</span><br>
<span class="lineno"></span><span class="keyword" id="2886503">func</span>&nbsp;<span class="op" id="2886508">(</span><span class="ident" id="2886509">s</span>&nbsp;<span class="op" id="2886511">*</span><span class="ident" id="2886512">FileSet</span><span class="op" id="2886519">)</span>&nbsp;<span class="ident" id="2886521">Position</span><span class="op" id="2886529">(</span><span class="ident" id="2886530">p</span>&nbsp;<span class="ident" id="2886532">Pos</span><span class="op" id="2886535">)</span>&nbsp;<span class="op" id="2886537">(</span><span class="ident" id="2886538">pos</span>&nbsp;<span class="ident" id="2886542">Position</span><span class="op" id="2886550">)</span>&nbsp;<span class="op" id="2886552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886555">return</span>&nbsp;<span class="ident" id="2886562">s</span><span class="op" id="2886563">.</span><span class="ident" id="2886564">PositionFor</span><span class="op" id="2886575">(</span><span class="ident" id="2886576">p</span><span class="op" id="2886577">,</span>&nbsp;<span class="builtintype" id="2886579">true</span><span class="op" id="2886583">)</span><br>
<span class="lineno"></span><span class="op" id="2886585">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="2886588">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2886669">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2886690">func</span>&nbsp;<span class="ident" id="2886695">searchInts</span><span class="op" id="2886705">(</span><span class="ident" id="2886706">a</span>&nbsp;<span class="op" id="2886708">[</span><span class="op" id="2886709">]</span><span class="builtintype" id="2886710">int</span><span class="op" id="2886713">,</span>&nbsp;<span class="ident" id="2886715">x</span>&nbsp;<span class="builtintype" id="2886717">int</span><span class="op" id="2886720">)</span>&nbsp;<span class="builtintype" id="2886722">int</span>&nbsp;<span class="op" id="2886726">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2886729">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2886786">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2886790">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2886865">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2886869">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2886939">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2887005">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2887072">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2887131">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887189">i</span><span class="op" id="2887190">,</span>&nbsp;<span class="ident" id="2887192">j</span>&nbsp;<span class="op" id="2887194">:=</span>&nbsp;<span class="num" id="2887197">0</span><span class="op" id="2887198">,</span>&nbsp;<span class="builtinfunc" id="2887200">len</span><span class="op" id="2887203">(</span><span class="ident" id="2887204">a</span><span class="op" id="2887205">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887208">for</span>&nbsp;<span class="ident" id="2887212">i</span>&nbsp;<span class="op" id="2887214">&lt;</span>&nbsp;<span class="ident" id="2887216">j</span>&nbsp;<span class="op" id="2887218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887222">h</span>&nbsp;<span class="op" id="2887224">:=</span>&nbsp;<span class="ident" id="2887227">i</span>&nbsp;<span class="op" id="2887229">+</span>&nbsp;<span class="op" id="2887231">(</span><span class="ident" id="2887232">j</span><span class="op" id="2887233">-</span><span class="ident" id="2887234">i</span><span class="op" id="2887235">)</span><span class="op" id="2887236">/</span><span class="num" id="2887237">2</span>&nbsp;<span class="comment" id="2887239">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2887276">//&nbsp;i&nbsp;≤&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887293">if</span>&nbsp;<span class="ident" id="2887296">a</span><span class="op" id="2887297">[</span><span class="ident" id="2887298">h</span><span class="op" id="2887299">]</span>&nbsp;<span class="op" id="2887301">&lt;=</span>&nbsp;<span class="ident" id="2887304">x</span>&nbsp;<span class="op" id="2887306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887311">i</span>&nbsp;<span class="op" id="2887313">=</span>&nbsp;<span class="ident" id="2887315">h</span>&nbsp;<span class="op" id="2887317">+</span>&nbsp;<span class="num" id="2887319">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887323">}</span>&nbsp;<span class="keyword" id="2887325">else</span>&nbsp;<span class="op" id="2887330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887335">j</span>&nbsp;<span class="op" id="2887337">=</span>&nbsp;<span class="ident" id="2887339">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887349">return</span>&nbsp;<span class="ident" id="2887356">i</span>&nbsp;<span class="op" id="2887358">-</span>&nbsp;<span class="num" id="2887360">1</span><br>
<span class="lineno">485</span><span class="op" id="2887362">}</span>
</div>
</body>
</html>
