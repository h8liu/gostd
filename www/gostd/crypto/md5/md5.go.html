<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/md5</h2>
<ul>
<li><a href="/gostd/crypto/md5/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/md5/md5.go.html" class="current">md5.go</a></li>
<li><a href="/gostd/crypto/md5/md5_test.go.html">md5_test.go</a></li>
<li><a href="/gostd/crypto/md5/md5block.go.html">md5block.go</a></li>
<li><a href="/gostd/crypto/md5/md5block_decl.go.html">md5block_decl.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4775329">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4775384">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4775438">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4775489">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-full&nbsp;-output&nbsp;md5block.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4775544">//&nbsp;Package&nbsp;md5&nbsp;implements&nbsp;the&nbsp;MD5&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;1321.</span><br>
<span class="lineno"></span><span class="keyword" id="4775617">package</span>&nbsp;<span class="ident" id="4775625">md5</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4775630">import</span>&nbsp;<span class="op" id="4775637">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4775640">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4775650">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4775657">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4775660">func</span>&nbsp;<span class="ident" id="4775665">init</span><span class="op" id="4775669">(</span><span class="op" id="4775670">)</span>&nbsp;<span class="op" id="4775672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775675">crypto</span><span class="op" id="4775681">.</span><span class="ident" id="4775682">RegisterHash</span><span class="op" id="4775694">(</span><span class="ident" id="4775695">crypto</span><span class="op" id="4775701">.</span><span class="ident" id="4775702">MD5</span><span class="op" id="4775705">,</span>&nbsp;<span class="ident" id="4775707">New</span><span class="op" id="4775710">)</span><br>
<span class="lineno"></span><span class="op" id="4775712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4775715">//&nbsp;The&nbsp;size&nbsp;of&nbsp;an&nbsp;MD5&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno">20</span><span class="keyword" id="4775756">const</span>&nbsp;<span class="ident" id="4775762">Size</span>&nbsp;<span class="op" id="4775767">=</span>&nbsp;<span class="num" id="4775769">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4775773">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;MD5&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4775807">const</span>&nbsp;<span class="ident" id="4775813">BlockSize</span>&nbsp;<span class="op" id="4775823">=</span>&nbsp;<span class="num" id="4775825">64</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="4775829">const</span>&nbsp;<span class="op" id="4775835">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775838">chunk</span>&nbsp;<span class="op" id="4775844">=</span>&nbsp;<span class="num" id="4775846">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775850">init0</span>&nbsp;<span class="op" id="4775856">=</span>&nbsp;<span class="num" id="4775858">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775870">init1</span>&nbsp;<span class="op" id="4775876">=</span>&nbsp;<span class="num" id="4775878">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775890">init2</span>&nbsp;<span class="op" id="4775896">=</span>&nbsp;<span class="num" id="4775898">0x98BADCFE</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4775910">init3</span>&nbsp;<span class="op" id="4775916">=</span>&nbsp;<span class="num" id="4775918">0x10325476</span><br>
<span class="lineno"></span><span class="op" id="4775929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4775932">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4775991">type</span>&nbsp;<span class="ident" id="4775996">digest</span>&nbsp;<span class="keyword" id="4776003">struct</span>&nbsp;<span class="op" id="4776010">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776013">s</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4776017">[</span><span class="num" id="4776018">4</span><span class="op" id="4776019">]</span><span class="builtintype" id="4776020">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776028">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4776032">[</span><span class="ident" id="4776033">chunk</span><span class="op" id="4776038">]</span><span class="builtintype" id="4776039">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776045">nx</span>&nbsp;&nbsp;<span class="builtintype" id="4776049">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4776054">len</span>&nbsp;<span class="ident" id="4776058">uint64</span><br>
<span class="lineno"></span><span class="op" id="4776065">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="4776068">func</span>&nbsp;<span class="op" id="4776073">(</span><span class="ident" id="4776074">d</span>&nbsp;<span class="op" id="4776076">*</span><span class="ident" id="4776077">digest</span><span class="op" id="4776083">)</span>&nbsp;<span class="ident" id="4776085">Reset</span><span class="op" id="4776090">(</span><span class="op" id="4776091">)</span>&nbsp;<span class="op" id="4776093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776096">d</span><span class="op" id="4776097">.</span><span class="ident" id="4776098">s</span><span class="op" id="4776099">[</span><span class="num" id="4776100">0</span><span class="op" id="4776101">]</span>&nbsp;<span class="op" id="4776103">=</span>&nbsp;<span class="ident" id="4776105">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776112">d</span><span class="op" id="4776113">.</span><span class="ident" id="4776114">s</span><span class="op" id="4776115">[</span><span class="num" id="4776116">1</span><span class="op" id="4776117">]</span>&nbsp;<span class="op" id="4776119">=</span>&nbsp;<span class="ident" id="4776121">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776128">d</span><span class="op" id="4776129">.</span><span class="ident" id="4776130">s</span><span class="op" id="4776131">[</span><span class="num" id="4776132">2</span><span class="op" id="4776133">]</span>&nbsp;<span class="op" id="4776135">=</span>&nbsp;<span class="ident" id="4776137">init2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776144">d</span><span class="op" id="4776145">.</span><span class="ident" id="4776146">s</span><span class="op" id="4776147">[</span><span class="num" id="4776148">3</span><span class="op" id="4776149">]</span>&nbsp;<span class="op" id="4776151">=</span>&nbsp;<span class="ident" id="4776153">init3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776160">d</span><span class="op" id="4776161">.</span><span class="ident" id="4776162">nx</span>&nbsp;<span class="op" id="4776165">=</span>&nbsp;<span class="num" id="4776167">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776170">d</span><span class="op" id="4776171">.</span><span class="builtinfunc" id="4776172">len</span>&nbsp;<span class="op" id="4776176">=</span>&nbsp;<span class="num" id="4776178">0</span><br>
<span class="lineno"></span><span class="op" id="4776180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4776183">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;MD5&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4776242">func</span>&nbsp;<span class="ident" id="4776247">New</span><span class="op" id="4776250">(</span><span class="op" id="4776251">)</span>&nbsp;<span class="ident" id="4776253">hash</span><span class="op" id="4776257">.</span><span class="ident" id="4776258">Hash</span>&nbsp;<span class="op" id="4776263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776266">d</span>&nbsp;<span class="op" id="4776268">:=</span>&nbsp;<span class="builtinfunc" id="4776271">new</span><span class="op" id="4776274">(</span><span class="ident" id="4776275">digest</span><span class="op" id="4776281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776284">d</span><span class="op" id="4776285">.</span><span class="ident" id="4776286">Reset</span><span class="op" id="4776291">(</span><span class="op" id="4776292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776295">return</span>&nbsp;<span class="ident" id="4776302">d</span><br>
<span class="lineno">55</span><span class="op" id="4776304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4776307">func</span>&nbsp;<span class="op" id="4776312">(</span><span class="ident" id="4776313">d</span>&nbsp;<span class="op" id="4776315">*</span><span class="ident" id="4776316">digest</span><span class="op" id="4776322">)</span>&nbsp;<span class="ident" id="4776324">Size</span><span class="op" id="4776328">(</span><span class="op" id="4776329">)</span>&nbsp;<span class="builtintype" id="4776331">int</span>&nbsp;<span class="op" id="4776335">{</span>&nbsp;<span class="keyword" id="4776337">return</span>&nbsp;<span class="ident" id="4776344">Size</span>&nbsp;<span class="op" id="4776349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4776352">func</span>&nbsp;<span class="op" id="4776357">(</span><span class="ident" id="4776358">d</span>&nbsp;<span class="op" id="4776360">*</span><span class="ident" id="4776361">digest</span><span class="op" id="4776367">)</span>&nbsp;<span class="ident" id="4776369">BlockSize</span><span class="op" id="4776378">(</span><span class="op" id="4776379">)</span>&nbsp;<span class="builtintype" id="4776381">int</span>&nbsp;<span class="op" id="4776385">{</span>&nbsp;<span class="keyword" id="4776387">return</span>&nbsp;<span class="ident" id="4776394">BlockSize</span>&nbsp;<span class="op" id="4776404">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4776407">func</span>&nbsp;<span class="op" id="4776412">(</span><span class="ident" id="4776413">d</span>&nbsp;<span class="op" id="4776415">*</span><span class="ident" id="4776416">digest</span><span class="op" id="4776422">)</span>&nbsp;<span class="ident" id="4776424">Write</span><span class="op" id="4776429">(</span><span class="ident" id="4776430">p</span>&nbsp;<span class="op" id="4776432">[</span><span class="op" id="4776433">]</span><span class="builtintype" id="4776434">byte</span><span class="op" id="4776438">)</span>&nbsp;<span class="op" id="4776440">(</span><span class="ident" id="4776441">nn</span>&nbsp;<span class="builtintype" id="4776444">int</span><span class="op" id="4776447">,</span>&nbsp;<span class="ident" id="4776449">err</span>&nbsp;<span class="builtintype" id="4776453">error</span><span class="op" id="4776458">)</span>&nbsp;<span class="op" id="4776460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776463">nn</span>&nbsp;<span class="op" id="4776466">=</span>&nbsp;<span class="builtinfunc" id="4776468">len</span><span class="op" id="4776471">(</span><span class="ident" id="4776472">p</span><span class="op" id="4776473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776476">d</span><span class="op" id="4776477">.</span><span class="builtinfunc" id="4776478">len</span>&nbsp;<span class="op" id="4776482">+=</span>&nbsp;<span class="ident" id="4776485">uint64</span><span class="op" id="4776491">(</span><span class="ident" id="4776492">nn</span><span class="op" id="4776494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776497">if</span>&nbsp;<span class="ident" id="4776500">d</span><span class="op" id="4776501">.</span><span class="ident" id="4776502">nx</span>&nbsp;<span class="op" id="4776505">&gt;</span>&nbsp;<span class="num" id="4776507">0</span>&nbsp;<span class="op" id="4776509">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776513">n</span>&nbsp;<span class="op" id="4776515">:=</span>&nbsp;<span class="builtinfunc" id="4776518">len</span><span class="op" id="4776521">(</span><span class="ident" id="4776522">p</span><span class="op" id="4776523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776527">if</span>&nbsp;<span class="ident" id="4776530">n</span>&nbsp;<span class="op" id="4776532">&gt;</span>&nbsp;<span class="ident" id="4776534">chunk</span><span class="op" id="4776539">-</span><span class="ident" id="4776540">d</span><span class="op" id="4776541">.</span><span class="ident" id="4776542">nx</span>&nbsp;<span class="op" id="4776545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776550">n</span>&nbsp;<span class="op" id="4776552">=</span>&nbsp;<span class="ident" id="4776554">chunk</span>&nbsp;<span class="op" id="4776560">-</span>&nbsp;<span class="ident" id="4776562">d</span><span class="op" id="4776563">.</span><span class="ident" id="4776564">nx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4776569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776573">for</span>&nbsp;<span class="ident" id="4776577">i</span>&nbsp;<span class="op" id="4776579">:=</span>&nbsp;<span class="num" id="4776582">0</span><span class="op" id="4776583">;</span>&nbsp;<span class="ident" id="4776585">i</span>&nbsp;<span class="op" id="4776587">&lt;</span>&nbsp;<span class="ident" id="4776589">n</span><span class="op" id="4776590">;</span>&nbsp;<span class="ident" id="4776592">i</span><span class="op" id="4776593">++</span>&nbsp;<span class="op" id="4776596">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776601">d</span><span class="op" id="4776602">.</span><span class="ident" id="4776603">x</span><span class="op" id="4776604">[</span><span class="ident" id="4776605">d</span><span class="op" id="4776606">.</span><span class="ident" id="4776607">nx</span><span class="op" id="4776609">+</span><span class="ident" id="4776610">i</span><span class="op" id="4776611">]</span>&nbsp;<span class="op" id="4776613">=</span>&nbsp;<span class="ident" id="4776615">p</span><span class="op" id="4776616">[</span><span class="ident" id="4776617">i</span><span class="op" id="4776618">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4776622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776626">d</span><span class="op" id="4776627">.</span><span class="ident" id="4776628">nx</span>&nbsp;<span class="op" id="4776631">+=</span>&nbsp;<span class="ident" id="4776634">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776638">if</span>&nbsp;<span class="ident" id="4776641">d</span><span class="op" id="4776642">.</span><span class="ident" id="4776643">nx</span>&nbsp;<span class="op" id="4776646">==</span>&nbsp;<span class="ident" id="4776649">chunk</span>&nbsp;<span class="op" id="4776655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776660">block</span><span class="op" id="4776665">(</span><span class="ident" id="4776666">d</span><span class="op" id="4776667">,</span>&nbsp;<span class="ident" id="4776669">d</span><span class="op" id="4776670">.</span><span class="ident" id="4776671">x</span><span class="op" id="4776672">[</span><span class="num" id="4776673">0</span><span class="op" id="4776674">:</span><span class="ident" id="4776675">chunk</span><span class="op" id="4776680">]</span><span class="op" id="4776681">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776686">d</span><span class="op" id="4776687">.</span><span class="ident" id="4776688">nx</span>&nbsp;<span class="op" id="4776691">=</span>&nbsp;<span class="num" id="4776693">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4776697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776701">p</span>&nbsp;<span class="op" id="4776703">=</span>&nbsp;<span class="ident" id="4776705">p</span><span class="op" id="4776706">[</span><span class="ident" id="4776707">n</span><span class="op" id="4776708">:</span><span class="op" id="4776709">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4776712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776715">if</span>&nbsp;<span class="builtinfunc" id="4776718">len</span><span class="op" id="4776721">(</span><span class="ident" id="4776722">p</span><span class="op" id="4776723">)</span>&nbsp;<span class="op" id="4776725">&gt;=</span>&nbsp;<span class="ident" id="4776728">chunk</span>&nbsp;<span class="op" id="4776734">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776738">n</span>&nbsp;<span class="op" id="4776740">:=</span>&nbsp;<span class="builtinfunc" id="4776743">len</span><span class="op" id="4776746">(</span><span class="ident" id="4776747">p</span><span class="op" id="4776748">)</span>&nbsp;<span class="op" id="4776750">&amp;^</span>&nbsp;<span class="op" id="4776753">(</span><span class="ident" id="4776754">chunk</span>&nbsp;<span class="op" id="4776760">-</span>&nbsp;<span class="num" id="4776762">1</span><span class="op" id="4776763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776767">block</span><span class="op" id="4776772">(</span><span class="ident" id="4776773">d</span><span class="op" id="4776774">,</span>&nbsp;<span class="ident" id="4776776">p</span><span class="op" id="4776777">[</span><span class="op" id="4776778">:</span><span class="ident" id="4776779">n</span><span class="op" id="4776780">]</span><span class="op" id="4776781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776785">p</span>&nbsp;<span class="op" id="4776787">=</span>&nbsp;<span class="ident" id="4776789">p</span><span class="op" id="4776790">[</span><span class="ident" id="4776791">n</span><span class="op" id="4776792">:</span><span class="op" id="4776793">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4776796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776799">if</span>&nbsp;<span class="builtinfunc" id="4776802">len</span><span class="op" id="4776805">(</span><span class="ident" id="4776806">p</span><span class="op" id="4776807">)</span>&nbsp;<span class="op" id="4776809">&gt;</span>&nbsp;<span class="num" id="4776811">0</span>&nbsp;<span class="op" id="4776813">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776817">d</span><span class="op" id="4776818">.</span><span class="ident" id="4776819">nx</span>&nbsp;<span class="op" id="4776822">=</span>&nbsp;<span class="builtinfunc" id="4776824">copy</span><span class="op" id="4776828">(</span><span class="ident" id="4776829">d</span><span class="op" id="4776830">.</span><span class="ident" id="4776831">x</span><span class="op" id="4776832">[</span><span class="op" id="4776833">:</span><span class="op" id="4776834">]</span><span class="op" id="4776835">,</span>&nbsp;<span class="ident" id="4776837">p</span><span class="op" id="4776838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4776841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776844">return</span><br>
<span class="lineno"></span><span class="op" id="4776851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4776854">func</span>&nbsp;<span class="op" id="4776859">(</span><span class="ident" id="4776860">d0</span>&nbsp;<span class="op" id="4776863">*</span><span class="ident" id="4776864">digest</span><span class="op" id="4776870">)</span>&nbsp;<span class="ident" id="4776872">Sum</span><span class="op" id="4776875">(</span><span class="ident" id="4776876">in</span>&nbsp;<span class="op" id="4776879">[</span><span class="op" id="4776880">]</span><span class="builtintype" id="4776881">byte</span><span class="op" id="4776885">)</span>&nbsp;<span class="op" id="4776887">[</span><span class="op" id="4776888">]</span><span class="builtintype" id="4776889">byte</span>&nbsp;<span class="op" id="4776894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4776897">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776964">d</span>&nbsp;<span class="op" id="4776966">:=</span>&nbsp;<span class="op" id="4776969">*</span><span class="ident" id="4776970">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776974">hash</span>&nbsp;<span class="op" id="4776979">:=</span>&nbsp;<span class="ident" id="4776982">d</span><span class="op" id="4776983">.</span><span class="ident" id="4776984">checkSum</span><span class="op" id="4776992">(</span><span class="op" id="4776993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4776996">return</span>&nbsp;<span class="builtinfunc" id="4777003">append</span><span class="op" id="4777009">(</span><span class="ident" id="4777010">in</span><span class="op" id="4777012">,</span>&nbsp;<span class="ident" id="4777014">hash</span><span class="op" id="4777018">[</span><span class="op" id="4777019">:</span><span class="op" id="4777020">]</span><span class="op" id="4777021">...</span><span class="op" id="4777024">)</span><br>
<span class="lineno">95</span><span class="op" id="4777026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4777029">func</span>&nbsp;<span class="op" id="4777034">(</span><span class="ident" id="4777035">d</span>&nbsp;<span class="op" id="4777037">*</span><span class="ident" id="4777038">digest</span><span class="op" id="4777044">)</span>&nbsp;<span class="ident" id="4777046">checkSum</span><span class="op" id="4777054">(</span><span class="op" id="4777055">)</span>&nbsp;<span class="op" id="4777057">[</span><span class="ident" id="4777058">Size</span><span class="op" id="4777062">]</span><span class="builtintype" id="4777063">byte</span>&nbsp;<span class="op" id="4777068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4777071">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4777131">len</span>&nbsp;<span class="op" id="4777135">:=</span>&nbsp;<span class="ident" id="4777138">d</span><span class="op" id="4777139">.</span><span class="builtinfunc" id="4777140">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777145">var</span>&nbsp;<span class="ident" id="4777149">tmp</span>&nbsp;<span class="op" id="4777153">[</span><span class="num" id="4777154">64</span><span class="op" id="4777156">]</span><span class="builtintype" id="4777157">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777163">tmp</span><span class="op" id="4777166">[</span><span class="num" id="4777167">0</span><span class="op" id="4777168">]</span>&nbsp;<span class="op" id="4777170">=</span>&nbsp;<span class="num" id="4777172">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777178">if</span>&nbsp;<span class="builtinfunc" id="4777181">len</span><span class="op" id="4777184">%</span><span class="num" id="4777185">64</span>&nbsp;<span class="op" id="4777188">&lt;</span>&nbsp;<span class="num" id="4777190">56</span>&nbsp;<span class="op" id="4777193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777197">d</span><span class="op" id="4777198">.</span><span class="ident" id="4777199">Write</span><span class="op" id="4777204">(</span><span class="ident" id="4777205">tmp</span><span class="op" id="4777208">[</span><span class="num" id="4777209">0</span>&nbsp;<span class="op" id="4777211">:</span>&nbsp;<span class="num" id="4777213">56</span><span class="op" id="4777215">-</span><span class="builtinfunc" id="4777216">len</span><span class="op" id="4777219">%</span><span class="num" id="4777220">64</span><span class="op" id="4777222">]</span><span class="op" id="4777223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4777226">}</span>&nbsp;<span class="keyword" id="4777228">else</span>&nbsp;<span class="op" id="4777233">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777237">d</span><span class="op" id="4777238">.</span><span class="ident" id="4777239">Write</span><span class="op" id="4777244">(</span><span class="ident" id="4777245">tmp</span><span class="op" id="4777248">[</span><span class="num" id="4777249">0</span>&nbsp;<span class="op" id="4777251">:</span>&nbsp;<span class="num" id="4777253">64</span><span class="op" id="4777255">+</span><span class="num" id="4777256">56</span><span class="op" id="4777258">-</span><span class="builtinfunc" id="4777259">len</span><span class="op" id="4777262">%</span><span class="num" id="4777263">64</span><span class="op" id="4777265">]</span><span class="op" id="4777266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4777269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4777273">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4777293">len</span>&nbsp;<span class="op" id="4777297">&lt;&lt;=</span>&nbsp;<span class="num" id="4777301">3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777304">for</span>&nbsp;<span class="ident" id="4777308">i</span>&nbsp;<span class="op" id="4777310">:=</span>&nbsp;<span class="builtintype" id="4777313">uint</span><span class="op" id="4777317">(</span><span class="num" id="4777318">0</span><span class="op" id="4777319">)</span><span class="op" id="4777320">;</span>&nbsp;<span class="ident" id="4777322">i</span>&nbsp;<span class="op" id="4777324">&lt;</span>&nbsp;<span class="num" id="4777326">8</span><span class="op" id="4777327">;</span>&nbsp;<span class="ident" id="4777329">i</span><span class="op" id="4777330">++</span>&nbsp;<span class="op" id="4777333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777337">tmp</span><span class="op" id="4777340">[</span><span class="ident" id="4777341">i</span><span class="op" id="4777342">]</span>&nbsp;<span class="op" id="4777344">=</span>&nbsp;<span class="builtintype" id="4777346">byte</span><span class="op" id="4777350">(</span><span class="builtinfunc" id="4777351">len</span>&nbsp;<span class="op" id="4777355">&gt;&gt;</span>&nbsp;<span class="op" id="4777358">(</span><span class="num" id="4777359">8</span>&nbsp;<span class="op" id="4777361">*</span>&nbsp;<span class="ident" id="4777363">i</span><span class="op" id="4777364">)</span><span class="op" id="4777365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4777368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777371">d</span><span class="op" id="4777372">.</span><span class="ident" id="4777373">Write</span><span class="op" id="4777378">(</span><span class="ident" id="4777379">tmp</span><span class="op" id="4777382">[</span><span class="num" id="4777383">0</span><span class="op" id="4777384">:</span><span class="num" id="4777385">8</span><span class="op" id="4777386">]</span><span class="op" id="4777387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777391">if</span>&nbsp;<span class="ident" id="4777394">d</span><span class="op" id="4777395">.</span><span class="ident" id="4777396">nx</span>&nbsp;<span class="op" id="4777399">!=</span>&nbsp;<span class="num" id="4777402">0</span>&nbsp;<span class="op" id="4777404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4777408">panic</span><span class="op" id="4777413">(</span><span class="string" id="4777414">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="4777425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4777428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777432">var</span>&nbsp;<span class="ident" id="4777436">digest</span>&nbsp;<span class="op" id="4777443">[</span><span class="ident" id="4777444">Size</span><span class="op" id="4777448">]</span><span class="builtintype" id="4777449">byte</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777455">for</span>&nbsp;<span class="ident" id="4777459">i</span><span class="op" id="4777460">,</span>&nbsp;<span class="ident" id="4777462">s</span>&nbsp;<span class="op" id="4777464">:=</span>&nbsp;<span class="keyword" id="4777467">range</span>&nbsp;<span class="ident" id="4777473">d</span><span class="op" id="4777474">.</span><span class="ident" id="4777475">s</span>&nbsp;<span class="op" id="4777477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777481">digest</span><span class="op" id="4777487">[</span><span class="ident" id="4777488">i</span><span class="op" id="4777489">*</span><span class="num" id="4777490">4</span><span class="op" id="4777491">]</span>&nbsp;<span class="op" id="4777493">=</span>&nbsp;<span class="builtintype" id="4777495">byte</span><span class="op" id="4777499">(</span><span class="ident" id="4777500">s</span><span class="op" id="4777501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777505">digest</span><span class="op" id="4777511">[</span><span class="ident" id="4777512">i</span><span class="op" id="4777513">*</span><span class="num" id="4777514">4</span><span class="op" id="4777515">+</span><span class="num" id="4777516">1</span><span class="op" id="4777517">]</span>&nbsp;<span class="op" id="4777519">=</span>&nbsp;<span class="builtintype" id="4777521">byte</span><span class="op" id="4777525">(</span><span class="ident" id="4777526">s</span>&nbsp;<span class="op" id="4777528">&gt;&gt;</span>&nbsp;<span class="num" id="4777531">8</span><span class="op" id="4777532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777536">digest</span><span class="op" id="4777542">[</span><span class="ident" id="4777543">i</span><span class="op" id="4777544">*</span><span class="num" id="4777545">4</span><span class="op" id="4777546">+</span><span class="num" id="4777547">2</span><span class="op" id="4777548">]</span>&nbsp;<span class="op" id="4777550">=</span>&nbsp;<span class="builtintype" id="4777552">byte</span><span class="op" id="4777556">(</span><span class="ident" id="4777557">s</span>&nbsp;<span class="op" id="4777559">&gt;&gt;</span>&nbsp;<span class="num" id="4777562">16</span><span class="op" id="4777564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777568">digest</span><span class="op" id="4777574">[</span><span class="ident" id="4777575">i</span><span class="op" id="4777576">*</span><span class="num" id="4777577">4</span><span class="op" id="4777578">+</span><span class="num" id="4777579">3</span><span class="op" id="4777580">]</span>&nbsp;<span class="op" id="4777582">=</span>&nbsp;<span class="builtintype" id="4777584">byte</span><span class="op" id="4777588">(</span><span class="ident" id="4777589">s</span>&nbsp;<span class="op" id="4777591">&gt;&gt;</span>&nbsp;<span class="num" id="4777594">24</span><span class="op" id="4777596">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4777599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777603">return</span>&nbsp;<span class="ident" id="4777610">digest</span><br>
<span class="lineno"></span><span class="op" id="4777617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="4777620">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;MD5&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4777665">func</span>&nbsp;<span class="ident" id="4777670">Sum</span><span class="op" id="4777673">(</span><span class="ident" id="4777674">data</span>&nbsp;<span class="op" id="4777679">[</span><span class="op" id="4777680">]</span><span class="builtintype" id="4777681">byte</span><span class="op" id="4777685">)</span>&nbsp;<span class="op" id="4777687">[</span><span class="ident" id="4777688">Size</span><span class="op" id="4777692">]</span><span class="builtintype" id="4777693">byte</span>&nbsp;<span class="op" id="4777698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777701">var</span>&nbsp;<span class="ident" id="4777705">d</span>&nbsp;<span class="ident" id="4777707">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777715">d</span><span class="op" id="4777716">.</span><span class="ident" id="4777717">Reset</span><span class="op" id="4777722">(</span><span class="op" id="4777723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777726">d</span><span class="op" id="4777727">.</span><span class="ident" id="4777728">Write</span><span class="op" id="4777733">(</span><span class="ident" id="4777734">data</span><span class="op" id="4777738">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777741">return</span>&nbsp;<span class="ident" id="4777748">d</span><span class="op" id="4777749">.</span><span class="ident" id="4777750">checkSum</span><span class="op" id="4777758">(</span><span class="op" id="4777759">)</span><br>
<span class="lineno"></span><span class="op" id="4777761">}</span>
</div>
</body>
</html>
