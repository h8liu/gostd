<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html" class="current">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7637936">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7637991">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7638045">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7638096">package</span>&nbsp;<span class="ident" id="7638104">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7638109">import</span>&nbsp;<span class="op" id="7638116">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7638119">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7638126">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7638132">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7638145">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7638156">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7638167">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7638174">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7638177">func</span>&nbsp;<span class="ident" id="7638182">isTimeout</span><span class="op" id="7638191">(</span><span class="ident" id="7638192">err</span>&nbsp;<span class="builtintype" id="7638196">error</span><span class="op" id="7638201">)</span>&nbsp;<span class="builtintype" id="7638203">bool</span>&nbsp;<span class="op" id="7638208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7638211">e</span><span class="op" id="7638212">,</span>&nbsp;<span class="ident" id="7638214">ok</span>&nbsp;<span class="op" id="7638217">:=</span>&nbsp;<span class="ident" id="7638220">err</span><span class="op" id="7638223">.</span><span class="op" id="7638224">(</span><span class="ident" id="7638225">Error</span><span class="op" id="7638230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7638233">return</span>&nbsp;<span class="ident" id="7638240">ok</span>&nbsp;<span class="op" id="7638243">&amp;&amp;</span>&nbsp;<span class="ident" id="7638246">e</span><span class="op" id="7638247">.</span><span class="ident" id="7638248">Timeout</span><span class="op" id="7638255">(</span><span class="op" id="7638256">)</span><br>
<span class="lineno"></span><span class="op" id="7638258">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7638261">type</span>&nbsp;<span class="ident" id="7638266">copyRes</span>&nbsp;<span class="keyword" id="7638274">struct</span>&nbsp;<span class="op" id="7638281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7638284">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7638288">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7638295">err</span>&nbsp;<span class="builtintype" id="7638299">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7638306">d</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7638310">time</span><span class="op" id="7638314">.</span><span class="ident" id="7638315">Duration</span><br>
<span class="lineno">25</span><span class="op" id="7638324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7638327">func</span>&nbsp;<span class="ident" id="7638332">TestAcceptTimeout</span><span class="op" id="7638349">(</span><span class="ident" id="7638350">t</span>&nbsp;<span class="op" id="7638352">*</span><span class="ident" id="7638353">testing</span><span class="op" id="7638360">.</span><span class="ident" id="7638361">T</span><span class="op" id="7638362">)</span>&nbsp;<span class="op" id="7638364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7638367">switch</span>&nbsp;<span class="ident" id="7638374">runtime</span><span class="op" id="7638381">.</span><span class="ident" id="7638382">GOOS</span>&nbsp;<span class="op" id="7638387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7638390">case</span>&nbsp;<span class="string" id="7638395">&#34;plan9&#34;</span><span class="op" id="7638402">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7638406">t</span><span class="op" id="7638407">.</span><span class="ident" id="7638408">Skipf</span><span class="op" id="7638413">(</span><span class="string" id="7638414">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7638435">,</span>&nbsp;<span class="ident" id="7638437">runtime</span><span class="op" id="7638444">.</span><span class="ident" id="7638445">GOOS</span><span class="op" id="7638449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7638452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7638456">ln</span>&nbsp;<span class="op" id="7638459">:=</span>&nbsp;<span class="ident" id="7638462">newLocalListener</span><span class="op" id="7638478">(</span><span class="ident" id="7638479">t</span><span class="op" id="7638480">)</span><span class="op" id="7638481">.</span><span class="op" id="7638482">(</span><span class="op" id="7638483">*</span><span class="ident" id="7638484">TCPListener</span><span class="op" id="7638495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7638498">defer</span>&nbsp;<span class="ident" id="7638504">ln</span><span class="op" id="7638506">.</span><span class="ident" id="7638507">Close</span><span class="op" id="7638512">(</span><span class="op" id="7638513">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7638516">ln</span><span class="op" id="7638518">.</span><span class="ident" id="7638519">SetDeadline</span><span class="op" id="7638530">(</span><span class="ident" id="7638531">time</span><span class="op" id="7638535">.</span><span class="ident" id="7638536">Now</span><span class="op" id="7638539">(</span><span class="op" id="7638540">)</span><span class="op" id="7638541">.</span><span class="ident" id="7638542">Add</span><span class="op" id="7638545">(</span><span class="op" id="7638546">-</span><span class="num" id="7638547">1</span>&nbsp;<span class="op" id="7638549">*</span>&nbsp;<span class="ident" id="7638551">time</span><span class="op" id="7638555">.</span><span class="ident" id="7638556">Second</span><span class="op" id="7638562">)</span><span class="op" id="7638563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7638566">if</span>&nbsp;<span class="ident" id="7638569">_</span><span class="op" id="7638570">,</span>&nbsp;<span class="ident" id="7638572">err</span>&nbsp;<span class="op" id="7638576">:=</span>&nbsp;<span class="ident" id="7638579">ln</span><span class="op" id="7638581">.</span><span class="ident" id="7638582">Accept</span><span class="op" id="7638588">(</span><span class="op" id="7638589">)</span><span class="op" id="7638590">;</span>&nbsp;<span class="op" id="7638592">!</span><span class="ident" id="7638593">isTimeout</span><span class="op" id="7638602">(</span><span class="ident" id="7638603">err</span><span class="op" id="7638606">)</span>&nbsp;<span class="op" id="7638608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7638612">t</span><span class="op" id="7638613">.</span><span class="ident" id="7638614">Fatalf</span><span class="op" id="7638620">(</span><span class="string" id="7638621">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7638654">,</span>&nbsp;<span class="ident" id="7638656">errTimeout</span><span class="op" id="7638666">,</span>&nbsp;<span class="ident" id="7638668">err</span><span class="op" id="7638671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7638674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7638677">if</span>&nbsp;<span class="ident" id="7638680">_</span><span class="op" id="7638681">,</span>&nbsp;<span class="ident" id="7638683">err</span>&nbsp;<span class="op" id="7638687">:=</span>&nbsp;<span class="ident" id="7638690">ln</span><span class="op" id="7638692">.</span><span class="ident" id="7638693">Accept</span><span class="op" id="7638699">(</span><span class="op" id="7638700">)</span><span class="op" id="7638701">;</span>&nbsp;<span class="op" id="7638703">!</span><span class="ident" id="7638704">isTimeout</span><span class="op" id="7638713">(</span><span class="ident" id="7638714">err</span><span class="op" id="7638717">)</span>&nbsp;<span class="op" id="7638719">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7638723">t</span><span class="op" id="7638724">.</span><span class="ident" id="7638725">Fatalf</span><span class="op" id="7638731">(</span><span class="string" id="7638732">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7638765">,</span>&nbsp;<span class="ident" id="7638767">errTimeout</span><span class="op" id="7638777">,</span>&nbsp;<span class="ident" id="7638779">err</span><span class="op" id="7638782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7638785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7638788">ln</span><span class="op" id="7638790">.</span><span class="ident" id="7638791">SetDeadline</span><span class="op" id="7638802">(</span><span class="ident" id="7638803">time</span><span class="op" id="7638807">.</span><span class="ident" id="7638808">Now</span><span class="op" id="7638811">(</span><span class="op" id="7638812">)</span><span class="op" id="7638813">.</span><span class="ident" id="7638814">Add</span><span class="op" id="7638817">(</span><span class="num" id="7638818">100</span>&nbsp;<span class="op" id="7638822">*</span>&nbsp;<span class="ident" id="7638824">time</span><span class="op" id="7638828">.</span><span class="ident" id="7638829">Millisecond</span><span class="op" id="7638840">)</span><span class="op" id="7638841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7638844">if</span>&nbsp;<span class="ident" id="7638847">_</span><span class="op" id="7638848">,</span>&nbsp;<span class="ident" id="7638850">err</span>&nbsp;<span class="op" id="7638854">:=</span>&nbsp;<span class="ident" id="7638857">ln</span><span class="op" id="7638859">.</span><span class="ident" id="7638860">Accept</span><span class="op" id="7638866">(</span><span class="op" id="7638867">)</span><span class="op" id="7638868">;</span>&nbsp;<span class="op" id="7638870">!</span><span class="ident" id="7638871">isTimeout</span><span class="op" id="7638880">(</span><span class="ident" id="7638881">err</span><span class="op" id="7638884">)</span>&nbsp;<span class="op" id="7638886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7638890">t</span><span class="op" id="7638891">.</span><span class="ident" id="7638892">Fatalf</span><span class="op" id="7638898">(</span><span class="string" id="7638899">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7638932">,</span>&nbsp;<span class="ident" id="7638934">errTimeout</span><span class="op" id="7638944">,</span>&nbsp;<span class="ident" id="7638946">err</span><span class="op" id="7638949">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7638952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7638955">if</span>&nbsp;<span class="ident" id="7638958">_</span><span class="op" id="7638959">,</span>&nbsp;<span class="ident" id="7638961">err</span>&nbsp;<span class="op" id="7638965">:=</span>&nbsp;<span class="ident" id="7638968">ln</span><span class="op" id="7638970">.</span><span class="ident" id="7638971">Accept</span><span class="op" id="7638977">(</span><span class="op" id="7638978">)</span><span class="op" id="7638979">;</span>&nbsp;<span class="op" id="7638981">!</span><span class="ident" id="7638982">isTimeout</span><span class="op" id="7638991">(</span><span class="ident" id="7638992">err</span><span class="op" id="7638995">)</span>&nbsp;<span class="op" id="7638997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639001">t</span><span class="op" id="7639002">.</span><span class="ident" id="7639003">Fatalf</span><span class="op" id="7639009">(</span><span class="string" id="7639010">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7639043">,</span>&nbsp;<span class="ident" id="7639045">errTimeout</span><span class="op" id="7639055">,</span>&nbsp;<span class="ident" id="7639057">err</span><span class="op" id="7639060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639066">ln</span><span class="op" id="7639068">.</span><span class="ident" id="7639069">SetDeadline</span><span class="op" id="7639080">(</span><span class="ident" id="7639081">noDeadline</span><span class="op" id="7639091">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639094">errc</span>&nbsp;<span class="op" id="7639099">:=</span>&nbsp;<span class="builtinfunc" id="7639102">make</span><span class="op" id="7639106">(</span><span class="keyword" id="7639107">chan</span>&nbsp;<span class="builtintype" id="7639112">error</span><span class="op" id="7639117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639120">go</span>&nbsp;<span class="keyword" id="7639123">func</span><span class="op" id="7639127">(</span><span class="op" id="7639128">)</span>&nbsp;<span class="op" id="7639130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639134">_</span><span class="op" id="7639135">,</span>&nbsp;<span class="ident" id="7639137">err</span>&nbsp;<span class="op" id="7639141">:=</span>&nbsp;<span class="ident" id="7639144">ln</span><span class="op" id="7639146">.</span><span class="ident" id="7639147">Accept</span><span class="op" id="7639153">(</span><span class="op" id="7639154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639158">errc</span>&nbsp;<span class="op" id="7639163">&lt;-</span>&nbsp;<span class="ident" id="7639166">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639171">}</span><span class="op" id="7639172">(</span><span class="op" id="7639173">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639176">time</span><span class="op" id="7639180">.</span><span class="ident" id="7639181">Sleep</span><span class="op" id="7639186">(</span><span class="num" id="7639187">100</span>&nbsp;<span class="op" id="7639191">*</span>&nbsp;<span class="ident" id="7639193">time</span><span class="op" id="7639197">.</span><span class="ident" id="7639198">Millisecond</span><span class="op" id="7639209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639212">select</span>&nbsp;<span class="op" id="7639219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639222">case</span>&nbsp;<span class="ident" id="7639227">err</span>&nbsp;<span class="op" id="7639231">:=</span>&nbsp;<span class="op" id="7639234">&lt;-</span><span class="ident" id="7639236">errc</span><span class="op" id="7639240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639244">t</span><span class="op" id="7639245">.</span><span class="ident" id="7639246">Fatalf</span><span class="op" id="7639252">(</span><span class="string" id="7639253">&#34;Expected&nbsp;Accept()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="7639313">,</span>&nbsp;<span class="ident" id="7639315">err</span><span class="op" id="7639318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639321">default</span><span class="op" id="7639328">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639334">ln</span><span class="op" id="7639336">.</span><span class="ident" id="7639337">Close</span><span class="op" id="7639342">(</span><span class="op" id="7639343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639346">switch</span>&nbsp;<span class="ident" id="7639353">nerr</span>&nbsp;<span class="op" id="7639358">:=</span>&nbsp;<span class="op" id="7639361">&lt;-</span><span class="ident" id="7639363">errc</span><span class="op" id="7639367">;</span>&nbsp;<span class="ident" id="7639369">err</span>&nbsp;<span class="op" id="7639373">:=</span>&nbsp;<span class="ident" id="7639376">nerr</span><span class="op" id="7639380">.</span><span class="op" id="7639381">(</span><span class="keyword" id="7639382">type</span><span class="op" id="7639386">)</span>&nbsp;<span class="op" id="7639388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639391">case</span>&nbsp;<span class="op" id="7639396">*</span><span class="ident" id="7639397">OpError</span><span class="op" id="7639404">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639408">if</span>&nbsp;<span class="ident" id="7639411">err</span><span class="op" id="7639414">.</span><span class="ident" id="7639415">Err</span>&nbsp;<span class="op" id="7639419">!=</span>&nbsp;<span class="ident" id="7639422">errClosing</span>&nbsp;<span class="op" id="7639433">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639438">t</span><span class="op" id="7639439">.</span><span class="ident" id="7639440">Fatalf</span><span class="op" id="7639446">(</span><span class="string" id="7639447">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7639480">,</span>&nbsp;<span class="ident" id="7639482">errClosing</span><span class="op" id="7639492">,</span>&nbsp;<span class="ident" id="7639494">err</span><span class="op" id="7639497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639504">default</span><span class="op" id="7639511">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639515">if</span>&nbsp;<span class="ident" id="7639518">err</span>&nbsp;<span class="op" id="7639522">!=</span>&nbsp;<span class="ident" id="7639525">errClosing</span>&nbsp;<span class="op" id="7639536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639541">t</span><span class="op" id="7639542">.</span><span class="ident" id="7639543">Fatalf</span><span class="op" id="7639549">(</span><span class="string" id="7639550">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7639583">,</span>&nbsp;<span class="ident" id="7639585">errClosing</span><span class="op" id="7639595">,</span>&nbsp;<span class="ident" id="7639597">err</span><span class="op" id="7639600">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639607">}</span><br>
<span class="lineno"></span><span class="op" id="7639609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7639612">func</span>&nbsp;<span class="ident" id="7639617">TestReadTimeout</span><span class="op" id="7639632">(</span><span class="ident" id="7639633">t</span>&nbsp;<span class="op" id="7639635">*</span><span class="ident" id="7639636">testing</span><span class="op" id="7639643">.</span><span class="ident" id="7639644">T</span><span class="op" id="7639645">)</span>&nbsp;<span class="op" id="7639647">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639650">switch</span>&nbsp;<span class="ident" id="7639657">runtime</span><span class="op" id="7639664">.</span><span class="ident" id="7639665">GOOS</span>&nbsp;<span class="op" id="7639670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639673">case</span>&nbsp;<span class="string" id="7639678">&#34;plan9&#34;</span><span class="op" id="7639685">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639689">t</span><span class="op" id="7639690">.</span><span class="ident" id="7639691">Skipf</span><span class="op" id="7639696">(</span><span class="string" id="7639697">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7639718">,</span>&nbsp;<span class="ident" id="7639720">runtime</span><span class="op" id="7639727">.</span><span class="ident" id="7639728">GOOS</span><span class="op" id="7639732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639739">ln</span>&nbsp;<span class="op" id="7639742">:=</span>&nbsp;<span class="ident" id="7639745">newLocalListener</span><span class="op" id="7639761">(</span><span class="ident" id="7639762">t</span><span class="op" id="7639763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639766">defer</span>&nbsp;<span class="ident" id="7639772">ln</span><span class="op" id="7639774">.</span><span class="ident" id="7639775">Close</span><span class="op" id="7639780">(</span><span class="op" id="7639781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639784">c</span><span class="op" id="7639785">,</span>&nbsp;<span class="ident" id="7639787">err</span>&nbsp;<span class="op" id="7639791">:=</span>&nbsp;<span class="ident" id="7639794">DialTCP</span><span class="op" id="7639801">(</span><span class="string" id="7639802">&#34;tcp&#34;</span><span class="op" id="7639807">,</span>&nbsp;<span class="ident" id="7639809">nil</span><span class="op" id="7639812">,</span>&nbsp;<span class="ident" id="7639814">ln</span><span class="op" id="7639816">.</span><span class="ident" id="7639817">Addr</span><span class="op" id="7639821">(</span><span class="op" id="7639822">)</span><span class="op" id="7639823">.</span><span class="op" id="7639824">(</span><span class="op" id="7639825">*</span><span class="ident" id="7639826">TCPAddr</span><span class="op" id="7639833">)</span><span class="op" id="7639834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639837">if</span>&nbsp;<span class="ident" id="7639840">err</span>&nbsp;<span class="op" id="7639844">!=</span>&nbsp;<span class="ident" id="7639847">nil</span>&nbsp;<span class="op" id="7639851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639855">t</span><span class="op" id="7639856">.</span><span class="ident" id="7639857">Fatalf</span><span class="op" id="7639863">(</span><span class="string" id="7639864">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="7639877">,</span>&nbsp;<span class="ident" id="7639879">err</span><span class="op" id="7639882">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7639885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7639888">defer</span>&nbsp;<span class="ident" id="7639894">c</span><span class="op" id="7639895">.</span><span class="ident" id="7639896">Close</span><span class="op" id="7639901">(</span><span class="op" id="7639902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639905">c</span><span class="op" id="7639906">.</span><span class="ident" id="7639907">SetDeadline</span><span class="op" id="7639918">(</span><span class="ident" id="7639919">time</span><span class="op" id="7639923">.</span><span class="ident" id="7639924">Now</span><span class="op" id="7639927">(</span><span class="op" id="7639928">)</span><span class="op" id="7639929">.</span><span class="ident" id="7639930">Add</span><span class="op" id="7639933">(</span><span class="ident" id="7639934">time</span><span class="op" id="7639938">.</span><span class="ident" id="7639939">Hour</span><span class="op" id="7639943">)</span><span class="op" id="7639944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7639947">c</span><span class="op" id="7639948">.</span><span class="ident" id="7639949">SetReadDeadline</span><span class="op" id="7639964">(</span><span class="ident" id="7639965">time</span><span class="op" id="7639969">.</span><span class="ident" id="7639970">Now</span><span class="op" id="7639973">(</span><span class="op" id="7639974">)</span><span class="op" id="7639975">.</span><span class="ident" id="7639976">Add</span><span class="op" id="7639979">(</span><span class="op" id="7639980">-</span><span class="num" id="7639981">1</span>&nbsp;<span class="op" id="7639983">*</span>&nbsp;<span class="ident" id="7639985">time</span><span class="op" id="7639989">.</span><span class="ident" id="7639990">Second</span><span class="op" id="7639996">)</span><span class="op" id="7639997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640000">buf</span>&nbsp;<span class="op" id="7640004">:=</span>&nbsp;<span class="builtinfunc" id="7640007">make</span><span class="op" id="7640011">(</span><span class="op" id="7640012">[</span><span class="op" id="7640013">]</span><span class="builtintype" id="7640014">byte</span><span class="op" id="7640018">,</span>&nbsp;<span class="num" id="7640020">1</span><span class="op" id="7640021">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640024">if</span>&nbsp;<span class="ident" id="7640027">_</span><span class="op" id="7640028">,</span>&nbsp;<span class="ident" id="7640030">err</span>&nbsp;<span class="op" id="7640034">=</span>&nbsp;<span class="ident" id="7640036">c</span><span class="op" id="7640037">.</span><span class="ident" id="7640038">Read</span><span class="op" id="7640042">(</span><span class="ident" id="7640043">buf</span><span class="op" id="7640046">)</span><span class="op" id="7640047">;</span>&nbsp;<span class="op" id="7640049">!</span><span class="ident" id="7640050">isTimeout</span><span class="op" id="7640059">(</span><span class="ident" id="7640060">err</span><span class="op" id="7640063">)</span>&nbsp;<span class="op" id="7640065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640069">t</span><span class="op" id="7640070">.</span><span class="ident" id="7640071">Fatalf</span><span class="op" id="7640077">(</span><span class="string" id="7640078">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7640109">,</span>&nbsp;<span class="ident" id="7640111">errTimeout</span><span class="op" id="7640121">,</span>&nbsp;<span class="ident" id="7640123">err</span><span class="op" id="7640126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640132">if</span>&nbsp;<span class="ident" id="7640135">_</span><span class="op" id="7640136">,</span>&nbsp;<span class="ident" id="7640138">err</span>&nbsp;<span class="op" id="7640142">=</span>&nbsp;<span class="ident" id="7640144">c</span><span class="op" id="7640145">.</span><span class="ident" id="7640146">Read</span><span class="op" id="7640150">(</span><span class="ident" id="7640151">buf</span><span class="op" id="7640154">)</span><span class="op" id="7640155">;</span>&nbsp;<span class="op" id="7640157">!</span><span class="ident" id="7640158">isTimeout</span><span class="op" id="7640167">(</span><span class="ident" id="7640168">err</span><span class="op" id="7640171">)</span>&nbsp;<span class="op" id="7640173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640177">t</span><span class="op" id="7640178">.</span><span class="ident" id="7640179">Fatalf</span><span class="op" id="7640185">(</span><span class="string" id="7640186">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7640217">,</span>&nbsp;<span class="ident" id="7640219">errTimeout</span><span class="op" id="7640229">,</span>&nbsp;<span class="ident" id="7640231">err</span><span class="op" id="7640234">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640240">c</span><span class="op" id="7640241">.</span><span class="ident" id="7640242">SetDeadline</span><span class="op" id="7640253">(</span><span class="ident" id="7640254">time</span><span class="op" id="7640258">.</span><span class="ident" id="7640259">Now</span><span class="op" id="7640262">(</span><span class="op" id="7640263">)</span><span class="op" id="7640264">.</span><span class="ident" id="7640265">Add</span><span class="op" id="7640268">(</span><span class="num" id="7640269">100</span>&nbsp;<span class="op" id="7640273">*</span>&nbsp;<span class="ident" id="7640275">time</span><span class="op" id="7640279">.</span><span class="ident" id="7640280">Millisecond</span><span class="op" id="7640291">)</span><span class="op" id="7640292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640295">if</span>&nbsp;<span class="ident" id="7640298">_</span><span class="op" id="7640299">,</span>&nbsp;<span class="ident" id="7640301">err</span>&nbsp;<span class="op" id="7640305">=</span>&nbsp;<span class="ident" id="7640307">c</span><span class="op" id="7640308">.</span><span class="ident" id="7640309">Read</span><span class="op" id="7640313">(</span><span class="ident" id="7640314">buf</span><span class="op" id="7640317">)</span><span class="op" id="7640318">;</span>&nbsp;<span class="op" id="7640320">!</span><span class="ident" id="7640321">isTimeout</span><span class="op" id="7640330">(</span><span class="ident" id="7640331">err</span><span class="op" id="7640334">)</span>&nbsp;<span class="op" id="7640336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640340">t</span><span class="op" id="7640341">.</span><span class="ident" id="7640342">Fatalf</span><span class="op" id="7640348">(</span><span class="string" id="7640349">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7640380">,</span>&nbsp;<span class="ident" id="7640382">errTimeout</span><span class="op" id="7640392">,</span>&nbsp;<span class="ident" id="7640394">err</span><span class="op" id="7640397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640400">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640403">if</span>&nbsp;<span class="ident" id="7640406">_</span><span class="op" id="7640407">,</span>&nbsp;<span class="ident" id="7640409">err</span>&nbsp;<span class="op" id="7640413">=</span>&nbsp;<span class="ident" id="7640415">c</span><span class="op" id="7640416">.</span><span class="ident" id="7640417">Read</span><span class="op" id="7640421">(</span><span class="ident" id="7640422">buf</span><span class="op" id="7640425">)</span><span class="op" id="7640426">;</span>&nbsp;<span class="op" id="7640428">!</span><span class="ident" id="7640429">isTimeout</span><span class="op" id="7640438">(</span><span class="ident" id="7640439">err</span><span class="op" id="7640442">)</span>&nbsp;<span class="op" id="7640444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640448">t</span><span class="op" id="7640449">.</span><span class="ident" id="7640450">Fatalf</span><span class="op" id="7640456">(</span><span class="string" id="7640457">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7640488">,</span>&nbsp;<span class="ident" id="7640490">errTimeout</span><span class="op" id="7640500">,</span>&nbsp;<span class="ident" id="7640502">err</span><span class="op" id="7640505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640511">c</span><span class="op" id="7640512">.</span><span class="ident" id="7640513">SetReadDeadline</span><span class="op" id="7640528">(</span><span class="ident" id="7640529">noDeadline</span><span class="op" id="7640539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640542">c</span><span class="op" id="7640543">.</span><span class="ident" id="7640544">SetWriteDeadline</span><span class="op" id="7640560">(</span><span class="ident" id="7640561">time</span><span class="op" id="7640565">.</span><span class="ident" id="7640566">Now</span><span class="op" id="7640569">(</span><span class="op" id="7640570">)</span><span class="op" id="7640571">.</span><span class="ident" id="7640572">Add</span><span class="op" id="7640575">(</span><span class="op" id="7640576">-</span><span class="num" id="7640577">1</span>&nbsp;<span class="op" id="7640579">*</span>&nbsp;<span class="ident" id="7640581">time</span><span class="op" id="7640585">.</span><span class="ident" id="7640586">Second</span><span class="op" id="7640592">)</span><span class="op" id="7640593">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640596">errc</span>&nbsp;<span class="op" id="7640601">:=</span>&nbsp;<span class="builtinfunc" id="7640604">make</span><span class="op" id="7640608">(</span><span class="keyword" id="7640609">chan</span>&nbsp;<span class="builtintype" id="7640614">error</span><span class="op" id="7640619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640622">go</span>&nbsp;<span class="keyword" id="7640625">func</span><span class="op" id="7640629">(</span><span class="op" id="7640630">)</span>&nbsp;<span class="op" id="7640632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640636">_</span><span class="op" id="7640637">,</span>&nbsp;<span class="ident" id="7640639">err</span>&nbsp;<span class="op" id="7640643">:=</span>&nbsp;<span class="ident" id="7640646">c</span><span class="op" id="7640647">.</span><span class="ident" id="7640648">Read</span><span class="op" id="7640652">(</span><span class="ident" id="7640653">buf</span><span class="op" id="7640656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640660">errc</span>&nbsp;<span class="op" id="7640665">&lt;-</span>&nbsp;<span class="ident" id="7640668">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640673">}</span><span class="op" id="7640674">(</span><span class="op" id="7640675">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640678">time</span><span class="op" id="7640682">.</span><span class="ident" id="7640683">Sleep</span><span class="op" id="7640688">(</span><span class="num" id="7640689">100</span>&nbsp;<span class="op" id="7640693">*</span>&nbsp;<span class="ident" id="7640695">time</span><span class="op" id="7640699">.</span><span class="ident" id="7640700">Millisecond</span><span class="op" id="7640711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640714">select</span>&nbsp;<span class="op" id="7640721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640724">case</span>&nbsp;<span class="ident" id="7640729">err</span>&nbsp;<span class="op" id="7640733">:=</span>&nbsp;<span class="op" id="7640736">&lt;-</span><span class="ident" id="7640738">errc</span><span class="op" id="7640742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640746">t</span><span class="op" id="7640747">.</span><span class="ident" id="7640748">Fatalf</span><span class="op" id="7640754">(</span><span class="string" id="7640755">&#34;Expected&nbsp;Read()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="7640813">,</span>&nbsp;<span class="ident" id="7640815">err</span><span class="op" id="7640818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640821">default</span><span class="op" id="7640828">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640834">c</span><span class="op" id="7640835">.</span><span class="ident" id="7640836">Close</span><span class="op" id="7640841">(</span><span class="op" id="7640842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640845">switch</span>&nbsp;<span class="ident" id="7640852">nerr</span>&nbsp;<span class="op" id="7640857">:=</span>&nbsp;<span class="op" id="7640860">&lt;-</span><span class="ident" id="7640862">errc</span><span class="op" id="7640866">;</span>&nbsp;<span class="ident" id="7640868">err</span>&nbsp;<span class="op" id="7640872">:=</span>&nbsp;<span class="ident" id="7640875">nerr</span><span class="op" id="7640879">.</span><span class="op" id="7640880">(</span><span class="keyword" id="7640881">type</span><span class="op" id="7640885">)</span>&nbsp;<span class="op" id="7640887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640890">case</span>&nbsp;<span class="op" id="7640895">*</span><span class="ident" id="7640896">OpError</span><span class="op" id="7640903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7640907">if</span>&nbsp;<span class="ident" id="7640910">err</span><span class="op" id="7640913">.</span><span class="ident" id="7640914">Err</span>&nbsp;<span class="op" id="7640918">!=</span>&nbsp;<span class="ident" id="7640921">errClosing</span>&nbsp;<span class="op" id="7640932">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7640937">t</span><span class="op" id="7640938">.</span><span class="ident" id="7640939">Fatalf</span><span class="op" id="7640945">(</span><span class="string" id="7640946">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7640977">,</span>&nbsp;<span class="ident" id="7640979">errClosing</span><span class="op" id="7640989">,</span>&nbsp;<span class="ident" id="7640991">err</span><span class="op" id="7640994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7640998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641001">default</span><span class="op" id="7641008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641012">if</span>&nbsp;<span class="ident" id="7641015">err</span>&nbsp;<span class="op" id="7641019">==</span>&nbsp;<span class="ident" id="7641022">io</span><span class="op" id="7641024">.</span><span class="ident" id="7641025">EOF</span>&nbsp;<span class="op" id="7641029">&amp;&amp;</span>&nbsp;<span class="ident" id="7641032">runtime</span><span class="op" id="7641039">.</span><span class="ident" id="7641040">GOOS</span>&nbsp;<span class="op" id="7641045">==</span>&nbsp;<span class="string" id="7641048">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7641055">{</span>&nbsp;<span class="comment" id="7641057">//&nbsp;close&nbsp;enough;&nbsp;golang.org/issue/8044</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641099">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641111">if</span>&nbsp;<span class="ident" id="7641114">err</span>&nbsp;<span class="op" id="7641118">!=</span>&nbsp;<span class="ident" id="7641121">errClosing</span>&nbsp;<span class="op" id="7641132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641137">t</span><span class="op" id="7641138">.</span><span class="ident" id="7641139">Fatalf</span><span class="op" id="7641145">(</span><span class="string" id="7641146">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7641177">,</span>&nbsp;<span class="ident" id="7641179">errClosing</span><span class="op" id="7641189">,</span>&nbsp;<span class="ident" id="7641191">err</span><span class="op" id="7641194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641201">}</span><br>
<span class="lineno">130</span><span class="op" id="7641203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7641206">func</span>&nbsp;<span class="ident" id="7641211">TestWriteTimeout</span><span class="op" id="7641227">(</span><span class="ident" id="7641228">t</span>&nbsp;<span class="op" id="7641230">*</span><span class="ident" id="7641231">testing</span><span class="op" id="7641238">.</span><span class="ident" id="7641239">T</span><span class="op" id="7641240">)</span>&nbsp;<span class="op" id="7641242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641245">switch</span>&nbsp;<span class="ident" id="7641252">runtime</span><span class="op" id="7641259">.</span><span class="ident" id="7641260">GOOS</span>&nbsp;<span class="op" id="7641265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641268">case</span>&nbsp;<span class="string" id="7641273">&#34;plan9&#34;</span><span class="op" id="7641280">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641284">t</span><span class="op" id="7641285">.</span><span class="ident" id="7641286">Skipf</span><span class="op" id="7641291">(</span><span class="string" id="7641292">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7641313">,</span>&nbsp;<span class="ident" id="7641315">runtime</span><span class="op" id="7641322">.</span><span class="ident" id="7641323">GOOS</span><span class="op" id="7641327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641334">ln</span>&nbsp;<span class="op" id="7641337">:=</span>&nbsp;<span class="ident" id="7641340">newLocalListener</span><span class="op" id="7641356">(</span><span class="ident" id="7641357">t</span><span class="op" id="7641358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641361">defer</span>&nbsp;<span class="ident" id="7641367">ln</span><span class="op" id="7641369">.</span><span class="ident" id="7641370">Close</span><span class="op" id="7641375">(</span><span class="op" id="7641376">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641379">c</span><span class="op" id="7641380">,</span>&nbsp;<span class="ident" id="7641382">err</span>&nbsp;<span class="op" id="7641386">:=</span>&nbsp;<span class="ident" id="7641389">DialTCP</span><span class="op" id="7641396">(</span><span class="string" id="7641397">&#34;tcp&#34;</span><span class="op" id="7641402">,</span>&nbsp;<span class="ident" id="7641404">nil</span><span class="op" id="7641407">,</span>&nbsp;<span class="ident" id="7641409">ln</span><span class="op" id="7641411">.</span><span class="ident" id="7641412">Addr</span><span class="op" id="7641416">(</span><span class="op" id="7641417">)</span><span class="op" id="7641418">.</span><span class="op" id="7641419">(</span><span class="op" id="7641420">*</span><span class="ident" id="7641421">TCPAddr</span><span class="op" id="7641428">)</span><span class="op" id="7641429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641432">if</span>&nbsp;<span class="ident" id="7641435">err</span>&nbsp;<span class="op" id="7641439">!=</span>&nbsp;<span class="ident" id="7641442">nil</span>&nbsp;<span class="op" id="7641446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641450">t</span><span class="op" id="7641451">.</span><span class="ident" id="7641452">Fatalf</span><span class="op" id="7641458">(</span><span class="string" id="7641459">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="7641472">,</span>&nbsp;<span class="ident" id="7641474">err</span><span class="op" id="7641477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641483">defer</span>&nbsp;<span class="ident" id="7641489">c</span><span class="op" id="7641490">.</span><span class="ident" id="7641491">Close</span><span class="op" id="7641496">(</span><span class="op" id="7641497">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641500">c</span><span class="op" id="7641501">.</span><span class="ident" id="7641502">SetDeadline</span><span class="op" id="7641513">(</span><span class="ident" id="7641514">time</span><span class="op" id="7641518">.</span><span class="ident" id="7641519">Now</span><span class="op" id="7641522">(</span><span class="op" id="7641523">)</span><span class="op" id="7641524">.</span><span class="ident" id="7641525">Add</span><span class="op" id="7641528">(</span><span class="ident" id="7641529">time</span><span class="op" id="7641533">.</span><span class="ident" id="7641534">Hour</span><span class="op" id="7641538">)</span><span class="op" id="7641539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641542">c</span><span class="op" id="7641543">.</span><span class="ident" id="7641544">SetWriteDeadline</span><span class="op" id="7641560">(</span><span class="ident" id="7641561">time</span><span class="op" id="7641565">.</span><span class="ident" id="7641566">Now</span><span class="op" id="7641569">(</span><span class="op" id="7641570">)</span><span class="op" id="7641571">.</span><span class="ident" id="7641572">Add</span><span class="op" id="7641575">(</span><span class="op" id="7641576">-</span><span class="num" id="7641577">1</span>&nbsp;<span class="op" id="7641579">*</span>&nbsp;<span class="ident" id="7641581">time</span><span class="op" id="7641585">.</span><span class="ident" id="7641586">Second</span><span class="op" id="7641592">)</span><span class="op" id="7641593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641596">buf</span>&nbsp;<span class="op" id="7641600">:=</span>&nbsp;<span class="builtinfunc" id="7641603">make</span><span class="op" id="7641607">(</span><span class="op" id="7641608">[</span><span class="op" id="7641609">]</span><span class="builtintype" id="7641610">byte</span><span class="op" id="7641614">,</span>&nbsp;<span class="num" id="7641616">4096</span><span class="op" id="7641620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641623">writeUntilTimeout</span>&nbsp;<span class="op" id="7641641">:=</span>&nbsp;<span class="keyword" id="7641644">func</span><span class="op" id="7641648">(</span><span class="op" id="7641649">)</span>&nbsp;<span class="op" id="7641651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641655">for</span>&nbsp;<span class="op" id="7641659">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641664">_</span><span class="op" id="7641665">,</span>&nbsp;<span class="ident" id="7641667">err</span>&nbsp;<span class="op" id="7641671">:=</span>&nbsp;<span class="ident" id="7641674">c</span><span class="op" id="7641675">.</span><span class="ident" id="7641676">Write</span><span class="op" id="7641681">(</span><span class="ident" id="7641682">buf</span><span class="op" id="7641685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641690">if</span>&nbsp;<span class="ident" id="7641693">err</span>&nbsp;<span class="op" id="7641697">!=</span>&nbsp;<span class="ident" id="7641700">nil</span>&nbsp;<span class="op" id="7641704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641710">if</span>&nbsp;<span class="ident" id="7641713">isTimeout</span><span class="op" id="7641722">(</span><span class="ident" id="7641723">err</span><span class="op" id="7641726">)</span>&nbsp;<span class="op" id="7641728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7641735">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641746">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641752">t</span><span class="op" id="7641753">.</span><span class="ident" id="7641754">Fatalf</span><span class="op" id="7641760">(</span><span class="string" id="7641761">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7641793">,</span>&nbsp;<span class="ident" id="7641795">errTimeout</span><span class="op" id="7641805">,</span>&nbsp;<span class="ident" id="7641807">err</span><span class="op" id="7641810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7641822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641825">writeUntilTimeout</span><span class="op" id="7641842">(</span><span class="op" id="7641843">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641846">c</span><span class="op" id="7641847">.</span><span class="ident" id="7641848">SetDeadline</span><span class="op" id="7641859">(</span><span class="ident" id="7641860">time</span><span class="op" id="7641864">.</span><span class="ident" id="7641865">Now</span><span class="op" id="7641868">(</span><span class="op" id="7641869">)</span><span class="op" id="7641870">.</span><span class="ident" id="7641871">Add</span><span class="op" id="7641874">(</span><span class="num" id="7641875">10</span>&nbsp;<span class="op" id="7641878">*</span>&nbsp;<span class="ident" id="7641880">time</span><span class="op" id="7641884">.</span><span class="ident" id="7641885">Millisecond</span><span class="op" id="7641896">)</span><span class="op" id="7641897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641900">writeUntilTimeout</span><span class="op" id="7641917">(</span><span class="op" id="7641918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641921">writeUntilTimeout</span><span class="op" id="7641938">(</span><span class="op" id="7641939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641942">c</span><span class="op" id="7641943">.</span><span class="ident" id="7641944">SetWriteDeadline</span><span class="op" id="7641960">(</span><span class="ident" id="7641961">noDeadline</span><span class="op" id="7641971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7641974">c</span><span class="op" id="7641975">.</span><span class="ident" id="7641976">SetReadDeadline</span><span class="op" id="7641991">(</span><span class="ident" id="7641992">time</span><span class="op" id="7641996">.</span><span class="ident" id="7641997">Now</span><span class="op" id="7642000">(</span><span class="op" id="7642001">)</span><span class="op" id="7642002">.</span><span class="ident" id="7642003">Add</span><span class="op" id="7642006">(</span><span class="op" id="7642007">-</span><span class="num" id="7642008">1</span>&nbsp;<span class="op" id="7642010">*</span>&nbsp;<span class="ident" id="7642012">time</span><span class="op" id="7642016">.</span><span class="ident" id="7642017">Second</span><span class="op" id="7642023">)</span><span class="op" id="7642024">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642027">errc</span>&nbsp;<span class="op" id="7642032">:=</span>&nbsp;<span class="builtinfunc" id="7642035">make</span><span class="op" id="7642039">(</span><span class="keyword" id="7642040">chan</span>&nbsp;<span class="builtintype" id="7642045">error</span><span class="op" id="7642050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642053">go</span>&nbsp;<span class="keyword" id="7642056">func</span><span class="op" id="7642060">(</span><span class="op" id="7642061">)</span>&nbsp;<span class="op" id="7642063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642067">for</span>&nbsp;<span class="op" id="7642071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642076">_</span><span class="op" id="7642077">,</span>&nbsp;<span class="ident" id="7642079">err</span>&nbsp;<span class="op" id="7642083">:=</span>&nbsp;<span class="ident" id="7642086">c</span><span class="op" id="7642087">.</span><span class="ident" id="7642088">Write</span><span class="op" id="7642093">(</span><span class="ident" id="7642094">buf</span><span class="op" id="7642097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642102">if</span>&nbsp;<span class="ident" id="7642105">err</span>&nbsp;<span class="op" id="7642109">!=</span>&nbsp;<span class="ident" id="7642112">nil</span>&nbsp;<span class="op" id="7642116">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642122">errc</span>&nbsp;<span class="op" id="7642127">&lt;-</span>&nbsp;<span class="ident" id="7642130">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7642137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7642141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7642144">}</span><span class="op" id="7642145">(</span><span class="op" id="7642146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642149">time</span><span class="op" id="7642153">.</span><span class="ident" id="7642154">Sleep</span><span class="op" id="7642159">(</span><span class="num" id="7642160">100</span>&nbsp;<span class="op" id="7642164">*</span>&nbsp;<span class="ident" id="7642166">time</span><span class="op" id="7642170">.</span><span class="ident" id="7642171">Millisecond</span><span class="op" id="7642182">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642185">select</span>&nbsp;<span class="op" id="7642192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642195">case</span>&nbsp;<span class="ident" id="7642200">err</span>&nbsp;<span class="op" id="7642204">:=</span>&nbsp;<span class="op" id="7642207">&lt;-</span><span class="ident" id="7642209">errc</span><span class="op" id="7642213">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642217">t</span><span class="op" id="7642218">.</span><span class="ident" id="7642219">Fatalf</span><span class="op" id="7642225">(</span><span class="string" id="7642226">&#34;Expected&nbsp;Write()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="7642285">,</span>&nbsp;<span class="ident" id="7642287">err</span><span class="op" id="7642290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642293">default</span><span class="op" id="7642300">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7642303">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642306">c</span><span class="op" id="7642307">.</span><span class="ident" id="7642308">Close</span><span class="op" id="7642313">(</span><span class="op" id="7642314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642317">switch</span>&nbsp;<span class="ident" id="7642324">nerr</span>&nbsp;<span class="op" id="7642329">:=</span>&nbsp;<span class="op" id="7642332">&lt;-</span><span class="ident" id="7642334">errc</span><span class="op" id="7642338">;</span>&nbsp;<span class="ident" id="7642340">err</span>&nbsp;<span class="op" id="7642344">:=</span>&nbsp;<span class="ident" id="7642347">nerr</span><span class="op" id="7642351">.</span><span class="op" id="7642352">(</span><span class="keyword" id="7642353">type</span><span class="op" id="7642357">)</span>&nbsp;<span class="op" id="7642359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642362">case</span>&nbsp;<span class="op" id="7642367">*</span><span class="ident" id="7642368">OpError</span><span class="op" id="7642375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642379">if</span>&nbsp;<span class="ident" id="7642382">err</span><span class="op" id="7642385">.</span><span class="ident" id="7642386">Err</span>&nbsp;<span class="op" id="7642390">!=</span>&nbsp;<span class="ident" id="7642393">errClosing</span>&nbsp;<span class="op" id="7642404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642409">t</span><span class="op" id="7642410">.</span><span class="ident" id="7642411">Fatalf</span><span class="op" id="7642417">(</span><span class="string" id="7642418">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7642450">,</span>&nbsp;<span class="ident" id="7642452">errClosing</span><span class="op" id="7642462">,</span>&nbsp;<span class="ident" id="7642464">err</span><span class="op" id="7642467">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7642471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642474">default</span><span class="op" id="7642481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642485">if</span>&nbsp;<span class="ident" id="7642488">err</span>&nbsp;<span class="op" id="7642492">!=</span>&nbsp;<span class="ident" id="7642495">errClosing</span>&nbsp;<span class="op" id="7642506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642511">t</span><span class="op" id="7642512">.</span><span class="ident" id="7642513">Fatalf</span><span class="op" id="7642519">(</span><span class="string" id="7642520">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7642552">,</span>&nbsp;<span class="ident" id="7642554">errClosing</span><span class="op" id="7642564">,</span>&nbsp;<span class="ident" id="7642566">err</span><span class="op" id="7642569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7642573">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7642576">}</span><br>
<span class="lineno"></span><span class="op" id="7642578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7642581">func</span>&nbsp;<span class="ident" id="7642586">testTimeout</span><span class="op" id="7642597">(</span><span class="ident" id="7642598">t</span>&nbsp;<span class="op" id="7642600">*</span><span class="ident" id="7642601">testing</span><span class="op" id="7642608">.</span><span class="ident" id="7642609">T</span><span class="op" id="7642610">,</span>&nbsp;<span class="ident" id="7642612">net</span><span class="op" id="7642615">,</span>&nbsp;<span class="ident" id="7642617">addr</span>&nbsp;<span class="builtintype" id="7642622">string</span><span class="op" id="7642628">,</span>&nbsp;<span class="ident" id="7642630">readFrom</span>&nbsp;<span class="builtintype" id="7642639">bool</span><span class="op" id="7642643">)</span>&nbsp;<span class="op" id="7642645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642648">c</span><span class="op" id="7642649">,</span>&nbsp;<span class="ident" id="7642651">err</span>&nbsp;<span class="op" id="7642655">:=</span>&nbsp;<span class="ident" id="7642658">Dial</span><span class="op" id="7642662">(</span><span class="ident" id="7642663">net</span><span class="op" id="7642666">,</span>&nbsp;<span class="ident" id="7642668">addr</span><span class="op" id="7642672">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642675">if</span>&nbsp;<span class="ident" id="7642678">err</span>&nbsp;<span class="op" id="7642682">!=</span>&nbsp;<span class="ident" id="7642685">nil</span>&nbsp;<span class="op" id="7642689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642693">t</span><span class="op" id="7642694">.</span><span class="ident" id="7642695">Errorf</span><span class="op" id="7642701">(</span><span class="string" id="7642702">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7642727">,</span>&nbsp;<span class="ident" id="7642729">net</span><span class="op" id="7642732">,</span>&nbsp;<span class="ident" id="7642734">addr</span><span class="op" id="7642738">,</span>&nbsp;<span class="ident" id="7642740">err</span><span class="op" id="7642743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642747">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7642755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642758">defer</span>&nbsp;<span class="ident" id="7642764">c</span><span class="op" id="7642765">.</span><span class="ident" id="7642766">Close</span><span class="op" id="7642771">(</span><span class="op" id="7642772">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642775">what</span>&nbsp;<span class="op" id="7642780">:=</span>&nbsp;<span class="string" id="7642783">&#34;Read&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642791">if</span>&nbsp;<span class="ident" id="7642794">readFrom</span>&nbsp;<span class="op" id="7642803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642807">what</span>&nbsp;<span class="op" id="7642812">=</span>&nbsp;<span class="string" id="7642814">&#34;ReadFrom&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7642826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642830">errc</span>&nbsp;<span class="op" id="7642835">:=</span>&nbsp;<span class="builtinfunc" id="7642838">make</span><span class="op" id="7642842">(</span><span class="keyword" id="7642843">chan</span>&nbsp;<span class="builtintype" id="7642848">error</span><span class="op" id="7642853">,</span>&nbsp;<span class="num" id="7642855">1</span><span class="op" id="7642856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642859">go</span>&nbsp;<span class="keyword" id="7642862">func</span><span class="op" id="7642866">(</span><span class="op" id="7642867">)</span>&nbsp;<span class="op" id="7642869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642873">t0</span>&nbsp;<span class="op" id="7642876">:=</span>&nbsp;<span class="ident" id="7642879">time</span><span class="op" id="7642883">.</span><span class="ident" id="7642884">Now</span><span class="op" id="7642887">(</span><span class="op" id="7642888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7642892">c</span><span class="op" id="7642893">.</span><span class="ident" id="7642894">SetReadDeadline</span><span class="op" id="7642909">(</span><span class="ident" id="7642910">time</span><span class="op" id="7642914">.</span><span class="ident" id="7642915">Now</span><span class="op" id="7642918">(</span><span class="op" id="7642919">)</span><span class="op" id="7642920">.</span><span class="ident" id="7642921">Add</span><span class="op" id="7642924">(</span><span class="num" id="7642925">100</span>&nbsp;<span class="op" id="7642929">*</span>&nbsp;<span class="ident" id="7642931">time</span><span class="op" id="7642935">.</span><span class="ident" id="7642936">Millisecond</span><span class="op" id="7642947">)</span><span class="op" id="7642948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642952">var</span>&nbsp;<span class="ident" id="7642956">b</span>&nbsp;<span class="op" id="7642958">[</span><span class="num" id="7642959">100</span><span class="op" id="7642962">]</span><span class="builtintype" id="7642963">byte</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642970">var</span>&nbsp;<span class="ident" id="7642974">n</span>&nbsp;<span class="builtintype" id="7642976">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642982">var</span>&nbsp;<span class="ident" id="7642986">err</span>&nbsp;<span class="builtintype" id="7642990">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7642998">if</span>&nbsp;<span class="ident" id="7643001">readFrom</span>&nbsp;<span class="op" id="7643010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7643015">n</span><span class="op" id="7643016">,</span>&nbsp;<span class="ident" id="7643018">_</span><span class="op" id="7643019">,</span>&nbsp;<span class="ident" id="7643021">err</span>&nbsp;<span class="op" id="7643025">=</span>&nbsp;<span class="ident" id="7643027">c</span><span class="op" id="7643028">.</span><span class="op" id="7643029">(</span><span class="ident" id="7643030">PacketConn</span><span class="op" id="7643040">)</span><span class="op" id="7643041">.</span><span class="ident" id="7643042">ReadFrom</span><span class="op" id="7643050">(</span><span class="ident" id="7643051">b</span><span class="op" id="7643052">[</span><span class="num" id="7643053">0</span><span class="op" id="7643054">:</span><span class="op" id="7643055">]</span><span class="op" id="7643056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7643060">}</span>&nbsp;<span class="keyword" id="7643062">else</span>&nbsp;<span class="op" id="7643067">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7643072">n</span><span class="op" id="7643073">,</span>&nbsp;<span class="ident" id="7643075">err</span>&nbsp;<span class="op" id="7643079">=</span>&nbsp;<span class="ident" id="7643081">c</span><span class="op" id="7643082">.</span><span class="ident" id="7643083">Read</span><span class="op" id="7643087">(</span><span class="ident" id="7643088">b</span><span class="op" id="7643089">[</span><span class="num" id="7643090">0</span><span class="op" id="7643091">:</span><span class="op" id="7643092">]</span><span class="op" id="7643093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7643097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7643101">t1</span>&nbsp;<span class="op" id="7643104">:=</span>&nbsp;<span class="ident" id="7643107">time</span><span class="op" id="7643111">.</span><span class="ident" id="7643112">Now</span><span class="op" id="7643115">(</span><span class="op" id="7643116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7643120">if</span>&nbsp;<span class="ident" id="7643123">n</span>&nbsp;<span class="op" id="7643125">!=</span>&nbsp;<span class="num" id="7643128">0</span>&nbsp;<span class="op" id="7643130">||</span>&nbsp;<span class="ident" id="7643133">err</span>&nbsp;<span class="op" id="7643137">==</span>&nbsp;<span class="ident" id="7643140">nil</span>&nbsp;<span class="op" id="7643144">||</span>&nbsp;<span class="op" id="7643147">!</span><span class="ident" id="7643148">err</span><span class="op" id="7643151">.</span><span class="op" id="7643152">(</span><span class="ident" id="7643153">Error</span><span class="op" id="7643158">)</span><span class="op" id="7643159">.</span><span class="ident" id="7643160">Timeout</span><span class="op" id="7643167">(</span><span class="op" id="7643168">)</span>&nbsp;<span class="op" id="7643170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7643175">errc</span>&nbsp;<span class="op" id="7643180">&lt;-</span>&nbsp;<span class="ident" id="7643183">fmt</span><span class="op" id="7643186">.</span><span class="ident" id="7643187">Errorf</span><span class="op" id="7643193">(</span><span class="string" id="7643194">&#34;%s(%q,&nbsp;%q)&nbsp;did&nbsp;not&nbsp;return&nbsp;0,&nbsp;timeout:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7643240">,</span>&nbsp;<span class="ident" id="7643242">what</span><span class="op" id="7643246">,</span>&nbsp;<span class="ident" id="7643248">net</span><span class="op" id="7643251">,</span>&nbsp;<span class="ident" id="7643253">addr</span><span class="op" id="7643257">,</span>&nbsp;<span class="ident" id="7643259">n</span><span class="op" id="7643260">,</span>&nbsp;<span class="ident" id="7643262">err</span><span class="op" id="7643265">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7643270">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7643279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7643283">if</span>&nbsp;<span class="ident" id="7643286">dt</span>&nbsp;<span class="op" id="7643289">:=</span>&nbsp;<span class="ident" id="7643292">t1</span><span class="op" id="7643294">.</span><span class="ident" id="7643295">Sub</span><span class="op" id="7643298">(</span><span class="ident" id="7643299">t0</span><span class="op" id="7643301">)</span><span class="op" id="7643302">;</span>&nbsp;<span class="ident" id="7643304">dt</span>&nbsp;<span class="op" id="7643307">&lt;</span>&nbsp;<span class="num" id="7643309">50</span><span class="op" id="7643311">*</span><span class="ident" id="7643312">time</span><span class="op" id="7643316">.</span><span class="ident" id="7643317">Millisecond</span>&nbsp;<span class="op" id="7643329">||</span>&nbsp;<span class="op" id="7643332">!</span><span class="ident" id="7643333">testing</span><span class="op" id="7643340">.</span><span class="ident" id="7643341">Short</span><span class="op" id="7643346">(</span><span class="op" id="7643347">)</span>&nbsp;<span class="op" id="7643349">&amp;&amp;</span>&nbsp;<span class="ident" id="7643352">dt</span>&nbsp;<span class="op" id="7643355">&gt;</span>&nbsp;<span class="num" id="7643357">250</span><span class="op" id="7643360">*</span><span class="ident" id="7643361">time</span><span class="op" id="7643365">.</span><span class="ident" id="7643366">Millisecond</span>&nbsp;<span class="op" id="7643378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7643383">errc</span>&nbsp;<span class="op" id="7643388">&lt;-</span>&nbsp;<span class="ident" id="7643391">fmt</span><span class="op" id="7643394">.</span><span class="ident" id="7643395">Errorf</span><span class="op" id="7643401">(</span><span class="string" id="7643402">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;%s,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="7643437">,</span>&nbsp;<span class="ident" id="7643439">what</span><span class="op" id="7643443">,</span>&nbsp;<span class="ident" id="7643445">net</span><span class="op" id="7643448">,</span>&nbsp;<span class="ident" id="7643450">addr</span><span class="op" id="7643454">,</span>&nbsp;<span class="ident" id="7643456">dt</span><span class="op" id="7643458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7643463">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7643472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7643476">errc</span>&nbsp;<span class="op" id="7643481">&lt;-</span>&nbsp;<span class="ident" id="7643484">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7643489">}</span><span class="op" id="7643490">(</span><span class="op" id="7643491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7643494">select</span>&nbsp;<span class="op" id="7643501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7643504">case</span>&nbsp;<span class="ident" id="7643509">err</span>&nbsp;<span class="op" id="7643513">:=</span>&nbsp;<span class="op" id="7643516">&lt;-</span><span class="ident" id="7643518">errc</span><span class="op" id="7643522">:</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7643526">if</span>&nbsp;<span class="ident" id="7643529">err</span>&nbsp;<span class="op" id="7643533">!=</span>&nbsp;<span class="ident" id="7643536">nil</span>&nbsp;<span class="op" id="7643540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7643545">t</span><span class="op" id="7643546">.</span><span class="ident" id="7643547">Error</span><span class="op" id="7643552">(</span><span class="ident" id="7643553">err</span><span class="op" id="7643556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7643560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7643563">case</span>&nbsp;<span class="op" id="7643568">&lt;-</span><span class="ident" id="7643570">time</span><span class="op" id="7643574">.</span><span class="ident" id="7643575">After</span><span class="op" id="7643580">(</span><span class="num" id="7643581">1</span>&nbsp;<span class="op" id="7643583">*</span>&nbsp;<span class="ident" id="7643585">time</span><span class="op" id="7643589">.</span><span class="ident" id="7643590">Second</span><span class="op" id="7643596">)</span><span class="op" id="7643597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7643601">t</span><span class="op" id="7643602">.</span><span class="ident" id="7643603">Errorf</span><span class="op" id="7643609">(</span><span class="string" id="7643610">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;over&nbsp;1&nbsp;second,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="7643656">,</span>&nbsp;<span class="ident" id="7643658">what</span><span class="op" id="7643662">,</span>&nbsp;<span class="ident" id="7643664">net</span><span class="op" id="7643667">,</span>&nbsp;<span class="ident" id="7643669">addr</span><span class="op" id="7643673">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7643676">}</span><br>
<span class="lineno"></span><span class="op" id="7643678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7643681">func</span>&nbsp;<span class="ident" id="7643686">TestTimeoutUDP</span><span class="op" id="7643700">(</span><span class="ident" id="7643701">t</span>&nbsp;<span class="op" id="7643703">*</span><span class="ident" id="7643704">testing</span><span class="op" id="7643711">.</span><span class="ident" id="7643712">T</span><span class="op" id="7643713">)</span>&nbsp;<span class="op" id="7643715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7643718">switch</span>&nbsp;<span class="ident" id="7643725">runtime</span><span class="op" id="7643732">.</span><span class="ident" id="7643733">GOOS</span>&nbsp;<span class="op" id="7643738">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7643741">case</span>&nbsp;<span class="string" id="7643746">&#34;plan9&#34;</span><span class="op" id="7643753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7643757">t</span><span class="op" id="7643758">.</span><span class="ident" id="7643759">Skipf</span><span class="op" id="7643764">(</span><span class="string" id="7643765">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7643786">,</span>&nbsp;<span class="ident" id="7643788">runtime</span><span class="op" id="7643795">.</span><span class="ident" id="7643796">GOOS</span><span class="op" id="7643800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7643803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7643807">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7643850">listening</span>&nbsp;<span class="op" id="7643860">:=</span>&nbsp;<span class="builtinfunc" id="7643863">make</span><span class="op" id="7643867">(</span><span class="keyword" id="7643868">chan</span>&nbsp;<span class="builtintype" id="7643873">string</span><span class="op" id="7643879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7643882">done</span>&nbsp;<span class="op" id="7643887">:=</span>&nbsp;<span class="builtinfunc" id="7643890">make</span><span class="op" id="7643894">(</span><span class="keyword" id="7643895">chan</span>&nbsp;<span class="builtintype" id="7643900">int</span><span class="op" id="7643903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7643906">go</span>&nbsp;<span class="ident" id="7643909">runDatagramPacketConnServer</span><span class="op" id="7643936">(</span><span class="ident" id="7643937">t</span><span class="op" id="7643938">,</span>&nbsp;<span class="string" id="7643940">&#34;udp&#34;</span><span class="op" id="7643945">,</span>&nbsp;<span class="string" id="7643947">&#34;127.0.0.1:0&#34;</span><span class="op" id="7643960">,</span>&nbsp;<span class="ident" id="7643962">listening</span><span class="op" id="7643971">,</span>&nbsp;<span class="ident" id="7643973">done</span><span class="op" id="7643977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7643980">addr</span>&nbsp;<span class="op" id="7643985">:=</span>&nbsp;<span class="op" id="7643988">&lt;-</span><span class="ident" id="7643990">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644002">testTimeout</span><span class="op" id="7644013">(</span><span class="ident" id="7644014">t</span><span class="op" id="7644015">,</span>&nbsp;<span class="string" id="7644017">&#34;udp&#34;</span><span class="op" id="7644022">,</span>&nbsp;<span class="ident" id="7644024">addr</span><span class="op" id="7644028">,</span>&nbsp;<span class="builtintype" id="7644030">false</span><span class="op" id="7644035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644038">testTimeout</span><span class="op" id="7644049">(</span><span class="ident" id="7644050">t</span><span class="op" id="7644051">,</span>&nbsp;<span class="string" id="7644053">&#34;udp&#34;</span><span class="op" id="7644058">,</span>&nbsp;<span class="ident" id="7644060">addr</span><span class="op" id="7644064">,</span>&nbsp;<span class="builtintype" id="7644066">true</span><span class="op" id="7644070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7644073">&lt;-</span><span class="ident" id="7644075">done</span><br>
<span class="lineno"></span><span class="op" id="7644080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="7644083">func</span>&nbsp;<span class="ident" id="7644088">TestTimeoutTCP</span><span class="op" id="7644102">(</span><span class="ident" id="7644103">t</span>&nbsp;<span class="op" id="7644105">*</span><span class="ident" id="7644106">testing</span><span class="op" id="7644113">.</span><span class="ident" id="7644114">T</span><span class="op" id="7644115">)</span>&nbsp;<span class="op" id="7644117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7644120">switch</span>&nbsp;<span class="ident" id="7644127">runtime</span><span class="op" id="7644134">.</span><span class="ident" id="7644135">GOOS</span>&nbsp;<span class="op" id="7644140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7644143">case</span>&nbsp;<span class="string" id="7644148">&#34;plan9&#34;</span><span class="op" id="7644155">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644159">t</span><span class="op" id="7644160">.</span><span class="ident" id="7644161">Skipf</span><span class="op" id="7644166">(</span><span class="string" id="7644167">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7644188">,</span>&nbsp;<span class="ident" id="7644190">runtime</span><span class="op" id="7644197">.</span><span class="ident" id="7644198">GOOS</span><span class="op" id="7644202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7644205">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7644209">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644252">listening</span>&nbsp;<span class="op" id="7644262">:=</span>&nbsp;<span class="builtinfunc" id="7644265">make</span><span class="op" id="7644269">(</span><span class="keyword" id="7644270">chan</span>&nbsp;<span class="builtintype" id="7644275">string</span><span class="op" id="7644281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644284">done</span>&nbsp;<span class="op" id="7644289">:=</span>&nbsp;<span class="builtinfunc" id="7644292">make</span><span class="op" id="7644296">(</span><span class="keyword" id="7644297">chan</span>&nbsp;<span class="builtintype" id="7644302">int</span><span class="op" id="7644305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7644308">go</span>&nbsp;<span class="ident" id="7644311">runStreamConnServer</span><span class="op" id="7644330">(</span><span class="ident" id="7644331">t</span><span class="op" id="7644332">,</span>&nbsp;<span class="string" id="7644334">&#34;tcp&#34;</span><span class="op" id="7644339">,</span>&nbsp;<span class="string" id="7644341">&#34;127.0.0.1:0&#34;</span><span class="op" id="7644354">,</span>&nbsp;<span class="ident" id="7644356">listening</span><span class="op" id="7644365">,</span>&nbsp;<span class="ident" id="7644367">done</span><span class="op" id="7644371">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644374">addr</span>&nbsp;<span class="op" id="7644379">:=</span>&nbsp;<span class="op" id="7644382">&lt;-</span><span class="ident" id="7644384">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644396">testTimeout</span><span class="op" id="7644407">(</span><span class="ident" id="7644408">t</span><span class="op" id="7644409">,</span>&nbsp;<span class="string" id="7644411">&#34;tcp&#34;</span><span class="op" id="7644416">,</span>&nbsp;<span class="ident" id="7644418">addr</span><span class="op" id="7644422">,</span>&nbsp;<span class="builtintype" id="7644424">false</span><span class="op" id="7644429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7644432">&lt;-</span><span class="ident" id="7644434">done</span><br>
<span class="lineno"></span><span class="op" id="7644439">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="7644442">func</span>&nbsp;<span class="ident" id="7644447">TestDeadlineReset</span><span class="op" id="7644464">(</span><span class="ident" id="7644465">t</span>&nbsp;<span class="op" id="7644467">*</span><span class="ident" id="7644468">testing</span><span class="op" id="7644475">.</span><span class="ident" id="7644476">T</span><span class="op" id="7644477">)</span>&nbsp;<span class="op" id="7644479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7644482">switch</span>&nbsp;<span class="ident" id="7644489">runtime</span><span class="op" id="7644496">.</span><span class="ident" id="7644497">GOOS</span>&nbsp;<span class="op" id="7644502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7644505">case</span>&nbsp;<span class="string" id="7644510">&#34;plan9&#34;</span><span class="op" id="7644517">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644521">t</span><span class="op" id="7644522">.</span><span class="ident" id="7644523">Skipf</span><span class="op" id="7644528">(</span><span class="string" id="7644529">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7644550">,</span>&nbsp;<span class="ident" id="7644552">runtime</span><span class="op" id="7644559">.</span><span class="ident" id="7644560">GOOS</span><span class="op" id="7644564">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7644567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644570">ln</span><span class="op" id="7644572">,</span>&nbsp;<span class="ident" id="7644574">err</span>&nbsp;<span class="op" id="7644578">:=</span>&nbsp;<span class="ident" id="7644581">Listen</span><span class="op" id="7644587">(</span><span class="string" id="7644588">&#34;tcp&#34;</span><span class="op" id="7644593">,</span>&nbsp;<span class="string" id="7644595">&#34;127.0.0.1:0&#34;</span><span class="op" id="7644608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7644611">if</span>&nbsp;<span class="ident" id="7644614">err</span>&nbsp;<span class="op" id="7644618">!=</span>&nbsp;<span class="ident" id="7644621">nil</span>&nbsp;<span class="op" id="7644625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644629">t</span><span class="op" id="7644630">.</span><span class="ident" id="7644631">Fatal</span><span class="op" id="7644636">(</span><span class="ident" id="7644637">err</span><span class="op" id="7644640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7644643">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7644646">defer</span>&nbsp;<span class="ident" id="7644652">ln</span><span class="op" id="7644654">.</span><span class="ident" id="7644655">Close</span><span class="op" id="7644660">(</span><span class="op" id="7644661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644664">tl</span>&nbsp;<span class="op" id="7644667">:=</span>&nbsp;<span class="ident" id="7644670">ln</span><span class="op" id="7644672">.</span><span class="op" id="7644673">(</span><span class="op" id="7644674">*</span><span class="ident" id="7644675">TCPListener</span><span class="op" id="7644686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644689">tl</span><span class="op" id="7644691">.</span><span class="ident" id="7644692">SetDeadline</span><span class="op" id="7644703">(</span><span class="ident" id="7644704">time</span><span class="op" id="7644708">.</span><span class="ident" id="7644709">Now</span><span class="op" id="7644712">(</span><span class="op" id="7644713">)</span><span class="op" id="7644714">.</span><span class="ident" id="7644715">Add</span><span class="op" id="7644718">(</span><span class="num" id="7644719">1</span>&nbsp;<span class="op" id="7644721">*</span>&nbsp;<span class="ident" id="7644723">time</span><span class="op" id="7644727">.</span><span class="ident" id="7644728">Minute</span><span class="op" id="7644734">)</span><span class="op" id="7644735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644738">tl</span><span class="op" id="7644740">.</span><span class="ident" id="7644741">SetDeadline</span><span class="op" id="7644752">(</span><span class="ident" id="7644753">noDeadline</span><span class="op" id="7644763">)</span>&nbsp;<span class="comment" id="7644765">//&nbsp;reset&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644778">errc</span>&nbsp;<span class="op" id="7644783">:=</span>&nbsp;<span class="builtinfunc" id="7644786">make</span><span class="op" id="7644790">(</span><span class="keyword" id="7644791">chan</span>&nbsp;<span class="builtintype" id="7644796">error</span><span class="op" id="7644801">,</span>&nbsp;<span class="num" id="7644803">1</span><span class="op" id="7644804">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7644807">go</span>&nbsp;<span class="keyword" id="7644810">func</span><span class="op" id="7644814">(</span><span class="op" id="7644815">)</span>&nbsp;<span class="op" id="7644817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644821">_</span><span class="op" id="7644822">,</span>&nbsp;<span class="ident" id="7644824">err</span>&nbsp;<span class="op" id="7644828">:=</span>&nbsp;<span class="ident" id="7644831">ln</span><span class="op" id="7644833">.</span><span class="ident" id="7644834">Accept</span><span class="op" id="7644840">(</span><span class="op" id="7644841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7644845">errc</span>&nbsp;<span class="op" id="7644850">&lt;-</span>&nbsp;<span class="ident" id="7644853">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7644858">}</span><span class="op" id="7644859">(</span><span class="op" id="7644860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7644863">select</span>&nbsp;<span class="op" id="7644870">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7644873">case</span>&nbsp;<span class="op" id="7644878">&lt;-</span><span class="ident" id="7644880">time</span><span class="op" id="7644884">.</span><span class="ident" id="7644885">After</span><span class="op" id="7644890">(</span><span class="num" id="7644891">50</span>&nbsp;<span class="op" id="7644894">*</span>&nbsp;<span class="ident" id="7644896">time</span><span class="op" id="7644900">.</span><span class="ident" id="7644901">Millisecond</span><span class="op" id="7644912">)</span><span class="op" id="7644913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7644917">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7644927">case</span>&nbsp;<span class="ident" id="7644932">err</span>&nbsp;<span class="op" id="7644936">:=</span>&nbsp;<span class="op" id="7644939">&lt;-</span><span class="ident" id="7644941">errc</span><span class="op" id="7644945">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7644949">//&nbsp;Accept&nbsp;should&nbsp;never&nbsp;return;&nbsp;we&nbsp;never</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7644991">//&nbsp;connected&nbsp;to&nbsp;it.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645013">t</span><span class="op" id="7645014">.</span><span class="ident" id="7645015">Errorf</span><span class="op" id="7645021">(</span><span class="string" id="7645022">&#34;unexpected&nbsp;return&nbsp;from&nbsp;Accept;&nbsp;err=%v&#34;</span><span class="op" id="7645061">,</span>&nbsp;<span class="ident" id="7645063">err</span><span class="op" id="7645066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7645069">}</span><br>
<span class="lineno"></span><span class="op" id="7645071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7645074">func</span>&nbsp;<span class="ident" id="7645079">TestTimeoutAccept</span><span class="op" id="7645096">(</span><span class="ident" id="7645097">t</span>&nbsp;<span class="op" id="7645099">*</span><span class="ident" id="7645100">testing</span><span class="op" id="7645107">.</span><span class="ident" id="7645108">T</span><span class="op" id="7645109">)</span>&nbsp;<span class="op" id="7645111">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7645114">switch</span>&nbsp;<span class="ident" id="7645121">runtime</span><span class="op" id="7645128">.</span><span class="ident" id="7645129">GOOS</span>&nbsp;<span class="op" id="7645134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7645137">case</span>&nbsp;<span class="string" id="7645142">&#34;plan9&#34;</span><span class="op" id="7645149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645153">t</span><span class="op" id="7645154">.</span><span class="ident" id="7645155">Skipf</span><span class="op" id="7645160">(</span><span class="string" id="7645161">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7645182">,</span>&nbsp;<span class="ident" id="7645184">runtime</span><span class="op" id="7645191">.</span><span class="ident" id="7645192">GOOS</span><span class="op" id="7645196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7645199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645202">ln</span><span class="op" id="7645204">,</span>&nbsp;<span class="ident" id="7645206">err</span>&nbsp;<span class="op" id="7645210">:=</span>&nbsp;<span class="ident" id="7645213">Listen</span><span class="op" id="7645219">(</span><span class="string" id="7645220">&#34;tcp&#34;</span><span class="op" id="7645225">,</span>&nbsp;<span class="string" id="7645227">&#34;127.0.0.1:0&#34;</span><span class="op" id="7645240">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7645243">if</span>&nbsp;<span class="ident" id="7645246">err</span>&nbsp;<span class="op" id="7645250">!=</span>&nbsp;<span class="ident" id="7645253">nil</span>&nbsp;<span class="op" id="7645257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645261">t</span><span class="op" id="7645262">.</span><span class="ident" id="7645263">Fatal</span><span class="op" id="7645268">(</span><span class="ident" id="7645269">err</span><span class="op" id="7645272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7645275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7645278">defer</span>&nbsp;<span class="ident" id="7645284">ln</span><span class="op" id="7645286">.</span><span class="ident" id="7645287">Close</span><span class="op" id="7645292">(</span><span class="op" id="7645293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645296">tl</span>&nbsp;<span class="op" id="7645299">:=</span>&nbsp;<span class="ident" id="7645302">ln</span><span class="op" id="7645304">.</span><span class="op" id="7645305">(</span><span class="op" id="7645306">*</span><span class="ident" id="7645307">TCPListener</span><span class="op" id="7645318">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645321">tl</span><span class="op" id="7645323">.</span><span class="ident" id="7645324">SetDeadline</span><span class="op" id="7645335">(</span><span class="ident" id="7645336">time</span><span class="op" id="7645340">.</span><span class="ident" id="7645341">Now</span><span class="op" id="7645344">(</span><span class="op" id="7645345">)</span><span class="op" id="7645346">.</span><span class="ident" id="7645347">Add</span><span class="op" id="7645350">(</span><span class="num" id="7645351">100</span>&nbsp;<span class="op" id="7645355">*</span>&nbsp;<span class="ident" id="7645357">time</span><span class="op" id="7645361">.</span><span class="ident" id="7645362">Millisecond</span><span class="op" id="7645373">)</span><span class="op" id="7645374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645377">errc</span>&nbsp;<span class="op" id="7645382">:=</span>&nbsp;<span class="builtinfunc" id="7645385">make</span><span class="op" id="7645389">(</span><span class="keyword" id="7645390">chan</span>&nbsp;<span class="builtintype" id="7645395">error</span><span class="op" id="7645400">,</span>&nbsp;<span class="num" id="7645402">1</span><span class="op" id="7645403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7645406">go</span>&nbsp;<span class="keyword" id="7645409">func</span><span class="op" id="7645413">(</span><span class="op" id="7645414">)</span>&nbsp;<span class="op" id="7645416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645420">_</span><span class="op" id="7645421">,</span>&nbsp;<span class="ident" id="7645423">err</span>&nbsp;<span class="op" id="7645427">:=</span>&nbsp;<span class="ident" id="7645430">ln</span><span class="op" id="7645432">.</span><span class="ident" id="7645433">Accept</span><span class="op" id="7645439">(</span><span class="op" id="7645440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645444">errc</span>&nbsp;<span class="op" id="7645449">&lt;-</span>&nbsp;<span class="ident" id="7645452">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7645457">}</span><span class="op" id="7645458">(</span><span class="op" id="7645459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7645462">select</span>&nbsp;<span class="op" id="7645469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7645472">case</span>&nbsp;<span class="op" id="7645477">&lt;-</span><span class="ident" id="7645479">time</span><span class="op" id="7645483">.</span><span class="ident" id="7645484">After</span><span class="op" id="7645489">(</span><span class="num" id="7645490">1</span>&nbsp;<span class="op" id="7645492">*</span>&nbsp;<span class="ident" id="7645494">time</span><span class="op" id="7645498">.</span><span class="ident" id="7645499">Second</span><span class="op" id="7645505">)</span><span class="op" id="7645506">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7645510">//&nbsp;Accept&nbsp;shouldn&#39;t&nbsp;block&nbsp;indefinitely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645551">t</span><span class="op" id="7645552">.</span><span class="ident" id="7645553">Errorf</span><span class="op" id="7645559">(</span><span class="string" id="7645560">&#34;Accept&nbsp;didn&#39;t&nbsp;return&nbsp;in&nbsp;an&nbsp;expected&nbsp;time&#34;</span><span class="op" id="7645602">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7645605">case</span>&nbsp;<span class="op" id="7645610">&lt;-</span><span class="ident" id="7645612">errc</span><span class="op" id="7645616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7645620">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7645630">}</span><br>
<span class="lineno"></span><span class="op" id="7645632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="7645635">func</span>&nbsp;<span class="ident" id="7645640">TestReadWriteDeadline</span><span class="op" id="7645661">(</span><span class="ident" id="7645662">t</span>&nbsp;<span class="op" id="7645664">*</span><span class="ident" id="7645665">testing</span><span class="op" id="7645672">.</span><span class="ident" id="7645673">T</span><span class="op" id="7645674">)</span>&nbsp;<span class="op" id="7645676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7645679">switch</span>&nbsp;<span class="ident" id="7645686">runtime</span><span class="op" id="7645693">.</span><span class="ident" id="7645694">GOOS</span>&nbsp;<span class="op" id="7645699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7645702">case</span>&nbsp;<span class="string" id="7645707">&#34;plan9&#34;</span><span class="op" id="7645714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645718">t</span><span class="op" id="7645719">.</span><span class="ident" id="7645720">Skipf</span><span class="op" id="7645725">(</span><span class="string" id="7645726">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7645747">,</span>&nbsp;<span class="ident" id="7645749">runtime</span><span class="op" id="7645756">.</span><span class="ident" id="7645757">GOOS</span><span class="op" id="7645761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7645764">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7645768">const</span>&nbsp;<span class="op" id="7645774">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645778">readTimeout</span>&nbsp;&nbsp;<span class="op" id="7645791">=</span>&nbsp;<span class="num" id="7645793">50</span>&nbsp;<span class="op" id="7645796">*</span>&nbsp;<span class="ident" id="7645798">time</span><span class="op" id="7645802">.</span><span class="ident" id="7645803">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645817">writeTimeout</span>&nbsp;<span class="op" id="7645830">=</span>&nbsp;<span class="num" id="7645832">250</span>&nbsp;<span class="op" id="7645836">*</span>&nbsp;<span class="ident" id="7645838">time</span><span class="op" id="7645842">.</span><span class="ident" id="7645843">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7645856">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645859">checkTimeout</span>&nbsp;<span class="op" id="7645872">:=</span>&nbsp;<span class="keyword" id="7645875">func</span><span class="op" id="7645879">(</span><span class="ident" id="7645880">command</span>&nbsp;<span class="builtintype" id="7645888">string</span><span class="op" id="7645894">,</span>&nbsp;<span class="ident" id="7645896">start</span>&nbsp;<span class="ident" id="7645902">time</span><span class="op" id="7645906">.</span><span class="ident" id="7645907">Time</span><span class="op" id="7645911">,</span>&nbsp;<span class="ident" id="7645913">should</span>&nbsp;<span class="ident" id="7645920">time</span><span class="op" id="7645924">.</span><span class="ident" id="7645925">Duration</span><span class="op" id="7645933">)</span>&nbsp;<span class="op" id="7645935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645939">is</span>&nbsp;<span class="op" id="7645942">:=</span>&nbsp;<span class="ident" id="7645945">time</span><span class="op" id="7645949">.</span><span class="ident" id="7645950">Now</span><span class="op" id="7645953">(</span><span class="op" id="7645954">)</span><span class="op" id="7645955">.</span><span class="ident" id="7645956">Sub</span><span class="op" id="7645959">(</span><span class="ident" id="7645960">start</span><span class="op" id="7645965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7645969">d</span>&nbsp;<span class="op" id="7645971">:=</span>&nbsp;<span class="ident" id="7645974">is</span>&nbsp;<span class="op" id="7645977">-</span>&nbsp;<span class="ident" id="7645979">should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7645988">if</span>&nbsp;<span class="ident" id="7645991">d</span>&nbsp;<span class="op" id="7645993">&lt;</span>&nbsp;<span class="op" id="7645995">-</span><span class="num" id="7645996">30</span><span class="op" id="7645998">*</span><span class="ident" id="7645999">time</span><span class="op" id="7646003">.</span><span class="ident" id="7646004">Millisecond</span>&nbsp;<span class="op" id="7646016">||</span>&nbsp;<span class="op" id="7646019">!</span><span class="ident" id="7646020">testing</span><span class="op" id="7646027">.</span><span class="ident" id="7646028">Short</span><span class="op" id="7646033">(</span><span class="op" id="7646034">)</span>&nbsp;<span class="op" id="7646036">&amp;&amp;</span>&nbsp;<span class="num" id="7646039">150</span><span class="op" id="7646042">*</span><span class="ident" id="7646043">time</span><span class="op" id="7646047">.</span><span class="ident" id="7646048">Millisecond</span>&nbsp;<span class="op" id="7646060">&lt;</span>&nbsp;<span class="ident" id="7646062">d</span>&nbsp;<span class="op" id="7646064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646069">t</span><span class="op" id="7646070">.</span><span class="ident" id="7646071">Errorf</span><span class="op" id="7646077">(</span><span class="string" id="7646078">&#34;%s&nbsp;timeout&nbsp;test&nbsp;failed:&nbsp;is=%v&nbsp;should=%v\n&#34;</span><span class="op" id="7646121">,</span>&nbsp;<span class="ident" id="7646123">command</span><span class="op" id="7646130">,</span>&nbsp;<span class="ident" id="7646132">is</span><span class="op" id="7646134">,</span>&nbsp;<span class="ident" id="7646136">should</span><span class="op" id="7646142">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7646146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7646149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646153">ln</span><span class="op" id="7646155">,</span>&nbsp;<span class="ident" id="7646157">err</span>&nbsp;<span class="op" id="7646161">:=</span>&nbsp;<span class="ident" id="7646164">Listen</span><span class="op" id="7646170">(</span><span class="string" id="7646171">&#34;tcp&#34;</span><span class="op" id="7646176">,</span>&nbsp;<span class="string" id="7646178">&#34;127.0.0.1:0&#34;</span><span class="op" id="7646191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7646194">if</span>&nbsp;<span class="ident" id="7646197">err</span>&nbsp;<span class="op" id="7646201">!=</span>&nbsp;<span class="ident" id="7646204">nil</span>&nbsp;<span class="op" id="7646208">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646212">t</span><span class="op" id="7646213">.</span><span class="ident" id="7646214">Fatalf</span><span class="op" id="7646220">(</span><span class="string" id="7646221">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="7646242">,</span>&nbsp;<span class="ident" id="7646244">err</span><span class="op" id="7646247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7646250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7646253">defer</span>&nbsp;<span class="ident" id="7646259">ln</span><span class="op" id="7646261">.</span><span class="ident" id="7646262">Close</span><span class="op" id="7646267">(</span><span class="op" id="7646268">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646272">lnquit</span>&nbsp;<span class="op" id="7646279">:=</span>&nbsp;<span class="builtinfunc" id="7646282">make</span><span class="op" id="7646286">(</span><span class="keyword" id="7646287">chan</span>&nbsp;<span class="builtintype" id="7646292">bool</span><span class="op" id="7646296">)</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7646300">go</span>&nbsp;<span class="keyword" id="7646303">func</span><span class="op" id="7646307">(</span><span class="op" id="7646308">)</span>&nbsp;<span class="op" id="7646310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646314">c</span><span class="op" id="7646315">,</span>&nbsp;<span class="ident" id="7646317">err</span>&nbsp;<span class="op" id="7646321">:=</span>&nbsp;<span class="ident" id="7646324">ln</span><span class="op" id="7646326">.</span><span class="ident" id="7646327">Accept</span><span class="op" id="7646333">(</span><span class="op" id="7646334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7646338">if</span>&nbsp;<span class="ident" id="7646341">err</span>&nbsp;<span class="op" id="7646345">!=</span>&nbsp;<span class="ident" id="7646348">nil</span>&nbsp;<span class="op" id="7646352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646357">t</span><span class="op" id="7646358">.</span><span class="ident" id="7646359">Errorf</span><span class="op" id="7646365">(</span><span class="string" id="7646366">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="7646378">,</span>&nbsp;<span class="ident" id="7646380">err</span><span class="op" id="7646383">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7646388">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7646397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7646401">defer</span>&nbsp;<span class="ident" id="7646407">c</span><span class="op" id="7646408">.</span><span class="ident" id="7646409">Close</span><span class="op" id="7646414">(</span><span class="op" id="7646415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646419">lnquit</span>&nbsp;<span class="op" id="7646426">&lt;-</span>&nbsp;<span class="builtintype" id="7646429">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7646435">}</span><span class="op" id="7646436">(</span><span class="op" id="7646437">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646441">c</span><span class="op" id="7646442">,</span>&nbsp;<span class="ident" id="7646444">err</span>&nbsp;<span class="op" id="7646448">:=</span>&nbsp;<span class="ident" id="7646451">Dial</span><span class="op" id="7646455">(</span><span class="string" id="7646456">&#34;tcp&#34;</span><span class="op" id="7646461">,</span>&nbsp;<span class="ident" id="7646463">ln</span><span class="op" id="7646465">.</span><span class="ident" id="7646466">Addr</span><span class="op" id="7646470">(</span><span class="op" id="7646471">)</span><span class="op" id="7646472">.</span><span class="ident" id="7646473">String</span><span class="op" id="7646479">(</span><span class="op" id="7646480">)</span><span class="op" id="7646481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7646484">if</span>&nbsp;<span class="ident" id="7646487">err</span>&nbsp;<span class="op" id="7646491">!=</span>&nbsp;<span class="ident" id="7646494">nil</span>&nbsp;<span class="op" id="7646498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646502">t</span><span class="op" id="7646503">.</span><span class="ident" id="7646504">Fatalf</span><span class="op" id="7646510">(</span><span class="string" id="7646511">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7646521">,</span>&nbsp;<span class="ident" id="7646523">err</span><span class="op" id="7646526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7646529">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7646532">defer</span>&nbsp;<span class="ident" id="7646538">c</span><span class="op" id="7646539">.</span><span class="ident" id="7646540">Close</span><span class="op" id="7646545">(</span><span class="op" id="7646546">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646550">start</span>&nbsp;<span class="op" id="7646556">:=</span>&nbsp;<span class="ident" id="7646559">time</span><span class="op" id="7646563">.</span><span class="ident" id="7646564">Now</span><span class="op" id="7646567">(</span><span class="op" id="7646568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646571">err</span>&nbsp;<span class="op" id="7646575">=</span>&nbsp;<span class="ident" id="7646577">c</span><span class="op" id="7646578">.</span><span class="ident" id="7646579">SetReadDeadline</span><span class="op" id="7646594">(</span><span class="ident" id="7646595">start</span><span class="op" id="7646600">.</span><span class="ident" id="7646601">Add</span><span class="op" id="7646604">(</span><span class="ident" id="7646605">readTimeout</span><span class="op" id="7646616">)</span><span class="op" id="7646617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7646620">if</span>&nbsp;<span class="ident" id="7646623">err</span>&nbsp;<span class="op" id="7646627">!=</span>&nbsp;<span class="ident" id="7646630">nil</span>&nbsp;<span class="op" id="7646634">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646638">t</span><span class="op" id="7646639">.</span><span class="ident" id="7646640">Fatalf</span><span class="op" id="7646646">(</span><span class="string" id="7646647">&#34;SetReadDeadline:&nbsp;%v&#34;</span><span class="op" id="7646668">,</span>&nbsp;<span class="ident" id="7646670">err</span><span class="op" id="7646673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7646676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646679">err</span>&nbsp;<span class="op" id="7646683">=</span>&nbsp;<span class="ident" id="7646685">c</span><span class="op" id="7646686">.</span><span class="ident" id="7646687">SetWriteDeadline</span><span class="op" id="7646703">(</span><span class="ident" id="7646704">start</span><span class="op" id="7646709">.</span><span class="ident" id="7646710">Add</span><span class="op" id="7646713">(</span><span class="ident" id="7646714">writeTimeout</span><span class="op" id="7646726">)</span><span class="op" id="7646727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7646730">if</span>&nbsp;<span class="ident" id="7646733">err</span>&nbsp;<span class="op" id="7646737">!=</span>&nbsp;<span class="ident" id="7646740">nil</span>&nbsp;<span class="op" id="7646744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646748">t</span><span class="op" id="7646749">.</span><span class="ident" id="7646750">Fatalf</span><span class="op" id="7646756">(</span><span class="string" id="7646757">&#34;SetWriteDeadline:&nbsp;%v&#34;</span><span class="op" id="7646779">,</span>&nbsp;<span class="ident" id="7646781">err</span><span class="op" id="7646784">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7646787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646791">quit</span>&nbsp;<span class="op" id="7646796">:=</span>&nbsp;<span class="builtinfunc" id="7646799">make</span><span class="op" id="7646803">(</span><span class="keyword" id="7646804">chan</span>&nbsp;<span class="builtintype" id="7646809">bool</span><span class="op" id="7646813">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7646817">go</span>&nbsp;<span class="keyword" id="7646820">func</span><span class="op" id="7646824">(</span><span class="op" id="7646825">)</span>&nbsp;<span class="op" id="7646827">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7646831">var</span>&nbsp;<span class="ident" id="7646835">buf</span>&nbsp;<span class="op" id="7646839">[</span><span class="num" id="7646840">10</span><span class="op" id="7646842">]</span><span class="builtintype" id="7646843">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646850">_</span><span class="op" id="7646851">,</span>&nbsp;<span class="ident" id="7646853">err</span>&nbsp;<span class="op" id="7646857">:=</span>&nbsp;<span class="ident" id="7646860">c</span><span class="op" id="7646861">.</span><span class="ident" id="7646862">Read</span><span class="op" id="7646866">(</span><span class="ident" id="7646867">buf</span><span class="op" id="7646870">[</span><span class="op" id="7646871">:</span><span class="op" id="7646872">]</span><span class="op" id="7646873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7646877">if</span>&nbsp;<span class="ident" id="7646880">err</span>&nbsp;<span class="op" id="7646884">==</span>&nbsp;<span class="ident" id="7646887">nil</span>&nbsp;<span class="op" id="7646891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646896">t</span><span class="op" id="7646897">.</span><span class="ident" id="7646898">Errorf</span><span class="op" id="7646904">(</span><span class="string" id="7646905">&#34;Read&nbsp;should&nbsp;not&nbsp;succeed&#34;</span><span class="op" id="7646930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7646934">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646938">checkTimeout</span><span class="op" id="7646950">(</span><span class="string" id="7646951">&#34;Read&#34;</span><span class="op" id="7646957">,</span>&nbsp;<span class="ident" id="7646959">start</span><span class="op" id="7646964">,</span>&nbsp;<span class="ident" id="7646966">readTimeout</span><span class="op" id="7646977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7646981">quit</span>&nbsp;<span class="op" id="7646986">&lt;-</span>&nbsp;<span class="builtintype" id="7646989">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7646995">}</span><span class="op" id="7646996">(</span><span class="op" id="7646997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647001">go</span>&nbsp;<span class="keyword" id="7647004">func</span><span class="op" id="7647008">(</span><span class="op" id="7647009">)</span>&nbsp;<span class="op" id="7647011">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647015">var</span>&nbsp;<span class="ident" id="7647019">buf</span>&nbsp;<span class="op" id="7647023">[</span><span class="num" id="7647024">10000</span><span class="op" id="7647029">]</span><span class="builtintype" id="7647030">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647037">for</span>&nbsp;<span class="op" id="7647041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7647046">_</span><span class="op" id="7647047">,</span>&nbsp;<span class="ident" id="7647049">err</span>&nbsp;<span class="op" id="7647053">:=</span>&nbsp;<span class="ident" id="7647056">c</span><span class="op" id="7647057">.</span><span class="ident" id="7647058">Write</span><span class="op" id="7647063">(</span><span class="ident" id="7647064">buf</span><span class="op" id="7647067">[</span><span class="op" id="7647068">:</span><span class="op" id="7647069">]</span><span class="op" id="7647070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647075">if</span>&nbsp;<span class="ident" id="7647078">err</span>&nbsp;<span class="op" id="7647082">!=</span>&nbsp;<span class="ident" id="7647085">nil</span>&nbsp;<span class="op" id="7647089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647095">break</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7647104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7647108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7647112">checkTimeout</span><span class="op" id="7647124">(</span><span class="string" id="7647125">&#34;Write&#34;</span><span class="op" id="7647132">,</span>&nbsp;<span class="ident" id="7647134">start</span><span class="op" id="7647139">,</span>&nbsp;<span class="ident" id="7647141">writeTimeout</span><span class="op" id="7647153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7647157">quit</span>&nbsp;<span class="op" id="7647162">&lt;-</span>&nbsp;<span class="builtintype" id="7647165">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7647171">}</span><span class="op" id="7647172">(</span><span class="op" id="7647173">)</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7647177">&lt;-</span><span class="ident" id="7647179">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7647185">&lt;-</span><span class="ident" id="7647187">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7647193">&lt;-</span><span class="ident" id="7647195">lnquit</span><br>
<span class="lineno"></span><span class="op" id="7647202">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="7647205">type</span>&nbsp;<span class="ident" id="7647210">neverEnding</span>&nbsp;<span class="builtintype" id="7647222">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7647228">func</span>&nbsp;<span class="op" id="7647233">(</span><span class="ident" id="7647234">b</span>&nbsp;<span class="ident" id="7647236">neverEnding</span><span class="op" id="7647247">)</span>&nbsp;<span class="ident" id="7647249">Read</span><span class="op" id="7647253">(</span><span class="ident" id="7647254">p</span>&nbsp;<span class="op" id="7647256">[</span><span class="op" id="7647257">]</span><span class="builtintype" id="7647258">byte</span><span class="op" id="7647262">)</span>&nbsp;<span class="op" id="7647264">(</span><span class="ident" id="7647265">n</span>&nbsp;<span class="builtintype" id="7647267">int</span><span class="op" id="7647270">,</span>&nbsp;<span class="ident" id="7647272">err</span>&nbsp;<span class="builtintype" id="7647276">error</span><span class="op" id="7647281">)</span>&nbsp;<span class="op" id="7647283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647286">for</span>&nbsp;<span class="ident" id="7647290">i</span>&nbsp;<span class="op" id="7647292">:=</span>&nbsp;<span class="keyword" id="7647295">range</span>&nbsp;<span class="ident" id="7647301">p</span>&nbsp;<span class="op" id="7647303">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7647307">p</span><span class="op" id="7647308">[</span><span class="ident" id="7647309">i</span><span class="op" id="7647310">]</span>&nbsp;<span class="op" id="7647312">=</span>&nbsp;<span class="builtintype" id="7647314">byte</span><span class="op" id="7647318">(</span><span class="ident" id="7647319">b</span><span class="op" id="7647320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7647323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647326">return</span>&nbsp;<span class="builtinfunc" id="7647333">len</span><span class="op" id="7647336">(</span><span class="ident" id="7647337">p</span><span class="op" id="7647338">)</span><span class="op" id="7647339">,</span>&nbsp;<span class="ident" id="7647341">nil</span><br>
<span class="lineno"></span><span class="op" id="7647345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="7647348">func</span>&nbsp;<span class="ident" id="7647353">TestVariousDeadlines1Proc</span><span class="op" id="7647378">(</span><span class="ident" id="7647379">t</span>&nbsp;<span class="op" id="7647381">*</span><span class="ident" id="7647382">testing</span><span class="op" id="7647389">.</span><span class="ident" id="7647390">T</span><span class="op" id="7647391">)</span>&nbsp;<span class="op" id="7647393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7647396">testVariousDeadlines</span><span class="op" id="7647416">(</span><span class="ident" id="7647417">t</span><span class="op" id="7647418">,</span>&nbsp;<span class="num" id="7647420">1</span><span class="op" id="7647421">)</span><br>
<span class="lineno"></span><span class="op" id="7647423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7647426">func</span>&nbsp;<span class="ident" id="7647431">TestVariousDeadlines4Proc</span><span class="op" id="7647456">(</span><span class="ident" id="7647457">t</span>&nbsp;<span class="op" id="7647459">*</span><span class="ident" id="7647460">testing</span><span class="op" id="7647467">.</span><span class="ident" id="7647468">T</span><span class="op" id="7647469">)</span>&nbsp;<span class="op" id="7647471">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7647474">testVariousDeadlines</span><span class="op" id="7647494">(</span><span class="ident" id="7647495">t</span><span class="op" id="7647496">,</span>&nbsp;<span class="num" id="7647498">4</span><span class="op" id="7647499">)</span><br>
<span class="lineno"></span><span class="op" id="7647501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7647504">func</span>&nbsp;<span class="ident" id="7647509">testVariousDeadlines</span><span class="op" id="7647529">(</span><span class="ident" id="7647530">t</span>&nbsp;<span class="op" id="7647532">*</span><span class="ident" id="7647533">testing</span><span class="op" id="7647540">.</span><span class="ident" id="7647541">T</span><span class="op" id="7647542">,</span>&nbsp;<span class="ident" id="7647544">maxProcs</span>&nbsp;<span class="builtintype" id="7647553">int</span><span class="op" id="7647556">)</span>&nbsp;<span class="op" id="7647558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647561">switch</span>&nbsp;<span class="ident" id="7647568">runtime</span><span class="op" id="7647575">.</span><span class="ident" id="7647576">GOOS</span>&nbsp;<span class="op" id="7647581">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647584">case</span>&nbsp;<span class="string" id="7647589">&#34;plan9&#34;</span><span class="op" id="7647596">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7647600">t</span><span class="op" id="7647601">.</span><span class="ident" id="7647602">Skipf</span><span class="op" id="7647607">(</span><span class="string" id="7647608">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7647629">,</span>&nbsp;<span class="ident" id="7647631">runtime</span><span class="op" id="7647638">.</span><span class="ident" id="7647639">GOOS</span><span class="op" id="7647643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7647646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647650">defer</span>&nbsp;<span class="ident" id="7647656">runtime</span><span class="op" id="7647663">.</span><span class="ident" id="7647664">GOMAXPROCS</span><span class="op" id="7647674">(</span><span class="ident" id="7647675">runtime</span><span class="op" id="7647682">.</span><span class="ident" id="7647683">GOMAXPROCS</span><span class="op" id="7647693">(</span><span class="ident" id="7647694">maxProcs</span><span class="op" id="7647702">)</span><span class="op" id="7647703">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7647706">ln</span>&nbsp;<span class="op" id="7647709">:=</span>&nbsp;<span class="ident" id="7647712">newLocalListener</span><span class="op" id="7647728">(</span><span class="ident" id="7647729">t</span><span class="op" id="7647730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647733">defer</span>&nbsp;<span class="ident" id="7647739">ln</span><span class="op" id="7647741">.</span><span class="ident" id="7647742">Close</span><span class="op" id="7647747">(</span><span class="op" id="7647748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7647751">acceptc</span>&nbsp;<span class="op" id="7647759">:=</span>&nbsp;<span class="builtinfunc" id="7647762">make</span><span class="op" id="7647766">(</span><span class="keyword" id="7647767">chan</span>&nbsp;<span class="builtintype" id="7647772">error</span><span class="op" id="7647777">,</span>&nbsp;<span class="num" id="7647779">1</span><span class="op" id="7647780">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7647784">//&nbsp;The&nbsp;server,&nbsp;with&nbsp;no&nbsp;timeouts&nbsp;of&nbsp;its&nbsp;own,&nbsp;sending&nbsp;bytes&nbsp;to&nbsp;clients</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7647854">//&nbsp;as&nbsp;fast&nbsp;as&nbsp;it&nbsp;can.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7647877">servec</span>&nbsp;<span class="op" id="7647884">:=</span>&nbsp;<span class="builtinfunc" id="7647887">make</span><span class="op" id="7647891">(</span><span class="keyword" id="7647892">chan</span>&nbsp;<span class="ident" id="7647897">copyRes</span><span class="op" id="7647904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647907">go</span>&nbsp;<span class="keyword" id="7647910">func</span><span class="op" id="7647914">(</span><span class="op" id="7647915">)</span>&nbsp;<span class="op" id="7647917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647921">for</span>&nbsp;<span class="op" id="7647925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7647930">c</span><span class="op" id="7647931">,</span>&nbsp;<span class="ident" id="7647933">err</span>&nbsp;<span class="op" id="7647937">:=</span>&nbsp;<span class="ident" id="7647940">ln</span><span class="op" id="7647942">.</span><span class="ident" id="7647943">Accept</span><span class="op" id="7647949">(</span><span class="op" id="7647950">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647955">if</span>&nbsp;<span class="ident" id="7647958">err</span>&nbsp;<span class="op" id="7647962">!=</span>&nbsp;<span class="ident" id="7647965">nil</span>&nbsp;<span class="op" id="7647969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7647975">acceptc</span>&nbsp;<span class="op" id="7647983">&lt;-</span>&nbsp;<span class="ident" id="7647986">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7647994">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7648004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7648009">go</span>&nbsp;<span class="keyword" id="7648012">func</span><span class="op" id="7648016">(</span><span class="op" id="7648017">)</span>&nbsp;<span class="op" id="7648019">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7648025">t0</span>&nbsp;<span class="op" id="7648028">:=</span>&nbsp;<span class="ident" id="7648031">time</span><span class="op" id="7648035">.</span><span class="ident" id="7648036">Now</span><span class="op" id="7648039">(</span><span class="op" id="7648040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7648046">n</span><span class="op" id="7648047">,</span>&nbsp;<span class="ident" id="7648049">err</span>&nbsp;<span class="op" id="7648053">:=</span>&nbsp;<span class="ident" id="7648056">io</span><span class="op" id="7648058">.</span><span class="ident" id="7648059">Copy</span><span class="op" id="7648063">(</span><span class="ident" id="7648064">c</span><span class="op" id="7648065">,</span>&nbsp;<span class="ident" id="7648067">neverEnding</span><span class="op" id="7648078">(</span><span class="string" id="7648079">&#39;a&#39;</span><span class="op" id="7648082">)</span><span class="op" id="7648083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7648089">d</span>&nbsp;<span class="op" id="7648091">:=</span>&nbsp;<span class="ident" id="7648094">time</span><span class="op" id="7648098">.</span><span class="ident" id="7648099">Since</span><span class="op" id="7648104">(</span><span class="ident" id="7648105">t0</span><span class="op" id="7648107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7648113">c</span><span class="op" id="7648114">.</span><span class="ident" id="7648115">Close</span><span class="op" id="7648120">(</span><span class="op" id="7648121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7648127">servec</span>&nbsp;<span class="op" id="7648134">&lt;-</span>&nbsp;<span class="ident" id="7648137">copyRes</span><span class="op" id="7648144">{</span><span class="ident" id="7648145">n</span><span class="op" id="7648146">,</span>&nbsp;<span class="ident" id="7648148">err</span><span class="op" id="7648151">,</span>&nbsp;<span class="ident" id="7648153">d</span><span class="op" id="7648154">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7648159">}</span><span class="op" id="7648160">(</span><span class="op" id="7648161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7648165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7648168">}</span><span class="op" id="7648169">(</span><span class="op" id="7648170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7648174">for</span>&nbsp;<span class="ident" id="7648178">_</span><span class="op" id="7648179">,</span>&nbsp;<span class="ident" id="7648181">timeout</span>&nbsp;<span class="op" id="7648189">:=</span>&nbsp;<span class="keyword" id="7648192">range</span>&nbsp;<span class="op" id="7648198">[</span><span class="op" id="7648199">]</span><span class="ident" id="7648200">time</span><span class="op" id="7648204">.</span><span class="ident" id="7648205">Duration</span><span class="op" id="7648213">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648217">1</span>&nbsp;<span class="op" id="7648219">*</span>&nbsp;<span class="ident" id="7648221">time</span><span class="op" id="7648225">.</span><span class="ident" id="7648226">Nanosecond</span><span class="op" id="7648236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648240">2</span>&nbsp;<span class="op" id="7648242">*</span>&nbsp;<span class="ident" id="7648244">time</span><span class="op" id="7648248">.</span><span class="ident" id="7648249">Nanosecond</span><span class="op" id="7648259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648263">5</span>&nbsp;<span class="op" id="7648265">*</span>&nbsp;<span class="ident" id="7648267">time</span><span class="op" id="7648271">.</span><span class="ident" id="7648272">Nanosecond</span><span class="op" id="7648282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648286">50</span>&nbsp;<span class="op" id="7648289">*</span>&nbsp;<span class="ident" id="7648291">time</span><span class="op" id="7648295">.</span><span class="ident" id="7648296">Nanosecond</span><span class="op" id="7648306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648310">100</span>&nbsp;<span class="op" id="7648314">*</span>&nbsp;<span class="ident" id="7648316">time</span><span class="op" id="7648320">.</span><span class="ident" id="7648321">Nanosecond</span><span class="op" id="7648331">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648335">200</span>&nbsp;<span class="op" id="7648339">*</span>&nbsp;<span class="ident" id="7648341">time</span><span class="op" id="7648345">.</span><span class="ident" id="7648346">Nanosecond</span><span class="op" id="7648356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648360">500</span>&nbsp;<span class="op" id="7648364">*</span>&nbsp;<span class="ident" id="7648366">time</span><span class="op" id="7648370">.</span><span class="ident" id="7648371">Nanosecond</span><span class="op" id="7648381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648385">750</span>&nbsp;<span class="op" id="7648389">*</span>&nbsp;<span class="ident" id="7648391">time</span><span class="op" id="7648395">.</span><span class="ident" id="7648396">Nanosecond</span><span class="op" id="7648406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648410">1</span>&nbsp;<span class="op" id="7648412">*</span>&nbsp;<span class="ident" id="7648414">time</span><span class="op" id="7648418">.</span><span class="ident" id="7648419">Microsecond</span><span class="op" id="7648430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648434">5</span>&nbsp;<span class="op" id="7648436">*</span>&nbsp;<span class="ident" id="7648438">time</span><span class="op" id="7648442">.</span><span class="ident" id="7648443">Microsecond</span><span class="op" id="7648454">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648458">25</span>&nbsp;<span class="op" id="7648461">*</span>&nbsp;<span class="ident" id="7648463">time</span><span class="op" id="7648467">.</span><span class="ident" id="7648468">Microsecond</span><span class="op" id="7648479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648483">250</span>&nbsp;<span class="op" id="7648487">*</span>&nbsp;<span class="ident" id="7648489">time</span><span class="op" id="7648493">.</span><span class="ident" id="7648494">Microsecond</span><span class="op" id="7648505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648509">500</span>&nbsp;<span class="op" id="7648513">*</span>&nbsp;<span class="ident" id="7648515">time</span><span class="op" id="7648519">.</span><span class="ident" id="7648520">Microsecond</span><span class="op" id="7648531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648535">1</span>&nbsp;<span class="op" id="7648537">*</span>&nbsp;<span class="ident" id="7648539">time</span><span class="op" id="7648543">.</span><span class="ident" id="7648544">Millisecond</span><span class="op" id="7648555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648559">5</span>&nbsp;<span class="op" id="7648561">*</span>&nbsp;<span class="ident" id="7648563">time</span><span class="op" id="7648567">.</span><span class="ident" id="7648568">Millisecond</span><span class="op" id="7648579">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648583">100</span>&nbsp;<span class="op" id="7648587">*</span>&nbsp;<span class="ident" id="7648589">time</span><span class="op" id="7648593">.</span><span class="ident" id="7648594">Millisecond</span><span class="op" id="7648605">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648609">250</span>&nbsp;<span class="op" id="7648613">*</span>&nbsp;<span class="ident" id="7648615">time</span><span class="op" id="7648619">.</span><span class="ident" id="7648620">Millisecond</span><span class="op" id="7648631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648635">500</span>&nbsp;<span class="op" id="7648639">*</span>&nbsp;<span class="ident" id="7648641">time</span><span class="op" id="7648645">.</span><span class="ident" id="7648646">Millisecond</span><span class="op" id="7648657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7648661">1</span>&nbsp;<span class="op" id="7648663">*</span>&nbsp;<span class="ident" id="7648665">time</span><span class="op" id="7648669">.</span><span class="ident" id="7648670">Second</span><span class="op" id="7648676">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7648679">}</span>&nbsp;<span class="op" id="7648681">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7648685">numRuns</span>&nbsp;<span class="op" id="7648693">:=</span>&nbsp;<span class="num" id="7648696">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7648700">if</span>&nbsp;<span class="ident" id="7648703">testing</span><span class="op" id="7648710">.</span><span class="ident" id="7648711">Short</span><span class="op" id="7648716">(</span><span class="op" id="7648717">)</span>&nbsp;<span class="op" id="7648719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7648724">numRuns</span>&nbsp;<span class="op" id="7648732">=</span>&nbsp;<span class="num" id="7648734">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7648739">if</span>&nbsp;<span class="ident" id="7648742">timeout</span>&nbsp;<span class="op" id="7648750">&gt;</span>&nbsp;<span class="num" id="7648752">500</span><span class="op" id="7648755">*</span><span class="ident" id="7648756">time</span><span class="op" id="7648760">.</span><span class="ident" id="7648761">Microsecond</span>&nbsp;<span class="op" id="7648773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7648779">continue</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7648791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7648795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7648799">for</span>&nbsp;<span class="ident" id="7648803">run</span>&nbsp;<span class="op" id="7648807">:=</span>&nbsp;<span class="num" id="7648810">0</span><span class="op" id="7648811">;</span>&nbsp;<span class="ident" id="7648813">run</span>&nbsp;<span class="op" id="7648817">&lt;</span>&nbsp;<span class="ident" id="7648819">numRuns</span><span class="op" id="7648826">;</span>&nbsp;<span class="ident" id="7648828">run</span><span class="op" id="7648831">++</span>&nbsp;<span class="op" id="7648834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7648839">name</span>&nbsp;<span class="op" id="7648844">:=</span>&nbsp;<span class="ident" id="7648847">fmt</span><span class="op" id="7648850">.</span><span class="ident" id="7648851">Sprintf</span><span class="op" id="7648858">(</span><span class="string" id="7648859">&#34;%v&nbsp;run&nbsp;%d/%d&#34;</span><span class="op" id="7648873">,</span>&nbsp;<span class="ident" id="7648875">timeout</span><span class="op" id="7648882">,</span>&nbsp;<span class="ident" id="7648884">run</span><span class="op" id="7648887">+</span><span class="num" id="7648888">1</span><span class="op" id="7648889">,</span>&nbsp;<span class="ident" id="7648891">numRuns</span><span class="op" id="7648898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7648903">t</span><span class="op" id="7648904">.</span><span class="ident" id="7648905">Log</span><span class="op" id="7648908">(</span><span class="ident" id="7648909">name</span><span class="op" id="7648913">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7648919">c</span><span class="op" id="7648920">,</span>&nbsp;<span class="ident" id="7648922">err</span>&nbsp;<span class="op" id="7648926">:=</span>&nbsp;<span class="ident" id="7648929">Dial</span><span class="op" id="7648933">(</span><span class="string" id="7648934">&#34;tcp&#34;</span><span class="op" id="7648939">,</span>&nbsp;<span class="ident" id="7648941">ln</span><span class="op" id="7648943">.</span><span class="ident" id="7648944">Addr</span><span class="op" id="7648948">(</span><span class="op" id="7648949">)</span><span class="op" id="7648950">.</span><span class="ident" id="7648951">String</span><span class="op" id="7648957">(</span><span class="op" id="7648958">)</span><span class="op" id="7648959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7648964">if</span>&nbsp;<span class="ident" id="7648967">err</span>&nbsp;<span class="op" id="7648971">!=</span>&nbsp;<span class="ident" id="7648974">nil</span>&nbsp;<span class="op" id="7648978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7648984">t</span><span class="op" id="7648985">.</span><span class="ident" id="7648986">Fatalf</span><span class="op" id="7648992">(</span><span class="string" id="7648993">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7649003">,</span>&nbsp;<span class="ident" id="7649005">err</span><span class="op" id="7649008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7649013">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649018">clientc</span>&nbsp;<span class="op" id="7649026">:=</span>&nbsp;<span class="builtinfunc" id="7649029">make</span><span class="op" id="7649033">(</span><span class="keyword" id="7649034">chan</span>&nbsp;<span class="ident" id="7649039">copyRes</span><span class="op" id="7649046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7649051">go</span>&nbsp;<span class="keyword" id="7649054">func</span><span class="op" id="7649058">(</span><span class="op" id="7649059">)</span>&nbsp;<span class="op" id="7649061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649067">t0</span>&nbsp;<span class="op" id="7649070">:=</span>&nbsp;<span class="ident" id="7649073">time</span><span class="op" id="7649077">.</span><span class="ident" id="7649078">Now</span><span class="op" id="7649081">(</span><span class="op" id="7649082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649088">c</span><span class="op" id="7649089">.</span><span class="ident" id="7649090">SetDeadline</span><span class="op" id="7649101">(</span><span class="ident" id="7649102">t0</span><span class="op" id="7649104">.</span><span class="ident" id="7649105">Add</span><span class="op" id="7649108">(</span><span class="ident" id="7649109">timeout</span><span class="op" id="7649116">)</span><span class="op" id="7649117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649123">n</span><span class="op" id="7649124">,</span>&nbsp;<span class="ident" id="7649126">err</span>&nbsp;<span class="op" id="7649130">:=</span>&nbsp;<span class="ident" id="7649133">io</span><span class="op" id="7649135">.</span><span class="ident" id="7649136">Copy</span><span class="op" id="7649140">(</span><span class="ident" id="7649141">ioutil</span><span class="op" id="7649147">.</span><span class="ident" id="7649148">Discard</span><span class="op" id="7649155">,</span>&nbsp;<span class="ident" id="7649157">c</span><span class="op" id="7649158">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649164">d</span>&nbsp;<span class="op" id="7649166">:=</span>&nbsp;<span class="ident" id="7649169">time</span><span class="op" id="7649173">.</span><span class="ident" id="7649174">Since</span><span class="op" id="7649179">(</span><span class="ident" id="7649180">t0</span><span class="op" id="7649182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649188">c</span><span class="op" id="7649189">.</span><span class="ident" id="7649190">Close</span><span class="op" id="7649195">(</span><span class="op" id="7649196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649202">clientc</span>&nbsp;<span class="op" id="7649210">&lt;-</span>&nbsp;<span class="ident" id="7649213">copyRes</span><span class="op" id="7649220">{</span><span class="ident" id="7649221">n</span><span class="op" id="7649222">,</span>&nbsp;<span class="ident" id="7649224">err</span><span class="op" id="7649227">,</span>&nbsp;<span class="ident" id="7649229">d</span><span class="op" id="7649230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7649235">}</span><span class="op" id="7649236">(</span><span class="op" id="7649237">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649243">tooLong</span>&nbsp;<span class="op" id="7649251">:=</span>&nbsp;<span class="num" id="7649254">5</span>&nbsp;<span class="op" id="7649256">*</span>&nbsp;<span class="ident" id="7649258">time</span><span class="op" id="7649262">.</span><span class="ident" id="7649263">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7649273">select</span>&nbsp;<span class="op" id="7649280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7649285">case</span>&nbsp;<span class="ident" id="7649290">res</span>&nbsp;<span class="op" id="7649294">:=</span>&nbsp;<span class="op" id="7649297">&lt;-</span><span class="ident" id="7649299">clientc</span><span class="op" id="7649306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7649312">if</span>&nbsp;<span class="ident" id="7649315">isTimeout</span><span class="op" id="7649324">(</span><span class="ident" id="7649325">res</span><span class="op" id="7649328">.</span><span class="ident" id="7649329">err</span><span class="op" id="7649332">)</span>&nbsp;<span class="op" id="7649334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649341">t</span><span class="op" id="7649342">.</span><span class="ident" id="7649343">Logf</span><span class="op" id="7649347">(</span><span class="string" id="7649348">&#34;for&nbsp;%v,&nbsp;good&nbsp;client&nbsp;timeout&nbsp;after&nbsp;%v,&nbsp;reading&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7649404">,</span>&nbsp;<span class="ident" id="7649406">name</span><span class="op" id="7649410">,</span>&nbsp;<span class="ident" id="7649412">res</span><span class="op" id="7649415">.</span><span class="ident" id="7649416">d</span><span class="op" id="7649417">,</span>&nbsp;<span class="ident" id="7649419">res</span><span class="op" id="7649422">.</span><span class="ident" id="7649423">n</span><span class="op" id="7649424">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7649430">}</span>&nbsp;<span class="keyword" id="7649432">else</span>&nbsp;<span class="op" id="7649437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649444">t</span><span class="op" id="7649445">.</span><span class="ident" id="7649446">Fatalf</span><span class="op" id="7649452">(</span><span class="string" id="7649453">&#34;for&nbsp;%v:&nbsp;client&nbsp;Copy&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;(want&nbsp;timeout)&#34;</span><span class="op" id="7649498">,</span>&nbsp;<span class="ident" id="7649500">name</span><span class="op" id="7649504">,</span>&nbsp;<span class="ident" id="7649506">res</span><span class="op" id="7649509">.</span><span class="ident" id="7649510">n</span><span class="op" id="7649511">,</span>&nbsp;<span class="ident" id="7649513">res</span><span class="op" id="7649516">.</span><span class="ident" id="7649517">err</span><span class="op" id="7649520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7649526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7649531">case</span>&nbsp;<span class="op" id="7649536">&lt;-</span><span class="ident" id="7649538">time</span><span class="op" id="7649542">.</span><span class="ident" id="7649543">After</span><span class="op" id="7649548">(</span><span class="ident" id="7649549">tooLong</span><span class="op" id="7649556">)</span><span class="op" id="7649557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649563">t</span><span class="op" id="7649564">.</span><span class="ident" id="7649565">Fatalf</span><span class="op" id="7649571">(</span><span class="string" id="7649572">&#34;for&nbsp;%v:&nbsp;timeout&nbsp;(%v)&nbsp;waiting&nbsp;for&nbsp;client&nbsp;to&nbsp;timeout&nbsp;(%v)&nbsp;reading&#34;</span><span class="op" id="7649637">,</span>&nbsp;<span class="ident" id="7649639">name</span><span class="op" id="7649643">,</span>&nbsp;<span class="ident" id="7649645">tooLong</span><span class="op" id="7649652">,</span>&nbsp;<span class="ident" id="7649654">timeout</span><span class="op" id="7649661">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7649666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7649672">select</span>&nbsp;<span class="op" id="7649679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7649684">case</span>&nbsp;<span class="ident" id="7649689">res</span>&nbsp;<span class="op" id="7649693">:=</span>&nbsp;<span class="op" id="7649696">&lt;-</span><span class="ident" id="7649698">servec</span><span class="op" id="7649704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649710">t</span><span class="op" id="7649711">.</span><span class="ident" id="7649712">Logf</span><span class="op" id="7649716">(</span><span class="string" id="7649717">&#34;for&nbsp;%v:&nbsp;server&nbsp;in&nbsp;%v&nbsp;wrote&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="7649752">,</span>&nbsp;<span class="ident" id="7649754">name</span><span class="op" id="7649758">,</span>&nbsp;<span class="ident" id="7649760">res</span><span class="op" id="7649763">.</span><span class="ident" id="7649764">d</span><span class="op" id="7649765">,</span>&nbsp;<span class="ident" id="7649767">res</span><span class="op" id="7649770">.</span><span class="ident" id="7649771">n</span><span class="op" id="7649772">,</span>&nbsp;<span class="ident" id="7649774">res</span><span class="op" id="7649777">.</span><span class="ident" id="7649778">err</span><span class="op" id="7649781">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7649786">case</span>&nbsp;<span class="ident" id="7649791">err</span>&nbsp;<span class="op" id="7649795">:=</span>&nbsp;<span class="op" id="7649798">&lt;-</span><span class="ident" id="7649800">acceptc</span><span class="op" id="7649807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649813">t</span><span class="op" id="7649814">.</span><span class="ident" id="7649815">Fatalf</span><span class="op" id="7649821">(</span><span class="string" id="7649822">&#34;for&nbsp;%v:&nbsp;server&nbsp;Accept&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7649850">,</span>&nbsp;<span class="ident" id="7649852">name</span><span class="op" id="7649856">,</span>&nbsp;<span class="ident" id="7649858">err</span><span class="op" id="7649861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7649866">case</span>&nbsp;<span class="op" id="7649871">&lt;-</span><span class="ident" id="7649873">time</span><span class="op" id="7649877">.</span><span class="ident" id="7649878">After</span><span class="op" id="7649883">(</span><span class="ident" id="7649884">tooLong</span><span class="op" id="7649891">)</span><span class="op" id="7649892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7649898">t</span><span class="op" id="7649899">.</span><span class="ident" id="7649900">Fatalf</span><span class="op" id="7649906">(</span><span class="string" id="7649907">&#34;for&nbsp;%v,&nbsp;timeout&nbsp;waiting&nbsp;for&nbsp;server&nbsp;to&nbsp;finish&nbsp;writing&#34;</span><span class="op" id="7649961">,</span>&nbsp;<span class="ident" id="7649963">name</span><span class="op" id="7649967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7649972">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7649976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7649979">}</span><br>
<span class="lineno"></span><span class="op" id="7649981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7649984">//&nbsp;TestReadDeadlineDataAvailable&nbsp;tests&nbsp;that&nbsp;read&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">525</span><span class="comment" id="7650054">//&nbsp;if&nbsp;there&#39;s&nbsp;data&nbsp;ready&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="7650091">func</span>&nbsp;<span class="ident" id="7650096">TestReadDeadlineDataAvailable</span><span class="op" id="7650125">(</span><span class="ident" id="7650126">t</span>&nbsp;<span class="op" id="7650128">*</span><span class="ident" id="7650129">testing</span><span class="op" id="7650136">.</span><span class="ident" id="7650137">T</span><span class="op" id="7650138">)</span>&nbsp;<span class="op" id="7650140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650143">switch</span>&nbsp;<span class="ident" id="7650150">runtime</span><span class="op" id="7650157">.</span><span class="ident" id="7650158">GOOS</span>&nbsp;<span class="op" id="7650163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650166">case</span>&nbsp;<span class="string" id="7650171">&#34;plan9&#34;</span><span class="op" id="7650178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650182">t</span><span class="op" id="7650183">.</span><span class="ident" id="7650184">Skipf</span><span class="op" id="7650189">(</span><span class="string" id="7650190">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7650211">,</span>&nbsp;<span class="ident" id="7650213">runtime</span><span class="op" id="7650220">.</span><span class="ident" id="7650221">GOOS</span><span class="op" id="7650225">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7650228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650232">ln</span>&nbsp;<span class="op" id="7650235">:=</span>&nbsp;<span class="ident" id="7650238">newLocalListener</span><span class="op" id="7650254">(</span><span class="ident" id="7650255">t</span><span class="op" id="7650256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650259">defer</span>&nbsp;<span class="ident" id="7650265">ln</span><span class="op" id="7650267">.</span><span class="ident" id="7650268">Close</span><span class="op" id="7650273">(</span><span class="op" id="7650274">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650278">servec</span>&nbsp;<span class="op" id="7650285">:=</span>&nbsp;<span class="builtinfunc" id="7650288">make</span><span class="op" id="7650292">(</span><span class="keyword" id="7650293">chan</span>&nbsp;<span class="ident" id="7650298">copyRes</span><span class="op" id="7650305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650308">const</span>&nbsp;<span class="ident" id="7650314">msg</span>&nbsp;<span class="op" id="7650318">=</span>&nbsp;<span class="string" id="7650320">&#34;data&nbsp;client&nbsp;shouldn&#39;t&nbsp;read,&nbsp;even&nbsp;though&nbsp;it&#39;ll&nbsp;be&nbsp;waiting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650380">go</span>&nbsp;<span class="keyword" id="7650383">func</span><span class="op" id="7650387">(</span><span class="op" id="7650388">)</span>&nbsp;<span class="op" id="7650390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650394">c</span><span class="op" id="7650395">,</span>&nbsp;<span class="ident" id="7650397">err</span>&nbsp;<span class="op" id="7650401">:=</span>&nbsp;<span class="ident" id="7650404">ln</span><span class="op" id="7650406">.</span><span class="ident" id="7650407">Accept</span><span class="op" id="7650413">(</span><span class="op" id="7650414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650418">if</span>&nbsp;<span class="ident" id="7650421">err</span>&nbsp;<span class="op" id="7650425">!=</span>&nbsp;<span class="ident" id="7650428">nil</span>&nbsp;<span class="op" id="7650432">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650437">t</span><span class="op" id="7650438">.</span><span class="ident" id="7650439">Errorf</span><span class="op" id="7650445">(</span><span class="string" id="7650446">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="7650458">,</span>&nbsp;<span class="ident" id="7650460">err</span><span class="op" id="7650463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650468">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7650477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650481">defer</span>&nbsp;<span class="ident" id="7650487">c</span><span class="op" id="7650488">.</span><span class="ident" id="7650489">Close</span><span class="op" id="7650494">(</span><span class="op" id="7650495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650499">n</span><span class="op" id="7650500">,</span>&nbsp;<span class="ident" id="7650502">err</span>&nbsp;<span class="op" id="7650506">:=</span>&nbsp;<span class="ident" id="7650509">c</span><span class="op" id="7650510">.</span><span class="ident" id="7650511">Write</span><span class="op" id="7650516">(</span><span class="op" id="7650517">[</span><span class="op" id="7650518">]</span><span class="builtintype" id="7650519">byte</span><span class="op" id="7650523">(</span><span class="ident" id="7650524">msg</span><span class="op" id="7650527">)</span><span class="op" id="7650528">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650532">servec</span>&nbsp;<span class="op" id="7650539">&lt;-</span>&nbsp;<span class="ident" id="7650542">copyRes</span><span class="op" id="7650549">{</span><span class="ident" id="7650550">n</span><span class="op" id="7650551">:</span>&nbsp;<span class="ident" id="7650553">int64</span><span class="op" id="7650558">(</span><span class="ident" id="7650559">n</span><span class="op" id="7650560">)</span><span class="op" id="7650561">,</span>&nbsp;<span class="ident" id="7650563">err</span><span class="op" id="7650566">:</span>&nbsp;<span class="ident" id="7650568">err</span><span class="op" id="7650571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7650574">}</span><span class="op" id="7650575">(</span><span class="op" id="7650576">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650580">c</span><span class="op" id="7650581">,</span>&nbsp;<span class="ident" id="7650583">err</span>&nbsp;<span class="op" id="7650587">:=</span>&nbsp;<span class="ident" id="7650590">Dial</span><span class="op" id="7650594">(</span><span class="string" id="7650595">&#34;tcp&#34;</span><span class="op" id="7650600">,</span>&nbsp;<span class="ident" id="7650602">ln</span><span class="op" id="7650604">.</span><span class="ident" id="7650605">Addr</span><span class="op" id="7650609">(</span><span class="op" id="7650610">)</span><span class="op" id="7650611">.</span><span class="ident" id="7650612">String</span><span class="op" id="7650618">(</span><span class="op" id="7650619">)</span><span class="op" id="7650620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650623">if</span>&nbsp;<span class="ident" id="7650626">err</span>&nbsp;<span class="op" id="7650630">!=</span>&nbsp;<span class="ident" id="7650633">nil</span>&nbsp;<span class="op" id="7650637">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650641">t</span><span class="op" id="7650642">.</span><span class="ident" id="7650643">Fatalf</span><span class="op" id="7650649">(</span><span class="string" id="7650650">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7650660">,</span>&nbsp;<span class="ident" id="7650662">err</span><span class="op" id="7650665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7650668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650671">defer</span>&nbsp;<span class="ident" id="7650677">c</span><span class="op" id="7650678">.</span><span class="ident" id="7650679">Close</span><span class="op" id="7650684">(</span><span class="op" id="7650685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650688">if</span>&nbsp;<span class="ident" id="7650691">res</span>&nbsp;<span class="op" id="7650695">:=</span>&nbsp;<span class="op" id="7650698">&lt;-</span><span class="ident" id="7650700">servec</span><span class="op" id="7650706">;</span>&nbsp;<span class="ident" id="7650708">res</span><span class="op" id="7650711">.</span><span class="ident" id="7650712">err</span>&nbsp;<span class="op" id="7650716">!=</span>&nbsp;<span class="ident" id="7650719">nil</span>&nbsp;<span class="op" id="7650723">||</span>&nbsp;<span class="ident" id="7650726">res</span><span class="op" id="7650729">.</span><span class="ident" id="7650730">n</span>&nbsp;<span class="op" id="7650732">!=</span>&nbsp;<span class="ident" id="7650735">int64</span><span class="op" id="7650740">(</span><span class="builtinfunc" id="7650741">len</span><span class="op" id="7650744">(</span><span class="ident" id="7650745">msg</span><span class="op" id="7650748">)</span><span class="op" id="7650749">)</span>&nbsp;<span class="op" id="7650751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650755">t</span><span class="op" id="7650756">.</span><span class="ident" id="7650757">Fatalf</span><span class="op" id="7650763">(</span><span class="string" id="7650764">&#34;unexpected&nbsp;server&nbsp;Write:&nbsp;n=%d,&nbsp;err=%v;&nbsp;want&nbsp;n=%d,&nbsp;err=nil&#34;</span><span class="op" id="7650823">,</span>&nbsp;<span class="ident" id="7650825">res</span><span class="op" id="7650828">.</span><span class="ident" id="7650829">n</span><span class="op" id="7650830">,</span>&nbsp;<span class="ident" id="7650832">res</span><span class="op" id="7650835">.</span><span class="ident" id="7650836">err</span><span class="op" id="7650839">,</span>&nbsp;<span class="builtinfunc" id="7650841">len</span><span class="op" id="7650844">(</span><span class="ident" id="7650845">msg</span><span class="op" id="7650848">)</span><span class="op" id="7650849">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7650852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650855">c</span><span class="op" id="7650856">.</span><span class="ident" id="7650857">SetReadDeadline</span><span class="op" id="7650872">(</span><span class="ident" id="7650873">time</span><span class="op" id="7650877">.</span><span class="ident" id="7650878">Now</span><span class="op" id="7650881">(</span><span class="op" id="7650882">)</span><span class="op" id="7650883">.</span><span class="ident" id="7650884">Add</span><span class="op" id="7650887">(</span><span class="op" id="7650888">-</span><span class="num" id="7650889">5</span>&nbsp;<span class="op" id="7650891">*</span>&nbsp;<span class="ident" id="7650893">time</span><span class="op" id="7650897">.</span><span class="ident" id="7650898">Second</span><span class="op" id="7650904">)</span><span class="op" id="7650905">)</span>&nbsp;<span class="comment" id="7650907">//&nbsp;in&nbsp;the&nbsp;psat.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650924">buf</span>&nbsp;<span class="op" id="7650928">:=</span>&nbsp;<span class="builtinfunc" id="7650931">make</span><span class="op" id="7650935">(</span><span class="op" id="7650936">[</span><span class="op" id="7650937">]</span><span class="builtintype" id="7650938">byte</span><span class="op" id="7650942">,</span>&nbsp;<span class="builtinfunc" id="7650944">len</span><span class="op" id="7650947">(</span><span class="ident" id="7650948">msg</span><span class="op" id="7650951">)</span><span class="op" id="7650952">/</span><span class="num" id="7650953">2</span><span class="op" id="7650954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7650957">n</span><span class="op" id="7650958">,</span>&nbsp;<span class="ident" id="7650960">err</span>&nbsp;<span class="op" id="7650964">:=</span>&nbsp;<span class="ident" id="7650967">c</span><span class="op" id="7650968">.</span><span class="ident" id="7650969">Read</span><span class="op" id="7650973">(</span><span class="ident" id="7650974">buf</span><span class="op" id="7650977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7650980">if</span>&nbsp;<span class="ident" id="7650983">n</span>&nbsp;<span class="op" id="7650985">&gt;</span>&nbsp;<span class="num" id="7650987">0</span>&nbsp;<span class="op" id="7650989">||</span>&nbsp;<span class="op" id="7650992">!</span><span class="ident" id="7650993">isTimeout</span><span class="op" id="7651002">(</span><span class="ident" id="7651003">err</span><span class="op" id="7651006">)</span>&nbsp;<span class="op" id="7651008">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651012">t</span><span class="op" id="7651013">.</span><span class="ident" id="7651014">Fatalf</span><span class="op" id="7651020">(</span><span class="string" id="7651021">&#34;client&nbsp;read&nbsp;=&nbsp;%d&nbsp;(%q)&nbsp;err=%v;&nbsp;want&nbsp;0,&nbsp;timeout&#34;</span><span class="op" id="7651068">,</span>&nbsp;<span class="ident" id="7651070">n</span><span class="op" id="7651071">,</span>&nbsp;<span class="ident" id="7651073">buf</span><span class="op" id="7651076">[</span><span class="op" id="7651077">:</span><span class="ident" id="7651078">n</span><span class="op" id="7651079">]</span><span class="op" id="7651080">,</span>&nbsp;<span class="ident" id="7651082">err</span><span class="op" id="7651085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651088">}</span><br>
<span class="lineno"></span><span class="op" id="7651090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7651093">//&nbsp;TestWriteDeadlineBufferAvailable&nbsp;tests&nbsp;that&nbsp;write&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">565</span><span class="comment" id="7651167">//&nbsp;if&nbsp;there&#39;s&nbsp;buffer&nbsp;space&nbsp;available&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span><span class="keyword" id="7651214">func</span>&nbsp;<span class="ident" id="7651219">TestWriteDeadlineBufferAvailable</span><span class="op" id="7651251">(</span><span class="ident" id="7651252">t</span>&nbsp;<span class="op" id="7651254">*</span><span class="ident" id="7651255">testing</span><span class="op" id="7651262">.</span><span class="ident" id="7651263">T</span><span class="op" id="7651264">)</span>&nbsp;<span class="op" id="7651266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651269">switch</span>&nbsp;<span class="ident" id="7651276">runtime</span><span class="op" id="7651283">.</span><span class="ident" id="7651284">GOOS</span>&nbsp;<span class="op" id="7651289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651292">case</span>&nbsp;<span class="string" id="7651297">&#34;plan9&#34;</span><span class="op" id="7651304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651308">t</span><span class="op" id="7651309">.</span><span class="ident" id="7651310">Skipf</span><span class="op" id="7651315">(</span><span class="string" id="7651316">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7651337">,</span>&nbsp;<span class="ident" id="7651339">runtime</span><span class="op" id="7651346">.</span><span class="ident" id="7651347">GOOS</span><span class="op" id="7651351">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651358">ln</span>&nbsp;<span class="op" id="7651361">:=</span>&nbsp;<span class="ident" id="7651364">newLocalListener</span><span class="op" id="7651380">(</span><span class="ident" id="7651381">t</span><span class="op" id="7651382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651385">defer</span>&nbsp;<span class="ident" id="7651391">ln</span><span class="op" id="7651393">.</span><span class="ident" id="7651394">Close</span><span class="op" id="7651399">(</span><span class="op" id="7651400">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651404">servec</span>&nbsp;<span class="op" id="7651411">:=</span>&nbsp;<span class="builtinfunc" id="7651414">make</span><span class="op" id="7651418">(</span><span class="keyword" id="7651419">chan</span>&nbsp;<span class="ident" id="7651424">copyRes</span><span class="op" id="7651431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651434">go</span>&nbsp;<span class="keyword" id="7651437">func</span><span class="op" id="7651441">(</span><span class="op" id="7651442">)</span>&nbsp;<span class="op" id="7651444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651448">c</span><span class="op" id="7651449">,</span>&nbsp;<span class="ident" id="7651451">err</span>&nbsp;<span class="op" id="7651455">:=</span>&nbsp;<span class="ident" id="7651458">ln</span><span class="op" id="7651460">.</span><span class="ident" id="7651461">Accept</span><span class="op" id="7651467">(</span><span class="op" id="7651468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651472">if</span>&nbsp;<span class="ident" id="7651475">err</span>&nbsp;<span class="op" id="7651479">!=</span>&nbsp;<span class="ident" id="7651482">nil</span>&nbsp;<span class="op" id="7651486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651491">t</span><span class="op" id="7651492">.</span><span class="ident" id="7651493">Errorf</span><span class="op" id="7651499">(</span><span class="string" id="7651500">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="7651512">,</span>&nbsp;<span class="ident" id="7651514">err</span><span class="op" id="7651517">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651522">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651535">defer</span>&nbsp;<span class="ident" id="7651541">c</span><span class="op" id="7651542">.</span><span class="ident" id="7651543">Close</span><span class="op" id="7651548">(</span><span class="op" id="7651549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651553">c</span><span class="op" id="7651554">.</span><span class="ident" id="7651555">SetWriteDeadline</span><span class="op" id="7651571">(</span><span class="ident" id="7651572">time</span><span class="op" id="7651576">.</span><span class="ident" id="7651577">Now</span><span class="op" id="7651580">(</span><span class="op" id="7651581">)</span><span class="op" id="7651582">.</span><span class="ident" id="7651583">Add</span><span class="op" id="7651586">(</span><span class="op" id="7651587">-</span><span class="num" id="7651588">5</span>&nbsp;<span class="op" id="7651590">*</span>&nbsp;<span class="ident" id="7651592">time</span><span class="op" id="7651596">.</span><span class="ident" id="7651597">Second</span><span class="op" id="7651603">)</span><span class="op" id="7651604">)</span>&nbsp;<span class="comment" id="7651606">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651623">n</span><span class="op" id="7651624">,</span>&nbsp;<span class="ident" id="7651626">err</span>&nbsp;<span class="op" id="7651630">:=</span>&nbsp;<span class="ident" id="7651633">c</span><span class="op" id="7651634">.</span><span class="ident" id="7651635">Write</span><span class="op" id="7651640">(</span><span class="op" id="7651641">[</span><span class="op" id="7651642">]</span><span class="builtintype" id="7651643">byte</span><span class="op" id="7651647">{</span><span class="string" id="7651648">&#39;x&#39;</span><span class="op" id="7651651">}</span><span class="op" id="7651652">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651656">servec</span>&nbsp;<span class="op" id="7651663">&lt;-</span>&nbsp;<span class="ident" id="7651666">copyRes</span><span class="op" id="7651673">{</span><span class="ident" id="7651674">n</span><span class="op" id="7651675">:</span>&nbsp;<span class="ident" id="7651677">int64</span><span class="op" id="7651682">(</span><span class="ident" id="7651683">n</span><span class="op" id="7651684">)</span><span class="op" id="7651685">,</span>&nbsp;<span class="ident" id="7651687">err</span><span class="op" id="7651690">:</span>&nbsp;<span class="ident" id="7651692">err</span><span class="op" id="7651695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651698">}</span><span class="op" id="7651699">(</span><span class="op" id="7651700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651704">c</span><span class="op" id="7651705">,</span>&nbsp;<span class="ident" id="7651707">err</span>&nbsp;<span class="op" id="7651711">:=</span>&nbsp;<span class="ident" id="7651714">Dial</span><span class="op" id="7651718">(</span><span class="string" id="7651719">&#34;tcp&#34;</span><span class="op" id="7651724">,</span>&nbsp;<span class="ident" id="7651726">ln</span><span class="op" id="7651728">.</span><span class="ident" id="7651729">Addr</span><span class="op" id="7651733">(</span><span class="op" id="7651734">)</span><span class="op" id="7651735">.</span><span class="ident" id="7651736">String</span><span class="op" id="7651742">(</span><span class="op" id="7651743">)</span><span class="op" id="7651744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651747">if</span>&nbsp;<span class="ident" id="7651750">err</span>&nbsp;<span class="op" id="7651754">!=</span>&nbsp;<span class="ident" id="7651757">nil</span>&nbsp;<span class="op" id="7651761">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651765">t</span><span class="op" id="7651766">.</span><span class="ident" id="7651767">Fatalf</span><span class="op" id="7651773">(</span><span class="string" id="7651774">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7651784">,</span>&nbsp;<span class="ident" id="7651786">err</span><span class="op" id="7651789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651795">defer</span>&nbsp;<span class="ident" id="7651801">c</span><span class="op" id="7651802">.</span><span class="ident" id="7651803">Close</span><span class="op" id="7651808">(</span><span class="op" id="7651809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651812">res</span>&nbsp;<span class="op" id="7651816">:=</span>&nbsp;<span class="op" id="7651819">&lt;-</span><span class="ident" id="7651821">servec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651829">if</span>&nbsp;<span class="ident" id="7651832">res</span><span class="op" id="7651835">.</span><span class="ident" id="7651836">n</span>&nbsp;<span class="op" id="7651838">!=</span>&nbsp;<span class="num" id="7651841">0</span>&nbsp;<span class="op" id="7651843">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651847">t</span><span class="op" id="7651848">.</span><span class="ident" id="7651849">Errorf</span><span class="op" id="7651855">(</span><span class="string" id="7651856">&#34;Write&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7651876">,</span>&nbsp;<span class="ident" id="7651878">res</span><span class="op" id="7651881">.</span><span class="ident" id="7651882">n</span><span class="op" id="7651883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7651889">if</span>&nbsp;<span class="op" id="7651892">!</span><span class="ident" id="7651893">isTimeout</span><span class="op" id="7651902">(</span><span class="ident" id="7651903">res</span><span class="op" id="7651906">.</span><span class="ident" id="7651907">err</span><span class="op" id="7651910">)</span>&nbsp;<span class="op" id="7651912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7651916">t</span><span class="op" id="7651917">.</span><span class="ident" id="7651918">Errorf</span><span class="op" id="7651924">(</span><span class="string" id="7651925">&#34;Write&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="7651957">,</span>&nbsp;<span class="ident" id="7651959">res</span><span class="op" id="7651962">.</span><span class="ident" id="7651963">err</span><span class="op" id="7651966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7651969">}</span><br>
<span class="lineno">600</span><span class="op" id="7651971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7651974">//&nbsp;TestAcceptDeadlineConnectionAvailable&nbsp;tests&nbsp;that&nbsp;accept&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="7652054">//&nbsp;if&nbsp;there&#39;s&nbsp;incoming&nbsp;connections&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="7652100">func</span>&nbsp;<span class="ident" id="7652105">TestAcceptDeadlineConnectionAvailable</span><span class="op" id="7652142">(</span><span class="ident" id="7652143">t</span>&nbsp;<span class="op" id="7652145">*</span><span class="ident" id="7652146">testing</span><span class="op" id="7652153">.</span><span class="ident" id="7652154">T</span><span class="op" id="7652155">)</span>&nbsp;<span class="op" id="7652157">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652160">switch</span>&nbsp;<span class="ident" id="7652167">runtime</span><span class="op" id="7652174">.</span><span class="ident" id="7652175">GOOS</span>&nbsp;<span class="op" id="7652180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652183">case</span>&nbsp;<span class="string" id="7652188">&#34;plan9&#34;</span><span class="op" id="7652195">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652199">t</span><span class="op" id="7652200">.</span><span class="ident" id="7652201">Skipf</span><span class="op" id="7652206">(</span><span class="string" id="7652207">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7652228">,</span>&nbsp;<span class="ident" id="7652230">runtime</span><span class="op" id="7652237">.</span><span class="ident" id="7652238">GOOS</span><span class="op" id="7652242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652249">ln</span>&nbsp;<span class="op" id="7652252">:=</span>&nbsp;<span class="ident" id="7652255">newLocalListener</span><span class="op" id="7652271">(</span><span class="ident" id="7652272">t</span><span class="op" id="7652273">)</span><span class="op" id="7652274">.</span><span class="op" id="7652275">(</span><span class="op" id="7652276">*</span><span class="ident" id="7652277">TCPListener</span><span class="op" id="7652288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652291">defer</span>&nbsp;<span class="ident" id="7652297">ln</span><span class="op" id="7652299">.</span><span class="ident" id="7652300">Close</span><span class="op" id="7652305">(</span><span class="op" id="7652306">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652310">go</span>&nbsp;<span class="keyword" id="7652313">func</span><span class="op" id="7652317">(</span><span class="op" id="7652318">)</span>&nbsp;<span class="op" id="7652320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652324">c</span><span class="op" id="7652325">,</span>&nbsp;<span class="ident" id="7652327">err</span>&nbsp;<span class="op" id="7652331">:=</span>&nbsp;<span class="ident" id="7652334">Dial</span><span class="op" id="7652338">(</span><span class="string" id="7652339">&#34;tcp&#34;</span><span class="op" id="7652344">,</span>&nbsp;<span class="ident" id="7652346">ln</span><span class="op" id="7652348">.</span><span class="ident" id="7652349">Addr</span><span class="op" id="7652353">(</span><span class="op" id="7652354">)</span><span class="op" id="7652355">.</span><span class="ident" id="7652356">String</span><span class="op" id="7652362">(</span><span class="op" id="7652363">)</span><span class="op" id="7652364">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652368">if</span>&nbsp;<span class="ident" id="7652371">err</span>&nbsp;<span class="op" id="7652375">!=</span>&nbsp;<span class="ident" id="7652378">nil</span>&nbsp;<span class="op" id="7652382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652387">t</span><span class="op" id="7652388">.</span><span class="ident" id="7652389">Errorf</span><span class="op" id="7652395">(</span><span class="string" id="7652396">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7652406">,</span>&nbsp;<span class="ident" id="7652408">err</span><span class="op" id="7652411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652416">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652429">defer</span>&nbsp;<span class="ident" id="7652435">c</span><span class="op" id="7652436">.</span><span class="ident" id="7652437">Close</span><span class="op" id="7652442">(</span><span class="op" id="7652443">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652447">var</span>&nbsp;<span class="ident" id="7652451">buf</span>&nbsp;<span class="op" id="7652455">[</span><span class="num" id="7652456">1</span><span class="op" id="7652457">]</span><span class="builtintype" id="7652458">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652465">c</span><span class="op" id="7652466">.</span><span class="ident" id="7652467">Read</span><span class="op" id="7652471">(</span><span class="ident" id="7652472">buf</span><span class="op" id="7652475">[</span><span class="op" id="7652476">:</span><span class="op" id="7652477">]</span><span class="op" id="7652478">)</span>&nbsp;<span class="comment" id="7652480">//&nbsp;block&nbsp;until&nbsp;the&nbsp;connection&nbsp;or&nbsp;listener&nbsp;is&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652533">}</span><span class="op" id="7652534">(</span><span class="op" id="7652535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652538">time</span><span class="op" id="7652542">.</span><span class="ident" id="7652543">Sleep</span><span class="op" id="7652548">(</span><span class="num" id="7652549">10</span>&nbsp;<span class="op" id="7652552">*</span>&nbsp;<span class="ident" id="7652554">time</span><span class="op" id="7652558">.</span><span class="ident" id="7652559">Millisecond</span><span class="op" id="7652570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652573">ln</span><span class="op" id="7652575">.</span><span class="ident" id="7652576">SetDeadline</span><span class="op" id="7652587">(</span><span class="ident" id="7652588">time</span><span class="op" id="7652592">.</span><span class="ident" id="7652593">Now</span><span class="op" id="7652596">(</span><span class="op" id="7652597">)</span><span class="op" id="7652598">.</span><span class="ident" id="7652599">Add</span><span class="op" id="7652602">(</span><span class="op" id="7652603">-</span><span class="num" id="7652604">5</span>&nbsp;<span class="op" id="7652606">*</span>&nbsp;<span class="ident" id="7652608">time</span><span class="op" id="7652612">.</span><span class="ident" id="7652613">Second</span><span class="op" id="7652619">)</span><span class="op" id="7652620">)</span>&nbsp;<span class="comment" id="7652622">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652638">c</span><span class="op" id="7652639">,</span>&nbsp;<span class="ident" id="7652641">err</span>&nbsp;<span class="op" id="7652645">:=</span>&nbsp;<span class="ident" id="7652648">ln</span><span class="op" id="7652650">.</span><span class="ident" id="7652651">Accept</span><span class="op" id="7652657">(</span><span class="op" id="7652658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652661">if</span>&nbsp;<span class="ident" id="7652664">err</span>&nbsp;<span class="op" id="7652668">==</span>&nbsp;<span class="ident" id="7652671">nil</span>&nbsp;<span class="op" id="7652675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652679">defer</span>&nbsp;<span class="ident" id="7652685">c</span><span class="op" id="7652686">.</span><span class="ident" id="7652687">Close</span><span class="op" id="7652692">(</span><span class="op" id="7652693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652699">if</span>&nbsp;<span class="op" id="7652702">!</span><span class="ident" id="7652703">isTimeout</span><span class="op" id="7652712">(</span><span class="ident" id="7652713">err</span><span class="op" id="7652716">)</span>&nbsp;<span class="op" id="7652718">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652722">t</span><span class="op" id="7652723">.</span><span class="ident" id="7652724">Fatalf</span><span class="op" id="7652730">(</span><span class="string" id="7652731">&#34;Accept:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="7652761">,</span>&nbsp;<span class="ident" id="7652763">err</span><span class="op" id="7652766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7652769">}</span><br>
<span class="lineno"></span><span class="op" id="7652771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7652774">//&nbsp;TestConnectDeadlineInThePast&nbsp;tests&nbsp;that&nbsp;connect&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">635</span><span class="comment" id="7652846">//&nbsp;if&nbsp;the&nbsp;connection&nbsp;can&nbsp;be&nbsp;established&nbsp;w/o&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="7652900">func</span>&nbsp;<span class="ident" id="7652905">TestConnectDeadlineInThePast</span><span class="op" id="7652933">(</span><span class="ident" id="7652934">t</span>&nbsp;<span class="op" id="7652936">*</span><span class="ident" id="7652937">testing</span><span class="op" id="7652944">.</span><span class="ident" id="7652945">T</span><span class="op" id="7652946">)</span>&nbsp;<span class="op" id="7652948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652951">switch</span>&nbsp;<span class="ident" id="7652958">runtime</span><span class="op" id="7652965">.</span><span class="ident" id="7652966">GOOS</span>&nbsp;<span class="op" id="7652971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7652974">case</span>&nbsp;<span class="string" id="7652979">&#34;plan9&#34;</span><span class="op" id="7652986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7652990">t</span><span class="op" id="7652991">.</span><span class="ident" id="7652992">Skipf</span><span class="op" id="7652997">(</span><span class="string" id="7652998">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7653019">,</span>&nbsp;<span class="ident" id="7653021">runtime</span><span class="op" id="7653028">.</span><span class="ident" id="7653029">GOOS</span><span class="op" id="7653033">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653040">ln</span>&nbsp;<span class="op" id="7653043">:=</span>&nbsp;<span class="ident" id="7653046">newLocalListener</span><span class="op" id="7653062">(</span><span class="ident" id="7653063">t</span><span class="op" id="7653064">)</span><span class="op" id="7653065">.</span><span class="op" id="7653066">(</span><span class="op" id="7653067">*</span><span class="ident" id="7653068">TCPListener</span><span class="op" id="7653079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653082">defer</span>&nbsp;<span class="ident" id="7653088">ln</span><span class="op" id="7653090">.</span><span class="ident" id="7653091">Close</span><span class="op" id="7653096">(</span><span class="op" id="7653097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653101">go</span>&nbsp;<span class="keyword" id="7653104">func</span><span class="op" id="7653108">(</span><span class="op" id="7653109">)</span>&nbsp;<span class="op" id="7653111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653115">c</span><span class="op" id="7653116">,</span>&nbsp;<span class="ident" id="7653118">err</span>&nbsp;<span class="op" id="7653122">:=</span>&nbsp;<span class="ident" id="7653125">ln</span><span class="op" id="7653127">.</span><span class="ident" id="7653128">Accept</span><span class="op" id="7653134">(</span><span class="op" id="7653135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653139">if</span>&nbsp;<span class="ident" id="7653142">err</span>&nbsp;<span class="op" id="7653146">==</span>&nbsp;<span class="ident" id="7653149">nil</span>&nbsp;<span class="op" id="7653153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653158">defer</span>&nbsp;<span class="ident" id="7653164">c</span><span class="op" id="7653165">.</span><span class="ident" id="7653166">Close</span><span class="op" id="7653171">(</span><span class="op" id="7653172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653176">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653179">}</span><span class="op" id="7653180">(</span><span class="op" id="7653181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653184">time</span><span class="op" id="7653188">.</span><span class="ident" id="7653189">Sleep</span><span class="op" id="7653194">(</span><span class="num" id="7653195">10</span>&nbsp;<span class="op" id="7653198">*</span>&nbsp;<span class="ident" id="7653200">time</span><span class="op" id="7653204">.</span><span class="ident" id="7653205">Millisecond</span><span class="op" id="7653216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653219">c</span><span class="op" id="7653220">,</span>&nbsp;<span class="ident" id="7653222">err</span>&nbsp;<span class="op" id="7653226">:=</span>&nbsp;<span class="ident" id="7653229">DialTimeout</span><span class="op" id="7653240">(</span><span class="string" id="7653241">&#34;tcp&#34;</span><span class="op" id="7653246">,</span>&nbsp;<span class="ident" id="7653248">ln</span><span class="op" id="7653250">.</span><span class="ident" id="7653251">Addr</span><span class="op" id="7653255">(</span><span class="op" id="7653256">)</span><span class="op" id="7653257">.</span><span class="ident" id="7653258">String</span><span class="op" id="7653264">(</span><span class="op" id="7653265">)</span><span class="op" id="7653266">,</span>&nbsp;<span class="op" id="7653268">-</span><span class="num" id="7653269">5</span><span class="op" id="7653270">*</span><span class="ident" id="7653271">time</span><span class="op" id="7653275">.</span><span class="ident" id="7653276">Second</span><span class="op" id="7653282">)</span>&nbsp;<span class="comment" id="7653284">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653300">if</span>&nbsp;<span class="ident" id="7653303">err</span>&nbsp;<span class="op" id="7653307">==</span>&nbsp;<span class="ident" id="7653310">nil</span>&nbsp;<span class="op" id="7653314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653318">defer</span>&nbsp;<span class="ident" id="7653324">c</span><span class="op" id="7653325">.</span><span class="ident" id="7653326">Close</span><span class="op" id="7653331">(</span><span class="op" id="7653332">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653338">if</span>&nbsp;<span class="op" id="7653341">!</span><span class="ident" id="7653342">isTimeout</span><span class="op" id="7653351">(</span><span class="ident" id="7653352">err</span><span class="op" id="7653355">)</span>&nbsp;<span class="op" id="7653357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653361">t</span><span class="op" id="7653362">.</span><span class="ident" id="7653363">Fatalf</span><span class="op" id="7653369">(</span><span class="string" id="7653370">&#34;DialTimeout:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="7653405">,</span>&nbsp;<span class="ident" id="7653407">err</span><span class="op" id="7653410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653413">}</span><br>
<span class="lineno"></span><span class="op" id="7653415">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="7653418">//&nbsp;TestProlongTimeout&nbsp;tests&nbsp;concurrent&nbsp;deadline&nbsp;modification.</span><br>
<span class="lineno"></span><span class="comment" id="7653480">//&nbsp;Known&nbsp;to&nbsp;cause&nbsp;data&nbsp;races&nbsp;in&nbsp;the&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="7653522">func</span>&nbsp;<span class="ident" id="7653527">TestProlongTimeout</span><span class="op" id="7653545">(</span><span class="ident" id="7653546">t</span>&nbsp;<span class="op" id="7653548">*</span><span class="ident" id="7653549">testing</span><span class="op" id="7653556">.</span><span class="ident" id="7653557">T</span><span class="op" id="7653558">)</span>&nbsp;<span class="op" id="7653560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653563">switch</span>&nbsp;<span class="ident" id="7653570">runtime</span><span class="op" id="7653577">.</span><span class="ident" id="7653578">GOOS</span>&nbsp;<span class="op" id="7653583">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653586">case</span>&nbsp;<span class="string" id="7653591">&#34;plan9&#34;</span><span class="op" id="7653598">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653602">t</span><span class="op" id="7653603">.</span><span class="ident" id="7653604">Skipf</span><span class="op" id="7653609">(</span><span class="string" id="7653610">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7653631">,</span>&nbsp;<span class="ident" id="7653633">runtime</span><span class="op" id="7653640">.</span><span class="ident" id="7653641">GOOS</span><span class="op" id="7653645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653652">ln</span>&nbsp;<span class="op" id="7653655">:=</span>&nbsp;<span class="ident" id="7653658">newLocalListener</span><span class="op" id="7653674">(</span><span class="ident" id="7653675">t</span><span class="op" id="7653676">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653679">defer</span>&nbsp;<span class="ident" id="7653685">ln</span><span class="op" id="7653687">.</span><span class="ident" id="7653688">Close</span><span class="op" id="7653693">(</span><span class="op" id="7653694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653697">connected</span>&nbsp;<span class="op" id="7653707">:=</span>&nbsp;<span class="builtinfunc" id="7653710">make</span><span class="op" id="7653714">(</span><span class="keyword" id="7653715">chan</span>&nbsp;<span class="builtintype" id="7653720">bool</span><span class="op" id="7653724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653727">go</span>&nbsp;<span class="keyword" id="7653730">func</span><span class="op" id="7653734">(</span><span class="op" id="7653735">)</span>&nbsp;<span class="op" id="7653737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653741">s</span><span class="op" id="7653742">,</span>&nbsp;<span class="ident" id="7653744">err</span>&nbsp;<span class="op" id="7653748">:=</span>&nbsp;<span class="ident" id="7653751">ln</span><span class="op" id="7653753">.</span><span class="ident" id="7653754">Accept</span><span class="op" id="7653760">(</span><span class="op" id="7653761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653765">connected</span>&nbsp;<span class="op" id="7653775">&lt;-</span>&nbsp;<span class="builtintype" id="7653778">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653785">if</span>&nbsp;<span class="ident" id="7653788">err</span>&nbsp;<span class="op" id="7653792">!=</span>&nbsp;<span class="ident" id="7653795">nil</span>&nbsp;<span class="op" id="7653799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653804">t</span><span class="op" id="7653805">.</span><span class="ident" id="7653806">Errorf</span><span class="op" id="7653812">(</span><span class="string" id="7653813">&#34;ln.Accept:&nbsp;%v&#34;</span><span class="op" id="7653828">,</span>&nbsp;<span class="ident" id="7653830">err</span><span class="op" id="7653833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653838">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7653847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653851">defer</span>&nbsp;<span class="ident" id="7653857">s</span><span class="op" id="7653858">.</span><span class="ident" id="7653859">Close</span><span class="op" id="7653864">(</span><span class="op" id="7653865">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653869">s</span><span class="op" id="7653870">.</span><span class="ident" id="7653871">SetDeadline</span><span class="op" id="7653882">(</span><span class="ident" id="7653883">time</span><span class="op" id="7653887">.</span><span class="ident" id="7653888">Now</span><span class="op" id="7653891">(</span><span class="op" id="7653892">)</span><span class="op" id="7653893">.</span><span class="ident" id="7653894">Add</span><span class="op" id="7653897">(</span><span class="ident" id="7653898">time</span><span class="op" id="7653902">.</span><span class="ident" id="7653903">Hour</span><span class="op" id="7653907">)</span><span class="op" id="7653908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653912">go</span>&nbsp;<span class="keyword" id="7653915">func</span><span class="op" id="7653919">(</span><span class="op" id="7653920">)</span>&nbsp;<span class="op" id="7653922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653927">var</span>&nbsp;<span class="ident" id="7653931">buf</span>&nbsp;<span class="op" id="7653935">[</span><span class="num" id="7653936">4096</span><span class="op" id="7653940">]</span><span class="builtintype" id="7653941">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653949">for</span>&nbsp;<span class="op" id="7653953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7653959">_</span><span class="op" id="7653960">,</span>&nbsp;<span class="ident" id="7653962">err</span>&nbsp;<span class="op" id="7653966">:=</span>&nbsp;<span class="ident" id="7653969">s</span><span class="op" id="7653970">.</span><span class="ident" id="7653971">Write</span><span class="op" id="7653976">(</span><span class="ident" id="7653977">buf</span><span class="op" id="7653980">[</span><span class="op" id="7653981">:</span><span class="op" id="7653982">]</span><span class="op" id="7653983">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7653989">if</span>&nbsp;<span class="ident" id="7653992">err</span>&nbsp;<span class="op" id="7653996">!=</span>&nbsp;<span class="ident" id="7653999">nil</span>&nbsp;<span class="op" id="7654003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654010">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654026">s</span><span class="op" id="7654027">.</span><span class="ident" id="7654028">SetDeadline</span><span class="op" id="7654039">(</span><span class="ident" id="7654040">time</span><span class="op" id="7654044">.</span><span class="ident" id="7654045">Now</span><span class="op" id="7654048">(</span><span class="op" id="7654049">)</span><span class="op" id="7654050">.</span><span class="ident" id="7654051">Add</span><span class="op" id="7654054">(</span><span class="ident" id="7654055">time</span><span class="op" id="7654059">.</span><span class="ident" id="7654060">Hour</span><span class="op" id="7654064">)</span><span class="op" id="7654065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654070">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654074">}</span><span class="op" id="7654075">(</span><span class="op" id="7654076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654080">buf</span>&nbsp;<span class="op" id="7654084">:=</span>&nbsp;<span class="builtinfunc" id="7654087">make</span><span class="op" id="7654091">(</span><span class="op" id="7654092">[</span><span class="op" id="7654093">]</span><span class="builtintype" id="7654094">byte</span><span class="op" id="7654098">,</span>&nbsp;<span class="num" id="7654100">1</span><span class="op" id="7654101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654105">for</span>&nbsp;<span class="op" id="7654109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654114">_</span><span class="op" id="7654115">,</span>&nbsp;<span class="ident" id="7654117">err</span>&nbsp;<span class="op" id="7654121">:=</span>&nbsp;<span class="ident" id="7654124">s</span><span class="op" id="7654125">.</span><span class="ident" id="7654126">Read</span><span class="op" id="7654130">(</span><span class="ident" id="7654131">buf</span><span class="op" id="7654134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654139">if</span>&nbsp;<span class="ident" id="7654142">err</span>&nbsp;<span class="op" id="7654146">!=</span>&nbsp;<span class="ident" id="7654149">nil</span>&nbsp;<span class="op" id="7654153">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654159">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654173">s</span><span class="op" id="7654174">.</span><span class="ident" id="7654175">SetDeadline</span><span class="op" id="7654186">(</span><span class="ident" id="7654187">time</span><span class="op" id="7654191">.</span><span class="ident" id="7654192">Now</span><span class="op" id="7654195">(</span><span class="op" id="7654196">)</span><span class="op" id="7654197">.</span><span class="ident" id="7654198">Add</span><span class="op" id="7654201">(</span><span class="ident" id="7654202">time</span><span class="op" id="7654206">.</span><span class="ident" id="7654207">Hour</span><span class="op" id="7654211">)</span><span class="op" id="7654212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654219">}</span><span class="op" id="7654220">(</span><span class="op" id="7654221">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654224">c</span><span class="op" id="7654225">,</span>&nbsp;<span class="ident" id="7654227">err</span>&nbsp;<span class="op" id="7654231">:=</span>&nbsp;<span class="ident" id="7654234">Dial</span><span class="op" id="7654238">(</span><span class="string" id="7654239">&#34;tcp&#34;</span><span class="op" id="7654244">,</span>&nbsp;<span class="ident" id="7654246">ln</span><span class="op" id="7654248">.</span><span class="ident" id="7654249">Addr</span><span class="op" id="7654253">(</span><span class="op" id="7654254">)</span><span class="op" id="7654255">.</span><span class="ident" id="7654256">String</span><span class="op" id="7654262">(</span><span class="op" id="7654263">)</span><span class="op" id="7654264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654267">if</span>&nbsp;<span class="ident" id="7654270">err</span>&nbsp;<span class="op" id="7654274">!=</span>&nbsp;<span class="ident" id="7654277">nil</span>&nbsp;<span class="op" id="7654281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654285">t</span><span class="op" id="7654286">.</span><span class="ident" id="7654287">Fatalf</span><span class="op" id="7654293">(</span><span class="string" id="7654294">&#34;DialTCP:&nbsp;%v&#34;</span><span class="op" id="7654307">,</span>&nbsp;<span class="ident" id="7654309">err</span><span class="op" id="7654312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654318">defer</span>&nbsp;<span class="ident" id="7654324">c</span><span class="op" id="7654325">.</span><span class="ident" id="7654326">Close</span><span class="op" id="7654331">(</span><span class="op" id="7654332">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654335">&lt;-</span><span class="ident" id="7654337">connected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654348">for</span>&nbsp;<span class="ident" id="7654352">i</span>&nbsp;<span class="op" id="7654354">:=</span>&nbsp;<span class="num" id="7654357">0</span><span class="op" id="7654358">;</span>&nbsp;<span class="ident" id="7654360">i</span>&nbsp;<span class="op" id="7654362">&lt;</span>&nbsp;<span class="num" id="7654364">1024</span><span class="op" id="7654368">;</span>&nbsp;<span class="ident" id="7654370">i</span><span class="op" id="7654371">++</span>&nbsp;<span class="op" id="7654374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654378">var</span>&nbsp;<span class="ident" id="7654382">buf</span>&nbsp;<span class="op" id="7654386">[</span><span class="num" id="7654387">1</span><span class="op" id="7654388">]</span><span class="builtintype" id="7654389">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654396">c</span><span class="op" id="7654397">.</span><span class="ident" id="7654398">Write</span><span class="op" id="7654403">(</span><span class="ident" id="7654404">buf</span><span class="op" id="7654407">[</span><span class="op" id="7654408">:</span><span class="op" id="7654409">]</span><span class="op" id="7654410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654413">}</span><br>
<span class="lineno">710</span><span class="op" id="7654415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7654418">func</span>&nbsp;<span class="ident" id="7654423">TestDeadlineRace</span><span class="op" id="7654439">(</span><span class="ident" id="7654440">t</span>&nbsp;<span class="op" id="7654442">*</span><span class="ident" id="7654443">testing</span><span class="op" id="7654450">.</span><span class="ident" id="7654451">T</span><span class="op" id="7654452">)</span>&nbsp;<span class="op" id="7654454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654457">switch</span>&nbsp;<span class="ident" id="7654464">runtime</span><span class="op" id="7654471">.</span><span class="ident" id="7654472">GOOS</span>&nbsp;<span class="op" id="7654477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654480">case</span>&nbsp;<span class="string" id="7654485">&#34;nacl&#34;</span><span class="op" id="7654491">,</span>&nbsp;<span class="string" id="7654493">&#34;plan9&#34;</span><span class="op" id="7654500">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654504">t</span><span class="op" id="7654505">.</span><span class="ident" id="7654506">Skipf</span><span class="op" id="7654511">(</span><span class="string" id="7654512">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7654533">,</span>&nbsp;<span class="ident" id="7654535">runtime</span><span class="op" id="7654542">.</span><span class="ident" id="7654543">GOOS</span><span class="op" id="7654547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654554">N</span>&nbsp;<span class="op" id="7654556">:=</span>&nbsp;<span class="num" id="7654559">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654565">if</span>&nbsp;<span class="ident" id="7654568">testing</span><span class="op" id="7654575">.</span><span class="ident" id="7654576">Short</span><span class="op" id="7654581">(</span><span class="op" id="7654582">)</span>&nbsp;<span class="op" id="7654584">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654588">N</span>&nbsp;<span class="op" id="7654590">=</span>&nbsp;<span class="num" id="7654592">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654599">defer</span>&nbsp;<span class="ident" id="7654605">runtime</span><span class="op" id="7654612">.</span><span class="ident" id="7654613">GOMAXPROCS</span><span class="op" id="7654623">(</span><span class="ident" id="7654624">runtime</span><span class="op" id="7654631">.</span><span class="ident" id="7654632">GOMAXPROCS</span><span class="op" id="7654642">(</span><span class="num" id="7654643">4</span><span class="op" id="7654644">)</span><span class="op" id="7654645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654648">ln</span>&nbsp;<span class="op" id="7654651">:=</span>&nbsp;<span class="ident" id="7654654">newLocalListener</span><span class="op" id="7654670">(</span><span class="ident" id="7654671">t</span><span class="op" id="7654672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654675">defer</span>&nbsp;<span class="ident" id="7654681">ln</span><span class="op" id="7654683">.</span><span class="ident" id="7654684">Close</span><span class="op" id="7654689">(</span><span class="op" id="7654690">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654693">c</span><span class="op" id="7654694">,</span>&nbsp;<span class="ident" id="7654696">err</span>&nbsp;<span class="op" id="7654700">:=</span>&nbsp;<span class="ident" id="7654703">Dial</span><span class="op" id="7654707">(</span><span class="string" id="7654708">&#34;tcp&#34;</span><span class="op" id="7654713">,</span>&nbsp;<span class="ident" id="7654715">ln</span><span class="op" id="7654717">.</span><span class="ident" id="7654718">Addr</span><span class="op" id="7654722">(</span><span class="op" id="7654723">)</span><span class="op" id="7654724">.</span><span class="ident" id="7654725">String</span><span class="op" id="7654731">(</span><span class="op" id="7654732">)</span><span class="op" id="7654733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654736">if</span>&nbsp;<span class="ident" id="7654739">err</span>&nbsp;<span class="op" id="7654743">!=</span>&nbsp;<span class="ident" id="7654746">nil</span>&nbsp;<span class="op" id="7654750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654754">t</span><span class="op" id="7654755">.</span><span class="ident" id="7654756">Fatalf</span><span class="op" id="7654762">(</span><span class="string" id="7654763">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7654773">,</span>&nbsp;<span class="ident" id="7654775">err</span><span class="op" id="7654778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654784">defer</span>&nbsp;<span class="ident" id="7654790">c</span><span class="op" id="7654791">.</span><span class="ident" id="7654792">Close</span><span class="op" id="7654797">(</span><span class="op" id="7654798">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654801">done</span>&nbsp;<span class="op" id="7654806">:=</span>&nbsp;<span class="builtinfunc" id="7654809">make</span><span class="op" id="7654813">(</span><span class="keyword" id="7654814">chan</span>&nbsp;<span class="builtintype" id="7654819">bool</span><span class="op" id="7654823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654826">go</span>&nbsp;<span class="keyword" id="7654829">func</span><span class="op" id="7654833">(</span><span class="op" id="7654834">)</span>&nbsp;<span class="op" id="7654836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654840">t</span>&nbsp;<span class="op" id="7654842">:=</span>&nbsp;<span class="ident" id="7654845">time</span><span class="op" id="7654849">.</span><span class="ident" id="7654850">NewTicker</span><span class="op" id="7654859">(</span><span class="num" id="7654860">2</span>&nbsp;<span class="op" id="7654862">*</span>&nbsp;<span class="ident" id="7654864">time</span><span class="op" id="7654868">.</span><span class="ident" id="7654869">Microsecond</span><span class="op" id="7654880">)</span><span class="op" id="7654881">.</span><span class="ident" id="7654882">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654886">for</span>&nbsp;<span class="ident" id="7654890">i</span>&nbsp;<span class="op" id="7654892">:=</span>&nbsp;<span class="num" id="7654895">0</span><span class="op" id="7654896">;</span>&nbsp;<span class="ident" id="7654898">i</span>&nbsp;<span class="op" id="7654900">&lt;</span>&nbsp;<span class="ident" id="7654902">N</span><span class="op" id="7654903">;</span>&nbsp;<span class="ident" id="7654905">i</span><span class="op" id="7654906">++</span>&nbsp;<span class="op" id="7654909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654914">if</span>&nbsp;<span class="ident" id="7654917">err</span>&nbsp;<span class="op" id="7654921">:=</span>&nbsp;<span class="ident" id="7654924">c</span><span class="op" id="7654925">.</span><span class="ident" id="7654926">SetDeadline</span><span class="op" id="7654937">(</span><span class="ident" id="7654938">time</span><span class="op" id="7654942">.</span><span class="ident" id="7654943">Now</span><span class="op" id="7654946">(</span><span class="op" id="7654947">)</span><span class="op" id="7654948">.</span><span class="ident" id="7654949">Add</span><span class="op" id="7654952">(</span><span class="num" id="7654953">2</span>&nbsp;<span class="op" id="7654955">*</span>&nbsp;<span class="ident" id="7654957">time</span><span class="op" id="7654961">.</span><span class="ident" id="7654962">Microsecond</span><span class="op" id="7654973">)</span><span class="op" id="7654974">)</span><span class="op" id="7654975">;</span>&nbsp;<span class="ident" id="7654977">err</span>&nbsp;<span class="op" id="7654981">!=</span>&nbsp;<span class="ident" id="7654984">nil</span>&nbsp;<span class="op" id="7654988">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654994">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655008">&lt;-</span><span class="ident" id="7655010">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655018">done</span>&nbsp;<span class="op" id="7655023">&lt;-</span>&nbsp;<span class="builtintype" id="7655026">true</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655032">}</span><span class="op" id="7655033">(</span><span class="op" id="7655034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7655037">var</span>&nbsp;<span class="ident" id="7655041">buf</span>&nbsp;<span class="op" id="7655045">[</span><span class="num" id="7655046">1</span><span class="op" id="7655047">]</span><span class="builtintype" id="7655048">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7655054">for</span>&nbsp;<span class="ident" id="7655058">i</span>&nbsp;<span class="op" id="7655060">:=</span>&nbsp;<span class="num" id="7655063">0</span><span class="op" id="7655064">;</span>&nbsp;<span class="ident" id="7655066">i</span>&nbsp;<span class="op" id="7655068">&lt;</span>&nbsp;<span class="ident" id="7655070">N</span><span class="op" id="7655071">;</span>&nbsp;<span class="ident" id="7655073">i</span><span class="op" id="7655074">++</span>&nbsp;<span class="op" id="7655077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655081">c</span><span class="op" id="7655082">.</span><span class="ident" id="7655083">Read</span><span class="op" id="7655087">(</span><span class="ident" id="7655088">buf</span><span class="op" id="7655091">[</span><span class="op" id="7655092">:</span><span class="op" id="7655093">]</span><span class="op" id="7655094">)</span>&nbsp;<span class="comment" id="7655096">//&nbsp;ignore&nbsp;possible&nbsp;timeout&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655131">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655134">c</span><span class="op" id="7655135">.</span><span class="ident" id="7655136">Close</span><span class="op" id="7655141">(</span><span class="op" id="7655142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655145">&lt;-</span><span class="ident" id="7655147">done</span><br>
<span class="lineno"></span><span class="op" id="7655152">}</span>
</div>
</body>
</html>
