<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/format</h2>
<ul>
<li><a href="/gostd/go/format/format.go.html" class="current">format.go</a></li>
<li><a href="/gostd/go/format/format_test.go.html">format_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6324097">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6324152">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6324206">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6324257">//&nbsp;Package&nbsp;format&nbsp;implements&nbsp;standard&nbsp;formatting&nbsp;of&nbsp;Go&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="6324320">package</span>&nbsp;<span class="ident" id="6324328">format</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6324336">import</span>&nbsp;<span class="op" id="6324343">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6324346">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6324355">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6324362">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6324372">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6324385">&#34;go/printer&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6324399">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6324411">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6324417">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6324427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6324430">var</span>&nbsp;<span class="ident" id="6324434">config</span>&nbsp;<span class="op" id="6324441">=</span>&nbsp;<span class="ident" id="6324443">printer</span><span class="op" id="6324450">.</span><span class="ident" id="6324451">Config</span><span class="op" id="6324457">{</span><span class="ident" id="6324458">Mode</span><span class="op" id="6324462">:</span>&nbsp;<span class="ident" id="6324464">printer</span><span class="op" id="6324471">.</span><span class="ident" id="6324472">UseSpaces</span>&nbsp;<span class="op" id="6324482">|</span>&nbsp;<span class="ident" id="6324484">printer</span><span class="op" id="6324491">.</span><span class="ident" id="6324492">TabIndent</span><span class="op" id="6324501">,</span>&nbsp;<span class="ident" id="6324503">Tabwidth</span><span class="op" id="6324511">:</span>&nbsp;<span class="num" id="6324513">8</span><span class="op" id="6324514">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6324517">const</span>&nbsp;<span class="ident" id="6324523">parserMode</span>&nbsp;<span class="op" id="6324534">=</span>&nbsp;<span class="ident" id="6324536">parser</span><span class="op" id="6324542">.</span><span class="ident" id="6324543">ParseComments</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6324558">//&nbsp;Node&nbsp;formats&nbsp;node&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="6324634">//</span><br>
<span class="lineno">25</span><span class="comment" id="6324637">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*printer.CommentedNode,&nbsp;[]ast.Decl,</span><br>
<span class="lineno"></span><span class="comment" id="6324709">//&nbsp;[]ast.Stmt,&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,</span><br>
<span class="lineno"></span><span class="comment" id="6324782">//&nbsp;or&nbsp;ast.Stmt.&nbsp;Node&nbsp;does&nbsp;not&nbsp;modify&nbsp;node.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6324852">//&nbsp;nodes&nbsp;representing&nbsp;partial&nbsp;source&nbsp;files&nbsp;(i.e.,&nbsp;if&nbsp;the&nbsp;node&nbsp;is&nbsp;not&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6324924">//&nbsp;*ast.File&nbsp;or&nbsp;a&nbsp;*printer.CommentedNode&nbsp;not&nbsp;wrapping&nbsp;an&nbsp;*ast.File).</span><br>
<span class="lineno">30</span><span class="comment" id="6324993">//</span><br>
<span class="lineno"></span><span class="comment" id="6324996">//&nbsp;The&nbsp;function&nbsp;may&nbsp;return&nbsp;early&nbsp;(before&nbsp;the&nbsp;entire&nbsp;result&nbsp;is&nbsp;written)</span><br>
<span class="lineno"></span><span class="comment" id="6325067">//&nbsp;and&nbsp;return&nbsp;a&nbsp;formatting&nbsp;error,&nbsp;for&nbsp;instance&nbsp;due&nbsp;to&nbsp;an&nbsp;incorrect&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="6325139">//</span><br>
<span class="lineno"></span><span class="keyword" id="6325142">func</span>&nbsp;<span class="ident" id="6325147">Node</span><span class="op" id="6325151">(</span><span class="ident" id="6325152">dst</span>&nbsp;<span class="ident" id="6325156">io</span><span class="op" id="6325158">.</span><span class="ident" id="6325159">Writer</span><span class="op" id="6325165">,</span>&nbsp;<span class="ident" id="6325167">fset</span>&nbsp;<span class="op" id="6325172">*</span><span class="ident" id="6325173">token</span><span class="op" id="6325178">.</span><span class="ident" id="6325179">FileSet</span><span class="op" id="6325186">,</span>&nbsp;<span class="ident" id="6325188">node</span>&nbsp;<span class="keyword" id="6325193">interface</span><span class="op" id="6325202">{</span><span class="op" id="6325203">}</span><span class="op" id="6325204">)</span>&nbsp;<span class="builtintype" id="6325206">error</span>&nbsp;<span class="op" id="6325212">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325215">//&nbsp;Determine&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;complete&nbsp;source&nbsp;file&nbsp;(file&nbsp;!=&nbsp;nil).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325278">var</span>&nbsp;<span class="ident" id="6325282">file</span>&nbsp;<span class="op" id="6325287">*</span><span class="ident" id="6325288">ast</span><span class="op" id="6325291">.</span><span class="ident" id="6325292">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325298">var</span>&nbsp;<span class="ident" id="6325302">cnode</span>&nbsp;<span class="op" id="6325308">*</span><span class="ident" id="6325309">printer</span><span class="op" id="6325316">.</span><span class="ident" id="6325317">CommentedNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325332">switch</span>&nbsp;<span class="ident" id="6325339">n</span>&nbsp;<span class="op" id="6325341">:=</span>&nbsp;<span class="ident" id="6325344">node</span><span class="op" id="6325348">.</span><span class="op" id="6325349">(</span><span class="keyword" id="6325350">type</span><span class="op" id="6325354">)</span>&nbsp;<span class="op" id="6325356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325359">case</span>&nbsp;<span class="op" id="6325364">*</span><span class="ident" id="6325365">ast</span><span class="op" id="6325368">.</span><span class="ident" id="6325369">File</span><span class="op" id="6325373">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325377">file</span>&nbsp;<span class="op" id="6325382">=</span>&nbsp;<span class="ident" id="6325384">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325387">case</span>&nbsp;<span class="op" id="6325392">*</span><span class="ident" id="6325393">printer</span><span class="op" id="6325400">.</span><span class="ident" id="6325401">CommentedNode</span><span class="op" id="6325414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325418">if</span>&nbsp;<span class="ident" id="6325421">f</span><span class="op" id="6325422">,</span>&nbsp;<span class="ident" id="6325424">ok</span>&nbsp;<span class="op" id="6325427">:=</span>&nbsp;<span class="ident" id="6325430">n</span><span class="op" id="6325431">.</span><span class="ident" id="6325432">Node</span><span class="op" id="6325436">.</span><span class="op" id="6325437">(</span><span class="op" id="6325438">*</span><span class="ident" id="6325439">ast</span><span class="op" id="6325442">.</span><span class="ident" id="6325443">File</span><span class="op" id="6325447">)</span><span class="op" id="6325448">;</span>&nbsp;<span class="ident" id="6325450">ok</span>&nbsp;<span class="op" id="6325453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325458">file</span>&nbsp;<span class="op" id="6325463">=</span>&nbsp;<span class="ident" id="6325465">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325470">cnode</span>&nbsp;<span class="op" id="6325476">=</span>&nbsp;<span class="ident" id="6325478">n</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325489">//&nbsp;Sort&nbsp;imports&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325520">if</span>&nbsp;<span class="ident" id="6325523">file</span>&nbsp;<span class="op" id="6325528">!=</span>&nbsp;<span class="ident" id="6325531">nil</span>&nbsp;<span class="op" id="6325535">&amp;&amp;</span>&nbsp;<span class="ident" id="6325538">hasUnsortedImports</span><span class="op" id="6325556">(</span><span class="ident" id="6325557">file</span><span class="op" id="6325561">)</span>&nbsp;<span class="op" id="6325563">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325567">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;AST&nbsp;because&nbsp;ast.SortImports&nbsp;is&nbsp;destructive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325635">//&nbsp;TODO(gri)&nbsp;Do&nbsp;this&nbsp;more&nbsp;efficiently.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325676">var</span>&nbsp;<span class="ident" id="6325680">buf</span>&nbsp;<span class="ident" id="6325684">bytes</span><span class="op" id="6325689">.</span><span class="ident" id="6325690">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325699">err</span>&nbsp;<span class="op" id="6325703">:=</span>&nbsp;<span class="ident" id="6325706">config</span><span class="op" id="6325712">.</span><span class="ident" id="6325713">Fprint</span><span class="op" id="6325719">(</span><span class="op" id="6325720">&amp;</span><span class="ident" id="6325721">buf</span><span class="op" id="6325724">,</span>&nbsp;<span class="ident" id="6325726">fset</span><span class="op" id="6325730">,</span>&nbsp;<span class="ident" id="6325732">file</span><span class="op" id="6325736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325740">if</span>&nbsp;<span class="ident" id="6325743">err</span>&nbsp;<span class="op" id="6325747">!=</span>&nbsp;<span class="ident" id="6325750">nil</span>&nbsp;<span class="op" id="6325754">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325759">return</span>&nbsp;<span class="ident" id="6325766">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325776">file</span><span class="op" id="6325780">,</span>&nbsp;<span class="ident" id="6325782">err</span>&nbsp;<span class="op" id="6325786">=</span>&nbsp;<span class="ident" id="6325788">parser</span><span class="op" id="6325794">.</span><span class="ident" id="6325795">ParseFile</span><span class="op" id="6325804">(</span><span class="ident" id="6325805">fset</span><span class="op" id="6325809">,</span>&nbsp;<span class="string" id="6325811">&#34;&#34;</span><span class="op" id="6325813">,</span>&nbsp;<span class="ident" id="6325815">buf</span><span class="op" id="6325818">.</span><span class="ident" id="6325819">Bytes</span><span class="op" id="6325824">(</span><span class="op" id="6325825">)</span><span class="op" id="6325826">,</span>&nbsp;<span class="ident" id="6325828">parserMode</span><span class="op" id="6325838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325842">if</span>&nbsp;<span class="ident" id="6325845">err</span>&nbsp;<span class="op" id="6325849">!=</span>&nbsp;<span class="ident" id="6325852">nil</span>&nbsp;<span class="op" id="6325856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325861">//&nbsp;We&nbsp;should&nbsp;never&nbsp;get&nbsp;here.&nbsp;If&nbsp;we&nbsp;do,&nbsp;provide&nbsp;good&nbsp;diagnostic.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325928">return</span>&nbsp;<span class="ident" id="6325935">fmt</span><span class="op" id="6325938">.</span><span class="ident" id="6325939">Errorf</span><span class="op" id="6325945">(</span><span class="string" id="6325946">&#34;format.Node&nbsp;internal&nbsp;error&nbsp;(%s)&#34;</span><span class="op" id="6325979">,</span>&nbsp;<span class="ident" id="6325981">err</span><span class="op" id="6325984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325992">ast</span><span class="op" id="6325995">.</span><span class="ident" id="6325996">SortImports</span><span class="op" id="6326007">(</span><span class="ident" id="6326008">fset</span><span class="op" id="6326012">,</span>&nbsp;<span class="ident" id="6326014">file</span><span class="op" id="6326018">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326023">//&nbsp;Use&nbsp;new&nbsp;file&nbsp;with&nbsp;sorted&nbsp;imports.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326062">node</span>&nbsp;<span class="op" id="6326067">=</span>&nbsp;<span class="ident" id="6326069">file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326076">if</span>&nbsp;<span class="ident" id="6326079">cnode</span>&nbsp;<span class="op" id="6326085">!=</span>&nbsp;<span class="ident" id="6326088">nil</span>&nbsp;<span class="op" id="6326092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326097">node</span>&nbsp;<span class="op" id="6326102">=</span>&nbsp;<span class="op" id="6326104">&amp;</span><span class="ident" id="6326105">printer</span><span class="op" id="6326112">.</span><span class="ident" id="6326113">CommentedNode</span><span class="op" id="6326126">{</span><span class="ident" id="6326127">Node</span><span class="op" id="6326131">:</span>&nbsp;<span class="ident" id="6326133">file</span><span class="op" id="6326137">,</span>&nbsp;<span class="ident" id="6326139">Comments</span><span class="op" id="6326147">:</span>&nbsp;<span class="ident" id="6326149">cnode</span><span class="op" id="6326154">.</span><span class="ident" id="6326155">Comments</span><span class="op" id="6326163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326170">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326174">return</span>&nbsp;<span class="ident" id="6326181">config</span><span class="op" id="6326187">.</span><span class="ident" id="6326188">Fprint</span><span class="op" id="6326194">(</span><span class="ident" id="6326195">dst</span><span class="op" id="6326198">,</span>&nbsp;<span class="ident" id="6326200">fset</span><span class="op" id="6326204">,</span>&nbsp;<span class="ident" id="6326206">node</span><span class="op" id="6326210">)</span><br>
<span class="lineno"></span><span class="op" id="6326212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6326215">//&nbsp;Source&nbsp;formats&nbsp;src&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;returns&nbsp;the&nbsp;result</span><br>
<span class="lineno">75</span><span class="comment" id="6326285">//&nbsp;or&nbsp;an&nbsp;(I/O&nbsp;or&nbsp;syntax)&nbsp;error.&nbsp;src&nbsp;is&nbsp;expected&nbsp;to&nbsp;be&nbsp;a&nbsp;syntactically</span><br>
<span class="lineno"></span><span class="comment" id="6326355">//&nbsp;correct&nbsp;Go&nbsp;source&nbsp;file,&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;Go&nbsp;declarations&nbsp;or&nbsp;statements.</span><br>
<span class="lineno"></span><span class="comment" id="6326426">//</span><br>
<span class="lineno"></span><span class="comment" id="6326429">//&nbsp;If&nbsp;src&nbsp;is&nbsp;a&nbsp;partial&nbsp;source&nbsp;file,&nbsp;the&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space&nbsp;of&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="6326503">//&nbsp;is&nbsp;applied&nbsp;to&nbsp;the&nbsp;result&nbsp;(such&nbsp;that&nbsp;it&nbsp;has&nbsp;the&nbsp;same&nbsp;leading&nbsp;and&nbsp;trailing</span><br>
<span class="lineno">80</span><span class="comment" id="6326579">//&nbsp;space&nbsp;as&nbsp;src),&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;indented&nbsp;by&nbsp;the&nbsp;same&nbsp;amount&nbsp;as&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="6326656">//&nbsp;line&nbsp;of&nbsp;src&nbsp;containing&nbsp;code.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for&nbsp;partial&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="6326737">//</span><br>
<span class="lineno"></span><span class="keyword" id="6326740">func</span>&nbsp;<span class="ident" id="6326745">Source</span><span class="op" id="6326751">(</span><span class="ident" id="6326752">src</span>&nbsp;<span class="op" id="6326756">[</span><span class="op" id="6326757">]</span><span class="builtintype" id="6326758">byte</span><span class="op" id="6326762">)</span>&nbsp;<span class="op" id="6326764">(</span><span class="op" id="6326765">[</span><span class="op" id="6326766">]</span><span class="builtintype" id="6326767">byte</span><span class="op" id="6326771">,</span>&nbsp;<span class="builtintype" id="6326773">error</span><span class="op" id="6326778">)</span>&nbsp;<span class="op" id="6326780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326783">fset</span>&nbsp;<span class="op" id="6326788">:=</span>&nbsp;<span class="ident" id="6326791">token</span><span class="op" id="6326796">.</span><span class="ident" id="6326797">NewFileSet</span><span class="op" id="6326807">(</span><span class="op" id="6326808">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326811">file</span><span class="op" id="6326815">,</span>&nbsp;<span class="ident" id="6326817">sourceAdj</span><span class="op" id="6326826">,</span>&nbsp;<span class="ident" id="6326828">indentAdj</span><span class="op" id="6326837">,</span>&nbsp;<span class="ident" id="6326839">err</span>&nbsp;<span class="op" id="6326843">:=</span>&nbsp;<span class="ident" id="6326846">parse</span><span class="op" id="6326851">(</span><span class="ident" id="6326852">fset</span><span class="op" id="6326856">,</span>&nbsp;<span class="string" id="6326858">&#34;&#34;</span><span class="op" id="6326860">,</span>&nbsp;<span class="ident" id="6326862">src</span><span class="op" id="6326865">,</span>&nbsp;<span class="builtintype" id="6326867">true</span><span class="op" id="6326871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326874">if</span>&nbsp;<span class="ident" id="6326877">err</span>&nbsp;<span class="op" id="6326881">!=</span>&nbsp;<span class="ident" id="6326884">nil</span>&nbsp;<span class="op" id="6326888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326892">return</span>&nbsp;<span class="ident" id="6326899">nil</span><span class="op" id="6326902">,</span>&nbsp;<span class="ident" id="6326904">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326913">if</span>&nbsp;<span class="ident" id="6326916">sourceAdj</span>&nbsp;<span class="op" id="6326926">==</span>&nbsp;<span class="ident" id="6326929">nil</span>&nbsp;<span class="op" id="6326933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326937">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326964">//&nbsp;TODO(gri)&nbsp;consider&nbsp;doing&nbsp;this&nbsp;always.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327007">ast</span><span class="op" id="6327010">.</span><span class="ident" id="6327011">SortImports</span><span class="op" id="6327022">(</span><span class="ident" id="6327023">fset</span><span class="op" id="6327027">,</span>&nbsp;<span class="ident" id="6327029">file</span><span class="op" id="6327033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327036">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327040">return</span>&nbsp;<span class="ident" id="6327047">format</span><span class="op" id="6327053">(</span><span class="ident" id="6327054">fset</span><span class="op" id="6327058">,</span>&nbsp;<span class="ident" id="6327060">file</span><span class="op" id="6327064">,</span>&nbsp;<span class="ident" id="6327066">sourceAdj</span><span class="op" id="6327075">,</span>&nbsp;<span class="ident" id="6327077">indentAdj</span><span class="op" id="6327086">,</span>&nbsp;<span class="ident" id="6327088">src</span><span class="op" id="6327091">,</span>&nbsp;<span class="ident" id="6327093">config</span><span class="op" id="6327099">)</span><br>
<span class="lineno"></span><span class="op" id="6327101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6327104">func</span>&nbsp;<span class="ident" id="6327109">hasUnsortedImports</span><span class="op" id="6327127">(</span><span class="ident" id="6327128">file</span>&nbsp;<span class="op" id="6327133">*</span><span class="ident" id="6327134">ast</span><span class="op" id="6327137">.</span><span class="ident" id="6327138">File</span><span class="op" id="6327142">)</span>&nbsp;<span class="builtintype" id="6327144">bool</span>&nbsp;<span class="op" id="6327149">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327152">for</span>&nbsp;<span class="ident" id="6327156">_</span><span class="op" id="6327157">,</span>&nbsp;<span class="ident" id="6327159">d</span>&nbsp;<span class="op" id="6327161">:=</span>&nbsp;<span class="keyword" id="6327164">range</span>&nbsp;<span class="ident" id="6327170">file</span><span class="op" id="6327174">.</span><span class="ident" id="6327175">Decls</span>&nbsp;<span class="op" id="6327181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327185">d</span><span class="op" id="6327186">,</span>&nbsp;<span class="ident" id="6327188">ok</span>&nbsp;<span class="op" id="6327191">:=</span>&nbsp;<span class="ident" id="6327194">d</span><span class="op" id="6327195">.</span><span class="op" id="6327196">(</span><span class="op" id="6327197">*</span><span class="ident" id="6327198">ast</span><span class="op" id="6327201">.</span><span class="ident" id="6327202">GenDecl</span><span class="op" id="6327209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327213">if</span>&nbsp;<span class="op" id="6327216">!</span><span class="ident" id="6327217">ok</span>&nbsp;<span class="op" id="6327220">||</span>&nbsp;<span class="ident" id="6327223">d</span><span class="op" id="6327224">.</span><span class="ident" id="6327225">Tok</span>&nbsp;<span class="op" id="6327229">!=</span>&nbsp;<span class="ident" id="6327232">token</span><span class="op" id="6327237">.</span><span class="ident" id="6327238">IMPORT</span>&nbsp;<span class="op" id="6327245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327250">//&nbsp;Not&nbsp;an&nbsp;import&nbsp;declaration,&nbsp;so&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327298">//&nbsp;Imports&nbsp;are&nbsp;always&nbsp;first.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327330">return</span>&nbsp;<span class="builtintype" id="6327337">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327349">if</span>&nbsp;<span class="ident" id="6327352">d</span><span class="op" id="6327353">.</span><span class="ident" id="6327354">Lparen</span><span class="op" id="6327360">.</span><span class="ident" id="6327361">IsValid</span><span class="op" id="6327368">(</span><span class="op" id="6327369">)</span>&nbsp;<span class="op" id="6327371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327376">//&nbsp;For&nbsp;now&nbsp;assume&nbsp;all&nbsp;grouped&nbsp;imports&nbsp;are&nbsp;unsorted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327431">//&nbsp;TODO(gri)&nbsp;Should&nbsp;check&nbsp;if&nbsp;they&nbsp;are&nbsp;sorted&nbsp;already.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327488">return</span>&nbsp;<span class="builtintype" id="6327495">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327506">//&nbsp;Ungrouped&nbsp;imports&nbsp;are&nbsp;sorted&nbsp;by&nbsp;default.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327554">return</span>&nbsp;<span class="builtintype" id="6327561">false</span><br>
<span class="lineno">115</span><span class="op" id="6327567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6327570">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6327650">//&nbsp;Support&nbsp;functions</span><br>
<span class="lineno"></span><span class="comment" id="6327671">//</span><br>
<span class="lineno">120</span><span class="comment" id="6327674">//&nbsp;The&nbsp;functions&nbsp;parse,&nbsp;format,&nbsp;and&nbsp;isSpace&nbsp;below&nbsp;are&nbsp;identical&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6327745">//&nbsp;respective&nbsp;functions&nbsp;in&nbsp;cmd/gofmt/gofmt.go&nbsp;-&nbsp;keep&nbsp;them&nbsp;in&nbsp;sync!</span><br>
<span class="lineno"></span><span class="comment" id="6327812">//</span><br>
<span class="lineno"></span><span class="comment" id="6327815">//&nbsp;TODO(gri)&nbsp;Factor&nbsp;out&nbsp;this&nbsp;functionality,&nbsp;eventually.</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="6327872">//&nbsp;parse&nbsp;parses&nbsp;src,&nbsp;which&nbsp;was&nbsp;read&nbsp;from&nbsp;the&nbsp;named&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="6327929">//&nbsp;as&nbsp;a&nbsp;Go&nbsp;source&nbsp;file,&nbsp;declaration,&nbsp;or&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="6327985">func</span>&nbsp;<span class="ident" id="6327990">parse</span><span class="op" id="6327995">(</span><span class="ident" id="6327996">fset</span>&nbsp;<span class="op" id="6328001">*</span><span class="ident" id="6328002">token</span><span class="op" id="6328007">.</span><span class="ident" id="6328008">FileSet</span><span class="op" id="6328015">,</span>&nbsp;<span class="ident" id="6328017">filename</span>&nbsp;<span class="builtintype" id="6328026">string</span><span class="op" id="6328032">,</span>&nbsp;<span class="ident" id="6328034">src</span>&nbsp;<span class="op" id="6328038">[</span><span class="op" id="6328039">]</span><span class="builtintype" id="6328040">byte</span><span class="op" id="6328044">,</span>&nbsp;<span class="ident" id="6328046">fragmentOk</span>&nbsp;<span class="builtintype" id="6328057">bool</span><span class="op" id="6328061">)</span>&nbsp;<span class="op" id="6328063">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328066">file</span>&nbsp;<span class="op" id="6328071">*</span><span class="ident" id="6328072">ast</span><span class="op" id="6328075">.</span><span class="ident" id="6328076">File</span><span class="op" id="6328080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328083">sourceAdj</span>&nbsp;<span class="keyword" id="6328093">func</span><span class="op" id="6328097">(</span><span class="ident" id="6328098">src</span>&nbsp;<span class="op" id="6328102">[</span><span class="op" id="6328103">]</span><span class="builtintype" id="6328104">byte</span><span class="op" id="6328108">,</span>&nbsp;<span class="ident" id="6328110">indent</span>&nbsp;<span class="builtintype" id="6328117">int</span><span class="op" id="6328120">)</span>&nbsp;<span class="op" id="6328122">[</span><span class="op" id="6328123">]</span><span class="builtintype" id="6328124">byte</span><span class="op" id="6328128">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328131">indentAdj</span>&nbsp;<span class="builtintype" id="6328141">int</span><span class="op" id="6328144">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328147">err</span>&nbsp;<span class="builtintype" id="6328151">error</span><span class="op" id="6328156">,</span><br>
<span class="lineno"></span><span class="op" id="6328158">)</span>&nbsp;<span class="op" id="6328160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328163">//&nbsp;Try&nbsp;as&nbsp;whole&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328193">file</span><span class="op" id="6328197">,</span>&nbsp;<span class="ident" id="6328199">err</span>&nbsp;<span class="op" id="6328203">=</span>&nbsp;<span class="ident" id="6328205">parser</span><span class="op" id="6328211">.</span><span class="ident" id="6328212">ParseFile</span><span class="op" id="6328221">(</span><span class="ident" id="6328222">fset</span><span class="op" id="6328226">,</span>&nbsp;<span class="ident" id="6328228">filename</span><span class="op" id="6328236">,</span>&nbsp;<span class="ident" id="6328238">src</span><span class="op" id="6328241">,</span>&nbsp;<span class="ident" id="6328243">parserMode</span><span class="op" id="6328253">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328256">//&nbsp;If&nbsp;there&#39;s&nbsp;no&nbsp;error,&nbsp;return.&nbsp;&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328347">//&nbsp;package&nbsp;line&nbsp;and&nbsp;source&nbsp;fragments&nbsp;are&nbsp;ok,&nbsp;fall&nbsp;through&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328409">//&nbsp;try&nbsp;as&nbsp;a&nbsp;source&nbsp;fragment.&nbsp;&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328476">if</span>&nbsp;<span class="ident" id="6328479">err</span>&nbsp;<span class="op" id="6328483">==</span>&nbsp;<span class="ident" id="6328486">nil</span>&nbsp;<span class="op" id="6328490">||</span>&nbsp;<span class="op" id="6328493">!</span><span class="ident" id="6328494">fragmentOk</span>&nbsp;<span class="op" id="6328505">||</span>&nbsp;<span class="op" id="6328508">!</span><span class="ident" id="6328509">strings</span><span class="op" id="6328516">.</span><span class="ident" id="6328517">Contains</span><span class="op" id="6328525">(</span><span class="ident" id="6328526">err</span><span class="op" id="6328529">.</span><span class="ident" id="6328530">Error</span><span class="op" id="6328535">(</span><span class="op" id="6328536">)</span><span class="op" id="6328537">,</span>&nbsp;<span class="string" id="6328539">&#34;expected&nbsp;&#39;package&#39;&#34;</span><span class="op" id="6328559">)</span>&nbsp;<span class="op" id="6328561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328565">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328577">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;declaration&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328634">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328669">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328731">//&nbsp;in&nbsp;psrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328766">psrc</span>&nbsp;<span class="op" id="6328771">:=</span>&nbsp;<span class="builtinfunc" id="6328774">append</span><span class="op" id="6328780">(</span><span class="op" id="6328781">[</span><span class="op" id="6328782">]</span><span class="builtintype" id="6328783">byte</span><span class="op" id="6328787">(</span><span class="string" id="6328788">&#34;package&nbsp;p;&#34;</span><span class="op" id="6328800">)</span><span class="op" id="6328801">,</span>&nbsp;<span class="ident" id="6328803">src</span><span class="op" id="6328806">...</span><span class="op" id="6328809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328812">file</span><span class="op" id="6328816">,</span>&nbsp;<span class="ident" id="6328818">err</span>&nbsp;<span class="op" id="6328822">=</span>&nbsp;<span class="ident" id="6328824">parser</span><span class="op" id="6328830">.</span><span class="ident" id="6328831">ParseFile</span><span class="op" id="6328840">(</span><span class="ident" id="6328841">fset</span><span class="op" id="6328845">,</span>&nbsp;<span class="ident" id="6328847">filename</span><span class="op" id="6328855">,</span>&nbsp;<span class="ident" id="6328857">psrc</span><span class="op" id="6328861">,</span>&nbsp;<span class="ident" id="6328863">parserMode</span><span class="op" id="6328873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328876">if</span>&nbsp;<span class="ident" id="6328879">err</span>&nbsp;<span class="op" id="6328883">==</span>&nbsp;<span class="ident" id="6328886">nil</span>&nbsp;<span class="op" id="6328890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328894">sourceAdj</span>&nbsp;<span class="op" id="6328904">=</span>&nbsp;<span class="keyword" id="6328906">func</span><span class="op" id="6328910">(</span><span class="ident" id="6328911">src</span>&nbsp;<span class="op" id="6328915">[</span><span class="op" id="6328916">]</span><span class="builtintype" id="6328917">byte</span><span class="op" id="6328921">,</span>&nbsp;<span class="ident" id="6328923">indent</span>&nbsp;<span class="builtintype" id="6328930">int</span><span class="op" id="6328933">)</span>&nbsp;<span class="op" id="6328935">[</span><span class="op" id="6328936">]</span><span class="builtintype" id="6328937">byte</span>&nbsp;<span class="op" id="6328942">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328947">//&nbsp;Remove&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328980">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329020">src</span>&nbsp;<span class="op" id="6329024">=</span>&nbsp;<span class="ident" id="6329026">src</span><span class="op" id="6329029">[</span><span class="ident" id="6329030">indent</span><span class="op" id="6329036">+</span><span class="builtinfunc" id="6329037">len</span><span class="op" id="6329040">(</span><span class="string" id="6329041">&#34;package&nbsp;p\n&#34;</span><span class="op" id="6329054">)</span><span class="op" id="6329055">:</span><span class="op" id="6329056">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329061">return</span>&nbsp;<span class="ident" id="6329068">bytes</span><span class="op" id="6329073">.</span><span class="ident" id="6329074">TrimSpace</span><span class="op" id="6329083">(</span><span class="ident" id="6329084">src</span><span class="op" id="6329087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329091">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329095">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329106">//&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329167">//&nbsp;declaration,&nbsp;fall&nbsp;through&nbsp;to&nbsp;try&nbsp;as&nbsp;a&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329225">//&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329265">if</span>&nbsp;<span class="op" id="6329268">!</span><span class="ident" id="6329269">strings</span><span class="op" id="6329276">.</span><span class="ident" id="6329277">Contains</span><span class="op" id="6329285">(</span><span class="ident" id="6329286">err</span><span class="op" id="6329289">.</span><span class="ident" id="6329290">Error</span><span class="op" id="6329295">(</span><span class="op" id="6329296">)</span><span class="op" id="6329297">,</span>&nbsp;<span class="string" id="6329299">&#34;expected&nbsp;declaration&#34;</span><span class="op" id="6329321">)</span>&nbsp;<span class="op" id="6329323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329327">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329339">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;statement&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329394">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause&nbsp;and&nbsp;turning&nbsp;the&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329449">//&nbsp;into&nbsp;a&nbsp;function&nbsp;body.&nbsp;&nbsp;This&nbsp;handles&nbsp;expressions&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329506">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329568">//&nbsp;in&nbsp;fsrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329603">fsrc</span>&nbsp;<span class="op" id="6329608">:=</span>&nbsp;<span class="builtinfunc" id="6329611">append</span><span class="op" id="6329617">(</span><span class="builtinfunc" id="6329618">append</span><span class="op" id="6329624">(</span><span class="op" id="6329625">[</span><span class="op" id="6329626">]</span><span class="builtintype" id="6329627">byte</span><span class="op" id="6329631">(</span><span class="string" id="6329632">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="6329655">)</span><span class="op" id="6329656">,</span>&nbsp;<span class="ident" id="6329658">src</span><span class="op" id="6329661">...</span><span class="op" id="6329664">)</span><span class="op" id="6329665">,</span>&nbsp;<span class="string" id="6329667">&#39;\n&#39;</span><span class="op" id="6329671">,</span>&nbsp;<span class="string" id="6329673">&#39;}&#39;</span><span class="op" id="6329676">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329679">file</span><span class="op" id="6329683">,</span>&nbsp;<span class="ident" id="6329685">err</span>&nbsp;<span class="op" id="6329689">=</span>&nbsp;<span class="ident" id="6329691">parser</span><span class="op" id="6329697">.</span><span class="ident" id="6329698">ParseFile</span><span class="op" id="6329707">(</span><span class="ident" id="6329708">fset</span><span class="op" id="6329712">,</span>&nbsp;<span class="ident" id="6329714">filename</span><span class="op" id="6329722">,</span>&nbsp;<span class="ident" id="6329724">fsrc</span><span class="op" id="6329728">,</span>&nbsp;<span class="ident" id="6329730">parserMode</span><span class="op" id="6329740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329743">if</span>&nbsp;<span class="ident" id="6329746">err</span>&nbsp;<span class="op" id="6329750">==</span>&nbsp;<span class="ident" id="6329753">nil</span>&nbsp;<span class="op" id="6329757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329761">sourceAdj</span>&nbsp;<span class="op" id="6329771">=</span>&nbsp;<span class="keyword" id="6329773">func</span><span class="op" id="6329777">(</span><span class="ident" id="6329778">src</span>&nbsp;<span class="op" id="6329782">[</span><span class="op" id="6329783">]</span><span class="builtintype" id="6329784">byte</span><span class="op" id="6329788">,</span>&nbsp;<span class="ident" id="6329790">indent</span>&nbsp;<span class="builtintype" id="6329797">int</span><span class="op" id="6329800">)</span>&nbsp;<span class="op" id="6329802">[</span><span class="op" id="6329803">]</span><span class="builtintype" id="6329804">byte</span>&nbsp;<span class="op" id="6329809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329814">//&nbsp;Cap&nbsp;adjusted&nbsp;indent&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329849">if</span>&nbsp;<span class="ident" id="6329852">indent</span>&nbsp;<span class="op" id="6329859">&lt;</span>&nbsp;<span class="num" id="6329861">0</span>&nbsp;<span class="op" id="6329863">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329869">indent</span>&nbsp;<span class="op" id="6329876">=</span>&nbsp;<span class="num" id="6329878">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329888">//&nbsp;Remove&nbsp;the&nbsp;wrapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329915">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329957">//&nbsp;There&nbsp;will&nbsp;be&nbsp;two&nbsp;non-blank&nbsp;lines&nbsp;with&nbsp;indent,&nbsp;hence&nbsp;2*indent.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330026">src</span>&nbsp;<span class="op" id="6330030">=</span>&nbsp;<span class="ident" id="6330032">src</span><span class="op" id="6330035">[</span><span class="num" id="6330036">2</span><span class="op" id="6330037">*</span><span class="ident" id="6330038">indent</span><span class="op" id="6330044">+</span><span class="builtinfunc" id="6330045">len</span><span class="op" id="6330048">(</span><span class="string" id="6330049">&#34;package&nbsp;p\n\nfunc&nbsp;_()&nbsp;{&#34;</span><span class="op" id="6330074">)</span><span class="op" id="6330075">:</span><span class="op" id="6330076">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330081">src</span>&nbsp;<span class="op" id="6330085">=</span>&nbsp;<span class="ident" id="6330087">src</span><span class="op" id="6330090">[</span><span class="op" id="6330091">:</span><span class="builtinfunc" id="6330092">len</span><span class="op" id="6330095">(</span><span class="ident" id="6330096">src</span><span class="op" id="6330099">)</span><span class="op" id="6330100">-</span><span class="op" id="6330101">(</span><span class="ident" id="6330102">indent</span><span class="op" id="6330108">+</span><span class="builtinfunc" id="6330109">len</span><span class="op" id="6330112">(</span><span class="string" id="6330113">&#34;\n}\n&#34;</span><span class="op" id="6330120">)</span><span class="op" id="6330121">)</span><span class="op" id="6330122">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330127">return</span>&nbsp;<span class="ident" id="6330134">bytes</span><span class="op" id="6330139">.</span><span class="ident" id="6330140">TrimSpace</span><span class="op" id="6330149">(</span><span class="ident" id="6330150">src</span><span class="op" id="6330153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6330161">//&nbsp;Gofmt&nbsp;has&nbsp;also&nbsp;indented&nbsp;the&nbsp;function&nbsp;body&nbsp;one&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6330219">//&nbsp;Adjust&nbsp;that&nbsp;with&nbsp;indentAdj.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330252">indentAdj</span>&nbsp;<span class="op" id="6330262">=</span>&nbsp;<span class="op" id="6330264">-</span><span class="num" id="6330265">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6330272">//&nbsp;Succeeded,&nbsp;or&nbsp;out&nbsp;of&nbsp;options.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330306">return</span><br>
<span class="lineno"></span><span class="op" id="6330313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6330316">//&nbsp;format&nbsp;formats&nbsp;the&nbsp;given&nbsp;package&nbsp;file&nbsp;originally&nbsp;obtained&nbsp;from&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="6330386">//&nbsp;and&nbsp;adjusts&nbsp;the&nbsp;result&nbsp;based&nbsp;on&nbsp;the&nbsp;original&nbsp;source&nbsp;via&nbsp;sourceAdj</span><br>
<span class="lineno">195</span><span class="comment" id="6330455">//&nbsp;and&nbsp;indentAdj.</span><br>
<span class="lineno"></span><span class="keyword" id="6330473">func</span>&nbsp;<span class="ident" id="6330478">format</span><span class="op" id="6330484">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330487">fset</span>&nbsp;<span class="op" id="6330492">*</span><span class="ident" id="6330493">token</span><span class="op" id="6330498">.</span><span class="ident" id="6330499">FileSet</span><span class="op" id="6330506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330509">file</span>&nbsp;<span class="op" id="6330514">*</span><span class="ident" id="6330515">ast</span><span class="op" id="6330518">.</span><span class="ident" id="6330519">File</span><span class="op" id="6330523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330526">sourceAdj</span>&nbsp;<span class="keyword" id="6330536">func</span><span class="op" id="6330540">(</span><span class="ident" id="6330541">src</span>&nbsp;<span class="op" id="6330545">[</span><span class="op" id="6330546">]</span><span class="builtintype" id="6330547">byte</span><span class="op" id="6330551">,</span>&nbsp;<span class="ident" id="6330553">indent</span>&nbsp;<span class="builtintype" id="6330560">int</span><span class="op" id="6330563">)</span>&nbsp;<span class="op" id="6330565">[</span><span class="op" id="6330566">]</span><span class="builtintype" id="6330567">byte</span><span class="op" id="6330571">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330574">indentAdj</span>&nbsp;<span class="builtintype" id="6330584">int</span><span class="op" id="6330587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330590">src</span>&nbsp;<span class="op" id="6330594">[</span><span class="op" id="6330595">]</span><span class="builtintype" id="6330596">byte</span><span class="op" id="6330600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330603">cfg</span>&nbsp;<span class="ident" id="6330607">printer</span><span class="op" id="6330614">.</span><span class="ident" id="6330615">Config</span><span class="op" id="6330621">,</span><br>
<span class="lineno"></span><span class="op" id="6330623">)</span>&nbsp;<span class="op" id="6330625">(</span><span class="op" id="6330626">[</span><span class="op" id="6330627">]</span><span class="builtintype" id="6330628">byte</span><span class="op" id="6330632">,</span>&nbsp;<span class="builtintype" id="6330634">error</span><span class="op" id="6330639">)</span>&nbsp;<span class="op" id="6330641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330644">if</span>&nbsp;<span class="ident" id="6330647">sourceAdj</span>&nbsp;<span class="op" id="6330657">==</span>&nbsp;<span class="ident" id="6330660">nil</span>&nbsp;<span class="op" id="6330664">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6330668">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330695">var</span>&nbsp;<span class="ident" id="6330699">buf</span>&nbsp;<span class="ident" id="6330703">bytes</span><span class="op" id="6330708">.</span><span class="ident" id="6330709">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330718">err</span>&nbsp;<span class="op" id="6330722">:=</span>&nbsp;<span class="ident" id="6330725">cfg</span><span class="op" id="6330728">.</span><span class="ident" id="6330729">Fprint</span><span class="op" id="6330735">(</span><span class="op" id="6330736">&amp;</span><span class="ident" id="6330737">buf</span><span class="op" id="6330740">,</span>&nbsp;<span class="ident" id="6330742">fset</span><span class="op" id="6330746">,</span>&nbsp;<span class="ident" id="6330748">file</span><span class="op" id="6330752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330756">if</span>&nbsp;<span class="ident" id="6330759">err</span>&nbsp;<span class="op" id="6330763">!=</span>&nbsp;<span class="ident" id="6330766">nil</span>&nbsp;<span class="op" id="6330770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330775">return</span>&nbsp;<span class="ident" id="6330782">nil</span><span class="op" id="6330785">,</span>&nbsp;<span class="ident" id="6330787">err</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330797">return</span>&nbsp;<span class="ident" id="6330804">buf</span><span class="op" id="6330807">.</span><span class="ident" id="6330808">Bytes</span><span class="op" id="6330813">(</span><span class="op" id="6330814">)</span><span class="op" id="6330815">,</span>&nbsp;<span class="ident" id="6330817">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6330826">//&nbsp;Partial&nbsp;source&nbsp;file.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6330851">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;leading&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330892">i</span><span class="op" id="6330893">,</span>&nbsp;<span class="ident" id="6330895">j</span>&nbsp;<span class="op" id="6330897">:=</span>&nbsp;<span class="num" id="6330900">0</span><span class="op" id="6330901">,</span>&nbsp;<span class="num" id="6330903">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330906">for</span>&nbsp;<span class="ident" id="6330910">j</span>&nbsp;<span class="op" id="6330912">&lt;</span>&nbsp;<span class="builtinfunc" id="6330914">len</span><span class="op" id="6330917">(</span><span class="ident" id="6330918">src</span><span class="op" id="6330921">)</span>&nbsp;<span class="op" id="6330923">&amp;&amp;</span>&nbsp;<span class="ident" id="6330926">isSpace</span><span class="op" id="6330933">(</span><span class="ident" id="6330934">src</span><span class="op" id="6330937">[</span><span class="ident" id="6330938">j</span><span class="op" id="6330939">]</span><span class="op" id="6330940">)</span>&nbsp;<span class="op" id="6330942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330946">if</span>&nbsp;<span class="ident" id="6330949">src</span><span class="op" id="6330952">[</span><span class="ident" id="6330953">j</span><span class="op" id="6330954">]</span>&nbsp;<span class="op" id="6330956">==</span>&nbsp;<span class="string" id="6330959">&#39;\n&#39;</span>&nbsp;<span class="op" id="6330964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330969">i</span>&nbsp;<span class="op" id="6330971">=</span>&nbsp;<span class="ident" id="6330973">j</span>&nbsp;<span class="op" id="6330975">+</span>&nbsp;<span class="num" id="6330977">1</span>&nbsp;<span class="comment" id="6330979">//&nbsp;byte&nbsp;offset&nbsp;of&nbsp;last&nbsp;line&nbsp;in&nbsp;leading&nbsp;space</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331030">j</span><span class="op" id="6331031">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331038">var</span>&nbsp;<span class="ident" id="6331042">res</span>&nbsp;<span class="op" id="6331046">[</span><span class="op" id="6331047">]</span><span class="builtintype" id="6331048">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331054">res</span>&nbsp;<span class="op" id="6331058">=</span>&nbsp;<span class="builtinfunc" id="6331060">append</span><span class="op" id="6331066">(</span><span class="ident" id="6331067">res</span><span class="op" id="6331070">,</span>&nbsp;<span class="ident" id="6331072">src</span><span class="op" id="6331075">[</span><span class="op" id="6331076">:</span><span class="ident" id="6331077">i</span><span class="op" id="6331078">]</span><span class="op" id="6331079">...</span><span class="op" id="6331082">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6331086">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;indentation&nbsp;of&nbsp;first&nbsp;code&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6331144">//&nbsp;Spaces&nbsp;are&nbsp;ignored&nbsp;unless&nbsp;there&nbsp;are&nbsp;no&nbsp;tabs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6331193">//&nbsp;in&nbsp;which&nbsp;case&nbsp;spaces&nbsp;count&nbsp;as&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331236">indent</span>&nbsp;<span class="op" id="6331243">:=</span>&nbsp;<span class="num" id="6331246">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331249">hasSpace</span>&nbsp;<span class="op" id="6331258">:=</span>&nbsp;<span class="builtintype" id="6331261">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331268">for</span>&nbsp;<span class="ident" id="6331272">_</span><span class="op" id="6331273">,</span>&nbsp;<span class="ident" id="6331275">b</span>&nbsp;<span class="op" id="6331277">:=</span>&nbsp;<span class="keyword" id="6331280">range</span>&nbsp;<span class="ident" id="6331286">src</span><span class="op" id="6331289">[</span><span class="ident" id="6331290">i</span><span class="op" id="6331291">:</span><span class="ident" id="6331292">j</span><span class="op" id="6331293">]</span>&nbsp;<span class="op" id="6331295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331299">switch</span>&nbsp;<span class="ident" id="6331306">b</span>&nbsp;<span class="op" id="6331308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331312">case</span>&nbsp;<span class="string" id="6331317">&#39;&nbsp;&#39;</span><span class="op" id="6331320">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331325">hasSpace</span>&nbsp;<span class="op" id="6331334">=</span>&nbsp;<span class="builtintype" id="6331336">true</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331343">case</span>&nbsp;<span class="string" id="6331348">&#39;\t&#39;</span><span class="op" id="6331352">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331357">indent</span><span class="op" id="6331363">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331374">if</span>&nbsp;<span class="ident" id="6331377">indent</span>&nbsp;<span class="op" id="6331384">==</span>&nbsp;<span class="num" id="6331387">0</span>&nbsp;<span class="op" id="6331389">&amp;&amp;</span>&nbsp;<span class="ident" id="6331392">hasSpace</span>&nbsp;<span class="op" id="6331401">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331405">indent</span>&nbsp;<span class="op" id="6331412">=</span>&nbsp;<span class="num" id="6331414">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331420">for</span>&nbsp;<span class="ident" id="6331424">i</span>&nbsp;<span class="op" id="6331426">:=</span>&nbsp;<span class="num" id="6331429">0</span><span class="op" id="6331430">;</span>&nbsp;<span class="ident" id="6331432">i</span>&nbsp;<span class="op" id="6331434">&lt;</span>&nbsp;<span class="ident" id="6331436">indent</span><span class="op" id="6331442">;</span>&nbsp;<span class="ident" id="6331444">i</span><span class="op" id="6331445">++</span>&nbsp;<span class="op" id="6331448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331452">res</span>&nbsp;<span class="op" id="6331456">=</span>&nbsp;<span class="builtinfunc" id="6331458">append</span><span class="op" id="6331464">(</span><span class="ident" id="6331465">res</span><span class="op" id="6331468">,</span>&nbsp;<span class="string" id="6331470">&#39;\t&#39;</span><span class="op" id="6331474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331477">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6331481">//&nbsp;Format&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6331504">//&nbsp;Write&nbsp;it&nbsp;without&nbsp;any&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331557">cfg</span><span class="op" id="6331560">.</span><span class="ident" id="6331561">Indent</span>&nbsp;<span class="op" id="6331568">=</span>&nbsp;<span class="ident" id="6331570">indent</span>&nbsp;<span class="op" id="6331577">+</span>&nbsp;<span class="ident" id="6331579">indentAdj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331590">var</span>&nbsp;<span class="ident" id="6331594">buf</span>&nbsp;<span class="ident" id="6331598">bytes</span><span class="op" id="6331603">.</span><span class="ident" id="6331604">Buffer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331612">err</span>&nbsp;<span class="op" id="6331616">:=</span>&nbsp;<span class="ident" id="6331619">cfg</span><span class="op" id="6331622">.</span><span class="ident" id="6331623">Fprint</span><span class="op" id="6331629">(</span><span class="op" id="6331630">&amp;</span><span class="ident" id="6331631">buf</span><span class="op" id="6331634">,</span>&nbsp;<span class="ident" id="6331636">fset</span><span class="op" id="6331640">,</span>&nbsp;<span class="ident" id="6331642">file</span><span class="op" id="6331646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331649">if</span>&nbsp;<span class="ident" id="6331652">err</span>&nbsp;<span class="op" id="6331656">!=</span>&nbsp;<span class="ident" id="6331659">nil</span>&nbsp;<span class="op" id="6331663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331667">return</span>&nbsp;<span class="ident" id="6331674">nil</span><span class="op" id="6331677">,</span>&nbsp;<span class="ident" id="6331679">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331687">res</span>&nbsp;<span class="op" id="6331691">=</span>&nbsp;<span class="builtinfunc" id="6331693">append</span><span class="op" id="6331699">(</span><span class="ident" id="6331700">res</span><span class="op" id="6331703">,</span>&nbsp;<span class="ident" id="6331705">sourceAdj</span><span class="op" id="6331714">(</span><span class="ident" id="6331715">buf</span><span class="op" id="6331718">.</span><span class="ident" id="6331719">Bytes</span><span class="op" id="6331724">(</span><span class="op" id="6331725">)</span><span class="op" id="6331726">,</span>&nbsp;<span class="ident" id="6331728">cfg</span><span class="op" id="6331731">.</span><span class="ident" id="6331732">Indent</span><span class="op" id="6331738">)</span><span class="op" id="6331739">...</span><span class="op" id="6331742">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6331746">//&nbsp;Determine&nbsp;and&nbsp;append&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331787">i</span>&nbsp;<span class="op" id="6331789">=</span>&nbsp;<span class="builtinfunc" id="6331791">len</span><span class="op" id="6331794">(</span><span class="ident" id="6331795">src</span><span class="op" id="6331798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331801">for</span>&nbsp;<span class="ident" id="6331805">i</span>&nbsp;<span class="op" id="6331807">&gt;</span>&nbsp;<span class="num" id="6331809">0</span>&nbsp;<span class="op" id="6331811">&amp;&amp;</span>&nbsp;<span class="ident" id="6331814">isSpace</span><span class="op" id="6331821">(</span><span class="ident" id="6331822">src</span><span class="op" id="6331825">[</span><span class="ident" id="6331826">i</span><span class="op" id="6331827">-</span><span class="num" id="6331828">1</span><span class="op" id="6331829">]</span><span class="op" id="6331830">)</span>&nbsp;<span class="op" id="6331832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331836">i</span><span class="op" id="6331837">--</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331844">return</span>&nbsp;<span class="builtinfunc" id="6331851">append</span><span class="op" id="6331857">(</span><span class="ident" id="6331858">res</span><span class="op" id="6331861">,</span>&nbsp;<span class="ident" id="6331863">src</span><span class="op" id="6331866">[</span><span class="ident" id="6331867">i</span><span class="op" id="6331868">:</span><span class="op" id="6331869">]</span><span class="op" id="6331870">...</span><span class="op" id="6331873">)</span><span class="op" id="6331874">,</span>&nbsp;<span class="ident" id="6331876">nil</span><br>
<span class="lineno"></span><span class="op" id="6331880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6331883">func</span>&nbsp;<span class="ident" id="6331888">isSpace</span><span class="op" id="6331895">(</span><span class="ident" id="6331896">b</span>&nbsp;<span class="builtintype" id="6331898">byte</span><span class="op" id="6331902">)</span>&nbsp;<span class="builtintype" id="6331904">bool</span>&nbsp;<span class="op" id="6331909">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331912">return</span>&nbsp;<span class="ident" id="6331919">b</span>&nbsp;<span class="op" id="6331921">==</span>&nbsp;<span class="string" id="6331924">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6331928">||</span>&nbsp;<span class="ident" id="6331931">b</span>&nbsp;<span class="op" id="6331933">==</span>&nbsp;<span class="string" id="6331936">&#39;\t&#39;</span>&nbsp;<span class="op" id="6331941">||</span>&nbsp;<span class="ident" id="6331944">b</span>&nbsp;<span class="op" id="6331946">==</span>&nbsp;<span class="string" id="6331949">&#39;\n&#39;</span>&nbsp;<span class="op" id="6331954">||</span>&nbsp;<span class="ident" id="6331957">b</span>&nbsp;<span class="op" id="6331959">==</span>&nbsp;<span class="string" id="6331962">&#39;\r&#39;</span><br>
<span class="lineno"></span><span class="op" id="6331967">}</span>
</div>
</body>
</html>
