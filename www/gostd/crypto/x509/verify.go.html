<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html" class="current">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4697049">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4697104">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4697158">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4697209">package</span>&nbsp;<span class="ident" id="4697217">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4697223">import</span>&nbsp;<span class="op" id="4697230">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4697233">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4697240">&#34;net&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4697247">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4697258">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4697269">&#34;time&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4697277">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4697292">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4697295">type</span>&nbsp;<span class="ident" id="4697300">InvalidReason</span>&nbsp;<span class="builtintype" id="4697314">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4697319">const</span>&nbsp;<span class="op" id="4697325">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697328">//&nbsp;NotAuthorizedToSign&nbsp;results&nbsp;when&nbsp;a&nbsp;certificate&nbsp;is&nbsp;signed&nbsp;by&nbsp;another</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697400">//&nbsp;which&nbsp;isn&#39;t&nbsp;marked&nbsp;as&nbsp;a&nbsp;CA&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697444">NotAuthorizedToSign</span>&nbsp;<span class="ident" id="4697464">InvalidReason</span>&nbsp;<span class="op" id="4697478">=</span>&nbsp;<span class="ident" id="4697480">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697486">//&nbsp;Expired&nbsp;results&nbsp;when&nbsp;a&nbsp;certificate&nbsp;has&nbsp;expired,&nbsp;based&nbsp;on&nbsp;the&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697556">//&nbsp;given&nbsp;in&nbsp;the&nbsp;VerifyOptions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697588">Expired</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697597">//&nbsp;CANotAuthorizedForThisName&nbsp;results&nbsp;when&nbsp;an&nbsp;intermediate&nbsp;or&nbsp;root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697665">//&nbsp;certificate&nbsp;has&nbsp;a&nbsp;name&nbsp;constraint&nbsp;which&nbsp;doesn&#39;t&nbsp;include&nbsp;the&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697734">//&nbsp;being&nbsp;checked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697753">CANotAuthorizedForThisName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697781">//&nbsp;TooManyIntermediates&nbsp;results&nbsp;when&nbsp;a&nbsp;path&nbsp;length&nbsp;constraint&nbsp;is</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697847">//&nbsp;violated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697861">TooManyIntermediates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697883">//&nbsp;IncompatibleUsage&nbsp;results&nbsp;when&nbsp;the&nbsp;certificate&#39;s&nbsp;key&nbsp;usage&nbsp;indicates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697956">//&nbsp;that&nbsp;it&nbsp;may&nbsp;only&nbsp;be&nbsp;used&nbsp;for&nbsp;a&nbsp;different&nbsp;purpose.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698010">IncompatibleUsage</span><br>
<span class="lineno">35</span><span class="op" id="4698028">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4698031">//&nbsp;CertificateInvalidError&nbsp;results&nbsp;when&nbsp;an&nbsp;odd&nbsp;error&nbsp;occurs.&nbsp;Users&nbsp;of&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="4698106">//&nbsp;library&nbsp;probably&nbsp;want&nbsp;to&nbsp;handle&nbsp;all&nbsp;these&nbsp;errors&nbsp;uniformly.</span><br>
<span class="lineno"></span><span class="keyword" id="4698169">type</span>&nbsp;<span class="ident" id="4698174">CertificateInvalidError</span>&nbsp;<span class="keyword" id="4698198">struct</span>&nbsp;<span class="op" id="4698205">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698208">Cert</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4698215">*</span><span class="ident" id="4698216">Certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698229">Reason</span>&nbsp;<span class="ident" id="4698236">InvalidReason</span><br>
<span class="lineno"></span><span class="op" id="4698250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4698253">func</span>&nbsp;<span class="op" id="4698258">(</span><span class="ident" id="4698259">e</span>&nbsp;<span class="ident" id="4698261">CertificateInvalidError</span><span class="op" id="4698284">)</span>&nbsp;<span class="ident" id="4698286">Error</span><span class="op" id="4698291">(</span><span class="op" id="4698292">)</span>&nbsp;<span class="builtintype" id="4698294">string</span>&nbsp;<span class="op" id="4698301">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698304">switch</span>&nbsp;<span class="ident" id="4698311">e</span><span class="op" id="4698312">.</span><span class="ident" id="4698313">Reason</span>&nbsp;<span class="op" id="4698320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698323">case</span>&nbsp;<span class="ident" id="4698328">NotAuthorizedToSign</span><span class="op" id="4698347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698351">return</span>&nbsp;<span class="string" id="4698358">&#34;x509:&nbsp;certificate&nbsp;is&nbsp;not&nbsp;authorized&nbsp;to&nbsp;sign&nbsp;other&nbsp;certificates&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698424">case</span>&nbsp;<span class="ident" id="4698429">Expired</span><span class="op" id="4698436">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698440">return</span>&nbsp;<span class="string" id="4698447">&#34;x509:&nbsp;certificate&nbsp;has&nbsp;expired&nbsp;or&nbsp;is&nbsp;not&nbsp;yet&nbsp;valid&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698500">case</span>&nbsp;<span class="ident" id="4698505">CANotAuthorizedForThisName</span><span class="op" id="4698531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698535">return</span>&nbsp;<span class="string" id="4698542">&#34;x509:&nbsp;a&nbsp;root&nbsp;or&nbsp;intermediate&nbsp;certificate&nbsp;is&nbsp;not&nbsp;authorized&nbsp;to&nbsp;sign&nbsp;in&nbsp;this&nbsp;domain&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698627">case</span>&nbsp;<span class="ident" id="4698632">TooManyIntermediates</span><span class="op" id="4698652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698656">return</span>&nbsp;<span class="string" id="4698663">&#34;x509:&nbsp;too&nbsp;many&nbsp;intermediates&nbsp;for&nbsp;path&nbsp;length&nbsp;constraint&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698722">case</span>&nbsp;<span class="ident" id="4698727">IncompatibleUsage</span><span class="op" id="4698744">:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698748">return</span>&nbsp;<span class="string" id="4698755">&#34;x509:&nbsp;certificate&nbsp;specifies&nbsp;an&nbsp;incompatible&nbsp;key&nbsp;usage&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698815">return</span>&nbsp;<span class="string" id="4698822">&#34;x509:&nbsp;unknown&nbsp;error&#34;</span><br>
<span class="lineno"></span><span class="op" id="4698844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4698847">//&nbsp;HostnameError&nbsp;results&nbsp;when&nbsp;the&nbsp;set&nbsp;of&nbsp;authorized&nbsp;names&nbsp;doesn&#39;t&nbsp;match&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4698923">//&nbsp;requested&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4698942">type</span>&nbsp;<span class="ident" id="4698947">HostnameError</span>&nbsp;<span class="keyword" id="4698961">struct</span>&nbsp;<span class="op" id="4698968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698971">Certificate</span>&nbsp;<span class="op" id="4698983">*</span><span class="ident" id="4698984">Certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698997">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4699009">string</span><br>
<span class="lineno">65</span><span class="op" id="4699016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4699019">func</span>&nbsp;<span class="op" id="4699024">(</span><span class="ident" id="4699025">h</span>&nbsp;<span class="ident" id="4699027">HostnameError</span><span class="op" id="4699040">)</span>&nbsp;<span class="ident" id="4699042">Error</span><span class="op" id="4699047">(</span><span class="op" id="4699048">)</span>&nbsp;<span class="builtintype" id="4699050">string</span>&nbsp;<span class="op" id="4699057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699060">c</span>&nbsp;<span class="op" id="4699062">:=</span>&nbsp;<span class="ident" id="4699065">h</span><span class="op" id="4699066">.</span><span class="ident" id="4699067">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699081">var</span>&nbsp;<span class="ident" id="4699085">valid</span>&nbsp;<span class="builtintype" id="4699091">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699099">if</span>&nbsp;<span class="ident" id="4699102">ip</span>&nbsp;<span class="op" id="4699105">:=</span>&nbsp;<span class="ident" id="4699108">net</span><span class="op" id="4699111">.</span><span class="ident" id="4699112">ParseIP</span><span class="op" id="4699119">(</span><span class="ident" id="4699120">h</span><span class="op" id="4699121">.</span><span class="ident" id="4699122">Host</span><span class="op" id="4699126">)</span><span class="op" id="4699127">;</span>&nbsp;<span class="ident" id="4699129">ip</span>&nbsp;<span class="op" id="4699132">!=</span>&nbsp;<span class="ident" id="4699135">nil</span>&nbsp;<span class="op" id="4699139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699143">//&nbsp;Trying&nbsp;to&nbsp;validate&nbsp;an&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699173">if</span>&nbsp;<span class="builtinfunc" id="4699176">len</span><span class="op" id="4699179">(</span><span class="ident" id="4699180">c</span><span class="op" id="4699181">.</span><span class="ident" id="4699182">IPAddresses</span><span class="op" id="4699193">)</span>&nbsp;<span class="op" id="4699195">==</span>&nbsp;<span class="num" id="4699198">0</span>&nbsp;<span class="op" id="4699200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699205">return</span>&nbsp;<span class="string" id="4699212">&#34;x509:&nbsp;cannot&nbsp;validate&nbsp;certificate&nbsp;for&nbsp;&#34;</span>&nbsp;<span class="op" id="4699253">+</span>&nbsp;<span class="ident" id="4699255">h</span><span class="op" id="4699256">.</span><span class="ident" id="4699257">Host</span>&nbsp;<span class="op" id="4699262">+</span>&nbsp;<span class="string" id="4699264">&#34;&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;contain&nbsp;any&nbsp;IP&nbsp;SANs&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699312">for</span>&nbsp;<span class="ident" id="4699316">_</span><span class="op" id="4699317">,</span>&nbsp;<span class="ident" id="4699319">san</span>&nbsp;<span class="op" id="4699323">:=</span>&nbsp;<span class="keyword" id="4699326">range</span>&nbsp;<span class="ident" id="4699332">c</span><span class="op" id="4699333">.</span><span class="ident" id="4699334">IPAddresses</span>&nbsp;<span class="op" id="4699346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699351">if</span>&nbsp;<span class="builtinfunc" id="4699354">len</span><span class="op" id="4699357">(</span><span class="ident" id="4699358">valid</span><span class="op" id="4699363">)</span>&nbsp;<span class="op" id="4699365">&gt;</span>&nbsp;<span class="num" id="4699367">0</span>&nbsp;<span class="op" id="4699369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699375">valid</span>&nbsp;<span class="op" id="4699381">+=</span>&nbsp;<span class="string" id="4699384">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699392">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699397">valid</span>&nbsp;<span class="op" id="4699403">+=</span>&nbsp;<span class="ident" id="4699406">san</span><span class="op" id="4699409">.</span><span class="ident" id="4699410">String</span><span class="op" id="4699416">(</span><span class="op" id="4699417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699424">}</span>&nbsp;<span class="keyword" id="4699426">else</span>&nbsp;<span class="op" id="4699431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699435">if</span>&nbsp;<span class="builtinfunc" id="4699438">len</span><span class="op" id="4699441">(</span><span class="ident" id="4699442">c</span><span class="op" id="4699443">.</span><span class="ident" id="4699444">DNSNames</span><span class="op" id="4699452">)</span>&nbsp;<span class="op" id="4699454">&gt;</span>&nbsp;<span class="num" id="4699456">0</span>&nbsp;<span class="op" id="4699458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699463">valid</span>&nbsp;<span class="op" id="4699469">=</span>&nbsp;<span class="ident" id="4699471">strings</span><span class="op" id="4699478">.</span><span class="ident" id="4699479">Join</span><span class="op" id="4699483">(</span><span class="ident" id="4699484">c</span><span class="op" id="4699485">.</span><span class="ident" id="4699486">DNSNames</span><span class="op" id="4699494">,</span>&nbsp;<span class="string" id="4699496">&#34;,&nbsp;&#34;</span><span class="op" id="4699500">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699504">}</span>&nbsp;<span class="keyword" id="4699506">else</span>&nbsp;<span class="op" id="4699511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699516">valid</span>&nbsp;<span class="op" id="4699522">=</span>&nbsp;<span class="ident" id="4699524">c</span><span class="op" id="4699525">.</span><span class="ident" id="4699526">Subject</span><span class="op" id="4699533">.</span><span class="ident" id="4699534">CommonName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699553">return</span>&nbsp;<span class="string" id="4699560">&#34;x509:&nbsp;certificate&nbsp;is&nbsp;valid&nbsp;for&nbsp;&#34;</span>&nbsp;<span class="op" id="4699594">+</span>&nbsp;<span class="ident" id="4699596">valid</span>&nbsp;<span class="op" id="4699602">+</span>&nbsp;<span class="string" id="4699604">&#34;,&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="4699613">+</span>&nbsp;<span class="ident" id="4699615">h</span><span class="op" id="4699616">.</span><span class="ident" id="4699617">Host</span><br>
<span class="lineno">90</span><span class="op" id="4699622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4699625">//&nbsp;UnknownAuthorityError&nbsp;results&nbsp;when&nbsp;the&nbsp;certificate&nbsp;issuer&nbsp;is&nbsp;unknown</span><br>
<span class="lineno"></span><span class="keyword" id="4699697">type</span>&nbsp;<span class="ident" id="4699702">UnknownAuthorityError</span>&nbsp;<span class="keyword" id="4699724">struct</span>&nbsp;<span class="op" id="4699731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699734">cert</span>&nbsp;<span class="op" id="4699739">*</span><span class="ident" id="4699740">Certificate</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699753">//&nbsp;hintErr&nbsp;contains&nbsp;an&nbsp;error&nbsp;that&nbsp;may&nbsp;be&nbsp;helpful&nbsp;in&nbsp;determining&nbsp;why&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699825">//&nbsp;authority&nbsp;wasn&#39;t&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699853">hintErr</span>&nbsp;<span class="builtintype" id="4699861">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699868">//&nbsp;hintCert&nbsp;contains&nbsp;a&nbsp;possible&nbsp;authority&nbsp;certificate&nbsp;that&nbsp;was&nbsp;rejected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699941">//&nbsp;because&nbsp;of&nbsp;the&nbsp;error&nbsp;in&nbsp;hintErr.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699978">hintCert</span>&nbsp;<span class="op" id="4699987">*</span><span class="ident" id="4699988">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4700000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4700003">func</span>&nbsp;<span class="op" id="4700008">(</span><span class="ident" id="4700009">e</span>&nbsp;<span class="ident" id="4700011">UnknownAuthorityError</span><span class="op" id="4700032">)</span>&nbsp;<span class="ident" id="4700034">Error</span><span class="op" id="4700039">(</span><span class="op" id="4700040">)</span>&nbsp;<span class="builtintype" id="4700042">string</span>&nbsp;<span class="op" id="4700049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700052">s</span>&nbsp;<span class="op" id="4700054">:=</span>&nbsp;<span class="string" id="4700057">&#34;x509:&nbsp;certificate&nbsp;signed&nbsp;by&nbsp;unknown&nbsp;authority&#34;</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700106">if</span>&nbsp;<span class="ident" id="4700109">e</span><span class="op" id="4700110">.</span><span class="ident" id="4700111">hintErr</span>&nbsp;<span class="op" id="4700119">!=</span>&nbsp;<span class="ident" id="4700122">nil</span>&nbsp;<span class="op" id="4700126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700130">certName</span>&nbsp;<span class="op" id="4700139">:=</span>&nbsp;<span class="ident" id="4700142">e</span><span class="op" id="4700143">.</span><span class="ident" id="4700144">hintCert</span><span class="op" id="4700152">.</span><span class="ident" id="4700153">Subject</span><span class="op" id="4700160">.</span><span class="ident" id="4700161">CommonName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700174">if</span>&nbsp;<span class="builtinfunc" id="4700177">len</span><span class="op" id="4700180">(</span><span class="ident" id="4700181">certName</span><span class="op" id="4700189">)</span>&nbsp;<span class="op" id="4700191">==</span>&nbsp;<span class="num" id="4700194">0</span>&nbsp;<span class="op" id="4700196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700201">if</span>&nbsp;<span class="builtinfunc" id="4700204">len</span><span class="op" id="4700207">(</span><span class="ident" id="4700208">e</span><span class="op" id="4700209">.</span><span class="ident" id="4700210">hintCert</span><span class="op" id="4700218">.</span><span class="ident" id="4700219">Subject</span><span class="op" id="4700226">.</span><span class="ident" id="4700227">Organization</span><span class="op" id="4700239">)</span>&nbsp;<span class="op" id="4700241">&gt;</span>&nbsp;<span class="num" id="4700243">0</span>&nbsp;<span class="op" id="4700245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700251">certName</span>&nbsp;<span class="op" id="4700260">=</span>&nbsp;<span class="ident" id="4700262">e</span><span class="op" id="4700263">.</span><span class="ident" id="4700264">hintCert</span><span class="op" id="4700272">.</span><span class="ident" id="4700273">Subject</span><span class="op" id="4700280">.</span><span class="ident" id="4700281">Organization</span><span class="op" id="4700293">[</span><span class="num" id="4700294">0</span><span class="op" id="4700295">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4700300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700305">certName</span>&nbsp;<span class="op" id="4700314">=</span>&nbsp;<span class="string" id="4700316">&#34;serial:&#34;</span>&nbsp;<span class="op" id="4700326">+</span>&nbsp;<span class="ident" id="4700328">e</span><span class="op" id="4700329">.</span><span class="ident" id="4700330">hintCert</span><span class="op" id="4700338">.</span><span class="ident" id="4700339">SerialNumber</span><span class="op" id="4700351">.</span><span class="ident" id="4700352">String</span><span class="op" id="4700358">(</span><span class="op" id="4700359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4700363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700367">s</span>&nbsp;<span class="op" id="4700369">+=</span>&nbsp;<span class="ident" id="4700372">fmt</span><span class="op" id="4700375">.</span><span class="ident" id="4700376">Sprintf</span><span class="op" id="4700383">(</span><span class="string" id="4700384">&#34;&nbsp;(possibly&nbsp;because&nbsp;of&nbsp;%q&nbsp;while&nbsp;trying&nbsp;to&nbsp;verify&nbsp;candidate&nbsp;authority&nbsp;certificate&nbsp;%q)&#34;</span><span class="op" id="4700469">,</span>&nbsp;<span class="ident" id="4700471">e</span><span class="op" id="4700472">.</span><span class="ident" id="4700473">hintErr</span><span class="op" id="4700480">,</span>&nbsp;<span class="ident" id="4700482">certName</span><span class="op" id="4700490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4700493">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700496">return</span>&nbsp;<span class="ident" id="4700503">s</span><br>
<span class="lineno"></span><span class="op" id="4700505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4700508">//&nbsp;SystemRootsError&nbsp;results&nbsp;when&nbsp;we&nbsp;fail&nbsp;to&nbsp;load&nbsp;the&nbsp;system&nbsp;root&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="4700587">type</span>&nbsp;<span class="ident" id="4700592">SystemRootsError</span>&nbsp;<span class="keyword" id="4700609">struct</span><span class="op" id="4700615">{</span><span class="op" id="4700616">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="4700619">func</span>&nbsp;<span class="op" id="4700624">(</span><span class="ident" id="4700625">SystemRootsError</span><span class="op" id="4700641">)</span>&nbsp;<span class="ident" id="4700643">Error</span><span class="op" id="4700648">(</span><span class="op" id="4700649">)</span>&nbsp;<span class="builtintype" id="4700651">string</span>&nbsp;<span class="op" id="4700658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700661">return</span>&nbsp;<span class="string" id="4700668">&#34;x509:&nbsp;failed&nbsp;to&nbsp;load&nbsp;system&nbsp;roots&nbsp;and&nbsp;no&nbsp;roots&nbsp;provided&#34;</span><br>
<span class="lineno"></span><span class="op" id="4700726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="4700729">//&nbsp;VerifyOptions&nbsp;contains&nbsp;parameters&nbsp;for&nbsp;Certificate.Verify.&nbsp;It&#39;s&nbsp;a&nbsp;structure</span><br>
<span class="lineno"></span><span class="comment" id="4700807">//&nbsp;because&nbsp;other&nbsp;PKIX&nbsp;verification&nbsp;APIs&nbsp;have&nbsp;ended&nbsp;up&nbsp;needing&nbsp;many&nbsp;options.</span><br>
<span class="lineno"></span><span class="keyword" id="4700883">type</span>&nbsp;<span class="ident" id="4700888">VerifyOptions</span>&nbsp;<span class="keyword" id="4700902">struct</span>&nbsp;<span class="op" id="4700909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700912">DNSName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4700926">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700934">Intermediates</span>&nbsp;<span class="op" id="4700948">*</span><span class="ident" id="4700949">CertPool</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700959">Roots</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4700973">*</span><span class="ident" id="4700974">CertPool</span>&nbsp;<span class="comment" id="4700983">//&nbsp;if&nbsp;nil,&nbsp;the&nbsp;system&nbsp;roots&nbsp;are&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701021">CurrentTime</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4701035">time</span><span class="op" id="4701039">.</span><span class="ident" id="4701040">Time</span>&nbsp;<span class="comment" id="4701045">//&nbsp;if&nbsp;zero,&nbsp;the&nbsp;current&nbsp;time&nbsp;is&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4701083">//&nbsp;KeyUsage&nbsp;specifies&nbsp;which&nbsp;Extended&nbsp;Key&nbsp;Usage&nbsp;values&nbsp;are&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4701154">//&nbsp;An&nbsp;empty&nbsp;list&nbsp;means&nbsp;ExtKeyUsageServerAuth.&nbsp;Key&nbsp;usage&nbsp;is&nbsp;considered&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4701227">//&nbsp;constraint&nbsp;down&nbsp;the&nbsp;chain&nbsp;which&nbsp;mirrors&nbsp;Windows&nbsp;CryptoAPI&nbsp;behaviour,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4701300">//&nbsp;but&nbsp;not&nbsp;the&nbsp;spec.&nbsp;To&nbsp;accept&nbsp;any&nbsp;key&nbsp;usage,&nbsp;include&nbsp;ExtKeyUsageAny.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701371">KeyUsages</span>&nbsp;<span class="op" id="4701381">[</span><span class="op" id="4701382">]</span><span class="ident" id="4701383">ExtKeyUsage</span><br>
<span class="lineno"></span><span class="op" id="4701395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4701398">const</span>&nbsp;<span class="op" id="4701404">(</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701407">leafCertificate</span>&nbsp;<span class="op" id="4701423">=</span>&nbsp;<span class="ident" id="4701425">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701431">intermediateCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701456">rootCertificate</span><br>
<span class="lineno"></span><span class="op" id="4701472">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="4701475">//&nbsp;isValid&nbsp;performs&nbsp;validity&nbsp;checks&nbsp;on&nbsp;the&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="4701521">func</span>&nbsp;<span class="op" id="4701526">(</span><span class="ident" id="4701527">c</span>&nbsp;<span class="op" id="4701529">*</span><span class="ident" id="4701530">Certificate</span><span class="op" id="4701541">)</span>&nbsp;<span class="ident" id="4701543">isValid</span><span class="op" id="4701550">(</span><span class="ident" id="4701551">certType</span>&nbsp;<span class="builtintype" id="4701560">int</span><span class="op" id="4701563">,</span>&nbsp;<span class="ident" id="4701565">currentChain</span>&nbsp;<span class="op" id="4701578">[</span><span class="op" id="4701579">]</span><span class="op" id="4701580">*</span><span class="ident" id="4701581">Certificate</span><span class="op" id="4701592">,</span>&nbsp;<span class="ident" id="4701594">opts</span>&nbsp;<span class="op" id="4701599">*</span><span class="ident" id="4701600">VerifyOptions</span><span class="op" id="4701613">)</span>&nbsp;<span class="builtintype" id="4701615">error</span>&nbsp;<span class="op" id="4701621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701624">now</span>&nbsp;<span class="op" id="4701628">:=</span>&nbsp;<span class="ident" id="4701631">opts</span><span class="op" id="4701635">.</span><span class="ident" id="4701636">CurrentTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701649">if</span>&nbsp;<span class="ident" id="4701652">now</span><span class="op" id="4701655">.</span><span class="ident" id="4701656">IsZero</span><span class="op" id="4701662">(</span><span class="op" id="4701663">)</span>&nbsp;<span class="op" id="4701665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701669">now</span>&nbsp;<span class="op" id="4701673">=</span>&nbsp;<span class="ident" id="4701675">time</span><span class="op" id="4701679">.</span><span class="ident" id="4701680">Now</span><span class="op" id="4701683">(</span><span class="op" id="4701684">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701690">if</span>&nbsp;<span class="ident" id="4701693">now</span><span class="op" id="4701696">.</span><span class="ident" id="4701697">Before</span><span class="op" id="4701703">(</span><span class="ident" id="4701704">c</span><span class="op" id="4701705">.</span><span class="ident" id="4701706">NotBefore</span><span class="op" id="4701715">)</span>&nbsp;<span class="op" id="4701717">||</span>&nbsp;<span class="ident" id="4701720">now</span><span class="op" id="4701723">.</span><span class="ident" id="4701724">After</span><span class="op" id="4701729">(</span><span class="ident" id="4701730">c</span><span class="op" id="4701731">.</span><span class="ident" id="4701732">NotAfter</span><span class="op" id="4701740">)</span>&nbsp;<span class="op" id="4701742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701746">return</span>&nbsp;<span class="ident" id="4701753">CertificateInvalidError</span><span class="op" id="4701776">{</span><span class="ident" id="4701777">c</span><span class="op" id="4701778">,</span>&nbsp;<span class="ident" id="4701780">Expired</span><span class="op" id="4701787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701794">if</span>&nbsp;<span class="builtinfunc" id="4701797">len</span><span class="op" id="4701800">(</span><span class="ident" id="4701801">c</span><span class="op" id="4701802">.</span><span class="ident" id="4701803">PermittedDNSDomains</span><span class="op" id="4701822">)</span>&nbsp;<span class="op" id="4701824">&gt;</span>&nbsp;<span class="num" id="4701826">0</span>&nbsp;<span class="op" id="4701828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701832">ok</span>&nbsp;<span class="op" id="4701835">:=</span>&nbsp;<span class="builtintype" id="4701838">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701846">for</span>&nbsp;<span class="ident" id="4701850">_</span><span class="op" id="4701851">,</span>&nbsp;<span class="ident" id="4701853">domain</span>&nbsp;<span class="op" id="4701860">:=</span>&nbsp;<span class="keyword" id="4701863">range</span>&nbsp;<span class="ident" id="4701869">c</span><span class="op" id="4701870">.</span><span class="ident" id="4701871">PermittedDNSDomains</span>&nbsp;<span class="op" id="4701891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701896">if</span>&nbsp;<span class="ident" id="4701899">opts</span><span class="op" id="4701903">.</span><span class="ident" id="4701904">DNSName</span>&nbsp;<span class="op" id="4701912">==</span>&nbsp;<span class="ident" id="4701915">domain</span>&nbsp;<span class="op" id="4701922">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701929">(</span><span class="ident" id="4701930">strings</span><span class="op" id="4701937">.</span><span class="ident" id="4701938">HasSuffix</span><span class="op" id="4701947">(</span><span class="ident" id="4701948">opts</span><span class="op" id="4701952">.</span><span class="ident" id="4701953">DNSName</span><span class="op" id="4701960">,</span>&nbsp;<span class="ident" id="4701962">domain</span><span class="op" id="4701968">)</span>&nbsp;<span class="op" id="4701970">&amp;&amp;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4701978">len</span><span class="op" id="4701981">(</span><span class="ident" id="4701982">opts</span><span class="op" id="4701986">.</span><span class="ident" id="4701987">DNSName</span><span class="op" id="4701994">)</span>&nbsp;<span class="op" id="4701996">&gt;=</span>&nbsp;<span class="num" id="4701999">1</span><span class="op" id="4702000">+</span><span class="builtinfunc" id="4702001">len</span><span class="op" id="4702004">(</span><span class="ident" id="4702005">domain</span><span class="op" id="4702011">)</span>&nbsp;<span class="op" id="4702013">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702021">opts</span><span class="op" id="4702025">.</span><span class="ident" id="4702026">DNSName</span><span class="op" id="4702033">[</span><span class="builtinfunc" id="4702034">len</span><span class="op" id="4702037">(</span><span class="ident" id="4702038">opts</span><span class="op" id="4702042">.</span><span class="ident" id="4702043">DNSName</span><span class="op" id="4702050">)</span><span class="op" id="4702051">-</span><span class="builtinfunc" id="4702052">len</span><span class="op" id="4702055">(</span><span class="ident" id="4702056">domain</span><span class="op" id="4702062">)</span><span class="op" id="4702063">-</span><span class="num" id="4702064">1</span><span class="op" id="4702065">]</span>&nbsp;<span class="op" id="4702067">==</span>&nbsp;<span class="string" id="4702070">&#39;.&#39;</span><span class="op" id="4702073">)</span>&nbsp;<span class="op" id="4702075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702081">ok</span>&nbsp;<span class="op" id="4702084">=</span>&nbsp;<span class="builtintype" id="4702086">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702095">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702104">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702113">if</span>&nbsp;<span class="op" id="4702116">!</span><span class="ident" id="4702117">ok</span>&nbsp;<span class="op" id="4702120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702125">return</span>&nbsp;<span class="ident" id="4702132">CertificateInvalidError</span><span class="op" id="4702155">{</span><span class="ident" id="4702156">c</span><span class="op" id="4702157">,</span>&nbsp;<span class="ident" id="4702159">CANotAuthorizedForThisName</span><span class="op" id="4702185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702189">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702196">//&nbsp;KeyUsage&nbsp;status&nbsp;flags&nbsp;are&nbsp;ignored.&nbsp;From&nbsp;Engineering&nbsp;Security,&nbsp;Peter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702268">//&nbsp;Gutmann:&nbsp;A&nbsp;European&nbsp;government&nbsp;CA&nbsp;marked&nbsp;its&nbsp;signing&nbsp;certificates&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702341">//&nbsp;being&nbsp;valid&nbsp;for&nbsp;encryption&nbsp;only,&nbsp;but&nbsp;no-one&nbsp;noticed.&nbsp;Another</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702406">//&nbsp;European&nbsp;CA&nbsp;marked&nbsp;its&nbsp;signature&nbsp;keys&nbsp;as&nbsp;not&nbsp;being&nbsp;valid&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702471">//&nbsp;signatures.&nbsp;A&nbsp;different&nbsp;CA&nbsp;marked&nbsp;its&nbsp;own&nbsp;trusted&nbsp;root&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702542">//&nbsp;as&nbsp;being&nbsp;invalid&nbsp;for&nbsp;certificate&nbsp;signing.&nbsp;&nbsp;Another&nbsp;national&nbsp;CA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702609">//&nbsp;distributed&nbsp;a&nbsp;certificate&nbsp;to&nbsp;be&nbsp;used&nbsp;to&nbsp;encrypt&nbsp;data&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702674">//&nbsp;country’s&nbsp;tax&nbsp;authority&nbsp;that&nbsp;was&nbsp;marked&nbsp;as&nbsp;only&nbsp;being&nbsp;usable&nbsp;for</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702745">//&nbsp;digital&nbsp;signatures&nbsp;but&nbsp;not&nbsp;for&nbsp;encryption.&nbsp;Yet&nbsp;another&nbsp;CA&nbsp;reversed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702816">//&nbsp;the&nbsp;order&nbsp;of&nbsp;the&nbsp;bit&nbsp;flags&nbsp;in&nbsp;the&nbsp;keyUsage&nbsp;due&nbsp;to&nbsp;confusion&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702885">//&nbsp;encoding&nbsp;endianness,&nbsp;essentially&nbsp;setting&nbsp;a&nbsp;random&nbsp;keyUsage&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702951">//&nbsp;certificates&nbsp;that&nbsp;it&nbsp;issued.&nbsp;Another&nbsp;CA&nbsp;created&nbsp;a&nbsp;self-invalidating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703023">//&nbsp;certificate&nbsp;by&nbsp;adding&nbsp;a&nbsp;certificate&nbsp;policy&nbsp;statement&nbsp;stipulating</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703092">//&nbsp;that&nbsp;the&nbsp;certificate&nbsp;had&nbsp;to&nbsp;be&nbsp;used&nbsp;strictly&nbsp;as&nbsp;specified&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703161">//&nbsp;keyUsage,&nbsp;and&nbsp;a&nbsp;keyUsage&nbsp;containing&nbsp;a&nbsp;flag&nbsp;indicating&nbsp;that&nbsp;the&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703232">//&nbsp;encryption&nbsp;key&nbsp;could&nbsp;only&nbsp;be&nbsp;used&nbsp;for&nbsp;Diffie-Hellman&nbsp;key&nbsp;agreement.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703305">if</span>&nbsp;<span class="ident" id="4703308">certType</span>&nbsp;<span class="op" id="4703317">==</span>&nbsp;<span class="ident" id="4703320">intermediateCertificate</span>&nbsp;<span class="op" id="4703344">&amp;&amp;</span>&nbsp;<span class="op" id="4703347">(</span><span class="op" id="4703348">!</span><span class="ident" id="4703349">c</span><span class="op" id="4703350">.</span><span class="ident" id="4703351">BasicConstraintsValid</span>&nbsp;<span class="op" id="4703373">||</span>&nbsp;<span class="op" id="4703376">!</span><span class="ident" id="4703377">c</span><span class="op" id="4703378">.</span><span class="ident" id="4703379">IsCA</span><span class="op" id="4703383">)</span>&nbsp;<span class="op" id="4703385">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703389">return</span>&nbsp;<span class="ident" id="4703396">CertificateInvalidError</span><span class="op" id="4703419">{</span><span class="ident" id="4703420">c</span><span class="op" id="4703421">,</span>&nbsp;<span class="ident" id="4703423">NotAuthorizedToSign</span><span class="op" id="4703442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703449">if</span>&nbsp;<span class="ident" id="4703452">c</span><span class="op" id="4703453">.</span><span class="ident" id="4703454">BasicConstraintsValid</span>&nbsp;<span class="op" id="4703476">&amp;&amp;</span>&nbsp;<span class="ident" id="4703479">c</span><span class="op" id="4703480">.</span><span class="ident" id="4703481">MaxPathLen</span>&nbsp;<span class="op" id="4703492">&gt;=</span>&nbsp;<span class="num" id="4703495">0</span>&nbsp;<span class="op" id="4703497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703501">numIntermediates</span>&nbsp;<span class="op" id="4703518">:=</span>&nbsp;<span class="builtinfunc" id="4703521">len</span><span class="op" id="4703524">(</span><span class="ident" id="4703525">currentChain</span><span class="op" id="4703537">)</span>&nbsp;<span class="op" id="4703539">-</span>&nbsp;<span class="num" id="4703541">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703545">if</span>&nbsp;<span class="ident" id="4703548">numIntermediates</span>&nbsp;<span class="op" id="4703565">&gt;</span>&nbsp;<span class="ident" id="4703567">c</span><span class="op" id="4703568">.</span><span class="ident" id="4703569">MaxPathLen</span>&nbsp;<span class="op" id="4703580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703585">return</span>&nbsp;<span class="ident" id="4703592">CertificateInvalidError</span><span class="op" id="4703615">{</span><span class="ident" id="4703616">c</span><span class="op" id="4703617">,</span>&nbsp;<span class="ident" id="4703619">TooManyIntermediates</span><span class="op" id="4703639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703650">return</span>&nbsp;<span class="ident" id="4703657">nil</span><br>
<span class="lineno"></span><span class="op" id="4703661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4703664">//&nbsp;Verify&nbsp;attempts&nbsp;to&nbsp;verify&nbsp;c&nbsp;by&nbsp;building&nbsp;one&nbsp;or&nbsp;more&nbsp;chains&nbsp;from&nbsp;c&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4703738">//&nbsp;certificate&nbsp;in&nbsp;opts.Roots,&nbsp;using&nbsp;certificates&nbsp;in&nbsp;opts.Intermediates&nbsp;if</span><br>
<span class="lineno">205</span><span class="comment" id="4703812">//&nbsp;needed.&nbsp;If&nbsp;successful,&nbsp;it&nbsp;returns&nbsp;one&nbsp;or&nbsp;more&nbsp;chains&nbsp;where&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="4703884">//&nbsp;element&nbsp;of&nbsp;the&nbsp;chain&nbsp;is&nbsp;c&nbsp;and&nbsp;the&nbsp;last&nbsp;element&nbsp;is&nbsp;from&nbsp;opts.Roots.</span><br>
<span class="lineno"></span><span class="comment" id="4703954">//</span><br>
<span class="lineno"></span><span class="comment" id="4703957">//&nbsp;If&nbsp;opts.Roots&nbsp;is&nbsp;nil&nbsp;and&nbsp;system&nbsp;roots&nbsp;are&nbsp;unavailable&nbsp;the&nbsp;returned&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4704033">//&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;SystemRootsError.</span><br>
<span class="lineno">210</span><span class="comment" id="4704070">//</span><br>
<span class="lineno"></span><span class="comment" id="4704073">//&nbsp;WARNING:&nbsp;this&nbsp;doesn&#39;t&nbsp;do&nbsp;any&nbsp;revocation&nbsp;checking.</span><br>
<span class="lineno"></span><span class="keyword" id="4704126">func</span>&nbsp;<span class="op" id="4704131">(</span><span class="ident" id="4704132">c</span>&nbsp;<span class="op" id="4704134">*</span><span class="ident" id="4704135">Certificate</span><span class="op" id="4704146">)</span>&nbsp;<span class="ident" id="4704148">Verify</span><span class="op" id="4704154">(</span><span class="ident" id="4704155">opts</span>&nbsp;<span class="ident" id="4704160">VerifyOptions</span><span class="op" id="4704173">)</span>&nbsp;<span class="op" id="4704175">(</span><span class="ident" id="4704176">chains</span>&nbsp;<span class="op" id="4704183">[</span><span class="op" id="4704184">]</span><span class="op" id="4704185">[</span><span class="op" id="4704186">]</span><span class="op" id="4704187">*</span><span class="ident" id="4704188">Certificate</span><span class="op" id="4704199">,</span>&nbsp;<span class="ident" id="4704201">err</span>&nbsp;<span class="builtintype" id="4704205">error</span><span class="op" id="4704210">)</span>&nbsp;<span class="op" id="4704212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4704215">//&nbsp;Use&nbsp;Windows&#39;s&nbsp;own&nbsp;verification&nbsp;and&nbsp;chain&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704270">if</span>&nbsp;<span class="ident" id="4704273">opts</span><span class="op" id="4704277">.</span><span class="ident" id="4704278">Roots</span>&nbsp;<span class="op" id="4704284">==</span>&nbsp;<span class="ident" id="4704287">nil</span>&nbsp;<span class="op" id="4704291">&amp;&amp;</span>&nbsp;<span class="ident" id="4704294">runtime</span><span class="op" id="4704301">.</span><span class="ident" id="4704302">GOOS</span>&nbsp;<span class="op" id="4704307">==</span>&nbsp;<span class="string" id="4704310">&#34;windows&#34;</span>&nbsp;<span class="op" id="4704320">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704324">return</span>&nbsp;<span class="ident" id="4704331">c</span><span class="op" id="4704332">.</span><span class="ident" id="4704333">systemVerify</span><span class="op" id="4704345">(</span><span class="op" id="4704346">&amp;</span><span class="ident" id="4704347">opts</span><span class="op" id="4704351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704358">if</span>&nbsp;<span class="ident" id="4704361">opts</span><span class="op" id="4704365">.</span><span class="ident" id="4704366">Roots</span>&nbsp;<span class="op" id="4704372">==</span>&nbsp;<span class="ident" id="4704375">nil</span>&nbsp;<span class="op" id="4704379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704383">opts</span><span class="op" id="4704387">.</span><span class="ident" id="4704388">Roots</span>&nbsp;<span class="op" id="4704394">=</span>&nbsp;<span class="ident" id="4704396">systemRootsPool</span><span class="op" id="4704411">(</span><span class="op" id="4704412">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704416">if</span>&nbsp;<span class="ident" id="4704419">opts</span><span class="op" id="4704423">.</span><span class="ident" id="4704424">Roots</span>&nbsp;<span class="op" id="4704430">==</span>&nbsp;<span class="ident" id="4704433">nil</span>&nbsp;<span class="op" id="4704437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704442">return</span>&nbsp;<span class="ident" id="4704449">nil</span><span class="op" id="4704452">,</span>&nbsp;<span class="ident" id="4704454">SystemRootsError</span><span class="op" id="4704470">{</span><span class="op" id="4704471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704482">err</span>&nbsp;<span class="op" id="4704486">=</span>&nbsp;<span class="ident" id="4704488">c</span><span class="op" id="4704489">.</span><span class="ident" id="4704490">isValid</span><span class="op" id="4704497">(</span><span class="ident" id="4704498">leafCertificate</span><span class="op" id="4704513">,</span>&nbsp;<span class="ident" id="4704515">nil</span><span class="op" id="4704518">,</span>&nbsp;<span class="op" id="4704520">&amp;</span><span class="ident" id="4704521">opts</span><span class="op" id="4704525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704528">if</span>&nbsp;<span class="ident" id="4704531">err</span>&nbsp;<span class="op" id="4704535">!=</span>&nbsp;<span class="ident" id="4704538">nil</span>&nbsp;<span class="op" id="4704542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704546">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704558">if</span>&nbsp;<span class="builtinfunc" id="4704561">len</span><span class="op" id="4704564">(</span><span class="ident" id="4704565">opts</span><span class="op" id="4704569">.</span><span class="ident" id="4704570">DNSName</span><span class="op" id="4704577">)</span>&nbsp;<span class="op" id="4704579">&gt;</span>&nbsp;<span class="num" id="4704581">0</span>&nbsp;<span class="op" id="4704583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704587">err</span>&nbsp;<span class="op" id="4704591">=</span>&nbsp;<span class="ident" id="4704593">c</span><span class="op" id="4704594">.</span><span class="ident" id="4704595">VerifyHostname</span><span class="op" id="4704609">(</span><span class="ident" id="4704610">opts</span><span class="op" id="4704614">.</span><span class="ident" id="4704615">DNSName</span><span class="op" id="4704622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704626">if</span>&nbsp;<span class="ident" id="4704629">err</span>&nbsp;<span class="op" id="4704633">!=</span>&nbsp;<span class="ident" id="4704636">nil</span>&nbsp;<span class="op" id="4704640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704645">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704654">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704661">candidateChains</span><span class="op" id="4704676">,</span>&nbsp;<span class="ident" id="4704678">err</span>&nbsp;<span class="op" id="4704682">:=</span>&nbsp;<span class="ident" id="4704685">c</span><span class="op" id="4704686">.</span><span class="ident" id="4704687">buildChains</span><span class="op" id="4704698">(</span><span class="builtinfunc" id="4704699">make</span><span class="op" id="4704703">(</span><span class="keyword" id="4704704">map</span><span class="op" id="4704707">[</span><span class="builtintype" id="4704708">int</span><span class="op" id="4704711">]</span><span class="op" id="4704712">[</span><span class="op" id="4704713">]</span><span class="op" id="4704714">[</span><span class="op" id="4704715">]</span><span class="op" id="4704716">*</span><span class="ident" id="4704717">Certificate</span><span class="op" id="4704728">)</span><span class="op" id="4704729">,</span>&nbsp;<span class="op" id="4704731">[</span><span class="op" id="4704732">]</span><span class="op" id="4704733">*</span><span class="ident" id="4704734">Certificate</span><span class="op" id="4704745">{</span><span class="ident" id="4704746">c</span><span class="op" id="4704747">}</span><span class="op" id="4704748">,</span>&nbsp;<span class="op" id="4704750">&amp;</span><span class="ident" id="4704751">opts</span><span class="op" id="4704755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704758">if</span>&nbsp;<span class="ident" id="4704761">err</span>&nbsp;<span class="op" id="4704765">!=</span>&nbsp;<span class="ident" id="4704768">nil</span>&nbsp;<span class="op" id="4704772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704776">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704788">keyUsages</span>&nbsp;<span class="op" id="4704798">:=</span>&nbsp;<span class="ident" id="4704801">opts</span><span class="op" id="4704805">.</span><span class="ident" id="4704806">KeyUsages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704817">if</span>&nbsp;<span class="builtinfunc" id="4704820">len</span><span class="op" id="4704823">(</span><span class="ident" id="4704824">keyUsages</span><span class="op" id="4704833">)</span>&nbsp;<span class="op" id="4704835">==</span>&nbsp;<span class="num" id="4704838">0</span>&nbsp;<span class="op" id="4704840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704844">keyUsages</span>&nbsp;<span class="op" id="4704854">=</span>&nbsp;<span class="op" id="4704856">[</span><span class="op" id="4704857">]</span><span class="ident" id="4704858">ExtKeyUsage</span><span class="op" id="4704869">{</span><span class="ident" id="4704870">ExtKeyUsageServerAuth</span><span class="op" id="4704891">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4704898">//&nbsp;If&nbsp;any&nbsp;key&nbsp;usage&nbsp;is&nbsp;acceptable&nbsp;then&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704950">for</span>&nbsp;<span class="ident" id="4704954">_</span><span class="op" id="4704955">,</span>&nbsp;<span class="ident" id="4704957">usage</span>&nbsp;<span class="op" id="4704963">:=</span>&nbsp;<span class="keyword" id="4704966">range</span>&nbsp;<span class="ident" id="4704972">keyUsages</span>&nbsp;<span class="op" id="4704982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704986">if</span>&nbsp;<span class="ident" id="4704989">usage</span>&nbsp;<span class="op" id="4704995">==</span>&nbsp;<span class="ident" id="4704998">ExtKeyUsageAny</span>&nbsp;<span class="op" id="4705013">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705018">chains</span>&nbsp;<span class="op" id="4705025">=</span>&nbsp;<span class="ident" id="4705027">candidateChains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705046">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705062">for</span>&nbsp;<span class="ident" id="4705066">_</span><span class="op" id="4705067">,</span>&nbsp;<span class="ident" id="4705069">candidate</span>&nbsp;<span class="op" id="4705079">:=</span>&nbsp;<span class="keyword" id="4705082">range</span>&nbsp;<span class="ident" id="4705088">candidateChains</span>&nbsp;<span class="op" id="4705104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705108">if</span>&nbsp;<span class="ident" id="4705111">checkChainForKeyUsage</span><span class="op" id="4705132">(</span><span class="ident" id="4705133">candidate</span><span class="op" id="4705142">,</span>&nbsp;<span class="ident" id="4705144">keyUsages</span><span class="op" id="4705153">)</span>&nbsp;<span class="op" id="4705155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705160">chains</span>&nbsp;<span class="op" id="4705167">=</span>&nbsp;<span class="builtinfunc" id="4705169">append</span><span class="op" id="4705175">(</span><span class="ident" id="4705176">chains</span><span class="op" id="4705182">,</span>&nbsp;<span class="ident" id="4705184">candidate</span><span class="op" id="4705193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705200">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705204">if</span>&nbsp;<span class="builtinfunc" id="4705207">len</span><span class="op" id="4705210">(</span><span class="ident" id="4705211">chains</span><span class="op" id="4705217">)</span>&nbsp;<span class="op" id="4705219">==</span>&nbsp;<span class="num" id="4705222">0</span>&nbsp;<span class="op" id="4705224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705228">err</span>&nbsp;<span class="op" id="4705232">=</span>&nbsp;<span class="ident" id="4705234">CertificateInvalidError</span><span class="op" id="4705257">{</span><span class="ident" id="4705258">c</span><span class="op" id="4705259">,</span>&nbsp;<span class="ident" id="4705261">IncompatibleUsage</span><span class="op" id="4705278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705285">return</span><br>
<span class="lineno"></span><span class="op" id="4705292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4705295">func</span>&nbsp;<span class="ident" id="4705300">appendToFreshChain</span><span class="op" id="4705318">(</span><span class="ident" id="4705319">chain</span>&nbsp;<span class="op" id="4705325">[</span><span class="op" id="4705326">]</span><span class="op" id="4705327">*</span><span class="ident" id="4705328">Certificate</span><span class="op" id="4705339">,</span>&nbsp;<span class="ident" id="4705341">cert</span>&nbsp;<span class="op" id="4705346">*</span><span class="ident" id="4705347">Certificate</span><span class="op" id="4705358">)</span>&nbsp;<span class="op" id="4705360">[</span><span class="op" id="4705361">]</span><span class="op" id="4705362">*</span><span class="ident" id="4705363">Certificate</span>&nbsp;<span class="op" id="4705375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705378">n</span>&nbsp;<span class="op" id="4705380">:=</span>&nbsp;<span class="builtinfunc" id="4705383">make</span><span class="op" id="4705387">(</span><span class="op" id="4705388">[</span><span class="op" id="4705389">]</span><span class="op" id="4705390">*</span><span class="ident" id="4705391">Certificate</span><span class="op" id="4705402">,</span>&nbsp;<span class="builtinfunc" id="4705404">len</span><span class="op" id="4705407">(</span><span class="ident" id="4705408">chain</span><span class="op" id="4705413">)</span><span class="op" id="4705414">+</span><span class="num" id="4705415">1</span><span class="op" id="4705416">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4705419">copy</span><span class="op" id="4705423">(</span><span class="ident" id="4705424">n</span><span class="op" id="4705425">,</span>&nbsp;<span class="ident" id="4705427">chain</span><span class="op" id="4705432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705435">n</span><span class="op" id="4705436">[</span><span class="builtinfunc" id="4705437">len</span><span class="op" id="4705440">(</span><span class="ident" id="4705441">chain</span><span class="op" id="4705446">)</span><span class="op" id="4705447">]</span>&nbsp;<span class="op" id="4705449">=</span>&nbsp;<span class="ident" id="4705451">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705457">return</span>&nbsp;<span class="ident" id="4705464">n</span><br>
<span class="lineno"></span><span class="op" id="4705466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="4705469">func</span>&nbsp;<span class="op" id="4705474">(</span><span class="ident" id="4705475">c</span>&nbsp;<span class="op" id="4705477">*</span><span class="ident" id="4705478">Certificate</span><span class="op" id="4705489">)</span>&nbsp;<span class="ident" id="4705491">buildChains</span><span class="op" id="4705502">(</span><span class="ident" id="4705503">cache</span>&nbsp;<span class="keyword" id="4705509">map</span><span class="op" id="4705512">[</span><span class="builtintype" id="4705513">int</span><span class="op" id="4705516">]</span><span class="op" id="4705517">[</span><span class="op" id="4705518">]</span><span class="op" id="4705519">[</span><span class="op" id="4705520">]</span><span class="op" id="4705521">*</span><span class="ident" id="4705522">Certificate</span><span class="op" id="4705533">,</span>&nbsp;<span class="ident" id="4705535">currentChain</span>&nbsp;<span class="op" id="4705548">[</span><span class="op" id="4705549">]</span><span class="op" id="4705550">*</span><span class="ident" id="4705551">Certificate</span><span class="op" id="4705562">,</span>&nbsp;<span class="ident" id="4705564">opts</span>&nbsp;<span class="op" id="4705569">*</span><span class="ident" id="4705570">VerifyOptions</span><span class="op" id="4705583">)</span>&nbsp;<span class="op" id="4705585">(</span><span class="ident" id="4705586">chains</span>&nbsp;<span class="op" id="4705593">[</span><span class="op" id="4705594">]</span><span class="op" id="4705595">[</span><span class="op" id="4705596">]</span><span class="op" id="4705597">*</span><span class="ident" id="4705598">Certificate</span><span class="op" id="4705609">,</span>&nbsp;<span class="ident" id="4705611">err</span>&nbsp;<span class="builtintype" id="4705615">error</span><span class="op" id="4705620">)</span>&nbsp;<span class="op" id="4705622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705625">possibleRoots</span><span class="op" id="4705638">,</span>&nbsp;<span class="ident" id="4705640">failedRoot</span><span class="op" id="4705650">,</span>&nbsp;<span class="ident" id="4705652">rootErr</span>&nbsp;<span class="op" id="4705660">:=</span>&nbsp;<span class="ident" id="4705663">opts</span><span class="op" id="4705667">.</span><span class="ident" id="4705668">Roots</span><span class="op" id="4705673">.</span><span class="ident" id="4705674">findVerifiedParents</span><span class="op" id="4705693">(</span><span class="ident" id="4705694">c</span><span class="op" id="4705695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705698">for</span>&nbsp;<span class="ident" id="4705702">_</span><span class="op" id="4705703">,</span>&nbsp;<span class="ident" id="4705705">rootNum</span>&nbsp;<span class="op" id="4705713">:=</span>&nbsp;<span class="keyword" id="4705716">range</span>&nbsp;<span class="ident" id="4705722">possibleRoots</span>&nbsp;<span class="op" id="4705736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705740">root</span>&nbsp;<span class="op" id="4705745">:=</span>&nbsp;<span class="ident" id="4705748">opts</span><span class="op" id="4705752">.</span><span class="ident" id="4705753">Roots</span><span class="op" id="4705758">.</span><span class="ident" id="4705759">certs</span><span class="op" id="4705764">[</span><span class="ident" id="4705765">rootNum</span><span class="op" id="4705772">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705776">err</span>&nbsp;<span class="op" id="4705780">=</span>&nbsp;<span class="ident" id="4705782">root</span><span class="op" id="4705786">.</span><span class="ident" id="4705787">isValid</span><span class="op" id="4705794">(</span><span class="ident" id="4705795">rootCertificate</span><span class="op" id="4705810">,</span>&nbsp;<span class="ident" id="4705812">currentChain</span><span class="op" id="4705824">,</span>&nbsp;<span class="ident" id="4705826">opts</span><span class="op" id="4705830">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705834">if</span>&nbsp;<span class="ident" id="4705837">err</span>&nbsp;<span class="op" id="4705841">!=</span>&nbsp;<span class="ident" id="4705844">nil</span>&nbsp;<span class="op" id="4705848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705853">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705868">chains</span>&nbsp;<span class="op" id="4705875">=</span>&nbsp;<span class="builtinfunc" id="4705877">append</span><span class="op" id="4705883">(</span><span class="ident" id="4705884">chains</span><span class="op" id="4705890">,</span>&nbsp;<span class="ident" id="4705892">appendToFreshChain</span><span class="op" id="4705910">(</span><span class="ident" id="4705911">currentChain</span><span class="op" id="4705923">,</span>&nbsp;<span class="ident" id="4705925">root</span><span class="op" id="4705929">)</span><span class="op" id="4705930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705933">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705937">possibleIntermediates</span><span class="op" id="4705958">,</span>&nbsp;<span class="ident" id="4705960">failedIntermediate</span><span class="op" id="4705978">,</span>&nbsp;<span class="ident" id="4705980">intermediateErr</span>&nbsp;<span class="op" id="4705996">:=</span>&nbsp;<span class="ident" id="4705999">opts</span><span class="op" id="4706003">.</span><span class="ident" id="4706004">Intermediates</span><span class="op" id="4706017">.</span><span class="ident" id="4706018">findVerifiedParents</span><span class="op" id="4706037">(</span><span class="ident" id="4706038">c</span><span class="op" id="4706039">)</span><br>
<span class="lineno"></span><span class="ident" id="4706041">nextIntermediate</span><span class="op" id="4706057">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706060">for</span>&nbsp;<span class="ident" id="4706064">_</span><span class="op" id="4706065">,</span>&nbsp;<span class="ident" id="4706067">intermediateNum</span>&nbsp;<span class="op" id="4706083">:=</span>&nbsp;<span class="keyword" id="4706086">range</span>&nbsp;<span class="ident" id="4706092">possibleIntermediates</span>&nbsp;<span class="op" id="4706114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706118">intermediate</span>&nbsp;<span class="op" id="4706131">:=</span>&nbsp;<span class="ident" id="4706134">opts</span><span class="op" id="4706138">.</span><span class="ident" id="4706139">Intermediates</span><span class="op" id="4706152">.</span><span class="ident" id="4706153">certs</span><span class="op" id="4706158">[</span><span class="ident" id="4706159">intermediateNum</span><span class="op" id="4706174">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706178">for</span>&nbsp;<span class="ident" id="4706182">_</span><span class="op" id="4706183">,</span>&nbsp;<span class="ident" id="4706185">cert</span>&nbsp;<span class="op" id="4706190">:=</span>&nbsp;<span class="keyword" id="4706193">range</span>&nbsp;<span class="ident" id="4706199">currentChain</span>&nbsp;<span class="op" id="4706212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706217">if</span>&nbsp;<span class="ident" id="4706220">cert</span>&nbsp;<span class="op" id="4706225">==</span>&nbsp;<span class="ident" id="4706228">intermediate</span>&nbsp;<span class="op" id="4706241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706247">continue</span>&nbsp;<span class="ident" id="4706256">nextIntermediate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706280">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706284">err</span>&nbsp;<span class="op" id="4706288">=</span>&nbsp;<span class="ident" id="4706290">intermediate</span><span class="op" id="4706302">.</span><span class="ident" id="4706303">isValid</span><span class="op" id="4706310">(</span><span class="ident" id="4706311">intermediateCertificate</span><span class="op" id="4706334">,</span>&nbsp;<span class="ident" id="4706336">currentChain</span><span class="op" id="4706348">,</span>&nbsp;<span class="ident" id="4706350">opts</span><span class="op" id="4706354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706358">if</span>&nbsp;<span class="ident" id="4706361">err</span>&nbsp;<span class="op" id="4706365">!=</span>&nbsp;<span class="ident" id="4706368">nil</span>&nbsp;<span class="op" id="4706372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706377">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706392">var</span>&nbsp;<span class="ident" id="4706396">childChains</span>&nbsp;<span class="op" id="4706408">[</span><span class="op" id="4706409">]</span><span class="op" id="4706410">[</span><span class="op" id="4706411">]</span><span class="op" id="4706412">*</span><span class="ident" id="4706413">Certificate</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706427">childChains</span><span class="op" id="4706438">,</span>&nbsp;<span class="ident" id="4706440">ok</span>&nbsp;<span class="op" id="4706443">:=</span>&nbsp;<span class="ident" id="4706446">cache</span><span class="op" id="4706451">[</span><span class="ident" id="4706452">intermediateNum</span><span class="op" id="4706467">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706471">if</span>&nbsp;<span class="op" id="4706474">!</span><span class="ident" id="4706475">ok</span>&nbsp;<span class="op" id="4706478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706483">childChains</span><span class="op" id="4706494">,</span>&nbsp;<span class="ident" id="4706496">err</span>&nbsp;<span class="op" id="4706500">=</span>&nbsp;<span class="ident" id="4706502">intermediate</span><span class="op" id="4706514">.</span><span class="ident" id="4706515">buildChains</span><span class="op" id="4706526">(</span><span class="ident" id="4706527">cache</span><span class="op" id="4706532">,</span>&nbsp;<span class="ident" id="4706534">appendToFreshChain</span><span class="op" id="4706552">(</span><span class="ident" id="4706553">currentChain</span><span class="op" id="4706565">,</span>&nbsp;<span class="ident" id="4706567">intermediate</span><span class="op" id="4706579">)</span><span class="op" id="4706580">,</span>&nbsp;<span class="ident" id="4706582">opts</span><span class="op" id="4706586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706591">cache</span><span class="op" id="4706596">[</span><span class="ident" id="4706597">intermediateNum</span><span class="op" id="4706612">]</span>&nbsp;<span class="op" id="4706614">=</span>&nbsp;<span class="ident" id="4706616">childChains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706630">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706634">chains</span>&nbsp;<span class="op" id="4706641">=</span>&nbsp;<span class="builtinfunc" id="4706643">append</span><span class="op" id="4706649">(</span><span class="ident" id="4706650">chains</span><span class="op" id="4706656">,</span>&nbsp;<span class="ident" id="4706658">childChains</span><span class="op" id="4706669">...</span><span class="op" id="4706672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706679">if</span>&nbsp;<span class="builtinfunc" id="4706682">len</span><span class="op" id="4706685">(</span><span class="ident" id="4706686">chains</span><span class="op" id="4706692">)</span>&nbsp;<span class="op" id="4706694">&gt;</span>&nbsp;<span class="num" id="4706696">0</span>&nbsp;<span class="op" id="4706698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706702">err</span>&nbsp;<span class="op" id="4706706">=</span>&nbsp;<span class="ident" id="4706708">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706717">if</span>&nbsp;<span class="builtinfunc" id="4706720">len</span><span class="op" id="4706723">(</span><span class="ident" id="4706724">chains</span><span class="op" id="4706730">)</span>&nbsp;<span class="op" id="4706732">==</span>&nbsp;<span class="num" id="4706735">0</span>&nbsp;<span class="op" id="4706737">&amp;&amp;</span>&nbsp;<span class="ident" id="4706740">err</span>&nbsp;<span class="op" id="4706744">==</span>&nbsp;<span class="ident" id="4706747">nil</span>&nbsp;<span class="op" id="4706751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706755">hintErr</span>&nbsp;<span class="op" id="4706763">:=</span>&nbsp;<span class="ident" id="4706766">rootErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706776">hintCert</span>&nbsp;<span class="op" id="4706785">:=</span>&nbsp;<span class="ident" id="4706788">failedRoot</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706801">if</span>&nbsp;<span class="ident" id="4706804">hintErr</span>&nbsp;<span class="op" id="4706812">==</span>&nbsp;<span class="ident" id="4706815">nil</span>&nbsp;<span class="op" id="4706819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706824">hintErr</span>&nbsp;<span class="op" id="4706832">=</span>&nbsp;<span class="ident" id="4706834">intermediateErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706853">hintCert</span>&nbsp;<span class="op" id="4706862">=</span>&nbsp;<span class="ident" id="4706864">failedIntermediate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706889">err</span>&nbsp;<span class="op" id="4706893">=</span>&nbsp;<span class="ident" id="4706895">UnknownAuthorityError</span><span class="op" id="4706916">{</span><span class="ident" id="4706917">c</span><span class="op" id="4706918">,</span>&nbsp;<span class="ident" id="4706920">hintErr</span><span class="op" id="4706927">,</span>&nbsp;<span class="ident" id="4706929">hintCert</span><span class="op" id="4706937">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706944">return</span><br>
<span class="lineno"></span><span class="op" id="4706951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="4706954">func</span>&nbsp;<span class="ident" id="4706959">matchHostnames</span><span class="op" id="4706973">(</span><span class="ident" id="4706974">pattern</span><span class="op" id="4706981">,</span>&nbsp;<span class="ident" id="4706983">host</span>&nbsp;<span class="builtintype" id="4706988">string</span><span class="op" id="4706994">)</span>&nbsp;<span class="builtintype" id="4706996">bool</span>&nbsp;<span class="op" id="4707001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707004">if</span>&nbsp;<span class="builtinfunc" id="4707007">len</span><span class="op" id="4707010">(</span><span class="ident" id="4707011">pattern</span><span class="op" id="4707018">)</span>&nbsp;<span class="op" id="4707020">==</span>&nbsp;<span class="num" id="4707023">0</span>&nbsp;<span class="op" id="4707025">||</span>&nbsp;<span class="builtinfunc" id="4707028">len</span><span class="op" id="4707031">(</span><span class="ident" id="4707032">host</span><span class="op" id="4707036">)</span>&nbsp;<span class="op" id="4707038">==</span>&nbsp;<span class="num" id="4707041">0</span>&nbsp;<span class="op" id="4707043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707047">return</span>&nbsp;<span class="builtintype" id="4707054">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707065">patternParts</span>&nbsp;<span class="op" id="4707078">:=</span>&nbsp;<span class="ident" id="4707081">strings</span><span class="op" id="4707088">.</span><span class="ident" id="4707089">Split</span><span class="op" id="4707094">(</span><span class="ident" id="4707095">pattern</span><span class="op" id="4707102">,</span>&nbsp;<span class="string" id="4707104">&#34;.&#34;</span><span class="op" id="4707107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707110">hostParts</span>&nbsp;<span class="op" id="4707120">:=</span>&nbsp;<span class="ident" id="4707123">strings</span><span class="op" id="4707130">.</span><span class="ident" id="4707131">Split</span><span class="op" id="4707136">(</span><span class="ident" id="4707137">host</span><span class="op" id="4707141">,</span>&nbsp;<span class="string" id="4707143">&#34;.&#34;</span><span class="op" id="4707146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707150">if</span>&nbsp;<span class="builtinfunc" id="4707153">len</span><span class="op" id="4707156">(</span><span class="ident" id="4707157">patternParts</span><span class="op" id="4707169">)</span>&nbsp;<span class="op" id="4707171">!=</span>&nbsp;<span class="builtinfunc" id="4707174">len</span><span class="op" id="4707177">(</span><span class="ident" id="4707178">hostParts</span><span class="op" id="4707187">)</span>&nbsp;<span class="op" id="4707189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707193">return</span>&nbsp;<span class="builtintype" id="4707200">false</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707211">for</span>&nbsp;<span class="ident" id="4707215">i</span><span class="op" id="4707216">,</span>&nbsp;<span class="ident" id="4707218">patternPart</span>&nbsp;<span class="op" id="4707230">:=</span>&nbsp;<span class="keyword" id="4707233">range</span>&nbsp;<span class="ident" id="4707239">patternParts</span>&nbsp;<span class="op" id="4707252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707256">if</span>&nbsp;<span class="ident" id="4707259">patternPart</span>&nbsp;<span class="op" id="4707271">==</span>&nbsp;<span class="string" id="4707274">&#34;*&#34;</span>&nbsp;<span class="op" id="4707278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707283">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707298">if</span>&nbsp;<span class="ident" id="4707301">patternPart</span>&nbsp;<span class="op" id="4707313">!=</span>&nbsp;<span class="ident" id="4707316">hostParts</span><span class="op" id="4707325">[</span><span class="ident" id="4707326">i</span><span class="op" id="4707327">]</span>&nbsp;<span class="op" id="4707329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707334">return</span>&nbsp;<span class="builtintype" id="4707341">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707352">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707356">return</span>&nbsp;<span class="builtintype" id="4707363">true</span><br>
<span class="lineno"></span><span class="op" id="4707368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4707371">//&nbsp;toLowerCaseASCII&nbsp;returns&nbsp;a&nbsp;lower-case&nbsp;version&nbsp;of&nbsp;in.&nbsp;See&nbsp;RFC&nbsp;6125&nbsp;6.4.1.&nbsp;We&nbsp;use</span><br>
<span class="lineno">350</span><span class="comment" id="4707454">//&nbsp;an&nbsp;explicitly&nbsp;ASCII&nbsp;function&nbsp;to&nbsp;avoid&nbsp;any&nbsp;sharp&nbsp;corners&nbsp;resulting&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4707528">//&nbsp;performing&nbsp;Unicode&nbsp;operations&nbsp;on&nbsp;DNS&nbsp;labels.</span><br>
<span class="lineno"></span><span class="keyword" id="4707576">func</span>&nbsp;<span class="ident" id="4707581">toLowerCaseASCII</span><span class="op" id="4707597">(</span><span class="ident" id="4707598">in</span>&nbsp;<span class="builtintype" id="4707601">string</span><span class="op" id="4707607">)</span>&nbsp;<span class="builtintype" id="4707609">string</span>&nbsp;<span class="op" id="4707616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707619">//&nbsp;If&nbsp;the&nbsp;string&nbsp;is&nbsp;already&nbsp;lower-case&nbsp;then&nbsp;there&#39;s&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707687">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4707706">:=</span>&nbsp;<span class="builtintype" id="4707709">true</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707715">for</span>&nbsp;<span class="ident" id="4707719">_</span><span class="op" id="4707720">,</span>&nbsp;<span class="ident" id="4707722">c</span>&nbsp;<span class="op" id="4707724">:=</span>&nbsp;<span class="keyword" id="4707727">range</span>&nbsp;<span class="ident" id="4707733">in</span>&nbsp;<span class="op" id="4707736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707740">if</span>&nbsp;<span class="ident" id="4707743">c</span>&nbsp;<span class="op" id="4707745">==</span>&nbsp;<span class="ident" id="4707748">utf8</span><span class="op" id="4707752">.</span><span class="ident" id="4707753">RuneError</span>&nbsp;<span class="op" id="4707763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707768">//&nbsp;If&nbsp;we&nbsp;get&nbsp;a&nbsp;UTF-8&nbsp;error&nbsp;then&nbsp;there&nbsp;might&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707818">//&nbsp;upper-case&nbsp;ASCII&nbsp;bytes&nbsp;in&nbsp;the&nbsp;invalid&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707872">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4707891">=</span>&nbsp;<span class="builtintype" id="4707893">false</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707902">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707914">if</span>&nbsp;<span class="string" id="4707917">&#39;A&#39;</span>&nbsp;<span class="op" id="4707921">&lt;=</span>&nbsp;<span class="ident" id="4707924">c</span>&nbsp;<span class="op" id="4707926">&amp;&amp;</span>&nbsp;<span class="ident" id="4707929">c</span>&nbsp;<span class="op" id="4707931">&lt;=</span>&nbsp;<span class="string" id="4707934">&#39;Z&#39;</span>&nbsp;<span class="op" id="4707938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707943">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4707962">=</span>&nbsp;<span class="builtintype" id="4707964">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707973">break</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707988">if</span>&nbsp;<span class="ident" id="4707991">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4708010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708014">return</span>&nbsp;<span class="ident" id="4708021">in</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4708029">out</span>&nbsp;<span class="op" id="4708033">:=</span>&nbsp;<span class="op" id="4708036">[</span><span class="op" id="4708037">]</span><span class="builtintype" id="4708038">byte</span><span class="op" id="4708042">(</span><span class="ident" id="4708043">in</span><span class="op" id="4708045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708048">for</span>&nbsp;<span class="ident" id="4708052">i</span><span class="op" id="4708053">,</span>&nbsp;<span class="ident" id="4708055">c</span>&nbsp;<span class="op" id="4708057">:=</span>&nbsp;<span class="keyword" id="4708060">range</span>&nbsp;<span class="ident" id="4708066">out</span>&nbsp;<span class="op" id="4708070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708074">if</span>&nbsp;<span class="string" id="4708077">&#39;A&#39;</span>&nbsp;<span class="op" id="4708081">&lt;=</span>&nbsp;<span class="ident" id="4708084">c</span>&nbsp;<span class="op" id="4708086">&amp;&amp;</span>&nbsp;<span class="ident" id="4708089">c</span>&nbsp;<span class="op" id="4708091">&lt;=</span>&nbsp;<span class="string" id="4708094">&#39;Z&#39;</span>&nbsp;<span class="op" id="4708098">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4708103">out</span><span class="op" id="4708106">[</span><span class="ident" id="4708107">i</span><span class="op" id="4708108">]</span>&nbsp;<span class="op" id="4708110">+=</span>&nbsp;<span class="string" id="4708113">&#39;a&#39;</span>&nbsp;<span class="op" id="4708117">-</span>&nbsp;<span class="string" id="4708119">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708131">return</span>&nbsp;<span class="builtintype" id="4708138">string</span><span class="op" id="4708144">(</span><span class="ident" id="4708145">out</span><span class="op" id="4708148">)</span><br>
<span class="lineno"></span><span class="op" id="4708150">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="4708153">//&nbsp;VerifyHostname&nbsp;returns&nbsp;nil&nbsp;if&nbsp;c&nbsp;is&nbsp;a&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;the&nbsp;named&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="4708231">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;mismatch.</span><br>
<span class="lineno"></span><span class="keyword" id="4708289">func</span>&nbsp;<span class="op" id="4708294">(</span><span class="ident" id="4708295">c</span>&nbsp;<span class="op" id="4708297">*</span><span class="ident" id="4708298">Certificate</span><span class="op" id="4708309">)</span>&nbsp;<span class="ident" id="4708311">VerifyHostname</span><span class="op" id="4708325">(</span><span class="ident" id="4708326">h</span>&nbsp;<span class="builtintype" id="4708328">string</span><span class="op" id="4708334">)</span>&nbsp;<span class="builtintype" id="4708336">error</span>&nbsp;<span class="op" id="4708342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4708345">//&nbsp;IP&nbsp;addresses&nbsp;may&nbsp;be&nbsp;written&nbsp;in&nbsp;[&nbsp;].</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4708385">candidateIP</span>&nbsp;<span class="op" id="4708397">:=</span>&nbsp;<span class="ident" id="4708400">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708403">if</span>&nbsp;<span class="builtinfunc" id="4708406">len</span><span class="op" id="4708409">(</span><span class="ident" id="4708410">h</span><span class="op" id="4708411">)</span>&nbsp;<span class="op" id="4708413">&gt;=</span>&nbsp;<span class="num" id="4708416">3</span>&nbsp;<span class="op" id="4708418">&amp;&amp;</span>&nbsp;<span class="ident" id="4708421">h</span><span class="op" id="4708422">[</span><span class="num" id="4708423">0</span><span class="op" id="4708424">]</span>&nbsp;<span class="op" id="4708426">==</span>&nbsp;<span class="string" id="4708429">&#39;[&#39;</span>&nbsp;<span class="op" id="4708433">&amp;&amp;</span>&nbsp;<span class="ident" id="4708436">h</span><span class="op" id="4708437">[</span><span class="builtinfunc" id="4708438">len</span><span class="op" id="4708441">(</span><span class="ident" id="4708442">h</span><span class="op" id="4708443">)</span><span class="op" id="4708444">-</span><span class="num" id="4708445">1</span><span class="op" id="4708446">]</span>&nbsp;<span class="op" id="4708448">==</span>&nbsp;<span class="string" id="4708451">&#39;]&#39;</span>&nbsp;<span class="op" id="4708455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4708459">candidateIP</span>&nbsp;<span class="op" id="4708471">=</span>&nbsp;<span class="ident" id="4708473">h</span><span class="op" id="4708474">[</span><span class="num" id="4708475">1</span>&nbsp;<span class="op" id="4708477">:</span>&nbsp;<span class="builtinfunc" id="4708479">len</span><span class="op" id="4708482">(</span><span class="ident" id="4708483">h</span><span class="op" id="4708484">)</span><span class="op" id="4708485">-</span><span class="num" id="4708486">1</span><span class="op" id="4708487">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708493">if</span>&nbsp;<span class="ident" id="4708496">ip</span>&nbsp;<span class="op" id="4708499">:=</span>&nbsp;<span class="ident" id="4708502">net</span><span class="op" id="4708505">.</span><span class="ident" id="4708506">ParseIP</span><span class="op" id="4708513">(</span><span class="ident" id="4708514">candidateIP</span><span class="op" id="4708525">)</span><span class="op" id="4708526">;</span>&nbsp;<span class="ident" id="4708528">ip</span>&nbsp;<span class="op" id="4708531">!=</span>&nbsp;<span class="ident" id="4708534">nil</span>&nbsp;<span class="op" id="4708538">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4708542">//&nbsp;We&nbsp;only&nbsp;match&nbsp;IP&nbsp;addresses&nbsp;against&nbsp;IP&nbsp;SANs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4708591">//&nbsp;https://tools.ietf.org/html/rfc6125#appendix-B.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708645">for</span>&nbsp;<span class="ident" id="4708649">_</span><span class="op" id="4708650">,</span>&nbsp;<span class="ident" id="4708652">candidate</span>&nbsp;<span class="op" id="4708662">:=</span>&nbsp;<span class="keyword" id="4708665">range</span>&nbsp;<span class="ident" id="4708671">c</span><span class="op" id="4708672">.</span><span class="ident" id="4708673">IPAddresses</span>&nbsp;<span class="op" id="4708685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708690">if</span>&nbsp;<span class="ident" id="4708693">ip</span><span class="op" id="4708695">.</span><span class="ident" id="4708696">Equal</span><span class="op" id="4708701">(</span><span class="ident" id="4708702">candidate</span><span class="op" id="4708711">)</span>&nbsp;<span class="op" id="4708713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708719">return</span>&nbsp;<span class="ident" id="4708726">nil</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708741">return</span>&nbsp;<span class="ident" id="4708748">HostnameError</span><span class="op" id="4708761">{</span><span class="ident" id="4708762">c</span><span class="op" id="4708763">,</span>&nbsp;<span class="ident" id="4708765">candidateIP</span><span class="op" id="4708776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4708783">lowered</span>&nbsp;<span class="op" id="4708791">:=</span>&nbsp;<span class="ident" id="4708794">toLowerCaseASCII</span><span class="op" id="4708810">(</span><span class="ident" id="4708811">h</span><span class="op" id="4708812">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708816">if</span>&nbsp;<span class="builtinfunc" id="4708819">len</span><span class="op" id="4708822">(</span><span class="ident" id="4708823">c</span><span class="op" id="4708824">.</span><span class="ident" id="4708825">DNSNames</span><span class="op" id="4708833">)</span>&nbsp;<span class="op" id="4708835">&gt;</span>&nbsp;<span class="num" id="4708837">0</span>&nbsp;<span class="op" id="4708839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708843">for</span>&nbsp;<span class="ident" id="4708847">_</span><span class="op" id="4708848">,</span>&nbsp;<span class="ident" id="4708850">match</span>&nbsp;<span class="op" id="4708856">:=</span>&nbsp;<span class="keyword" id="4708859">range</span>&nbsp;<span class="ident" id="4708865">c</span><span class="op" id="4708866">.</span><span class="ident" id="4708867">DNSNames</span>&nbsp;<span class="op" id="4708876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708881">if</span>&nbsp;<span class="ident" id="4708884">matchHostnames</span><span class="op" id="4708898">(</span><span class="ident" id="4708899">toLowerCaseASCII</span><span class="op" id="4708915">(</span><span class="ident" id="4708916">match</span><span class="op" id="4708921">)</span><span class="op" id="4708922">,</span>&nbsp;<span class="ident" id="4708924">lowered</span><span class="op" id="4708931">)</span>&nbsp;<span class="op" id="4708933">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708939">return</span>&nbsp;<span class="ident" id="4708946">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4708961">//&nbsp;If&nbsp;Subject&nbsp;Alt&nbsp;Name&nbsp;is&nbsp;given,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;common&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4709022">}</span>&nbsp;<span class="keyword" id="4709024">else</span>&nbsp;<span class="keyword" id="4709029">if</span>&nbsp;<span class="ident" id="4709032">matchHostnames</span><span class="op" id="4709046">(</span><span class="ident" id="4709047">toLowerCaseASCII</span><span class="op" id="4709063">(</span><span class="ident" id="4709064">c</span><span class="op" id="4709065">.</span><span class="ident" id="4709066">Subject</span><span class="op" id="4709073">.</span><span class="ident" id="4709074">CommonName</span><span class="op" id="4709084">)</span><span class="op" id="4709085">,</span>&nbsp;<span class="ident" id="4709087">lowered</span><span class="op" id="4709094">)</span>&nbsp;<span class="op" id="4709096">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4709100">return</span>&nbsp;<span class="ident" id="4709107">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4709112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4709116">return</span>&nbsp;<span class="ident" id="4709123">HostnameError</span><span class="op" id="4709136">{</span><span class="ident" id="4709137">c</span><span class="op" id="4709138">,</span>&nbsp;<span class="ident" id="4709140">h</span><span class="op" id="4709141">}</span><br>
<span class="lineno"></span><span class="op" id="4709143">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="4709146">func</span>&nbsp;<span class="ident" id="4709151">checkChainForKeyUsage</span><span class="op" id="4709172">(</span><span class="ident" id="4709173">chain</span>&nbsp;<span class="op" id="4709179">[</span><span class="op" id="4709180">]</span><span class="op" id="4709181">*</span><span class="ident" id="4709182">Certificate</span><span class="op" id="4709193">,</span>&nbsp;<span class="ident" id="4709195">keyUsages</span>&nbsp;<span class="op" id="4709205">[</span><span class="op" id="4709206">]</span><span class="ident" id="4709207">ExtKeyUsage</span><span class="op" id="4709218">)</span>&nbsp;<span class="builtintype" id="4709220">bool</span>&nbsp;<span class="op" id="4709225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4709228">usages</span>&nbsp;<span class="op" id="4709235">:=</span>&nbsp;<span class="builtinfunc" id="4709238">make</span><span class="op" id="4709242">(</span><span class="op" id="4709243">[</span><span class="op" id="4709244">]</span><span class="ident" id="4709245">ExtKeyUsage</span><span class="op" id="4709256">,</span>&nbsp;<span class="builtinfunc" id="4709258">len</span><span class="op" id="4709261">(</span><span class="ident" id="4709262">keyUsages</span><span class="op" id="4709271">)</span><span class="op" id="4709272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4709275">copy</span><span class="op" id="4709279">(</span><span class="ident" id="4709280">usages</span><span class="op" id="4709286">,</span>&nbsp;<span class="ident" id="4709288">keyUsages</span><span class="op" id="4709297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4709301">if</span>&nbsp;<span class="builtinfunc" id="4709304">len</span><span class="op" id="4709307">(</span><span class="ident" id="4709308">chain</span><span class="op" id="4709313">)</span>&nbsp;<span class="op" id="4709315">==</span>&nbsp;<span class="num" id="4709318">0</span>&nbsp;<span class="op" id="4709320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4709324">return</span>&nbsp;<span class="builtintype" id="4709331">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4709338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4709342">usagesRemaining</span>&nbsp;<span class="op" id="4709358">:=</span>&nbsp;<span class="builtinfunc" id="4709361">len</span><span class="op" id="4709364">(</span><span class="ident" id="4709365">usages</span><span class="op" id="4709371">)</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4709375">//&nbsp;We&nbsp;walk&nbsp;down&nbsp;the&nbsp;list&nbsp;and&nbsp;cross&nbsp;out&nbsp;any&nbsp;usages&nbsp;that&nbsp;aren&#39;t&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4709448">//&nbsp;by&nbsp;each&nbsp;certificate.&nbsp;If&nbsp;we&nbsp;cross&nbsp;out&nbsp;all&nbsp;the&nbsp;usages,&nbsp;then&nbsp;the&nbsp;chain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4709520">//&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="ident" id="4709541">NextCert</span><span class="op" id="4709549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4709552">for</span>&nbsp;<span class="ident" id="4709556">i</span>&nbsp;<span class="op" id="4709558">:=</span>&nbsp;<span class="builtinfunc" id="4709561">len</span><span class="op" id="4709564">(</span><span class="ident" id="4709565">chain</span><span class="op" id="4709570">)</span>&nbsp;<span class="op" id="4709572">-</span>&nbsp;<span class="num" id="4709574">1</span><span class="op" id="4709575">;</span>&nbsp;<span class="ident" id="4709577">i</span>&nbsp;<span class="op" id="4709579">&gt;=</span>&nbsp;<span class="num" id="4709582">0</span><span class="op" id="4709583">;</span>&nbsp;<span class="ident" id="4709585">i</span><span class="op" id="4709586">--</span>&nbsp;<span class="op" id="4709589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4709593">cert</span>&nbsp;<span class="op" id="4709598">:=</span>&nbsp;<span class="ident" id="4709601">chain</span><span class="op" id="4709606">[</span><span class="ident" id="4709607">i</span><span class="op" id="4709608">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4709612">if</span>&nbsp;<span class="builtinfunc" id="4709615">len</span><span class="op" id="4709618">(</span><span class="ident" id="4709619">cert</span><span class="op" id="4709623">.</span><span class="ident" id="4709624">ExtKeyUsage</span><span class="op" id="4709635">)</span>&nbsp;<span class="op" id="4709637">==</span>&nbsp;<span class="num" id="4709640">0</span>&nbsp;<span class="op" id="4709642">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4709645">len</span><span class="op" id="4709648">(</span><span class="ident" id="4709649">cert</span><span class="op" id="4709653">.</span><span class="ident" id="4709654">UnknownExtKeyUsage</span><span class="op" id="4709672">)</span>&nbsp;<span class="op" id="4709674">==</span>&nbsp;<span class="num" id="4709677">0</span>&nbsp;<span class="op" id="4709679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4709684">//&nbsp;The&nbsp;certificate&nbsp;doesn&#39;t&nbsp;have&nbsp;any&nbsp;extended&nbsp;key&nbsp;usage&nbsp;specified.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4709753">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4709764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4709769">for</span>&nbsp;<span class="ident" id="4709773">_</span><span class="op" id="4709774">,</span>&nbsp;<span class="ident" id="4709776">usage</span>&nbsp;<span class="op" id="4709782">:=</span>&nbsp;<span class="keyword" id="4709785">range</span>&nbsp;<span class="ident" id="4709791">cert</span><span class="op" id="4709795">.</span><span class="ident" id="4709796">ExtKeyUsage</span>&nbsp;<span class="op" id="4709808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4709813">if</span>&nbsp;<span class="ident" id="4709816">usage</span>&nbsp;<span class="op" id="4709822">==</span>&nbsp;<span class="ident" id="4709825">ExtKeyUsageAny</span>&nbsp;<span class="op" id="4709840">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4709846">//&nbsp;The&nbsp;certificate&nbsp;is&nbsp;explicitly&nbsp;good&nbsp;for&nbsp;any&nbsp;usage.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4709903">continue</span>&nbsp;<span class="ident" id="4709912">NextCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4709924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4709928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4709933">const</span>&nbsp;<span class="ident" id="4709939">invalidUsage</span>&nbsp;<span class="ident" id="4709952">ExtKeyUsage</span>&nbsp;<span class="op" id="4709964">=</span>&nbsp;<span class="op" id="4709966">-</span><span class="num" id="4709967">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4709971">NextRequestedUsage</span><span class="op" id="4709989">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4709993">for</span>&nbsp;<span class="ident" id="4709997">i</span><span class="op" id="4709998">,</span>&nbsp;<span class="ident" id="4710000">requestedUsage</span>&nbsp;<span class="op" id="4710015">:=</span>&nbsp;<span class="keyword" id="4710018">range</span>&nbsp;<span class="ident" id="4710024">usages</span>&nbsp;<span class="op" id="4710031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4710036">if</span>&nbsp;<span class="ident" id="4710039">requestedUsage</span>&nbsp;<span class="op" id="4710054">==</span>&nbsp;<span class="ident" id="4710057">invalidUsage</span>&nbsp;<span class="op" id="4710070">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4710076">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4710088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4710094">for</span>&nbsp;<span class="ident" id="4710098">_</span><span class="op" id="4710099">,</span>&nbsp;<span class="ident" id="4710101">usage</span>&nbsp;<span class="op" id="4710107">:=</span>&nbsp;<span class="keyword" id="4710110">range</span>&nbsp;<span class="ident" id="4710116">cert</span><span class="op" id="4710120">.</span><span class="ident" id="4710121">ExtKeyUsage</span>&nbsp;<span class="op" id="4710133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4710139">if</span>&nbsp;<span class="ident" id="4710142">requestedUsage</span>&nbsp;<span class="op" id="4710157">==</span>&nbsp;<span class="ident" id="4710160">usage</span>&nbsp;<span class="op" id="4710166">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4710173">continue</span>&nbsp;<span class="ident" id="4710182">NextRequestedUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4710205">}</span>&nbsp;<span class="keyword" id="4710207">else</span>&nbsp;<span class="keyword" id="4710212">if</span>&nbsp;<span class="ident" id="4710215">requestedUsage</span>&nbsp;<span class="op" id="4710230">==</span>&nbsp;<span class="ident" id="4710233">ExtKeyUsageServerAuth</span>&nbsp;<span class="op" id="4710255">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4710263">(</span><span class="ident" id="4710264">usage</span>&nbsp;<span class="op" id="4710270">==</span>&nbsp;<span class="ident" id="4710273">ExtKeyUsageNetscapeServerGatedCrypto</span>&nbsp;<span class="op" id="4710310">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4710319">usage</span>&nbsp;<span class="op" id="4710325">==</span>&nbsp;<span class="ident" id="4710328">ExtKeyUsageMicrosoftServerGatedCrypto</span><span class="op" id="4710365">)</span>&nbsp;<span class="op" id="4710367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4710374">//&nbsp;In&nbsp;order&nbsp;to&nbsp;support&nbsp;COMODO</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4710409">//&nbsp;certificate&nbsp;chains,&nbsp;we&nbsp;have&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4710448">//&nbsp;accept&nbsp;Netscape&nbsp;or&nbsp;Microsoft&nbsp;SGC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4710489">//&nbsp;usages&nbsp;as&nbsp;equal&nbsp;to&nbsp;ServerAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4710528">continue</span>&nbsp;<span class="ident" id="4710537">NextRequestedUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4710560">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4710565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4710571">usages</span><span class="op" id="4710577">[</span><span class="ident" id="4710578">i</span><span class="op" id="4710579">]</span>&nbsp;<span class="op" id="4710581">=</span>&nbsp;<span class="ident" id="4710583">invalidUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4710599">usagesRemaining</span><span class="op" id="4710614">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4710620">if</span>&nbsp;<span class="ident" id="4710623">usagesRemaining</span>&nbsp;<span class="op" id="4710639">==</span>&nbsp;<span class="num" id="4710642">0</span>&nbsp;<span class="op" id="4710644">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4710650">return</span>&nbsp;<span class="builtintype" id="4710657">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4710666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4710670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4710673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4710677">return</span>&nbsp;<span class="builtintype" id="4710684">true</span><br>
<span class="lineno"></span><span class="op" id="4710689">}</span>
</div>
</body>
</html>
