<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8453747">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8453802">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8453856">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8453907">package</span>&nbsp;<span class="ident" id="8453915">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8453920">import</span>&nbsp;<span class="op" id="8453927">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8453930">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8453939">&#34;flag&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8453947">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8453954">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8453967">&#34;go/printer&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8453981">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8453993">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454006">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454012">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454029">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454039">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454050">&#34;testing&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454061">&#34;text/template&#34;</span><br>
<span class="lineno"></span><span class="op" id="8454077">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8454080">var</span>&nbsp;<span class="ident" id="8454084">update</span>&nbsp;<span class="op" id="8454091">=</span>&nbsp;<span class="ident" id="8454093">flag</span><span class="op" id="8454097">.</span><span class="ident" id="8454098">Bool</span><span class="op" id="8454102">(</span><span class="string" id="8454103">&#34;update&#34;</span><span class="op" id="8454111">,</span>&nbsp;<span class="builtintype" id="8454113">false</span><span class="op" id="8454118">,</span>&nbsp;<span class="string" id="8454120">&#34;update&nbsp;golden&nbsp;(.out)&nbsp;files&#34;</span><span class="op" id="8454148">)</span><br>
<span class="lineno"></span><span class="keyword" id="8454150">var</span>&nbsp;<span class="ident" id="8454154">files</span>&nbsp;<span class="op" id="8454160">=</span>&nbsp;<span class="ident" id="8454162">flag</span><span class="op" id="8454166">.</span><span class="ident" id="8454167">String</span><span class="op" id="8454173">(</span><span class="string" id="8454174">&#34;files&#34;</span><span class="op" id="8454181">,</span>&nbsp;<span class="string" id="8454183">&#34;&#34;</span><span class="op" id="8454185">,</span>&nbsp;<span class="string" id="8454187">&#34;consider&nbsp;only&nbsp;Go&nbsp;test&nbsp;files&nbsp;matching&nbsp;this&nbsp;regular&nbsp;expression&#34;</span><span class="op" id="8454249">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="8454252">const</span>&nbsp;<span class="ident" id="8454258">dataDir</span>&nbsp;<span class="op" id="8454266">=</span>&nbsp;<span class="string" id="8454268">&#34;testdata&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8454280">var</span>&nbsp;<span class="ident" id="8454284">templateTxt</span>&nbsp;<span class="op" id="8454296">=</span>&nbsp;<span class="ident" id="8454298">readTemplate</span><span class="op" id="8454310">(</span><span class="string" id="8454311">&#34;template.txt&#34;</span><span class="op" id="8454325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8454328">func</span>&nbsp;<span class="ident" id="8454333">readTemplate</span><span class="op" id="8454345">(</span><span class="ident" id="8454346">filename</span>&nbsp;<span class="builtintype" id="8454355">string</span><span class="op" id="8454361">)</span>&nbsp;<span class="op" id="8454363">*</span><span class="ident" id="8454364">template</span><span class="op" id="8454372">.</span><span class="ident" id="8454373">Template</span>&nbsp;<span class="op" id="8454382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454385">t</span>&nbsp;<span class="op" id="8454387">:=</span>&nbsp;<span class="ident" id="8454390">template</span><span class="op" id="8454398">.</span><span class="ident" id="8454399">New</span><span class="op" id="8454402">(</span><span class="ident" id="8454403">filename</span><span class="op" id="8454411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454414">t</span><span class="op" id="8454415">.</span><span class="ident" id="8454416">Funcs</span><span class="op" id="8454421">(</span><span class="ident" id="8454422">template</span><span class="op" id="8454430">.</span><span class="ident" id="8454431">FuncMap</span><span class="op" id="8454438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454442">&#34;node&#34;</span><span class="op" id="8454448">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454454">nodeFmt</span><span class="op" id="8454461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454465">&#34;synopsis&#34;</span><span class="op" id="8454475">:</span>&nbsp;<span class="ident" id="8454477">synopsisFmt</span><span class="op" id="8454488">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454492">&#34;indent&#34;</span><span class="op" id="8454500">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8454504">indentFmt</span><span class="op" id="8454513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8454516">}</span><span class="op" id="8454517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8454520">return</span>&nbsp;<span class="ident" id="8454527">template</span><span class="op" id="8454535">.</span><span class="ident" id="8454536">Must</span><span class="op" id="8454540">(</span><span class="ident" id="8454541">t</span><span class="op" id="8454542">.</span><span class="ident" id="8454543">ParseFiles</span><span class="op" id="8454553">(</span><span class="ident" id="8454554">filepath</span><span class="op" id="8454562">.</span><span class="ident" id="8454563">Join</span><span class="op" id="8454567">(</span><span class="ident" id="8454568">dataDir</span><span class="op" id="8454575">,</span>&nbsp;<span class="ident" id="8454577">filename</span><span class="op" id="8454585">)</span><span class="op" id="8454586">)</span><span class="op" id="8454587">)</span><br>
<span class="lineno"></span><span class="op" id="8454589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="8454592">func</span>&nbsp;<span class="ident" id="8454597">nodeFmt</span><span class="op" id="8454604">(</span><span class="ident" id="8454605">node</span>&nbsp;<span class="keyword" id="8454610">interface</span><span class="op" id="8454619">{</span><span class="op" id="8454620">}</span><span class="op" id="8454621">,</span>&nbsp;<span class="ident" id="8454623">fset</span>&nbsp;<span class="op" id="8454628">*</span><span class="ident" id="8454629">token</span><span class="op" id="8454634">.</span><span class="ident" id="8454635">FileSet</span><span class="op" id="8454642">)</span>&nbsp;<span class="builtintype" id="8454644">string</span>&nbsp;<span class="op" id="8454651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8454654">var</span>&nbsp;<span class="ident" id="8454658">buf</span>&nbsp;<span class="ident" id="8454662">bytes</span><span class="op" id="8454667">.</span><span class="ident" id="8454668">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454676">printer</span><span class="op" id="8454683">.</span><span class="ident" id="8454684">Fprint</span><span class="op" id="8454690">(</span><span class="op" id="8454691">&amp;</span><span class="ident" id="8454692">buf</span><span class="op" id="8454695">,</span>&nbsp;<span class="ident" id="8454697">fset</span><span class="op" id="8454701">,</span>&nbsp;<span class="ident" id="8454703">node</span><span class="op" id="8454707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8454710">return</span>&nbsp;<span class="ident" id="8454717">strings</span><span class="op" id="8454724">.</span><span class="ident" id="8454725">Replace</span><span class="op" id="8454732">(</span><span class="ident" id="8454733">strings</span><span class="op" id="8454740">.</span><span class="ident" id="8454741">TrimSpace</span><span class="op" id="8454750">(</span><span class="ident" id="8454751">buf</span><span class="op" id="8454754">.</span><span class="ident" id="8454755">String</span><span class="op" id="8454761">(</span><span class="op" id="8454762">)</span><span class="op" id="8454763">)</span><span class="op" id="8454764">,</span>&nbsp;<span class="string" id="8454766">&#34;\n&#34;</span><span class="op" id="8454770">,</span>&nbsp;<span class="string" id="8454772">&#34;\n\t&#34;</span><span class="op" id="8454778">,</span>&nbsp;<span class="op" id="8454780">-</span><span class="num" id="8454781">1</span><span class="op" id="8454782">)</span><br>
<span class="lineno"></span><span class="op" id="8454784">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8454787">func</span>&nbsp;<span class="ident" id="8454792">synopsisFmt</span><span class="op" id="8454803">(</span><span class="ident" id="8454804">s</span>&nbsp;<span class="builtintype" id="8454806">string</span><span class="op" id="8454812">)</span>&nbsp;<span class="builtintype" id="8454814">string</span>&nbsp;<span class="op" id="8454821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8454824">const</span>&nbsp;<span class="ident" id="8454830">n</span>&nbsp;<span class="op" id="8454832">=</span>&nbsp;<span class="num" id="8454834">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8454838">if</span>&nbsp;<span class="builtinfunc" id="8454841">len</span><span class="op" id="8454844">(</span><span class="ident" id="8454845">s</span><span class="op" id="8454846">)</span>&nbsp;<span class="op" id="8454848">&gt;</span>&nbsp;<span class="ident" id="8454850">n</span>&nbsp;<span class="op" id="8454852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8454856">//&nbsp;cut&nbsp;off&nbsp;excess&nbsp;text&nbsp;and&nbsp;go&nbsp;back&nbsp;to&nbsp;a&nbsp;word&nbsp;boundary</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454912">s</span>&nbsp;<span class="op" id="8454914">=</span>&nbsp;<span class="ident" id="8454916">s</span><span class="op" id="8454917">[</span><span class="num" id="8454918">0</span><span class="op" id="8454919">:</span><span class="ident" id="8454920">n</span><span class="op" id="8454921">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8454925">if</span>&nbsp;<span class="ident" id="8454928">i</span>&nbsp;<span class="op" id="8454930">:=</span>&nbsp;<span class="ident" id="8454933">strings</span><span class="op" id="8454940">.</span><span class="ident" id="8454941">LastIndexAny</span><span class="op" id="8454953">(</span><span class="ident" id="8454954">s</span><span class="op" id="8454955">,</span>&nbsp;<span class="string" id="8454957">&#34;\t\n&nbsp;&#34;</span><span class="op" id="8454964">)</span><span class="op" id="8454965">;</span>&nbsp;<span class="ident" id="8454967">i</span>&nbsp;<span class="op" id="8454969">&gt;=</span>&nbsp;<span class="num" id="8454972">0</span>&nbsp;<span class="op" id="8454974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454979">s</span>&nbsp;<span class="op" id="8454981">=</span>&nbsp;<span class="ident" id="8454983">s</span><span class="op" id="8454984">[</span><span class="num" id="8454985">0</span><span class="op" id="8454986">:</span><span class="ident" id="8454987">i</span><span class="op" id="8454988">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8454992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8454996">s</span>&nbsp;<span class="op" id="8454998">=</span>&nbsp;<span class="ident" id="8455000">strings</span><span class="op" id="8455007">.</span><span class="ident" id="8455008">TrimSpace</span><span class="op" id="8455017">(</span><span class="ident" id="8455018">s</span><span class="op" id="8455019">)</span>&nbsp;<span class="op" id="8455021">+</span>&nbsp;<span class="string" id="8455023">&#34;&nbsp;...&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455034">return</span>&nbsp;<span class="string" id="8455041">&#34;//&nbsp;&#34;</span>&nbsp;<span class="op" id="8455047">+</span>&nbsp;<span class="ident" id="8455049">strings</span><span class="op" id="8455056">.</span><span class="ident" id="8455057">Replace</span><span class="op" id="8455064">(</span><span class="ident" id="8455065">s</span><span class="op" id="8455066">,</span>&nbsp;<span class="string" id="8455068">&#34;\n&#34;</span><span class="op" id="8455072">,</span>&nbsp;<span class="string" id="8455074">&#34;&nbsp;&#34;</span><span class="op" id="8455077">,</span>&nbsp;<span class="op" id="8455079">-</span><span class="num" id="8455080">1</span><span class="op" id="8455081">)</span><br>
<span class="lineno"></span><span class="op" id="8455083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8455086">func</span>&nbsp;<span class="ident" id="8455091">indentFmt</span><span class="op" id="8455100">(</span><span class="ident" id="8455101">indent</span><span class="op" id="8455107">,</span>&nbsp;<span class="ident" id="8455109">s</span>&nbsp;<span class="builtintype" id="8455111">string</span><span class="op" id="8455117">)</span>&nbsp;<span class="builtintype" id="8455119">string</span>&nbsp;<span class="op" id="8455126">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455129">end</span>&nbsp;<span class="op" id="8455133">:=</span>&nbsp;<span class="string" id="8455136">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455140">if</span>&nbsp;<span class="ident" id="8455143">strings</span><span class="op" id="8455150">.</span><span class="ident" id="8455151">HasSuffix</span><span class="op" id="8455160">(</span><span class="ident" id="8455161">s</span><span class="op" id="8455162">,</span>&nbsp;<span class="string" id="8455164">&#34;\n&#34;</span><span class="op" id="8455168">)</span>&nbsp;<span class="op" id="8455170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455174">end</span>&nbsp;<span class="op" id="8455178">=</span>&nbsp;<span class="string" id="8455180">&#34;\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455187">s</span>&nbsp;<span class="op" id="8455189">=</span>&nbsp;<span class="ident" id="8455191">s</span><span class="op" id="8455192">[</span><span class="op" id="8455193">:</span><span class="builtinfunc" id="8455194">len</span><span class="op" id="8455197">(</span><span class="ident" id="8455198">s</span><span class="op" id="8455199">)</span><span class="op" id="8455200">-</span><span class="num" id="8455201">1</span><span class="op" id="8455202">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455205">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455208">return</span>&nbsp;<span class="ident" id="8455215">indent</span>&nbsp;<span class="op" id="8455222">+</span>&nbsp;<span class="ident" id="8455224">strings</span><span class="op" id="8455231">.</span><span class="ident" id="8455232">Replace</span><span class="op" id="8455239">(</span><span class="ident" id="8455240">s</span><span class="op" id="8455241">,</span>&nbsp;<span class="string" id="8455243">&#34;\n&#34;</span><span class="op" id="8455247">,</span>&nbsp;<span class="string" id="8455249">&#34;\n&#34;</span><span class="op" id="8455253">+</span><span class="ident" id="8455254">indent</span><span class="op" id="8455260">,</span>&nbsp;<span class="op" id="8455262">-</span><span class="num" id="8455263">1</span><span class="op" id="8455264">)</span>&nbsp;<span class="op" id="8455266">+</span>&nbsp;<span class="ident" id="8455268">end</span><br>
<span class="lineno"></span><span class="op" id="8455272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8455275">func</span>&nbsp;<span class="ident" id="8455280">isGoFile</span><span class="op" id="8455288">(</span><span class="ident" id="8455289">fi</span>&nbsp;<span class="ident" id="8455292">os</span><span class="op" id="8455294">.</span><span class="ident" id="8455295">FileInfo</span><span class="op" id="8455303">)</span>&nbsp;<span class="builtintype" id="8455305">bool</span>&nbsp;<span class="op" id="8455310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455313">name</span>&nbsp;<span class="op" id="8455318">:=</span>&nbsp;<span class="ident" id="8455321">fi</span><span class="op" id="8455323">.</span><span class="ident" id="8455324">Name</span><span class="op" id="8455328">(</span><span class="op" id="8455329">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455332">return</span>&nbsp;<span class="op" id="8455339">!</span><span class="ident" id="8455340">fi</span><span class="op" id="8455342">.</span><span class="ident" id="8455343">IsDir</span><span class="op" id="8455348">(</span><span class="op" id="8455349">)</span>&nbsp;<span class="op" id="8455351">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8455356">len</span><span class="op" id="8455359">(</span><span class="ident" id="8455360">name</span><span class="op" id="8455364">)</span>&nbsp;<span class="op" id="8455366">&gt;</span>&nbsp;<span class="num" id="8455368">0</span>&nbsp;<span class="op" id="8455370">&amp;&amp;</span>&nbsp;<span class="ident" id="8455373">name</span><span class="op" id="8455377">[</span><span class="num" id="8455378">0</span><span class="op" id="8455379">]</span>&nbsp;<span class="op" id="8455381">!=</span>&nbsp;<span class="string" id="8455384">&#39;.&#39;</span>&nbsp;<span class="op" id="8455388">&amp;&amp;</span>&nbsp;<span class="comment" id="8455391">//&nbsp;ignore&nbsp;.files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455410">filepath</span><span class="op" id="8455418">.</span><span class="ident" id="8455419">Ext</span><span class="op" id="8455422">(</span><span class="ident" id="8455423">name</span><span class="op" id="8455427">)</span>&nbsp;<span class="op" id="8455429">==</span>&nbsp;<span class="string" id="8455432">&#34;.go&#34;</span><br>
<span class="lineno"></span><span class="op" id="8455438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="8455441">type</span>&nbsp;<span class="ident" id="8455446">bundle</span>&nbsp;<span class="keyword" id="8455453">struct</span>&nbsp;<span class="op" id="8455460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455463">*</span><span class="ident" id="8455464">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455473">FSet</span>&nbsp;<span class="op" id="8455478">*</span><span class="ident" id="8455479">token</span><span class="op" id="8455484">.</span><span class="ident" id="8455485">FileSet</span><br>
<span class="lineno"></span><span class="op" id="8455493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="8455496">func</span>&nbsp;<span class="ident" id="8455501">test</span><span class="op" id="8455505">(</span><span class="ident" id="8455506">t</span>&nbsp;<span class="op" id="8455508">*</span><span class="ident" id="8455509">testing</span><span class="op" id="8455516">.</span><span class="ident" id="8455517">T</span><span class="op" id="8455518">,</span>&nbsp;<span class="ident" id="8455520">mode</span>&nbsp;<span class="ident" id="8455525">Mode</span><span class="op" id="8455529">)</span>&nbsp;<span class="op" id="8455531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455534">//&nbsp;determine&nbsp;file&nbsp;filter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455560">filter</span>&nbsp;<span class="op" id="8455567">:=</span>&nbsp;<span class="ident" id="8455570">isGoFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455580">if</span>&nbsp;<span class="op" id="8455583">*</span><span class="ident" id="8455584">files</span>&nbsp;<span class="op" id="8455590">!=</span>&nbsp;<span class="string" id="8455593">&#34;&#34;</span>&nbsp;<span class="op" id="8455596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455600">rx</span><span class="op" id="8455602">,</span>&nbsp;<span class="ident" id="8455604">err</span>&nbsp;<span class="op" id="8455608">:=</span>&nbsp;<span class="ident" id="8455611">regexp</span><span class="op" id="8455617">.</span><span class="ident" id="8455618">Compile</span><span class="op" id="8455625">(</span><span class="op" id="8455626">*</span><span class="ident" id="8455627">files</span><span class="op" id="8455632">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455636">if</span>&nbsp;<span class="ident" id="8455639">err</span>&nbsp;<span class="op" id="8455643">!=</span>&nbsp;<span class="ident" id="8455646">nil</span>&nbsp;<span class="op" id="8455650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455655">t</span><span class="op" id="8455656">.</span><span class="ident" id="8455657">Fatal</span><span class="op" id="8455662">(</span><span class="ident" id="8455663">err</span><span class="op" id="8455666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455674">filter</span>&nbsp;<span class="op" id="8455681">=</span>&nbsp;<span class="keyword" id="8455683">func</span><span class="op" id="8455687">(</span><span class="ident" id="8455688">fi</span>&nbsp;<span class="ident" id="8455691">os</span><span class="op" id="8455693">.</span><span class="ident" id="8455694">FileInfo</span><span class="op" id="8455702">)</span>&nbsp;<span class="builtintype" id="8455704">bool</span>&nbsp;<span class="op" id="8455709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455714">return</span>&nbsp;<span class="ident" id="8455721">isGoFile</span><span class="op" id="8455729">(</span><span class="ident" id="8455730">fi</span><span class="op" id="8455732">)</span>&nbsp;<span class="op" id="8455734">&amp;&amp;</span>&nbsp;<span class="ident" id="8455737">rx</span><span class="op" id="8455739">.</span><span class="ident" id="8455740">MatchString</span><span class="op" id="8455751">(</span><span class="ident" id="8455752">fi</span><span class="op" id="8455754">.</span><span class="ident" id="8455755">Name</span><span class="op" id="8455759">(</span><span class="op" id="8455760">)</span><span class="op" id="8455761">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455772">//&nbsp;get&nbsp;packages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455789">fset</span>&nbsp;<span class="op" id="8455794">:=</span>&nbsp;<span class="ident" id="8455797">token</span><span class="op" id="8455802">.</span><span class="ident" id="8455803">NewFileSet</span><span class="op" id="8455813">(</span><span class="op" id="8455814">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455817">pkgs</span><span class="op" id="8455821">,</span>&nbsp;<span class="ident" id="8455823">err</span>&nbsp;<span class="op" id="8455827">:=</span>&nbsp;<span class="ident" id="8455830">parser</span><span class="op" id="8455836">.</span><span class="ident" id="8455837">ParseDir</span><span class="op" id="8455845">(</span><span class="ident" id="8455846">fset</span><span class="op" id="8455850">,</span>&nbsp;<span class="ident" id="8455852">dataDir</span><span class="op" id="8455859">,</span>&nbsp;<span class="ident" id="8455861">filter</span><span class="op" id="8455867">,</span>&nbsp;<span class="ident" id="8455869">parser</span><span class="op" id="8455875">.</span><span class="ident" id="8455876">ParseComments</span><span class="op" id="8455889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455892">if</span>&nbsp;<span class="ident" id="8455895">err</span>&nbsp;<span class="op" id="8455899">!=</span>&nbsp;<span class="ident" id="8455902">nil</span>&nbsp;<span class="op" id="8455906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455910">t</span><span class="op" id="8455911">.</span><span class="ident" id="8455912">Fatal</span><span class="op" id="8455917">(</span><span class="ident" id="8455918">err</span><span class="op" id="8455921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455928">//&nbsp;test&nbsp;packages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455946">for</span>&nbsp;<span class="ident" id="8455950">_</span><span class="op" id="8455951">,</span>&nbsp;<span class="ident" id="8455953">pkg</span>&nbsp;<span class="op" id="8455957">:=</span>&nbsp;<span class="keyword" id="8455960">range</span>&nbsp;<span class="ident" id="8455966">pkgs</span>&nbsp;<span class="op" id="8455971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455975">importpath</span>&nbsp;<span class="op" id="8455986">:=</span>&nbsp;<span class="ident" id="8455989">dataDir</span>&nbsp;<span class="op" id="8455997">+</span>&nbsp;<span class="string" id="8455999">&#34;/&#34;</span>&nbsp;<span class="op" id="8456003">+</span>&nbsp;<span class="ident" id="8456005">pkg</span><span class="op" id="8456008">.</span><span class="ident" id="8456009">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456016">doc</span>&nbsp;<span class="op" id="8456020">:=</span>&nbsp;<span class="ident" id="8456023">New</span><span class="op" id="8456026">(</span><span class="ident" id="8456027">pkg</span><span class="op" id="8456030">,</span>&nbsp;<span class="ident" id="8456032">importpath</span><span class="op" id="8456042">,</span>&nbsp;<span class="ident" id="8456044">mode</span><span class="op" id="8456048">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8456053">//&nbsp;golden&nbsp;files&nbsp;always&nbsp;use&nbsp;/&nbsp;in&nbsp;filenames&nbsp;-&nbsp;canonicalize&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456117">for</span>&nbsp;<span class="ident" id="8456121">i</span><span class="op" id="8456122">,</span>&nbsp;<span class="ident" id="8456124">filename</span>&nbsp;<span class="op" id="8456133">:=</span>&nbsp;<span class="keyword" id="8456136">range</span>&nbsp;<span class="ident" id="8456142">doc</span><span class="op" id="8456145">.</span><span class="ident" id="8456146">Filenames</span>&nbsp;<span class="op" id="8456156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456161">doc</span><span class="op" id="8456164">.</span><span class="ident" id="8456165">Filenames</span><span class="op" id="8456174">[</span><span class="ident" id="8456175">i</span><span class="op" id="8456176">]</span>&nbsp;<span class="op" id="8456178">=</span>&nbsp;<span class="ident" id="8456180">filepath</span><span class="op" id="8456188">.</span><span class="ident" id="8456189">ToSlash</span><span class="op" id="8456196">(</span><span class="ident" id="8456197">filename</span><span class="op" id="8456205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8456214">//&nbsp;print&nbsp;documentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456239">var</span>&nbsp;<span class="ident" id="8456243">buf</span>&nbsp;<span class="ident" id="8456247">bytes</span><span class="op" id="8456252">.</span><span class="ident" id="8456253">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456262">if</span>&nbsp;<span class="ident" id="8456265">err</span>&nbsp;<span class="op" id="8456269">:=</span>&nbsp;<span class="ident" id="8456272">templateTxt</span><span class="op" id="8456283">.</span><span class="ident" id="8456284">Execute</span><span class="op" id="8456291">(</span><span class="op" id="8456292">&amp;</span><span class="ident" id="8456293">buf</span><span class="op" id="8456296">,</span>&nbsp;<span class="ident" id="8456298">bundle</span><span class="op" id="8456304">{</span><span class="ident" id="8456305">doc</span><span class="op" id="8456308">,</span>&nbsp;<span class="ident" id="8456310">fset</span><span class="op" id="8456314">}</span><span class="op" id="8456315">)</span><span class="op" id="8456316">;</span>&nbsp;<span class="ident" id="8456318">err</span>&nbsp;<span class="op" id="8456322">!=</span>&nbsp;<span class="ident" id="8456325">nil</span>&nbsp;<span class="op" id="8456329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456334">t</span><span class="op" id="8456335">.</span><span class="ident" id="8456336">Error</span><span class="op" id="8456341">(</span><span class="ident" id="8456342">err</span><span class="op" id="8456345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456350">continue</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456365">got</span>&nbsp;<span class="op" id="8456369">:=</span>&nbsp;<span class="ident" id="8456372">buf</span><span class="op" id="8456375">.</span><span class="ident" id="8456376">Bytes</span><span class="op" id="8456381">(</span><span class="op" id="8456382">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8456387">//&nbsp;update&nbsp;golden&nbsp;file&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456424">golden</span>&nbsp;<span class="op" id="8456431">:=</span>&nbsp;<span class="ident" id="8456434">filepath</span><span class="op" id="8456442">.</span><span class="ident" id="8456443">Join</span><span class="op" id="8456447">(</span><span class="ident" id="8456448">dataDir</span><span class="op" id="8456455">,</span>&nbsp;<span class="ident" id="8456457">fmt</span><span class="op" id="8456460">.</span><span class="ident" id="8456461">Sprintf</span><span class="op" id="8456468">(</span><span class="string" id="8456469">&#34;%s.%d.golden&#34;</span><span class="op" id="8456483">,</span>&nbsp;<span class="ident" id="8456485">pkg</span><span class="op" id="8456488">.</span><span class="ident" id="8456489">Name</span><span class="op" id="8456493">,</span>&nbsp;<span class="ident" id="8456495">mode</span><span class="op" id="8456499">)</span><span class="op" id="8456500">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456504">if</span>&nbsp;<span class="op" id="8456507">*</span><span class="ident" id="8456508">update</span>&nbsp;<span class="op" id="8456515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456520">err</span>&nbsp;<span class="op" id="8456524">:=</span>&nbsp;<span class="ident" id="8456527">ioutil</span><span class="op" id="8456533">.</span><span class="ident" id="8456534">WriteFile</span><span class="op" id="8456543">(</span><span class="ident" id="8456544">golden</span><span class="op" id="8456550">,</span>&nbsp;<span class="ident" id="8456552">got</span><span class="op" id="8456555">,</span>&nbsp;<span class="num" id="8456557">0644</span><span class="op" id="8456561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456566">if</span>&nbsp;<span class="ident" id="8456569">err</span>&nbsp;<span class="op" id="8456573">!=</span>&nbsp;<span class="ident" id="8456576">nil</span>&nbsp;<span class="op" id="8456580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456586">t</span><span class="op" id="8456587">.</span><span class="ident" id="8456588">Error</span><span class="op" id="8456593">(</span><span class="ident" id="8456594">err</span><span class="op" id="8456597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456602">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456607">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8456623">//&nbsp;get&nbsp;golden&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456644">want</span><span class="op" id="8456648">,</span>&nbsp;<span class="ident" id="8456650">err</span>&nbsp;<span class="op" id="8456654">:=</span>&nbsp;<span class="ident" id="8456657">ioutil</span><span class="op" id="8456663">.</span><span class="ident" id="8456664">ReadFile</span><span class="op" id="8456672">(</span><span class="ident" id="8456673">golden</span><span class="op" id="8456679">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456683">if</span>&nbsp;<span class="ident" id="8456686">err</span>&nbsp;<span class="op" id="8456690">!=</span>&nbsp;<span class="ident" id="8456693">nil</span>&nbsp;<span class="op" id="8456697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456702">t</span><span class="op" id="8456703">.</span><span class="ident" id="8456704">Error</span><span class="op" id="8456709">(</span><span class="ident" id="8456710">err</span><span class="op" id="8456713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456718">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8456734">//&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456747">if</span>&nbsp;<span class="op" id="8456750">!</span><span class="ident" id="8456751">bytes</span><span class="op" id="8456756">.</span><span class="ident" id="8456757">Equal</span><span class="op" id="8456762">(</span><span class="ident" id="8456763">got</span><span class="op" id="8456766">,</span>&nbsp;<span class="ident" id="8456768">want</span><span class="op" id="8456772">)</span>&nbsp;<span class="op" id="8456774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456779">t</span><span class="op" id="8456780">.</span><span class="ident" id="8456781">Errorf</span><span class="op" id="8456787">(</span><span class="string" id="8456788">&#34;package&nbsp;%s\n\tgot:\n%s\n\twant:\n%s&#34;</span><span class="op" id="8456825">,</span>&nbsp;<span class="ident" id="8456827">pkg</span><span class="op" id="8456830">.</span><span class="ident" id="8456831">Name</span><span class="op" id="8456835">,</span>&nbsp;<span class="ident" id="8456837">got</span><span class="op" id="8456840">,</span>&nbsp;<span class="ident" id="8456842">want</span><span class="op" id="8456846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456853">}</span><br>
<span class="lineno">140</span><span class="op" id="8456855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8456858">func</span>&nbsp;<span class="ident" id="8456863">Test</span><span class="op" id="8456867">(</span><span class="ident" id="8456868">t</span>&nbsp;<span class="op" id="8456870">*</span><span class="ident" id="8456871">testing</span><span class="op" id="8456878">.</span><span class="ident" id="8456879">T</span><span class="op" id="8456880">)</span>&nbsp;<span class="op" id="8456882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456885">test</span><span class="op" id="8456889">(</span><span class="ident" id="8456890">t</span><span class="op" id="8456891">,</span>&nbsp;<span class="num" id="8456893">0</span><span class="op" id="8456894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456897">test</span><span class="op" id="8456901">(</span><span class="ident" id="8456902">t</span><span class="op" id="8456903">,</span>&nbsp;<span class="ident" id="8456905">AllDecls</span><span class="op" id="8456913">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456916">test</span><span class="op" id="8456920">(</span><span class="ident" id="8456921">t</span><span class="op" id="8456922">,</span>&nbsp;<span class="ident" id="8456924">AllMethods</span><span class="op" id="8456934">)</span><br>
<span class="lineno"></span><span class="op" id="8456936">}</span>
</div>
</body>
</html>
