<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html" class="current">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5545849">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5545904">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5545958">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5546009">package</span>&nbsp;<span class="ident" id="5546017">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5546023">import</span>&nbsp;<span class="op" id="5546030">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5546033">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5546048">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5546062">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5546072">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="5546078">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5546081">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="5546141">type</span>&nbsp;<span class="ident" id="5546146">Auth</span>&nbsp;<span class="keyword" id="5546151">interface</span>&nbsp;<span class="op" id="5546161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546164">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546214">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546269">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546332">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546394">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546441">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546499">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546557">Start</span><span class="op" id="5546562">(</span><span class="ident" id="5546563">server</span>&nbsp;<span class="op" id="5546570">*</span><span class="ident" id="5546571">ServerInfo</span><span class="op" id="5546581">)</span>&nbsp;<span class="op" id="5546583">(</span><span class="ident" id="5546584">proto</span>&nbsp;<span class="builtintype" id="5546590">string</span><span class="op" id="5546596">,</span>&nbsp;<span class="ident" id="5546598">toServer</span>&nbsp;<span class="op" id="5546607">[</span><span class="op" id="5546608">]</span><span class="builtintype" id="5546609">byte</span><span class="op" id="5546613">,</span>&nbsp;<span class="ident" id="5546615">err</span>&nbsp;<span class="builtintype" id="5546619">error</span><span class="op" id="5546624">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546628">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546692">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546755">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546817">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546857">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5546917">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546975">Next</span><span class="op" id="5546979">(</span><span class="ident" id="5546980">fromServer</span>&nbsp;<span class="op" id="5546991">[</span><span class="op" id="5546992">]</span><span class="builtintype" id="5546993">byte</span><span class="op" id="5546997">,</span>&nbsp;<span class="ident" id="5546999">more</span>&nbsp;<span class="builtintype" id="5547004">bool</span><span class="op" id="5547008">)</span>&nbsp;<span class="op" id="5547010">(</span><span class="ident" id="5547011">toServer</span>&nbsp;<span class="op" id="5547020">[</span><span class="op" id="5547021">]</span><span class="builtintype" id="5547022">byte</span><span class="op" id="5547026">,</span>&nbsp;<span class="ident" id="5547028">err</span>&nbsp;<span class="builtintype" id="5547032">error</span><span class="op" id="5547037">)</span><br>
<span class="lineno"></span><span class="op" id="5547039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5547042">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="5547098">type</span>&nbsp;<span class="ident" id="5547103">ServerInfo</span>&nbsp;<span class="keyword" id="5547114">struct</span>&nbsp;<span class="op" id="5547121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547124">Name</span>&nbsp;<span class="builtintype" id="5547129">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5547138">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547159">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="5547164">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5547173">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547220">Auth</span>&nbsp;<span class="op" id="5547225">[</span><span class="op" id="5547226">]</span><span class="builtintype" id="5547227">string</span>&nbsp;<span class="comment" id="5547234">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="5547274">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5547277">type</span>&nbsp;<span class="ident" id="5547282">plainAuth</span>&nbsp;<span class="keyword" id="5547292">struct</span>&nbsp;<span class="op" id="5547299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547302">identity</span><span class="op" id="5547310">,</span>&nbsp;<span class="ident" id="5547312">username</span><span class="op" id="5547320">,</span>&nbsp;<span class="ident" id="5547322">password</span>&nbsp;<span class="builtintype" id="5547331">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547339">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5547368">string</span><br>
<span class="lineno"></span><span class="op" id="5547375">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5547378">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="5547448">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="5547485">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="5547559">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="5547635">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="5547669">func</span>&nbsp;<span class="ident" id="5547674">PlainAuth</span><span class="op" id="5547683">(</span><span class="ident" id="5547684">identity</span><span class="op" id="5547692">,</span>&nbsp;<span class="ident" id="5547694">username</span><span class="op" id="5547702">,</span>&nbsp;<span class="ident" id="5547704">password</span><span class="op" id="5547712">,</span>&nbsp;<span class="ident" id="5547714">host</span>&nbsp;<span class="builtintype" id="5547719">string</span><span class="op" id="5547725">)</span>&nbsp;<span class="ident" id="5547727">Auth</span>&nbsp;<span class="op" id="5547732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547735">return</span>&nbsp;<span class="op" id="5547742">&amp;</span><span class="ident" id="5547743">plainAuth</span><span class="op" id="5547752">{</span><span class="ident" id="5547753">identity</span><span class="op" id="5547761">,</span>&nbsp;<span class="ident" id="5547763">username</span><span class="op" id="5547771">,</span>&nbsp;<span class="ident" id="5547773">password</span><span class="op" id="5547781">,</span>&nbsp;<span class="ident" id="5547783">host</span><span class="op" id="5547787">}</span><br>
<span class="lineno"></span><span class="op" id="5547789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5547792">func</span>&nbsp;<span class="op" id="5547797">(</span><span class="ident" id="5547798">a</span>&nbsp;<span class="op" id="5547800">*</span><span class="ident" id="5547801">plainAuth</span><span class="op" id="5547810">)</span>&nbsp;<span class="ident" id="5547812">Start</span><span class="op" id="5547817">(</span><span class="ident" id="5547818">server</span>&nbsp;<span class="op" id="5547825">*</span><span class="ident" id="5547826">ServerInfo</span><span class="op" id="5547836">)</span>&nbsp;<span class="op" id="5547838">(</span><span class="builtintype" id="5547839">string</span><span class="op" id="5547845">,</span>&nbsp;<span class="op" id="5547847">[</span><span class="op" id="5547848">]</span><span class="builtintype" id="5547849">byte</span><span class="op" id="5547853">,</span>&nbsp;<span class="builtintype" id="5547855">error</span><span class="op" id="5547860">)</span>&nbsp;<span class="op" id="5547862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547865">if</span>&nbsp;<span class="op" id="5547868">!</span><span class="ident" id="5547869">server</span><span class="op" id="5547875">.</span><span class="ident" id="5547876">TLS</span>&nbsp;<span class="op" id="5547880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547884">advertised</span>&nbsp;<span class="op" id="5547895">:=</span>&nbsp;<span class="builtintype" id="5547898">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547906">for</span>&nbsp;<span class="ident" id="5547910">_</span><span class="op" id="5547911">,</span>&nbsp;<span class="ident" id="5547913">mechanism</span>&nbsp;<span class="op" id="5547923">:=</span>&nbsp;<span class="keyword" id="5547926">range</span>&nbsp;<span class="ident" id="5547932">server</span><span class="op" id="5547938">.</span><span class="ident" id="5547939">Auth</span>&nbsp;<span class="op" id="5547944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547949">if</span>&nbsp;<span class="ident" id="5547952">mechanism</span>&nbsp;<span class="op" id="5547962">==</span>&nbsp;<span class="string" id="5547965">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="5547973">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547979">advertised</span>&nbsp;<span class="op" id="5547990">=</span>&nbsp;<span class="builtintype" id="5547992">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548001">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548018">if</span>&nbsp;<span class="op" id="5548021">!</span><span class="ident" id="5548022">advertised</span>&nbsp;<span class="op" id="5548033">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548038">return</span>&nbsp;<span class="string" id="5548045">&#34;&#34;</span><span class="op" id="5548047">,</span>&nbsp;<span class="ident" id="5548049">nil</span><span class="op" id="5548052">,</span>&nbsp;<span class="ident" id="5548054">errors</span><span class="op" id="5548060">.</span><span class="ident" id="5548061">New</span><span class="op" id="5548064">(</span><span class="string" id="5548065">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="5548089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548099">if</span>&nbsp;<span class="ident" id="5548102">server</span><span class="op" id="5548108">.</span><span class="ident" id="5548109">Name</span>&nbsp;<span class="op" id="5548114">!=</span>&nbsp;<span class="ident" id="5548117">a</span><span class="op" id="5548118">.</span><span class="ident" id="5548119">host</span>&nbsp;<span class="op" id="5548124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548128">return</span>&nbsp;<span class="string" id="5548135">&#34;&#34;</span><span class="op" id="5548137">,</span>&nbsp;<span class="ident" id="5548139">nil</span><span class="op" id="5548142">,</span>&nbsp;<span class="ident" id="5548144">errors</span><span class="op" id="5548150">.</span><span class="ident" id="5548151">New</span><span class="op" id="5548154">(</span><span class="string" id="5548155">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="5548172">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548178">resp</span>&nbsp;<span class="op" id="5548183">:=</span>&nbsp;<span class="op" id="5548186">[</span><span class="op" id="5548187">]</span><span class="builtintype" id="5548188">byte</span><span class="op" id="5548192">(</span><span class="ident" id="5548193">a</span><span class="op" id="5548194">.</span><span class="ident" id="5548195">identity</span>&nbsp;<span class="op" id="5548204">+</span>&nbsp;<span class="string" id="5548206">&#34;\x00&#34;</span>&nbsp;<span class="op" id="5548213">+</span>&nbsp;<span class="ident" id="5548215">a</span><span class="op" id="5548216">.</span><span class="ident" id="5548217">username</span>&nbsp;<span class="op" id="5548226">+</span>&nbsp;<span class="string" id="5548228">&#34;\x00&#34;</span>&nbsp;<span class="op" id="5548235">+</span>&nbsp;<span class="ident" id="5548237">a</span><span class="op" id="5548238">.</span><span class="ident" id="5548239">password</span><span class="op" id="5548247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548250">return</span>&nbsp;<span class="string" id="5548257">&#34;PLAIN&#34;</span><span class="op" id="5548264">,</span>&nbsp;<span class="ident" id="5548266">resp</span><span class="op" id="5548270">,</span>&nbsp;<span class="ident" id="5548272">nil</span><br>
<span class="lineno"></span><span class="op" id="5548276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5548279">func</span>&nbsp;<span class="op" id="5548284">(</span><span class="ident" id="5548285">a</span>&nbsp;<span class="op" id="5548287">*</span><span class="ident" id="5548288">plainAuth</span><span class="op" id="5548297">)</span>&nbsp;<span class="ident" id="5548299">Next</span><span class="op" id="5548303">(</span><span class="ident" id="5548304">fromServer</span>&nbsp;<span class="op" id="5548315">[</span><span class="op" id="5548316">]</span><span class="builtintype" id="5548317">byte</span><span class="op" id="5548321">,</span>&nbsp;<span class="ident" id="5548323">more</span>&nbsp;<span class="builtintype" id="5548328">bool</span><span class="op" id="5548332">)</span>&nbsp;<span class="op" id="5548334">(</span><span class="op" id="5548335">[</span><span class="op" id="5548336">]</span><span class="builtintype" id="5548337">byte</span><span class="op" id="5548341">,</span>&nbsp;<span class="builtintype" id="5548343">error</span><span class="op" id="5548348">)</span>&nbsp;<span class="op" id="5548350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548353">if</span>&nbsp;<span class="ident" id="5548356">more</span>&nbsp;<span class="op" id="5548361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548365">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548401">return</span>&nbsp;<span class="ident" id="5548408">nil</span><span class="op" id="5548411">,</span>&nbsp;<span class="ident" id="5548413">errors</span><span class="op" id="5548419">.</span><span class="ident" id="5548420">New</span><span class="op" id="5548423">(</span><span class="string" id="5548424">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="5548453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548456">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548459">return</span>&nbsp;<span class="ident" id="5548466">nil</span><span class="op" id="5548469">,</span>&nbsp;<span class="ident" id="5548471">nil</span><br>
<span class="lineno"></span><span class="op" id="5548475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5548478">type</span>&nbsp;<span class="ident" id="5548483">cramMD5Auth</span>&nbsp;<span class="keyword" id="5548495">struct</span>&nbsp;<span class="op" id="5548502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548505">username</span><span class="op" id="5548513">,</span>&nbsp;<span class="ident" id="5548515">secret</span>&nbsp;<span class="builtintype" id="5548522">string</span><br>
<span class="lineno">85</span><span class="op" id="5548529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5548532">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="5548607">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="5548644">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="5548716">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="5548773">func</span>&nbsp;<span class="ident" id="5548778">CRAMMD5Auth</span><span class="op" id="5548789">(</span><span class="ident" id="5548790">username</span><span class="op" id="5548798">,</span>&nbsp;<span class="ident" id="5548800">secret</span>&nbsp;<span class="builtintype" id="5548807">string</span><span class="op" id="5548813">)</span>&nbsp;<span class="ident" id="5548815">Auth</span>&nbsp;<span class="op" id="5548820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548823">return</span>&nbsp;<span class="op" id="5548830">&amp;</span><span class="ident" id="5548831">cramMD5Auth</span><span class="op" id="5548842">{</span><span class="ident" id="5548843">username</span><span class="op" id="5548851">,</span>&nbsp;<span class="ident" id="5548853">secret</span><span class="op" id="5548859">}</span><br>
<span class="lineno"></span><span class="op" id="5548861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5548864">func</span>&nbsp;<span class="op" id="5548869">(</span><span class="ident" id="5548870">a</span>&nbsp;<span class="op" id="5548872">*</span><span class="ident" id="5548873">cramMD5Auth</span><span class="op" id="5548884">)</span>&nbsp;<span class="ident" id="5548886">Start</span><span class="op" id="5548891">(</span><span class="ident" id="5548892">server</span>&nbsp;<span class="op" id="5548899">*</span><span class="ident" id="5548900">ServerInfo</span><span class="op" id="5548910">)</span>&nbsp;<span class="op" id="5548912">(</span><span class="builtintype" id="5548913">string</span><span class="op" id="5548919">,</span>&nbsp;<span class="op" id="5548921">[</span><span class="op" id="5548922">]</span><span class="builtintype" id="5548923">byte</span><span class="op" id="5548927">,</span>&nbsp;<span class="builtintype" id="5548929">error</span><span class="op" id="5548934">)</span>&nbsp;<span class="op" id="5548936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548939">return</span>&nbsp;<span class="string" id="5548946">&#34;CRAM-MD5&#34;</span><span class="op" id="5548956">,</span>&nbsp;<span class="ident" id="5548958">nil</span><span class="op" id="5548961">,</span>&nbsp;<span class="ident" id="5548963">nil</span><br>
<span class="lineno"></span><span class="op" id="5548967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5548970">func</span>&nbsp;<span class="op" id="5548975">(</span><span class="ident" id="5548976">a</span>&nbsp;<span class="op" id="5548978">*</span><span class="ident" id="5548979">cramMD5Auth</span><span class="op" id="5548990">)</span>&nbsp;<span class="ident" id="5548992">Next</span><span class="op" id="5548996">(</span><span class="ident" id="5548997">fromServer</span>&nbsp;<span class="op" id="5549008">[</span><span class="op" id="5549009">]</span><span class="builtintype" id="5549010">byte</span><span class="op" id="5549014">,</span>&nbsp;<span class="ident" id="5549016">more</span>&nbsp;<span class="builtintype" id="5549021">bool</span><span class="op" id="5549025">)</span>&nbsp;<span class="op" id="5549027">(</span><span class="op" id="5549028">[</span><span class="op" id="5549029">]</span><span class="builtintype" id="5549030">byte</span><span class="op" id="5549034">,</span>&nbsp;<span class="builtintype" id="5549036">error</span><span class="op" id="5549041">)</span>&nbsp;<span class="op" id="5549043">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549046">if</span>&nbsp;<span class="ident" id="5549049">more</span>&nbsp;<span class="op" id="5549054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549058">d</span>&nbsp;<span class="op" id="5549060">:=</span>&nbsp;<span class="ident" id="5549063">hmac</span><span class="op" id="5549067">.</span><span class="ident" id="5549068">New</span><span class="op" id="5549071">(</span><span class="ident" id="5549072">md5</span><span class="op" id="5549075">.</span><span class="ident" id="5549076">New</span><span class="op" id="5549079">,</span>&nbsp;<span class="op" id="5549081">[</span><span class="op" id="5549082">]</span><span class="builtintype" id="5549083">byte</span><span class="op" id="5549087">(</span><span class="ident" id="5549088">a</span><span class="op" id="5549089">.</span><span class="ident" id="5549090">secret</span><span class="op" id="5549096">)</span><span class="op" id="5549097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549101">d</span><span class="op" id="5549102">.</span><span class="ident" id="5549103">Write</span><span class="op" id="5549108">(</span><span class="ident" id="5549109">fromServer</span><span class="op" id="5549119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549123">s</span>&nbsp;<span class="op" id="5549125">:=</span>&nbsp;<span class="builtinfunc" id="5549128">make</span><span class="op" id="5549132">(</span><span class="op" id="5549133">[</span><span class="op" id="5549134">]</span><span class="builtintype" id="5549135">byte</span><span class="op" id="5549139">,</span>&nbsp;<span class="num" id="5549141">0</span><span class="op" id="5549142">,</span>&nbsp;<span class="ident" id="5549144">d</span><span class="op" id="5549145">.</span><span class="ident" id="5549146">Size</span><span class="op" id="5549150">(</span><span class="op" id="5549151">)</span><span class="op" id="5549152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549156">return</span>&nbsp;<span class="op" id="5549163">[</span><span class="op" id="5549164">]</span><span class="builtintype" id="5549165">byte</span><span class="op" id="5549169">(</span><span class="ident" id="5549170">fmt</span><span class="op" id="5549173">.</span><span class="ident" id="5549174">Sprintf</span><span class="op" id="5549181">(</span><span class="string" id="5549182">&#34;%s&nbsp;%x&#34;</span><span class="op" id="5549189">,</span>&nbsp;<span class="ident" id="5549191">a</span><span class="op" id="5549192">.</span><span class="ident" id="5549193">username</span><span class="op" id="5549201">,</span>&nbsp;<span class="ident" id="5549203">d</span><span class="op" id="5549204">.</span><span class="ident" id="5549205">Sum</span><span class="op" id="5549208">(</span><span class="ident" id="5549209">s</span><span class="op" id="5549210">)</span><span class="op" id="5549211">)</span><span class="op" id="5549212">)</span><span class="op" id="5549213">,</span>&nbsp;<span class="ident" id="5549215">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549223">return</span>&nbsp;<span class="ident" id="5549230">nil</span><span class="op" id="5549233">,</span>&nbsp;<span class="ident" id="5549235">nil</span><br>
<span class="lineno"></span><span class="op" id="5549239">}</span>
</div>
</body>
</html>
