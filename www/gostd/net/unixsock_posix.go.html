<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3279472">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3279528">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3279582">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3279633">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3279711">package</span>&nbsp;<span class="ident" id="3279719">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3279724">import</span>&nbsp;<span class="op" id="3279731">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3279734">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3279744">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3279750">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3279761">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3279768">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3279771">func</span>&nbsp;<span class="ident" id="3279776">unixSocket</span><span class="op" id="3279786">(</span><span class="ident" id="3279787">net</span>&nbsp;<span class="builtintype" id="3279791">string</span><span class="op" id="3279797">,</span>&nbsp;<span class="ident" id="3279799">laddr</span><span class="op" id="3279804">,</span>&nbsp;<span class="ident" id="3279806">raddr</span>&nbsp;<span class="ident" id="3279812">sockaddr</span><span class="op" id="3279820">,</span>&nbsp;<span class="ident" id="3279822">mode</span>&nbsp;<span class="builtintype" id="3279827">string</span><span class="op" id="3279833">,</span>&nbsp;<span class="ident" id="3279835">deadline</span>&nbsp;<span class="ident" id="3279844">time</span><span class="op" id="3279848">.</span><span class="ident" id="3279849">Time</span><span class="op" id="3279853">)</span>&nbsp;<span class="op" id="3279855">(</span><span class="op" id="3279856">*</span><span class="ident" id="3279857">netFD</span><span class="op" id="3279862">,</span>&nbsp;<span class="builtintype" id="3279864">error</span><span class="op" id="3279869">)</span>&nbsp;<span class="op" id="3279871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279874">var</span>&nbsp;<span class="ident" id="3279878">sotype</span>&nbsp;<span class="builtintype" id="3279885">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279890">switch</span>&nbsp;<span class="ident" id="3279897">net</span>&nbsp;<span class="op" id="3279901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279904">case</span>&nbsp;<span class="string" id="3279909">&#34;unix&#34;</span><span class="op" id="3279915">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3279919">sotype</span>&nbsp;<span class="op" id="3279926">=</span>&nbsp;<span class="ident" id="3279928">syscall</span><span class="op" id="3279935">.</span><span class="ident" id="3279936">SOCK_STREAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279949">case</span>&nbsp;<span class="string" id="3279954">&#34;unixgram&#34;</span><span class="op" id="3279964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3279968">sotype</span>&nbsp;<span class="op" id="3279975">=</span>&nbsp;<span class="ident" id="3279977">syscall</span><span class="op" id="3279984">.</span><span class="ident" id="3279985">SOCK_DGRAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279997">case</span>&nbsp;<span class="string" id="3280002">&#34;unixpacket&#34;</span><span class="op" id="3280014">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280018">sotype</span>&nbsp;<span class="op" id="3280025">=</span>&nbsp;<span class="ident" id="3280027">syscall</span><span class="op" id="3280034">.</span><span class="ident" id="3280035">SOCK_SEQPACKET</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280051">default</span><span class="op" id="3280058">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280062">return</span>&nbsp;<span class="ident" id="3280069">nil</span><span class="op" id="3280072">,</span>&nbsp;<span class="ident" id="3280074">UnknownNetworkError</span><span class="op" id="3280093">(</span><span class="ident" id="3280094">net</span><span class="op" id="3280097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280104">switch</span>&nbsp;<span class="ident" id="3280111">mode</span>&nbsp;<span class="op" id="3280116">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280119">case</span>&nbsp;<span class="string" id="3280124">&#34;dial&#34;</span><span class="op" id="3280130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280134">if</span>&nbsp;<span class="ident" id="3280137">laddr</span>&nbsp;<span class="op" id="3280143">!=</span>&nbsp;<span class="ident" id="3280146">nil</span>&nbsp;<span class="op" id="3280150">&amp;&amp;</span>&nbsp;<span class="ident" id="3280153">laddr</span><span class="op" id="3280158">.</span><span class="ident" id="3280159">isWildcard</span><span class="op" id="3280169">(</span><span class="op" id="3280170">)</span>&nbsp;<span class="op" id="3280172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280177">laddr</span>&nbsp;<span class="op" id="3280183">=</span>&nbsp;<span class="ident" id="3280185">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280195">if</span>&nbsp;<span class="ident" id="3280198">raddr</span>&nbsp;<span class="op" id="3280204">!=</span>&nbsp;<span class="ident" id="3280207">nil</span>&nbsp;<span class="op" id="3280211">&amp;&amp;</span>&nbsp;<span class="ident" id="3280214">raddr</span><span class="op" id="3280219">.</span><span class="ident" id="3280220">isWildcard</span><span class="op" id="3280230">(</span><span class="op" id="3280231">)</span>&nbsp;<span class="op" id="3280233">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280238">raddr</span>&nbsp;<span class="op" id="3280244">=</span>&nbsp;<span class="ident" id="3280246">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280256">if</span>&nbsp;<span class="ident" id="3280259">raddr</span>&nbsp;<span class="op" id="3280265">==</span>&nbsp;<span class="ident" id="3280268">nil</span>&nbsp;<span class="op" id="3280272">&amp;&amp;</span>&nbsp;<span class="op" id="3280275">(</span><span class="ident" id="3280276">sotype</span>&nbsp;<span class="op" id="3280283">!=</span>&nbsp;<span class="ident" id="3280286">syscall</span><span class="op" id="3280293">.</span><span class="ident" id="3280294">SOCK_DGRAM</span>&nbsp;<span class="op" id="3280305">||</span>&nbsp;<span class="ident" id="3280308">laddr</span>&nbsp;<span class="op" id="3280314">==</span>&nbsp;<span class="ident" id="3280317">nil</span><span class="op" id="3280320">)</span>&nbsp;<span class="op" id="3280322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280327">return</span>&nbsp;<span class="ident" id="3280334">nil</span><span class="op" id="3280337">,</span>&nbsp;<span class="ident" id="3280339">errMissingAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280359">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280362">case</span>&nbsp;<span class="string" id="3280367">&#34;listen&#34;</span><span class="op" id="3280375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280378">default</span><span class="op" id="3280385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280389">return</span>&nbsp;<span class="ident" id="3280396">nil</span><span class="op" id="3280399">,</span>&nbsp;<span class="ident" id="3280401">errors</span><span class="op" id="3280407">.</span><span class="ident" id="3280408">New</span><span class="op" id="3280411">(</span><span class="string" id="3280412">&#34;unknown&nbsp;mode:&nbsp;&#34;</span>&nbsp;<span class="op" id="3280429">+</span>&nbsp;<span class="ident" id="3280431">mode</span><span class="op" id="3280435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280442">fd</span><span class="op" id="3280444">,</span>&nbsp;<span class="ident" id="3280446">err</span>&nbsp;<span class="op" id="3280450">:=</span>&nbsp;<span class="ident" id="3280453">socket</span><span class="op" id="3280459">(</span><span class="ident" id="3280460">net</span><span class="op" id="3280463">,</span>&nbsp;<span class="ident" id="3280465">syscall</span><span class="op" id="3280472">.</span><span class="ident" id="3280473">AF_UNIX</span><span class="op" id="3280480">,</span>&nbsp;<span class="ident" id="3280482">sotype</span><span class="op" id="3280488">,</span>&nbsp;<span class="num" id="3280490">0</span><span class="op" id="3280491">,</span>&nbsp;<span class="builtintype" id="3280493">false</span><span class="op" id="3280498">,</span>&nbsp;<span class="ident" id="3280500">laddr</span><span class="op" id="3280505">,</span>&nbsp;<span class="ident" id="3280507">raddr</span><span class="op" id="3280512">,</span>&nbsp;<span class="ident" id="3280514">deadline</span><span class="op" id="3280522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280525">if</span>&nbsp;<span class="ident" id="3280528">err</span>&nbsp;<span class="op" id="3280532">!=</span>&nbsp;<span class="ident" id="3280535">nil</span>&nbsp;<span class="op" id="3280539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280543">return</span>&nbsp;<span class="ident" id="3280550">nil</span><span class="op" id="3280553">,</span>&nbsp;<span class="ident" id="3280555">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280563">return</span>&nbsp;<span class="ident" id="3280570">fd</span><span class="op" id="3280572">,</span>&nbsp;<span class="ident" id="3280574">nil</span><br>
<span class="lineno">50</span><span class="op" id="3280578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3280581">func</span>&nbsp;<span class="ident" id="3280586">sockaddrToUnix</span><span class="op" id="3280600">(</span><span class="ident" id="3280601">sa</span>&nbsp;<span class="ident" id="3280604">syscall</span><span class="op" id="3280611">.</span><span class="ident" id="3280612">Sockaddr</span><span class="op" id="3280620">)</span>&nbsp;<span class="ident" id="3280622">Addr</span>&nbsp;<span class="op" id="3280627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280630">if</span>&nbsp;<span class="ident" id="3280633">s</span><span class="op" id="3280634">,</span>&nbsp;<span class="ident" id="3280636">ok</span>&nbsp;<span class="op" id="3280639">:=</span>&nbsp;<span class="ident" id="3280642">sa</span><span class="op" id="3280644">.</span><span class="op" id="3280645">(</span><span class="op" id="3280646">*</span><span class="ident" id="3280647">syscall</span><span class="op" id="3280654">.</span><span class="ident" id="3280655">SockaddrUnix</span><span class="op" id="3280667">)</span><span class="op" id="3280668">;</span>&nbsp;<span class="ident" id="3280670">ok</span>&nbsp;<span class="op" id="3280673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280677">return</span>&nbsp;<span class="op" id="3280684">&amp;</span><span class="ident" id="3280685">UnixAddr</span><span class="op" id="3280693">{</span><span class="ident" id="3280694">Name</span><span class="op" id="3280698">:</span>&nbsp;<span class="ident" id="3280700">s</span><span class="op" id="3280701">.</span><span class="ident" id="3280702">Name</span><span class="op" id="3280706">,</span>&nbsp;<span class="ident" id="3280708">Net</span><span class="op" id="3280711">:</span>&nbsp;<span class="string" id="3280713">&#34;unix&#34;</span><span class="op" id="3280719">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280725">return</span>&nbsp;<span class="ident" id="3280732">nil</span><br>
<span class="lineno"></span><span class="op" id="3280736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3280739">func</span>&nbsp;<span class="ident" id="3280744">sockaddrToUnixgram</span><span class="op" id="3280762">(</span><span class="ident" id="3280763">sa</span>&nbsp;<span class="ident" id="3280766">syscall</span><span class="op" id="3280773">.</span><span class="ident" id="3280774">Sockaddr</span><span class="op" id="3280782">)</span>&nbsp;<span class="ident" id="3280784">Addr</span>&nbsp;<span class="op" id="3280789">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280792">if</span>&nbsp;<span class="ident" id="3280795">s</span><span class="op" id="3280796">,</span>&nbsp;<span class="ident" id="3280798">ok</span>&nbsp;<span class="op" id="3280801">:=</span>&nbsp;<span class="ident" id="3280804">sa</span><span class="op" id="3280806">.</span><span class="op" id="3280807">(</span><span class="op" id="3280808">*</span><span class="ident" id="3280809">syscall</span><span class="op" id="3280816">.</span><span class="ident" id="3280817">SockaddrUnix</span><span class="op" id="3280829">)</span><span class="op" id="3280830">;</span>&nbsp;<span class="ident" id="3280832">ok</span>&nbsp;<span class="op" id="3280835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280839">return</span>&nbsp;<span class="op" id="3280846">&amp;</span><span class="ident" id="3280847">UnixAddr</span><span class="op" id="3280855">{</span><span class="ident" id="3280856">Name</span><span class="op" id="3280860">:</span>&nbsp;<span class="ident" id="3280862">s</span><span class="op" id="3280863">.</span><span class="ident" id="3280864">Name</span><span class="op" id="3280868">,</span>&nbsp;<span class="ident" id="3280870">Net</span><span class="op" id="3280873">:</span>&nbsp;<span class="string" id="3280875">&#34;unixgram&#34;</span><span class="op" id="3280885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280891">return</span>&nbsp;<span class="ident" id="3280898">nil</span><br>
<span class="lineno"></span><span class="op" id="3280902">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3280905">func</span>&nbsp;<span class="ident" id="3280910">sockaddrToUnixpacket</span><span class="op" id="3280930">(</span><span class="ident" id="3280931">sa</span>&nbsp;<span class="ident" id="3280934">syscall</span><span class="op" id="3280941">.</span><span class="ident" id="3280942">Sockaddr</span><span class="op" id="3280950">)</span>&nbsp;<span class="ident" id="3280952">Addr</span>&nbsp;<span class="op" id="3280957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280960">if</span>&nbsp;<span class="ident" id="3280963">s</span><span class="op" id="3280964">,</span>&nbsp;<span class="ident" id="3280966">ok</span>&nbsp;<span class="op" id="3280969">:=</span>&nbsp;<span class="ident" id="3280972">sa</span><span class="op" id="3280974">.</span><span class="op" id="3280975">(</span><span class="op" id="3280976">*</span><span class="ident" id="3280977">syscall</span><span class="op" id="3280984">.</span><span class="ident" id="3280985">SockaddrUnix</span><span class="op" id="3280997">)</span><span class="op" id="3280998">;</span>&nbsp;<span class="ident" id="3281000">ok</span>&nbsp;<span class="op" id="3281003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281007">return</span>&nbsp;<span class="op" id="3281014">&amp;</span><span class="ident" id="3281015">UnixAddr</span><span class="op" id="3281023">{</span><span class="ident" id="3281024">Name</span><span class="op" id="3281028">:</span>&nbsp;<span class="ident" id="3281030">s</span><span class="op" id="3281031">.</span><span class="ident" id="3281032">Name</span><span class="op" id="3281036">,</span>&nbsp;<span class="ident" id="3281038">Net</span><span class="op" id="3281041">:</span>&nbsp;<span class="string" id="3281043">&#34;unixpacket&#34;</span><span class="op" id="3281055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281058">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281061">return</span>&nbsp;<span class="ident" id="3281068">nil</span><br>
<span class="lineno"></span><span class="op" id="3281072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3281075">func</span>&nbsp;<span class="ident" id="3281080">sotypeToNet</span><span class="op" id="3281091">(</span><span class="ident" id="3281092">sotype</span>&nbsp;<span class="builtintype" id="3281099">int</span><span class="op" id="3281102">)</span>&nbsp;<span class="builtintype" id="3281104">string</span>&nbsp;<span class="op" id="3281111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281114">switch</span>&nbsp;<span class="ident" id="3281121">sotype</span>&nbsp;<span class="op" id="3281128">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281131">case</span>&nbsp;<span class="ident" id="3281136">syscall</span><span class="op" id="3281143">.</span><span class="ident" id="3281144">SOCK_STREAM</span><span class="op" id="3281155">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281159">return</span>&nbsp;<span class="string" id="3281166">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281174">case</span>&nbsp;<span class="ident" id="3281179">syscall</span><span class="op" id="3281186">.</span><span class="ident" id="3281187">SOCK_DGRAM</span><span class="op" id="3281197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281201">return</span>&nbsp;<span class="string" id="3281208">&#34;unixgram&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281220">case</span>&nbsp;<span class="ident" id="3281225">syscall</span><span class="op" id="3281232">.</span><span class="ident" id="3281233">SOCK_SEQPACKET</span><span class="op" id="3281247">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281251">return</span>&nbsp;<span class="string" id="3281258">&#34;unixpacket&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281272">default</span><span class="op" id="3281279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3281283">panic</span><span class="op" id="3281288">(</span><span class="string" id="3281289">&#34;sotypeToNet&nbsp;unknown&nbsp;socket&nbsp;type&#34;</span><span class="op" id="3281322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281325">}</span><br>
<span class="lineno"></span><span class="op" id="3281327">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3281330">func</span>&nbsp;<span class="op" id="3281335">(</span><span class="ident" id="3281336">a</span>&nbsp;<span class="op" id="3281338">*</span><span class="ident" id="3281339">UnixAddr</span><span class="op" id="3281347">)</span>&nbsp;<span class="ident" id="3281349">family</span><span class="op" id="3281355">(</span><span class="op" id="3281356">)</span>&nbsp;<span class="builtintype" id="3281358">int</span>&nbsp;<span class="op" id="3281362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281365">return</span>&nbsp;<span class="ident" id="3281372">syscall</span><span class="op" id="3281379">.</span><span class="ident" id="3281380">AF_UNIX</span><br>
<span class="lineno"></span><span class="op" id="3281388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3281391">func</span>&nbsp;<span class="op" id="3281396">(</span><span class="ident" id="3281397">a</span>&nbsp;<span class="op" id="3281399">*</span><span class="ident" id="3281400">UnixAddr</span><span class="op" id="3281408">)</span>&nbsp;<span class="ident" id="3281410">isWildcard</span><span class="op" id="3281420">(</span><span class="op" id="3281421">)</span>&nbsp;<span class="builtintype" id="3281423">bool</span>&nbsp;<span class="op" id="3281428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281431">return</span>&nbsp;<span class="ident" id="3281438">a</span>&nbsp;<span class="op" id="3281440">==</span>&nbsp;<span class="ident" id="3281443">nil</span>&nbsp;<span class="op" id="3281447">||</span>&nbsp;<span class="ident" id="3281450">a</span><span class="op" id="3281451">.</span><span class="ident" id="3281452">Name</span>&nbsp;<span class="op" id="3281457">==</span>&nbsp;<span class="string" id="3281460">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3281463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3281466">func</span>&nbsp;<span class="op" id="3281471">(</span><span class="ident" id="3281472">a</span>&nbsp;<span class="op" id="3281474">*</span><span class="ident" id="3281475">UnixAddr</span><span class="op" id="3281483">)</span>&nbsp;<span class="ident" id="3281485">sockaddr</span><span class="op" id="3281493">(</span><span class="ident" id="3281494">family</span>&nbsp;<span class="builtintype" id="3281501">int</span><span class="op" id="3281504">)</span>&nbsp;<span class="op" id="3281506">(</span><span class="ident" id="3281507">syscall</span><span class="op" id="3281514">.</span><span class="ident" id="3281515">Sockaddr</span><span class="op" id="3281523">,</span>&nbsp;<span class="builtintype" id="3281525">error</span><span class="op" id="3281530">)</span>&nbsp;<span class="op" id="3281532">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281535">if</span>&nbsp;<span class="ident" id="3281538">a</span>&nbsp;<span class="op" id="3281540">==</span>&nbsp;<span class="ident" id="3281543">nil</span>&nbsp;<span class="op" id="3281547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281551">return</span>&nbsp;<span class="ident" id="3281558">nil</span><span class="op" id="3281561">,</span>&nbsp;<span class="ident" id="3281563">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281571">return</span>&nbsp;<span class="op" id="3281578">&amp;</span><span class="ident" id="3281579">syscall</span><span class="op" id="3281586">.</span><span class="ident" id="3281587">SockaddrUnix</span><span class="op" id="3281599">{</span><span class="ident" id="3281600">Name</span><span class="op" id="3281604">:</span>&nbsp;<span class="ident" id="3281606">a</span><span class="op" id="3281607">.</span><span class="ident" id="3281608">Name</span><span class="op" id="3281612">}</span><span class="op" id="3281613">,</span>&nbsp;<span class="ident" id="3281615">nil</span><br>
<span class="lineno"></span><span class="op" id="3281619">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3281622">//&nbsp;UnixConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="3281693">//&nbsp;to&nbsp;Unix&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3281720">type</span>&nbsp;<span class="ident" id="3281725">UnixConn</span>&nbsp;<span class="keyword" id="3281734">struct</span>&nbsp;<span class="op" id="3281741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281744">conn</span><br>
<span class="lineno">105</span><span class="op" id="3281749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3281752">func</span>&nbsp;<span class="ident" id="3281757">newUnixConn</span><span class="op" id="3281768">(</span><span class="ident" id="3281769">fd</span>&nbsp;<span class="op" id="3281772">*</span><span class="ident" id="3281773">netFD</span><span class="op" id="3281778">)</span>&nbsp;<span class="op" id="3281780">*</span><span class="ident" id="3281781">UnixConn</span>&nbsp;<span class="op" id="3281790">{</span>&nbsp;<span class="keyword" id="3281792">return</span>&nbsp;<span class="op" id="3281799">&amp;</span><span class="ident" id="3281800">UnixConn</span><span class="op" id="3281808">{</span><span class="ident" id="3281809">conn</span><span class="op" id="3281813">{</span><span class="ident" id="3281814">fd</span><span class="op" id="3281816">}</span><span class="op" id="3281817">}</span>&nbsp;<span class="op" id="3281819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3281822">//&nbsp;ReadFromUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.&nbsp;&nbsp;It</span><br>
<span class="lineno">110</span><span class="comment" id="3281893">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3281964">//&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3281979">//</span><br>
<span class="lineno"></span><span class="comment" id="3281982">//&nbsp;ReadFromUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3282047">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="3282114">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3282134">func</span>&nbsp;<span class="op" id="3282139">(</span><span class="ident" id="3282140">c</span>&nbsp;<span class="op" id="3282142">*</span><span class="ident" id="3282143">UnixConn</span><span class="op" id="3282151">)</span>&nbsp;<span class="ident" id="3282153">ReadFromUnix</span><span class="op" id="3282165">(</span><span class="ident" id="3282166">b</span>&nbsp;<span class="op" id="3282168">[</span><span class="op" id="3282169">]</span><span class="builtintype" id="3282170">byte</span><span class="op" id="3282174">)</span>&nbsp;<span class="op" id="3282176">(</span><span class="ident" id="3282177">n</span>&nbsp;<span class="builtintype" id="3282179">int</span><span class="op" id="3282182">,</span>&nbsp;<span class="ident" id="3282184">addr</span>&nbsp;<span class="op" id="3282189">*</span><span class="ident" id="3282190">UnixAddr</span><span class="op" id="3282198">,</span>&nbsp;<span class="ident" id="3282200">err</span>&nbsp;<span class="builtintype" id="3282204">error</span><span class="op" id="3282209">)</span>&nbsp;<span class="op" id="3282211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282214">if</span>&nbsp;<span class="op" id="3282217">!</span><span class="ident" id="3282218">c</span><span class="op" id="3282219">.</span><span class="ident" id="3282220">ok</span><span class="op" id="3282222">(</span><span class="op" id="3282223">)</span>&nbsp;<span class="op" id="3282225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282229">return</span>&nbsp;<span class="num" id="3282236">0</span><span class="op" id="3282237">,</span>&nbsp;<span class="ident" id="3282239">nil</span><span class="op" id="3282242">,</span>&nbsp;<span class="ident" id="3282244">syscall</span><span class="op" id="3282251">.</span><span class="ident" id="3282252">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282260">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282263">n</span><span class="op" id="3282264">,</span>&nbsp;<span class="ident" id="3282266">sa</span><span class="op" id="3282268">,</span>&nbsp;<span class="ident" id="3282270">err</span>&nbsp;<span class="op" id="3282274">:=</span>&nbsp;<span class="ident" id="3282277">c</span><span class="op" id="3282278">.</span><span class="ident" id="3282279">fd</span><span class="op" id="3282281">.</span><span class="ident" id="3282282">readFrom</span><span class="op" id="3282290">(</span><span class="ident" id="3282291">b</span><span class="op" id="3282292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282295">switch</span>&nbsp;<span class="ident" id="3282302">sa</span>&nbsp;<span class="op" id="3282305">:=</span>&nbsp;<span class="ident" id="3282308">sa</span><span class="op" id="3282310">.</span><span class="op" id="3282311">(</span><span class="keyword" id="3282312">type</span><span class="op" id="3282316">)</span>&nbsp;<span class="op" id="3282318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282321">case</span>&nbsp;<span class="op" id="3282326">*</span><span class="ident" id="3282327">syscall</span><span class="op" id="3282334">.</span><span class="ident" id="3282335">SockaddrUnix</span><span class="op" id="3282347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282351">if</span>&nbsp;<span class="ident" id="3282354">sa</span><span class="op" id="3282356">.</span><span class="ident" id="3282357">Name</span>&nbsp;<span class="op" id="3282362">!=</span>&nbsp;<span class="string" id="3282365">&#34;&#34;</span>&nbsp;<span class="op" id="3282368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282373">addr</span>&nbsp;<span class="op" id="3282378">=</span>&nbsp;<span class="op" id="3282380">&amp;</span><span class="ident" id="3282381">UnixAddr</span><span class="op" id="3282389">{</span><span class="ident" id="3282390">Name</span><span class="op" id="3282394">:</span>&nbsp;<span class="ident" id="3282396">sa</span><span class="op" id="3282398">.</span><span class="ident" id="3282399">Name</span><span class="op" id="3282403">,</span>&nbsp;<span class="ident" id="3282405">Net</span><span class="op" id="3282408">:</span>&nbsp;<span class="ident" id="3282410">sotypeToNet</span><span class="op" id="3282421">(</span><span class="ident" id="3282422">c</span><span class="op" id="3282423">.</span><span class="ident" id="3282424">fd</span><span class="op" id="3282426">.</span><span class="ident" id="3282427">sotype</span><span class="op" id="3282433">)</span><span class="op" id="3282434">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282444">return</span><br>
<span class="lineno"></span><span class="op" id="3282451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3282454">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3282509">func</span>&nbsp;<span class="op" id="3282514">(</span><span class="ident" id="3282515">c</span>&nbsp;<span class="op" id="3282517">*</span><span class="ident" id="3282518">UnixConn</span><span class="op" id="3282526">)</span>&nbsp;<span class="ident" id="3282528">ReadFrom</span><span class="op" id="3282536">(</span><span class="ident" id="3282537">b</span>&nbsp;<span class="op" id="3282539">[</span><span class="op" id="3282540">]</span><span class="builtintype" id="3282541">byte</span><span class="op" id="3282545">)</span>&nbsp;<span class="op" id="3282547">(</span><span class="builtintype" id="3282548">int</span><span class="op" id="3282551">,</span>&nbsp;<span class="ident" id="3282553">Addr</span><span class="op" id="3282557">,</span>&nbsp;<span class="builtintype" id="3282559">error</span><span class="op" id="3282564">)</span>&nbsp;<span class="op" id="3282566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282569">if</span>&nbsp;<span class="op" id="3282572">!</span><span class="ident" id="3282573">c</span><span class="op" id="3282574">.</span><span class="ident" id="3282575">ok</span><span class="op" id="3282577">(</span><span class="op" id="3282578">)</span>&nbsp;<span class="op" id="3282580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282584">return</span>&nbsp;<span class="num" id="3282591">0</span><span class="op" id="3282592">,</span>&nbsp;<span class="ident" id="3282594">nil</span><span class="op" id="3282597">,</span>&nbsp;<span class="ident" id="3282599">syscall</span><span class="op" id="3282606">.</span><span class="ident" id="3282607">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282615">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282618">n</span><span class="op" id="3282619">,</span>&nbsp;<span class="ident" id="3282621">addr</span><span class="op" id="3282625">,</span>&nbsp;<span class="ident" id="3282627">err</span>&nbsp;<span class="op" id="3282631">:=</span>&nbsp;<span class="ident" id="3282634">c</span><span class="op" id="3282635">.</span><span class="ident" id="3282636">ReadFromUnix</span><span class="op" id="3282648">(</span><span class="ident" id="3282649">b</span><span class="op" id="3282650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282653">return</span>&nbsp;<span class="ident" id="3282660">n</span><span class="op" id="3282661">,</span>&nbsp;<span class="ident" id="3282663">addr</span><span class="op" id="3282667">.</span><span class="ident" id="3282668">toAddr</span><span class="op" id="3282674">(</span><span class="op" id="3282675">)</span><span class="op" id="3282676">,</span>&nbsp;<span class="ident" id="3282678">err</span><br>
<span class="lineno"></span><span class="op" id="3282682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3282685">//&nbsp;ReadMsgUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno">140</span><span class="comment" id="3282754">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3282825">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3282896">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet,&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3282966">func</span>&nbsp;<span class="op" id="3282971">(</span><span class="ident" id="3282972">c</span>&nbsp;<span class="op" id="3282974">*</span><span class="ident" id="3282975">UnixConn</span><span class="op" id="3282983">)</span>&nbsp;<span class="ident" id="3282985">ReadMsgUnix</span><span class="op" id="3282996">(</span><span class="ident" id="3282997">b</span><span class="op" id="3282998">,</span>&nbsp;<span class="ident" id="3283000">oob</span>&nbsp;<span class="op" id="3283004">[</span><span class="op" id="3283005">]</span><span class="builtintype" id="3283006">byte</span><span class="op" id="3283010">)</span>&nbsp;<span class="op" id="3283012">(</span><span class="ident" id="3283013">n</span><span class="op" id="3283014">,</span>&nbsp;<span class="ident" id="3283016">oobn</span><span class="op" id="3283020">,</span>&nbsp;<span class="ident" id="3283022">flags</span>&nbsp;<span class="builtintype" id="3283028">int</span><span class="op" id="3283031">,</span>&nbsp;<span class="ident" id="3283033">addr</span>&nbsp;<span class="op" id="3283038">*</span><span class="ident" id="3283039">UnixAddr</span><span class="op" id="3283047">,</span>&nbsp;<span class="ident" id="3283049">err</span>&nbsp;<span class="builtintype" id="3283053">error</span><span class="op" id="3283058">)</span>&nbsp;<span class="op" id="3283060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283063">if</span>&nbsp;<span class="op" id="3283066">!</span><span class="ident" id="3283067">c</span><span class="op" id="3283068">.</span><span class="ident" id="3283069">ok</span><span class="op" id="3283071">(</span><span class="op" id="3283072">)</span>&nbsp;<span class="op" id="3283074">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283078">return</span>&nbsp;<span class="num" id="3283085">0</span><span class="op" id="3283086">,</span>&nbsp;<span class="num" id="3283088">0</span><span class="op" id="3283089">,</span>&nbsp;<span class="num" id="3283091">0</span><span class="op" id="3283092">,</span>&nbsp;<span class="ident" id="3283094">nil</span><span class="op" id="3283097">,</span>&nbsp;<span class="ident" id="3283099">syscall</span><span class="op" id="3283106">.</span><span class="ident" id="3283107">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283118">n</span><span class="op" id="3283119">,</span>&nbsp;<span class="ident" id="3283121">oobn</span><span class="op" id="3283125">,</span>&nbsp;<span class="ident" id="3283127">flags</span><span class="op" id="3283132">,</span>&nbsp;<span class="ident" id="3283134">sa</span><span class="op" id="3283136">,</span>&nbsp;<span class="ident" id="3283138">err</span>&nbsp;<span class="op" id="3283142">:=</span>&nbsp;<span class="ident" id="3283145">c</span><span class="op" id="3283146">.</span><span class="ident" id="3283147">fd</span><span class="op" id="3283149">.</span><span class="ident" id="3283150">readMsg</span><span class="op" id="3283157">(</span><span class="ident" id="3283158">b</span><span class="op" id="3283159">,</span>&nbsp;<span class="ident" id="3283161">oob</span><span class="op" id="3283164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283167">switch</span>&nbsp;<span class="ident" id="3283174">sa</span>&nbsp;<span class="op" id="3283177">:=</span>&nbsp;<span class="ident" id="3283180">sa</span><span class="op" id="3283182">.</span><span class="op" id="3283183">(</span><span class="keyword" id="3283184">type</span><span class="op" id="3283188">)</span>&nbsp;<span class="op" id="3283190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283193">case</span>&nbsp;<span class="op" id="3283198">*</span><span class="ident" id="3283199">syscall</span><span class="op" id="3283206">.</span><span class="ident" id="3283207">SockaddrUnix</span><span class="op" id="3283219">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283223">if</span>&nbsp;<span class="ident" id="3283226">sa</span><span class="op" id="3283228">.</span><span class="ident" id="3283229">Name</span>&nbsp;<span class="op" id="3283234">!=</span>&nbsp;<span class="string" id="3283237">&#34;&#34;</span>&nbsp;<span class="op" id="3283240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283245">addr</span>&nbsp;<span class="op" id="3283250">=</span>&nbsp;<span class="op" id="3283252">&amp;</span><span class="ident" id="3283253">UnixAddr</span><span class="op" id="3283261">{</span><span class="ident" id="3283262">Name</span><span class="op" id="3283266">:</span>&nbsp;<span class="ident" id="3283268">sa</span><span class="op" id="3283270">.</span><span class="ident" id="3283271">Name</span><span class="op" id="3283275">,</span>&nbsp;<span class="ident" id="3283277">Net</span><span class="op" id="3283280">:</span>&nbsp;<span class="ident" id="3283282">sotypeToNet</span><span class="op" id="3283293">(</span><span class="ident" id="3283294">c</span><span class="op" id="3283295">.</span><span class="ident" id="3283296">fd</span><span class="op" id="3283298">.</span><span class="ident" id="3283299">sotype</span><span class="op" id="3283305">)</span><span class="op" id="3283306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283316">return</span><br>
<span class="lineno">155</span><span class="op" id="3283323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3283326">//&nbsp;WriteToUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3283400">//</span><br>
<span class="lineno"></span><span class="comment" id="3283403">//&nbsp;WriteToUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">160</span><span class="comment" id="3283467">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3283534">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3283603">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3283616">func</span>&nbsp;<span class="op" id="3283621">(</span><span class="ident" id="3283622">c</span>&nbsp;<span class="op" id="3283624">*</span><span class="ident" id="3283625">UnixConn</span><span class="op" id="3283633">)</span>&nbsp;<span class="ident" id="3283635">WriteToUnix</span><span class="op" id="3283646">(</span><span class="ident" id="3283647">b</span>&nbsp;<span class="op" id="3283649">[</span><span class="op" id="3283650">]</span><span class="builtintype" id="3283651">byte</span><span class="op" id="3283655">,</span>&nbsp;<span class="ident" id="3283657">addr</span>&nbsp;<span class="op" id="3283662">*</span><span class="ident" id="3283663">UnixAddr</span><span class="op" id="3283671">)</span>&nbsp;<span class="op" id="3283673">(</span><span class="ident" id="3283674">n</span>&nbsp;<span class="builtintype" id="3283676">int</span><span class="op" id="3283679">,</span>&nbsp;<span class="ident" id="3283681">err</span>&nbsp;<span class="builtintype" id="3283685">error</span><span class="op" id="3283690">)</span>&nbsp;<span class="op" id="3283692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283695">if</span>&nbsp;<span class="op" id="3283698">!</span><span class="ident" id="3283699">c</span><span class="op" id="3283700">.</span><span class="ident" id="3283701">ok</span><span class="op" id="3283703">(</span><span class="op" id="3283704">)</span>&nbsp;<span class="op" id="3283706">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283710">return</span>&nbsp;<span class="num" id="3283717">0</span><span class="op" id="3283718">,</span>&nbsp;<span class="ident" id="3283720">syscall</span><span class="op" id="3283727">.</span><span class="ident" id="3283728">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283739">if</span>&nbsp;<span class="ident" id="3283742">c</span><span class="op" id="3283743">.</span><span class="ident" id="3283744">fd</span><span class="op" id="3283746">.</span><span class="ident" id="3283747">isConnected</span>&nbsp;<span class="op" id="3283759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283763">return</span>&nbsp;<span class="num" id="3283770">0</span><span class="op" id="3283771">,</span>&nbsp;<span class="op" id="3283773">&amp;</span><span class="ident" id="3283774">OpError</span><span class="op" id="3283781">{</span><span class="ident" id="3283782">Op</span><span class="op" id="3283784">:</span>&nbsp;<span class="string" id="3283786">&#34;write&#34;</span><span class="op" id="3283793">,</span>&nbsp;<span class="ident" id="3283795">Net</span><span class="op" id="3283798">:</span>&nbsp;<span class="ident" id="3283800">c</span><span class="op" id="3283801">.</span><span class="ident" id="3283802">fd</span><span class="op" id="3283804">.</span><span class="ident" id="3283805">net</span><span class="op" id="3283808">,</span>&nbsp;<span class="ident" id="3283810">Addr</span><span class="op" id="3283814">:</span>&nbsp;<span class="ident" id="3283816">addr</span><span class="op" id="3283820">,</span>&nbsp;<span class="ident" id="3283822">Err</span><span class="op" id="3283825">:</span>&nbsp;<span class="ident" id="3283827">ErrWriteToConnected</span><span class="op" id="3283846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283849">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283852">if</span>&nbsp;<span class="ident" id="3283855">addr</span>&nbsp;<span class="op" id="3283860">==</span>&nbsp;<span class="ident" id="3283863">nil</span>&nbsp;<span class="op" id="3283867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283871">return</span>&nbsp;<span class="num" id="3283878">0</span><span class="op" id="3283879">,</span>&nbsp;<span class="op" id="3283881">&amp;</span><span class="ident" id="3283882">OpError</span><span class="op" id="3283889">{</span><span class="ident" id="3283890">Op</span><span class="op" id="3283892">:</span>&nbsp;<span class="string" id="3283894">&#34;write&#34;</span><span class="op" id="3283901">,</span>&nbsp;<span class="ident" id="3283903">Net</span><span class="op" id="3283906">:</span>&nbsp;<span class="ident" id="3283908">c</span><span class="op" id="3283909">.</span><span class="ident" id="3283910">fd</span><span class="op" id="3283912">.</span><span class="ident" id="3283913">net</span><span class="op" id="3283916">,</span>&nbsp;<span class="ident" id="3283918">Addr</span><span class="op" id="3283922">:</span>&nbsp;<span class="ident" id="3283924">nil</span><span class="op" id="3283927">,</span>&nbsp;<span class="ident" id="3283929">Err</span><span class="op" id="3283932">:</span>&nbsp;<span class="ident" id="3283934">errMissingAddress</span><span class="op" id="3283951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283957">if</span>&nbsp;<span class="ident" id="3283960">addr</span><span class="op" id="3283964">.</span><span class="ident" id="3283965">Net</span>&nbsp;<span class="op" id="3283969">!=</span>&nbsp;<span class="ident" id="3283972">sotypeToNet</span><span class="op" id="3283983">(</span><span class="ident" id="3283984">c</span><span class="op" id="3283985">.</span><span class="ident" id="3283986">fd</span><span class="op" id="3283988">.</span><span class="ident" id="3283989">sotype</span><span class="op" id="3283995">)</span>&nbsp;<span class="op" id="3283997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284001">return</span>&nbsp;<span class="num" id="3284008">0</span><span class="op" id="3284009">,</span>&nbsp;<span class="ident" id="3284011">syscall</span><span class="op" id="3284018">.</span><span class="ident" id="3284019">EAFNOSUPPORT</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284036">sa</span>&nbsp;<span class="op" id="3284039">:=</span>&nbsp;<span class="op" id="3284042">&amp;</span><span class="ident" id="3284043">syscall</span><span class="op" id="3284050">.</span><span class="ident" id="3284051">SockaddrUnix</span><span class="op" id="3284063">{</span><span class="ident" id="3284064">Name</span><span class="op" id="3284068">:</span>&nbsp;<span class="ident" id="3284070">addr</span><span class="op" id="3284074">.</span><span class="ident" id="3284075">Name</span><span class="op" id="3284079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284082">return</span>&nbsp;<span class="ident" id="3284089">c</span><span class="op" id="3284090">.</span><span class="ident" id="3284091">fd</span><span class="op" id="3284093">.</span><span class="ident" id="3284094">writeTo</span><span class="op" id="3284101">(</span><span class="ident" id="3284102">b</span><span class="op" id="3284103">,</span>&nbsp;<span class="ident" id="3284105">sa</span><span class="op" id="3284107">)</span><br>
<span class="lineno"></span><span class="op" id="3284109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3284112">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3284165">func</span>&nbsp;<span class="op" id="3284170">(</span><span class="ident" id="3284171">c</span>&nbsp;<span class="op" id="3284173">*</span><span class="ident" id="3284174">UnixConn</span><span class="op" id="3284182">)</span>&nbsp;<span class="ident" id="3284184">WriteTo</span><span class="op" id="3284191">(</span><span class="ident" id="3284192">b</span>&nbsp;<span class="op" id="3284194">[</span><span class="op" id="3284195">]</span><span class="builtintype" id="3284196">byte</span><span class="op" id="3284200">,</span>&nbsp;<span class="ident" id="3284202">addr</span>&nbsp;<span class="ident" id="3284207">Addr</span><span class="op" id="3284211">)</span>&nbsp;<span class="op" id="3284213">(</span><span class="ident" id="3284214">n</span>&nbsp;<span class="builtintype" id="3284216">int</span><span class="op" id="3284219">,</span>&nbsp;<span class="ident" id="3284221">err</span>&nbsp;<span class="builtintype" id="3284225">error</span><span class="op" id="3284230">)</span>&nbsp;<span class="op" id="3284232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284235">if</span>&nbsp;<span class="op" id="3284238">!</span><span class="ident" id="3284239">c</span><span class="op" id="3284240">.</span><span class="ident" id="3284241">ok</span><span class="op" id="3284243">(</span><span class="op" id="3284244">)</span>&nbsp;<span class="op" id="3284246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284250">return</span>&nbsp;<span class="num" id="3284257">0</span><span class="op" id="3284258">,</span>&nbsp;<span class="ident" id="3284260">syscall</span><span class="op" id="3284267">.</span><span class="ident" id="3284268">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284276">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284279">a</span><span class="op" id="3284280">,</span>&nbsp;<span class="ident" id="3284282">ok</span>&nbsp;<span class="op" id="3284285">:=</span>&nbsp;<span class="ident" id="3284288">addr</span><span class="op" id="3284292">.</span><span class="op" id="3284293">(</span><span class="op" id="3284294">*</span><span class="ident" id="3284295">UnixAddr</span><span class="op" id="3284303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284306">if</span>&nbsp;<span class="op" id="3284309">!</span><span class="ident" id="3284310">ok</span>&nbsp;<span class="op" id="3284313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284317">return</span>&nbsp;<span class="num" id="3284324">0</span><span class="op" id="3284325">,</span>&nbsp;<span class="op" id="3284327">&amp;</span><span class="ident" id="3284328">OpError</span><span class="op" id="3284335">{</span><span class="string" id="3284336">&#34;write&#34;</span><span class="op" id="3284343">,</span>&nbsp;<span class="ident" id="3284345">c</span><span class="op" id="3284346">.</span><span class="ident" id="3284347">fd</span><span class="op" id="3284349">.</span><span class="ident" id="3284350">net</span><span class="op" id="3284353">,</span>&nbsp;<span class="ident" id="3284355">addr</span><span class="op" id="3284359">,</span>&nbsp;<span class="ident" id="3284361">syscall</span><span class="op" id="3284368">.</span><span class="ident" id="3284369">EINVAL</span><span class="op" id="3284375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284381">return</span>&nbsp;<span class="ident" id="3284388">c</span><span class="op" id="3284389">.</span><span class="ident" id="3284390">WriteToUnix</span><span class="op" id="3284401">(</span><span class="ident" id="3284402">b</span><span class="op" id="3284403">,</span>&nbsp;<span class="ident" id="3284405">a</span><span class="op" id="3284406">)</span><br>
<span class="lineno">190</span><span class="op" id="3284408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3284411">//&nbsp;WriteMsgUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3284478">//&nbsp;from&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3284546">//&nbsp;the&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">195</span><span class="keyword" id="3284602">func</span>&nbsp;<span class="op" id="3284607">(</span><span class="ident" id="3284608">c</span>&nbsp;<span class="op" id="3284610">*</span><span class="ident" id="3284611">UnixConn</span><span class="op" id="3284619">)</span>&nbsp;<span class="ident" id="3284621">WriteMsgUnix</span><span class="op" id="3284633">(</span><span class="ident" id="3284634">b</span><span class="op" id="3284635">,</span>&nbsp;<span class="ident" id="3284637">oob</span>&nbsp;<span class="op" id="3284641">[</span><span class="op" id="3284642">]</span><span class="builtintype" id="3284643">byte</span><span class="op" id="3284647">,</span>&nbsp;<span class="ident" id="3284649">addr</span>&nbsp;<span class="op" id="3284654">*</span><span class="ident" id="3284655">UnixAddr</span><span class="op" id="3284663">)</span>&nbsp;<span class="op" id="3284665">(</span><span class="ident" id="3284666">n</span><span class="op" id="3284667">,</span>&nbsp;<span class="ident" id="3284669">oobn</span>&nbsp;<span class="builtintype" id="3284674">int</span><span class="op" id="3284677">,</span>&nbsp;<span class="ident" id="3284679">err</span>&nbsp;<span class="builtintype" id="3284683">error</span><span class="op" id="3284688">)</span>&nbsp;<span class="op" id="3284690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284693">if</span>&nbsp;<span class="op" id="3284696">!</span><span class="ident" id="3284697">c</span><span class="op" id="3284698">.</span><span class="ident" id="3284699">ok</span><span class="op" id="3284701">(</span><span class="op" id="3284702">)</span>&nbsp;<span class="op" id="3284704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284708">return</span>&nbsp;<span class="num" id="3284715">0</span><span class="op" id="3284716">,</span>&nbsp;<span class="num" id="3284718">0</span><span class="op" id="3284719">,</span>&nbsp;<span class="ident" id="3284721">syscall</span><span class="op" id="3284728">.</span><span class="ident" id="3284729">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284740">if</span>&nbsp;<span class="ident" id="3284743">c</span><span class="op" id="3284744">.</span><span class="ident" id="3284745">fd</span><span class="op" id="3284747">.</span><span class="ident" id="3284748">sotype</span>&nbsp;<span class="op" id="3284755">==</span>&nbsp;<span class="ident" id="3284758">syscall</span><span class="op" id="3284765">.</span><span class="ident" id="3284766">SOCK_DGRAM</span>&nbsp;<span class="op" id="3284777">&amp;&amp;</span>&nbsp;<span class="ident" id="3284780">c</span><span class="op" id="3284781">.</span><span class="ident" id="3284782">fd</span><span class="op" id="3284784">.</span><span class="ident" id="3284785">isConnected</span>&nbsp;<span class="op" id="3284797">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284801">return</span>&nbsp;<span class="num" id="3284808">0</span><span class="op" id="3284809">,</span>&nbsp;<span class="num" id="3284811">0</span><span class="op" id="3284812">,</span>&nbsp;<span class="op" id="3284814">&amp;</span><span class="ident" id="3284815">OpError</span><span class="op" id="3284822">{</span><span class="ident" id="3284823">Op</span><span class="op" id="3284825">:</span>&nbsp;<span class="string" id="3284827">&#34;write&#34;</span><span class="op" id="3284834">,</span>&nbsp;<span class="ident" id="3284836">Net</span><span class="op" id="3284839">:</span>&nbsp;<span class="ident" id="3284841">c</span><span class="op" id="3284842">.</span><span class="ident" id="3284843">fd</span><span class="op" id="3284845">.</span><span class="ident" id="3284846">net</span><span class="op" id="3284849">,</span>&nbsp;<span class="ident" id="3284851">Addr</span><span class="op" id="3284855">:</span>&nbsp;<span class="ident" id="3284857">addr</span><span class="op" id="3284861">,</span>&nbsp;<span class="ident" id="3284863">Err</span><span class="op" id="3284866">:</span>&nbsp;<span class="ident" id="3284868">ErrWriteToConnected</span><span class="op" id="3284887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284893">if</span>&nbsp;<span class="ident" id="3284896">addr</span>&nbsp;<span class="op" id="3284901">!=</span>&nbsp;<span class="ident" id="3284904">nil</span>&nbsp;<span class="op" id="3284908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284912">if</span>&nbsp;<span class="ident" id="3284915">addr</span><span class="op" id="3284919">.</span><span class="ident" id="3284920">Net</span>&nbsp;<span class="op" id="3284924">!=</span>&nbsp;<span class="ident" id="3284927">sotypeToNet</span><span class="op" id="3284938">(</span><span class="ident" id="3284939">c</span><span class="op" id="3284940">.</span><span class="ident" id="3284941">fd</span><span class="op" id="3284943">.</span><span class="ident" id="3284944">sotype</span><span class="op" id="3284950">)</span>&nbsp;<span class="op" id="3284952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284957">return</span>&nbsp;<span class="num" id="3284964">0</span><span class="op" id="3284965">,</span>&nbsp;<span class="num" id="3284967">0</span><span class="op" id="3284968">,</span>&nbsp;<span class="ident" id="3284970">syscall</span><span class="op" id="3284977">.</span><span class="ident" id="3284978">EAFNOSUPPORT</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284997">sa</span>&nbsp;<span class="op" id="3285000">:=</span>&nbsp;<span class="op" id="3285003">&amp;</span><span class="ident" id="3285004">syscall</span><span class="op" id="3285011">.</span><span class="ident" id="3285012">SockaddrUnix</span><span class="op" id="3285024">{</span><span class="ident" id="3285025">Name</span><span class="op" id="3285029">:</span>&nbsp;<span class="ident" id="3285031">addr</span><span class="op" id="3285035">.</span><span class="ident" id="3285036">Name</span><span class="op" id="3285040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285044">return</span>&nbsp;<span class="ident" id="3285051">c</span><span class="op" id="3285052">.</span><span class="ident" id="3285053">fd</span><span class="op" id="3285055">.</span><span class="ident" id="3285056">writeMsg</span><span class="op" id="3285064">(</span><span class="ident" id="3285065">b</span><span class="op" id="3285066">,</span>&nbsp;<span class="ident" id="3285068">oob</span><span class="op" id="3285071">,</span>&nbsp;<span class="ident" id="3285073">sa</span><span class="op" id="3285075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285081">return</span>&nbsp;<span class="ident" id="3285088">c</span><span class="op" id="3285089">.</span><span class="ident" id="3285090">fd</span><span class="op" id="3285092">.</span><span class="ident" id="3285093">writeMsg</span><span class="op" id="3285101">(</span><span class="ident" id="3285102">b</span><span class="op" id="3285103">,</span>&nbsp;<span class="ident" id="3285105">oob</span><span class="op" id="3285108">,</span>&nbsp;<span class="ident" id="3285110">nil</span><span class="op" id="3285113">)</span><br>
<span class="lineno">210</span><span class="op" id="3285115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3285118">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3285190">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3285229">func</span>&nbsp;<span class="op" id="3285234">(</span><span class="ident" id="3285235">c</span>&nbsp;<span class="op" id="3285237">*</span><span class="ident" id="3285238">UnixConn</span><span class="op" id="3285246">)</span>&nbsp;<span class="ident" id="3285248">CloseRead</span><span class="op" id="3285257">(</span><span class="op" id="3285258">)</span>&nbsp;<span class="builtintype" id="3285260">error</span>&nbsp;<span class="op" id="3285266">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285269">if</span>&nbsp;<span class="op" id="3285272">!</span><span class="ident" id="3285273">c</span><span class="op" id="3285274">.</span><span class="ident" id="3285275">ok</span><span class="op" id="3285277">(</span><span class="op" id="3285278">)</span>&nbsp;<span class="op" id="3285280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285284">return</span>&nbsp;<span class="ident" id="3285291">syscall</span><span class="op" id="3285298">.</span><span class="ident" id="3285299">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285310">return</span>&nbsp;<span class="ident" id="3285317">c</span><span class="op" id="3285318">.</span><span class="ident" id="3285319">fd</span><span class="op" id="3285321">.</span><span class="ident" id="3285322">closeRead</span><span class="op" id="3285331">(</span><span class="op" id="3285332">)</span><br>
<span class="lineno"></span><span class="op" id="3285334">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3285337">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3285410">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3285449">func</span>&nbsp;<span class="op" id="3285454">(</span><span class="ident" id="3285455">c</span>&nbsp;<span class="op" id="3285457">*</span><span class="ident" id="3285458">UnixConn</span><span class="op" id="3285466">)</span>&nbsp;<span class="ident" id="3285468">CloseWrite</span><span class="op" id="3285478">(</span><span class="op" id="3285479">)</span>&nbsp;<span class="builtintype" id="3285481">error</span>&nbsp;<span class="op" id="3285487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285490">if</span>&nbsp;<span class="op" id="3285493">!</span><span class="ident" id="3285494">c</span><span class="op" id="3285495">.</span><span class="ident" id="3285496">ok</span><span class="op" id="3285498">(</span><span class="op" id="3285499">)</span>&nbsp;<span class="op" id="3285501">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285505">return</span>&nbsp;<span class="ident" id="3285512">syscall</span><span class="op" id="3285519">.</span><span class="ident" id="3285520">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285531">return</span>&nbsp;<span class="ident" id="3285538">c</span><span class="op" id="3285539">.</span><span class="ident" id="3285540">fd</span><span class="op" id="3285542">.</span><span class="ident" id="3285543">closeWrite</span><span class="op" id="3285553">(</span><span class="op" id="3285554">)</span><br>
<span class="lineno"></span><span class="op" id="3285556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="3285559">//&nbsp;DialUnix&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3285628">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3285698">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3285758">func</span>&nbsp;<span class="ident" id="3285763">DialUnix</span><span class="op" id="3285771">(</span><span class="ident" id="3285772">net</span>&nbsp;<span class="builtintype" id="3285776">string</span><span class="op" id="3285782">,</span>&nbsp;<span class="ident" id="3285784">laddr</span><span class="op" id="3285789">,</span>&nbsp;<span class="ident" id="3285791">raddr</span>&nbsp;<span class="op" id="3285797">*</span><span class="ident" id="3285798">UnixAddr</span><span class="op" id="3285806">)</span>&nbsp;<span class="op" id="3285808">(</span><span class="op" id="3285809">*</span><span class="ident" id="3285810">UnixConn</span><span class="op" id="3285818">,</span>&nbsp;<span class="builtintype" id="3285820">error</span><span class="op" id="3285825">)</span>&nbsp;<span class="op" id="3285827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285830">switch</span>&nbsp;<span class="ident" id="3285837">net</span>&nbsp;<span class="op" id="3285841">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285844">case</span>&nbsp;<span class="string" id="3285849">&#34;unix&#34;</span><span class="op" id="3285855">,</span>&nbsp;<span class="string" id="3285857">&#34;unixgram&#34;</span><span class="op" id="3285867">,</span>&nbsp;<span class="string" id="3285869">&#34;unixpacket&#34;</span><span class="op" id="3285881">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285884">default</span><span class="op" id="3285891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285895">return</span>&nbsp;<span class="ident" id="3285902">nil</span><span class="op" id="3285905">,</span>&nbsp;<span class="op" id="3285907">&amp;</span><span class="ident" id="3285908">OpError</span><span class="op" id="3285915">{</span><span class="ident" id="3285916">Op</span><span class="op" id="3285918">:</span>&nbsp;<span class="string" id="3285920">&#34;dial&#34;</span><span class="op" id="3285926">,</span>&nbsp;<span class="ident" id="3285928">Net</span><span class="op" id="3285931">:</span>&nbsp;<span class="ident" id="3285933">net</span><span class="op" id="3285936">,</span>&nbsp;<span class="ident" id="3285938">Addr</span><span class="op" id="3285942">:</span>&nbsp;<span class="ident" id="3285944">raddr</span><span class="op" id="3285949">,</span>&nbsp;<span class="ident" id="3285951">Err</span><span class="op" id="3285954">:</span>&nbsp;<span class="ident" id="3285956">UnknownNetworkError</span><span class="op" id="3285975">(</span><span class="ident" id="3285976">net</span><span class="op" id="3285979">)</span><span class="op" id="3285980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3285983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3285986">return</span>&nbsp;<span class="ident" id="3285993">dialUnix</span><span class="op" id="3286001">(</span><span class="ident" id="3286002">net</span><span class="op" id="3286005">,</span>&nbsp;<span class="ident" id="3286007">laddr</span><span class="op" id="3286012">,</span>&nbsp;<span class="ident" id="3286014">raddr</span><span class="op" id="3286019">,</span>&nbsp;<span class="ident" id="3286021">noDeadline</span><span class="op" id="3286031">)</span><br>
<span class="lineno">240</span><span class="op" id="3286033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3286036">func</span>&nbsp;<span class="ident" id="3286041">dialUnix</span><span class="op" id="3286049">(</span><span class="ident" id="3286050">net</span>&nbsp;<span class="builtintype" id="3286054">string</span><span class="op" id="3286060">,</span>&nbsp;<span class="ident" id="3286062">laddr</span><span class="op" id="3286067">,</span>&nbsp;<span class="ident" id="3286069">raddr</span>&nbsp;<span class="op" id="3286075">*</span><span class="ident" id="3286076">UnixAddr</span><span class="op" id="3286084">,</span>&nbsp;<span class="ident" id="3286086">deadline</span>&nbsp;<span class="ident" id="3286095">time</span><span class="op" id="3286099">.</span><span class="ident" id="3286100">Time</span><span class="op" id="3286104">)</span>&nbsp;<span class="op" id="3286106">(</span><span class="op" id="3286107">*</span><span class="ident" id="3286108">UnixConn</span><span class="op" id="3286116">,</span>&nbsp;<span class="builtintype" id="3286118">error</span><span class="op" id="3286123">)</span>&nbsp;<span class="op" id="3286125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3286128">fd</span><span class="op" id="3286130">,</span>&nbsp;<span class="ident" id="3286132">err</span>&nbsp;<span class="op" id="3286136">:=</span>&nbsp;<span class="ident" id="3286139">unixSocket</span><span class="op" id="3286149">(</span><span class="ident" id="3286150">net</span><span class="op" id="3286153">,</span>&nbsp;<span class="ident" id="3286155">laddr</span><span class="op" id="3286160">,</span>&nbsp;<span class="ident" id="3286162">raddr</span><span class="op" id="3286167">,</span>&nbsp;<span class="string" id="3286169">&#34;dial&#34;</span><span class="op" id="3286175">,</span>&nbsp;<span class="ident" id="3286177">deadline</span><span class="op" id="3286185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286188">if</span>&nbsp;<span class="ident" id="3286191">err</span>&nbsp;<span class="op" id="3286195">!=</span>&nbsp;<span class="ident" id="3286198">nil</span>&nbsp;<span class="op" id="3286202">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286206">return</span>&nbsp;<span class="ident" id="3286213">nil</span><span class="op" id="3286216">,</span>&nbsp;<span class="op" id="3286218">&amp;</span><span class="ident" id="3286219">OpError</span><span class="op" id="3286226">{</span><span class="ident" id="3286227">Op</span><span class="op" id="3286229">:</span>&nbsp;<span class="string" id="3286231">&#34;dial&#34;</span><span class="op" id="3286237">,</span>&nbsp;<span class="ident" id="3286239">Net</span><span class="op" id="3286242">:</span>&nbsp;<span class="ident" id="3286244">net</span><span class="op" id="3286247">,</span>&nbsp;<span class="ident" id="3286249">Addr</span><span class="op" id="3286253">:</span>&nbsp;<span class="ident" id="3286255">raddr</span><span class="op" id="3286260">,</span>&nbsp;<span class="ident" id="3286262">Err</span><span class="op" id="3286265">:</span>&nbsp;<span class="ident" id="3286267">err</span><span class="op" id="3286270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3286273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286276">return</span>&nbsp;<span class="ident" id="3286283">newUnixConn</span><span class="op" id="3286294">(</span><span class="ident" id="3286295">fd</span><span class="op" id="3286297">)</span><span class="op" id="3286298">,</span>&nbsp;<span class="ident" id="3286300">nil</span><br>
<span class="lineno"></span><span class="op" id="3286304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3286307">//&nbsp;UnixListener&nbsp;is&nbsp;a&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3286373">//&nbsp;typically&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;Unix</span><br>
<span class="lineno"></span><span class="comment" id="3286442">//&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3286461">type</span>&nbsp;<span class="ident" id="3286466">UnixListener</span>&nbsp;<span class="keyword" id="3286479">struct</span>&nbsp;<span class="op" id="3286486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3286489">fd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3286494">*</span><span class="ident" id="3286495">netFD</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3286502">path</span>&nbsp;<span class="builtintype" id="3286507">string</span><br>
<span class="lineno"></span><span class="op" id="3286514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3286517">//&nbsp;ListenUnix&nbsp;announces&nbsp;on&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3286587">//&nbsp;Unix&nbsp;listener.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno">260</span><span class="keyword" id="3286654">func</span>&nbsp;<span class="ident" id="3286659">ListenUnix</span><span class="op" id="3286669">(</span><span class="ident" id="3286670">net</span>&nbsp;<span class="builtintype" id="3286674">string</span><span class="op" id="3286680">,</span>&nbsp;<span class="ident" id="3286682">laddr</span>&nbsp;<span class="op" id="3286688">*</span><span class="ident" id="3286689">UnixAddr</span><span class="op" id="3286697">)</span>&nbsp;<span class="op" id="3286699">(</span><span class="op" id="3286700">*</span><span class="ident" id="3286701">UnixListener</span><span class="op" id="3286713">,</span>&nbsp;<span class="builtintype" id="3286715">error</span><span class="op" id="3286720">)</span>&nbsp;<span class="op" id="3286722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286725">switch</span>&nbsp;<span class="ident" id="3286732">net</span>&nbsp;<span class="op" id="3286736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286739">case</span>&nbsp;<span class="string" id="3286744">&#34;unix&#34;</span><span class="op" id="3286750">,</span>&nbsp;<span class="string" id="3286752">&#34;unixpacket&#34;</span><span class="op" id="3286764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286767">default</span><span class="op" id="3286774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286778">return</span>&nbsp;<span class="ident" id="3286785">nil</span><span class="op" id="3286788">,</span>&nbsp;<span class="op" id="3286790">&amp;</span><span class="ident" id="3286791">OpError</span><span class="op" id="3286798">{</span><span class="ident" id="3286799">Op</span><span class="op" id="3286801">:</span>&nbsp;<span class="string" id="3286803">&#34;listen&#34;</span><span class="op" id="3286811">,</span>&nbsp;<span class="ident" id="3286813">Net</span><span class="op" id="3286816">:</span>&nbsp;<span class="ident" id="3286818">net</span><span class="op" id="3286821">,</span>&nbsp;<span class="ident" id="3286823">Addr</span><span class="op" id="3286827">:</span>&nbsp;<span class="ident" id="3286829">laddr</span><span class="op" id="3286834">,</span>&nbsp;<span class="ident" id="3286836">Err</span><span class="op" id="3286839">:</span>&nbsp;<span class="ident" id="3286841">UnknownNetworkError</span><span class="op" id="3286860">(</span><span class="ident" id="3286861">net</span><span class="op" id="3286864">)</span><span class="op" id="3286865">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3286868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286871">if</span>&nbsp;<span class="ident" id="3286874">laddr</span>&nbsp;<span class="op" id="3286880">==</span>&nbsp;<span class="ident" id="3286883">nil</span>&nbsp;<span class="op" id="3286887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3286891">return</span>&nbsp;<span class="ident" id="3286898">nil</span><span class="op" id="3286901">,</span>&nbsp;<span class="op" id="3286903">&amp;</span><span class="ident" id="3286904">OpError</span><span class="op" id="3286911">{</span><span class="ident" id="3286912">Op</span><span class="op" id="3286914">:</span>&nbsp;<span class="string" id="3286916">&#34;listen&#34;</span><span class="op" id="3286924">,</span>&nbsp;<span class="ident" id="3286926">Net</span><span class="op" id="3286929">:</span>&nbsp;<span class="ident" id="3286931">net</span><span class="op" id="3286934">,</span>&nbsp;<span class="ident" id="3286936">Addr</span><span class="op" id="3286940">:</span>&nbsp;<span class="ident" id="3286942">nil</span><span class="op" id="3286945">,</span>&nbsp;<span class="ident" id="3286947">Err</span><span class="op" id="3286950">:</span>&nbsp;<span class="ident" id="3286952">errMissingAddress</span><span class="op" id="3286969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3286972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3286975">fd</span><span class="op" id="3286977">,</span>&nbsp;<span class="ident" id="3286979">err</span>&nbsp;<span class="op" id="3286983">:=</span>&nbsp;<span class="ident" id="3286986">unixSocket</span><span class="op" id="3286996">(</span><span class="ident" id="3286997">net</span><span class="op" id="3287000">,</span>&nbsp;<span class="ident" id="3287002">laddr</span><span class="op" id="3287007">,</span>&nbsp;<span class="ident" id="3287009">nil</span><span class="op" id="3287012">,</span>&nbsp;<span class="string" id="3287014">&#34;listen&#34;</span><span class="op" id="3287022">,</span>&nbsp;<span class="ident" id="3287024">noDeadline</span><span class="op" id="3287034">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287037">if</span>&nbsp;<span class="ident" id="3287040">err</span>&nbsp;<span class="op" id="3287044">!=</span>&nbsp;<span class="ident" id="3287047">nil</span>&nbsp;<span class="op" id="3287051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287055">return</span>&nbsp;<span class="ident" id="3287062">nil</span><span class="op" id="3287065">,</span>&nbsp;<span class="op" id="3287067">&amp;</span><span class="ident" id="3287068">OpError</span><span class="op" id="3287075">{</span><span class="ident" id="3287076">Op</span><span class="op" id="3287078">:</span>&nbsp;<span class="string" id="3287080">&#34;listen&#34;</span><span class="op" id="3287088">,</span>&nbsp;<span class="ident" id="3287090">Net</span><span class="op" id="3287093">:</span>&nbsp;<span class="ident" id="3287095">net</span><span class="op" id="3287098">,</span>&nbsp;<span class="ident" id="3287100">Addr</span><span class="op" id="3287104">:</span>&nbsp;<span class="ident" id="3287106">laddr</span><span class="op" id="3287111">,</span>&nbsp;<span class="ident" id="3287113">Err</span><span class="op" id="3287116">:</span>&nbsp;<span class="ident" id="3287118">err</span><span class="op" id="3287121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287127">return</span>&nbsp;<span class="op" id="3287134">&amp;</span><span class="ident" id="3287135">UnixListener</span><span class="op" id="3287147">{</span><span class="ident" id="3287148">fd</span><span class="op" id="3287150">,</span>&nbsp;<span class="ident" id="3287152">fd</span><span class="op" id="3287154">.</span><span class="ident" id="3287155">laddr</span><span class="op" id="3287160">.</span><span class="ident" id="3287161">String</span><span class="op" id="3287167">(</span><span class="op" id="3287168">)</span><span class="op" id="3287169">}</span><span class="op" id="3287170">,</span>&nbsp;<span class="ident" id="3287172">nil</span><br>
<span class="lineno"></span><span class="op" id="3287176">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="3287179">//&nbsp;AcceptUnix&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3287244">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3287259">func</span>&nbsp;<span class="op" id="3287264">(</span><span class="ident" id="3287265">l</span>&nbsp;<span class="op" id="3287267">*</span><span class="ident" id="3287268">UnixListener</span><span class="op" id="3287280">)</span>&nbsp;<span class="ident" id="3287282">AcceptUnix</span><span class="op" id="3287292">(</span><span class="op" id="3287293">)</span>&nbsp;<span class="op" id="3287295">(</span><span class="op" id="3287296">*</span><span class="ident" id="3287297">UnixConn</span><span class="op" id="3287305">,</span>&nbsp;<span class="builtintype" id="3287307">error</span><span class="op" id="3287312">)</span>&nbsp;<span class="op" id="3287314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287317">if</span>&nbsp;<span class="ident" id="3287320">l</span>&nbsp;<span class="op" id="3287322">==</span>&nbsp;<span class="ident" id="3287325">nil</span>&nbsp;<span class="op" id="3287329">||</span>&nbsp;<span class="ident" id="3287332">l</span><span class="op" id="3287333">.</span><span class="ident" id="3287334">fd</span>&nbsp;<span class="op" id="3287337">==</span>&nbsp;<span class="ident" id="3287340">nil</span>&nbsp;<span class="op" id="3287344">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287348">return</span>&nbsp;<span class="ident" id="3287355">nil</span><span class="op" id="3287358">,</span>&nbsp;<span class="ident" id="3287360">syscall</span><span class="op" id="3287367">.</span><span class="ident" id="3287368">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3287379">fd</span><span class="op" id="3287381">,</span>&nbsp;<span class="ident" id="3287383">err</span>&nbsp;<span class="op" id="3287387">:=</span>&nbsp;<span class="ident" id="3287390">l</span><span class="op" id="3287391">.</span><span class="ident" id="3287392">fd</span><span class="op" id="3287394">.</span><span class="ident" id="3287395">accept</span><span class="op" id="3287401">(</span><span class="op" id="3287402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287405">if</span>&nbsp;<span class="ident" id="3287408">err</span>&nbsp;<span class="op" id="3287412">!=</span>&nbsp;<span class="ident" id="3287415">nil</span>&nbsp;<span class="op" id="3287419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287423">return</span>&nbsp;<span class="ident" id="3287430">nil</span><span class="op" id="3287433">,</span>&nbsp;<span class="ident" id="3287435">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3287443">c</span>&nbsp;<span class="op" id="3287445">:=</span>&nbsp;<span class="ident" id="3287448">newUnixConn</span><span class="op" id="3287459">(</span><span class="ident" id="3287460">fd</span><span class="op" id="3287462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287465">return</span>&nbsp;<span class="ident" id="3287472">c</span><span class="op" id="3287473">,</span>&nbsp;<span class="ident" id="3287475">nil</span><br>
<span class="lineno"></span><span class="op" id="3287479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="3287482">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3287551">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="3287606">func</span>&nbsp;<span class="op" id="3287611">(</span><span class="ident" id="3287612">l</span>&nbsp;<span class="op" id="3287614">*</span><span class="ident" id="3287615">UnixListener</span><span class="op" id="3287627">)</span>&nbsp;<span class="ident" id="3287629">Accept</span><span class="op" id="3287635">(</span><span class="op" id="3287636">)</span>&nbsp;<span class="op" id="3287638">(</span><span class="ident" id="3287639">c</span>&nbsp;<span class="ident" id="3287641">Conn</span><span class="op" id="3287645">,</span>&nbsp;<span class="ident" id="3287647">err</span>&nbsp;<span class="builtintype" id="3287651">error</span><span class="op" id="3287656">)</span>&nbsp;<span class="op" id="3287658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3287661">c1</span><span class="op" id="3287663">,</span>&nbsp;<span class="ident" id="3287665">err</span>&nbsp;<span class="op" id="3287669">:=</span>&nbsp;<span class="ident" id="3287672">l</span><span class="op" id="3287673">.</span><span class="ident" id="3287674">AcceptUnix</span><span class="op" id="3287684">(</span><span class="op" id="3287685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287688">if</span>&nbsp;<span class="ident" id="3287691">err</span>&nbsp;<span class="op" id="3287695">!=</span>&nbsp;<span class="ident" id="3287698">nil</span>&nbsp;<span class="op" id="3287702">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287706">return</span>&nbsp;<span class="ident" id="3287713">nil</span><span class="op" id="3287716">,</span>&nbsp;<span class="ident" id="3287718">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287726">return</span>&nbsp;<span class="ident" id="3287733">c1</span><span class="op" id="3287735">,</span>&nbsp;<span class="ident" id="3287737">nil</span><br>
<span class="lineno"></span><span class="op" id="3287741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="3287744">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;Unix&nbsp;address.&nbsp;&nbsp;Already&nbsp;accepted</span><br>
<span class="lineno"></span><span class="comment" id="3287808">//&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="3287839">func</span>&nbsp;<span class="op" id="3287844">(</span><span class="ident" id="3287845">l</span>&nbsp;<span class="op" id="3287847">*</span><span class="ident" id="3287848">UnixListener</span><span class="op" id="3287860">)</span>&nbsp;<span class="ident" id="3287862">Close</span><span class="op" id="3287867">(</span><span class="op" id="3287868">)</span>&nbsp;<span class="builtintype" id="3287870">error</span>&nbsp;<span class="op" id="3287876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287879">if</span>&nbsp;<span class="ident" id="3287882">l</span>&nbsp;<span class="op" id="3287884">==</span>&nbsp;<span class="ident" id="3287887">nil</span>&nbsp;<span class="op" id="3287891">||</span>&nbsp;<span class="ident" id="3287894">l</span><span class="op" id="3287895">.</span><span class="ident" id="3287896">fd</span>&nbsp;<span class="op" id="3287899">==</span>&nbsp;<span class="ident" id="3287902">nil</span>&nbsp;<span class="op" id="3287906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3287910">return</span>&nbsp;<span class="ident" id="3287917">syscall</span><span class="op" id="3287924">.</span><span class="ident" id="3287925">EINVAL</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3287933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3287937">//&nbsp;The&nbsp;operating&nbsp;system&nbsp;doesn&#39;t&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3287979">//&nbsp;the&nbsp;file&nbsp;that&nbsp;announcing&nbsp;created,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3288020">//&nbsp;we&nbsp;have&nbsp;to&nbsp;clean&nbsp;it&nbsp;up&nbsp;ourselves.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3288058">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here--we&nbsp;can&#39;t&nbsp;know&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3288101">//&nbsp;sure&nbsp;whether&nbsp;someone&nbsp;else&nbsp;has&nbsp;come&nbsp;along</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3288146">//&nbsp;and&nbsp;replaced&nbsp;our&nbsp;socket&nbsp;name&nbsp;already--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3288189">//&nbsp;but&nbsp;this&nbsp;sequence&nbsp;(remove&nbsp;then&nbsp;close)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3288231">//&nbsp;is&nbsp;at&nbsp;least&nbsp;compatible&nbsp;with&nbsp;the&nbsp;auto-remove</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3288279">//&nbsp;sequence&nbsp;in&nbsp;ListenUnix.&nbsp;&nbsp;It&#39;s&nbsp;only&nbsp;non-Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3288325">//&nbsp;programs&nbsp;that&nbsp;can&nbsp;mess&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288359">if</span>&nbsp;<span class="ident" id="3288362">l</span><span class="op" id="3288363">.</span><span class="ident" id="3288364">path</span><span class="op" id="3288368">[</span><span class="num" id="3288369">0</span><span class="op" id="3288370">]</span>&nbsp;<span class="op" id="3288372">!=</span>&nbsp;<span class="string" id="3288375">&#39;@&#39;</span>&nbsp;<span class="op" id="3288379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3288383">syscall</span><span class="op" id="3288390">.</span><span class="ident" id="3288391">Unlink</span><span class="op" id="3288397">(</span><span class="ident" id="3288398">l</span><span class="op" id="3288399">.</span><span class="ident" id="3288400">path</span><span class="op" id="3288404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3288407">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288410">return</span>&nbsp;<span class="ident" id="3288417">l</span><span class="op" id="3288418">.</span><span class="ident" id="3288419">fd</span><span class="op" id="3288421">.</span><span class="ident" id="3288422">Close</span><span class="op" id="3288427">(</span><span class="op" id="3288428">)</span><br>
<span class="lineno"></span><span class="op" id="3288430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3288433">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3288481">func</span>&nbsp;<span class="op" id="3288486">(</span><span class="ident" id="3288487">l</span>&nbsp;<span class="op" id="3288489">*</span><span class="ident" id="3288490">UnixListener</span><span class="op" id="3288502">)</span>&nbsp;<span class="ident" id="3288504">Addr</span><span class="op" id="3288508">(</span><span class="op" id="3288509">)</span>&nbsp;<span class="ident" id="3288511">Addr</span>&nbsp;<span class="op" id="3288516">{</span>&nbsp;<span class="keyword" id="3288518">return</span>&nbsp;<span class="ident" id="3288525">l</span><span class="op" id="3288526">.</span><span class="ident" id="3288527">fd</span><span class="op" id="3288529">.</span><span class="ident" id="3288530">laddr</span>&nbsp;<span class="op" id="3288536">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="3288539">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="3288602">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3288646">func</span>&nbsp;<span class="op" id="3288651">(</span><span class="ident" id="3288652">l</span>&nbsp;<span class="op" id="3288654">*</span><span class="ident" id="3288655">UnixListener</span><span class="op" id="3288667">)</span>&nbsp;<span class="ident" id="3288669">SetDeadline</span><span class="op" id="3288680">(</span><span class="ident" id="3288681">t</span>&nbsp;<span class="ident" id="3288683">time</span><span class="op" id="3288687">.</span><span class="ident" id="3288688">Time</span><span class="op" id="3288692">)</span>&nbsp;<span class="op" id="3288694">(</span><span class="ident" id="3288695">err</span>&nbsp;<span class="builtintype" id="3288699">error</span><span class="op" id="3288704">)</span>&nbsp;<span class="op" id="3288706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288709">if</span>&nbsp;<span class="ident" id="3288712">l</span>&nbsp;<span class="op" id="3288714">==</span>&nbsp;<span class="ident" id="3288717">nil</span>&nbsp;<span class="op" id="3288721">||</span>&nbsp;<span class="ident" id="3288724">l</span><span class="op" id="3288725">.</span><span class="ident" id="3288726">fd</span>&nbsp;<span class="op" id="3288729">==</span>&nbsp;<span class="ident" id="3288732">nil</span>&nbsp;<span class="op" id="3288736">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288740">return</span>&nbsp;<span class="ident" id="3288747">syscall</span><span class="op" id="3288754">.</span><span class="ident" id="3288755">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3288763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3288766">return</span>&nbsp;<span class="ident" id="3288773">l</span><span class="op" id="3288774">.</span><span class="ident" id="3288775">fd</span><span class="op" id="3288777">.</span><span class="ident" id="3288778">setDeadline</span><span class="op" id="3288789">(</span><span class="ident" id="3288790">t</span><span class="op" id="3288791">)</span><br>
<span class="lineno"></span><span class="op" id="3288793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="3288796">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="3288862">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="3288932">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno"></span><span class="comment" id="3288997">//</span><br>
<span class="lineno"></span><span class="comment" id="3289000">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno">340</span><span class="comment" id="3289064">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="3289130">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="3289194">func</span>&nbsp;<span class="op" id="3289199">(</span><span class="ident" id="3289200">l</span>&nbsp;<span class="op" id="3289202">*</span><span class="ident" id="3289203">UnixListener</span><span class="op" id="3289215">)</span>&nbsp;<span class="ident" id="3289217">File</span><span class="op" id="3289221">(</span><span class="op" id="3289222">)</span>&nbsp;<span class="op" id="3289224">(</span><span class="ident" id="3289225">f</span>&nbsp;<span class="op" id="3289227">*</span><span class="ident" id="3289228">os</span><span class="op" id="3289230">.</span><span class="ident" id="3289231">File</span><span class="op" id="3289235">,</span>&nbsp;<span class="ident" id="3289237">err</span>&nbsp;<span class="builtintype" id="3289241">error</span><span class="op" id="3289246">)</span>&nbsp;<span class="op" id="3289248">{</span>&nbsp;<span class="keyword" id="3289250">return</span>&nbsp;<span class="ident" id="3289257">l</span><span class="op" id="3289258">.</span><span class="ident" id="3289259">fd</span><span class="op" id="3289261">.</span><span class="ident" id="3289262">dup</span><span class="op" id="3289265">(</span><span class="op" id="3289266">)</span>&nbsp;<span class="op" id="3289268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3289271">//&nbsp;ListenUnixgram&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;Unix&nbsp;datagram&nbsp;packets&nbsp;addressed</span><br>
<span class="lineno">345</span><span class="comment" id="3289342">//&nbsp;to&nbsp;the&nbsp;local&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3289410">//&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo&nbsp;methods&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3289480">//&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;packets&nbsp;with&nbsp;per-packet&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3289539">func</span>&nbsp;<span class="ident" id="3289544">ListenUnixgram</span><span class="op" id="3289558">(</span><span class="ident" id="3289559">net</span>&nbsp;<span class="builtintype" id="3289563">string</span><span class="op" id="3289569">,</span>&nbsp;<span class="ident" id="3289571">laddr</span>&nbsp;<span class="op" id="3289577">*</span><span class="ident" id="3289578">UnixAddr</span><span class="op" id="3289586">)</span>&nbsp;<span class="op" id="3289588">(</span><span class="op" id="3289589">*</span><span class="ident" id="3289590">UnixConn</span><span class="op" id="3289598">,</span>&nbsp;<span class="builtintype" id="3289600">error</span><span class="op" id="3289605">)</span>&nbsp;<span class="op" id="3289607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289610">switch</span>&nbsp;<span class="ident" id="3289617">net</span>&nbsp;<span class="op" id="3289621">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289624">case</span>&nbsp;<span class="string" id="3289629">&#34;unixgram&#34;</span><span class="op" id="3289639">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289642">default</span><span class="op" id="3289649">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289653">return</span>&nbsp;<span class="ident" id="3289660">nil</span><span class="op" id="3289663">,</span>&nbsp;<span class="op" id="3289665">&amp;</span><span class="ident" id="3289666">OpError</span><span class="op" id="3289673">{</span><span class="ident" id="3289674">Op</span><span class="op" id="3289676">:</span>&nbsp;<span class="string" id="3289678">&#34;listen&#34;</span><span class="op" id="3289686">,</span>&nbsp;<span class="ident" id="3289688">Net</span><span class="op" id="3289691">:</span>&nbsp;<span class="ident" id="3289693">net</span><span class="op" id="3289696">,</span>&nbsp;<span class="ident" id="3289698">Addr</span><span class="op" id="3289702">:</span>&nbsp;<span class="ident" id="3289704">laddr</span><span class="op" id="3289709">,</span>&nbsp;<span class="ident" id="3289711">Err</span><span class="op" id="3289714">:</span>&nbsp;<span class="ident" id="3289716">UnknownNetworkError</span><span class="op" id="3289735">(</span><span class="ident" id="3289736">net</span><span class="op" id="3289739">)</span><span class="op" id="3289740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289746">if</span>&nbsp;<span class="ident" id="3289749">laddr</span>&nbsp;<span class="op" id="3289755">==</span>&nbsp;<span class="ident" id="3289758">nil</span>&nbsp;<span class="op" id="3289762">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289766">return</span>&nbsp;<span class="ident" id="3289773">nil</span><span class="op" id="3289776">,</span>&nbsp;<span class="op" id="3289778">&amp;</span><span class="ident" id="3289779">OpError</span><span class="op" id="3289786">{</span><span class="ident" id="3289787">Op</span><span class="op" id="3289789">:</span>&nbsp;<span class="string" id="3289791">&#34;listen&#34;</span><span class="op" id="3289799">,</span>&nbsp;<span class="ident" id="3289801">Net</span><span class="op" id="3289804">:</span>&nbsp;<span class="ident" id="3289806">net</span><span class="op" id="3289809">,</span>&nbsp;<span class="ident" id="3289811">Addr</span><span class="op" id="3289815">:</span>&nbsp;<span class="ident" id="3289817">nil</span><span class="op" id="3289820">,</span>&nbsp;<span class="ident" id="3289822">Err</span><span class="op" id="3289825">:</span>&nbsp;<span class="ident" id="3289827">errMissingAddress</span><span class="op" id="3289844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3289850">fd</span><span class="op" id="3289852">,</span>&nbsp;<span class="ident" id="3289854">err</span>&nbsp;<span class="op" id="3289858">:=</span>&nbsp;<span class="ident" id="3289861">unixSocket</span><span class="op" id="3289871">(</span><span class="ident" id="3289872">net</span><span class="op" id="3289875">,</span>&nbsp;<span class="ident" id="3289877">laddr</span><span class="op" id="3289882">,</span>&nbsp;<span class="ident" id="3289884">nil</span><span class="op" id="3289887">,</span>&nbsp;<span class="string" id="3289889">&#34;listen&#34;</span><span class="op" id="3289897">,</span>&nbsp;<span class="ident" id="3289899">noDeadline</span><span class="op" id="3289909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289912">if</span>&nbsp;<span class="ident" id="3289915">err</span>&nbsp;<span class="op" id="3289919">!=</span>&nbsp;<span class="ident" id="3289922">nil</span>&nbsp;<span class="op" id="3289926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3289930">return</span>&nbsp;<span class="ident" id="3289937">nil</span><span class="op" id="3289940">,</span>&nbsp;<span class="op" id="3289942">&amp;</span><span class="ident" id="3289943">OpError</span><span class="op" id="3289950">{</span><span class="ident" id="3289951">Op</span><span class="op" id="3289953">:</span>&nbsp;<span class="string" id="3289955">&#34;listen&#34;</span><span class="op" id="3289963">,</span>&nbsp;<span class="ident" id="3289965">Net</span><span class="op" id="3289968">:</span>&nbsp;<span class="ident" id="3289970">net</span><span class="op" id="3289973">,</span>&nbsp;<span class="ident" id="3289975">Addr</span><span class="op" id="3289979">:</span>&nbsp;<span class="ident" id="3289981">laddr</span><span class="op" id="3289986">,</span>&nbsp;<span class="ident" id="3289988">Err</span><span class="op" id="3289991">:</span>&nbsp;<span class="ident" id="3289993">err</span><span class="op" id="3289996">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3289999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3290002">return</span>&nbsp;<span class="ident" id="3290009">newUnixConn</span><span class="op" id="3290020">(</span><span class="ident" id="3290021">fd</span><span class="op" id="3290023">)</span><span class="op" id="3290024">,</span>&nbsp;<span class="ident" id="3290026">nil</span><br>
<span class="lineno"></span><span class="op" id="3290030">}</span>
</div>
</body>
</html>
