<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4178485">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4178541">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4178595">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4178646">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4178724">package</span>&nbsp;<span class="ident" id="4178732">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4178737">import</span>&nbsp;<span class="op" id="4178744">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4178747">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4178758">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4178765">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4178768">func</span>&nbsp;<span class="ident" id="4178773">sockaddrToUDP</span><span class="op" id="4178786">(</span><span class="ident" id="4178787">sa</span>&nbsp;<span class="ident" id="4178790">syscall</span><span class="op" id="4178797">.</span><span class="ident" id="4178798">Sockaddr</span><span class="op" id="4178806">)</span>&nbsp;<span class="ident" id="4178808">Addr</span>&nbsp;<span class="op" id="4178813">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178816">switch</span>&nbsp;<span class="ident" id="4178823">sa</span>&nbsp;<span class="op" id="4178826">:=</span>&nbsp;<span class="ident" id="4178829">sa</span><span class="op" id="4178831">.</span><span class="op" id="4178832">(</span><span class="keyword" id="4178833">type</span><span class="op" id="4178837">)</span>&nbsp;<span class="op" id="4178839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178842">case</span>&nbsp;<span class="op" id="4178847">*</span><span class="ident" id="4178848">syscall</span><span class="op" id="4178855">.</span><span class="ident" id="4178856">SockaddrInet4</span><span class="op" id="4178869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178873">return</span>&nbsp;<span class="op" id="4178880">&amp;</span><span class="ident" id="4178881">UDPAddr</span><span class="op" id="4178888">{</span><span class="ident" id="4178889">IP</span><span class="op" id="4178891">:</span>&nbsp;<span class="ident" id="4178893">sa</span><span class="op" id="4178895">.</span><span class="ident" id="4178896">Addr</span><span class="op" id="4178900">[</span><span class="num" id="4178901">0</span><span class="op" id="4178902">:</span><span class="op" id="4178903">]</span><span class="op" id="4178904">,</span>&nbsp;<span class="ident" id="4178906">Port</span><span class="op" id="4178910">:</span>&nbsp;<span class="ident" id="4178912">sa</span><span class="op" id="4178914">.</span><span class="ident" id="4178915">Port</span><span class="op" id="4178919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178922">case</span>&nbsp;<span class="op" id="4178927">*</span><span class="ident" id="4178928">syscall</span><span class="op" id="4178935">.</span><span class="ident" id="4178936">SockaddrInet6</span><span class="op" id="4178949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178953">return</span>&nbsp;<span class="op" id="4178960">&amp;</span><span class="ident" id="4178961">UDPAddr</span><span class="op" id="4178968">{</span><span class="ident" id="4178969">IP</span><span class="op" id="4178971">:</span>&nbsp;<span class="ident" id="4178973">sa</span><span class="op" id="4178975">.</span><span class="ident" id="4178976">Addr</span><span class="op" id="4178980">[</span><span class="num" id="4178981">0</span><span class="op" id="4178982">:</span><span class="op" id="4178983">]</span><span class="op" id="4178984">,</span>&nbsp;<span class="ident" id="4178986">Port</span><span class="op" id="4178990">:</span>&nbsp;<span class="ident" id="4178992">sa</span><span class="op" id="4178994">.</span><span class="ident" id="4178995">Port</span><span class="op" id="4178999">,</span>&nbsp;<span class="ident" id="4179001">Zone</span><span class="op" id="4179005">:</span>&nbsp;<span class="ident" id="4179007">zoneToString</span><span class="op" id="4179019">(</span><span class="builtintype" id="4179020">int</span><span class="op" id="4179023">(</span><span class="ident" id="4179024">sa</span><span class="op" id="4179026">.</span><span class="ident" id="4179027">ZoneId</span><span class="op" id="4179033">)</span><span class="op" id="4179034">)</span><span class="op" id="4179035">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179041">return</span>&nbsp;<span class="ident" id="4179048">nil</span><br>
<span class="lineno"></span><span class="op" id="4179052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4179055">func</span>&nbsp;<span class="op" id="4179060">(</span><span class="ident" id="4179061">a</span>&nbsp;<span class="op" id="4179063">*</span><span class="ident" id="4179064">UDPAddr</span><span class="op" id="4179071">)</span>&nbsp;<span class="ident" id="4179073">family</span><span class="op" id="4179079">(</span><span class="op" id="4179080">)</span>&nbsp;<span class="builtintype" id="4179082">int</span>&nbsp;<span class="op" id="4179086">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179089">if</span>&nbsp;<span class="ident" id="4179092">a</span>&nbsp;<span class="op" id="4179094">==</span>&nbsp;<span class="ident" id="4179097">nil</span>&nbsp;<span class="op" id="4179101">||</span>&nbsp;<span class="builtinfunc" id="4179104">len</span><span class="op" id="4179107">(</span><span class="ident" id="4179108">a</span><span class="op" id="4179109">.</span><span class="ident" id="4179110">IP</span><span class="op" id="4179112">)</span>&nbsp;<span class="op" id="4179114">&lt;=</span>&nbsp;<span class="ident" id="4179117">IPv4len</span>&nbsp;<span class="op" id="4179125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179129">return</span>&nbsp;<span class="ident" id="4179136">syscall</span><span class="op" id="4179143">.</span><span class="ident" id="4179144">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179156">if</span>&nbsp;<span class="ident" id="4179159">a</span><span class="op" id="4179160">.</span><span class="ident" id="4179161">IP</span><span class="op" id="4179163">.</span><span class="ident" id="4179164">To4</span><span class="op" id="4179167">(</span><span class="op" id="4179168">)</span>&nbsp;<span class="op" id="4179170">!=</span>&nbsp;<span class="ident" id="4179173">nil</span>&nbsp;<span class="op" id="4179177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179181">return</span>&nbsp;<span class="ident" id="4179188">syscall</span><span class="op" id="4179195">.</span><span class="ident" id="4179196">AF_INET</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179208">return</span>&nbsp;<span class="ident" id="4179215">syscall</span><span class="op" id="4179222">.</span><span class="ident" id="4179223">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="4179232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4179235">func</span>&nbsp;<span class="op" id="4179240">(</span><span class="ident" id="4179241">a</span>&nbsp;<span class="op" id="4179243">*</span><span class="ident" id="4179244">UDPAddr</span><span class="op" id="4179251">)</span>&nbsp;<span class="ident" id="4179253">isWildcard</span><span class="op" id="4179263">(</span><span class="op" id="4179264">)</span>&nbsp;<span class="builtintype" id="4179266">bool</span>&nbsp;<span class="op" id="4179271">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179274">if</span>&nbsp;<span class="ident" id="4179277">a</span>&nbsp;<span class="op" id="4179279">==</span>&nbsp;<span class="ident" id="4179282">nil</span>&nbsp;<span class="op" id="4179286">||</span>&nbsp;<span class="ident" id="4179289">a</span><span class="op" id="4179290">.</span><span class="ident" id="4179291">IP</span>&nbsp;<span class="op" id="4179294">==</span>&nbsp;<span class="ident" id="4179297">nil</span>&nbsp;<span class="op" id="4179301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179305">return</span>&nbsp;<span class="builtintype" id="4179312">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179321">return</span>&nbsp;<span class="ident" id="4179328">a</span><span class="op" id="4179329">.</span><span class="ident" id="4179330">IP</span><span class="op" id="4179332">.</span><span class="ident" id="4179333">IsUnspecified</span><span class="op" id="4179346">(</span><span class="op" id="4179347">)</span><br>
<span class="lineno"></span><span class="op" id="4179349">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="4179352">func</span>&nbsp;<span class="op" id="4179357">(</span><span class="ident" id="4179358">a</span>&nbsp;<span class="op" id="4179360">*</span><span class="ident" id="4179361">UDPAddr</span><span class="op" id="4179368">)</span>&nbsp;<span class="ident" id="4179370">sockaddr</span><span class="op" id="4179378">(</span><span class="ident" id="4179379">family</span>&nbsp;<span class="builtintype" id="4179386">int</span><span class="op" id="4179389">)</span>&nbsp;<span class="op" id="4179391">(</span><span class="ident" id="4179392">syscall</span><span class="op" id="4179399">.</span><span class="ident" id="4179400">Sockaddr</span><span class="op" id="4179408">,</span>&nbsp;<span class="builtintype" id="4179410">error</span><span class="op" id="4179415">)</span>&nbsp;<span class="op" id="4179417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179420">if</span>&nbsp;<span class="ident" id="4179423">a</span>&nbsp;<span class="op" id="4179425">==</span>&nbsp;<span class="ident" id="4179428">nil</span>&nbsp;<span class="op" id="4179432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179436">return</span>&nbsp;<span class="ident" id="4179443">nil</span><span class="op" id="4179446">,</span>&nbsp;<span class="ident" id="4179448">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179453">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179456">return</span>&nbsp;<span class="ident" id="4179463">ipToSockaddr</span><span class="op" id="4179475">(</span><span class="ident" id="4179476">family</span><span class="op" id="4179482">,</span>&nbsp;<span class="ident" id="4179484">a</span><span class="op" id="4179485">.</span><span class="ident" id="4179486">IP</span><span class="op" id="4179488">,</span>&nbsp;<span class="ident" id="4179490">a</span><span class="op" id="4179491">.</span><span class="ident" id="4179492">Port</span><span class="op" id="4179496">,</span>&nbsp;<span class="ident" id="4179498">a</span><span class="op" id="4179499">.</span><span class="ident" id="4179500">Zone</span><span class="op" id="4179504">)</span><br>
<span class="lineno"></span><span class="op" id="4179506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4179509">//&nbsp;UDPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="4179580">//&nbsp;for&nbsp;UDP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno">50</span><span class="keyword" id="4179612">type</span>&nbsp;<span class="ident" id="4179617">UDPConn</span>&nbsp;<span class="keyword" id="4179625">struct</span>&nbsp;<span class="op" id="4179632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4179635">conn</span><br>
<span class="lineno"></span><span class="op" id="4179640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4179643">func</span>&nbsp;<span class="ident" id="4179648">newUDPConn</span><span class="op" id="4179658">(</span><span class="ident" id="4179659">fd</span>&nbsp;<span class="op" id="4179662">*</span><span class="ident" id="4179663">netFD</span><span class="op" id="4179668">)</span>&nbsp;<span class="op" id="4179670">*</span><span class="ident" id="4179671">UDPConn</span>&nbsp;<span class="op" id="4179679">{</span>&nbsp;<span class="keyword" id="4179681">return</span>&nbsp;<span class="op" id="4179688">&amp;</span><span class="ident" id="4179689">UDPConn</span><span class="op" id="4179696">{</span><span class="ident" id="4179697">conn</span><span class="op" id="4179701">{</span><span class="ident" id="4179702">fd</span><span class="op" id="4179704">}</span><span class="op" id="4179705">}</span>&nbsp;<span class="op" id="4179707">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4179710">//&nbsp;ReadFromUDP&nbsp;reads&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="4179780">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="4179851">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="4179878">//</span><br>
<span class="lineno">60</span><span class="comment" id="4179881">//&nbsp;ReadFromUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4179945">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4180012">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="4180032">func</span>&nbsp;<span class="op" id="4180037">(</span><span class="ident" id="4180038">c</span>&nbsp;<span class="op" id="4180040">*</span><span class="ident" id="4180041">UDPConn</span><span class="op" id="4180048">)</span>&nbsp;<span class="ident" id="4180050">ReadFromUDP</span><span class="op" id="4180061">(</span><span class="ident" id="4180062">b</span>&nbsp;<span class="op" id="4180064">[</span><span class="op" id="4180065">]</span><span class="builtintype" id="4180066">byte</span><span class="op" id="4180070">)</span>&nbsp;<span class="op" id="4180072">(</span><span class="ident" id="4180073">n</span>&nbsp;<span class="builtintype" id="4180075">int</span><span class="op" id="4180078">,</span>&nbsp;<span class="ident" id="4180080">addr</span>&nbsp;<span class="op" id="4180085">*</span><span class="ident" id="4180086">UDPAddr</span><span class="op" id="4180093">,</span>&nbsp;<span class="ident" id="4180095">err</span>&nbsp;<span class="builtintype" id="4180099">error</span><span class="op" id="4180104">)</span>&nbsp;<span class="op" id="4180106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180109">if</span>&nbsp;<span class="op" id="4180112">!</span><span class="ident" id="4180113">c</span><span class="op" id="4180114">.</span><span class="ident" id="4180115">ok</span><span class="op" id="4180117">(</span><span class="op" id="4180118">)</span>&nbsp;<span class="op" id="4180120">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180124">return</span>&nbsp;<span class="num" id="4180131">0</span><span class="op" id="4180132">,</span>&nbsp;<span class="ident" id="4180134">nil</span><span class="op" id="4180137">,</span>&nbsp;<span class="ident" id="4180139">syscall</span><span class="op" id="4180146">.</span><span class="ident" id="4180147">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4180155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180158">n</span><span class="op" id="4180159">,</span>&nbsp;<span class="ident" id="4180161">sa</span><span class="op" id="4180163">,</span>&nbsp;<span class="ident" id="4180165">err</span>&nbsp;<span class="op" id="4180169">:=</span>&nbsp;<span class="ident" id="4180172">c</span><span class="op" id="4180173">.</span><span class="ident" id="4180174">fd</span><span class="op" id="4180176">.</span><span class="ident" id="4180177">readFrom</span><span class="op" id="4180185">(</span><span class="ident" id="4180186">b</span><span class="op" id="4180187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180190">switch</span>&nbsp;<span class="ident" id="4180197">sa</span>&nbsp;<span class="op" id="4180200">:=</span>&nbsp;<span class="ident" id="4180203">sa</span><span class="op" id="4180205">.</span><span class="op" id="4180206">(</span><span class="keyword" id="4180207">type</span><span class="op" id="4180211">)</span>&nbsp;<span class="op" id="4180213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180216">case</span>&nbsp;<span class="op" id="4180221">*</span><span class="ident" id="4180222">syscall</span><span class="op" id="4180229">.</span><span class="ident" id="4180230">SockaddrInet4</span><span class="op" id="4180243">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180247">addr</span>&nbsp;<span class="op" id="4180252">=</span>&nbsp;<span class="op" id="4180254">&amp;</span><span class="ident" id="4180255">UDPAddr</span><span class="op" id="4180262">{</span><span class="ident" id="4180263">IP</span><span class="op" id="4180265">:</span>&nbsp;<span class="ident" id="4180267">sa</span><span class="op" id="4180269">.</span><span class="ident" id="4180270">Addr</span><span class="op" id="4180274">[</span><span class="num" id="4180275">0</span><span class="op" id="4180276">:</span><span class="op" id="4180277">]</span><span class="op" id="4180278">,</span>&nbsp;<span class="ident" id="4180280">Port</span><span class="op" id="4180284">:</span>&nbsp;<span class="ident" id="4180286">sa</span><span class="op" id="4180288">.</span><span class="ident" id="4180289">Port</span><span class="op" id="4180293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180296">case</span>&nbsp;<span class="op" id="4180301">*</span><span class="ident" id="4180302">syscall</span><span class="op" id="4180309">.</span><span class="ident" id="4180310">SockaddrInet6</span><span class="op" id="4180323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180327">addr</span>&nbsp;<span class="op" id="4180332">=</span>&nbsp;<span class="op" id="4180334">&amp;</span><span class="ident" id="4180335">UDPAddr</span><span class="op" id="4180342">{</span><span class="ident" id="4180343">IP</span><span class="op" id="4180345">:</span>&nbsp;<span class="ident" id="4180347">sa</span><span class="op" id="4180349">.</span><span class="ident" id="4180350">Addr</span><span class="op" id="4180354">[</span><span class="num" id="4180355">0</span><span class="op" id="4180356">:</span><span class="op" id="4180357">]</span><span class="op" id="4180358">,</span>&nbsp;<span class="ident" id="4180360">Port</span><span class="op" id="4180364">:</span>&nbsp;<span class="ident" id="4180366">sa</span><span class="op" id="4180368">.</span><span class="ident" id="4180369">Port</span><span class="op" id="4180373">,</span>&nbsp;<span class="ident" id="4180375">Zone</span><span class="op" id="4180379">:</span>&nbsp;<span class="ident" id="4180381">zoneToString</span><span class="op" id="4180393">(</span><span class="builtintype" id="4180394">int</span><span class="op" id="4180397">(</span><span class="ident" id="4180398">sa</span><span class="op" id="4180400">.</span><span class="ident" id="4180401">ZoneId</span><span class="op" id="4180407">)</span><span class="op" id="4180408">)</span><span class="op" id="4180409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4180412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180415">return</span><br>
<span class="lineno">75</span><span class="op" id="4180422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4180425">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="4180480">func</span>&nbsp;<span class="op" id="4180485">(</span><span class="ident" id="4180486">c</span>&nbsp;<span class="op" id="4180488">*</span><span class="ident" id="4180489">UDPConn</span><span class="op" id="4180496">)</span>&nbsp;<span class="ident" id="4180498">ReadFrom</span><span class="op" id="4180506">(</span><span class="ident" id="4180507">b</span>&nbsp;<span class="op" id="4180509">[</span><span class="op" id="4180510">]</span><span class="builtintype" id="4180511">byte</span><span class="op" id="4180515">)</span>&nbsp;<span class="op" id="4180517">(</span><span class="builtintype" id="4180518">int</span><span class="op" id="4180521">,</span>&nbsp;<span class="ident" id="4180523">Addr</span><span class="op" id="4180527">,</span>&nbsp;<span class="builtintype" id="4180529">error</span><span class="op" id="4180534">)</span>&nbsp;<span class="op" id="4180536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180539">if</span>&nbsp;<span class="op" id="4180542">!</span><span class="ident" id="4180543">c</span><span class="op" id="4180544">.</span><span class="ident" id="4180545">ok</span><span class="op" id="4180547">(</span><span class="op" id="4180548">)</span>&nbsp;<span class="op" id="4180550">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180554">return</span>&nbsp;<span class="num" id="4180561">0</span><span class="op" id="4180562">,</span>&nbsp;<span class="ident" id="4180564">nil</span><span class="op" id="4180567">,</span>&nbsp;<span class="ident" id="4180569">syscall</span><span class="op" id="4180576">.</span><span class="ident" id="4180577">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4180585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180588">n</span><span class="op" id="4180589">,</span>&nbsp;<span class="ident" id="4180591">addr</span><span class="op" id="4180595">,</span>&nbsp;<span class="ident" id="4180597">err</span>&nbsp;<span class="op" id="4180601">:=</span>&nbsp;<span class="ident" id="4180604">c</span><span class="op" id="4180605">.</span><span class="ident" id="4180606">ReadFromUDP</span><span class="op" id="4180617">(</span><span class="ident" id="4180618">b</span><span class="op" id="4180619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180622">return</span>&nbsp;<span class="ident" id="4180629">n</span><span class="op" id="4180630">,</span>&nbsp;<span class="ident" id="4180632">addr</span><span class="op" id="4180636">.</span><span class="ident" id="4180637">toAddr</span><span class="op" id="4180643">(</span><span class="op" id="4180644">)</span><span class="op" id="4180645">,</span>&nbsp;<span class="ident" id="4180647">err</span><br>
<span class="lineno"></span><span class="op" id="4180651">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4180654">//&nbsp;ReadMsgUDP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4180722">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="4180790">//&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4180858">//&nbsp;flags&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno">90</span><span class="comment" id="4180925">//&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="4180936">func</span>&nbsp;<span class="op" id="4180941">(</span><span class="ident" id="4180942">c</span>&nbsp;<span class="op" id="4180944">*</span><span class="ident" id="4180945">UDPConn</span><span class="op" id="4180952">)</span>&nbsp;<span class="ident" id="4180954">ReadMsgUDP</span><span class="op" id="4180964">(</span><span class="ident" id="4180965">b</span><span class="op" id="4180966">,</span>&nbsp;<span class="ident" id="4180968">oob</span>&nbsp;<span class="op" id="4180972">[</span><span class="op" id="4180973">]</span><span class="builtintype" id="4180974">byte</span><span class="op" id="4180978">)</span>&nbsp;<span class="op" id="4180980">(</span><span class="ident" id="4180981">n</span><span class="op" id="4180982">,</span>&nbsp;<span class="ident" id="4180984">oobn</span><span class="op" id="4180988">,</span>&nbsp;<span class="ident" id="4180990">flags</span>&nbsp;<span class="builtintype" id="4180996">int</span><span class="op" id="4180999">,</span>&nbsp;<span class="ident" id="4181001">addr</span>&nbsp;<span class="op" id="4181006">*</span><span class="ident" id="4181007">UDPAddr</span><span class="op" id="4181014">,</span>&nbsp;<span class="ident" id="4181016">err</span>&nbsp;<span class="builtintype" id="4181020">error</span><span class="op" id="4181025">)</span>&nbsp;<span class="op" id="4181027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181030">if</span>&nbsp;<span class="op" id="4181033">!</span><span class="ident" id="4181034">c</span><span class="op" id="4181035">.</span><span class="ident" id="4181036">ok</span><span class="op" id="4181038">(</span><span class="op" id="4181039">)</span>&nbsp;<span class="op" id="4181041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181045">return</span>&nbsp;<span class="num" id="4181052">0</span><span class="op" id="4181053">,</span>&nbsp;<span class="num" id="4181055">0</span><span class="op" id="4181056">,</span>&nbsp;<span class="num" id="4181058">0</span><span class="op" id="4181059">,</span>&nbsp;<span class="ident" id="4181061">nil</span><span class="op" id="4181064">,</span>&nbsp;<span class="ident" id="4181066">syscall</span><span class="op" id="4181073">.</span><span class="ident" id="4181074">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181082">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181085">var</span>&nbsp;<span class="ident" id="4181089">sa</span>&nbsp;<span class="ident" id="4181092">syscall</span><span class="op" id="4181099">.</span><span class="ident" id="4181100">Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181110">n</span><span class="op" id="4181111">,</span>&nbsp;<span class="ident" id="4181113">oobn</span><span class="op" id="4181117">,</span>&nbsp;<span class="ident" id="4181119">flags</span><span class="op" id="4181124">,</span>&nbsp;<span class="ident" id="4181126">sa</span><span class="op" id="4181128">,</span>&nbsp;<span class="ident" id="4181130">err</span>&nbsp;<span class="op" id="4181134">=</span>&nbsp;<span class="ident" id="4181136">c</span><span class="op" id="4181137">.</span><span class="ident" id="4181138">fd</span><span class="op" id="4181140">.</span><span class="ident" id="4181141">readMsg</span><span class="op" id="4181148">(</span><span class="ident" id="4181149">b</span><span class="op" id="4181150">,</span>&nbsp;<span class="ident" id="4181152">oob</span><span class="op" id="4181155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181158">switch</span>&nbsp;<span class="ident" id="4181165">sa</span>&nbsp;<span class="op" id="4181168">:=</span>&nbsp;<span class="ident" id="4181171">sa</span><span class="op" id="4181173">.</span><span class="op" id="4181174">(</span><span class="keyword" id="4181175">type</span><span class="op" id="4181179">)</span>&nbsp;<span class="op" id="4181181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181184">case</span>&nbsp;<span class="op" id="4181189">*</span><span class="ident" id="4181190">syscall</span><span class="op" id="4181197">.</span><span class="ident" id="4181198">SockaddrInet4</span><span class="op" id="4181211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181215">addr</span>&nbsp;<span class="op" id="4181220">=</span>&nbsp;<span class="op" id="4181222">&amp;</span><span class="ident" id="4181223">UDPAddr</span><span class="op" id="4181230">{</span><span class="ident" id="4181231">IP</span><span class="op" id="4181233">:</span>&nbsp;<span class="ident" id="4181235">sa</span><span class="op" id="4181237">.</span><span class="ident" id="4181238">Addr</span><span class="op" id="4181242">[</span><span class="num" id="4181243">0</span><span class="op" id="4181244">:</span><span class="op" id="4181245">]</span><span class="op" id="4181246">,</span>&nbsp;<span class="ident" id="4181248">Port</span><span class="op" id="4181252">:</span>&nbsp;<span class="ident" id="4181254">sa</span><span class="op" id="4181256">.</span><span class="ident" id="4181257">Port</span><span class="op" id="4181261">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181264">case</span>&nbsp;<span class="op" id="4181269">*</span><span class="ident" id="4181270">syscall</span><span class="op" id="4181277">.</span><span class="ident" id="4181278">SockaddrInet6</span><span class="op" id="4181291">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181295">addr</span>&nbsp;<span class="op" id="4181300">=</span>&nbsp;<span class="op" id="4181302">&amp;</span><span class="ident" id="4181303">UDPAddr</span><span class="op" id="4181310">{</span><span class="ident" id="4181311">IP</span><span class="op" id="4181313">:</span>&nbsp;<span class="ident" id="4181315">sa</span><span class="op" id="4181317">.</span><span class="ident" id="4181318">Addr</span><span class="op" id="4181322">[</span><span class="num" id="4181323">0</span><span class="op" id="4181324">:</span><span class="op" id="4181325">]</span><span class="op" id="4181326">,</span>&nbsp;<span class="ident" id="4181328">Port</span><span class="op" id="4181332">:</span>&nbsp;<span class="ident" id="4181334">sa</span><span class="op" id="4181336">.</span><span class="ident" id="4181337">Port</span><span class="op" id="4181341">,</span>&nbsp;<span class="ident" id="4181343">Zone</span><span class="op" id="4181347">:</span>&nbsp;<span class="ident" id="4181349">zoneToString</span><span class="op" id="4181361">(</span><span class="builtintype" id="4181362">int</span><span class="op" id="4181365">(</span><span class="ident" id="4181366">sa</span><span class="op" id="4181368">.</span><span class="ident" id="4181369">ZoneId</span><span class="op" id="4181375">)</span><span class="op" id="4181376">)</span><span class="op" id="4181377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181383">return</span><br>
<span class="lineno"></span><span class="op" id="4181390">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="4181393">//&nbsp;WriteToUDP&nbsp;writes&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="4181462">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="4181473">//</span><br>
<span class="lineno"></span><span class="comment" id="4181476">//&nbsp;WriteToUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">110</span><span class="comment" id="4181539">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4181606">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="4181675">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="4181688">func</span>&nbsp;<span class="op" id="4181693">(</span><span class="ident" id="4181694">c</span>&nbsp;<span class="op" id="4181696">*</span><span class="ident" id="4181697">UDPConn</span><span class="op" id="4181704">)</span>&nbsp;<span class="ident" id="4181706">WriteToUDP</span><span class="op" id="4181716">(</span><span class="ident" id="4181717">b</span>&nbsp;<span class="op" id="4181719">[</span><span class="op" id="4181720">]</span><span class="builtintype" id="4181721">byte</span><span class="op" id="4181725">,</span>&nbsp;<span class="ident" id="4181727">addr</span>&nbsp;<span class="op" id="4181732">*</span><span class="ident" id="4181733">UDPAddr</span><span class="op" id="4181740">)</span>&nbsp;<span class="op" id="4181742">(</span><span class="builtintype" id="4181743">int</span><span class="op" id="4181746">,</span>&nbsp;<span class="builtintype" id="4181748">error</span><span class="op" id="4181753">)</span>&nbsp;<span class="op" id="4181755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181758">if</span>&nbsp;<span class="op" id="4181761">!</span><span class="ident" id="4181762">c</span><span class="op" id="4181763">.</span><span class="ident" id="4181764">ok</span><span class="op" id="4181766">(</span><span class="op" id="4181767">)</span>&nbsp;<span class="op" id="4181769">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181773">return</span>&nbsp;<span class="num" id="4181780">0</span><span class="op" id="4181781">,</span>&nbsp;<span class="ident" id="4181783">syscall</span><span class="op" id="4181790">.</span><span class="ident" id="4181791">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181802">if</span>&nbsp;<span class="ident" id="4181805">c</span><span class="op" id="4181806">.</span><span class="ident" id="4181807">fd</span><span class="op" id="4181809">.</span><span class="ident" id="4181810">isConnected</span>&nbsp;<span class="op" id="4181822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181826">return</span>&nbsp;<span class="num" id="4181833">0</span><span class="op" id="4181834">,</span>&nbsp;<span class="op" id="4181836">&amp;</span><span class="ident" id="4181837">OpError</span><span class="op" id="4181844">{</span><span class="string" id="4181845">&#34;write&#34;</span><span class="op" id="4181852">,</span>&nbsp;<span class="ident" id="4181854">c</span><span class="op" id="4181855">.</span><span class="ident" id="4181856">fd</span><span class="op" id="4181858">.</span><span class="ident" id="4181859">net</span><span class="op" id="4181862">,</span>&nbsp;<span class="ident" id="4181864">addr</span><span class="op" id="4181868">,</span>&nbsp;<span class="ident" id="4181870">ErrWriteToConnected</span><span class="op" id="4181889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181892">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181895">if</span>&nbsp;<span class="ident" id="4181898">addr</span>&nbsp;<span class="op" id="4181903">==</span>&nbsp;<span class="ident" id="4181906">nil</span>&nbsp;<span class="op" id="4181910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181914">return</span>&nbsp;<span class="num" id="4181921">0</span><span class="op" id="4181922">,</span>&nbsp;<span class="op" id="4181924">&amp;</span><span class="ident" id="4181925">OpError</span><span class="op" id="4181932">{</span><span class="ident" id="4181933">Op</span><span class="op" id="4181935">:</span>&nbsp;<span class="string" id="4181937">&#34;write&#34;</span><span class="op" id="4181944">,</span>&nbsp;<span class="ident" id="4181946">Net</span><span class="op" id="4181949">:</span>&nbsp;<span class="ident" id="4181951">c</span><span class="op" id="4181952">.</span><span class="ident" id="4181953">fd</span><span class="op" id="4181955">.</span><span class="ident" id="4181956">net</span><span class="op" id="4181959">,</span>&nbsp;<span class="ident" id="4181961">Addr</span><span class="op" id="4181965">:</span>&nbsp;<span class="ident" id="4181967">nil</span><span class="op" id="4181970">,</span>&nbsp;<span class="ident" id="4181972">Err</span><span class="op" id="4181975">:</span>&nbsp;<span class="ident" id="4181977">errMissingAddress</span><span class="op" id="4181994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182000">sa</span><span class="op" id="4182002">,</span>&nbsp;<span class="ident" id="4182004">err</span>&nbsp;<span class="op" id="4182008">:=</span>&nbsp;<span class="ident" id="4182011">addr</span><span class="op" id="4182015">.</span><span class="ident" id="4182016">sockaddr</span><span class="op" id="4182024">(</span><span class="ident" id="4182025">c</span><span class="op" id="4182026">.</span><span class="ident" id="4182027">fd</span><span class="op" id="4182029">.</span><span class="ident" id="4182030">family</span><span class="op" id="4182036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182039">if</span>&nbsp;<span class="ident" id="4182042">err</span>&nbsp;<span class="op" id="4182046">!=</span>&nbsp;<span class="ident" id="4182049">nil</span>&nbsp;<span class="op" id="4182053">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182057">return</span>&nbsp;<span class="num" id="4182064">0</span><span class="op" id="4182065">,</span>&nbsp;<span class="op" id="4182067">&amp;</span><span class="ident" id="4182068">OpError</span><span class="op" id="4182075">{</span><span class="string" id="4182076">&#34;write&#34;</span><span class="op" id="4182083">,</span>&nbsp;<span class="ident" id="4182085">c</span><span class="op" id="4182086">.</span><span class="ident" id="4182087">fd</span><span class="op" id="4182089">.</span><span class="ident" id="4182090">net</span><span class="op" id="4182093">,</span>&nbsp;<span class="ident" id="4182095">addr</span><span class="op" id="4182099">,</span>&nbsp;<span class="ident" id="4182101">err</span><span class="op" id="4182104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182110">return</span>&nbsp;<span class="ident" id="4182117">c</span><span class="op" id="4182118">.</span><span class="ident" id="4182119">fd</span><span class="op" id="4182121">.</span><span class="ident" id="4182122">writeTo</span><span class="op" id="4182129">(</span><span class="ident" id="4182130">b</span><span class="op" id="4182131">,</span>&nbsp;<span class="ident" id="4182133">sa</span><span class="op" id="4182135">)</span><br>
<span class="lineno"></span><span class="op" id="4182137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="4182140">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="4182193">func</span>&nbsp;<span class="op" id="4182198">(</span><span class="ident" id="4182199">c</span>&nbsp;<span class="op" id="4182201">*</span><span class="ident" id="4182202">UDPConn</span><span class="op" id="4182209">)</span>&nbsp;<span class="ident" id="4182211">WriteTo</span><span class="op" id="4182218">(</span><span class="ident" id="4182219">b</span>&nbsp;<span class="op" id="4182221">[</span><span class="op" id="4182222">]</span><span class="builtintype" id="4182223">byte</span><span class="op" id="4182227">,</span>&nbsp;<span class="ident" id="4182229">addr</span>&nbsp;<span class="ident" id="4182234">Addr</span><span class="op" id="4182238">)</span>&nbsp;<span class="op" id="4182240">(</span><span class="builtintype" id="4182241">int</span><span class="op" id="4182244">,</span>&nbsp;<span class="builtintype" id="4182246">error</span><span class="op" id="4182251">)</span>&nbsp;<span class="op" id="4182253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182256">if</span>&nbsp;<span class="op" id="4182259">!</span><span class="ident" id="4182260">c</span><span class="op" id="4182261">.</span><span class="ident" id="4182262">ok</span><span class="op" id="4182264">(</span><span class="op" id="4182265">)</span>&nbsp;<span class="op" id="4182267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182271">return</span>&nbsp;<span class="num" id="4182278">0</span><span class="op" id="4182279">,</span>&nbsp;<span class="ident" id="4182281">syscall</span><span class="op" id="4182288">.</span><span class="ident" id="4182289">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182297">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182300">a</span><span class="op" id="4182301">,</span>&nbsp;<span class="ident" id="4182303">ok</span>&nbsp;<span class="op" id="4182306">:=</span>&nbsp;<span class="ident" id="4182309">addr</span><span class="op" id="4182313">.</span><span class="op" id="4182314">(</span><span class="op" id="4182315">*</span><span class="ident" id="4182316">UDPAddr</span><span class="op" id="4182323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182326">if</span>&nbsp;<span class="op" id="4182329">!</span><span class="ident" id="4182330">ok</span>&nbsp;<span class="op" id="4182333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182337">return</span>&nbsp;<span class="num" id="4182344">0</span><span class="op" id="4182345">,</span>&nbsp;<span class="op" id="4182347">&amp;</span><span class="ident" id="4182348">OpError</span><span class="op" id="4182355">{</span><span class="string" id="4182356">&#34;write&#34;</span><span class="op" id="4182363">,</span>&nbsp;<span class="ident" id="4182365">c</span><span class="op" id="4182366">.</span><span class="ident" id="4182367">fd</span><span class="op" id="4182369">.</span><span class="ident" id="4182370">net</span><span class="op" id="4182373">,</span>&nbsp;<span class="ident" id="4182375">addr</span><span class="op" id="4182379">,</span>&nbsp;<span class="ident" id="4182381">syscall</span><span class="op" id="4182388">.</span><span class="ident" id="4182389">EINVAL</span><span class="op" id="4182395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182401">return</span>&nbsp;<span class="ident" id="4182408">c</span><span class="op" id="4182409">.</span><span class="ident" id="4182410">WriteToUDP</span><span class="op" id="4182420">(</span><span class="ident" id="4182421">b</span><span class="op" id="4182422">,</span>&nbsp;<span class="ident" id="4182424">a</span><span class="op" id="4182425">)</span><br>
<span class="lineno">140</span><span class="op" id="4182427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4182430">//&nbsp;WriteMsgUDP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4182501">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4182568">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">145</span><span class="keyword" id="4182620">func</span>&nbsp;<span class="op" id="4182625">(</span><span class="ident" id="4182626">c</span>&nbsp;<span class="op" id="4182628">*</span><span class="ident" id="4182629">UDPConn</span><span class="op" id="4182636">)</span>&nbsp;<span class="ident" id="4182638">WriteMsgUDP</span><span class="op" id="4182649">(</span><span class="ident" id="4182650">b</span><span class="op" id="4182651">,</span>&nbsp;<span class="ident" id="4182653">oob</span>&nbsp;<span class="op" id="4182657">[</span><span class="op" id="4182658">]</span><span class="builtintype" id="4182659">byte</span><span class="op" id="4182663">,</span>&nbsp;<span class="ident" id="4182665">addr</span>&nbsp;<span class="op" id="4182670">*</span><span class="ident" id="4182671">UDPAddr</span><span class="op" id="4182678">)</span>&nbsp;<span class="op" id="4182680">(</span><span class="ident" id="4182681">n</span><span class="op" id="4182682">,</span>&nbsp;<span class="ident" id="4182684">oobn</span>&nbsp;<span class="builtintype" id="4182689">int</span><span class="op" id="4182692">,</span>&nbsp;<span class="ident" id="4182694">err</span>&nbsp;<span class="builtintype" id="4182698">error</span><span class="op" id="4182703">)</span>&nbsp;<span class="op" id="4182705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182708">if</span>&nbsp;<span class="op" id="4182711">!</span><span class="ident" id="4182712">c</span><span class="op" id="4182713">.</span><span class="ident" id="4182714">ok</span><span class="op" id="4182716">(</span><span class="op" id="4182717">)</span>&nbsp;<span class="op" id="4182719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182723">return</span>&nbsp;<span class="num" id="4182730">0</span><span class="op" id="4182731">,</span>&nbsp;<span class="num" id="4182733">0</span><span class="op" id="4182734">,</span>&nbsp;<span class="ident" id="4182736">syscall</span><span class="op" id="4182743">.</span><span class="ident" id="4182744">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182755">if</span>&nbsp;<span class="ident" id="4182758">c</span><span class="op" id="4182759">.</span><span class="ident" id="4182760">fd</span><span class="op" id="4182762">.</span><span class="ident" id="4182763">isConnected</span>&nbsp;<span class="op" id="4182775">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182779">return</span>&nbsp;<span class="num" id="4182786">0</span><span class="op" id="4182787">,</span>&nbsp;<span class="num" id="4182789">0</span><span class="op" id="4182790">,</span>&nbsp;<span class="op" id="4182792">&amp;</span><span class="ident" id="4182793">OpError</span><span class="op" id="4182800">{</span><span class="string" id="4182801">&#34;write&#34;</span><span class="op" id="4182808">,</span>&nbsp;<span class="ident" id="4182810">c</span><span class="op" id="4182811">.</span><span class="ident" id="4182812">fd</span><span class="op" id="4182814">.</span><span class="ident" id="4182815">net</span><span class="op" id="4182818">,</span>&nbsp;<span class="ident" id="4182820">addr</span><span class="op" id="4182824">,</span>&nbsp;<span class="ident" id="4182826">ErrWriteToConnected</span><span class="op" id="4182845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182851">if</span>&nbsp;<span class="ident" id="4182854">addr</span>&nbsp;<span class="op" id="4182859">==</span>&nbsp;<span class="ident" id="4182862">nil</span>&nbsp;<span class="op" id="4182866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182870">return</span>&nbsp;<span class="num" id="4182877">0</span><span class="op" id="4182878">,</span>&nbsp;<span class="num" id="4182880">0</span><span class="op" id="4182881">,</span>&nbsp;<span class="op" id="4182883">&amp;</span><span class="ident" id="4182884">OpError</span><span class="op" id="4182891">{</span><span class="ident" id="4182892">Op</span><span class="op" id="4182894">:</span>&nbsp;<span class="string" id="4182896">&#34;write&#34;</span><span class="op" id="4182903">,</span>&nbsp;<span class="ident" id="4182905">Net</span><span class="op" id="4182908">:</span>&nbsp;<span class="ident" id="4182910">c</span><span class="op" id="4182911">.</span><span class="ident" id="4182912">fd</span><span class="op" id="4182914">.</span><span class="ident" id="4182915">net</span><span class="op" id="4182918">,</span>&nbsp;<span class="ident" id="4182920">Addr</span><span class="op" id="4182924">:</span>&nbsp;<span class="ident" id="4182926">nil</span><span class="op" id="4182929">,</span>&nbsp;<span class="ident" id="4182931">Err</span><span class="op" id="4182934">:</span>&nbsp;<span class="ident" id="4182936">errMissingAddress</span><span class="op" id="4182953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182956">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182959">sa</span><span class="op" id="4182961">,</span>&nbsp;<span class="ident" id="4182963">err</span>&nbsp;<span class="op" id="4182967">:=</span>&nbsp;<span class="ident" id="4182970">addr</span><span class="op" id="4182974">.</span><span class="ident" id="4182975">sockaddr</span><span class="op" id="4182983">(</span><span class="ident" id="4182984">c</span><span class="op" id="4182985">.</span><span class="ident" id="4182986">fd</span><span class="op" id="4182988">.</span><span class="ident" id="4182989">family</span><span class="op" id="4182995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182998">if</span>&nbsp;<span class="ident" id="4183001">err</span>&nbsp;<span class="op" id="4183005">!=</span>&nbsp;<span class="ident" id="4183008">nil</span>&nbsp;<span class="op" id="4183012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183016">return</span>&nbsp;<span class="num" id="4183023">0</span><span class="op" id="4183024">,</span>&nbsp;<span class="num" id="4183026">0</span><span class="op" id="4183027">,</span>&nbsp;<span class="op" id="4183029">&amp;</span><span class="ident" id="4183030">OpError</span><span class="op" id="4183037">{</span><span class="string" id="4183038">&#34;write&#34;</span><span class="op" id="4183045">,</span>&nbsp;<span class="ident" id="4183047">c</span><span class="op" id="4183048">.</span><span class="ident" id="4183049">fd</span><span class="op" id="4183051">.</span><span class="ident" id="4183052">net</span><span class="op" id="4183055">,</span>&nbsp;<span class="ident" id="4183057">addr</span><span class="op" id="4183061">,</span>&nbsp;<span class="ident" id="4183063">err</span><span class="op" id="4183066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183072">return</span>&nbsp;<span class="ident" id="4183079">c</span><span class="op" id="4183080">.</span><span class="ident" id="4183081">fd</span><span class="op" id="4183083">.</span><span class="ident" id="4183084">writeMsg</span><span class="op" id="4183092">(</span><span class="ident" id="4183093">b</span><span class="op" id="4183094">,</span>&nbsp;<span class="ident" id="4183096">oob</span><span class="op" id="4183099">,</span>&nbsp;<span class="ident" id="4183101">sa</span><span class="op" id="4183103">)</span><br>
<span class="lineno">160</span><span class="op" id="4183105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4183108">//&nbsp;DialUDP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="4183176">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4183247">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno">165</span><span class="keyword" id="4183296">func</span>&nbsp;<span class="ident" id="4183301">DialUDP</span><span class="op" id="4183308">(</span><span class="ident" id="4183309">net</span>&nbsp;<span class="builtintype" id="4183313">string</span><span class="op" id="4183319">,</span>&nbsp;<span class="ident" id="4183321">laddr</span><span class="op" id="4183326">,</span>&nbsp;<span class="ident" id="4183328">raddr</span>&nbsp;<span class="op" id="4183334">*</span><span class="ident" id="4183335">UDPAddr</span><span class="op" id="4183342">)</span>&nbsp;<span class="op" id="4183344">(</span><span class="op" id="4183345">*</span><span class="ident" id="4183346">UDPConn</span><span class="op" id="4183353">,</span>&nbsp;<span class="builtintype" id="4183355">error</span><span class="op" id="4183360">)</span>&nbsp;<span class="op" id="4183362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183365">switch</span>&nbsp;<span class="ident" id="4183372">net</span>&nbsp;<span class="op" id="4183376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183379">case</span>&nbsp;<span class="string" id="4183384">&#34;udp&#34;</span><span class="op" id="4183389">,</span>&nbsp;<span class="string" id="4183391">&#34;udp4&#34;</span><span class="op" id="4183397">,</span>&nbsp;<span class="string" id="4183399">&#34;udp6&#34;</span><span class="op" id="4183405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183408">default</span><span class="op" id="4183415">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183419">return</span>&nbsp;<span class="ident" id="4183426">nil</span><span class="op" id="4183429">,</span>&nbsp;<span class="op" id="4183431">&amp;</span><span class="ident" id="4183432">OpError</span><span class="op" id="4183439">{</span><span class="ident" id="4183440">Op</span><span class="op" id="4183442">:</span>&nbsp;<span class="string" id="4183444">&#34;dial&#34;</span><span class="op" id="4183450">,</span>&nbsp;<span class="ident" id="4183452">Net</span><span class="op" id="4183455">:</span>&nbsp;<span class="ident" id="4183457">net</span><span class="op" id="4183460">,</span>&nbsp;<span class="ident" id="4183462">Addr</span><span class="op" id="4183466">:</span>&nbsp;<span class="ident" id="4183468">raddr</span><span class="op" id="4183473">,</span>&nbsp;<span class="ident" id="4183475">Err</span><span class="op" id="4183478">:</span>&nbsp;<span class="ident" id="4183480">UnknownNetworkError</span><span class="op" id="4183499">(</span><span class="ident" id="4183500">net</span><span class="op" id="4183503">)</span><span class="op" id="4183504">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183510">if</span>&nbsp;<span class="ident" id="4183513">raddr</span>&nbsp;<span class="op" id="4183519">==</span>&nbsp;<span class="ident" id="4183522">nil</span>&nbsp;<span class="op" id="4183526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183530">return</span>&nbsp;<span class="ident" id="4183537">nil</span><span class="op" id="4183540">,</span>&nbsp;<span class="op" id="4183542">&amp;</span><span class="ident" id="4183543">OpError</span><span class="op" id="4183550">{</span><span class="ident" id="4183551">Op</span><span class="op" id="4183553">:</span>&nbsp;<span class="string" id="4183555">&#34;dial&#34;</span><span class="op" id="4183561">,</span>&nbsp;<span class="ident" id="4183563">Net</span><span class="op" id="4183566">:</span>&nbsp;<span class="ident" id="4183568">net</span><span class="op" id="4183571">,</span>&nbsp;<span class="ident" id="4183573">Addr</span><span class="op" id="4183577">:</span>&nbsp;<span class="ident" id="4183579">nil</span><span class="op" id="4183582">,</span>&nbsp;<span class="ident" id="4183584">Err</span><span class="op" id="4183587">:</span>&nbsp;<span class="ident" id="4183589">errMissingAddress</span><span class="op" id="4183606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183612">return</span>&nbsp;<span class="ident" id="4183619">dialUDP</span><span class="op" id="4183626">(</span><span class="ident" id="4183627">net</span><span class="op" id="4183630">,</span>&nbsp;<span class="ident" id="4183632">laddr</span><span class="op" id="4183637">,</span>&nbsp;<span class="ident" id="4183639">raddr</span><span class="op" id="4183644">,</span>&nbsp;<span class="ident" id="4183646">noDeadline</span><span class="op" id="4183656">)</span><br>
<span class="lineno">175</span><span class="op" id="4183658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4183661">func</span>&nbsp;<span class="ident" id="4183666">dialUDP</span><span class="op" id="4183673">(</span><span class="ident" id="4183674">net</span>&nbsp;<span class="builtintype" id="4183678">string</span><span class="op" id="4183684">,</span>&nbsp;<span class="ident" id="4183686">laddr</span><span class="op" id="4183691">,</span>&nbsp;<span class="ident" id="4183693">raddr</span>&nbsp;<span class="op" id="4183699">*</span><span class="ident" id="4183700">UDPAddr</span><span class="op" id="4183707">,</span>&nbsp;<span class="ident" id="4183709">deadline</span>&nbsp;<span class="ident" id="4183718">time</span><span class="op" id="4183722">.</span><span class="ident" id="4183723">Time</span><span class="op" id="4183727">)</span>&nbsp;<span class="op" id="4183729">(</span><span class="op" id="4183730">*</span><span class="ident" id="4183731">UDPConn</span><span class="op" id="4183738">,</span>&nbsp;<span class="builtintype" id="4183740">error</span><span class="op" id="4183745">)</span>&nbsp;<span class="op" id="4183747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183750">fd</span><span class="op" id="4183752">,</span>&nbsp;<span class="ident" id="4183754">err</span>&nbsp;<span class="op" id="4183758">:=</span>&nbsp;<span class="ident" id="4183761">internetSocket</span><span class="op" id="4183775">(</span><span class="ident" id="4183776">net</span><span class="op" id="4183779">,</span>&nbsp;<span class="ident" id="4183781">laddr</span><span class="op" id="4183786">,</span>&nbsp;<span class="ident" id="4183788">raddr</span><span class="op" id="4183793">,</span>&nbsp;<span class="ident" id="4183795">deadline</span><span class="op" id="4183803">,</span>&nbsp;<span class="ident" id="4183805">syscall</span><span class="op" id="4183812">.</span><span class="ident" id="4183813">SOCK_DGRAM</span><span class="op" id="4183823">,</span>&nbsp;<span class="num" id="4183825">0</span><span class="op" id="4183826">,</span>&nbsp;<span class="string" id="4183828">&#34;dial&#34;</span><span class="op" id="4183834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183837">if</span>&nbsp;<span class="ident" id="4183840">err</span>&nbsp;<span class="op" id="4183844">!=</span>&nbsp;<span class="ident" id="4183847">nil</span>&nbsp;<span class="op" id="4183851">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183855">return</span>&nbsp;<span class="ident" id="4183862">nil</span><span class="op" id="4183865">,</span>&nbsp;<span class="op" id="4183867">&amp;</span><span class="ident" id="4183868">OpError</span><span class="op" id="4183875">{</span><span class="ident" id="4183876">Op</span><span class="op" id="4183878">:</span>&nbsp;<span class="string" id="4183880">&#34;dial&#34;</span><span class="op" id="4183886">,</span>&nbsp;<span class="ident" id="4183888">Net</span><span class="op" id="4183891">:</span>&nbsp;<span class="ident" id="4183893">net</span><span class="op" id="4183896">,</span>&nbsp;<span class="ident" id="4183898">Addr</span><span class="op" id="4183902">:</span>&nbsp;<span class="ident" id="4183904">raddr</span><span class="op" id="4183909">,</span>&nbsp;<span class="ident" id="4183911">Err</span><span class="op" id="4183914">:</span>&nbsp;<span class="ident" id="4183916">err</span><span class="op" id="4183919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183925">return</span>&nbsp;<span class="ident" id="4183932">newUDPConn</span><span class="op" id="4183942">(</span><span class="ident" id="4183943">fd</span><span class="op" id="4183945">)</span><span class="op" id="4183946">,</span>&nbsp;<span class="ident" id="4183948">nil</span><br>
<span class="lineno"></span><span class="op" id="4183952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="4183955">//&nbsp;ListenUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;UDP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="4184024">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="4184095">//&nbsp;a&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenUDP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.</span><br>
<span class="lineno"></span><span class="comment" id="4184152">//&nbsp;The&nbsp;LocalAddr&nbsp;method&nbsp;of&nbsp;the&nbsp;returned&nbsp;UDPConn&nbsp;can&nbsp;be&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4184215">//&nbsp;discover&nbsp;the&nbsp;port.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">190</span><span class="comment" id="4184285">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;UDP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="4184356">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="4184371">func</span>&nbsp;<span class="ident" id="4184376">ListenUDP</span><span class="op" id="4184385">(</span><span class="ident" id="4184386">net</span>&nbsp;<span class="builtintype" id="4184390">string</span><span class="op" id="4184396">,</span>&nbsp;<span class="ident" id="4184398">laddr</span>&nbsp;<span class="op" id="4184404">*</span><span class="ident" id="4184405">UDPAddr</span><span class="op" id="4184412">)</span>&nbsp;<span class="op" id="4184414">(</span><span class="op" id="4184415">*</span><span class="ident" id="4184416">UDPConn</span><span class="op" id="4184423">,</span>&nbsp;<span class="builtintype" id="4184425">error</span><span class="op" id="4184430">)</span>&nbsp;<span class="op" id="4184432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184435">switch</span>&nbsp;<span class="ident" id="4184442">net</span>&nbsp;<span class="op" id="4184446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184449">case</span>&nbsp;<span class="string" id="4184454">&#34;udp&#34;</span><span class="op" id="4184459">,</span>&nbsp;<span class="string" id="4184461">&#34;udp4&#34;</span><span class="op" id="4184467">,</span>&nbsp;<span class="string" id="4184469">&#34;udp6&#34;</span><span class="op" id="4184475">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184478">default</span><span class="op" id="4184485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184489">return</span>&nbsp;<span class="ident" id="4184496">nil</span><span class="op" id="4184499">,</span>&nbsp;<span class="op" id="4184501">&amp;</span><span class="ident" id="4184502">OpError</span><span class="op" id="4184509">{</span><span class="ident" id="4184510">Op</span><span class="op" id="4184512">:</span>&nbsp;<span class="string" id="4184514">&#34;listen&#34;</span><span class="op" id="4184522">,</span>&nbsp;<span class="ident" id="4184524">Net</span><span class="op" id="4184527">:</span>&nbsp;<span class="ident" id="4184529">net</span><span class="op" id="4184532">,</span>&nbsp;<span class="ident" id="4184534">Addr</span><span class="op" id="4184538">:</span>&nbsp;<span class="ident" id="4184540">laddr</span><span class="op" id="4184545">,</span>&nbsp;<span class="ident" id="4184547">Err</span><span class="op" id="4184550">:</span>&nbsp;<span class="ident" id="4184552">UnknownNetworkError</span><span class="op" id="4184571">(</span><span class="ident" id="4184572">net</span><span class="op" id="4184575">)</span><span class="op" id="4184576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4184579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184582">if</span>&nbsp;<span class="ident" id="4184585">laddr</span>&nbsp;<span class="op" id="4184591">==</span>&nbsp;<span class="ident" id="4184594">nil</span>&nbsp;<span class="op" id="4184598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184602">laddr</span>&nbsp;<span class="op" id="4184608">=</span>&nbsp;<span class="op" id="4184610">&amp;</span><span class="ident" id="4184611">UDPAddr</span><span class="op" id="4184618">{</span><span class="op" id="4184619">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4184622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184625">fd</span><span class="op" id="4184627">,</span>&nbsp;<span class="ident" id="4184629">err</span>&nbsp;<span class="op" id="4184633">:=</span>&nbsp;<span class="ident" id="4184636">internetSocket</span><span class="op" id="4184650">(</span><span class="ident" id="4184651">net</span><span class="op" id="4184654">,</span>&nbsp;<span class="ident" id="4184656">laddr</span><span class="op" id="4184661">,</span>&nbsp;<span class="ident" id="4184663">nil</span><span class="op" id="4184666">,</span>&nbsp;<span class="ident" id="4184668">noDeadline</span><span class="op" id="4184678">,</span>&nbsp;<span class="ident" id="4184680">syscall</span><span class="op" id="4184687">.</span><span class="ident" id="4184688">SOCK_DGRAM</span><span class="op" id="4184698">,</span>&nbsp;<span class="num" id="4184700">0</span><span class="op" id="4184701">,</span>&nbsp;<span class="string" id="4184703">&#34;listen&#34;</span><span class="op" id="4184711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184714">if</span>&nbsp;<span class="ident" id="4184717">err</span>&nbsp;<span class="op" id="4184721">!=</span>&nbsp;<span class="ident" id="4184724">nil</span>&nbsp;<span class="op" id="4184728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184732">return</span>&nbsp;<span class="ident" id="4184739">nil</span><span class="op" id="4184742">,</span>&nbsp;<span class="op" id="4184744">&amp;</span><span class="ident" id="4184745">OpError</span><span class="op" id="4184752">{</span><span class="ident" id="4184753">Op</span><span class="op" id="4184755">:</span>&nbsp;<span class="string" id="4184757">&#34;listen&#34;</span><span class="op" id="4184765">,</span>&nbsp;<span class="ident" id="4184767">Net</span><span class="op" id="4184770">:</span>&nbsp;<span class="ident" id="4184772">net</span><span class="op" id="4184775">,</span>&nbsp;<span class="ident" id="4184777">Addr</span><span class="op" id="4184781">:</span>&nbsp;<span class="ident" id="4184783">laddr</span><span class="op" id="4184788">,</span>&nbsp;<span class="ident" id="4184790">Err</span><span class="op" id="4184793">:</span>&nbsp;<span class="ident" id="4184795">err</span><span class="op" id="4184798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4184801">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184804">return</span>&nbsp;<span class="ident" id="4184811">newUDPConn</span><span class="op" id="4184821">(</span><span class="ident" id="4184822">fd</span><span class="op" id="4184824">)</span><span class="op" id="4184825">,</span>&nbsp;<span class="ident" id="4184827">nil</span><br>
<span class="lineno"></span><span class="op" id="4184831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4184834">//&nbsp;ListenMulticastUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;multicast&nbsp;UDP&nbsp;packets</span><br>
<span class="lineno"></span><span class="comment" id="4184899">//&nbsp;addressed&nbsp;to&nbsp;the&nbsp;group&nbsp;address&nbsp;gaddr&nbsp;on&nbsp;ifi,&nbsp;which&nbsp;specifies&nbsp;the</span><br>
<span class="lineno">210</span><span class="comment" id="4184967">//&nbsp;interface&nbsp;to&nbsp;join.&nbsp;&nbsp;ListenMulticastUDP&nbsp;uses&nbsp;default&nbsp;multicast</span><br>
<span class="lineno"></span><span class="comment" id="4185032">//&nbsp;interface&nbsp;if&nbsp;ifi&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4185060">func</span>&nbsp;<span class="ident" id="4185065">ListenMulticastUDP</span><span class="op" id="4185083">(</span><span class="ident" id="4185084">net</span>&nbsp;<span class="builtintype" id="4185088">string</span><span class="op" id="4185094">,</span>&nbsp;<span class="ident" id="4185096">ifi</span>&nbsp;<span class="op" id="4185100">*</span><span class="ident" id="4185101">Interface</span><span class="op" id="4185110">,</span>&nbsp;<span class="ident" id="4185112">gaddr</span>&nbsp;<span class="op" id="4185118">*</span><span class="ident" id="4185119">UDPAddr</span><span class="op" id="4185126">)</span>&nbsp;<span class="op" id="4185128">(</span><span class="op" id="4185129">*</span><span class="ident" id="4185130">UDPConn</span><span class="op" id="4185137">,</span>&nbsp;<span class="builtintype" id="4185139">error</span><span class="op" id="4185144">)</span>&nbsp;<span class="op" id="4185146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185149">switch</span>&nbsp;<span class="ident" id="4185156">net</span>&nbsp;<span class="op" id="4185160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185163">case</span>&nbsp;<span class="string" id="4185168">&#34;udp&#34;</span><span class="op" id="4185173">,</span>&nbsp;<span class="string" id="4185175">&#34;udp4&#34;</span><span class="op" id="4185181">,</span>&nbsp;<span class="string" id="4185183">&#34;udp6&#34;</span><span class="op" id="4185189">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185192">default</span><span class="op" id="4185199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185203">return</span>&nbsp;<span class="ident" id="4185210">nil</span><span class="op" id="4185213">,</span>&nbsp;<span class="op" id="4185215">&amp;</span><span class="ident" id="4185216">OpError</span><span class="op" id="4185223">{</span><span class="ident" id="4185224">Op</span><span class="op" id="4185226">:</span>&nbsp;<span class="string" id="4185228">&#34;listen&#34;</span><span class="op" id="4185236">,</span>&nbsp;<span class="ident" id="4185238">Net</span><span class="op" id="4185241">:</span>&nbsp;<span class="ident" id="4185243">net</span><span class="op" id="4185246">,</span>&nbsp;<span class="ident" id="4185248">Addr</span><span class="op" id="4185252">:</span>&nbsp;<span class="ident" id="4185254">gaddr</span><span class="op" id="4185259">,</span>&nbsp;<span class="ident" id="4185261">Err</span><span class="op" id="4185264">:</span>&nbsp;<span class="ident" id="4185266">UnknownNetworkError</span><span class="op" id="4185285">(</span><span class="ident" id="4185286">net</span><span class="op" id="4185289">)</span><span class="op" id="4185290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185296">if</span>&nbsp;<span class="ident" id="4185299">gaddr</span>&nbsp;<span class="op" id="4185305">==</span>&nbsp;<span class="ident" id="4185308">nil</span>&nbsp;<span class="op" id="4185312">||</span>&nbsp;<span class="ident" id="4185315">gaddr</span><span class="op" id="4185320">.</span><span class="ident" id="4185321">IP</span>&nbsp;<span class="op" id="4185324">==</span>&nbsp;<span class="ident" id="4185327">nil</span>&nbsp;<span class="op" id="4185331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185335">return</span>&nbsp;<span class="ident" id="4185342">nil</span><span class="op" id="4185345">,</span>&nbsp;<span class="op" id="4185347">&amp;</span><span class="ident" id="4185348">OpError</span><span class="op" id="4185355">{</span><span class="ident" id="4185356">Op</span><span class="op" id="4185358">:</span>&nbsp;<span class="string" id="4185360">&#34;listen&#34;</span><span class="op" id="4185368">,</span>&nbsp;<span class="ident" id="4185370">Net</span><span class="op" id="4185373">:</span>&nbsp;<span class="ident" id="4185375">net</span><span class="op" id="4185378">,</span>&nbsp;<span class="ident" id="4185380">Addr</span><span class="op" id="4185384">:</span>&nbsp;<span class="ident" id="4185386">nil</span><span class="op" id="4185389">,</span>&nbsp;<span class="ident" id="4185391">Err</span><span class="op" id="4185394">:</span>&nbsp;<span class="ident" id="4185396">errMissingAddress</span><span class="op" id="4185413">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185419">fd</span><span class="op" id="4185421">,</span>&nbsp;<span class="ident" id="4185423">err</span>&nbsp;<span class="op" id="4185427">:=</span>&nbsp;<span class="ident" id="4185430">internetSocket</span><span class="op" id="4185444">(</span><span class="ident" id="4185445">net</span><span class="op" id="4185448">,</span>&nbsp;<span class="ident" id="4185450">gaddr</span><span class="op" id="4185455">,</span>&nbsp;<span class="ident" id="4185457">nil</span><span class="op" id="4185460">,</span>&nbsp;<span class="ident" id="4185462">noDeadline</span><span class="op" id="4185472">,</span>&nbsp;<span class="ident" id="4185474">syscall</span><span class="op" id="4185481">.</span><span class="ident" id="4185482">SOCK_DGRAM</span><span class="op" id="4185492">,</span>&nbsp;<span class="num" id="4185494">0</span><span class="op" id="4185495">,</span>&nbsp;<span class="string" id="4185497">&#34;listen&#34;</span><span class="op" id="4185505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185508">if</span>&nbsp;<span class="ident" id="4185511">err</span>&nbsp;<span class="op" id="4185515">!=</span>&nbsp;<span class="ident" id="4185518">nil</span>&nbsp;<span class="op" id="4185522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185526">return</span>&nbsp;<span class="ident" id="4185533">nil</span><span class="op" id="4185536">,</span>&nbsp;<span class="op" id="4185538">&amp;</span><span class="ident" id="4185539">OpError</span><span class="op" id="4185546">{</span><span class="ident" id="4185547">Op</span><span class="op" id="4185549">:</span>&nbsp;<span class="string" id="4185551">&#34;listen&#34;</span><span class="op" id="4185559">,</span>&nbsp;<span class="ident" id="4185561">Net</span><span class="op" id="4185564">:</span>&nbsp;<span class="ident" id="4185566">net</span><span class="op" id="4185569">,</span>&nbsp;<span class="ident" id="4185571">Addr</span><span class="op" id="4185575">:</span>&nbsp;<span class="ident" id="4185577">gaddr</span><span class="op" id="4185582">,</span>&nbsp;<span class="ident" id="4185584">Err</span><span class="op" id="4185587">:</span>&nbsp;<span class="ident" id="4185589">err</span><span class="op" id="4185592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185595">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185598">c</span>&nbsp;<span class="op" id="4185600">:=</span>&nbsp;<span class="ident" id="4185603">newUDPConn</span><span class="op" id="4185613">(</span><span class="ident" id="4185614">fd</span><span class="op" id="4185616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185619">if</span>&nbsp;<span class="ident" id="4185622">ip4</span>&nbsp;<span class="op" id="4185626">:=</span>&nbsp;<span class="ident" id="4185629">gaddr</span><span class="op" id="4185634">.</span><span class="ident" id="4185635">IP</span><span class="op" id="4185637">.</span><span class="ident" id="4185638">To4</span><span class="op" id="4185641">(</span><span class="op" id="4185642">)</span><span class="op" id="4185643">;</span>&nbsp;<span class="ident" id="4185645">ip4</span>&nbsp;<span class="op" id="4185649">!=</span>&nbsp;<span class="ident" id="4185652">nil</span>&nbsp;<span class="op" id="4185656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185660">if</span>&nbsp;<span class="ident" id="4185663">err</span>&nbsp;<span class="op" id="4185667">:=</span>&nbsp;<span class="ident" id="4185670">listenIPv4MulticastUDP</span><span class="op" id="4185692">(</span><span class="ident" id="4185693">c</span><span class="op" id="4185694">,</span>&nbsp;<span class="ident" id="4185696">ifi</span><span class="op" id="4185699">,</span>&nbsp;<span class="ident" id="4185701">ip4</span><span class="op" id="4185704">)</span><span class="op" id="4185705">;</span>&nbsp;<span class="ident" id="4185707">err</span>&nbsp;<span class="op" id="4185711">!=</span>&nbsp;<span class="ident" id="4185714">nil</span>&nbsp;<span class="op" id="4185718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185723">c</span><span class="op" id="4185724">.</span><span class="ident" id="4185725">Close</span><span class="op" id="4185730">(</span><span class="op" id="4185731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185736">return</span>&nbsp;<span class="ident" id="4185743">nil</span><span class="op" id="4185746">,</span>&nbsp;<span class="op" id="4185748">&amp;</span><span class="ident" id="4185749">OpError</span><span class="op" id="4185756">{</span><span class="ident" id="4185757">Op</span><span class="op" id="4185759">:</span>&nbsp;<span class="string" id="4185761">&#34;listen&#34;</span><span class="op" id="4185769">,</span>&nbsp;<span class="ident" id="4185771">Net</span><span class="op" id="4185774">:</span>&nbsp;<span class="ident" id="4185776">net</span><span class="op" id="4185779">,</span>&nbsp;<span class="ident" id="4185781">Addr</span><span class="op" id="4185785">:</span>&nbsp;<span class="op" id="4185787">&amp;</span><span class="ident" id="4185788">IPAddr</span><span class="op" id="4185794">{</span><span class="ident" id="4185795">IP</span><span class="op" id="4185797">:</span>&nbsp;<span class="ident" id="4185799">ip4</span><span class="op" id="4185802">}</span><span class="op" id="4185803">,</span>&nbsp;<span class="ident" id="4185805">Err</span><span class="op" id="4185808">:</span>&nbsp;<span class="ident" id="4185810">err</span><span class="op" id="4185813">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185820">}</span>&nbsp;<span class="keyword" id="4185822">else</span>&nbsp;<span class="op" id="4185827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185831">if</span>&nbsp;<span class="ident" id="4185834">err</span>&nbsp;<span class="op" id="4185838">:=</span>&nbsp;<span class="ident" id="4185841">listenIPv6MulticastUDP</span><span class="op" id="4185863">(</span><span class="ident" id="4185864">c</span><span class="op" id="4185865">,</span>&nbsp;<span class="ident" id="4185867">ifi</span><span class="op" id="4185870">,</span>&nbsp;<span class="ident" id="4185872">gaddr</span><span class="op" id="4185877">.</span><span class="ident" id="4185878">IP</span><span class="op" id="4185880">)</span><span class="op" id="4185881">;</span>&nbsp;<span class="ident" id="4185883">err</span>&nbsp;<span class="op" id="4185887">!=</span>&nbsp;<span class="ident" id="4185890">nil</span>&nbsp;<span class="op" id="4185894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185899">c</span><span class="op" id="4185900">.</span><span class="ident" id="4185901">Close</span><span class="op" id="4185906">(</span><span class="op" id="4185907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185912">return</span>&nbsp;<span class="ident" id="4185919">nil</span><span class="op" id="4185922">,</span>&nbsp;<span class="op" id="4185924">&amp;</span><span class="ident" id="4185925">OpError</span><span class="op" id="4185932">{</span><span class="ident" id="4185933">Op</span><span class="op" id="4185935">:</span>&nbsp;<span class="string" id="4185937">&#34;listen&#34;</span><span class="op" id="4185945">,</span>&nbsp;<span class="ident" id="4185947">Net</span><span class="op" id="4185950">:</span>&nbsp;<span class="ident" id="4185952">net</span><span class="op" id="4185955">,</span>&nbsp;<span class="ident" id="4185957">Addr</span><span class="op" id="4185961">:</span>&nbsp;<span class="op" id="4185963">&amp;</span><span class="ident" id="4185964">IPAddr</span><span class="op" id="4185970">{</span><span class="ident" id="4185971">IP</span><span class="op" id="4185973">:</span>&nbsp;<span class="ident" id="4185975">gaddr</span><span class="op" id="4185980">.</span><span class="ident" id="4185981">IP</span><span class="op" id="4185983">}</span><span class="op" id="4185984">,</span>&nbsp;<span class="ident" id="4185986">Err</span><span class="op" id="4185989">:</span>&nbsp;<span class="ident" id="4185991">err</span><span class="op" id="4185994">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186004">return</span>&nbsp;<span class="ident" id="4186011">c</span><span class="op" id="4186012">,</span>&nbsp;<span class="ident" id="4186014">nil</span><br>
<span class="lineno"></span><span class="op" id="4186018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="4186021">func</span>&nbsp;<span class="ident" id="4186026">listenIPv4MulticastUDP</span><span class="op" id="4186048">(</span><span class="ident" id="4186049">c</span>&nbsp;<span class="op" id="4186051">*</span><span class="ident" id="4186052">UDPConn</span><span class="op" id="4186059">,</span>&nbsp;<span class="ident" id="4186061">ifi</span>&nbsp;<span class="op" id="4186065">*</span><span class="ident" id="4186066">Interface</span><span class="op" id="4186075">,</span>&nbsp;<span class="ident" id="4186077">ip</span>&nbsp;<span class="ident" id="4186080">IP</span><span class="op" id="4186082">)</span>&nbsp;<span class="builtintype" id="4186084">error</span>&nbsp;<span class="op" id="4186090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186093">if</span>&nbsp;<span class="ident" id="4186096">ifi</span>&nbsp;<span class="op" id="4186100">!=</span>&nbsp;<span class="ident" id="4186103">nil</span>&nbsp;<span class="op" id="4186107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186111">if</span>&nbsp;<span class="ident" id="4186114">err</span>&nbsp;<span class="op" id="4186118">:=</span>&nbsp;<span class="ident" id="4186121">setIPv4MulticastInterface</span><span class="op" id="4186146">(</span><span class="ident" id="4186147">c</span><span class="op" id="4186148">.</span><span class="ident" id="4186149">fd</span><span class="op" id="4186151">,</span>&nbsp;<span class="ident" id="4186153">ifi</span><span class="op" id="4186156">)</span><span class="op" id="4186157">;</span>&nbsp;<span class="ident" id="4186159">err</span>&nbsp;<span class="op" id="4186163">!=</span>&nbsp;<span class="ident" id="4186166">nil</span>&nbsp;<span class="op" id="4186170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186175">return</span>&nbsp;<span class="ident" id="4186182">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186188">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186194">if</span>&nbsp;<span class="ident" id="4186197">err</span>&nbsp;<span class="op" id="4186201">:=</span>&nbsp;<span class="ident" id="4186204">setIPv4MulticastLoopback</span><span class="op" id="4186228">(</span><span class="ident" id="4186229">c</span><span class="op" id="4186230">.</span><span class="ident" id="4186231">fd</span><span class="op" id="4186233">,</span>&nbsp;<span class="builtintype" id="4186235">false</span><span class="op" id="4186240">)</span><span class="op" id="4186241">;</span>&nbsp;<span class="ident" id="4186243">err</span>&nbsp;<span class="op" id="4186247">!=</span>&nbsp;<span class="ident" id="4186250">nil</span>&nbsp;<span class="op" id="4186254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186258">return</span>&nbsp;<span class="ident" id="4186265">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186273">if</span>&nbsp;<span class="ident" id="4186276">err</span>&nbsp;<span class="op" id="4186280">:=</span>&nbsp;<span class="ident" id="4186283">joinIPv4Group</span><span class="op" id="4186296">(</span><span class="ident" id="4186297">c</span><span class="op" id="4186298">.</span><span class="ident" id="4186299">fd</span><span class="op" id="4186301">,</span>&nbsp;<span class="ident" id="4186303">ifi</span><span class="op" id="4186306">,</span>&nbsp;<span class="ident" id="4186308">ip</span><span class="op" id="4186310">)</span><span class="op" id="4186311">;</span>&nbsp;<span class="ident" id="4186313">err</span>&nbsp;<span class="op" id="4186317">!=</span>&nbsp;<span class="ident" id="4186320">nil</span>&nbsp;<span class="op" id="4186324">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186328">return</span>&nbsp;<span class="ident" id="4186335">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186343">return</span>&nbsp;<span class="ident" id="4186350">nil</span><br>
<span class="lineno"></span><span class="op" id="4186354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="4186357">func</span>&nbsp;<span class="ident" id="4186362">listenIPv6MulticastUDP</span><span class="op" id="4186384">(</span><span class="ident" id="4186385">c</span>&nbsp;<span class="op" id="4186387">*</span><span class="ident" id="4186388">UDPConn</span><span class="op" id="4186395">,</span>&nbsp;<span class="ident" id="4186397">ifi</span>&nbsp;<span class="op" id="4186401">*</span><span class="ident" id="4186402">Interface</span><span class="op" id="4186411">,</span>&nbsp;<span class="ident" id="4186413">ip</span>&nbsp;<span class="ident" id="4186416">IP</span><span class="op" id="4186418">)</span>&nbsp;<span class="builtintype" id="4186420">error</span>&nbsp;<span class="op" id="4186426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186429">if</span>&nbsp;<span class="ident" id="4186432">ifi</span>&nbsp;<span class="op" id="4186436">!=</span>&nbsp;<span class="ident" id="4186439">nil</span>&nbsp;<span class="op" id="4186443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186447">if</span>&nbsp;<span class="ident" id="4186450">err</span>&nbsp;<span class="op" id="4186454">:=</span>&nbsp;<span class="ident" id="4186457">setIPv6MulticastInterface</span><span class="op" id="4186482">(</span><span class="ident" id="4186483">c</span><span class="op" id="4186484">.</span><span class="ident" id="4186485">fd</span><span class="op" id="4186487">,</span>&nbsp;<span class="ident" id="4186489">ifi</span><span class="op" id="4186492">)</span><span class="op" id="4186493">;</span>&nbsp;<span class="ident" id="4186495">err</span>&nbsp;<span class="op" id="4186499">!=</span>&nbsp;<span class="ident" id="4186502">nil</span>&nbsp;<span class="op" id="4186506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186511">return</span>&nbsp;<span class="ident" id="4186518">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186524">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186530">if</span>&nbsp;<span class="ident" id="4186533">err</span>&nbsp;<span class="op" id="4186537">:=</span>&nbsp;<span class="ident" id="4186540">setIPv6MulticastLoopback</span><span class="op" id="4186564">(</span><span class="ident" id="4186565">c</span><span class="op" id="4186566">.</span><span class="ident" id="4186567">fd</span><span class="op" id="4186569">,</span>&nbsp;<span class="builtintype" id="4186571">false</span><span class="op" id="4186576">)</span><span class="op" id="4186577">;</span>&nbsp;<span class="ident" id="4186579">err</span>&nbsp;<span class="op" id="4186583">!=</span>&nbsp;<span class="ident" id="4186586">nil</span>&nbsp;<span class="op" id="4186590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186594">return</span>&nbsp;<span class="ident" id="4186601">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186609">if</span>&nbsp;<span class="ident" id="4186612">err</span>&nbsp;<span class="op" id="4186616">:=</span>&nbsp;<span class="ident" id="4186619">joinIPv6Group</span><span class="op" id="4186632">(</span><span class="ident" id="4186633">c</span><span class="op" id="4186634">.</span><span class="ident" id="4186635">fd</span><span class="op" id="4186637">,</span>&nbsp;<span class="ident" id="4186639">ifi</span><span class="op" id="4186642">,</span>&nbsp;<span class="ident" id="4186644">ip</span><span class="op" id="4186646">)</span><span class="op" id="4186647">;</span>&nbsp;<span class="ident" id="4186649">err</span>&nbsp;<span class="op" id="4186653">!=</span>&nbsp;<span class="ident" id="4186656">nil</span>&nbsp;<span class="op" id="4186660">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186664">return</span>&nbsp;<span class="ident" id="4186671">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186679">return</span>&nbsp;<span class="ident" id="4186686">nil</span><br>
<span class="lineno"></span><span class="op" id="4186690">}</span>
</div>
</body>
</html>
