<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4567872">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4567927">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4567981">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4568032">package</span>&nbsp;<span class="ident" id="4568040">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4568047">import</span>&nbsp;<span class="op" id="4568054">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4568057">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4568063">&#34;math&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4568070">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4568073">const</span>&nbsp;<span class="op" id="4568079">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4568082">//&nbsp;The&nbsp;largest&nbsp;offset&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568111">offsetCodeCount</span>&nbsp;<span class="op" id="4568127">=</span>&nbsp;<span class="num" id="4568129">30</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4568134">//&nbsp;The&nbsp;special&nbsp;code&nbsp;used&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568188">endBlockMarker</span>&nbsp;<span class="op" id="4568203">=</span>&nbsp;<span class="num" id="4568205">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4568211">//&nbsp;The&nbsp;first&nbsp;length&nbsp;code.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568238">lengthCodesStart</span>&nbsp;<span class="op" id="4568255">=</span>&nbsp;<span class="num" id="4568257">257</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4568263">//&nbsp;The&nbsp;number&nbsp;of&nbsp;codegen&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568296">codegenCodeCount</span>&nbsp;<span class="op" id="4568313">=</span>&nbsp;<span class="num" id="4568315">19</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568319">badCode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568336">=</span>&nbsp;<span class="num" id="4568338">255</span><br>
<span class="lineno">25</span><span class="op" id="4568342">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4568345">//&nbsp;The&nbsp;number&nbsp;of&nbsp;extra&nbsp;bits&nbsp;needed&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4568419">var</span>&nbsp;<span class="ident" id="4568423">lengthExtraBits</span>&nbsp;<span class="op" id="4568439">=</span>&nbsp;<span class="op" id="4568441">[</span><span class="op" id="4568442">]</span><span class="builtintype" id="4568443">int8</span><span class="op" id="4568447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4568450">/*&nbsp;257&nbsp;*/</span>&nbsp;<span class="num" id="4568460">0</span><span class="op" id="4568461">,</span>&nbsp;<span class="num" id="4568463">0</span><span class="op" id="4568464">,</span>&nbsp;<span class="num" id="4568466">0</span><span class="op" id="4568467">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4568470">/*&nbsp;260&nbsp;*/</span>&nbsp;<span class="num" id="4568480">0</span><span class="op" id="4568481">,</span>&nbsp;<span class="num" id="4568483">0</span><span class="op" id="4568484">,</span>&nbsp;<span class="num" id="4568486">0</span><span class="op" id="4568487">,</span>&nbsp;<span class="num" id="4568489">0</span><span class="op" id="4568490">,</span>&nbsp;<span class="num" id="4568492">0</span><span class="op" id="4568493">,</span>&nbsp;<span class="num" id="4568495">1</span><span class="op" id="4568496">,</span>&nbsp;<span class="num" id="4568498">1</span><span class="op" id="4568499">,</span>&nbsp;<span class="num" id="4568501">1</span><span class="op" id="4568502">,</span>&nbsp;<span class="num" id="4568504">1</span><span class="op" id="4568505">,</span>&nbsp;<span class="num" id="4568507">2</span><span class="op" id="4568508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4568511">/*&nbsp;270&nbsp;*/</span>&nbsp;<span class="num" id="4568521">2</span><span class="op" id="4568522">,</span>&nbsp;<span class="num" id="4568524">2</span><span class="op" id="4568525">,</span>&nbsp;<span class="num" id="4568527">2</span><span class="op" id="4568528">,</span>&nbsp;<span class="num" id="4568530">3</span><span class="op" id="4568531">,</span>&nbsp;<span class="num" id="4568533">3</span><span class="op" id="4568534">,</span>&nbsp;<span class="num" id="4568536">3</span><span class="op" id="4568537">,</span>&nbsp;<span class="num" id="4568539">3</span><span class="op" id="4568540">,</span>&nbsp;<span class="num" id="4568542">4</span><span class="op" id="4568543">,</span>&nbsp;<span class="num" id="4568545">4</span><span class="op" id="4568546">,</span>&nbsp;<span class="num" id="4568548">4</span><span class="op" id="4568549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4568552">/*&nbsp;280&nbsp;*/</span>&nbsp;<span class="num" id="4568562">4</span><span class="op" id="4568563">,</span>&nbsp;<span class="num" id="4568565">5</span><span class="op" id="4568566">,</span>&nbsp;<span class="num" id="4568568">5</span><span class="op" id="4568569">,</span>&nbsp;<span class="num" id="4568571">5</span><span class="op" id="4568572">,</span>&nbsp;<span class="num" id="4568574">5</span><span class="op" id="4568575">,</span>&nbsp;<span class="num" id="4568577">0</span><span class="op" id="4568578">,</span><br>
<span class="lineno"></span><span class="op" id="4568580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4568583">//&nbsp;The&nbsp;length&nbsp;indicated&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4568646">var</span>&nbsp;<span class="ident" id="4568650">lengthBase</span>&nbsp;<span class="op" id="4568661">=</span>&nbsp;<span class="op" id="4568663">[</span><span class="op" id="4568664">]</span><span class="builtintype" id="4568665">uint32</span><span class="op" id="4568671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4568674">0</span><span class="op" id="4568675">,</span>&nbsp;<span class="num" id="4568677">1</span><span class="op" id="4568678">,</span>&nbsp;<span class="num" id="4568680">2</span><span class="op" id="4568681">,</span>&nbsp;<span class="num" id="4568683">3</span><span class="op" id="4568684">,</span>&nbsp;<span class="num" id="4568686">4</span><span class="op" id="4568687">,</span>&nbsp;<span class="num" id="4568689">5</span><span class="op" id="4568690">,</span>&nbsp;<span class="num" id="4568692">6</span><span class="op" id="4568693">,</span>&nbsp;<span class="num" id="4568695">7</span><span class="op" id="4568696">,</span>&nbsp;<span class="num" id="4568698">8</span><span class="op" id="4568699">,</span>&nbsp;<span class="num" id="4568701">10</span><span class="op" id="4568703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4568706">12</span><span class="op" id="4568708">,</span>&nbsp;<span class="num" id="4568710">14</span><span class="op" id="4568712">,</span>&nbsp;<span class="num" id="4568714">16</span><span class="op" id="4568716">,</span>&nbsp;<span class="num" id="4568718">20</span><span class="op" id="4568720">,</span>&nbsp;<span class="num" id="4568722">24</span><span class="op" id="4568724">,</span>&nbsp;<span class="num" id="4568726">28</span><span class="op" id="4568728">,</span>&nbsp;<span class="num" id="4568730">32</span><span class="op" id="4568732">,</span>&nbsp;<span class="num" id="4568734">40</span><span class="op" id="4568736">,</span>&nbsp;<span class="num" id="4568738">48</span><span class="op" id="4568740">,</span>&nbsp;<span class="num" id="4568742">56</span><span class="op" id="4568744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4568747">64</span><span class="op" id="4568749">,</span>&nbsp;<span class="num" id="4568751">80</span><span class="op" id="4568753">,</span>&nbsp;<span class="num" id="4568755">96</span><span class="op" id="4568757">,</span>&nbsp;<span class="num" id="4568759">112</span><span class="op" id="4568762">,</span>&nbsp;<span class="num" id="4568764">128</span><span class="op" id="4568767">,</span>&nbsp;<span class="num" id="4568769">160</span><span class="op" id="4568772">,</span>&nbsp;<span class="num" id="4568774">192</span><span class="op" id="4568777">,</span>&nbsp;<span class="num" id="4568779">224</span><span class="op" id="4568782">,</span>&nbsp;<span class="num" id="4568784">255</span><span class="op" id="4568787">,</span><br>
<span class="lineno">40</span><span class="op" id="4568789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4568792">//&nbsp;offset&nbsp;code&nbsp;word&nbsp;extra&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4568824">var</span>&nbsp;<span class="ident" id="4568828">offsetExtraBits</span>&nbsp;<span class="op" id="4568844">=</span>&nbsp;<span class="op" id="4568846">[</span><span class="op" id="4568847">]</span><span class="builtintype" id="4568848">int8</span><span class="op" id="4568852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4568855">0</span><span class="op" id="4568856">,</span>&nbsp;<span class="num" id="4568858">0</span><span class="op" id="4568859">,</span>&nbsp;<span class="num" id="4568861">0</span><span class="op" id="4568862">,</span>&nbsp;<span class="num" id="4568864">0</span><span class="op" id="4568865">,</span>&nbsp;<span class="num" id="4568867">1</span><span class="op" id="4568868">,</span>&nbsp;<span class="num" id="4568870">1</span><span class="op" id="4568871">,</span>&nbsp;<span class="num" id="4568873">2</span><span class="op" id="4568874">,</span>&nbsp;<span class="num" id="4568876">2</span><span class="op" id="4568877">,</span>&nbsp;<span class="num" id="4568879">3</span><span class="op" id="4568880">,</span>&nbsp;<span class="num" id="4568882">3</span><span class="op" id="4568883">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4568886">4</span><span class="op" id="4568887">,</span>&nbsp;<span class="num" id="4568889">4</span><span class="op" id="4568890">,</span>&nbsp;<span class="num" id="4568892">5</span><span class="op" id="4568893">,</span>&nbsp;<span class="num" id="4568895">5</span><span class="op" id="4568896">,</span>&nbsp;<span class="num" id="4568898">6</span><span class="op" id="4568899">,</span>&nbsp;<span class="num" id="4568901">6</span><span class="op" id="4568902">,</span>&nbsp;<span class="num" id="4568904">7</span><span class="op" id="4568905">,</span>&nbsp;<span class="num" id="4568907">7</span><span class="op" id="4568908">,</span>&nbsp;<span class="num" id="4568910">8</span><span class="op" id="4568911">,</span>&nbsp;<span class="num" id="4568913">8</span><span class="op" id="4568914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4568917">9</span><span class="op" id="4568918">,</span>&nbsp;<span class="num" id="4568920">9</span><span class="op" id="4568921">,</span>&nbsp;<span class="num" id="4568923">10</span><span class="op" id="4568925">,</span>&nbsp;<span class="num" id="4568927">10</span><span class="op" id="4568929">,</span>&nbsp;<span class="num" id="4568931">11</span><span class="op" id="4568933">,</span>&nbsp;<span class="num" id="4568935">11</span><span class="op" id="4568937">,</span>&nbsp;<span class="num" id="4568939">12</span><span class="op" id="4568941">,</span>&nbsp;<span class="num" id="4568943">12</span><span class="op" id="4568945">,</span>&nbsp;<span class="num" id="4568947">13</span><span class="op" id="4568949">,</span>&nbsp;<span class="num" id="4568951">13</span><span class="op" id="4568953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4568956">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4568979">14</span><span class="op" id="4568981">,</span>&nbsp;<span class="num" id="4568983">14</span><span class="op" id="4568985">,</span>&nbsp;<span class="num" id="4568987">15</span><span class="op" id="4568989">,</span>&nbsp;<span class="num" id="4568991">15</span><span class="op" id="4568993">,</span>&nbsp;<span class="num" id="4568995">16</span><span class="op" id="4568997">,</span>&nbsp;<span class="num" id="4568999">16</span><span class="op" id="4569001">,</span>&nbsp;<span class="num" id="4569003">17</span><span class="op" id="4569005">,</span>&nbsp;<span class="num" id="4569007">17</span><span class="op" id="4569009">,</span>&nbsp;<span class="num" id="4569011">18</span><span class="op" id="4569013">,</span>&nbsp;<span class="num" id="4569015">18</span><span class="op" id="4569017">,</span>&nbsp;<span class="num" id="4569019">19</span><span class="op" id="4569021">,</span>&nbsp;<span class="num" id="4569023">19</span><span class="op" id="4569025">,</span>&nbsp;<span class="num" id="4569027">20</span><span class="op" id="4569029">,</span>&nbsp;<span class="num" id="4569031">20</span><span class="op" id="4569033">,</span><br>
<span class="lineno"></span><span class="op" id="4569035">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4569038">var</span>&nbsp;<span class="ident" id="4569042">offsetBase</span>&nbsp;<span class="op" id="4569053">=</span>&nbsp;<span class="op" id="4569055">[</span><span class="op" id="4569056">]</span><span class="builtintype" id="4569057">uint32</span><span class="op" id="4569063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4569066">/*&nbsp;normal&nbsp;deflate&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4569088">0x000000</span><span class="op" id="4569096">,</span>&nbsp;<span class="num" id="4569098">0x000001</span><span class="op" id="4569106">,</span>&nbsp;<span class="num" id="4569108">0x000002</span><span class="op" id="4569116">,</span>&nbsp;<span class="num" id="4569118">0x000003</span><span class="op" id="4569126">,</span>&nbsp;<span class="num" id="4569128">0x000004</span><span class="op" id="4569136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4569139">0x000006</span><span class="op" id="4569147">,</span>&nbsp;<span class="num" id="4569149">0x000008</span><span class="op" id="4569157">,</span>&nbsp;<span class="num" id="4569159">0x00000c</span><span class="op" id="4569167">,</span>&nbsp;<span class="num" id="4569169">0x000010</span><span class="op" id="4569177">,</span>&nbsp;<span class="num" id="4569179">0x000018</span><span class="op" id="4569187">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4569190">0x000020</span><span class="op" id="4569198">,</span>&nbsp;<span class="num" id="4569200">0x000030</span><span class="op" id="4569208">,</span>&nbsp;<span class="num" id="4569210">0x000040</span><span class="op" id="4569218">,</span>&nbsp;<span class="num" id="4569220">0x000060</span><span class="op" id="4569228">,</span>&nbsp;<span class="num" id="4569230">0x000080</span><span class="op" id="4569238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4569241">0x0000c0</span><span class="op" id="4569249">,</span>&nbsp;<span class="num" id="4569251">0x000100</span><span class="op" id="4569259">,</span>&nbsp;<span class="num" id="4569261">0x000180</span><span class="op" id="4569269">,</span>&nbsp;<span class="num" id="4569271">0x000200</span><span class="op" id="4569279">,</span>&nbsp;<span class="num" id="4569281">0x000300</span><span class="op" id="4569289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4569292">0x000400</span><span class="op" id="4569300">,</span>&nbsp;<span class="num" id="4569302">0x000600</span><span class="op" id="4569310">,</span>&nbsp;<span class="num" id="4569312">0x000800</span><span class="op" id="4569320">,</span>&nbsp;<span class="num" id="4569322">0x000c00</span><span class="op" id="4569330">,</span>&nbsp;<span class="num" id="4569332">0x001000</span><span class="op" id="4569340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4569343">0x001800</span><span class="op" id="4569351">,</span>&nbsp;<span class="num" id="4569353">0x002000</span><span class="op" id="4569361">,</span>&nbsp;<span class="num" id="4569363">0x003000</span><span class="op" id="4569371">,</span>&nbsp;<span class="num" id="4569373">0x004000</span><span class="op" id="4569381">,</span>&nbsp;<span class="num" id="4569383">0x006000</span><span class="op" id="4569391">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4569395">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4569418">0x008000</span><span class="op" id="4569426">,</span>&nbsp;<span class="num" id="4569428">0x00c000</span><span class="op" id="4569436">,</span>&nbsp;<span class="num" id="4569438">0x010000</span><span class="op" id="4569446">,</span>&nbsp;<span class="num" id="4569448">0x018000</span><span class="op" id="4569456">,</span>&nbsp;<span class="num" id="4569458">0x020000</span><span class="op" id="4569466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4569469">0x030000</span><span class="op" id="4569477">,</span>&nbsp;<span class="num" id="4569479">0x040000</span><span class="op" id="4569487">,</span>&nbsp;<span class="num" id="4569489">0x060000</span><span class="op" id="4569497">,</span>&nbsp;<span class="num" id="4569499">0x080000</span><span class="op" id="4569507">,</span>&nbsp;<span class="num" id="4569509">0x0c0000</span><span class="op" id="4569517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4569520">0x100000</span><span class="op" id="4569528">,</span>&nbsp;<span class="num" id="4569530">0x180000</span><span class="op" id="4569538">,</span>&nbsp;<span class="num" id="4569540">0x200000</span><span class="op" id="4569548">,</span>&nbsp;<span class="num" id="4569550">0x300000</span><span class="op" id="4569558">,</span><br>
<span class="lineno"></span><span class="op" id="4569560">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4569563">//&nbsp;The&nbsp;odd&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;codegen&nbsp;code&nbsp;sizes&nbsp;are&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="4569625">var</span>&nbsp;<span class="ident" id="4569629">codegenOrder</span>&nbsp;<span class="op" id="4569642">=</span>&nbsp;<span class="op" id="4569644">[</span><span class="op" id="4569645">]</span><span class="builtintype" id="4569646">uint32</span><span class="op" id="4569652">{</span><span class="num" id="4569653">16</span><span class="op" id="4569655">,</span>&nbsp;<span class="num" id="4569657">17</span><span class="op" id="4569659">,</span>&nbsp;<span class="num" id="4569661">18</span><span class="op" id="4569663">,</span>&nbsp;<span class="num" id="4569665">0</span><span class="op" id="4569666">,</span>&nbsp;<span class="num" id="4569668">8</span><span class="op" id="4569669">,</span>&nbsp;<span class="num" id="4569671">7</span><span class="op" id="4569672">,</span>&nbsp;<span class="num" id="4569674">9</span><span class="op" id="4569675">,</span>&nbsp;<span class="num" id="4569677">6</span><span class="op" id="4569678">,</span>&nbsp;<span class="num" id="4569680">10</span><span class="op" id="4569682">,</span>&nbsp;<span class="num" id="4569684">5</span><span class="op" id="4569685">,</span>&nbsp;<span class="num" id="4569687">11</span><span class="op" id="4569689">,</span>&nbsp;<span class="num" id="4569691">4</span><span class="op" id="4569692">,</span>&nbsp;<span class="num" id="4569694">12</span><span class="op" id="4569696">,</span>&nbsp;<span class="num" id="4569698">3</span><span class="op" id="4569699">,</span>&nbsp;<span class="num" id="4569701">13</span><span class="op" id="4569703">,</span>&nbsp;<span class="num" id="4569705">2</span><span class="op" id="4569706">,</span>&nbsp;<span class="num" id="4569708">14</span><span class="op" id="4569710">,</span>&nbsp;<span class="num" id="4569712">1</span><span class="op" id="4569713">,</span>&nbsp;<span class="num" id="4569715">15</span><span class="op" id="4569717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4569720">type</span>&nbsp;<span class="ident" id="4569725">huffmanBitWriter</span>&nbsp;<span class="keyword" id="4569742">struct</span>&nbsp;<span class="op" id="4569749">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569752">w</span>&nbsp;<span class="ident" id="4569754">io</span><span class="op" id="4569756">.</span><span class="ident" id="4569757">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4569765">//&nbsp;Data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;written&nbsp;is&nbsp;bytes[0:nbytes]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4569815">//&nbsp;and&nbsp;then&nbsp;the&nbsp;low&nbsp;nbits&nbsp;of&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569851">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4569867">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569875">nbits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4569891">uint32</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569899">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4569915">[</span><span class="num" id="4569916">64</span><span class="op" id="4569918">]</span><span class="builtintype" id="4569919">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569925">nbytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4569941">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569946">literalFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4569962">[</span><span class="op" id="4569963">]</span><span class="builtintype" id="4569964">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569971">offsetFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4569987">[</span><span class="op" id="4569988">]</span><span class="builtintype" id="4569989">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569996">codegen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4570012">[</span><span class="op" id="4570013">]</span><span class="builtintype" id="4570014">uint8</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570021">codegenFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4570037">[</span><span class="op" id="4570038">]</span><span class="builtintype" id="4570039">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570046">literalEncoding</span>&nbsp;<span class="op" id="4570062">*</span><span class="ident" id="4570063">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570079">offsetEncoding</span>&nbsp;&nbsp;<span class="op" id="4570095">*</span><span class="ident" id="4570096">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570112">codegenEncoding</span>&nbsp;<span class="op" id="4570128">*</span><span class="ident" id="4570129">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570145">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4570161">error</span><br>
<span class="lineno">85</span><span class="op" id="4570167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4570170">func</span>&nbsp;<span class="ident" id="4570175">newHuffmanBitWriter</span><span class="op" id="4570194">(</span><span class="ident" id="4570195">w</span>&nbsp;<span class="ident" id="4570197">io</span><span class="op" id="4570199">.</span><span class="ident" id="4570200">Writer</span><span class="op" id="4570206">)</span>&nbsp;<span class="op" id="4570208">*</span><span class="ident" id="4570209">huffmanBitWriter</span>&nbsp;<span class="op" id="4570226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570229">return</span>&nbsp;<span class="op" id="4570236">&amp;</span><span class="ident" id="4570237">huffmanBitWriter</span><span class="op" id="4570253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570257">w</span><span class="op" id="4570258">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570274">w</span><span class="op" id="4570275">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570279">literalFreq</span><span class="op" id="4570290">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4570296">make</span><span class="op" id="4570300">(</span><span class="op" id="4570301">[</span><span class="op" id="4570302">]</span><span class="builtintype" id="4570303">int32</span><span class="op" id="4570308">,</span>&nbsp;<span class="ident" id="4570310">maxLit</span><span class="op" id="4570316">)</span><span class="op" id="4570317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570321">offsetFreq</span><span class="op" id="4570331">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4570338">make</span><span class="op" id="4570342">(</span><span class="op" id="4570343">[</span><span class="op" id="4570344">]</span><span class="builtintype" id="4570345">int32</span><span class="op" id="4570350">,</span>&nbsp;<span class="ident" id="4570352">offsetCodeCount</span><span class="op" id="4570367">)</span><span class="op" id="4570368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570372">codegen</span><span class="op" id="4570379">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4570389">make</span><span class="op" id="4570393">(</span><span class="op" id="4570394">[</span><span class="op" id="4570395">]</span><span class="builtintype" id="4570396">uint8</span><span class="op" id="4570401">,</span>&nbsp;<span class="ident" id="4570403">maxLit</span><span class="op" id="4570409">+</span><span class="ident" id="4570410">offsetCodeCount</span><span class="op" id="4570425">+</span><span class="num" id="4570426">1</span><span class="op" id="4570427">)</span><span class="op" id="4570428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570432">codegenFreq</span><span class="op" id="4570443">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4570449">make</span><span class="op" id="4570453">(</span><span class="op" id="4570454">[</span><span class="op" id="4570455">]</span><span class="builtintype" id="4570456">int32</span><span class="op" id="4570461">,</span>&nbsp;<span class="ident" id="4570463">codegenCodeCount</span><span class="op" id="4570479">)</span><span class="op" id="4570480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570484">literalEncoding</span><span class="op" id="4570499">:</span>&nbsp;<span class="ident" id="4570501">newHuffmanEncoder</span><span class="op" id="4570518">(</span><span class="ident" id="4570519">maxLit</span><span class="op" id="4570525">)</span><span class="op" id="4570526">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570530">offsetEncoding</span><span class="op" id="4570544">:</span>&nbsp;&nbsp;<span class="ident" id="4570547">newHuffmanEncoder</span><span class="op" id="4570564">(</span><span class="ident" id="4570565">offsetCodeCount</span><span class="op" id="4570580">)</span><span class="op" id="4570581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570585">codegenEncoding</span><span class="op" id="4570600">:</span>&nbsp;<span class="ident" id="4570602">newHuffmanEncoder</span><span class="op" id="4570619">(</span><span class="ident" id="4570620">codegenCodeCount</span><span class="op" id="4570636">)</span><span class="op" id="4570637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4570640">}</span><br>
<span class="lineno"></span><span class="op" id="4570642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4570645">func</span>&nbsp;<span class="op" id="4570650">(</span><span class="ident" id="4570651">w</span>&nbsp;<span class="op" id="4570653">*</span><span class="ident" id="4570654">huffmanBitWriter</span><span class="op" id="4570670">)</span>&nbsp;<span class="ident" id="4570672">reset</span><span class="op" id="4570677">(</span><span class="ident" id="4570678">writer</span>&nbsp;<span class="ident" id="4570685">io</span><span class="op" id="4570687">.</span><span class="ident" id="4570688">Writer</span><span class="op" id="4570694">)</span>&nbsp;<span class="op" id="4570696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570699">w</span><span class="op" id="4570700">.</span><span class="ident" id="4570701">w</span>&nbsp;<span class="op" id="4570703">=</span>&nbsp;<span class="ident" id="4570705">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570713">w</span><span class="op" id="4570714">.</span><span class="ident" id="4570715">bits</span><span class="op" id="4570719">,</span>&nbsp;<span class="ident" id="4570721">w</span><span class="op" id="4570722">.</span><span class="ident" id="4570723">nbits</span><span class="op" id="4570728">,</span>&nbsp;<span class="ident" id="4570730">w</span><span class="op" id="4570731">.</span><span class="ident" id="4570732">nbytes</span><span class="op" id="4570738">,</span>&nbsp;<span class="ident" id="4570740">w</span><span class="op" id="4570741">.</span><span class="ident" id="4570742">err</span>&nbsp;<span class="op" id="4570746">=</span>&nbsp;<span class="num" id="4570748">0</span><span class="op" id="4570749">,</span>&nbsp;<span class="num" id="4570751">0</span><span class="op" id="4570752">,</span>&nbsp;<span class="num" id="4570754">0</span><span class="op" id="4570755">,</span>&nbsp;<span class="ident" id="4570757">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570762">w</span><span class="op" id="4570763">.</span><span class="ident" id="4570764">bytes</span>&nbsp;<span class="op" id="4570770">=</span>&nbsp;<span class="op" id="4570772">[</span><span class="num" id="4570773">64</span><span class="op" id="4570775">]</span><span class="builtintype" id="4570776">byte</span><span class="op" id="4570780">{</span><span class="op" id="4570781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570784">for</span>&nbsp;<span class="ident" id="4570788">i</span>&nbsp;<span class="op" id="4570790">:=</span>&nbsp;<span class="keyword" id="4570793">range</span>&nbsp;<span class="ident" id="4570799">w</span><span class="op" id="4570800">.</span><span class="ident" id="4570801">codegen</span>&nbsp;<span class="op" id="4570809">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570813">w</span><span class="op" id="4570814">.</span><span class="ident" id="4570815">codegen</span><span class="op" id="4570822">[</span><span class="ident" id="4570823">i</span><span class="op" id="4570824">]</span>&nbsp;<span class="op" id="4570826">=</span>&nbsp;<span class="num" id="4570828">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4570831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570834">for</span>&nbsp;<span class="ident" id="4570838">_</span><span class="op" id="4570839">,</span>&nbsp;<span class="ident" id="4570841">s</span>&nbsp;<span class="op" id="4570843">:=</span>&nbsp;<span class="keyword" id="4570846">range</span>&nbsp;<span class="op" id="4570852">[</span><span class="op" id="4570853">...</span><span class="op" id="4570856">]</span><span class="op" id="4570857">[</span><span class="op" id="4570858">]</span><span class="builtintype" id="4570859">int32</span><span class="op" id="4570864">{</span><span class="ident" id="4570865">w</span><span class="op" id="4570866">.</span><span class="ident" id="4570867">literalFreq</span><span class="op" id="4570878">,</span>&nbsp;<span class="ident" id="4570880">w</span><span class="op" id="4570881">.</span><span class="ident" id="4570882">offsetFreq</span><span class="op" id="4570892">,</span>&nbsp;<span class="ident" id="4570894">w</span><span class="op" id="4570895">.</span><span class="ident" id="4570896">codegenFreq</span><span class="op" id="4570907">}</span>&nbsp;<span class="op" id="4570909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570913">for</span>&nbsp;<span class="ident" id="4570917">i</span>&nbsp;<span class="op" id="4570919">:=</span>&nbsp;<span class="keyword" id="4570922">range</span>&nbsp;<span class="ident" id="4570928">s</span>&nbsp;<span class="op" id="4570930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570935">s</span><span class="op" id="4570936">[</span><span class="ident" id="4570937">i</span><span class="op" id="4570938">]</span>&nbsp;<span class="op" id="4570940">=</span>&nbsp;<span class="num" id="4570942">0</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4570946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4570949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570952">for</span>&nbsp;<span class="ident" id="4570956">_</span><span class="op" id="4570957">,</span>&nbsp;<span class="ident" id="4570959">enc</span>&nbsp;<span class="op" id="4570963">:=</span>&nbsp;<span class="keyword" id="4570966">range</span>&nbsp;<span class="op" id="4570972">[</span><span class="op" id="4570973">...</span><span class="op" id="4570976">]</span><span class="op" id="4570977">*</span><span class="ident" id="4570978">huffmanEncoder</span><span class="op" id="4570992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570996">w</span><span class="op" id="4570997">.</span><span class="ident" id="4570998">literalEncoding</span><span class="op" id="4571013">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571017">w</span><span class="op" id="4571018">.</span><span class="ident" id="4571019">offsetEncoding</span><span class="op" id="4571033">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571037">w</span><span class="op" id="4571038">.</span><span class="ident" id="4571039">codegenEncoding</span><span class="op" id="4571054">}</span>&nbsp;<span class="op" id="4571056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4571060">for</span>&nbsp;<span class="ident" id="4571064">i</span>&nbsp;<span class="op" id="4571066">:=</span>&nbsp;<span class="keyword" id="4571069">range</span>&nbsp;<span class="ident" id="4571075">enc</span><span class="op" id="4571078">.</span><span class="ident" id="4571079">code</span>&nbsp;<span class="op" id="4571084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571089">enc</span><span class="op" id="4571092">.</span><span class="ident" id="4571093">code</span><span class="op" id="4571097">[</span><span class="ident" id="4571098">i</span><span class="op" id="4571099">]</span>&nbsp;<span class="op" id="4571101">=</span>&nbsp;<span class="num" id="4571103">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4571107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4571111">for</span>&nbsp;<span class="ident" id="4571115">i</span>&nbsp;<span class="op" id="4571117">:=</span>&nbsp;<span class="keyword" id="4571120">range</span>&nbsp;<span class="ident" id="4571126">enc</span><span class="op" id="4571129">.</span><span class="ident" id="4571130">codeBits</span>&nbsp;<span class="op" id="4571139">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571144">enc</span><span class="op" id="4571147">.</span><span class="ident" id="4571148">codeBits</span><span class="op" id="4571156">[</span><span class="ident" id="4571157">i</span><span class="op" id="4571158">]</span>&nbsp;<span class="op" id="4571160">=</span>&nbsp;<span class="num" id="4571162">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4571166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4571169">}</span><br>
<span class="lineno"></span><span class="op" id="4571171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="4571174">func</span>&nbsp;<span class="op" id="4571179">(</span><span class="ident" id="4571180">w</span>&nbsp;<span class="op" id="4571182">*</span><span class="ident" id="4571183">huffmanBitWriter</span><span class="op" id="4571199">)</span>&nbsp;<span class="ident" id="4571201">flushBits</span><span class="op" id="4571210">(</span><span class="op" id="4571211">)</span>&nbsp;<span class="op" id="4571213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4571216">if</span>&nbsp;<span class="ident" id="4571219">w</span><span class="op" id="4571220">.</span><span class="ident" id="4571221">err</span>&nbsp;<span class="op" id="4571225">!=</span>&nbsp;<span class="ident" id="4571228">nil</span>&nbsp;<span class="op" id="4571232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571236">w</span><span class="op" id="4571237">.</span><span class="ident" id="4571238">nbits</span>&nbsp;<span class="op" id="4571244">=</span>&nbsp;<span class="num" id="4571246">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4571250">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4571258">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571261">bits</span>&nbsp;<span class="op" id="4571266">:=</span>&nbsp;<span class="ident" id="4571269">w</span><span class="op" id="4571270">.</span><span class="ident" id="4571271">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571277">w</span><span class="op" id="4571278">.</span><span class="ident" id="4571279">bits</span>&nbsp;<span class="op" id="4571284">&gt;&gt;=</span>&nbsp;<span class="num" id="4571288">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571292">w</span><span class="op" id="4571293">.</span><span class="ident" id="4571294">nbits</span>&nbsp;<span class="op" id="4571300">-=</span>&nbsp;<span class="num" id="4571303">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571307">n</span>&nbsp;<span class="op" id="4571309">:=</span>&nbsp;<span class="ident" id="4571312">w</span><span class="op" id="4571313">.</span><span class="ident" id="4571314">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571322">w</span><span class="op" id="4571323">.</span><span class="ident" id="4571324">bytes</span><span class="op" id="4571329">[</span><span class="ident" id="4571330">n</span><span class="op" id="4571331">]</span>&nbsp;<span class="op" id="4571333">=</span>&nbsp;<span class="builtintype" id="4571335">byte</span><span class="op" id="4571339">(</span><span class="ident" id="4571340">bits</span><span class="op" id="4571344">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571347">w</span><span class="op" id="4571348">.</span><span class="ident" id="4571349">bytes</span><span class="op" id="4571354">[</span><span class="ident" id="4571355">n</span><span class="op" id="4571356">+</span><span class="num" id="4571357">1</span><span class="op" id="4571358">]</span>&nbsp;<span class="op" id="4571360">=</span>&nbsp;<span class="builtintype" id="4571362">byte</span><span class="op" id="4571366">(</span><span class="ident" id="4571367">bits</span>&nbsp;<span class="op" id="4571372">&gt;&gt;</span>&nbsp;<span class="num" id="4571375">8</span><span class="op" id="4571376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4571379">if</span>&nbsp;<span class="ident" id="4571382">n</span>&nbsp;<span class="op" id="4571384">+=</span>&nbsp;<span class="num" id="4571387">2</span><span class="op" id="4571388">;</span>&nbsp;<span class="ident" id="4571390">n</span>&nbsp;<span class="op" id="4571392">&gt;=</span>&nbsp;<span class="builtinfunc" id="4571395">len</span><span class="op" id="4571398">(</span><span class="ident" id="4571399">w</span><span class="op" id="4571400">.</span><span class="ident" id="4571401">bytes</span><span class="op" id="4571406">)</span>&nbsp;<span class="op" id="4571408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571412">_</span><span class="op" id="4571413">,</span>&nbsp;<span class="ident" id="4571415">w</span><span class="op" id="4571416">.</span><span class="ident" id="4571417">err</span>&nbsp;<span class="op" id="4571421">=</span>&nbsp;<span class="ident" id="4571423">w</span><span class="op" id="4571424">.</span><span class="ident" id="4571425">w</span><span class="op" id="4571426">.</span><span class="ident" id="4571427">Write</span><span class="op" id="4571432">(</span><span class="ident" id="4571433">w</span><span class="op" id="4571434">.</span><span class="ident" id="4571435">bytes</span><span class="op" id="4571440">[</span><span class="num" id="4571441">0</span><span class="op" id="4571442">:</span><span class="op" id="4571443">]</span><span class="op" id="4571444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571448">n</span>&nbsp;<span class="op" id="4571450">=</span>&nbsp;<span class="num" id="4571452">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4571455">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571458">w</span><span class="op" id="4571459">.</span><span class="ident" id="4571460">nbytes</span>&nbsp;<span class="op" id="4571467">=</span>&nbsp;<span class="ident" id="4571469">n</span><br>
<span class="lineno"></span><span class="op" id="4571471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4571474">func</span>&nbsp;<span class="op" id="4571479">(</span><span class="ident" id="4571480">w</span>&nbsp;<span class="op" id="4571482">*</span><span class="ident" id="4571483">huffmanBitWriter</span><span class="op" id="4571499">)</span>&nbsp;<span class="ident" id="4571501">flush</span><span class="op" id="4571506">(</span><span class="op" id="4571507">)</span>&nbsp;<span class="op" id="4571509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4571512">if</span>&nbsp;<span class="ident" id="4571515">w</span><span class="op" id="4571516">.</span><span class="ident" id="4571517">err</span>&nbsp;<span class="op" id="4571521">!=</span>&nbsp;<span class="ident" id="4571524">nil</span>&nbsp;<span class="op" id="4571528">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571532">w</span><span class="op" id="4571533">.</span><span class="ident" id="4571534">nbits</span>&nbsp;<span class="op" id="4571540">=</span>&nbsp;<span class="num" id="4571542">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4571546">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4571554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571557">n</span>&nbsp;<span class="op" id="4571559">:=</span>&nbsp;<span class="ident" id="4571562">w</span><span class="op" id="4571563">.</span><span class="ident" id="4571564">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4571572">if</span>&nbsp;<span class="ident" id="4571575">w</span><span class="op" id="4571576">.</span><span class="ident" id="4571577">nbits</span>&nbsp;<span class="op" id="4571583">&gt;</span>&nbsp;<span class="num" id="4571585">8</span>&nbsp;<span class="op" id="4571587">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571591">w</span><span class="op" id="4571592">.</span><span class="ident" id="4571593">bytes</span><span class="op" id="4571598">[</span><span class="ident" id="4571599">n</span><span class="op" id="4571600">]</span>&nbsp;<span class="op" id="4571602">=</span>&nbsp;<span class="builtintype" id="4571604">byte</span><span class="op" id="4571608">(</span><span class="ident" id="4571609">w</span><span class="op" id="4571610">.</span><span class="ident" id="4571611">bits</span><span class="op" id="4571615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571619">w</span><span class="op" id="4571620">.</span><span class="ident" id="4571621">bits</span>&nbsp;<span class="op" id="4571626">&gt;&gt;=</span>&nbsp;<span class="num" id="4571630">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571634">w</span><span class="op" id="4571635">.</span><span class="ident" id="4571636">nbits</span>&nbsp;<span class="op" id="4571642">-=</span>&nbsp;<span class="num" id="4571645">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571649">n</span><span class="op" id="4571650">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4571654">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4571657">if</span>&nbsp;<span class="ident" id="4571660">w</span><span class="op" id="4571661">.</span><span class="ident" id="4571662">nbits</span>&nbsp;<span class="op" id="4571668">&gt;</span>&nbsp;<span class="num" id="4571670">0</span>&nbsp;<span class="op" id="4571672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571676">w</span><span class="op" id="4571677">.</span><span class="ident" id="4571678">bytes</span><span class="op" id="4571683">[</span><span class="ident" id="4571684">n</span><span class="op" id="4571685">]</span>&nbsp;<span class="op" id="4571687">=</span>&nbsp;<span class="builtintype" id="4571689">byte</span><span class="op" id="4571693">(</span><span class="ident" id="4571694">w</span><span class="op" id="4571695">.</span><span class="ident" id="4571696">bits</span><span class="op" id="4571700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571704">w</span><span class="op" id="4571705">.</span><span class="ident" id="4571706">nbits</span>&nbsp;<span class="op" id="4571712">=</span>&nbsp;<span class="num" id="4571714">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571718">n</span><span class="op" id="4571719">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4571723">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571726">w</span><span class="op" id="4571727">.</span><span class="ident" id="4571728">bits</span>&nbsp;<span class="op" id="4571733">=</span>&nbsp;<span class="num" id="4571735">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571738">_</span><span class="op" id="4571739">,</span>&nbsp;<span class="ident" id="4571741">w</span><span class="op" id="4571742">.</span><span class="ident" id="4571743">err</span>&nbsp;<span class="op" id="4571747">=</span>&nbsp;<span class="ident" id="4571749">w</span><span class="op" id="4571750">.</span><span class="ident" id="4571751">w</span><span class="op" id="4571752">.</span><span class="ident" id="4571753">Write</span><span class="op" id="4571758">(</span><span class="ident" id="4571759">w</span><span class="op" id="4571760">.</span><span class="ident" id="4571761">bytes</span><span class="op" id="4571766">[</span><span class="num" id="4571767">0</span><span class="op" id="4571768">:</span><span class="ident" id="4571769">n</span><span class="op" id="4571770">]</span><span class="op" id="4571771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571774">w</span><span class="op" id="4571775">.</span><span class="ident" id="4571776">nbytes</span>&nbsp;<span class="op" id="4571783">=</span>&nbsp;<span class="num" id="4571785">0</span><br>
<span class="lineno"></span><span class="op" id="4571787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="4571790">func</span>&nbsp;<span class="op" id="4571795">(</span><span class="ident" id="4571796">w</span>&nbsp;<span class="op" id="4571798">*</span><span class="ident" id="4571799">huffmanBitWriter</span><span class="op" id="4571815">)</span>&nbsp;<span class="ident" id="4571817">writeBits</span><span class="op" id="4571826">(</span><span class="ident" id="4571827">b</span><span class="op" id="4571828">,</span>&nbsp;<span class="ident" id="4571830">nb</span>&nbsp;<span class="builtintype" id="4571833">int32</span><span class="op" id="4571838">)</span>&nbsp;<span class="op" id="4571840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571843">w</span><span class="op" id="4571844">.</span><span class="ident" id="4571845">bits</span>&nbsp;<span class="op" id="4571850">|=</span>&nbsp;<span class="builtintype" id="4571853">uint32</span><span class="op" id="4571859">(</span><span class="ident" id="4571860">b</span><span class="op" id="4571861">)</span>&nbsp;<span class="op" id="4571863">&lt;&lt;</span>&nbsp;<span class="ident" id="4571866">w</span><span class="op" id="4571867">.</span><span class="ident" id="4571868">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4571875">if</span>&nbsp;<span class="ident" id="4571878">w</span><span class="op" id="4571879">.</span><span class="ident" id="4571880">nbits</span>&nbsp;<span class="op" id="4571886">+=</span>&nbsp;<span class="builtintype" id="4571889">uint32</span><span class="op" id="4571895">(</span><span class="ident" id="4571896">nb</span><span class="op" id="4571898">)</span><span class="op" id="4571899">;</span>&nbsp;<span class="ident" id="4571901">w</span><span class="op" id="4571902">.</span><span class="ident" id="4571903">nbits</span>&nbsp;<span class="op" id="4571909">&gt;=</span>&nbsp;<span class="num" id="4571912">16</span>&nbsp;<span class="op" id="4571915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571919">w</span><span class="op" id="4571920">.</span><span class="ident" id="4571921">flushBits</span><span class="op" id="4571930">(</span><span class="op" id="4571931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4571934">}</span><br>
<span class="lineno">170</span><span class="op" id="4571936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4571939">func</span>&nbsp;<span class="op" id="4571944">(</span><span class="ident" id="4571945">w</span>&nbsp;<span class="op" id="4571947">*</span><span class="ident" id="4571948">huffmanBitWriter</span><span class="op" id="4571964">)</span>&nbsp;<span class="ident" id="4571966">writeBytes</span><span class="op" id="4571976">(</span><span class="ident" id="4571977">bytes</span>&nbsp;<span class="op" id="4571983">[</span><span class="op" id="4571984">]</span><span class="builtintype" id="4571985">byte</span><span class="op" id="4571989">)</span>&nbsp;<span class="op" id="4571991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4571994">if</span>&nbsp;<span class="ident" id="4571997">w</span><span class="op" id="4571998">.</span><span class="ident" id="4571999">err</span>&nbsp;<span class="op" id="4572003">!=</span>&nbsp;<span class="ident" id="4572006">nil</span>&nbsp;<span class="op" id="4572010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572014">return</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4572022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572025">n</span>&nbsp;<span class="op" id="4572027">:=</span>&nbsp;<span class="ident" id="4572030">w</span><span class="op" id="4572031">.</span><span class="ident" id="4572032">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572040">if</span>&nbsp;<span class="ident" id="4572043">w</span><span class="op" id="4572044">.</span><span class="ident" id="4572045">nbits</span>&nbsp;<span class="op" id="4572051">==</span>&nbsp;<span class="num" id="4572054">8</span>&nbsp;<span class="op" id="4572056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572060">w</span><span class="op" id="4572061">.</span><span class="ident" id="4572062">bytes</span><span class="op" id="4572067">[</span><span class="ident" id="4572068">n</span><span class="op" id="4572069">]</span>&nbsp;<span class="op" id="4572071">=</span>&nbsp;<span class="builtintype" id="4572073">byte</span><span class="op" id="4572077">(</span><span class="ident" id="4572078">w</span><span class="op" id="4572079">.</span><span class="ident" id="4572080">bits</span><span class="op" id="4572084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572088">w</span><span class="op" id="4572089">.</span><span class="ident" id="4572090">nbits</span>&nbsp;<span class="op" id="4572096">=</span>&nbsp;<span class="num" id="4572098">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572102">n</span><span class="op" id="4572103">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4572107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572110">if</span>&nbsp;<span class="ident" id="4572113">w</span><span class="op" id="4572114">.</span><span class="ident" id="4572115">nbits</span>&nbsp;<span class="op" id="4572121">!=</span>&nbsp;<span class="num" id="4572124">0</span>&nbsp;<span class="op" id="4572126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572130">w</span><span class="op" id="4572131">.</span><span class="ident" id="4572132">err</span>&nbsp;<span class="op" id="4572136">=</span>&nbsp;<span class="ident" id="4572138">InternalError</span><span class="op" id="4572151">(</span><span class="string" id="4572152">&#34;writeBytes&nbsp;with&nbsp;unfinished&nbsp;bits&#34;</span><span class="op" id="4572185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572189">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4572197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572200">if</span>&nbsp;<span class="ident" id="4572203">n</span>&nbsp;<span class="op" id="4572205">!=</span>&nbsp;<span class="num" id="4572208">0</span>&nbsp;<span class="op" id="4572210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572214">_</span><span class="op" id="4572215">,</span>&nbsp;<span class="ident" id="4572217">w</span><span class="op" id="4572218">.</span><span class="ident" id="4572219">err</span>&nbsp;<span class="op" id="4572223">=</span>&nbsp;<span class="ident" id="4572225">w</span><span class="op" id="4572226">.</span><span class="ident" id="4572227">w</span><span class="op" id="4572228">.</span><span class="ident" id="4572229">Write</span><span class="op" id="4572234">(</span><span class="ident" id="4572235">w</span><span class="op" id="4572236">.</span><span class="ident" id="4572237">bytes</span><span class="op" id="4572242">[</span><span class="num" id="4572243">0</span><span class="op" id="4572244">:</span><span class="ident" id="4572245">n</span><span class="op" id="4572246">]</span><span class="op" id="4572247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572251">if</span>&nbsp;<span class="ident" id="4572254">w</span><span class="op" id="4572255">.</span><span class="ident" id="4572256">err</span>&nbsp;<span class="op" id="4572260">!=</span>&nbsp;<span class="ident" id="4572263">nil</span>&nbsp;<span class="op" id="4572267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572272">return</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4572281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4572284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572287">w</span><span class="op" id="4572288">.</span><span class="ident" id="4572289">nbytes</span>&nbsp;<span class="op" id="4572296">=</span>&nbsp;<span class="num" id="4572298">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572301">_</span><span class="op" id="4572302">,</span>&nbsp;<span class="ident" id="4572304">w</span><span class="op" id="4572305">.</span><span class="ident" id="4572306">err</span>&nbsp;<span class="op" id="4572310">=</span>&nbsp;<span class="ident" id="4572312">w</span><span class="op" id="4572313">.</span><span class="ident" id="4572314">w</span><span class="op" id="4572315">.</span><span class="ident" id="4572316">Write</span><span class="op" id="4572321">(</span><span class="ident" id="4572322">bytes</span><span class="op" id="4572327">)</span><br>
<span class="lineno"></span><span class="op" id="4572329">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4572332">//&nbsp;RFC&nbsp;1951&nbsp;3.2.7&nbsp;specifies&nbsp;a&nbsp;special&nbsp;run-length&nbsp;encoding&nbsp;for&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="4572405">//&nbsp;the&nbsp;literal&nbsp;and&nbsp;offset&nbsp;lengths&nbsp;arrays&nbsp;(which&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="4572484">//&nbsp;array).&nbsp;&nbsp;This&nbsp;method&nbsp;generates&nbsp;that&nbsp;run-length&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4572544">//</span><br>
<span class="lineno">200</span><span class="comment" id="4572547">//&nbsp;The&nbsp;result&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegen&nbsp;array,&nbsp;and&nbsp;the&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4572616">//&nbsp;of&nbsp;each&nbsp;code&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegenFreq&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="4572671">//&nbsp;Codes&nbsp;0-15&nbsp;are&nbsp;single&nbsp;byte&nbsp;codes.&nbsp;Codes&nbsp;16-18&nbsp;are&nbsp;followed&nbsp;by&nbsp;additional</span><br>
<span class="lineno"></span><span class="comment" id="4572747">//&nbsp;information.&nbsp;&nbsp;Code&nbsp;badCode&nbsp;is&nbsp;an&nbsp;end&nbsp;marker</span><br>
<span class="lineno"></span><span class="comment" id="4572794">//</span><br>
<span class="lineno">205</span><span class="comment" id="4572797">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;in&nbsp;literalEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4572860">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;in&nbsp;offsetEncoding</span><br>
<span class="lineno"></span><span class="keyword" id="4572921">func</span>&nbsp;<span class="op" id="4572926">(</span><span class="ident" id="4572927">w</span>&nbsp;<span class="op" id="4572929">*</span><span class="ident" id="4572930">huffmanBitWriter</span><span class="op" id="4572946">)</span>&nbsp;<span class="ident" id="4572948">generateCodegen</span><span class="op" id="4572963">(</span><span class="ident" id="4572964">numLiterals</span>&nbsp;<span class="builtintype" id="4572976">int</span><span class="op" id="4572979">,</span>&nbsp;<span class="ident" id="4572981">numOffsets</span>&nbsp;<span class="builtintype" id="4572992">int</span><span class="op" id="4572995">)</span>&nbsp;<span class="op" id="4572997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4573000">for</span>&nbsp;<span class="ident" id="4573004">i</span>&nbsp;<span class="op" id="4573006">:=</span>&nbsp;<span class="keyword" id="4573009">range</span>&nbsp;<span class="ident" id="4573015">w</span><span class="op" id="4573016">.</span><span class="ident" id="4573017">codegenFreq</span>&nbsp;<span class="op" id="4573029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573033">w</span><span class="op" id="4573034">.</span><span class="ident" id="4573035">codegenFreq</span><span class="op" id="4573046">[</span><span class="ident" id="4573047">i</span><span class="op" id="4573048">]</span>&nbsp;<span class="op" id="4573050">=</span>&nbsp;<span class="num" id="4573052">0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4573055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4573058">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;are&nbsp;using&nbsp;codegen&nbsp;both&nbsp;as&nbsp;a&nbsp;temporary&nbsp;variable&nbsp;for&nbsp;holding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4573134">//&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;frequencies,&nbsp;and&nbsp;as&nbsp;the&nbsp;place&nbsp;where&nbsp;we&nbsp;put&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4573207">//&nbsp;This&nbsp;is&nbsp;fine&nbsp;because&nbsp;the&nbsp;output&nbsp;is&nbsp;always&nbsp;shorter&nbsp;than&nbsp;the&nbsp;input&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4573281">//&nbsp;so&nbsp;far.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573293">codegen</span>&nbsp;<span class="op" id="4573301">:=</span>&nbsp;<span class="ident" id="4573304">w</span><span class="op" id="4573305">.</span><span class="ident" id="4573306">codegen</span>&nbsp;<span class="comment" id="4573314">//&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4573324">//&nbsp;Copy&nbsp;the&nbsp;concatenated&nbsp;code&nbsp;sizes&nbsp;to&nbsp;codegen.&nbsp;&nbsp;Put&nbsp;a&nbsp;marker&nbsp;at&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4573399">copy</span><span class="op" id="4573403">(</span><span class="ident" id="4573404">codegen</span><span class="op" id="4573411">[</span><span class="num" id="4573412">0</span><span class="op" id="4573413">:</span><span class="ident" id="4573414">numLiterals</span><span class="op" id="4573425">]</span><span class="op" id="4573426">,</span>&nbsp;<span class="ident" id="4573428">w</span><span class="op" id="4573429">.</span><span class="ident" id="4573430">literalEncoding</span><span class="op" id="4573445">.</span><span class="ident" id="4573446">codeBits</span><span class="op" id="4573454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4573457">copy</span><span class="op" id="4573461">(</span><span class="ident" id="4573462">codegen</span><span class="op" id="4573469">[</span><span class="ident" id="4573470">numLiterals</span><span class="op" id="4573481">:</span><span class="ident" id="4573482">numLiterals</span><span class="op" id="4573493">+</span><span class="ident" id="4573494">numOffsets</span><span class="op" id="4573504">]</span><span class="op" id="4573505">,</span>&nbsp;<span class="ident" id="4573507">w</span><span class="op" id="4573508">.</span><span class="ident" id="4573509">offsetEncoding</span><span class="op" id="4573523">.</span><span class="ident" id="4573524">codeBits</span><span class="op" id="4573532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573535">codegen</span><span class="op" id="4573542">[</span><span class="ident" id="4573543">numLiterals</span><span class="op" id="4573554">+</span><span class="ident" id="4573555">numOffsets</span><span class="op" id="4573565">]</span>&nbsp;<span class="op" id="4573567">=</span>&nbsp;<span class="ident" id="4573569">badCode</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573579">size</span>&nbsp;<span class="op" id="4573584">:=</span>&nbsp;<span class="ident" id="4573587">codegen</span><span class="op" id="4573594">[</span><span class="num" id="4573595">0</span><span class="op" id="4573596">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573599">count</span>&nbsp;<span class="op" id="4573605">:=</span>&nbsp;<span class="num" id="4573608">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573611">outIndex</span>&nbsp;<span class="op" id="4573620">:=</span>&nbsp;<span class="num" id="4573623">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4573626">for</span>&nbsp;<span class="ident" id="4573630">inIndex</span>&nbsp;<span class="op" id="4573638">:=</span>&nbsp;<span class="num" id="4573641">1</span><span class="op" id="4573642">;</span>&nbsp;<span class="ident" id="4573644">size</span>&nbsp;<span class="op" id="4573649">!=</span>&nbsp;<span class="ident" id="4573652">badCode</span><span class="op" id="4573659">;</span>&nbsp;<span class="ident" id="4573661">inIndex</span><span class="op" id="4573668">++</span>&nbsp;<span class="op" id="4573671">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4573675">//&nbsp;INVARIANT:&nbsp;We&nbsp;have&nbsp;seen&nbsp;&#34;count&#34;&nbsp;copies&nbsp;of&nbsp;size&nbsp;that&nbsp;have&nbsp;not&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4573745">//&nbsp;had&nbsp;output&nbsp;generated&nbsp;for&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573781">nextSize</span>&nbsp;<span class="op" id="4573790">:=</span>&nbsp;<span class="ident" id="4573793">codegen</span><span class="op" id="4573800">[</span><span class="ident" id="4573801">inIndex</span><span class="op" id="4573808">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4573812">if</span>&nbsp;<span class="ident" id="4573815">nextSize</span>&nbsp;<span class="op" id="4573824">==</span>&nbsp;<span class="ident" id="4573827">size</span>&nbsp;<span class="op" id="4573832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573837">count</span><span class="op" id="4573842">++</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4573848">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4573859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4573863">//&nbsp;We&nbsp;need&nbsp;to&nbsp;generate&nbsp;codegen&nbsp;indicating&nbsp;&#34;count&#34;&nbsp;of&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4573924">if</span>&nbsp;<span class="ident" id="4573927">size</span>&nbsp;<span class="op" id="4573932">!=</span>&nbsp;<span class="num" id="4573935">0</span>&nbsp;<span class="op" id="4573937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573942">codegen</span><span class="op" id="4573949">[</span><span class="ident" id="4573950">outIndex</span><span class="op" id="4573958">]</span>&nbsp;<span class="op" id="4573960">=</span>&nbsp;<span class="ident" id="4573962">size</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573970">outIndex</span><span class="op" id="4573978">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573984">w</span><span class="op" id="4573985">.</span><span class="ident" id="4573986">codegenFreq</span><span class="op" id="4573997">[</span><span class="ident" id="4573998">size</span><span class="op" id="4574002">]</span><span class="op" id="4574003">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574009">count</span><span class="op" id="4574014">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4574020">for</span>&nbsp;<span class="ident" id="4574024">count</span>&nbsp;<span class="op" id="4574030">&gt;=</span>&nbsp;<span class="num" id="4574033">3</span>&nbsp;<span class="op" id="4574035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574041">n</span>&nbsp;<span class="op" id="4574043">:=</span>&nbsp;<span class="num" id="4574046">6</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4574052">if</span>&nbsp;<span class="ident" id="4574055">n</span>&nbsp;<span class="op" id="4574057">&gt;</span>&nbsp;<span class="ident" id="4574059">count</span>&nbsp;<span class="op" id="4574065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574072">n</span>&nbsp;<span class="op" id="4574074">=</span>&nbsp;<span class="ident" id="4574076">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4574086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574092">codegen</span><span class="op" id="4574099">[</span><span class="ident" id="4574100">outIndex</span><span class="op" id="4574108">]</span>&nbsp;<span class="op" id="4574110">=</span>&nbsp;<span class="num" id="4574112">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574119">outIndex</span><span class="op" id="4574127">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574134">codegen</span><span class="op" id="4574141">[</span><span class="ident" id="4574142">outIndex</span><span class="op" id="4574150">]</span>&nbsp;<span class="op" id="4574152">=</span>&nbsp;<span class="builtintype" id="4574154">uint8</span><span class="op" id="4574159">(</span><span class="ident" id="4574160">n</span>&nbsp;<span class="op" id="4574162">-</span>&nbsp;<span class="num" id="4574164">3</span><span class="op" id="4574165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574171">outIndex</span><span class="op" id="4574179">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574186">w</span><span class="op" id="4574187">.</span><span class="ident" id="4574188">codegenFreq</span><span class="op" id="4574199">[</span><span class="num" id="4574200">16</span><span class="op" id="4574202">]</span><span class="op" id="4574203">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574210">count</span>&nbsp;<span class="op" id="4574216">-=</span>&nbsp;<span class="ident" id="4574219">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4574224">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4574228">}</span>&nbsp;<span class="keyword" id="4574230">else</span>&nbsp;<span class="op" id="4574235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4574240">for</span>&nbsp;<span class="ident" id="4574244">count</span>&nbsp;<span class="op" id="4574250">&gt;=</span>&nbsp;<span class="num" id="4574253">11</span>&nbsp;<span class="op" id="4574256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574262">n</span>&nbsp;<span class="op" id="4574264">:=</span>&nbsp;<span class="num" id="4574267">138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4574275">if</span>&nbsp;<span class="ident" id="4574278">n</span>&nbsp;<span class="op" id="4574280">&gt;</span>&nbsp;<span class="ident" id="4574282">count</span>&nbsp;<span class="op" id="4574288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574295">n</span>&nbsp;<span class="op" id="4574297">=</span>&nbsp;<span class="ident" id="4574299">count</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4574309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574315">codegen</span><span class="op" id="4574322">[</span><span class="ident" id="4574323">outIndex</span><span class="op" id="4574331">]</span>&nbsp;<span class="op" id="4574333">=</span>&nbsp;<span class="num" id="4574335">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574342">outIndex</span><span class="op" id="4574350">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574357">codegen</span><span class="op" id="4574364">[</span><span class="ident" id="4574365">outIndex</span><span class="op" id="4574373">]</span>&nbsp;<span class="op" id="4574375">=</span>&nbsp;<span class="builtintype" id="4574377">uint8</span><span class="op" id="4574382">(</span><span class="ident" id="4574383">n</span>&nbsp;<span class="op" id="4574385">-</span>&nbsp;<span class="num" id="4574387">11</span><span class="op" id="4574389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574395">outIndex</span><span class="op" id="4574403">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574410">w</span><span class="op" id="4574411">.</span><span class="ident" id="4574412">codegenFreq</span><span class="op" id="4574423">[</span><span class="num" id="4574424">18</span><span class="op" id="4574426">]</span><span class="op" id="4574427">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574434">count</span>&nbsp;<span class="op" id="4574440">-=</span>&nbsp;<span class="ident" id="4574443">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4574448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4574453">if</span>&nbsp;<span class="ident" id="4574456">count</span>&nbsp;<span class="op" id="4574462">&gt;=</span>&nbsp;<span class="num" id="4574465">3</span>&nbsp;<span class="op" id="4574467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4574473">//&nbsp;count&nbsp;&gt;=&nbsp;3&nbsp;&amp;&amp;&nbsp;count&nbsp;&lt;=&nbsp;10</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574506">codegen</span><span class="op" id="4574513">[</span><span class="ident" id="4574514">outIndex</span><span class="op" id="4574522">]</span>&nbsp;<span class="op" id="4574524">=</span>&nbsp;<span class="num" id="4574526">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574533">outIndex</span><span class="op" id="4574541">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574548">codegen</span><span class="op" id="4574555">[</span><span class="ident" id="4574556">outIndex</span><span class="op" id="4574564">]</span>&nbsp;<span class="op" id="4574566">=</span>&nbsp;<span class="builtintype" id="4574568">uint8</span><span class="op" id="4574573">(</span><span class="ident" id="4574574">count</span>&nbsp;<span class="op" id="4574580">-</span>&nbsp;<span class="num" id="4574582">3</span><span class="op" id="4574583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574589">outIndex</span><span class="op" id="4574597">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574604">w</span><span class="op" id="4574605">.</span><span class="ident" id="4574606">codegenFreq</span><span class="op" id="4574617">[</span><span class="num" id="4574618">17</span><span class="op" id="4574620">]</span><span class="op" id="4574621">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574628">count</span>&nbsp;<span class="op" id="4574634">=</span>&nbsp;<span class="num" id="4574636">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4574641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4574645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574649">count</span><span class="op" id="4574654">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4574659">for</span>&nbsp;<span class="op" id="4574663">;</span>&nbsp;<span class="ident" id="4574665">count</span>&nbsp;<span class="op" id="4574671">&gt;=</span>&nbsp;<span class="num" id="4574674">0</span><span class="op" id="4574675">;</span>&nbsp;<span class="ident" id="4574677">count</span><span class="op" id="4574682">--</span>&nbsp;<span class="op" id="4574685">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574690">codegen</span><span class="op" id="4574697">[</span><span class="ident" id="4574698">outIndex</span><span class="op" id="4574706">]</span>&nbsp;<span class="op" id="4574708">=</span>&nbsp;<span class="ident" id="4574710">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574718">outIndex</span><span class="op" id="4574726">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574732">w</span><span class="op" id="4574733">.</span><span class="ident" id="4574734">codegenFreq</span><span class="op" id="4574745">[</span><span class="ident" id="4574746">size</span><span class="op" id="4574750">]</span><span class="op" id="4574751">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4574756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4574760">//&nbsp;Set&nbsp;up&nbsp;invariant&nbsp;for&nbsp;next&nbsp;time&nbsp;through&nbsp;the&nbsp;loop.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574814">size</span>&nbsp;<span class="op" id="4574819">=</span>&nbsp;<span class="ident" id="4574821">nextSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574832">count</span>&nbsp;<span class="op" id="4574838">=</span>&nbsp;<span class="num" id="4574840">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4574843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4574846">//&nbsp;Marker&nbsp;indicating&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;codegen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4574892">codegen</span><span class="op" id="4574899">[</span><span class="ident" id="4574900">outIndex</span><span class="op" id="4574908">]</span>&nbsp;<span class="op" id="4574910">=</span>&nbsp;<span class="ident" id="4574912">badCode</span><br>
<span class="lineno">285</span><span class="op" id="4574920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4574923">func</span>&nbsp;<span class="op" id="4574928">(</span><span class="ident" id="4574929">w</span>&nbsp;<span class="op" id="4574931">*</span><span class="ident" id="4574932">huffmanBitWriter</span><span class="op" id="4574948">)</span>&nbsp;<span class="ident" id="4574950">writeCode</span><span class="op" id="4574959">(</span><span class="ident" id="4574960">code</span>&nbsp;<span class="op" id="4574965">*</span><span class="ident" id="4574966">huffmanEncoder</span><span class="op" id="4574980">,</span>&nbsp;<span class="ident" id="4574982">literal</span>&nbsp;<span class="builtintype" id="4574990">uint32</span><span class="op" id="4574996">)</span>&nbsp;<span class="op" id="4574998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4575001">if</span>&nbsp;<span class="ident" id="4575004">w</span><span class="op" id="4575005">.</span><span class="ident" id="4575006">err</span>&nbsp;<span class="op" id="4575010">!=</span>&nbsp;<span class="ident" id="4575013">nil</span>&nbsp;<span class="op" id="4575017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4575021">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4575029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4575032">w</span><span class="op" id="4575033">.</span><span class="ident" id="4575034">writeBits</span><span class="op" id="4575043">(</span><span class="builtintype" id="4575044">int32</span><span class="op" id="4575049">(</span><span class="ident" id="4575050">code</span><span class="op" id="4575054">.</span><span class="ident" id="4575055">code</span><span class="op" id="4575059">[</span><span class="ident" id="4575060">literal</span><span class="op" id="4575067">]</span><span class="op" id="4575068">)</span><span class="op" id="4575069">,</span>&nbsp;<span class="builtintype" id="4575071">int32</span><span class="op" id="4575076">(</span><span class="ident" id="4575077">code</span><span class="op" id="4575081">.</span><span class="ident" id="4575082">codeBits</span><span class="op" id="4575090">[</span><span class="ident" id="4575091">literal</span><span class="op" id="4575098">]</span><span class="op" id="4575099">)</span><span class="op" id="4575100">)</span><br>
<span class="lineno"></span><span class="op" id="4575102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4575105">//&nbsp;Write&nbsp;the&nbsp;header&nbsp;of&nbsp;a&nbsp;dynamic&nbsp;Huffman&nbsp;block&nbsp;to&nbsp;the&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">295</span><span class="comment" id="4575174">//</span><br>
<span class="lineno"></span><span class="comment" id="4575177">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4575238">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4575298">//&nbsp;&nbsp;numCodegens&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;codegens&nbsp;used&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="keyword" id="4575354">func</span>&nbsp;<span class="op" id="4575359">(</span><span class="ident" id="4575360">w</span>&nbsp;<span class="op" id="4575362">*</span><span class="ident" id="4575363">huffmanBitWriter</span><span class="op" id="4575379">)</span>&nbsp;<span class="ident" id="4575381">writeDynamicHeader</span><span class="op" id="4575399">(</span><span class="ident" id="4575400">numLiterals</span>&nbsp;<span class="builtintype" id="4575412">int</span><span class="op" id="4575415">,</span>&nbsp;<span class="ident" id="4575417">numOffsets</span>&nbsp;<span class="builtintype" id="4575428">int</span><span class="op" id="4575431">,</span>&nbsp;<span class="ident" id="4575433">numCodegens</span>&nbsp;<span class="builtintype" id="4575445">int</span><span class="op" id="4575448">,</span>&nbsp;<span class="ident" id="4575450">isEof</span>&nbsp;<span class="builtintype" id="4575456">bool</span><span class="op" id="4575460">)</span>&nbsp;<span class="op" id="4575462">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4575465">if</span>&nbsp;<span class="ident" id="4575468">w</span><span class="op" id="4575469">.</span><span class="ident" id="4575470">err</span>&nbsp;<span class="op" id="4575474">!=</span>&nbsp;<span class="ident" id="4575477">nil</span>&nbsp;<span class="op" id="4575481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4575485">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4575493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4575496">var</span>&nbsp;<span class="ident" id="4575500">firstBits</span>&nbsp;<span class="builtintype" id="4575510">int32</span>&nbsp;<span class="op" id="4575516">=</span>&nbsp;<span class="num" id="4575518">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4575521">if</span>&nbsp;<span class="ident" id="4575524">isEof</span>&nbsp;<span class="op" id="4575530">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4575534">firstBits</span>&nbsp;<span class="op" id="4575544">=</span>&nbsp;<span class="num" id="4575546">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4575549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4575552">w</span><span class="op" id="4575553">.</span><span class="ident" id="4575554">writeBits</span><span class="op" id="4575563">(</span><span class="ident" id="4575564">firstBits</span><span class="op" id="4575573">,</span>&nbsp;<span class="num" id="4575575">3</span><span class="op" id="4575576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4575579">w</span><span class="op" id="4575580">.</span><span class="ident" id="4575581">writeBits</span><span class="op" id="4575590">(</span><span class="builtintype" id="4575591">int32</span><span class="op" id="4575596">(</span><span class="ident" id="4575597">numLiterals</span><span class="op" id="4575608">-</span><span class="num" id="4575609">257</span><span class="op" id="4575612">)</span><span class="op" id="4575613">,</span>&nbsp;<span class="num" id="4575615">5</span><span class="op" id="4575616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4575619">w</span><span class="op" id="4575620">.</span><span class="ident" id="4575621">writeBits</span><span class="op" id="4575630">(</span><span class="builtintype" id="4575631">int32</span><span class="op" id="4575636">(</span><span class="ident" id="4575637">numOffsets</span><span class="op" id="4575647">-</span><span class="num" id="4575648">1</span><span class="op" id="4575649">)</span><span class="op" id="4575650">,</span>&nbsp;<span class="num" id="4575652">5</span><span class="op" id="4575653">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4575656">w</span><span class="op" id="4575657">.</span><span class="ident" id="4575658">writeBits</span><span class="op" id="4575667">(</span><span class="builtintype" id="4575668">int32</span><span class="op" id="4575673">(</span><span class="ident" id="4575674">numCodegens</span><span class="op" id="4575685">-</span><span class="num" id="4575686">4</span><span class="op" id="4575687">)</span><span class="op" id="4575688">,</span>&nbsp;<span class="num" id="4575690">4</span><span class="op" id="4575691">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4575695">for</span>&nbsp;<span class="ident" id="4575699">i</span>&nbsp;<span class="op" id="4575701">:=</span>&nbsp;<span class="num" id="4575704">0</span><span class="op" id="4575705">;</span>&nbsp;<span class="ident" id="4575707">i</span>&nbsp;<span class="op" id="4575709">&lt;</span>&nbsp;<span class="ident" id="4575711">numCodegens</span><span class="op" id="4575722">;</span>&nbsp;<span class="ident" id="4575724">i</span><span class="op" id="4575725">++</span>&nbsp;<span class="op" id="4575728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4575732">value</span>&nbsp;<span class="op" id="4575738">:=</span>&nbsp;<span class="ident" id="4575741">w</span><span class="op" id="4575742">.</span><span class="ident" id="4575743">codegenEncoding</span><span class="op" id="4575758">.</span><span class="ident" id="4575759">codeBits</span><span class="op" id="4575767">[</span><span class="ident" id="4575768">codegenOrder</span><span class="op" id="4575780">[</span><span class="ident" id="4575781">i</span><span class="op" id="4575782">]</span><span class="op" id="4575783">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4575787">w</span><span class="op" id="4575788">.</span><span class="ident" id="4575789">writeBits</span><span class="op" id="4575798">(</span><span class="builtintype" id="4575799">int32</span><span class="op" id="4575804">(</span><span class="ident" id="4575805">value</span><span class="op" id="4575810">)</span><span class="op" id="4575811">,</span>&nbsp;<span class="num" id="4575813">3</span><span class="op" id="4575814">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4575817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4575821">i</span>&nbsp;<span class="op" id="4575823">:=</span>&nbsp;<span class="num" id="4575826">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4575829">for</span>&nbsp;<span class="op" id="4575833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4575837">var</span>&nbsp;<span class="ident" id="4575841">codeWord</span>&nbsp;<span class="builtintype" id="4575850">int</span>&nbsp;<span class="op" id="4575854">=</span>&nbsp;<span class="builtintype" id="4575856">int</span><span class="op" id="4575859">(</span><span class="ident" id="4575860">w</span><span class="op" id="4575861">.</span><span class="ident" id="4575862">codegen</span><span class="op" id="4575869">[</span><span class="ident" id="4575870">i</span><span class="op" id="4575871">]</span><span class="op" id="4575872">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4575876">i</span><span class="op" id="4575877">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4575882">if</span>&nbsp;<span class="ident" id="4575885">codeWord</span>&nbsp;<span class="op" id="4575894">==</span>&nbsp;<span class="ident" id="4575897">badCode</span>&nbsp;<span class="op" id="4575905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4575910">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4575918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4575922">//&nbsp;The&nbsp;low&nbsp;byte&nbsp;contains&nbsp;the&nbsp;actual&nbsp;code&nbsp;to&nbsp;generate.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4575978">w</span><span class="op" id="4575979">.</span><span class="ident" id="4575980">writeCode</span><span class="op" id="4575989">(</span><span class="ident" id="4575990">w</span><span class="op" id="4575991">.</span><span class="ident" id="4575992">codegenEncoding</span><span class="op" id="4576007">,</span>&nbsp;<span class="builtintype" id="4576009">uint32</span><span class="op" id="4576015">(</span><span class="ident" id="4576016">codeWord</span><span class="op" id="4576024">)</span><span class="op" id="4576025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576030">switch</span>&nbsp;<span class="ident" id="4576037">codeWord</span>&nbsp;<span class="op" id="4576046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576050">case</span>&nbsp;<span class="num" id="4576055">16</span><span class="op" id="4576057">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576062">w</span><span class="op" id="4576063">.</span><span class="ident" id="4576064">writeBits</span><span class="op" id="4576073">(</span><span class="builtintype" id="4576074">int32</span><span class="op" id="4576079">(</span><span class="ident" id="4576080">w</span><span class="op" id="4576081">.</span><span class="ident" id="4576082">codegen</span><span class="op" id="4576089">[</span><span class="ident" id="4576090">i</span><span class="op" id="4576091">]</span><span class="op" id="4576092">)</span><span class="op" id="4576093">,</span>&nbsp;<span class="num" id="4576095">2</span><span class="op" id="4576096">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576101">i</span><span class="op" id="4576102">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576108">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576116">case</span>&nbsp;<span class="num" id="4576121">17</span><span class="op" id="4576123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576128">w</span><span class="op" id="4576129">.</span><span class="ident" id="4576130">writeBits</span><span class="op" id="4576139">(</span><span class="builtintype" id="4576140">int32</span><span class="op" id="4576145">(</span><span class="ident" id="4576146">w</span><span class="op" id="4576147">.</span><span class="ident" id="4576148">codegen</span><span class="op" id="4576155">[</span><span class="ident" id="4576156">i</span><span class="op" id="4576157">]</span><span class="op" id="4576158">)</span><span class="op" id="4576159">,</span>&nbsp;<span class="num" id="4576161">3</span><span class="op" id="4576162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576167">i</span><span class="op" id="4576168">++</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576174">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576182">case</span>&nbsp;<span class="num" id="4576187">18</span><span class="op" id="4576189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576194">w</span><span class="op" id="4576195">.</span><span class="ident" id="4576196">writeBits</span><span class="op" id="4576205">(</span><span class="builtintype" id="4576206">int32</span><span class="op" id="4576211">(</span><span class="ident" id="4576212">w</span><span class="op" id="4576213">.</span><span class="ident" id="4576214">codegen</span><span class="op" id="4576221">[</span><span class="ident" id="4576222">i</span><span class="op" id="4576223">]</span><span class="op" id="4576224">)</span><span class="op" id="4576225">,</span>&nbsp;<span class="num" id="4576227">7</span><span class="op" id="4576228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576233">i</span><span class="op" id="4576234">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576240">break</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4576248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4576251">}</span><br>
<span class="lineno"></span><span class="op" id="4576253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4576256">func</span>&nbsp;<span class="op" id="4576261">(</span><span class="ident" id="4576262">w</span>&nbsp;<span class="op" id="4576264">*</span><span class="ident" id="4576265">huffmanBitWriter</span><span class="op" id="4576281">)</span>&nbsp;<span class="ident" id="4576283">writeStoredHeader</span><span class="op" id="4576300">(</span><span class="ident" id="4576301">length</span>&nbsp;<span class="builtintype" id="4576308">int</span><span class="op" id="4576311">,</span>&nbsp;<span class="ident" id="4576313">isEof</span>&nbsp;<span class="builtintype" id="4576319">bool</span><span class="op" id="4576323">)</span>&nbsp;<span class="op" id="4576325">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576328">if</span>&nbsp;<span class="ident" id="4576331">w</span><span class="op" id="4576332">.</span><span class="ident" id="4576333">err</span>&nbsp;<span class="op" id="4576337">!=</span>&nbsp;<span class="ident" id="4576340">nil</span>&nbsp;<span class="op" id="4576344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576348">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4576356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576359">var</span>&nbsp;<span class="ident" id="4576363">flag</span>&nbsp;<span class="builtintype" id="4576368">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576375">if</span>&nbsp;<span class="ident" id="4576378">isEof</span>&nbsp;<span class="op" id="4576384">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576388">flag</span>&nbsp;<span class="op" id="4576393">=</span>&nbsp;<span class="num" id="4576395">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4576398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576401">w</span><span class="op" id="4576402">.</span><span class="ident" id="4576403">writeBits</span><span class="op" id="4576412">(</span><span class="ident" id="4576413">flag</span><span class="op" id="4576417">,</span>&nbsp;<span class="num" id="4576419">3</span><span class="op" id="4576420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576423">w</span><span class="op" id="4576424">.</span><span class="ident" id="4576425">flush</span><span class="op" id="4576430">(</span><span class="op" id="4576431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576434">w</span><span class="op" id="4576435">.</span><span class="ident" id="4576436">writeBits</span><span class="op" id="4576445">(</span><span class="builtintype" id="4576446">int32</span><span class="op" id="4576451">(</span><span class="ident" id="4576452">length</span><span class="op" id="4576458">)</span><span class="op" id="4576459">,</span>&nbsp;<span class="num" id="4576461">16</span><span class="op" id="4576463">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576466">w</span><span class="op" id="4576467">.</span><span class="ident" id="4576468">writeBits</span><span class="op" id="4576477">(</span><span class="builtintype" id="4576478">int32</span><span class="op" id="4576483">(</span><span class="op" id="4576484">^</span><span class="builtintype" id="4576485">uint16</span><span class="op" id="4576491">(</span><span class="ident" id="4576492">length</span><span class="op" id="4576498">)</span><span class="op" id="4576499">)</span><span class="op" id="4576500">,</span>&nbsp;<span class="num" id="4576502">16</span><span class="op" id="4576504">)</span><br>
<span class="lineno"></span><span class="op" id="4576506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4576509">func</span>&nbsp;<span class="op" id="4576514">(</span><span class="ident" id="4576515">w</span>&nbsp;<span class="op" id="4576517">*</span><span class="ident" id="4576518">huffmanBitWriter</span><span class="op" id="4576534">)</span>&nbsp;<span class="ident" id="4576536">writeFixedHeader</span><span class="op" id="4576552">(</span><span class="ident" id="4576553">isEof</span>&nbsp;<span class="builtintype" id="4576559">bool</span><span class="op" id="4576563">)</span>&nbsp;<span class="op" id="4576565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576568">if</span>&nbsp;<span class="ident" id="4576571">w</span><span class="op" id="4576572">.</span><span class="ident" id="4576573">err</span>&nbsp;<span class="op" id="4576577">!=</span>&nbsp;<span class="ident" id="4576580">nil</span>&nbsp;<span class="op" id="4576584">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576588">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4576596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4576599">//&nbsp;Indicate&nbsp;that&nbsp;we&nbsp;are&nbsp;a&nbsp;fixed&nbsp;Huffman&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576646">var</span>&nbsp;<span class="ident" id="4576650">value</span>&nbsp;<span class="builtintype" id="4576656">int32</span>&nbsp;<span class="op" id="4576662">=</span>&nbsp;<span class="num" id="4576664">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576667">if</span>&nbsp;<span class="ident" id="4576670">isEof</span>&nbsp;<span class="op" id="4576676">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576680">value</span>&nbsp;<span class="op" id="4576686">=</span>&nbsp;<span class="num" id="4576688">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4576691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576694">w</span><span class="op" id="4576695">.</span><span class="ident" id="4576696">writeBits</span><span class="op" id="4576705">(</span><span class="ident" id="4576706">value</span><span class="op" id="4576711">,</span>&nbsp;<span class="num" id="4576713">3</span><span class="op" id="4576714">)</span><br>
<span class="lineno"></span><span class="op" id="4576716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="4576719">func</span>&nbsp;<span class="op" id="4576724">(</span><span class="ident" id="4576725">w</span>&nbsp;<span class="op" id="4576727">*</span><span class="ident" id="4576728">huffmanBitWriter</span><span class="op" id="4576744">)</span>&nbsp;<span class="ident" id="4576746">writeBlock</span><span class="op" id="4576756">(</span><span class="ident" id="4576757">tokens</span>&nbsp;<span class="op" id="4576764">[</span><span class="op" id="4576765">]</span><span class="ident" id="4576766">token</span><span class="op" id="4576771">,</span>&nbsp;<span class="ident" id="4576773">eof</span>&nbsp;<span class="builtintype" id="4576777">bool</span><span class="op" id="4576781">,</span>&nbsp;<span class="ident" id="4576783">input</span>&nbsp;<span class="op" id="4576789">[</span><span class="op" id="4576790">]</span><span class="builtintype" id="4576791">byte</span><span class="op" id="4576795">)</span>&nbsp;<span class="op" id="4576797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576800">if</span>&nbsp;<span class="ident" id="4576803">w</span><span class="op" id="4576804">.</span><span class="ident" id="4576805">err</span>&nbsp;<span class="op" id="4576809">!=</span>&nbsp;<span class="ident" id="4576812">nil</span>&nbsp;<span class="op" id="4576816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576820">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4576828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576831">for</span>&nbsp;<span class="ident" id="4576835">i</span>&nbsp;<span class="op" id="4576837">:=</span>&nbsp;<span class="keyword" id="4576840">range</span>&nbsp;<span class="ident" id="4576846">w</span><span class="op" id="4576847">.</span><span class="ident" id="4576848">literalFreq</span>&nbsp;<span class="op" id="4576860">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576864">w</span><span class="op" id="4576865">.</span><span class="ident" id="4576866">literalFreq</span><span class="op" id="4576877">[</span><span class="ident" id="4576878">i</span><span class="op" id="4576879">]</span>&nbsp;<span class="op" id="4576881">=</span>&nbsp;<span class="num" id="4576883">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4576886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4576889">for</span>&nbsp;<span class="ident" id="4576893">i</span>&nbsp;<span class="op" id="4576895">:=</span>&nbsp;<span class="keyword" id="4576898">range</span>&nbsp;<span class="ident" id="4576904">w</span><span class="op" id="4576905">.</span><span class="ident" id="4576906">offsetFreq</span>&nbsp;<span class="op" id="4576917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576921">w</span><span class="op" id="4576922">.</span><span class="ident" id="4576923">offsetFreq</span><span class="op" id="4576933">[</span><span class="ident" id="4576934">i</span><span class="op" id="4576935">]</span>&nbsp;<span class="op" id="4576937">=</span>&nbsp;<span class="num" id="4576939">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4576942">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576946">n</span>&nbsp;<span class="op" id="4576948">:=</span>&nbsp;<span class="builtinfunc" id="4576951">len</span><span class="op" id="4576954">(</span><span class="ident" id="4576955">tokens</span><span class="op" id="4576961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576964">tokens</span>&nbsp;<span class="op" id="4576971">=</span>&nbsp;<span class="ident" id="4576973">tokens</span><span class="op" id="4576979">[</span><span class="num" id="4576980">0</span>&nbsp;<span class="op" id="4576982">:</span>&nbsp;<span class="ident" id="4576984">n</span><span class="op" id="4576985">+</span><span class="num" id="4576986">1</span><span class="op" id="4576987">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4576990">tokens</span><span class="op" id="4576996">[</span><span class="ident" id="4576997">n</span><span class="op" id="4576998">]</span>&nbsp;<span class="op" id="4577000">=</span>&nbsp;<span class="ident" id="4577002">endBlockMarker</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4577019">for</span>&nbsp;<span class="ident" id="4577023">_</span><span class="op" id="4577024">,</span>&nbsp;<span class="ident" id="4577026">t</span>&nbsp;<span class="op" id="4577028">:=</span>&nbsp;<span class="keyword" id="4577031">range</span>&nbsp;<span class="ident" id="4577037">tokens</span>&nbsp;<span class="op" id="4577044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4577048">switch</span>&nbsp;<span class="ident" id="4577055">t</span><span class="op" id="4577056">.</span><span class="ident" id="4577057">typ</span><span class="op" id="4577060">(</span><span class="op" id="4577061">)</span>&nbsp;<span class="op" id="4577063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4577067">case</span>&nbsp;<span class="ident" id="4577072">literalType</span><span class="op" id="4577083">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577088">w</span><span class="op" id="4577089">.</span><span class="ident" id="4577090">literalFreq</span><span class="op" id="4577101">[</span><span class="ident" id="4577102">t</span><span class="op" id="4577103">.</span><span class="ident" id="4577104">literal</span><span class="op" id="4577111">(</span><span class="op" id="4577112">)</span><span class="op" id="4577113">]</span><span class="op" id="4577114">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4577119">case</span>&nbsp;<span class="ident" id="4577124">matchType</span><span class="op" id="4577133">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577138">length</span>&nbsp;<span class="op" id="4577145">:=</span>&nbsp;<span class="ident" id="4577148">t</span><span class="op" id="4577149">.</span><span class="ident" id="4577150">length</span><span class="op" id="4577156">(</span><span class="op" id="4577157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577162">offset</span>&nbsp;<span class="op" id="4577169">:=</span>&nbsp;<span class="ident" id="4577172">t</span><span class="op" id="4577173">.</span><span class="ident" id="4577174">offset</span><span class="op" id="4577180">(</span><span class="op" id="4577181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577186">w</span><span class="op" id="4577187">.</span><span class="ident" id="4577188">literalFreq</span><span class="op" id="4577199">[</span><span class="ident" id="4577200">lengthCodesStart</span><span class="op" id="4577216">+</span><span class="ident" id="4577217">lengthCode</span><span class="op" id="4577227">(</span><span class="ident" id="4577228">length</span><span class="op" id="4577234">)</span><span class="op" id="4577235">]</span><span class="op" id="4577236">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577242">w</span><span class="op" id="4577243">.</span><span class="ident" id="4577244">offsetFreq</span><span class="op" id="4577254">[</span><span class="ident" id="4577255">offsetCode</span><span class="op" id="4577265">(</span><span class="ident" id="4577266">offset</span><span class="op" id="4577272">)</span><span class="op" id="4577273">]</span><span class="op" id="4577274">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4577279">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4577282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4577286">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577317">numLiterals</span>&nbsp;<span class="op" id="4577329">:=</span>&nbsp;<span class="builtinfunc" id="4577332">len</span><span class="op" id="4577335">(</span><span class="ident" id="4577336">w</span><span class="op" id="4577337">.</span><span class="ident" id="4577338">literalFreq</span><span class="op" id="4577349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4577352">for</span>&nbsp;<span class="ident" id="4577356">w</span><span class="op" id="4577357">.</span><span class="ident" id="4577358">literalFreq</span><span class="op" id="4577369">[</span><span class="ident" id="4577370">numLiterals</span><span class="op" id="4577381">-</span><span class="num" id="4577382">1</span><span class="op" id="4577383">]</span>&nbsp;<span class="op" id="4577385">==</span>&nbsp;<span class="num" id="4577388">0</span>&nbsp;<span class="op" id="4577390">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577394">numLiterals</span><span class="op" id="4577405">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4577409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4577412">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577442">numOffsets</span>&nbsp;<span class="op" id="4577453">:=</span>&nbsp;<span class="builtinfunc" id="4577456">len</span><span class="op" id="4577459">(</span><span class="ident" id="4577460">w</span><span class="op" id="4577461">.</span><span class="ident" id="4577462">offsetFreq</span><span class="op" id="4577472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4577475">for</span>&nbsp;<span class="ident" id="4577479">numOffsets</span>&nbsp;<span class="op" id="4577490">&gt;</span>&nbsp;<span class="num" id="4577492">0</span>&nbsp;<span class="op" id="4577494">&amp;&amp;</span>&nbsp;<span class="ident" id="4577497">w</span><span class="op" id="4577498">.</span><span class="ident" id="4577499">offsetFreq</span><span class="op" id="4577509">[</span><span class="ident" id="4577510">numOffsets</span><span class="op" id="4577520">-</span><span class="num" id="4577521">1</span><span class="op" id="4577522">]</span>&nbsp;<span class="op" id="4577524">==</span>&nbsp;<span class="num" id="4577527">0</span>&nbsp;<span class="op" id="4577529">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577533">numOffsets</span><span class="op" id="4577543">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4577547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4577550">if</span>&nbsp;<span class="ident" id="4577553">numOffsets</span>&nbsp;<span class="op" id="4577564">==</span>&nbsp;<span class="num" id="4577567">0</span>&nbsp;<span class="op" id="4577569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4577573">//&nbsp;We&nbsp;haven&#39;t&nbsp;found&nbsp;a&nbsp;single&nbsp;match.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;go&nbsp;with&nbsp;the&nbsp;dynamic&nbsp;encoding,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4577655">//&nbsp;we&nbsp;should&nbsp;count&nbsp;at&nbsp;least&nbsp;one&nbsp;offset&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;the&nbsp;offset&nbsp;huffman&nbsp;tree&nbsp;could&nbsp;be&nbsp;encoded.</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577754">w</span><span class="op" id="4577755">.</span><span class="ident" id="4577756">offsetFreq</span><span class="op" id="4577766">[</span><span class="num" id="4577767">0</span><span class="op" id="4577768">]</span>&nbsp;<span class="op" id="4577770">=</span>&nbsp;<span class="num" id="4577772">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577776">numOffsets</span>&nbsp;<span class="op" id="4577787">=</span>&nbsp;<span class="num" id="4577789">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4577792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577796">w</span><span class="op" id="4577797">.</span><span class="ident" id="4577798">literalEncoding</span><span class="op" id="4577813">.</span><span class="ident" id="4577814">generate</span><span class="op" id="4577822">(</span><span class="ident" id="4577823">w</span><span class="op" id="4577824">.</span><span class="ident" id="4577825">literalFreq</span><span class="op" id="4577836">,</span>&nbsp;<span class="num" id="4577838">15</span><span class="op" id="4577840">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577843">w</span><span class="op" id="4577844">.</span><span class="ident" id="4577845">offsetEncoding</span><span class="op" id="4577859">.</span><span class="ident" id="4577860">generate</span><span class="op" id="4577868">(</span><span class="ident" id="4577869">w</span><span class="op" id="4577870">.</span><span class="ident" id="4577871">offsetFreq</span><span class="op" id="4577881">,</span>&nbsp;<span class="num" id="4577883">15</span><span class="op" id="4577885">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577889">storedBytes</span>&nbsp;<span class="op" id="4577901">:=</span>&nbsp;<span class="num" id="4577904">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4577907">if</span>&nbsp;<span class="ident" id="4577910">input</span>&nbsp;<span class="op" id="4577916">!=</span>&nbsp;<span class="ident" id="4577919">nil</span>&nbsp;<span class="op" id="4577923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4577927">storedBytes</span>&nbsp;<span class="op" id="4577939">=</span>&nbsp;<span class="builtinfunc" id="4577941">len</span><span class="op" id="4577944">(</span><span class="ident" id="4577945">input</span><span class="op" id="4577950">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4577953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4577956">var</span>&nbsp;<span class="ident" id="4577960">extraBits</span>&nbsp;<span class="ident" id="4577970">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4577977">var</span>&nbsp;<span class="ident" id="4577981">storedSize</span>&nbsp;<span class="ident" id="4577992">int64</span>&nbsp;<span class="op" id="4577998">=</span>&nbsp;<span class="ident" id="4578000">math</span><span class="op" id="4578004">.</span><span class="ident" id="4578005">MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4578015">if</span>&nbsp;<span class="ident" id="4578018">storedBytes</span>&nbsp;<span class="op" id="4578030">&lt;=</span>&nbsp;<span class="ident" id="4578033">maxStoreBlockSize</span>&nbsp;<span class="op" id="4578051">&amp;&amp;</span>&nbsp;<span class="ident" id="4578054">input</span>&nbsp;<span class="op" id="4578060">!=</span>&nbsp;<span class="ident" id="4578063">nil</span>&nbsp;<span class="op" id="4578067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4578071">storedSize</span>&nbsp;<span class="op" id="4578082">=</span>&nbsp;<span class="ident" id="4578084">int64</span><span class="op" id="4578089">(</span><span class="op" id="4578090">(</span><span class="ident" id="4578091">storedBytes</span>&nbsp;<span class="op" id="4578103">+</span>&nbsp;<span class="num" id="4578105">5</span><span class="op" id="4578106">)</span>&nbsp;<span class="op" id="4578108">*</span>&nbsp;<span class="num" id="4578110">8</span><span class="op" id="4578111">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4578115">//&nbsp;We&nbsp;only&nbsp;bother&nbsp;calculating&nbsp;the&nbsp;costs&nbsp;of&nbsp;the&nbsp;extra&nbsp;bits&nbsp;required&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4578187">//&nbsp;the&nbsp;length&nbsp;of&nbsp;offset&nbsp;fields&nbsp;(which&nbsp;will&nbsp;be&nbsp;the&nbsp;same&nbsp;for&nbsp;both&nbsp;fixed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4578259">//&nbsp;and&nbsp;dynamic&nbsp;encoding),&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;compare&nbsp;those&nbsp;two&nbsp;encodings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4578329">//&nbsp;against&nbsp;stored&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4578359">for</span>&nbsp;<span class="ident" id="4578363">lengthCode</span>&nbsp;<span class="op" id="4578374">:=</span>&nbsp;<span class="ident" id="4578377">lengthCodesStart</span>&nbsp;<span class="op" id="4578394">+</span>&nbsp;<span class="num" id="4578396">8</span><span class="op" id="4578397">;</span>&nbsp;<span class="ident" id="4578399">lengthCode</span>&nbsp;<span class="op" id="4578410">&lt;</span>&nbsp;<span class="ident" id="4578412">numLiterals</span><span class="op" id="4578423">;</span>&nbsp;<span class="ident" id="4578425">lengthCode</span><span class="op" id="4578435">++</span>&nbsp;<span class="op" id="4578438">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4578443">//&nbsp;First&nbsp;eight&nbsp;length&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4578495">extraBits</span>&nbsp;<span class="op" id="4578505">+=</span>&nbsp;<span class="ident" id="4578508">int64</span><span class="op" id="4578513">(</span><span class="ident" id="4578514">w</span><span class="op" id="4578515">.</span><span class="ident" id="4578516">literalFreq</span><span class="op" id="4578527">[</span><span class="ident" id="4578528">lengthCode</span><span class="op" id="4578538">]</span><span class="op" id="4578539">)</span>&nbsp;<span class="op" id="4578541">*</span>&nbsp;<span class="ident" id="4578543">int64</span><span class="op" id="4578548">(</span><span class="ident" id="4578549">lengthExtraBits</span><span class="op" id="4578564">[</span><span class="ident" id="4578565">lengthCode</span><span class="op" id="4578575">-</span><span class="ident" id="4578576">lengthCodesStart</span><span class="op" id="4578592">]</span><span class="op" id="4578593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4578597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4578601">for</span>&nbsp;<span class="ident" id="4578605">offsetCode</span>&nbsp;<span class="op" id="4578616">:=</span>&nbsp;<span class="num" id="4578619">4</span><span class="op" id="4578620">;</span>&nbsp;<span class="ident" id="4578622">offsetCode</span>&nbsp;<span class="op" id="4578633">&lt;</span>&nbsp;<span class="ident" id="4578635">numOffsets</span><span class="op" id="4578645">;</span>&nbsp;<span class="ident" id="4578647">offsetCode</span><span class="op" id="4578657">++</span>&nbsp;<span class="op" id="4578660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4578665">//&nbsp;First&nbsp;four&nbsp;offset&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4578716">extraBits</span>&nbsp;<span class="op" id="4578726">+=</span>&nbsp;<span class="ident" id="4578729">int64</span><span class="op" id="4578734">(</span><span class="ident" id="4578735">w</span><span class="op" id="4578736">.</span><span class="ident" id="4578737">offsetFreq</span><span class="op" id="4578747">[</span><span class="ident" id="4578748">offsetCode</span><span class="op" id="4578758">]</span><span class="op" id="4578759">)</span>&nbsp;<span class="op" id="4578761">*</span>&nbsp;<span class="ident" id="4578763">int64</span><span class="op" id="4578768">(</span><span class="ident" id="4578769">offsetExtraBits</span><span class="op" id="4578784">[</span><span class="ident" id="4578785">offsetCode</span><span class="op" id="4578795">]</span><span class="op" id="4578796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4578800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4578803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4578807">//&nbsp;Figure&nbsp;out&nbsp;smallest&nbsp;code.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4578837">//&nbsp;Fixed&nbsp;Huffman&nbsp;baseline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4578865">var</span>&nbsp;<span class="ident" id="4578869">size</span>&nbsp;<span class="op" id="4578874">=</span>&nbsp;<span class="ident" id="4578876">int64</span><span class="op" id="4578881">(</span><span class="num" id="4578882">3</span><span class="op" id="4578883">)</span>&nbsp;<span class="op" id="4578885">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4578889">fixedLiteralEncoding</span><span class="op" id="4578909">.</span><span class="ident" id="4578910">bitLength</span><span class="op" id="4578919">(</span><span class="ident" id="4578920">w</span><span class="op" id="4578921">.</span><span class="ident" id="4578922">literalFreq</span><span class="op" id="4578933">)</span>&nbsp;<span class="op" id="4578935">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4578939">fixedOffsetEncoding</span><span class="op" id="4578958">.</span><span class="ident" id="4578959">bitLength</span><span class="op" id="4578968">(</span><span class="ident" id="4578969">w</span><span class="op" id="4578970">.</span><span class="ident" id="4578971">offsetFreq</span><span class="op" id="4578981">)</span>&nbsp;<span class="op" id="4578983">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4578987">extraBits</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4578998">var</span>&nbsp;<span class="ident" id="4579002">literalEncoding</span>&nbsp;<span class="op" id="4579018">=</span>&nbsp;<span class="ident" id="4579020">fixedLiteralEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4579042">var</span>&nbsp;<span class="ident" id="4579046">offsetEncoding</span>&nbsp;<span class="op" id="4579061">=</span>&nbsp;<span class="ident" id="4579063">fixedOffsetEncoding</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4579085">//&nbsp;Dynamic&nbsp;Huffman?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4579106">var</span>&nbsp;<span class="ident" id="4579110">numCodegens</span>&nbsp;<span class="builtintype" id="4579122">int</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4579128">//&nbsp;Generate&nbsp;codegen&nbsp;and&nbsp;codegenFrequencies,&nbsp;which&nbsp;indicates&nbsp;how&nbsp;to&nbsp;encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4579203">//&nbsp;the&nbsp;literalEncoding&nbsp;and&nbsp;the&nbsp;offsetEncoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579251">w</span><span class="op" id="4579252">.</span><span class="ident" id="4579253">generateCodegen</span><span class="op" id="4579268">(</span><span class="ident" id="4579269">numLiterals</span><span class="op" id="4579280">,</span>&nbsp;<span class="ident" id="4579282">numOffsets</span><span class="op" id="4579292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579295">w</span><span class="op" id="4579296">.</span><span class="ident" id="4579297">codegenEncoding</span><span class="op" id="4579312">.</span><span class="ident" id="4579313">generate</span><span class="op" id="4579321">(</span><span class="ident" id="4579322">w</span><span class="op" id="4579323">.</span><span class="ident" id="4579324">codegenFreq</span><span class="op" id="4579335">,</span>&nbsp;<span class="num" id="4579337">7</span><span class="op" id="4579338">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579341">numCodegens</span>&nbsp;<span class="op" id="4579353">=</span>&nbsp;<span class="builtinfunc" id="4579355">len</span><span class="op" id="4579358">(</span><span class="ident" id="4579359">w</span><span class="op" id="4579360">.</span><span class="ident" id="4579361">codegenFreq</span><span class="op" id="4579372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4579375">for</span>&nbsp;<span class="ident" id="4579379">numCodegens</span>&nbsp;<span class="op" id="4579391">&gt;</span>&nbsp;<span class="num" id="4579393">4</span>&nbsp;<span class="op" id="4579395">&amp;&amp;</span>&nbsp;<span class="ident" id="4579398">w</span><span class="op" id="4579399">.</span><span class="ident" id="4579400">codegenFreq</span><span class="op" id="4579411">[</span><span class="ident" id="4579412">codegenOrder</span><span class="op" id="4579424">[</span><span class="ident" id="4579425">numCodegens</span><span class="op" id="4579436">-</span><span class="num" id="4579437">1</span><span class="op" id="4579438">]</span><span class="op" id="4579439">]</span>&nbsp;<span class="op" id="4579441">==</span>&nbsp;<span class="num" id="4579444">0</span>&nbsp;<span class="op" id="4579446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579450">numCodegens</span><span class="op" id="4579461">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4579465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579468">dynamicHeader</span>&nbsp;<span class="op" id="4579482">:=</span>&nbsp;<span class="ident" id="4579485">int64</span><span class="op" id="4579490">(</span><span class="num" id="4579491">3</span><span class="op" id="4579492">+</span><span class="num" id="4579493">5</span><span class="op" id="4579494">+</span><span class="num" id="4579495">5</span><span class="op" id="4579496">+</span><span class="num" id="4579497">4</span><span class="op" id="4579498">+</span><span class="op" id="4579499">(</span><span class="num" id="4579500">3</span><span class="op" id="4579501">*</span><span class="ident" id="4579502">numCodegens</span><span class="op" id="4579513">)</span><span class="op" id="4579514">)</span>&nbsp;<span class="op" id="4579516">+</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579520">w</span><span class="op" id="4579521">.</span><span class="ident" id="4579522">codegenEncoding</span><span class="op" id="4579537">.</span><span class="ident" id="4579538">bitLength</span><span class="op" id="4579547">(</span><span class="ident" id="4579548">w</span><span class="op" id="4579549">.</span><span class="ident" id="4579550">codegenFreq</span><span class="op" id="4579561">)</span>&nbsp;<span class="op" id="4579563">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579567">int64</span><span class="op" id="4579572">(</span><span class="ident" id="4579573">extraBits</span><span class="op" id="4579582">)</span>&nbsp;<span class="op" id="4579584">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579588">int64</span><span class="op" id="4579593">(</span><span class="ident" id="4579594">w</span><span class="op" id="4579595">.</span><span class="ident" id="4579596">codegenFreq</span><span class="op" id="4579607">[</span><span class="num" id="4579608">16</span><span class="op" id="4579610">]</span><span class="op" id="4579611">*</span><span class="num" id="4579612">2</span><span class="op" id="4579613">)</span>&nbsp;<span class="op" id="4579615">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579619">int64</span><span class="op" id="4579624">(</span><span class="ident" id="4579625">w</span><span class="op" id="4579626">.</span><span class="ident" id="4579627">codegenFreq</span><span class="op" id="4579638">[</span><span class="num" id="4579639">17</span><span class="op" id="4579641">]</span><span class="op" id="4579642">*</span><span class="num" id="4579643">3</span><span class="op" id="4579644">)</span>&nbsp;<span class="op" id="4579646">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579650">int64</span><span class="op" id="4579655">(</span><span class="ident" id="4579656">w</span><span class="op" id="4579657">.</span><span class="ident" id="4579658">codegenFreq</span><span class="op" id="4579669">[</span><span class="num" id="4579670">18</span><span class="op" id="4579672">]</span><span class="op" id="4579673">*</span><span class="num" id="4579674">7</span><span class="op" id="4579675">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579678">dynamicSize</span>&nbsp;<span class="op" id="4579690">:=</span>&nbsp;<span class="ident" id="4579693">dynamicHeader</span>&nbsp;<span class="op" id="4579707">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579711">w</span><span class="op" id="4579712">.</span><span class="ident" id="4579713">literalEncoding</span><span class="op" id="4579728">.</span><span class="ident" id="4579729">bitLength</span><span class="op" id="4579738">(</span><span class="ident" id="4579739">w</span><span class="op" id="4579740">.</span><span class="ident" id="4579741">literalFreq</span><span class="op" id="4579752">)</span>&nbsp;<span class="op" id="4579754">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579758">w</span><span class="op" id="4579759">.</span><span class="ident" id="4579760">offsetEncoding</span><span class="op" id="4579774">.</span><span class="ident" id="4579775">bitLength</span><span class="op" id="4579784">(</span><span class="ident" id="4579785">w</span><span class="op" id="4579786">.</span><span class="ident" id="4579787">offsetFreq</span><span class="op" id="4579797">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4579801">if</span>&nbsp;<span class="ident" id="4579804">dynamicSize</span>&nbsp;<span class="op" id="4579816">&lt;</span>&nbsp;<span class="ident" id="4579818">size</span>&nbsp;<span class="op" id="4579823">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579827">size</span>&nbsp;<span class="op" id="4579832">=</span>&nbsp;<span class="ident" id="4579834">dynamicSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579848">literalEncoding</span>&nbsp;<span class="op" id="4579864">=</span>&nbsp;<span class="ident" id="4579866">w</span><span class="op" id="4579867">.</span><span class="ident" id="4579868">literalEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579886">offsetEncoding</span>&nbsp;<span class="op" id="4579901">=</span>&nbsp;<span class="ident" id="4579903">w</span><span class="op" id="4579904">.</span><span class="ident" id="4579905">offsetEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4579921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4579925">//&nbsp;Stored&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4579943">if</span>&nbsp;<span class="ident" id="4579946">storedSize</span>&nbsp;<span class="op" id="4579957">&lt;</span>&nbsp;<span class="ident" id="4579959">size</span>&nbsp;<span class="op" id="4579964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4579968">w</span><span class="op" id="4579969">.</span><span class="ident" id="4579970">writeStoredHeader</span><span class="op" id="4579987">(</span><span class="ident" id="4579988">storedBytes</span><span class="op" id="4579999">,</span>&nbsp;<span class="ident" id="4580001">eof</span><span class="op" id="4580004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580008">w</span><span class="op" id="4580009">.</span><span class="ident" id="4580010">writeBytes</span><span class="op" id="4580020">(</span><span class="ident" id="4580021">input</span><span class="op" id="4580026">[</span><span class="num" id="4580027">0</span><span class="op" id="4580028">:</span><span class="ident" id="4580029">storedBytes</span><span class="op" id="4580040">]</span><span class="op" id="4580041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580045">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4580053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4580057">//&nbsp;Huffman.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580070">if</span>&nbsp;<span class="ident" id="4580073">literalEncoding</span>&nbsp;<span class="op" id="4580089">==</span>&nbsp;<span class="ident" id="4580092">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4580113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580117">w</span><span class="op" id="4580118">.</span><span class="ident" id="4580119">writeFixedHeader</span><span class="op" id="4580135">(</span><span class="ident" id="4580136">eof</span><span class="op" id="4580139">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4580142">}</span>&nbsp;<span class="keyword" id="4580144">else</span>&nbsp;<span class="op" id="4580149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580153">w</span><span class="op" id="4580154">.</span><span class="ident" id="4580155">writeDynamicHeader</span><span class="op" id="4580173">(</span><span class="ident" id="4580174">numLiterals</span><span class="op" id="4580185">,</span>&nbsp;<span class="ident" id="4580187">numOffsets</span><span class="op" id="4580197">,</span>&nbsp;<span class="ident" id="4580199">numCodegens</span><span class="op" id="4580210">,</span>&nbsp;<span class="ident" id="4580212">eof</span><span class="op" id="4580215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4580218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580221">for</span>&nbsp;<span class="ident" id="4580225">_</span><span class="op" id="4580226">,</span>&nbsp;<span class="ident" id="4580228">t</span>&nbsp;<span class="op" id="4580230">:=</span>&nbsp;<span class="keyword" id="4580233">range</span>&nbsp;<span class="ident" id="4580239">tokens</span>&nbsp;<span class="op" id="4580246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580250">switch</span>&nbsp;<span class="ident" id="4580257">t</span><span class="op" id="4580258">.</span><span class="ident" id="4580259">typ</span><span class="op" id="4580262">(</span><span class="op" id="4580263">)</span>&nbsp;<span class="op" id="4580265">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580269">case</span>&nbsp;<span class="ident" id="4580274">literalType</span><span class="op" id="4580285">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580290">w</span><span class="op" id="4580291">.</span><span class="ident" id="4580292">writeCode</span><span class="op" id="4580301">(</span><span class="ident" id="4580302">literalEncoding</span><span class="op" id="4580317">,</span>&nbsp;<span class="ident" id="4580319">t</span><span class="op" id="4580320">.</span><span class="ident" id="4580321">literal</span><span class="op" id="4580328">(</span><span class="op" id="4580329">)</span><span class="op" id="4580330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580335">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580343">case</span>&nbsp;<span class="ident" id="4580348">matchType</span><span class="op" id="4580357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4580362">//&nbsp;Write&nbsp;the&nbsp;length</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580385">length</span>&nbsp;<span class="op" id="4580392">:=</span>&nbsp;<span class="ident" id="4580395">t</span><span class="op" id="4580396">.</span><span class="ident" id="4580397">length</span><span class="op" id="4580403">(</span><span class="op" id="4580404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580409">lengthCode</span>&nbsp;<span class="op" id="4580420">:=</span>&nbsp;<span class="ident" id="4580423">lengthCode</span><span class="op" id="4580433">(</span><span class="ident" id="4580434">length</span><span class="op" id="4580440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580445">w</span><span class="op" id="4580446">.</span><span class="ident" id="4580447">writeCode</span><span class="op" id="4580456">(</span><span class="ident" id="4580457">literalEncoding</span><span class="op" id="4580472">,</span>&nbsp;<span class="ident" id="4580474">lengthCode</span><span class="op" id="4580484">+</span><span class="ident" id="4580485">lengthCodesStart</span><span class="op" id="4580501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580506">extraLengthBits</span>&nbsp;<span class="op" id="4580522">:=</span>&nbsp;<span class="builtintype" id="4580525">int32</span><span class="op" id="4580530">(</span><span class="ident" id="4580531">lengthExtraBits</span><span class="op" id="4580546">[</span><span class="ident" id="4580547">lengthCode</span><span class="op" id="4580557">]</span><span class="op" id="4580558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580563">if</span>&nbsp;<span class="ident" id="4580566">extraLengthBits</span>&nbsp;<span class="op" id="4580582">&gt;</span>&nbsp;<span class="num" id="4580584">0</span>&nbsp;<span class="op" id="4580586">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580592">extraLength</span>&nbsp;<span class="op" id="4580604">:=</span>&nbsp;<span class="builtintype" id="4580607">int32</span><span class="op" id="4580612">(</span><span class="ident" id="4580613">length</span>&nbsp;<span class="op" id="4580620">-</span>&nbsp;<span class="ident" id="4580622">lengthBase</span><span class="op" id="4580632">[</span><span class="ident" id="4580633">lengthCode</span><span class="op" id="4580643">]</span><span class="op" id="4580644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580650">w</span><span class="op" id="4580651">.</span><span class="ident" id="4580652">writeBits</span><span class="op" id="4580661">(</span><span class="ident" id="4580662">extraLength</span><span class="op" id="4580673">,</span>&nbsp;<span class="ident" id="4580675">extraLengthBits</span><span class="op" id="4580690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4580695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4580700">//&nbsp;Write&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580723">offset</span>&nbsp;<span class="op" id="4580730">:=</span>&nbsp;<span class="ident" id="4580733">t</span><span class="op" id="4580734">.</span><span class="ident" id="4580735">offset</span><span class="op" id="4580741">(</span><span class="op" id="4580742">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580747">offsetCode</span>&nbsp;<span class="op" id="4580758">:=</span>&nbsp;<span class="ident" id="4580761">offsetCode</span><span class="op" id="4580771">(</span><span class="ident" id="4580772">offset</span><span class="op" id="4580778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580783">w</span><span class="op" id="4580784">.</span><span class="ident" id="4580785">writeCode</span><span class="op" id="4580794">(</span><span class="ident" id="4580795">offsetEncoding</span><span class="op" id="4580809">,</span>&nbsp;<span class="ident" id="4580811">offsetCode</span><span class="op" id="4580821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580826">extraOffsetBits</span>&nbsp;<span class="op" id="4580842">:=</span>&nbsp;<span class="builtintype" id="4580845">int32</span><span class="op" id="4580850">(</span><span class="ident" id="4580851">offsetExtraBits</span><span class="op" id="4580866">[</span><span class="ident" id="4580867">offsetCode</span><span class="op" id="4580877">]</span><span class="op" id="4580878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580883">if</span>&nbsp;<span class="ident" id="4580886">extraOffsetBits</span>&nbsp;<span class="op" id="4580902">&gt;</span>&nbsp;<span class="num" id="4580904">0</span>&nbsp;<span class="op" id="4580906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580912">extraOffset</span>&nbsp;<span class="op" id="4580924">:=</span>&nbsp;<span class="builtintype" id="4580927">int32</span><span class="op" id="4580932">(</span><span class="ident" id="4580933">offset</span>&nbsp;<span class="op" id="4580940">-</span>&nbsp;<span class="ident" id="4580942">offsetBase</span><span class="op" id="4580952">[</span><span class="ident" id="4580953">offsetCode</span><span class="op" id="4580963">]</span><span class="op" id="4580964">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580970">w</span><span class="op" id="4580971">.</span><span class="ident" id="4580972">writeBits</span><span class="op" id="4580981">(</span><span class="ident" id="4580982">extraOffset</span><span class="op" id="4580993">,</span>&nbsp;<span class="ident" id="4580995">extraOffsetBits</span><span class="op" id="4581010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4581015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4581020">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4581028">default</span><span class="op" id="4581035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4581040">panic</span><span class="op" id="4581045">(</span><span class="string" id="4581046">&#34;unknown&nbsp;token&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4581069">+</span>&nbsp;<span class="builtintype" id="4581071">string</span><span class="op" id="4581077">(</span><span class="ident" id="4581078">t</span><span class="op" id="4581079">)</span><span class="op" id="4581080">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4581084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4581087">}</span><br>
<span class="lineno"></span><span class="op" id="4581089">}</span>
</div>
</body>
</html>
