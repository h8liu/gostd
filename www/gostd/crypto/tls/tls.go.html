<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4273952">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4274007">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4274061">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4274112">//&nbsp;Package&nbsp;tls&nbsp;partially&nbsp;implements&nbsp;TLS&nbsp;1.2,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;5246.</span><br>
<span class="lineno"></span><span class="keyword" id="4274183">package</span>&nbsp;<span class="ident" id="4274191">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4274196">import</span>&nbsp;<span class="op" id="4274203">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4274206">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4274216">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4274232">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4274246">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4274261">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4274277">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4274287">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4274300">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4274307">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4274318">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4274325">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4274328">//&nbsp;Server&nbsp;returns&nbsp;a&nbsp;new&nbsp;TLS&nbsp;server&nbsp;side&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="4274379">//&nbsp;using&nbsp;conn&nbsp;as&nbsp;the&nbsp;underlying&nbsp;transport.</span><br>
<span class="lineno"></span><span class="comment" id="4274422">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4274480">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno">25</span><span class="keyword" id="4274509">func</span>&nbsp;<span class="ident" id="4274514">Server</span><span class="op" id="4274520">(</span><span class="ident" id="4274521">conn</span>&nbsp;<span class="ident" id="4274526">net</span><span class="op" id="4274529">.</span><span class="ident" id="4274530">Conn</span><span class="op" id="4274534">,</span>&nbsp;<span class="ident" id="4274536">config</span>&nbsp;<span class="op" id="4274543">*</span><span class="ident" id="4274544">Config</span><span class="op" id="4274550">)</span>&nbsp;<span class="op" id="4274552">*</span><span class="ident" id="4274553">Conn</span>&nbsp;<span class="op" id="4274558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274561">return</span>&nbsp;<span class="op" id="4274568">&amp;</span><span class="ident" id="4274569">Conn</span><span class="op" id="4274573">{</span><span class="ident" id="4274574">conn</span><span class="op" id="4274578">:</span>&nbsp;<span class="ident" id="4274580">conn</span><span class="op" id="4274584">,</span>&nbsp;<span class="ident" id="4274586">config</span><span class="op" id="4274592">:</span>&nbsp;<span class="ident" id="4274594">config</span><span class="op" id="4274600">}</span><br>
<span class="lineno"></span><span class="op" id="4274602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4274605">//&nbsp;Client&nbsp;returns&nbsp;a&nbsp;new&nbsp;TLS&nbsp;client&nbsp;side&nbsp;connection</span><br>
<span class="lineno">30</span><span class="comment" id="4274656">//&nbsp;using&nbsp;conn&nbsp;as&nbsp;the&nbsp;underlying&nbsp;transport.</span><br>
<span class="lineno"></span><span class="comment" id="4274699">//&nbsp;The&nbsp;config&nbsp;cannot&nbsp;be&nbsp;nil:&nbsp;users&nbsp;must&nbsp;set&nbsp;either&nbsp;ServerName&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4274764">//&nbsp;InsecureSkipVerify&nbsp;in&nbsp;the&nbsp;config.</span><br>
<span class="lineno"></span><span class="keyword" id="4274801">func</span>&nbsp;<span class="ident" id="4274806">Client</span><span class="op" id="4274812">(</span><span class="ident" id="4274813">conn</span>&nbsp;<span class="ident" id="4274818">net</span><span class="op" id="4274821">.</span><span class="ident" id="4274822">Conn</span><span class="op" id="4274826">,</span>&nbsp;<span class="ident" id="4274828">config</span>&nbsp;<span class="op" id="4274835">*</span><span class="ident" id="4274836">Config</span><span class="op" id="4274842">)</span>&nbsp;<span class="op" id="4274844">*</span><span class="ident" id="4274845">Conn</span>&nbsp;<span class="op" id="4274850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274853">return</span>&nbsp;<span class="op" id="4274860">&amp;</span><span class="ident" id="4274861">Conn</span><span class="op" id="4274865">{</span><span class="ident" id="4274866">conn</span><span class="op" id="4274870">:</span>&nbsp;<span class="ident" id="4274872">conn</span><span class="op" id="4274876">,</span>&nbsp;<span class="ident" id="4274878">config</span><span class="op" id="4274884">:</span>&nbsp;<span class="ident" id="4274886">config</span><span class="op" id="4274892">,</span>&nbsp;<span class="ident" id="4274894">isClient</span><span class="op" id="4274902">:</span>&nbsp;<span class="builtintype" id="4274904">true</span><span class="op" id="4274908">}</span><br>
<span class="lineno">35</span><span class="op" id="4274910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4274913">//&nbsp;A&nbsp;listener&nbsp;implements&nbsp;a&nbsp;network&nbsp;listener&nbsp;(net.Listener)&nbsp;for&nbsp;TLS&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="4274993">type</span>&nbsp;<span class="ident" id="4274998">listener</span>&nbsp;<span class="keyword" id="4275007">struct</span>&nbsp;<span class="op" id="4275014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275017">net</span><span class="op" id="4275020">.</span><span class="ident" id="4275021">Listener</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275031">config</span>&nbsp;<span class="op" id="4275038">*</span><span class="ident" id="4275039">Config</span><br>
<span class="lineno"></span><span class="op" id="4275046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4275049">//&nbsp;Accept&nbsp;waits&nbsp;for&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;incoming&nbsp;TLS&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4275115">//&nbsp;The&nbsp;returned&nbsp;connection&nbsp;c&nbsp;is&nbsp;a&nbsp;*tls.Conn.</span><br>
<span class="lineno">45</span><span class="keyword" id="4275160">func</span>&nbsp;<span class="op" id="4275165">(</span><span class="ident" id="4275166">l</span>&nbsp;<span class="op" id="4275168">*</span><span class="ident" id="4275169">listener</span><span class="op" id="4275177">)</span>&nbsp;<span class="ident" id="4275179">Accept</span><span class="op" id="4275185">(</span><span class="op" id="4275186">)</span>&nbsp;<span class="op" id="4275188">(</span><span class="ident" id="4275189">c</span>&nbsp;<span class="ident" id="4275191">net</span><span class="op" id="4275194">.</span><span class="ident" id="4275195">Conn</span><span class="op" id="4275199">,</span>&nbsp;<span class="ident" id="4275201">err</span>&nbsp;<span class="builtintype" id="4275205">error</span><span class="op" id="4275210">)</span>&nbsp;<span class="op" id="4275212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275215">c</span><span class="op" id="4275216">,</span>&nbsp;<span class="ident" id="4275218">err</span>&nbsp;<span class="op" id="4275222">=</span>&nbsp;<span class="ident" id="4275224">l</span><span class="op" id="4275225">.</span><span class="ident" id="4275226">Listener</span><span class="op" id="4275234">.</span><span class="ident" id="4275235">Accept</span><span class="op" id="4275241">(</span><span class="op" id="4275242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275245">if</span>&nbsp;<span class="ident" id="4275248">err</span>&nbsp;<span class="op" id="4275252">!=</span>&nbsp;<span class="ident" id="4275255">nil</span>&nbsp;<span class="op" id="4275259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275263">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275271">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275274">c</span>&nbsp;<span class="op" id="4275276">=</span>&nbsp;<span class="ident" id="4275278">Server</span><span class="op" id="4275284">(</span><span class="ident" id="4275285">c</span><span class="op" id="4275286">,</span>&nbsp;<span class="ident" id="4275288">l</span><span class="op" id="4275289">.</span><span class="ident" id="4275290">config</span><span class="op" id="4275296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275299">return</span><br>
<span class="lineno"></span><span class="op" id="4275306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4275309">//&nbsp;NewListener&nbsp;creates&nbsp;a&nbsp;Listener&nbsp;which&nbsp;accepts&nbsp;connections&nbsp;from&nbsp;an&nbsp;inner</span><br>
<span class="lineno">55</span><span class="comment" id="4275383">//&nbsp;Listener&nbsp;and&nbsp;wraps&nbsp;each&nbsp;connection&nbsp;with&nbsp;Server.</span><br>
<span class="lineno"></span><span class="comment" id="4275434">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4275492">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4275521">func</span>&nbsp;<span class="ident" id="4275526">NewListener</span><span class="op" id="4275537">(</span><span class="ident" id="4275538">inner</span>&nbsp;<span class="ident" id="4275544">net</span><span class="op" id="4275547">.</span><span class="ident" id="4275548">Listener</span><span class="op" id="4275556">,</span>&nbsp;<span class="ident" id="4275558">config</span>&nbsp;<span class="op" id="4275565">*</span><span class="ident" id="4275566">Config</span><span class="op" id="4275572">)</span>&nbsp;<span class="ident" id="4275574">net</span><span class="op" id="4275577">.</span><span class="ident" id="4275578">Listener</span>&nbsp;<span class="op" id="4275587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275590">l</span>&nbsp;<span class="op" id="4275592">:=</span>&nbsp;<span class="builtinfunc" id="4275595">new</span><span class="op" id="4275598">(</span><span class="ident" id="4275599">listener</span><span class="op" id="4275607">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275610">l</span><span class="op" id="4275611">.</span><span class="ident" id="4275612">Listener</span>&nbsp;<span class="op" id="4275621">=</span>&nbsp;<span class="ident" id="4275623">inner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275630">l</span><span class="op" id="4275631">.</span><span class="ident" id="4275632">config</span>&nbsp;<span class="op" id="4275639">=</span>&nbsp;<span class="ident" id="4275641">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275649">return</span>&nbsp;<span class="ident" id="4275656">l</span><br>
<span class="lineno"></span><span class="op" id="4275658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4275661">//&nbsp;Listen&nbsp;creates&nbsp;a&nbsp;TLS&nbsp;listener&nbsp;accepting&nbsp;connections&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4275723">//&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;net.Listen.</span><br>
<span class="lineno"></span><span class="comment" id="4275766">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4275824">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4275853">func</span>&nbsp;<span class="ident" id="4275858">Listen</span><span class="op" id="4275864">(</span><span class="ident" id="4275865">network</span><span class="op" id="4275872">,</span>&nbsp;<span class="ident" id="4275874">laddr</span>&nbsp;<span class="builtintype" id="4275880">string</span><span class="op" id="4275886">,</span>&nbsp;<span class="ident" id="4275888">config</span>&nbsp;<span class="op" id="4275895">*</span><span class="ident" id="4275896">Config</span><span class="op" id="4275902">)</span>&nbsp;<span class="op" id="4275904">(</span><span class="ident" id="4275905">net</span><span class="op" id="4275908">.</span><span class="ident" id="4275909">Listener</span><span class="op" id="4275917">,</span>&nbsp;<span class="builtintype" id="4275919">error</span><span class="op" id="4275924">)</span>&nbsp;<span class="op" id="4275926">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275929">if</span>&nbsp;<span class="ident" id="4275932">config</span>&nbsp;<span class="op" id="4275939">==</span>&nbsp;<span class="ident" id="4275942">nil</span>&nbsp;<span class="op" id="4275946">||</span>&nbsp;<span class="builtinfunc" id="4275949">len</span><span class="op" id="4275952">(</span><span class="ident" id="4275953">config</span><span class="op" id="4275959">.</span><span class="ident" id="4275960">Certificates</span><span class="op" id="4275972">)</span>&nbsp;<span class="op" id="4275974">==</span>&nbsp;<span class="num" id="4275977">0</span>&nbsp;<span class="op" id="4275979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275983">return</span>&nbsp;<span class="ident" id="4275990">nil</span><span class="op" id="4275993">,</span>&nbsp;<span class="ident" id="4275995">errors</span><span class="op" id="4276001">.</span><span class="ident" id="4276002">New</span><span class="op" id="4276005">(</span><span class="string" id="4276006">&#34;tls.Listen:&nbsp;no&nbsp;certificates&nbsp;in&nbsp;configuration&#34;</span><span class="op" id="4276052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4276055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276058">l</span><span class="op" id="4276059">,</span>&nbsp;<span class="ident" id="4276061">err</span>&nbsp;<span class="op" id="4276065">:=</span>&nbsp;<span class="ident" id="4276068">net</span><span class="op" id="4276071">.</span><span class="ident" id="4276072">Listen</span><span class="op" id="4276078">(</span><span class="ident" id="4276079">network</span><span class="op" id="4276086">,</span>&nbsp;<span class="ident" id="4276088">laddr</span><span class="op" id="4276093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276096">if</span>&nbsp;<span class="ident" id="4276099">err</span>&nbsp;<span class="op" id="4276103">!=</span>&nbsp;<span class="ident" id="4276106">nil</span>&nbsp;<span class="op" id="4276110">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276114">return</span>&nbsp;<span class="ident" id="4276121">nil</span><span class="op" id="4276124">,</span>&nbsp;<span class="ident" id="4276126">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4276131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276134">return</span>&nbsp;<span class="ident" id="4276141">NewListener</span><span class="op" id="4276152">(</span><span class="ident" id="4276153">l</span><span class="op" id="4276154">,</span>&nbsp;<span class="ident" id="4276156">config</span><span class="op" id="4276162">)</span><span class="op" id="4276163">,</span>&nbsp;<span class="ident" id="4276165">nil</span><br>
<span class="lineno"></span><span class="op" id="4276169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4276172">type</span>&nbsp;<span class="ident" id="4276177">timeoutError</span>&nbsp;<span class="keyword" id="4276190">struct</span><span class="op" id="4276196">{</span><span class="op" id="4276197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4276200">func</span>&nbsp;<span class="op" id="4276205">(</span><span class="ident" id="4276206">timeoutError</span><span class="op" id="4276218">)</span>&nbsp;<span class="ident" id="4276220">Error</span><span class="op" id="4276225">(</span><span class="op" id="4276226">)</span>&nbsp;<span class="builtintype" id="4276228">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4276237">{</span>&nbsp;<span class="keyword" id="4276239">return</span>&nbsp;<span class="string" id="4276246">&#34;tls:&nbsp;DialWithDialer&nbsp;timed&nbsp;out&#34;</span>&nbsp;<span class="op" id="4276278">}</span><br>
<span class="lineno"></span><span class="keyword" id="4276280">func</span>&nbsp;<span class="op" id="4276285">(</span><span class="ident" id="4276286">timeoutError</span><span class="op" id="4276298">)</span>&nbsp;<span class="ident" id="4276300">Timeout</span><span class="op" id="4276307">(</span><span class="op" id="4276308">)</span>&nbsp;<span class="builtintype" id="4276310">bool</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4276317">{</span>&nbsp;<span class="keyword" id="4276319">return</span>&nbsp;<span class="builtintype" id="4276326">true</span>&nbsp;<span class="op" id="4276331">}</span><br>
<span class="lineno"></span><span class="keyword" id="4276333">func</span>&nbsp;<span class="op" id="4276338">(</span><span class="ident" id="4276339">timeoutError</span><span class="op" id="4276351">)</span>&nbsp;<span class="ident" id="4276353">Temporary</span><span class="op" id="4276362">(</span><span class="op" id="4276363">)</span>&nbsp;<span class="builtintype" id="4276365">bool</span>&nbsp;<span class="op" id="4276370">{</span>&nbsp;<span class="keyword" id="4276372">return</span>&nbsp;<span class="builtintype" id="4276379">true</span>&nbsp;<span class="op" id="4276384">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4276387">//&nbsp;DialWithDialer&nbsp;connects&nbsp;to&nbsp;the&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;dialer.Dial&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4276465">//&nbsp;then&nbsp;initiates&nbsp;a&nbsp;TLS&nbsp;handshake,&nbsp;returning&nbsp;the&nbsp;resulting&nbsp;TLS&nbsp;connection.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="4276544">//&nbsp;timeout&nbsp;or&nbsp;deadline&nbsp;given&nbsp;in&nbsp;the&nbsp;dialer&nbsp;apply&nbsp;to&nbsp;connection&nbsp;and&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="4276615">//&nbsp;handshake&nbsp;as&nbsp;a&nbsp;whole.</span><br>
<span class="lineno">90</span><span class="comment" id="4276640">//</span><br>
<span class="lineno"></span><span class="comment" id="4276643">//&nbsp;DialWithDialer&nbsp;interprets&nbsp;a&nbsp;nil&nbsp;configuration&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="4276718">//&nbsp;configuration;&nbsp;see&nbsp;the&nbsp;documentation&nbsp;of&nbsp;Config&nbsp;for&nbsp;the&nbsp;defaults.</span><br>
<span class="lineno"></span><span class="keyword" id="4276786">func</span>&nbsp;<span class="ident" id="4276791">DialWithDialer</span><span class="op" id="4276805">(</span><span class="ident" id="4276806">dialer</span>&nbsp;<span class="op" id="4276813">*</span><span class="ident" id="4276814">net</span><span class="op" id="4276817">.</span><span class="ident" id="4276818">Dialer</span><span class="op" id="4276824">,</span>&nbsp;<span class="ident" id="4276826">network</span><span class="op" id="4276833">,</span>&nbsp;<span class="ident" id="4276835">addr</span>&nbsp;<span class="builtintype" id="4276840">string</span><span class="op" id="4276846">,</span>&nbsp;<span class="ident" id="4276848">config</span>&nbsp;<span class="op" id="4276855">*</span><span class="ident" id="4276856">Config</span><span class="op" id="4276862">)</span>&nbsp;<span class="op" id="4276864">(</span><span class="op" id="4276865">*</span><span class="ident" id="4276866">Conn</span><span class="op" id="4276870">,</span>&nbsp;<span class="builtintype" id="4276872">error</span><span class="op" id="4276877">)</span>&nbsp;<span class="op" id="4276879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276882">//&nbsp;We&nbsp;want&nbsp;the&nbsp;Timeout&nbsp;and&nbsp;Deadline&nbsp;values&nbsp;from&nbsp;dialer&nbsp;to&nbsp;cover&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276951">//&nbsp;whole&nbsp;process:&nbsp;TCP&nbsp;connection&nbsp;and&nbsp;TLS&nbsp;handshake.&nbsp;This&nbsp;means&nbsp;that&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277023">//&nbsp;also&nbsp;need&nbsp;to&nbsp;start&nbsp;our&nbsp;own&nbsp;timers&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277066">timeout</span>&nbsp;<span class="op" id="4277074">:=</span>&nbsp;<span class="ident" id="4277077">dialer</span><span class="op" id="4277083">.</span><span class="ident" id="4277084">Timeout</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277094">if</span>&nbsp;<span class="op" id="4277097">!</span><span class="ident" id="4277098">dialer</span><span class="op" id="4277104">.</span><span class="ident" id="4277105">Deadline</span><span class="op" id="4277113">.</span><span class="ident" id="4277114">IsZero</span><span class="op" id="4277120">(</span><span class="op" id="4277121">)</span>&nbsp;<span class="op" id="4277123">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277127">deadlineTimeout</span>&nbsp;<span class="op" id="4277143">:=</span>&nbsp;<span class="ident" id="4277146">dialer</span><span class="op" id="4277152">.</span><span class="ident" id="4277153">Deadline</span><span class="op" id="4277161">.</span><span class="ident" id="4277162">Sub</span><span class="op" id="4277165">(</span><span class="ident" id="4277166">time</span><span class="op" id="4277170">.</span><span class="ident" id="4277171">Now</span><span class="op" id="4277174">(</span><span class="op" id="4277175">)</span><span class="op" id="4277176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277180">if</span>&nbsp;<span class="ident" id="4277183">timeout</span>&nbsp;<span class="op" id="4277191">==</span>&nbsp;<span class="num" id="4277194">0</span>&nbsp;<span class="op" id="4277196">||</span>&nbsp;<span class="ident" id="4277199">deadlineTimeout</span>&nbsp;<span class="op" id="4277215">&lt;</span>&nbsp;<span class="ident" id="4277217">timeout</span>&nbsp;<span class="op" id="4277225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277230">timeout</span>&nbsp;<span class="op" id="4277238">=</span>&nbsp;<span class="ident" id="4277240">deadlineTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277261">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277265">var</span>&nbsp;<span class="ident" id="4277269">errChannel</span>&nbsp;<span class="keyword" id="4277280">chan</span>&nbsp;<span class="builtintype" id="4277285">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277293">if</span>&nbsp;<span class="ident" id="4277296">timeout</span>&nbsp;<span class="op" id="4277304">!=</span>&nbsp;<span class="num" id="4277307">0</span>&nbsp;<span class="op" id="4277309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277313">errChannel</span>&nbsp;<span class="op" id="4277324">=</span>&nbsp;<span class="builtinfunc" id="4277326">make</span><span class="op" id="4277330">(</span><span class="keyword" id="4277331">chan</span>&nbsp;<span class="builtintype" id="4277336">error</span><span class="op" id="4277341">,</span>&nbsp;<span class="num" id="4277343">2</span><span class="op" id="4277344">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277348">time</span><span class="op" id="4277352">.</span><span class="ident" id="4277353">AfterFunc</span><span class="op" id="4277362">(</span><span class="ident" id="4277363">timeout</span><span class="op" id="4277370">,</span>&nbsp;<span class="keyword" id="4277372">func</span><span class="op" id="4277376">(</span><span class="op" id="4277377">)</span>&nbsp;<span class="op" id="4277379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277384">errChannel</span>&nbsp;<span class="op" id="4277395">&lt;-</span>&nbsp;<span class="ident" id="4277398">timeoutError</span><span class="op" id="4277410">{</span><span class="op" id="4277411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277415">}</span><span class="op" id="4277416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277423">rawConn</span><span class="op" id="4277430">,</span>&nbsp;<span class="ident" id="4277432">err</span>&nbsp;<span class="op" id="4277436">:=</span>&nbsp;<span class="ident" id="4277439">dialer</span><span class="op" id="4277445">.</span><span class="ident" id="4277446">Dial</span><span class="op" id="4277450">(</span><span class="ident" id="4277451">network</span><span class="op" id="4277458">,</span>&nbsp;<span class="ident" id="4277460">addr</span><span class="op" id="4277464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277467">if</span>&nbsp;<span class="ident" id="4277470">err</span>&nbsp;<span class="op" id="4277474">!=</span>&nbsp;<span class="ident" id="4277477">nil</span>&nbsp;<span class="op" id="4277481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277485">return</span>&nbsp;<span class="ident" id="4277492">nil</span><span class="op" id="4277495">,</span>&nbsp;<span class="ident" id="4277497">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277506">colonPos</span>&nbsp;<span class="op" id="4277515">:=</span>&nbsp;<span class="ident" id="4277518">strings</span><span class="op" id="4277525">.</span><span class="ident" id="4277526">LastIndex</span><span class="op" id="4277535">(</span><span class="ident" id="4277536">addr</span><span class="op" id="4277540">,</span>&nbsp;<span class="string" id="4277542">&#34;:&#34;</span><span class="op" id="4277545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277548">if</span>&nbsp;<span class="ident" id="4277551">colonPos</span>&nbsp;<span class="op" id="4277560">==</span>&nbsp;<span class="op" id="4277563">-</span><span class="num" id="4277564">1</span>&nbsp;<span class="op" id="4277566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277570">colonPos</span>&nbsp;<span class="op" id="4277579">=</span>&nbsp;<span class="builtinfunc" id="4277581">len</span><span class="op" id="4277584">(</span><span class="ident" id="4277585">addr</span><span class="op" id="4277589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277595">hostname</span>&nbsp;<span class="op" id="4277604">:=</span>&nbsp;<span class="ident" id="4277607">addr</span><span class="op" id="4277611">[</span><span class="op" id="4277612">:</span><span class="ident" id="4277613">colonPos</span><span class="op" id="4277621">]</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277625">if</span>&nbsp;<span class="ident" id="4277628">config</span>&nbsp;<span class="op" id="4277635">==</span>&nbsp;<span class="ident" id="4277638">nil</span>&nbsp;<span class="op" id="4277642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277646">config</span>&nbsp;<span class="op" id="4277653">=</span>&nbsp;<span class="ident" id="4277655">defaultConfig</span><span class="op" id="4277668">(</span><span class="op" id="4277669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277675">//&nbsp;If&nbsp;no&nbsp;ServerName&nbsp;is&nbsp;set,&nbsp;infer&nbsp;the&nbsp;ServerName</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277725">//&nbsp;from&nbsp;the&nbsp;hostname&nbsp;we&#39;re&nbsp;connecting&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277768">if</span>&nbsp;<span class="ident" id="4277771">config</span><span class="op" id="4277777">.</span><span class="ident" id="4277778">ServerName</span>&nbsp;<span class="op" id="4277789">==</span>&nbsp;<span class="string" id="4277792">&#34;&#34;</span>&nbsp;<span class="op" id="4277795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277799">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;to&nbsp;avoid&nbsp;polluting&nbsp;argument&nbsp;or&nbsp;default.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277856">c</span>&nbsp;<span class="op" id="4277858">:=</span>&nbsp;<span class="op" id="4277861">*</span><span class="ident" id="4277862">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277871">c</span><span class="op" id="4277872">.</span><span class="ident" id="4277873">ServerName</span>&nbsp;<span class="op" id="4277884">=</span>&nbsp;<span class="ident" id="4277886">hostname</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277897">config</span>&nbsp;<span class="op" id="4277904">=</span>&nbsp;<span class="op" id="4277906">&amp;</span><span class="ident" id="4277907">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277914">conn</span>&nbsp;<span class="op" id="4277919">:=</span>&nbsp;<span class="ident" id="4277922">Client</span><span class="op" id="4277928">(</span><span class="ident" id="4277929">rawConn</span><span class="op" id="4277936">,</span>&nbsp;<span class="ident" id="4277938">config</span><span class="op" id="4277944">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277948">if</span>&nbsp;<span class="ident" id="4277951">timeout</span>&nbsp;<span class="op" id="4277959">==</span>&nbsp;<span class="num" id="4277962">0</span>&nbsp;<span class="op" id="4277964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277968">err</span>&nbsp;<span class="op" id="4277972">=</span>&nbsp;<span class="ident" id="4277974">conn</span><span class="op" id="4277978">.</span><span class="ident" id="4277979">Handshake</span><span class="op" id="4277988">(</span><span class="op" id="4277989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277992">}</span>&nbsp;<span class="keyword" id="4277994">else</span>&nbsp;<span class="op" id="4277999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278003">go</span>&nbsp;<span class="keyword" id="4278006">func</span><span class="op" id="4278010">(</span><span class="op" id="4278011">)</span>&nbsp;<span class="op" id="4278013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278018">errChannel</span>&nbsp;<span class="op" id="4278029">&lt;-</span>&nbsp;<span class="ident" id="4278032">conn</span><span class="op" id="4278036">.</span><span class="ident" id="4278037">Handshake</span><span class="op" id="4278046">(</span><span class="op" id="4278047">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278051">}</span><span class="op" id="4278052">(</span><span class="op" id="4278053">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278058">err</span>&nbsp;<span class="op" id="4278062">=</span>&nbsp;<span class="op" id="4278064">&lt;-</span><span class="ident" id="4278066">errChannel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278082">if</span>&nbsp;<span class="ident" id="4278085">err</span>&nbsp;<span class="op" id="4278089">!=</span>&nbsp;<span class="ident" id="4278092">nil</span>&nbsp;<span class="op" id="4278096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278100">rawConn</span><span class="op" id="4278107">.</span><span class="ident" id="4278108">Close</span><span class="op" id="4278113">(</span><span class="op" id="4278114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278118">return</span>&nbsp;<span class="ident" id="4278125">nil</span><span class="op" id="4278128">,</span>&nbsp;<span class="ident" id="4278130">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278139">return</span>&nbsp;<span class="ident" id="4278146">conn</span><span class="op" id="4278150">,</span>&nbsp;<span class="ident" id="4278152">nil</span><br>
<span class="lineno"></span><span class="op" id="4278156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4278159">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;net.Dial</span><br>
<span class="lineno"></span><span class="comment" id="4278220">//&nbsp;and&nbsp;then&nbsp;initiates&nbsp;a&nbsp;TLS&nbsp;handshake,&nbsp;returning&nbsp;the&nbsp;resulting</span><br>
<span class="lineno">160</span><span class="comment" id="4278283">//&nbsp;TLS&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4278302">//&nbsp;Dial&nbsp;interprets&nbsp;a&nbsp;nil&nbsp;configuration&nbsp;as&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4278358">//&nbsp;the&nbsp;zero&nbsp;configuration;&nbsp;see&nbsp;the&nbsp;documentation&nbsp;of&nbsp;Config</span><br>
<span class="lineno"></span><span class="comment" id="4278417">//&nbsp;for&nbsp;the&nbsp;defaults.</span><br>
<span class="lineno"></span><span class="keyword" id="4278438">func</span>&nbsp;<span class="ident" id="4278443">Dial</span><span class="op" id="4278447">(</span><span class="ident" id="4278448">network</span><span class="op" id="4278455">,</span>&nbsp;<span class="ident" id="4278457">addr</span>&nbsp;<span class="builtintype" id="4278462">string</span><span class="op" id="4278468">,</span>&nbsp;<span class="ident" id="4278470">config</span>&nbsp;<span class="op" id="4278477">*</span><span class="ident" id="4278478">Config</span><span class="op" id="4278484">)</span>&nbsp;<span class="op" id="4278486">(</span><span class="op" id="4278487">*</span><span class="ident" id="4278488">Conn</span><span class="op" id="4278492">,</span>&nbsp;<span class="builtintype" id="4278494">error</span><span class="op" id="4278499">)</span>&nbsp;<span class="op" id="4278501">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278504">return</span>&nbsp;<span class="ident" id="4278511">DialWithDialer</span><span class="op" id="4278525">(</span><span class="builtinfunc" id="4278526">new</span><span class="op" id="4278529">(</span><span class="ident" id="4278530">net</span><span class="op" id="4278533">.</span><span class="ident" id="4278534">Dialer</span><span class="op" id="4278540">)</span><span class="op" id="4278541">,</span>&nbsp;<span class="ident" id="4278543">network</span><span class="op" id="4278550">,</span>&nbsp;<span class="ident" id="4278552">addr</span><span class="op" id="4278556">,</span>&nbsp;<span class="ident" id="4278558">config</span><span class="op" id="4278564">)</span><br>
<span class="lineno"></span><span class="op" id="4278566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4278569">//&nbsp;LoadX509KeyPair&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;public/private&nbsp;key&nbsp;pair&nbsp;from&nbsp;a&nbsp;pair&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4278646">//&nbsp;files.&nbsp;The&nbsp;files&nbsp;must&nbsp;contain&nbsp;PEM&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno">170</span><span class="keyword" id="4278697">func</span>&nbsp;<span class="ident" id="4278702">LoadX509KeyPair</span><span class="op" id="4278717">(</span><span class="ident" id="4278718">certFile</span><span class="op" id="4278726">,</span>&nbsp;<span class="ident" id="4278728">keyFile</span>&nbsp;<span class="builtintype" id="4278736">string</span><span class="op" id="4278742">)</span>&nbsp;<span class="op" id="4278744">(</span><span class="ident" id="4278745">cert</span>&nbsp;<span class="ident" id="4278750">Certificate</span><span class="op" id="4278761">,</span>&nbsp;<span class="ident" id="4278763">err</span>&nbsp;<span class="builtintype" id="4278767">error</span><span class="op" id="4278772">)</span>&nbsp;<span class="op" id="4278774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278777">certPEMBlock</span><span class="op" id="4278789">,</span>&nbsp;<span class="ident" id="4278791">err</span>&nbsp;<span class="op" id="4278795">:=</span>&nbsp;<span class="ident" id="4278798">ioutil</span><span class="op" id="4278804">.</span><span class="ident" id="4278805">ReadFile</span><span class="op" id="4278813">(</span><span class="ident" id="4278814">certFile</span><span class="op" id="4278822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278825">if</span>&nbsp;<span class="ident" id="4278828">err</span>&nbsp;<span class="op" id="4278832">!=</span>&nbsp;<span class="ident" id="4278835">nil</span>&nbsp;<span class="op" id="4278839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278843">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278851">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278854">keyPEMBlock</span><span class="op" id="4278865">,</span>&nbsp;<span class="ident" id="4278867">err</span>&nbsp;<span class="op" id="4278871">:=</span>&nbsp;<span class="ident" id="4278874">ioutil</span><span class="op" id="4278880">.</span><span class="ident" id="4278881">ReadFile</span><span class="op" id="4278889">(</span><span class="ident" id="4278890">keyFile</span><span class="op" id="4278897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278900">if</span>&nbsp;<span class="ident" id="4278903">err</span>&nbsp;<span class="op" id="4278907">!=</span>&nbsp;<span class="ident" id="4278910">nil</span>&nbsp;<span class="op" id="4278914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278918">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278929">return</span>&nbsp;<span class="ident" id="4278936">X509KeyPair</span><span class="op" id="4278947">(</span><span class="ident" id="4278948">certPEMBlock</span><span class="op" id="4278960">,</span>&nbsp;<span class="ident" id="4278962">keyPEMBlock</span><span class="op" id="4278973">)</span><br>
<span class="lineno">180</span><span class="op" id="4278975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4278978">//&nbsp;X509KeyPair&nbsp;parses&nbsp;a&nbsp;public/private&nbsp;key&nbsp;pair&nbsp;from&nbsp;a&nbsp;pair&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4279041">//&nbsp;PEM&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4279062">func</span>&nbsp;<span class="ident" id="4279067">X509KeyPair</span><span class="op" id="4279078">(</span><span class="ident" id="4279079">certPEMBlock</span><span class="op" id="4279091">,</span>&nbsp;<span class="ident" id="4279093">keyPEMBlock</span>&nbsp;<span class="op" id="4279105">[</span><span class="op" id="4279106">]</span><span class="builtintype" id="4279107">byte</span><span class="op" id="4279111">)</span>&nbsp;<span class="op" id="4279113">(</span><span class="ident" id="4279114">cert</span>&nbsp;<span class="ident" id="4279119">Certificate</span><span class="op" id="4279130">,</span>&nbsp;<span class="ident" id="4279132">err</span>&nbsp;<span class="builtintype" id="4279136">error</span><span class="op" id="4279141">)</span>&nbsp;<span class="op" id="4279143">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279146">var</span>&nbsp;<span class="ident" id="4279150">certDERBlock</span>&nbsp;<span class="op" id="4279163">*</span><span class="ident" id="4279164">pem</span><span class="op" id="4279167">.</span><span class="ident" id="4279168">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279175">for</span>&nbsp;<span class="op" id="4279179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279183">certDERBlock</span><span class="op" id="4279195">,</span>&nbsp;<span class="ident" id="4279197">certPEMBlock</span>&nbsp;<span class="op" id="4279210">=</span>&nbsp;<span class="ident" id="4279212">pem</span><span class="op" id="4279215">.</span><span class="ident" id="4279216">Decode</span><span class="op" id="4279222">(</span><span class="ident" id="4279223">certPEMBlock</span><span class="op" id="4279235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279239">if</span>&nbsp;<span class="ident" id="4279242">certDERBlock</span>&nbsp;<span class="op" id="4279255">==</span>&nbsp;<span class="ident" id="4279258">nil</span>&nbsp;<span class="op" id="4279262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279267">break</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279279">if</span>&nbsp;<span class="ident" id="4279282">certDERBlock</span><span class="op" id="4279294">.</span><span class="ident" id="4279295">Type</span>&nbsp;<span class="op" id="4279300">==</span>&nbsp;<span class="string" id="4279303">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="4279317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279322">cert</span><span class="op" id="4279326">.</span><span class="ident" id="4279327">Certificate</span>&nbsp;<span class="op" id="4279339">=</span>&nbsp;<span class="builtinfunc" id="4279341">append</span><span class="op" id="4279347">(</span><span class="ident" id="4279348">cert</span><span class="op" id="4279352">.</span><span class="ident" id="4279353">Certificate</span><span class="op" id="4279364">,</span>&nbsp;<span class="ident" id="4279366">certDERBlock</span><span class="op" id="4279378">.</span><span class="ident" id="4279379">Bytes</span><span class="op" id="4279384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279391">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279395">if</span>&nbsp;<span class="builtinfunc" id="4279398">len</span><span class="op" id="4279401">(</span><span class="ident" id="4279402">cert</span><span class="op" id="4279406">.</span><span class="ident" id="4279407">Certificate</span><span class="op" id="4279418">)</span>&nbsp;<span class="op" id="4279420">==</span>&nbsp;<span class="num" id="4279423">0</span>&nbsp;<span class="op" id="4279425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279429">err</span>&nbsp;<span class="op" id="4279433">=</span>&nbsp;<span class="ident" id="4279435">errors</span><span class="op" id="4279441">.</span><span class="ident" id="4279442">New</span><span class="op" id="4279445">(</span><span class="string" id="4279446">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;certificate&nbsp;PEM&nbsp;data&#34;</span><span class="op" id="4279496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279500">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279508">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279512">var</span>&nbsp;<span class="ident" id="4279516">keyDERBlock</span>&nbsp;<span class="op" id="4279528">*</span><span class="ident" id="4279529">pem</span><span class="op" id="4279532">.</span><span class="ident" id="4279533">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279540">for</span>&nbsp;<span class="op" id="4279544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279548">keyDERBlock</span><span class="op" id="4279559">,</span>&nbsp;<span class="ident" id="4279561">keyPEMBlock</span>&nbsp;<span class="op" id="4279573">=</span>&nbsp;<span class="ident" id="4279575">pem</span><span class="op" id="4279578">.</span><span class="ident" id="4279579">Decode</span><span class="op" id="4279585">(</span><span class="ident" id="4279586">keyPEMBlock</span><span class="op" id="4279597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279601">if</span>&nbsp;<span class="ident" id="4279604">keyDERBlock</span>&nbsp;<span class="op" id="4279616">==</span>&nbsp;<span class="ident" id="4279619">nil</span>&nbsp;<span class="op" id="4279623">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279628">err</span>&nbsp;<span class="op" id="4279632">=</span>&nbsp;<span class="ident" id="4279634">errors</span><span class="op" id="4279640">.</span><span class="ident" id="4279641">New</span><span class="op" id="4279644">(</span><span class="string" id="4279645">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;key&nbsp;PEM&nbsp;data&#34;</span><span class="op" id="4279687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279692">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279705">if</span>&nbsp;<span class="ident" id="4279708">keyDERBlock</span><span class="op" id="4279719">.</span><span class="ident" id="4279720">Type</span>&nbsp;<span class="op" id="4279725">==</span>&nbsp;<span class="string" id="4279728">&#34;PRIVATE&nbsp;KEY&#34;</span>&nbsp;<span class="op" id="4279742">||</span>&nbsp;<span class="ident" id="4279745">strings</span><span class="op" id="4279752">.</span><span class="ident" id="4279753">HasSuffix</span><span class="op" id="4279762">(</span><span class="ident" id="4279763">keyDERBlock</span><span class="op" id="4279774">.</span><span class="ident" id="4279775">Type</span><span class="op" id="4279779">,</span>&nbsp;<span class="string" id="4279781">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="4279795">)</span>&nbsp;<span class="op" id="4279797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279802">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279817">cert</span><span class="op" id="4279821">.</span><span class="ident" id="4279822">PrivateKey</span><span class="op" id="4279832">,</span>&nbsp;<span class="ident" id="4279834">err</span>&nbsp;<span class="op" id="4279838">=</span>&nbsp;<span class="ident" id="4279840">parsePrivateKey</span><span class="op" id="4279855">(</span><span class="ident" id="4279856">keyDERBlock</span><span class="op" id="4279867">.</span><span class="ident" id="4279868">Bytes</span><span class="op" id="4279873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279876">if</span>&nbsp;<span class="ident" id="4279879">err</span>&nbsp;<span class="op" id="4279883">!=</span>&nbsp;<span class="ident" id="4279886">nil</span>&nbsp;<span class="op" id="4279890">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279894">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4279906">//&nbsp;We&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;parse&nbsp;the&nbsp;public&nbsp;key&nbsp;for&nbsp;TLS,&nbsp;but&nbsp;we&nbsp;so&nbsp;do&nbsp;anyway</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4279977">//&nbsp;to&nbsp;check&nbsp;that&nbsp;it&nbsp;looks&nbsp;sane&nbsp;and&nbsp;matches&nbsp;the&nbsp;private&nbsp;key.</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280038">x509Cert</span><span class="op" id="4280046">,</span>&nbsp;<span class="ident" id="4280048">err</span>&nbsp;<span class="op" id="4280052">:=</span>&nbsp;<span class="ident" id="4280055">x509</span><span class="op" id="4280059">.</span><span class="ident" id="4280060">ParseCertificate</span><span class="op" id="4280076">(</span><span class="ident" id="4280077">cert</span><span class="op" id="4280081">.</span><span class="ident" id="4280082">Certificate</span><span class="op" id="4280093">[</span><span class="num" id="4280094">0</span><span class="op" id="4280095">]</span><span class="op" id="4280096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280099">if</span>&nbsp;<span class="ident" id="4280102">err</span>&nbsp;<span class="op" id="4280106">!=</span>&nbsp;<span class="ident" id="4280109">nil</span>&nbsp;<span class="op" id="4280113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280117">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280129">switch</span>&nbsp;<span class="ident" id="4280136">pub</span>&nbsp;<span class="op" id="4280140">:=</span>&nbsp;<span class="ident" id="4280143">x509Cert</span><span class="op" id="4280151">.</span><span class="ident" id="4280152">PublicKey</span><span class="op" id="4280161">.</span><span class="op" id="4280162">(</span><span class="keyword" id="4280163">type</span><span class="op" id="4280167">)</span>&nbsp;<span class="op" id="4280169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280172">case</span>&nbsp;<span class="op" id="4280177">*</span><span class="ident" id="4280178">rsa</span><span class="op" id="4280181">.</span><span class="ident" id="4280182">PublicKey</span><span class="op" id="4280191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280195">priv</span><span class="op" id="4280199">,</span>&nbsp;<span class="ident" id="4280201">ok</span>&nbsp;<span class="op" id="4280204">:=</span>&nbsp;<span class="ident" id="4280207">cert</span><span class="op" id="4280211">.</span><span class="ident" id="4280212">PrivateKey</span><span class="op" id="4280222">.</span><span class="op" id="4280223">(</span><span class="op" id="4280224">*</span><span class="ident" id="4280225">rsa</span><span class="op" id="4280228">.</span><span class="ident" id="4280229">PrivateKey</span><span class="op" id="4280239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280243">if</span>&nbsp;<span class="op" id="4280246">!</span><span class="ident" id="4280247">ok</span>&nbsp;<span class="op" id="4280250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280255">err</span>&nbsp;<span class="op" id="4280259">=</span>&nbsp;<span class="ident" id="4280261">errors</span><span class="op" id="4280267">.</span><span class="ident" id="4280268">New</span><span class="op" id="4280271">(</span><span class="string" id="4280272">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;type&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&nbsp;type&#34;</span><span class="op" id="4280333">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280338">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280351">if</span>&nbsp;<span class="ident" id="4280354">pub</span><span class="op" id="4280357">.</span><span class="ident" id="4280358">N</span><span class="op" id="4280359">.</span><span class="ident" id="4280360">Cmp</span><span class="op" id="4280363">(</span><span class="ident" id="4280364">priv</span><span class="op" id="4280368">.</span><span class="ident" id="4280369">N</span><span class="op" id="4280370">)</span>&nbsp;<span class="op" id="4280372">!=</span>&nbsp;<span class="num" id="4280375">0</span>&nbsp;<span class="op" id="4280377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280382">err</span>&nbsp;<span class="op" id="4280386">=</span>&nbsp;<span class="ident" id="4280388">errors</span><span class="op" id="4280394">.</span><span class="ident" id="4280395">New</span><span class="op" id="4280398">(</span><span class="string" id="4280399">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&#34;</span><span class="op" id="4280450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280455">return</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280467">case</span>&nbsp;<span class="op" id="4280472">*</span><span class="ident" id="4280473">ecdsa</span><span class="op" id="4280478">.</span><span class="ident" id="4280479">PublicKey</span><span class="op" id="4280488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280492">priv</span><span class="op" id="4280496">,</span>&nbsp;<span class="ident" id="4280498">ok</span>&nbsp;<span class="op" id="4280501">:=</span>&nbsp;<span class="ident" id="4280504">cert</span><span class="op" id="4280508">.</span><span class="ident" id="4280509">PrivateKey</span><span class="op" id="4280519">.</span><span class="op" id="4280520">(</span><span class="op" id="4280521">*</span><span class="ident" id="4280522">ecdsa</span><span class="op" id="4280527">.</span><span class="ident" id="4280528">PrivateKey</span><span class="op" id="4280538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280542">if</span>&nbsp;<span class="op" id="4280545">!</span><span class="ident" id="4280546">ok</span>&nbsp;<span class="op" id="4280549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280554">err</span>&nbsp;<span class="op" id="4280558">=</span>&nbsp;<span class="ident" id="4280560">errors</span><span class="op" id="4280566">.</span><span class="ident" id="4280567">New</span><span class="op" id="4280570">(</span><span class="string" id="4280571">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;type&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&nbsp;type&#34;</span><span class="op" id="4280632">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280637">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280651">if</span>&nbsp;<span class="ident" id="4280654">pub</span><span class="op" id="4280657">.</span><span class="ident" id="4280658">X</span><span class="op" id="4280659">.</span><span class="ident" id="4280660">Cmp</span><span class="op" id="4280663">(</span><span class="ident" id="4280664">priv</span><span class="op" id="4280668">.</span><span class="ident" id="4280669">X</span><span class="op" id="4280670">)</span>&nbsp;<span class="op" id="4280672">!=</span>&nbsp;<span class="num" id="4280675">0</span>&nbsp;<span class="op" id="4280677">||</span>&nbsp;<span class="ident" id="4280680">pub</span><span class="op" id="4280683">.</span><span class="ident" id="4280684">Y</span><span class="op" id="4280685">.</span><span class="ident" id="4280686">Cmp</span><span class="op" id="4280689">(</span><span class="ident" id="4280690">priv</span><span class="op" id="4280694">.</span><span class="ident" id="4280695">Y</span><span class="op" id="4280696">)</span>&nbsp;<span class="op" id="4280698">!=</span>&nbsp;<span class="num" id="4280701">0</span>&nbsp;<span class="op" id="4280703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280708">err</span>&nbsp;<span class="op" id="4280712">=</span>&nbsp;<span class="ident" id="4280714">errors</span><span class="op" id="4280720">.</span><span class="ident" id="4280721">New</span><span class="op" id="4280724">(</span><span class="string" id="4280725">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&#34;</span><span class="op" id="4280776">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280781">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280793">default</span><span class="op" id="4280800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280804">err</span>&nbsp;<span class="op" id="4280808">=</span>&nbsp;<span class="ident" id="4280810">errors</span><span class="op" id="4280816">.</span><span class="ident" id="4280817">New</span><span class="op" id="4280820">(</span><span class="string" id="4280821">&#34;crypto/tls:&nbsp;unknown&nbsp;public&nbsp;key&nbsp;algorithm&#34;</span><span class="op" id="4280863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280867">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280879">return</span><br>
<span class="lineno"></span><span class="op" id="4280886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="4280889">//&nbsp;Attempt&nbsp;to&nbsp;parse&nbsp;the&nbsp;given&nbsp;private&nbsp;key&nbsp;DER&nbsp;block.&nbsp;OpenSSL&nbsp;0.9.8&nbsp;generates</span><br>
<span class="lineno"></span><span class="comment" id="4280966">//&nbsp;PKCS#1&nbsp;private&nbsp;keys&nbsp;by&nbsp;default,&nbsp;while&nbsp;OpenSSL&nbsp;1.0.0&nbsp;generates&nbsp;PKCS#8&nbsp;keys.</span><br>
<span class="lineno"></span><span class="comment" id="4281044">//&nbsp;OpenSSL&nbsp;ecparam&nbsp;generates&nbsp;SEC1&nbsp;EC&nbsp;private&nbsp;keys&nbsp;for&nbsp;ECDSA.&nbsp;We&nbsp;try&nbsp;all&nbsp;three.</span><br>
<span class="lineno"></span><span class="keyword" id="4281123">func</span>&nbsp;<span class="ident" id="4281128">parsePrivateKey</span><span class="op" id="4281143">(</span><span class="ident" id="4281144">der</span>&nbsp;<span class="op" id="4281148">[</span><span class="op" id="4281149">]</span><span class="builtintype" id="4281150">byte</span><span class="op" id="4281154">)</span>&nbsp;<span class="op" id="4281156">(</span><span class="ident" id="4281157">crypto</span><span class="op" id="4281163">.</span><span class="ident" id="4281164">PrivateKey</span><span class="op" id="4281174">,</span>&nbsp;<span class="builtintype" id="4281176">error</span><span class="op" id="4281181">)</span>&nbsp;<span class="op" id="4281183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281186">if</span>&nbsp;<span class="ident" id="4281189">key</span><span class="op" id="4281192">,</span>&nbsp;<span class="ident" id="4281194">err</span>&nbsp;<span class="op" id="4281198">:=</span>&nbsp;<span class="ident" id="4281201">x509</span><span class="op" id="4281205">.</span><span class="ident" id="4281206">ParsePKCS1PrivateKey</span><span class="op" id="4281226">(</span><span class="ident" id="4281227">der</span><span class="op" id="4281230">)</span><span class="op" id="4281231">;</span>&nbsp;<span class="ident" id="4281233">err</span>&nbsp;<span class="op" id="4281237">==</span>&nbsp;<span class="ident" id="4281240">nil</span>&nbsp;<span class="op" id="4281244">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281248">return</span>&nbsp;<span class="ident" id="4281255">key</span><span class="op" id="4281258">,</span>&nbsp;<span class="ident" id="4281260">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281268">if</span>&nbsp;<span class="ident" id="4281271">key</span><span class="op" id="4281274">,</span>&nbsp;<span class="ident" id="4281276">err</span>&nbsp;<span class="op" id="4281280">:=</span>&nbsp;<span class="ident" id="4281283">x509</span><span class="op" id="4281287">.</span><span class="ident" id="4281288">ParsePKCS8PrivateKey</span><span class="op" id="4281308">(</span><span class="ident" id="4281309">der</span><span class="op" id="4281312">)</span><span class="op" id="4281313">;</span>&nbsp;<span class="ident" id="4281315">err</span>&nbsp;<span class="op" id="4281319">==</span>&nbsp;<span class="ident" id="4281322">nil</span>&nbsp;<span class="op" id="4281326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281330">switch</span>&nbsp;<span class="ident" id="4281337">key</span>&nbsp;<span class="op" id="4281341">:=</span>&nbsp;<span class="ident" id="4281344">key</span><span class="op" id="4281347">.</span><span class="op" id="4281348">(</span><span class="keyword" id="4281349">type</span><span class="op" id="4281353">)</span>&nbsp;<span class="op" id="4281355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281359">case</span>&nbsp;<span class="op" id="4281364">*</span><span class="ident" id="4281365">rsa</span><span class="op" id="4281368">.</span><span class="ident" id="4281369">PrivateKey</span><span class="op" id="4281379">,</span>&nbsp;<span class="op" id="4281381">*</span><span class="ident" id="4281382">ecdsa</span><span class="op" id="4281387">.</span><span class="ident" id="4281388">PrivateKey</span><span class="op" id="4281398">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281403">return</span>&nbsp;<span class="ident" id="4281410">key</span><span class="op" id="4281413">,</span>&nbsp;<span class="ident" id="4281415">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281421">default</span><span class="op" id="4281428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281433">return</span>&nbsp;<span class="ident" id="4281440">nil</span><span class="op" id="4281443">,</span>&nbsp;<span class="ident" id="4281445">errors</span><span class="op" id="4281451">.</span><span class="ident" id="4281452">New</span><span class="op" id="4281455">(</span><span class="string" id="4281456">&#34;crypto/tls:&nbsp;found&nbsp;unknown&nbsp;private&nbsp;key&nbsp;type&nbsp;in&nbsp;PKCS#8&nbsp;wrapping&#34;</span><span class="op" id="4281519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281526">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281529">if</span>&nbsp;<span class="ident" id="4281532">key</span><span class="op" id="4281535">,</span>&nbsp;<span class="ident" id="4281537">err</span>&nbsp;<span class="op" id="4281541">:=</span>&nbsp;<span class="ident" id="4281544">x509</span><span class="op" id="4281548">.</span><span class="ident" id="4281549">ParseECPrivateKey</span><span class="op" id="4281566">(</span><span class="ident" id="4281567">der</span><span class="op" id="4281570">)</span><span class="op" id="4281571">;</span>&nbsp;<span class="ident" id="4281573">err</span>&nbsp;<span class="op" id="4281577">==</span>&nbsp;<span class="ident" id="4281580">nil</span>&nbsp;<span class="op" id="4281584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281588">return</span>&nbsp;<span class="ident" id="4281595">key</span><span class="op" id="4281598">,</span>&nbsp;<span class="ident" id="4281600">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281609">return</span>&nbsp;<span class="ident" id="4281616">nil</span><span class="op" id="4281619">,</span>&nbsp;<span class="ident" id="4281621">errors</span><span class="op" id="4281627">.</span><span class="ident" id="4281628">New</span><span class="op" id="4281631">(</span><span class="string" id="4281632">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;private&nbsp;key&#34;</span><span class="op" id="4281673">)</span><br>
<span class="lineno">275</span><span class="op" id="4281675">}</span>
</div>
</body>
</html>
