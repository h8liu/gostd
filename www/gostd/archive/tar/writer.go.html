<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6017117">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6017172">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6017226">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6017277">package</span>&nbsp;<span class="ident" id="6017285">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6017290">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="6017309">//&nbsp;-&nbsp;catch&nbsp;more&nbsp;errors&nbsp;(no&nbsp;first&nbsp;header,&nbsp;etc.)</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6017357">import</span>&nbsp;<span class="op" id="6017364">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6017367">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6017376">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6017386">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6017393">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6017399">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6017405">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6017413">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6017424">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6017435">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="6017442">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6017445">var</span>&nbsp;<span class="op" id="6017449">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6017452">ErrWriteTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6017471">=</span>&nbsp;<span class="ident" id="6017473">errors</span><span class="op" id="6017479">.</span><span class="ident" id="6017480">New</span><span class="op" id="6017483">(</span><span class="string" id="6017484">&#34;archive/tar:&nbsp;write&nbsp;too&nbsp;long&#34;</span><span class="op" id="6017513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6017516">ErrFieldTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6017535">=</span>&nbsp;<span class="ident" id="6017537">errors</span><span class="op" id="6017543">.</span><span class="ident" id="6017544">New</span><span class="op" id="6017547">(</span><span class="string" id="6017548">&#34;archive/tar:&nbsp;header&nbsp;field&nbsp;too&nbsp;long&#34;</span><span class="op" id="6017584">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6017587">ErrWriteAfterClose</span>&nbsp;<span class="op" id="6017606">=</span>&nbsp;<span class="ident" id="6017608">errors</span><span class="op" id="6017614">.</span><span class="ident" id="6017615">New</span><span class="op" id="6017618">(</span><span class="string" id="6017619">&#34;archive/tar:&nbsp;write&nbsp;after&nbsp;close&#34;</span><span class="op" id="6017651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6017654">errNameTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6017673">=</span>&nbsp;<span class="ident" id="6017675">errors</span><span class="op" id="6017681">.</span><span class="ident" id="6017682">New</span><span class="op" id="6017685">(</span><span class="string" id="6017686">&#34;archive/tar:&nbsp;name&nbsp;too&nbsp;long&#34;</span><span class="op" id="6017714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6017717">errInvalidHeader</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6017736">=</span>&nbsp;<span class="ident" id="6017738">errors</span><span class="op" id="6017744">.</span><span class="ident" id="6017745">New</span><span class="op" id="6017748">(</span><span class="string" id="6017749">&#34;archive/tar:&nbsp;header&nbsp;field&nbsp;too&nbsp;long&nbsp;or&nbsp;contains&nbsp;invalid&nbsp;values&#34;</span><span class="op" id="6017812">)</span><br>
<span class="lineno"></span><span class="op" id="6017814">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6017817">//&nbsp;A&nbsp;Writer&nbsp;provides&nbsp;sequential&nbsp;writing&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive&nbsp;in&nbsp;POSIX.1&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="6017893">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="6017943">//&nbsp;Call&nbsp;WriteHeader&nbsp;to&nbsp;begin&nbsp;a&nbsp;new&nbsp;file,&nbsp;and&nbsp;then&nbsp;call&nbsp;Write&nbsp;to&nbsp;supply&nbsp;that&nbsp;file&#39;s&nbsp;data,</span><br>
<span class="lineno"></span><span class="comment" id="6018032">//&nbsp;writing&nbsp;at&nbsp;most&nbsp;hdr.Size&nbsp;bytes&nbsp;in&nbsp;total.</span><br>
<span class="lineno"></span><span class="keyword" id="6018076">type</span>&nbsp;<span class="ident" id="6018081">Writer</span>&nbsp;<span class="keyword" id="6018088">struct</span>&nbsp;<span class="op" id="6018095">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018098">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018109">io</span><span class="op" id="6018111">.</span><span class="ident" id="6018112">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018120">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6018131">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018138">nb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018149">int64</span>&nbsp;<span class="comment" id="6018155">//&nbsp;number&nbsp;of&nbsp;unwritten&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018208">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018219">int64</span>&nbsp;<span class="comment" id="6018225">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;to&nbsp;write&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018281">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6018292">bool</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018298">usedBinary</span>&nbsp;<span class="builtintype" id="6018309">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6018325">//&nbsp;whether&nbsp;the&nbsp;binary&nbsp;numeric&nbsp;field&nbsp;extension&nbsp;was&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018381">preferPax</span>&nbsp;&nbsp;<span class="builtintype" id="6018392">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6018408">//&nbsp;use&nbsp;pax&nbsp;header&nbsp;instead&nbsp;of&nbsp;binary&nbsp;numeric&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018460">hdrBuff</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018471">[</span><span class="ident" id="6018472">blockSize</span><span class="op" id="6018481">]</span><span class="builtintype" id="6018482">byte</span>&nbsp;<span class="comment" id="6018487">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;writeHeader&nbsp;when&nbsp;writing&nbsp;a&nbsp;regular&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018550">paxHdrBuff</span>&nbsp;<span class="op" id="6018561">[</span><span class="ident" id="6018562">blockSize</span><span class="op" id="6018571">]</span><span class="builtintype" id="6018572">byte</span>&nbsp;<span class="comment" id="6018577">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;writeHeader&nbsp;when&nbsp;writing&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span><span class="op" id="6018635">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6018638">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6018686">func</span>&nbsp;<span class="ident" id="6018691">NewWriter</span><span class="op" id="6018700">(</span><span class="ident" id="6018701">w</span>&nbsp;<span class="ident" id="6018703">io</span><span class="op" id="6018705">.</span><span class="ident" id="6018706">Writer</span><span class="op" id="6018712">)</span>&nbsp;<span class="op" id="6018714">*</span><span class="ident" id="6018715">Writer</span>&nbsp;<span class="op" id="6018722">{</span>&nbsp;<span class="keyword" id="6018724">return</span>&nbsp;<span class="op" id="6018731">&amp;</span><span class="ident" id="6018732">Writer</span><span class="op" id="6018738">{</span><span class="ident" id="6018739">w</span><span class="op" id="6018740">:</span>&nbsp;<span class="ident" id="6018742">w</span><span class="op" id="6018743">}</span>&nbsp;<span class="op" id="6018745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6018748">//&nbsp;Flush&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;current&nbsp;file&nbsp;(optional).</span><br>
<span class="lineno">50</span><span class="keyword" id="6018803">func</span>&nbsp;<span class="op" id="6018808">(</span><span class="ident" id="6018809">tw</span>&nbsp;<span class="op" id="6018812">*</span><span class="ident" id="6018813">Writer</span><span class="op" id="6018819">)</span>&nbsp;<span class="ident" id="6018821">Flush</span><span class="op" id="6018826">(</span><span class="op" id="6018827">)</span>&nbsp;<span class="builtintype" id="6018829">error</span>&nbsp;<span class="op" id="6018835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6018838">if</span>&nbsp;<span class="ident" id="6018841">tw</span><span class="op" id="6018843">.</span><span class="ident" id="6018844">nb</span>&nbsp;<span class="op" id="6018847">&gt;</span>&nbsp;<span class="num" id="6018849">0</span>&nbsp;<span class="op" id="6018851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018855">tw</span><span class="op" id="6018857">.</span><span class="ident" id="6018858">err</span>&nbsp;<span class="op" id="6018862">=</span>&nbsp;<span class="ident" id="6018864">fmt</span><span class="op" id="6018867">.</span><span class="ident" id="6018868">Errorf</span><span class="op" id="6018874">(</span><span class="string" id="6018875">&#34;archive/tar:&nbsp;missed&nbsp;writing&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6018913">,</span>&nbsp;<span class="ident" id="6018915">tw</span><span class="op" id="6018917">.</span><span class="ident" id="6018918">nb</span><span class="op" id="6018920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6018924">return</span>&nbsp;<span class="ident" id="6018931">tw</span><span class="op" id="6018933">.</span><span class="ident" id="6018934">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6018939">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018943">n</span>&nbsp;<span class="op" id="6018945">:=</span>&nbsp;<span class="ident" id="6018948">tw</span><span class="op" id="6018950">.</span><span class="ident" id="6018951">nb</span>&nbsp;<span class="op" id="6018954">+</span>&nbsp;<span class="ident" id="6018956">tw</span><span class="op" id="6018958">.</span><span class="ident" id="6018959">pad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6018964">for</span>&nbsp;<span class="ident" id="6018968">n</span>&nbsp;<span class="op" id="6018970">&gt;</span>&nbsp;<span class="num" id="6018972">0</span>&nbsp;<span class="op" id="6018974">&amp;&amp;</span>&nbsp;<span class="ident" id="6018977">tw</span><span class="op" id="6018979">.</span><span class="ident" id="6018980">err</span>&nbsp;<span class="op" id="6018984">==</span>&nbsp;<span class="builtintype" id="6018987">nil</span>&nbsp;<span class="op" id="6018991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6018995">nr</span>&nbsp;<span class="op" id="6018998">:=</span>&nbsp;<span class="ident" id="6019001">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6019005">if</span>&nbsp;<span class="ident" id="6019008">nr</span>&nbsp;<span class="op" id="6019011">&gt;</span>&nbsp;<span class="ident" id="6019013">blockSize</span>&nbsp;<span class="op" id="6019023">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6019028">nr</span>&nbsp;<span class="op" id="6019031">=</span>&nbsp;<span class="ident" id="6019033">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6019045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6019049">var</span>&nbsp;<span class="ident" id="6019053">nw</span>&nbsp;<span class="builtintype" id="6019056">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6019062">nw</span><span class="op" id="6019064">,</span>&nbsp;<span class="ident" id="6019066">tw</span><span class="op" id="6019068">.</span><span class="ident" id="6019069">err</span>&nbsp;<span class="op" id="6019073">=</span>&nbsp;<span class="ident" id="6019075">tw</span><span class="op" id="6019077">.</span><span class="ident" id="6019078">w</span><span class="op" id="6019079">.</span><span class="ident" id="6019080">Write</span><span class="op" id="6019085">(</span><span class="ident" id="6019086">zeroBlock</span><span class="op" id="6019095">[</span><span class="num" id="6019096">0</span><span class="op" id="6019097">:</span><span class="ident" id="6019098">nr</span><span class="op" id="6019100">]</span><span class="op" id="6019101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6019105">n</span>&nbsp;<span class="op" id="6019107">-=</span>&nbsp;<span class="ident" id="6019110">int64</span><span class="op" id="6019115">(</span><span class="ident" id="6019116">nw</span><span class="op" id="6019118">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6019121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6019124">tw</span><span class="op" id="6019126">.</span><span class="ident" id="6019127">nb</span>&nbsp;<span class="op" id="6019130">=</span>&nbsp;<span class="num" id="6019132">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6019135">tw</span><span class="op" id="6019137">.</span><span class="ident" id="6019138">pad</span>&nbsp;<span class="op" id="6019142">=</span>&nbsp;<span class="num" id="6019144">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6019147">return</span>&nbsp;<span class="ident" id="6019154">tw</span><span class="op" id="6019156">.</span><span class="ident" id="6019157">err</span><br>
<span class="lineno"></span><span class="op" id="6019161">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="6019164">//&nbsp;Write&nbsp;s&nbsp;into&nbsp;b,&nbsp;terminating&nbsp;it&nbsp;with&nbsp;a&nbsp;NUL&nbsp;if&nbsp;there&nbsp;is&nbsp;room.</span><br>
<span class="lineno"></span><span class="comment" id="6019227">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;allowPax&nbsp;is&nbsp;true&nbsp;add&nbsp;a&nbsp;paxheader&nbsp;record&nbsp;instead</span><br>
<span class="lineno"></span><span class="keyword" id="6019321">func</span>&nbsp;<span class="op" id="6019326">(</span><span class="ident" id="6019327">tw</span>&nbsp;<span class="op" id="6019330">*</span><span class="ident" id="6019331">Writer</span><span class="op" id="6019337">)</span>&nbsp;<span class="ident" id="6019339">cString</span><span class="op" id="6019346">(</span><span class="ident" id="6019347">b</span>&nbsp;<span class="op" id="6019349">[</span><span class="op" id="6019350">]</span><span class="builtintype" id="6019351">byte</span><span class="op" id="6019355">,</span>&nbsp;<span class="ident" id="6019357">s</span>&nbsp;<span class="builtintype" id="6019359">string</span><span class="op" id="6019365">,</span>&nbsp;<span class="ident" id="6019367">allowPax</span>&nbsp;<span class="builtintype" id="6019376">bool</span><span class="op" id="6019380">,</span>&nbsp;<span class="ident" id="6019382">paxKeyword</span>&nbsp;<span class="builtintype" id="6019393">string</span><span class="op" id="6019399">,</span>&nbsp;<span class="ident" id="6019401">paxHeaders</span>&nbsp;<span class="keyword" id="6019412">map</span><span class="op" id="6019415">[</span><span class="builtintype" id="6019416">string</span><span class="op" id="6019422">]</span><span class="builtintype" id="6019423">string</span><span class="op" id="6019429">)</span>&nbsp;<span class="op" id="6019431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6019434">needsPaxHeader</span>&nbsp;<span class="op" id="6019449">:=</span>&nbsp;<span class="ident" id="6019452">allowPax</span>&nbsp;<span class="op" id="6019461">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6019464">len</span><span class="op" id="6019467">(</span><span class="ident" id="6019468">s</span><span class="op" id="6019469">)</span>&nbsp;<span class="op" id="6019471">&gt;</span>&nbsp;<span class="builtinfunc" id="6019473">len</span><span class="op" id="6019476">(</span><span class="ident" id="6019477">b</span><span class="op" id="6019478">)</span>&nbsp;<span class="op" id="6019480">||</span>&nbsp;<span class="op" id="6019483">!</span><span class="ident" id="6019484">isASCII</span><span class="op" id="6019491">(</span><span class="ident" id="6019492">s</span><span class="op" id="6019493">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6019496">if</span>&nbsp;<span class="ident" id="6019499">needsPaxHeader</span>&nbsp;<span class="op" id="6019514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6019518">paxHeaders</span><span class="op" id="6019528">[</span><span class="ident" id="6019529">paxKeyword</span><span class="op" id="6019539">]</span>&nbsp;<span class="op" id="6019541">=</span>&nbsp;<span class="ident" id="6019543">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6019547">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6019555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6019558">if</span>&nbsp;<span class="builtinfunc" id="6019561">len</span><span class="op" id="6019564">(</span><span class="ident" id="6019565">s</span><span class="op" id="6019566">)</span>&nbsp;<span class="op" id="6019568">&gt;</span>&nbsp;<span class="builtinfunc" id="6019570">len</span><span class="op" id="6019573">(</span><span class="ident" id="6019574">b</span><span class="op" id="6019575">)</span>&nbsp;<span class="op" id="6019577">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6019581">if</span>&nbsp;<span class="ident" id="6019584">tw</span><span class="op" id="6019586">.</span><span class="ident" id="6019587">err</span>&nbsp;<span class="op" id="6019591">==</span>&nbsp;<span class="builtintype" id="6019594">nil</span>&nbsp;<span class="op" id="6019598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6019603">tw</span><span class="op" id="6019605">.</span><span class="ident" id="6019606">err</span>&nbsp;<span class="op" id="6019610">=</span>&nbsp;<span class="ident" id="6019612">ErrFieldTooLong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6019630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6019634">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6019642">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6019645">ascii</span>&nbsp;<span class="op" id="6019651">:=</span>&nbsp;<span class="ident" id="6019654">toASCII</span><span class="op" id="6019661">(</span><span class="ident" id="6019662">s</span><span class="op" id="6019663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6019666">copy</span><span class="op" id="6019670">(</span><span class="ident" id="6019671">b</span><span class="op" id="6019672">,</span>&nbsp;<span class="ident" id="6019674">ascii</span><span class="op" id="6019679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6019682">if</span>&nbsp;<span class="builtinfunc" id="6019685">len</span><span class="op" id="6019688">(</span><span class="ident" id="6019689">ascii</span><span class="op" id="6019694">)</span>&nbsp;<span class="op" id="6019696">&lt;</span>&nbsp;<span class="builtinfunc" id="6019698">len</span><span class="op" id="6019701">(</span><span class="ident" id="6019702">b</span><span class="op" id="6019703">)</span>&nbsp;<span class="op" id="6019705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6019709">b</span><span class="op" id="6019710">[</span><span class="builtinfunc" id="6019711">len</span><span class="op" id="6019714">(</span><span class="ident" id="6019715">ascii</span><span class="op" id="6019720">)</span><span class="op" id="6019721">]</span>&nbsp;<span class="op" id="6019723">=</span>&nbsp;<span class="num" id="6019725">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6019728">}</span><br>
<span class="lineno">90</span><span class="op" id="6019730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6019733">//&nbsp;Encode&nbsp;x&nbsp;as&nbsp;an&nbsp;octal&nbsp;ASCII&nbsp;string&nbsp;and&nbsp;write&nbsp;it&nbsp;into&nbsp;b&nbsp;with&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span><span class="keyword" id="6019810">func</span>&nbsp;<span class="op" id="6019815">(</span><span class="ident" id="6019816">tw</span>&nbsp;<span class="op" id="6019819">*</span><span class="ident" id="6019820">Writer</span><span class="op" id="6019826">)</span>&nbsp;<span class="ident" id="6019828">octal</span><span class="op" id="6019833">(</span><span class="ident" id="6019834">b</span>&nbsp;<span class="op" id="6019836">[</span><span class="op" id="6019837">]</span><span class="builtintype" id="6019838">byte</span><span class="op" id="6019842">,</span>&nbsp;<span class="ident" id="6019844">x</span>&nbsp;<span class="ident" id="6019846">int64</span><span class="op" id="6019851">)</span>&nbsp;<span class="op" id="6019853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6019856">s</span>&nbsp;<span class="op" id="6019858">:=</span>&nbsp;<span class="ident" id="6019861">strconv</span><span class="op" id="6019868">.</span><span class="ident" id="6019869">FormatInt</span><span class="op" id="6019878">(</span><span class="ident" id="6019879">x</span><span class="op" id="6019880">,</span>&nbsp;<span class="num" id="6019882">8</span><span class="op" id="6019883">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6019886">//&nbsp;leading&nbsp;zeros,&nbsp;but&nbsp;leave&nbsp;room&nbsp;for&nbsp;a&nbsp;NUL.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6019931">for</span>&nbsp;<span class="builtinfunc" id="6019935">len</span><span class="op" id="6019938">(</span><span class="ident" id="6019939">s</span><span class="op" id="6019940">)</span><span class="op" id="6019941">+</span><span class="num" id="6019942">1</span>&nbsp;<span class="op" id="6019944">&lt;</span>&nbsp;<span class="builtinfunc" id="6019946">len</span><span class="op" id="6019949">(</span><span class="ident" id="6019950">b</span><span class="op" id="6019951">)</span>&nbsp;<span class="op" id="6019953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6019957">s</span>&nbsp;<span class="op" id="6019959">=</span>&nbsp;<span class="string" id="6019961">&#34;0&#34;</span>&nbsp;<span class="op" id="6019965">+</span>&nbsp;<span class="ident" id="6019967">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6019970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6019973">tw</span><span class="op" id="6019975">.</span><span class="ident" id="6019976">cString</span><span class="op" id="6019983">(</span><span class="ident" id="6019984">b</span><span class="op" id="6019985">,</span>&nbsp;<span class="ident" id="6019987">s</span><span class="op" id="6019988">,</span>&nbsp;<span class="builtintype" id="6019990">false</span><span class="op" id="6019995">,</span>&nbsp;<span class="ident" id="6019997">paxNone</span><span class="op" id="6020004">,</span>&nbsp;<span class="builtintype" id="6020006">nil</span><span class="op" id="6020009">)</span><br>
<span class="lineno">100</span><span class="op" id="6020011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6020014">//&nbsp;Write&nbsp;x&nbsp;into&nbsp;b,&nbsp;either&nbsp;as&nbsp;octal&nbsp;or&nbsp;as&nbsp;binary&nbsp;(GNUtar/star&nbsp;extension).</span><br>
<span class="lineno"></span><span class="comment" id="6020087">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;writingPax&nbsp;is&nbsp;enabled&nbsp;both&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;the&nbsp;add&nbsp;a&nbsp;paxheader&nbsp;record&nbsp;instead</span><br>
<span class="lineno"></span><span class="keyword" id="6020213">func</span>&nbsp;<span class="op" id="6020218">(</span><span class="ident" id="6020219">tw</span>&nbsp;<span class="op" id="6020222">*</span><span class="ident" id="6020223">Writer</span><span class="op" id="6020229">)</span>&nbsp;<span class="ident" id="6020231">numeric</span><span class="op" id="6020238">(</span><span class="ident" id="6020239">b</span>&nbsp;<span class="op" id="6020241">[</span><span class="op" id="6020242">]</span><span class="builtintype" id="6020243">byte</span><span class="op" id="6020247">,</span>&nbsp;<span class="ident" id="6020249">x</span>&nbsp;<span class="ident" id="6020251">int64</span><span class="op" id="6020256">,</span>&nbsp;<span class="ident" id="6020258">allowPax</span>&nbsp;<span class="builtintype" id="6020267">bool</span><span class="op" id="6020271">,</span>&nbsp;<span class="ident" id="6020273">paxKeyword</span>&nbsp;<span class="builtintype" id="6020284">string</span><span class="op" id="6020290">,</span>&nbsp;<span class="ident" id="6020292">paxHeaders</span>&nbsp;<span class="keyword" id="6020303">map</span><span class="op" id="6020306">[</span><span class="builtintype" id="6020307">string</span><span class="op" id="6020313">]</span><span class="builtintype" id="6020314">string</span><span class="op" id="6020320">)</span>&nbsp;<span class="op" id="6020322">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6020325">//&nbsp;Try&nbsp;octal&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6020346">s</span>&nbsp;<span class="op" id="6020348">:=</span>&nbsp;<span class="ident" id="6020351">strconv</span><span class="op" id="6020358">.</span><span class="ident" id="6020359">FormatInt</span><span class="op" id="6020368">(</span><span class="ident" id="6020369">x</span><span class="op" id="6020370">,</span>&nbsp;<span class="num" id="6020372">8</span><span class="op" id="6020373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6020376">if</span>&nbsp;<span class="builtinfunc" id="6020379">len</span><span class="op" id="6020382">(</span><span class="ident" id="6020383">s</span><span class="op" id="6020384">)</span>&nbsp;<span class="op" id="6020386">&lt;</span>&nbsp;<span class="builtinfunc" id="6020388">len</span><span class="op" id="6020391">(</span><span class="ident" id="6020392">b</span><span class="op" id="6020393">)</span>&nbsp;<span class="op" id="6020395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6020399">tw</span><span class="op" id="6020401">.</span><span class="ident" id="6020402">octal</span><span class="op" id="6020407">(</span><span class="ident" id="6020408">b</span><span class="op" id="6020409">,</span>&nbsp;<span class="ident" id="6020411">x</span><span class="op" id="6020412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6020416">return</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6020424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6020428">//&nbsp;If&nbsp;it&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;octal,&nbsp;and&nbsp;pax&nbsp;is&nbsp;preferred,&nbsp;use&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6020500">if</span>&nbsp;<span class="ident" id="6020503">allowPax</span>&nbsp;<span class="op" id="6020512">&amp;&amp;</span>&nbsp;<span class="ident" id="6020515">tw</span><span class="op" id="6020517">.</span><span class="ident" id="6020518">preferPax</span>&nbsp;<span class="op" id="6020528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6020532">tw</span><span class="op" id="6020534">.</span><span class="ident" id="6020535">octal</span><span class="op" id="6020540">(</span><span class="ident" id="6020541">b</span><span class="op" id="6020542">,</span>&nbsp;<span class="num" id="6020544">0</span><span class="op" id="6020545">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6020549">s</span>&nbsp;<span class="op" id="6020551">:=</span>&nbsp;<span class="ident" id="6020554">strconv</span><span class="op" id="6020561">.</span><span class="ident" id="6020562">FormatInt</span><span class="op" id="6020571">(</span><span class="ident" id="6020572">x</span><span class="op" id="6020573">,</span>&nbsp;<span class="num" id="6020575">10</span><span class="op" id="6020577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6020581">paxHeaders</span><span class="op" id="6020591">[</span><span class="ident" id="6020592">paxKeyword</span><span class="op" id="6020602">]</span>&nbsp;<span class="op" id="6020604">=</span>&nbsp;<span class="ident" id="6020606">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6020610">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6020618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6020622">//&nbsp;Too&nbsp;big:&nbsp;use&nbsp;binary&nbsp;(big-endian).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6020660">tw</span><span class="op" id="6020662">.</span><span class="ident" id="6020663">usedBinary</span>&nbsp;<span class="op" id="6020674">=</span>&nbsp;<span class="builtintype" id="6020676">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6020682">for</span>&nbsp;<span class="ident" id="6020686">i</span>&nbsp;<span class="op" id="6020688">:=</span>&nbsp;<span class="builtinfunc" id="6020691">len</span><span class="op" id="6020694">(</span><span class="ident" id="6020695">b</span><span class="op" id="6020696">)</span>&nbsp;<span class="op" id="6020698">-</span>&nbsp;<span class="num" id="6020700">1</span><span class="op" id="6020701">;</span>&nbsp;<span class="ident" id="6020703">x</span>&nbsp;<span class="op" id="6020705">&gt;</span>&nbsp;<span class="num" id="6020707">0</span>&nbsp;<span class="op" id="6020709">&amp;&amp;</span>&nbsp;<span class="ident" id="6020712">i</span>&nbsp;<span class="op" id="6020714">&gt;=</span>&nbsp;<span class="num" id="6020717">0</span><span class="op" id="6020718">;</span>&nbsp;<span class="ident" id="6020720">i</span><span class="op" id="6020721">--</span>&nbsp;<span class="op" id="6020724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6020728">b</span><span class="op" id="6020729">[</span><span class="ident" id="6020730">i</span><span class="op" id="6020731">]</span>&nbsp;<span class="op" id="6020733">=</span>&nbsp;<span class="builtintype" id="6020735">byte</span><span class="op" id="6020739">(</span><span class="ident" id="6020740">x</span><span class="op" id="6020741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6020745">x</span>&nbsp;<span class="op" id="6020747">&gt;&gt;=</span>&nbsp;<span class="num" id="6020751">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6020754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6020757">b</span><span class="op" id="6020758">[</span><span class="num" id="6020759">0</span><span class="op" id="6020760">]</span>&nbsp;<span class="op" id="6020762">|=</span>&nbsp;<span class="num" id="6020765">0x80</span>&nbsp;<span class="comment" id="6020770">//&nbsp;highest&nbsp;bit&nbsp;indicates&nbsp;binary&nbsp;format</span><br>
<span class="lineno"></span><span class="op" id="6020809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6020812">var</span>&nbsp;<span class="op" id="6020816">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6020819">minTime</span>&nbsp;<span class="op" id="6020827">=</span>&nbsp;<span class="ident" id="6020829">time</span><span class="op" id="6020833">.</span><span class="ident" id="6020834">Unix</span><span class="op" id="6020838">(</span><span class="num" id="6020839">0</span><span class="op" id="6020840">,</span>&nbsp;<span class="num" id="6020842">0</span><span class="op" id="6020843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6020846">//&nbsp;There&nbsp;is&nbsp;room&nbsp;for&nbsp;11&nbsp;octal&nbsp;digits&nbsp;(33&nbsp;bits)&nbsp;of&nbsp;mtime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6020904">maxTime</span>&nbsp;<span class="op" id="6020912">=</span>&nbsp;<span class="ident" id="6020914">minTime</span><span class="op" id="6020921">.</span><span class="ident" id="6020922">Add</span><span class="op" id="6020925">(</span><span class="op" id="6020926">(</span><span class="num" id="6020927">1</span><span class="op" id="6020928">&lt;&lt;</span><span class="num" id="6020930">33</span>&nbsp;<span class="op" id="6020933">-</span>&nbsp;<span class="num" id="6020935">1</span><span class="op" id="6020936">)</span>&nbsp;<span class="op" id="6020938">*</span>&nbsp;<span class="ident" id="6020940">time</span><span class="op" id="6020944">.</span><span class="ident" id="6020945">Second</span><span class="op" id="6020951">)</span><br>
<span class="lineno"></span><span class="op" id="6020953">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="6020956">//&nbsp;WriteHeader&nbsp;writes&nbsp;hdr&nbsp;and&nbsp;prepares&nbsp;to&nbsp;accept&nbsp;the&nbsp;file&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="6021026">//&nbsp;WriteHeader&nbsp;calls&nbsp;Flush&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;first&nbsp;header.</span><br>
<span class="lineno"></span><span class="comment" id="6021084">//&nbsp;Calling&nbsp;after&nbsp;a&nbsp;Close&nbsp;will&nbsp;return&nbsp;ErrWriteAfterClose.</span><br>
<span class="lineno"></span><span class="keyword" id="6021141">func</span>&nbsp;<span class="op" id="6021146">(</span><span class="ident" id="6021147">tw</span>&nbsp;<span class="op" id="6021150">*</span><span class="ident" id="6021151">Writer</span><span class="op" id="6021157">)</span>&nbsp;<span class="ident" id="6021159">WriteHeader</span><span class="op" id="6021170">(</span><span class="ident" id="6021171">hdr</span>&nbsp;<span class="op" id="6021175">*</span><span class="ident" id="6021176">Header</span><span class="op" id="6021182">)</span>&nbsp;<span class="builtintype" id="6021184">error</span>&nbsp;<span class="op" id="6021190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6021193">return</span>&nbsp;<span class="ident" id="6021200">tw</span><span class="op" id="6021202">.</span><span class="ident" id="6021203">writeHeader</span><span class="op" id="6021214">(</span><span class="ident" id="6021215">hdr</span><span class="op" id="6021218">,</span>&nbsp;<span class="builtintype" id="6021220">true</span><span class="op" id="6021224">)</span><br>
<span class="lineno">140</span><span class="op" id="6021226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6021229">//&nbsp;WriteHeader&nbsp;writes&nbsp;hdr&nbsp;and&nbsp;prepares&nbsp;to&nbsp;accept&nbsp;the&nbsp;file&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="6021299">//&nbsp;WriteHeader&nbsp;calls&nbsp;Flush&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;first&nbsp;header.</span><br>
<span class="lineno"></span><span class="comment" id="6021357">//&nbsp;Calling&nbsp;after&nbsp;a&nbsp;Close&nbsp;will&nbsp;return&nbsp;ErrWriteAfterClose.</span><br>
<span class="lineno">145</span><span class="comment" id="6021414">//&nbsp;As&nbsp;this&nbsp;method&nbsp;is&nbsp;called&nbsp;internally&nbsp;by&nbsp;writePax&nbsp;header&nbsp;to&nbsp;allow&nbsp;it&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6021487">//&nbsp;suppress&nbsp;writing&nbsp;the&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="6021523">func</span>&nbsp;<span class="op" id="6021528">(</span><span class="ident" id="6021529">tw</span>&nbsp;<span class="op" id="6021532">*</span><span class="ident" id="6021533">Writer</span><span class="op" id="6021539">)</span>&nbsp;<span class="ident" id="6021541">writeHeader</span><span class="op" id="6021552">(</span><span class="ident" id="6021553">hdr</span>&nbsp;<span class="op" id="6021557">*</span><span class="ident" id="6021558">Header</span><span class="op" id="6021564">,</span>&nbsp;<span class="ident" id="6021566">allowPax</span>&nbsp;<span class="builtintype" id="6021575">bool</span><span class="op" id="6021579">)</span>&nbsp;<span class="builtintype" id="6021581">error</span>&nbsp;<span class="op" id="6021587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6021590">if</span>&nbsp;<span class="ident" id="6021593">tw</span><span class="op" id="6021595">.</span><span class="ident" id="6021596">closed</span>&nbsp;<span class="op" id="6021603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6021607">return</span>&nbsp;<span class="ident" id="6021614">ErrWriteAfterClose</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6021634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6021637">if</span>&nbsp;<span class="ident" id="6021640">tw</span><span class="op" id="6021642">.</span><span class="ident" id="6021643">err</span>&nbsp;<span class="op" id="6021647">==</span>&nbsp;<span class="builtintype" id="6021650">nil</span>&nbsp;<span class="op" id="6021654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6021658">tw</span><span class="op" id="6021660">.</span><span class="ident" id="6021661">Flush</span><span class="op" id="6021666">(</span><span class="op" id="6021667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6021670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6021673">if</span>&nbsp;<span class="ident" id="6021676">tw</span><span class="op" id="6021678">.</span><span class="ident" id="6021679">err</span>&nbsp;<span class="op" id="6021683">!=</span>&nbsp;<span class="builtintype" id="6021686">nil</span>&nbsp;<span class="op" id="6021690">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6021694">return</span>&nbsp;<span class="ident" id="6021701">tw</span><span class="op" id="6021703">.</span><span class="ident" id="6021704">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6021709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6021713">//&nbsp;a&nbsp;map&nbsp;to&nbsp;hold&nbsp;pax&nbsp;header&nbsp;records,&nbsp;if&nbsp;any&nbsp;are&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6021769">paxHeaders</span>&nbsp;<span class="op" id="6021780">:=</span>&nbsp;<span class="builtinfunc" id="6021783">make</span><span class="op" id="6021787">(</span><span class="keyword" id="6021788">map</span><span class="op" id="6021791">[</span><span class="builtintype" id="6021792">string</span><span class="op" id="6021798">]</span><span class="builtintype" id="6021799">string</span><span class="op" id="6021805">)</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6021809">//&nbsp;TODO(shanemhansen):&nbsp;we&nbsp;might&nbsp;want&nbsp;to&nbsp;use&nbsp;PAX&nbsp;headers&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6021870">//&nbsp;subsecond&nbsp;time&nbsp;resolution,&nbsp;but&nbsp;for&nbsp;now&nbsp;let&#39;s&nbsp;just&nbsp;capture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6021932">//&nbsp;too&nbsp;long&nbsp;fields&nbsp;or&nbsp;non&nbsp;ascii&nbsp;characters</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6021977">var</span>&nbsp;<span class="ident" id="6021981">header</span>&nbsp;<span class="op" id="6021988">[</span><span class="op" id="6021989">]</span><span class="builtintype" id="6021990">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6021997">//&nbsp;We&nbsp;need&nbsp;to&nbsp;select&nbsp;which&nbsp;scratch&nbsp;buffer&nbsp;to&nbsp;use&nbsp;carefully,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6022058">//&nbsp;since&nbsp;this&nbsp;method&nbsp;is&nbsp;called&nbsp;recursively&nbsp;to&nbsp;write&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6022124">//&nbsp;If&nbsp;allowPax&nbsp;is&nbsp;true,&nbsp;this&nbsp;is&nbsp;the&nbsp;non-recursive&nbsp;call,&nbsp;and&nbsp;we&nbsp;will&nbsp;use&nbsp;hdrBuff.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6022206">//&nbsp;If&nbsp;allowPax&nbsp;is&nbsp;false,&nbsp;we&nbsp;are&nbsp;being&nbsp;called&nbsp;by&nbsp;writePAXHeader,&nbsp;and&nbsp;hdrBuff&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6022286">//&nbsp;already&nbsp;being&nbsp;used&nbsp;by&nbsp;the&nbsp;non-recursive&nbsp;call,&nbsp;so&nbsp;we&nbsp;must&nbsp;use&nbsp;paxHdrBuff.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022363">header</span>&nbsp;<span class="op" id="6022370">=</span>&nbsp;<span class="ident" id="6022372">tw</span><span class="op" id="6022374">.</span><span class="ident" id="6022375">hdrBuff</span><span class="op" id="6022382">[</span><span class="op" id="6022383">:</span><span class="op" id="6022384">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6022387">if</span>&nbsp;<span class="op" id="6022390">!</span><span class="ident" id="6022391">allowPax</span>&nbsp;<span class="op" id="6022400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022404">header</span>&nbsp;<span class="op" id="6022411">=</span>&nbsp;<span class="ident" id="6022413">tw</span><span class="op" id="6022415">.</span><span class="ident" id="6022416">paxHdrBuff</span><span class="op" id="6022426">[</span><span class="op" id="6022427">:</span><span class="op" id="6022428">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6022431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6022434">copy</span><span class="op" id="6022438">(</span><span class="ident" id="6022439">header</span><span class="op" id="6022445">,</span>&nbsp;<span class="ident" id="6022447">zeroBlock</span><span class="op" id="6022456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022459">s</span>&nbsp;<span class="op" id="6022461">:=</span>&nbsp;<span class="ident" id="6022464">slicer</span><span class="op" id="6022470">(</span><span class="ident" id="6022471">header</span><span class="op" id="6022477">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6022481">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;filename&nbsp;to&nbsp;allow&nbsp;to&nbsp;overwrite&nbsp;it&nbsp;later&nbsp;if&nbsp;we&nbsp;detect&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;ustar&nbsp;longnames&nbsp;instead&nbsp;of&nbsp;pax</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022609">pathHeaderBytes</span>&nbsp;<span class="op" id="6022625">:=</span>&nbsp;<span class="ident" id="6022628">s</span><span class="op" id="6022629">.</span><span class="ident" id="6022630">next</span><span class="op" id="6022634">(</span><span class="ident" id="6022635">fileNameSize</span><span class="op" id="6022647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022651">tw</span><span class="op" id="6022653">.</span><span class="ident" id="6022654">cString</span><span class="op" id="6022661">(</span><span class="ident" id="6022662">pathHeaderBytes</span><span class="op" id="6022677">,</span>&nbsp;<span class="ident" id="6022679">hdr</span><span class="op" id="6022682">.</span><span class="ident" id="6022683">Name</span><span class="op" id="6022687">,</span>&nbsp;<span class="builtintype" id="6022689">true</span><span class="op" id="6022693">,</span>&nbsp;<span class="ident" id="6022695">paxPath</span><span class="op" id="6022702">,</span>&nbsp;<span class="ident" id="6022704">paxHeaders</span><span class="op" id="6022714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6022718">//&nbsp;Handle&nbsp;out&nbsp;of&nbsp;range&nbsp;ModTime&nbsp;carefully.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6022761">var</span>&nbsp;<span class="ident" id="6022765">modTime</span>&nbsp;<span class="ident" id="6022773">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6022780">if</span>&nbsp;<span class="op" id="6022783">!</span><span class="ident" id="6022784">hdr</span><span class="op" id="6022787">.</span><span class="ident" id="6022788">ModTime</span><span class="op" id="6022795">.</span><span class="ident" id="6022796">Before</span><span class="op" id="6022802">(</span><span class="ident" id="6022803">minTime</span><span class="op" id="6022810">)</span>&nbsp;<span class="op" id="6022812">&amp;&amp;</span>&nbsp;<span class="op" id="6022815">!</span><span class="ident" id="6022816">hdr</span><span class="op" id="6022819">.</span><span class="ident" id="6022820">ModTime</span><span class="op" id="6022827">.</span><span class="ident" id="6022828">After</span><span class="op" id="6022833">(</span><span class="ident" id="6022834">maxTime</span><span class="op" id="6022841">)</span>&nbsp;<span class="op" id="6022843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022847">modTime</span>&nbsp;<span class="op" id="6022855">=</span>&nbsp;<span class="ident" id="6022857">hdr</span><span class="op" id="6022860">.</span><span class="ident" id="6022861">ModTime</span><span class="op" id="6022868">.</span><span class="ident" id="6022869">Unix</span><span class="op" id="6022873">(</span><span class="op" id="6022874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6022877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022881">tw</span><span class="op" id="6022883">.</span><span class="ident" id="6022884">octal</span><span class="op" id="6022889">(</span><span class="ident" id="6022890">s</span><span class="op" id="6022891">.</span><span class="ident" id="6022892">next</span><span class="op" id="6022896">(</span><span class="num" id="6022897">8</span><span class="op" id="6022898">)</span><span class="op" id="6022899">,</span>&nbsp;<span class="ident" id="6022901">hdr</span><span class="op" id="6022904">.</span><span class="ident" id="6022905">Mode</span><span class="op" id="6022909">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6022945">//&nbsp;100:108</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022957">tw</span><span class="op" id="6022959">.</span><span class="ident" id="6022960">numeric</span><span class="op" id="6022967">(</span><span class="ident" id="6022968">s</span><span class="op" id="6022969">.</span><span class="ident" id="6022970">next</span><span class="op" id="6022974">(</span><span class="num" id="6022975">8</span><span class="op" id="6022976">)</span><span class="op" id="6022977">,</span>&nbsp;<span class="ident" id="6022979">int64</span><span class="op" id="6022984">(</span><span class="ident" id="6022985">hdr</span><span class="op" id="6022988">.</span><span class="ident" id="6022989">Uid</span><span class="op" id="6022992">)</span><span class="op" id="6022993">,</span>&nbsp;<span class="builtintype" id="6022995">true</span><span class="op" id="6022999">,</span>&nbsp;<span class="ident" id="6023001">paxUid</span><span class="op" id="6023007">,</span>&nbsp;<span class="ident" id="6023009">paxHeaders</span><span class="op" id="6023019">)</span>&nbsp;<span class="comment" id="6023021">//&nbsp;108:116</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023033">tw</span><span class="op" id="6023035">.</span><span class="ident" id="6023036">numeric</span><span class="op" id="6023043">(</span><span class="ident" id="6023044">s</span><span class="op" id="6023045">.</span><span class="ident" id="6023046">next</span><span class="op" id="6023050">(</span><span class="num" id="6023051">8</span><span class="op" id="6023052">)</span><span class="op" id="6023053">,</span>&nbsp;<span class="ident" id="6023055">int64</span><span class="op" id="6023060">(</span><span class="ident" id="6023061">hdr</span><span class="op" id="6023064">.</span><span class="ident" id="6023065">Gid</span><span class="op" id="6023068">)</span><span class="op" id="6023069">,</span>&nbsp;<span class="builtintype" id="6023071">true</span><span class="op" id="6023075">,</span>&nbsp;<span class="ident" id="6023077">paxGid</span><span class="op" id="6023083">,</span>&nbsp;<span class="ident" id="6023085">paxHeaders</span><span class="op" id="6023095">)</span>&nbsp;<span class="comment" id="6023097">//&nbsp;116:124</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023109">tw</span><span class="op" id="6023111">.</span><span class="ident" id="6023112">numeric</span><span class="op" id="6023119">(</span><span class="ident" id="6023120">s</span><span class="op" id="6023121">.</span><span class="ident" id="6023122">next</span><span class="op" id="6023126">(</span><span class="num" id="6023127">12</span><span class="op" id="6023129">)</span><span class="op" id="6023130">,</span>&nbsp;<span class="ident" id="6023132">hdr</span><span class="op" id="6023135">.</span><span class="ident" id="6023136">Size</span><span class="op" id="6023140">,</span>&nbsp;<span class="builtintype" id="6023142">true</span><span class="op" id="6023146">,</span>&nbsp;<span class="ident" id="6023148">paxSize</span><span class="op" id="6023155">,</span>&nbsp;<span class="ident" id="6023157">paxHeaders</span><span class="op" id="6023167">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6023173">//&nbsp;124:136</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023185">tw</span><span class="op" id="6023187">.</span><span class="ident" id="6023188">numeric</span><span class="op" id="6023195">(</span><span class="ident" id="6023196">s</span><span class="op" id="6023197">.</span><span class="ident" id="6023198">next</span><span class="op" id="6023202">(</span><span class="num" id="6023203">12</span><span class="op" id="6023205">)</span><span class="op" id="6023206">,</span>&nbsp;<span class="ident" id="6023208">modTime</span><span class="op" id="6023215">,</span>&nbsp;<span class="builtintype" id="6023217">false</span><span class="op" id="6023222">,</span>&nbsp;<span class="ident" id="6023224">paxNone</span><span class="op" id="6023231">,</span>&nbsp;<span class="builtintype" id="6023233">nil</span><span class="op" id="6023236">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6023249">//&nbsp;136:148&nbsp;---&nbsp;consider&nbsp;using&nbsp;pax&nbsp;for&nbsp;finer&nbsp;granularity</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023306">s</span><span class="op" id="6023307">.</span><span class="ident" id="6023308">next</span><span class="op" id="6023312">(</span><span class="num" id="6023313">8</span><span class="op" id="6023314">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6023370">//&nbsp;chksum&nbsp;(148:156)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023391">s</span><span class="op" id="6023392">.</span><span class="ident" id="6023393">next</span><span class="op" id="6023397">(</span><span class="num" id="6023398">1</span><span class="op" id="6023399">)</span><span class="op" id="6023400">[</span><span class="num" id="6023401">0</span><span class="op" id="6023402">]</span>&nbsp;<span class="op" id="6023404">=</span>&nbsp;<span class="ident" id="6023406">hdr</span><span class="op" id="6023409">.</span><span class="ident" id="6023410">Typeflag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6023455">//&nbsp;156:157</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023468">tw</span><span class="op" id="6023470">.</span><span class="ident" id="6023471">cString</span><span class="op" id="6023478">(</span><span class="ident" id="6023479">s</span><span class="op" id="6023480">.</span><span class="ident" id="6023481">next</span><span class="op" id="6023485">(</span><span class="num" id="6023486">100</span><span class="op" id="6023489">)</span><span class="op" id="6023490">,</span>&nbsp;<span class="ident" id="6023492">hdr</span><span class="op" id="6023495">.</span><span class="ident" id="6023496">Linkname</span><span class="op" id="6023504">,</span>&nbsp;<span class="builtintype" id="6023506">true</span><span class="op" id="6023510">,</span>&nbsp;<span class="ident" id="6023512">paxLinkpath</span><span class="op" id="6023523">,</span>&nbsp;<span class="ident" id="6023525">paxHeaders</span><span class="op" id="6023535">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6023539">copy</span><span class="op" id="6023543">(</span><span class="ident" id="6023544">s</span><span class="op" id="6023545">.</span><span class="ident" id="6023546">next</span><span class="op" id="6023550">(</span><span class="num" id="6023551">8</span><span class="op" id="6023552">)</span><span class="op" id="6023553">,</span>&nbsp;<span class="op" id="6023555">[</span><span class="op" id="6023556">]</span><span class="builtintype" id="6023557">byte</span><span class="op" id="6023561">(</span><span class="string" id="6023562">&#34;ustar\x0000&#34;</span><span class="op" id="6023575">)</span><span class="op" id="6023576">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6023601">//&nbsp;257:265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023613">tw</span><span class="op" id="6023615">.</span><span class="ident" id="6023616">cString</span><span class="op" id="6023623">(</span><span class="ident" id="6023624">s</span><span class="op" id="6023625">.</span><span class="ident" id="6023626">next</span><span class="op" id="6023630">(</span><span class="num" id="6023631">32</span><span class="op" id="6023633">)</span><span class="op" id="6023634">,</span>&nbsp;<span class="ident" id="6023636">hdr</span><span class="op" id="6023639">.</span><span class="ident" id="6023640">Uname</span><span class="op" id="6023645">,</span>&nbsp;<span class="builtintype" id="6023647">true</span><span class="op" id="6023651">,</span>&nbsp;<span class="ident" id="6023653">paxUname</span><span class="op" id="6023661">,</span>&nbsp;<span class="ident" id="6023663">paxHeaders</span><span class="op" id="6023673">)</span>&nbsp;<span class="comment" id="6023675">//&nbsp;265:297</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023687">tw</span><span class="op" id="6023689">.</span><span class="ident" id="6023690">cString</span><span class="op" id="6023697">(</span><span class="ident" id="6023698">s</span><span class="op" id="6023699">.</span><span class="ident" id="6023700">next</span><span class="op" id="6023704">(</span><span class="num" id="6023705">32</span><span class="op" id="6023707">)</span><span class="op" id="6023708">,</span>&nbsp;<span class="ident" id="6023710">hdr</span><span class="op" id="6023713">.</span><span class="ident" id="6023714">Gname</span><span class="op" id="6023719">,</span>&nbsp;<span class="builtintype" id="6023721">true</span><span class="op" id="6023725">,</span>&nbsp;<span class="ident" id="6023727">paxGname</span><span class="op" id="6023735">,</span>&nbsp;<span class="ident" id="6023737">paxHeaders</span><span class="op" id="6023747">)</span>&nbsp;<span class="comment" id="6023749">//&nbsp;297:329</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023761">tw</span><span class="op" id="6023763">.</span><span class="ident" id="6023764">numeric</span><span class="op" id="6023771">(</span><span class="ident" id="6023772">s</span><span class="op" id="6023773">.</span><span class="ident" id="6023774">next</span><span class="op" id="6023778">(</span><span class="num" id="6023779">8</span><span class="op" id="6023780">)</span><span class="op" id="6023781">,</span>&nbsp;<span class="ident" id="6023783">hdr</span><span class="op" id="6023786">.</span><span class="ident" id="6023787">Devmajor</span><span class="op" id="6023795">,</span>&nbsp;<span class="builtintype" id="6023797">false</span><span class="op" id="6023802">,</span>&nbsp;<span class="ident" id="6023804">paxNone</span><span class="op" id="6023811">,</span>&nbsp;<span class="builtintype" id="6023813">nil</span><span class="op" id="6023816">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6023823">//&nbsp;329:337</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023835">tw</span><span class="op" id="6023837">.</span><span class="ident" id="6023838">numeric</span><span class="op" id="6023845">(</span><span class="ident" id="6023846">s</span><span class="op" id="6023847">.</span><span class="ident" id="6023848">next</span><span class="op" id="6023852">(</span><span class="num" id="6023853">8</span><span class="op" id="6023854">)</span><span class="op" id="6023855">,</span>&nbsp;<span class="ident" id="6023857">hdr</span><span class="op" id="6023860">.</span><span class="ident" id="6023861">Devminor</span><span class="op" id="6023869">,</span>&nbsp;<span class="builtintype" id="6023871">false</span><span class="op" id="6023876">,</span>&nbsp;<span class="ident" id="6023878">paxNone</span><span class="op" id="6023885">,</span>&nbsp;<span class="builtintype" id="6023887">nil</span><span class="op" id="6023890">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6023897">//&nbsp;337:345</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6023910">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;prefix&nbsp;to&nbsp;allow&nbsp;to&nbsp;overwrite&nbsp;it&nbsp;later&nbsp;if&nbsp;we&nbsp;detect&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;ustar&nbsp;longnames&nbsp;instead&nbsp;of&nbsp;pax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6024036">prefixHeaderBytes</span>&nbsp;<span class="op" id="6024054">:=</span>&nbsp;<span class="ident" id="6024057">s</span><span class="op" id="6024058">.</span><span class="ident" id="6024059">next</span><span class="op" id="6024063">(</span><span class="num" id="6024064">155</span><span class="op" id="6024067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6024070">tw</span><span class="op" id="6024072">.</span><span class="ident" id="6024073">cString</span><span class="op" id="6024080">(</span><span class="ident" id="6024081">prefixHeaderBytes</span><span class="op" id="6024098">,</span>&nbsp;<span class="string" id="6024100">&#34;&#34;</span><span class="op" id="6024102">,</span>&nbsp;<span class="builtintype" id="6024104">false</span><span class="op" id="6024109">,</span>&nbsp;<span class="ident" id="6024111">paxNone</span><span class="op" id="6024118">,</span>&nbsp;<span class="builtintype" id="6024120">nil</span><span class="op" id="6024123">)</span>&nbsp;<span class="comment" id="6024125">//&nbsp;345:500&nbsp;&nbsp;prefix</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6024146">//&nbsp;Use&nbsp;the&nbsp;GNU&nbsp;magic&nbsp;instead&nbsp;of&nbsp;POSIX&nbsp;magic&nbsp;if&nbsp;we&nbsp;used&nbsp;any&nbsp;GNU&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6024222">if</span>&nbsp;<span class="ident" id="6024225">tw</span><span class="op" id="6024227">.</span><span class="ident" id="6024228">usedBinary</span>&nbsp;<span class="op" id="6024239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6024243">copy</span><span class="op" id="6024247">(</span><span class="ident" id="6024248">header</span><span class="op" id="6024254">[</span><span class="num" id="6024255">257</span><span class="op" id="6024258">:</span><span class="num" id="6024259">265</span><span class="op" id="6024262">]</span><span class="op" id="6024263">,</span>&nbsp;<span class="op" id="6024265">[</span><span class="op" id="6024266">]</span><span class="builtintype" id="6024267">byte</span><span class="op" id="6024271">(</span><span class="string" id="6024272">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="6024285">)</span><span class="op" id="6024286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6024289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6024293">_</span><span class="op" id="6024294">,</span>&nbsp;<span class="ident" id="6024296">paxPathUsed</span>&nbsp;<span class="op" id="6024308">:=</span>&nbsp;<span class="ident" id="6024311">paxHeaders</span><span class="op" id="6024321">[</span><span class="ident" id="6024322">paxPath</span><span class="op" id="6024329">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6024332">//&nbsp;try&nbsp;to&nbsp;use&nbsp;a&nbsp;ustar&nbsp;header&nbsp;when&nbsp;only&nbsp;the&nbsp;name&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6024393">if</span>&nbsp;<span class="op" id="6024396">!</span><span class="ident" id="6024397">tw</span><span class="op" id="6024399">.</span><span class="ident" id="6024400">preferPax</span>&nbsp;<span class="op" id="6024410">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6024413">len</span><span class="op" id="6024416">(</span><span class="ident" id="6024417">paxHeaders</span><span class="op" id="6024427">)</span>&nbsp;<span class="op" id="6024429">==</span>&nbsp;<span class="num" id="6024432">1</span>&nbsp;<span class="op" id="6024434">&amp;&amp;</span>&nbsp;<span class="ident" id="6024437">paxPathUsed</span>&nbsp;<span class="op" id="6024449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6024453">suffix</span>&nbsp;<span class="op" id="6024460">:=</span>&nbsp;<span class="ident" id="6024463">hdr</span><span class="op" id="6024466">.</span><span class="ident" id="6024467">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6024474">prefix</span>&nbsp;<span class="op" id="6024481">:=</span>&nbsp;<span class="string" id="6024484">&#34;&#34;</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6024489">if</span>&nbsp;<span class="builtinfunc" id="6024492">len</span><span class="op" id="6024495">(</span><span class="ident" id="6024496">hdr</span><span class="op" id="6024499">.</span><span class="ident" id="6024500">Name</span><span class="op" id="6024504">)</span>&nbsp;<span class="op" id="6024506">&gt;</span>&nbsp;<span class="ident" id="6024508">fileNameSize</span>&nbsp;<span class="op" id="6024521">&amp;&amp;</span>&nbsp;<span class="ident" id="6024524">isASCII</span><span class="op" id="6024531">(</span><span class="ident" id="6024532">hdr</span><span class="op" id="6024535">.</span><span class="ident" id="6024536">Name</span><span class="op" id="6024540">)</span>&nbsp;<span class="op" id="6024542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6024547">var</span>&nbsp;<span class="ident" id="6024551">err</span>&nbsp;<span class="builtintype" id="6024555">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6024564">prefix</span><span class="op" id="6024570">,</span>&nbsp;<span class="ident" id="6024572">suffix</span><span class="op" id="6024578">,</span>&nbsp;<span class="ident" id="6024580">err</span>&nbsp;<span class="op" id="6024584">=</span>&nbsp;<span class="ident" id="6024586">tw</span><span class="op" id="6024588">.</span><span class="ident" id="6024589">splitUSTARLongName</span><span class="op" id="6024607">(</span><span class="ident" id="6024608">hdr</span><span class="op" id="6024611">.</span><span class="ident" id="6024612">Name</span><span class="op" id="6024616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6024621">if</span>&nbsp;<span class="ident" id="6024624">err</span>&nbsp;<span class="op" id="6024628">==</span>&nbsp;<span class="builtintype" id="6024631">nil</span>&nbsp;<span class="op" id="6024635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6024641">//&nbsp;ok&nbsp;we&nbsp;can&nbsp;use&nbsp;a&nbsp;ustar&nbsp;long&nbsp;name&nbsp;instead&nbsp;of&nbsp;pax,&nbsp;now&nbsp;correct&nbsp;the&nbsp;fields</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6024720">//&nbsp;remove&nbsp;the&nbsp;path&nbsp;field&nbsp;from&nbsp;the&nbsp;pax&nbsp;header.&nbsp;this&nbsp;will&nbsp;suppress&nbsp;the&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6024804">delete</span><span class="op" id="6024810">(</span><span class="ident" id="6024811">paxHeaders</span><span class="op" id="6024821">,</span>&nbsp;<span class="ident" id="6024823">paxPath</span><span class="op" id="6024830">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6024837">//&nbsp;update&nbsp;the&nbsp;path&nbsp;fields</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6024867">tw</span><span class="op" id="6024869">.</span><span class="ident" id="6024870">cString</span><span class="op" id="6024877">(</span><span class="ident" id="6024878">pathHeaderBytes</span><span class="op" id="6024893">,</span>&nbsp;<span class="ident" id="6024895">suffix</span><span class="op" id="6024901">,</span>&nbsp;<span class="builtintype" id="6024903">false</span><span class="op" id="6024908">,</span>&nbsp;<span class="ident" id="6024910">paxNone</span><span class="op" id="6024917">,</span>&nbsp;<span class="builtintype" id="6024919">nil</span><span class="op" id="6024922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6024928">tw</span><span class="op" id="6024930">.</span><span class="ident" id="6024931">cString</span><span class="op" id="6024938">(</span><span class="ident" id="6024939">prefixHeaderBytes</span><span class="op" id="6024956">,</span>&nbsp;<span class="ident" id="6024958">prefix</span><span class="op" id="6024964">,</span>&nbsp;<span class="builtintype" id="6024966">false</span><span class="op" id="6024971">,</span>&nbsp;<span class="ident" id="6024973">paxNone</span><span class="op" id="6024980">,</span>&nbsp;<span class="builtintype" id="6024982">nil</span><span class="op" id="6024985">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6024992">//&nbsp;Use&nbsp;the&nbsp;ustar&nbsp;magic&nbsp;if&nbsp;we&nbsp;used&nbsp;ustar&nbsp;long&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6025048">if</span>&nbsp;<span class="builtinfunc" id="6025051">len</span><span class="op" id="6025054">(</span><span class="ident" id="6025055">prefix</span><span class="op" id="6025061">)</span>&nbsp;<span class="op" id="6025063">&gt;</span>&nbsp;<span class="num" id="6025065">0</span>&nbsp;<span class="op" id="6025067">&amp;&amp;</span>&nbsp;<span class="op" id="6025070">!</span><span class="ident" id="6025071">tw</span><span class="op" id="6025073">.</span><span class="ident" id="6025074">usedBinary</span>&nbsp;<span class="op" id="6025085">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6025092">copy</span><span class="op" id="6025096">(</span><span class="ident" id="6025097">header</span><span class="op" id="6025103">[</span><span class="num" id="6025104">257</span><span class="op" id="6025107">:</span><span class="num" id="6025108">265</span><span class="op" id="6025111">]</span><span class="op" id="6025112">,</span>&nbsp;<span class="op" id="6025114">[</span><span class="op" id="6025115">]</span><span class="builtintype" id="6025116">byte</span><span class="op" id="6025120">(</span><span class="string" id="6025121">&#34;ustar\x00&#34;</span><span class="op" id="6025132">)</span><span class="op" id="6025133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6025139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6025144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6025148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6025151">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6025155">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;NUL&nbsp;and&nbsp;a&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6025212">//&nbsp;This&nbsp;is&nbsp;different&nbsp;from&nbsp;the&nbsp;other&nbsp;octal&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6025263">chksum</span><span class="op" id="6025269">,</span>&nbsp;<span class="ident" id="6025271">_</span>&nbsp;<span class="op" id="6025273">:=</span>&nbsp;<span class="ident" id="6025276">checksum</span><span class="op" id="6025284">(</span><span class="ident" id="6025285">header</span><span class="op" id="6025291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6025294">tw</span><span class="op" id="6025296">.</span><span class="ident" id="6025297">octal</span><span class="op" id="6025302">(</span><span class="ident" id="6025303">header</span><span class="op" id="6025309">[</span><span class="num" id="6025310">148</span><span class="op" id="6025313">:</span><span class="num" id="6025314">155</span><span class="op" id="6025317">]</span><span class="op" id="6025318">,</span>&nbsp;<span class="ident" id="6025320">chksum</span><span class="op" id="6025326">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6025329">header</span><span class="op" id="6025335">[</span><span class="num" id="6025336">155</span><span class="op" id="6025339">]</span>&nbsp;<span class="op" id="6025341">=</span>&nbsp;<span class="string" id="6025343">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6025349">if</span>&nbsp;<span class="ident" id="6025352">tw</span><span class="op" id="6025354">.</span><span class="ident" id="6025355">err</span>&nbsp;<span class="op" id="6025359">!=</span>&nbsp;<span class="builtintype" id="6025362">nil</span>&nbsp;<span class="op" id="6025366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6025370">//&nbsp;problem&nbsp;with&nbsp;header;&nbsp;probably&nbsp;integer&nbsp;too&nbsp;big&nbsp;for&nbsp;a&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6025434">return</span>&nbsp;<span class="ident" id="6025441">tw</span><span class="op" id="6025443">.</span><span class="ident" id="6025444">err</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6025449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6025453">if</span>&nbsp;<span class="ident" id="6025456">allowPax</span>&nbsp;<span class="op" id="6025465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6025469">for</span>&nbsp;<span class="ident" id="6025473">k</span><span class="op" id="6025474">,</span>&nbsp;<span class="ident" id="6025476">v</span>&nbsp;<span class="op" id="6025478">:=</span>&nbsp;<span class="keyword" id="6025481">range</span>&nbsp;<span class="ident" id="6025487">hdr</span><span class="op" id="6025490">.</span><span class="ident" id="6025491">Xattrs</span>&nbsp;<span class="op" id="6025498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6025503">paxHeaders</span><span class="op" id="6025513">[</span><span class="ident" id="6025514">paxXattr</span><span class="op" id="6025522">+</span><span class="ident" id="6025523">k</span><span class="op" id="6025524">]</span>&nbsp;<span class="op" id="6025526">=</span>&nbsp;<span class="ident" id="6025528">v</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6025532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6025535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6025539">if</span>&nbsp;<span class="builtinfunc" id="6025542">len</span><span class="op" id="6025545">(</span><span class="ident" id="6025546">paxHeaders</span><span class="op" id="6025556">)</span>&nbsp;<span class="op" id="6025558">&gt;</span>&nbsp;<span class="num" id="6025560">0</span>&nbsp;<span class="op" id="6025562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6025566">if</span>&nbsp;<span class="op" id="6025569">!</span><span class="ident" id="6025570">allowPax</span>&nbsp;<span class="op" id="6025579">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6025584">return</span>&nbsp;<span class="ident" id="6025591">errInvalidHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6025610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6025614">if</span>&nbsp;<span class="ident" id="6025617">err</span>&nbsp;<span class="op" id="6025621">:=</span>&nbsp;<span class="ident" id="6025624">tw</span><span class="op" id="6025626">.</span><span class="ident" id="6025627">writePAXHeader</span><span class="op" id="6025641">(</span><span class="ident" id="6025642">hdr</span><span class="op" id="6025645">,</span>&nbsp;<span class="ident" id="6025647">paxHeaders</span><span class="op" id="6025657">)</span><span class="op" id="6025658">;</span>&nbsp;<span class="ident" id="6025660">err</span>&nbsp;<span class="op" id="6025664">!=</span>&nbsp;<span class="builtintype" id="6025667">nil</span>&nbsp;<span class="op" id="6025671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6025676">return</span>&nbsp;<span class="ident" id="6025683">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6025689">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6025692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6025695">tw</span><span class="op" id="6025697">.</span><span class="ident" id="6025698">nb</span>&nbsp;<span class="op" id="6025701">=</span>&nbsp;<span class="ident" id="6025703">int64</span><span class="op" id="6025708">(</span><span class="ident" id="6025709">hdr</span><span class="op" id="6025712">.</span><span class="ident" id="6025713">Size</span><span class="op" id="6025717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6025720">tw</span><span class="op" id="6025722">.</span><span class="ident" id="6025723">pad</span>&nbsp;<span class="op" id="6025727">=</span>&nbsp;<span class="op" id="6025729">(</span><span class="ident" id="6025730">blockSize</span>&nbsp;<span class="op" id="6025740">-</span>&nbsp;<span class="op" id="6025742">(</span><span class="ident" id="6025743">tw</span><span class="op" id="6025745">.</span><span class="ident" id="6025746">nb</span>&nbsp;<span class="op" id="6025749">%</span>&nbsp;<span class="ident" id="6025751">blockSize</span><span class="op" id="6025760">)</span><span class="op" id="6025761">)</span>&nbsp;<span class="op" id="6025763">%</span>&nbsp;<span class="ident" id="6025765">blockSize</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6025777">_</span><span class="op" id="6025778">,</span>&nbsp;<span class="ident" id="6025780">tw</span><span class="op" id="6025782">.</span><span class="ident" id="6025783">err</span>&nbsp;<span class="op" id="6025787">=</span>&nbsp;<span class="ident" id="6025789">tw</span><span class="op" id="6025791">.</span><span class="ident" id="6025792">w</span><span class="op" id="6025793">.</span><span class="ident" id="6025794">Write</span><span class="op" id="6025799">(</span><span class="ident" id="6025800">header</span><span class="op" id="6025806">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6025809">return</span>&nbsp;<span class="ident" id="6025816">tw</span><span class="op" id="6025818">.</span><span class="ident" id="6025819">err</span><br>
<span class="lineno"></span><span class="op" id="6025823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6025826">//&nbsp;writeUSTARLongName&nbsp;splits&nbsp;a&nbsp;USTAR&nbsp;long&nbsp;name&nbsp;hdr.Name.</span><br>
<span class="lineno"></span><span class="comment" id="6025883">//&nbsp;name&nbsp;must&nbsp;be&nbsp;&lt;&nbsp;256&nbsp;characters.&nbsp;errNameTooLong&nbsp;is&nbsp;returned</span><br>
<span class="lineno">275</span><span class="comment" id="6025944">//&nbsp;if&nbsp;hdr.Name&nbsp;can&#39;t&nbsp;be&nbsp;split.&nbsp;The&nbsp;splitting&nbsp;heuristic</span><br>
<span class="lineno"></span><span class="comment" id="6025999">//&nbsp;is&nbsp;compatible&nbsp;with&nbsp;gnu&nbsp;tar.</span><br>
<span class="lineno"></span><span class="keyword" id="6026030">func</span>&nbsp;<span class="op" id="6026035">(</span><span class="ident" id="6026036">tw</span>&nbsp;<span class="op" id="6026039">*</span><span class="ident" id="6026040">Writer</span><span class="op" id="6026046">)</span>&nbsp;<span class="ident" id="6026048">splitUSTARLongName</span><span class="op" id="6026066">(</span><span class="ident" id="6026067">name</span>&nbsp;<span class="builtintype" id="6026072">string</span><span class="op" id="6026078">)</span>&nbsp;<span class="op" id="6026080">(</span><span class="ident" id="6026081">prefix</span><span class="op" id="6026087">,</span>&nbsp;<span class="ident" id="6026089">suffix</span>&nbsp;<span class="builtintype" id="6026096">string</span><span class="op" id="6026102">,</span>&nbsp;<span class="ident" id="6026104">err</span>&nbsp;<span class="builtintype" id="6026108">error</span><span class="op" id="6026113">)</span>&nbsp;<span class="op" id="6026115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026118">length</span>&nbsp;<span class="op" id="6026125">:=</span>&nbsp;<span class="builtinfunc" id="6026128">len</span><span class="op" id="6026131">(</span><span class="ident" id="6026132">name</span><span class="op" id="6026136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6026139">if</span>&nbsp;<span class="ident" id="6026142">length</span>&nbsp;<span class="op" id="6026149">&gt;</span>&nbsp;<span class="ident" id="6026151">fileNamePrefixSize</span><span class="op" id="6026169">+</span><span class="num" id="6026170">1</span>&nbsp;<span class="op" id="6026172">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026176">length</span>&nbsp;<span class="op" id="6026183">=</span>&nbsp;<span class="ident" id="6026185">fileNamePrefixSize</span>&nbsp;<span class="op" id="6026204">+</span>&nbsp;<span class="num" id="6026206">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6026209">}</span>&nbsp;<span class="keyword" id="6026211">else</span>&nbsp;<span class="keyword" id="6026216">if</span>&nbsp;<span class="ident" id="6026219">name</span><span class="op" id="6026223">[</span><span class="ident" id="6026224">length</span><span class="op" id="6026230">-</span><span class="num" id="6026231">1</span><span class="op" id="6026232">]</span>&nbsp;<span class="op" id="6026234">==</span>&nbsp;<span class="string" id="6026237">&#39;/&#39;</span>&nbsp;<span class="op" id="6026241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026245">length</span><span class="op" id="6026251">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6026255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026258">i</span>&nbsp;<span class="op" id="6026260">:=</span>&nbsp;<span class="ident" id="6026263">strings</span><span class="op" id="6026270">.</span><span class="ident" id="6026271">LastIndex</span><span class="op" id="6026280">(</span><span class="ident" id="6026281">name</span><span class="op" id="6026285">[</span><span class="op" id="6026286">:</span><span class="ident" id="6026287">length</span><span class="op" id="6026293">]</span><span class="op" id="6026294">,</span>&nbsp;<span class="string" id="6026296">&#34;/&#34;</span><span class="op" id="6026299">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6026302">//&nbsp;nlen&nbsp;contains&nbsp;the&nbsp;resulting&nbsp;length&nbsp;in&nbsp;the&nbsp;name&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6026360">//&nbsp;plen&nbsp;contains&nbsp;the&nbsp;resulting&nbsp;length&nbsp;in&nbsp;the&nbsp;prefix&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026420">nlen</span>&nbsp;<span class="op" id="6026425">:=</span>&nbsp;<span class="builtinfunc" id="6026428">len</span><span class="op" id="6026431">(</span><span class="ident" id="6026432">name</span><span class="op" id="6026436">)</span>&nbsp;<span class="op" id="6026438">-</span>&nbsp;<span class="ident" id="6026440">i</span>&nbsp;<span class="op" id="6026442">-</span>&nbsp;<span class="num" id="6026444">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026447">plen</span>&nbsp;<span class="op" id="6026452">:=</span>&nbsp;<span class="ident" id="6026455">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6026458">if</span>&nbsp;<span class="ident" id="6026461">i</span>&nbsp;<span class="op" id="6026463">&lt;=</span>&nbsp;<span class="num" id="6026466">0</span>&nbsp;<span class="op" id="6026468">||</span>&nbsp;<span class="ident" id="6026471">nlen</span>&nbsp;<span class="op" id="6026476">&gt;</span>&nbsp;<span class="ident" id="6026478">fileNameSize</span>&nbsp;<span class="op" id="6026491">||</span>&nbsp;<span class="ident" id="6026494">nlen</span>&nbsp;<span class="op" id="6026499">==</span>&nbsp;<span class="num" id="6026502">0</span>&nbsp;<span class="op" id="6026504">||</span>&nbsp;<span class="ident" id="6026507">plen</span>&nbsp;<span class="op" id="6026512">&gt;</span>&nbsp;<span class="ident" id="6026514">fileNamePrefixSize</span>&nbsp;<span class="op" id="6026533">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026537">err</span>&nbsp;<span class="op" id="6026541">=</span>&nbsp;<span class="ident" id="6026543">errNameTooLong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6026560">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6026568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026571">prefix</span><span class="op" id="6026577">,</span>&nbsp;<span class="ident" id="6026579">suffix</span>&nbsp;<span class="op" id="6026586">=</span>&nbsp;<span class="ident" id="6026588">name</span><span class="op" id="6026592">[</span><span class="op" id="6026593">:</span><span class="ident" id="6026594">i</span><span class="op" id="6026595">]</span><span class="op" id="6026596">,</span>&nbsp;<span class="ident" id="6026598">name</span><span class="op" id="6026602">[</span><span class="ident" id="6026603">i</span><span class="op" id="6026604">+</span><span class="num" id="6026605">1</span><span class="op" id="6026606">:</span><span class="op" id="6026607">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6026610">return</span><br>
<span class="lineno">295</span><span class="op" id="6026617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6026620">//&nbsp;writePaxHeader&nbsp;writes&nbsp;an&nbsp;extended&nbsp;pax&nbsp;header&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6026675">//&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6026687">func</span>&nbsp;<span class="op" id="6026692">(</span><span class="ident" id="6026693">tw</span>&nbsp;<span class="op" id="6026696">*</span><span class="ident" id="6026697">Writer</span><span class="op" id="6026703">)</span>&nbsp;<span class="ident" id="6026705">writePAXHeader</span><span class="op" id="6026719">(</span><span class="ident" id="6026720">hdr</span>&nbsp;<span class="op" id="6026724">*</span><span class="ident" id="6026725">Header</span><span class="op" id="6026731">,</span>&nbsp;<span class="ident" id="6026733">paxHeaders</span>&nbsp;<span class="keyword" id="6026744">map</span><span class="op" id="6026747">[</span><span class="builtintype" id="6026748">string</span><span class="op" id="6026754">]</span><span class="builtintype" id="6026755">string</span><span class="op" id="6026761">)</span>&nbsp;<span class="builtintype" id="6026763">error</span>&nbsp;<span class="op" id="6026769">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6026772">//&nbsp;Prepare&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026800">ext</span>&nbsp;<span class="op" id="6026804">:=</span>&nbsp;<span class="builtinfunc" id="6026807">new</span><span class="op" id="6026810">(</span><span class="ident" id="6026811">Header</span><span class="op" id="6026817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026820">ext</span><span class="op" id="6026823">.</span><span class="ident" id="6026824">Typeflag</span>&nbsp;<span class="op" id="6026833">=</span>&nbsp;<span class="ident" id="6026835">TypeXHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6026848">//&nbsp;Setting&nbsp;ModTime&nbsp;is&nbsp;required&nbsp;for&nbsp;reader&nbsp;parsing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6026902">//&nbsp;succeed,&nbsp;and&nbsp;seems&nbsp;harmless&nbsp;enough.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026942">ext</span><span class="op" id="6026945">.</span><span class="ident" id="6026946">ModTime</span>&nbsp;<span class="op" id="6026954">=</span>&nbsp;<span class="ident" id="6026956">hdr</span><span class="op" id="6026959">.</span><span class="ident" id="6026960">ModTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6026969">//&nbsp;The&nbsp;spec&nbsp;asks&nbsp;that&nbsp;we&nbsp;namespace&nbsp;our&nbsp;pseudo&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6027022">//&nbsp;with&nbsp;the&nbsp;current&nbsp;pid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6027048">pid</span>&nbsp;<span class="op" id="6027052">:=</span>&nbsp;<span class="ident" id="6027055">os</span><span class="op" id="6027057">.</span><span class="ident" id="6027058">Getpid</span><span class="op" id="6027064">(</span><span class="op" id="6027065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6027068">dir</span><span class="op" id="6027071">,</span>&nbsp;<span class="ident" id="6027073">file</span>&nbsp;<span class="op" id="6027078">:=</span>&nbsp;<span class="ident" id="6027081">path</span><span class="op" id="6027085">.</span><span class="ident" id="6027086">Split</span><span class="op" id="6027091">(</span><span class="ident" id="6027092">hdr</span><span class="op" id="6027095">.</span><span class="ident" id="6027096">Name</span><span class="op" id="6027100">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6027103">fullName</span>&nbsp;<span class="op" id="6027112">:=</span>&nbsp;<span class="ident" id="6027115">path</span><span class="op" id="6027119">.</span><span class="ident" id="6027120">Join</span><span class="op" id="6027124">(</span><span class="ident" id="6027125">dir</span><span class="op" id="6027128">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6027132">fmt</span><span class="op" id="6027135">.</span><span class="ident" id="6027136">Sprintf</span><span class="op" id="6027143">(</span><span class="string" id="6027144">&#34;PaxHeaders.%d&#34;</span><span class="op" id="6027159">,</span>&nbsp;<span class="ident" id="6027161">pid</span><span class="op" id="6027164">)</span><span class="op" id="6027165">,</span>&nbsp;<span class="ident" id="6027167">file</span><span class="op" id="6027171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6027175">ascii</span>&nbsp;<span class="op" id="6027181">:=</span>&nbsp;<span class="ident" id="6027184">toASCII</span><span class="op" id="6027191">(</span><span class="ident" id="6027192">fullName</span><span class="op" id="6027200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6027203">if</span>&nbsp;<span class="builtinfunc" id="6027206">len</span><span class="op" id="6027209">(</span><span class="ident" id="6027210">ascii</span><span class="op" id="6027215">)</span>&nbsp;<span class="op" id="6027217">&gt;</span>&nbsp;<span class="num" id="6027219">100</span>&nbsp;<span class="op" id="6027223">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6027227">ascii</span>&nbsp;<span class="op" id="6027233">=</span>&nbsp;<span class="ident" id="6027235">ascii</span><span class="op" id="6027240">[</span><span class="op" id="6027241">:</span><span class="num" id="6027242">100</span><span class="op" id="6027245">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6027248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6027251">ext</span><span class="op" id="6027254">.</span><span class="ident" id="6027255">Name</span>&nbsp;<span class="op" id="6027260">=</span>&nbsp;<span class="ident" id="6027262">ascii</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6027269">//&nbsp;Construct&nbsp;the&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6027292">var</span>&nbsp;<span class="ident" id="6027296">buf</span>&nbsp;<span class="ident" id="6027300">bytes</span><span class="op" id="6027305">.</span><span class="ident" id="6027306">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6027315">for</span>&nbsp;<span class="ident" id="6027319">k</span><span class="op" id="6027320">,</span>&nbsp;<span class="ident" id="6027322">v</span>&nbsp;<span class="op" id="6027324">:=</span>&nbsp;<span class="keyword" id="6027327">range</span>&nbsp;<span class="ident" id="6027333">paxHeaders</span>&nbsp;<span class="op" id="6027344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6027348">fmt</span><span class="op" id="6027351">.</span><span class="ident" id="6027352">Fprint</span><span class="op" id="6027358">(</span><span class="op" id="6027359">&amp;</span><span class="ident" id="6027360">buf</span><span class="op" id="6027363">,</span>&nbsp;<span class="ident" id="6027365">paxHeader</span><span class="op" id="6027374">(</span><span class="ident" id="6027375">k</span><span class="op" id="6027376">+</span><span class="string" id="6027377">&#34;=&#34;</span><span class="op" id="6027380">+</span><span class="ident" id="6027381">v</span><span class="op" id="6027382">)</span><span class="op" id="6027383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6027386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6027390">ext</span><span class="op" id="6027393">.</span><span class="ident" id="6027394">Size</span>&nbsp;<span class="op" id="6027399">=</span>&nbsp;<span class="ident" id="6027401">int64</span><span class="op" id="6027406">(</span><span class="builtinfunc" id="6027407">len</span><span class="op" id="6027410">(</span><span class="ident" id="6027411">buf</span><span class="op" id="6027414">.</span><span class="ident" id="6027415">Bytes</span><span class="op" id="6027420">(</span><span class="op" id="6027421">)</span><span class="op" id="6027422">)</span><span class="op" id="6027423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6027426">if</span>&nbsp;<span class="ident" id="6027429">err</span>&nbsp;<span class="op" id="6027433">:=</span>&nbsp;<span class="ident" id="6027436">tw</span><span class="op" id="6027438">.</span><span class="ident" id="6027439">writeHeader</span><span class="op" id="6027450">(</span><span class="ident" id="6027451">ext</span><span class="op" id="6027454">,</span>&nbsp;<span class="builtintype" id="6027456">false</span><span class="op" id="6027461">)</span><span class="op" id="6027462">;</span>&nbsp;<span class="ident" id="6027464">err</span>&nbsp;<span class="op" id="6027468">!=</span>&nbsp;<span class="builtintype" id="6027471">nil</span>&nbsp;<span class="op" id="6027475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6027479">return</span>&nbsp;<span class="ident" id="6027486">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6027491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6027494">if</span>&nbsp;<span class="ident" id="6027497">_</span><span class="op" id="6027498">,</span>&nbsp;<span class="ident" id="6027500">err</span>&nbsp;<span class="op" id="6027504">:=</span>&nbsp;<span class="ident" id="6027507">tw</span><span class="op" id="6027509">.</span><span class="ident" id="6027510">Write</span><span class="op" id="6027515">(</span><span class="ident" id="6027516">buf</span><span class="op" id="6027519">.</span><span class="ident" id="6027520">Bytes</span><span class="op" id="6027525">(</span><span class="op" id="6027526">)</span><span class="op" id="6027527">)</span><span class="op" id="6027528">;</span>&nbsp;<span class="ident" id="6027530">err</span>&nbsp;<span class="op" id="6027534">!=</span>&nbsp;<span class="builtintype" id="6027537">nil</span>&nbsp;<span class="op" id="6027541">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6027545">return</span>&nbsp;<span class="ident" id="6027552">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6027557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6027560">if</span>&nbsp;<span class="ident" id="6027563">err</span>&nbsp;<span class="op" id="6027567">:=</span>&nbsp;<span class="ident" id="6027570">tw</span><span class="op" id="6027572">.</span><span class="ident" id="6027573">Flush</span><span class="op" id="6027578">(</span><span class="op" id="6027579">)</span><span class="op" id="6027580">;</span>&nbsp;<span class="ident" id="6027582">err</span>&nbsp;<span class="op" id="6027586">!=</span>&nbsp;<span class="builtintype" id="6027589">nil</span>&nbsp;<span class="op" id="6027593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6027597">return</span>&nbsp;<span class="ident" id="6027604">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6027609">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6027612">return</span>&nbsp;<span class="builtintype" id="6027619">nil</span><br>
<span class="lineno"></span><span class="op" id="6027623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6027626">//&nbsp;paxHeader&nbsp;formats&nbsp;a&nbsp;single&nbsp;pax&nbsp;record,&nbsp;prefixing&nbsp;it&nbsp;with&nbsp;the&nbsp;appropriate&nbsp;length</span><br>
<span class="lineno"></span><span class="keyword" id="6027709">func</span>&nbsp;<span class="ident" id="6027714">paxHeader</span><span class="op" id="6027723">(</span><span class="ident" id="6027724">msg</span>&nbsp;<span class="builtintype" id="6027728">string</span><span class="op" id="6027734">)</span>&nbsp;<span class="builtintype" id="6027736">string</span>&nbsp;<span class="op" id="6027743">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6027746">const</span>&nbsp;<span class="ident" id="6027752">padding</span>&nbsp;<span class="op" id="6027760">=</span>&nbsp;<span class="num" id="6027762">2</span>&nbsp;<span class="comment" id="6027764">//&nbsp;Extra&nbsp;padding&nbsp;for&nbsp;space&nbsp;and&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6027804">size</span>&nbsp;<span class="op" id="6027809">:=</span>&nbsp;<span class="builtinfunc" id="6027812">len</span><span class="op" id="6027815">(</span><span class="ident" id="6027816">msg</span><span class="op" id="6027819">)</span>&nbsp;<span class="op" id="6027821">+</span>&nbsp;<span class="ident" id="6027823">padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6027832">size</span>&nbsp;<span class="op" id="6027837">+=</span>&nbsp;<span class="builtinfunc" id="6027840">len</span><span class="op" id="6027843">(</span><span class="ident" id="6027844">strconv</span><span class="op" id="6027851">.</span><span class="ident" id="6027852">Itoa</span><span class="op" id="6027856">(</span><span class="ident" id="6027857">size</span><span class="op" id="6027861">)</span><span class="op" id="6027862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6027865">record</span>&nbsp;<span class="op" id="6027872">:=</span>&nbsp;<span class="ident" id="6027875">fmt</span><span class="op" id="6027878">.</span><span class="ident" id="6027879">Sprintf</span><span class="op" id="6027886">(</span><span class="string" id="6027887">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="6027896">,</span>&nbsp;<span class="ident" id="6027898">size</span><span class="op" id="6027902">,</span>&nbsp;<span class="ident" id="6027904">msg</span><span class="op" id="6027907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6027910">if</span>&nbsp;<span class="builtinfunc" id="6027913">len</span><span class="op" id="6027916">(</span><span class="ident" id="6027917">record</span><span class="op" id="6027923">)</span>&nbsp;<span class="op" id="6027925">!=</span>&nbsp;<span class="ident" id="6027928">size</span>&nbsp;<span class="op" id="6027933">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6027937">//&nbsp;Final&nbsp;adjustment&nbsp;if&nbsp;adding&nbsp;size&nbsp;increased</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6027984">//&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6028018">size</span>&nbsp;<span class="op" id="6028023">=</span>&nbsp;<span class="builtinfunc" id="6028025">len</span><span class="op" id="6028028">(</span><span class="ident" id="6028029">record</span><span class="op" id="6028035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6028039">record</span>&nbsp;<span class="op" id="6028046">=</span>&nbsp;<span class="ident" id="6028048">fmt</span><span class="op" id="6028051">.</span><span class="ident" id="6028052">Sprintf</span><span class="op" id="6028059">(</span><span class="string" id="6028060">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="6028069">,</span>&nbsp;<span class="ident" id="6028071">size</span><span class="op" id="6028075">,</span>&nbsp;<span class="ident" id="6028077">msg</span><span class="op" id="6028080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6028083">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028086">return</span>&nbsp;<span class="ident" id="6028093">record</span><br>
<span class="lineno"></span><span class="op" id="6028100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6028103">//&nbsp;Write&nbsp;writes&nbsp;to&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="6028160">//&nbsp;Write&nbsp;returns&nbsp;the&nbsp;error&nbsp;ErrWriteTooLong&nbsp;if&nbsp;more&nbsp;than</span><br>
<span class="lineno">355</span><span class="comment" id="6028216">//&nbsp;hdr.Size&nbsp;bytes&nbsp;are&nbsp;written&nbsp;after&nbsp;WriteHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6028265">func</span>&nbsp;<span class="op" id="6028270">(</span><span class="ident" id="6028271">tw</span>&nbsp;<span class="op" id="6028274">*</span><span class="ident" id="6028275">Writer</span><span class="op" id="6028281">)</span>&nbsp;<span class="ident" id="6028283">Write</span><span class="op" id="6028288">(</span><span class="ident" id="6028289">b</span>&nbsp;<span class="op" id="6028291">[</span><span class="op" id="6028292">]</span><span class="builtintype" id="6028293">byte</span><span class="op" id="6028297">)</span>&nbsp;<span class="op" id="6028299">(</span><span class="ident" id="6028300">n</span>&nbsp;<span class="builtintype" id="6028302">int</span><span class="op" id="6028305">,</span>&nbsp;<span class="ident" id="6028307">err</span>&nbsp;<span class="builtintype" id="6028311">error</span><span class="op" id="6028316">)</span>&nbsp;<span class="op" id="6028318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028321">if</span>&nbsp;<span class="ident" id="6028324">tw</span><span class="op" id="6028326">.</span><span class="ident" id="6028327">closed</span>&nbsp;<span class="op" id="6028334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6028338">err</span>&nbsp;<span class="op" id="6028342">=</span>&nbsp;<span class="ident" id="6028344">ErrWriteTooLong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028362">return</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6028370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6028373">overwrite</span>&nbsp;<span class="op" id="6028383">:=</span>&nbsp;<span class="builtintype" id="6028386">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028393">if</span>&nbsp;<span class="ident" id="6028396">int64</span><span class="op" id="6028401">(</span><span class="builtinfunc" id="6028402">len</span><span class="op" id="6028405">(</span><span class="ident" id="6028406">b</span><span class="op" id="6028407">)</span><span class="op" id="6028408">)</span>&nbsp;<span class="op" id="6028410">&gt;</span>&nbsp;<span class="ident" id="6028412">tw</span><span class="op" id="6028414">.</span><span class="ident" id="6028415">nb</span>&nbsp;<span class="op" id="6028418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6028422">b</span>&nbsp;<span class="op" id="6028424">=</span>&nbsp;<span class="ident" id="6028426">b</span><span class="op" id="6028427">[</span><span class="num" id="6028428">0</span><span class="op" id="6028429">:</span><span class="ident" id="6028430">tw</span><span class="op" id="6028432">.</span><span class="ident" id="6028433">nb</span><span class="op" id="6028435">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6028439">overwrite</span>&nbsp;<span class="op" id="6028449">=</span>&nbsp;<span class="builtintype" id="6028451">true</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6028457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6028460">n</span><span class="op" id="6028461">,</span>&nbsp;<span class="ident" id="6028463">err</span>&nbsp;<span class="op" id="6028467">=</span>&nbsp;<span class="ident" id="6028469">tw</span><span class="op" id="6028471">.</span><span class="ident" id="6028472">w</span><span class="op" id="6028473">.</span><span class="ident" id="6028474">Write</span><span class="op" id="6028479">(</span><span class="ident" id="6028480">b</span><span class="op" id="6028481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6028484">tw</span><span class="op" id="6028486">.</span><span class="ident" id="6028487">nb</span>&nbsp;<span class="op" id="6028490">-=</span>&nbsp;<span class="ident" id="6028493">int64</span><span class="op" id="6028498">(</span><span class="ident" id="6028499">n</span><span class="op" id="6028500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028503">if</span>&nbsp;<span class="ident" id="6028506">err</span>&nbsp;<span class="op" id="6028510">==</span>&nbsp;<span class="builtintype" id="6028513">nil</span>&nbsp;<span class="op" id="6028517">&amp;&amp;</span>&nbsp;<span class="ident" id="6028520">overwrite</span>&nbsp;<span class="op" id="6028530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6028534">err</span>&nbsp;<span class="op" id="6028538">=</span>&nbsp;<span class="ident" id="6028540">ErrWriteTooLong</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028558">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6028566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6028569">tw</span><span class="op" id="6028571">.</span><span class="ident" id="6028572">err</span>&nbsp;<span class="op" id="6028576">=</span>&nbsp;<span class="ident" id="6028578">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028583">return</span><br>
<span class="lineno"></span><span class="op" id="6028590">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6028593">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;flushing&nbsp;any&nbsp;unwritten</span><br>
<span class="lineno"></span><span class="comment" id="6028649">//&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6028683">func</span>&nbsp;<span class="op" id="6028688">(</span><span class="ident" id="6028689">tw</span>&nbsp;<span class="op" id="6028692">*</span><span class="ident" id="6028693">Writer</span><span class="op" id="6028699">)</span>&nbsp;<span class="ident" id="6028701">Close</span><span class="op" id="6028706">(</span><span class="op" id="6028707">)</span>&nbsp;<span class="builtintype" id="6028709">error</span>&nbsp;<span class="op" id="6028715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028718">if</span>&nbsp;<span class="ident" id="6028721">tw</span><span class="op" id="6028723">.</span><span class="ident" id="6028724">err</span>&nbsp;<span class="op" id="6028728">!=</span>&nbsp;<span class="builtintype" id="6028731">nil</span>&nbsp;<span class="op" id="6028735">||</span>&nbsp;<span class="ident" id="6028738">tw</span><span class="op" id="6028740">.</span><span class="ident" id="6028741">closed</span>&nbsp;<span class="op" id="6028748">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028752">return</span>&nbsp;<span class="ident" id="6028759">tw</span><span class="op" id="6028761">.</span><span class="ident" id="6028762">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6028767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6028770">tw</span><span class="op" id="6028772">.</span><span class="ident" id="6028773">Flush</span><span class="op" id="6028778">(</span><span class="op" id="6028779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6028782">tw</span><span class="op" id="6028784">.</span><span class="ident" id="6028785">closed</span>&nbsp;<span class="op" id="6028792">=</span>&nbsp;<span class="builtintype" id="6028794">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028800">if</span>&nbsp;<span class="ident" id="6028803">tw</span><span class="op" id="6028805">.</span><span class="ident" id="6028806">err</span>&nbsp;<span class="op" id="6028810">!=</span>&nbsp;<span class="builtintype" id="6028813">nil</span>&nbsp;<span class="op" id="6028817">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028821">return</span>&nbsp;<span class="ident" id="6028828">tw</span><span class="op" id="6028830">.</span><span class="ident" id="6028831">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6028836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6028840">//&nbsp;trailer:&nbsp;two&nbsp;zero&nbsp;blocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028869">for</span>&nbsp;<span class="ident" id="6028873">i</span>&nbsp;<span class="op" id="6028875">:=</span>&nbsp;<span class="num" id="6028878">0</span><span class="op" id="6028879">;</span>&nbsp;<span class="ident" id="6028881">i</span>&nbsp;<span class="op" id="6028883">&lt;</span>&nbsp;<span class="num" id="6028885">2</span><span class="op" id="6028886">;</span>&nbsp;<span class="ident" id="6028888">i</span><span class="op" id="6028889">++</span>&nbsp;<span class="op" id="6028892">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6028896">_</span><span class="op" id="6028897">,</span>&nbsp;<span class="ident" id="6028899">tw</span><span class="op" id="6028901">.</span><span class="ident" id="6028902">err</span>&nbsp;<span class="op" id="6028906">=</span>&nbsp;<span class="ident" id="6028908">tw</span><span class="op" id="6028910">.</span><span class="ident" id="6028911">w</span><span class="op" id="6028912">.</span><span class="ident" id="6028913">Write</span><span class="op" id="6028918">(</span><span class="ident" id="6028919">zeroBlock</span><span class="op" id="6028928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028932">if</span>&nbsp;<span class="ident" id="6028935">tw</span><span class="op" id="6028937">.</span><span class="ident" id="6028938">err</span>&nbsp;<span class="op" id="6028942">!=</span>&nbsp;<span class="builtintype" id="6028945">nil</span>&nbsp;<span class="op" id="6028949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028954">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6028962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6028965">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6028968">return</span>&nbsp;<span class="ident" id="6028975">tw</span><span class="op" id="6028977">.</span><span class="ident" id="6028978">err</span><br>
<span class="lineno"></span><span class="op" id="6028982">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
