<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html" class="current">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3344848">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3344903">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3344957">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3345008">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;sysSocket&nbsp;and&nbsp;accept&nbsp;for&nbsp;platforms&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3345072">//&nbsp;provide&nbsp;a&nbsp;fast&nbsp;path&nbsp;for&nbsp;setting&nbsp;SetNonblock&nbsp;and&nbsp;CloseOnExec.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3345137">//&nbsp;+build&nbsp;freebsd&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3345162">package</span>&nbsp;<span class="ident" id="3345170">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3345175">import</span>&nbsp;<span class="string" id="3345182">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3345193">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;socket&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">15</span><span class="comment" id="3345263">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3345311">func</span>&nbsp;<span class="ident" id="3345316">sysSocket</span><span class="op" id="3345325">(</span><span class="ident" id="3345326">family</span><span class="op" id="3345332">,</span>&nbsp;<span class="ident" id="3345334">sotype</span><span class="op" id="3345340">,</span>&nbsp;<span class="ident" id="3345342">proto</span>&nbsp;<span class="builtintype" id="3345348">int</span><span class="op" id="3345351">)</span>&nbsp;<span class="op" id="3345353">(</span><span class="builtintype" id="3345354">int</span><span class="op" id="3345357">,</span>&nbsp;<span class="builtintype" id="3345359">error</span><span class="op" id="3345364">)</span>&nbsp;<span class="op" id="3345366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3345369">s</span><span class="op" id="3345370">,</span>&nbsp;<span class="ident" id="3345372">err</span>&nbsp;<span class="op" id="3345376">:=</span>&nbsp;<span class="ident" id="3345379">syscall</span><span class="op" id="3345386">.</span><span class="ident" id="3345387">Socket</span><span class="op" id="3345393">(</span><span class="ident" id="3345394">family</span><span class="op" id="3345400">,</span>&nbsp;<span class="ident" id="3345402">sotype</span><span class="op" id="3345408">|</span><span class="ident" id="3345409">syscall</span><span class="op" id="3345416">.</span><span class="ident" id="3345417">SOCK_NONBLOCK</span><span class="op" id="3345430">|</span><span class="ident" id="3345431">syscall</span><span class="op" id="3345438">.</span><span class="ident" id="3345439">SOCK_CLOEXEC</span><span class="op" id="3345451">,</span>&nbsp;<span class="ident" id="3345453">proto</span><span class="op" id="3345458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3345461">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;SOCK_NONBLOCK&nbsp;and&nbsp;SOCK_CLOEXEC&nbsp;flags&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3345520">//&nbsp;introduced&nbsp;in&nbsp;2.6.27&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;both&nbsp;flags&nbsp;were</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3345583">//&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we&nbsp;get&nbsp;an&nbsp;EINVAL&nbsp;error&nbsp;on&nbsp;Linux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3345647">//&nbsp;or&nbsp;EPROTONOSUPPORT&nbsp;error&nbsp;on&nbsp;FreeBSD,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3345707">//&nbsp;socket&nbsp;without&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3345732">if</span>&nbsp;<span class="ident" id="3345735">err</span>&nbsp;<span class="op" id="3345739">==</span>&nbsp;<span class="builtintype" id="3345742">nil</span>&nbsp;<span class="op" id="3345746">||</span>&nbsp;<span class="op" id="3345749">(</span><span class="ident" id="3345750">err</span>&nbsp;<span class="op" id="3345754">!=</span>&nbsp;<span class="ident" id="3345757">syscall</span><span class="op" id="3345764">.</span><span class="ident" id="3345765">EPROTONOSUPPORT</span>&nbsp;<span class="op" id="3345781">&amp;&amp;</span>&nbsp;<span class="ident" id="3345784">err</span>&nbsp;<span class="op" id="3345788">!=</span>&nbsp;<span class="ident" id="3345791">syscall</span><span class="op" id="3345798">.</span><span class="ident" id="3345799">EINVAL</span><span class="op" id="3345805">)</span>&nbsp;<span class="op" id="3345807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3345811">return</span>&nbsp;<span class="ident" id="3345818">s</span><span class="op" id="3345819">,</span>&nbsp;<span class="ident" id="3345821">err</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3345826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3345830">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3345891">syscall</span><span class="op" id="3345898">.</span><span class="ident" id="3345899">ForkLock</span><span class="op" id="3345907">.</span><span class="ident" id="3345908">RLock</span><span class="op" id="3345913">(</span><span class="op" id="3345914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3345917">s</span><span class="op" id="3345918">,</span>&nbsp;<span class="ident" id="3345920">err</span>&nbsp;<span class="op" id="3345924">=</span>&nbsp;<span class="ident" id="3345926">syscall</span><span class="op" id="3345933">.</span><span class="ident" id="3345934">Socket</span><span class="op" id="3345940">(</span><span class="ident" id="3345941">family</span><span class="op" id="3345947">,</span>&nbsp;<span class="ident" id="3345949">sotype</span><span class="op" id="3345955">,</span>&nbsp;<span class="ident" id="3345957">proto</span><span class="op" id="3345962">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3345965">if</span>&nbsp;<span class="ident" id="3345968">err</span>&nbsp;<span class="op" id="3345972">==</span>&nbsp;<span class="builtintype" id="3345975">nil</span>&nbsp;<span class="op" id="3345979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3345983">syscall</span><span class="op" id="3345990">.</span><span class="ident" id="3345991">CloseOnExec</span><span class="op" id="3346002">(</span><span class="ident" id="3346003">s</span><span class="op" id="3346004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3346007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3346010">syscall</span><span class="op" id="3346017">.</span><span class="ident" id="3346018">ForkLock</span><span class="op" id="3346026">.</span><span class="ident" id="3346027">RUnlock</span><span class="op" id="3346034">(</span><span class="op" id="3346035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346038">if</span>&nbsp;<span class="ident" id="3346041">err</span>&nbsp;<span class="op" id="3346045">!=</span>&nbsp;<span class="builtintype" id="3346048">nil</span>&nbsp;<span class="op" id="3346052">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346056">return</span>&nbsp;<span class="op" id="3346063">-</span><span class="num" id="3346064">1</span><span class="op" id="3346065">,</span>&nbsp;<span class="ident" id="3346067">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3346072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346075">if</span>&nbsp;<span class="ident" id="3346078">err</span>&nbsp;<span class="op" id="3346082">=</span>&nbsp;<span class="ident" id="3346084">syscall</span><span class="op" id="3346091">.</span><span class="ident" id="3346092">SetNonblock</span><span class="op" id="3346103">(</span><span class="ident" id="3346104">s</span><span class="op" id="3346105">,</span>&nbsp;<span class="builtintype" id="3346107">true</span><span class="op" id="3346111">)</span><span class="op" id="3346112">;</span>&nbsp;<span class="ident" id="3346114">err</span>&nbsp;<span class="op" id="3346118">!=</span>&nbsp;<span class="builtintype" id="3346121">nil</span>&nbsp;<span class="op" id="3346125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3346129">syscall</span><span class="op" id="3346136">.</span><span class="ident" id="3346137">Close</span><span class="op" id="3346142">(</span><span class="ident" id="3346143">s</span><span class="op" id="3346144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346148">return</span>&nbsp;<span class="op" id="3346155">-</span><span class="num" id="3346156">1</span><span class="op" id="3346157">,</span>&nbsp;<span class="ident" id="3346159">err</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3346164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346167">return</span>&nbsp;<span class="ident" id="3346174">s</span><span class="op" id="3346175">,</span>&nbsp;<span class="builtintype" id="3346177">nil</span><br>
<span class="lineno"></span><span class="op" id="3346181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3346184">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;accept&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">45</span><span class="comment" id="3346254">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3346302">func</span>&nbsp;<span class="ident" id="3346307">accept</span><span class="op" id="3346313">(</span><span class="ident" id="3346314">s</span>&nbsp;<span class="builtintype" id="3346316">int</span><span class="op" id="3346319">)</span>&nbsp;<span class="op" id="3346321">(</span><span class="builtintype" id="3346322">int</span><span class="op" id="3346325">,</span>&nbsp;<span class="ident" id="3346327">syscall</span><span class="op" id="3346334">.</span><span class="ident" id="3346335">Sockaddr</span><span class="op" id="3346343">,</span>&nbsp;<span class="builtintype" id="3346345">error</span><span class="op" id="3346350">)</span>&nbsp;<span class="op" id="3346352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3346355">ns</span><span class="op" id="3346357">,</span>&nbsp;<span class="ident" id="3346359">sa</span><span class="op" id="3346361">,</span>&nbsp;<span class="ident" id="3346363">err</span>&nbsp;<span class="op" id="3346367">:=</span>&nbsp;<span class="ident" id="3346370">syscall</span><span class="op" id="3346377">.</span><span class="ident" id="3346378">Accept4</span><span class="op" id="3346385">(</span><span class="ident" id="3346386">s</span><span class="op" id="3346387">,</span>&nbsp;<span class="ident" id="3346389">syscall</span><span class="op" id="3346396">.</span><span class="ident" id="3346397">SOCK_NONBLOCK</span><span class="op" id="3346410">|</span><span class="ident" id="3346411">syscall</span><span class="op" id="3346418">.</span><span class="ident" id="3346419">SOCK_CLOEXEC</span><span class="op" id="3346431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3346434">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;accept4&nbsp;system&nbsp;call&nbsp;was&nbsp;introduced&nbsp;in&nbsp;2.6.28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3346496">//&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;it&nbsp;was&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3346560">//&nbsp;get&nbsp;an&nbsp;ENOSYS&nbsp;error&nbsp;on&nbsp;both&nbsp;Linux&nbsp;and&nbsp;FreeBSD,&nbsp;or&nbsp;EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3346621">//&nbsp;error&nbsp;on&nbsp;Linux,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using&nbsp;accept.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346668">switch</span>&nbsp;<span class="ident" id="3346675">err</span>&nbsp;<span class="op" id="3346679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346682">default</span><span class="op" id="3346689">:</span>&nbsp;<span class="comment" id="3346691">//&nbsp;nil&nbsp;and&nbsp;errors&nbsp;other&nbsp;than&nbsp;the&nbsp;ones&nbsp;listed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346738">return</span>&nbsp;<span class="ident" id="3346745">ns</span><span class="op" id="3346747">,</span>&nbsp;<span class="ident" id="3346749">sa</span><span class="op" id="3346751">,</span>&nbsp;<span class="ident" id="3346753">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346758">case</span>&nbsp;<span class="ident" id="3346763">syscall</span><span class="op" id="3346770">.</span><span class="ident" id="3346771">ENOSYS</span><span class="op" id="3346777">:</span>&nbsp;<span class="comment" id="3346779">//&nbsp;syscall&nbsp;missing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346799">case</span>&nbsp;<span class="ident" id="3346804">syscall</span><span class="op" id="3346811">.</span><span class="ident" id="3346812">EINVAL</span><span class="op" id="3346818">:</span>&nbsp;<span class="comment" id="3346820">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346862">case</span>&nbsp;<span class="ident" id="3346867">syscall</span><span class="op" id="3346874">.</span><span class="ident" id="3346875">EACCES</span><span class="op" id="3346881">:</span>&nbsp;<span class="comment" id="3346883">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3346925">case</span>&nbsp;<span class="ident" id="3346930">syscall</span><span class="op" id="3346937">.</span><span class="ident" id="3346938">EFAULT</span><span class="op" id="3346944">:</span>&nbsp;<span class="comment" id="3346946">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3346988">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3346992">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3347053">//&nbsp;It&nbsp;is&nbsp;probably&nbsp;okay&nbsp;to&nbsp;hold&nbsp;the&nbsp;lock&nbsp;across&nbsp;syscall.Accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3347116">//&nbsp;because&nbsp;we&nbsp;have&nbsp;put&nbsp;fd.sysfd&nbsp;into&nbsp;non-blocking&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3347173">//&nbsp;However,&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;File&nbsp;method&nbsp;will&nbsp;put&nbsp;it&nbsp;back&nbsp;into</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3347234">//&nbsp;blocking&nbsp;mode.&nbsp;We&nbsp;can&#39;t&nbsp;take&nbsp;that&nbsp;risk,&nbsp;so&nbsp;no&nbsp;use&nbsp;of&nbsp;ForkLock&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3347306">ns</span><span class="op" id="3347308">,</span>&nbsp;<span class="ident" id="3347310">sa</span><span class="op" id="3347312">,</span>&nbsp;<span class="ident" id="3347314">err</span>&nbsp;<span class="op" id="3347318">=</span>&nbsp;<span class="ident" id="3347320">syscall</span><span class="op" id="3347327">.</span><span class="ident" id="3347328">Accept</span><span class="op" id="3347334">(</span><span class="ident" id="3347335">s</span><span class="op" id="3347336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3347339">if</span>&nbsp;<span class="ident" id="3347342">err</span>&nbsp;<span class="op" id="3347346">==</span>&nbsp;<span class="builtintype" id="3347349">nil</span>&nbsp;<span class="op" id="3347353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3347357">syscall</span><span class="op" id="3347364">.</span><span class="ident" id="3347365">CloseOnExec</span><span class="op" id="3347376">(</span><span class="ident" id="3347377">ns</span><span class="op" id="3347379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3347382">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3347385">if</span>&nbsp;<span class="ident" id="3347388">err</span>&nbsp;<span class="op" id="3347392">!=</span>&nbsp;<span class="builtintype" id="3347395">nil</span>&nbsp;<span class="op" id="3347399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3347403">return</span>&nbsp;<span class="op" id="3347410">-</span><span class="num" id="3347411">1</span><span class="op" id="3347412">,</span>&nbsp;<span class="builtintype" id="3347414">nil</span><span class="op" id="3347417">,</span>&nbsp;<span class="ident" id="3347419">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3347424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3347427">if</span>&nbsp;<span class="ident" id="3347430">err</span>&nbsp;<span class="op" id="3347434">=</span>&nbsp;<span class="ident" id="3347436">syscall</span><span class="op" id="3347443">.</span><span class="ident" id="3347444">SetNonblock</span><span class="op" id="3347455">(</span><span class="ident" id="3347456">ns</span><span class="op" id="3347458">,</span>&nbsp;<span class="builtintype" id="3347460">true</span><span class="op" id="3347464">)</span><span class="op" id="3347465">;</span>&nbsp;<span class="ident" id="3347467">err</span>&nbsp;<span class="op" id="3347471">!=</span>&nbsp;<span class="builtintype" id="3347474">nil</span>&nbsp;<span class="op" id="3347478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3347482">syscall</span><span class="op" id="3347489">.</span><span class="ident" id="3347490">Close</span><span class="op" id="3347495">(</span><span class="ident" id="3347496">ns</span><span class="op" id="3347498">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3347502">return</span>&nbsp;<span class="op" id="3347509">-</span><span class="num" id="3347510">1</span><span class="op" id="3347511">,</span>&nbsp;<span class="builtintype" id="3347513">nil</span><span class="op" id="3347516">,</span>&nbsp;<span class="ident" id="3347518">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3347523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3347526">return</span>&nbsp;<span class="ident" id="3347533">ns</span><span class="op" id="3347535">,</span>&nbsp;<span class="ident" id="3347537">sa</span><span class="op" id="3347539">,</span>&nbsp;<span class="builtintype" id="3347541">nil</span><br>
<span class="lineno"></span><span class="op" id="3347545">}</span>
</div>
</body>
</html>
