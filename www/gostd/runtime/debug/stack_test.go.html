<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8478486">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8478541">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8478595">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8478646">package</span>&nbsp;<span class="ident" id="8478654">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8478661">import</span>&nbsp;<span class="op" id="8478668">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8478671">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8478682">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8478692">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8478695">type</span>&nbsp;<span class="ident" id="8478700">T</span>&nbsp;<span class="builtintype" id="8478702">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8478707">func</span>&nbsp;<span class="op" id="8478712">(</span><span class="ident" id="8478713">t</span>&nbsp;<span class="op" id="8478715">*</span><span class="ident" id="8478716">T</span><span class="op" id="8478717">)</span>&nbsp;<span class="ident" id="8478719">ptrmethod</span><span class="op" id="8478728">(</span><span class="op" id="8478729">)</span>&nbsp;<span class="op" id="8478731">[</span><span class="op" id="8478732">]</span><span class="builtintype" id="8478733">byte</span>&nbsp;<span class="op" id="8478738">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478741">return</span>&nbsp;<span class="ident" id="8478748">Stack</span><span class="op" id="8478753">(</span><span class="op" id="8478754">)</span><br>
<span class="lineno"></span><span class="op" id="8478756">}</span><br>
<span class="lineno"></span><span class="keyword" id="8478758">func</span>&nbsp;<span class="op" id="8478763">(</span><span class="ident" id="8478764">t</span>&nbsp;<span class="ident" id="8478766">T</span><span class="op" id="8478767">)</span>&nbsp;<span class="ident" id="8478769">method</span><span class="op" id="8478775">(</span><span class="op" id="8478776">)</span>&nbsp;<span class="op" id="8478778">[</span><span class="op" id="8478779">]</span><span class="builtintype" id="8478780">byte</span>&nbsp;<span class="op" id="8478785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478788">return</span>&nbsp;<span class="ident" id="8478795">t</span><span class="op" id="8478796">.</span><span class="ident" id="8478797">ptrmethod</span><span class="op" id="8478806">(</span><span class="op" id="8478807">)</span><br>
<span class="lineno"></span><span class="op" id="8478809">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="8478812">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;traceback&nbsp;should&nbsp;look&nbsp;something&nbsp;like&nbsp;this,&nbsp;modulo&nbsp;line&nbsp;numbers&nbsp;and&nbsp;hex&nbsp;constants.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspDon&#39;t&nbsp;worry&nbsp;much&nbsp;about&nbsp;the&nbsp;base&nbsp;levels,&nbsp;but&nbsp;check&nbsp;the&nbsp;ones&nbsp;in&nbsp;our&nbsp;own&nbsp;package.<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:15&nbsp;(0x13878)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(*T).ptrmethod:&nbsp;return&nbsp;Stack()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:18&nbsp;(0x138dd)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspT.method:&nbsp;return&nbsp;t.ptrmethod()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:23&nbsp;(0x13920)<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/testing/testing.go:132&nbsp;(0x14a7a)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptRunner:&nbsp;test.F(t)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/proc.c:145&nbsp;(0xc970)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp???:&nbsp;runtime·unlock(&amp;runtime·sched);<br>
<span class="lineno">35</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="8479425">func</span>&nbsp;<span class="ident" id="8479430">TestStack</span><span class="op" id="8479439">(</span><span class="ident" id="8479440">t</span>&nbsp;<span class="op" id="8479442">*</span><span class="ident" id="8479443">testing</span><span class="op" id="8479450">.</span><span class="ident" id="8479451">T</span><span class="op" id="8479452">)</span>&nbsp;<span class="op" id="8479454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479457">b</span>&nbsp;<span class="op" id="8479459">:=</span>&nbsp;<span class="ident" id="8479462">T</span><span class="op" id="8479463">(</span><span class="num" id="8479464">0</span><span class="op" id="8479465">)</span><span class="op" id="8479466">.</span><span class="ident" id="8479467">method</span><span class="op" id="8479473">(</span><span class="op" id="8479474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479477">lines</span>&nbsp;<span class="op" id="8479483">:=</span>&nbsp;<span class="ident" id="8479486">strings</span><span class="op" id="8479493">.</span><span class="ident" id="8479494">Split</span><span class="op" id="8479499">(</span><span class="builtintype" id="8479500">string</span><span class="op" id="8479506">(</span><span class="ident" id="8479507">b</span><span class="op" id="8479508">)</span><span class="op" id="8479509">,</span>&nbsp;<span class="string" id="8479511">&#34;\n&#34;</span><span class="op" id="8479515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8479518">if</span>&nbsp;<span class="builtinfunc" id="8479521">len</span><span class="op" id="8479524">(</span><span class="ident" id="8479525">lines</span><span class="op" id="8479530">)</span>&nbsp;<span class="op" id="8479532">&lt;</span>&nbsp;<span class="num" id="8479534">6</span>&nbsp;<span class="op" id="8479536">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479540">t</span><span class="op" id="8479541">.</span><span class="ident" id="8479542">Fatal</span><span class="op" id="8479547">(</span><span class="string" id="8479548">&#34;too&nbsp;few&nbsp;lines&#34;</span><span class="op" id="8479563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8479566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479569">n</span>&nbsp;<span class="op" id="8479571">:=</span>&nbsp;<span class="num" id="8479574">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479577">frame</span>&nbsp;<span class="op" id="8479583">:=</span>&nbsp;<span class="keyword" id="8479586">func</span><span class="op" id="8479590">(</span><span class="ident" id="8479591">line</span><span class="op" id="8479595">,</span>&nbsp;<span class="ident" id="8479597">code</span>&nbsp;<span class="builtintype" id="8479602">string</span><span class="op" id="8479608">)</span>&nbsp;<span class="op" id="8479610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479614">check</span><span class="op" id="8479619">(</span><span class="ident" id="8479620">t</span><span class="op" id="8479621">,</span>&nbsp;<span class="ident" id="8479623">lines</span><span class="op" id="8479628">[</span><span class="ident" id="8479629">n</span><span class="op" id="8479630">]</span><span class="op" id="8479631">,</span>&nbsp;<span class="ident" id="8479633">line</span><span class="op" id="8479637">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479641">n</span><span class="op" id="8479642">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8479647">//&nbsp;The&nbsp;source&nbsp;might&nbsp;not&nbsp;be&nbsp;available&nbsp;while&nbsp;running&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8479710">if</span>&nbsp;<span class="ident" id="8479713">strings</span><span class="op" id="8479720">.</span><span class="ident" id="8479721">HasPrefix</span><span class="op" id="8479730">(</span><span class="ident" id="8479731">lines</span><span class="op" id="8479736">[</span><span class="ident" id="8479737">n</span><span class="op" id="8479738">]</span><span class="op" id="8479739">,</span>&nbsp;<span class="string" id="8479741">&#34;\t&#34;</span><span class="op" id="8479745">)</span>&nbsp;<span class="op" id="8479747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479752">check</span><span class="op" id="8479757">(</span><span class="ident" id="8479758">t</span><span class="op" id="8479759">,</span>&nbsp;<span class="ident" id="8479761">lines</span><span class="op" id="8479766">[</span><span class="ident" id="8479767">n</span><span class="op" id="8479768">]</span><span class="op" id="8479769">,</span>&nbsp;<span class="ident" id="8479771">code</span><span class="op" id="8479775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479780">n</span><span class="op" id="8479781">++</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8479786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8479789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479792">frame</span><span class="op" id="8479797">(</span><span class="string" id="8479798">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8479831">,</span>&nbsp;<span class="string" id="8479833">&#34;\t(*T).ptrmethod:&nbsp;return&nbsp;Stack()&#34;</span><span class="op" id="8479867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479870">frame</span><span class="op" id="8479875">(</span><span class="string" id="8479876">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8479909">,</span>&nbsp;<span class="string" id="8479911">&#34;\tT.method:&nbsp;return&nbsp;t.ptrmethod()&#34;</span><span class="op" id="8479945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479948">frame</span><span class="op" id="8479953">(</span><span class="string" id="8479954">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8479987">,</span>&nbsp;<span class="string" id="8479989">&#34;\tTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()&#34;</span><span class="op" id="8480022">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480025">frame</span><span class="op" id="8480030">(</span><span class="string" id="8480031">&#34;src/testing/testing.go&#34;</span><span class="op" id="8480055">,</span>&nbsp;<span class="string" id="8480057">&#34;&#34;</span><span class="op" id="8480059">)</span><br>
<span class="lineno"></span><span class="op" id="8480061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8480064">func</span>&nbsp;<span class="ident" id="8480069">check</span><span class="op" id="8480074">(</span><span class="ident" id="8480075">t</span>&nbsp;<span class="op" id="8480077">*</span><span class="ident" id="8480078">testing</span><span class="op" id="8480085">.</span><span class="ident" id="8480086">T</span><span class="op" id="8480087">,</span>&nbsp;<span class="ident" id="8480089">line</span><span class="op" id="8480093">,</span>&nbsp;<span class="ident" id="8480095">has</span>&nbsp;<span class="builtintype" id="8480099">string</span><span class="op" id="8480105">)</span>&nbsp;<span class="op" id="8480107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8480110">if</span>&nbsp;<span class="ident" id="8480113">strings</span><span class="op" id="8480120">.</span><span class="ident" id="8480121">Index</span><span class="op" id="8480126">(</span><span class="ident" id="8480127">line</span><span class="op" id="8480131">,</span>&nbsp;<span class="ident" id="8480133">has</span><span class="op" id="8480136">)</span>&nbsp;<span class="op" id="8480138">&lt;</span>&nbsp;<span class="num" id="8480140">0</span>&nbsp;<span class="op" id="8480142">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480146">t</span><span class="op" id="8480147">.</span><span class="ident" id="8480148">Errorf</span><span class="op" id="8480154">(</span><span class="string" id="8480155">&#34;expected&nbsp;%q&nbsp;in&nbsp;%q&#34;</span><span class="op" id="8480174">,</span>&nbsp;<span class="ident" id="8480176">has</span><span class="op" id="8480179">,</span>&nbsp;<span class="ident" id="8480181">line</span><span class="op" id="8480185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480188">}</span><br>
<span class="lineno"></span><span class="op" id="8480190">}</span>
</div>
</body>
</html>
