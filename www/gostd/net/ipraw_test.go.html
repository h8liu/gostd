<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8262404">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8262460">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8262514">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8262565">package</span>&nbsp;<span class="ident" id="8262573">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8262578">import</span>&nbsp;<span class="op" id="8262585">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8262588">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8262597">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8262604">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8262610">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8262621">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8262632">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8262643">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8262650">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8262653">type</span>&nbsp;<span class="ident" id="8262658">resolveIPAddrTest</span>&nbsp;<span class="keyword" id="8262676">struct</span>&nbsp;<span class="op" id="8262683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262686">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8262700">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262708">litAddrOrName</span>&nbsp;<span class="builtintype" id="8262722">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262730">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8262744">*</span><span class="ident" id="8262745">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262753">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8262767">error</span><br>
<span class="lineno"></span><span class="op" id="8262773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8262776">var</span>&nbsp;<span class="ident" id="8262780">resolveIPAddrTests</span>&nbsp;<span class="op" id="8262799">=</span>&nbsp;<span class="op" id="8262801">[</span><span class="op" id="8262802">]</span><span class="ident" id="8262803">resolveIPAddrTest</span><span class="op" id="8262820">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262823">{</span><span class="string" id="8262824">&#34;ip&#34;</span><span class="op" id="8262828">,</span>&nbsp;<span class="string" id="8262830">&#34;127.0.0.1&#34;</span><span class="op" id="8262841">,</span>&nbsp;<span class="op" id="8262843">&amp;</span><span class="ident" id="8262844">IPAddr</span><span class="op" id="8262850">{</span><span class="ident" id="8262851">IP</span><span class="op" id="8262853">:</span>&nbsp;<span class="ident" id="8262855">IPv4</span><span class="op" id="8262859">(</span><span class="num" id="8262860">127</span><span class="op" id="8262863">,</span>&nbsp;<span class="num" id="8262865">0</span><span class="op" id="8262866">,</span>&nbsp;<span class="num" id="8262868">0</span><span class="op" id="8262869">,</span>&nbsp;<span class="num" id="8262871">1</span><span class="op" id="8262872">)</span><span class="op" id="8262873">}</span><span class="op" id="8262874">,</span>&nbsp;<span class="ident" id="8262876">nil</span><span class="op" id="8262879">}</span><span class="op" id="8262880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262883">{</span><span class="string" id="8262884">&#34;ip4&#34;</span><span class="op" id="8262889">,</span>&nbsp;<span class="string" id="8262891">&#34;127.0.0.1&#34;</span><span class="op" id="8262902">,</span>&nbsp;<span class="op" id="8262904">&amp;</span><span class="ident" id="8262905">IPAddr</span><span class="op" id="8262911">{</span><span class="ident" id="8262912">IP</span><span class="op" id="8262914">:</span>&nbsp;<span class="ident" id="8262916">IPv4</span><span class="op" id="8262920">(</span><span class="num" id="8262921">127</span><span class="op" id="8262924">,</span>&nbsp;<span class="num" id="8262926">0</span><span class="op" id="8262927">,</span>&nbsp;<span class="num" id="8262929">0</span><span class="op" id="8262930">,</span>&nbsp;<span class="num" id="8262932">1</span><span class="op" id="8262933">)</span><span class="op" id="8262934">}</span><span class="op" id="8262935">,</span>&nbsp;<span class="ident" id="8262937">nil</span><span class="op" id="8262940">}</span><span class="op" id="8262941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262944">{</span><span class="string" id="8262945">&#34;ip4:icmp&#34;</span><span class="op" id="8262955">,</span>&nbsp;<span class="string" id="8262957">&#34;127.0.0.1&#34;</span><span class="op" id="8262968">,</span>&nbsp;<span class="op" id="8262970">&amp;</span><span class="ident" id="8262971">IPAddr</span><span class="op" id="8262977">{</span><span class="ident" id="8262978">IP</span><span class="op" id="8262980">:</span>&nbsp;<span class="ident" id="8262982">IPv4</span><span class="op" id="8262986">(</span><span class="num" id="8262987">127</span><span class="op" id="8262990">,</span>&nbsp;<span class="num" id="8262992">0</span><span class="op" id="8262993">,</span>&nbsp;<span class="num" id="8262995">0</span><span class="op" id="8262996">,</span>&nbsp;<span class="num" id="8262998">1</span><span class="op" id="8262999">)</span><span class="op" id="8263000">}</span><span class="op" id="8263001">,</span>&nbsp;<span class="ident" id="8263003">nil</span><span class="op" id="8263006">}</span><span class="op" id="8263007">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263011">{</span><span class="string" id="8263012">&#34;ip&#34;</span><span class="op" id="8263016">,</span>&nbsp;<span class="string" id="8263018">&#34;::1&#34;</span><span class="op" id="8263023">,</span>&nbsp;<span class="op" id="8263025">&amp;</span><span class="ident" id="8263026">IPAddr</span><span class="op" id="8263032">{</span><span class="ident" id="8263033">IP</span><span class="op" id="8263035">:</span>&nbsp;<span class="ident" id="8263037">ParseIP</span><span class="op" id="8263044">(</span><span class="string" id="8263045">&#34;::1&#34;</span><span class="op" id="8263050">)</span><span class="op" id="8263051">}</span><span class="op" id="8263052">,</span>&nbsp;<span class="ident" id="8263054">nil</span><span class="op" id="8263057">}</span><span class="op" id="8263058">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263061">{</span><span class="string" id="8263062">&#34;ip6&#34;</span><span class="op" id="8263067">,</span>&nbsp;<span class="string" id="8263069">&#34;::1&#34;</span><span class="op" id="8263074">,</span>&nbsp;<span class="op" id="8263076">&amp;</span><span class="ident" id="8263077">IPAddr</span><span class="op" id="8263083">{</span><span class="ident" id="8263084">IP</span><span class="op" id="8263086">:</span>&nbsp;<span class="ident" id="8263088">ParseIP</span><span class="op" id="8263095">(</span><span class="string" id="8263096">&#34;::1&#34;</span><span class="op" id="8263101">)</span><span class="op" id="8263102">}</span><span class="op" id="8263103">,</span>&nbsp;<span class="ident" id="8263105">nil</span><span class="op" id="8263108">}</span><span class="op" id="8263109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263112">{</span><span class="string" id="8263113">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="8263128">,</span>&nbsp;<span class="string" id="8263130">&#34;::1&#34;</span><span class="op" id="8263135">,</span>&nbsp;<span class="op" id="8263137">&amp;</span><span class="ident" id="8263138">IPAddr</span><span class="op" id="8263144">{</span><span class="ident" id="8263145">IP</span><span class="op" id="8263147">:</span>&nbsp;<span class="ident" id="8263149">ParseIP</span><span class="op" id="8263156">(</span><span class="string" id="8263157">&#34;::1&#34;</span><span class="op" id="8263162">)</span><span class="op" id="8263163">}</span><span class="op" id="8263164">,</span>&nbsp;<span class="ident" id="8263166">nil</span><span class="op" id="8263169">}</span><span class="op" id="8263170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263173">{</span><span class="string" id="8263174">&#34;ip6:IPv6-ICMP&#34;</span><span class="op" id="8263189">,</span>&nbsp;<span class="string" id="8263191">&#34;::1&#34;</span><span class="op" id="8263196">,</span>&nbsp;<span class="op" id="8263198">&amp;</span><span class="ident" id="8263199">IPAddr</span><span class="op" id="8263205">{</span><span class="ident" id="8263206">IP</span><span class="op" id="8263208">:</span>&nbsp;<span class="ident" id="8263210">ParseIP</span><span class="op" id="8263217">(</span><span class="string" id="8263218">&#34;::1&#34;</span><span class="op" id="8263223">)</span><span class="op" id="8263224">}</span><span class="op" id="8263225">,</span>&nbsp;<span class="ident" id="8263227">nil</span><span class="op" id="8263230">}</span><span class="op" id="8263231">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263235">{</span><span class="string" id="8263236">&#34;ip&#34;</span><span class="op" id="8263240">,</span>&nbsp;<span class="string" id="8263242">&#34;::1%en0&#34;</span><span class="op" id="8263251">,</span>&nbsp;<span class="op" id="8263253">&amp;</span><span class="ident" id="8263254">IPAddr</span><span class="op" id="8263260">{</span><span class="ident" id="8263261">IP</span><span class="op" id="8263263">:</span>&nbsp;<span class="ident" id="8263265">ParseIP</span><span class="op" id="8263272">(</span><span class="string" id="8263273">&#34;::1&#34;</span><span class="op" id="8263278">)</span><span class="op" id="8263279">,</span>&nbsp;<span class="ident" id="8263281">Zone</span><span class="op" id="8263285">:</span>&nbsp;<span class="string" id="8263287">&#34;en0&#34;</span><span class="op" id="8263292">}</span><span class="op" id="8263293">,</span>&nbsp;<span class="ident" id="8263295">nil</span><span class="op" id="8263298">}</span><span class="op" id="8263299">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263302">{</span><span class="string" id="8263303">&#34;ip6&#34;</span><span class="op" id="8263308">,</span>&nbsp;<span class="string" id="8263310">&#34;::1%911&#34;</span><span class="op" id="8263319">,</span>&nbsp;<span class="op" id="8263321">&amp;</span><span class="ident" id="8263322">IPAddr</span><span class="op" id="8263328">{</span><span class="ident" id="8263329">IP</span><span class="op" id="8263331">:</span>&nbsp;<span class="ident" id="8263333">ParseIP</span><span class="op" id="8263340">(</span><span class="string" id="8263341">&#34;::1&#34;</span><span class="op" id="8263346">)</span><span class="op" id="8263347">,</span>&nbsp;<span class="ident" id="8263349">Zone</span><span class="op" id="8263353">:</span>&nbsp;<span class="string" id="8263355">&#34;911&#34;</span><span class="op" id="8263360">}</span><span class="op" id="8263361">,</span>&nbsp;<span class="ident" id="8263363">nil</span><span class="op" id="8263366">}</span><span class="op" id="8263367">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263371">{</span><span class="string" id="8263372">&#34;&#34;</span><span class="op" id="8263374">,</span>&nbsp;<span class="string" id="8263376">&#34;127.0.0.1&#34;</span><span class="op" id="8263387">,</span>&nbsp;<span class="op" id="8263389">&amp;</span><span class="ident" id="8263390">IPAddr</span><span class="op" id="8263396">{</span><span class="ident" id="8263397">IP</span><span class="op" id="8263399">:</span>&nbsp;<span class="ident" id="8263401">IPv4</span><span class="op" id="8263405">(</span><span class="num" id="8263406">127</span><span class="op" id="8263409">,</span>&nbsp;<span class="num" id="8263411">0</span><span class="op" id="8263412">,</span>&nbsp;<span class="num" id="8263414">0</span><span class="op" id="8263415">,</span>&nbsp;<span class="num" id="8263417">1</span><span class="op" id="8263418">)</span><span class="op" id="8263419">}</span><span class="op" id="8263420">,</span>&nbsp;<span class="ident" id="8263422">nil</span><span class="op" id="8263425">}</span><span class="op" id="8263426">,</span>&nbsp;<span class="comment" id="8263428">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263448">{</span><span class="string" id="8263449">&#34;&#34;</span><span class="op" id="8263451">,</span>&nbsp;<span class="string" id="8263453">&#34;::1&#34;</span><span class="op" id="8263458">,</span>&nbsp;<span class="op" id="8263460">&amp;</span><span class="ident" id="8263461">IPAddr</span><span class="op" id="8263467">{</span><span class="ident" id="8263468">IP</span><span class="op" id="8263470">:</span>&nbsp;<span class="ident" id="8263472">ParseIP</span><span class="op" id="8263479">(</span><span class="string" id="8263480">&#34;::1&#34;</span><span class="op" id="8263485">)</span><span class="op" id="8263486">}</span><span class="op" id="8263487">,</span>&nbsp;<span class="ident" id="8263489">nil</span><span class="op" id="8263492">}</span><span class="op" id="8263493">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8263505">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263526">{</span><span class="string" id="8263527">&#34;l2tp&#34;</span><span class="op" id="8263533">,</span>&nbsp;<span class="string" id="8263535">&#34;127.0.0.1&#34;</span><span class="op" id="8263546">,</span>&nbsp;<span class="ident" id="8263548">nil</span><span class="op" id="8263551">,</span>&nbsp;<span class="ident" id="8263553">UnknownNetworkError</span><span class="op" id="8263572">(</span><span class="string" id="8263573">&#34;l2tp&#34;</span><span class="op" id="8263579">)</span><span class="op" id="8263580">}</span><span class="op" id="8263581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263584">{</span><span class="string" id="8263585">&#34;l2tp:gre&#34;</span><span class="op" id="8263595">,</span>&nbsp;<span class="string" id="8263597">&#34;127.0.0.1&#34;</span><span class="op" id="8263608">,</span>&nbsp;<span class="ident" id="8263610">nil</span><span class="op" id="8263613">,</span>&nbsp;<span class="ident" id="8263615">UnknownNetworkError</span><span class="op" id="8263634">(</span><span class="string" id="8263635">&#34;l2tp:gre&#34;</span><span class="op" id="8263645">)</span><span class="op" id="8263646">}</span><span class="op" id="8263647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263650">{</span><span class="string" id="8263651">&#34;tcp&#34;</span><span class="op" id="8263656">,</span>&nbsp;<span class="string" id="8263658">&#34;1.2.3.4:123&#34;</span><span class="op" id="8263671">,</span>&nbsp;<span class="ident" id="8263673">nil</span><span class="op" id="8263676">,</span>&nbsp;<span class="ident" id="8263678">UnknownNetworkError</span><span class="op" id="8263697">(</span><span class="string" id="8263698">&#34;tcp&#34;</span><span class="op" id="8263703">)</span><span class="op" id="8263704">}</span><span class="op" id="8263705">,</span><br>
<span class="lineno"></span><span class="op" id="8263707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="8263710">func</span>&nbsp;<span class="ident" id="8263715">init</span><span class="op" id="8263719">(</span><span class="op" id="8263720">)</span>&nbsp;<span class="op" id="8263722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8263725">if</span>&nbsp;<span class="ident" id="8263728">ifi</span>&nbsp;<span class="op" id="8263732">:=</span>&nbsp;<span class="ident" id="8263735">loopbackInterface</span><span class="op" id="8263752">(</span><span class="op" id="8263753">)</span><span class="op" id="8263754">;</span>&nbsp;<span class="ident" id="8263756">ifi</span>&nbsp;<span class="op" id="8263760">!=</span>&nbsp;<span class="ident" id="8263763">nil</span>&nbsp;<span class="op" id="8263767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263771">index</span>&nbsp;<span class="op" id="8263777">:=</span>&nbsp;<span class="ident" id="8263780">fmt</span><span class="op" id="8263783">.</span><span class="ident" id="8263784">Sprintf</span><span class="op" id="8263791">(</span><span class="string" id="8263792">&#34;%v&#34;</span><span class="op" id="8263796">,</span>&nbsp;<span class="ident" id="8263798">ifi</span><span class="op" id="8263801">.</span><span class="ident" id="8263802">Index</span><span class="op" id="8263807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263811">resolveIPAddrTests</span>&nbsp;<span class="op" id="8263830">=</span>&nbsp;<span class="builtinfunc" id="8263832">append</span><span class="op" id="8263838">(</span><span class="ident" id="8263839">resolveIPAddrTests</span><span class="op" id="8263857">,</span>&nbsp;<span class="op" id="8263859">[</span><span class="op" id="8263860">]</span><span class="ident" id="8263861">resolveIPAddrTest</span><span class="op" id="8263878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263883">{</span><span class="string" id="8263884">&#34;ip6&#34;</span><span class="op" id="8263889">,</span>&nbsp;<span class="string" id="8263891">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="8263902">+</span>&nbsp;<span class="ident" id="8263904">ifi</span><span class="op" id="8263907">.</span><span class="ident" id="8263908">Name</span><span class="op" id="8263912">,</span>&nbsp;<span class="op" id="8263914">&amp;</span><span class="ident" id="8263915">IPAddr</span><span class="op" id="8263921">{</span><span class="ident" id="8263922">IP</span><span class="op" id="8263924">:</span>&nbsp;<span class="ident" id="8263926">ParseIP</span><span class="op" id="8263933">(</span><span class="string" id="8263934">&#34;fe80::1&#34;</span><span class="op" id="8263943">)</span><span class="op" id="8263944">,</span>&nbsp;<span class="ident" id="8263946">Zone</span><span class="op" id="8263950">:</span>&nbsp;<span class="ident" id="8263952">zoneToString</span><span class="op" id="8263964">(</span><span class="ident" id="8263965">ifi</span><span class="op" id="8263968">.</span><span class="ident" id="8263969">Index</span><span class="op" id="8263974">)</span><span class="op" id="8263975">}</span><span class="op" id="8263976">,</span>&nbsp;<span class="ident" id="8263978">nil</span><span class="op" id="8263981">}</span><span class="op" id="8263982">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263987">{</span><span class="string" id="8263988">&#34;ip6&#34;</span><span class="op" id="8263993">,</span>&nbsp;<span class="string" id="8263995">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="8264006">+</span>&nbsp;<span class="ident" id="8264008">index</span><span class="op" id="8264013">,</span>&nbsp;<span class="op" id="8264015">&amp;</span><span class="ident" id="8264016">IPAddr</span><span class="op" id="8264022">{</span><span class="ident" id="8264023">IP</span><span class="op" id="8264025">:</span>&nbsp;<span class="ident" id="8264027">ParseIP</span><span class="op" id="8264034">(</span><span class="string" id="8264035">&#34;fe80::1&#34;</span><span class="op" id="8264044">)</span><span class="op" id="8264045">,</span>&nbsp;<span class="ident" id="8264047">Zone</span><span class="op" id="8264051">:</span>&nbsp;<span class="ident" id="8264053">index</span><span class="op" id="8264058">}</span><span class="op" id="8264059">,</span>&nbsp;<span class="ident" id="8264061">nil</span><span class="op" id="8264064">}</span><span class="op" id="8264065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264069">}</span><span class="op" id="8264070">...</span><span class="op" id="8264073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264079">if</span>&nbsp;<span class="ident" id="8264082">ips</span><span class="op" id="8264085">,</span>&nbsp;<span class="ident" id="8264087">err</span>&nbsp;<span class="op" id="8264091">:=</span>&nbsp;<span class="ident" id="8264094">LookupIP</span><span class="op" id="8264102">(</span><span class="string" id="8264103">&#34;localhost&#34;</span><span class="op" id="8264114">)</span><span class="op" id="8264115">;</span>&nbsp;<span class="ident" id="8264117">err</span>&nbsp;<span class="op" id="8264121">==</span>&nbsp;<span class="ident" id="8264124">nil</span>&nbsp;<span class="op" id="8264128">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="8264131">len</span><span class="op" id="8264134">(</span><span class="ident" id="8264135">ips</span><span class="op" id="8264138">)</span>&nbsp;<span class="op" id="8264140">&gt;</span>&nbsp;<span class="num" id="8264142">1</span>&nbsp;<span class="op" id="8264144">&amp;&amp;</span>&nbsp;<span class="ident" id="8264147">supportsIPv4</span>&nbsp;<span class="op" id="8264160">&amp;&amp;</span>&nbsp;<span class="ident" id="8264163">supportsIPv6</span>&nbsp;<span class="op" id="8264176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264180">resolveIPAddrTests</span>&nbsp;<span class="op" id="8264199">=</span>&nbsp;<span class="builtinfunc" id="8264201">append</span><span class="op" id="8264207">(</span><span class="ident" id="8264208">resolveIPAddrTests</span><span class="op" id="8264226">,</span>&nbsp;<span class="op" id="8264228">[</span><span class="op" id="8264229">]</span><span class="ident" id="8264230">resolveIPAddrTest</span><span class="op" id="8264247">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264252">{</span><span class="string" id="8264253">&#34;ip&#34;</span><span class="op" id="8264257">,</span>&nbsp;<span class="string" id="8264259">&#34;localhost&#34;</span><span class="op" id="8264270">,</span>&nbsp;<span class="op" id="8264272">&amp;</span><span class="ident" id="8264273">IPAddr</span><span class="op" id="8264279">{</span><span class="ident" id="8264280">IP</span><span class="op" id="8264282">:</span>&nbsp;<span class="ident" id="8264284">IPv4</span><span class="op" id="8264288">(</span><span class="num" id="8264289">127</span><span class="op" id="8264292">,</span>&nbsp;<span class="num" id="8264294">0</span><span class="op" id="8264295">,</span>&nbsp;<span class="num" id="8264297">0</span><span class="op" id="8264298">,</span>&nbsp;<span class="num" id="8264300">1</span><span class="op" id="8264301">)</span><span class="op" id="8264302">}</span><span class="op" id="8264303">,</span>&nbsp;<span class="ident" id="8264305">nil</span><span class="op" id="8264308">}</span><span class="op" id="8264309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264314">{</span><span class="string" id="8264315">&#34;ip4&#34;</span><span class="op" id="8264320">,</span>&nbsp;<span class="string" id="8264322">&#34;localhost&#34;</span><span class="op" id="8264333">,</span>&nbsp;<span class="op" id="8264335">&amp;</span><span class="ident" id="8264336">IPAddr</span><span class="op" id="8264342">{</span><span class="ident" id="8264343">IP</span><span class="op" id="8264345">:</span>&nbsp;<span class="ident" id="8264347">IPv4</span><span class="op" id="8264351">(</span><span class="num" id="8264352">127</span><span class="op" id="8264355">,</span>&nbsp;<span class="num" id="8264357">0</span><span class="op" id="8264358">,</span>&nbsp;<span class="num" id="8264360">0</span><span class="op" id="8264361">,</span>&nbsp;<span class="num" id="8264363">1</span><span class="op" id="8264364">)</span><span class="op" id="8264365">}</span><span class="op" id="8264366">,</span>&nbsp;<span class="ident" id="8264368">nil</span><span class="op" id="8264371">}</span><span class="op" id="8264372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264377">{</span><span class="string" id="8264378">&#34;ip6&#34;</span><span class="op" id="8264383">,</span>&nbsp;<span class="string" id="8264385">&#34;localhost&#34;</span><span class="op" id="8264396">,</span>&nbsp;<span class="op" id="8264398">&amp;</span><span class="ident" id="8264399">IPAddr</span><span class="op" id="8264405">{</span><span class="ident" id="8264406">IP</span><span class="op" id="8264408">:</span>&nbsp;<span class="ident" id="8264410">IPv6loopback</span><span class="op" id="8264422">}</span><span class="op" id="8264423">,</span>&nbsp;<span class="ident" id="8264425">nil</span><span class="op" id="8264428">}</span><span class="op" id="8264429">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264433">}</span><span class="op" id="8264434">...</span><span class="op" id="8264437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264440">}</span><br>
<span class="lineno">60</span><span class="op" id="8264442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8264445">func</span>&nbsp;<span class="ident" id="8264450">skipRawSocketTest</span><span class="op" id="8264467">(</span><span class="ident" id="8264468">t</span>&nbsp;<span class="op" id="8264470">*</span><span class="ident" id="8264471">testing</span><span class="op" id="8264478">.</span><span class="ident" id="8264479">T</span><span class="op" id="8264480">)</span>&nbsp;<span class="op" id="8264482">(</span><span class="ident" id="8264483">skip</span>&nbsp;<span class="builtintype" id="8264488">bool</span><span class="op" id="8264492">,</span>&nbsp;<span class="ident" id="8264494">skipmsg</span>&nbsp;<span class="builtintype" id="8264502">string</span><span class="op" id="8264508">)</span>&nbsp;<span class="op" id="8264510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264513">skip</span><span class="op" id="8264517">,</span>&nbsp;<span class="ident" id="8264519">skipmsg</span><span class="op" id="8264526">,</span>&nbsp;<span class="ident" id="8264528">err</span>&nbsp;<span class="op" id="8264532">:=</span>&nbsp;<span class="ident" id="8264535">skipRawSocketTests</span><span class="op" id="8264553">(</span><span class="op" id="8264554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264557">if</span>&nbsp;<span class="ident" id="8264560">err</span>&nbsp;<span class="op" id="8264564">!=</span>&nbsp;<span class="ident" id="8264567">nil</span>&nbsp;<span class="op" id="8264571">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264575">t</span><span class="op" id="8264576">.</span><span class="ident" id="8264577">Fatal</span><span class="op" id="8264582">(</span><span class="ident" id="8264583">err</span><span class="op" id="8264586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264592">return</span>&nbsp;<span class="ident" id="8264599">skip</span><span class="op" id="8264603">,</span>&nbsp;<span class="ident" id="8264605">skipmsg</span><br>
<span class="lineno"></span><span class="op" id="8264613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="8264616">func</span>&nbsp;<span class="ident" id="8264621">TestResolveIPAddr</span><span class="op" id="8264638">(</span><span class="ident" id="8264639">t</span>&nbsp;<span class="op" id="8264641">*</span><span class="ident" id="8264642">testing</span><span class="op" id="8264649">.</span><span class="ident" id="8264650">T</span><span class="op" id="8264651">)</span>&nbsp;<span class="op" id="8264653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264656">switch</span>&nbsp;<span class="ident" id="8264663">runtime</span><span class="op" id="8264670">.</span><span class="ident" id="8264671">GOOS</span>&nbsp;<span class="op" id="8264676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264679">case</span>&nbsp;<span class="string" id="8264684">&#34;nacl&#34;</span><span class="op" id="8264690">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264694">t</span><span class="op" id="8264695">.</span><span class="ident" id="8264696">Skipf</span><span class="op" id="8264701">(</span><span class="string" id="8264702">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8264723">,</span>&nbsp;<span class="ident" id="8264725">runtime</span><span class="op" id="8264732">.</span><span class="ident" id="8264733">GOOS</span><span class="op" id="8264737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264740">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264744">for</span>&nbsp;<span class="ident" id="8264748">_</span><span class="op" id="8264749">,</span>&nbsp;<span class="ident" id="8264751">tt</span>&nbsp;<span class="op" id="8264754">:=</span>&nbsp;<span class="keyword" id="8264757">range</span>&nbsp;<span class="ident" id="8264763">resolveIPAddrTests</span>&nbsp;<span class="op" id="8264782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264786">addr</span><span class="op" id="8264790">,</span>&nbsp;<span class="ident" id="8264792">err</span>&nbsp;<span class="op" id="8264796">:=</span>&nbsp;<span class="ident" id="8264799">ResolveIPAddr</span><span class="op" id="8264812">(</span><span class="ident" id="8264813">tt</span><span class="op" id="8264815">.</span><span class="ident" id="8264816">net</span><span class="op" id="8264819">,</span>&nbsp;<span class="ident" id="8264821">tt</span><span class="op" id="8264823">.</span><span class="ident" id="8264824">litAddrOrName</span><span class="op" id="8264837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264841">if</span>&nbsp;<span class="ident" id="8264844">err</span>&nbsp;<span class="op" id="8264848">!=</span>&nbsp;<span class="ident" id="8264851">tt</span><span class="op" id="8264853">.</span><span class="ident" id="8264854">err</span>&nbsp;<span class="op" id="8264858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264863">t</span><span class="op" id="8264864">.</span><span class="ident" id="8264865">Fatalf</span><span class="op" id="8264871">(</span><span class="string" id="8264872">&#34;ResolveIPAddr(%v,&nbsp;%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8264906">,</span>&nbsp;<span class="ident" id="8264908">tt</span><span class="op" id="8264910">.</span><span class="ident" id="8264911">net</span><span class="op" id="8264914">,</span>&nbsp;<span class="ident" id="8264916">tt</span><span class="op" id="8264918">.</span><span class="ident" id="8264919">litAddrOrName</span><span class="op" id="8264932">,</span>&nbsp;<span class="ident" id="8264934">err</span><span class="op" id="8264937">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264941">}</span>&nbsp;<span class="keyword" id="8264943">else</span>&nbsp;<span class="keyword" id="8264948">if</span>&nbsp;<span class="op" id="8264951">!</span><span class="ident" id="8264952">reflect</span><span class="op" id="8264959">.</span><span class="ident" id="8264960">DeepEqual</span><span class="op" id="8264969">(</span><span class="ident" id="8264970">addr</span><span class="op" id="8264974">,</span>&nbsp;<span class="ident" id="8264976">tt</span><span class="op" id="8264978">.</span><span class="ident" id="8264979">addr</span><span class="op" id="8264983">)</span>&nbsp;<span class="op" id="8264985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264990">t</span><span class="op" id="8264991">.</span><span class="ident" id="8264992">Fatalf</span><span class="op" id="8264998">(</span><span class="string" id="8264999">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8265022">,</span>&nbsp;<span class="ident" id="8265024">addr</span><span class="op" id="8265028">,</span>&nbsp;<span class="ident" id="8265030">tt</span><span class="op" id="8265032">.</span><span class="ident" id="8265033">addr</span><span class="op" id="8265037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265044">}</span><br>
<span class="lineno"></span><span class="op" id="8265046">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="8265049">var</span>&nbsp;<span class="ident" id="8265053">icmpEchoTests</span>&nbsp;<span class="op" id="8265067">=</span>&nbsp;<span class="op" id="8265069">[</span><span class="op" id="8265070">]</span><span class="keyword" id="8265071">struct</span>&nbsp;<span class="op" id="8265078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265081">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8265087">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265095">laddr</span>&nbsp;<span class="builtintype" id="8265101">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265109">raddr</span>&nbsp;<span class="builtintype" id="8265115">string</span><br>
<span class="lineno">90</span><span class="op" id="8265122">}</span><span class="op" id="8265123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265126">{</span><span class="string" id="8265127">&#34;ip4:icmp&#34;</span><span class="op" id="8265137">,</span>&nbsp;<span class="string" id="8265139">&#34;0.0.0.0&#34;</span><span class="op" id="8265148">,</span>&nbsp;<span class="string" id="8265150">&#34;127.0.0.1&#34;</span><span class="op" id="8265161">}</span><span class="op" id="8265162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265165">{</span><span class="string" id="8265166">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="8265181">,</span>&nbsp;<span class="string" id="8265183">&#34;::&#34;</span><span class="op" id="8265187">,</span>&nbsp;<span class="string" id="8265189">&#34;::1&#34;</span><span class="op" id="8265194">}</span><span class="op" id="8265195">,</span><br>
<span class="lineno"></span><span class="op" id="8265197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="8265200">func</span>&nbsp;<span class="ident" id="8265205">TestConnICMPEcho</span><span class="op" id="8265221">(</span><span class="ident" id="8265222">t</span>&nbsp;<span class="op" id="8265224">*</span><span class="ident" id="8265225">testing</span><span class="op" id="8265232">.</span><span class="ident" id="8265233">T</span><span class="op" id="8265234">)</span>&nbsp;<span class="op" id="8265236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265239">if</span>&nbsp;<span class="ident" id="8265242">skip</span><span class="op" id="8265246">,</span>&nbsp;<span class="ident" id="8265248">skipmsg</span>&nbsp;<span class="op" id="8265256">:=</span>&nbsp;<span class="ident" id="8265259">skipRawSocketTest</span><span class="op" id="8265276">(</span><span class="ident" id="8265277">t</span><span class="op" id="8265278">)</span><span class="op" id="8265279">;</span>&nbsp;<span class="ident" id="8265281">skip</span>&nbsp;<span class="op" id="8265286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265290">t</span><span class="op" id="8265291">.</span><span class="ident" id="8265292">Skip</span><span class="op" id="8265296">(</span><span class="ident" id="8265297">skipmsg</span><span class="op" id="8265304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265311">for</span>&nbsp;<span class="ident" id="8265315">i</span><span class="op" id="8265316">,</span>&nbsp;<span class="ident" id="8265318">tt</span>&nbsp;<span class="op" id="8265321">:=</span>&nbsp;<span class="keyword" id="8265324">range</span>&nbsp;<span class="ident" id="8265330">icmpEchoTests</span>&nbsp;<span class="op" id="8265344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265348">net</span><span class="op" id="8265351">,</span>&nbsp;<span class="ident" id="8265353">_</span><span class="op" id="8265354">,</span>&nbsp;<span class="ident" id="8265356">err</span>&nbsp;<span class="op" id="8265360">:=</span>&nbsp;<span class="ident" id="8265363">parseNetwork</span><span class="op" id="8265375">(</span><span class="ident" id="8265376">tt</span><span class="op" id="8265378">.</span><span class="ident" id="8265379">net</span><span class="op" id="8265382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265386">if</span>&nbsp;<span class="ident" id="8265389">err</span>&nbsp;<span class="op" id="8265393">!=</span>&nbsp;<span class="ident" id="8265396">nil</span>&nbsp;<span class="op" id="8265400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265405">t</span><span class="op" id="8265406">.</span><span class="ident" id="8265407">Fatalf</span><span class="op" id="8265413">(</span><span class="string" id="8265414">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8265439">,</span>&nbsp;<span class="ident" id="8265441">err</span><span class="op" id="8265444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265448">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265452">if</span>&nbsp;<span class="ident" id="8265455">net</span>&nbsp;<span class="op" id="8265459">==</span>&nbsp;<span class="string" id="8265462">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8265468">&amp;&amp;</span>&nbsp;<span class="op" id="8265471">!</span><span class="ident" id="8265472">supportsIPv6</span>&nbsp;<span class="op" id="8265485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265490">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265506">c</span><span class="op" id="8265507">,</span>&nbsp;<span class="ident" id="8265509">err</span>&nbsp;<span class="op" id="8265513">:=</span>&nbsp;<span class="ident" id="8265516">Dial</span><span class="op" id="8265520">(</span><span class="ident" id="8265521">tt</span><span class="op" id="8265523">.</span><span class="ident" id="8265524">net</span><span class="op" id="8265527">,</span>&nbsp;<span class="ident" id="8265529">tt</span><span class="op" id="8265531">.</span><span class="ident" id="8265532">raddr</span><span class="op" id="8265537">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265541">if</span>&nbsp;<span class="ident" id="8265544">err</span>&nbsp;<span class="op" id="8265548">!=</span>&nbsp;<span class="ident" id="8265551">nil</span>&nbsp;<span class="op" id="8265555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265560">t</span><span class="op" id="8265561">.</span><span class="ident" id="8265562">Fatalf</span><span class="op" id="8265568">(</span><span class="string" id="8265569">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8265586">,</span>&nbsp;<span class="ident" id="8265588">err</span><span class="op" id="8265591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265599">c</span><span class="op" id="8265600">.</span><span class="ident" id="8265601">SetDeadline</span><span class="op" id="8265612">(</span><span class="ident" id="8265613">time</span><span class="op" id="8265617">.</span><span class="ident" id="8265618">Now</span><span class="op" id="8265621">(</span><span class="op" id="8265622">)</span><span class="op" id="8265623">.</span><span class="ident" id="8265624">Add</span><span class="op" id="8265627">(</span><span class="num" id="8265628">100</span>&nbsp;<span class="op" id="8265632">*</span>&nbsp;<span class="ident" id="8265634">time</span><span class="op" id="8265638">.</span><span class="ident" id="8265639">Millisecond</span><span class="op" id="8265650">)</span><span class="op" id="8265651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265655">defer</span>&nbsp;<span class="ident" id="8265661">c</span><span class="op" id="8265662">.</span><span class="ident" id="8265663">Close</span><span class="op" id="8265668">(</span><span class="op" id="8265669">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265674">typ</span>&nbsp;<span class="op" id="8265678">:=</span>&nbsp;<span class="ident" id="8265681">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265701">if</span>&nbsp;<span class="ident" id="8265704">net</span>&nbsp;<span class="op" id="8265708">==</span>&nbsp;<span class="string" id="8265711">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8265717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265722">typ</span>&nbsp;<span class="op" id="8265726">=</span>&nbsp;<span class="ident" id="8265728">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265748">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265752">xid</span><span class="op" id="8265755">,</span>&nbsp;<span class="ident" id="8265757">xseq</span>&nbsp;<span class="op" id="8265762">:=</span>&nbsp;<span class="ident" id="8265765">os</span><span class="op" id="8265767">.</span><span class="ident" id="8265768">Getpid</span><span class="op" id="8265774">(</span><span class="op" id="8265775">)</span><span class="op" id="8265776">&amp;</span><span class="num" id="8265777">0xffff</span><span class="op" id="8265783">,</span>&nbsp;<span class="ident" id="8265785">i</span><span class="op" id="8265786">+</span><span class="num" id="8265787">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265791">wb</span><span class="op" id="8265793">,</span>&nbsp;<span class="ident" id="8265795">err</span>&nbsp;<span class="op" id="8265799">:=</span>&nbsp;<span class="op" id="8265802">(</span><span class="op" id="8265803">&amp;</span><span class="ident" id="8265804">icmpMessage</span><span class="op" id="8265815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265820">Type</span><span class="op" id="8265824">:</span>&nbsp;<span class="ident" id="8265826">typ</span><span class="op" id="8265829">,</span>&nbsp;<span class="ident" id="8265831">Code</span><span class="op" id="8265835">:</span>&nbsp;<span class="num" id="8265837">0</span><span class="op" id="8265838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265843">Body</span><span class="op" id="8265847">:</span>&nbsp;<span class="op" id="8265849">&amp;</span><span class="ident" id="8265850">icmpEcho</span><span class="op" id="8265858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265864">ID</span><span class="op" id="8265866">:</span>&nbsp;<span class="ident" id="8265868">xid</span><span class="op" id="8265871">,</span>&nbsp;<span class="ident" id="8265873">Seq</span><span class="op" id="8265876">:</span>&nbsp;<span class="ident" id="8265878">xseq</span><span class="op" id="8265882">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265888">Data</span><span class="op" id="8265892">:</span>&nbsp;<span class="ident" id="8265894">bytes</span><span class="op" id="8265899">.</span><span class="ident" id="8265900">Repeat</span><span class="op" id="8265906">(</span><span class="op" id="8265907">[</span><span class="op" id="8265908">]</span><span class="builtintype" id="8265909">byte</span><span class="op" id="8265913">(</span><span class="string" id="8265914">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="8265936">)</span><span class="op" id="8265937">,</span>&nbsp;<span class="num" id="8265939">3</span><span class="op" id="8265940">)</span><span class="op" id="8265941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265946">}</span><span class="op" id="8265947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265951">}</span><span class="op" id="8265952">)</span><span class="op" id="8265953">.</span><span class="ident" id="8265954">Marshal</span><span class="op" id="8265961">(</span><span class="op" id="8265962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265966">if</span>&nbsp;<span class="ident" id="8265969">err</span>&nbsp;<span class="op" id="8265973">!=</span>&nbsp;<span class="ident" id="8265976">nil</span>&nbsp;<span class="op" id="8265980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265985">t</span><span class="op" id="8265986">.</span><span class="ident" id="8265987">Fatalf</span><span class="op" id="8265993">(</span><span class="string" id="8265994">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8266026">,</span>&nbsp;<span class="ident" id="8266028">err</span><span class="op" id="8266031">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266039">if</span>&nbsp;<span class="ident" id="8266042">_</span><span class="op" id="8266043">,</span>&nbsp;<span class="ident" id="8266045">err</span>&nbsp;<span class="op" id="8266049">:=</span>&nbsp;<span class="ident" id="8266052">c</span><span class="op" id="8266053">.</span><span class="ident" id="8266054">Write</span><span class="op" id="8266059">(</span><span class="ident" id="8266060">wb</span><span class="op" id="8266062">)</span><span class="op" id="8266063">;</span>&nbsp;<span class="ident" id="8266065">err</span>&nbsp;<span class="op" id="8266069">!=</span>&nbsp;<span class="ident" id="8266072">nil</span>&nbsp;<span class="op" id="8266076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266081">t</span><span class="op" id="8266082">.</span><span class="ident" id="8266083">Fatalf</span><span class="op" id="8266089">(</span><span class="string" id="8266090">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8266113">,</span>&nbsp;<span class="ident" id="8266115">err</span><span class="op" id="8266118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266126">var</span>&nbsp;<span class="ident" id="8266130">m</span>&nbsp;<span class="op" id="8266132">*</span><span class="ident" id="8266133">icmpMessage</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266147">rb</span>&nbsp;<span class="op" id="8266150">:=</span>&nbsp;<span class="builtinfunc" id="8266153">make</span><span class="op" id="8266157">(</span><span class="op" id="8266158">[</span><span class="op" id="8266159">]</span><span class="builtintype" id="8266160">byte</span><span class="op" id="8266164">,</span>&nbsp;<span class="num" id="8266166">20</span><span class="op" id="8266168">+</span><span class="builtinfunc" id="8266169">len</span><span class="op" id="8266172">(</span><span class="ident" id="8266173">wb</span><span class="op" id="8266175">)</span><span class="op" id="8266176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266180">for</span>&nbsp;<span class="op" id="8266184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266189">if</span>&nbsp;<span class="ident" id="8266192">_</span><span class="op" id="8266193">,</span>&nbsp;<span class="ident" id="8266195">err</span>&nbsp;<span class="op" id="8266199">:=</span>&nbsp;<span class="ident" id="8266202">c</span><span class="op" id="8266203">.</span><span class="ident" id="8266204">Read</span><span class="op" id="8266208">(</span><span class="ident" id="8266209">rb</span><span class="op" id="8266211">)</span><span class="op" id="8266212">;</span>&nbsp;<span class="ident" id="8266214">err</span>&nbsp;<span class="op" id="8266218">!=</span>&nbsp;<span class="ident" id="8266221">nil</span>&nbsp;<span class="op" id="8266225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266231">t</span><span class="op" id="8266232">.</span><span class="ident" id="8266233">Fatalf</span><span class="op" id="8266239">(</span><span class="string" id="8266240">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8266262">,</span>&nbsp;<span class="ident" id="8266264">err</span><span class="op" id="8266267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266272">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266277">if</span>&nbsp;<span class="ident" id="8266280">net</span>&nbsp;<span class="op" id="8266284">==</span>&nbsp;<span class="string" id="8266287">&#34;ip4&#34;</span>&nbsp;<span class="op" id="8266293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266299">rb</span>&nbsp;<span class="op" id="8266302">=</span>&nbsp;<span class="ident" id="8266304">ipv4Payload</span><span class="op" id="8266315">(</span><span class="ident" id="8266316">rb</span><span class="op" id="8266318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266328">if</span>&nbsp;<span class="ident" id="8266331">m</span><span class="op" id="8266332">,</span>&nbsp;<span class="ident" id="8266334">err</span>&nbsp;<span class="op" id="8266338">=</span>&nbsp;<span class="ident" id="8266340">parseICMPMessage</span><span class="op" id="8266356">(</span><span class="ident" id="8266357">rb</span><span class="op" id="8266359">)</span><span class="op" id="8266360">;</span>&nbsp;<span class="ident" id="8266362">err</span>&nbsp;<span class="op" id="8266366">!=</span>&nbsp;<span class="ident" id="8266369">nil</span>&nbsp;<span class="op" id="8266373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266379">t</span><span class="op" id="8266380">.</span><span class="ident" id="8266381">Fatalf</span><span class="op" id="8266387">(</span><span class="string" id="8266388">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8266417">,</span>&nbsp;<span class="ident" id="8266419">err</span><span class="op" id="8266422">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266432">switch</span>&nbsp;<span class="ident" id="8266439">m</span><span class="op" id="8266440">.</span><span class="ident" id="8266441">Type</span>&nbsp;<span class="op" id="8266446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266451">case</span>&nbsp;<span class="ident" id="8266456">icmpv4EchoRequest</span><span class="op" id="8266473">,</span>&nbsp;<span class="ident" id="8266475">icmpv6EchoRequest</span><span class="op" id="8266492">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266498">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266510">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266515">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266527">switch</span>&nbsp;<span class="ident" id="8266534">p</span>&nbsp;<span class="op" id="8266536">:=</span>&nbsp;<span class="ident" id="8266539">m</span><span class="op" id="8266540">.</span><span class="ident" id="8266541">Body</span><span class="op" id="8266545">.</span><span class="op" id="8266546">(</span><span class="keyword" id="8266547">type</span><span class="op" id="8266551">)</span>&nbsp;<span class="op" id="8266553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266557">case</span>&nbsp;<span class="op" id="8266562">*</span><span class="ident" id="8266563">icmpEcho</span><span class="op" id="8266571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266576">if</span>&nbsp;<span class="ident" id="8266579">p</span><span class="op" id="8266580">.</span><span class="ident" id="8266581">ID</span>&nbsp;<span class="op" id="8266584">!=</span>&nbsp;<span class="ident" id="8266587">xid</span>&nbsp;<span class="op" id="8266591">||</span>&nbsp;<span class="ident" id="8266594">p</span><span class="op" id="8266595">.</span><span class="ident" id="8266596">Seq</span>&nbsp;<span class="op" id="8266600">!=</span>&nbsp;<span class="ident" id="8266603">xseq</span>&nbsp;<span class="op" id="8266608">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266614">t</span><span class="op" id="8266615">.</span><span class="ident" id="8266616">Fatalf</span><span class="op" id="8266622">(</span><span class="string" id="8266623">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="8266672">,</span>&nbsp;<span class="ident" id="8266674">p</span><span class="op" id="8266675">.</span><span class="ident" id="8266676">ID</span><span class="op" id="8266678">,</span>&nbsp;<span class="ident" id="8266680">p</span><span class="op" id="8266681">.</span><span class="ident" id="8266682">Seq</span><span class="op" id="8266685">,</span>&nbsp;<span class="ident" id="8266687">xid</span><span class="op" id="8266690">,</span>&nbsp;<span class="ident" id="8266692">xseq</span><span class="op" id="8266696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266705">default</span><span class="op" id="8266712">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266717">t</span><span class="op" id="8266718">.</span><span class="ident" id="8266719">Fatalf</span><span class="op" id="8266725">(</span><span class="string" id="8266726">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="8266775">,</span>&nbsp;<span class="ident" id="8266777">m</span><span class="op" id="8266778">.</span><span class="ident" id="8266779">Type</span><span class="op" id="8266783">,</span>&nbsp;<span class="ident" id="8266785">m</span><span class="op" id="8266786">.</span><span class="ident" id="8266787">Code</span><span class="op" id="8266791">,</span>&nbsp;<span class="ident" id="8266793">typ</span><span class="op" id="8266796">,</span>&nbsp;<span class="num" id="8266798">0</span><span class="op" id="8266799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266803">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266806">}</span><br>
<span class="lineno"></span><span class="op" id="8266808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8266811">func</span>&nbsp;<span class="ident" id="8266816">TestPacketConnICMPEcho</span><span class="op" id="8266838">(</span><span class="ident" id="8266839">t</span>&nbsp;<span class="op" id="8266841">*</span><span class="ident" id="8266842">testing</span><span class="op" id="8266849">.</span><span class="ident" id="8266850">T</span><span class="op" id="8266851">)</span>&nbsp;<span class="op" id="8266853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266856">if</span>&nbsp;<span class="ident" id="8266859">skip</span><span class="op" id="8266863">,</span>&nbsp;<span class="ident" id="8266865">skipmsg</span>&nbsp;<span class="op" id="8266873">:=</span>&nbsp;<span class="ident" id="8266876">skipRawSocketTest</span><span class="op" id="8266893">(</span><span class="ident" id="8266894">t</span><span class="op" id="8266895">)</span><span class="op" id="8266896">;</span>&nbsp;<span class="ident" id="8266898">skip</span>&nbsp;<span class="op" id="8266903">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266907">t</span><span class="op" id="8266908">.</span><span class="ident" id="8266909">Skip</span><span class="op" id="8266913">(</span><span class="ident" id="8266914">skipmsg</span><span class="op" id="8266921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266928">for</span>&nbsp;<span class="ident" id="8266932">i</span><span class="op" id="8266933">,</span>&nbsp;<span class="ident" id="8266935">tt</span>&nbsp;<span class="op" id="8266938">:=</span>&nbsp;<span class="keyword" id="8266941">range</span>&nbsp;<span class="ident" id="8266947">icmpEchoTests</span>&nbsp;<span class="op" id="8266961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266965">net</span><span class="op" id="8266968">,</span>&nbsp;<span class="ident" id="8266970">_</span><span class="op" id="8266971">,</span>&nbsp;<span class="ident" id="8266973">err</span>&nbsp;<span class="op" id="8266977">:=</span>&nbsp;<span class="ident" id="8266980">parseNetwork</span><span class="op" id="8266992">(</span><span class="ident" id="8266993">tt</span><span class="op" id="8266995">.</span><span class="ident" id="8266996">net</span><span class="op" id="8266999">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267003">if</span>&nbsp;<span class="ident" id="8267006">err</span>&nbsp;<span class="op" id="8267010">!=</span>&nbsp;<span class="ident" id="8267013">nil</span>&nbsp;<span class="op" id="8267017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267022">t</span><span class="op" id="8267023">.</span><span class="ident" id="8267024">Fatalf</span><span class="op" id="8267030">(</span><span class="string" id="8267031">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8267056">,</span>&nbsp;<span class="ident" id="8267058">err</span><span class="op" id="8267061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8267065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267069">if</span>&nbsp;<span class="ident" id="8267072">net</span>&nbsp;<span class="op" id="8267076">==</span>&nbsp;<span class="string" id="8267079">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8267085">&amp;&amp;</span>&nbsp;<span class="op" id="8267088">!</span><span class="ident" id="8267089">supportsIPv6</span>&nbsp;<span class="op" id="8267102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267107">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8267118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267123">c</span><span class="op" id="8267124">,</span>&nbsp;<span class="ident" id="8267126">err</span>&nbsp;<span class="op" id="8267130">:=</span>&nbsp;<span class="ident" id="8267133">ListenPacket</span><span class="op" id="8267145">(</span><span class="ident" id="8267146">tt</span><span class="op" id="8267148">.</span><span class="ident" id="8267149">net</span><span class="op" id="8267152">,</span>&nbsp;<span class="ident" id="8267154">tt</span><span class="op" id="8267156">.</span><span class="ident" id="8267157">laddr</span><span class="op" id="8267162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267166">if</span>&nbsp;<span class="ident" id="8267169">err</span>&nbsp;<span class="op" id="8267173">!=</span>&nbsp;<span class="ident" id="8267176">nil</span>&nbsp;<span class="op" id="8267180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267185">t</span><span class="op" id="8267186">.</span><span class="ident" id="8267187">Fatalf</span><span class="op" id="8267193">(</span><span class="string" id="8267194">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8267219">,</span>&nbsp;<span class="ident" id="8267221">err</span><span class="op" id="8267224">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8267228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267232">c</span><span class="op" id="8267233">.</span><span class="ident" id="8267234">SetDeadline</span><span class="op" id="8267245">(</span><span class="ident" id="8267246">time</span><span class="op" id="8267250">.</span><span class="ident" id="8267251">Now</span><span class="op" id="8267254">(</span><span class="op" id="8267255">)</span><span class="op" id="8267256">.</span><span class="ident" id="8267257">Add</span><span class="op" id="8267260">(</span><span class="num" id="8267261">100</span>&nbsp;<span class="op" id="8267265">*</span>&nbsp;<span class="ident" id="8267267">time</span><span class="op" id="8267271">.</span><span class="ident" id="8267272">Millisecond</span><span class="op" id="8267283">)</span><span class="op" id="8267284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267288">defer</span>&nbsp;<span class="ident" id="8267294">c</span><span class="op" id="8267295">.</span><span class="ident" id="8267296">Close</span><span class="op" id="8267301">(</span><span class="op" id="8267302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267307">ra</span><span class="op" id="8267309">,</span>&nbsp;<span class="ident" id="8267311">err</span>&nbsp;<span class="op" id="8267315">:=</span>&nbsp;<span class="ident" id="8267318">ResolveIPAddr</span><span class="op" id="8267331">(</span><span class="ident" id="8267332">tt</span><span class="op" id="8267334">.</span><span class="ident" id="8267335">net</span><span class="op" id="8267338">,</span>&nbsp;<span class="ident" id="8267340">tt</span><span class="op" id="8267342">.</span><span class="ident" id="8267343">raddr</span><span class="op" id="8267348">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267352">if</span>&nbsp;<span class="ident" id="8267355">err</span>&nbsp;<span class="op" id="8267359">!=</span>&nbsp;<span class="ident" id="8267362">nil</span>&nbsp;<span class="op" id="8267366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267371">t</span><span class="op" id="8267372">.</span><span class="ident" id="8267373">Fatalf</span><span class="op" id="8267379">(</span><span class="string" id="8267380">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8267406">,</span>&nbsp;<span class="ident" id="8267408">err</span><span class="op" id="8267411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8267415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267419">typ</span>&nbsp;<span class="op" id="8267423">:=</span>&nbsp;<span class="ident" id="8267426">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267446">if</span>&nbsp;<span class="ident" id="8267449">net</span>&nbsp;<span class="op" id="8267453">==</span>&nbsp;<span class="string" id="8267456">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8267462">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267467">typ</span>&nbsp;<span class="op" id="8267471">=</span>&nbsp;<span class="ident" id="8267473">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8267493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267497">xid</span><span class="op" id="8267500">,</span>&nbsp;<span class="ident" id="8267502">xseq</span>&nbsp;<span class="op" id="8267507">:=</span>&nbsp;<span class="ident" id="8267510">os</span><span class="op" id="8267512">.</span><span class="ident" id="8267513">Getpid</span><span class="op" id="8267519">(</span><span class="op" id="8267520">)</span><span class="op" id="8267521">&amp;</span><span class="num" id="8267522">0xffff</span><span class="op" id="8267528">,</span>&nbsp;<span class="ident" id="8267530">i</span><span class="op" id="8267531">+</span><span class="num" id="8267532">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267536">wb</span><span class="op" id="8267538">,</span>&nbsp;<span class="ident" id="8267540">err</span>&nbsp;<span class="op" id="8267544">:=</span>&nbsp;<span class="op" id="8267547">(</span><span class="op" id="8267548">&amp;</span><span class="ident" id="8267549">icmpMessage</span><span class="op" id="8267560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267565">Type</span><span class="op" id="8267569">:</span>&nbsp;<span class="ident" id="8267571">typ</span><span class="op" id="8267574">,</span>&nbsp;<span class="ident" id="8267576">Code</span><span class="op" id="8267580">:</span>&nbsp;<span class="num" id="8267582">0</span><span class="op" id="8267583">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267588">Body</span><span class="op" id="8267592">:</span>&nbsp;<span class="op" id="8267594">&amp;</span><span class="ident" id="8267595">icmpEcho</span><span class="op" id="8267603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267609">ID</span><span class="op" id="8267611">:</span>&nbsp;<span class="ident" id="8267613">xid</span><span class="op" id="8267616">,</span>&nbsp;<span class="ident" id="8267618">Seq</span><span class="op" id="8267621">:</span>&nbsp;<span class="ident" id="8267623">xseq</span><span class="op" id="8267627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267633">Data</span><span class="op" id="8267637">:</span>&nbsp;<span class="ident" id="8267639">bytes</span><span class="op" id="8267644">.</span><span class="ident" id="8267645">Repeat</span><span class="op" id="8267651">(</span><span class="op" id="8267652">[</span><span class="op" id="8267653">]</span><span class="builtintype" id="8267654">byte</span><span class="op" id="8267658">(</span><span class="string" id="8267659">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="8267681">)</span><span class="op" id="8267682">,</span>&nbsp;<span class="num" id="8267684">3</span><span class="op" id="8267685">)</span><span class="op" id="8267686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8267691">}</span><span class="op" id="8267692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8267696">}</span><span class="op" id="8267697">)</span><span class="op" id="8267698">.</span><span class="ident" id="8267699">Marshal</span><span class="op" id="8267706">(</span><span class="op" id="8267707">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267711">if</span>&nbsp;<span class="ident" id="8267714">err</span>&nbsp;<span class="op" id="8267718">!=</span>&nbsp;<span class="ident" id="8267721">nil</span>&nbsp;<span class="op" id="8267725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267730">t</span><span class="op" id="8267731">.</span><span class="ident" id="8267732">Fatalf</span><span class="op" id="8267738">(</span><span class="string" id="8267739">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8267771">,</span>&nbsp;<span class="ident" id="8267773">err</span><span class="op" id="8267776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8267780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267784">if</span>&nbsp;<span class="ident" id="8267787">_</span><span class="op" id="8267788">,</span>&nbsp;<span class="ident" id="8267790">err</span>&nbsp;<span class="op" id="8267794">:=</span>&nbsp;<span class="ident" id="8267797">c</span><span class="op" id="8267798">.</span><span class="ident" id="8267799">WriteTo</span><span class="op" id="8267806">(</span><span class="ident" id="8267807">wb</span><span class="op" id="8267809">,</span>&nbsp;<span class="ident" id="8267811">ra</span><span class="op" id="8267813">)</span><span class="op" id="8267814">;</span>&nbsp;<span class="ident" id="8267816">err</span>&nbsp;<span class="op" id="8267820">!=</span>&nbsp;<span class="ident" id="8267823">nil</span>&nbsp;<span class="op" id="8267827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267832">t</span><span class="op" id="8267833">.</span><span class="ident" id="8267834">Fatalf</span><span class="op" id="8267840">(</span><span class="string" id="8267841">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8267872">,</span>&nbsp;<span class="ident" id="8267874">err</span><span class="op" id="8267877">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8267881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267885">var</span>&nbsp;<span class="ident" id="8267889">m</span>&nbsp;<span class="op" id="8267891">*</span><span class="ident" id="8267892">icmpMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267906">rb</span>&nbsp;<span class="op" id="8267909">:=</span>&nbsp;<span class="builtinfunc" id="8267912">make</span><span class="op" id="8267916">(</span><span class="op" id="8267917">[</span><span class="op" id="8267918">]</span><span class="builtintype" id="8267919">byte</span><span class="op" id="8267923">,</span>&nbsp;<span class="num" id="8267925">20</span><span class="op" id="8267927">+</span><span class="builtinfunc" id="8267928">len</span><span class="op" id="8267931">(</span><span class="ident" id="8267932">wb</span><span class="op" id="8267934">)</span><span class="op" id="8267935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267939">for</span>&nbsp;<span class="op" id="8267943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267948">if</span>&nbsp;<span class="ident" id="8267951">_</span><span class="op" id="8267952">,</span>&nbsp;<span class="ident" id="8267954">_</span><span class="op" id="8267955">,</span>&nbsp;<span class="ident" id="8267957">err</span>&nbsp;<span class="op" id="8267961">:=</span>&nbsp;<span class="ident" id="8267964">c</span><span class="op" id="8267965">.</span><span class="ident" id="8267966">ReadFrom</span><span class="op" id="8267974">(</span><span class="ident" id="8267975">rb</span><span class="op" id="8267977">)</span><span class="op" id="8267978">;</span>&nbsp;<span class="ident" id="8267980">err</span>&nbsp;<span class="op" id="8267984">!=</span>&nbsp;<span class="ident" id="8267987">nil</span>&nbsp;<span class="op" id="8267991">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267997">t</span><span class="op" id="8267998">.</span><span class="ident" id="8267999">Fatalf</span><span class="op" id="8268005">(</span><span class="string" id="8268006">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8268038">,</span>&nbsp;<span class="ident" id="8268040">err</span><span class="op" id="8268043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8268053">//&nbsp;See&nbsp;BUG&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8268076">//if&nbsp;net&nbsp;==&nbsp;&#34;ip4&#34;&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8268099">//&nbsp;&nbsp;&nbsp;&nbsprb&nbsp;=&nbsp;ipv4Payload(rb)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8268126">//}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268133">if</span>&nbsp;<span class="ident" id="8268136">m</span><span class="op" id="8268137">,</span>&nbsp;<span class="ident" id="8268139">err</span>&nbsp;<span class="op" id="8268143">=</span>&nbsp;<span class="ident" id="8268145">parseICMPMessage</span><span class="op" id="8268161">(</span><span class="ident" id="8268162">rb</span><span class="op" id="8268164">)</span><span class="op" id="8268165">;</span>&nbsp;<span class="ident" id="8268167">err</span>&nbsp;<span class="op" id="8268171">!=</span>&nbsp;<span class="ident" id="8268174">nil</span>&nbsp;<span class="op" id="8268178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268184">t</span><span class="op" id="8268185">.</span><span class="ident" id="8268186">Fatalf</span><span class="op" id="8268192">(</span><span class="string" id="8268193">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8268222">,</span>&nbsp;<span class="ident" id="8268224">err</span><span class="op" id="8268227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268237">switch</span>&nbsp;<span class="ident" id="8268244">m</span><span class="op" id="8268245">.</span><span class="ident" id="8268246">Type</span>&nbsp;<span class="op" id="8268251">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268256">case</span>&nbsp;<span class="ident" id="8268261">icmpv4EchoRequest</span><span class="op" id="8268278">,</span>&nbsp;<span class="ident" id="8268280">icmpv6EchoRequest</span><span class="op" id="8268297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268303">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268320">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268328">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268332">switch</span>&nbsp;<span class="ident" id="8268339">p</span>&nbsp;<span class="op" id="8268341">:=</span>&nbsp;<span class="ident" id="8268344">m</span><span class="op" id="8268345">.</span><span class="ident" id="8268346">Body</span><span class="op" id="8268350">.</span><span class="op" id="8268351">(</span><span class="keyword" id="8268352">type</span><span class="op" id="8268356">)</span>&nbsp;<span class="op" id="8268358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268362">case</span>&nbsp;<span class="op" id="8268367">*</span><span class="ident" id="8268368">icmpEcho</span><span class="op" id="8268376">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268381">if</span>&nbsp;<span class="ident" id="8268384">p</span><span class="op" id="8268385">.</span><span class="ident" id="8268386">ID</span>&nbsp;<span class="op" id="8268389">!=</span>&nbsp;<span class="ident" id="8268392">xid</span>&nbsp;<span class="op" id="8268396">||</span>&nbsp;<span class="ident" id="8268399">p</span><span class="op" id="8268400">.</span><span class="ident" id="8268401">Seq</span>&nbsp;<span class="op" id="8268405">!=</span>&nbsp;<span class="ident" id="8268408">xseq</span>&nbsp;<span class="op" id="8268413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268419">t</span><span class="op" id="8268420">.</span><span class="ident" id="8268421">Fatalf</span><span class="op" id="8268427">(</span><span class="string" id="8268428">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="8268477">,</span>&nbsp;<span class="ident" id="8268479">p</span><span class="op" id="8268480">.</span><span class="ident" id="8268481">ID</span><span class="op" id="8268483">,</span>&nbsp;<span class="ident" id="8268485">p</span><span class="op" id="8268486">.</span><span class="ident" id="8268487">Seq</span><span class="op" id="8268490">,</span>&nbsp;<span class="ident" id="8268492">xid</span><span class="op" id="8268495">,</span>&nbsp;<span class="ident" id="8268497">xseq</span><span class="op" id="8268501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268506">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268510">default</span><span class="op" id="8268517">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268522">t</span><span class="op" id="8268523">.</span><span class="ident" id="8268524">Fatalf</span><span class="op" id="8268530">(</span><span class="string" id="8268531">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="8268580">,</span>&nbsp;<span class="ident" id="8268582">m</span><span class="op" id="8268583">.</span><span class="ident" id="8268584">Type</span><span class="op" id="8268588">,</span>&nbsp;<span class="ident" id="8268590">m</span><span class="op" id="8268591">.</span><span class="ident" id="8268592">Code</span><span class="op" id="8268596">,</span>&nbsp;<span class="ident" id="8268598">typ</span><span class="op" id="8268601">,</span>&nbsp;<span class="num" id="8268603">0</span><span class="op" id="8268604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268611">}</span><br>
<span class="lineno"></span><span class="op" id="8268613">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="8268616">func</span>&nbsp;<span class="ident" id="8268621">ipv4Payload</span><span class="op" id="8268632">(</span><span class="ident" id="8268633">b</span>&nbsp;<span class="op" id="8268635">[</span><span class="op" id="8268636">]</span><span class="builtintype" id="8268637">byte</span><span class="op" id="8268641">)</span>&nbsp;<span class="op" id="8268643">[</span><span class="op" id="8268644">]</span><span class="builtintype" id="8268645">byte</span>&nbsp;<span class="op" id="8268650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268653">if</span>&nbsp;<span class="builtinfunc" id="8268656">len</span><span class="op" id="8268659">(</span><span class="ident" id="8268660">b</span><span class="op" id="8268661">)</span>&nbsp;<span class="op" id="8268663">&lt;</span>&nbsp;<span class="num" id="8268665">20</span>&nbsp;<span class="op" id="8268668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268672">return</span>&nbsp;<span class="ident" id="8268679">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268682">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268685">hdrlen</span>&nbsp;<span class="op" id="8268692">:=</span>&nbsp;<span class="builtintype" id="8268695">int</span><span class="op" id="8268698">(</span><span class="ident" id="8268699">b</span><span class="op" id="8268700">[</span><span class="num" id="8268701">0</span><span class="op" id="8268702">]</span><span class="op" id="8268703">&amp;</span><span class="num" id="8268704">0x0f</span><span class="op" id="8268708">)</span>&nbsp;<span class="op" id="8268710">&lt;&lt;</span>&nbsp;<span class="num" id="8268713">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268716">return</span>&nbsp;<span class="ident" id="8268723">b</span><span class="op" id="8268724">[</span><span class="ident" id="8268725">hdrlen</span><span class="op" id="8268731">:</span><span class="op" id="8268732">]</span><br>
<span class="lineno"></span><span class="op" id="8268734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8268737">var</span>&nbsp;<span class="ident" id="8268741">ipConnLocalNameTests</span>&nbsp;<span class="op" id="8268762">=</span>&nbsp;<span class="op" id="8268764">[</span><span class="op" id="8268765">]</span><span class="keyword" id="8268766">struct</span>&nbsp;<span class="op" id="8268773">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268776">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8268782">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268790">laddr</span>&nbsp;<span class="op" id="8268796">*</span><span class="ident" id="8268797">IPAddr</span><br>
<span class="lineno"></span><span class="op" id="8268804">}</span><span class="op" id="8268805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268808">{</span><span class="string" id="8268809">&#34;ip4:icmp&#34;</span><span class="op" id="8268819">,</span>&nbsp;<span class="op" id="8268821">&amp;</span><span class="ident" id="8268822">IPAddr</span><span class="op" id="8268828">{</span><span class="ident" id="8268829">IP</span><span class="op" id="8268831">:</span>&nbsp;<span class="ident" id="8268833">IPv4</span><span class="op" id="8268837">(</span><span class="num" id="8268838">127</span><span class="op" id="8268841">,</span>&nbsp;<span class="num" id="8268843">0</span><span class="op" id="8268844">,</span>&nbsp;<span class="num" id="8268846">0</span><span class="op" id="8268847">,</span>&nbsp;<span class="num" id="8268849">1</span><span class="op" id="8268850">)</span><span class="op" id="8268851">}</span><span class="op" id="8268852">}</span><span class="op" id="8268853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268856">{</span><span class="string" id="8268857">&#34;ip4:icmp&#34;</span><span class="op" id="8268867">,</span>&nbsp;<span class="op" id="8268869">&amp;</span><span class="ident" id="8268870">IPAddr</span><span class="op" id="8268876">{</span><span class="op" id="8268877">}</span><span class="op" id="8268878">}</span><span class="op" id="8268879">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268882">{</span><span class="string" id="8268883">&#34;ip4:icmp&#34;</span><span class="op" id="8268893">,</span>&nbsp;<span class="ident" id="8268895">nil</span><span class="op" id="8268898">}</span><span class="op" id="8268899">,</span><br>
<span class="lineno"></span><span class="op" id="8268901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8268904">func</span>&nbsp;<span class="ident" id="8268909">TestIPConnLocalName</span><span class="op" id="8268928">(</span><span class="ident" id="8268929">t</span>&nbsp;<span class="op" id="8268931">*</span><span class="ident" id="8268932">testing</span><span class="op" id="8268939">.</span><span class="ident" id="8268940">T</span><span class="op" id="8268941">)</span>&nbsp;<span class="op" id="8268943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268946">switch</span>&nbsp;<span class="ident" id="8268953">runtime</span><span class="op" id="8268960">.</span><span class="ident" id="8268961">GOOS</span>&nbsp;<span class="op" id="8268966">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268969">case</span>&nbsp;<span class="string" id="8268974">&#34;nacl&#34;</span><span class="op" id="8268980">,</span>&nbsp;<span class="string" id="8268982">&#34;plan9&#34;</span><span class="op" id="8268989">,</span>&nbsp;<span class="string" id="8268991">&#34;windows&#34;</span><span class="op" id="8269000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269004">t</span><span class="op" id="8269005">.</span><span class="ident" id="8269006">Skipf</span><span class="op" id="8269011">(</span><span class="string" id="8269012">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8269033">,</span>&nbsp;<span class="ident" id="8269035">runtime</span><span class="op" id="8269042">.</span><span class="ident" id="8269043">GOOS</span><span class="op" id="8269047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269050">default</span><span class="op" id="8269057">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269061">if</span>&nbsp;<span class="ident" id="8269064">os</span><span class="op" id="8269066">.</span><span class="ident" id="8269067">Getuid</span><span class="op" id="8269073">(</span><span class="op" id="8269074">)</span>&nbsp;<span class="op" id="8269076">!=</span>&nbsp;<span class="num" id="8269079">0</span>&nbsp;<span class="op" id="8269081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269086">t</span><span class="op" id="8269087">.</span><span class="ident" id="8269088">Skip</span><span class="op" id="8269092">(</span><span class="string" id="8269093">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="8269122">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269133">for</span>&nbsp;<span class="ident" id="8269137">_</span><span class="op" id="8269138">,</span>&nbsp;<span class="ident" id="8269140">tt</span>&nbsp;<span class="op" id="8269143">:=</span>&nbsp;<span class="keyword" id="8269146">range</span>&nbsp;<span class="ident" id="8269152">ipConnLocalNameTests</span>&nbsp;<span class="op" id="8269173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269177">c</span><span class="op" id="8269178">,</span>&nbsp;<span class="ident" id="8269180">err</span>&nbsp;<span class="op" id="8269184">:=</span>&nbsp;<span class="ident" id="8269187">ListenIP</span><span class="op" id="8269195">(</span><span class="ident" id="8269196">tt</span><span class="op" id="8269198">.</span><span class="ident" id="8269199">net</span><span class="op" id="8269202">,</span>&nbsp;<span class="ident" id="8269204">tt</span><span class="op" id="8269206">.</span><span class="ident" id="8269207">laddr</span><span class="op" id="8269212">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269216">if</span>&nbsp;<span class="ident" id="8269219">err</span>&nbsp;<span class="op" id="8269223">!=</span>&nbsp;<span class="ident" id="8269226">nil</span>&nbsp;<span class="op" id="8269230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269235">t</span><span class="op" id="8269236">.</span><span class="ident" id="8269237">Fatalf</span><span class="op" id="8269243">(</span><span class="string" id="8269244">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8269265">,</span>&nbsp;<span class="ident" id="8269267">err</span><span class="op" id="8269270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269278">defer</span>&nbsp;<span class="ident" id="8269284">c</span><span class="op" id="8269285">.</span><span class="ident" id="8269286">Close</span><span class="op" id="8269291">(</span><span class="op" id="8269292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269296">if</span>&nbsp;<span class="ident" id="8269299">la</span>&nbsp;<span class="op" id="8269302">:=</span>&nbsp;<span class="ident" id="8269305">c</span><span class="op" id="8269306">.</span><span class="ident" id="8269307">LocalAddr</span><span class="op" id="8269316">(</span><span class="op" id="8269317">)</span><span class="op" id="8269318">;</span>&nbsp;<span class="ident" id="8269320">la</span>&nbsp;<span class="op" id="8269323">==</span>&nbsp;<span class="ident" id="8269326">nil</span>&nbsp;<span class="op" id="8269330">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269335">t</span><span class="op" id="8269336">.</span><span class="ident" id="8269337">Fatal</span><span class="op" id="8269342">(</span><span class="string" id="8269343">&#34;IPConn.LocalAddr&nbsp;failed&#34;</span><span class="op" id="8269368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269375">}</span><br>
<span class="lineno"></span><span class="op" id="8269377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="8269380">func</span>&nbsp;<span class="ident" id="8269385">TestIPConnRemoteName</span><span class="op" id="8269405">(</span><span class="ident" id="8269406">t</span>&nbsp;<span class="op" id="8269408">*</span><span class="ident" id="8269409">testing</span><span class="op" id="8269416">.</span><span class="ident" id="8269417">T</span><span class="op" id="8269418">)</span>&nbsp;<span class="op" id="8269420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269423">switch</span>&nbsp;<span class="ident" id="8269430">runtime</span><span class="op" id="8269437">.</span><span class="ident" id="8269438">GOOS</span>&nbsp;<span class="op" id="8269443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269446">case</span>&nbsp;<span class="string" id="8269451">&#34;plan9&#34;</span><span class="op" id="8269458">,</span>&nbsp;<span class="string" id="8269460">&#34;windows&#34;</span><span class="op" id="8269469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269473">t</span><span class="op" id="8269474">.</span><span class="ident" id="8269475">Skipf</span><span class="op" id="8269480">(</span><span class="string" id="8269481">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8269502">,</span>&nbsp;<span class="ident" id="8269504">runtime</span><span class="op" id="8269511">.</span><span class="ident" id="8269512">GOOS</span><span class="op" id="8269516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269519">default</span><span class="op" id="8269526">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269530">if</span>&nbsp;<span class="ident" id="8269533">os</span><span class="op" id="8269535">.</span><span class="ident" id="8269536">Getuid</span><span class="op" id="8269542">(</span><span class="op" id="8269543">)</span>&nbsp;<span class="op" id="8269545">!=</span>&nbsp;<span class="num" id="8269548">0</span>&nbsp;<span class="op" id="8269550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269555">t</span><span class="op" id="8269556">.</span><span class="ident" id="8269557">Skip</span><span class="op" id="8269561">(</span><span class="string" id="8269562">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="8269591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269602">raddr</span>&nbsp;<span class="op" id="8269608">:=</span>&nbsp;<span class="op" id="8269611">&amp;</span><span class="ident" id="8269612">IPAddr</span><span class="op" id="8269618">{</span><span class="ident" id="8269619">IP</span><span class="op" id="8269621">:</span>&nbsp;<span class="ident" id="8269623">IPv4</span><span class="op" id="8269627">(</span><span class="num" id="8269628">127</span><span class="op" id="8269631">,</span>&nbsp;<span class="num" id="8269633">0</span><span class="op" id="8269634">,</span>&nbsp;<span class="num" id="8269636">0</span><span class="op" id="8269637">,</span>&nbsp;<span class="num" id="8269639">1</span><span class="op" id="8269640">)</span><span class="op" id="8269641">.</span><span class="ident" id="8269642">To4</span><span class="op" id="8269645">(</span><span class="op" id="8269646">)</span><span class="op" id="8269647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269650">c</span><span class="op" id="8269651">,</span>&nbsp;<span class="ident" id="8269653">err</span>&nbsp;<span class="op" id="8269657">:=</span>&nbsp;<span class="ident" id="8269660">DialIP</span><span class="op" id="8269666">(</span><span class="string" id="8269667">&#34;ip:tcp&#34;</span><span class="op" id="8269675">,</span>&nbsp;<span class="op" id="8269677">&amp;</span><span class="ident" id="8269678">IPAddr</span><span class="op" id="8269684">{</span><span class="ident" id="8269685">IP</span><span class="op" id="8269687">:</span>&nbsp;<span class="ident" id="8269689">IPv4</span><span class="op" id="8269693">(</span><span class="num" id="8269694">127</span><span class="op" id="8269697">,</span>&nbsp;<span class="num" id="8269699">0</span><span class="op" id="8269700">,</span>&nbsp;<span class="num" id="8269702">0</span><span class="op" id="8269703">,</span>&nbsp;<span class="num" id="8269705">1</span><span class="op" id="8269706">)</span><span class="op" id="8269707">}</span><span class="op" id="8269708">,</span>&nbsp;<span class="ident" id="8269710">raddr</span><span class="op" id="8269715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269718">if</span>&nbsp;<span class="ident" id="8269721">err</span>&nbsp;<span class="op" id="8269725">!=</span>&nbsp;<span class="ident" id="8269728">nil</span>&nbsp;<span class="op" id="8269732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269736">t</span><span class="op" id="8269737">.</span><span class="ident" id="8269738">Fatalf</span><span class="op" id="8269744">(</span><span class="string" id="8269745">&#34;DialIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8269764">,</span>&nbsp;<span class="ident" id="8269766">err</span><span class="op" id="8269769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269772">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269775">defer</span>&nbsp;<span class="ident" id="8269781">c</span><span class="op" id="8269782">.</span><span class="ident" id="8269783">Close</span><span class="op" id="8269788">(</span><span class="op" id="8269789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269792">if</span>&nbsp;<span class="op" id="8269795">!</span><span class="ident" id="8269796">reflect</span><span class="op" id="8269803">.</span><span class="ident" id="8269804">DeepEqual</span><span class="op" id="8269813">(</span><span class="ident" id="8269814">raddr</span><span class="op" id="8269819">,</span>&nbsp;<span class="ident" id="8269821">c</span><span class="op" id="8269822">.</span><span class="ident" id="8269823">RemoteAddr</span><span class="op" id="8269833">(</span><span class="op" id="8269834">)</span><span class="op" id="8269835">)</span>&nbsp;<span class="op" id="8269837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269841">t</span><span class="op" id="8269842">.</span><span class="ident" id="8269843">Fatalf</span><span class="op" id="8269849">(</span><span class="string" id="8269850">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8269873">,</span>&nbsp;<span class="ident" id="8269875">c</span><span class="op" id="8269876">.</span><span class="ident" id="8269877">RemoteAddr</span><span class="op" id="8269887">(</span><span class="op" id="8269888">)</span><span class="op" id="8269889">,</span>&nbsp;<span class="ident" id="8269891">raddr</span><span class="op" id="8269896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269899">}</span><br>
<span class="lineno"></span><span class="op" id="8269901">}</span>
</div>
</body>
</html>
