<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2200998">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2201053">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2201107">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2201158">package</span>&nbsp;<span class="ident" id="2201166">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2201175">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="2201252">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2201302">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="2201370">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="2201447">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="2201482">type</span>&nbsp;<span class="ident" id="2201487">stringFinder</span>&nbsp;<span class="keyword" id="2201500">struct</span>&nbsp;<span class="op" id="2201507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2201510">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2201575">pattern</span>&nbsp;<span class="builtintype" id="2201583">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2201592">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2201666">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2201740">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2201776">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2201780">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2201852">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2201925">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2201970">badCharSkip</span>&nbsp;<span class="op" id="2201982">[</span><span class="num" id="2201983">256</span><span class="op" id="2201986">]</span><span class="builtintype" id="2201987">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2201993">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202069">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202141">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202183">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202187">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202259">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202333">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202403">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202476">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202541">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202576">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202580">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202655">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202723">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202797">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202863">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2202931">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2203001">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2203072">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2203145">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2203202">goodSuffixSkip</span>&nbsp;<span class="op" id="2203217">[</span><span class="op" id="2203218">]</span><span class="builtintype" id="2203219">int</span><br>
<span class="lineno"></span><span class="op" id="2203223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2203226">func</span>&nbsp;<span class="ident" id="2203231">makeStringFinder</span><span class="op" id="2203247">(</span><span class="ident" id="2203248">pattern</span>&nbsp;<span class="builtintype" id="2203256">string</span><span class="op" id="2203262">)</span>&nbsp;<span class="op" id="2203264">*</span><span class="ident" id="2203265">stringFinder</span>&nbsp;<span class="op" id="2203278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2203281">f</span>&nbsp;<span class="op" id="2203283">:=</span>&nbsp;<span class="op" id="2203286">&amp;</span><span class="ident" id="2203287">stringFinder</span><span class="op" id="2203299">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2203303">pattern</span><span class="op" id="2203310">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2203319">pattern</span><span class="op" id="2203326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2203330">goodSuffixSkip</span><span class="op" id="2203344">:</span>&nbsp;<span class="builtinfunc" id="2203346">make</span><span class="op" id="2203350">(</span><span class="op" id="2203351">[</span><span class="op" id="2203352">]</span><span class="builtintype" id="2203353">int</span><span class="op" id="2203356">,</span>&nbsp;<span class="builtinfunc" id="2203358">len</span><span class="op" id="2203361">(</span><span class="ident" id="2203362">pattern</span><span class="op" id="2203369">)</span><span class="op" id="2203370">)</span><span class="op" id="2203371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2203374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2203377">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2203437">last</span>&nbsp;<span class="op" id="2203442">:=</span>&nbsp;<span class="builtinfunc" id="2203445">len</span><span class="op" id="2203448">(</span><span class="ident" id="2203449">pattern</span><span class="op" id="2203456">)</span>&nbsp;<span class="op" id="2203458">-</span>&nbsp;<span class="num" id="2203460">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2203464">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2203495">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2203555">for</span>&nbsp;<span class="ident" id="2203559">i</span>&nbsp;<span class="op" id="2203561">:=</span>&nbsp;<span class="keyword" id="2203564">range</span>&nbsp;<span class="ident" id="2203570">f</span><span class="op" id="2203571">.</span><span class="ident" id="2203572">badCharSkip</span>&nbsp;<span class="op" id="2203584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2203588">f</span><span class="op" id="2203589">.</span><span class="ident" id="2203590">badCharSkip</span><span class="op" id="2203601">[</span><span class="ident" id="2203602">i</span><span class="op" id="2203603">]</span>&nbsp;<span class="op" id="2203605">=</span>&nbsp;<span class="builtinfunc" id="2203607">len</span><span class="op" id="2203610">(</span><span class="ident" id="2203611">pattern</span><span class="op" id="2203618">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2203621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2203624">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2203697">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2203772">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2203813">for</span>&nbsp;<span class="ident" id="2203817">i</span>&nbsp;<span class="op" id="2203819">:=</span>&nbsp;<span class="num" id="2203822">0</span><span class="op" id="2203823">;</span>&nbsp;<span class="ident" id="2203825">i</span>&nbsp;<span class="op" id="2203827">&lt;</span>&nbsp;<span class="ident" id="2203829">last</span><span class="op" id="2203833">;</span>&nbsp;<span class="ident" id="2203835">i</span><span class="op" id="2203836">++</span>&nbsp;<span class="op" id="2203839">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2203843">f</span><span class="op" id="2203844">.</span><span class="ident" id="2203845">badCharSkip</span><span class="op" id="2203856">[</span><span class="ident" id="2203857">pattern</span><span class="op" id="2203864">[</span><span class="ident" id="2203865">i</span><span class="op" id="2203866">]</span><span class="op" id="2203867">]</span>&nbsp;<span class="op" id="2203869">=</span>&nbsp;<span class="ident" id="2203871">last</span>&nbsp;<span class="op" id="2203876">-</span>&nbsp;<span class="ident" id="2203878">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2203881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2203885">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2203914">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2203988">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2204001">lastPrefix</span>&nbsp;<span class="op" id="2204012">:=</span>&nbsp;<span class="ident" id="2204015">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2204021">for</span>&nbsp;<span class="ident" id="2204025">i</span>&nbsp;<span class="op" id="2204027">:=</span>&nbsp;<span class="ident" id="2204030">last</span><span class="op" id="2204034">;</span>&nbsp;<span class="ident" id="2204036">i</span>&nbsp;<span class="op" id="2204038">&gt;=</span>&nbsp;<span class="num" id="2204041">0</span><span class="op" id="2204042">;</span>&nbsp;<span class="ident" id="2204044">i</span><span class="op" id="2204045">--</span>&nbsp;<span class="op" id="2204048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2204052">if</span>&nbsp;<span class="ident" id="2204055">HasPrefix</span><span class="op" id="2204064">(</span><span class="ident" id="2204065">pattern</span><span class="op" id="2204072">,</span>&nbsp;<span class="ident" id="2204074">pattern</span><span class="op" id="2204081">[</span><span class="ident" id="2204082">i</span><span class="op" id="2204083">+</span><span class="num" id="2204084">1</span><span class="op" id="2204085">:</span><span class="op" id="2204086">]</span><span class="op" id="2204087">)</span>&nbsp;<span class="op" id="2204089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2204094">lastPrefix</span>&nbsp;<span class="op" id="2204105">=</span>&nbsp;<span class="ident" id="2204107">i</span>&nbsp;<span class="op" id="2204109">+</span>&nbsp;<span class="num" id="2204111">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2204115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2204119">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2204178">f</span><span class="op" id="2204179">.</span><span class="ident" id="2204180">goodSuffixSkip</span><span class="op" id="2204194">[</span><span class="ident" id="2204195">i</span><span class="op" id="2204196">]</span>&nbsp;<span class="op" id="2204198">=</span>&nbsp;<span class="ident" id="2204200">lastPrefix</span>&nbsp;<span class="op" id="2204211">+</span>&nbsp;<span class="ident" id="2204213">last</span>&nbsp;<span class="op" id="2204218">-</span>&nbsp;<span class="ident" id="2204220">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2204223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2204226">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2204301">for</span>&nbsp;<span class="ident" id="2204305">i</span>&nbsp;<span class="op" id="2204307">:=</span>&nbsp;<span class="num" id="2204310">0</span><span class="op" id="2204311">;</span>&nbsp;<span class="ident" id="2204313">i</span>&nbsp;<span class="op" id="2204315">&lt;</span>&nbsp;<span class="ident" id="2204317">last</span><span class="op" id="2204321">;</span>&nbsp;<span class="ident" id="2204323">i</span><span class="op" id="2204324">++</span>&nbsp;<span class="op" id="2204327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2204331">lenSuffix</span>&nbsp;<span class="op" id="2204341">:=</span>&nbsp;<span class="ident" id="2204344">longestCommonSuffix</span><span class="op" id="2204363">(</span><span class="ident" id="2204364">pattern</span><span class="op" id="2204371">,</span>&nbsp;<span class="ident" id="2204373">pattern</span><span class="op" id="2204380">[</span><span class="num" id="2204381">1</span><span class="op" id="2204382">:</span><span class="ident" id="2204383">i</span><span class="op" id="2204384">+</span><span class="num" id="2204385">1</span><span class="op" id="2204386">]</span><span class="op" id="2204387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2204391">if</span>&nbsp;<span class="ident" id="2204394">pattern</span><span class="op" id="2204401">[</span><span class="ident" id="2204402">i</span><span class="op" id="2204403">-</span><span class="ident" id="2204404">lenSuffix</span><span class="op" id="2204413">]</span>&nbsp;<span class="op" id="2204415">!=</span>&nbsp;<span class="ident" id="2204418">pattern</span><span class="op" id="2204425">[</span><span class="ident" id="2204426">last</span><span class="op" id="2204430">-</span><span class="ident" id="2204431">lenSuffix</span><span class="op" id="2204440">]</span>&nbsp;<span class="op" id="2204442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2204447">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2204506">f</span><span class="op" id="2204507">.</span><span class="ident" id="2204508">goodSuffixSkip</span><span class="op" id="2204522">[</span><span class="ident" id="2204523">last</span><span class="op" id="2204527">-</span><span class="ident" id="2204528">lenSuffix</span><span class="op" id="2204537">]</span>&nbsp;<span class="op" id="2204539">=</span>&nbsp;<span class="ident" id="2204541">lenSuffix</span>&nbsp;<span class="op" id="2204551">+</span>&nbsp;<span class="ident" id="2204553">last</span>&nbsp;<span class="op" id="2204558">-</span>&nbsp;<span class="ident" id="2204560">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2204564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2204567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2204571">return</span>&nbsp;<span class="ident" id="2204578">f</span><br>
<span class="lineno"></span><span class="op" id="2204580">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2204583">func</span>&nbsp;<span class="ident" id="2204588">longestCommonSuffix</span><span class="op" id="2204607">(</span><span class="ident" id="2204608">a</span><span class="op" id="2204609">,</span>&nbsp;<span class="ident" id="2204611">b</span>&nbsp;<span class="builtintype" id="2204613">string</span><span class="op" id="2204619">)</span>&nbsp;<span class="op" id="2204621">(</span><span class="ident" id="2204622">i</span>&nbsp;<span class="builtintype" id="2204624">int</span><span class="op" id="2204627">)</span>&nbsp;<span class="op" id="2204629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2204632">for</span>&nbsp;<span class="op" id="2204636">;</span>&nbsp;<span class="ident" id="2204638">i</span>&nbsp;<span class="op" id="2204640">&lt;</span>&nbsp;<span class="builtinfunc" id="2204642">len</span><span class="op" id="2204645">(</span><span class="ident" id="2204646">a</span><span class="op" id="2204647">)</span>&nbsp;<span class="op" id="2204649">&amp;&amp;</span>&nbsp;<span class="ident" id="2204652">i</span>&nbsp;<span class="op" id="2204654">&lt;</span>&nbsp;<span class="builtinfunc" id="2204656">len</span><span class="op" id="2204659">(</span><span class="ident" id="2204660">b</span><span class="op" id="2204661">)</span><span class="op" id="2204662">;</span>&nbsp;<span class="ident" id="2204664">i</span><span class="op" id="2204665">++</span>&nbsp;<span class="op" id="2204668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2204672">if</span>&nbsp;<span class="ident" id="2204675">a</span><span class="op" id="2204676">[</span><span class="builtinfunc" id="2204677">len</span><span class="op" id="2204680">(</span><span class="ident" id="2204681">a</span><span class="op" id="2204682">)</span><span class="op" id="2204683">-</span><span class="num" id="2204684">1</span><span class="op" id="2204685">-</span><span class="ident" id="2204686">i</span><span class="op" id="2204687">]</span>&nbsp;<span class="op" id="2204689">!=</span>&nbsp;<span class="ident" id="2204692">b</span><span class="op" id="2204693">[</span><span class="builtinfunc" id="2204694">len</span><span class="op" id="2204697">(</span><span class="ident" id="2204698">b</span><span class="op" id="2204699">)</span><span class="op" id="2204700">-</span><span class="num" id="2204701">1</span><span class="op" id="2204702">-</span><span class="ident" id="2204703">i</span><span class="op" id="2204704">]</span>&nbsp;<span class="op" id="2204706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2204711">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2204719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2204722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2204725">return</span><br>
<span class="lineno"></span><span class="op" id="2204732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2204735">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2204812">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2204856">func</span>&nbsp;<span class="op" id="2204861">(</span><span class="ident" id="2204862">f</span>&nbsp;<span class="op" id="2204864">*</span><span class="ident" id="2204865">stringFinder</span><span class="op" id="2204877">)</span>&nbsp;<span class="ident" id="2204879">next</span><span class="op" id="2204883">(</span><span class="ident" id="2204884">text</span>&nbsp;<span class="builtintype" id="2204889">string</span><span class="op" id="2204895">)</span>&nbsp;<span class="builtintype" id="2204897">int</span>&nbsp;<span class="op" id="2204901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2204904">i</span>&nbsp;<span class="op" id="2204906">:=</span>&nbsp;<span class="builtinfunc" id="2204909">len</span><span class="op" id="2204912">(</span><span class="ident" id="2204913">f</span><span class="op" id="2204914">.</span><span class="ident" id="2204915">pattern</span><span class="op" id="2204922">)</span>&nbsp;<span class="op" id="2204924">-</span>&nbsp;<span class="num" id="2204926">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2204929">for</span>&nbsp;<span class="ident" id="2204933">i</span>&nbsp;<span class="op" id="2204935">&lt;</span>&nbsp;<span class="builtinfunc" id="2204937">len</span><span class="op" id="2204940">(</span><span class="ident" id="2204941">text</span><span class="op" id="2204945">)</span>&nbsp;<span class="op" id="2204947">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2204951">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205025">j</span>&nbsp;<span class="op" id="2205027">:=</span>&nbsp;<span class="builtinfunc" id="2205030">len</span><span class="op" id="2205033">(</span><span class="ident" id="2205034">f</span><span class="op" id="2205035">.</span><span class="ident" id="2205036">pattern</span><span class="op" id="2205043">)</span>&nbsp;<span class="op" id="2205045">-</span>&nbsp;<span class="num" id="2205047">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205051">for</span>&nbsp;<span class="ident" id="2205055">j</span>&nbsp;<span class="op" id="2205057">&gt;=</span>&nbsp;<span class="num" id="2205060">0</span>&nbsp;<span class="op" id="2205062">&amp;&amp;</span>&nbsp;<span class="ident" id="2205065">text</span><span class="op" id="2205069">[</span><span class="ident" id="2205070">i</span><span class="op" id="2205071">]</span>&nbsp;<span class="op" id="2205073">==</span>&nbsp;<span class="ident" id="2205076">f</span><span class="op" id="2205077">.</span><span class="ident" id="2205078">pattern</span><span class="op" id="2205085">[</span><span class="ident" id="2205086">j</span><span class="op" id="2205087">]</span>&nbsp;<span class="op" id="2205089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205094">i</span><span class="op" id="2205095">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205101">j</span><span class="op" id="2205102">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2205107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205111">if</span>&nbsp;<span class="ident" id="2205114">j</span>&nbsp;<span class="op" id="2205116">&lt;</span>&nbsp;<span class="num" id="2205118">0</span>&nbsp;<span class="op" id="2205120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205125">return</span>&nbsp;<span class="ident" id="2205132">i</span>&nbsp;<span class="op" id="2205134">+</span>&nbsp;<span class="num" id="2205136">1</span>&nbsp;<span class="comment" id="2205138">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2205149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205153">i</span>&nbsp;<span class="op" id="2205155">+=</span>&nbsp;<span class="ident" id="2205158">max</span><span class="op" id="2205161">(</span><span class="ident" id="2205162">f</span><span class="op" id="2205163">.</span><span class="ident" id="2205164">badCharSkip</span><span class="op" id="2205175">[</span><span class="ident" id="2205176">text</span><span class="op" id="2205180">[</span><span class="ident" id="2205181">i</span><span class="op" id="2205182">]</span><span class="op" id="2205183">]</span><span class="op" id="2205184">,</span>&nbsp;<span class="ident" id="2205186">f</span><span class="op" id="2205187">.</span><span class="ident" id="2205188">goodSuffixSkip</span><span class="op" id="2205202">[</span><span class="ident" id="2205203">j</span><span class="op" id="2205204">]</span><span class="op" id="2205205">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2205208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205211">return</span>&nbsp;<span class="op" id="2205218">-</span><span class="num" id="2205219">1</span><br>
<span class="lineno"></span><span class="op" id="2205221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2205224">func</span>&nbsp;<span class="ident" id="2205229">max</span><span class="op" id="2205232">(</span><span class="ident" id="2205233">a</span><span class="op" id="2205234">,</span>&nbsp;<span class="ident" id="2205236">b</span>&nbsp;<span class="builtintype" id="2205238">int</span><span class="op" id="2205241">)</span>&nbsp;<span class="builtintype" id="2205243">int</span>&nbsp;<span class="op" id="2205247">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205250">if</span>&nbsp;<span class="ident" id="2205253">a</span>&nbsp;<span class="op" id="2205255">&gt;</span>&nbsp;<span class="ident" id="2205257">b</span>&nbsp;<span class="op" id="2205259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205263">return</span>&nbsp;<span class="ident" id="2205270">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2205273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205276">return</span>&nbsp;<span class="ident" id="2205283">b</span><br>
<span class="lineno"></span><span class="op" id="2205285">}</span>
</div>
</body>
</html>
