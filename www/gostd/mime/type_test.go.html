<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime</h2>
<ul>
<li><a href="/gostd/mime/grammar.go.html">grammar.go</a></li>
<li><a href="/gostd/mime/mediatype.go.html">mediatype.go</a></li>
<li><a href="/gostd/mime/mediatype_test.go.html">mediatype_test.go</a></li>
<li><a href="/gostd/mime/type.go.html">type.go</a></li>
<li><a href="/gostd/mime/type_test.go.html">type_test.go</a></li>
<li><a href="/gostd/mime/type_unix.go.html">type_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6561076">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6561131">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6561185">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6561236">package</span>&nbsp;<span class="ident" id="6561244">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6561250">import</span>&nbsp;<span class="op" id="6561257">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6561260">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6561270">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="6561273">var</span>&nbsp;<span class="ident" id="6561277">typeTests</span>&nbsp;<span class="op" id="6561287">=</span>&nbsp;<span class="ident" id="6561289">initMimeForTests</span><span class="op" id="6561305">(</span><span class="op" id="6561306">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6561309">func</span>&nbsp;<span class="ident" id="6561314">TestTypeByExtension</span><span class="op" id="6561333">(</span><span class="ident" id="6561334">t</span>&nbsp;<span class="op" id="6561336">*</span><span class="ident" id="6561337">testing</span><span class="op" id="6561344">.</span><span class="ident" id="6561345">T</span><span class="op" id="6561346">)</span>&nbsp;<span class="op" id="6561348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561351">for</span>&nbsp;<span class="ident" id="6561355">ext</span><span class="op" id="6561358">,</span>&nbsp;<span class="ident" id="6561360">want</span>&nbsp;<span class="op" id="6561365">:=</span>&nbsp;<span class="keyword" id="6561368">range</span>&nbsp;<span class="ident" id="6561374">typeTests</span>&nbsp;<span class="op" id="6561384">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561388">val</span>&nbsp;<span class="op" id="6561392">:=</span>&nbsp;<span class="ident" id="6561395">TypeByExtension</span><span class="op" id="6561410">(</span><span class="ident" id="6561411">ext</span><span class="op" id="6561414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561418">if</span>&nbsp;<span class="ident" id="6561421">val</span>&nbsp;<span class="op" id="6561425">!=</span>&nbsp;<span class="ident" id="6561428">want</span>&nbsp;<span class="op" id="6561433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561438">t</span><span class="op" id="6561439">.</span><span class="ident" id="6561440">Errorf</span><span class="op" id="6561446">(</span><span class="string" id="6561447">&#34;TypeByExtension(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6561482">,</span>&nbsp;<span class="ident" id="6561484">ext</span><span class="op" id="6561487">,</span>&nbsp;<span class="ident" id="6561489">val</span><span class="op" id="6561492">,</span>&nbsp;<span class="ident" id="6561494">want</span><span class="op" id="6561498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6561502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6561505">}</span><br>
<span class="lineno">20</span><span class="op" id="6561507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6561510">func</span>&nbsp;<span class="ident" id="6561515">TestTypeByExtensionCase</span><span class="op" id="6561538">(</span><span class="ident" id="6561539">t</span>&nbsp;<span class="op" id="6561541">*</span><span class="ident" id="6561542">testing</span><span class="op" id="6561549">.</span><span class="ident" id="6561550">T</span><span class="op" id="6561551">)</span>&nbsp;<span class="op" id="6561553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561556">const</span>&nbsp;<span class="ident" id="6561562">custom</span>&nbsp;<span class="op" id="6561569">=</span>&nbsp;<span class="string" id="6561571">&#34;test/test;&nbsp;charset=iso-8859-1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561604">const</span>&nbsp;<span class="ident" id="6561610">caps</span>&nbsp;<span class="op" id="6561615">=</span>&nbsp;<span class="string" id="6561617">&#34;test/test;&nbsp;WAS=ALLCAPS&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561643">if</span>&nbsp;<span class="ident" id="6561646">err</span>&nbsp;<span class="op" id="6561650">:=</span>&nbsp;<span class="ident" id="6561653">AddExtensionType</span><span class="op" id="6561669">(</span><span class="string" id="6561670">&#34;.TEST&#34;</span><span class="op" id="6561677">,</span>&nbsp;<span class="ident" id="6561679">caps</span><span class="op" id="6561683">)</span><span class="op" id="6561684">;</span>&nbsp;<span class="ident" id="6561686">err</span>&nbsp;<span class="op" id="6561690">!=</span>&nbsp;<span class="ident" id="6561693">nil</span>&nbsp;<span class="op" id="6561697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561701">t</span><span class="op" id="6561702">.</span><span class="ident" id="6561703">Fatalf</span><span class="op" id="6561709">(</span><span class="string" id="6561710">&#34;error&nbsp;%s&nbsp;for&nbsp;AddExtension(%s)&#34;</span><span class="op" id="6561741">,</span>&nbsp;<span class="ident" id="6561743">err</span><span class="op" id="6561746">,</span>&nbsp;<span class="ident" id="6561748">custom</span><span class="op" id="6561754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6561757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561760">if</span>&nbsp;<span class="ident" id="6561763">err</span>&nbsp;<span class="op" id="6561767">:=</span>&nbsp;<span class="ident" id="6561770">AddExtensionType</span><span class="op" id="6561786">(</span><span class="string" id="6561787">&#34;.tesT&#34;</span><span class="op" id="6561794">,</span>&nbsp;<span class="ident" id="6561796">custom</span><span class="op" id="6561802">)</span><span class="op" id="6561803">;</span>&nbsp;<span class="ident" id="6561805">err</span>&nbsp;<span class="op" id="6561809">!=</span>&nbsp;<span class="ident" id="6561812">nil</span>&nbsp;<span class="op" id="6561816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561820">t</span><span class="op" id="6561821">.</span><span class="ident" id="6561822">Fatalf</span><span class="op" id="6561828">(</span><span class="string" id="6561829">&#34;error&nbsp;%s&nbsp;for&nbsp;AddExtension(%s)&#34;</span><span class="op" id="6561860">,</span>&nbsp;<span class="ident" id="6561862">err</span><span class="op" id="6561865">,</span>&nbsp;<span class="ident" id="6561867">custom</span><span class="op" id="6561873">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6561876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6561880">//&nbsp;case-sensitive&nbsp;lookup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561906">if</span>&nbsp;<span class="ident" id="6561909">got</span>&nbsp;<span class="op" id="6561913">:=</span>&nbsp;<span class="ident" id="6561916">TypeByExtension</span><span class="op" id="6561931">(</span><span class="string" id="6561932">&#34;.tesT&#34;</span><span class="op" id="6561939">)</span><span class="op" id="6561940">;</span>&nbsp;<span class="ident" id="6561942">got</span>&nbsp;<span class="op" id="6561946">!=</span>&nbsp;<span class="ident" id="6561949">custom</span>&nbsp;<span class="op" id="6561956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561960">t</span><span class="op" id="6561961">.</span><span class="ident" id="6561962">Fatalf</span><span class="op" id="6561968">(</span><span class="string" id="6561969">&#34;for&nbsp;.tesT,&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6561997">,</span>&nbsp;<span class="ident" id="6561999">got</span><span class="op" id="6562002">,</span>&nbsp;<span class="ident" id="6562004">custom</span><span class="op" id="6562010">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562016">if</span>&nbsp;<span class="ident" id="6562019">got</span>&nbsp;<span class="op" id="6562023">:=</span>&nbsp;<span class="ident" id="6562026">TypeByExtension</span><span class="op" id="6562041">(</span><span class="string" id="6562042">&#34;.TEST&#34;</span><span class="op" id="6562049">)</span><span class="op" id="6562050">;</span>&nbsp;<span class="ident" id="6562052">got</span>&nbsp;<span class="op" id="6562056">!=</span>&nbsp;<span class="ident" id="6562059">caps</span>&nbsp;<span class="op" id="6562064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562068">t</span><span class="op" id="6562069">.</span><span class="ident" id="6562070">Fatalf</span><span class="op" id="6562076">(</span><span class="string" id="6562077">&#34;for&nbsp;.TEST,&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6562105">,</span>&nbsp;<span class="ident" id="6562107">got</span><span class="op" id="6562110">,</span>&nbsp;<span class="ident" id="6562112">caps</span><span class="op" id="6562116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6562123">//&nbsp;case-insensitive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562144">if</span>&nbsp;<span class="ident" id="6562147">got</span>&nbsp;<span class="op" id="6562151">:=</span>&nbsp;<span class="ident" id="6562154">TypeByExtension</span><span class="op" id="6562169">(</span><span class="string" id="6562170">&#34;.TesT&#34;</span><span class="op" id="6562177">)</span><span class="op" id="6562178">;</span>&nbsp;<span class="ident" id="6562180">got</span>&nbsp;<span class="op" id="6562184">!=</span>&nbsp;<span class="ident" id="6562187">custom</span>&nbsp;<span class="op" id="6562194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562198">t</span><span class="op" id="6562199">.</span><span class="ident" id="6562200">Fatalf</span><span class="op" id="6562206">(</span><span class="string" id="6562207">&#34;for&nbsp;.TesT,&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6562235">,</span>&nbsp;<span class="ident" id="6562237">got</span><span class="op" id="6562240">,</span>&nbsp;<span class="ident" id="6562242">custom</span><span class="op" id="6562248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562251">}</span><br>
<span class="lineno"></span><span class="op" id="6562253">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6562256">func</span>&nbsp;<span class="ident" id="6562261">TestLookupMallocs</span><span class="op" id="6562278">(</span><span class="ident" id="6562279">t</span>&nbsp;<span class="op" id="6562281">*</span><span class="ident" id="6562282">testing</span><span class="op" id="6562289">.</span><span class="ident" id="6562290">T</span><span class="op" id="6562291">)</span>&nbsp;<span class="op" id="6562293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562296">n</span>&nbsp;<span class="op" id="6562298">:=</span>&nbsp;<span class="ident" id="6562301">testing</span><span class="op" id="6562308">.</span><span class="ident" id="6562309">AllocsPerRun</span><span class="op" id="6562321">(</span><span class="num" id="6562322">10000</span><span class="op" id="6562327">,</span>&nbsp;<span class="keyword" id="6562329">func</span><span class="op" id="6562333">(</span><span class="op" id="6562334">)</span>&nbsp;<span class="op" id="6562336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562340">TypeByExtension</span><span class="op" id="6562355">(</span><span class="string" id="6562356">&#34;.html&#34;</span><span class="op" id="6562363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562367">TypeByExtension</span><span class="op" id="6562382">(</span><span class="string" id="6562383">&#34;.HtML&#34;</span><span class="op" id="6562390">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562393">}</span><span class="op" id="6562394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562397">if</span>&nbsp;<span class="ident" id="6562400">n</span>&nbsp;<span class="op" id="6562402">&gt;</span>&nbsp;<span class="num" id="6562404">0</span>&nbsp;<span class="op" id="6562406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562410">t</span><span class="op" id="6562411">.</span><span class="ident" id="6562412">Errorf</span><span class="op" id="6562418">(</span><span class="string" id="6562419">&#34;allocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;0&#34;</span><span class="op" id="6562440">,</span>&nbsp;<span class="ident" id="6562442">n</span><span class="op" id="6562443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562446">}</span><br>
<span class="lineno"></span><span class="op" id="6562448">}</span>
</div>
</body>
</html>
