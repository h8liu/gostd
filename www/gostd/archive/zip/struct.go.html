<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2899417">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2899472">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2899526">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2899577">/*<br>
<span class="lineno"></span>Package&nbsp;zip&nbsp;provides&nbsp;support&nbsp;for&nbsp;reading&nbsp;and&nbsp;writing&nbsp;ZIP&nbsp;archives.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>See:&nbsp;http://www.pkware.com/documents/casestudies/APPNOTE.TXT<br>
<span class="lineno"></span><br>
<span class="lineno">10</span>This&nbsp;package&nbsp;does&nbsp;not&nbsp;support&nbsp;disk&nbsp;spanning.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>A&nbsp;note&nbsp;about&nbsp;ZIP64:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>To&nbsp;be&nbsp;backwards&nbsp;compatible&nbsp;the&nbsp;FileHeader&nbsp;has&nbsp;both&nbsp;32&nbsp;and&nbsp;64&nbsp;bit&nbsp;Size<br>
<span class="lineno">15</span>fields.&nbsp;The&nbsp;64&nbsp;bit&nbsp;fields&nbsp;will&nbsp;always&nbsp;contain&nbsp;the&nbsp;correct&nbsp;value&nbsp;and<br>
<span class="lineno"></span>for&nbsp;normal&nbsp;archives&nbsp;both&nbsp;fields&nbsp;will&nbsp;be&nbsp;the&nbsp;same.&nbsp;For&nbsp;files&nbsp;requiring<br>
<span class="lineno"></span>the&nbsp;ZIP64&nbsp;format&nbsp;the&nbsp;32&nbsp;bit&nbsp;fields&nbsp;will&nbsp;be&nbsp;0xffffffff&nbsp;and&nbsp;the&nbsp;64&nbsp;bit<br>
<span class="lineno"></span>fields&nbsp;must&nbsp;be&nbsp;used&nbsp;instead.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno">20</span><span class="keyword" id="2900086">package</span>&nbsp;<span class="ident" id="2900094">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2900099">import</span>&nbsp;<span class="op" id="2900106">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2900109">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2900115">&#34;path&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2900123">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="2900130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2900133">//&nbsp;Compression&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="2900157">const</span>&nbsp;<span class="op" id="2900163">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900166">Store</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2900174">uint16</span>&nbsp;<span class="op" id="2900181">=</span>&nbsp;<span class="num" id="2900183">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900186">Deflate</span>&nbsp;<span class="builtintype" id="2900194">uint16</span>&nbsp;<span class="op" id="2900201">=</span>&nbsp;<span class="num" id="2900203">8</span><br>
<span class="lineno"></span><span class="op" id="2900205">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2900208">const</span>&nbsp;<span class="op" id="2900214">(</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900217">fileHeaderSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900242">=</span>&nbsp;<span class="num" id="2900244">0x04034b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900256">directoryHeaderSignature</span>&nbsp;<span class="op" id="2900281">=</span>&nbsp;<span class="num" id="2900283">0x02014b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900295">directoryEndSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900320">=</span>&nbsp;<span class="num" id="2900322">0x06054b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900334">directory64LocSignature</span>&nbsp;&nbsp;<span class="op" id="2900359">=</span>&nbsp;<span class="num" id="2900361">0x07064b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900373">directory64EndSignature</span>&nbsp;&nbsp;<span class="op" id="2900398">=</span>&nbsp;<span class="num" id="2900400">0x06064b50</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900412">dataDescriptorSignature</span>&nbsp;&nbsp;<span class="op" id="2900437">=</span>&nbsp;<span class="num" id="2900439">0x08074b50</span>&nbsp;<span class="comment" id="2900450">//&nbsp;de-facto&nbsp;standard;&nbsp;required&nbsp;by&nbsp;OS&nbsp;X&nbsp;Finder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900497">fileHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900522">=</span>&nbsp;<span class="num" id="2900524">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2900535">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900558">directoryHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900583">=</span>&nbsp;<span class="num" id="2900585">46</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2900596">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900629">directoryEndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900654">=</span>&nbsp;<span class="num" id="2900656">22</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2900667">//&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900681">dataDescriptorLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900706">=</span>&nbsp;<span class="num" id="2900708">16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2900719">//&nbsp;four&nbsp;uint32:&nbsp;descriptor&nbsp;signature,&nbsp;crc32,&nbsp;compressed&nbsp;size,&nbsp;size</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900787">dataDescriptor64Len</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900812">=</span>&nbsp;<span class="num" id="2900814">24</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2900825">//&nbsp;descriptor&nbsp;with&nbsp;8&nbsp;byte&nbsp;sizes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900858">directory64LocLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900883">=</span>&nbsp;<span class="num" id="2900885">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2900896">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2900900">directory64EndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2900925">=</span>&nbsp;<span class="num" id="2900927">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2900938">//&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2900951">//&nbsp;Constants&nbsp;for&nbsp;the&nbsp;first&nbsp;byte&nbsp;in&nbsp;CreatorVersion</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901002">creatorFAT</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2901016">=</span>&nbsp;<span class="num" id="2901018">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901021">creatorUnix</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2901035">=</span>&nbsp;<span class="num" id="2901037">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901040">creatorNTFS</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2901054">=</span>&nbsp;<span class="num" id="2901056">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901060">creatorVFAT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2901074">=</span>&nbsp;<span class="num" id="2901076">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901080">creatorMacOSX</span>&nbsp;<span class="op" id="2901094">=</span>&nbsp;<span class="num" id="2901096">19</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901101">//&nbsp;version&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901121">zipVersion20</span>&nbsp;<span class="op" id="2901134">=</span>&nbsp;<span class="num" id="2901136">20</span>&nbsp;<span class="comment" id="2901139">//&nbsp;2.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901147">zipVersion45</span>&nbsp;<span class="op" id="2901160">=</span>&nbsp;<span class="num" id="2901162">45</span>&nbsp;<span class="comment" id="2901165">//&nbsp;4.5&nbsp;(reads&nbsp;and&nbsp;writes&nbsp;zip64&nbsp;archives)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901208">//&nbsp;limits&nbsp;for&nbsp;non&nbsp;zip64&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901239">uint16max</span>&nbsp;<span class="op" id="2901249">=</span>&nbsp;<span class="op" id="2901251">(</span><span class="num" id="2901252">1</span>&nbsp;<span class="op" id="2901254">&lt;&lt;</span>&nbsp;<span class="num" id="2901257">16</span><span class="op" id="2901259">)</span>&nbsp;<span class="op" id="2901261">-</span>&nbsp;<span class="num" id="2901263">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901266">uint32max</span>&nbsp;<span class="op" id="2901276">=</span>&nbsp;<span class="op" id="2901278">(</span><span class="num" id="2901279">1</span>&nbsp;<span class="op" id="2901281">&lt;&lt;</span>&nbsp;<span class="num" id="2901284">32</span><span class="op" id="2901286">)</span>&nbsp;<span class="op" id="2901288">-</span>&nbsp;<span class="num" id="2901290">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901294">//&nbsp;extra&nbsp;header&nbsp;id&#39;s</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901316">zip64ExtraId</span>&nbsp;<span class="op" id="2901329">=</span>&nbsp;<span class="num" id="2901331">0x0001</span>&nbsp;<span class="comment" id="2901338">//&nbsp;zip64&nbsp;Extended&nbsp;Information&nbsp;Extra&nbsp;Field</span><br>
<span class="lineno"></span><span class="op" id="2901380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2901383">//&nbsp;FileHeader&nbsp;describes&nbsp;a&nbsp;file&nbsp;within&nbsp;a&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2901433">//&nbsp;See&nbsp;the&nbsp;zip&nbsp;spec&nbsp;for&nbsp;details.</span><br>
<span class="lineno">70</span><span class="keyword" id="2901466">type</span>&nbsp;<span class="ident" id="2901471">FileHeader</span>&nbsp;<span class="keyword" id="2901482">struct</span>&nbsp;<span class="op" id="2901489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901492">//&nbsp;Name&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901526">//&nbsp;It&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901589">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2901653">//&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901670">Name</span>&nbsp;<span class="builtintype" id="2901675">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901684">CreatorVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2901703">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901711">ReaderVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2901730">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901738">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2901757">uint16</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901765">Method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2901784">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901792">ModifiedTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2901811">uint16</span>&nbsp;<span class="comment" id="2901818">//&nbsp;MS-DOS&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901834">ModifiedDate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2901853">uint16</span>&nbsp;<span class="comment" id="2901860">//&nbsp;MS-DOS&nbsp;date</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901876">CRC32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2901895">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901903">CompressedSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2901922">uint32</span>&nbsp;<span class="comment" id="2901929">//&nbsp;deprecated;&nbsp;use&nbsp;CompressedSize64</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2901966">UncompressedSize</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2901985">uint32</span>&nbsp;<span class="comment" id="2901992">//&nbsp;deprecated;&nbsp;use&nbsp;UncompressedSize64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2902031">CompressedSize64</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2902050">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2902058">UncompressedSize64</span>&nbsp;<span class="ident" id="2902077">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2902085">Extra</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2902104">[</span><span class="op" id="2902105">]</span><span class="builtintype" id="2902106">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2902112">ExternalAttrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2902131">uint32</span>&nbsp;<span class="comment" id="2902138">//&nbsp;Meaning&nbsp;depends&nbsp;on&nbsp;CreatorVersion</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2902176">Comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2902195">string</span><br>
<span class="lineno"></span><span class="op" id="2902202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2902205">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="2902260">func</span>&nbsp;<span class="op" id="2902265">(</span><span class="ident" id="2902266">h</span>&nbsp;<span class="op" id="2902268">*</span><span class="ident" id="2902269">FileHeader</span><span class="op" id="2902279">)</span>&nbsp;<span class="ident" id="2902281">FileInfo</span><span class="op" id="2902289">(</span><span class="op" id="2902290">)</span>&nbsp;<span class="ident" id="2902292">os</span><span class="op" id="2902294">.</span><span class="ident" id="2902295">FileInfo</span>&nbsp;<span class="op" id="2902304">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902307">return</span>&nbsp;<span class="ident" id="2902314">headerFileInfo</span><span class="op" id="2902328">{</span><span class="ident" id="2902329">h</span><span class="op" id="2902330">}</span><br>
<span class="lineno"></span><span class="op" id="2902332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2902335">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="2902377">type</span>&nbsp;<span class="ident" id="2902382">headerFileInfo</span>&nbsp;<span class="keyword" id="2902397">struct</span>&nbsp;<span class="op" id="2902404">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2902407">fh</span>&nbsp;<span class="op" id="2902410">*</span><span class="ident" id="2902411">FileHeader</span><br>
<span class="lineno"></span><span class="op" id="2902422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2902425">func</span>&nbsp;<span class="op" id="2902430">(</span><span class="ident" id="2902431">fi</span>&nbsp;<span class="ident" id="2902434">headerFileInfo</span><span class="op" id="2902448">)</span>&nbsp;<span class="ident" id="2902450">Name</span><span class="op" id="2902454">(</span><span class="op" id="2902455">)</span>&nbsp;<span class="builtintype" id="2902457">string</span>&nbsp;<span class="op" id="2902464">{</span>&nbsp;<span class="keyword" id="2902466">return</span>&nbsp;<span class="ident" id="2902473">path</span><span class="op" id="2902477">.</span><span class="ident" id="2902478">Base</span><span class="op" id="2902482">(</span><span class="ident" id="2902483">fi</span><span class="op" id="2902485">.</span><span class="ident" id="2902486">fh</span><span class="op" id="2902488">.</span><span class="ident" id="2902489">Name</span><span class="op" id="2902493">)</span>&nbsp;<span class="op" id="2902495">}</span><br>
<span class="lineno"></span><span class="keyword" id="2902497">func</span>&nbsp;<span class="op" id="2902502">(</span><span class="ident" id="2902503">fi</span>&nbsp;<span class="ident" id="2902506">headerFileInfo</span><span class="op" id="2902520">)</span>&nbsp;<span class="ident" id="2902522">Size</span><span class="op" id="2902526">(</span><span class="op" id="2902527">)</span>&nbsp;<span class="ident" id="2902529">int64</span>&nbsp;<span class="op" id="2902535">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902538">if</span>&nbsp;<span class="ident" id="2902541">fi</span><span class="op" id="2902543">.</span><span class="ident" id="2902544">fh</span><span class="op" id="2902546">.</span><span class="ident" id="2902547">UncompressedSize64</span>&nbsp;<span class="op" id="2902566">&gt;</span>&nbsp;<span class="num" id="2902568">0</span>&nbsp;<span class="op" id="2902570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902574">return</span>&nbsp;<span class="ident" id="2902581">int64</span><span class="op" id="2902586">(</span><span class="ident" id="2902587">fi</span><span class="op" id="2902589">.</span><span class="ident" id="2902590">fh</span><span class="op" id="2902592">.</span><span class="ident" id="2902593">UncompressedSize64</span><span class="op" id="2902611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2902614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2902617">return</span>&nbsp;<span class="ident" id="2902624">int64</span><span class="op" id="2902629">(</span><span class="ident" id="2902630">fi</span><span class="op" id="2902632">.</span><span class="ident" id="2902633">fh</span><span class="op" id="2902635">.</span><span class="ident" id="2902636">UncompressedSize</span><span class="op" id="2902652">)</span><br>
<span class="lineno"></span><span class="op" id="2902654">}</span><br>
<span class="lineno">110</span><span class="keyword" id="2902656">func</span>&nbsp;<span class="op" id="2902661">(</span><span class="ident" id="2902662">fi</span>&nbsp;<span class="ident" id="2902665">headerFileInfo</span><span class="op" id="2902679">)</span>&nbsp;<span class="ident" id="2902681">IsDir</span><span class="op" id="2902686">(</span><span class="op" id="2902687">)</span>&nbsp;<span class="builtintype" id="2902689">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2902701">{</span>&nbsp;<span class="keyword" id="2902703">return</span>&nbsp;<span class="ident" id="2902710">fi</span><span class="op" id="2902712">.</span><span class="ident" id="2902713">Mode</span><span class="op" id="2902717">(</span><span class="op" id="2902718">)</span><span class="op" id="2902719">.</span><span class="ident" id="2902720">IsDir</span><span class="op" id="2902725">(</span><span class="op" id="2902726">)</span>&nbsp;<span class="op" id="2902728">}</span><br>
<span class="lineno"></span><span class="keyword" id="2902730">func</span>&nbsp;<span class="op" id="2902735">(</span><span class="ident" id="2902736">fi</span>&nbsp;<span class="ident" id="2902739">headerFileInfo</span><span class="op" id="2902753">)</span>&nbsp;<span class="ident" id="2902755">ModTime</span><span class="op" id="2902762">(</span><span class="op" id="2902763">)</span>&nbsp;<span class="ident" id="2902765">time</span><span class="op" id="2902769">.</span><span class="ident" id="2902770">Time</span>&nbsp;<span class="op" id="2902775">{</span>&nbsp;<span class="keyword" id="2902777">return</span>&nbsp;<span class="ident" id="2902784">fi</span><span class="op" id="2902786">.</span><span class="ident" id="2902787">fh</span><span class="op" id="2902789">.</span><span class="ident" id="2902790">ModTime</span><span class="op" id="2902797">(</span><span class="op" id="2902798">)</span>&nbsp;<span class="op" id="2902800">}</span><br>
<span class="lineno"></span><span class="keyword" id="2902802">func</span>&nbsp;<span class="op" id="2902807">(</span><span class="ident" id="2902808">fi</span>&nbsp;<span class="ident" id="2902811">headerFileInfo</span><span class="op" id="2902825">)</span>&nbsp;<span class="ident" id="2902827">Mode</span><span class="op" id="2902831">(</span><span class="op" id="2902832">)</span>&nbsp;<span class="ident" id="2902834">os</span><span class="op" id="2902836">.</span><span class="ident" id="2902837">FileMode</span>&nbsp;&nbsp;<span class="op" id="2902847">{</span>&nbsp;<span class="keyword" id="2902849">return</span>&nbsp;<span class="ident" id="2902856">fi</span><span class="op" id="2902858">.</span><span class="ident" id="2902859">fh</span><span class="op" id="2902861">.</span><span class="ident" id="2902862">Mode</span><span class="op" id="2902866">(</span><span class="op" id="2902867">)</span>&nbsp;<span class="op" id="2902869">}</span><br>
<span class="lineno"></span><span class="keyword" id="2902871">func</span>&nbsp;<span class="op" id="2902876">(</span><span class="ident" id="2902877">fi</span>&nbsp;<span class="ident" id="2902880">headerFileInfo</span><span class="op" id="2902894">)</span>&nbsp;<span class="ident" id="2902896">Sys</span><span class="op" id="2902899">(</span><span class="op" id="2902900">)</span>&nbsp;<span class="keyword" id="2902902">interface</span><span class="op" id="2902911">{</span><span class="op" id="2902912">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2902916">{</span>&nbsp;<span class="keyword" id="2902918">return</span>&nbsp;<span class="ident" id="2902925">fi</span><span class="op" id="2902927">.</span><span class="ident" id="2902928">fh</span>&nbsp;<span class="op" id="2902931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="2902934">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;FileHeader&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2903001">//&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="comment" id="2903017">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2903084">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="2903155">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">120</span><span class="keyword" id="2903224">func</span>&nbsp;<span class="ident" id="2903229">FileInfoHeader</span><span class="op" id="2903243">(</span><span class="ident" id="2903244">fi</span>&nbsp;<span class="ident" id="2903247">os</span><span class="op" id="2903249">.</span><span class="ident" id="2903250">FileInfo</span><span class="op" id="2903258">)</span>&nbsp;<span class="op" id="2903260">(</span><span class="op" id="2903261">*</span><span class="ident" id="2903262">FileHeader</span><span class="op" id="2903272">,</span>&nbsp;<span class="builtintype" id="2903274">error</span><span class="op" id="2903279">)</span>&nbsp;<span class="op" id="2903281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903284">size</span>&nbsp;<span class="op" id="2903289">:=</span>&nbsp;<span class="ident" id="2903292">fi</span><span class="op" id="2903294">.</span><span class="ident" id="2903295">Size</span><span class="op" id="2903299">(</span><span class="op" id="2903300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903303">fh</span>&nbsp;<span class="op" id="2903306">:=</span>&nbsp;<span class="op" id="2903309">&amp;</span><span class="ident" id="2903310">FileHeader</span><span class="op" id="2903320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903324">Name</span><span class="op" id="2903328">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2903344">fi</span><span class="op" id="2903346">.</span><span class="ident" id="2903347">Name</span><span class="op" id="2903351">(</span><span class="op" id="2903352">)</span><span class="op" id="2903353">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903357">UncompressedSize64</span><span class="op" id="2903375">:</span>&nbsp;<span class="ident" id="2903377">uint64</span><span class="op" id="2903383">(</span><span class="ident" id="2903384">size</span><span class="op" id="2903388">)</span><span class="op" id="2903389">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2903392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903395">fh</span><span class="op" id="2903397">.</span><span class="ident" id="2903398">SetModTime</span><span class="op" id="2903408">(</span><span class="ident" id="2903409">fi</span><span class="op" id="2903411">.</span><span class="ident" id="2903412">ModTime</span><span class="op" id="2903419">(</span><span class="op" id="2903420">)</span><span class="op" id="2903421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903424">fh</span><span class="op" id="2903426">.</span><span class="ident" id="2903427">SetMode</span><span class="op" id="2903434">(</span><span class="ident" id="2903435">fi</span><span class="op" id="2903437">.</span><span class="ident" id="2903438">Mode</span><span class="op" id="2903442">(</span><span class="op" id="2903443">)</span><span class="op" id="2903444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2903447">if</span>&nbsp;<span class="ident" id="2903450">fh</span><span class="op" id="2903452">.</span><span class="ident" id="2903453">UncompressedSize64</span>&nbsp;<span class="op" id="2903472">&gt;</span>&nbsp;<span class="ident" id="2903474">uint32max</span>&nbsp;<span class="op" id="2903484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903488">fh</span><span class="op" id="2903490">.</span><span class="ident" id="2903491">UncompressedSize</span>&nbsp;<span class="op" id="2903508">=</span>&nbsp;<span class="ident" id="2903510">uint32max</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2903521">}</span>&nbsp;<span class="keyword" id="2903523">else</span>&nbsp;<span class="op" id="2903528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903532">fh</span><span class="op" id="2903534">.</span><span class="ident" id="2903535">UncompressedSize</span>&nbsp;<span class="op" id="2903552">=</span>&nbsp;<span class="builtintype" id="2903554">uint32</span><span class="op" id="2903560">(</span><span class="ident" id="2903561">fh</span><span class="op" id="2903563">.</span><span class="ident" id="2903564">UncompressedSize64</span><span class="op" id="2903582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2903585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2903588">return</span>&nbsp;<span class="ident" id="2903595">fh</span><span class="op" id="2903597">,</span>&nbsp;<span class="ident" id="2903599">nil</span><br>
<span class="lineno"></span><span class="op" id="2903603">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="2903606">type</span>&nbsp;<span class="ident" id="2903611">directoryEnd</span>&nbsp;<span class="keyword" id="2903624">struct</span>&nbsp;<span class="op" id="2903631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903634">diskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2903653">uint32</span>&nbsp;<span class="comment" id="2903660">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903671">dirDiskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2903690">uint32</span>&nbsp;<span class="comment" id="2903697">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903708">dirRecordsThisDisk</span>&nbsp;<span class="ident" id="2903727">uint64</span>&nbsp;<span class="comment" id="2903734">//&nbsp;unused</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903745">directoryRecords</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2903764">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903772">directorySize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2903791">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903799">directoryOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2903818">uint64</span>&nbsp;<span class="comment" id="2903825">//&nbsp;relative&nbsp;to&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903846">commentLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2903865">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2903873">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2903892">string</span><br>
<span class="lineno">145</span><span class="op" id="2903899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2903902">//&nbsp;msDosTimeToTime&nbsp;converts&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time&nbsp;into&nbsp;a&nbsp;time.Time.</span><br>
<span class="lineno"></span><span class="comment" id="2903972">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="2903997">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724247(v=VS.85).aspx</span><br>
<span class="lineno">150</span><span class="keyword" id="2904068">func</span>&nbsp;<span class="ident" id="2904073">msDosTimeToTime</span><span class="op" id="2904088">(</span><span class="ident" id="2904089">dosDate</span><span class="op" id="2904096">,</span>&nbsp;<span class="ident" id="2904098">dosTime</span>&nbsp;<span class="builtintype" id="2904106">uint16</span><span class="op" id="2904112">)</span>&nbsp;<span class="ident" id="2904114">time</span><span class="op" id="2904118">.</span><span class="ident" id="2904119">Time</span>&nbsp;<span class="op" id="2904124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2904127">return</span>&nbsp;<span class="ident" id="2904134">time</span><span class="op" id="2904138">.</span><span class="ident" id="2904139">Date</span><span class="op" id="2904143">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2904147">//&nbsp;date&nbsp;bits&nbsp;0-4:&nbsp;day&nbsp;of&nbsp;month;&nbsp;5-8:&nbsp;month;&nbsp;9-15:&nbsp;years&nbsp;since&nbsp;1980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2904216">int</span><span class="op" id="2904219">(</span><span class="ident" id="2904220">dosDate</span><span class="op" id="2904227">&gt;&gt;</span><span class="num" id="2904229">9</span><span class="op" id="2904230">+</span><span class="num" id="2904231">1980</span><span class="op" id="2904235">)</span><span class="op" id="2904236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2904240">time</span><span class="op" id="2904244">.</span><span class="ident" id="2904245">Month</span><span class="op" id="2904250">(</span><span class="ident" id="2904251">dosDate</span><span class="op" id="2904258">&gt;&gt;</span><span class="num" id="2904260">5</span><span class="op" id="2904261">&amp;</span><span class="num" id="2904262">0xf</span><span class="op" id="2904265">)</span><span class="op" id="2904266">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2904270">int</span><span class="op" id="2904273">(</span><span class="ident" id="2904274">dosDate</span><span class="op" id="2904281">&amp;</span><span class="num" id="2904282">0x1f</span><span class="op" id="2904286">)</span><span class="op" id="2904287">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2904292">//&nbsp;time&nbsp;bits&nbsp;0-4:&nbsp;second/2;&nbsp;5-10:&nbsp;minute;&nbsp;11-15:&nbsp;hour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2904348">int</span><span class="op" id="2904351">(</span><span class="ident" id="2904352">dosTime</span><span class="op" id="2904359">&gt;&gt;</span><span class="num" id="2904361">11</span><span class="op" id="2904363">)</span><span class="op" id="2904364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2904368">int</span><span class="op" id="2904371">(</span><span class="ident" id="2904372">dosTime</span><span class="op" id="2904379">&gt;&gt;</span><span class="num" id="2904381">5</span><span class="op" id="2904382">&amp;</span><span class="num" id="2904383">0x3f</span><span class="op" id="2904387">)</span><span class="op" id="2904388">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2904392">int</span><span class="op" id="2904395">(</span><span class="ident" id="2904396">dosTime</span><span class="op" id="2904403">&amp;</span><span class="num" id="2904404">0x1f</span><span class="op" id="2904408">*</span><span class="num" id="2904409">2</span><span class="op" id="2904410">)</span><span class="op" id="2904411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="2904415">0</span><span class="op" id="2904416">,</span>&nbsp;<span class="comment" id="2904418">//&nbsp;nanoseconds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2904436">time</span><span class="op" id="2904440">.</span><span class="ident" id="2904441">UTC</span><span class="op" id="2904444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2904447">)</span><br>
<span class="lineno">165</span><span class="op" id="2904449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2904452">//&nbsp;timeToMsDosTime&nbsp;converts&nbsp;a&nbsp;time.Time&nbsp;to&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="2904520">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="2904545">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724274(v=VS.85).aspx</span><br>
<span class="lineno">170</span><span class="keyword" id="2904616">func</span>&nbsp;<span class="ident" id="2904621">timeToMsDosTime</span><span class="op" id="2904636">(</span><span class="ident" id="2904637">t</span>&nbsp;<span class="ident" id="2904639">time</span><span class="op" id="2904643">.</span><span class="ident" id="2904644">Time</span><span class="op" id="2904648">)</span>&nbsp;<span class="op" id="2904650">(</span><span class="ident" id="2904651">fDate</span>&nbsp;<span class="builtintype" id="2904657">uint16</span><span class="op" id="2904663">,</span>&nbsp;<span class="ident" id="2904665">fTime</span>&nbsp;<span class="builtintype" id="2904671">uint16</span><span class="op" id="2904677">)</span>&nbsp;<span class="op" id="2904679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2904682">t</span>&nbsp;<span class="op" id="2904684">=</span>&nbsp;<span class="ident" id="2904686">t</span><span class="op" id="2904687">.</span><span class="ident" id="2904688">In</span><span class="op" id="2904690">(</span><span class="ident" id="2904691">time</span><span class="op" id="2904695">.</span><span class="ident" id="2904696">UTC</span><span class="op" id="2904699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2904702">fDate</span>&nbsp;<span class="op" id="2904708">=</span>&nbsp;<span class="builtintype" id="2904710">uint16</span><span class="op" id="2904716">(</span><span class="ident" id="2904717">t</span><span class="op" id="2904718">.</span><span class="ident" id="2904719">Day</span><span class="op" id="2904722">(</span><span class="op" id="2904723">)</span>&nbsp;<span class="op" id="2904725">+</span>&nbsp;<span class="builtintype" id="2904727">int</span><span class="op" id="2904730">(</span><span class="ident" id="2904731">t</span><span class="op" id="2904732">.</span><span class="ident" id="2904733">Month</span><span class="op" id="2904738">(</span><span class="op" id="2904739">)</span><span class="op" id="2904740">)</span><span class="op" id="2904741">&lt;&lt;</span><span class="num" id="2904743">5</span>&nbsp;<span class="op" id="2904745">+</span>&nbsp;<span class="op" id="2904747">(</span><span class="ident" id="2904748">t</span><span class="op" id="2904749">.</span><span class="ident" id="2904750">Year</span><span class="op" id="2904754">(</span><span class="op" id="2904755">)</span><span class="op" id="2904756">-</span><span class="num" id="2904757">1980</span><span class="op" id="2904761">)</span><span class="op" id="2904762">&lt;&lt;</span><span class="num" id="2904764">9</span><span class="op" id="2904765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2904768">fTime</span>&nbsp;<span class="op" id="2904774">=</span>&nbsp;<span class="builtintype" id="2904776">uint16</span><span class="op" id="2904782">(</span><span class="ident" id="2904783">t</span><span class="op" id="2904784">.</span><span class="ident" id="2904785">Second</span><span class="op" id="2904791">(</span><span class="op" id="2904792">)</span><span class="op" id="2904793">/</span><span class="num" id="2904794">2</span>&nbsp;<span class="op" id="2904796">+</span>&nbsp;<span class="ident" id="2904798">t</span><span class="op" id="2904799">.</span><span class="ident" id="2904800">Minute</span><span class="op" id="2904806">(</span><span class="op" id="2904807">)</span><span class="op" id="2904808">&lt;&lt;</span><span class="num" id="2904810">5</span>&nbsp;<span class="op" id="2904812">+</span>&nbsp;<span class="ident" id="2904814">t</span><span class="op" id="2904815">.</span><span class="ident" id="2904816">Hour</span><span class="op" id="2904820">(</span><span class="op" id="2904821">)</span><span class="op" id="2904822">&lt;&lt;</span><span class="num" id="2904824">11</span><span class="op" id="2904826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2904829">return</span><br>
<span class="lineno">175</span><span class="op" id="2904836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2904839">//&nbsp;ModTime&nbsp;returns&nbsp;the&nbsp;modification&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="2904888">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="keyword" id="2904913">func</span>&nbsp;<span class="op" id="2904918">(</span><span class="ident" id="2904919">h</span>&nbsp;<span class="op" id="2904921">*</span><span class="ident" id="2904922">FileHeader</span><span class="op" id="2904932">)</span>&nbsp;<span class="ident" id="2904934">ModTime</span><span class="op" id="2904941">(</span><span class="op" id="2904942">)</span>&nbsp;<span class="ident" id="2904944">time</span><span class="op" id="2904948">.</span><span class="ident" id="2904949">Time</span>&nbsp;<span class="op" id="2904954">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2904957">return</span>&nbsp;<span class="ident" id="2904964">msDosTimeToTime</span><span class="op" id="2904979">(</span><span class="ident" id="2904980">h</span><span class="op" id="2904981">.</span><span class="ident" id="2904982">ModifiedDate</span><span class="op" id="2904994">,</span>&nbsp;<span class="ident" id="2904996">h</span><span class="op" id="2904997">.</span><span class="ident" id="2904998">ModifiedTime</span><span class="op" id="2905010">)</span><br>
<span class="lineno"></span><span class="op" id="2905012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2905015">//&nbsp;SetModTime&nbsp;sets&nbsp;the&nbsp;ModifiedTime&nbsp;and&nbsp;ModifiedDate&nbsp;fields&nbsp;to&nbsp;the&nbsp;given&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="2905101">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno">185</span><span class="keyword" id="2905126">func</span>&nbsp;<span class="op" id="2905131">(</span><span class="ident" id="2905132">h</span>&nbsp;<span class="op" id="2905134">*</span><span class="ident" id="2905135">FileHeader</span><span class="op" id="2905145">)</span>&nbsp;<span class="ident" id="2905147">SetModTime</span><span class="op" id="2905157">(</span><span class="ident" id="2905158">t</span>&nbsp;<span class="ident" id="2905160">time</span><span class="op" id="2905164">.</span><span class="ident" id="2905165">Time</span><span class="op" id="2905169">)</span>&nbsp;<span class="op" id="2905171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905174">h</span><span class="op" id="2905175">.</span><span class="ident" id="2905176">ModifiedDate</span><span class="op" id="2905188">,</span>&nbsp;<span class="ident" id="2905190">h</span><span class="op" id="2905191">.</span><span class="ident" id="2905192">ModifiedTime</span>&nbsp;<span class="op" id="2905205">=</span>&nbsp;<span class="ident" id="2905207">timeToMsDosTime</span><span class="op" id="2905222">(</span><span class="ident" id="2905223">t</span><span class="op" id="2905224">)</span><br>
<span class="lineno"></span><span class="op" id="2905226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2905229">const</span>&nbsp;<span class="op" id="2905235">(</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2905238">//&nbsp;Unix&nbsp;constants.&nbsp;The&nbsp;specification&nbsp;doesn&#39;t&nbsp;mention&nbsp;them,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2905298">//&nbsp;but&nbsp;these&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;values&nbsp;agreed&nbsp;on&nbsp;by&nbsp;tools.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905354">s_IFMT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2905363">=</span>&nbsp;<span class="num" id="2905365">0xf000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905373">s_IFSOCK</span>&nbsp;<span class="op" id="2905382">=</span>&nbsp;<span class="num" id="2905384">0xc000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905392">s_IFLNK</span>&nbsp;&nbsp;<span class="op" id="2905401">=</span>&nbsp;<span class="num" id="2905403">0xa000</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905411">s_IFREG</span>&nbsp;&nbsp;<span class="op" id="2905420">=</span>&nbsp;<span class="num" id="2905422">0x8000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905430">s_IFBLK</span>&nbsp;&nbsp;<span class="op" id="2905439">=</span>&nbsp;<span class="num" id="2905441">0x6000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905449">s_IFDIR</span>&nbsp;&nbsp;<span class="op" id="2905458">=</span>&nbsp;<span class="num" id="2905460">0x4000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905468">s_IFCHR</span>&nbsp;&nbsp;<span class="op" id="2905477">=</span>&nbsp;<span class="num" id="2905479">0x2000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905487">s_IFIFO</span>&nbsp;&nbsp;<span class="op" id="2905496">=</span>&nbsp;<span class="num" id="2905498">0x1000</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905506">s_ISUID</span>&nbsp;&nbsp;<span class="op" id="2905515">=</span>&nbsp;<span class="num" id="2905517">0x800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905524">s_ISGID</span>&nbsp;&nbsp;<span class="op" id="2905533">=</span>&nbsp;<span class="num" id="2905535">0x400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905542">s_ISVTX</span>&nbsp;&nbsp;<span class="op" id="2905551">=</span>&nbsp;<span class="num" id="2905553">0x200</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905561">msdosDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2905575">=</span>&nbsp;<span class="num" id="2905577">0x10</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905583">msdosReadOnly</span>&nbsp;<span class="op" id="2905597">=</span>&nbsp;<span class="num" id="2905599">0x01</span><br>
<span class="lineno"></span><span class="op" id="2905604">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2905607">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="2905672">func</span>&nbsp;<span class="op" id="2905677">(</span><span class="ident" id="2905678">h</span>&nbsp;<span class="op" id="2905680">*</span><span class="ident" id="2905681">FileHeader</span><span class="op" id="2905691">)</span>&nbsp;<span class="ident" id="2905693">Mode</span><span class="op" id="2905697">(</span><span class="op" id="2905698">)</span>&nbsp;<span class="op" id="2905700">(</span><span class="ident" id="2905701">mode</span>&nbsp;<span class="ident" id="2905706">os</span><span class="op" id="2905708">.</span><span class="ident" id="2905709">FileMode</span><span class="op" id="2905717">)</span>&nbsp;<span class="op" id="2905719">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2905722">switch</span>&nbsp;<span class="ident" id="2905729">h</span><span class="op" id="2905730">.</span><span class="ident" id="2905731">CreatorVersion</span>&nbsp;<span class="op" id="2905746">&gt;&gt;</span>&nbsp;<span class="num" id="2905749">8</span>&nbsp;<span class="op" id="2905751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2905754">case</span>&nbsp;<span class="ident" id="2905759">creatorUnix</span><span class="op" id="2905770">,</span>&nbsp;<span class="ident" id="2905772">creatorMacOSX</span><span class="op" id="2905785">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905789">mode</span>&nbsp;<span class="op" id="2905794">=</span>&nbsp;<span class="ident" id="2905796">unixModeToFileMode</span><span class="op" id="2905814">(</span><span class="ident" id="2905815">h</span><span class="op" id="2905816">.</span><span class="ident" id="2905817">ExternalAttrs</span>&nbsp;<span class="op" id="2905831">&gt;&gt;</span>&nbsp;<span class="num" id="2905834">16</span><span class="op" id="2905836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2905839">case</span>&nbsp;<span class="ident" id="2905844">creatorNTFS</span><span class="op" id="2905855">,</span>&nbsp;<span class="ident" id="2905857">creatorVFAT</span><span class="op" id="2905868">,</span>&nbsp;<span class="ident" id="2905870">creatorFAT</span><span class="op" id="2905880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905884">mode</span>&nbsp;<span class="op" id="2905889">=</span>&nbsp;<span class="ident" id="2905891">msdosModeToFileMode</span><span class="op" id="2905910">(</span><span class="ident" id="2905911">h</span><span class="op" id="2905912">.</span><span class="ident" id="2905913">ExternalAttrs</span><span class="op" id="2905926">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2905929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2905932">if</span>&nbsp;<span class="builtinfunc" id="2905935">len</span><span class="op" id="2905938">(</span><span class="ident" id="2905939">h</span><span class="op" id="2905940">.</span><span class="ident" id="2905941">Name</span><span class="op" id="2905945">)</span>&nbsp;<span class="op" id="2905947">&gt;</span>&nbsp;<span class="num" id="2905949">0</span>&nbsp;<span class="op" id="2905951">&amp;&amp;</span>&nbsp;<span class="ident" id="2905954">h</span><span class="op" id="2905955">.</span><span class="ident" id="2905956">Name</span><span class="op" id="2905960">[</span><span class="builtinfunc" id="2905961">len</span><span class="op" id="2905964">(</span><span class="ident" id="2905965">h</span><span class="op" id="2905966">.</span><span class="ident" id="2905967">Name</span><span class="op" id="2905971">)</span><span class="op" id="2905972">-</span><span class="num" id="2905973">1</span><span class="op" id="2905974">]</span>&nbsp;<span class="op" id="2905976">==</span>&nbsp;<span class="string" id="2905979">&#39;/&#39;</span>&nbsp;<span class="op" id="2905983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2905987">mode</span>&nbsp;<span class="op" id="2905992">|=</span>&nbsp;<span class="ident" id="2905995">os</span><span class="op" id="2905997">.</span><span class="ident" id="2905998">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2906007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2906010">return</span>&nbsp;<span class="ident" id="2906017">mode</span><br>
<span class="lineno">220</span><span class="op" id="2906022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2906025">//&nbsp;SetMode&nbsp;changes&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="2906093">func</span>&nbsp;<span class="op" id="2906098">(</span><span class="ident" id="2906099">h</span>&nbsp;<span class="op" id="2906101">*</span><span class="ident" id="2906102">FileHeader</span><span class="op" id="2906112">)</span>&nbsp;<span class="ident" id="2906114">SetMode</span><span class="op" id="2906121">(</span><span class="ident" id="2906122">mode</span>&nbsp;<span class="ident" id="2906127">os</span><span class="op" id="2906129">.</span><span class="ident" id="2906130">FileMode</span><span class="op" id="2906138">)</span>&nbsp;<span class="op" id="2906140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2906143">h</span><span class="op" id="2906144">.</span><span class="ident" id="2906145">CreatorVersion</span>&nbsp;<span class="op" id="2906160">=</span>&nbsp;<span class="ident" id="2906162">h</span><span class="op" id="2906163">.</span><span class="ident" id="2906164">CreatorVersion</span><span class="op" id="2906178">&amp;</span><span class="num" id="2906179">0xff</span>&nbsp;<span class="op" id="2906184">|</span>&nbsp;<span class="ident" id="2906186">creatorUnix</span><span class="op" id="2906197">&lt;&lt;</span><span class="num" id="2906199">8</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2906202">h</span><span class="op" id="2906203">.</span><span class="ident" id="2906204">ExternalAttrs</span>&nbsp;<span class="op" id="2906218">=</span>&nbsp;<span class="ident" id="2906220">fileModeToUnixMode</span><span class="op" id="2906238">(</span><span class="ident" id="2906239">mode</span><span class="op" id="2906243">)</span>&nbsp;<span class="op" id="2906245">&lt;&lt;</span>&nbsp;<span class="num" id="2906248">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2906253">//&nbsp;set&nbsp;MSDOS&nbsp;attributes&nbsp;too,&nbsp;as&nbsp;the&nbsp;original&nbsp;zip&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2906309">if</span>&nbsp;<span class="ident" id="2906312">mode</span><span class="op" id="2906316">&amp;</span><span class="ident" id="2906317">os</span><span class="op" id="2906319">.</span><span class="ident" id="2906320">ModeDir</span>&nbsp;<span class="op" id="2906328">!=</span>&nbsp;<span class="num" id="2906331">0</span>&nbsp;<span class="op" id="2906333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2906337">h</span><span class="op" id="2906338">.</span><span class="ident" id="2906339">ExternalAttrs</span>&nbsp;<span class="op" id="2906353">|=</span>&nbsp;<span class="ident" id="2906356">msdosDir</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2906366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2906369">if</span>&nbsp;<span class="ident" id="2906372">mode</span><span class="op" id="2906376">&amp;</span><span class="num" id="2906377">0200</span>&nbsp;<span class="op" id="2906382">==</span>&nbsp;<span class="num" id="2906385">0</span>&nbsp;<span class="op" id="2906387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2906391">h</span><span class="op" id="2906392">.</span><span class="ident" id="2906393">ExternalAttrs</span>&nbsp;<span class="op" id="2906407">|=</span>&nbsp;<span class="ident" id="2906410">msdosReadOnly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2906425">}</span><br>
<span class="lineno"></span><span class="op" id="2906427">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="2906430">//&nbsp;isZip64&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;exceeds&nbsp;the&nbsp;32&nbsp;bit&nbsp;limit</span><br>
<span class="lineno"></span><span class="keyword" id="2906496">func</span>&nbsp;<span class="op" id="2906501">(</span><span class="ident" id="2906502">fh</span>&nbsp;<span class="op" id="2906505">*</span><span class="ident" id="2906506">FileHeader</span><span class="op" id="2906516">)</span>&nbsp;<span class="ident" id="2906518">isZip64</span><span class="op" id="2906525">(</span><span class="op" id="2906526">)</span>&nbsp;<span class="builtintype" id="2906528">bool</span>&nbsp;<span class="op" id="2906533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2906536">return</span>&nbsp;<span class="ident" id="2906543">fh</span><span class="op" id="2906545">.</span><span class="ident" id="2906546">CompressedSize64</span>&nbsp;<span class="op" id="2906563">&gt;</span>&nbsp;<span class="ident" id="2906565">uint32max</span>&nbsp;<span class="op" id="2906575">||</span>&nbsp;<span class="ident" id="2906578">fh</span><span class="op" id="2906580">.</span><span class="ident" id="2906581">UncompressedSize64</span>&nbsp;<span class="op" id="2906600">&gt;</span>&nbsp;<span class="ident" id="2906602">uint32max</span><br>
<span class="lineno"></span><span class="op" id="2906612">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2906615">func</span>&nbsp;<span class="ident" id="2906620">msdosModeToFileMode</span><span class="op" id="2906639">(</span><span class="ident" id="2906640">m</span>&nbsp;<span class="builtintype" id="2906642">uint32</span><span class="op" id="2906648">)</span>&nbsp;<span class="op" id="2906650">(</span><span class="ident" id="2906651">mode</span>&nbsp;<span class="ident" id="2906656">os</span><span class="op" id="2906658">.</span><span class="ident" id="2906659">FileMode</span><span class="op" id="2906667">)</span>&nbsp;<span class="op" id="2906669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2906672">if</span>&nbsp;<span class="ident" id="2906675">m</span><span class="op" id="2906676">&amp;</span><span class="ident" id="2906677">msdosDir</span>&nbsp;<span class="op" id="2906686">!=</span>&nbsp;<span class="num" id="2906689">0</span>&nbsp;<span class="op" id="2906691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2906695">mode</span>&nbsp;<span class="op" id="2906700">=</span>&nbsp;<span class="ident" id="2906702">os</span><span class="op" id="2906704">.</span><span class="ident" id="2906705">ModeDir</span>&nbsp;<span class="op" id="2906713">|</span>&nbsp;<span class="num" id="2906715">0777</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2906721">}</span>&nbsp;<span class="keyword" id="2906723">else</span>&nbsp;<span class="op" id="2906728">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2906732">mode</span>&nbsp;<span class="op" id="2906737">=</span>&nbsp;<span class="num" id="2906739">0666</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2906745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2906748">if</span>&nbsp;<span class="ident" id="2906751">m</span><span class="op" id="2906752">&amp;</span><span class="ident" id="2906753">msdosReadOnly</span>&nbsp;<span class="op" id="2906767">!=</span>&nbsp;<span class="num" id="2906770">0</span>&nbsp;<span class="op" id="2906772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2906776">mode</span>&nbsp;<span class="op" id="2906781">&amp;^=</span>&nbsp;<span class="num" id="2906785">0222</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2906791">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2906794">return</span>&nbsp;<span class="ident" id="2906801">mode</span><br>
<span class="lineno"></span><span class="op" id="2906806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2906809">func</span>&nbsp;<span class="ident" id="2906814">fileModeToUnixMode</span><span class="op" id="2906832">(</span><span class="ident" id="2906833">mode</span>&nbsp;<span class="ident" id="2906838">os</span><span class="op" id="2906840">.</span><span class="ident" id="2906841">FileMode</span><span class="op" id="2906849">)</span>&nbsp;<span class="builtintype" id="2906851">uint32</span>&nbsp;<span class="op" id="2906858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2906861">var</span>&nbsp;<span class="ident" id="2906865">m</span>&nbsp;<span class="builtintype" id="2906867">uint32</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2906875">switch</span>&nbsp;<span class="ident" id="2906882">mode</span>&nbsp;<span class="op" id="2906887">&amp;</span>&nbsp;<span class="ident" id="2906889">os</span><span class="op" id="2906891">.</span><span class="ident" id="2906892">ModeType</span>&nbsp;<span class="op" id="2906901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2906904">default</span><span class="op" id="2906911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2906915">m</span>&nbsp;<span class="op" id="2906917">=</span>&nbsp;<span class="ident" id="2906919">s_IFREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2906928">case</span>&nbsp;<span class="ident" id="2906933">os</span><span class="op" id="2906935">.</span><span class="ident" id="2906936">ModeDir</span><span class="op" id="2906943">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2906947">m</span>&nbsp;<span class="op" id="2906949">=</span>&nbsp;<span class="ident" id="2906951">s_IFDIR</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2906960">case</span>&nbsp;<span class="ident" id="2906965">os</span><span class="op" id="2906967">.</span><span class="ident" id="2906968">ModeSymlink</span><span class="op" id="2906979">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2906983">m</span>&nbsp;<span class="op" id="2906985">=</span>&nbsp;<span class="ident" id="2906987">s_IFLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2906996">case</span>&nbsp;<span class="ident" id="2907001">os</span><span class="op" id="2907003">.</span><span class="ident" id="2907004">ModeNamedPipe</span><span class="op" id="2907017">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907021">m</span>&nbsp;<span class="op" id="2907023">=</span>&nbsp;<span class="ident" id="2907025">s_IFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907034">case</span>&nbsp;<span class="ident" id="2907039">os</span><span class="op" id="2907041">.</span><span class="ident" id="2907042">ModeSocket</span><span class="op" id="2907052">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907056">m</span>&nbsp;<span class="op" id="2907058">=</span>&nbsp;<span class="ident" id="2907060">s_IFSOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907070">case</span>&nbsp;<span class="ident" id="2907075">os</span><span class="op" id="2907077">.</span><span class="ident" id="2907078">ModeDevice</span><span class="op" id="2907088">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907092">if</span>&nbsp;<span class="ident" id="2907095">mode</span><span class="op" id="2907099">&amp;</span><span class="ident" id="2907100">os</span><span class="op" id="2907102">.</span><span class="ident" id="2907103">ModeCharDevice</span>&nbsp;<span class="op" id="2907118">!=</span>&nbsp;<span class="num" id="2907121">0</span>&nbsp;<span class="op" id="2907123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907128">m</span>&nbsp;<span class="op" id="2907130">=</span>&nbsp;<span class="ident" id="2907132">s_IFCHR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2907142">}</span>&nbsp;<span class="keyword" id="2907144">else</span>&nbsp;<span class="op" id="2907149">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907154">m</span>&nbsp;<span class="op" id="2907156">=</span>&nbsp;<span class="ident" id="2907158">s_IFBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2907168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2907171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907174">if</span>&nbsp;<span class="ident" id="2907177">mode</span><span class="op" id="2907181">&amp;</span><span class="ident" id="2907182">os</span><span class="op" id="2907184">.</span><span class="ident" id="2907185">ModeSetuid</span>&nbsp;<span class="op" id="2907196">!=</span>&nbsp;<span class="num" id="2907199">0</span>&nbsp;<span class="op" id="2907201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907205">m</span>&nbsp;<span class="op" id="2907207">|=</span>&nbsp;<span class="ident" id="2907210">s_ISUID</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2907219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907222">if</span>&nbsp;<span class="ident" id="2907225">mode</span><span class="op" id="2907229">&amp;</span><span class="ident" id="2907230">os</span><span class="op" id="2907232">.</span><span class="ident" id="2907233">ModeSetgid</span>&nbsp;<span class="op" id="2907244">!=</span>&nbsp;<span class="num" id="2907247">0</span>&nbsp;<span class="op" id="2907249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907253">m</span>&nbsp;<span class="op" id="2907255">|=</span>&nbsp;<span class="ident" id="2907258">s_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2907267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907270">if</span>&nbsp;<span class="ident" id="2907273">mode</span><span class="op" id="2907277">&amp;</span><span class="ident" id="2907278">os</span><span class="op" id="2907280">.</span><span class="ident" id="2907281">ModeSticky</span>&nbsp;<span class="op" id="2907292">!=</span>&nbsp;<span class="num" id="2907295">0</span>&nbsp;<span class="op" id="2907297">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907301">m</span>&nbsp;<span class="op" id="2907303">|=</span>&nbsp;<span class="ident" id="2907306">s_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2907315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907318">return</span>&nbsp;<span class="ident" id="2907325">m</span>&nbsp;<span class="op" id="2907327">|</span>&nbsp;<span class="builtintype" id="2907329">uint32</span><span class="op" id="2907335">(</span><span class="ident" id="2907336">mode</span><span class="op" id="2907340">&amp;</span><span class="num" id="2907341">0777</span><span class="op" id="2907345">)</span><br>
<span class="lineno"></span><span class="op" id="2907347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="2907350">func</span>&nbsp;<span class="ident" id="2907355">unixModeToFileMode</span><span class="op" id="2907373">(</span><span class="ident" id="2907374">m</span>&nbsp;<span class="builtintype" id="2907376">uint32</span><span class="op" id="2907382">)</span>&nbsp;<span class="ident" id="2907384">os</span><span class="op" id="2907386">.</span><span class="ident" id="2907387">FileMode</span>&nbsp;<span class="op" id="2907396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907399">mode</span>&nbsp;<span class="op" id="2907404">:=</span>&nbsp;<span class="ident" id="2907407">os</span><span class="op" id="2907409">.</span><span class="ident" id="2907410">FileMode</span><span class="op" id="2907418">(</span><span class="ident" id="2907419">m</span>&nbsp;<span class="op" id="2907421">&amp;</span>&nbsp;<span class="num" id="2907423">0777</span><span class="op" id="2907427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907430">switch</span>&nbsp;<span class="ident" id="2907437">m</span>&nbsp;<span class="op" id="2907439">&amp;</span>&nbsp;<span class="ident" id="2907441">s_IFMT</span>&nbsp;<span class="op" id="2907448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907451">case</span>&nbsp;<span class="ident" id="2907456">s_IFBLK</span><span class="op" id="2907463">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907467">mode</span>&nbsp;<span class="op" id="2907472">|=</span>&nbsp;<span class="ident" id="2907475">os</span><span class="op" id="2907477">.</span><span class="ident" id="2907478">ModeDevice</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907490">case</span>&nbsp;<span class="ident" id="2907495">s_IFCHR</span><span class="op" id="2907502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907506">mode</span>&nbsp;<span class="op" id="2907511">|=</span>&nbsp;<span class="ident" id="2907514">os</span><span class="op" id="2907516">.</span><span class="ident" id="2907517">ModeDevice</span>&nbsp;<span class="op" id="2907528">|</span>&nbsp;<span class="ident" id="2907530">os</span><span class="op" id="2907532">.</span><span class="ident" id="2907533">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907549">case</span>&nbsp;<span class="ident" id="2907554">s_IFDIR</span><span class="op" id="2907561">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907565">mode</span>&nbsp;<span class="op" id="2907570">|=</span>&nbsp;<span class="ident" id="2907573">os</span><span class="op" id="2907575">.</span><span class="ident" id="2907576">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907585">case</span>&nbsp;<span class="ident" id="2907590">s_IFIFO</span><span class="op" id="2907597">:</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907601">mode</span>&nbsp;<span class="op" id="2907606">|=</span>&nbsp;<span class="ident" id="2907609">os</span><span class="op" id="2907611">.</span><span class="ident" id="2907612">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907627">case</span>&nbsp;<span class="ident" id="2907632">s_IFLNK</span><span class="op" id="2907639">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907643">mode</span>&nbsp;<span class="op" id="2907648">|=</span>&nbsp;<span class="ident" id="2907651">os</span><span class="op" id="2907653">.</span><span class="ident" id="2907654">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907667">case</span>&nbsp;<span class="ident" id="2907672">s_IFREG</span><span class="op" id="2907679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2907683">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907701">case</span>&nbsp;<span class="ident" id="2907706">s_IFSOCK</span><span class="op" id="2907714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907718">mode</span>&nbsp;<span class="op" id="2907723">|=</span>&nbsp;<span class="ident" id="2907726">os</span><span class="op" id="2907728">.</span><span class="ident" id="2907729">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2907741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907744">if</span>&nbsp;<span class="ident" id="2907747">m</span><span class="op" id="2907748">&amp;</span><span class="ident" id="2907749">s_ISGID</span>&nbsp;<span class="op" id="2907757">!=</span>&nbsp;<span class="num" id="2907760">0</span>&nbsp;<span class="op" id="2907762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907766">mode</span>&nbsp;<span class="op" id="2907771">|=</span>&nbsp;<span class="ident" id="2907774">os</span><span class="op" id="2907776">.</span><span class="ident" id="2907777">ModeSetgid</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2907789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907792">if</span>&nbsp;<span class="ident" id="2907795">m</span><span class="op" id="2907796">&amp;</span><span class="ident" id="2907797">s_ISUID</span>&nbsp;<span class="op" id="2907805">!=</span>&nbsp;<span class="num" id="2907808">0</span>&nbsp;<span class="op" id="2907810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907814">mode</span>&nbsp;<span class="op" id="2907819">|=</span>&nbsp;<span class="ident" id="2907822">os</span><span class="op" id="2907824">.</span><span class="ident" id="2907825">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2907837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907840">if</span>&nbsp;<span class="ident" id="2907843">m</span><span class="op" id="2907844">&amp;</span><span class="ident" id="2907845">s_ISVTX</span>&nbsp;<span class="op" id="2907853">!=</span>&nbsp;<span class="num" id="2907856">0</span>&nbsp;<span class="op" id="2907858">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2907862">mode</span>&nbsp;<span class="op" id="2907867">|=</span>&nbsp;<span class="ident" id="2907870">os</span><span class="op" id="2907872">.</span><span class="ident" id="2907873">ModeSticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2907885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2907888">return</span>&nbsp;<span class="ident" id="2907895">mode</span><br>
<span class="lineno"></span><span class="op" id="2907900">}</span>
</div>
</body>
</html>
