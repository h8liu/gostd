<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html" class="current">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8505741">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8505796">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8505850">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8505901">package</span>&nbsp;<span class="ident" id="8505909">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8505914">import</span>&nbsp;<span class="op" id="8505921">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8505924">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8505933">&#34;encoding/hex&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8505949">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8505959">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8505967">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8505974">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8505980">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8505993">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8506000">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8506011">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8506022">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="8506029">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="8506032">//&nbsp;TLS&nbsp;reference&nbsp;tests&nbsp;run&nbsp;a&nbsp;connection&nbsp;against&nbsp;a&nbsp;reference&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="8506107">//&nbsp;(OpenSSL)&nbsp;of&nbsp;TLS&nbsp;and&nbsp;record&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;The&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="8506184">//&nbsp;code,&nbsp;during&nbsp;a&nbsp;test,&nbsp;is&nbsp;configured&nbsp;with&nbsp;deterministic&nbsp;randomness&nbsp;and&nbsp;so&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8506263">//&nbsp;reference&nbsp;test&nbsp;can&nbsp;be&nbsp;reproduced&nbsp;exactly&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno">25</span><span class="comment" id="8506322">//</span><br>
<span class="lineno"></span><span class="comment" id="8506325">//&nbsp;In&nbsp;order&nbsp;to&nbsp;save&nbsp;everyone&nbsp;who&nbsp;wishes&nbsp;to&nbsp;run&nbsp;the&nbsp;tests&nbsp;from&nbsp;needing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8506399">//&nbsp;reference&nbsp;implementation&nbsp;installed,&nbsp;the&nbsp;reference&nbsp;connections&nbsp;are&nbsp;saved&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8506477">//&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata&nbsp;directory.&nbsp;Thus&nbsp;running&nbsp;the&nbsp;tests&nbsp;involves&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="8506553">//&nbsp;external,&nbsp;but&nbsp;creating&nbsp;and&nbsp;updating&nbsp;them&nbsp;requires&nbsp;the&nbsp;reference</span><br>
<span class="lineno">30</span><span class="comment" id="8506620">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="8506639">//</span><br>
<span class="lineno"></span><span class="comment" id="8506642">//&nbsp;Tests&nbsp;can&nbsp;be&nbsp;updated&nbsp;by&nbsp;running&nbsp;them&nbsp;with&nbsp;the&nbsp;-update&nbsp;flag.&nbsp;This&nbsp;will&nbsp;cause</span><br>
<span class="lineno"></span><span class="comment" id="8506721">//&nbsp;the&nbsp;test&nbsp;files.&nbsp;Generally&nbsp;one&nbsp;should&nbsp;combine&nbsp;the&nbsp;-update&nbsp;flag&nbsp;with&nbsp;-test.run</span><br>
<span class="lineno"></span><span class="comment" id="8506801">//&nbsp;to&nbsp;updated&nbsp;a&nbsp;specific&nbsp;test.&nbsp;Since&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;will&nbsp;always</span><br>
<span class="lineno">35</span><span class="comment" id="8506879">//&nbsp;generate&nbsp;fresh&nbsp;random&nbsp;numbers,&nbsp;large&nbsp;parts&nbsp;of&nbsp;the&nbsp;reference&nbsp;connection&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="8506958">//&nbsp;always&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8506977">var</span>&nbsp;<span class="ident" id="8506981">update</span>&nbsp;<span class="op" id="8506988">=</span>&nbsp;<span class="ident" id="8506990">flag</span><span class="op" id="8506994">.</span><span class="ident" id="8506995">Bool</span><span class="op" id="8506999">(</span><span class="string" id="8507000">&#34;update&#34;</span><span class="op" id="8507008">,</span>&nbsp;<span class="builtintype" id="8507010">false</span><span class="op" id="8507015">,</span>&nbsp;<span class="string" id="8507017">&#34;update&nbsp;golden&nbsp;files&nbsp;on&nbsp;disk&#34;</span><span class="op" id="8507046">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="8507049">//&nbsp;recordingConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;that&nbsp;records&nbsp;the&nbsp;traffic&nbsp;that&nbsp;passes&nbsp;through&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="8507129">//&nbsp;WriteTo&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;produce&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;later&nbsp;be&nbsp;loaded&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="8507203">//&nbsp;ParseTestData.</span><br>
<span class="lineno"></span><span class="keyword" id="8507221">type</span>&nbsp;<span class="ident" id="8507226">recordingConn</span>&nbsp;<span class="keyword" id="8507240">struct</span>&nbsp;<span class="op" id="8507247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507250">net</span><span class="op" id="8507253">.</span><span class="ident" id="8507254">Conn</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507260">sync</span><span class="op" id="8507264">.</span><span class="ident" id="8507265">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507272">flows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8507280">[</span><span class="op" id="8507281">]</span><span class="op" id="8507282">[</span><span class="op" id="8507283">]</span><span class="builtintype" id="8507284">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507290">reading</span>&nbsp;<span class="builtintype" id="8507298">bool</span><br>
<span class="lineno"></span><span class="op" id="8507303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="8507306">func</span>&nbsp;<span class="op" id="8507311">(</span><span class="ident" id="8507312">r</span>&nbsp;<span class="op" id="8507314">*</span><span class="ident" id="8507315">recordingConn</span><span class="op" id="8507328">)</span>&nbsp;<span class="ident" id="8507330">Read</span><span class="op" id="8507334">(</span><span class="ident" id="8507335">b</span>&nbsp;<span class="op" id="8507337">[</span><span class="op" id="8507338">]</span><span class="builtintype" id="8507339">byte</span><span class="op" id="8507343">)</span>&nbsp;<span class="op" id="8507345">(</span><span class="ident" id="8507346">n</span>&nbsp;<span class="builtintype" id="8507348">int</span><span class="op" id="8507351">,</span>&nbsp;<span class="ident" id="8507353">err</span>&nbsp;<span class="builtintype" id="8507357">error</span><span class="op" id="8507362">)</span>&nbsp;<span class="op" id="8507364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507367">if</span>&nbsp;<span class="ident" id="8507370">n</span><span class="op" id="8507371">,</span>&nbsp;<span class="ident" id="8507373">err</span>&nbsp;<span class="op" id="8507377">=</span>&nbsp;<span class="ident" id="8507379">r</span><span class="op" id="8507380">.</span><span class="ident" id="8507381">Conn</span><span class="op" id="8507385">.</span><span class="ident" id="8507386">Read</span><span class="op" id="8507390">(</span><span class="ident" id="8507391">b</span><span class="op" id="8507392">)</span><span class="op" id="8507393">;</span>&nbsp;<span class="ident" id="8507395">n</span>&nbsp;<span class="op" id="8507397">==</span>&nbsp;<span class="num" id="8507400">0</span>&nbsp;<span class="op" id="8507402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507406">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507417">b</span>&nbsp;<span class="op" id="8507419">=</span>&nbsp;<span class="ident" id="8507421">b</span><span class="op" id="8507422">[</span><span class="op" id="8507423">:</span><span class="ident" id="8507424">n</span><span class="op" id="8507425">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507429">r</span><span class="op" id="8507430">.</span><span class="ident" id="8507431">Lock</span><span class="op" id="8507435">(</span><span class="op" id="8507436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507439">defer</span>&nbsp;<span class="ident" id="8507445">r</span><span class="op" id="8507446">.</span><span class="ident" id="8507447">Unlock</span><span class="op" id="8507453">(</span><span class="op" id="8507454">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507458">if</span>&nbsp;<span class="ident" id="8507461">l</span>&nbsp;<span class="op" id="8507463">:=</span>&nbsp;<span class="builtinfunc" id="8507466">len</span><span class="op" id="8507469">(</span><span class="ident" id="8507470">r</span><span class="op" id="8507471">.</span><span class="ident" id="8507472">flows</span><span class="op" id="8507477">)</span><span class="op" id="8507478">;</span>&nbsp;<span class="ident" id="8507480">l</span>&nbsp;<span class="op" id="8507482">==</span>&nbsp;<span class="num" id="8507485">0</span>&nbsp;<span class="op" id="8507487">||</span>&nbsp;<span class="op" id="8507490">!</span><span class="ident" id="8507491">r</span><span class="op" id="8507492">.</span><span class="ident" id="8507493">reading</span>&nbsp;<span class="op" id="8507501">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507505">buf</span>&nbsp;<span class="op" id="8507509">:=</span>&nbsp;<span class="builtinfunc" id="8507512">make</span><span class="op" id="8507516">(</span><span class="op" id="8507517">[</span><span class="op" id="8507518">]</span><span class="builtintype" id="8507519">byte</span><span class="op" id="8507523">,</span>&nbsp;<span class="builtinfunc" id="8507525">len</span><span class="op" id="8507528">(</span><span class="ident" id="8507529">b</span><span class="op" id="8507530">)</span><span class="op" id="8507531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8507535">copy</span><span class="op" id="8507539">(</span><span class="ident" id="8507540">buf</span><span class="op" id="8507543">,</span>&nbsp;<span class="ident" id="8507545">b</span><span class="op" id="8507546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507550">r</span><span class="op" id="8507551">.</span><span class="ident" id="8507552">flows</span>&nbsp;<span class="op" id="8507558">=</span>&nbsp;<span class="builtinfunc" id="8507560">append</span><span class="op" id="8507566">(</span><span class="ident" id="8507567">r</span><span class="op" id="8507568">.</span><span class="ident" id="8507569">flows</span><span class="op" id="8507574">,</span>&nbsp;<span class="ident" id="8507576">buf</span><span class="op" id="8507579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507582">}</span>&nbsp;<span class="keyword" id="8507584">else</span>&nbsp;<span class="op" id="8507589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507593">r</span><span class="op" id="8507594">.</span><span class="ident" id="8507595">flows</span><span class="op" id="8507600">[</span><span class="ident" id="8507601">l</span><span class="op" id="8507602">-</span><span class="num" id="8507603">1</span><span class="op" id="8507604">]</span>&nbsp;<span class="op" id="8507606">=</span>&nbsp;<span class="builtinfunc" id="8507608">append</span><span class="op" id="8507614">(</span><span class="ident" id="8507615">r</span><span class="op" id="8507616">.</span><span class="ident" id="8507617">flows</span><span class="op" id="8507622">[</span><span class="ident" id="8507623">l</span><span class="op" id="8507624">-</span><span class="num" id="8507625">1</span><span class="op" id="8507626">]</span><span class="op" id="8507627">,</span>&nbsp;<span class="ident" id="8507629">b</span><span class="op" id="8507630">[</span><span class="op" id="8507631">:</span><span class="ident" id="8507632">n</span><span class="op" id="8507633">]</span><span class="op" id="8507634">...</span><span class="op" id="8507637">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507643">r</span><span class="op" id="8507644">.</span><span class="ident" id="8507645">reading</span>&nbsp;<span class="op" id="8507653">=</span>&nbsp;<span class="builtintype" id="8507655">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507661">return</span><br>
<span class="lineno"></span><span class="op" id="8507668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="8507671">func</span>&nbsp;<span class="op" id="8507676">(</span><span class="ident" id="8507677">r</span>&nbsp;<span class="op" id="8507679">*</span><span class="ident" id="8507680">recordingConn</span><span class="op" id="8507693">)</span>&nbsp;<span class="ident" id="8507695">Write</span><span class="op" id="8507700">(</span><span class="ident" id="8507701">b</span>&nbsp;<span class="op" id="8507703">[</span><span class="op" id="8507704">]</span><span class="builtintype" id="8507705">byte</span><span class="op" id="8507709">)</span>&nbsp;<span class="op" id="8507711">(</span><span class="ident" id="8507712">n</span>&nbsp;<span class="builtintype" id="8507714">int</span><span class="op" id="8507717">,</span>&nbsp;<span class="ident" id="8507719">err</span>&nbsp;<span class="builtintype" id="8507723">error</span><span class="op" id="8507728">)</span>&nbsp;<span class="op" id="8507730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507733">if</span>&nbsp;<span class="ident" id="8507736">n</span><span class="op" id="8507737">,</span>&nbsp;<span class="ident" id="8507739">err</span>&nbsp;<span class="op" id="8507743">=</span>&nbsp;<span class="ident" id="8507745">r</span><span class="op" id="8507746">.</span><span class="ident" id="8507747">Conn</span><span class="op" id="8507751">.</span><span class="ident" id="8507752">Write</span><span class="op" id="8507757">(</span><span class="ident" id="8507758">b</span><span class="op" id="8507759">)</span><span class="op" id="8507760">;</span>&nbsp;<span class="ident" id="8507762">n</span>&nbsp;<span class="op" id="8507764">==</span>&nbsp;<span class="num" id="8507767">0</span>&nbsp;<span class="op" id="8507769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507773">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507784">b</span>&nbsp;<span class="op" id="8507786">=</span>&nbsp;<span class="ident" id="8507788">b</span><span class="op" id="8507789">[</span><span class="op" id="8507790">:</span><span class="ident" id="8507791">n</span><span class="op" id="8507792">]</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507796">r</span><span class="op" id="8507797">.</span><span class="ident" id="8507798">Lock</span><span class="op" id="8507802">(</span><span class="op" id="8507803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507806">defer</span>&nbsp;<span class="ident" id="8507812">r</span><span class="op" id="8507813">.</span><span class="ident" id="8507814">Unlock</span><span class="op" id="8507820">(</span><span class="op" id="8507821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8507825">if</span>&nbsp;<span class="ident" id="8507828">l</span>&nbsp;<span class="op" id="8507830">:=</span>&nbsp;<span class="builtinfunc" id="8507833">len</span><span class="op" id="8507836">(</span><span class="ident" id="8507837">r</span><span class="op" id="8507838">.</span><span class="ident" id="8507839">flows</span><span class="op" id="8507844">)</span><span class="op" id="8507845">;</span>&nbsp;<span class="ident" id="8507847">l</span>&nbsp;<span class="op" id="8507849">==</span>&nbsp;<span class="num" id="8507852">0</span>&nbsp;<span class="op" id="8507854">||</span>&nbsp;<span class="ident" id="8507857">r</span><span class="op" id="8507858">.</span><span class="ident" id="8507859">reading</span>&nbsp;<span class="op" id="8507867">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507871">buf</span>&nbsp;<span class="op" id="8507875">:=</span>&nbsp;<span class="builtinfunc" id="8507878">make</span><span class="op" id="8507882">(</span><span class="op" id="8507883">[</span><span class="op" id="8507884">]</span><span class="builtintype" id="8507885">byte</span><span class="op" id="8507889">,</span>&nbsp;<span class="builtinfunc" id="8507891">len</span><span class="op" id="8507894">(</span><span class="ident" id="8507895">b</span><span class="op" id="8507896">)</span><span class="op" id="8507897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8507901">copy</span><span class="op" id="8507905">(</span><span class="ident" id="8507906">buf</span><span class="op" id="8507909">,</span>&nbsp;<span class="ident" id="8507911">b</span><span class="op" id="8507912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507916">r</span><span class="op" id="8507917">.</span><span class="ident" id="8507918">flows</span>&nbsp;<span class="op" id="8507924">=</span>&nbsp;<span class="builtinfunc" id="8507926">append</span><span class="op" id="8507932">(</span><span class="ident" id="8507933">r</span><span class="op" id="8507934">.</span><span class="ident" id="8507935">flows</span><span class="op" id="8507940">,</span>&nbsp;<span class="ident" id="8507942">buf</span><span class="op" id="8507945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8507948">}</span>&nbsp;<span class="keyword" id="8507950">else</span>&nbsp;<span class="op" id="8507955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8507959">r</span><span class="op" id="8507960">.</span><span class="ident" id="8507961">flows</span><span class="op" id="8507966">[</span><span class="ident" id="8507967">l</span><span class="op" id="8507968">-</span><span class="num" id="8507969">1</span><span class="op" id="8507970">]</span>&nbsp;<span class="op" id="8507972">=</span>&nbsp;<span class="builtinfunc" id="8507974">append</span><span class="op" id="8507980">(</span><span class="ident" id="8507981">r</span><span class="op" id="8507982">.</span><span class="ident" id="8507983">flows</span><span class="op" id="8507988">[</span><span class="ident" id="8507989">l</span><span class="op" id="8507990">-</span><span class="num" id="8507991">1</span><span class="op" id="8507992">]</span><span class="op" id="8507993">,</span>&nbsp;<span class="ident" id="8507995">b</span><span class="op" id="8507996">[</span><span class="op" id="8507997">:</span><span class="ident" id="8507998">n</span><span class="op" id="8507999">]</span><span class="op" id="8508000">...</span><span class="op" id="8508003">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508009">r</span><span class="op" id="8508010">.</span><span class="ident" id="8508011">reading</span>&nbsp;<span class="op" id="8508019">=</span>&nbsp;<span class="builtintype" id="8508021">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508028">return</span><br>
<span class="lineno"></span><span class="op" id="8508035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="8508038">//&nbsp;WriteTo&nbsp;writes&nbsp;Go&nbsp;source&nbsp;code&nbsp;to&nbsp;w&nbsp;that&nbsp;contains&nbsp;the&nbsp;recorded&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="8508112">func</span>&nbsp;<span class="op" id="8508117">(</span><span class="ident" id="8508118">r</span>&nbsp;<span class="op" id="8508120">*</span><span class="ident" id="8508121">recordingConn</span><span class="op" id="8508134">)</span>&nbsp;<span class="ident" id="8508136">WriteTo</span><span class="op" id="8508143">(</span><span class="ident" id="8508144">w</span>&nbsp;<span class="ident" id="8508146">io</span><span class="op" id="8508148">.</span><span class="ident" id="8508149">Writer</span><span class="op" id="8508155">)</span>&nbsp;<span class="op" id="8508157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8508160">//&nbsp;TLS&nbsp;always&nbsp;starts&nbsp;with&nbsp;a&nbsp;client&nbsp;to&nbsp;server&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508212">clientToServer</span>&nbsp;<span class="op" id="8508227">:=</span>&nbsp;<span class="builtintype" id="8508230">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508237">for</span>&nbsp;<span class="ident" id="8508241">i</span><span class="op" id="8508242">,</span>&nbsp;<span class="ident" id="8508244">flow</span>&nbsp;<span class="op" id="8508249">:=</span>&nbsp;<span class="keyword" id="8508252">range</span>&nbsp;<span class="ident" id="8508258">r</span><span class="op" id="8508259">.</span><span class="ident" id="8508260">flows</span>&nbsp;<span class="op" id="8508266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508270">source</span><span class="op" id="8508276">,</span>&nbsp;<span class="ident" id="8508278">dest</span>&nbsp;<span class="op" id="8508283">:=</span>&nbsp;<span class="string" id="8508286">&#34;client&#34;</span><span class="op" id="8508294">,</span>&nbsp;<span class="string" id="8508296">&#34;server&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508307">if</span>&nbsp;<span class="op" id="8508310">!</span><span class="ident" id="8508311">clientToServer</span>&nbsp;<span class="op" id="8508326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508331">source</span><span class="op" id="8508337">,</span>&nbsp;<span class="ident" id="8508339">dest</span>&nbsp;<span class="op" id="8508344">=</span>&nbsp;<span class="ident" id="8508346">dest</span><span class="op" id="8508350">,</span>&nbsp;<span class="ident" id="8508352">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508361">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508365">fmt</span><span class="op" id="8508368">.</span><span class="ident" id="8508369">Fprintf</span><span class="op" id="8508376">(</span><span class="ident" id="8508377">w</span><span class="op" id="8508378">,</span>&nbsp;<span class="string" id="8508380">&#34;&gt;&gt;&gt;&nbsp;Flow&nbsp;%d&nbsp;(%s&nbsp;to&nbsp;%s)\n&#34;</span><span class="op" id="8508406">,</span>&nbsp;<span class="ident" id="8508408">i</span><span class="op" id="8508409">+</span><span class="num" id="8508410">1</span><span class="op" id="8508411">,</span>&nbsp;<span class="ident" id="8508413">source</span><span class="op" id="8508419">,</span>&nbsp;<span class="ident" id="8508421">dest</span><span class="op" id="8508425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508429">dumper</span>&nbsp;<span class="op" id="8508436">:=</span>&nbsp;<span class="ident" id="8508439">hex</span><span class="op" id="8508442">.</span><span class="ident" id="8508443">Dumper</span><span class="op" id="8508449">(</span><span class="ident" id="8508450">w</span><span class="op" id="8508451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508455">dumper</span><span class="op" id="8508461">.</span><span class="ident" id="8508462">Write</span><span class="op" id="8508467">(</span><span class="ident" id="8508468">flow</span><span class="op" id="8508472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508476">dumper</span><span class="op" id="8508482">.</span><span class="ident" id="8508483">Close</span><span class="op" id="8508488">(</span><span class="op" id="8508489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508493">clientToServer</span>&nbsp;<span class="op" id="8508508">=</span>&nbsp;<span class="op" id="8508510">!</span><span class="ident" id="8508511">clientToServer</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508527">}</span><br>
<span class="lineno"></span><span class="op" id="8508529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8508532">func</span>&nbsp;<span class="ident" id="8508537">parseTestData</span><span class="op" id="8508550">(</span><span class="ident" id="8508551">r</span>&nbsp;<span class="ident" id="8508553">io</span><span class="op" id="8508555">.</span><span class="ident" id="8508556">Reader</span><span class="op" id="8508562">)</span>&nbsp;<span class="op" id="8508564">(</span><span class="ident" id="8508565">flows</span>&nbsp;<span class="op" id="8508571">[</span><span class="op" id="8508572">]</span><span class="op" id="8508573">[</span><span class="op" id="8508574">]</span><span class="builtintype" id="8508575">byte</span><span class="op" id="8508579">,</span>&nbsp;<span class="ident" id="8508581">err</span>&nbsp;<span class="builtintype" id="8508585">error</span><span class="op" id="8508590">)</span>&nbsp;<span class="op" id="8508592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508595">var</span>&nbsp;<span class="ident" id="8508599">currentFlow</span>&nbsp;<span class="op" id="8508611">[</span><span class="op" id="8508612">]</span><span class="builtintype" id="8508613">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508620">scanner</span>&nbsp;<span class="op" id="8508628">:=</span>&nbsp;<span class="ident" id="8508631">bufio</span><span class="op" id="8508636">.</span><span class="ident" id="8508637">NewScanner</span><span class="op" id="8508647">(</span><span class="ident" id="8508648">r</span><span class="op" id="8508649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508652">for</span>&nbsp;<span class="ident" id="8508656">scanner</span><span class="op" id="8508663">.</span><span class="ident" id="8508664">Scan</span><span class="op" id="8508668">(</span><span class="op" id="8508669">)</span>&nbsp;<span class="op" id="8508671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508675">line</span>&nbsp;<span class="op" id="8508680">:=</span>&nbsp;<span class="ident" id="8508683">scanner</span><span class="op" id="8508690">.</span><span class="ident" id="8508691">Text</span><span class="op" id="8508695">(</span><span class="op" id="8508696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8508700">//&nbsp;If&nbsp;the&nbsp;line&nbsp;starts&nbsp;with&nbsp;&#34;&gt;&gt;&gt;&nbsp;&#34;&nbsp;then&nbsp;it&nbsp;marks&nbsp;the&nbsp;beginning</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8508764">//&nbsp;of&nbsp;a&nbsp;new&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508784">if</span>&nbsp;<span class="ident" id="8508787">strings</span><span class="op" id="8508794">.</span><span class="ident" id="8508795">HasPrefix</span><span class="op" id="8508804">(</span><span class="ident" id="8508805">line</span><span class="op" id="8508809">,</span>&nbsp;<span class="string" id="8508811">&#34;&gt;&gt;&gt;&nbsp;&#34;</span><span class="op" id="8508817">)</span>&nbsp;<span class="op" id="8508819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508824">if</span>&nbsp;<span class="builtinfunc" id="8508827">len</span><span class="op" id="8508830">(</span><span class="ident" id="8508831">currentFlow</span><span class="op" id="8508842">)</span>&nbsp;<span class="op" id="8508844">&gt;</span>&nbsp;<span class="num" id="8508846">0</span>&nbsp;<span class="op" id="8508848">||</span>&nbsp;<span class="builtinfunc" id="8508851">len</span><span class="op" id="8508854">(</span><span class="ident" id="8508855">flows</span><span class="op" id="8508860">)</span>&nbsp;<span class="op" id="8508862">&gt;</span>&nbsp;<span class="num" id="8508864">0</span>&nbsp;<span class="op" id="8508866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508872">flows</span>&nbsp;<span class="op" id="8508878">=</span>&nbsp;<span class="builtinfunc" id="8508880">append</span><span class="op" id="8508886">(</span><span class="ident" id="8508887">flows</span><span class="op" id="8508892">,</span>&nbsp;<span class="ident" id="8508894">currentFlow</span><span class="op" id="8508905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8508911">currentFlow</span>&nbsp;<span class="op" id="8508923">=</span>&nbsp;<span class="ident" id="8508925">nil</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8508937">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8508948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8508953">//&nbsp;Otherwise&nbsp;the&nbsp;line&nbsp;is&nbsp;a&nbsp;line&nbsp;of&nbsp;hex&nbsp;dump&nbsp;that&nbsp;looks&nbsp;like:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8509016">//&nbsp;00000170&nbsp;&nbsp;fc&nbsp;f5&nbsp;06&nbsp;bf&nbsp;(...)&nbsp;&nbsp;|.....X{&amp;?......!|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8509069">//&nbsp;(Some&nbsp;bytes&nbsp;have&nbsp;been&nbsp;omitted&nbsp;from&nbsp;the&nbsp;middle&nbsp;section.)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509131">if</span>&nbsp;<span class="ident" id="8509134">i</span>&nbsp;<span class="op" id="8509136">:=</span>&nbsp;<span class="ident" id="8509139">strings</span><span class="op" id="8509146">.</span><span class="ident" id="8509147">IndexByte</span><span class="op" id="8509156">(</span><span class="ident" id="8509157">line</span><span class="op" id="8509161">,</span>&nbsp;<span class="string" id="8509163">&#39;&nbsp;&#39;</span><span class="op" id="8509166">)</span><span class="op" id="8509167">;</span>&nbsp;<span class="ident" id="8509169">i</span>&nbsp;<span class="op" id="8509171">&gt;=</span>&nbsp;<span class="num" id="8509174">0</span>&nbsp;<span class="op" id="8509176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509181">line</span>&nbsp;<span class="op" id="8509186">=</span>&nbsp;<span class="ident" id="8509188">line</span><span class="op" id="8509192">[</span><span class="ident" id="8509193">i</span><span class="op" id="8509194">:</span><span class="op" id="8509195">]</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509199">}</span>&nbsp;<span class="keyword" id="8509201">else</span>&nbsp;<span class="op" id="8509206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509211">return</span>&nbsp;<span class="ident" id="8509218">nil</span><span class="op" id="8509221">,</span>&nbsp;<span class="ident" id="8509223">errors</span><span class="op" id="8509229">.</span><span class="ident" id="8509230">New</span><span class="op" id="8509233">(</span><span class="string" id="8509234">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="8509253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509262">if</span>&nbsp;<span class="ident" id="8509265">i</span>&nbsp;<span class="op" id="8509267">:=</span>&nbsp;<span class="ident" id="8509270">strings</span><span class="op" id="8509277">.</span><span class="ident" id="8509278">IndexByte</span><span class="op" id="8509287">(</span><span class="ident" id="8509288">line</span><span class="op" id="8509292">,</span>&nbsp;<span class="string" id="8509294">&#39;|&#39;</span><span class="op" id="8509297">)</span><span class="op" id="8509298">;</span>&nbsp;<span class="ident" id="8509300">i</span>&nbsp;<span class="op" id="8509302">&gt;=</span>&nbsp;<span class="num" id="8509305">0</span>&nbsp;<span class="op" id="8509307">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509312">line</span>&nbsp;<span class="op" id="8509317">=</span>&nbsp;<span class="ident" id="8509319">line</span><span class="op" id="8509323">[</span><span class="op" id="8509324">:</span><span class="ident" id="8509325">i</span><span class="op" id="8509326">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509330">}</span>&nbsp;<span class="keyword" id="8509332">else</span>&nbsp;<span class="op" id="8509337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509342">return</span>&nbsp;<span class="ident" id="8509349">nil</span><span class="op" id="8509352">,</span>&nbsp;<span class="ident" id="8509354">errors</span><span class="op" id="8509360">.</span><span class="ident" id="8509361">New</span><span class="op" id="8509364">(</span><span class="string" id="8509365">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="8509384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509393">hexBytes</span>&nbsp;<span class="op" id="8509402">:=</span>&nbsp;<span class="ident" id="8509405">strings</span><span class="op" id="8509412">.</span><span class="ident" id="8509413">Fields</span><span class="op" id="8509419">(</span><span class="ident" id="8509420">line</span><span class="op" id="8509424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509428">for</span>&nbsp;<span class="ident" id="8509432">_</span><span class="op" id="8509433">,</span>&nbsp;<span class="ident" id="8509435">hexByte</span>&nbsp;<span class="op" id="8509443">:=</span>&nbsp;<span class="keyword" id="8509446">range</span>&nbsp;<span class="ident" id="8509452">hexBytes</span>&nbsp;<span class="op" id="8509461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509466">val</span><span class="op" id="8509469">,</span>&nbsp;<span class="ident" id="8509471">err</span>&nbsp;<span class="op" id="8509475">:=</span>&nbsp;<span class="ident" id="8509478">strconv</span><span class="op" id="8509485">.</span><span class="ident" id="8509486">ParseUint</span><span class="op" id="8509495">(</span><span class="ident" id="8509496">hexByte</span><span class="op" id="8509503">,</span>&nbsp;<span class="num" id="8509505">16</span><span class="op" id="8509507">,</span>&nbsp;<span class="num" id="8509509">8</span><span class="op" id="8509510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509515">if</span>&nbsp;<span class="ident" id="8509518">err</span>&nbsp;<span class="op" id="8509522">!=</span>&nbsp;<span class="ident" id="8509525">nil</span>&nbsp;<span class="op" id="8509529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509535">return</span>&nbsp;<span class="ident" id="8509542">nil</span><span class="op" id="8509545">,</span>&nbsp;<span class="ident" id="8509547">errors</span><span class="op" id="8509553">.</span><span class="ident" id="8509554">New</span><span class="op" id="8509557">(</span><span class="string" id="8509558">&#34;invalid&nbsp;hex&nbsp;byte&nbsp;in&nbsp;test&nbsp;data:&nbsp;&#34;</span>&nbsp;<span class="op" id="8509592">+</span>&nbsp;<span class="ident" id="8509594">err</span><span class="op" id="8509597">.</span><span class="ident" id="8509598">Error</span><span class="op" id="8509603">(</span><span class="op" id="8509604">)</span><span class="op" id="8509605">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509615">currentFlow</span>&nbsp;<span class="op" id="8509627">=</span>&nbsp;<span class="builtinfunc" id="8509629">append</span><span class="op" id="8509635">(</span><span class="ident" id="8509636">currentFlow</span><span class="op" id="8509647">,</span>&nbsp;<span class="builtintype" id="8509649">byte</span><span class="op" id="8509653">(</span><span class="ident" id="8509654">val</span><span class="op" id="8509657">)</span><span class="op" id="8509658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509669">if</span>&nbsp;<span class="builtinfunc" id="8509672">len</span><span class="op" id="8509675">(</span><span class="ident" id="8509676">currentFlow</span><span class="op" id="8509687">)</span>&nbsp;<span class="op" id="8509689">&gt;</span>&nbsp;<span class="num" id="8509691">0</span>&nbsp;<span class="op" id="8509693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509697">flows</span>&nbsp;<span class="op" id="8509703">=</span>&nbsp;<span class="builtinfunc" id="8509705">append</span><span class="op" id="8509711">(</span><span class="ident" id="8509712">flows</span><span class="op" id="8509717">,</span>&nbsp;<span class="ident" id="8509719">currentFlow</span><span class="op" id="8509730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509737">return</span>&nbsp;<span class="ident" id="8509744">flows</span><span class="op" id="8509749">,</span>&nbsp;<span class="ident" id="8509751">nil</span><br>
<span class="lineno">155</span><span class="op" id="8509755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8509758">//&nbsp;tempFile&nbsp;creates&nbsp;a&nbsp;temp&nbsp;file&nbsp;containing&nbsp;contents&nbsp;and&nbsp;returns&nbsp;its&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="8509832">func</span>&nbsp;<span class="ident" id="8509837">tempFile</span><span class="op" id="8509845">(</span><span class="ident" id="8509846">contents</span>&nbsp;<span class="builtintype" id="8509855">string</span><span class="op" id="8509861">)</span>&nbsp;<span class="builtintype" id="8509863">string</span>&nbsp;<span class="op" id="8509870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509873">file</span><span class="op" id="8509877">,</span>&nbsp;<span class="ident" id="8509879">err</span>&nbsp;<span class="op" id="8509883">:=</span>&nbsp;<span class="ident" id="8509886">ioutil</span><span class="op" id="8509892">.</span><span class="ident" id="8509893">TempFile</span><span class="op" id="8509901">(</span><span class="string" id="8509902">&#34;&#34;</span><span class="op" id="8509904">,</span>&nbsp;<span class="string" id="8509906">&#34;go-tls-test&#34;</span><span class="op" id="8509919">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8509922">if</span>&nbsp;<span class="ident" id="8509925">err</span>&nbsp;<span class="op" id="8509929">!=</span>&nbsp;<span class="ident" id="8509932">nil</span>&nbsp;<span class="op" id="8509936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8509940">panic</span><span class="op" id="8509945">(</span><span class="string" id="8509946">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file:&nbsp;&#34;</span>&nbsp;<span class="op" id="8509977">+</span>&nbsp;<span class="ident" id="8509979">err</span><span class="op" id="8509982">.</span><span class="ident" id="8509983">Error</span><span class="op" id="8509988">(</span><span class="op" id="8509989">)</span><span class="op" id="8509990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8509993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8509996">path</span>&nbsp;<span class="op" id="8510001">:=</span>&nbsp;<span class="ident" id="8510004">file</span><span class="op" id="8510008">.</span><span class="ident" id="8510009">Name</span><span class="op" id="8510013">(</span><span class="op" id="8510014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510017">file</span><span class="op" id="8510021">.</span><span class="ident" id="8510022">WriteString</span><span class="op" id="8510033">(</span><span class="ident" id="8510034">contents</span><span class="op" id="8510042">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510045">file</span><span class="op" id="8510049">.</span><span class="ident" id="8510050">Close</span><span class="op" id="8510055">(</span><span class="op" id="8510056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510059">return</span>&nbsp;<span class="ident" id="8510066">path</span><br>
<span class="lineno"></span><span class="op" id="8510071">}</span>
</div>
</body>
</html>
