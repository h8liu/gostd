<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html" class="current">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8389723">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8389778">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8389832">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8389883">package</span>&nbsp;<span class="ident" id="8389891">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8389902">import</span>&nbsp;<span class="op" id="8389909">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8389912">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8389921">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8389938">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8389945">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8389951">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8389964">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8389981">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8389987">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8389998">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8390009">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8390019">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8390022">func</span>&nbsp;<span class="ident" id="8390027">TestBoundaryLine</span><span class="op" id="8390043">(</span><span class="ident" id="8390044">t</span>&nbsp;<span class="op" id="8390046">*</span><span class="ident" id="8390047">testing</span><span class="op" id="8390054">.</span><span class="ident" id="8390055">T</span><span class="op" id="8390056">)</span>&nbsp;<span class="op" id="8390058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390061">mr</span>&nbsp;<span class="op" id="8390064">:=</span>&nbsp;<span class="ident" id="8390067">NewReader</span><span class="op" id="8390076">(</span><span class="ident" id="8390077">strings</span><span class="op" id="8390084">.</span><span class="ident" id="8390085">NewReader</span><span class="op" id="8390094">(</span><span class="string" id="8390095">&#34;&#34;</span><span class="op" id="8390097">)</span><span class="op" id="8390098">,</span>&nbsp;<span class="string" id="8390100">&#34;myBoundary&#34;</span><span class="op" id="8390112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390115">if</span>&nbsp;<span class="op" id="8390118">!</span><span class="ident" id="8390119">mr</span><span class="op" id="8390121">.</span><span class="ident" id="8390122">isBoundaryDelimiterLine</span><span class="op" id="8390145">(</span><span class="op" id="8390146">[</span><span class="op" id="8390147">]</span><span class="builtintype" id="8390148">byte</span><span class="op" id="8390152">(</span><span class="string" id="8390153">&#34;--myBoundary\r\n&#34;</span><span class="op" id="8390171">)</span><span class="op" id="8390172">)</span>&nbsp;<span class="op" id="8390174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390178">t</span><span class="op" id="8390179">.</span><span class="ident" id="8390180">Error</span><span class="op" id="8390185">(</span><span class="string" id="8390186">&#34;expected&#34;</span><span class="op" id="8390196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390199">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390202">if</span>&nbsp;<span class="op" id="8390205">!</span><span class="ident" id="8390206">mr</span><span class="op" id="8390208">.</span><span class="ident" id="8390209">isBoundaryDelimiterLine</span><span class="op" id="8390232">(</span><span class="op" id="8390233">[</span><span class="op" id="8390234">]</span><span class="builtintype" id="8390235">byte</span><span class="op" id="8390239">(</span><span class="string" id="8390240">&#34;--myBoundary&nbsp;\r\n&#34;</span><span class="op" id="8390259">)</span><span class="op" id="8390260">)</span>&nbsp;<span class="op" id="8390262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390266">t</span><span class="op" id="8390267">.</span><span class="ident" id="8390268">Error</span><span class="op" id="8390273">(</span><span class="string" id="8390274">&#34;expected&#34;</span><span class="op" id="8390284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390290">if</span>&nbsp;<span class="op" id="8390293">!</span><span class="ident" id="8390294">mr</span><span class="op" id="8390296">.</span><span class="ident" id="8390297">isBoundaryDelimiterLine</span><span class="op" id="8390320">(</span><span class="op" id="8390321">[</span><span class="op" id="8390322">]</span><span class="builtintype" id="8390323">byte</span><span class="op" id="8390327">(</span><span class="string" id="8390328">&#34;--myBoundary&nbsp;\n&#34;</span><span class="op" id="8390345">)</span><span class="op" id="8390346">)</span>&nbsp;<span class="op" id="8390348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390352">t</span><span class="op" id="8390353">.</span><span class="ident" id="8390354">Error</span><span class="op" id="8390359">(</span><span class="string" id="8390360">&#34;expected&#34;</span><span class="op" id="8390370">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390376">if</span>&nbsp;<span class="ident" id="8390379">mr</span><span class="op" id="8390381">.</span><span class="ident" id="8390382">isBoundaryDelimiterLine</span><span class="op" id="8390405">(</span><span class="op" id="8390406">[</span><span class="op" id="8390407">]</span><span class="builtintype" id="8390408">byte</span><span class="op" id="8390412">(</span><span class="string" id="8390413">&#34;--myBoundary&nbsp;bogus&nbsp;\n&#34;</span><span class="op" id="8390436">)</span><span class="op" id="8390437">)</span>&nbsp;<span class="op" id="8390439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390443">t</span><span class="op" id="8390444">.</span><span class="ident" id="8390445">Error</span><span class="op" id="8390450">(</span><span class="string" id="8390451">&#34;expected&nbsp;fail&#34;</span><span class="op" id="8390466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390472">if</span>&nbsp;<span class="ident" id="8390475">mr</span><span class="op" id="8390477">.</span><span class="ident" id="8390478">isBoundaryDelimiterLine</span><span class="op" id="8390501">(</span><span class="op" id="8390502">[</span><span class="op" id="8390503">]</span><span class="builtintype" id="8390504">byte</span><span class="op" id="8390508">(</span><span class="string" id="8390509">&#34;--myBoundary&nbsp;bogus--&#34;</span><span class="op" id="8390531">)</span><span class="op" id="8390532">)</span>&nbsp;<span class="op" id="8390534">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390538">t</span><span class="op" id="8390539">.</span><span class="ident" id="8390540">Error</span><span class="op" id="8390545">(</span><span class="string" id="8390546">&#34;expected&nbsp;fail&#34;</span><span class="op" id="8390561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390564">}</span><br>
<span class="lineno"></span><span class="op" id="8390566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8390569">func</span>&nbsp;<span class="ident" id="8390574">escapeString</span><span class="op" id="8390586">(</span><span class="ident" id="8390587">v</span>&nbsp;<span class="builtintype" id="8390589">string</span><span class="op" id="8390595">)</span>&nbsp;<span class="builtintype" id="8390597">string</span>&nbsp;<span class="op" id="8390604">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390607">bytes</span><span class="op" id="8390612">,</span>&nbsp;<span class="ident" id="8390614">_</span>&nbsp;<span class="op" id="8390616">:=</span>&nbsp;<span class="ident" id="8390619">json</span><span class="op" id="8390623">.</span><span class="ident" id="8390624">Marshal</span><span class="op" id="8390631">(</span><span class="ident" id="8390632">v</span><span class="op" id="8390633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390636">return</span>&nbsp;<span class="builtintype" id="8390643">string</span><span class="op" id="8390649">(</span><span class="ident" id="8390650">bytes</span><span class="op" id="8390655">)</span><br>
<span class="lineno"></span><span class="op" id="8390657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8390660">func</span>&nbsp;<span class="ident" id="8390665">expectEq</span><span class="op" id="8390673">(</span><span class="ident" id="8390674">t</span>&nbsp;<span class="op" id="8390676">*</span><span class="ident" id="8390677">testing</span><span class="op" id="8390684">.</span><span class="ident" id="8390685">T</span><span class="op" id="8390686">,</span>&nbsp;<span class="ident" id="8390688">expected</span><span class="op" id="8390696">,</span>&nbsp;<span class="ident" id="8390698">actual</span><span class="op" id="8390704">,</span>&nbsp;<span class="ident" id="8390706">what</span>&nbsp;<span class="builtintype" id="8390711">string</span><span class="op" id="8390717">)</span>&nbsp;<span class="op" id="8390719">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390722">if</span>&nbsp;<span class="ident" id="8390725">expected</span>&nbsp;<span class="op" id="8390734">==</span>&nbsp;<span class="ident" id="8390737">actual</span>&nbsp;<span class="op" id="8390744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8390748">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390759">t</span><span class="op" id="8390760">.</span><span class="ident" id="8390761">Errorf</span><span class="op" id="8390767">(</span><span class="string" id="8390768">&#34;Unexpected&nbsp;value&nbsp;for&nbsp;%s;&nbsp;got&nbsp;%s&nbsp;(len&nbsp;%d)&nbsp;but&nbsp;expected:&nbsp;%s&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="8390836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390840">what</span><span class="op" id="8390844">,</span>&nbsp;<span class="ident" id="8390846">escapeString</span><span class="op" id="8390858">(</span><span class="ident" id="8390859">actual</span><span class="op" id="8390865">)</span><span class="op" id="8390866">,</span>&nbsp;<span class="builtinfunc" id="8390868">len</span><span class="op" id="8390871">(</span><span class="ident" id="8390872">actual</span><span class="op" id="8390878">)</span><span class="op" id="8390879">,</span>&nbsp;<span class="ident" id="8390881">escapeString</span><span class="op" id="8390893">(</span><span class="ident" id="8390894">expected</span><span class="op" id="8390902">)</span><span class="op" id="8390903">,</span>&nbsp;<span class="builtinfunc" id="8390905">len</span><span class="op" id="8390908">(</span><span class="ident" id="8390909">expected</span><span class="op" id="8390917">)</span><span class="op" id="8390918">)</span><br>
<span class="lineno">50</span><span class="op" id="8390920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8390923">func</span>&nbsp;<span class="ident" id="8390928">TestNameAccessors</span><span class="op" id="8390945">(</span><span class="ident" id="8390946">t</span>&nbsp;<span class="op" id="8390948">*</span><span class="ident" id="8390949">testing</span><span class="op" id="8390956">.</span><span class="ident" id="8390957">T</span><span class="op" id="8390958">)</span>&nbsp;<span class="op" id="8390960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8390963">tests</span>&nbsp;<span class="op" id="8390969">:=</span>&nbsp;<span class="op" id="8390972">[</span><span class="op" id="8390973">...</span><span class="op" id="8390976">]</span><span class="op" id="8390977">[</span><span class="num" id="8390978">3</span><span class="op" id="8390979">]</span><span class="builtintype" id="8390980">string</span><span class="op" id="8390986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8390990">{</span><span class="string" id="8390991">`form-data;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="8391014">,</span>&nbsp;<span class="string" id="8391016">&#34;foo&#34;</span><span class="op" id="8391021">,</span>&nbsp;<span class="string" id="8391023">&#34;&#34;</span><span class="op" id="8391025">}</span><span class="op" id="8391026">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391030">{</span><span class="string" id="8391031">`&nbsp;form-data&nbsp;;&nbsp;name=foo`</span><span class="op" id="8391054">,</span>&nbsp;<span class="string" id="8391056">&#34;foo&#34;</span><span class="op" id="8391061">,</span>&nbsp;<span class="string" id="8391063">&#34;&#34;</span><span class="op" id="8391065">}</span><span class="op" id="8391066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391070">{</span><span class="string" id="8391071">`FORM-DATA;name=&#34;foo&#34;`</span><span class="op" id="8391093">,</span>&nbsp;<span class="string" id="8391095">&#34;foo&#34;</span><span class="op" id="8391100">,</span>&nbsp;<span class="string" id="8391102">&#34;&#34;</span><span class="op" id="8391104">}</span><span class="op" id="8391105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391109">{</span><span class="string" id="8391110">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="8391135">,</span>&nbsp;<span class="string" id="8391137">&#34;foo&#34;</span><span class="op" id="8391142">,</span>&nbsp;<span class="string" id="8391144">&#34;&#34;</span><span class="op" id="8391146">}</span><span class="op" id="8391147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391151">{</span><span class="string" id="8391152">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="8391177">,</span>&nbsp;<span class="string" id="8391179">&#34;foo&#34;</span><span class="op" id="8391184">,</span>&nbsp;<span class="string" id="8391186">&#34;&#34;</span><span class="op" id="8391188">}</span><span class="op" id="8391189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391193">{</span><span class="string" id="8391194">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=foo`</span><span class="op" id="8391217">,</span>&nbsp;<span class="string" id="8391219">&#34;foo&#34;</span><span class="op" id="8391224">,</span>&nbsp;<span class="string" id="8391226">&#34;&#34;</span><span class="op" id="8391228">}</span><span class="op" id="8391229">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391233">{</span><span class="string" id="8391234">`&nbsp;FORM-DATA&nbsp;;&nbsp;filename=&#34;foo.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="8391287">,</span>&nbsp;<span class="string" id="8391289">&#34;foo&#34;</span><span class="op" id="8391294">,</span>&nbsp;<span class="string" id="8391296">&#34;foo.txt&#34;</span><span class="op" id="8391305">}</span><span class="op" id="8391306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391310">{</span><span class="string" id="8391311">`&nbsp;not-form-data&nbsp;;&nbsp;filename=&#34;bar.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="8391368">,</span>&nbsp;<span class="string" id="8391370">&#34;&#34;</span><span class="op" id="8391372">,</span>&nbsp;<span class="string" id="8391374">&#34;bar.txt&#34;</span><span class="op" id="8391383">}</span><span class="op" id="8391384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391390">for</span>&nbsp;<span class="ident" id="8391394">i</span><span class="op" id="8391395">,</span>&nbsp;<span class="ident" id="8391397">test</span>&nbsp;<span class="op" id="8391402">:=</span>&nbsp;<span class="keyword" id="8391405">range</span>&nbsp;<span class="ident" id="8391411">tests</span>&nbsp;<span class="op" id="8391417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391421">p</span>&nbsp;<span class="op" id="8391423">:=</span>&nbsp;<span class="op" id="8391426">&amp;</span><span class="ident" id="8391427">Part</span><span class="op" id="8391431">{</span><span class="ident" id="8391432">Header</span><span class="op" id="8391438">:</span>&nbsp;<span class="builtinfunc" id="8391440">make</span><span class="op" id="8391444">(</span><span class="keyword" id="8391445">map</span><span class="op" id="8391448">[</span><span class="builtintype" id="8391449">string</span><span class="op" id="8391455">]</span><span class="op" id="8391456">[</span><span class="op" id="8391457">]</span><span class="builtintype" id="8391458">string</span><span class="op" id="8391464">)</span><span class="op" id="8391465">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391469">p</span><span class="op" id="8391470">.</span><span class="ident" id="8391471">Header</span><span class="op" id="8391477">.</span><span class="ident" id="8391478">Set</span><span class="op" id="8391481">(</span><span class="string" id="8391482">&#34;Content-Disposition&#34;</span><span class="op" id="8391503">,</span>&nbsp;<span class="ident" id="8391505">test</span><span class="op" id="8391509">[</span><span class="num" id="8391510">0</span><span class="op" id="8391511">]</span><span class="op" id="8391512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391516">if</span>&nbsp;<span class="ident" id="8391519">g</span><span class="op" id="8391520">,</span>&nbsp;<span class="ident" id="8391522">e</span>&nbsp;<span class="op" id="8391524">:=</span>&nbsp;<span class="ident" id="8391527">p</span><span class="op" id="8391528">.</span><span class="ident" id="8391529">FormName</span><span class="op" id="8391537">(</span><span class="op" id="8391538">)</span><span class="op" id="8391539">,</span>&nbsp;<span class="ident" id="8391541">test</span><span class="op" id="8391545">[</span><span class="num" id="8391546">1</span><span class="op" id="8391547">]</span><span class="op" id="8391548">;</span>&nbsp;<span class="ident" id="8391550">g</span>&nbsp;<span class="op" id="8391552">!=</span>&nbsp;<span class="ident" id="8391555">e</span>&nbsp;<span class="op" id="8391557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391562">t</span><span class="op" id="8391563">.</span><span class="ident" id="8391564">Errorf</span><span class="op" id="8391570">(</span><span class="string" id="8391571">&#34;test&nbsp;%d:&nbsp;FormName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8391606">,</span>&nbsp;<span class="ident" id="8391608">i</span><span class="op" id="8391609">,</span>&nbsp;<span class="ident" id="8391611">g</span><span class="op" id="8391612">,</span>&nbsp;<span class="ident" id="8391614">e</span><span class="op" id="8391615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8391623">if</span>&nbsp;<span class="ident" id="8391626">g</span><span class="op" id="8391627">,</span>&nbsp;<span class="ident" id="8391629">e</span>&nbsp;<span class="op" id="8391631">:=</span>&nbsp;<span class="ident" id="8391634">p</span><span class="op" id="8391635">.</span><span class="ident" id="8391636">FileName</span><span class="op" id="8391644">(</span><span class="op" id="8391645">)</span><span class="op" id="8391646">,</span>&nbsp;<span class="ident" id="8391648">test</span><span class="op" id="8391652">[</span><span class="num" id="8391653">2</span><span class="op" id="8391654">]</span><span class="op" id="8391655">;</span>&nbsp;<span class="ident" id="8391657">g</span>&nbsp;<span class="op" id="8391659">!=</span>&nbsp;<span class="ident" id="8391662">e</span>&nbsp;<span class="op" id="8391664">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391669">t</span><span class="op" id="8391670">.</span><span class="ident" id="8391671">Errorf</span><span class="op" id="8391677">(</span><span class="string" id="8391678">&#34;test&nbsp;%d:&nbsp;FileName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8391713">,</span>&nbsp;<span class="ident" id="8391715">i</span><span class="op" id="8391716">,</span>&nbsp;<span class="ident" id="8391718">g</span><span class="op" id="8391719">,</span>&nbsp;<span class="ident" id="8391721">e</span><span class="op" id="8391722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8391729">}</span><br>
<span class="lineno"></span><span class="op" id="8391731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="8391734">var</span>&nbsp;<span class="ident" id="8391738">longLine</span>&nbsp;<span class="op" id="8391747">=</span>&nbsp;<span class="ident" id="8391749">strings</span><span class="op" id="8391756">.</span><span class="ident" id="8391757">Repeat</span><span class="op" id="8391763">(</span><span class="string" id="8391764">&#34;\n\n\r\r\r\n\r\000&#34;</span><span class="op" id="8391784">,</span>&nbsp;<span class="op" id="8391786">(</span><span class="num" id="8391787">1</span><span class="op" id="8391788">&lt;&lt;</span><span class="num" id="8391790">20</span><span class="op" id="8391792">)</span><span class="op" id="8391793">/</span><span class="num" id="8391794">8</span><span class="op" id="8391795">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8391798">func</span>&nbsp;<span class="ident" id="8391803">testMultipartBody</span><span class="op" id="8391820">(</span><span class="ident" id="8391821">sep</span>&nbsp;<span class="builtintype" id="8391825">string</span><span class="op" id="8391831">)</span>&nbsp;<span class="builtintype" id="8391833">string</span>&nbsp;<span class="op" id="8391840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8391843">testBody</span>&nbsp;<span class="op" id="8391852">:=</span>&nbsp;<span class="string" id="8391855">`<br>
<span class="lineno"></span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno">80</span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1<br>
<span class="lineno"></span>HEADER2:&nbsp;value2<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno">85</span>My&nbsp;value<br>
<span class="lineno"></span>The&nbsp;end.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>name:&nbsp;bigsection<br>
<span class="lineno"></span><br>
<span class="lineno">90</span>[longline]<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1b<br>
<span class="lineno"></span>HEADER2:&nbsp;value2b<br>
<span class="lineno"></span>foo-bar:&nbsp;bazb<br>
<span class="lineno">95</span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno"></span>Line&nbsp;2<br>
<span class="lineno"></span>Line&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>--MyBoundary<br>
<span class="lineno"></span><br>
<span class="lineno"></span>never&nbsp;read&nbsp;data<br>
<span class="lineno"></span>--MyBoundary--<br>
<span class="lineno"></span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>useless&nbsp;trailer<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392212">testBody</span>&nbsp;<span class="op" id="8392221">=</span>&nbsp;<span class="ident" id="8392223">strings</span><span class="op" id="8392230">.</span><span class="ident" id="8392231">Replace</span><span class="op" id="8392238">(</span><span class="ident" id="8392239">testBody</span><span class="op" id="8392247">,</span>&nbsp;<span class="string" id="8392249">&#34;\n&#34;</span><span class="op" id="8392253">,</span>&nbsp;<span class="ident" id="8392255">sep</span><span class="op" id="8392258">,</span>&nbsp;<span class="op" id="8392260">-</span><span class="num" id="8392261">1</span><span class="op" id="8392262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392265">return</span>&nbsp;<span class="ident" id="8392272">strings</span><span class="op" id="8392279">.</span><span class="ident" id="8392280">Replace</span><span class="op" id="8392287">(</span><span class="ident" id="8392288">testBody</span><span class="op" id="8392296">,</span>&nbsp;<span class="string" id="8392298">&#34;[longline]&#34;</span><span class="op" id="8392310">,</span>&nbsp;<span class="ident" id="8392312">longLine</span><span class="op" id="8392320">,</span>&nbsp;<span class="num" id="8392322">1</span><span class="op" id="8392323">)</span><br>
<span class="lineno">110</span><span class="op" id="8392325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8392328">func</span>&nbsp;<span class="ident" id="8392333">TestMultipart</span><span class="op" id="8392346">(</span><span class="ident" id="8392347">t</span>&nbsp;<span class="op" id="8392349">*</span><span class="ident" id="8392350">testing</span><span class="op" id="8392357">.</span><span class="ident" id="8392358">T</span><span class="op" id="8392359">)</span>&nbsp;<span class="op" id="8392361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392364">bodyReader</span>&nbsp;<span class="op" id="8392375">:=</span>&nbsp;<span class="ident" id="8392378">strings</span><span class="op" id="8392385">.</span><span class="ident" id="8392386">NewReader</span><span class="op" id="8392395">(</span><span class="ident" id="8392396">testMultipartBody</span><span class="op" id="8392413">(</span><span class="string" id="8392414">&#34;\r\n&#34;</span><span class="op" id="8392420">)</span><span class="op" id="8392421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392424">testMultipart</span><span class="op" id="8392437">(</span><span class="ident" id="8392438">t</span><span class="op" id="8392439">,</span>&nbsp;<span class="ident" id="8392441">bodyReader</span><span class="op" id="8392451">,</span>&nbsp;<span class="builtintype" id="8392453">false</span><span class="op" id="8392458">)</span><br>
<span class="lineno">115</span><span class="op" id="8392460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8392463">func</span>&nbsp;<span class="ident" id="8392468">TestMultipartOnlyNewlines</span><span class="op" id="8392493">(</span><span class="ident" id="8392494">t</span>&nbsp;<span class="op" id="8392496">*</span><span class="ident" id="8392497">testing</span><span class="op" id="8392504">.</span><span class="ident" id="8392505">T</span><span class="op" id="8392506">)</span>&nbsp;<span class="op" id="8392508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392511">bodyReader</span>&nbsp;<span class="op" id="8392522">:=</span>&nbsp;<span class="ident" id="8392525">strings</span><span class="op" id="8392532">.</span><span class="ident" id="8392533">NewReader</span><span class="op" id="8392542">(</span><span class="ident" id="8392543">testMultipartBody</span><span class="op" id="8392560">(</span><span class="string" id="8392561">&#34;\n&#34;</span><span class="op" id="8392565">)</span><span class="op" id="8392566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392569">testMultipart</span><span class="op" id="8392582">(</span><span class="ident" id="8392583">t</span><span class="op" id="8392584">,</span>&nbsp;<span class="ident" id="8392586">bodyReader</span><span class="op" id="8392596">,</span>&nbsp;<span class="builtintype" id="8392598">true</span><span class="op" id="8392602">)</span><br>
<span class="lineno">120</span><span class="op" id="8392604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8392607">func</span>&nbsp;<span class="ident" id="8392612">TestMultipartSlowInput</span><span class="op" id="8392634">(</span><span class="ident" id="8392635">t</span>&nbsp;<span class="op" id="8392637">*</span><span class="ident" id="8392638">testing</span><span class="op" id="8392645">.</span><span class="ident" id="8392646">T</span><span class="op" id="8392647">)</span>&nbsp;<span class="op" id="8392649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392652">bodyReader</span>&nbsp;<span class="op" id="8392663">:=</span>&nbsp;<span class="ident" id="8392666">strings</span><span class="op" id="8392673">.</span><span class="ident" id="8392674">NewReader</span><span class="op" id="8392683">(</span><span class="ident" id="8392684">testMultipartBody</span><span class="op" id="8392701">(</span><span class="string" id="8392702">&#34;\r\n&#34;</span><span class="op" id="8392708">)</span><span class="op" id="8392709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392712">testMultipart</span><span class="op" id="8392725">(</span><span class="ident" id="8392726">t</span><span class="op" id="8392727">,</span>&nbsp;<span class="op" id="8392729">&amp;</span><span class="ident" id="8392730">slowReader</span><span class="op" id="8392740">{</span><span class="ident" id="8392741">bodyReader</span><span class="op" id="8392751">}</span><span class="op" id="8392752">,</span>&nbsp;<span class="builtintype" id="8392754">false</span><span class="op" id="8392759">)</span><br>
<span class="lineno">125</span><span class="op" id="8392761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8392764">func</span>&nbsp;<span class="ident" id="8392769">testMultipart</span><span class="op" id="8392782">(</span><span class="ident" id="8392783">t</span>&nbsp;<span class="op" id="8392785">*</span><span class="ident" id="8392786">testing</span><span class="op" id="8392793">.</span><span class="ident" id="8392794">T</span><span class="op" id="8392795">,</span>&nbsp;<span class="ident" id="8392797">r</span>&nbsp;<span class="ident" id="8392799">io</span><span class="op" id="8392801">.</span><span class="ident" id="8392802">Reader</span><span class="op" id="8392808">,</span>&nbsp;<span class="ident" id="8392810">onlyNewlines</span>&nbsp;<span class="builtintype" id="8392823">bool</span><span class="op" id="8392827">)</span>&nbsp;<span class="op" id="8392829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392832">reader</span>&nbsp;<span class="op" id="8392839">:=</span>&nbsp;<span class="ident" id="8392842">NewReader</span><span class="op" id="8392851">(</span><span class="ident" id="8392852">r</span><span class="op" id="8392853">,</span>&nbsp;<span class="string" id="8392855">&#34;MyBoundary&#34;</span><span class="op" id="8392867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392870">buf</span>&nbsp;<span class="op" id="8392874">:=</span>&nbsp;<span class="builtinfunc" id="8392877">new</span><span class="op" id="8392880">(</span><span class="ident" id="8392881">bytes</span><span class="op" id="8392886">.</span><span class="ident" id="8392887">Buffer</span><span class="op" id="8392893">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8392897">//&nbsp;Part1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392907">part</span><span class="op" id="8392911">,</span>&nbsp;<span class="ident" id="8392913">err</span>&nbsp;<span class="op" id="8392917">:=</span>&nbsp;<span class="ident" id="8392920">reader</span><span class="op" id="8392926">.</span><span class="ident" id="8392927">NextPart</span><span class="op" id="8392935">(</span><span class="op" id="8392936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8392939">if</span>&nbsp;<span class="ident" id="8392942">part</span>&nbsp;<span class="op" id="8392947">==</span>&nbsp;<span class="ident" id="8392950">nil</span>&nbsp;<span class="op" id="8392954">||</span>&nbsp;<span class="ident" id="8392957">err</span>&nbsp;<span class="op" id="8392961">!=</span>&nbsp;<span class="ident" id="8392964">nil</span>&nbsp;<span class="op" id="8392968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8392972">t</span><span class="op" id="8392973">.</span><span class="ident" id="8392974">Error</span><span class="op" id="8392979">(</span><span class="string" id="8392980">&#34;Expected&nbsp;part1&#34;</span><span class="op" id="8392996">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393000">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393011">if</span>&nbsp;<span class="ident" id="8393014">x</span>&nbsp;<span class="op" id="8393016">:=</span>&nbsp;<span class="ident" id="8393019">part</span><span class="op" id="8393023">.</span><span class="ident" id="8393024">Header</span><span class="op" id="8393030">.</span><span class="ident" id="8393031">Get</span><span class="op" id="8393034">(</span><span class="string" id="8393035">&#34;Header1&#34;</span><span class="op" id="8393044">)</span><span class="op" id="8393045">;</span>&nbsp;<span class="ident" id="8393047">x</span>&nbsp;<span class="op" id="8393049">!=</span>&nbsp;<span class="string" id="8393052">&#34;value1&#34;</span>&nbsp;<span class="op" id="8393061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393065">t</span><span class="op" id="8393066">.</span><span class="ident" id="8393067">Errorf</span><span class="op" id="8393073">(</span><span class="string" id="8393074">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8393109">,</span>&nbsp;<span class="string" id="8393111">&#34;Header1&#34;</span><span class="op" id="8393120">,</span>&nbsp;<span class="ident" id="8393122">x</span><span class="op" id="8393123">,</span>&nbsp;<span class="string" id="8393125">&#34;value1&#34;</span><span class="op" id="8393133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393136">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393139">if</span>&nbsp;<span class="ident" id="8393142">x</span>&nbsp;<span class="op" id="8393144">:=</span>&nbsp;<span class="ident" id="8393147">part</span><span class="op" id="8393151">.</span><span class="ident" id="8393152">Header</span><span class="op" id="8393158">.</span><span class="ident" id="8393159">Get</span><span class="op" id="8393162">(</span><span class="string" id="8393163">&#34;foo-bar&#34;</span><span class="op" id="8393172">)</span><span class="op" id="8393173">;</span>&nbsp;<span class="ident" id="8393175">x</span>&nbsp;<span class="op" id="8393177">!=</span>&nbsp;<span class="string" id="8393180">&#34;baz&#34;</span>&nbsp;<span class="op" id="8393186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393190">t</span><span class="op" id="8393191">.</span><span class="ident" id="8393192">Errorf</span><span class="op" id="8393198">(</span><span class="string" id="8393199">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8393234">,</span>&nbsp;<span class="string" id="8393236">&#34;foo-bar&#34;</span><span class="op" id="8393245">,</span>&nbsp;<span class="ident" id="8393247">x</span><span class="op" id="8393248">,</span>&nbsp;<span class="string" id="8393250">&#34;baz&#34;</span><span class="op" id="8393255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393261">if</span>&nbsp;<span class="ident" id="8393264">x</span>&nbsp;<span class="op" id="8393266">:=</span>&nbsp;<span class="ident" id="8393269">part</span><span class="op" id="8393273">.</span><span class="ident" id="8393274">Header</span><span class="op" id="8393280">.</span><span class="ident" id="8393281">Get</span><span class="op" id="8393284">(</span><span class="string" id="8393285">&#34;Foo-Bar&#34;</span><span class="op" id="8393294">)</span><span class="op" id="8393295">;</span>&nbsp;<span class="ident" id="8393297">x</span>&nbsp;<span class="op" id="8393299">!=</span>&nbsp;<span class="string" id="8393302">&#34;baz&#34;</span>&nbsp;<span class="op" id="8393308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393312">t</span><span class="op" id="8393313">.</span><span class="ident" id="8393314">Errorf</span><span class="op" id="8393320">(</span><span class="string" id="8393321">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8393356">,</span>&nbsp;<span class="string" id="8393358">&#34;Foo-Bar&#34;</span><span class="op" id="8393367">,</span>&nbsp;<span class="ident" id="8393369">x</span><span class="op" id="8393370">,</span>&nbsp;<span class="string" id="8393372">&#34;baz&#34;</span><span class="op" id="8393377">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393383">buf</span><span class="op" id="8393386">.</span><span class="ident" id="8393387">Reset</span><span class="op" id="8393392">(</span><span class="op" id="8393393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393396">if</span>&nbsp;<span class="ident" id="8393399">_</span><span class="op" id="8393400">,</span>&nbsp;<span class="ident" id="8393402">err</span>&nbsp;<span class="op" id="8393406">:=</span>&nbsp;<span class="ident" id="8393409">io</span><span class="op" id="8393411">.</span><span class="ident" id="8393412">Copy</span><span class="op" id="8393416">(</span><span class="ident" id="8393417">buf</span><span class="op" id="8393420">,</span>&nbsp;<span class="ident" id="8393422">part</span><span class="op" id="8393426">)</span><span class="op" id="8393427">;</span>&nbsp;<span class="ident" id="8393429">err</span>&nbsp;<span class="op" id="8393433">!=</span>&nbsp;<span class="ident" id="8393436">nil</span>&nbsp;<span class="op" id="8393440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393444">t</span><span class="op" id="8393445">.</span><span class="ident" id="8393446">Errorf</span><span class="op" id="8393452">(</span><span class="string" id="8393453">&#34;part&nbsp;1&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="8393470">,</span>&nbsp;<span class="ident" id="8393472">err</span><span class="op" id="8393475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393478">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393482">adjustNewlines</span>&nbsp;<span class="op" id="8393497">:=</span>&nbsp;<span class="keyword" id="8393500">func</span><span class="op" id="8393504">(</span><span class="ident" id="8393505">s</span>&nbsp;<span class="builtintype" id="8393507">string</span><span class="op" id="8393513">)</span>&nbsp;<span class="builtintype" id="8393515">string</span>&nbsp;<span class="op" id="8393522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393526">if</span>&nbsp;<span class="ident" id="8393529">onlyNewlines</span>&nbsp;<span class="op" id="8393542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393547">return</span>&nbsp;<span class="ident" id="8393554">strings</span><span class="op" id="8393561">.</span><span class="ident" id="8393562">Replace</span><span class="op" id="8393569">(</span><span class="ident" id="8393570">s</span><span class="op" id="8393571">,</span>&nbsp;<span class="string" id="8393573">&#34;\r\n&#34;</span><span class="op" id="8393579">,</span>&nbsp;<span class="string" id="8393581">&#34;\n&#34;</span><span class="op" id="8393585">,</span>&nbsp;<span class="op" id="8393587">-</span><span class="num" id="8393588">1</span><span class="op" id="8393589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393593">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393597">return</span>&nbsp;<span class="ident" id="8393604">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393611">expectEq</span><span class="op" id="8393619">(</span><span class="ident" id="8393620">t</span><span class="op" id="8393621">,</span>&nbsp;<span class="ident" id="8393623">adjustNewlines</span><span class="op" id="8393637">(</span><span class="string" id="8393638">&#34;My&nbsp;value\r\nThe&nbsp;end.&#34;</span><span class="op" id="8393660">)</span><span class="op" id="8393661">,</span>&nbsp;<span class="ident" id="8393663">buf</span><span class="op" id="8393666">.</span><span class="ident" id="8393667">String</span><span class="op" id="8393673">(</span><span class="op" id="8393674">)</span><span class="op" id="8393675">,</span>&nbsp;<span class="string" id="8393677">&#34;Value&nbsp;of&nbsp;first&nbsp;part&#34;</span><span class="op" id="8393698">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8393702">//&nbsp;Part2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393712">part</span><span class="op" id="8393716">,</span>&nbsp;<span class="ident" id="8393718">err</span>&nbsp;<span class="op" id="8393722">=</span>&nbsp;<span class="ident" id="8393724">reader</span><span class="op" id="8393730">.</span><span class="ident" id="8393731">NextPart</span><span class="op" id="8393739">(</span><span class="op" id="8393740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393743">if</span>&nbsp;<span class="ident" id="8393746">err</span>&nbsp;<span class="op" id="8393750">!=</span>&nbsp;<span class="ident" id="8393753">nil</span>&nbsp;<span class="op" id="8393757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393761">t</span><span class="op" id="8393762">.</span><span class="ident" id="8393763">Fatalf</span><span class="op" id="8393769">(</span><span class="string" id="8393770">&#34;Expected&nbsp;part2;&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="8393795">,</span>&nbsp;<span class="ident" id="8393797">err</span><span class="op" id="8393800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393804">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393815">if</span>&nbsp;<span class="ident" id="8393818">e</span><span class="op" id="8393819">,</span>&nbsp;<span class="ident" id="8393821">g</span>&nbsp;<span class="op" id="8393823">:=</span>&nbsp;<span class="string" id="8393826">&#34;bigsection&#34;</span><span class="op" id="8393838">,</span>&nbsp;<span class="ident" id="8393840">part</span><span class="op" id="8393844">.</span><span class="ident" id="8393845">Header</span><span class="op" id="8393851">.</span><span class="ident" id="8393852">Get</span><span class="op" id="8393855">(</span><span class="string" id="8393856">&#34;name&#34;</span><span class="op" id="8393862">)</span><span class="op" id="8393863">;</span>&nbsp;<span class="ident" id="8393865">e</span>&nbsp;<span class="op" id="8393867">!=</span>&nbsp;<span class="ident" id="8393870">g</span>&nbsp;<span class="op" id="8393872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393876">t</span><span class="op" id="8393877">.</span><span class="ident" id="8393878">Errorf</span><span class="op" id="8393884">(</span><span class="string" id="8393885">&#34;part2&#39;s&nbsp;name&nbsp;header:&nbsp;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8393927">,</span>&nbsp;<span class="ident" id="8393929">e</span><span class="op" id="8393930">,</span>&nbsp;<span class="ident" id="8393932">g</span><span class="op" id="8393933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8393936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8393939">buf</span><span class="op" id="8393942">.</span><span class="ident" id="8393943">Reset</span><span class="op" id="8393948">(</span><span class="op" id="8393949">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8393952">if</span>&nbsp;<span class="ident" id="8393955">_</span><span class="op" id="8393956">,</span>&nbsp;<span class="ident" id="8393958">err</span>&nbsp;<span class="op" id="8393962">:=</span>&nbsp;<span class="ident" id="8393965">io</span><span class="op" id="8393967">.</span><span class="ident" id="8393968">Copy</span><span class="op" id="8393972">(</span><span class="ident" id="8393973">buf</span><span class="op" id="8393976">,</span>&nbsp;<span class="ident" id="8393978">part</span><span class="op" id="8393982">)</span><span class="op" id="8393983">;</span>&nbsp;<span class="ident" id="8393985">err</span>&nbsp;<span class="op" id="8393989">!=</span>&nbsp;<span class="ident" id="8393992">nil</span>&nbsp;<span class="op" id="8393996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394000">t</span><span class="op" id="8394001">.</span><span class="ident" id="8394002">Errorf</span><span class="op" id="8394008">(</span><span class="string" id="8394009">&#34;part&nbsp;2&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="8394026">,</span>&nbsp;<span class="ident" id="8394028">err</span><span class="op" id="8394031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8394034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394037">s</span>&nbsp;<span class="op" id="8394039">:=</span>&nbsp;<span class="ident" id="8394042">buf</span><span class="op" id="8394045">.</span><span class="ident" id="8394046">String</span><span class="op" id="8394052">(</span><span class="op" id="8394053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8394056">if</span>&nbsp;<span class="builtinfunc" id="8394059">len</span><span class="op" id="8394062">(</span><span class="ident" id="8394063">s</span><span class="op" id="8394064">)</span>&nbsp;<span class="op" id="8394066">!=</span>&nbsp;<span class="builtinfunc" id="8394069">len</span><span class="op" id="8394072">(</span><span class="ident" id="8394073">longLine</span><span class="op" id="8394081">)</span>&nbsp;<span class="op" id="8394083">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394087">t</span><span class="op" id="8394088">.</span><span class="ident" id="8394089">Errorf</span><span class="op" id="8394095">(</span><span class="string" id="8394096">&#34;part2&nbsp;body&nbsp;expected&nbsp;long&nbsp;line&nbsp;of&nbsp;length&nbsp;%d;&nbsp;got&nbsp;length&nbsp;%d&#34;</span><span class="op" id="8394155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8394160">len</span><span class="op" id="8394163">(</span><span class="ident" id="8394164">longLine</span><span class="op" id="8394172">)</span><span class="op" id="8394173">,</span>&nbsp;<span class="builtinfunc" id="8394175">len</span><span class="op" id="8394178">(</span><span class="ident" id="8394179">s</span><span class="op" id="8394180">)</span><span class="op" id="8394181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8394184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8394187">if</span>&nbsp;<span class="ident" id="8394190">s</span>&nbsp;<span class="op" id="8394192">!=</span>&nbsp;<span class="ident" id="8394195">longLine</span>&nbsp;<span class="op" id="8394204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394208">t</span><span class="op" id="8394209">.</span><span class="ident" id="8394210">Errorf</span><span class="op" id="8394216">(</span><span class="string" id="8394217">&#34;part2&nbsp;long&nbsp;body&nbsp;didn&#39;t&nbsp;match&#34;</span><span class="op" id="8394247">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8394250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8394254">//&nbsp;Part3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394264">part</span><span class="op" id="8394268">,</span>&nbsp;<span class="ident" id="8394270">err</span>&nbsp;<span class="op" id="8394274">=</span>&nbsp;<span class="ident" id="8394276">reader</span><span class="op" id="8394282">.</span><span class="ident" id="8394283">NextPart</span><span class="op" id="8394291">(</span><span class="op" id="8394292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8394295">if</span>&nbsp;<span class="ident" id="8394298">part</span>&nbsp;<span class="op" id="8394303">==</span>&nbsp;<span class="ident" id="8394306">nil</span>&nbsp;<span class="op" id="8394310">||</span>&nbsp;<span class="ident" id="8394313">err</span>&nbsp;<span class="op" id="8394317">!=</span>&nbsp;<span class="ident" id="8394320">nil</span>&nbsp;<span class="op" id="8394324">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394328">t</span><span class="op" id="8394329">.</span><span class="ident" id="8394330">Error</span><span class="op" id="8394335">(</span><span class="string" id="8394336">&#34;Expected&nbsp;part3&#34;</span><span class="op" id="8394352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8394356">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8394364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8394367">if</span>&nbsp;<span class="ident" id="8394370">part</span><span class="op" id="8394374">.</span><span class="ident" id="8394375">Header</span><span class="op" id="8394381">.</span><span class="ident" id="8394382">Get</span><span class="op" id="8394385">(</span><span class="string" id="8394386">&#34;foo-bar&#34;</span><span class="op" id="8394395">)</span>&nbsp;<span class="op" id="8394397">!=</span>&nbsp;<span class="string" id="8394400">&#34;bazb&#34;</span>&nbsp;<span class="op" id="8394407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394411">t</span><span class="op" id="8394412">.</span><span class="ident" id="8394413">Error</span><span class="op" id="8394418">(</span><span class="string" id="8394419">&#34;Expected&nbsp;foo-bar:&nbsp;bazb&#34;</span><span class="op" id="8394443">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8394446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394449">buf</span><span class="op" id="8394452">.</span><span class="ident" id="8394453">Reset</span><span class="op" id="8394458">(</span><span class="op" id="8394459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8394462">if</span>&nbsp;<span class="ident" id="8394465">_</span><span class="op" id="8394466">,</span>&nbsp;<span class="ident" id="8394468">err</span>&nbsp;<span class="op" id="8394472">:=</span>&nbsp;<span class="ident" id="8394475">io</span><span class="op" id="8394477">.</span><span class="ident" id="8394478">Copy</span><span class="op" id="8394482">(</span><span class="ident" id="8394483">buf</span><span class="op" id="8394486">,</span>&nbsp;<span class="ident" id="8394488">part</span><span class="op" id="8394492">)</span><span class="op" id="8394493">;</span>&nbsp;<span class="ident" id="8394495">err</span>&nbsp;<span class="op" id="8394499">!=</span>&nbsp;<span class="ident" id="8394502">nil</span>&nbsp;<span class="op" id="8394506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394510">t</span><span class="op" id="8394511">.</span><span class="ident" id="8394512">Errorf</span><span class="op" id="8394518">(</span><span class="string" id="8394519">&#34;part&nbsp;3&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="8394536">,</span>&nbsp;<span class="ident" id="8394538">err</span><span class="op" id="8394541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8394544">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394547">expectEq</span><span class="op" id="8394555">(</span><span class="ident" id="8394556">t</span><span class="op" id="8394557">,</span>&nbsp;<span class="ident" id="8394559">adjustNewlines</span><span class="op" id="8394573">(</span><span class="string" id="8394574">&#34;Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.\r\n&#34;</span><span class="op" id="8394639">)</span><span class="op" id="8394640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394644">buf</span><span class="op" id="8394647">.</span><span class="ident" id="8394648">String</span><span class="op" id="8394654">(</span><span class="op" id="8394655">)</span><span class="op" id="8394656">,</span>&nbsp;<span class="string" id="8394658">&#34;body&nbsp;of&nbsp;part&nbsp;3&#34;</span><span class="op" id="8394674">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8394678">//&nbsp;Part4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394688">part</span><span class="op" id="8394692">,</span>&nbsp;<span class="ident" id="8394694">err</span>&nbsp;<span class="op" id="8394698">=</span>&nbsp;<span class="ident" id="8394700">reader</span><span class="op" id="8394706">.</span><span class="ident" id="8394707">NextPart</span><span class="op" id="8394715">(</span><span class="op" id="8394716">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8394719">if</span>&nbsp;<span class="ident" id="8394722">part</span>&nbsp;<span class="op" id="8394727">==</span>&nbsp;<span class="ident" id="8394730">nil</span>&nbsp;<span class="op" id="8394734">||</span>&nbsp;<span class="ident" id="8394737">err</span>&nbsp;<span class="op" id="8394741">!=</span>&nbsp;<span class="ident" id="8394744">nil</span>&nbsp;<span class="op" id="8394748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394752">t</span><span class="op" id="8394753">.</span><span class="ident" id="8394754">Error</span><span class="op" id="8394759">(</span><span class="string" id="8394760">&#34;Expected&nbsp;part&nbsp;4&nbsp;without&nbsp;errors&#34;</span><span class="op" id="8394792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8394796">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8394804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8394808">//&nbsp;Non-existent&nbsp;part5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394831">part</span><span class="op" id="8394835">,</span>&nbsp;<span class="ident" id="8394837">err</span>&nbsp;<span class="op" id="8394841">=</span>&nbsp;<span class="ident" id="8394843">reader</span><span class="op" id="8394849">.</span><span class="ident" id="8394850">NextPart</span><span class="op" id="8394858">(</span><span class="op" id="8394859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8394862">if</span>&nbsp;<span class="ident" id="8394865">part</span>&nbsp;<span class="op" id="8394870">!=</span>&nbsp;<span class="ident" id="8394873">nil</span>&nbsp;<span class="op" id="8394877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394881">t</span><span class="op" id="8394882">.</span><span class="ident" id="8394883">Error</span><span class="op" id="8394888">(</span><span class="string" id="8394889">&#34;Didn&#39;t&nbsp;expect&nbsp;a&nbsp;fifth&nbsp;part.&#34;</span><span class="op" id="8394918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8394921">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8394924">if</span>&nbsp;<span class="ident" id="8394927">err</span>&nbsp;<span class="op" id="8394931">!=</span>&nbsp;<span class="ident" id="8394934">io</span><span class="op" id="8394936">.</span><span class="ident" id="8394937">EOF</span>&nbsp;<span class="op" id="8394941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8394945">t</span><span class="op" id="8394946">.</span><span class="ident" id="8394947">Errorf</span><span class="op" id="8394953">(</span><span class="string" id="8394954">&#34;On&nbsp;fifth&nbsp;part&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8394993">,</span>&nbsp;<span class="ident" id="8394995">err</span><span class="op" id="8394998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8395001">}</span><br>
<span class="lineno"></span><span class="op" id="8395003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="8395006">func</span>&nbsp;<span class="ident" id="8395011">TestVariousTextLineEndings</span><span class="op" id="8395037">(</span><span class="ident" id="8395038">t</span>&nbsp;<span class="op" id="8395040">*</span><span class="ident" id="8395041">testing</span><span class="op" id="8395048">.</span><span class="ident" id="8395049">T</span><span class="op" id="8395050">)</span>&nbsp;<span class="op" id="8395052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395055">tests</span>&nbsp;<span class="op" id="8395061">:=</span>&nbsp;<span class="op" id="8395064">[</span><span class="op" id="8395065">...</span><span class="op" id="8395068">]</span><span class="builtintype" id="8395069">string</span><span class="op" id="8395075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8395079">&#34;Foo\nBar&#34;</span><span class="op" id="8395089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8395093">&#34;Foo\nBar\n&#34;</span><span class="op" id="8395105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8395109">&#34;Foo\r\nBar&#34;</span><span class="op" id="8395121">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8395125">&#34;Foo\r\nBar\r\n&#34;</span><span class="op" id="8395141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8395145">&#34;Foo\rBar&#34;</span><span class="op" id="8395155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8395159">&#34;Foo\rBar\r&#34;</span><span class="op" id="8395171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8395175">&#34;\x00\x01\x02\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&#34;</span><span class="op" id="8395221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8395224">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395228">for</span>&nbsp;<span class="ident" id="8395232">testNum</span><span class="op" id="8395239">,</span>&nbsp;<span class="ident" id="8395241">expectedBody</span>&nbsp;<span class="op" id="8395254">:=</span>&nbsp;<span class="keyword" id="8395257">range</span>&nbsp;<span class="ident" id="8395263">tests</span>&nbsp;<span class="op" id="8395269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395273">body</span>&nbsp;<span class="op" id="8395278">:=</span>&nbsp;<span class="string" id="8395281">&#34;--BOUNDARY\r\n&#34;</span>&nbsp;<span class="op" id="8395298">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8395303">&#34;Content-Disposition:&nbsp;form-data;&nbsp;name=\&#34;value\&#34;\r\n&#34;</span>&nbsp;<span class="op" id="8395356">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8395361">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="8395368">+</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395373">expectedBody</span>&nbsp;<span class="op" id="8395386">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8395391">&#34;\r\n--BOUNDARY--\r\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395416">bodyReader</span>&nbsp;<span class="op" id="8395427">:=</span>&nbsp;<span class="ident" id="8395430">strings</span><span class="op" id="8395437">.</span><span class="ident" id="8395438">NewReader</span><span class="op" id="8395447">(</span><span class="ident" id="8395448">body</span><span class="op" id="8395452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395457">reader</span>&nbsp;<span class="op" id="8395464">:=</span>&nbsp;<span class="ident" id="8395467">NewReader</span><span class="op" id="8395476">(</span><span class="ident" id="8395477">bodyReader</span><span class="op" id="8395487">,</span>&nbsp;<span class="string" id="8395489">&#34;BOUNDARY&#34;</span><span class="op" id="8395499">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395503">buf</span>&nbsp;<span class="op" id="8395507">:=</span>&nbsp;<span class="builtinfunc" id="8395510">new</span><span class="op" id="8395513">(</span><span class="ident" id="8395514">bytes</span><span class="op" id="8395519">.</span><span class="ident" id="8395520">Buffer</span><span class="op" id="8395526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395530">part</span><span class="op" id="8395534">,</span>&nbsp;<span class="ident" id="8395536">err</span>&nbsp;<span class="op" id="8395540">:=</span>&nbsp;<span class="ident" id="8395543">reader</span><span class="op" id="8395549">.</span><span class="ident" id="8395550">NextPart</span><span class="op" id="8395558">(</span><span class="op" id="8395559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395563">if</span>&nbsp;<span class="ident" id="8395566">part</span>&nbsp;<span class="op" id="8395571">==</span>&nbsp;<span class="ident" id="8395574">nil</span>&nbsp;<span class="op" id="8395578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395583">t</span><span class="op" id="8395584">.</span><span class="ident" id="8395585">Errorf</span><span class="op" id="8395591">(</span><span class="string" id="8395592">&#34;Expected&nbsp;a&nbsp;body&nbsp;part&nbsp;on&nbsp;text&nbsp;%d&#34;</span><span class="op" id="8395625">,</span>&nbsp;<span class="ident" id="8395627">testNum</span><span class="op" id="8395634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395639">continue</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8395650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395654">if</span>&nbsp;<span class="ident" id="8395657">err</span>&nbsp;<span class="op" id="8395661">!=</span>&nbsp;<span class="ident" id="8395664">nil</span>&nbsp;<span class="op" id="8395668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395673">t</span><span class="op" id="8395674">.</span><span class="ident" id="8395675">Errorf</span><span class="op" id="8395681">(</span><span class="string" id="8395682">&#34;Unexpected&nbsp;error&nbsp;on&nbsp;text&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="8395715">,</span>&nbsp;<span class="ident" id="8395717">testNum</span><span class="op" id="8395724">,</span>&nbsp;<span class="ident" id="8395726">err</span><span class="op" id="8395729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395734">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8395745">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395749">written</span><span class="op" id="8395756">,</span>&nbsp;<span class="ident" id="8395758">err</span>&nbsp;<span class="op" id="8395762">:=</span>&nbsp;<span class="ident" id="8395765">io</span><span class="op" id="8395767">.</span><span class="ident" id="8395768">Copy</span><span class="op" id="8395772">(</span><span class="ident" id="8395773">buf</span><span class="op" id="8395776">,</span>&nbsp;<span class="ident" id="8395778">part</span><span class="op" id="8395782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395786">expectEq</span><span class="op" id="8395794">(</span><span class="ident" id="8395795">t</span><span class="op" id="8395796">,</span>&nbsp;<span class="ident" id="8395798">expectedBody</span><span class="op" id="8395810">,</span>&nbsp;<span class="ident" id="8395812">buf</span><span class="op" id="8395815">.</span><span class="ident" id="8395816">String</span><span class="op" id="8395822">(</span><span class="op" id="8395823">)</span><span class="op" id="8395824">,</span>&nbsp;<span class="ident" id="8395826">fmt</span><span class="op" id="8395829">.</span><span class="ident" id="8395830">Sprintf</span><span class="op" id="8395837">(</span><span class="string" id="8395838">&#34;test&nbsp;%d&#34;</span><span class="op" id="8395847">,</span>&nbsp;<span class="ident" id="8395849">testNum</span><span class="op" id="8395856">)</span><span class="op" id="8395857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395861">if</span>&nbsp;<span class="ident" id="8395864">err</span>&nbsp;<span class="op" id="8395868">!=</span>&nbsp;<span class="ident" id="8395871">nil</span>&nbsp;<span class="op" id="8395875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395880">t</span><span class="op" id="8395881">.</span><span class="ident" id="8395882">Errorf</span><span class="op" id="8395888">(</span><span class="string" id="8395889">&#34;Error&nbsp;copying&nbsp;multipart;&nbsp;bytes=%v,&nbsp;error=%v&#34;</span><span class="op" id="8395934">,</span>&nbsp;<span class="ident" id="8395936">written</span><span class="op" id="8395943">,</span>&nbsp;<span class="ident" id="8395945">err</span><span class="op" id="8395948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8395952">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395957">part</span><span class="op" id="8395961">,</span>&nbsp;<span class="ident" id="8395963">err</span>&nbsp;<span class="op" id="8395967">=</span>&nbsp;<span class="ident" id="8395969">reader</span><span class="op" id="8395975">.</span><span class="ident" id="8395976">NextPart</span><span class="op" id="8395984">(</span><span class="op" id="8395985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395989">if</span>&nbsp;<span class="ident" id="8395992">part</span>&nbsp;<span class="op" id="8395997">!=</span>&nbsp;<span class="ident" id="8396000">nil</span>&nbsp;<span class="op" id="8396004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396009">t</span><span class="op" id="8396010">.</span><span class="ident" id="8396011">Errorf</span><span class="op" id="8396017">(</span><span class="string" id="8396018">&#34;Unexpected&nbsp;part&nbsp;in&nbsp;test&nbsp;%d&#34;</span><span class="op" id="8396046">,</span>&nbsp;<span class="ident" id="8396048">testNum</span><span class="op" id="8396055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8396059">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396063">if</span>&nbsp;<span class="ident" id="8396066">err</span>&nbsp;<span class="op" id="8396070">!=</span>&nbsp;<span class="ident" id="8396073">io</span><span class="op" id="8396075">.</span><span class="ident" id="8396076">EOF</span>&nbsp;<span class="op" id="8396080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396085">t</span><span class="op" id="8396086">.</span><span class="ident" id="8396087">Errorf</span><span class="op" id="8396093">(</span><span class="string" id="8396094">&#34;On&nbsp;test&nbsp;%d&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8396130">,</span>&nbsp;<span class="ident" id="8396132">testNum</span><span class="op" id="8396139">,</span>&nbsp;<span class="ident" id="8396141">err</span><span class="op" id="8396144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8396148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8396152">}</span><br>
<span class="lineno">260</span><span class="op" id="8396154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8396157">type</span>&nbsp;<span class="ident" id="8396162">maliciousReader</span>&nbsp;<span class="keyword" id="8396178">struct</span>&nbsp;<span class="op" id="8396185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396188">t</span>&nbsp;<span class="op" id="8396190">*</span><span class="ident" id="8396191">testing</span><span class="op" id="8396198">.</span><span class="ident" id="8396199">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396202">n</span>&nbsp;<span class="builtintype" id="8396204">int</span><br>
<span class="lineno">265</span><span class="op" id="8396208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8396211">const</span>&nbsp;<span class="ident" id="8396217">maxReadThreshold</span>&nbsp;<span class="op" id="8396234">=</span>&nbsp;<span class="num" id="8396236">1</span>&nbsp;<span class="op" id="8396238">&lt;&lt;</span>&nbsp;<span class="num" id="8396241">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8396245">func</span>&nbsp;<span class="op" id="8396250">(</span><span class="ident" id="8396251">mr</span>&nbsp;<span class="op" id="8396254">*</span><span class="ident" id="8396255">maliciousReader</span><span class="op" id="8396270">)</span>&nbsp;<span class="ident" id="8396272">Read</span><span class="op" id="8396276">(</span><span class="ident" id="8396277">b</span>&nbsp;<span class="op" id="8396279">[</span><span class="op" id="8396280">]</span><span class="builtintype" id="8396281">byte</span><span class="op" id="8396285">)</span>&nbsp;<span class="op" id="8396287">(</span><span class="ident" id="8396288">n</span>&nbsp;<span class="builtintype" id="8396290">int</span><span class="op" id="8396293">,</span>&nbsp;<span class="ident" id="8396295">err</span>&nbsp;<span class="builtintype" id="8396299">error</span><span class="op" id="8396304">)</span>&nbsp;<span class="op" id="8396306">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396309">mr</span><span class="op" id="8396311">.</span><span class="ident" id="8396312">n</span>&nbsp;<span class="op" id="8396314">+=</span>&nbsp;<span class="builtinfunc" id="8396317">len</span><span class="op" id="8396320">(</span><span class="ident" id="8396321">b</span><span class="op" id="8396322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396325">if</span>&nbsp;<span class="ident" id="8396328">mr</span><span class="op" id="8396330">.</span><span class="ident" id="8396331">n</span>&nbsp;<span class="op" id="8396333">&gt;=</span>&nbsp;<span class="ident" id="8396336">maxReadThreshold</span>&nbsp;<span class="op" id="8396353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396357">mr</span><span class="op" id="8396359">.</span><span class="ident" id="8396360">t</span><span class="op" id="8396361">.</span><span class="ident" id="8396362">Fatal</span><span class="op" id="8396367">(</span><span class="string" id="8396368">&#34;too&nbsp;much&nbsp;was&nbsp;read&#34;</span><span class="op" id="8396387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396391">return</span>&nbsp;<span class="num" id="8396398">0</span><span class="op" id="8396399">,</span>&nbsp;<span class="ident" id="8396401">io</span><span class="op" id="8396403">.</span><span class="ident" id="8396404">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8396409">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396412">return</span>&nbsp;<span class="builtinfunc" id="8396419">len</span><span class="op" id="8396422">(</span><span class="ident" id="8396423">b</span><span class="op" id="8396424">)</span><span class="op" id="8396425">,</span>&nbsp;<span class="ident" id="8396427">nil</span><br>
<span class="lineno"></span><span class="op" id="8396431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8396434">func</span>&nbsp;<span class="ident" id="8396439">TestLineLimit</span><span class="op" id="8396452">(</span><span class="ident" id="8396453">t</span>&nbsp;<span class="op" id="8396455">*</span><span class="ident" id="8396456">testing</span><span class="op" id="8396463">.</span><span class="ident" id="8396464">T</span><span class="op" id="8396465">)</span>&nbsp;<span class="op" id="8396467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396470">mr</span>&nbsp;<span class="op" id="8396473">:=</span>&nbsp;<span class="op" id="8396476">&amp;</span><span class="ident" id="8396477">maliciousReader</span><span class="op" id="8396492">{</span><span class="ident" id="8396493">t</span><span class="op" id="8396494">:</span>&nbsp;<span class="ident" id="8396496">t</span><span class="op" id="8396497">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396500">r</span>&nbsp;<span class="op" id="8396502">:=</span>&nbsp;<span class="ident" id="8396505">NewReader</span><span class="op" id="8396514">(</span><span class="ident" id="8396515">mr</span><span class="op" id="8396517">,</span>&nbsp;<span class="string" id="8396519">&#34;fooBoundary&#34;</span><span class="op" id="8396532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396535">part</span><span class="op" id="8396539">,</span>&nbsp;<span class="ident" id="8396541">err</span>&nbsp;<span class="op" id="8396545">:=</span>&nbsp;<span class="ident" id="8396548">r</span><span class="op" id="8396549">.</span><span class="ident" id="8396550">NextPart</span><span class="op" id="8396558">(</span><span class="op" id="8396559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396562">if</span>&nbsp;<span class="ident" id="8396565">part</span>&nbsp;<span class="op" id="8396570">!=</span>&nbsp;<span class="ident" id="8396573">nil</span>&nbsp;<span class="op" id="8396577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396581">t</span><span class="op" id="8396582">.</span><span class="ident" id="8396583">Errorf</span><span class="op" id="8396589">(</span><span class="string" id="8396590">&#34;unexpected&nbsp;part&nbsp;read&#34;</span><span class="op" id="8396612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8396615">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396618">if</span>&nbsp;<span class="ident" id="8396621">err</span>&nbsp;<span class="op" id="8396625">==</span>&nbsp;<span class="ident" id="8396628">nil</span>&nbsp;<span class="op" id="8396632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396636">t</span><span class="op" id="8396637">.</span><span class="ident" id="8396638">Errorf</span><span class="op" id="8396644">(</span><span class="string" id="8396645">&#34;expected&nbsp;an&nbsp;error&#34;</span><span class="op" id="8396664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8396667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396670">if</span>&nbsp;<span class="ident" id="8396673">mr</span><span class="op" id="8396675">.</span><span class="ident" id="8396676">n</span>&nbsp;<span class="op" id="8396678">&gt;=</span>&nbsp;<span class="ident" id="8396681">maxReadThreshold</span>&nbsp;<span class="op" id="8396698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396702">t</span><span class="op" id="8396703">.</span><span class="ident" id="8396704">Errorf</span><span class="op" id="8396710">(</span><span class="string" id="8396711">&#34;expected&nbsp;to&nbsp;read&nbsp;&lt;&nbsp;%d&nbsp;bytes;&nbsp;read&nbsp;%d&#34;</span><span class="op" id="8396749">,</span>&nbsp;<span class="ident" id="8396751">maxReadThreshold</span><span class="op" id="8396767">,</span>&nbsp;<span class="ident" id="8396769">mr</span><span class="op" id="8396771">.</span><span class="ident" id="8396772">n</span><span class="op" id="8396773">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8396776">}</span><br>
<span class="lineno"></span><span class="op" id="8396778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8396781">func</span>&nbsp;<span class="ident" id="8396786">TestMultipartTruncated</span><span class="op" id="8396808">(</span><span class="ident" id="8396809">t</span>&nbsp;<span class="op" id="8396811">*</span><span class="ident" id="8396812">testing</span><span class="op" id="8396819">.</span><span class="ident" id="8396820">T</span><span class="op" id="8396821">)</span>&nbsp;<span class="op" id="8396823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396826">testBody</span>&nbsp;<span class="op" id="8396835">:=</span>&nbsp;<span class="string" id="8396838">`<br>
<span class="lineno">295</span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Oh&nbsp;no,&nbsp;premature&nbsp;EOF!<br>
<span class="lineno">300</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396945">body</span>&nbsp;<span class="op" id="8396950">:=</span>&nbsp;<span class="ident" id="8396953">strings</span><span class="op" id="8396960">.</span><span class="ident" id="8396961">Replace</span><span class="op" id="8396968">(</span><span class="ident" id="8396969">testBody</span><span class="op" id="8396977">,</span>&nbsp;<span class="string" id="8396979">&#34;\n&#34;</span><span class="op" id="8396983">,</span>&nbsp;<span class="string" id="8396985">&#34;\r\n&#34;</span><span class="op" id="8396991">,</span>&nbsp;<span class="op" id="8396993">-</span><span class="num" id="8396994">1</span><span class="op" id="8396995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396998">bodyReader</span>&nbsp;<span class="op" id="8397009">:=</span>&nbsp;<span class="ident" id="8397012">strings</span><span class="op" id="8397019">.</span><span class="ident" id="8397020">NewReader</span><span class="op" id="8397029">(</span><span class="ident" id="8397030">body</span><span class="op" id="8397034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8397037">r</span>&nbsp;<span class="op" id="8397039">:=</span>&nbsp;<span class="ident" id="8397042">NewReader</span><span class="op" id="8397051">(</span><span class="ident" id="8397052">bodyReader</span><span class="op" id="8397062">,</span>&nbsp;<span class="string" id="8397064">&#34;MyBoundary&#34;</span><span class="op" id="8397076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8397080">part</span><span class="op" id="8397084">,</span>&nbsp;<span class="ident" id="8397086">err</span>&nbsp;<span class="op" id="8397090">:=</span>&nbsp;<span class="ident" id="8397093">r</span><span class="op" id="8397094">.</span><span class="ident" id="8397095">NextPart</span><span class="op" id="8397103">(</span><span class="op" id="8397104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8397107">if</span>&nbsp;<span class="ident" id="8397110">err</span>&nbsp;<span class="op" id="8397114">!=</span>&nbsp;<span class="ident" id="8397117">nil</span>&nbsp;<span class="op" id="8397121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8397125">t</span><span class="op" id="8397126">.</span><span class="ident" id="8397127">Fatalf</span><span class="op" id="8397133">(</span><span class="string" id="8397134">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="8397153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8397156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8397159">_</span><span class="op" id="8397160">,</span>&nbsp;<span class="ident" id="8397162">err</span>&nbsp;<span class="op" id="8397166">=</span>&nbsp;<span class="ident" id="8397168">io</span><span class="op" id="8397170">.</span><span class="ident" id="8397171">Copy</span><span class="op" id="8397175">(</span><span class="ident" id="8397176">ioutil</span><span class="op" id="8397182">.</span><span class="ident" id="8397183">Discard</span><span class="op" id="8397190">,</span>&nbsp;<span class="ident" id="8397192">part</span><span class="op" id="8397196">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8397199">if</span>&nbsp;<span class="ident" id="8397202">err</span>&nbsp;<span class="op" id="8397206">!=</span>&nbsp;<span class="ident" id="8397209">io</span><span class="op" id="8397211">.</span><span class="ident" id="8397212">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="8397229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8397233">t</span><span class="op" id="8397234">.</span><span class="ident" id="8397235">Fatalf</span><span class="op" id="8397241">(</span><span class="string" id="8397242">&#34;expected&nbsp;error&nbsp;io.ErrUnexpectedEOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8397286">,</span>&nbsp;<span class="ident" id="8397288">err</span><span class="op" id="8397291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8397294">}</span><br>
<span class="lineno"></span><span class="op" id="8397296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="8397299">type</span>&nbsp;<span class="ident" id="8397304">slowReader</span>&nbsp;<span class="keyword" id="8397315">struct</span>&nbsp;<span class="op" id="8397322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8397325">r</span>&nbsp;<span class="ident" id="8397327">io</span><span class="op" id="8397329">.</span><span class="ident" id="8397330">Reader</span><br>
<span class="lineno"></span><span class="op" id="8397337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8397340">func</span>&nbsp;<span class="op" id="8397345">(</span><span class="ident" id="8397346">s</span>&nbsp;<span class="op" id="8397348">*</span><span class="ident" id="8397349">slowReader</span><span class="op" id="8397359">)</span>&nbsp;<span class="ident" id="8397361">Read</span><span class="op" id="8397365">(</span><span class="ident" id="8397366">p</span>&nbsp;<span class="op" id="8397368">[</span><span class="op" id="8397369">]</span><span class="builtintype" id="8397370">byte</span><span class="op" id="8397374">)</span>&nbsp;<span class="op" id="8397376">(</span><span class="builtintype" id="8397377">int</span><span class="op" id="8397380">,</span>&nbsp;<span class="builtintype" id="8397382">error</span><span class="op" id="8397387">)</span>&nbsp;<span class="op" id="8397389">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8397392">if</span>&nbsp;<span class="builtinfunc" id="8397395">len</span><span class="op" id="8397398">(</span><span class="ident" id="8397399">p</span><span class="op" id="8397400">)</span>&nbsp;<span class="op" id="8397402">==</span>&nbsp;<span class="num" id="8397405">0</span>&nbsp;<span class="op" id="8397407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8397411">return</span>&nbsp;<span class="ident" id="8397418">s</span><span class="op" id="8397419">.</span><span class="ident" id="8397420">r</span><span class="op" id="8397421">.</span><span class="ident" id="8397422">Read</span><span class="op" id="8397426">(</span><span class="ident" id="8397427">p</span><span class="op" id="8397428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8397431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8397434">return</span>&nbsp;<span class="ident" id="8397441">s</span><span class="op" id="8397442">.</span><span class="ident" id="8397443">r</span><span class="op" id="8397444">.</span><span class="ident" id="8397445">Read</span><span class="op" id="8397449">(</span><span class="ident" id="8397450">p</span><span class="op" id="8397451">[</span><span class="op" id="8397452">:</span><span class="num" id="8397453">1</span><span class="op" id="8397454">]</span><span class="op" id="8397455">)</span><br>
<span class="lineno"></span><span class="op" id="8397457">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="8397460">func</span>&nbsp;<span class="ident" id="8397465">TestLineContinuation</span><span class="op" id="8397485">(</span><span class="ident" id="8397486">t</span>&nbsp;<span class="op" id="8397488">*</span><span class="ident" id="8397489">testing</span><span class="op" id="8397496">.</span><span class="ident" id="8397497">T</span><span class="op" id="8397498">)</span>&nbsp;<span class="op" id="8397500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8397503">//&nbsp;This&nbsp;body,&nbsp;extracted&nbsp;from&nbsp;an&nbsp;email,&nbsp;contains&nbsp;headers&nbsp;that&nbsp;span&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8397579">//&nbsp;lines.</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8397591">//&nbsp;TODO:&nbsp;The&nbsp;original&nbsp;mail&nbsp;ended&nbsp;with&nbsp;a&nbsp;double-newline&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8397658">//&nbsp;final&nbsp;delimiter;&nbsp;this&nbsp;was&nbsp;manually&nbsp;edited&nbsp;to&nbsp;use&nbsp;a&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8397719">testBody</span>&nbsp;<span class="op" id="8397728">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8397733">&#34;\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;7bit\nContent-Type:&nbsp;text/plain;\n\tcharset=US-ASCII;\n\tdelsp=yes;\n\tformat=flowed\n\nI&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;happening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).\n\n\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;quoted-printable\nContent-Type:&nbsp;text/html;\n\tcharset=ISO-8859-1\n\n&lt;HTML&gt;&lt;BODY&gt;I&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;=\nhappening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).=A0&nbsp;But&nbsp;I&nbsp;built&nbsp;it&nbsp;with&nbsp;XCode&nbsp;=\n2.0.&lt;/BODY&gt;&lt;/=\nHTML&gt;=\n\r\n--Apple-Mail-2-292336769--\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398229">r</span>&nbsp;<span class="op" id="8398231">:=</span>&nbsp;<span class="ident" id="8398234">NewReader</span><span class="op" id="8398243">(</span><span class="ident" id="8398244">strings</span><span class="op" id="8398251">.</span><span class="ident" id="8398252">NewReader</span><span class="op" id="8398261">(</span><span class="ident" id="8398262">testBody</span><span class="op" id="8398270">)</span><span class="op" id="8398271">,</span>&nbsp;<span class="string" id="8398273">&#34;Apple-Mail-2-292336769&#34;</span><span class="op" id="8398297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8398301">for</span>&nbsp;<span class="ident" id="8398305">i</span>&nbsp;<span class="op" id="8398307">:=</span>&nbsp;<span class="num" id="8398310">0</span><span class="op" id="8398311">;</span>&nbsp;<span class="ident" id="8398313">i</span>&nbsp;<span class="op" id="8398315">&lt;</span>&nbsp;<span class="num" id="8398317">2</span><span class="op" id="8398318">;</span>&nbsp;<span class="ident" id="8398320">i</span><span class="op" id="8398321">++</span>&nbsp;<span class="op" id="8398324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398328">part</span><span class="op" id="8398332">,</span>&nbsp;<span class="ident" id="8398334">err</span>&nbsp;<span class="op" id="8398338">:=</span>&nbsp;<span class="ident" id="8398341">r</span><span class="op" id="8398342">.</span><span class="ident" id="8398343">NextPart</span><span class="op" id="8398351">(</span><span class="op" id="8398352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8398356">if</span>&nbsp;<span class="ident" id="8398359">err</span>&nbsp;<span class="op" id="8398363">!=</span>&nbsp;<span class="ident" id="8398366">nil</span>&nbsp;<span class="op" id="8398370">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398375">t</span><span class="op" id="8398376">.</span><span class="ident" id="8398377">Fatalf</span><span class="op" id="8398383">(</span><span class="string" id="8398384">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="8398403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8398407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8398411">var</span>&nbsp;<span class="ident" id="8398415">buf</span>&nbsp;<span class="ident" id="8398419">bytes</span><span class="op" id="8398424">.</span><span class="ident" id="8398425">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398434">n</span><span class="op" id="8398435">,</span>&nbsp;<span class="ident" id="8398437">err</span>&nbsp;<span class="op" id="8398441">:=</span>&nbsp;<span class="ident" id="8398444">io</span><span class="op" id="8398446">.</span><span class="ident" id="8398447">Copy</span><span class="op" id="8398451">(</span><span class="op" id="8398452">&amp;</span><span class="ident" id="8398453">buf</span><span class="op" id="8398456">,</span>&nbsp;<span class="ident" id="8398458">part</span><span class="op" id="8398462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8398466">if</span>&nbsp;<span class="ident" id="8398469">err</span>&nbsp;<span class="op" id="8398473">!=</span>&nbsp;<span class="ident" id="8398476">nil</span>&nbsp;<span class="op" id="8398480">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398485">t</span><span class="op" id="8398486">.</span><span class="ident" id="8398487">Errorf</span><span class="op" id="8398493">(</span><span class="string" id="8398494">&#34;error&nbsp;reading&nbsp;part:&nbsp;%v\nread&nbsp;so&nbsp;far:&nbsp;%q&#34;</span><span class="op" id="8398535">,</span>&nbsp;<span class="ident" id="8398537">err</span><span class="op" id="8398540">,</span>&nbsp;<span class="ident" id="8398542">buf</span><span class="op" id="8398545">.</span><span class="ident" id="8398546">String</span><span class="op" id="8398552">(</span><span class="op" id="8398553">)</span><span class="op" id="8398554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8398558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8398562">if</span>&nbsp;<span class="ident" id="8398565">n</span>&nbsp;<span class="op" id="8398567">&lt;=</span>&nbsp;<span class="num" id="8398570">0</span>&nbsp;<span class="op" id="8398572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398577">t</span><span class="op" id="8398578">.</span><span class="ident" id="8398579">Errorf</span><span class="op" id="8398585">(</span><span class="string" id="8398586">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;expected&nbsp;&gt;0&#34;</span><span class="op" id="8398614">,</span>&nbsp;<span class="ident" id="8398616">n</span><span class="op" id="8398617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8398621">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8398624">}</span><br>
<span class="lineno"></span><span class="op" id="8398626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8398629">func</span>&nbsp;<span class="ident" id="8398634">TestQuotedPrintableEncoding</span><span class="op" id="8398661">(</span><span class="ident" id="8398662">t</span>&nbsp;<span class="op" id="8398664">*</span><span class="ident" id="8398665">testing</span><span class="op" id="8398672">.</span><span class="ident" id="8398673">T</span><span class="op" id="8398674">)</span>&nbsp;<span class="op" id="8398676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8398679">//&nbsp;From&nbsp;http://golang.org/issue/4411</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398717">body</span>&nbsp;<span class="op" id="8398722">:=</span>&nbsp;<span class="string" id="8398725">&#34;--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=text\r\nContent-Transfer-Encoding:&nbsp;quoted-printable\r\n\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words\r\n--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--0016e68ee29c5d515f04cedf6733--&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399459">r</span>&nbsp;<span class="op" id="8399461">:=</span>&nbsp;<span class="ident" id="8399464">NewReader</span><span class="op" id="8399473">(</span><span class="ident" id="8399474">strings</span><span class="op" id="8399481">.</span><span class="ident" id="8399482">NewReader</span><span class="op" id="8399491">(</span><span class="ident" id="8399492">body</span><span class="op" id="8399496">)</span><span class="op" id="8399497">,</span>&nbsp;<span class="string" id="8399499">&#34;0016e68ee29c5d515f04cedf6733&#34;</span><span class="op" id="8399529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399532">part</span><span class="op" id="8399536">,</span>&nbsp;<span class="ident" id="8399538">err</span>&nbsp;<span class="op" id="8399542">:=</span>&nbsp;<span class="ident" id="8399545">r</span><span class="op" id="8399546">.</span><span class="ident" id="8399547">NextPart</span><span class="op" id="8399555">(</span><span class="op" id="8399556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8399559">if</span>&nbsp;<span class="ident" id="8399562">err</span>&nbsp;<span class="op" id="8399566">!=</span>&nbsp;<span class="ident" id="8399569">nil</span>&nbsp;<span class="op" id="8399573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399577">t</span><span class="op" id="8399578">.</span><span class="ident" id="8399579">Fatal</span><span class="op" id="8399584">(</span><span class="ident" id="8399585">err</span><span class="op" id="8399588">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8399591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8399594">if</span>&nbsp;<span class="ident" id="8399597">te</span><span class="op" id="8399599">,</span>&nbsp;<span class="ident" id="8399601">ok</span>&nbsp;<span class="op" id="8399604">:=</span>&nbsp;<span class="ident" id="8399607">part</span><span class="op" id="8399611">.</span><span class="ident" id="8399612">Header</span><span class="op" id="8399618">[</span><span class="string" id="8399619">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="8399646">]</span><span class="op" id="8399647">;</span>&nbsp;<span class="ident" id="8399649">ok</span>&nbsp;<span class="op" id="8399652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399656">t</span><span class="op" id="8399657">.</span><span class="ident" id="8399658">Errorf</span><span class="op" id="8399664">(</span><span class="string" id="8399665">&#34;unexpected&nbsp;Content-Transfer-Encoding&nbsp;of&nbsp;%q&#34;</span><span class="op" id="8399709">,</span>&nbsp;<span class="ident" id="8399711">te</span><span class="op" id="8399713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8399716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8399719">var</span>&nbsp;<span class="ident" id="8399723">buf</span>&nbsp;<span class="ident" id="8399727">bytes</span><span class="op" id="8399732">.</span><span class="ident" id="8399733">Buffer</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399741">_</span><span class="op" id="8399742">,</span>&nbsp;<span class="ident" id="8399744">err</span>&nbsp;<span class="op" id="8399748">=</span>&nbsp;<span class="ident" id="8399750">io</span><span class="op" id="8399752">.</span><span class="ident" id="8399753">Copy</span><span class="op" id="8399757">(</span><span class="op" id="8399758">&amp;</span><span class="ident" id="8399759">buf</span><span class="op" id="8399762">,</span>&nbsp;<span class="ident" id="8399764">part</span><span class="op" id="8399768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8399771">if</span>&nbsp;<span class="ident" id="8399774">err</span>&nbsp;<span class="op" id="8399778">!=</span>&nbsp;<span class="ident" id="8399781">nil</span>&nbsp;<span class="op" id="8399785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399789">t</span><span class="op" id="8399790">.</span><span class="ident" id="8399791">Error</span><span class="op" id="8399796">(</span><span class="ident" id="8399797">err</span><span class="op" id="8399800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8399803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399806">got</span>&nbsp;<span class="op" id="8399810">:=</span>&nbsp;<span class="ident" id="8399813">buf</span><span class="op" id="8399816">.</span><span class="ident" id="8399817">String</span><span class="op" id="8399823">(</span><span class="op" id="8399824">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399827">want</span>&nbsp;<span class="op" id="8399832">:=</span>&nbsp;<span class="string" id="8399835">&#34;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8400192">if</span>&nbsp;<span class="ident" id="8400195">got</span>&nbsp;<span class="op" id="8400199">!=</span>&nbsp;<span class="ident" id="8400202">want</span>&nbsp;<span class="op" id="8400207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400211">t</span><span class="op" id="8400212">.</span><span class="ident" id="8400213">Errorf</span><span class="op" id="8400219">(</span><span class="string" id="8400220">&#34;wrong&nbsp;part&nbsp;value:\n&nbsp;got:&nbsp;%q\nwant:&nbsp;%q&#34;</span><span class="op" id="8400259">,</span>&nbsp;<span class="ident" id="8400261">got</span><span class="op" id="8400264">,</span>&nbsp;<span class="ident" id="8400266">want</span><span class="op" id="8400270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8400273">}</span><br>
<span class="lineno"></span><span class="op" id="8400275">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="8400278">//&nbsp;Test&nbsp;parsing&nbsp;an&nbsp;image&nbsp;attachment&nbsp;from&nbsp;gmail,&nbsp;which&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="8400351">func</span>&nbsp;<span class="ident" id="8400356">TestNested</span><span class="op" id="8400366">(</span><span class="ident" id="8400367">t</span>&nbsp;<span class="op" id="8400369">*</span><span class="ident" id="8400370">testing</span><span class="op" id="8400377">.</span><span class="ident" id="8400378">T</span><span class="op" id="8400379">)</span>&nbsp;<span class="op" id="8400381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8400384">//&nbsp;nested-mime&nbsp;is&nbsp;the&nbsp;body&nbsp;part&nbsp;of&nbsp;a&nbsp;multipart/mixed&nbsp;email</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8400444">//&nbsp;with&nbsp;boundary&nbsp;e89a8ff1c1e83553e304be640612</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400491">f</span><span class="op" id="8400492">,</span>&nbsp;<span class="ident" id="8400494">err</span>&nbsp;<span class="op" id="8400498">:=</span>&nbsp;<span class="ident" id="8400501">os</span><span class="op" id="8400503">.</span><span class="ident" id="8400504">Open</span><span class="op" id="8400508">(</span><span class="string" id="8400509">&#34;testdata/nested-mime&#34;</span><span class="op" id="8400531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8400534">if</span>&nbsp;<span class="ident" id="8400537">err</span>&nbsp;<span class="op" id="8400541">!=</span>&nbsp;<span class="ident" id="8400544">nil</span>&nbsp;<span class="op" id="8400548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400552">t</span><span class="op" id="8400553">.</span><span class="ident" id="8400554">Fatal</span><span class="op" id="8400559">(</span><span class="ident" id="8400560">err</span><span class="op" id="8400563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8400566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8400569">defer</span>&nbsp;<span class="ident" id="8400575">f</span><span class="op" id="8400576">.</span><span class="ident" id="8400577">Close</span><span class="op" id="8400582">(</span><span class="op" id="8400583">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400586">mr</span>&nbsp;<span class="op" id="8400589">:=</span>&nbsp;<span class="ident" id="8400592">NewReader</span><span class="op" id="8400601">(</span><span class="ident" id="8400602">f</span><span class="op" id="8400603">,</span>&nbsp;<span class="string" id="8400605">&#34;e89a8ff1c1e83553e304be640612&#34;</span><span class="op" id="8400635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400638">p</span><span class="op" id="8400639">,</span>&nbsp;<span class="ident" id="8400641">err</span>&nbsp;<span class="op" id="8400645">:=</span>&nbsp;<span class="ident" id="8400648">mr</span><span class="op" id="8400650">.</span><span class="ident" id="8400651">NextPart</span><span class="op" id="8400659">(</span><span class="op" id="8400660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8400663">if</span>&nbsp;<span class="ident" id="8400666">err</span>&nbsp;<span class="op" id="8400670">!=</span>&nbsp;<span class="ident" id="8400673">nil</span>&nbsp;<span class="op" id="8400677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400681">t</span><span class="op" id="8400682">.</span><span class="ident" id="8400683">Fatalf</span><span class="op" id="8400689">(</span><span class="string" id="8400690">&#34;error&nbsp;reading&nbsp;first&nbsp;section&nbsp;(alternative):&nbsp;%v&#34;</span><span class="op" id="8400737">,</span>&nbsp;<span class="ident" id="8400739">err</span><span class="op" id="8400742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8400745">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8400749">//&nbsp;Read&nbsp;the&nbsp;inner&nbsp;text/plain&nbsp;and&nbsp;text/html&nbsp;sections&nbsp;of&nbsp;the&nbsp;multipart/alternative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400832">mr2</span>&nbsp;<span class="op" id="8400836">:=</span>&nbsp;<span class="ident" id="8400839">NewReader</span><span class="op" id="8400848">(</span><span class="ident" id="8400849">p</span><span class="op" id="8400850">,</span>&nbsp;<span class="string" id="8400852">&#34;e89a8ff1c1e83553e004be640610&#34;</span><span class="op" id="8400882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400885">p</span><span class="op" id="8400886">,</span>&nbsp;<span class="ident" id="8400888">err</span>&nbsp;<span class="op" id="8400892">=</span>&nbsp;<span class="ident" id="8400894">mr2</span><span class="op" id="8400897">.</span><span class="ident" id="8400898">NextPart</span><span class="op" id="8400906">(</span><span class="op" id="8400907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8400910">if</span>&nbsp;<span class="ident" id="8400913">err</span>&nbsp;<span class="op" id="8400917">!=</span>&nbsp;<span class="ident" id="8400920">nil</span>&nbsp;<span class="op" id="8400924">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400928">t</span><span class="op" id="8400929">.</span><span class="ident" id="8400930">Fatalf</span><span class="op" id="8400936">(</span><span class="string" id="8400937">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="8400966">,</span>&nbsp;<span class="ident" id="8400968">err</span><span class="op" id="8400971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8400974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8400977">if</span>&nbsp;<span class="ident" id="8400980">b</span><span class="op" id="8400981">,</span>&nbsp;<span class="ident" id="8400983">err</span>&nbsp;<span class="op" id="8400987">:=</span>&nbsp;<span class="ident" id="8400990">ioutil</span><span class="op" id="8400996">.</span><span class="ident" id="8400997">ReadAll</span><span class="op" id="8401004">(</span><span class="ident" id="8401005">p</span><span class="op" id="8401006">)</span><span class="op" id="8401007">;</span>&nbsp;<span class="builtintype" id="8401009">string</span><span class="op" id="8401015">(</span><span class="ident" id="8401016">b</span><span class="op" id="8401017">)</span>&nbsp;<span class="op" id="8401019">!=</span>&nbsp;<span class="string" id="8401022">&#34;*body*\r\n&#34;</span>&nbsp;<span class="op" id="8401035">||</span>&nbsp;<span class="ident" id="8401038">err</span>&nbsp;<span class="op" id="8401042">!=</span>&nbsp;<span class="ident" id="8401045">nil</span>&nbsp;<span class="op" id="8401049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401053">t</span><span class="op" id="8401054">.</span><span class="ident" id="8401055">Fatalf</span><span class="op" id="8401061">(</span><span class="string" id="8401062">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8401099">,</span>&nbsp;<span class="ident" id="8401101">b</span><span class="op" id="8401102">,</span>&nbsp;<span class="ident" id="8401104">err</span><span class="op" id="8401107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401110">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401113">p</span><span class="op" id="8401114">,</span>&nbsp;<span class="ident" id="8401116">err</span>&nbsp;<span class="op" id="8401120">=</span>&nbsp;<span class="ident" id="8401122">mr2</span><span class="op" id="8401125">.</span><span class="ident" id="8401126">NextPart</span><span class="op" id="8401134">(</span><span class="op" id="8401135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8401138">if</span>&nbsp;<span class="ident" id="8401141">err</span>&nbsp;<span class="op" id="8401145">!=</span>&nbsp;<span class="ident" id="8401148">nil</span>&nbsp;<span class="op" id="8401152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401156">t</span><span class="op" id="8401157">.</span><span class="ident" id="8401158">Fatalf</span><span class="op" id="8401164">(</span><span class="string" id="8401165">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="8401193">,</span>&nbsp;<span class="ident" id="8401195">err</span><span class="op" id="8401198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8401204">if</span>&nbsp;<span class="ident" id="8401207">b</span><span class="op" id="8401208">,</span>&nbsp;<span class="ident" id="8401210">err</span>&nbsp;<span class="op" id="8401214">:=</span>&nbsp;<span class="ident" id="8401217">ioutil</span><span class="op" id="8401223">.</span><span class="ident" id="8401224">ReadAll</span><span class="op" id="8401231">(</span><span class="ident" id="8401232">p</span><span class="op" id="8401233">)</span><span class="op" id="8401234">;</span>&nbsp;<span class="builtintype" id="8401236">string</span><span class="op" id="8401242">(</span><span class="ident" id="8401243">b</span><span class="op" id="8401244">)</span>&nbsp;<span class="op" id="8401246">!=</span>&nbsp;<span class="string" id="8401249">&#34;&lt;b&gt;body&lt;/b&gt;\r\n&#34;</span>&nbsp;<span class="op" id="8401267">||</span>&nbsp;<span class="ident" id="8401270">err</span>&nbsp;<span class="op" id="8401274">!=</span>&nbsp;<span class="ident" id="8401277">nil</span>&nbsp;<span class="op" id="8401281">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401285">t</span><span class="op" id="8401286">.</span><span class="ident" id="8401287">Fatalf</span><span class="op" id="8401293">(</span><span class="string" id="8401294">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8401330">,</span>&nbsp;<span class="ident" id="8401332">b</span><span class="op" id="8401333">,</span>&nbsp;<span class="ident" id="8401335">err</span><span class="op" id="8401338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401345">p</span><span class="op" id="8401346">,</span>&nbsp;<span class="ident" id="8401348">err</span>&nbsp;<span class="op" id="8401352">=</span>&nbsp;<span class="ident" id="8401354">mr2</span><span class="op" id="8401357">.</span><span class="ident" id="8401358">NextPart</span><span class="op" id="8401366">(</span><span class="op" id="8401367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8401370">if</span>&nbsp;<span class="ident" id="8401373">err</span>&nbsp;<span class="op" id="8401377">!=</span>&nbsp;<span class="ident" id="8401380">io</span><span class="op" id="8401382">.</span><span class="ident" id="8401383">EOF</span>&nbsp;<span class="op" id="8401387">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401391">t</span><span class="op" id="8401392">.</span><span class="ident" id="8401393">Fatalf</span><span class="op" id="8401399">(</span><span class="string" id="8401400">&#34;final&nbsp;inner&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="8401440">,</span>&nbsp;<span class="ident" id="8401442">err</span><span class="op" id="8401445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8401452">//&nbsp;Back&nbsp;to&nbsp;the&nbsp;outer&nbsp;multipart/mixed,&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401521">_</span><span class="op" id="8401522">,</span>&nbsp;<span class="ident" id="8401524">err</span>&nbsp;<span class="op" id="8401528">=</span>&nbsp;<span class="ident" id="8401530">mr</span><span class="op" id="8401532">.</span><span class="ident" id="8401533">NextPart</span><span class="op" id="8401541">(</span><span class="op" id="8401542">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8401545">if</span>&nbsp;<span class="ident" id="8401548">err</span>&nbsp;<span class="op" id="8401552">!=</span>&nbsp;<span class="ident" id="8401555">nil</span>&nbsp;<span class="op" id="8401559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401563">t</span><span class="op" id="8401564">.</span><span class="ident" id="8401565">Fatalf</span><span class="op" id="8401571">(</span><span class="string" id="8401572">&#34;error&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment&nbsp;at&nbsp;the&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="8401623">,</span>&nbsp;<span class="ident" id="8401625">err</span><span class="op" id="8401628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401635">_</span><span class="op" id="8401636">,</span>&nbsp;<span class="ident" id="8401638">err</span>&nbsp;<span class="op" id="8401642">=</span>&nbsp;<span class="ident" id="8401644">mr</span><span class="op" id="8401646">.</span><span class="ident" id="8401647">NextPart</span><span class="op" id="8401655">(</span><span class="op" id="8401656">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8401659">if</span>&nbsp;<span class="ident" id="8401662">err</span>&nbsp;<span class="op" id="8401666">!=</span>&nbsp;<span class="ident" id="8401669">io</span><span class="op" id="8401671">.</span><span class="ident" id="8401672">EOF</span>&nbsp;<span class="op" id="8401676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401680">t</span><span class="op" id="8401681">.</span><span class="ident" id="8401682">Fatalf</span><span class="op" id="8401688">(</span><span class="string" id="8401689">&#34;final&nbsp;outer&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="8401729">,</span>&nbsp;<span class="ident" id="8401731">err</span><span class="op" id="8401734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401737">}</span><br>
<span class="lineno"></span><span class="op" id="8401739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="keyword" id="8401742">type</span>&nbsp;<span class="ident" id="8401747">headerBody</span>&nbsp;<span class="keyword" id="8401758">struct</span>&nbsp;<span class="op" id="8401765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401768">header</span>&nbsp;<span class="ident" id="8401775">textproto</span><span class="op" id="8401784">.</span><span class="ident" id="8401785">MIMEHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401797">body</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8401804">string</span><br>
<span class="lineno"></span><span class="op" id="8401811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="8401814">func</span>&nbsp;<span class="ident" id="8401819">formData</span><span class="op" id="8401827">(</span><span class="ident" id="8401828">key</span><span class="op" id="8401831">,</span>&nbsp;<span class="ident" id="8401833">value</span>&nbsp;<span class="builtintype" id="8401839">string</span><span class="op" id="8401845">)</span>&nbsp;<span class="ident" id="8401847">headerBody</span>&nbsp;<span class="op" id="8401858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8401861">return</span>&nbsp;<span class="ident" id="8401868">headerBody</span><span class="op" id="8401878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401882">textproto</span><span class="op" id="8401891">.</span><span class="ident" id="8401892">MIMEHeader</span><span class="op" id="8401902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8401907">&#34;Content-Type&#34;</span><span class="op" id="8401921">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8401930">{</span><span class="string" id="8401931">&#34;text/plain;&nbsp;charset=ISO-8859-1&#34;</span><span class="op" id="8401963">}</span><span class="op" id="8401964">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8401969">&#34;Content-Disposition&#34;</span><span class="op" id="8401990">:</span>&nbsp;<span class="op" id="8401992">{</span><span class="string" id="8401993">&#34;form-data;&nbsp;name=&#34;</span>&nbsp;<span class="op" id="8402012">+</span>&nbsp;<span class="ident" id="8402014">key</span><span class="op" id="8402017">}</span><span class="op" id="8402018">,</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8402022">}</span><span class="op" id="8402023">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402027">value</span><span class="op" id="8402032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8402035">}</span><br>
<span class="lineno"></span><span class="op" id="8402037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="8402040">type</span>&nbsp;<span class="ident" id="8402045">parseTest</span>&nbsp;<span class="keyword" id="8402055">struct</span>&nbsp;<span class="op" id="8402062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402065">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8402073">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402081">in</span><span class="op" id="8402083">,</span>&nbsp;<span class="ident" id="8402085">sep</span>&nbsp;<span class="builtintype" id="8402089">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402097">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8402105">[</span><span class="op" id="8402106">]</span><span class="ident" id="8402107">headerBody</span><br>
<span class="lineno"></span><span class="op" id="8402118">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="8402121">var</span>&nbsp;<span class="ident" id="8402125">parseTests</span>&nbsp;<span class="op" id="8402136">=</span>&nbsp;<span class="op" id="8402138">[</span><span class="op" id="8402139">]</span><span class="ident" id="8402140">parseTest</span><span class="op" id="8402149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8402152">//&nbsp;Actual&nbsp;body&nbsp;from&nbsp;App&nbsp;Engine&nbsp;on&nbsp;a&nbsp;blob&nbsp;upload.&nbsp;The&nbsp;final&nbsp;part&nbsp;(the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8402222">//&nbsp;Content-Type:&nbsp;message/external-body)&nbsp;is&nbsp;what&nbsp;App&nbsp;Engine&nbsp;replaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8402291">//&nbsp;the&nbsp;uploaded&nbsp;file&nbsp;with.&nbsp;&nbsp;The&nbsp;other&nbsp;form&nbsp;fields&nbsp;(prefixed&nbsp;with</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8402357">//&nbsp;&#34;other&#34;&nbsp;in&nbsp;their&nbsp;form-data&nbsp;name)&nbsp;are&nbsp;unchanged.&nbsp;&nbsp;A&nbsp;bug&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8402420">//&nbsp;reported&nbsp;with&nbsp;blob&nbsp;uploads&nbsp;failing&nbsp;when&nbsp;the&nbsp;other&nbsp;fields&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8402486">//&nbsp;empty.&nbsp;This&nbsp;was&nbsp;the&nbsp;MIME&nbsp;POST&nbsp;body&nbsp;that&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8402549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402553">name</span><span class="op" id="8402557">:</span>&nbsp;<span class="string" id="8402559">&#34;App&nbsp;Engine&nbsp;post&#34;</span><span class="op" id="8402576">,</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402580">sep</span><span class="op" id="8402583">:</span>&nbsp;&nbsp;<span class="string" id="8402586">&#34;00151757727e9583fd04bfbca4c6&#34;</span><span class="op" id="8402616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402620">in</span><span class="op" id="8402622">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8402626">&#34;--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty1\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo1\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo2\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty2\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\nContent-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n\r\n--00151757727e9583fd04bfbca4c6--&#34;</span><span class="op" id="8404534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404538">want</span><span class="op" id="8404542">:</span>&nbsp;<span class="op" id="8404544">[</span><span class="op" id="8404545">]</span><span class="ident" id="8404546">headerBody</span><span class="op" id="8404556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404561">formData</span><span class="op" id="8404569">(</span><span class="string" id="8404570">&#34;otherEmpty1&#34;</span><span class="op" id="8404583">,</span>&nbsp;<span class="string" id="8404585">&#34;&#34;</span><span class="op" id="8404587">)</span><span class="op" id="8404588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404593">formData</span><span class="op" id="8404601">(</span><span class="string" id="8404602">&#34;otherFoo1&#34;</span><span class="op" id="8404613">,</span>&nbsp;<span class="string" id="8404615">&#34;foo&#34;</span><span class="op" id="8404620">)</span><span class="op" id="8404621">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404626">formData</span><span class="op" id="8404634">(</span><span class="string" id="8404635">&#34;otherFoo2&#34;</span><span class="op" id="8404646">,</span>&nbsp;<span class="string" id="8404648">&#34;foo&#34;</span><span class="op" id="8404653">)</span><span class="op" id="8404654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404659">formData</span><span class="op" id="8404667">(</span><span class="string" id="8404668">&#34;otherEmpty2&#34;</span><span class="op" id="8404681">,</span>&nbsp;<span class="string" id="8404683">&#34;&#34;</span><span class="op" id="8404685">)</span><span class="op" id="8404686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404691">formData</span><span class="op" id="8404699">(</span><span class="string" id="8404700">&#34;otherRepeatFoo&#34;</span><span class="op" id="8404716">,</span>&nbsp;<span class="string" id="8404718">&#34;foo&#34;</span><span class="op" id="8404723">)</span><span class="op" id="8404724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404729">formData</span><span class="op" id="8404737">(</span><span class="string" id="8404738">&#34;otherRepeatFoo&#34;</span><span class="op" id="8404754">,</span>&nbsp;<span class="string" id="8404756">&#34;foo&#34;</span><span class="op" id="8404761">)</span><span class="op" id="8404762">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404767">formData</span><span class="op" id="8404775">(</span><span class="string" id="8404776">&#34;otherRepeatEmpty&#34;</span><span class="op" id="8404794">,</span>&nbsp;<span class="string" id="8404796">&#34;&#34;</span><span class="op" id="8404798">)</span><span class="op" id="8404799">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404804">formData</span><span class="op" id="8404812">(</span><span class="string" id="8404813">&#34;otherRepeatEmpty&#34;</span><span class="op" id="8404831">,</span>&nbsp;<span class="string" id="8404833">&#34;&#34;</span><span class="op" id="8404835">)</span><span class="op" id="8404836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404841">formData</span><span class="op" id="8404849">(</span><span class="string" id="8404850">&#34;submit&#34;</span><span class="op" id="8404858">,</span>&nbsp;<span class="string" id="8404860">&#34;Submit&#34;</span><span class="op" id="8404868">)</span><span class="op" id="8404869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8404874">{</span><span class="ident" id="8404875">textproto</span><span class="op" id="8404884">.</span><span class="ident" id="8404885">MIMEHeader</span><span class="op" id="8404895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8404901">&#34;Content-Type&#34;</span><span class="op" id="8404915">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8404924">{</span><span class="string" id="8404925">&#34;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q&#34;</span><span class="op" id="8405141">}</span><span class="op" id="8405142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8405148">&#34;Content-Disposition&#34;</span><span class="op" id="8405169">:</span>&nbsp;<span class="op" id="8405171">{</span><span class="string" id="8405172">&#34;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;&#34;</span><span class="op" id="8405217">}</span><span class="op" id="8405218">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405223">}</span><span class="op" id="8405224">,</span>&nbsp;<span class="string" id="8405226">&#34;Content-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n&#34;</span><span class="op" id="8405473">}</span><span class="op" id="8405474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405478">}</span><span class="op" id="8405479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405482">}</span><span class="op" id="8405483">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405487">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405563">name</span><span class="op" id="8405567">:</span>&nbsp;<span class="string" id="8405569">&#34;single&nbsp;empty&nbsp;part,&nbsp;--boundary&#34;</span><span class="op" id="8405600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405604">sep</span><span class="op" id="8405607">:</span>&nbsp;&nbsp;<span class="string" id="8405610">&#34;abc&#34;</span><span class="op" id="8405615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405619">in</span><span class="op" id="8405621">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8405625">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&#34;</span><span class="op" id="8405659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405663">want</span><span class="op" id="8405667">:</span>&nbsp;<span class="op" id="8405669">[</span><span class="op" id="8405670">]</span><span class="ident" id="8405671">headerBody</span><span class="op" id="8405681">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405686">{</span><span class="ident" id="8405687">textproto</span><span class="op" id="8405696">.</span><span class="ident" id="8405697">MIMEHeader</span><span class="op" id="8405707">{</span><span class="string" id="8405708">&#34;Foo&#34;</span><span class="op" id="8405713">:</span>&nbsp;<span class="op" id="8405715">{</span><span class="string" id="8405716">&#34;bar&#34;</span><span class="op" id="8405721">}</span><span class="op" id="8405722">}</span><span class="op" id="8405723">,</span>&nbsp;<span class="string" id="8405725">&#34;&#34;</span><span class="op" id="8405727">}</span><span class="op" id="8405728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405732">}</span><span class="op" id="8405733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405736">}</span><span class="op" id="8405737">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405741">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;\r\n--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405821">name</span><span class="op" id="8405825">:</span>&nbsp;<span class="string" id="8405827">&#34;single&nbsp;empty&nbsp;part,&nbsp;\r\n--boundary&#34;</span><span class="op" id="8405862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405866">sep</span><span class="op" id="8405869">:</span>&nbsp;&nbsp;<span class="string" id="8405872">&#34;abc&#34;</span><span class="op" id="8405877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405881">in</span><span class="op" id="8405883">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8405887">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n\r\n--abc--&#34;</span><span class="op" id="8405925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405929">want</span><span class="op" id="8405933">:</span>&nbsp;<span class="op" id="8405935">[</span><span class="op" id="8405936">]</span><span class="ident" id="8405937">headerBody</span><span class="op" id="8405947">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405952">{</span><span class="ident" id="8405953">textproto</span><span class="op" id="8405962">.</span><span class="ident" id="8405963">MIMEHeader</span><span class="op" id="8405973">{</span><span class="string" id="8405974">&#34;Foo&#34;</span><span class="op" id="8405979">:</span>&nbsp;<span class="op" id="8405981">{</span><span class="string" id="8405982">&#34;bar&#34;</span><span class="op" id="8405987">}</span><span class="op" id="8405988">}</span><span class="op" id="8405989">,</span>&nbsp;<span class="string" id="8405991">&#34;&#34;</span><span class="op" id="8405993">}</span><span class="op" id="8405994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405998">}</span><span class="op" id="8405999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406002">}</span><span class="op" id="8406003">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406007">//&nbsp;Final&nbsp;part&nbsp;empty.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406033">name</span><span class="op" id="8406037">:</span>&nbsp;<span class="string" id="8406039">&#34;final&nbsp;part&nbsp;empty&#34;</span><span class="op" id="8406057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406061">sep</span><span class="op" id="8406064">:</span>&nbsp;&nbsp;<span class="string" id="8406067">&#34;abc&#34;</span><span class="op" id="8406072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406076">in</span><span class="op" id="8406078">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8406082">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc\r\nFoo2:&nbsp;bar2\r\n\r\n--abc--&#34;</span><span class="op" id="8406143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406147">want</span><span class="op" id="8406151">:</span>&nbsp;<span class="op" id="8406153">[</span><span class="op" id="8406154">]</span><span class="ident" id="8406155">headerBody</span><span class="op" id="8406165">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406170">{</span><span class="ident" id="8406171">textproto</span><span class="op" id="8406180">.</span><span class="ident" id="8406181">MIMEHeader</span><span class="op" id="8406191">{</span><span class="string" id="8406192">&#34;Foo&#34;</span><span class="op" id="8406197">:</span>&nbsp;<span class="op" id="8406199">{</span><span class="string" id="8406200">&#34;bar&#34;</span><span class="op" id="8406205">}</span><span class="op" id="8406206">}</span><span class="op" id="8406207">,</span>&nbsp;<span class="string" id="8406209">&#34;&#34;</span><span class="op" id="8406211">}</span><span class="op" id="8406212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406217">{</span><span class="ident" id="8406218">textproto</span><span class="op" id="8406227">.</span><span class="ident" id="8406228">MIMEHeader</span><span class="op" id="8406238">{</span><span class="string" id="8406239">&#34;Foo2&#34;</span><span class="op" id="8406245">:</span>&nbsp;<span class="op" id="8406247">{</span><span class="string" id="8406248">&#34;bar2&#34;</span><span class="op" id="8406254">}</span><span class="op" id="8406255">}</span><span class="op" id="8406256">,</span>&nbsp;<span class="string" id="8406258">&#34;&#34;</span><span class="op" id="8406260">}</span><span class="op" id="8406261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406265">}</span><span class="op" id="8406266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406269">}</span><span class="op" id="8406270">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406274">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;newlines&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406336">name</span><span class="op" id="8406340">:</span>&nbsp;<span class="string" id="8406342">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;crlf&#34;</span><span class="op" id="8406370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406374">sep</span><span class="op" id="8406377">:</span>&nbsp;&nbsp;<span class="string" id="8406380">&#34;abc&#34;</span><span class="op" id="8406385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406389">in</span><span class="op" id="8406391">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8406395">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--\r\n&#34;</span><span class="op" id="8406433">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406437">want</span><span class="op" id="8406441">:</span>&nbsp;<span class="op" id="8406443">[</span><span class="op" id="8406444">]</span><span class="ident" id="8406445">headerBody</span><span class="op" id="8406455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406460">{</span><span class="ident" id="8406461">textproto</span><span class="op" id="8406470">.</span><span class="ident" id="8406471">MIMEHeader</span><span class="op" id="8406481">{</span><span class="string" id="8406482">&#34;Foo&#34;</span><span class="op" id="8406487">:</span>&nbsp;<span class="op" id="8406489">{</span><span class="string" id="8406490">&#34;bar&#34;</span><span class="op" id="8406495">}</span><span class="op" id="8406496">}</span><span class="op" id="8406497">,</span>&nbsp;<span class="string" id="8406499">&#34;&#34;</span><span class="op" id="8406501">}</span><span class="op" id="8406502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406506">}</span><span class="op" id="8406507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406510">}</span><span class="op" id="8406511">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406515">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;lwsp-chars&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406579">name</span><span class="op" id="8406583">:</span>&nbsp;<span class="string" id="8406585">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;lwsp&#34;</span><span class="op" id="8406613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406617">sep</span><span class="op" id="8406620">:</span>&nbsp;&nbsp;<span class="string" id="8406623">&#34;abc&#34;</span><span class="op" id="8406628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406632">in</span><span class="op" id="8406634">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8406638">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&nbsp;\t&#34;</span><span class="op" id="8406675">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406679">want</span><span class="op" id="8406683">:</span>&nbsp;<span class="op" id="8406685">[</span><span class="op" id="8406686">]</span><span class="ident" id="8406687">headerBody</span><span class="op" id="8406697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406702">{</span><span class="ident" id="8406703">textproto</span><span class="op" id="8406712">.</span><span class="ident" id="8406713">MIMEHeader</span><span class="op" id="8406723">{</span><span class="string" id="8406724">&#34;Foo&#34;</span><span class="op" id="8406729">:</span>&nbsp;<span class="op" id="8406731">{</span><span class="string" id="8406732">&#34;bar&#34;</span><span class="op" id="8406737">}</span><span class="op" id="8406738">}</span><span class="op" id="8406739">,</span>&nbsp;<span class="string" id="8406741">&#34;&#34;</span><span class="op" id="8406743">}</span><span class="op" id="8406744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406748">}</span><span class="op" id="8406749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406752">}</span><span class="op" id="8406753">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406757">//&nbsp;No&nbsp;parts&nbsp;(empty&nbsp;form&nbsp;as&nbsp;submitted&nbsp;by&nbsp;Chrome)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406810">name</span><span class="op" id="8406814">:</span>&nbsp;<span class="string" id="8406816">&#34;no&nbsp;parts&#34;</span><span class="op" id="8406826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406830">sep</span><span class="op" id="8406833">:</span>&nbsp;&nbsp;<span class="string" id="8406836">&#34;----WebKitFormBoundaryQfEAfzFOiSemeHfA&#34;</span><span class="op" id="8406876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406880">in</span><span class="op" id="8406882">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8406886">&#34;------WebKitFormBoundaryQfEAfzFOiSemeHfA--\r\n&#34;</span><span class="op" id="8406934">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406938">want</span><span class="op" id="8406942">:</span>&nbsp;<span class="op" id="8406944">[</span><span class="op" id="8406945">]</span><span class="ident" id="8406946">headerBody</span><span class="op" id="8406956">{</span><span class="op" id="8406957">}</span><span class="op" id="8406958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406961">}</span><span class="op" id="8406962">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406966">//&nbsp;Part&nbsp;containing&nbsp;data&nbsp;starting&nbsp;with&nbsp;the&nbsp;boundary,&nbsp;but&nbsp;with&nbsp;additional&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407047">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407051">name</span><span class="op" id="8407055">:</span>&nbsp;<span class="string" id="8407057">&#34;fake&nbsp;separator&nbsp;as&nbsp;data&#34;</span><span class="op" id="8407081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407085">sep</span><span class="op" id="8407088">:</span>&nbsp;&nbsp;<span class="string" id="8407091">&#34;sep&#34;</span><span class="op" id="8407096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407100">in</span><span class="op" id="8407102">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8407106">&#34;--sep\r\nFoo:&nbsp;bar\r\n\r\n--sepFAKE\r\n--sep--&#34;</span><span class="op" id="8407153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407157">want</span><span class="op" id="8407161">:</span>&nbsp;<span class="op" id="8407163">[</span><span class="op" id="8407164">]</span><span class="ident" id="8407165">headerBody</span><span class="op" id="8407175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407180">{</span><span class="ident" id="8407181">textproto</span><span class="op" id="8407190">.</span><span class="ident" id="8407191">MIMEHeader</span><span class="op" id="8407201">{</span><span class="string" id="8407202">&#34;Foo&#34;</span><span class="op" id="8407207">:</span>&nbsp;<span class="op" id="8407209">{</span><span class="string" id="8407210">&#34;bar&#34;</span><span class="op" id="8407215">}</span><span class="op" id="8407216">}</span><span class="op" id="8407217">,</span>&nbsp;<span class="string" id="8407219">&#34;--sepFAKE&#34;</span><span class="op" id="8407230">}</span><span class="op" id="8407231">,</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407235">}</span><span class="op" id="8407236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407239">}</span><span class="op" id="8407240">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8407244">//&nbsp;Part&nbsp;containing&nbsp;a&nbsp;boundary&nbsp;with&nbsp;whitespace&nbsp;following&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407305">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407309">name</span><span class="op" id="8407313">:</span>&nbsp;<span class="string" id="8407315">&#34;boundary&nbsp;with&nbsp;whitespace&#34;</span><span class="op" id="8407341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407345">sep</span><span class="op" id="8407348">:</span>&nbsp;&nbsp;<span class="string" id="8407351">&#34;sep&#34;</span><span class="op" id="8407356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407360">in</span><span class="op" id="8407362">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8407366">&#34;--sep&nbsp;\r\nFoo:&nbsp;bar\r\n\r\ntext\r\n--sep--&#34;</span><span class="op" id="8407409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407413">want</span><span class="op" id="8407417">:</span>&nbsp;<span class="op" id="8407419">[</span><span class="op" id="8407420">]</span><span class="ident" id="8407421">headerBody</span><span class="op" id="8407431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407436">{</span><span class="ident" id="8407437">textproto</span><span class="op" id="8407446">.</span><span class="ident" id="8407447">MIMEHeader</span><span class="op" id="8407457">{</span><span class="string" id="8407458">&#34;Foo&#34;</span><span class="op" id="8407463">:</span>&nbsp;<span class="op" id="8407465">{</span><span class="string" id="8407466">&#34;bar&#34;</span><span class="op" id="8407471">}</span><span class="op" id="8407472">}</span><span class="op" id="8407473">,</span>&nbsp;<span class="string" id="8407475">&#34;text&#34;</span><span class="op" id="8407481">}</span><span class="op" id="8407482">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407486">}</span><span class="op" id="8407487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407490">}</span><span class="op" id="8407491">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8407495">//&nbsp;With&nbsp;ignored&nbsp;leading&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407526">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407530">name</span><span class="op" id="8407534">:</span>&nbsp;<span class="string" id="8407536">&#34;leading&nbsp;line&#34;</span><span class="op" id="8407550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407554">sep</span><span class="op" id="8407557">:</span>&nbsp;&nbsp;<span class="string" id="8407560">&#34;MyBoundary&#34;</span><span class="op" id="8407572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407576">in</span><span class="op" id="8407578">:</span>&nbsp;<span class="ident" id="8407580">strings</span><span class="op" id="8407587">.</span><span class="ident" id="8407588">Replace</span><span class="op" id="8407595">(</span><span class="string" id="8407596">`This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo:&nbsp;bar<br>
<span class="lineno">560</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>--MyBoundary--`</span><span class="op" id="8407689">,</span>&nbsp;<span class="string" id="8407691">&#34;\n&#34;</span><span class="op" id="8407695">,</span>&nbsp;<span class="string" id="8407697">&#34;\r\n&#34;</span><span class="op" id="8407703">,</span>&nbsp;<span class="op" id="8407705">-</span><span class="num" id="8407706">1</span><span class="op" id="8407707">)</span><span class="op" id="8407708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407712">want</span><span class="op" id="8407716">:</span>&nbsp;<span class="op" id="8407718">[</span><span class="op" id="8407719">]</span><span class="ident" id="8407720">headerBody</span><span class="op" id="8407730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407735">{</span><span class="ident" id="8407736">textproto</span><span class="op" id="8407745">.</span><span class="ident" id="8407746">MIMEHeader</span><span class="op" id="8407756">{</span><span class="string" id="8407757">&#34;Foo&#34;</span><span class="op" id="8407762">:</span>&nbsp;<span class="op" id="8407764">{</span><span class="string" id="8407765">&#34;bar&#34;</span><span class="op" id="8407770">}</span><span class="op" id="8407771">}</span><span class="op" id="8407772">,</span>&nbsp;<span class="string" id="8407774">&#34;&#34;</span><span class="op" id="8407776">}</span><span class="op" id="8407777">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407781">}</span><span class="op" id="8407782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407785">}</span><span class="op" id="8407786">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407790">roundTripParseTest</span><span class="op" id="8407808">(</span><span class="op" id="8407809">)</span><span class="op" id="8407810">,</span><br>
<span class="lineno"></span><span class="op" id="8407812">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="keyword" id="8407815">func</span>&nbsp;<span class="ident" id="8407820">TestParse</span><span class="op" id="8407829">(</span><span class="ident" id="8407830">t</span>&nbsp;<span class="op" id="8407832">*</span><span class="ident" id="8407833">testing</span><span class="op" id="8407840">.</span><span class="ident" id="8407841">T</span><span class="op" id="8407842">)</span>&nbsp;<span class="op" id="8407844">{</span><br>
<span class="lineno"></span><span class="ident" id="8407846">Cases</span><span class="op" id="8407851">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407854">for</span>&nbsp;<span class="ident" id="8407858">_</span><span class="op" id="8407859">,</span>&nbsp;<span class="ident" id="8407861">tt</span>&nbsp;<span class="op" id="8407864">:=</span>&nbsp;<span class="keyword" id="8407867">range</span>&nbsp;<span class="ident" id="8407873">parseTests</span>&nbsp;<span class="op" id="8407884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407888">r</span>&nbsp;<span class="op" id="8407890">:=</span>&nbsp;<span class="ident" id="8407893">NewReader</span><span class="op" id="8407902">(</span><span class="ident" id="8407903">strings</span><span class="op" id="8407910">.</span><span class="ident" id="8407911">NewReader</span><span class="op" id="8407920">(</span><span class="ident" id="8407921">tt</span><span class="op" id="8407923">.</span><span class="ident" id="8407924">in</span><span class="op" id="8407926">)</span><span class="op" id="8407927">,</span>&nbsp;<span class="ident" id="8407929">tt</span><span class="op" id="8407931">.</span><span class="ident" id="8407932">sep</span><span class="op" id="8407935">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407939">got</span>&nbsp;<span class="op" id="8407943">:=</span>&nbsp;<span class="op" id="8407946">[</span><span class="op" id="8407947">]</span><span class="ident" id="8407948">headerBody</span><span class="op" id="8407958">{</span><span class="op" id="8407959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407963">for</span>&nbsp;<span class="op" id="8407967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407972">p</span><span class="op" id="8407973">,</span>&nbsp;<span class="ident" id="8407975">err</span>&nbsp;<span class="op" id="8407979">:=</span>&nbsp;<span class="ident" id="8407982">r</span><span class="op" id="8407983">.</span><span class="ident" id="8407984">NextPart</span><span class="op" id="8407992">(</span><span class="op" id="8407993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407998">if</span>&nbsp;<span class="ident" id="8408001">err</span>&nbsp;<span class="op" id="8408005">==</span>&nbsp;<span class="ident" id="8408008">io</span><span class="op" id="8408010">.</span><span class="ident" id="8408011">EOF</span>&nbsp;<span class="op" id="8408015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408021">break</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408035">if</span>&nbsp;<span class="ident" id="8408038">err</span>&nbsp;<span class="op" id="8408042">!=</span>&nbsp;<span class="ident" id="8408045">nil</span>&nbsp;<span class="op" id="8408049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408055">t</span><span class="op" id="8408056">.</span><span class="ident" id="8408057">Errorf</span><span class="op" id="8408063">(</span><span class="string" id="8408064">&#34;in&nbsp;test&nbsp;%q,&nbsp;NextPart:&nbsp;%v&#34;</span><span class="op" id="8408090">,</span>&nbsp;<span class="ident" id="8408092">tt</span><span class="op" id="8408094">.</span><span class="ident" id="8408095">name</span><span class="op" id="8408099">,</span>&nbsp;<span class="ident" id="8408101">err</span><span class="op" id="8408104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408110">continue</span>&nbsp;<span class="ident" id="8408119">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408128">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408133">pbody</span><span class="op" id="8408138">,</span>&nbsp;<span class="ident" id="8408140">err</span>&nbsp;<span class="op" id="8408144">:=</span>&nbsp;<span class="ident" id="8408147">ioutil</span><span class="op" id="8408153">.</span><span class="ident" id="8408154">ReadAll</span><span class="op" id="8408161">(</span><span class="ident" id="8408162">p</span><span class="op" id="8408163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408168">if</span>&nbsp;<span class="ident" id="8408171">err</span>&nbsp;<span class="op" id="8408175">!=</span>&nbsp;<span class="ident" id="8408178">nil</span>&nbsp;<span class="op" id="8408182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408188">t</span><span class="op" id="8408189">.</span><span class="ident" id="8408190">Errorf</span><span class="op" id="8408196">(</span><span class="string" id="8408197">&#34;in&nbsp;test&nbsp;%q,&nbsp;error&nbsp;reading&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="8408233">,</span>&nbsp;<span class="ident" id="8408235">tt</span><span class="op" id="8408237">.</span><span class="ident" id="8408238">name</span><span class="op" id="8408242">,</span>&nbsp;<span class="ident" id="8408244">err</span><span class="op" id="8408247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408253">continue</span>&nbsp;<span class="ident" id="8408262">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408271">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408276">got</span>&nbsp;<span class="op" id="8408280">=</span>&nbsp;<span class="builtinfunc" id="8408282">append</span><span class="op" id="8408288">(</span><span class="ident" id="8408289">got</span><span class="op" id="8408292">,</span>&nbsp;<span class="ident" id="8408294">headerBody</span><span class="op" id="8408304">{</span><span class="ident" id="8408305">p</span><span class="op" id="8408306">.</span><span class="ident" id="8408307">Header</span><span class="op" id="8408313">,</span>&nbsp;<span class="builtintype" id="8408315">string</span><span class="op" id="8408321">(</span><span class="ident" id="8408322">pbody</span><span class="op" id="8408327">)</span><span class="op" id="8408328">}</span><span class="op" id="8408329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408337">if</span>&nbsp;<span class="op" id="8408340">!</span><span class="ident" id="8408341">reflect</span><span class="op" id="8408348">.</span><span class="ident" id="8408349">DeepEqual</span><span class="op" id="8408358">(</span><span class="ident" id="8408359">tt</span><span class="op" id="8408361">.</span><span class="ident" id="8408362">want</span><span class="op" id="8408366">,</span>&nbsp;<span class="ident" id="8408368">got</span><span class="op" id="8408371">)</span>&nbsp;<span class="op" id="8408373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408378">t</span><span class="op" id="8408379">.</span><span class="ident" id="8408380">Errorf</span><span class="op" id="8408386">(</span><span class="string" id="8408387">&#34;test&nbsp;%q:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="8408417">,</span>&nbsp;<span class="ident" id="8408419">tt</span><span class="op" id="8408421">.</span><span class="ident" id="8408422">name</span><span class="op" id="8408426">,</span>&nbsp;<span class="ident" id="8408428">got</span><span class="op" id="8408431">,</span>&nbsp;<span class="ident" id="8408433">tt</span><span class="op" id="8408435">.</span><span class="ident" id="8408436">want</span><span class="op" id="8408440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408445">if</span>&nbsp;<span class="builtinfunc" id="8408448">len</span><span class="op" id="8408451">(</span><span class="ident" id="8408452">tt</span><span class="op" id="8408454">.</span><span class="ident" id="8408455">want</span><span class="op" id="8408459">)</span>&nbsp;<span class="op" id="8408461">!=</span>&nbsp;<span class="builtinfunc" id="8408464">len</span><span class="op" id="8408467">(</span><span class="ident" id="8408468">got</span><span class="op" id="8408471">)</span>&nbsp;<span class="op" id="8408473">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408479">t</span><span class="op" id="8408480">.</span><span class="ident" id="8408481">Errorf</span><span class="op" id="8408487">(</span><span class="string" id="8408488">&#34;test&nbsp;%q:&nbsp;got&nbsp;%d&nbsp;parts,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8408520">,</span>&nbsp;<span class="ident" id="8408522">tt</span><span class="op" id="8408524">.</span><span class="ident" id="8408525">name</span><span class="op" id="8408529">,</span>&nbsp;<span class="builtinfunc" id="8408531">len</span><span class="op" id="8408534">(</span><span class="ident" id="8408535">got</span><span class="op" id="8408538">)</span><span class="op" id="8408539">,</span>&nbsp;<span class="builtinfunc" id="8408541">len</span><span class="op" id="8408544">(</span><span class="ident" id="8408545">tt</span><span class="op" id="8408547">.</span><span class="ident" id="8408548">want</span><span class="op" id="8408552">)</span><span class="op" id="8408553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408558">}</span>&nbsp;<span class="keyword" id="8408560">else</span>&nbsp;<span class="keyword" id="8408565">if</span>&nbsp;<span class="builtinfunc" id="8408568">len</span><span class="op" id="8408571">(</span><span class="ident" id="8408572">got</span><span class="op" id="8408575">)</span>&nbsp;<span class="op" id="8408577">&gt;</span>&nbsp;<span class="num" id="8408579">1</span>&nbsp;<span class="op" id="8408581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408587">for</span>&nbsp;<span class="ident" id="8408591">pi</span><span class="op" id="8408593">,</span>&nbsp;<span class="ident" id="8408595">wantPart</span>&nbsp;<span class="op" id="8408604">:=</span>&nbsp;<span class="keyword" id="8408607">range</span>&nbsp;<span class="ident" id="8408613">tt</span><span class="op" id="8408615">.</span><span class="ident" id="8408616">want</span>&nbsp;<span class="op" id="8408621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408628">if</span>&nbsp;<span class="op" id="8408631">!</span><span class="ident" id="8408632">reflect</span><span class="op" id="8408639">.</span><span class="ident" id="8408640">DeepEqual</span><span class="op" id="8408649">(</span><span class="ident" id="8408650">wantPart</span><span class="op" id="8408658">,</span>&nbsp;<span class="ident" id="8408660">got</span><span class="op" id="8408663">[</span><span class="ident" id="8408664">pi</span><span class="op" id="8408666">]</span><span class="op" id="8408667">)</span>&nbsp;<span class="op" id="8408669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408677">t</span><span class="op" id="8408678">.</span><span class="ident" id="8408679">Errorf</span><span class="op" id="8408685">(</span><span class="string" id="8408686">&#34;test&nbsp;%q,&nbsp;part&nbsp;%d:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="8408725">,</span>&nbsp;<span class="ident" id="8408727">tt</span><span class="op" id="8408729">.</span><span class="ident" id="8408730">name</span><span class="op" id="8408734">,</span>&nbsp;<span class="ident" id="8408736">pi</span><span class="op" id="8408738">,</span>&nbsp;<span class="ident" id="8408740">got</span><span class="op" id="8408743">[</span><span class="ident" id="8408744">pi</span><span class="op" id="8408746">]</span><span class="op" id="8408747">,</span>&nbsp;<span class="ident" id="8408749">wantPart</span><span class="op" id="8408757">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408782">}</span><br>
<span class="lineno">605</span><span class="op" id="8408784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8408787">func</span>&nbsp;<span class="ident" id="8408792">roundTripParseTest</span><span class="op" id="8408810">(</span><span class="op" id="8408811">)</span>&nbsp;<span class="ident" id="8408813">parseTest</span>&nbsp;<span class="op" id="8408823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408826">t</span>&nbsp;<span class="op" id="8408828">:=</span>&nbsp;<span class="ident" id="8408831">parseTest</span><span class="op" id="8408840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408844">name</span><span class="op" id="8408848">:</span>&nbsp;<span class="string" id="8408850">&#34;round&nbsp;trip&#34;</span><span class="op" id="8408862">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408866">want</span><span class="op" id="8408870">:</span>&nbsp;<span class="op" id="8408872">[</span><span class="op" id="8408873">]</span><span class="ident" id="8408874">headerBody</span><span class="op" id="8408884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408889">formData</span><span class="op" id="8408897">(</span><span class="string" id="8408898">&#34;empty&#34;</span><span class="op" id="8408905">,</span>&nbsp;<span class="string" id="8408907">&#34;&#34;</span><span class="op" id="8408909">)</span><span class="op" id="8408910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408915">formData</span><span class="op" id="8408923">(</span><span class="string" id="8408924">&#34;lf&#34;</span><span class="op" id="8408928">,</span>&nbsp;<span class="string" id="8408930">&#34;\n&#34;</span><span class="op" id="8408934">)</span><span class="op" id="8408935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408940">formData</span><span class="op" id="8408948">(</span><span class="string" id="8408949">&#34;cr&#34;</span><span class="op" id="8408953">,</span>&nbsp;<span class="string" id="8408955">&#34;\r&#34;</span><span class="op" id="8408959">)</span><span class="op" id="8408960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408965">formData</span><span class="op" id="8408973">(</span><span class="string" id="8408974">&#34;crlf&#34;</span><span class="op" id="8408980">,</span>&nbsp;<span class="string" id="8408982">&#34;\r\n&#34;</span><span class="op" id="8408988">)</span><span class="op" id="8408989">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408994">formData</span><span class="op" id="8409002">(</span><span class="string" id="8409003">&#34;foo&#34;</span><span class="op" id="8409008">,</span>&nbsp;<span class="string" id="8409010">&#34;bar&#34;</span><span class="op" id="8409015">)</span><span class="op" id="8409016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409020">}</span><span class="op" id="8409021">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409027">var</span>&nbsp;<span class="ident" id="8409031">buf</span>&nbsp;<span class="ident" id="8409035">bytes</span><span class="op" id="8409040">.</span><span class="ident" id="8409041">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409049">w</span>&nbsp;<span class="op" id="8409051">:=</span>&nbsp;<span class="ident" id="8409054">NewWriter</span><span class="op" id="8409063">(</span><span class="op" id="8409064">&amp;</span><span class="ident" id="8409065">buf</span><span class="op" id="8409068">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409071">for</span>&nbsp;<span class="ident" id="8409075">_</span><span class="op" id="8409076">,</span>&nbsp;<span class="ident" id="8409078">p</span>&nbsp;<span class="op" id="8409080">:=</span>&nbsp;<span class="keyword" id="8409083">range</span>&nbsp;<span class="ident" id="8409089">t</span><span class="op" id="8409090">.</span><span class="ident" id="8409091">want</span>&nbsp;<span class="op" id="8409096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409100">pw</span><span class="op" id="8409102">,</span>&nbsp;<span class="ident" id="8409104">err</span>&nbsp;<span class="op" id="8409108">:=</span>&nbsp;<span class="ident" id="8409111">w</span><span class="op" id="8409112">.</span><span class="ident" id="8409113">CreatePart</span><span class="op" id="8409123">(</span><span class="ident" id="8409124">p</span><span class="op" id="8409125">.</span><span class="ident" id="8409126">header</span><span class="op" id="8409132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409136">if</span>&nbsp;<span class="ident" id="8409139">err</span>&nbsp;<span class="op" id="8409143">!=</span>&nbsp;<span class="ident" id="8409146">nil</span>&nbsp;<span class="op" id="8409150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8409155">panic</span><span class="op" id="8409160">(</span><span class="ident" id="8409161">err</span><span class="op" id="8409164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409168">}</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409172">_</span><span class="op" id="8409173">,</span>&nbsp;<span class="ident" id="8409175">err</span>&nbsp;<span class="op" id="8409179">=</span>&nbsp;<span class="ident" id="8409181">pw</span><span class="op" id="8409183">.</span><span class="ident" id="8409184">Write</span><span class="op" id="8409189">(</span><span class="op" id="8409190">[</span><span class="op" id="8409191">]</span><span class="builtintype" id="8409192">byte</span><span class="op" id="8409196">(</span><span class="ident" id="8409197">p</span><span class="op" id="8409198">.</span><span class="ident" id="8409199">body</span><span class="op" id="8409203">)</span><span class="op" id="8409204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409208">if</span>&nbsp;<span class="ident" id="8409211">err</span>&nbsp;<span class="op" id="8409215">!=</span>&nbsp;<span class="ident" id="8409218">nil</span>&nbsp;<span class="op" id="8409222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8409227">panic</span><span class="op" id="8409232">(</span><span class="ident" id="8409233">err</span><span class="op" id="8409236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409243">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409246">w</span><span class="op" id="8409247">.</span><span class="ident" id="8409248">Close</span><span class="op" id="8409253">(</span><span class="op" id="8409254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409257">t</span><span class="op" id="8409258">.</span><span class="ident" id="8409259">in</span>&nbsp;<span class="op" id="8409262">=</span>&nbsp;<span class="ident" id="8409264">buf</span><span class="op" id="8409267">.</span><span class="ident" id="8409268">String</span><span class="op" id="8409274">(</span><span class="op" id="8409275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409278">t</span><span class="op" id="8409279">.</span><span class="ident" id="8409280">sep</span>&nbsp;<span class="op" id="8409284">=</span>&nbsp;<span class="ident" id="8409286">w</span><span class="op" id="8409287">.</span><span class="ident" id="8409288">Boundary</span><span class="op" id="8409296">(</span><span class="op" id="8409297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409300">return</span>&nbsp;<span class="ident" id="8409307">t</span><br>
<span class="lineno"></span><span class="op" id="8409309">}</span>
</div>
</body>
</html>
