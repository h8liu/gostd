<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html" class="current">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4112277">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4112333">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4112387">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4112438">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4112475">package</span>&nbsp;<span class="ident" id="4112483">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4112488">import</span>&nbsp;<span class="op" id="4112495">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4112498">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4112508">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4112515">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4112518">var</span>&nbsp;<span class="op" id="4112522">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112525">//&nbsp;supportsIPv4&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112585">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112615">supportsIPv4</span>&nbsp;<span class="builtintype" id="4112628">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112635">//&nbsp;supportsIPv6&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112695">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112725">supportsIPv6</span>&nbsp;<span class="builtintype" id="4112738">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112745">//&nbsp;supportsIPv4map&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112803">//&nbsp;mapping&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;inside&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;at&nbsp;transport</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112867">//&nbsp;layer&nbsp;protocols.&nbsp;&nbsp;See&nbsp;RFC&nbsp;4291,&nbsp;RFC&nbsp;4038&nbsp;and&nbsp;RFC&nbsp;3493.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112926">supportsIPv4map</span>&nbsp;<span class="builtintype" id="4112942">bool</span><br>
<span class="lineno"></span><span class="op" id="4112947">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4112950">func</span>&nbsp;<span class="ident" id="4112955">init</span><span class="op" id="4112959">(</span><span class="op" id="4112960">)</span>&nbsp;<span class="op" id="4112962">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112965">sysInit</span><span class="op" id="4112972">(</span><span class="op" id="4112973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112976">supportsIPv4</span>&nbsp;<span class="op" id="4112989">=</span>&nbsp;<span class="ident" id="4112991">probeIPv4Stack</span><span class="op" id="4113005">(</span><span class="op" id="4113006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113009">supportsIPv6</span><span class="op" id="4113021">,</span>&nbsp;<span class="ident" id="4113023">supportsIPv4map</span>&nbsp;<span class="op" id="4113039">=</span>&nbsp;<span class="ident" id="4113041">probeIPv6Stack</span><span class="op" id="4113055">(</span><span class="op" id="4113056">)</span><br>
<span class="lineno"></span><span class="op" id="4113058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4113061">//&nbsp;A&nbsp;netaddr&nbsp;represents&nbsp;a&nbsp;network&nbsp;endpoint&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4113125">//&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="4113156">type</span>&nbsp;<span class="ident" id="4113161">netaddr</span>&nbsp;<span class="keyword" id="4113169">interface</span>&nbsp;<span class="op" id="4113179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4113182">//&nbsp;toAddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;represented&nbsp;in&nbsp;Addr&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4113244">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;nil.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113300">toAddr</span><span class="op" id="4113306">(</span><span class="op" id="4113307">)</span>&nbsp;<span class="ident" id="4113309">Addr</span><br>
<span class="lineno"></span><span class="op" id="4113314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4113317">//&nbsp;An&nbsp;addrList&nbsp;represents&nbsp;a&nbsp;list&nbsp;of&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="4113381">type</span>&nbsp;<span class="ident" id="4113386">addrList</span>&nbsp;<span class="op" id="4113395">[</span><span class="op" id="4113396">]</span><span class="ident" id="4113397">netaddr</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="4113406">func</span>&nbsp;<span class="op" id="4113411">(</span><span class="ident" id="4113412">al</span>&nbsp;<span class="ident" id="4113415">addrList</span><span class="op" id="4113423">)</span>&nbsp;<span class="ident" id="4113425">toAddr</span><span class="op" id="4113431">(</span><span class="op" id="4113432">)</span>&nbsp;<span class="ident" id="4113434">Addr</span>&nbsp;<span class="op" id="4113439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113442">switch</span>&nbsp;<span class="builtinfunc" id="4113449">len</span><span class="op" id="4113452">(</span><span class="ident" id="4113453">al</span><span class="op" id="4113455">)</span>&nbsp;<span class="op" id="4113457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113460">case</span>&nbsp;<span class="num" id="4113465">0</span><span class="op" id="4113466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113470">return</span>&nbsp;<span class="ident" id="4113477">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113482">case</span>&nbsp;<span class="num" id="4113487">1</span><span class="op" id="4113488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113492">return</span>&nbsp;<span class="ident" id="4113499">al</span><span class="op" id="4113501">[</span><span class="num" id="4113502">0</span><span class="op" id="4113503">]</span><span class="op" id="4113504">.</span><span class="ident" id="4113505">toAddr</span><span class="op" id="4113511">(</span><span class="op" id="4113512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113515">default</span><span class="op" id="4113522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4113526">//&nbsp;For&nbsp;now,&nbsp;we&#39;ll&nbsp;roughly&nbsp;pick&nbsp;first&nbsp;one&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4113577">//&nbsp;considering&nbsp;dealing&nbsp;with&nbsp;any&nbsp;preferences&nbsp;such&nbsp;as</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4113631">//&nbsp;DNS&nbsp;TTL,&nbsp;transport&nbsp;path&nbsp;quality,&nbsp;network&nbsp;routing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4113685">//&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113703">return</span>&nbsp;<span class="ident" id="4113710">al</span><span class="op" id="4113712">[</span><span class="num" id="4113713">0</span><span class="op" id="4113714">]</span><span class="op" id="4113715">.</span><span class="ident" id="4113716">toAddr</span><span class="op" id="4113722">(</span><span class="op" id="4113723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113726">}</span><br>
<span class="lineno"></span><span class="op" id="4113728">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4113731">var</span>&nbsp;<span class="ident" id="4113735">errNoSuitableAddress</span>&nbsp;<span class="op" id="4113756">=</span>&nbsp;<span class="ident" id="4113758">errors</span><span class="op" id="4113764">.</span><span class="ident" id="4113765">New</span><span class="op" id="4113768">(</span><span class="string" id="4113769">&#34;no&nbsp;suitable&nbsp;address&nbsp;found&#34;</span><span class="op" id="4113796">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4113799">//&nbsp;firstFavoriteAddr&nbsp;returns&nbsp;an&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4113867">//&nbsp;implement&nbsp;the&nbsp;netaddr&nbsp;interface.&nbsp;Known&nbsp;filters&nbsp;are&nbsp;nil,&nbsp;ipv4only</span><br>
<span class="lineno">65</span><span class="comment" id="4113935">//&nbsp;and&nbsp;ipv6only.&nbsp;It&nbsp;returns&nbsp;any&nbsp;address&nbsp;when&nbsp;filter&nbsp;is&nbsp;nil.&nbsp;The&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="4114006">//&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4114058">func</span>&nbsp;<span class="ident" id="4114063">firstFavoriteAddr</span><span class="op" id="4114080">(</span><span class="ident" id="4114081">filter</span>&nbsp;<span class="keyword" id="4114088">func</span><span class="op" id="4114092">(</span><span class="ident" id="4114093">IP</span><span class="op" id="4114095">)</span>&nbsp;<span class="ident" id="4114097">IP</span><span class="op" id="4114099">,</span>&nbsp;<span class="ident" id="4114101">ips</span>&nbsp;<span class="op" id="4114105">[</span><span class="op" id="4114106">]</span><span class="ident" id="4114107">IP</span><span class="op" id="4114109">,</span>&nbsp;<span class="ident" id="4114111">inetaddr</span>&nbsp;<span class="keyword" id="4114120">func</span><span class="op" id="4114124">(</span><span class="ident" id="4114125">IP</span><span class="op" id="4114127">)</span>&nbsp;<span class="ident" id="4114129">netaddr</span><span class="op" id="4114136">)</span>&nbsp;<span class="op" id="4114138">(</span><span class="ident" id="4114139">netaddr</span><span class="op" id="4114146">,</span>&nbsp;<span class="builtintype" id="4114148">error</span><span class="op" id="4114153">)</span>&nbsp;<span class="op" id="4114155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114158">if</span>&nbsp;<span class="ident" id="4114161">filter</span>&nbsp;<span class="op" id="4114168">!=</span>&nbsp;<span class="ident" id="4114171">nil</span>&nbsp;<span class="op" id="4114175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114179">return</span>&nbsp;<span class="ident" id="4114186">firstSupportedAddr</span><span class="op" id="4114204">(</span><span class="ident" id="4114205">filter</span><span class="op" id="4114211">,</span>&nbsp;<span class="ident" id="4114213">ips</span><span class="op" id="4114216">,</span>&nbsp;<span class="ident" id="4114218">inetaddr</span><span class="op" id="4114226">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114232">var</span>&nbsp;<span class="op" id="4114236">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114240">ipv4</span><span class="op" id="4114244">,</span>&nbsp;<span class="ident" id="4114246">ipv6</span><span class="op" id="4114250">,</span>&nbsp;<span class="ident" id="4114252">swap</span>&nbsp;<span class="builtintype" id="4114257">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114264">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114281">addrList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114291">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114294">for</span>&nbsp;<span class="ident" id="4114298">_</span><span class="op" id="4114299">,</span>&nbsp;<span class="ident" id="4114301">ip</span>&nbsp;<span class="op" id="4114304">:=</span>&nbsp;<span class="keyword" id="4114307">range</span>&nbsp;<span class="ident" id="4114313">ips</span>&nbsp;<span class="op" id="4114317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114321">//&nbsp;We&#39;ll&nbsp;take&nbsp;any&nbsp;IP&nbsp;address,&nbsp;but&nbsp;since&nbsp;the&nbsp;dialing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114375">//&nbsp;code&nbsp;does&nbsp;not&nbsp;yet&nbsp;try&nbsp;multiple&nbsp;addresses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114421">//&nbsp;effectively,&nbsp;prefer&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114472">//&nbsp;possible.&nbsp;This&nbsp;is&nbsp;especially&nbsp;relevant&nbsp;if&nbsp;localhost</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114528">//&nbsp;resolves&nbsp;to&nbsp;[ipv6-localhost,&nbsp;ipv4-localhost].&nbsp;Too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114583">//&nbsp;much&nbsp;code&nbsp;assumes&nbsp;localhost&nbsp;==&nbsp;ipv4-localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114635">if</span>&nbsp;<span class="ident" id="4114638">ip4</span>&nbsp;<span class="op" id="4114642">:=</span>&nbsp;<span class="ident" id="4114645">ipv4only</span><span class="op" id="4114653">(</span><span class="ident" id="4114654">ip</span><span class="op" id="4114656">)</span><span class="op" id="4114657">;</span>&nbsp;<span class="ident" id="4114659">ip4</span>&nbsp;<span class="op" id="4114663">!=</span>&nbsp;<span class="ident" id="4114666">nil</span>&nbsp;<span class="op" id="4114670">&amp;&amp;</span>&nbsp;<span class="op" id="4114673">!</span><span class="ident" id="4114674">ipv4</span>&nbsp;<span class="op" id="4114679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114684">list</span>&nbsp;<span class="op" id="4114689">=</span>&nbsp;<span class="builtinfunc" id="4114691">append</span><span class="op" id="4114697">(</span><span class="ident" id="4114698">list</span><span class="op" id="4114702">,</span>&nbsp;<span class="ident" id="4114704">inetaddr</span><span class="op" id="4114712">(</span><span class="ident" id="4114713">ip4</span><span class="op" id="4114716">)</span><span class="op" id="4114717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114722">ipv4</span>&nbsp;<span class="op" id="4114727">=</span>&nbsp;<span class="builtintype" id="4114729">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114737">if</span>&nbsp;<span class="ident" id="4114740">ipv6</span>&nbsp;<span class="op" id="4114745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114751">swap</span>&nbsp;<span class="op" id="4114756">=</span>&nbsp;<span class="builtintype" id="4114758">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114770">}</span>&nbsp;<span class="keyword" id="4114772">else</span>&nbsp;<span class="keyword" id="4114777">if</span>&nbsp;<span class="ident" id="4114780">ip6</span>&nbsp;<span class="op" id="4114784">:=</span>&nbsp;<span class="ident" id="4114787">ipv6only</span><span class="op" id="4114795">(</span><span class="ident" id="4114796">ip</span><span class="op" id="4114798">)</span><span class="op" id="4114799">;</span>&nbsp;<span class="ident" id="4114801">ip6</span>&nbsp;<span class="op" id="4114805">!=</span>&nbsp;<span class="ident" id="4114808">nil</span>&nbsp;<span class="op" id="4114812">&amp;&amp;</span>&nbsp;<span class="op" id="4114815">!</span><span class="ident" id="4114816">ipv6</span>&nbsp;<span class="op" id="4114821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114826">list</span>&nbsp;<span class="op" id="4114831">=</span>&nbsp;<span class="builtinfunc" id="4114833">append</span><span class="op" id="4114839">(</span><span class="ident" id="4114840">list</span><span class="op" id="4114844">,</span>&nbsp;<span class="ident" id="4114846">inetaddr</span><span class="op" id="4114854">(</span><span class="ident" id="4114855">ip6</span><span class="op" id="4114858">)</span><span class="op" id="4114859">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114864">ipv6</span>&nbsp;<span class="op" id="4114869">=</span>&nbsp;<span class="builtintype" id="4114871">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114882">if</span>&nbsp;<span class="ident" id="4114885">ipv4</span>&nbsp;<span class="op" id="4114890">&amp;&amp;</span>&nbsp;<span class="ident" id="4114893">ipv6</span>&nbsp;<span class="op" id="4114898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114903">if</span>&nbsp;<span class="ident" id="4114906">swap</span>&nbsp;<span class="op" id="4114911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114917">list</span><span class="op" id="4114921">[</span><span class="num" id="4114922">0</span><span class="op" id="4114923">]</span><span class="op" id="4114924">,</span>&nbsp;<span class="ident" id="4114926">list</span><span class="op" id="4114930">[</span><span class="num" id="4114931">1</span><span class="op" id="4114932">]</span>&nbsp;<span class="op" id="4114934">=</span>&nbsp;<span class="ident" id="4114936">list</span><span class="op" id="4114940">[</span><span class="num" id="4114941">1</span><span class="op" id="4114942">]</span><span class="op" id="4114943">,</span>&nbsp;<span class="ident" id="4114945">list</span><span class="op" id="4114949">[</span><span class="num" id="4114950">0</span><span class="op" id="4114951">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114961">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114975">switch</span>&nbsp;<span class="builtinfunc" id="4114982">len</span><span class="op" id="4114985">(</span><span class="ident" id="4114986">list</span><span class="op" id="4114990">)</span>&nbsp;<span class="op" id="4114992">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114995">case</span>&nbsp;<span class="num" id="4115000">0</span><span class="op" id="4115001">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115005">return</span>&nbsp;<span class="ident" id="4115012">nil</span><span class="op" id="4115015">,</span>&nbsp;<span class="ident" id="4115017">errNoSuitableAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115039">case</span>&nbsp;<span class="num" id="4115044">1</span><span class="op" id="4115045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115049">return</span>&nbsp;<span class="ident" id="4115056">list</span><span class="op" id="4115060">[</span><span class="num" id="4115061">0</span><span class="op" id="4115062">]</span><span class="op" id="4115063">,</span>&nbsp;<span class="ident" id="4115065">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115070">default</span><span class="op" id="4115077">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115081">return</span>&nbsp;<span class="ident" id="4115088">list</span><span class="op" id="4115092">,</span>&nbsp;<span class="ident" id="4115094">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115099">}</span><br>
<span class="lineno"></span><span class="op" id="4115101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4115104">func</span>&nbsp;<span class="ident" id="4115109">firstSupportedAddr</span><span class="op" id="4115127">(</span><span class="ident" id="4115128">filter</span>&nbsp;<span class="keyword" id="4115135">func</span><span class="op" id="4115139">(</span><span class="ident" id="4115140">IP</span><span class="op" id="4115142">)</span>&nbsp;<span class="ident" id="4115144">IP</span><span class="op" id="4115146">,</span>&nbsp;<span class="ident" id="4115148">ips</span>&nbsp;<span class="op" id="4115152">[</span><span class="op" id="4115153">]</span><span class="ident" id="4115154">IP</span><span class="op" id="4115156">,</span>&nbsp;<span class="ident" id="4115158">inetaddr</span>&nbsp;<span class="keyword" id="4115167">func</span><span class="op" id="4115171">(</span><span class="ident" id="4115172">IP</span><span class="op" id="4115174">)</span>&nbsp;<span class="ident" id="4115176">netaddr</span><span class="op" id="4115183">)</span>&nbsp;<span class="op" id="4115185">(</span><span class="ident" id="4115186">netaddr</span><span class="op" id="4115193">,</span>&nbsp;<span class="builtintype" id="4115195">error</span><span class="op" id="4115200">)</span>&nbsp;<span class="op" id="4115202">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115205">for</span>&nbsp;<span class="ident" id="4115209">_</span><span class="op" id="4115210">,</span>&nbsp;<span class="ident" id="4115212">ip</span>&nbsp;<span class="op" id="4115215">:=</span>&nbsp;<span class="keyword" id="4115218">range</span>&nbsp;<span class="ident" id="4115224">ips</span>&nbsp;<span class="op" id="4115228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115232">if</span>&nbsp;<span class="ident" id="4115235">ip</span>&nbsp;<span class="op" id="4115238">:=</span>&nbsp;<span class="ident" id="4115241">filter</span><span class="op" id="4115247">(</span><span class="ident" id="4115248">ip</span><span class="op" id="4115250">)</span><span class="op" id="4115251">;</span>&nbsp;<span class="ident" id="4115253">ip</span>&nbsp;<span class="op" id="4115256">!=</span>&nbsp;<span class="ident" id="4115259">nil</span>&nbsp;<span class="op" id="4115263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115268">return</span>&nbsp;<span class="ident" id="4115275">inetaddr</span><span class="op" id="4115283">(</span><span class="ident" id="4115284">ip</span><span class="op" id="4115286">)</span><span class="op" id="4115287">,</span>&nbsp;<span class="ident" id="4115289">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115298">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115301">return</span>&nbsp;<span class="ident" id="4115308">nil</span><span class="op" id="4115311">,</span>&nbsp;<span class="ident" id="4115313">errNoSuitableAddress</span><br>
<span class="lineno"></span><span class="op" id="4115334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4115337">//&nbsp;ipv4only&nbsp;returns&nbsp;IPv4&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4115406">//&nbsp;IPv4&nbsp;addressing&nbsp;modes.&nbsp;If&nbsp;ip&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;ipv4only&nbsp;returns&nbsp;ip.</span><br>
<span class="lineno">120</span><span class="comment" id="4115479">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4115508">func</span>&nbsp;<span class="ident" id="4115513">ipv4only</span><span class="op" id="4115521">(</span><span class="ident" id="4115522">ip</span>&nbsp;<span class="ident" id="4115525">IP</span><span class="op" id="4115527">)</span>&nbsp;<span class="ident" id="4115529">IP</span>&nbsp;<span class="op" id="4115532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115535">if</span>&nbsp;<span class="ident" id="4115538">supportsIPv4</span>&nbsp;<span class="op" id="4115551">&amp;&amp;</span>&nbsp;<span class="ident" id="4115554">ip</span><span class="op" id="4115556">.</span><span class="ident" id="4115557">To4</span><span class="op" id="4115560">(</span><span class="op" id="4115561">)</span>&nbsp;<span class="op" id="4115563">!=</span>&nbsp;<span class="ident" id="4115566">nil</span>&nbsp;<span class="op" id="4115570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115574">return</span>&nbsp;<span class="ident" id="4115581">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115585">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115588">return</span>&nbsp;<span class="ident" id="4115595">nil</span><br>
<span class="lineno"></span><span class="op" id="4115599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4115602">//&nbsp;ipv6only&nbsp;returns&nbsp;IPv6&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4115671">//&nbsp;IPv6&nbsp;addressing&nbsp;modes.&nbsp;&nbsp;It&nbsp;returns&nbsp;IPv4-mapped&nbsp;IPv6&nbsp;addresses&nbsp;as</span><br>
<span class="lineno">130</span><span class="comment" id="4115739">//&nbsp;nils&nbsp;and&nbsp;returns&nbsp;other&nbsp;IPv6&nbsp;address&nbsp;types&nbsp;as&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="4115803">func</span>&nbsp;<span class="ident" id="4115808">ipv6only</span><span class="op" id="4115816">(</span><span class="ident" id="4115817">ip</span>&nbsp;<span class="ident" id="4115820">IP</span><span class="op" id="4115822">)</span>&nbsp;<span class="ident" id="4115824">IP</span>&nbsp;<span class="op" id="4115827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115830">if</span>&nbsp;<span class="ident" id="4115833">supportsIPv6</span>&nbsp;<span class="op" id="4115846">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4115849">len</span><span class="op" id="4115852">(</span><span class="ident" id="4115853">ip</span><span class="op" id="4115855">)</span>&nbsp;<span class="op" id="4115857">==</span>&nbsp;<span class="ident" id="4115860">IPv6len</span>&nbsp;<span class="op" id="4115868">&amp;&amp;</span>&nbsp;<span class="ident" id="4115871">ip</span><span class="op" id="4115873">.</span><span class="ident" id="4115874">To4</span><span class="op" id="4115877">(</span><span class="op" id="4115878">)</span>&nbsp;<span class="op" id="4115880">==</span>&nbsp;<span class="ident" id="4115883">nil</span>&nbsp;<span class="op" id="4115887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115891">return</span>&nbsp;<span class="ident" id="4115898">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4115902">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115905">return</span>&nbsp;<span class="ident" id="4115912">nil</span><br>
<span class="lineno"></span><span class="op" id="4115916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4115919">//&nbsp;SplitHostPort&nbsp;splits&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4115986">//&nbsp;&#34;[host]:port&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:port&#34;&nbsp;into&nbsp;host&nbsp;or</span><br>
<span class="lineno">140</span><span class="comment" id="4116043">//&nbsp;ipv6-host%zone&nbsp;and&nbsp;port.&nbsp;&nbsp;A&nbsp;literal&nbsp;address&nbsp;or&nbsp;host&nbsp;name&nbsp;for&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="4116112">//&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4116170">//&nbsp;&#34;[ipv6-host]:http&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4116218">func</span>&nbsp;<span class="ident" id="4116223">SplitHostPort</span><span class="op" id="4116236">(</span><span class="ident" id="4116237">hostport</span>&nbsp;<span class="builtintype" id="4116246">string</span><span class="op" id="4116252">)</span>&nbsp;<span class="op" id="4116254">(</span><span class="ident" id="4116255">host</span><span class="op" id="4116259">,</span>&nbsp;<span class="ident" id="4116261">port</span>&nbsp;<span class="builtintype" id="4116266">string</span><span class="op" id="4116272">,</span>&nbsp;<span class="ident" id="4116274">err</span>&nbsp;<span class="builtintype" id="4116278">error</span><span class="op" id="4116283">)</span>&nbsp;<span class="op" id="4116285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116288">j</span><span class="op" id="4116289">,</span>&nbsp;<span class="ident" id="4116291">k</span>&nbsp;<span class="op" id="4116293">:=</span>&nbsp;<span class="num" id="4116296">0</span><span class="op" id="4116297">,</span>&nbsp;<span class="num" id="4116299">0</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4116303">//&nbsp;The&nbsp;port&nbsp;starts&nbsp;after&nbsp;the&nbsp;last&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116345">i</span>&nbsp;<span class="op" id="4116347">:=</span>&nbsp;<span class="ident" id="4116350">last</span><span class="op" id="4116354">(</span><span class="ident" id="4116355">hostport</span><span class="op" id="4116363">,</span>&nbsp;<span class="string" id="4116365">&#39;:&#39;</span><span class="op" id="4116368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116371">if</span>&nbsp;<span class="ident" id="4116374">i</span>&nbsp;<span class="op" id="4116376">&lt;</span>&nbsp;<span class="num" id="4116378">0</span>&nbsp;<span class="op" id="4116380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116384">goto</span>&nbsp;<span class="ident" id="4116389">missingPort</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116406">if</span>&nbsp;<span class="ident" id="4116409">hostport</span><span class="op" id="4116417">[</span><span class="num" id="4116418">0</span><span class="op" id="4116419">]</span>&nbsp;<span class="op" id="4116421">==</span>&nbsp;<span class="string" id="4116424">&#39;[&#39;</span>&nbsp;<span class="op" id="4116428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4116432">//&nbsp;Expect&nbsp;the&nbsp;first&nbsp;&#39;]&#39;&nbsp;just&nbsp;before&nbsp;the&nbsp;last&nbsp;&#39;:&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116484">end</span>&nbsp;<span class="op" id="4116488">:=</span>&nbsp;<span class="ident" id="4116491">byteIndex</span><span class="op" id="4116500">(</span><span class="ident" id="4116501">hostport</span><span class="op" id="4116509">,</span>&nbsp;<span class="string" id="4116511">&#39;]&#39;</span><span class="op" id="4116514">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116518">if</span>&nbsp;<span class="ident" id="4116521">end</span>&nbsp;<span class="op" id="4116525">&lt;</span>&nbsp;<span class="num" id="4116527">0</span>&nbsp;<span class="op" id="4116529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116534">err</span>&nbsp;<span class="op" id="4116538">=</span>&nbsp;<span class="op" id="4116540">&amp;</span><span class="ident" id="4116541">AddrError</span><span class="op" id="4116550">{</span><span class="string" id="4116551">&#34;missing&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="4116575">,</span>&nbsp;<span class="ident" id="4116577">hostport</span><span class="op" id="4116585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116590">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116603">switch</span>&nbsp;<span class="ident" id="4116610">end</span>&nbsp;<span class="op" id="4116614">+</span>&nbsp;<span class="num" id="4116616">1</span>&nbsp;<span class="op" id="4116618">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116622">case</span>&nbsp;<span class="builtinfunc" id="4116627">len</span><span class="op" id="4116630">(</span><span class="ident" id="4116631">hostport</span><span class="op" id="4116639">)</span><span class="op" id="4116640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4116645">//&nbsp;There&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;:&#39;&nbsp;behind&nbsp;the&nbsp;&#39;]&#39;&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116692">goto</span>&nbsp;<span class="ident" id="4116697">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116711">case</span>&nbsp;<span class="ident" id="4116716">i</span><span class="op" id="4116717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4116722">//&nbsp;The&nbsp;expected&nbsp;result.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116748">default</span><span class="op" id="4116755">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4116760">//&nbsp;Either&nbsp;&#39;]&#39;&nbsp;isn&#39;t&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;or&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4116813">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116865">if</span>&nbsp;<span class="ident" id="4116868">hostport</span><span class="op" id="4116876">[</span><span class="ident" id="4116877">end</span><span class="op" id="4116880">+</span><span class="num" id="4116881">1</span><span class="op" id="4116882">]</span>&nbsp;<span class="op" id="4116884">==</span>&nbsp;<span class="string" id="4116887">&#39;:&#39;</span>&nbsp;<span class="op" id="4116891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116897">goto</span>&nbsp;<span class="ident" id="4116902">tooManyColons</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116924">goto</span>&nbsp;<span class="ident" id="4116929">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116947">host</span>&nbsp;<span class="op" id="4116952">=</span>&nbsp;<span class="ident" id="4116954">hostport</span><span class="op" id="4116962">[</span><span class="num" id="4116963">1</span><span class="op" id="4116964">:</span><span class="ident" id="4116965">end</span><span class="op" id="4116968">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116972">j</span><span class="op" id="4116973">,</span>&nbsp;<span class="ident" id="4116975">k</span>&nbsp;<span class="op" id="4116977">=</span>&nbsp;<span class="num" id="4116979">1</span><span class="op" id="4116980">,</span>&nbsp;<span class="ident" id="4116982">end</span><span class="op" id="4116985">+</span><span class="num" id="4116986">1</span>&nbsp;<span class="comment" id="4116988">//&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;[&#39;&nbsp;resp.&nbsp;&#39;]&#39;&nbsp;before&nbsp;these&nbsp;positions</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117046">}</span>&nbsp;<span class="keyword" id="4117048">else</span>&nbsp;<span class="op" id="4117053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117057">host</span>&nbsp;<span class="op" id="4117062">=</span>&nbsp;<span class="ident" id="4117064">hostport</span><span class="op" id="4117072">[</span><span class="op" id="4117073">:</span><span class="ident" id="4117074">i</span><span class="op" id="4117075">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117079">if</span>&nbsp;<span class="ident" id="4117082">byteIndex</span><span class="op" id="4117091">(</span><span class="ident" id="4117092">host</span><span class="op" id="4117096">,</span>&nbsp;<span class="string" id="4117098">&#39;:&#39;</span><span class="op" id="4117101">)</span>&nbsp;<span class="op" id="4117103">&gt;=</span>&nbsp;<span class="num" id="4117106">0</span>&nbsp;<span class="op" id="4117108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117113">goto</span>&nbsp;<span class="ident" id="4117118">tooManyColons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117134">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117138">if</span>&nbsp;<span class="ident" id="4117141">byteIndex</span><span class="op" id="4117150">(</span><span class="ident" id="4117151">host</span><span class="op" id="4117155">,</span>&nbsp;<span class="string" id="4117157">&#39;%&#39;</span><span class="op" id="4117160">)</span>&nbsp;<span class="op" id="4117162">&gt;=</span>&nbsp;<span class="num" id="4117165">0</span>&nbsp;<span class="op" id="4117167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117172">goto</span>&nbsp;<span class="ident" id="4117177">missingBrackets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117201">if</span>&nbsp;<span class="ident" id="4117204">byteIndex</span><span class="op" id="4117213">(</span><span class="ident" id="4117214">hostport</span><span class="op" id="4117222">[</span><span class="ident" id="4117223">j</span><span class="op" id="4117224">:</span><span class="op" id="4117225">]</span><span class="op" id="4117226">,</span>&nbsp;<span class="string" id="4117228">&#39;[&#39;</span><span class="op" id="4117231">)</span>&nbsp;<span class="op" id="4117233">&gt;=</span>&nbsp;<span class="num" id="4117236">0</span>&nbsp;<span class="op" id="4117238">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117242">err</span>&nbsp;<span class="op" id="4117246">=</span>&nbsp;<span class="op" id="4117248">&amp;</span><span class="ident" id="4117249">AddrError</span><span class="op" id="4117258">{</span><span class="string" id="4117259">&#34;unexpected&nbsp;&#39;[&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="4117286">,</span>&nbsp;<span class="ident" id="4117288">hostport</span><span class="op" id="4117296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117300">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117311">if</span>&nbsp;<span class="ident" id="4117314">byteIndex</span><span class="op" id="4117323">(</span><span class="ident" id="4117324">hostport</span><span class="op" id="4117332">[</span><span class="ident" id="4117333">k</span><span class="op" id="4117334">:</span><span class="op" id="4117335">]</span><span class="op" id="4117336">,</span>&nbsp;<span class="string" id="4117338">&#39;]&#39;</span><span class="op" id="4117341">)</span>&nbsp;<span class="op" id="4117343">&gt;=</span>&nbsp;<span class="num" id="4117346">0</span>&nbsp;<span class="op" id="4117348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117352">err</span>&nbsp;<span class="op" id="4117356">=</span>&nbsp;<span class="op" id="4117358">&amp;</span><span class="ident" id="4117359">AddrError</span><span class="op" id="4117368">{</span><span class="string" id="4117369">&#34;unexpected&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="4117396">,</span>&nbsp;<span class="ident" id="4117398">hostport</span><span class="op" id="4117406">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117410">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117422">port</span>&nbsp;<span class="op" id="4117427">=</span>&nbsp;<span class="ident" id="4117429">hostport</span><span class="op" id="4117437">[</span><span class="ident" id="4117438">i</span><span class="op" id="4117439">+</span><span class="num" id="4117440">1</span><span class="op" id="4117441">:</span><span class="op" id="4117442">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117445">return</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="4117453">missingPort</span><span class="op" id="4117464">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117467">err</span>&nbsp;<span class="op" id="4117471">=</span>&nbsp;<span class="op" id="4117473">&amp;</span><span class="ident" id="4117474">AddrError</span><span class="op" id="4117483">{</span><span class="string" id="4117484">&#34;missing&nbsp;port&nbsp;in&nbsp;address&#34;</span><span class="op" id="4117509">,</span>&nbsp;<span class="ident" id="4117511">hostport</span><span class="op" id="4117519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117522">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="4117530">tooManyColons</span><span class="op" id="4117543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117546">err</span>&nbsp;<span class="op" id="4117550">=</span>&nbsp;<span class="op" id="4117552">&amp;</span><span class="ident" id="4117553">AddrError</span><span class="op" id="4117562">{</span><span class="string" id="4117563">&#34;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;address&#34;</span><span class="op" id="4117591">,</span>&nbsp;<span class="ident" id="4117593">hostport</span><span class="op" id="4117601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117604">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4117612">missingBrackets</span><span class="op" id="4117627">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117630">err</span>&nbsp;<span class="op" id="4117634">=</span>&nbsp;<span class="op" id="4117636">&amp;</span><span class="ident" id="4117637">AddrError</span><span class="op" id="4117646">{</span><span class="string" id="4117647">&#34;missing&nbsp;brackets&nbsp;in&nbsp;address&#34;</span><span class="op" id="4117676">,</span>&nbsp;<span class="ident" id="4117678">hostport</span><span class="op" id="4117686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117689">return</span><br>
<span class="lineno"></span><span class="op" id="4117696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4117699">func</span>&nbsp;<span class="ident" id="4117704">splitHostZone</span><span class="op" id="4117717">(</span><span class="ident" id="4117718">s</span>&nbsp;<span class="builtintype" id="4117720">string</span><span class="op" id="4117726">)</span>&nbsp;<span class="op" id="4117728">(</span><span class="ident" id="4117729">host</span><span class="op" id="4117733">,</span>&nbsp;<span class="ident" id="4117735">zone</span>&nbsp;<span class="builtintype" id="4117740">string</span><span class="op" id="4117746">)</span>&nbsp;<span class="op" id="4117748">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4117751">//&nbsp;The&nbsp;IPv6&nbsp;scoped&nbsp;addressing&nbsp;zone&nbsp;identifier&nbsp;starts&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4117815">//&nbsp;last&nbsp;percent&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117838">if</span>&nbsp;<span class="ident" id="4117841">i</span>&nbsp;<span class="op" id="4117843">:=</span>&nbsp;<span class="ident" id="4117846">last</span><span class="op" id="4117850">(</span><span class="ident" id="4117851">s</span><span class="op" id="4117852">,</span>&nbsp;<span class="string" id="4117854">&#39;%&#39;</span><span class="op" id="4117857">)</span><span class="op" id="4117858">;</span>&nbsp;<span class="ident" id="4117860">i</span>&nbsp;<span class="op" id="4117862">&gt;</span>&nbsp;<span class="num" id="4117864">0</span>&nbsp;<span class="op" id="4117866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117870">host</span><span class="op" id="4117874">,</span>&nbsp;<span class="ident" id="4117876">zone</span>&nbsp;<span class="op" id="4117881">=</span>&nbsp;<span class="ident" id="4117883">s</span><span class="op" id="4117884">[</span><span class="op" id="4117885">:</span><span class="ident" id="4117886">i</span><span class="op" id="4117887">]</span><span class="op" id="4117888">,</span>&nbsp;<span class="ident" id="4117890">s</span><span class="op" id="4117891">[</span><span class="ident" id="4117892">i</span><span class="op" id="4117893">+</span><span class="num" id="4117894">1</span><span class="op" id="4117895">:</span><span class="op" id="4117896">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117899">}</span>&nbsp;<span class="keyword" id="4117901">else</span>&nbsp;<span class="op" id="4117906">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117910">host</span>&nbsp;<span class="op" id="4117915">=</span>&nbsp;<span class="ident" id="4117917">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117923">return</span><br>
<span class="lineno"></span><span class="op" id="4117930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="4117933">//&nbsp;JoinHostPort&nbsp;combines&nbsp;host&nbsp;and&nbsp;port&nbsp;into&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4118002">//&nbsp;form&nbsp;&#34;host:port&#34;&nbsp;or,&nbsp;if&nbsp;host&nbsp;contains&nbsp;a&nbsp;colon&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,</span><br>
<span class="lineno"></span><span class="comment" id="4118070">//&nbsp;&#34;[host]:port&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4118088">func</span>&nbsp;<span class="ident" id="4118093">JoinHostPort</span><span class="op" id="4118105">(</span><span class="ident" id="4118106">host</span><span class="op" id="4118110">,</span>&nbsp;<span class="ident" id="4118112">port</span>&nbsp;<span class="builtintype" id="4118117">string</span><span class="op" id="4118123">)</span>&nbsp;<span class="builtintype" id="4118125">string</span>&nbsp;<span class="op" id="4118132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4118135">//&nbsp;If&nbsp;host&nbsp;has&nbsp;colons&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,&nbsp;have&nbsp;to&nbsp;bracket&nbsp;it.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118197">if</span>&nbsp;<span class="ident" id="4118200">byteIndex</span><span class="op" id="4118209">(</span><span class="ident" id="4118210">host</span><span class="op" id="4118214">,</span>&nbsp;<span class="string" id="4118216">&#39;:&#39;</span><span class="op" id="4118219">)</span>&nbsp;<span class="op" id="4118221">&gt;=</span>&nbsp;<span class="num" id="4118224">0</span>&nbsp;<span class="op" id="4118226">||</span>&nbsp;<span class="ident" id="4118229">byteIndex</span><span class="op" id="4118238">(</span><span class="ident" id="4118239">host</span><span class="op" id="4118243">,</span>&nbsp;<span class="string" id="4118245">&#39;%&#39;</span><span class="op" id="4118248">)</span>&nbsp;<span class="op" id="4118250">&gt;=</span>&nbsp;<span class="num" id="4118253">0</span>&nbsp;<span class="op" id="4118255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118259">return</span>&nbsp;<span class="string" id="4118266">&#34;[&#34;</span>&nbsp;<span class="op" id="4118270">+</span>&nbsp;<span class="ident" id="4118272">host</span>&nbsp;<span class="op" id="4118277">+</span>&nbsp;<span class="string" id="4118279">&#34;]:&#34;</span>&nbsp;<span class="op" id="4118284">+</span>&nbsp;<span class="ident" id="4118286">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4118292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118295">return</span>&nbsp;<span class="ident" id="4118302">host</span>&nbsp;<span class="op" id="4118307">+</span>&nbsp;<span class="string" id="4118309">&#34;:&#34;</span>&nbsp;<span class="op" id="4118313">+</span>&nbsp;<span class="ident" id="4118315">port</span><br>
<span class="lineno"></span><span class="op" id="4118320">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="4118323">//&nbsp;resolveInternetAddr&nbsp;resolves&nbsp;addr&nbsp;that&nbsp;is&nbsp;either&nbsp;a&nbsp;literal&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="4118388">//&nbsp;address&nbsp;or&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;returns&nbsp;an&nbsp;internet&nbsp;protocol&nbsp;family</span><br>
<span class="lineno"></span><span class="comment" id="4118453">//&nbsp;address.&nbsp;It&nbsp;returns&nbsp;a&nbsp;list&nbsp;that&nbsp;contains&nbsp;a&nbsp;pair&nbsp;of&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="4118517">//&nbsp;address&nbsp;family&nbsp;addresses&nbsp;when&nbsp;addr&nbsp;is&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;the&nbsp;name&nbsp;has</span><br>
<span class="lineno">235</span><span class="comment" id="4118586">//&nbsp;multiple&nbsp;address&nbsp;family&nbsp;records.&nbsp;The&nbsp;result&nbsp;contains&nbsp;at&nbsp;least&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="4118655">//&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4118685">func</span>&nbsp;<span class="ident" id="4118690">resolveInternetAddr</span><span class="op" id="4118709">(</span><span class="ident" id="4118710">net</span><span class="op" id="4118713">,</span>&nbsp;<span class="ident" id="4118715">addr</span>&nbsp;<span class="builtintype" id="4118720">string</span><span class="op" id="4118726">,</span>&nbsp;<span class="ident" id="4118728">deadline</span>&nbsp;<span class="ident" id="4118737">time</span><span class="op" id="4118741">.</span><span class="ident" id="4118742">Time</span><span class="op" id="4118746">)</span>&nbsp;<span class="op" id="4118748">(</span><span class="ident" id="4118749">netaddr</span><span class="op" id="4118756">,</span>&nbsp;<span class="builtintype" id="4118758">error</span><span class="op" id="4118763">)</span>&nbsp;<span class="op" id="4118765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118768">var</span>&nbsp;<span class="op" id="4118772">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118776">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4118793">error</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118801">host</span><span class="op" id="4118805">,</span>&nbsp;<span class="ident" id="4118807">port</span><span class="op" id="4118811">,</span>&nbsp;<span class="ident" id="4118813">zone</span>&nbsp;<span class="builtintype" id="4118818">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118827">portnum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4118844">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4118849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118852">switch</span>&nbsp;<span class="ident" id="4118859">net</span>&nbsp;<span class="op" id="4118863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118866">case</span>&nbsp;<span class="string" id="4118871">&#34;tcp&#34;</span><span class="op" id="4118876">,</span>&nbsp;<span class="string" id="4118878">&#34;tcp4&#34;</span><span class="op" id="4118884">,</span>&nbsp;<span class="string" id="4118886">&#34;tcp6&#34;</span><span class="op" id="4118892">,</span>&nbsp;<span class="string" id="4118894">&#34;udp&#34;</span><span class="op" id="4118899">,</span>&nbsp;<span class="string" id="4118901">&#34;udp4&#34;</span><span class="op" id="4118907">,</span>&nbsp;<span class="string" id="4118909">&#34;udp6&#34;</span><span class="op" id="4118915">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118919">if</span>&nbsp;<span class="ident" id="4118922">addr</span>&nbsp;<span class="op" id="4118927">!=</span>&nbsp;<span class="string" id="4118930">&#34;&#34;</span>&nbsp;<span class="op" id="4118933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118938">if</span>&nbsp;<span class="ident" id="4118941">host</span><span class="op" id="4118945">,</span>&nbsp;<span class="ident" id="4118947">port</span><span class="op" id="4118951">,</span>&nbsp;<span class="ident" id="4118953">err</span>&nbsp;<span class="op" id="4118957">=</span>&nbsp;<span class="ident" id="4118959">SplitHostPort</span><span class="op" id="4118972">(</span><span class="ident" id="4118973">addr</span><span class="op" id="4118977">)</span><span class="op" id="4118978">;</span>&nbsp;<span class="ident" id="4118980">err</span>&nbsp;<span class="op" id="4118984">!=</span>&nbsp;<span class="ident" id="4118987">nil</span>&nbsp;<span class="op" id="4118991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118997">return</span>&nbsp;<span class="ident" id="4119004">nil</span><span class="op" id="4119007">,</span>&nbsp;<span class="ident" id="4119009">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119021">if</span>&nbsp;<span class="ident" id="4119024">portnum</span><span class="op" id="4119031">,</span>&nbsp;<span class="ident" id="4119033">err</span>&nbsp;<span class="op" id="4119037">=</span>&nbsp;<span class="ident" id="4119039">parsePort</span><span class="op" id="4119048">(</span><span class="ident" id="4119049">net</span><span class="op" id="4119052">,</span>&nbsp;<span class="ident" id="4119054">port</span><span class="op" id="4119058">)</span><span class="op" id="4119059">;</span>&nbsp;<span class="ident" id="4119061">err</span>&nbsp;<span class="op" id="4119065">!=</span>&nbsp;<span class="ident" id="4119068">nil</span>&nbsp;<span class="op" id="4119072">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119078">return</span>&nbsp;<span class="ident" id="4119085">nil</span><span class="op" id="4119088">,</span>&nbsp;<span class="ident" id="4119090">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119104">case</span>&nbsp;<span class="string" id="4119109">&#34;ip&#34;</span><span class="op" id="4119113">,</span>&nbsp;<span class="string" id="4119115">&#34;ip4&#34;</span><span class="op" id="4119120">,</span>&nbsp;<span class="string" id="4119122">&#34;ip6&#34;</span><span class="op" id="4119127">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119131">if</span>&nbsp;<span class="ident" id="4119134">addr</span>&nbsp;<span class="op" id="4119139">!=</span>&nbsp;<span class="string" id="4119142">&#34;&#34;</span>&nbsp;<span class="op" id="4119145">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119150">host</span>&nbsp;<span class="op" id="4119155">=</span>&nbsp;<span class="ident" id="4119157">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119167">default</span><span class="op" id="4119174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119178">return</span>&nbsp;<span class="ident" id="4119185">nil</span><span class="op" id="4119188">,</span>&nbsp;<span class="ident" id="4119190">UnknownNetworkError</span><span class="op" id="4119209">(</span><span class="ident" id="4119210">net</span><span class="op" id="4119213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119216">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119219">inetaddr</span>&nbsp;<span class="op" id="4119228">:=</span>&nbsp;<span class="keyword" id="4119231">func</span><span class="op" id="4119235">(</span><span class="ident" id="4119236">ip</span>&nbsp;<span class="ident" id="4119239">IP</span><span class="op" id="4119241">)</span>&nbsp;<span class="ident" id="4119243">netaddr</span>&nbsp;<span class="op" id="4119251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119255">switch</span>&nbsp;<span class="ident" id="4119262">net</span>&nbsp;<span class="op" id="4119266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119270">case</span>&nbsp;<span class="string" id="4119275">&#34;tcp&#34;</span><span class="op" id="4119280">,</span>&nbsp;<span class="string" id="4119282">&#34;tcp4&#34;</span><span class="op" id="4119288">,</span>&nbsp;<span class="string" id="4119290">&#34;tcp6&#34;</span><span class="op" id="4119296">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119301">return</span>&nbsp;<span class="op" id="4119308">&amp;</span><span class="ident" id="4119309">TCPAddr</span><span class="op" id="4119316">{</span><span class="ident" id="4119317">IP</span><span class="op" id="4119319">:</span>&nbsp;<span class="ident" id="4119321">ip</span><span class="op" id="4119323">,</span>&nbsp;<span class="ident" id="4119325">Port</span><span class="op" id="4119329">:</span>&nbsp;<span class="ident" id="4119331">portnum</span><span class="op" id="4119338">,</span>&nbsp;<span class="ident" id="4119340">Zone</span><span class="op" id="4119344">:</span>&nbsp;<span class="ident" id="4119346">zone</span><span class="op" id="4119350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119354">case</span>&nbsp;<span class="string" id="4119359">&#34;udp&#34;</span><span class="op" id="4119364">,</span>&nbsp;<span class="string" id="4119366">&#34;udp4&#34;</span><span class="op" id="4119372">,</span>&nbsp;<span class="string" id="4119374">&#34;udp6&#34;</span><span class="op" id="4119380">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119385">return</span>&nbsp;<span class="op" id="4119392">&amp;</span><span class="ident" id="4119393">UDPAddr</span><span class="op" id="4119400">{</span><span class="ident" id="4119401">IP</span><span class="op" id="4119403">:</span>&nbsp;<span class="ident" id="4119405">ip</span><span class="op" id="4119407">,</span>&nbsp;<span class="ident" id="4119409">Port</span><span class="op" id="4119413">:</span>&nbsp;<span class="ident" id="4119415">portnum</span><span class="op" id="4119422">,</span>&nbsp;<span class="ident" id="4119424">Zone</span><span class="op" id="4119428">:</span>&nbsp;<span class="ident" id="4119430">zone</span><span class="op" id="4119434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119438">case</span>&nbsp;<span class="string" id="4119443">&#34;ip&#34;</span><span class="op" id="4119447">,</span>&nbsp;<span class="string" id="4119449">&#34;ip4&#34;</span><span class="op" id="4119454">,</span>&nbsp;<span class="string" id="4119456">&#34;ip6&#34;</span><span class="op" id="4119461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119466">return</span>&nbsp;<span class="op" id="4119473">&amp;</span><span class="ident" id="4119474">IPAddr</span><span class="op" id="4119480">{</span><span class="ident" id="4119481">IP</span><span class="op" id="4119483">:</span>&nbsp;<span class="ident" id="4119485">ip</span><span class="op" id="4119487">,</span>&nbsp;<span class="ident" id="4119489">Zone</span><span class="op" id="4119493">:</span>&nbsp;<span class="ident" id="4119495">zone</span><span class="op" id="4119499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119503">default</span><span class="op" id="4119510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4119515">panic</span><span class="op" id="4119520">(</span><span class="string" id="4119521">&#34;unexpected&nbsp;network:&nbsp;&#34;</span>&nbsp;<span class="op" id="4119544">+</span>&nbsp;<span class="ident" id="4119546">net</span><span class="op" id="4119549">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119559">if</span>&nbsp;<span class="ident" id="4119562">host</span>&nbsp;<span class="op" id="4119567">==</span>&nbsp;<span class="string" id="4119570">&#34;&#34;</span>&nbsp;<span class="op" id="4119573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119577">return</span>&nbsp;<span class="ident" id="4119584">inetaddr</span><span class="op" id="4119592">(</span><span class="ident" id="4119593">nil</span><span class="op" id="4119596">)</span><span class="op" id="4119597">,</span>&nbsp;<span class="ident" id="4119599">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119604">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4119607">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119640">var</span>&nbsp;<span class="ident" id="4119644">ip</span>&nbsp;<span class="ident" id="4119647">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119651">if</span>&nbsp;<span class="ident" id="4119654">ip</span>&nbsp;<span class="op" id="4119657">=</span>&nbsp;<span class="ident" id="4119659">parseIPv4</span><span class="op" id="4119668">(</span><span class="ident" id="4119669">host</span><span class="op" id="4119673">)</span><span class="op" id="4119674">;</span>&nbsp;<span class="ident" id="4119676">ip</span>&nbsp;<span class="op" id="4119679">!=</span>&nbsp;<span class="ident" id="4119682">nil</span>&nbsp;<span class="op" id="4119686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119690">return</span>&nbsp;<span class="ident" id="4119697">inetaddr</span><span class="op" id="4119705">(</span><span class="ident" id="4119706">ip</span><span class="op" id="4119708">)</span><span class="op" id="4119709">,</span>&nbsp;<span class="ident" id="4119711">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119716">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119719">if</span>&nbsp;<span class="ident" id="4119722">ip</span><span class="op" id="4119724">,</span>&nbsp;<span class="ident" id="4119726">zone</span>&nbsp;<span class="op" id="4119731">=</span>&nbsp;<span class="ident" id="4119733">parseIPv6</span><span class="op" id="4119742">(</span><span class="ident" id="4119743">host</span><span class="op" id="4119747">,</span>&nbsp;<span class="builtintype" id="4119749">true</span><span class="op" id="4119753">)</span><span class="op" id="4119754">;</span>&nbsp;<span class="ident" id="4119756">ip</span>&nbsp;<span class="op" id="4119759">!=</span>&nbsp;<span class="ident" id="4119762">nil</span>&nbsp;<span class="op" id="4119766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119770">return</span>&nbsp;<span class="ident" id="4119777">inetaddr</span><span class="op" id="4119785">(</span><span class="ident" id="4119786">ip</span><span class="op" id="4119788">)</span><span class="op" id="4119789">,</span>&nbsp;<span class="ident" id="4119791">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4119799">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;DNS&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119822">host</span><span class="op" id="4119826">,</span>&nbsp;<span class="ident" id="4119828">zone</span>&nbsp;<span class="op" id="4119833">=</span>&nbsp;<span class="ident" id="4119835">splitHostZone</span><span class="op" id="4119848">(</span><span class="ident" id="4119849">host</span><span class="op" id="4119853">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4119856">ips</span><span class="op" id="4119859">,</span>&nbsp;<span class="ident" id="4119861">err</span>&nbsp;<span class="op" id="4119865">:=</span>&nbsp;<span class="ident" id="4119868">lookupIPDeadline</span><span class="op" id="4119884">(</span><span class="ident" id="4119885">host</span><span class="op" id="4119889">,</span>&nbsp;<span class="ident" id="4119891">deadline</span><span class="op" id="4119899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119902">if</span>&nbsp;<span class="ident" id="4119905">err</span>&nbsp;<span class="op" id="4119909">!=</span>&nbsp;<span class="ident" id="4119912">nil</span>&nbsp;<span class="op" id="4119916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119920">return</span>&nbsp;<span class="ident" id="4119927">nil</span><span class="op" id="4119930">,</span>&nbsp;<span class="ident" id="4119932">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4119937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119940">var</span>&nbsp;<span class="ident" id="4119944">filter</span>&nbsp;<span class="keyword" id="4119951">func</span><span class="op" id="4119955">(</span><span class="ident" id="4119956">IP</span><span class="op" id="4119958">)</span>&nbsp;<span class="ident" id="4119960">IP</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4119964">if</span>&nbsp;<span class="ident" id="4119967">net</span>&nbsp;<span class="op" id="4119971">!=</span>&nbsp;<span class="string" id="4119974">&#34;&#34;</span>&nbsp;<span class="op" id="4119977">&amp;&amp;</span>&nbsp;<span class="ident" id="4119980">net</span><span class="op" id="4119983">[</span><span class="builtinfunc" id="4119984">len</span><span class="op" id="4119987">(</span><span class="ident" id="4119988">net</span><span class="op" id="4119991">)</span><span class="op" id="4119992">-</span><span class="num" id="4119993">1</span><span class="op" id="4119994">]</span>&nbsp;<span class="op" id="4119996">==</span>&nbsp;<span class="string" id="4119999">&#39;4&#39;</span>&nbsp;<span class="op" id="4120003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120007">filter</span>&nbsp;<span class="op" id="4120014">=</span>&nbsp;<span class="ident" id="4120016">ipv4only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120029">if</span>&nbsp;<span class="ident" id="4120032">net</span>&nbsp;<span class="op" id="4120036">!=</span>&nbsp;<span class="string" id="4120039">&#34;&#34;</span>&nbsp;<span class="op" id="4120042">&amp;&amp;</span>&nbsp;<span class="ident" id="4120045">net</span><span class="op" id="4120048">[</span><span class="builtinfunc" id="4120049">len</span><span class="op" id="4120052">(</span><span class="ident" id="4120053">net</span><span class="op" id="4120056">)</span><span class="op" id="4120057">-</span><span class="num" id="4120058">1</span><span class="op" id="4120059">]</span>&nbsp;<span class="op" id="4120061">==</span>&nbsp;<span class="string" id="4120064">&#39;6&#39;</span>&nbsp;<span class="op" id="4120068">||</span>&nbsp;<span class="ident" id="4120071">zone</span>&nbsp;<span class="op" id="4120076">!=</span>&nbsp;<span class="string" id="4120079">&#34;&#34;</span>&nbsp;<span class="op" id="4120082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120086">filter</span>&nbsp;<span class="op" id="4120093">=</span>&nbsp;<span class="ident" id="4120095">ipv6only</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120108">return</span>&nbsp;<span class="ident" id="4120115">firstFavoriteAddr</span><span class="op" id="4120132">(</span><span class="ident" id="4120133">filter</span><span class="op" id="4120139">,</span>&nbsp;<span class="ident" id="4120141">ips</span><span class="op" id="4120144">,</span>&nbsp;<span class="ident" id="4120146">inetaddr</span><span class="op" id="4120154">)</span><br>
<span class="lineno"></span><span class="op" id="4120156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4120159">func</span>&nbsp;<span class="ident" id="4120164">zoneToString</span><span class="op" id="4120176">(</span><span class="ident" id="4120177">zone</span>&nbsp;<span class="builtintype" id="4120182">int</span><span class="op" id="4120185">)</span>&nbsp;<span class="builtintype" id="4120187">string</span>&nbsp;<span class="op" id="4120194">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120197">if</span>&nbsp;<span class="ident" id="4120200">zone</span>&nbsp;<span class="op" id="4120205">==</span>&nbsp;<span class="num" id="4120208">0</span>&nbsp;<span class="op" id="4120210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120214">return</span>&nbsp;<span class="string" id="4120221">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120228">if</span>&nbsp;<span class="ident" id="4120231">ifi</span><span class="op" id="4120234">,</span>&nbsp;<span class="ident" id="4120236">err</span>&nbsp;<span class="op" id="4120240">:=</span>&nbsp;<span class="ident" id="4120243">InterfaceByIndex</span><span class="op" id="4120259">(</span><span class="ident" id="4120260">zone</span><span class="op" id="4120264">)</span><span class="op" id="4120265">;</span>&nbsp;<span class="ident" id="4120267">err</span>&nbsp;<span class="op" id="4120271">==</span>&nbsp;<span class="ident" id="4120274">nil</span>&nbsp;<span class="op" id="4120278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120282">return</span>&nbsp;<span class="ident" id="4120289">ifi</span><span class="op" id="4120292">.</span><span class="ident" id="4120293">Name</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120302">return</span>&nbsp;<span class="ident" id="4120309">itod</span><span class="op" id="4120313">(</span><span class="builtintype" id="4120314">uint</span><span class="op" id="4120318">(</span><span class="ident" id="4120319">zone</span><span class="op" id="4120323">)</span><span class="op" id="4120324">)</span><br>
<span class="lineno"></span><span class="op" id="4120326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4120329">func</span>&nbsp;<span class="ident" id="4120334">zoneToInt</span><span class="op" id="4120343">(</span><span class="ident" id="4120344">zone</span>&nbsp;<span class="builtintype" id="4120349">string</span><span class="op" id="4120355">)</span>&nbsp;<span class="builtintype" id="4120357">int</span>&nbsp;<span class="op" id="4120361">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120364">if</span>&nbsp;<span class="ident" id="4120367">zone</span>&nbsp;<span class="op" id="4120372">==</span>&nbsp;<span class="string" id="4120375">&#34;&#34;</span>&nbsp;<span class="op" id="4120378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120382">return</span>&nbsp;<span class="num" id="4120389">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120395">if</span>&nbsp;<span class="ident" id="4120398">ifi</span><span class="op" id="4120401">,</span>&nbsp;<span class="ident" id="4120403">err</span>&nbsp;<span class="op" id="4120407">:=</span>&nbsp;<span class="ident" id="4120410">InterfaceByName</span><span class="op" id="4120425">(</span><span class="ident" id="4120426">zone</span><span class="op" id="4120430">)</span><span class="op" id="4120431">;</span>&nbsp;<span class="ident" id="4120433">err</span>&nbsp;<span class="op" id="4120437">==</span>&nbsp;<span class="ident" id="4120440">nil</span>&nbsp;<span class="op" id="4120444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120448">return</span>&nbsp;<span class="ident" id="4120455">ifi</span><span class="op" id="4120458">.</span><span class="ident" id="4120459">Index</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4120466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4120469">n</span><span class="op" id="4120470">,</span>&nbsp;<span class="ident" id="4120472">_</span><span class="op" id="4120473">,</span>&nbsp;<span class="ident" id="4120475">_</span>&nbsp;<span class="op" id="4120477">:=</span>&nbsp;<span class="ident" id="4120480">dtoi</span><span class="op" id="4120484">(</span><span class="ident" id="4120485">zone</span><span class="op" id="4120489">,</span>&nbsp;<span class="num" id="4120491">0</span><span class="op" id="4120492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4120495">return</span>&nbsp;<span class="ident" id="4120502">n</span><br>
<span class="lineno"></span><span class="op" id="4120504">}</span>
</div>
</body>
</html>
