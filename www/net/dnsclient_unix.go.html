<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2532646">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2532701">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2532755">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2532806">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2532871">//&nbsp;DNS&nbsp;client:&nbsp;see&nbsp;RFC&nbsp;1035.</span><br>
<span class="lineno"></span><span class="comment" id="2532900">//&nbsp;Has&nbsp;to&nbsp;be&nbsp;linked&nbsp;into&nbsp;package&nbsp;net&nbsp;for&nbsp;Dial.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="2532948">//&nbsp;TODO(rsc):</span><br>
<span class="lineno"></span><span class="comment" id="2532962">//&nbsp;&nbsp;&nbsp;&nbspCould&nbsp;potentially&nbsp;handle&nbsp;many&nbsp;outstanding&nbsp;lookups&nbsp;faster.</span><br>
<span class="lineno"></span><span class="comment" id="2533023">//&nbsp;&nbsp;&nbsp;&nbspCould&nbsp;have&nbsp;a&nbsp;small&nbsp;cache.</span><br>
<span class="lineno"></span><span class="comment" id="2533052">//&nbsp;&nbsp;&nbsp;&nbspRandom&nbsp;UDP&nbsp;source&nbsp;port&nbsp;(net.Dial&nbsp;should&nbsp;do&nbsp;that&nbsp;for&nbsp;us).</span><br>
<span class="lineno"></span><span class="comment" id="2533112">//&nbsp;&nbsp;&nbsp;&nbspRandom&nbsp;request&nbsp;IDs.</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="2533136">package</span>&nbsp;<span class="ident" id="2533144">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2533149">import</span>&nbsp;<span class="op" id="2533156">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2533159">&#34;errors&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2533169">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2533175">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2533188">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2533194">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2533202">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="2533209">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2533212">//&nbsp;A&nbsp;dnsConn&nbsp;represents&nbsp;a&nbsp;DNS&nbsp;transport&nbsp;endpoint.</span><br>
<span class="lineno"></span><span class="keyword" id="2533262">type</span>&nbsp;<span class="ident" id="2533267">dnsConn</span>&nbsp;<span class="keyword" id="2533275">interface</span>&nbsp;<span class="op" id="2533285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533288"><a href="/net/net.go.html#2652476">Conn</a></span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2533295">//&nbsp;readDNSResponse&nbsp;reads&nbsp;a&nbsp;DNS&nbsp;response&nbsp;message&nbsp;from&nbsp;the&nbsp;DNS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2533357">//&nbsp;transport&nbsp;endpoint&nbsp;and&nbsp;returns&nbsp;the&nbsp;received&nbsp;DNS&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2533418">//&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533431">readDNSResponse</span><span class="op" id="2533446">(</span><span class="op" id="2533447">)</span>&nbsp;<span class="op" id="2533449">(</span><span class="op" id="2533450">*</span><span class="ident" id="2533451"><a href="/net/dnsmsg.go.html#2563931">dnsMsg</a></span><span class="op" id="2533457">,</span>&nbsp;<span class="builtintype" id="2533459">error</span><span class="op" id="2533464">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2533468">//&nbsp;writeDNSQuery&nbsp;writes&nbsp;a&nbsp;DNS&nbsp;query&nbsp;message&nbsp;to&nbsp;the&nbsp;DNS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2533524">//&nbsp;connection&nbsp;endpoint.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533549">writeDNSQuery</span><span class="op" id="2533562">(</span><span class="op" id="2533563">*</span><span class="ident" id="2533564"><a href="/net/dnsmsg.go.html#2563931">dnsMsg</a></span><span class="op" id="2533570">)</span>&nbsp;<span class="builtintype" id="2533572">error</span><br>
<span class="lineno"></span><span class="op" id="2533578">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2533581">func</span>&nbsp;<span class="op" id="2533586">(</span><span class="ident" id="2533587">c</span>&nbsp;<span class="op" id="2533589">*</span><span class="ident" id="2533590"><a href="/net/udpsock_posix.go.html#2706235">UDPConn</a></span><span class="op" id="2533597">)</span>&nbsp;<span class="ident" id="2533599">readDNSResponse</span><span class="op" id="2533614">(</span><span class="op" id="2533615">)</span>&nbsp;<span class="op" id="2533617">(</span><span class="op" id="2533618">*</span><span class="ident" id="2533619"><a href="/net/dnsmsg.go.html#2563931">dnsMsg</a></span><span class="op" id="2533625">,</span>&nbsp;<span class="builtintype" id="2533627">error</span><span class="op" id="2533632">)</span>&nbsp;<span class="op" id="2533634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533637">b</span>&nbsp;<span class="op" id="2533639">:=</span>&nbsp;<span class="builtinfunc" id="2533642">make</span><span class="op" id="2533646">(</span><span class="op" id="2533647">[</span><span class="op" id="2533648">]</span><span class="builtintype" id="2533649">byte</span><span class="op" id="2533653">,</span>&nbsp;<span class="num" id="2533655">512</span><span class="op" id="2533658">)</span>&nbsp;<span class="comment" id="2533660">//&nbsp;see&nbsp;RFC&nbsp;1035</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533677">n</span><span class="op" id="2533678">,</span>&nbsp;<span class="ident" id="2533680">err</span>&nbsp;<span class="op" id="2533684">:=</span>&nbsp;<span class="ident" id="2533687"><a href="/net/dnsclient_unix.go.html#2533587">c</a></span><span class="op" id="2533688">.</span><span class="ident" id="2533689">Read</span><span class="op" id="2533693">(</span><span class="ident" id="2533694"><a href="/net/dnsclient_unix.go.html#2533637">b</a></span><span class="op" id="2533695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533698">if</span>&nbsp;<span class="ident" id="2533701"><a href="/net/dnsclient_unix.go.html#2533680">err</a></span>&nbsp;<span class="op" id="2533705">!=</span>&nbsp;<span class="ident" id="2533708">nil</span>&nbsp;<span class="op" id="2533712">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533716">return</span>&nbsp;<span class="ident" id="2533723">nil</span><span class="op" id="2533726">,</span>&nbsp;<span class="ident" id="2533728"><a href="/net/dnsclient_unix.go.html#2533680">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2533733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533736">msg</span>&nbsp;<span class="op" id="2533740">:=</span>&nbsp;<span class="op" id="2533743">&amp;</span><span class="ident" id="2533744"><a href="/net/dnsmsg.go.html#2563931">dnsMsg</a></span><span class="op" id="2533750">{</span><span class="op" id="2533751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533754">if</span>&nbsp;<span class="op" id="2533757">!</span><span class="ident" id="2533758"><a href="/net/dnsclient_unix.go.html#2533736">msg</a></span><span class="op" id="2533761">.</span><span class="ident" id="2533762">Unpack</span><span class="op" id="2533768">(</span><span class="ident" id="2533769"><a href="/net/dnsclient_unix.go.html#2533637">b</a></span><span class="op" id="2533770">[</span><span class="op" id="2533771">:</span><span class="ident" id="2533772"><a href="/net/dnsclient_unix.go.html#2533677">n</a></span><span class="op" id="2533773">]</span><span class="op" id="2533774">)</span>&nbsp;<span class="op" id="2533776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533780">return</span>&nbsp;<span class="ident" id="2533787">nil</span><span class="op" id="2533790">,</span>&nbsp;<span class="ident" id="2533792"><a href="/net/dnsclient_unix.go.html#2533159">errors</a></span><span class="op" id="2533798">.</span><span class="ident" id="2533799">New</span><span class="op" id="2533802">(</span><span class="string" id="2533803">&#34;cannot&nbsp;unmarshal&nbsp;DNS&nbsp;message&#34;</span><span class="op" id="2533833">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2533836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533839">return</span>&nbsp;<span class="ident" id="2533846"><a href="/net/dnsclient_unix.go.html#2533736">msg</a></span><span class="op" id="2533849">,</span>&nbsp;<span class="ident" id="2533851">nil</span><br>
<span class="lineno"></span><span class="op" id="2533855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2533858">func</span>&nbsp;<span class="op" id="2533863">(</span><span class="ident" id="2533864">c</span>&nbsp;<span class="op" id="2533866">*</span><span class="ident" id="2533867"><a href="/net/udpsock_posix.go.html#2706235">UDPConn</a></span><span class="op" id="2533874">)</span>&nbsp;<span class="ident" id="2533876">writeDNSQuery</span><span class="op" id="2533889">(</span><span class="ident" id="2533890">msg</span>&nbsp;<span class="op" id="2533894">*</span><span class="ident" id="2533895"><a href="/net/dnsmsg.go.html#2563931">dnsMsg</a></span><span class="op" id="2533901">)</span>&nbsp;<span class="builtintype" id="2533903">error</span>&nbsp;<span class="op" id="2533909">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2533912">b</span><span class="op" id="2533913">,</span>&nbsp;<span class="ident" id="2533915">ok</span>&nbsp;<span class="op" id="2533918">:=</span>&nbsp;<span class="ident" id="2533921"><a href="/net/dnsclient_unix.go.html#2533890">msg</a></span><span class="op" id="2533924">.</span><span class="ident" id="2533925">Pack</span><span class="op" id="2533929">(</span><span class="op" id="2533930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533933">if</span>&nbsp;<span class="op" id="2533936">!</span><span class="ident" id="2533937"><a href="/net/dnsclient_unix.go.html#2533915">ok</a></span>&nbsp;<span class="op" id="2533940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533944">return</span>&nbsp;<span class="ident" id="2533951"><a href="/net/dnsclient_unix.go.html#2533159">errors</a></span><span class="op" id="2533957">.</span><span class="ident" id="2533958">New</span><span class="op" id="2533961">(</span><span class="string" id="2533962">&#34;cannot&nbsp;marshal&nbsp;DNS&nbsp;message&#34;</span><span class="op" id="2533990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2533993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2533996">if</span>&nbsp;<span class="ident" id="2533999">_</span><span class="op" id="2534000">,</span>&nbsp;<span class="ident" id="2534002">err</span>&nbsp;<span class="op" id="2534006">:=</span>&nbsp;<span class="ident" id="2534009"><a href="/net/dnsclient_unix.go.html#2533864">c</a></span><span class="op" id="2534010">.</span><span class="ident" id="2534011">Write</span><span class="op" id="2534016">(</span><span class="ident" id="2534017"><a href="/net/dnsclient_unix.go.html#2533912">b</a></span><span class="op" id="2534018">)</span><span class="op" id="2534019">;</span>&nbsp;<span class="ident" id="2534021"><a href="/net/dnsclient_unix.go.html#2534002">err</a></span>&nbsp;<span class="op" id="2534025">!=</span>&nbsp;<span class="ident" id="2534028">nil</span>&nbsp;<span class="op" id="2534032">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534036">return</span>&nbsp;<span class="ident" id="2534043"><a href="/net/dnsclient_unix.go.html#2534002">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2534048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534051">return</span>&nbsp;<span class="ident" id="2534058">nil</span><br>
<span class="lineno"></span><span class="op" id="2534062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="2534065">func</span>&nbsp;<span class="op" id="2534070">(</span><span class="ident" id="2534071">c</span>&nbsp;<span class="op" id="2534073">*</span><span class="ident" id="2534074"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2534081">)</span>&nbsp;<span class="ident" id="2534083">readDNSResponse</span><span class="op" id="2534098">(</span><span class="op" id="2534099">)</span>&nbsp;<span class="op" id="2534101">(</span><span class="op" id="2534102">*</span><span class="ident" id="2534103"><a href="/net/dnsmsg.go.html#2563931">dnsMsg</a></span><span class="op" id="2534109">,</span>&nbsp;<span class="builtintype" id="2534111">error</span><span class="op" id="2534116">)</span>&nbsp;<span class="op" id="2534118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534121">b</span>&nbsp;<span class="op" id="2534123">:=</span>&nbsp;<span class="builtinfunc" id="2534126">make</span><span class="op" id="2534130">(</span><span class="op" id="2534131">[</span><span class="op" id="2534132">]</span><span class="builtintype" id="2534133">byte</span><span class="op" id="2534137">,</span>&nbsp;<span class="num" id="2534139">1280</span><span class="op" id="2534143">)</span>&nbsp;<span class="comment" id="2534145">//&nbsp;1280&nbsp;is&nbsp;a&nbsp;reasonable&nbsp;initial&nbsp;size&nbsp;for&nbsp;IP&nbsp;over&nbsp;Ethernet,&nbsp;see&nbsp;RFC&nbsp;4035</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534218">if</span>&nbsp;<span class="ident" id="2534221">_</span><span class="op" id="2534222">,</span>&nbsp;<span class="ident" id="2534224">err</span>&nbsp;<span class="op" id="2534228">:=</span>&nbsp;<span class="ident" id="2534231"><a href="/net/dnsclient_unix.go.html#2533169">io</a></span><span class="op" id="2534233">.</span><span class="ident" id="2534234">ReadFull</span><span class="op" id="2534242">(</span><span class="ident" id="2534243"><a href="/net/dnsclient_unix.go.html#2534071">c</a></span><span class="op" id="2534244">,</span>&nbsp;<span class="ident" id="2534246"><a href="/net/dnsclient_unix.go.html#2534121">b</a></span><span class="op" id="2534247">[</span><span class="op" id="2534248">:</span><span class="num" id="2534249">2</span><span class="op" id="2534250">]</span><span class="op" id="2534251">)</span><span class="op" id="2534252">;</span>&nbsp;<span class="ident" id="2534254"><a href="/net/dnsclient_unix.go.html#2534224">err</a></span>&nbsp;<span class="op" id="2534258">!=</span>&nbsp;<span class="ident" id="2534261">nil</span>&nbsp;<span class="op" id="2534265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534269">return</span>&nbsp;<span class="ident" id="2534276">nil</span><span class="op" id="2534279">,</span>&nbsp;<span class="ident" id="2534281"><a href="/net/dnsclient_unix.go.html#2534224">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2534286">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534289">l</span>&nbsp;<span class="op" id="2534291">:=</span>&nbsp;<span class="builtintype" id="2534294">int</span><span class="op" id="2534297">(</span><span class="ident" id="2534298"><a href="/net/dnsclient_unix.go.html#2534121">b</a></span><span class="op" id="2534299">[</span><span class="num" id="2534300">0</span><span class="op" id="2534301">]</span><span class="op" id="2534302">)</span><span class="op" id="2534303">&lt;&lt;</span><span class="num" id="2534305">8</span>&nbsp;<span class="op" id="2534307">|</span>&nbsp;<span class="builtintype" id="2534309">int</span><span class="op" id="2534312">(</span><span class="ident" id="2534313"><a href="/net/dnsclient_unix.go.html#2534121">b</a></span><span class="op" id="2534314">[</span><span class="num" id="2534315">1</span><span class="op" id="2534316">]</span><span class="op" id="2534317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534320">if</span>&nbsp;<span class="ident" id="2534323"><a href="/net/dnsclient_unix.go.html#2534289">l</a></span>&nbsp;<span class="op" id="2534325">&gt;</span>&nbsp;<span class="builtinfunc" id="2534327">len</span><span class="op" id="2534330">(</span><span class="ident" id="2534331"><a href="/net/dnsclient_unix.go.html#2534121">b</a></span><span class="op" id="2534332">)</span>&nbsp;<span class="op" id="2534334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534338"><a href="/net/dnsclient_unix.go.html#2534121">b</a></span>&nbsp;<span class="op" id="2534340">=</span>&nbsp;<span class="builtinfunc" id="2534342">make</span><span class="op" id="2534346">(</span><span class="op" id="2534347">[</span><span class="op" id="2534348">]</span><span class="builtintype" id="2534349">byte</span><span class="op" id="2534353">,</span>&nbsp;<span class="ident" id="2534355"><a href="/net/dnsclient_unix.go.html#2534289">l</a></span><span class="op" id="2534356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2534359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534362">n</span><span class="op" id="2534363">,</span>&nbsp;<span class="ident" id="2534365">err</span>&nbsp;<span class="op" id="2534369">:=</span>&nbsp;<span class="ident" id="2534372"><a href="/net/dnsclient_unix.go.html#2533169">io</a></span><span class="op" id="2534374">.</span><span class="ident" id="2534375">ReadFull</span><span class="op" id="2534383">(</span><span class="ident" id="2534384"><a href="/net/dnsclient_unix.go.html#2534071">c</a></span><span class="op" id="2534385">,</span>&nbsp;<span class="ident" id="2534387"><a href="/net/dnsclient_unix.go.html#2534121">b</a></span><span class="op" id="2534388">[</span><span class="op" id="2534389">:</span><span class="ident" id="2534390"><a href="/net/dnsclient_unix.go.html#2534289">l</a></span><span class="op" id="2534391">]</span><span class="op" id="2534392">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534395">if</span>&nbsp;<span class="ident" id="2534398"><a href="/net/dnsclient_unix.go.html#2534365">err</a></span>&nbsp;<span class="op" id="2534402">!=</span>&nbsp;<span class="ident" id="2534405">nil</span>&nbsp;<span class="op" id="2534409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534413">return</span>&nbsp;<span class="ident" id="2534420">nil</span><span class="op" id="2534423">,</span>&nbsp;<span class="ident" id="2534425"><a href="/net/dnsclient_unix.go.html#2534365">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2534430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534433">msg</span>&nbsp;<span class="op" id="2534437">:=</span>&nbsp;<span class="op" id="2534440">&amp;</span><span class="ident" id="2534441"><a href="/net/dnsmsg.go.html#2563931">dnsMsg</a></span><span class="op" id="2534447">{</span><span class="op" id="2534448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534451">if</span>&nbsp;<span class="op" id="2534454">!</span><span class="ident" id="2534455"><a href="/net/dnsclient_unix.go.html#2534433">msg</a></span><span class="op" id="2534458">.</span><span class="ident" id="2534459">Unpack</span><span class="op" id="2534465">(</span><span class="ident" id="2534466"><a href="/net/dnsclient_unix.go.html#2534121">b</a></span><span class="op" id="2534467">[</span><span class="op" id="2534468">:</span><span class="ident" id="2534469"><a href="/net/dnsclient_unix.go.html#2534362">n</a></span><span class="op" id="2534470">]</span><span class="op" id="2534471">)</span>&nbsp;<span class="op" id="2534473">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534477">return</span>&nbsp;<span class="ident" id="2534484">nil</span><span class="op" id="2534487">,</span>&nbsp;<span class="ident" id="2534489"><a href="/net/dnsclient_unix.go.html#2533159">errors</a></span><span class="op" id="2534495">.</span><span class="ident" id="2534496">New</span><span class="op" id="2534499">(</span><span class="string" id="2534500">&#34;cannot&nbsp;unmarshal&nbsp;DNS&nbsp;message&#34;</span><span class="op" id="2534530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2534533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534536">return</span>&nbsp;<span class="ident" id="2534543"><a href="/net/dnsclient_unix.go.html#2534433">msg</a></span><span class="op" id="2534546">,</span>&nbsp;<span class="ident" id="2534548">nil</span><br>
<span class="lineno"></span><span class="op" id="2534552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="2534555">func</span>&nbsp;<span class="op" id="2534560">(</span><span class="ident" id="2534561">c</span>&nbsp;<span class="op" id="2534563">*</span><span class="ident" id="2534564"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2534571">)</span>&nbsp;<span class="ident" id="2534573">writeDNSQuery</span><span class="op" id="2534586">(</span><span class="ident" id="2534587">msg</span>&nbsp;<span class="op" id="2534591">*</span><span class="ident" id="2534592"><a href="/net/dnsmsg.go.html#2563931">dnsMsg</a></span><span class="op" id="2534598">)</span>&nbsp;<span class="builtintype" id="2534600">error</span>&nbsp;<span class="op" id="2534606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534609">b</span><span class="op" id="2534610">,</span>&nbsp;<span class="ident" id="2534612">ok</span>&nbsp;<span class="op" id="2534615">:=</span>&nbsp;<span class="ident" id="2534618"><a href="/net/dnsclient_unix.go.html#2534587">msg</a></span><span class="op" id="2534621">.</span><span class="ident" id="2534622">Pack</span><span class="op" id="2534626">(</span><span class="op" id="2534627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534630">if</span>&nbsp;<span class="op" id="2534633">!</span><span class="ident" id="2534634"><a href="/net/dnsclient_unix.go.html#2534612">ok</a></span>&nbsp;<span class="op" id="2534637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534641">return</span>&nbsp;<span class="ident" id="2534648"><a href="/net/dnsclient_unix.go.html#2533159">errors</a></span><span class="op" id="2534654">.</span><span class="ident" id="2534655">New</span><span class="op" id="2534658">(</span><span class="string" id="2534659">&#34;cannot&nbsp;marshal&nbsp;DNS&nbsp;message&#34;</span><span class="op" id="2534687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2534690">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534693">l</span>&nbsp;<span class="op" id="2534695">:=</span>&nbsp;<span class="builtintype" id="2534698">uint16</span><span class="op" id="2534704">(</span><span class="builtinfunc" id="2534705">len</span><span class="op" id="2534708">(</span><span class="ident" id="2534709"><a href="/net/dnsclient_unix.go.html#2534609">b</a></span><span class="op" id="2534710">)</span><span class="op" id="2534711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2534714"><a href="/net/dnsclient_unix.go.html#2534609">b</a></span>&nbsp;<span class="op" id="2534716">=</span>&nbsp;<span class="builtinfunc" id="2534718">append</span><span class="op" id="2534724">(</span><span class="op" id="2534725">[</span><span class="op" id="2534726">]</span><span class="builtintype" id="2534727">byte</span><span class="op" id="2534731">{</span><span class="builtintype" id="2534732">byte</span><span class="op" id="2534736">(</span><span class="ident" id="2534737"><a href="/net/dnsclient_unix.go.html#2534693">l</a></span>&nbsp;<span class="op" id="2534739">&gt;&gt;</span>&nbsp;<span class="num" id="2534742">8</span><span class="op" id="2534743">)</span><span class="op" id="2534744">,</span>&nbsp;<span class="builtintype" id="2534746">byte</span><span class="op" id="2534750">(</span><span class="ident" id="2534751"><a href="/net/dnsclient_unix.go.html#2534693">l</a></span><span class="op" id="2534752">)</span><span class="op" id="2534753">}</span><span class="op" id="2534754">,</span>&nbsp;<span class="ident" id="2534756"><a href="/net/dnsclient_unix.go.html#2534609">b</a></span><span class="op" id="2534757">...</span><span class="op" id="2534760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534763">if</span>&nbsp;<span class="ident" id="2534766">_</span><span class="op" id="2534767">,</span>&nbsp;<span class="ident" id="2534769">err</span>&nbsp;<span class="op" id="2534773">:=</span>&nbsp;<span class="ident" id="2534776"><a href="/net/dnsclient_unix.go.html#2534561">c</a></span><span class="op" id="2534777">.</span><span class="ident" id="2534778">Write</span><span class="op" id="2534783">(</span><span class="ident" id="2534784"><a href="/net/dnsclient_unix.go.html#2534609">b</a></span><span class="op" id="2534785">)</span><span class="op" id="2534786">;</span>&nbsp;<span class="ident" id="2534788"><a href="/net/dnsclient_unix.go.html#2534769">err</a></span>&nbsp;<span class="op" id="2534792">!=</span>&nbsp;<span class="ident" id="2534795">nil</span>&nbsp;<span class="op" id="2534799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534803">return</span>&nbsp;<span class="ident" id="2534810"><a href="/net/dnsclient_unix.go.html#2534769">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2534815">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534818">return</span>&nbsp;<span class="ident" id="2534825">nil</span><br>
<span class="lineno"></span><span class="op" id="2534829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2534832">func</span>&nbsp;<span class="op" id="2534837">(</span><span class="ident" id="2534838">d</span>&nbsp;<span class="op" id="2534840">*</span><span class="ident" id="2534841"><a href="/net/dial.go.html#2517815">Dialer</a></span><span class="op" id="2534847">)</span>&nbsp;<span class="ident" id="2534849">dialDNS</span><span class="op" id="2534856">(</span><span class="ident" id="2534857">network</span><span class="op" id="2534864">,</span>&nbsp;<span class="ident" id="2534866">server</span>&nbsp;<span class="builtintype" id="2534873">string</span><span class="op" id="2534879">)</span>&nbsp;<span class="op" id="2534881">(</span><span class="ident" id="2534882"><a href="/net/dnsclient_unix.go.html#2533267">dnsConn</a></span><span class="op" id="2534889">,</span>&nbsp;<span class="builtintype" id="2534891">error</span><span class="op" id="2534896">)</span>&nbsp;<span class="op" id="2534898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534901">switch</span>&nbsp;<span class="ident" id="2534908"><a href="/net/dnsclient_unix.go.html#2534857">network</a></span>&nbsp;<span class="op" id="2534916">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534919">case</span>&nbsp;<span class="string" id="2534924">&#34;tcp&#34;</span><span class="op" id="2534929">,</span>&nbsp;<span class="string" id="2534931">&#34;tcp4&#34;</span><span class="op" id="2534937">,</span>&nbsp;<span class="string" id="2534939">&#34;tcp6&#34;</span><span class="op" id="2534945">,</span>&nbsp;<span class="string" id="2534947">&#34;udp&#34;</span><span class="op" id="2534952">,</span>&nbsp;<span class="string" id="2534954">&#34;udp4&#34;</span><span class="op" id="2534960">,</span>&nbsp;<span class="string" id="2534962">&#34;udp6&#34;</span><span class="op" id="2534968">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534971">default</span><span class="op" id="2534978">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2534982">return</span>&nbsp;<span class="ident" id="2534989">nil</span><span class="op" id="2534992">,</span>&nbsp;<span class="ident" id="2534994"><a href="/net/net.go.html#2661008">UnknownNetworkError</a></span><span class="op" id="2535013">(</span><span class="ident" id="2535014"><a href="/net/dnsclient_unix.go.html#2534857">network</a></span><span class="op" id="2535021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2535024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2535027">//&nbsp;Calling&nbsp;Dial&nbsp;here&nbsp;is&nbsp;scary&nbsp;--&nbsp;we&nbsp;have&nbsp;to&nbsp;be&nbsp;sure&nbsp;not&nbsp;to</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2535087">//&nbsp;dial&nbsp;a&nbsp;name&nbsp;that&nbsp;will&nbsp;require&nbsp;a&nbsp;DNS&nbsp;lookup,&nbsp;or&nbsp;Dial&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2535148">//&nbsp;call&nbsp;back&nbsp;here&nbsp;to&nbsp;translate&nbsp;it.&nbsp;The&nbsp;DNS&nbsp;config&nbsp;parser&nbsp;has</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2535210">//&nbsp;already&nbsp;checked&nbsp;that&nbsp;all&nbsp;the&nbsp;cfg.servers[i]&nbsp;are&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2535265">//&nbsp;addresses,&nbsp;which&nbsp;Dial&nbsp;will&nbsp;use&nbsp;without&nbsp;a&nbsp;DNS&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2535322">c</span><span class="op" id="2535323">,</span>&nbsp;<span class="ident" id="2535325">err</span>&nbsp;<span class="op" id="2535329">:=</span>&nbsp;<span class="ident" id="2535332"><a href="/net/dnsclient_unix.go.html#2534838">d</a></span><span class="op" id="2535333">.</span><span class="ident" id="2535334">Dial</span><span class="op" id="2535338">(</span><span class="ident" id="2535339"><a href="/net/dnsclient_unix.go.html#2534857">network</a></span><span class="op" id="2535346">,</span>&nbsp;<span class="ident" id="2535348"><a href="/net/dnsclient_unix.go.html#2534866">server</a></span><span class="op" id="2535354">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2535357">if</span>&nbsp;<span class="ident" id="2535360"><a href="/net/dnsclient_unix.go.html#2535325">err</a></span>&nbsp;<span class="op" id="2535364">!=</span>&nbsp;<span class="ident" id="2535367">nil</span>&nbsp;<span class="op" id="2535371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2535375">return</span>&nbsp;<span class="ident" id="2535382">nil</span><span class="op" id="2535385">,</span>&nbsp;<span class="ident" id="2535387"><a href="/net/dnsclient_unix.go.html#2535325">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2535392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2535395">switch</span>&nbsp;<span class="ident" id="2535402"><a href="/net/dnsclient_unix.go.html#2534857">network</a></span>&nbsp;<span class="op" id="2535410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2535413">case</span>&nbsp;<span class="string" id="2535418">&#34;tcp&#34;</span><span class="op" id="2535423">,</span>&nbsp;<span class="string" id="2535425">&#34;tcp4&#34;</span><span class="op" id="2535431">,</span>&nbsp;<span class="string" id="2535433">&#34;tcp6&#34;</span><span class="op" id="2535439">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2535443">return</span>&nbsp;<span class="ident" id="2535450"><a href="/net/dnsclient_unix.go.html#2535322">c</a></span><span class="op" id="2535451">.</span><span class="op" id="2535452">(</span><span class="op" id="2535453">*</span><span class="ident" id="2535454"><a href="/net/tcpsock_posix.go.html#2694160">TCPConn</a></span><span class="op" id="2535461">)</span><span class="op" id="2535462">,</span>&nbsp;<span class="ident" id="2535464">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2535469">case</span>&nbsp;<span class="string" id="2535474">&#34;udp&#34;</span><span class="op" id="2535479">,</span>&nbsp;<span class="string" id="2535481">&#34;udp4&#34;</span><span class="op" id="2535487">,</span>&nbsp;<span class="string" id="2535489">&#34;udp6&#34;</span><span class="op" id="2535495">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2535499">return</span>&nbsp;<span class="ident" id="2535506"><a href="/net/dnsclient_unix.go.html#2535322">c</a></span><span class="op" id="2535507">.</span><span class="op" id="2535508">(</span><span class="op" id="2535509">*</span><span class="ident" id="2535510"><a href="/net/udpsock_posix.go.html#2706235">UDPConn</a></span><span class="op" id="2535517">)</span><span class="op" id="2535518">,</span>&nbsp;<span class="ident" id="2535520">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2535525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2535528">panic</span><span class="op" id="2535533">(</span><span class="string" id="2535534">&#34;unreachable&#34;</span><span class="op" id="2535547">)</span><br>
<span class="lineno">120</span><span class="op" id="2535549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2535552">//&nbsp;exchange&nbsp;sends&nbsp;a&nbsp;query&nbsp;on&nbsp;the&nbsp;connection&nbsp;and&nbsp;hopes&nbsp;for&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="2535622">func</span>&nbsp;<span class="ident" id="2535627">exchange</span><span class="op" id="2535635">(</span><span class="ident" id="2535636">server</span><span class="op" id="2535642">,</span>&nbsp;<span class="ident" id="2535644">name</span>&nbsp;<span class="builtintype" id="2535649">string</span><span class="op" id="2535655">,</span>&nbsp;<span class="ident" id="2535657">qtype</span>&nbsp;<span class="builtintype" id="2535663">uint16</span><span class="op" id="2535669">,</span>&nbsp;<span class="ident" id="2535671">timeout</span>&nbsp;<span class="ident" id="2535679"><a href="/net/dnsclient_unix.go.html#2533202">time</a></span><span class="op" id="2535683">.</span><span class="ident" id="2535684">Duration</span><span class="op" id="2535692">)</span>&nbsp;<span class="op" id="2535694">(</span><span class="op" id="2535695">*</span><span class="ident" id="2535696"><a href="/net/dnsmsg.go.html#2563931">dnsMsg</a></span><span class="op" id="2535702">,</span>&nbsp;<span class="builtintype" id="2535704">error</span><span class="op" id="2535709">)</span>&nbsp;<span class="op" id="2535711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2535714">d</span>&nbsp;<span class="op" id="2535716">:=</span>&nbsp;<span class="ident" id="2535719"><a href="/net/dial.go.html#2517815">Dialer</a></span><span class="op" id="2535725">{</span><span class="ident" id="2535726">Timeout</span><span class="op" id="2535733">:</span>&nbsp;<span class="ident" id="2535735"><a href="/net/dnsclient_unix.go.html#2535671">timeout</a></span><span class="op" id="2535742">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2535745">out</span>&nbsp;<span class="op" id="2535749">:=</span>&nbsp;<span class="ident" id="2535752"><a href="/net/dnsmsg.go.html#2563931">dnsMsg</a></span><span class="op" id="2535758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2535762">dnsMsgHdr</span><span class="op" id="2535771">:</span>&nbsp;<span class="ident" id="2535773"><a href="/net/dnsmsg.go.html#2563294">dnsMsgHdr</a></span><span class="op" id="2535782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2535787">recursion_desired</span><span class="op" id="2535804">:</span>&nbsp;<span class="ident" id="2535806">true</span><span class="op" id="2535810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2535814">}</span><span class="op" id="2535815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2535819">question</span><span class="op" id="2535827">:</span>&nbsp;<span class="op" id="2535829">[</span><span class="op" id="2535830">]</span><span class="ident" id="2535831"><a href="/net/dnsmsg.go.html#2548921">dnsQuestion</a></span><span class="op" id="2535842">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2535847">{</span><span class="ident" id="2535848"><a href="/net/dnsclient_unix.go.html#2535644">name</a></span><span class="op" id="2535852">,</span>&nbsp;<span class="ident" id="2535854"><a href="/net/dnsclient_unix.go.html#2535657">qtype</a></span><span class="op" id="2535859">,</span>&nbsp;<span class="ident" id="2535861"><a href="/net/dnsmsg.go.html#2547322">dnsClassINET</a></span><span class="op" id="2535873">}</span><span class="op" id="2535874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2535878">}</span><span class="op" id="2535879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2535882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2535885">for</span>&nbsp;<span class="ident" id="2535889">_</span><span class="op" id="2535890">,</span>&nbsp;<span class="ident" id="2535892">network</span>&nbsp;<span class="op" id="2535900">:=</span>&nbsp;<span class="keyword" id="2535903">range</span>&nbsp;<span class="op" id="2535909">[</span><span class="op" id="2535910">]</span><span class="builtintype" id="2535911">string</span><span class="op" id="2535917">{</span><span class="string" id="2535918">&#34;udp&#34;</span><span class="op" id="2535923">,</span>&nbsp;<span class="string" id="2535925">&#34;tcp&#34;</span><span class="op" id="2535930">}</span>&nbsp;<span class="op" id="2535932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2535936">c</span><span class="op" id="2535937">,</span>&nbsp;<span class="ident" id="2535939">err</span>&nbsp;<span class="op" id="2535943">:=</span>&nbsp;<span class="ident" id="2535946"><a href="/net/dnsclient_unix.go.html#2535714">d</a></span><span class="op" id="2535947">.</span><span class="ident" id="2535948">dialDNS</span><span class="op" id="2535955">(</span><span class="ident" id="2535956"><a href="/net/dnsclient_unix.go.html#2535892">network</a></span><span class="op" id="2535963">,</span>&nbsp;<span class="ident" id="2535965"><a href="/net/dnsclient_unix.go.html#2535636">server</a></span><span class="op" id="2535971">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2535975">if</span>&nbsp;<span class="ident" id="2535978"><a href="/net/dnsclient_unix.go.html#2535939">err</a></span>&nbsp;<span class="op" id="2535982">!=</span>&nbsp;<span class="ident" id="2535985">nil</span>&nbsp;<span class="op" id="2535989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2535994">return</span>&nbsp;<span class="ident" id="2536001">nil</span><span class="op" id="2536004">,</span>&nbsp;<span class="ident" id="2536006"><a href="/net/dnsclient_unix.go.html#2535939">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2536012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536016">defer</span>&nbsp;<span class="ident" id="2536022"><a href="/net/dnsclient_unix.go.html#2535936">c</a></span><span class="op" id="2536023">.</span><span class="ident" id="2536024">Close</span><span class="op" id="2536029">(</span><span class="op" id="2536030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536034">if</span>&nbsp;<span class="ident" id="2536037"><a href="/net/dnsclient_unix.go.html#2535671">timeout</a></span>&nbsp;<span class="op" id="2536045">&gt;</span>&nbsp;<span class="num" id="2536047">0</span>&nbsp;<span class="op" id="2536049">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2536054"><a href="/net/dnsclient_unix.go.html#2535936">c</a></span><span class="op" id="2536055">.</span><span class="ident" id="2536056">SetDeadline</span><span class="op" id="2536067">(</span><span class="ident" id="2536068"><a href="/net/dnsclient_unix.go.html#2533202">time</a></span><span class="op" id="2536072">.</span><span class="ident" id="2536073">Now</span><span class="op" id="2536076">(</span><span class="op" id="2536077">)</span><span class="op" id="2536078">.</span><span class="ident" id="2536079">Add</span><span class="op" id="2536082">(</span><span class="ident" id="2536083"><a href="/net/dnsclient_unix.go.html#2535671">timeout</a></span><span class="op" id="2536090">)</span><span class="op" id="2536091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2536095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2536099"><a href="/net/dnsclient_unix.go.html#2535745">out</a></span><span class="op" id="2536102">.</span><span class="ident" id="2536103">id</span>&nbsp;<span class="op" id="2536106">=</span>&nbsp;<span class="builtintype" id="2536108">uint16</span><span class="op" id="2536114">(</span><span class="ident" id="2536115"><a href="/net/dnsclient_unix.go.html#2533175">rand</a></span><span class="op" id="2536119">.</span><span class="ident" id="2536120">Int</span><span class="op" id="2536123">(</span><span class="op" id="2536124">)</span><span class="op" id="2536125">)</span>&nbsp;<span class="op" id="2536127">^</span>&nbsp;<span class="builtintype" id="2536129">uint16</span><span class="op" id="2536135">(</span><span class="ident" id="2536136"><a href="/net/dnsclient_unix.go.html#2533202">time</a></span><span class="op" id="2536140">.</span><span class="ident" id="2536141">Now</span><span class="op" id="2536144">(</span><span class="op" id="2536145">)</span><span class="op" id="2536146">.</span><span class="ident" id="2536147">UnixNano</span><span class="op" id="2536155">(</span><span class="op" id="2536156">)</span><span class="op" id="2536157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536161">if</span>&nbsp;<span class="ident" id="2536164">err</span>&nbsp;<span class="op" id="2536168">:=</span>&nbsp;<span class="ident" id="2536171"><a href="/net/dnsclient_unix.go.html#2535936">c</a></span><span class="op" id="2536172">.</span><span class="ident" id="2536173">writeDNSQuery</span><span class="op" id="2536186">(</span><span class="op" id="2536187">&amp;</span><span class="ident" id="2536188"><a href="/net/dnsclient_unix.go.html#2535745">out</a></span><span class="op" id="2536191">)</span><span class="op" id="2536192">;</span>&nbsp;<span class="ident" id="2536194"><a href="/net/dnsclient_unix.go.html#2536164">err</a></span>&nbsp;<span class="op" id="2536198">!=</span>&nbsp;<span class="ident" id="2536201">nil</span>&nbsp;<span class="op" id="2536205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536210">return</span>&nbsp;<span class="ident" id="2536217">nil</span><span class="op" id="2536220">,</span>&nbsp;<span class="ident" id="2536222"><a href="/net/dnsclient_unix.go.html#2536164">err</a></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2536228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2536232">in</span><span class="op" id="2536234">,</span>&nbsp;<span class="ident" id="2536236"><a href="/net/dnsclient_unix.go.html#2535939">err</a></span>&nbsp;<span class="op" id="2536240">:=</span>&nbsp;<span class="ident" id="2536243"><a href="/net/dnsclient_unix.go.html#2535936">c</a></span><span class="op" id="2536244">.</span><span class="ident" id="2536245">readDNSResponse</span><span class="op" id="2536260">(</span><span class="op" id="2536261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536265">if</span>&nbsp;<span class="ident" id="2536268"><a href="/net/dnsclient_unix.go.html#2535939">err</a></span>&nbsp;<span class="op" id="2536272">!=</span>&nbsp;<span class="ident" id="2536275">nil</span>&nbsp;<span class="op" id="2536279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536284">return</span>&nbsp;<span class="ident" id="2536291">nil</span><span class="op" id="2536294">,</span>&nbsp;<span class="ident" id="2536296"><a href="/net/dnsclient_unix.go.html#2535939">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2536302">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536306">if</span>&nbsp;<span class="ident" id="2536309"><a href="/net/dnsclient_unix.go.html#2536232">in</a></span><span class="op" id="2536311">.</span><span class="ident" id="2536312">id</span>&nbsp;<span class="op" id="2536315">!=</span>&nbsp;<span class="ident" id="2536318"><a href="/net/dnsclient_unix.go.html#2535745">out</a></span><span class="op" id="2536321">.</span><span class="ident" id="2536322">id</span>&nbsp;<span class="op" id="2536325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536330">return</span>&nbsp;<span class="ident" id="2536337">nil</span><span class="op" id="2536340">,</span>&nbsp;<span class="ident" id="2536342"><a href="/net/dnsclient_unix.go.html#2533159">errors</a></span><span class="op" id="2536348">.</span><span class="ident" id="2536349">New</span><span class="op" id="2536352">(</span><span class="string" id="2536353">&#34;DNS&nbsp;message&nbsp;ID&nbsp;mismatch&#34;</span><span class="op" id="2536378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2536382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536386">if</span>&nbsp;<span class="ident" id="2536389"><a href="/net/dnsclient_unix.go.html#2536232">in</a></span><span class="op" id="2536391">.</span><span class="ident" id="2536392">truncated</span>&nbsp;<span class="op" id="2536402">{</span>&nbsp;<span class="comment" id="2536404">//&nbsp;see&nbsp;RFC&nbsp;5966</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536423">continue</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2536434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536438">return</span>&nbsp;<span class="ident" id="2536445"><a href="/net/dnsclient_unix.go.html#2536232">in</a></span><span class="op" id="2536447">,</span>&nbsp;<span class="ident" id="2536449">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2536454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536457">return</span>&nbsp;<span class="ident" id="2536464">nil</span><span class="op" id="2536467">,</span>&nbsp;<span class="ident" id="2536469"><a href="/net/dnsclient_unix.go.html#2533159">errors</a></span><span class="op" id="2536475">.</span><span class="ident" id="2536476">New</span><span class="op" id="2536479">(</span><span class="string" id="2536480">&#34;no&nbsp;answer&nbsp;from&nbsp;DNS&nbsp;server&#34;</span><span class="op" id="2536507">)</span><br>
<span class="lineno"></span><span class="op" id="2536509">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="2536512">//&nbsp;Do&nbsp;a&nbsp;lookup&nbsp;for&nbsp;a&nbsp;single&nbsp;name,&nbsp;which&nbsp;must&nbsp;be&nbsp;rooted</span><br>
<span class="lineno"></span><span class="comment" id="2536567">//&nbsp;(otherwise&nbsp;answer&nbsp;will&nbsp;not&nbsp;find&nbsp;the&nbsp;answers).</span><br>
<span class="lineno"></span><span class="keyword" id="2536616">func</span>&nbsp;<span class="ident" id="2536621">tryOneName</span><span class="op" id="2536631">(</span><span class="ident" id="2536632">cfg</span>&nbsp;<span class="op" id="2536636">*</span><span class="ident" id="2536637"><a href="/net/dnsconfig_unix.go.html#2543590">dnsConfig</a></span><span class="op" id="2536646">,</span>&nbsp;<span class="ident" id="2536648">name</span>&nbsp;<span class="builtintype" id="2536653">string</span><span class="op" id="2536659">,</span>&nbsp;<span class="ident" id="2536661">qtype</span>&nbsp;<span class="builtintype" id="2536667">uint16</span><span class="op" id="2536673">)</span>&nbsp;<span class="op" id="2536675">(</span><span class="builtintype" id="2536676">string</span><span class="op" id="2536682">,</span>&nbsp;<span class="op" id="2536684">[</span><span class="op" id="2536685">]</span><span class="ident" id="2536686"><a href="/net/dnsmsg.go.html#2549843">dnsRR</a></span><span class="op" id="2536691">,</span>&nbsp;<span class="builtintype" id="2536693">error</span><span class="op" id="2536698">)</span>&nbsp;<span class="op" id="2536700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536703">if</span>&nbsp;<span class="builtinfunc" id="2536706">len</span><span class="op" id="2536709">(</span><span class="ident" id="2536710"><a href="/net/dnsclient_unix.go.html#2536632">cfg</a></span><span class="op" id="2536713">.</span><span class="ident" id="2536714">servers</span><span class="op" id="2536721">)</span>&nbsp;<span class="op" id="2536723">==</span>&nbsp;<span class="num" id="2536726">0</span>&nbsp;<span class="op" id="2536728">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536732">return</span>&nbsp;<span class="string" id="2536739">&#34;&#34;</span><span class="op" id="2536741">,</span>&nbsp;<span class="ident" id="2536743">nil</span><span class="op" id="2536746">,</span>&nbsp;<span class="op" id="2536748">&amp;</span><span class="ident" id="2536749"><a href="/net/dnsclient.go.html#2526854">DNSError</a></span><span class="op" id="2536757">{</span><span class="ident" id="2536758">Err</span><span class="op" id="2536761">:</span>&nbsp;<span class="string" id="2536763">&#34;no&nbsp;DNS&nbsp;servers&#34;</span><span class="op" id="2536779">,</span>&nbsp;<span class="ident" id="2536781">Name</span><span class="op" id="2536785">:</span>&nbsp;<span class="ident" id="2536787"><a href="/net/dnsclient_unix.go.html#2536648">name</a></span><span class="op" id="2536791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2536794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536797">if</span>&nbsp;<span class="builtinfunc" id="2536800">len</span><span class="op" id="2536803">(</span><span class="ident" id="2536804"><a href="/net/dnsclient_unix.go.html#2536648">name</a></span><span class="op" id="2536808">)</span>&nbsp;<span class="op" id="2536810">&gt;=</span>&nbsp;<span class="num" id="2536813">256</span>&nbsp;<span class="op" id="2536817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536821">return</span>&nbsp;<span class="string" id="2536828">&#34;&#34;</span><span class="op" id="2536830">,</span>&nbsp;<span class="ident" id="2536832">nil</span><span class="op" id="2536835">,</span>&nbsp;<span class="op" id="2536837">&amp;</span><span class="ident" id="2536838"><a href="/net/dnsclient.go.html#2526854">DNSError</a></span><span class="op" id="2536846">{</span><span class="ident" id="2536847">Err</span><span class="op" id="2536850">:</span>&nbsp;<span class="string" id="2536852">&#34;DNS&nbsp;name&nbsp;too&nbsp;long&#34;</span><span class="op" id="2536871">,</span>&nbsp;<span class="ident" id="2536873">Name</span><span class="op" id="2536877">:</span>&nbsp;<span class="ident" id="2536879"><a href="/net/dnsclient_unix.go.html#2536648">name</a></span><span class="op" id="2536883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2536886">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2536889">timeout</span>&nbsp;<span class="op" id="2536897">:=</span>&nbsp;<span class="ident" id="2536900"><a href="/net/dnsclient_unix.go.html#2533202">time</a></span><span class="op" id="2536904">.</span><span class="ident" id="2536905">Duration</span><span class="op" id="2536913">(</span><span class="ident" id="2536914"><a href="/net/dnsclient_unix.go.html#2536632">cfg</a></span><span class="op" id="2536917">.</span><span class="ident" id="2536918">timeout</span><span class="op" id="2536925">)</span>&nbsp;<span class="op" id="2536927">*</span>&nbsp;<span class="ident" id="2536929"><a href="/net/dnsclient_unix.go.html#2533202">time</a></span><span class="op" id="2536933">.</span><span class="ident" id="2536934">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536942">var</span>&nbsp;<span class="ident" id="2536946">lastErr</span>&nbsp;<span class="builtintype" id="2536954">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536961">for</span>&nbsp;<span class="ident" id="2536965">i</span>&nbsp;<span class="op" id="2536967">:=</span>&nbsp;<span class="num" id="2536970">0</span><span class="op" id="2536971">;</span>&nbsp;<span class="ident" id="2536973"><a href="/net/dnsclient_unix.go.html#2536965">i</a></span>&nbsp;<span class="op" id="2536975">&lt;</span>&nbsp;<span class="ident" id="2536977"><a href="/net/dnsclient_unix.go.html#2536632">cfg</a></span><span class="op" id="2536980">.</span><span class="ident" id="2536981">attempts</span><span class="op" id="2536989">;</span>&nbsp;<span class="ident" id="2536991"><a href="/net/dnsclient_unix.go.html#2536965">i</a></span><span class="op" id="2536992">++</span>&nbsp;<span class="op" id="2536995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2536999">for</span>&nbsp;<span class="ident" id="2537003">_</span><span class="op" id="2537004">,</span>&nbsp;<span class="ident" id="2537006">server</span>&nbsp;<span class="op" id="2537013">:=</span>&nbsp;<span class="keyword" id="2537016">range</span>&nbsp;<span class="ident" id="2537022"><a href="/net/dnsclient_unix.go.html#2536632">cfg</a></span><span class="op" id="2537025">.</span><span class="ident" id="2537026">servers</span>&nbsp;<span class="op" id="2537034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537039"><a href="/net/dnsclient_unix.go.html#2537006">server</a></span>&nbsp;<span class="op" id="2537046">=</span>&nbsp;<span class="ident" id="2537048"><a href="/net/ipsock.go.html#2633137">JoinHostPort</a></span><span class="op" id="2537060">(</span><span class="ident" id="2537061"><a href="/net/dnsclient_unix.go.html#2537006">server</a></span><span class="op" id="2537067">,</span>&nbsp;<span class="string" id="2537069">&#34;53&#34;</span><span class="op" id="2537073">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537078">msg</span><span class="op" id="2537081">,</span>&nbsp;<span class="ident" id="2537083">err</span>&nbsp;<span class="op" id="2537087">:=</span>&nbsp;<span class="ident" id="2537090"><a href="/net/dnsclient_unix.go.html#2535627">exchange</a></span><span class="op" id="2537098">(</span><span class="ident" id="2537099"><a href="/net/dnsclient_unix.go.html#2537006">server</a></span><span class="op" id="2537105">,</span>&nbsp;<span class="ident" id="2537107"><a href="/net/dnsclient_unix.go.html#2536648">name</a></span><span class="op" id="2537111">,</span>&nbsp;<span class="ident" id="2537113"><a href="/net/dnsclient_unix.go.html#2536661">qtype</a></span><span class="op" id="2537118">,</span>&nbsp;<span class="ident" id="2537120"><a href="/net/dnsclient_unix.go.html#2536889">timeout</a></span><span class="op" id="2537127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537132">if</span>&nbsp;<span class="ident" id="2537135"><a href="/net/dnsclient_unix.go.html#2537083">err</a></span>&nbsp;<span class="op" id="2537139">!=</span>&nbsp;<span class="ident" id="2537142">nil</span>&nbsp;<span class="op" id="2537146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537152"><a href="/net/dnsclient_unix.go.html#2536946">lastErr</a></span>&nbsp;<span class="op" id="2537160">=</span>&nbsp;<span class="op" id="2537162">&amp;</span><span class="ident" id="2537163"><a href="/net/dnsclient.go.html#2526854">DNSError</a></span><span class="op" id="2537171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537178">Err</span><span class="op" id="2537181">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2537186"><a href="/net/dnsclient_unix.go.html#2537083">err</a></span><span class="op" id="2537189">.</span><span class="ident" id="2537190">Error</span><span class="op" id="2537195">(</span><span class="op" id="2537196">)</span><span class="op" id="2537197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537204">Name</span><span class="op" id="2537208">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2537212"><a href="/net/dnsclient_unix.go.html#2536648">name</a></span><span class="op" id="2537216">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537223">Server</span><span class="op" id="2537229">:</span>&nbsp;<span class="ident" id="2537231"><a href="/net/dnsclient_unix.go.html#2537006">server</a></span><span class="op" id="2537237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2537243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537249">if</span>&nbsp;<span class="ident" id="2537252">nerr</span><span class="op" id="2537256">,</span>&nbsp;<span class="ident" id="2537258">ok</span>&nbsp;<span class="op" id="2537261">:=</span>&nbsp;<span class="ident" id="2537264"><a href="/net/dnsclient_unix.go.html#2537083">err</a></span><span class="op" id="2537267">.</span><span class="op" id="2537268">(</span><span class="ident" id="2537269"><a href="/net/net.go.html#2656629">Error</a></span><span class="op" id="2537274">)</span><span class="op" id="2537275">;</span>&nbsp;<span class="ident" id="2537277"><a href="/net/dnsclient_unix.go.html#2537258">ok</a></span>&nbsp;<span class="op" id="2537280">&amp;&amp;</span>&nbsp;<span class="ident" id="2537283"><a href="/net/dnsclient_unix.go.html#2537252">nerr</a></span><span class="op" id="2537287">.</span><span class="ident" id="2537288">Timeout</span><span class="op" id="2537295">(</span><span class="op" id="2537296">)</span>&nbsp;<span class="op" id="2537298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537305"><a href="/net/dnsclient_unix.go.html#2536946">lastErr</a></span><span class="op" id="2537312">.</span><span class="op" id="2537313">(</span><span class="op" id="2537314">*</span><span class="ident" id="2537315"><a href="/net/dnsclient.go.html#2526854">DNSError</a></span><span class="op" id="2537323">)</span><span class="op" id="2537324">.</span><span class="ident" id="2537325">IsTimeout</span>&nbsp;<span class="op" id="2537335">=</span>&nbsp;<span class="ident" id="2537337">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2537346">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537352">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2537364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537369">cname</span><span class="op" id="2537374">,</span>&nbsp;<span class="ident" id="2537376">addrs</span><span class="op" id="2537381">,</span>&nbsp;<span class="ident" id="2537383"><a href="/net/dnsclient_unix.go.html#2537083">err</a></span>&nbsp;<span class="op" id="2537387">:=</span>&nbsp;<span class="ident" id="2537390"><a href="/net/dnsclient.go.html#2528333">answer</a></span><span class="op" id="2537396">(</span><span class="ident" id="2537397"><a href="/net/dnsclient_unix.go.html#2536648">name</a></span><span class="op" id="2537401">,</span>&nbsp;<span class="ident" id="2537403"><a href="/net/dnsclient_unix.go.html#2537006">server</a></span><span class="op" id="2537409">,</span>&nbsp;<span class="ident" id="2537411"><a href="/net/dnsclient_unix.go.html#2537078">msg</a></span><span class="op" id="2537414">,</span>&nbsp;<span class="ident" id="2537416"><a href="/net/dnsclient_unix.go.html#2536661">qtype</a></span><span class="op" id="2537421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537426">if</span>&nbsp;<span class="ident" id="2537429"><a href="/net/dnsclient_unix.go.html#2537083">err</a></span>&nbsp;<span class="op" id="2537433">==</span>&nbsp;<span class="ident" id="2537436">nil</span>&nbsp;<span class="op" id="2537440">||</span>&nbsp;<span class="ident" id="2537443"><a href="/net/dnsclient_unix.go.html#2537083">err</a></span><span class="op" id="2537446">.</span><span class="op" id="2537447">(</span><span class="op" id="2537448">*</span><span class="ident" id="2537449"><a href="/net/dnsclient.go.html#2526854">DNSError</a></span><span class="op" id="2537457">)</span><span class="op" id="2537458">.</span><span class="ident" id="2537459">Err</span>&nbsp;<span class="op" id="2537463">==</span>&nbsp;<span class="ident" id="2537466"><a href="/net/dnsclient.go.html#2527309">noSuchHost</a></span>&nbsp;<span class="op" id="2537477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537483">return</span>&nbsp;<span class="ident" id="2537490"><a href="/net/dnsclient_unix.go.html#2537369">cname</a></span><span class="op" id="2537495">,</span>&nbsp;<span class="ident" id="2537497"><a href="/net/dnsclient_unix.go.html#2537376">addrs</a></span><span class="op" id="2537502">,</span>&nbsp;<span class="ident" id="2537504"><a href="/net/dnsclient_unix.go.html#2537083">err</a></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2537511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537516"><a href="/net/dnsclient_unix.go.html#2536946">lastErr</a></span>&nbsp;<span class="op" id="2537524">=</span>&nbsp;<span class="ident" id="2537526"><a href="/net/dnsclient_unix.go.html#2537083">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2537532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2537535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537538">return</span>&nbsp;<span class="string" id="2537545">&#34;&#34;</span><span class="op" id="2537547">,</span>&nbsp;<span class="ident" id="2537549">nil</span><span class="op" id="2537552">,</span>&nbsp;<span class="ident" id="2537554"><a href="/net/dnsclient_unix.go.html#2536946">lastErr</a></span><br>
<span class="lineno">195</span><span class="op" id="2537562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2537565">func</span>&nbsp;<span class="ident" id="2537570">convertRR_A</span><span class="op" id="2537581">(</span><span class="ident" id="2537582">records</span>&nbsp;<span class="op" id="2537590">[</span><span class="op" id="2537591">]</span><span class="ident" id="2537592"><a href="/net/dnsmsg.go.html#2549843">dnsRR</a></span><span class="op" id="2537597">)</span>&nbsp;<span class="op" id="2537599">[</span><span class="op" id="2537600">]</span><span class="ident" id="2537601"><a href="/net/ip.go.html#2604330">IP</a></span>&nbsp;<span class="op" id="2537604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537607">addrs</span>&nbsp;<span class="op" id="2537613">:=</span>&nbsp;<span class="builtinfunc" id="2537616">make</span><span class="op" id="2537620">(</span><span class="op" id="2537621">[</span><span class="op" id="2537622">]</span><span class="ident" id="2537623"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2537625">,</span>&nbsp;<span class="builtinfunc" id="2537627">len</span><span class="op" id="2537630">(</span><span class="ident" id="2537631"><a href="/net/dnsclient_unix.go.html#2537582">records</a></span><span class="op" id="2537638">)</span><span class="op" id="2537639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537642">for</span>&nbsp;<span class="ident" id="2537646">i</span><span class="op" id="2537647">,</span>&nbsp;<span class="ident" id="2537649">rr</span>&nbsp;<span class="op" id="2537652">:=</span>&nbsp;<span class="keyword" id="2537655">range</span>&nbsp;<span class="ident" id="2537661"><a href="/net/dnsclient_unix.go.html#2537582">records</a></span>&nbsp;<span class="op" id="2537669">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537673">a</span>&nbsp;<span class="op" id="2537675">:=</span>&nbsp;<span class="ident" id="2537678"><a href="/net/dnsclient_unix.go.html#2537649">rr</a></span><span class="op" id="2537680">.</span><span class="op" id="2537681">(</span><span class="op" id="2537682">*</span><span class="ident" id="2537683"><a href="/net/dnsmsg.go.html#2553903">dnsRR_A</a></span><span class="op" id="2537690">)</span><span class="op" id="2537691">.</span><span class="ident" id="2537692">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537696"><a href="/net/dnsclient_unix.go.html#2537607">addrs</a></span><span class="op" id="2537701">[</span><span class="ident" id="2537702"><a href="/net/dnsclient_unix.go.html#2537646">i</a></span><span class="op" id="2537703">]</span>&nbsp;<span class="op" id="2537705">=</span>&nbsp;<span class="ident" id="2537707"><a href="/net/ip.go.html#2604600">IPv4</a></span><span class="op" id="2537711">(</span><span class="builtintype" id="2537712">byte</span><span class="op" id="2537716">(</span><span class="ident" id="2537717"><a href="/net/dnsclient_unix.go.html#2537673">a</a></span><span class="op" id="2537718">&gt;&gt;</span><span class="num" id="2537720">24</span><span class="op" id="2537722">)</span><span class="op" id="2537723">,</span>&nbsp;<span class="builtintype" id="2537725">byte</span><span class="op" id="2537729">(</span><span class="ident" id="2537730"><a href="/net/dnsclient_unix.go.html#2537673">a</a></span><span class="op" id="2537731">&gt;&gt;</span><span class="num" id="2537733">16</span><span class="op" id="2537735">)</span><span class="op" id="2537736">,</span>&nbsp;<span class="builtintype" id="2537738">byte</span><span class="op" id="2537742">(</span><span class="ident" id="2537743"><a href="/net/dnsclient_unix.go.html#2537673">a</a></span><span class="op" id="2537744">&gt;&gt;</span><span class="num" id="2537746">8</span><span class="op" id="2537747">)</span><span class="op" id="2537748">,</span>&nbsp;<span class="builtintype" id="2537750">byte</span><span class="op" id="2537754">(</span><span class="ident" id="2537755"><a href="/net/dnsclient_unix.go.html#2537673">a</a></span><span class="op" id="2537756">)</span><span class="op" id="2537757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2537760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537763">return</span>&nbsp;<span class="ident" id="2537770"><a href="/net/dnsclient_unix.go.html#2537607">addrs</a></span><br>
<span class="lineno"></span><span class="op" id="2537776">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="keyword" id="2537779">func</span>&nbsp;<span class="ident" id="2537784">convertRR_AAAA</span><span class="op" id="2537798">(</span><span class="ident" id="2537799">records</span>&nbsp;<span class="op" id="2537807">[</span><span class="op" id="2537808">]</span><span class="ident" id="2537809"><a href="/net/dnsmsg.go.html#2549843">dnsRR</a></span><span class="op" id="2537814">)</span>&nbsp;<span class="op" id="2537816">[</span><span class="op" id="2537817">]</span><span class="ident" id="2537818"><a href="/net/ip.go.html#2604330">IP</a></span>&nbsp;<span class="op" id="2537821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537824">addrs</span>&nbsp;<span class="op" id="2537830">:=</span>&nbsp;<span class="builtinfunc" id="2537833">make</span><span class="op" id="2537837">(</span><span class="op" id="2537838">[</span><span class="op" id="2537839">]</span><span class="ident" id="2537840"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2537842">,</span>&nbsp;<span class="builtinfunc" id="2537844">len</span><span class="op" id="2537847">(</span><span class="ident" id="2537848"><a href="/net/dnsclient_unix.go.html#2537799">records</a></span><span class="op" id="2537855">)</span><span class="op" id="2537856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537859">for</span>&nbsp;<span class="ident" id="2537863">i</span><span class="op" id="2537864">,</span>&nbsp;<span class="ident" id="2537866">rr</span>&nbsp;<span class="op" id="2537869">:=</span>&nbsp;<span class="keyword" id="2537872">range</span>&nbsp;<span class="ident" id="2537878"><a href="/net/dnsclient_unix.go.html#2537799">records</a></span>&nbsp;<span class="op" id="2537886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537890">a</span>&nbsp;<span class="op" id="2537892">:=</span>&nbsp;<span class="builtinfunc" id="2537895">make</span><span class="op" id="2537899">(</span><span class="ident" id="2537900"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2537902">,</span>&nbsp;<span class="ident" id="2537904"><a href="/net/ip.go.html#2603923">IPv6len</a></span><span class="op" id="2537911">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2537915">copy</span><span class="op" id="2537919">(</span><span class="ident" id="2537920"><a href="/net/dnsclient_unix.go.html#2537890">a</a></span><span class="op" id="2537921">,</span>&nbsp;<span class="ident" id="2537923"><a href="/net/dnsclient_unix.go.html#2537866">rr</a></span><span class="op" id="2537925">.</span><span class="op" id="2537926">(</span><span class="op" id="2537927">*</span><span class="ident" id="2537928"><a href="/net/dnsmsg.go.html#2554162">dnsRR_AAAA</a></span><span class="op" id="2537938">)</span><span class="op" id="2537939">.</span><span class="ident" id="2537940">AAAA</span><span class="op" id="2537944">[</span><span class="op" id="2537945">:</span><span class="op" id="2537946">]</span><span class="op" id="2537947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537951"><a href="/net/dnsclient_unix.go.html#2537824">addrs</a></span><span class="op" id="2537956">[</span><span class="ident" id="2537957"><a href="/net/dnsclient_unix.go.html#2537863">i</a></span><span class="op" id="2537958">]</span>&nbsp;<span class="op" id="2537960">=</span>&nbsp;<span class="ident" id="2537962"><a href="/net/dnsclient_unix.go.html#2537890">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2537965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537968">return</span>&nbsp;<span class="ident" id="2537975"><a href="/net/dnsclient_unix.go.html#2537824">addrs</a></span><br>
<span class="lineno"></span><span class="op" id="2537981">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="2537984">var</span>&nbsp;<span class="ident" id="2537988">cfg</span>&nbsp;<span class="keyword" id="2537992">struct</span>&nbsp;<span class="op" id="2537999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538002">ch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2538012">chan</span>&nbsp;<span class="keyword" id="2538017">struct</span><span class="op" id="2538023">{</span><span class="op" id="2538024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538027">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2538037"><a href="/net/dnsclient_unix.go.html#2533194">sync</a></span><span class="op" id="2538041">.</span><span class="ident" id="2538042">RWMutex</span>&nbsp;<span class="comment" id="2538050">//&nbsp;protects&nbsp;dnsConfig&nbsp;and&nbsp;dnserr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538084">dnsConfig</span>&nbsp;<span class="op" id="2538094">*</span><span class="ident" id="2538095"><a href="/net/dnsconfig_unix.go.html#2543590">dnsConfig</a></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538106">dnserr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2538116">error</span><br>
<span class="lineno"></span><span class="op" id="2538122">}</span><br>
<span class="lineno"></span><span class="keyword" id="2538124">var</span>&nbsp;<span class="ident" id="2538128">onceLoadConfig</span>&nbsp;<span class="ident" id="2538143"><a href="/net/dnsclient_unix.go.html#2533194">sync</a></span><span class="op" id="2538147">.</span><span class="ident" id="2538148">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2538154">//&nbsp;Assume&nbsp;dns&nbsp;config&nbsp;file&nbsp;is&nbsp;/etc/resolv.conf&nbsp;here</span><br>
<span class="lineno">225</span><span class="keyword" id="2538205">func</span>&nbsp;<span class="ident" id="2538210">loadDefaultConfig</span><span class="op" id="2538227">(</span><span class="op" id="2538228">)</span>&nbsp;<span class="op" id="2538230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538233"><a href="/net/dnsclient_unix.go.html#2538292">loadConfig</a></span><span class="op" id="2538243">(</span><span class="string" id="2538244">&#34;/etc/resolv.conf&#34;</span><span class="op" id="2538262">,</span>&nbsp;<span class="num" id="2538264">5</span><span class="op" id="2538265">*</span><span class="ident" id="2538266"><a href="/net/dnsclient_unix.go.html#2533202">time</a></span><span class="op" id="2538270">.</span><span class="ident" id="2538271">Second</span><span class="op" id="2538277">,</span>&nbsp;<span class="ident" id="2538279">nil</span><span class="op" id="2538282">)</span><br>
<span class="lineno"></span><span class="op" id="2538284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2538287">func</span>&nbsp;<span class="ident" id="2538292">loadConfig</span><span class="op" id="2538302">(</span><span class="ident" id="2538303">resolvConfPath</span>&nbsp;<span class="builtintype" id="2538318">string</span><span class="op" id="2538324">,</span>&nbsp;<span class="ident" id="2538326">reloadTime</span>&nbsp;<span class="ident" id="2538337"><a href="/net/dnsclient_unix.go.html#2533202">time</a></span><span class="op" id="2538341">.</span><span class="ident" id="2538342">Duration</span><span class="op" id="2538350">,</span>&nbsp;<span class="ident" id="2538352">quit</span>&nbsp;<span class="op" id="2538357">&lt;-</span><span class="keyword" id="2538359">chan</span>&nbsp;<span class="keyword" id="2538364">chan</span>&nbsp;<span class="keyword" id="2538369">struct</span><span class="op" id="2538375">{</span><span class="op" id="2538376">}</span><span class="op" id="2538377">)</span>&nbsp;<span class="op" id="2538379">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538382">var</span>&nbsp;<span class="ident" id="2538386">mtime</span>&nbsp;<span class="ident" id="2538392"><a href="/net/dnsclient_unix.go.html#2533202">time</a></span><span class="op" id="2538396">.</span><span class="ident" id="2538397">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538403"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2538406">.</span><span class="ident" id="2538407">ch</span>&nbsp;<span class="op" id="2538410">=</span>&nbsp;<span class="builtinfunc" id="2538412">make</span><span class="op" id="2538416">(</span><span class="keyword" id="2538417">chan</span>&nbsp;<span class="keyword" id="2538422">struct</span><span class="op" id="2538428">{</span><span class="op" id="2538429">}</span><span class="op" id="2538430">,</span>&nbsp;<span class="num" id="2538432">1</span><span class="op" id="2538433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538436">if</span>&nbsp;<span class="ident" id="2538439">fi</span><span class="op" id="2538441">,</span>&nbsp;<span class="ident" id="2538443">err</span>&nbsp;<span class="op" id="2538447">:=</span>&nbsp;<span class="ident" id="2538450"><a href="/net/dnsclient_unix.go.html#2533188">os</a></span><span class="op" id="2538452">.</span><span class="ident" id="2538453">Stat</span><span class="op" id="2538457">(</span><span class="ident" id="2538458"><a href="/net/dnsclient_unix.go.html#2538303">resolvConfPath</a></span><span class="op" id="2538472">)</span><span class="op" id="2538473">;</span>&nbsp;<span class="ident" id="2538475"><a href="/net/dnsclient_unix.go.html#2538443">err</a></span>&nbsp;<span class="op" id="2538479">!=</span>&nbsp;<span class="ident" id="2538482">nil</span>&nbsp;<span class="op" id="2538486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538490"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2538493">.</span><span class="ident" id="2538494">dnserr</span>&nbsp;<span class="op" id="2538501">=</span>&nbsp;<span class="ident" id="2538503"><a href="/net/dnsclient_unix.go.html#2538443">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2538508">}</span>&nbsp;<span class="keyword" id="2538510">else</span>&nbsp;<span class="op" id="2538515">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538519"><a href="/net/dnsclient_unix.go.html#2538386">mtime</a></span>&nbsp;<span class="op" id="2538525">=</span>&nbsp;<span class="ident" id="2538527"><a href="/net/dnsclient_unix.go.html#2538439">fi</a></span><span class="op" id="2538529">.</span><span class="ident" id="2538530">ModTime</span><span class="op" id="2538537">(</span><span class="op" id="2538538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538542"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2538545">.</span><span class="ident" id="2538546">dnsConfig</span><span class="op" id="2538555">,</span>&nbsp;<span class="ident" id="2538557"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2538560">.</span><span class="ident" id="2538561">dnserr</span>&nbsp;<span class="op" id="2538568">=</span>&nbsp;<span class="ident" id="2538570"><a href="/net/dnsconfig_unix.go.html#2544106">dnsReadConfig</a></span><span class="op" id="2538583">(</span><span class="ident" id="2538584"><a href="/net/dnsclient_unix.go.html#2538303">resolvConfPath</a></span><span class="op" id="2538598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2538601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538604">go</span>&nbsp;<span class="keyword" id="2538607">func</span><span class="op" id="2538611">(</span><span class="op" id="2538612">)</span>&nbsp;<span class="op" id="2538614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538618">for</span>&nbsp;<span class="op" id="2538622">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538627"><a href="/net/dnsclient_unix.go.html#2533202">time</a></span><span class="op" id="2538631">.</span><span class="ident" id="2538632">Sleep</span><span class="op" id="2538637">(</span><span class="ident" id="2538638"><a href="/net/dnsclient_unix.go.html#2538326">reloadTime</a></span><span class="op" id="2538648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538653">select</span>&nbsp;<span class="op" id="2538660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538665">case</span>&nbsp;<span class="ident" id="2538670">qresp</span>&nbsp;<span class="op" id="2538676">:=</span>&nbsp;<span class="op" id="2538679">&lt;-</span><span class="ident" id="2538681"><a href="/net/dnsclient_unix.go.html#2538352">quit</a></span><span class="op" id="2538685">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538691"><a href="/net/dnsclient_unix.go.html#2538670">qresp</a></span>&nbsp;<span class="op" id="2538697">&lt;-</span>&nbsp;<span class="keyword" id="2538700">struct</span><span class="op" id="2538706">{</span><span class="op" id="2538707">}</span><span class="op" id="2538708">{</span><span class="op" id="2538709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538715">return</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538725">case</span>&nbsp;<span class="op" id="2538730">&lt;-</span><span class="ident" id="2538732"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2538735">.</span><span class="ident" id="2538736">ch</span><span class="op" id="2538738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2538743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2538749">//&nbsp;In&nbsp;case&nbsp;of&nbsp;error,&nbsp;we&nbsp;keep&nbsp;the&nbsp;previous&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538801">fi</span><span class="op" id="2538803">,</span>&nbsp;<span class="ident" id="2538805">err</span>&nbsp;<span class="op" id="2538809">:=</span>&nbsp;<span class="ident" id="2538812"><a href="/net/dnsclient_unix.go.html#2533188">os</a></span><span class="op" id="2538814">.</span><span class="ident" id="2538815">Stat</span><span class="op" id="2538819">(</span><span class="ident" id="2538820"><a href="/net/dnsclient_unix.go.html#2538303">resolvConfPath</a></span><span class="op" id="2538834">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538839">if</span>&nbsp;<span class="ident" id="2538842"><a href="/net/dnsclient_unix.go.html#2538805">err</a></span>&nbsp;<span class="op" id="2538846">!=</span>&nbsp;<span class="ident" id="2538849">nil</span>&nbsp;<span class="op" id="2538853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538859">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2538871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2538876">//&nbsp;If&nbsp;the&nbsp;resolv.conf&nbsp;mtime&nbsp;didn&#39;t&nbsp;change,&nbsp;do&nbsp;not&nbsp;reload</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538936">m</span>&nbsp;<span class="op" id="2538938">:=</span>&nbsp;<span class="ident" id="2538941"><a href="/net/dnsclient_unix.go.html#2538801">fi</a></span><span class="op" id="2538943">.</span><span class="ident" id="2538944">ModTime</span><span class="op" id="2538951">(</span><span class="op" id="2538952">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538957">if</span>&nbsp;<span class="ident" id="2538960"><a href="/net/dnsclient_unix.go.html#2538936">m</a></span><span class="op" id="2538961">.</span><span class="ident" id="2538962">Equal</span><span class="op" id="2538967">(</span><span class="ident" id="2538968"><a href="/net/dnsclient_unix.go.html#2538386">mtime</a></span><span class="op" id="2538973">)</span>&nbsp;<span class="op" id="2538975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538981">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2538993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538998"><a href="/net/dnsclient_unix.go.html#2538386">mtime</a></span>&nbsp;<span class="op" id="2539004">=</span>&nbsp;<span class="ident" id="2539006"><a href="/net/dnsclient_unix.go.html#2538936">m</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2539011">//&nbsp;In&nbsp;case&nbsp;of&nbsp;error,&nbsp;we&nbsp;keep&nbsp;the&nbsp;previous&nbsp;config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539063">ncfg</span><span class="op" id="2539067">,</span>&nbsp;<span class="ident" id="2539069"><a href="/net/dnsclient_unix.go.html#2538805">err</a></span>&nbsp;<span class="op" id="2539073">:=</span>&nbsp;<span class="ident" id="2539076"><a href="/net/dnsconfig_unix.go.html#2544106">dnsReadConfig</a></span><span class="op" id="2539089">(</span><span class="ident" id="2539090"><a href="/net/dnsclient_unix.go.html#2538303">resolvConfPath</a></span><span class="op" id="2539104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539109">if</span>&nbsp;<span class="ident" id="2539112"><a href="/net/dnsclient_unix.go.html#2538805">err</a></span>&nbsp;<span class="op" id="2539116">!=</span>&nbsp;<span class="ident" id="2539119">nil</span>&nbsp;<span class="op" id="2539123">||</span>&nbsp;<span class="builtinfunc" id="2539126">len</span><span class="op" id="2539129">(</span><span class="ident" id="2539130"><a href="/net/dnsclient_unix.go.html#2539063">ncfg</a></span><span class="op" id="2539134">.</span><span class="ident" id="2539135">servers</span><span class="op" id="2539142">)</span>&nbsp;<span class="op" id="2539144">==</span>&nbsp;<span class="num" id="2539147">0</span>&nbsp;<span class="op" id="2539149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539155">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2539167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539172"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2539175">.</span><span class="ident" id="2539176">mu</span><span class="op" id="2539178">.</span><span class="ident" id="2539179">Lock</span><span class="op" id="2539183">(</span><span class="op" id="2539184">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539189"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2539192">.</span><span class="ident" id="2539193">dnsConfig</span>&nbsp;<span class="op" id="2539203">=</span>&nbsp;<span class="ident" id="2539205"><a href="/net/dnsclient_unix.go.html#2539063">ncfg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539213"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2539216">.</span><span class="ident" id="2539217">dnserr</span>&nbsp;<span class="op" id="2539224">=</span>&nbsp;<span class="ident" id="2539226">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539233"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2539236">.</span><span class="ident" id="2539237">mu</span><span class="op" id="2539239">.</span><span class="ident" id="2539240">Unlock</span><span class="op" id="2539246">(</span><span class="op" id="2539247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2539251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2539254">}</span><span class="op" id="2539255">(</span><span class="op" id="2539256">)</span><br>
<span class="lineno">270</span><span class="op" id="2539258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2539261">func</span>&nbsp;<span class="ident" id="2539266">lookup</span><span class="op" id="2539272">(</span><span class="ident" id="2539273">name</span>&nbsp;<span class="builtintype" id="2539278">string</span><span class="op" id="2539284">,</span>&nbsp;<span class="ident" id="2539286">qtype</span>&nbsp;<span class="builtintype" id="2539292">uint16</span><span class="op" id="2539298">)</span>&nbsp;<span class="op" id="2539300">(</span><span class="ident" id="2539301">cname</span>&nbsp;<span class="builtintype" id="2539307">string</span><span class="op" id="2539313">,</span>&nbsp;<span class="ident" id="2539315">addrs</span>&nbsp;<span class="op" id="2539321">[</span><span class="op" id="2539322">]</span><span class="ident" id="2539323"><a href="/net/dnsmsg.go.html#2549843">dnsRR</a></span><span class="op" id="2539328">,</span>&nbsp;<span class="ident" id="2539330">err</span>&nbsp;<span class="builtintype" id="2539334">error</span><span class="op" id="2539339">)</span>&nbsp;<span class="op" id="2539341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539344">if</span>&nbsp;<span class="op" id="2539347">!</span><span class="ident" id="2539348"><a href="/net/dnsclient.go.html#2529939">isDomainName</a></span><span class="op" id="2539360">(</span><span class="ident" id="2539361"><a href="/net/dnsclient_unix.go.html#2539273">name</a></span><span class="op" id="2539365">)</span>&nbsp;<span class="op" id="2539367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539371">return</span>&nbsp;<span class="ident" id="2539378"><a href="/net/dnsclient_unix.go.html#2539273">name</a></span><span class="op" id="2539382">,</span>&nbsp;<span class="ident" id="2539384">nil</span><span class="op" id="2539387">,</span>&nbsp;<span class="op" id="2539389">&amp;</span><span class="ident" id="2539390"><a href="/net/dnsclient.go.html#2526854">DNSError</a></span><span class="op" id="2539398">{</span><span class="ident" id="2539399">Err</span><span class="op" id="2539402">:</span>&nbsp;<span class="string" id="2539404">&#34;invalid&nbsp;domain&nbsp;name&#34;</span><span class="op" id="2539425">,</span>&nbsp;<span class="ident" id="2539427">Name</span><span class="op" id="2539431">:</span>&nbsp;<span class="ident" id="2539433"><a href="/net/dnsclient_unix.go.html#2539273">name</a></span><span class="op" id="2539437">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2539440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539443"><a href="/net/dnsclient_unix.go.html#2538128">onceLoadConfig</a></span><span class="op" id="2539457">.</span><span class="ident" id="2539458">Do</span><span class="op" id="2539460">(</span><span class="ident" id="2539461"><a href="/net/dnsclient_unix.go.html#2538210">loadDefaultConfig</a></span><span class="op" id="2539478">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539482">select</span>&nbsp;<span class="op" id="2539489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539492">case</span>&nbsp;<span class="ident" id="2539497"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2539500">.</span><span class="ident" id="2539501">ch</span>&nbsp;<span class="op" id="2539504">&lt;-</span>&nbsp;<span class="keyword" id="2539507">struct</span><span class="op" id="2539513">{</span><span class="op" id="2539514">}</span><span class="op" id="2539515">{</span><span class="op" id="2539516">}</span><span class="op" id="2539517">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539520">default</span><span class="op" id="2539527">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2539530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539534"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2539537">.</span><span class="ident" id="2539538">mu</span><span class="op" id="2539540">.</span><span class="ident" id="2539541">RLock</span><span class="op" id="2539546">(</span><span class="op" id="2539547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539550">defer</span>&nbsp;<span class="ident" id="2539556"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2539559">.</span><span class="ident" id="2539560">mu</span><span class="op" id="2539562">.</span><span class="ident" id="2539563">RUnlock</span><span class="op" id="2539570">(</span><span class="op" id="2539571">)</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539575">if</span>&nbsp;<span class="ident" id="2539578"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2539581">.</span><span class="ident" id="2539582">dnserr</span>&nbsp;<span class="op" id="2539589">!=</span>&nbsp;<span class="ident" id="2539592">nil</span>&nbsp;<span class="op" id="2539596">||</span>&nbsp;<span class="ident" id="2539599"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2539602">.</span><span class="ident" id="2539603">dnsConfig</span>&nbsp;<span class="op" id="2539613">==</span>&nbsp;<span class="ident" id="2539616">nil</span>&nbsp;<span class="op" id="2539620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539624"><a href="/net/dnsclient_unix.go.html#2539330">err</a></span>&nbsp;<span class="op" id="2539628">=</span>&nbsp;<span class="ident" id="2539630"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2539633">.</span><span class="ident" id="2539634">dnserr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539643">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2539651">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2539654">//&nbsp;If&nbsp;name&nbsp;is&nbsp;rooted&nbsp;(trailing&nbsp;dot)&nbsp;or&nbsp;has&nbsp;enough&nbsp;dots,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2539711">//&nbsp;try&nbsp;it&nbsp;by&nbsp;itself&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539739">rooted</span>&nbsp;<span class="op" id="2539746">:=</span>&nbsp;<span class="builtinfunc" id="2539749">len</span><span class="op" id="2539752">(</span><span class="ident" id="2539753"><a href="/net/dnsclient_unix.go.html#2539273">name</a></span><span class="op" id="2539757">)</span>&nbsp;<span class="op" id="2539759">&gt;</span>&nbsp;<span class="num" id="2539761">0</span>&nbsp;<span class="op" id="2539763">&amp;&amp;</span>&nbsp;<span class="ident" id="2539766"><a href="/net/dnsclient_unix.go.html#2539273">name</a></span><span class="op" id="2539770">[</span><span class="builtinfunc" id="2539771">len</span><span class="op" id="2539774">(</span><span class="ident" id="2539775"><a href="/net/dnsclient_unix.go.html#2539273">name</a></span><span class="op" id="2539779">)</span><span class="op" id="2539780">-</span><span class="num" id="2539781">1</span><span class="op" id="2539782">]</span>&nbsp;<span class="op" id="2539784">==</span>&nbsp;<span class="string" id="2539787">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539792">if</span>&nbsp;<span class="ident" id="2539795"><a href="/net/dnsclient_unix.go.html#2539739">rooted</a></span>&nbsp;<span class="op" id="2539802">||</span>&nbsp;<span class="ident" id="2539805"><a href="/net/parse.go.html#2667037">count</a></span><span class="op" id="2539810">(</span><span class="ident" id="2539811"><a href="/net/dnsclient_unix.go.html#2539273">name</a></span><span class="op" id="2539815">,</span>&nbsp;<span class="string" id="2539817">&#39;.&#39;</span><span class="op" id="2539820">)</span>&nbsp;<span class="op" id="2539822">&gt;=</span>&nbsp;<span class="ident" id="2539825"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2539828">.</span><span class="ident" id="2539829">dnsConfig</span><span class="op" id="2539838">.</span><span class="ident" id="2539839">ndots</span>&nbsp;<span class="op" id="2539845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539849">rname</span>&nbsp;<span class="op" id="2539855">:=</span>&nbsp;<span class="ident" id="2539858"><a href="/net/dnsclient_unix.go.html#2539273">name</a></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539865">if</span>&nbsp;<span class="op" id="2539868">!</span><span class="ident" id="2539869"><a href="/net/dnsclient_unix.go.html#2539739">rooted</a></span>&nbsp;<span class="op" id="2539876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539881"><a href="/net/dnsclient_unix.go.html#2539849">rname</a></span>&nbsp;<span class="op" id="2539887">+=</span>&nbsp;<span class="string" id="2539890">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2539896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2539900">//&nbsp;Can&nbsp;try&nbsp;as&nbsp;ordinary&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539931"><a href="/net/dnsclient_unix.go.html#2539301">cname</a></span><span class="op" id="2539936">,</span>&nbsp;<span class="ident" id="2539938"><a href="/net/dnsclient_unix.go.html#2539315">addrs</a></span><span class="op" id="2539943">,</span>&nbsp;<span class="ident" id="2539945"><a href="/net/dnsclient_unix.go.html#2539330">err</a></span>&nbsp;<span class="op" id="2539949">=</span>&nbsp;<span class="ident" id="2539951"><a href="/net/dnsclient_unix.go.html#2536621">tryOneName</a></span><span class="op" id="2539961">(</span><span class="ident" id="2539962"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2539965">.</span><span class="ident" id="2539966">dnsConfig</span><span class="op" id="2539975">,</span>&nbsp;<span class="ident" id="2539977"><a href="/net/dnsclient_unix.go.html#2539849">rname</a></span><span class="op" id="2539982">,</span>&nbsp;<span class="ident" id="2539984"><a href="/net/dnsclient_unix.go.html#2539286">qtype</a></span><span class="op" id="2539989">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539993">if</span>&nbsp;<span class="ident" id="2539996"><a href="/net/dnsclient_unix.go.html#2539739">rooted</a></span>&nbsp;<span class="op" id="2540003">||</span>&nbsp;<span class="ident" id="2540006"><a href="/net/dnsclient_unix.go.html#2539330">err</a></span>&nbsp;<span class="op" id="2540010">==</span>&nbsp;<span class="ident" id="2540013">nil</span>&nbsp;<span class="op" id="2540017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2540022">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2540031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2540034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2540038">//&nbsp;Otherwise,&nbsp;try&nbsp;suffixes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2540067">for</span>&nbsp;<span class="ident" id="2540071">i</span>&nbsp;<span class="op" id="2540073">:=</span>&nbsp;<span class="num" id="2540076">0</span><span class="op" id="2540077">;</span>&nbsp;<span class="ident" id="2540079"><a href="/net/dnsclient_unix.go.html#2540071">i</a></span>&nbsp;<span class="op" id="2540081">&lt;</span>&nbsp;<span class="builtinfunc" id="2540083">len</span><span class="op" id="2540086">(</span><span class="ident" id="2540087"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2540090">.</span><span class="ident" id="2540091">dnsConfig</span><span class="op" id="2540100">.</span><span class="ident" id="2540101">search</span><span class="op" id="2540107">)</span><span class="op" id="2540108">;</span>&nbsp;<span class="ident" id="2540110"><a href="/net/dnsclient_unix.go.html#2540071">i</a></span><span class="op" id="2540111">++</span>&nbsp;<span class="op" id="2540114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2540118">rname</span>&nbsp;<span class="op" id="2540124">:=</span>&nbsp;<span class="ident" id="2540127"><a href="/net/dnsclient_unix.go.html#2539273">name</a></span>&nbsp;<span class="op" id="2540132">+</span>&nbsp;<span class="string" id="2540134">&#34;.&#34;</span>&nbsp;<span class="op" id="2540138">+</span>&nbsp;<span class="ident" id="2540140"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2540143">.</span><span class="ident" id="2540144">dnsConfig</span><span class="op" id="2540153">.</span><span class="ident" id="2540154">search</span><span class="op" id="2540160">[</span><span class="ident" id="2540161"><a href="/net/dnsclient_unix.go.html#2540071">i</a></span><span class="op" id="2540162">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2540166">if</span>&nbsp;<span class="ident" id="2540169"><a href="/net/dnsclient_unix.go.html#2540118">rname</a></span><span class="op" id="2540174">[</span><span class="builtinfunc" id="2540175">len</span><span class="op" id="2540178">(</span><span class="ident" id="2540179"><a href="/net/dnsclient_unix.go.html#2540118">rname</a></span><span class="op" id="2540184">)</span><span class="op" id="2540185">-</span><span class="num" id="2540186">1</span><span class="op" id="2540187">]</span>&nbsp;<span class="op" id="2540189">!=</span>&nbsp;<span class="string" id="2540192">&#39;.&#39;</span>&nbsp;<span class="op" id="2540196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2540201"><a href="/net/dnsclient_unix.go.html#2540118">rname</a></span>&nbsp;<span class="op" id="2540207">+=</span>&nbsp;<span class="string" id="2540210">&#34;.&#34;</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2540216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2540220"><a href="/net/dnsclient_unix.go.html#2539301">cname</a></span><span class="op" id="2540225">,</span>&nbsp;<span class="ident" id="2540227"><a href="/net/dnsclient_unix.go.html#2539315">addrs</a></span><span class="op" id="2540232">,</span>&nbsp;<span class="ident" id="2540234"><a href="/net/dnsclient_unix.go.html#2539330">err</a></span>&nbsp;<span class="op" id="2540238">=</span>&nbsp;<span class="ident" id="2540240"><a href="/net/dnsclient_unix.go.html#2536621">tryOneName</a></span><span class="op" id="2540250">(</span><span class="ident" id="2540251"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2540254">.</span><span class="ident" id="2540255">dnsConfig</span><span class="op" id="2540264">,</span>&nbsp;<span class="ident" id="2540266"><a href="/net/dnsclient_unix.go.html#2540118">rname</a></span><span class="op" id="2540271">,</span>&nbsp;<span class="ident" id="2540273"><a href="/net/dnsclient_unix.go.html#2539286">qtype</a></span><span class="op" id="2540278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2540282">if</span>&nbsp;<span class="ident" id="2540285"><a href="/net/dnsclient_unix.go.html#2539330">err</a></span>&nbsp;<span class="op" id="2540289">==</span>&nbsp;<span class="ident" id="2540292">nil</span>&nbsp;<span class="op" id="2540296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2540301">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2540310">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2540313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2540317">//&nbsp;Last&nbsp;ditch&nbsp;effort:&nbsp;try&nbsp;unsuffixed&nbsp;only&nbsp;if&nbsp;we&nbsp;haven&#39;t&nbsp;already,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2540383">//&nbsp;that&nbsp;is,&nbsp;name&nbsp;is&nbsp;not&nbsp;rooted&nbsp;and&nbsp;has&nbsp;less&nbsp;than&nbsp;ndots&nbsp;dots.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2540445">if</span>&nbsp;<span class="ident" id="2540448"><a href="/net/parse.go.html#2667037">count</a></span><span class="op" id="2540453">(</span><span class="ident" id="2540454"><a href="/net/dnsclient_unix.go.html#2539273">name</a></span><span class="op" id="2540458">,</span>&nbsp;<span class="string" id="2540460">&#39;.&#39;</span><span class="op" id="2540463">)</span>&nbsp;<span class="op" id="2540465">&lt;</span>&nbsp;<span class="ident" id="2540467"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2540470">.</span><span class="ident" id="2540471">dnsConfig</span><span class="op" id="2540480">.</span><span class="ident" id="2540481">ndots</span>&nbsp;<span class="op" id="2540487">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2540491"><a href="/net/dnsclient_unix.go.html#2539301">cname</a></span><span class="op" id="2540496">,</span>&nbsp;<span class="ident" id="2540498"><a href="/net/dnsclient_unix.go.html#2539315">addrs</a></span><span class="op" id="2540503">,</span>&nbsp;<span class="ident" id="2540505"><a href="/net/dnsclient_unix.go.html#2539330">err</a></span>&nbsp;<span class="op" id="2540509">=</span>&nbsp;<span class="ident" id="2540511"><a href="/net/dnsclient_unix.go.html#2536621">tryOneName</a></span><span class="op" id="2540521">(</span><span class="ident" id="2540522"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="2540525">.</span><span class="ident" id="2540526">dnsConfig</span><span class="op" id="2540535">,</span>&nbsp;<span class="ident" id="2540537"><a href="/net/dnsclient_unix.go.html#2539273">name</a></span><span class="op" id="2540541">+</span><span class="string" id="2540542">&#34;.&#34;</span><span class="op" id="2540545">,</span>&nbsp;<span class="ident" id="2540547"><a href="/net/dnsclient_unix.go.html#2539286">qtype</a></span><span class="op" id="2540552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2540556">if</span>&nbsp;<span class="ident" id="2540559"><a href="/net/dnsclient_unix.go.html#2539330">err</a></span>&nbsp;<span class="op" id="2540563">==</span>&nbsp;<span class="ident" id="2540566">nil</span>&nbsp;<span class="op" id="2540570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2540575">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2540584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2540587">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2540591">if</span>&nbsp;<span class="ident" id="2540594">e</span><span class="op" id="2540595">,</span>&nbsp;<span class="ident" id="2540597">ok</span>&nbsp;<span class="op" id="2540600">:=</span>&nbsp;<span class="ident" id="2540603"><a href="/net/dnsclient_unix.go.html#2539330">err</a></span><span class="op" id="2540606">.</span><span class="op" id="2540607">(</span><span class="op" id="2540608">*</span><span class="ident" id="2540609"><a href="/net/dnsclient.go.html#2526854">DNSError</a></span><span class="op" id="2540617">)</span><span class="op" id="2540618">;</span>&nbsp;<span class="ident" id="2540620"><a href="/net/dnsclient_unix.go.html#2540597">ok</a></span>&nbsp;<span class="op" id="2540623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2540627">//&nbsp;Show&nbsp;original&nbsp;name&nbsp;passed&nbsp;to&nbsp;lookup,&nbsp;not&nbsp;suffixed&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2540687">//&nbsp;In&nbsp;general&nbsp;we&nbsp;might&nbsp;have&nbsp;tried&nbsp;many&nbsp;suffixes;&nbsp;showing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2540746">//&nbsp;just&nbsp;one&nbsp;is&nbsp;misleading.&nbsp;See&nbsp;also&nbsp;golang.org/issue/6324.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2540807"><a href="/net/dnsclient_unix.go.html#2540594">e</a></span><span class="op" id="2540808">.</span><span class="ident" id="2540809">Name</span>&nbsp;<span class="op" id="2540814">=</span>&nbsp;<span class="ident" id="2540816"><a href="/net/dnsclient_unix.go.html#2539273">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2540822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2540825">return</span><br>
<span class="lineno"></span><span class="op" id="2540832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="2540835">//&nbsp;goLookupHost&nbsp;is&nbsp;the&nbsp;native&nbsp;Go&nbsp;implementation&nbsp;of&nbsp;LookupHost.</span><br>
<span class="lineno"></span><span class="comment" id="2540898">//&nbsp;Used&nbsp;only&nbsp;if&nbsp;cgoLookupHost&nbsp;refuses&nbsp;to&nbsp;handle&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="2540958">//&nbsp;(that&nbsp;is,&nbsp;only&nbsp;if&nbsp;cgoLookupHost&nbsp;is&nbsp;the&nbsp;stub&nbsp;in&nbsp;cgo_stub.go).</span><br>
<span class="lineno"></span><span class="comment" id="2541022">//&nbsp;Normally&nbsp;we&nbsp;let&nbsp;cgo&nbsp;use&nbsp;the&nbsp;C&nbsp;library&nbsp;resolver&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2541083">//&nbsp;depending&nbsp;on&nbsp;our&nbsp;lookup&nbsp;code,&nbsp;so&nbsp;that&nbsp;Go&nbsp;and&nbsp;C&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno">340</span><span class="comment" id="2541146">//&nbsp;answers.</span><br>
<span class="lineno"></span><span class="keyword" id="2541158">func</span>&nbsp;<span class="ident" id="2541163">goLookupHost</span><span class="op" id="2541175">(</span><span class="ident" id="2541176">name</span>&nbsp;<span class="builtintype" id="2541181">string</span><span class="op" id="2541187">)</span>&nbsp;<span class="op" id="2541189">(</span><span class="ident" id="2541190">addrs</span>&nbsp;<span class="op" id="2541196">[</span><span class="op" id="2541197">]</span><span class="builtintype" id="2541198">string</span><span class="op" id="2541204">,</span>&nbsp;<span class="ident" id="2541206">err</span>&nbsp;<span class="builtintype" id="2541210">error</span><span class="op" id="2541215">)</span>&nbsp;<span class="op" id="2541217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2541220">//&nbsp;Use&nbsp;entries&nbsp;from&nbsp;/etc/hosts&nbsp;if&nbsp;they&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2541267"><a href="/net/dnsclient_unix.go.html#2541190">addrs</a></span>&nbsp;<span class="op" id="2541273">=</span>&nbsp;<span class="ident" id="2541275"><a href="/net/hosts.go.html#2592322">lookupStaticHost</a></span><span class="op" id="2541291">(</span><span class="ident" id="2541292"><a href="/net/dnsclient_unix.go.html#2541176">name</a></span><span class="op" id="2541296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2541299">if</span>&nbsp;<span class="builtinfunc" id="2541302">len</span><span class="op" id="2541305">(</span><span class="ident" id="2541306"><a href="/net/dnsclient_unix.go.html#2541190">addrs</a></span><span class="op" id="2541311">)</span>&nbsp;<span class="op" id="2541313">&gt;</span>&nbsp;<span class="num" id="2541315">0</span>&nbsp;<span class="op" id="2541317">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2541321">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2541329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2541332">ips</span><span class="op" id="2541335">,</span>&nbsp;<span class="ident" id="2541337"><a href="/net/dnsclient_unix.go.html#2541206">err</a></span>&nbsp;<span class="op" id="2541341">:=</span>&nbsp;<span class="ident" id="2541344"><a href="/net/dnsclient_unix.go.html#2541824">goLookupIP</a></span><span class="op" id="2541354">(</span><span class="ident" id="2541355"><a href="/net/dnsclient_unix.go.html#2541176">name</a></span><span class="op" id="2541359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2541362">if</span>&nbsp;<span class="ident" id="2541365"><a href="/net/dnsclient_unix.go.html#2541206">err</a></span>&nbsp;<span class="op" id="2541369">!=</span>&nbsp;<span class="ident" id="2541372">nil</span>&nbsp;<span class="op" id="2541376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2541380">return</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2541388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2541391"><a href="/net/dnsclient_unix.go.html#2541190">addrs</a></span>&nbsp;<span class="op" id="2541397">=</span>&nbsp;<span class="builtinfunc" id="2541399">make</span><span class="op" id="2541403">(</span><span class="op" id="2541404">[</span><span class="op" id="2541405">]</span><span class="builtintype" id="2541406">string</span><span class="op" id="2541412">,</span>&nbsp;<span class="num" id="2541414">0</span><span class="op" id="2541415">,</span>&nbsp;<span class="builtinfunc" id="2541417">len</span><span class="op" id="2541420">(</span><span class="ident" id="2541421"><a href="/net/dnsclient_unix.go.html#2541332">ips</a></span><span class="op" id="2541424">)</span><span class="op" id="2541425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2541428">for</span>&nbsp;<span class="ident" id="2541432">_</span><span class="op" id="2541433">,</span>&nbsp;<span class="ident" id="2541435">ip</span>&nbsp;<span class="op" id="2541438">:=</span>&nbsp;<span class="keyword" id="2541441">range</span>&nbsp;<span class="ident" id="2541447"><a href="/net/dnsclient_unix.go.html#2541332">ips</a></span>&nbsp;<span class="op" id="2541451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2541455"><a href="/net/dnsclient_unix.go.html#2541190">addrs</a></span>&nbsp;<span class="op" id="2541461">=</span>&nbsp;<span class="builtinfunc" id="2541463">append</span><span class="op" id="2541469">(</span><span class="ident" id="2541470"><a href="/net/dnsclient_unix.go.html#2541190">addrs</a></span><span class="op" id="2541475">,</span>&nbsp;<span class="ident" id="2541477"><a href="/net/dnsclient_unix.go.html#2541435">ip</a></span><span class="op" id="2541479">.</span><span class="ident" id="2541480">String</span><span class="op" id="2541486">(</span><span class="op" id="2541487">)</span><span class="op" id="2541488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2541491">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2541494">return</span><br>
<span class="lineno"></span><span class="op" id="2541501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2541504">//&nbsp;goLookupIP&nbsp;is&nbsp;the&nbsp;native&nbsp;Go&nbsp;implementation&nbsp;of&nbsp;LookupIP.</span><br>
<span class="lineno"></span><span class="comment" id="2541563">//&nbsp;Used&nbsp;only&nbsp;if&nbsp;cgoLookupIP&nbsp;refuses&nbsp;to&nbsp;handle&nbsp;the&nbsp;request</span><br>
<span class="lineno">360</span><span class="comment" id="2541621">//&nbsp;(that&nbsp;is,&nbsp;only&nbsp;if&nbsp;cgoLookupIP&nbsp;is&nbsp;the&nbsp;stub&nbsp;in&nbsp;cgo_stub.go).</span><br>
<span class="lineno"></span><span class="comment" id="2541683">//&nbsp;Normally&nbsp;we&nbsp;let&nbsp;cgo&nbsp;use&nbsp;the&nbsp;C&nbsp;library&nbsp;resolver&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2541744">//&nbsp;depending&nbsp;on&nbsp;our&nbsp;lookup&nbsp;code,&nbsp;so&nbsp;that&nbsp;Go&nbsp;and&nbsp;C&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="2541807">//&nbsp;answers.</span><br>
<span class="lineno"></span><span class="keyword" id="2541819">func</span>&nbsp;<span class="ident" id="2541824">goLookupIP</span><span class="op" id="2541834">(</span><span class="ident" id="2541835">name</span>&nbsp;<span class="builtintype" id="2541840">string</span><span class="op" id="2541846">)</span>&nbsp;<span class="op" id="2541848">(</span><span class="ident" id="2541849">addrs</span>&nbsp;<span class="op" id="2541855">[</span><span class="op" id="2541856">]</span><span class="ident" id="2541857"><a href="/net/ip.go.html#2604330">IP</a></span><span class="op" id="2541859">,</span>&nbsp;<span class="ident" id="2541861">err</span>&nbsp;<span class="builtintype" id="2541865">error</span><span class="op" id="2541870">)</span>&nbsp;<span class="op" id="2541872">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2541875">//&nbsp;Use&nbsp;entries&nbsp;from&nbsp;/etc/hosts&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2541920">haddrs</span>&nbsp;<span class="op" id="2541927">:=</span>&nbsp;<span class="ident" id="2541930"><a href="/net/hosts.go.html#2592322">lookupStaticHost</a></span><span class="op" id="2541946">(</span><span class="ident" id="2541947"><a href="/net/dnsclient_unix.go.html#2541835">name</a></span><span class="op" id="2541951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2541954">if</span>&nbsp;<span class="builtinfunc" id="2541957">len</span><span class="op" id="2541960">(</span><span class="ident" id="2541961"><a href="/net/dnsclient_unix.go.html#2541920">haddrs</a></span><span class="op" id="2541967">)</span>&nbsp;<span class="op" id="2541969">&gt;</span>&nbsp;<span class="num" id="2541971">0</span>&nbsp;<span class="op" id="2541973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2541977">for</span>&nbsp;<span class="ident" id="2541981">_</span><span class="op" id="2541982">,</span>&nbsp;<span class="ident" id="2541984">haddr</span>&nbsp;<span class="op" id="2541990">:=</span>&nbsp;<span class="keyword" id="2541993">range</span>&nbsp;<span class="ident" id="2541999"><a href="/net/dnsclient_unix.go.html#2541920">haddrs</a></span>&nbsp;<span class="op" id="2542006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542011">if</span>&nbsp;<span class="ident" id="2542014">ip</span>&nbsp;<span class="op" id="2542017">:=</span>&nbsp;<span class="ident" id="2542020"><a href="/net/ip.go.html#2617916">ParseIP</a></span><span class="op" id="2542027">(</span><span class="ident" id="2542028"><a href="/net/dnsclient_unix.go.html#2541984">haddr</a></span><span class="op" id="2542033">)</span><span class="op" id="2542034">;</span>&nbsp;<span class="ident" id="2542036"><a href="/net/dnsclient_unix.go.html#2542014">ip</a></span>&nbsp;<span class="op" id="2542039">!=</span>&nbsp;<span class="ident" id="2542042">nil</span>&nbsp;<span class="op" id="2542046">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2542052"><a href="/net/dnsclient_unix.go.html#2541849">addrs</a></span>&nbsp;<span class="op" id="2542058">=</span>&nbsp;<span class="builtinfunc" id="2542060">append</span><span class="op" id="2542066">(</span><span class="ident" id="2542067"><a href="/net/dnsclient_unix.go.html#2541849">addrs</a></span><span class="op" id="2542072">,</span>&nbsp;<span class="ident" id="2542074"><a href="/net/dnsclient_unix.go.html#2542014">ip</a></span><span class="op" id="2542076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2542081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2542085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542089">if</span>&nbsp;<span class="builtinfunc" id="2542092">len</span><span class="op" id="2542095">(</span><span class="ident" id="2542096"><a href="/net/dnsclient_unix.go.html#2541849">addrs</a></span><span class="op" id="2542101">)</span>&nbsp;<span class="op" id="2542103">&gt;</span>&nbsp;<span class="num" id="2542105">0</span>&nbsp;<span class="op" id="2542107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542112">return</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2542121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2542124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542127">type</span>&nbsp;<span class="ident" id="2542132">racer</span>&nbsp;<span class="keyword" id="2542138">struct</span>&nbsp;<span class="op" id="2542145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2542149">qtype</span>&nbsp;<span class="builtintype" id="2542155">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2542164">rrs</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2542170">[</span><span class="op" id="2542171">]</span><span class="ident" id="2542172"><a href="/net/dnsmsg.go.html#2549843">dnsRR</a></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2542180">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2542187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2542190">lane</span>&nbsp;<span class="op" id="2542195">:=</span>&nbsp;<span class="builtinfunc" id="2542198">make</span><span class="op" id="2542202">(</span><span class="keyword" id="2542203">chan</span>&nbsp;<span class="ident" id="2542208"><a href="/net/dnsclient_unix.go.html#2542132">racer</a></span><span class="op" id="2542213">,</span>&nbsp;<span class="num" id="2542215">1</span><span class="op" id="2542216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2542219">qtypes</span>&nbsp;<span class="op" id="2542226">:=</span>&nbsp;<span class="op" id="2542229">[</span><span class="op" id="2542230">...</span><span class="op" id="2542233">]</span><span class="builtintype" id="2542234">uint16</span><span class="op" id="2542240">{</span><span class="ident" id="2542241"><a href="/net/dnsmsg.go.html#2546845">dnsTypeA</a></span><span class="op" id="2542249">,</span>&nbsp;<span class="ident" id="2542251"><a href="/net/dnsmsg.go.html#2547140">dnsTypeAAAA</a></span><span class="op" id="2542262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542265">for</span>&nbsp;<span class="ident" id="2542269">_</span><span class="op" id="2542270">,</span>&nbsp;<span class="ident" id="2542272">qtype</span>&nbsp;<span class="op" id="2542278">:=</span>&nbsp;<span class="keyword" id="2542281">range</span>&nbsp;<span class="ident" id="2542287"><a href="/net/dnsclient_unix.go.html#2542219">qtypes</a></span>&nbsp;<span class="op" id="2542294">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542298">go</span>&nbsp;<span class="keyword" id="2542301">func</span><span class="op" id="2542305">(</span><span class="ident" id="2542306">qtype</span>&nbsp;<span class="builtintype" id="2542312">uint16</span><span class="op" id="2542318">)</span>&nbsp;<span class="op" id="2542320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2542325">_</span><span class="op" id="2542326">,</span>&nbsp;<span class="ident" id="2542328">rrs</span><span class="op" id="2542331">,</span>&nbsp;<span class="ident" id="2542333">err</span>&nbsp;<span class="op" id="2542337">:=</span>&nbsp;<span class="ident" id="2542340"><a href="/net/dnsclient_unix.go.html#2539266">lookup</a></span><span class="op" id="2542346">(</span><span class="ident" id="2542347"><a href="/net/dnsclient_unix.go.html#2541835">name</a></span><span class="op" id="2542351">,</span>&nbsp;<span class="ident" id="2542353"><a href="/net/dnsclient_unix.go.html#2542306">qtype</a></span><span class="op" id="2542358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2542363"><a href="/net/dnsclient_unix.go.html#2542190">lane</a></span>&nbsp;<span class="op" id="2542368">&lt;-</span>&nbsp;<span class="ident" id="2542371"><a href="/net/dnsclient_unix.go.html#2542132">racer</a></span><span class="op" id="2542376">{</span><span class="ident" id="2542377"><a href="/net/dnsclient_unix.go.html#2542306">qtype</a></span><span class="op" id="2542382">,</span>&nbsp;<span class="ident" id="2542384"><a href="/net/dnsclient_unix.go.html#2542328">rrs</a></span><span class="op" id="2542387">,</span>&nbsp;<span class="ident" id="2542389"><a href="/net/dnsclient_unix.go.html#2542333">err</a></span><span class="op" id="2542392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2542396">}</span><span class="op" id="2542397">(</span><span class="ident" id="2542398"><a href="/net/dnsclient_unix.go.html#2542272">qtype</a></span><span class="op" id="2542403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2542406">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542409">var</span>&nbsp;<span class="ident" id="2542413">lastErr</span>&nbsp;<span class="builtintype" id="2542421">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542428">for</span>&nbsp;<span class="keyword" id="2542432">range</span>&nbsp;<span class="ident" id="2542438"><a href="/net/dnsclient_unix.go.html#2542219">qtypes</a></span>&nbsp;<span class="op" id="2542445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2542449">racer</span>&nbsp;<span class="op" id="2542455">:=</span>&nbsp;<span class="op" id="2542458">&lt;-</span><span class="ident" id="2542460"><a href="/net/dnsclient_unix.go.html#2542190">lane</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542467">if</span>&nbsp;<span class="ident" id="2542470"><a href="/net/dnsclient_unix.go.html#2542449">racer</a></span><span class="op" id="2542475">.</span><span class="builtintype" id="2542476">error</span>&nbsp;<span class="op" id="2542482">!=</span>&nbsp;<span class="ident" id="2542485">nil</span>&nbsp;<span class="op" id="2542489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2542494"><a href="/net/dnsclient_unix.go.html#2542413">lastErr</a></span>&nbsp;<span class="op" id="2542502">=</span>&nbsp;<span class="ident" id="2542504"><a href="/net/dnsclient_unix.go.html#2542449">racer</a></span><span class="op" id="2542509">.</span><span class="builtintype" id="2542510">error</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542519">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2542530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542534">switch</span>&nbsp;<span class="ident" id="2542541"><a href="/net/dnsclient_unix.go.html#2542449">racer</a></span><span class="op" id="2542546">.</span><span class="ident" id="2542547">qtype</span>&nbsp;<span class="op" id="2542553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542557">case</span>&nbsp;<span class="ident" id="2542562"><a href="/net/dnsmsg.go.html#2546845">dnsTypeA</a></span><span class="op" id="2542570">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2542575"><a href="/net/dnsclient_unix.go.html#2541849">addrs</a></span>&nbsp;<span class="op" id="2542581">=</span>&nbsp;<span class="builtinfunc" id="2542583">append</span><span class="op" id="2542589">(</span><span class="ident" id="2542590"><a href="/net/dnsclient_unix.go.html#2541849">addrs</a></span><span class="op" id="2542595">,</span>&nbsp;<span class="ident" id="2542597"><a href="/net/dnsclient_unix.go.html#2537570">convertRR_A</a></span><span class="op" id="2542608">(</span><span class="ident" id="2542609"><a href="/net/dnsclient_unix.go.html#2542449">racer</a></span><span class="op" id="2542614">.</span><span class="ident" id="2542615">rrs</span><span class="op" id="2542618">)</span><span class="op" id="2542619">...</span><span class="op" id="2542622">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542626">case</span>&nbsp;<span class="ident" id="2542631"><a href="/net/dnsmsg.go.html#2547140">dnsTypeAAAA</a></span><span class="op" id="2542642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2542647"><a href="/net/dnsclient_unix.go.html#2541849">addrs</a></span>&nbsp;<span class="op" id="2542653">=</span>&nbsp;<span class="builtinfunc" id="2542655">append</span><span class="op" id="2542661">(</span><span class="ident" id="2542662"><a href="/net/dnsclient_unix.go.html#2541849">addrs</a></span><span class="op" id="2542667">,</span>&nbsp;<span class="ident" id="2542669"><a href="/net/dnsclient_unix.go.html#2537784">convertRR_AAAA</a></span><span class="op" id="2542683">(</span><span class="ident" id="2542684"><a href="/net/dnsclient_unix.go.html#2542449">racer</a></span><span class="op" id="2542689">.</span><span class="ident" id="2542690">rrs</span><span class="op" id="2542693">)</span><span class="op" id="2542694">...</span><span class="op" id="2542697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2542701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2542704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542707">if</span>&nbsp;<span class="builtinfunc" id="2542710">len</span><span class="op" id="2542713">(</span><span class="ident" id="2542714"><a href="/net/dnsclient_unix.go.html#2541849">addrs</a></span><span class="op" id="2542719">)</span>&nbsp;<span class="op" id="2542721">==</span>&nbsp;<span class="num" id="2542724">0</span>&nbsp;<span class="op" id="2542726">&amp;&amp;</span>&nbsp;<span class="ident" id="2542729"><a href="/net/dnsclient_unix.go.html#2542413">lastErr</a></span>&nbsp;<span class="op" id="2542737">!=</span>&nbsp;<span class="ident" id="2542740">nil</span>&nbsp;<span class="op" id="2542744">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542748">return</span>&nbsp;<span class="ident" id="2542755">nil</span><span class="op" id="2542758">,</span>&nbsp;<span class="ident" id="2542760"><a href="/net/dnsclient_unix.go.html#2542413">lastErr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2542769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542772">return</span>&nbsp;<span class="ident" id="2542779"><a href="/net/dnsclient_unix.go.html#2541849">addrs</a></span><span class="op" id="2542784">,</span>&nbsp;<span class="ident" id="2542786">nil</span><br>
<span class="lineno"></span><span class="op" id="2542790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="2542793">//&nbsp;goLookupCNAME&nbsp;is&nbsp;the&nbsp;native&nbsp;Go&nbsp;implementation&nbsp;of&nbsp;LookupCNAME.</span><br>
<span class="lineno"></span><span class="comment" id="2542858">//&nbsp;Used&nbsp;only&nbsp;if&nbsp;cgoLookupCNAME&nbsp;refuses&nbsp;to&nbsp;handle&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="2542919">//&nbsp;(that&nbsp;is,&nbsp;only&nbsp;if&nbsp;cgoLookupCNAME&nbsp;is&nbsp;the&nbsp;stub&nbsp;in&nbsp;cgo_stub.go).</span><br>
<span class="lineno"></span><span class="comment" id="2542984">//&nbsp;Normally&nbsp;we&nbsp;let&nbsp;cgo&nbsp;use&nbsp;the&nbsp;C&nbsp;library&nbsp;resolver&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2543045">//&nbsp;depending&nbsp;on&nbsp;our&nbsp;lookup&nbsp;code,&nbsp;so&nbsp;that&nbsp;Go&nbsp;and&nbsp;C&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno">415</span><span class="comment" id="2543108">//&nbsp;answers.</span><br>
<span class="lineno"></span><span class="keyword" id="2543120">func</span>&nbsp;<span class="ident" id="2543125">goLookupCNAME</span><span class="op" id="2543138">(</span><span class="ident" id="2543139">name</span>&nbsp;<span class="builtintype" id="2543144">string</span><span class="op" id="2543150">)</span>&nbsp;<span class="op" id="2543152">(</span><span class="ident" id="2543153">cname</span>&nbsp;<span class="builtintype" id="2543159">string</span><span class="op" id="2543165">,</span>&nbsp;<span class="ident" id="2543167">err</span>&nbsp;<span class="builtintype" id="2543171">error</span><span class="op" id="2543176">)</span>&nbsp;<span class="op" id="2543178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2543181">_</span><span class="op" id="2543182">,</span>&nbsp;<span class="ident" id="2543184">rr</span><span class="op" id="2543186">,</span>&nbsp;<span class="ident" id="2543188"><a href="/net/dnsclient_unix.go.html#2543167">err</a></span>&nbsp;<span class="op" id="2543192">:=</span>&nbsp;<span class="ident" id="2543195"><a href="/net/dnsclient_unix.go.html#2539266">lookup</a></span><span class="op" id="2543201">(</span><span class="ident" id="2543202"><a href="/net/dnsclient_unix.go.html#2543139">name</a></span><span class="op" id="2543206">,</span>&nbsp;<span class="ident" id="2543208"><a href="/net/dnsmsg.go.html#2546917">dnsTypeCNAME</a></span><span class="op" id="2543220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2543223">if</span>&nbsp;<span class="ident" id="2543226"><a href="/net/dnsclient_unix.go.html#2543167">err</a></span>&nbsp;<span class="op" id="2543230">!=</span>&nbsp;<span class="ident" id="2543233">nil</span>&nbsp;<span class="op" id="2543237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2543241">return</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2543249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2543252"><a href="/net/dnsclient_unix.go.html#2543153">cname</a></span>&nbsp;<span class="op" id="2543258">=</span>&nbsp;<span class="ident" id="2543260"><a href="/net/dnsclient_unix.go.html#2543184">rr</a></span><span class="op" id="2543262">[</span><span class="num" id="2543263">0</span><span class="op" id="2543264">]</span><span class="op" id="2543265">.</span><span class="op" id="2543266">(</span><span class="op" id="2543267">*</span><span class="ident" id="2543268"><a href="/net/dnsmsg.go.html#2549953">dnsRR_CNAME</a></span><span class="op" id="2543279">)</span><span class="op" id="2543280">.</span><span class="ident" id="2543281">Cname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2543288">return</span><br>
<span class="lineno"></span><span class="op" id="2543295">}</span>
</div>
</body>
</html>
