<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2580168">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2580224">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2580278">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2580329">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2580399">//&nbsp;Unix&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2580431">package</span>&nbsp;<span class="ident" id="2580439">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2580448">import</span>&nbsp;<span class="string" id="2580455">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2580463">var</span>&nbsp;<span class="op" id="2580467">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2580470">//&nbsp;envOnce&nbsp;guards&nbsp;initialization&nbsp;by&nbsp;copyenv,&nbsp;which&nbsp;populates&nbsp;env.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2580537">envOnce</span>&nbsp;<span class="ident" id="2580545">sync</span><span class="op" id="2580549">.</span><span class="ident" id="2580550">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2580557">//&nbsp;envLock&nbsp;guards&nbsp;env&nbsp;and&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2580590">envLock</span>&nbsp;<span class="ident" id="2580598">sync</span><span class="op" id="2580602">.</span><span class="ident" id="2580603">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2580613">//&nbsp;env&nbsp;maps&nbsp;from&nbsp;an&nbsp;environment&nbsp;variable&nbsp;to&nbsp;its&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2580688">env</span>&nbsp;<span class="keyword" id="2580692">map</span><span class="op" id="2580695">[</span><span class="builtintype" id="2580696">string</span><span class="op" id="2580702">]</span><span class="builtintype" id="2580703">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2580709">//&nbsp;envs&nbsp;is&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;elements&nbsp;are&nbsp;expected&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2580771">//&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;key=value&#34;.&nbsp;An&nbsp;empty&nbsp;string&nbsp;means&nbsp;deleted</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2580833">//&nbsp;(or&nbsp;a&nbsp;duplicate&nbsp;to&nbsp;be&nbsp;ignored).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2580869">envs</span>&nbsp;<span class="op" id="2580874">[</span><span class="op" id="2580875">]</span><span class="builtintype" id="2580876">string</span>&nbsp;<span class="op" id="2580883">=</span>&nbsp;<span class="ident" id="2580885">runtime_envs</span><span class="op" id="2580897">(</span><span class="op" id="2580898">)</span><br>
<span class="lineno"></span><span class="op" id="2580900">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2580903">func</span>&nbsp;<span class="ident" id="2580908">runtime_envs</span><span class="op" id="2580920">(</span><span class="op" id="2580921">)</span>&nbsp;<span class="op" id="2580923">[</span><span class="op" id="2580924">]</span><span class="builtintype" id="2580925">string</span>&nbsp;<span class="comment" id="2580932">//&nbsp;in&nbsp;package&nbsp;runtime</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2580955">//&nbsp;setenv_c&nbsp;and&nbsp;unsetenv_c&nbsp;are&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime&nbsp;but&nbsp;are&nbsp;no-ops</span><br>
<span class="lineno"></span><span class="comment" id="2581025">//&nbsp;if&nbsp;cgo&nbsp;isn&#39;t&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="keyword" id="2581049">func</span>&nbsp;<span class="ident" id="2581054">setenv_c</span><span class="op" id="2581062">(</span><span class="ident" id="2581063">k</span><span class="op" id="2581064">,</span>&nbsp;<span class="ident" id="2581066">v</span>&nbsp;<span class="builtintype" id="2581068">string</span><span class="op" id="2581074">)</span><br>
<span class="lineno"></span><span class="keyword" id="2581076">func</span>&nbsp;<span class="ident" id="2581081">unsetenv_c</span><span class="op" id="2581091">(</span><span class="ident" id="2581092">k</span>&nbsp;<span class="builtintype" id="2581094">string</span><span class="op" id="2581100">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2581103">func</span>&nbsp;<span class="ident" id="2581108">copyenv</span><span class="op" id="2581115">(</span><span class="op" id="2581116">)</span>&nbsp;<span class="op" id="2581118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581121">env</span>&nbsp;<span class="op" id="2581125">=</span>&nbsp;<span class="builtinfunc" id="2581127">make</span><span class="op" id="2581131">(</span><span class="keyword" id="2581132">map</span><span class="op" id="2581135">[</span><span class="builtintype" id="2581136">string</span><span class="op" id="2581142">]</span><span class="builtintype" id="2581143">int</span><span class="op" id="2581146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581149">for</span>&nbsp;<span class="ident" id="2581153">i</span><span class="op" id="2581154">,</span>&nbsp;<span class="ident" id="2581156">s</span>&nbsp;<span class="op" id="2581158">:=</span>&nbsp;<span class="keyword" id="2581161">range</span>&nbsp;<span class="ident" id="2581167">envs</span>&nbsp;<span class="op" id="2581172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581176">for</span>&nbsp;<span class="ident" id="2581180">j</span>&nbsp;<span class="op" id="2581182">:=</span>&nbsp;<span class="num" id="2581185">0</span><span class="op" id="2581186">;</span>&nbsp;<span class="ident" id="2581188">j</span>&nbsp;<span class="op" id="2581190">&lt;</span>&nbsp;<span class="builtinfunc" id="2581192">len</span><span class="op" id="2581195">(</span><span class="ident" id="2581196">s</span><span class="op" id="2581197">)</span><span class="op" id="2581198">;</span>&nbsp;<span class="ident" id="2581200">j</span><span class="op" id="2581201">++</span>&nbsp;<span class="op" id="2581204">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581209">if</span>&nbsp;<span class="ident" id="2581212">s</span><span class="op" id="2581213">[</span><span class="ident" id="2581214">j</span><span class="op" id="2581215">]</span>&nbsp;<span class="op" id="2581217">==</span>&nbsp;<span class="string" id="2581220">&#39;=&#39;</span>&nbsp;<span class="op" id="2581224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581230">key</span>&nbsp;<span class="op" id="2581234">:=</span>&nbsp;<span class="ident" id="2581237">s</span><span class="op" id="2581238">[</span><span class="op" id="2581239">:</span><span class="ident" id="2581240">j</span><span class="op" id="2581241">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581247">if</span>&nbsp;<span class="ident" id="2581250">_</span><span class="op" id="2581251">,</span>&nbsp;<span class="ident" id="2581253">ok</span>&nbsp;<span class="op" id="2581256">:=</span>&nbsp;<span class="ident" id="2581259">env</span><span class="op" id="2581262">[</span><span class="ident" id="2581263">key</span><span class="op" id="2581266">]</span><span class="op" id="2581267">;</span>&nbsp;<span class="op" id="2581269">!</span><span class="ident" id="2581270">ok</span>&nbsp;<span class="op" id="2581273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581280">env</span><span class="op" id="2581283">[</span><span class="ident" id="2581284">key</span><span class="op" id="2581287">]</span>&nbsp;<span class="op" id="2581289">=</span>&nbsp;<span class="ident" id="2581291">i</span>&nbsp;<span class="comment" id="2581293">//&nbsp;first&nbsp;mention&nbsp;of&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2581321">}</span>&nbsp;<span class="keyword" id="2581323">else</span>&nbsp;<span class="op" id="2581328">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2581335">//&nbsp;Clear&nbsp;duplicate&nbsp;keys.&nbsp;This&nbsp;permits&nbsp;Unsetenv&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2581390">//&nbsp;safely&nbsp;delete&nbsp;only&nbsp;the&nbsp;first&nbsp;item&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2581440">//&nbsp;worrying&nbsp;about&nbsp;unshadowing&nbsp;a&nbsp;later&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2581488">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;security&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581531">envs</span><span class="op" id="2581535">[</span><span class="ident" id="2581536">i</span><span class="op" id="2581537">]</span>&nbsp;<span class="op" id="2581539">=</span>&nbsp;<span class="string" id="2581541">&#34;&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2581548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581554">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2581563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2581567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2581570">}</span><br>
<span class="lineno">55</span><span class="op" id="2581572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2581575">func</span>&nbsp;<span class="ident" id="2581580">Unsetenv</span><span class="op" id="2581588">(</span><span class="ident" id="2581589">key</span>&nbsp;<span class="builtintype" id="2581593">string</span><span class="op" id="2581599">)</span>&nbsp;<span class="builtintype" id="2581601">error</span>&nbsp;<span class="op" id="2581607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581610">envOnce</span><span class="op" id="2581617">.</span><span class="ident" id="2581618">Do</span><span class="op" id="2581620">(</span><span class="ident" id="2581621">copyenv</span><span class="op" id="2581628">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581632">envLock</span><span class="op" id="2581639">.</span><span class="ident" id="2581640">Lock</span><span class="op" id="2581644">(</span><span class="op" id="2581645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581648">defer</span>&nbsp;<span class="ident" id="2581654">envLock</span><span class="op" id="2581661">.</span><span class="ident" id="2581662">Unlock</span><span class="op" id="2581668">(</span><span class="op" id="2581669">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581673">if</span>&nbsp;<span class="ident" id="2581676">i</span><span class="op" id="2581677">,</span>&nbsp;<span class="ident" id="2581679">ok</span>&nbsp;<span class="op" id="2581682">:=</span>&nbsp;<span class="ident" id="2581685">env</span><span class="op" id="2581688">[</span><span class="ident" id="2581689">key</span><span class="op" id="2581692">]</span><span class="op" id="2581693">;</span>&nbsp;<span class="ident" id="2581695">ok</span>&nbsp;<span class="op" id="2581698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581702">envs</span><span class="op" id="2581706">[</span><span class="ident" id="2581707">i</span><span class="op" id="2581708">]</span>&nbsp;<span class="op" id="2581710">=</span>&nbsp;<span class="string" id="2581712">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2581717">delete</span><span class="op" id="2581723">(</span><span class="ident" id="2581724">env</span><span class="op" id="2581727">,</span>&nbsp;<span class="ident" id="2581729">key</span><span class="op" id="2581732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2581735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581738">unsetenv_c</span><span class="op" id="2581748">(</span><span class="ident" id="2581749">key</span><span class="op" id="2581752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581755">return</span>&nbsp;<span class="ident" id="2581762">nil</span><br>
<span class="lineno"></span><span class="op" id="2581766">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2581769">func</span>&nbsp;<span class="ident" id="2581774">Getenv</span><span class="op" id="2581780">(</span><span class="ident" id="2581781">key</span>&nbsp;<span class="builtintype" id="2581785">string</span><span class="op" id="2581791">)</span>&nbsp;<span class="op" id="2581793">(</span><span class="ident" id="2581794">value</span>&nbsp;<span class="builtintype" id="2581800">string</span><span class="op" id="2581806">,</span>&nbsp;<span class="ident" id="2581808">found</span>&nbsp;<span class="builtintype" id="2581814">bool</span><span class="op" id="2581818">)</span>&nbsp;<span class="op" id="2581820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581823">envOnce</span><span class="op" id="2581830">.</span><span class="ident" id="2581831">Do</span><span class="op" id="2581833">(</span><span class="ident" id="2581834">copyenv</span><span class="op" id="2581841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581844">if</span>&nbsp;<span class="builtinfunc" id="2581847">len</span><span class="op" id="2581850">(</span><span class="ident" id="2581851">key</span><span class="op" id="2581854">)</span>&nbsp;<span class="op" id="2581856">==</span>&nbsp;<span class="num" id="2581859">0</span>&nbsp;<span class="op" id="2581861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581865">return</span>&nbsp;<span class="string" id="2581872">&#34;&#34;</span><span class="op" id="2581874">,</span>&nbsp;<span class="builtintype" id="2581876">false</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2581883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581887">envLock</span><span class="op" id="2581894">.</span><span class="ident" id="2581895">RLock</span><span class="op" id="2581900">(</span><span class="op" id="2581901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581904">defer</span>&nbsp;<span class="ident" id="2581910">envLock</span><span class="op" id="2581917">.</span><span class="ident" id="2581918">RUnlock</span><span class="op" id="2581925">(</span><span class="op" id="2581926">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581930">i</span><span class="op" id="2581931">,</span>&nbsp;<span class="ident" id="2581933">ok</span>&nbsp;<span class="op" id="2581936">:=</span>&nbsp;<span class="ident" id="2581939">env</span><span class="op" id="2581942">[</span><span class="ident" id="2581943">key</span><span class="op" id="2581946">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581949">if</span>&nbsp;<span class="op" id="2581952">!</span><span class="ident" id="2581953">ok</span>&nbsp;<span class="op" id="2581956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581960">return</span>&nbsp;<span class="string" id="2581967">&#34;&#34;</span><span class="op" id="2581969">,</span>&nbsp;<span class="builtintype" id="2581971">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2581978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2581981">s</span>&nbsp;<span class="op" id="2581983">:=</span>&nbsp;<span class="ident" id="2581986">envs</span><span class="op" id="2581990">[</span><span class="ident" id="2581991">i</span><span class="op" id="2581992">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2581995">for</span>&nbsp;<span class="ident" id="2581999">i</span>&nbsp;<span class="op" id="2582001">:=</span>&nbsp;<span class="num" id="2582004">0</span><span class="op" id="2582005">;</span>&nbsp;<span class="ident" id="2582007">i</span>&nbsp;<span class="op" id="2582009">&lt;</span>&nbsp;<span class="builtinfunc" id="2582011">len</span><span class="op" id="2582014">(</span><span class="ident" id="2582015">s</span><span class="op" id="2582016">)</span><span class="op" id="2582017">;</span>&nbsp;<span class="ident" id="2582019">i</span><span class="op" id="2582020">++</span>&nbsp;<span class="op" id="2582023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582027">if</span>&nbsp;<span class="ident" id="2582030">s</span><span class="op" id="2582031">[</span><span class="ident" id="2582032">i</span><span class="op" id="2582033">]</span>&nbsp;<span class="op" id="2582035">==</span>&nbsp;<span class="string" id="2582038">&#39;=&#39;</span>&nbsp;<span class="op" id="2582042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582047">return</span>&nbsp;<span class="ident" id="2582054">s</span><span class="op" id="2582055">[</span><span class="ident" id="2582056">i</span><span class="op" id="2582057">+</span><span class="num" id="2582058">1</span><span class="op" id="2582059">:</span><span class="op" id="2582060">]</span><span class="op" id="2582061">,</span>&nbsp;<span class="builtintype" id="2582063">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2582070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2582073">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582076">return</span>&nbsp;<span class="string" id="2582083">&#34;&#34;</span><span class="op" id="2582085">,</span>&nbsp;<span class="builtintype" id="2582087">false</span><br>
<span class="lineno"></span><span class="op" id="2582093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2582096">func</span>&nbsp;<span class="ident" id="2582101">Setenv</span><span class="op" id="2582107">(</span><span class="ident" id="2582108">key</span><span class="op" id="2582111">,</span>&nbsp;<span class="ident" id="2582113">value</span>&nbsp;<span class="builtintype" id="2582119">string</span><span class="op" id="2582125">)</span>&nbsp;<span class="builtintype" id="2582127">error</span>&nbsp;<span class="op" id="2582133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582136">envOnce</span><span class="op" id="2582143">.</span><span class="ident" id="2582144">Do</span><span class="op" id="2582146">(</span><span class="ident" id="2582147">copyenv</span><span class="op" id="2582154">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582157">if</span>&nbsp;<span class="builtinfunc" id="2582160">len</span><span class="op" id="2582163">(</span><span class="ident" id="2582164">key</span><span class="op" id="2582167">)</span>&nbsp;<span class="op" id="2582169">==</span>&nbsp;<span class="num" id="2582172">0</span>&nbsp;<span class="op" id="2582174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582178">return</span>&nbsp;<span class="ident" id="2582185">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2582193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582196">for</span>&nbsp;<span class="ident" id="2582200">i</span>&nbsp;<span class="op" id="2582202">:=</span>&nbsp;<span class="num" id="2582205">0</span><span class="op" id="2582206">;</span>&nbsp;<span class="ident" id="2582208">i</span>&nbsp;<span class="op" id="2582210">&lt;</span>&nbsp;<span class="builtinfunc" id="2582212">len</span><span class="op" id="2582215">(</span><span class="ident" id="2582216">key</span><span class="op" id="2582219">)</span><span class="op" id="2582220">;</span>&nbsp;<span class="ident" id="2582222">i</span><span class="op" id="2582223">++</span>&nbsp;<span class="op" id="2582226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582230">if</span>&nbsp;<span class="ident" id="2582233">key</span><span class="op" id="2582236">[</span><span class="ident" id="2582237">i</span><span class="op" id="2582238">]</span>&nbsp;<span class="op" id="2582240">==</span>&nbsp;<span class="string" id="2582243">&#39;=&#39;</span>&nbsp;<span class="op" id="2582247">||</span>&nbsp;<span class="ident" id="2582250">key</span><span class="op" id="2582253">[</span><span class="ident" id="2582254">i</span><span class="op" id="2582255">]</span>&nbsp;<span class="op" id="2582257">==</span>&nbsp;<span class="num" id="2582260">0</span>&nbsp;<span class="op" id="2582262">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582267">return</span>&nbsp;<span class="ident" id="2582274">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2582283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2582286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582289">for</span>&nbsp;<span class="ident" id="2582293">i</span>&nbsp;<span class="op" id="2582295">:=</span>&nbsp;<span class="num" id="2582298">0</span><span class="op" id="2582299">;</span>&nbsp;<span class="ident" id="2582301">i</span>&nbsp;<span class="op" id="2582303">&lt;</span>&nbsp;<span class="builtinfunc" id="2582305">len</span><span class="op" id="2582308">(</span><span class="ident" id="2582309">value</span><span class="op" id="2582314">)</span><span class="op" id="2582315">;</span>&nbsp;<span class="ident" id="2582317">i</span><span class="op" id="2582318">++</span>&nbsp;<span class="op" id="2582321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582325">if</span>&nbsp;<span class="ident" id="2582328">value</span><span class="op" id="2582333">[</span><span class="ident" id="2582334">i</span><span class="op" id="2582335">]</span>&nbsp;<span class="op" id="2582337">==</span>&nbsp;<span class="num" id="2582340">0</span>&nbsp;<span class="op" id="2582342">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582347">return</span>&nbsp;<span class="ident" id="2582354">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2582363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2582366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582370">envLock</span><span class="op" id="2582377">.</span><span class="ident" id="2582378">Lock</span><span class="op" id="2582382">(</span><span class="op" id="2582383">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582386">defer</span>&nbsp;<span class="ident" id="2582392">envLock</span><span class="op" id="2582399">.</span><span class="ident" id="2582400">Unlock</span><span class="op" id="2582406">(</span><span class="op" id="2582407">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582411">i</span><span class="op" id="2582412">,</span>&nbsp;<span class="ident" id="2582414">ok</span>&nbsp;<span class="op" id="2582417">:=</span>&nbsp;<span class="ident" id="2582420">env</span><span class="op" id="2582423">[</span><span class="ident" id="2582424">key</span><span class="op" id="2582427">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582430">kv</span>&nbsp;<span class="op" id="2582433">:=</span>&nbsp;<span class="ident" id="2582436">key</span>&nbsp;<span class="op" id="2582440">+</span>&nbsp;<span class="string" id="2582442">&#34;=&#34;</span>&nbsp;<span class="op" id="2582446">+</span>&nbsp;<span class="ident" id="2582448">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582455">if</span>&nbsp;<span class="ident" id="2582458">ok</span>&nbsp;<span class="op" id="2582461">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582465">envs</span><span class="op" id="2582469">[</span><span class="ident" id="2582470">i</span><span class="op" id="2582471">]</span>&nbsp;<span class="op" id="2582473">=</span>&nbsp;<span class="ident" id="2582475">kv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2582479">}</span>&nbsp;<span class="keyword" id="2582481">else</span>&nbsp;<span class="op" id="2582486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582490">i</span>&nbsp;<span class="op" id="2582492">=</span>&nbsp;<span class="builtinfunc" id="2582494">len</span><span class="op" id="2582497">(</span><span class="ident" id="2582498">envs</span><span class="op" id="2582502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582506">envs</span>&nbsp;<span class="op" id="2582511">=</span>&nbsp;<span class="builtinfunc" id="2582513">append</span><span class="op" id="2582519">(</span><span class="ident" id="2582520">envs</span><span class="op" id="2582524">,</span>&nbsp;<span class="ident" id="2582526">kv</span><span class="op" id="2582528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2582531">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582534">env</span><span class="op" id="2582537">[</span><span class="ident" id="2582538">key</span><span class="op" id="2582541">]</span>&nbsp;<span class="op" id="2582543">=</span>&nbsp;<span class="ident" id="2582545">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582548">setenv_c</span><span class="op" id="2582556">(</span><span class="ident" id="2582557">key</span><span class="op" id="2582560">,</span>&nbsp;<span class="ident" id="2582562">value</span><span class="op" id="2582567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582570">return</span>&nbsp;<span class="ident" id="2582577">nil</span><br>
<span class="lineno"></span><span class="op" id="2582581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2582584">func</span>&nbsp;<span class="ident" id="2582589">Clearenv</span><span class="op" id="2582597">(</span><span class="op" id="2582598">)</span>&nbsp;<span class="op" id="2582600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582603">envOnce</span><span class="op" id="2582610">.</span><span class="ident" id="2582611">Do</span><span class="op" id="2582613">(</span><span class="ident" id="2582614">copyenv</span><span class="op" id="2582621">)</span>&nbsp;<span class="comment" id="2582623">//&nbsp;prevent&nbsp;copyenv&nbsp;in&nbsp;Getenv/Setenv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582661">envLock</span><span class="op" id="2582668">.</span><span class="ident" id="2582669">Lock</span><span class="op" id="2582673">(</span><span class="op" id="2582674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582677">defer</span>&nbsp;<span class="ident" id="2582683">envLock</span><span class="op" id="2582690">.</span><span class="ident" id="2582691">Unlock</span><span class="op" id="2582697">(</span><span class="op" id="2582698">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582702">for</span>&nbsp;<span class="ident" id="2582706">k</span>&nbsp;<span class="op" id="2582708">:=</span>&nbsp;<span class="keyword" id="2582711">range</span>&nbsp;<span class="ident" id="2582717">env</span>&nbsp;<span class="op" id="2582721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582725">unsetenv_c</span><span class="op" id="2582735">(</span><span class="ident" id="2582736">k</span><span class="op" id="2582737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2582740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582743">env</span>&nbsp;<span class="op" id="2582747">=</span>&nbsp;<span class="builtinfunc" id="2582749">make</span><span class="op" id="2582753">(</span><span class="keyword" id="2582754">map</span><span class="op" id="2582757">[</span><span class="builtintype" id="2582758">string</span><span class="op" id="2582764">]</span><span class="builtintype" id="2582765">int</span><span class="op" id="2582768">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582771">envs</span>&nbsp;<span class="op" id="2582776">=</span>&nbsp;<span class="op" id="2582778">[</span><span class="op" id="2582779">]</span><span class="builtintype" id="2582780">string</span><span class="op" id="2582786">{</span><span class="op" id="2582787">}</span><br>
<span class="lineno"></span><span class="op" id="2582789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2582792">func</span>&nbsp;<span class="ident" id="2582797">Environ</span><span class="op" id="2582804">(</span><span class="op" id="2582805">)</span>&nbsp;<span class="op" id="2582807">[</span><span class="op" id="2582808">]</span><span class="builtintype" id="2582809">string</span>&nbsp;<span class="op" id="2582816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582819">envOnce</span><span class="op" id="2582826">.</span><span class="ident" id="2582827">Do</span><span class="op" id="2582829">(</span><span class="ident" id="2582830">copyenv</span><span class="op" id="2582837">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582840">envLock</span><span class="op" id="2582847">.</span><span class="ident" id="2582848">RLock</span><span class="op" id="2582853">(</span><span class="op" id="2582854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582857">defer</span>&nbsp;<span class="ident" id="2582863">envLock</span><span class="op" id="2582870">.</span><span class="ident" id="2582871">RUnlock</span><span class="op" id="2582878">(</span><span class="op" id="2582879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582882">a</span>&nbsp;<span class="op" id="2582884">:=</span>&nbsp;<span class="builtinfunc" id="2582887">make</span><span class="op" id="2582891">(</span><span class="op" id="2582892">[</span><span class="op" id="2582893">]</span><span class="builtintype" id="2582894">string</span><span class="op" id="2582900">,</span>&nbsp;<span class="num" id="2582902">0</span><span class="op" id="2582903">,</span>&nbsp;<span class="builtinfunc" id="2582905">len</span><span class="op" id="2582908">(</span><span class="ident" id="2582909">envs</span><span class="op" id="2582913">)</span><span class="op" id="2582914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582917">for</span>&nbsp;<span class="ident" id="2582921">_</span><span class="op" id="2582922">,</span>&nbsp;<span class="ident" id="2582924">env</span>&nbsp;<span class="op" id="2582928">:=</span>&nbsp;<span class="keyword" id="2582931">range</span>&nbsp;<span class="ident" id="2582937">envs</span>&nbsp;<span class="op" id="2582942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582946">if</span>&nbsp;<span class="ident" id="2582949">env</span>&nbsp;<span class="op" id="2582953">!=</span>&nbsp;<span class="string" id="2582956">&#34;&#34;</span>&nbsp;<span class="op" id="2582959">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2582964">a</span>&nbsp;<span class="op" id="2582966">=</span>&nbsp;<span class="builtinfunc" id="2582968">append</span><span class="op" id="2582974">(</span><span class="ident" id="2582975">a</span><span class="op" id="2582976">,</span>&nbsp;<span class="ident" id="2582978">env</span><span class="op" id="2582981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2582985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2582988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2582991">return</span>&nbsp;<span class="ident" id="2582998">a</span><br>
<span class="lineno"></span><span class="op" id="2583000">}</span>
</div>
</body>
</html>
