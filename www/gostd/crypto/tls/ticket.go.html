<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html" class="current">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4461875">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4461930">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4461984">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4462035">package</span>&nbsp;<span class="ident" id="4462043">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4462048">import</span>&nbsp;<span class="op" id="4462055">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4462058">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4462067">&#34;crypto/aes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4462081">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4462098">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4462113">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4462130">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4462147">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4462157">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4462162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4462165">//&nbsp;sessionState&nbsp;contains&nbsp;the&nbsp;information&nbsp;that&nbsp;is&nbsp;serialized&nbsp;into&nbsp;a&nbsp;session</span><br>
<span class="lineno"></span><span class="comment" id="4462240">//&nbsp;ticket&nbsp;in&nbsp;order&nbsp;to&nbsp;later&nbsp;resume&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="4462289">type</span>&nbsp;<span class="ident" id="4462294">sessionState</span>&nbsp;<span class="keyword" id="4462307">struct</span>&nbsp;<span class="op" id="4462314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4462317">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4462330">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4462338">cipherSuite</span>&nbsp;&nbsp;<span class="builtintype" id="4462351">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4462359">masterSecret</span>&nbsp;<span class="op" id="4462372">[</span><span class="op" id="4462373">]</span><span class="builtintype" id="4462374">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4462380">certificates</span>&nbsp;<span class="op" id="4462393">[</span><span class="op" id="4462394">]</span><span class="op" id="4462395">[</span><span class="op" id="4462396">]</span><span class="builtintype" id="4462397">byte</span><br>
<span class="lineno">25</span><span class="op" id="4462402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4462405">func</span>&nbsp;<span class="op" id="4462410">(</span><span class="ident" id="4462411">s</span>&nbsp;<span class="op" id="4462413">*</span><span class="ident" id="4462414">sessionState</span><span class="op" id="4462426">)</span>&nbsp;<span class="ident" id="4462428">equal</span><span class="op" id="4462433">(</span><span class="ident" id="4462434">i</span>&nbsp;<span class="keyword" id="4462436">interface</span><span class="op" id="4462445">{</span><span class="op" id="4462446">}</span><span class="op" id="4462447">)</span>&nbsp;<span class="builtintype" id="4462449">bool</span>&nbsp;<span class="op" id="4462454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4462457">s1</span><span class="op" id="4462459">,</span>&nbsp;<span class="ident" id="4462461">ok</span>&nbsp;<span class="op" id="4462464">:=</span>&nbsp;<span class="ident" id="4462467">i</span><span class="op" id="4462468">.</span><span class="op" id="4462469">(</span><span class="op" id="4462470">*</span><span class="ident" id="4462471">sessionState</span><span class="op" id="4462483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462486">if</span>&nbsp;<span class="op" id="4462489">!</span><span class="ident" id="4462490">ok</span>&nbsp;<span class="op" id="4462493">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462497">return</span>&nbsp;<span class="builtintype" id="4462504">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4462511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462515">if</span>&nbsp;<span class="ident" id="4462518">s</span><span class="op" id="4462519">.</span><span class="ident" id="4462520">vers</span>&nbsp;<span class="op" id="4462525">!=</span>&nbsp;<span class="ident" id="4462528">s1</span><span class="op" id="4462530">.</span><span class="ident" id="4462531">vers</span>&nbsp;<span class="op" id="4462536">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4462541">s</span><span class="op" id="4462542">.</span><span class="ident" id="4462543">cipherSuite</span>&nbsp;<span class="op" id="4462555">!=</span>&nbsp;<span class="ident" id="4462558">s1</span><span class="op" id="4462560">.</span><span class="ident" id="4462561">cipherSuite</span>&nbsp;<span class="op" id="4462573">||</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4462578">!</span><span class="ident" id="4462579">bytes</span><span class="op" id="4462584">.</span><span class="ident" id="4462585">Equal</span><span class="op" id="4462590">(</span><span class="ident" id="4462591">s</span><span class="op" id="4462592">.</span><span class="ident" id="4462593">masterSecret</span><span class="op" id="4462605">,</span>&nbsp;<span class="ident" id="4462607">s1</span><span class="op" id="4462609">.</span><span class="ident" id="4462610">masterSecret</span><span class="op" id="4462622">)</span>&nbsp;<span class="op" id="4462624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462628">return</span>&nbsp;<span class="builtintype" id="4462635">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4462642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462646">if</span>&nbsp;<span class="builtinfunc" id="4462649">len</span><span class="op" id="4462652">(</span><span class="ident" id="4462653">s</span><span class="op" id="4462654">.</span><span class="ident" id="4462655">certificates</span><span class="op" id="4462667">)</span>&nbsp;<span class="op" id="4462669">!=</span>&nbsp;<span class="builtinfunc" id="4462672">len</span><span class="op" id="4462675">(</span><span class="ident" id="4462676">s1</span><span class="op" id="4462678">.</span><span class="ident" id="4462679">certificates</span><span class="op" id="4462691">)</span>&nbsp;<span class="op" id="4462693">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462697">return</span>&nbsp;<span class="builtintype" id="4462704">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4462711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462715">for</span>&nbsp;<span class="ident" id="4462719">i</span>&nbsp;<span class="op" id="4462721">:=</span>&nbsp;<span class="keyword" id="4462724">range</span>&nbsp;<span class="ident" id="4462730">s</span><span class="op" id="4462731">.</span><span class="ident" id="4462732">certificates</span>&nbsp;<span class="op" id="4462745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462749">if</span>&nbsp;<span class="op" id="4462752">!</span><span class="ident" id="4462753">bytes</span><span class="op" id="4462758">.</span><span class="ident" id="4462759">Equal</span><span class="op" id="4462764">(</span><span class="ident" id="4462765">s</span><span class="op" id="4462766">.</span><span class="ident" id="4462767">certificates</span><span class="op" id="4462779">[</span><span class="ident" id="4462780">i</span><span class="op" id="4462781">]</span><span class="op" id="4462782">,</span>&nbsp;<span class="ident" id="4462784">s1</span><span class="op" id="4462786">.</span><span class="ident" id="4462787">certificates</span><span class="op" id="4462799">[</span><span class="ident" id="4462800">i</span><span class="op" id="4462801">]</span><span class="op" id="4462802">)</span>&nbsp;<span class="op" id="4462804">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462809">return</span>&nbsp;<span class="builtintype" id="4462816">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4462824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4462827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462831">return</span>&nbsp;<span class="builtintype" id="4462838">true</span><br>
<span class="lineno">50</span><span class="op" id="4462843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4462846">func</span>&nbsp;<span class="op" id="4462851">(</span><span class="ident" id="4462852">s</span>&nbsp;<span class="op" id="4462854">*</span><span class="ident" id="4462855">sessionState</span><span class="op" id="4462867">)</span>&nbsp;<span class="ident" id="4462869">marshal</span><span class="op" id="4462876">(</span><span class="op" id="4462877">)</span>&nbsp;<span class="op" id="4462879">[</span><span class="op" id="4462880">]</span><span class="builtintype" id="4462881">byte</span>&nbsp;<span class="op" id="4462886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4462889">length</span>&nbsp;<span class="op" id="4462896">:=</span>&nbsp;<span class="num" id="4462899">2</span>&nbsp;<span class="op" id="4462901">+</span>&nbsp;<span class="num" id="4462903">2</span>&nbsp;<span class="op" id="4462905">+</span>&nbsp;<span class="num" id="4462907">2</span>&nbsp;<span class="op" id="4462909">+</span>&nbsp;<span class="builtinfunc" id="4462911">len</span><span class="op" id="4462914">(</span><span class="ident" id="4462915">s</span><span class="op" id="4462916">.</span><span class="ident" id="4462917">masterSecret</span><span class="op" id="4462929">)</span>&nbsp;<span class="op" id="4462931">+</span>&nbsp;<span class="num" id="4462933">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462936">for</span>&nbsp;<span class="ident" id="4462940">_</span><span class="op" id="4462941">,</span>&nbsp;<span class="ident" id="4462943">cert</span>&nbsp;<span class="op" id="4462948">:=</span>&nbsp;<span class="keyword" id="4462951">range</span>&nbsp;<span class="ident" id="4462957">s</span><span class="op" id="4462958">.</span><span class="ident" id="4462959">certificates</span>&nbsp;<span class="op" id="4462972">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4462976">length</span>&nbsp;<span class="op" id="4462983">+=</span>&nbsp;<span class="num" id="4462986">4</span>&nbsp;<span class="op" id="4462988">+</span>&nbsp;<span class="builtinfunc" id="4462990">len</span><span class="op" id="4462993">(</span><span class="ident" id="4462994">cert</span><span class="op" id="4462998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4463001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463005">ret</span>&nbsp;<span class="op" id="4463009">:=</span>&nbsp;<span class="builtinfunc" id="4463012">make</span><span class="op" id="4463016">(</span><span class="op" id="4463017">[</span><span class="op" id="4463018">]</span><span class="builtintype" id="4463019">byte</span><span class="op" id="4463023">,</span>&nbsp;<span class="ident" id="4463025">length</span><span class="op" id="4463031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463034">x</span>&nbsp;<span class="op" id="4463036">:=</span>&nbsp;<span class="ident" id="4463039">ret</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463044">x</span><span class="op" id="4463045">[</span><span class="num" id="4463046">0</span><span class="op" id="4463047">]</span>&nbsp;<span class="op" id="4463049">=</span>&nbsp;<span class="builtintype" id="4463051">byte</span><span class="op" id="4463055">(</span><span class="ident" id="4463056">s</span><span class="op" id="4463057">.</span><span class="ident" id="4463058">vers</span>&nbsp;<span class="op" id="4463063">&gt;&gt;</span>&nbsp;<span class="num" id="4463066">8</span><span class="op" id="4463067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463070">x</span><span class="op" id="4463071">[</span><span class="num" id="4463072">1</span><span class="op" id="4463073">]</span>&nbsp;<span class="op" id="4463075">=</span>&nbsp;<span class="builtintype" id="4463077">byte</span><span class="op" id="4463081">(</span><span class="ident" id="4463082">s</span><span class="op" id="4463083">.</span><span class="ident" id="4463084">vers</span><span class="op" id="4463088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463091">x</span><span class="op" id="4463092">[</span><span class="num" id="4463093">2</span><span class="op" id="4463094">]</span>&nbsp;<span class="op" id="4463096">=</span>&nbsp;<span class="builtintype" id="4463098">byte</span><span class="op" id="4463102">(</span><span class="ident" id="4463103">s</span><span class="op" id="4463104">.</span><span class="ident" id="4463105">cipherSuite</span>&nbsp;<span class="op" id="4463117">&gt;&gt;</span>&nbsp;<span class="num" id="4463120">8</span><span class="op" id="4463121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463124">x</span><span class="op" id="4463125">[</span><span class="num" id="4463126">3</span><span class="op" id="4463127">]</span>&nbsp;<span class="op" id="4463129">=</span>&nbsp;<span class="builtintype" id="4463131">byte</span><span class="op" id="4463135">(</span><span class="ident" id="4463136">s</span><span class="op" id="4463137">.</span><span class="ident" id="4463138">cipherSuite</span><span class="op" id="4463149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463152">x</span><span class="op" id="4463153">[</span><span class="num" id="4463154">4</span><span class="op" id="4463155">]</span>&nbsp;<span class="op" id="4463157">=</span>&nbsp;<span class="builtintype" id="4463159">byte</span><span class="op" id="4463163">(</span><span class="builtinfunc" id="4463164">len</span><span class="op" id="4463167">(</span><span class="ident" id="4463168">s</span><span class="op" id="4463169">.</span><span class="ident" id="4463170">masterSecret</span><span class="op" id="4463182">)</span>&nbsp;<span class="op" id="4463184">&gt;&gt;</span>&nbsp;<span class="num" id="4463187">8</span><span class="op" id="4463188">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463191">x</span><span class="op" id="4463192">[</span><span class="num" id="4463193">5</span><span class="op" id="4463194">]</span>&nbsp;<span class="op" id="4463196">=</span>&nbsp;<span class="builtintype" id="4463198">byte</span><span class="op" id="4463202">(</span><span class="builtinfunc" id="4463203">len</span><span class="op" id="4463206">(</span><span class="ident" id="4463207">s</span><span class="op" id="4463208">.</span><span class="ident" id="4463209">masterSecret</span><span class="op" id="4463221">)</span><span class="op" id="4463222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463225">x</span>&nbsp;<span class="op" id="4463227">=</span>&nbsp;<span class="ident" id="4463229">x</span><span class="op" id="4463230">[</span><span class="num" id="4463231">6</span><span class="op" id="4463232">:</span><span class="op" id="4463233">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4463236">copy</span><span class="op" id="4463240">(</span><span class="ident" id="4463241">x</span><span class="op" id="4463242">,</span>&nbsp;<span class="ident" id="4463244">s</span><span class="op" id="4463245">.</span><span class="ident" id="4463246">masterSecret</span><span class="op" id="4463258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463261">x</span>&nbsp;<span class="op" id="4463263">=</span>&nbsp;<span class="ident" id="4463265">x</span><span class="op" id="4463266">[</span><span class="builtinfunc" id="4463267">len</span><span class="op" id="4463270">(</span><span class="ident" id="4463271">s</span><span class="op" id="4463272">.</span><span class="ident" id="4463273">masterSecret</span><span class="op" id="4463285">)</span><span class="op" id="4463286">:</span><span class="op" id="4463287">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463291">x</span><span class="op" id="4463292">[</span><span class="num" id="4463293">0</span><span class="op" id="4463294">]</span>&nbsp;<span class="op" id="4463296">=</span>&nbsp;<span class="builtintype" id="4463298">byte</span><span class="op" id="4463302">(</span><span class="builtinfunc" id="4463303">len</span><span class="op" id="4463306">(</span><span class="ident" id="4463307">s</span><span class="op" id="4463308">.</span><span class="ident" id="4463309">certificates</span><span class="op" id="4463321">)</span>&nbsp;<span class="op" id="4463323">&gt;&gt;</span>&nbsp;<span class="num" id="4463326">8</span><span class="op" id="4463327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463330">x</span><span class="op" id="4463331">[</span><span class="num" id="4463332">1</span><span class="op" id="4463333">]</span>&nbsp;<span class="op" id="4463335">=</span>&nbsp;<span class="builtintype" id="4463337">byte</span><span class="op" id="4463341">(</span><span class="builtinfunc" id="4463342">len</span><span class="op" id="4463345">(</span><span class="ident" id="4463346">s</span><span class="op" id="4463347">.</span><span class="ident" id="4463348">certificates</span><span class="op" id="4463360">)</span><span class="op" id="4463361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463364">x</span>&nbsp;<span class="op" id="4463366">=</span>&nbsp;<span class="ident" id="4463368">x</span><span class="op" id="4463369">[</span><span class="num" id="4463370">2</span><span class="op" id="4463371">:</span><span class="op" id="4463372">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4463376">for</span>&nbsp;<span class="ident" id="4463380">_</span><span class="op" id="4463381">,</span>&nbsp;<span class="ident" id="4463383">cert</span>&nbsp;<span class="op" id="4463388">:=</span>&nbsp;<span class="keyword" id="4463391">range</span>&nbsp;<span class="ident" id="4463397">s</span><span class="op" id="4463398">.</span><span class="ident" id="4463399">certificates</span>&nbsp;<span class="op" id="4463412">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463416">x</span><span class="op" id="4463417">[</span><span class="num" id="4463418">0</span><span class="op" id="4463419">]</span>&nbsp;<span class="op" id="4463421">=</span>&nbsp;<span class="builtintype" id="4463423">byte</span><span class="op" id="4463427">(</span><span class="builtinfunc" id="4463428">len</span><span class="op" id="4463431">(</span><span class="ident" id="4463432">cert</span><span class="op" id="4463436">)</span>&nbsp;<span class="op" id="4463438">&gt;&gt;</span>&nbsp;<span class="num" id="4463441">24</span><span class="op" id="4463443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463447">x</span><span class="op" id="4463448">[</span><span class="num" id="4463449">1</span><span class="op" id="4463450">]</span>&nbsp;<span class="op" id="4463452">=</span>&nbsp;<span class="builtintype" id="4463454">byte</span><span class="op" id="4463458">(</span><span class="builtinfunc" id="4463459">len</span><span class="op" id="4463462">(</span><span class="ident" id="4463463">cert</span><span class="op" id="4463467">)</span>&nbsp;<span class="op" id="4463469">&gt;&gt;</span>&nbsp;<span class="num" id="4463472">16</span><span class="op" id="4463474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463478">x</span><span class="op" id="4463479">[</span><span class="num" id="4463480">2</span><span class="op" id="4463481">]</span>&nbsp;<span class="op" id="4463483">=</span>&nbsp;<span class="builtintype" id="4463485">byte</span><span class="op" id="4463489">(</span><span class="builtinfunc" id="4463490">len</span><span class="op" id="4463493">(</span><span class="ident" id="4463494">cert</span><span class="op" id="4463498">)</span>&nbsp;<span class="op" id="4463500">&gt;&gt;</span>&nbsp;<span class="num" id="4463503">8</span><span class="op" id="4463504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463508">x</span><span class="op" id="4463509">[</span><span class="num" id="4463510">3</span><span class="op" id="4463511">]</span>&nbsp;<span class="op" id="4463513">=</span>&nbsp;<span class="builtintype" id="4463515">byte</span><span class="op" id="4463519">(</span><span class="builtinfunc" id="4463520">len</span><span class="op" id="4463523">(</span><span class="ident" id="4463524">cert</span><span class="op" id="4463528">)</span><span class="op" id="4463529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4463533">copy</span><span class="op" id="4463537">(</span><span class="ident" id="4463538">x</span><span class="op" id="4463539">[</span><span class="num" id="4463540">4</span><span class="op" id="4463541">:</span><span class="op" id="4463542">]</span><span class="op" id="4463543">,</span>&nbsp;<span class="ident" id="4463545">cert</span><span class="op" id="4463549">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463553">x</span>&nbsp;<span class="op" id="4463555">=</span>&nbsp;<span class="ident" id="4463557">x</span><span class="op" id="4463558">[</span><span class="num" id="4463559">4</span><span class="op" id="4463560">+</span><span class="builtinfunc" id="4463561">len</span><span class="op" id="4463564">(</span><span class="ident" id="4463565">cert</span><span class="op" id="4463569">)</span><span class="op" id="4463570">:</span><span class="op" id="4463571">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4463574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4463578">return</span>&nbsp;<span class="ident" id="4463585">ret</span><br>
<span class="lineno"></span><span class="op" id="4463589">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="4463592">func</span>&nbsp;<span class="op" id="4463597">(</span><span class="ident" id="4463598">s</span>&nbsp;<span class="op" id="4463600">*</span><span class="ident" id="4463601">sessionState</span><span class="op" id="4463613">)</span>&nbsp;<span class="ident" id="4463615">unmarshal</span><span class="op" id="4463624">(</span><span class="ident" id="4463625">data</span>&nbsp;<span class="op" id="4463630">[</span><span class="op" id="4463631">]</span><span class="builtintype" id="4463632">byte</span><span class="op" id="4463636">)</span>&nbsp;<span class="builtintype" id="4463638">bool</span>&nbsp;<span class="op" id="4463643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4463646">if</span>&nbsp;<span class="builtinfunc" id="4463649">len</span><span class="op" id="4463652">(</span><span class="ident" id="4463653">data</span><span class="op" id="4463657">)</span>&nbsp;<span class="op" id="4463659">&lt;</span>&nbsp;<span class="num" id="4463661">8</span>&nbsp;<span class="op" id="4463663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4463667">return</span>&nbsp;<span class="builtintype" id="4463674">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4463681">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463685">s</span><span class="op" id="4463686">.</span><span class="ident" id="4463687">vers</span>&nbsp;<span class="op" id="4463692">=</span>&nbsp;<span class="builtintype" id="4463694">uint16</span><span class="op" id="4463700">(</span><span class="ident" id="4463701">data</span><span class="op" id="4463705">[</span><span class="num" id="4463706">0</span><span class="op" id="4463707">]</span><span class="op" id="4463708">)</span><span class="op" id="4463709">&lt;&lt;</span><span class="num" id="4463711">8</span>&nbsp;<span class="op" id="4463713">|</span>&nbsp;<span class="builtintype" id="4463715">uint16</span><span class="op" id="4463721">(</span><span class="ident" id="4463722">data</span><span class="op" id="4463726">[</span><span class="num" id="4463727">1</span><span class="op" id="4463728">]</span><span class="op" id="4463729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463732">s</span><span class="op" id="4463733">.</span><span class="ident" id="4463734">cipherSuite</span>&nbsp;<span class="op" id="4463746">=</span>&nbsp;<span class="builtintype" id="4463748">uint16</span><span class="op" id="4463754">(</span><span class="ident" id="4463755">data</span><span class="op" id="4463759">[</span><span class="num" id="4463760">2</span><span class="op" id="4463761">]</span><span class="op" id="4463762">)</span><span class="op" id="4463763">&lt;&lt;</span><span class="num" id="4463765">8</span>&nbsp;<span class="op" id="4463767">|</span>&nbsp;<span class="builtintype" id="4463769">uint16</span><span class="op" id="4463775">(</span><span class="ident" id="4463776">data</span><span class="op" id="4463780">[</span><span class="num" id="4463781">3</span><span class="op" id="4463782">]</span><span class="op" id="4463783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463786">masterSecretLen</span>&nbsp;<span class="op" id="4463802">:=</span>&nbsp;<span class="builtintype" id="4463805">int</span><span class="op" id="4463808">(</span><span class="ident" id="4463809">data</span><span class="op" id="4463813">[</span><span class="num" id="4463814">4</span><span class="op" id="4463815">]</span><span class="op" id="4463816">)</span><span class="op" id="4463817">&lt;&lt;</span><span class="num" id="4463819">8</span>&nbsp;<span class="op" id="4463821">|</span>&nbsp;<span class="builtintype" id="4463823">int</span><span class="op" id="4463826">(</span><span class="ident" id="4463827">data</span><span class="op" id="4463831">[</span><span class="num" id="4463832">5</span><span class="op" id="4463833">]</span><span class="op" id="4463834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463837">data</span>&nbsp;<span class="op" id="4463842">=</span>&nbsp;<span class="ident" id="4463844">data</span><span class="op" id="4463848">[</span><span class="num" id="4463849">6</span><span class="op" id="4463850">:</span><span class="op" id="4463851">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4463854">if</span>&nbsp;<span class="builtinfunc" id="4463857">len</span><span class="op" id="4463860">(</span><span class="ident" id="4463861">data</span><span class="op" id="4463865">)</span>&nbsp;<span class="op" id="4463867">&lt;</span>&nbsp;<span class="ident" id="4463869">masterSecretLen</span>&nbsp;<span class="op" id="4463885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4463889">return</span>&nbsp;<span class="builtintype" id="4463896">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4463903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463907">s</span><span class="op" id="4463908">.</span><span class="ident" id="4463909">masterSecret</span>&nbsp;<span class="op" id="4463922">=</span>&nbsp;<span class="ident" id="4463924">data</span><span class="op" id="4463928">[</span><span class="op" id="4463929">:</span><span class="ident" id="4463930">masterSecretLen</span><span class="op" id="4463945">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463948">data</span>&nbsp;<span class="op" id="4463953">=</span>&nbsp;<span class="ident" id="4463955">data</span><span class="op" id="4463959">[</span><span class="ident" id="4463960">masterSecretLen</span><span class="op" id="4463975">:</span><span class="op" id="4463976">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4463980">if</span>&nbsp;<span class="builtinfunc" id="4463983">len</span><span class="op" id="4463986">(</span><span class="ident" id="4463987">data</span><span class="op" id="4463991">)</span>&nbsp;<span class="op" id="4463993">&lt;</span>&nbsp;<span class="num" id="4463995">2</span>&nbsp;<span class="op" id="4463997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464001">return</span>&nbsp;<span class="builtintype" id="4464008">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464015">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464019">numCerts</span>&nbsp;<span class="op" id="4464028">:=</span>&nbsp;<span class="builtintype" id="4464031">int</span><span class="op" id="4464034">(</span><span class="ident" id="4464035">data</span><span class="op" id="4464039">[</span><span class="num" id="4464040">0</span><span class="op" id="4464041">]</span><span class="op" id="4464042">)</span><span class="op" id="4464043">&lt;&lt;</span><span class="num" id="4464045">8</span>&nbsp;<span class="op" id="4464047">|</span>&nbsp;<span class="builtintype" id="4464049">int</span><span class="op" id="4464052">(</span><span class="ident" id="4464053">data</span><span class="op" id="4464057">[</span><span class="num" id="4464058">1</span><span class="op" id="4464059">]</span><span class="op" id="4464060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464063">data</span>&nbsp;<span class="op" id="4464068">=</span>&nbsp;<span class="ident" id="4464070">data</span><span class="op" id="4464074">[</span><span class="num" id="4464075">2</span><span class="op" id="4464076">:</span><span class="op" id="4464077">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464081">s</span><span class="op" id="4464082">.</span><span class="ident" id="4464083">certificates</span>&nbsp;<span class="op" id="4464096">=</span>&nbsp;<span class="builtinfunc" id="4464098">make</span><span class="op" id="4464102">(</span><span class="op" id="4464103">[</span><span class="op" id="4464104">]</span><span class="op" id="4464105">[</span><span class="op" id="4464106">]</span><span class="builtintype" id="4464107">byte</span><span class="op" id="4464111">,</span>&nbsp;<span class="ident" id="4464113">numCerts</span><span class="op" id="4464121">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464124">for</span>&nbsp;<span class="ident" id="4464128">i</span>&nbsp;<span class="op" id="4464130">:=</span>&nbsp;<span class="keyword" id="4464133">range</span>&nbsp;<span class="ident" id="4464139">s</span><span class="op" id="4464140">.</span><span class="ident" id="4464141">certificates</span>&nbsp;<span class="op" id="4464154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464158">if</span>&nbsp;<span class="builtinfunc" id="4464161">len</span><span class="op" id="4464164">(</span><span class="ident" id="4464165">data</span><span class="op" id="4464169">)</span>&nbsp;<span class="op" id="4464171">&lt;</span>&nbsp;<span class="num" id="4464173">4</span>&nbsp;<span class="op" id="4464175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464180">return</span>&nbsp;<span class="builtintype" id="4464187">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464199">certLen</span>&nbsp;<span class="op" id="4464207">:=</span>&nbsp;<span class="builtintype" id="4464210">int</span><span class="op" id="4464213">(</span><span class="ident" id="4464214">data</span><span class="op" id="4464218">[</span><span class="num" id="4464219">0</span><span class="op" id="4464220">]</span><span class="op" id="4464221">)</span><span class="op" id="4464222">&lt;&lt;</span><span class="num" id="4464224">24</span>&nbsp;<span class="op" id="4464227">|</span>&nbsp;<span class="builtintype" id="4464229">int</span><span class="op" id="4464232">(</span><span class="ident" id="4464233">data</span><span class="op" id="4464237">[</span><span class="num" id="4464238">1</span><span class="op" id="4464239">]</span><span class="op" id="4464240">)</span><span class="op" id="4464241">&lt;&lt;</span><span class="num" id="4464243">16</span>&nbsp;<span class="op" id="4464246">|</span>&nbsp;<span class="builtintype" id="4464248">int</span><span class="op" id="4464251">(</span><span class="ident" id="4464252">data</span><span class="op" id="4464256">[</span><span class="num" id="4464257">2</span><span class="op" id="4464258">]</span><span class="op" id="4464259">)</span><span class="op" id="4464260">&lt;&lt;</span><span class="num" id="4464262">8</span>&nbsp;<span class="op" id="4464264">|</span>&nbsp;<span class="builtintype" id="4464266">int</span><span class="op" id="4464269">(</span><span class="ident" id="4464270">data</span><span class="op" id="4464274">[</span><span class="num" id="4464275">3</span><span class="op" id="4464276">]</span><span class="op" id="4464277">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464281">data</span>&nbsp;<span class="op" id="4464286">=</span>&nbsp;<span class="ident" id="4464288">data</span><span class="op" id="4464292">[</span><span class="num" id="4464293">4</span><span class="op" id="4464294">:</span><span class="op" id="4464295">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464299">if</span>&nbsp;<span class="ident" id="4464302">certLen</span>&nbsp;<span class="op" id="4464310">&lt;</span>&nbsp;<span class="num" id="4464312">0</span>&nbsp;<span class="op" id="4464314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464319">return</span>&nbsp;<span class="builtintype" id="4464326">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464338">if</span>&nbsp;<span class="builtinfunc" id="4464341">len</span><span class="op" id="4464344">(</span><span class="ident" id="4464345">data</span><span class="op" id="4464349">)</span>&nbsp;<span class="op" id="4464351">&lt;</span>&nbsp;<span class="ident" id="4464353">certLen</span>&nbsp;<span class="op" id="4464361">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464366">return</span>&nbsp;<span class="builtintype" id="4464373">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464385">s</span><span class="op" id="4464386">.</span><span class="ident" id="4464387">certificates</span><span class="op" id="4464399">[</span><span class="ident" id="4464400">i</span><span class="op" id="4464401">]</span>&nbsp;<span class="op" id="4464403">=</span>&nbsp;<span class="ident" id="4464405">data</span><span class="op" id="4464409">[</span><span class="op" id="4464410">:</span><span class="ident" id="4464411">certLen</span><span class="op" id="4464418">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464422">data</span>&nbsp;<span class="op" id="4464427">=</span>&nbsp;<span class="ident" id="4464429">data</span><span class="op" id="4464433">[</span><span class="ident" id="4464434">certLen</span><span class="op" id="4464441">:</span><span class="op" id="4464442">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464445">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464449">if</span>&nbsp;<span class="builtinfunc" id="4464452">len</span><span class="op" id="4464455">(</span><span class="ident" id="4464456">data</span><span class="op" id="4464460">)</span>&nbsp;<span class="op" id="4464462">&gt;</span>&nbsp;<span class="num" id="4464464">0</span>&nbsp;<span class="op" id="4464466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464470">return</span>&nbsp;<span class="builtintype" id="4464477">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464488">return</span>&nbsp;<span class="builtintype" id="4464495">true</span><br>
<span class="lineno"></span><span class="op" id="4464500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4464503">func</span>&nbsp;<span class="op" id="4464508">(</span><span class="ident" id="4464509">c</span>&nbsp;<span class="op" id="4464511">*</span><span class="ident" id="4464512">Conn</span><span class="op" id="4464516">)</span>&nbsp;<span class="ident" id="4464518">encryptTicket</span><span class="op" id="4464531">(</span><span class="ident" id="4464532">state</span>&nbsp;<span class="op" id="4464538">*</span><span class="ident" id="4464539">sessionState</span><span class="op" id="4464551">)</span>&nbsp;<span class="op" id="4464553">(</span><span class="op" id="4464554">[</span><span class="op" id="4464555">]</span><span class="builtintype" id="4464556">byte</span><span class="op" id="4464560">,</span>&nbsp;<span class="builtintype" id="4464562">error</span><span class="op" id="4464567">)</span>&nbsp;<span class="op" id="4464569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464572">serialized</span>&nbsp;<span class="op" id="4464583">:=</span>&nbsp;<span class="ident" id="4464586">state</span><span class="op" id="4464591">.</span><span class="ident" id="4464592">marshal</span><span class="op" id="4464599">(</span><span class="op" id="4464600">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464603">encrypted</span>&nbsp;<span class="op" id="4464613">:=</span>&nbsp;<span class="builtinfunc" id="4464616">make</span><span class="op" id="4464620">(</span><span class="op" id="4464621">[</span><span class="op" id="4464622">]</span><span class="builtintype" id="4464623">byte</span><span class="op" id="4464627">,</span>&nbsp;<span class="ident" id="4464629">aes</span><span class="op" id="4464632">.</span><span class="ident" id="4464633">BlockSize</span><span class="op" id="4464642">+</span><span class="builtinfunc" id="4464643">len</span><span class="op" id="4464646">(</span><span class="ident" id="4464647">serialized</span><span class="op" id="4464657">)</span><span class="op" id="4464658">+</span><span class="ident" id="4464659">sha256</span><span class="op" id="4464665">.</span><span class="ident" id="4464666">Size</span><span class="op" id="4464670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464673">iv</span>&nbsp;<span class="op" id="4464676">:=</span>&nbsp;<span class="ident" id="4464679">encrypted</span><span class="op" id="4464688">[</span><span class="op" id="4464689">:</span><span class="ident" id="4464690">aes</span><span class="op" id="4464693">.</span><span class="ident" id="4464694">BlockSize</span><span class="op" id="4464703">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464706">macBytes</span>&nbsp;<span class="op" id="4464715">:=</span>&nbsp;<span class="ident" id="4464718">encrypted</span><span class="op" id="4464727">[</span><span class="builtinfunc" id="4464728">len</span><span class="op" id="4464731">(</span><span class="ident" id="4464732">encrypted</span><span class="op" id="4464741">)</span><span class="op" id="4464742">-</span><span class="ident" id="4464743">sha256</span><span class="op" id="4464749">.</span><span class="ident" id="4464750">Size</span><span class="op" id="4464754">:</span><span class="op" id="4464755">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464759">if</span>&nbsp;<span class="ident" id="4464762">_</span><span class="op" id="4464763">,</span>&nbsp;<span class="ident" id="4464765">err</span>&nbsp;<span class="op" id="4464769">:=</span>&nbsp;<span class="ident" id="4464772">io</span><span class="op" id="4464774">.</span><span class="ident" id="4464775">ReadFull</span><span class="op" id="4464783">(</span><span class="ident" id="4464784">c</span><span class="op" id="4464785">.</span><span class="ident" id="4464786">config</span><span class="op" id="4464792">.</span><span class="ident" id="4464793">rand</span><span class="op" id="4464797">(</span><span class="op" id="4464798">)</span><span class="op" id="4464799">,</span>&nbsp;<span class="ident" id="4464801">iv</span><span class="op" id="4464803">)</span><span class="op" id="4464804">;</span>&nbsp;<span class="ident" id="4464806">err</span>&nbsp;<span class="op" id="4464810">!=</span>&nbsp;<span class="builtintype" id="4464813">nil</span>&nbsp;<span class="op" id="4464817">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464821">return</span>&nbsp;<span class="builtintype" id="4464828">nil</span><span class="op" id="4464831">,</span>&nbsp;<span class="ident" id="4464833">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464841">block</span><span class="op" id="4464846">,</span>&nbsp;<span class="ident" id="4464848">err</span>&nbsp;<span class="op" id="4464852">:=</span>&nbsp;<span class="ident" id="4464855">aes</span><span class="op" id="4464858">.</span><span class="ident" id="4464859">NewCipher</span><span class="op" id="4464868">(</span><span class="ident" id="4464869">c</span><span class="op" id="4464870">.</span><span class="ident" id="4464871">config</span><span class="op" id="4464877">.</span><span class="ident" id="4464878">SessionTicketKey</span><span class="op" id="4464894">[</span><span class="op" id="4464895">:</span><span class="num" id="4464896">16</span><span class="op" id="4464898">]</span><span class="op" id="4464899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464902">if</span>&nbsp;<span class="ident" id="4464905">err</span>&nbsp;<span class="op" id="4464909">!=</span>&nbsp;<span class="builtintype" id="4464912">nil</span>&nbsp;<span class="op" id="4464916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464920">return</span>&nbsp;<span class="builtintype" id="4464927">nil</span><span class="op" id="4464930">,</span>&nbsp;<span class="ident" id="4464932">errors</span><span class="op" id="4464938">.</span><span class="ident" id="4464939">New</span><span class="op" id="4464942">(</span><span class="string" id="4464943">&#34;tls:&nbsp;failed&nbsp;to&nbsp;create&nbsp;cipher&nbsp;while&nbsp;encrypting&nbsp;ticket:&nbsp;&#34;</span>&nbsp;<span class="op" id="4465000">+</span>&nbsp;<span class="ident" id="4465002">err</span><span class="op" id="4465005">.</span><span class="ident" id="4465006">Error</span><span class="op" id="4465011">(</span><span class="op" id="4465012">)</span><span class="op" id="4465013">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4465016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465019">cipher</span><span class="op" id="4465025">.</span><span class="ident" id="4465026">NewCTR</span><span class="op" id="4465032">(</span><span class="ident" id="4465033">block</span><span class="op" id="4465038">,</span>&nbsp;<span class="ident" id="4465040">iv</span><span class="op" id="4465042">)</span><span class="op" id="4465043">.</span><span class="ident" id="4465044">XORKeyStream</span><span class="op" id="4465056">(</span><span class="ident" id="4465057">encrypted</span><span class="op" id="4465066">[</span><span class="ident" id="4465067">aes</span><span class="op" id="4465070">.</span><span class="ident" id="4465071">BlockSize</span><span class="op" id="4465080">:</span><span class="op" id="4465081">]</span><span class="op" id="4465082">,</span>&nbsp;<span class="ident" id="4465084">serialized</span><span class="op" id="4465094">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465098">mac</span>&nbsp;<span class="op" id="4465102">:=</span>&nbsp;<span class="ident" id="4465105">hmac</span><span class="op" id="4465109">.</span><span class="ident" id="4465110">New</span><span class="op" id="4465113">(</span><span class="ident" id="4465114">sha256</span><span class="op" id="4465120">.</span><span class="ident" id="4465121">New</span><span class="op" id="4465124">,</span>&nbsp;<span class="ident" id="4465126">c</span><span class="op" id="4465127">.</span><span class="ident" id="4465128">config</span><span class="op" id="4465134">.</span><span class="ident" id="4465135">SessionTicketKey</span><span class="op" id="4465151">[</span><span class="num" id="4465152">16</span><span class="op" id="4465154">:</span><span class="num" id="4465155">32</span><span class="op" id="4465157">]</span><span class="op" id="4465158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465161">mac</span><span class="op" id="4465164">.</span><span class="ident" id="4465165">Write</span><span class="op" id="4465170">(</span><span class="ident" id="4465171">encrypted</span><span class="op" id="4465180">[</span><span class="op" id="4465181">:</span><span class="builtinfunc" id="4465182">len</span><span class="op" id="4465185">(</span><span class="ident" id="4465186">encrypted</span><span class="op" id="4465195">)</span><span class="op" id="4465196">-</span><span class="ident" id="4465197">sha256</span><span class="op" id="4465203">.</span><span class="ident" id="4465204">Size</span><span class="op" id="4465208">]</span><span class="op" id="4465209">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465212">mac</span><span class="op" id="4465215">.</span><span class="ident" id="4465216">Sum</span><span class="op" id="4465219">(</span><span class="ident" id="4465220">macBytes</span><span class="op" id="4465228">[</span><span class="op" id="4465229">:</span><span class="num" id="4465230">0</span><span class="op" id="4465231">]</span><span class="op" id="4465232">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4465236">return</span>&nbsp;<span class="ident" id="4465243">encrypted</span><span class="op" id="4465252">,</span>&nbsp;<span class="builtintype" id="4465254">nil</span><br>
<span class="lineno"></span><span class="op" id="4465258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="4465261">func</span>&nbsp;<span class="op" id="4465266">(</span><span class="ident" id="4465267">c</span>&nbsp;<span class="op" id="4465269">*</span><span class="ident" id="4465270">Conn</span><span class="op" id="4465274">)</span>&nbsp;<span class="ident" id="4465276">decryptTicket</span><span class="op" id="4465289">(</span><span class="ident" id="4465290">encrypted</span>&nbsp;<span class="op" id="4465300">[</span><span class="op" id="4465301">]</span><span class="builtintype" id="4465302">byte</span><span class="op" id="4465306">)</span>&nbsp;<span class="op" id="4465308">(</span><span class="op" id="4465309">*</span><span class="ident" id="4465310">sessionState</span><span class="op" id="4465322">,</span>&nbsp;<span class="builtintype" id="4465324">bool</span><span class="op" id="4465328">)</span>&nbsp;<span class="op" id="4465330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4465333">if</span>&nbsp;<span class="ident" id="4465336">c</span><span class="op" id="4465337">.</span><span class="ident" id="4465338">config</span><span class="op" id="4465344">.</span><span class="ident" id="4465345">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4465368">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4465373">len</span><span class="op" id="4465376">(</span><span class="ident" id="4465377">encrypted</span><span class="op" id="4465386">)</span>&nbsp;<span class="op" id="4465388">&lt;</span>&nbsp;<span class="ident" id="4465390">aes</span><span class="op" id="4465393">.</span><span class="ident" id="4465394">BlockSize</span><span class="op" id="4465403">+</span><span class="ident" id="4465404">sha256</span><span class="op" id="4465410">.</span><span class="ident" id="4465411">Size</span>&nbsp;<span class="op" id="4465416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4465420">return</span>&nbsp;<span class="builtintype" id="4465427">nil</span><span class="op" id="4465430">,</span>&nbsp;<span class="builtintype" id="4465432">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4465439">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465443">iv</span>&nbsp;<span class="op" id="4465446">:=</span>&nbsp;<span class="ident" id="4465449">encrypted</span><span class="op" id="4465458">[</span><span class="op" id="4465459">:</span><span class="ident" id="4465460">aes</span><span class="op" id="4465463">.</span><span class="ident" id="4465464">BlockSize</span><span class="op" id="4465473">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465476">macBytes</span>&nbsp;<span class="op" id="4465485">:=</span>&nbsp;<span class="ident" id="4465488">encrypted</span><span class="op" id="4465497">[</span><span class="builtinfunc" id="4465498">len</span><span class="op" id="4465501">(</span><span class="ident" id="4465502">encrypted</span><span class="op" id="4465511">)</span><span class="op" id="4465512">-</span><span class="ident" id="4465513">sha256</span><span class="op" id="4465519">.</span><span class="ident" id="4465520">Size</span><span class="op" id="4465524">:</span><span class="op" id="4465525">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465529">mac</span>&nbsp;<span class="op" id="4465533">:=</span>&nbsp;<span class="ident" id="4465536">hmac</span><span class="op" id="4465540">.</span><span class="ident" id="4465541">New</span><span class="op" id="4465544">(</span><span class="ident" id="4465545">sha256</span><span class="op" id="4465551">.</span><span class="ident" id="4465552">New</span><span class="op" id="4465555">,</span>&nbsp;<span class="ident" id="4465557">c</span><span class="op" id="4465558">.</span><span class="ident" id="4465559">config</span><span class="op" id="4465565">.</span><span class="ident" id="4465566">SessionTicketKey</span><span class="op" id="4465582">[</span><span class="num" id="4465583">16</span><span class="op" id="4465585">:</span><span class="num" id="4465586">32</span><span class="op" id="4465588">]</span><span class="op" id="4465589">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465592">mac</span><span class="op" id="4465595">.</span><span class="ident" id="4465596">Write</span><span class="op" id="4465601">(</span><span class="ident" id="4465602">encrypted</span><span class="op" id="4465611">[</span><span class="op" id="4465612">:</span><span class="builtinfunc" id="4465613">len</span><span class="op" id="4465616">(</span><span class="ident" id="4465617">encrypted</span><span class="op" id="4465626">)</span><span class="op" id="4465627">-</span><span class="ident" id="4465628">sha256</span><span class="op" id="4465634">.</span><span class="ident" id="4465635">Size</span><span class="op" id="4465639">]</span><span class="op" id="4465640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465643">expected</span>&nbsp;<span class="op" id="4465652">:=</span>&nbsp;<span class="ident" id="4465655">mac</span><span class="op" id="4465658">.</span><span class="ident" id="4465659">Sum</span><span class="op" id="4465662">(</span><span class="builtintype" id="4465663">nil</span><span class="op" id="4465666">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4465670">if</span>&nbsp;<span class="ident" id="4465673">subtle</span><span class="op" id="4465679">.</span><span class="ident" id="4465680">ConstantTimeCompare</span><span class="op" id="4465699">(</span><span class="ident" id="4465700">macBytes</span><span class="op" id="4465708">,</span>&nbsp;<span class="ident" id="4465710">expected</span><span class="op" id="4465718">)</span>&nbsp;<span class="op" id="4465720">!=</span>&nbsp;<span class="num" id="4465723">1</span>&nbsp;<span class="op" id="4465725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4465729">return</span>&nbsp;<span class="builtintype" id="4465736">nil</span><span class="op" id="4465739">,</span>&nbsp;<span class="builtintype" id="4465741">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4465748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465752">block</span><span class="op" id="4465757">,</span>&nbsp;<span class="ident" id="4465759">err</span>&nbsp;<span class="op" id="4465763">:=</span>&nbsp;<span class="ident" id="4465766">aes</span><span class="op" id="4465769">.</span><span class="ident" id="4465770">NewCipher</span><span class="op" id="4465779">(</span><span class="ident" id="4465780">c</span><span class="op" id="4465781">.</span><span class="ident" id="4465782">config</span><span class="op" id="4465788">.</span><span class="ident" id="4465789">SessionTicketKey</span><span class="op" id="4465805">[</span><span class="op" id="4465806">:</span><span class="num" id="4465807">16</span><span class="op" id="4465809">]</span><span class="op" id="4465810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4465813">if</span>&nbsp;<span class="ident" id="4465816">err</span>&nbsp;<span class="op" id="4465820">!=</span>&nbsp;<span class="builtintype" id="4465823">nil</span>&nbsp;<span class="op" id="4465827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4465831">return</span>&nbsp;<span class="builtintype" id="4465838">nil</span><span class="op" id="4465841">,</span>&nbsp;<span class="builtintype" id="4465843">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4465850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465853">ciphertext</span>&nbsp;<span class="op" id="4465864">:=</span>&nbsp;<span class="ident" id="4465867">encrypted</span><span class="op" id="4465876">[</span><span class="ident" id="4465877">aes</span><span class="op" id="4465880">.</span><span class="ident" id="4465881">BlockSize</span>&nbsp;<span class="op" id="4465891">:</span>&nbsp;<span class="builtinfunc" id="4465893">len</span><span class="op" id="4465896">(</span><span class="ident" id="4465897">encrypted</span><span class="op" id="4465906">)</span><span class="op" id="4465907">-</span><span class="ident" id="4465908">sha256</span><span class="op" id="4465914">.</span><span class="ident" id="4465915">Size</span><span class="op" id="4465919">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465922">plaintext</span>&nbsp;<span class="op" id="4465932">:=</span>&nbsp;<span class="ident" id="4465935">ciphertext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465947">cipher</span><span class="op" id="4465953">.</span><span class="ident" id="4465954">NewCTR</span><span class="op" id="4465960">(</span><span class="ident" id="4465961">block</span><span class="op" id="4465966">,</span>&nbsp;<span class="ident" id="4465968">iv</span><span class="op" id="4465970">)</span><span class="op" id="4465971">.</span><span class="ident" id="4465972">XORKeyStream</span><span class="op" id="4465984">(</span><span class="ident" id="4465985">plaintext</span><span class="op" id="4465994">,</span>&nbsp;<span class="ident" id="4465996">ciphertext</span><span class="op" id="4466006">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466010">state</span>&nbsp;<span class="op" id="4466016">:=</span>&nbsp;<span class="builtinfunc" id="4466019">new</span><span class="op" id="4466022">(</span><span class="ident" id="4466023">sessionState</span><span class="op" id="4466035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466038">ok</span>&nbsp;<span class="op" id="4466041">:=</span>&nbsp;<span class="ident" id="4466044">state</span><span class="op" id="4466049">.</span><span class="ident" id="4466050">unmarshal</span><span class="op" id="4466059">(</span><span class="ident" id="4466060">plaintext</span><span class="op" id="4466069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4466072">return</span>&nbsp;<span class="ident" id="4466079">state</span><span class="op" id="4466084">,</span>&nbsp;<span class="ident" id="4466086">ok</span><br>
<span class="lineno"></span><span class="op" id="4466089">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
