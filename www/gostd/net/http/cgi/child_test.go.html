<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6991123">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6991178">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6991232">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6991283">//&nbsp;Tests&nbsp;for&nbsp;CGI&nbsp;(the&nbsp;child&nbsp;process&nbsp;perspective)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6991333">package</span>&nbsp;<span class="ident" id="6991341">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6991346">import</span>&nbsp;<span class="op" id="6991353">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6991356">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6991366">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6991369">func</span>&nbsp;<span class="ident" id="6991374">TestRequest</span><span class="op" id="6991385">(</span><span class="ident" id="6991386">t</span>&nbsp;<span class="op" id="6991388">*</span><span class="ident" id="6991389">testing</span><span class="op" id="6991396">.</span><span class="ident" id="6991397">T</span><span class="op" id="6991398">)</span>&nbsp;<span class="op" id="6991400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6991403">env</span>&nbsp;<span class="op" id="6991407">:=</span>&nbsp;<span class="keyword" id="6991410">map</span><span class="op" id="6991413">[</span><span class="builtintype" id="6991414">string</span><span class="op" id="6991420">]</span><span class="builtintype" id="6991421">string</span><span class="op" id="6991427">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6991431">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6991448">:</span>&nbsp;<span class="string" id="6991450">&#34;HTTP/1.1&#34;</span><span class="op" id="6991460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6991464">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6991480">:</span>&nbsp;&nbsp;<span class="string" id="6991483">&#34;GET&#34;</span><span class="op" id="6991488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6991492">&#34;HTTP_HOST&#34;</span><span class="op" id="6991503">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6991511">&#34;example.com&#34;</span><span class="op" id="6991524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6991528">&#34;HTTP_REFERER&#34;</span><span class="op" id="6991542">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6991547">&#34;elsewhere&#34;</span><span class="op" id="6991558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6991562">&#34;HTTP_USER_AGENT&#34;</span><span class="op" id="6991579">:</span>&nbsp;<span class="string" id="6991581">&#34;goclient&#34;</span><span class="op" id="6991591">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6991595">&#34;HTTP_FOO_BAR&#34;</span><span class="op" id="6991609">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6991614">&#34;baz&#34;</span><span class="op" id="6991619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6991623">&#34;REQUEST_URI&#34;</span><span class="op" id="6991636">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6991642">&#34;/path?a=b&#34;</span><span class="op" id="6991653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6991657">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6991673">:</span>&nbsp;&nbsp;<span class="string" id="6991676">&#34;123&#34;</span><span class="op" id="6991681">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6991685">&#34;CONTENT_TYPE&#34;</span><span class="op" id="6991699">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6991704">&#34;text/xml&#34;</span><span class="op" id="6991714">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6991718">&#34;REMOTE_ADDR&#34;</span><span class="op" id="6991731">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6991737">&#34;5.6.7.8&#34;</span><span class="op" id="6991746">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6991749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6991752">req</span><span class="op" id="6991755">,</span>&nbsp;<span class="ident" id="6991757">err</span>&nbsp;<span class="op" id="6991761">:=</span>&nbsp;<span class="ident" id="6991764">RequestFromMap</span><span class="op" id="6991778">(</span><span class="ident" id="6991779">env</span><span class="op" id="6991782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6991785">if</span>&nbsp;<span class="ident" id="6991788">err</span>&nbsp;<span class="op" id="6991792">!=</span>&nbsp;<span class="ident" id="6991795">nil</span>&nbsp;<span class="op" id="6991799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6991803">t</span><span class="op" id="6991804">.</span><span class="ident" id="6991805">Fatalf</span><span class="op" id="6991811">(</span><span class="string" id="6991812">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6991832">,</span>&nbsp;<span class="ident" id="6991834">err</span><span class="op" id="6991837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6991840">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6991843">if</span>&nbsp;<span class="ident" id="6991846">g</span><span class="op" id="6991847">,</span>&nbsp;<span class="ident" id="6991849">e</span>&nbsp;<span class="op" id="6991851">:=</span>&nbsp;<span class="ident" id="6991854">req</span><span class="op" id="6991857">.</span><span class="ident" id="6991858">UserAgent</span><span class="op" id="6991867">(</span><span class="op" id="6991868">)</span><span class="op" id="6991869">,</span>&nbsp;<span class="string" id="6991871">&#34;goclient&#34;</span><span class="op" id="6991881">;</span>&nbsp;<span class="ident" id="6991883">e</span>&nbsp;<span class="op" id="6991885">!=</span>&nbsp;<span class="ident" id="6991888">g</span>&nbsp;<span class="op" id="6991890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6991894">t</span><span class="op" id="6991895">.</span><span class="ident" id="6991896">Errorf</span><span class="op" id="6991902">(</span><span class="string" id="6991903">&#34;expected&nbsp;UserAgent&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6991934">,</span>&nbsp;<span class="ident" id="6991936">e</span><span class="op" id="6991937">,</span>&nbsp;<span class="ident" id="6991939">g</span><span class="op" id="6991940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6991943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6991946">if</span>&nbsp;<span class="ident" id="6991949">g</span><span class="op" id="6991950">,</span>&nbsp;<span class="ident" id="6991952">e</span>&nbsp;<span class="op" id="6991954">:=</span>&nbsp;<span class="ident" id="6991957">req</span><span class="op" id="6991960">.</span><span class="ident" id="6991961">Method</span><span class="op" id="6991967">,</span>&nbsp;<span class="string" id="6991969">&#34;GET&#34;</span><span class="op" id="6991974">;</span>&nbsp;<span class="ident" id="6991976">e</span>&nbsp;<span class="op" id="6991978">!=</span>&nbsp;<span class="ident" id="6991981">g</span>&nbsp;<span class="op" id="6991983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6991987">t</span><span class="op" id="6991988">.</span><span class="ident" id="6991989">Errorf</span><span class="op" id="6991995">(</span><span class="string" id="6991996">&#34;expected&nbsp;Method&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6992024">,</span>&nbsp;<span class="ident" id="6992026">e</span><span class="op" id="6992027">,</span>&nbsp;<span class="ident" id="6992029">g</span><span class="op" id="6992030">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6992033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6992036">if</span>&nbsp;<span class="ident" id="6992039">g</span><span class="op" id="6992040">,</span>&nbsp;<span class="ident" id="6992042">e</span>&nbsp;<span class="op" id="6992044">:=</span>&nbsp;<span class="ident" id="6992047">req</span><span class="op" id="6992050">.</span><span class="ident" id="6992051">Header</span><span class="op" id="6992057">.</span><span class="ident" id="6992058">Get</span><span class="op" id="6992061">(</span><span class="string" id="6992062">&#34;Content-Type&#34;</span><span class="op" id="6992076">)</span><span class="op" id="6992077">,</span>&nbsp;<span class="string" id="6992079">&#34;text/xml&#34;</span><span class="op" id="6992089">;</span>&nbsp;<span class="ident" id="6992091">e</span>&nbsp;<span class="op" id="6992093">!=</span>&nbsp;<span class="ident" id="6992096">g</span>&nbsp;<span class="op" id="6992098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6992102">t</span><span class="op" id="6992103">.</span><span class="ident" id="6992104">Errorf</span><span class="op" id="6992110">(</span><span class="string" id="6992111">&#34;expected&nbsp;Content-Type&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6992145">,</span>&nbsp;<span class="ident" id="6992147">e</span><span class="op" id="6992148">,</span>&nbsp;<span class="ident" id="6992150">g</span><span class="op" id="6992151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6992154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6992157">if</span>&nbsp;<span class="ident" id="6992160">g</span><span class="op" id="6992161">,</span>&nbsp;<span class="ident" id="6992163">e</span>&nbsp;<span class="op" id="6992165">:=</span>&nbsp;<span class="ident" id="6992168">req</span><span class="op" id="6992171">.</span><span class="ident" id="6992172">ContentLength</span><span class="op" id="6992185">,</span>&nbsp;<span class="ident" id="6992187">int64</span><span class="op" id="6992192">(</span><span class="num" id="6992193">123</span><span class="op" id="6992196">)</span><span class="op" id="6992197">;</span>&nbsp;<span class="ident" id="6992199">e</span>&nbsp;<span class="op" id="6992201">!=</span>&nbsp;<span class="ident" id="6992204">g</span>&nbsp;<span class="op" id="6992206">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6992210">t</span><span class="op" id="6992211">.</span><span class="ident" id="6992212">Errorf</span><span class="op" id="6992218">(</span><span class="string" id="6992219">&#34;expected&nbsp;ContentLength&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6992254">,</span>&nbsp;<span class="ident" id="6992256">e</span><span class="op" id="6992257">,</span>&nbsp;<span class="ident" id="6992259">g</span><span class="op" id="6992260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6992263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6992266">if</span>&nbsp;<span class="ident" id="6992269">g</span><span class="op" id="6992270">,</span>&nbsp;<span class="ident" id="6992272">e</span>&nbsp;<span class="op" id="6992274">:=</span>&nbsp;<span class="ident" id="6992277">req</span><span class="op" id="6992280">.</span><span class="ident" id="6992281">Referer</span><span class="op" id="6992288">(</span><span class="op" id="6992289">)</span><span class="op" id="6992290">,</span>&nbsp;<span class="string" id="6992292">&#34;elsewhere&#34;</span><span class="op" id="6992303">;</span>&nbsp;<span class="ident" id="6992305">e</span>&nbsp;<span class="op" id="6992307">!=</span>&nbsp;<span class="ident" id="6992310">g</span>&nbsp;<span class="op" id="6992312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6992316">t</span><span class="op" id="6992317">.</span><span class="ident" id="6992318">Errorf</span><span class="op" id="6992324">(</span><span class="string" id="6992325">&#34;expected&nbsp;Referer&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6992354">,</span>&nbsp;<span class="ident" id="6992356">e</span><span class="op" id="6992357">,</span>&nbsp;<span class="ident" id="6992359">g</span><span class="op" id="6992360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6992363">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6992366">if</span>&nbsp;<span class="ident" id="6992369">req</span><span class="op" id="6992372">.</span><span class="ident" id="6992373">Header</span>&nbsp;<span class="op" id="6992380">==</span>&nbsp;<span class="ident" id="6992383">nil</span>&nbsp;<span class="op" id="6992387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6992391">t</span><span class="op" id="6992392">.</span><span class="ident" id="6992393">Fatalf</span><span class="op" id="6992399">(</span><span class="string" id="6992400">&#34;unexpected&nbsp;nil&nbsp;Header&#34;</span><span class="op" id="6992423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6992426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6992429">if</span>&nbsp;<span class="ident" id="6992432">g</span><span class="op" id="6992433">,</span>&nbsp;<span class="ident" id="6992435">e</span>&nbsp;<span class="op" id="6992437">:=</span>&nbsp;<span class="ident" id="6992440">req</span><span class="op" id="6992443">.</span><span class="ident" id="6992444">Header</span><span class="op" id="6992450">.</span><span class="ident" id="6992451">Get</span><span class="op" id="6992454">(</span><span class="string" id="6992455">&#34;Foo-Bar&#34;</span><span class="op" id="6992464">)</span><span class="op" id="6992465">,</span>&nbsp;<span class="string" id="6992467">&#34;baz&#34;</span><span class="op" id="6992472">;</span>&nbsp;<span class="ident" id="6992474">e</span>&nbsp;<span class="op" id="6992476">!=</span>&nbsp;<span class="ident" id="6992479">g</span>&nbsp;<span class="op" id="6992481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6992485">t</span><span class="op" id="6992486">.</span><span class="ident" id="6992487">Errorf</span><span class="op" id="6992493">(</span><span class="string" id="6992494">&#34;expected&nbsp;Foo-Bar&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6992523">,</span>&nbsp;<span class="ident" id="6992525">e</span><span class="op" id="6992526">,</span>&nbsp;<span class="ident" id="6992528">g</span><span class="op" id="6992529">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6992532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6992535">if</span>&nbsp;<span class="ident" id="6992538">g</span><span class="op" id="6992539">,</span>&nbsp;<span class="ident" id="6992541">e</span>&nbsp;<span class="op" id="6992543">:=</span>&nbsp;<span class="ident" id="6992546">req</span><span class="op" id="6992549">.</span><span class="ident" id="6992550">URL</span><span class="op" id="6992553">.</span><span class="ident" id="6992554">String</span><span class="op" id="6992560">(</span><span class="op" id="6992561">)</span><span class="op" id="6992562">,</span>&nbsp;<span class="string" id="6992564">&#34;http://example.com/path?a=b&#34;</span><span class="op" id="6992593">;</span>&nbsp;<span class="ident" id="6992595">e</span>&nbsp;<span class="op" id="6992597">!=</span>&nbsp;<span class="ident" id="6992600">g</span>&nbsp;<span class="op" id="6992602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6992606">t</span><span class="op" id="6992607">.</span><span class="ident" id="6992608">Errorf</span><span class="op" id="6992614">(</span><span class="string" id="6992615">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6992640">,</span>&nbsp;<span class="ident" id="6992642">e</span><span class="op" id="6992643">,</span>&nbsp;<span class="ident" id="6992645">g</span><span class="op" id="6992646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6992649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6992652">if</span>&nbsp;<span class="ident" id="6992655">g</span><span class="op" id="6992656">,</span>&nbsp;<span class="ident" id="6992658">e</span>&nbsp;<span class="op" id="6992660">:=</span>&nbsp;<span class="ident" id="6992663">req</span><span class="op" id="6992666">.</span><span class="ident" id="6992667">FormValue</span><span class="op" id="6992676">(</span><span class="string" id="6992677">&#34;a&#34;</span><span class="op" id="6992680">)</span><span class="op" id="6992681">,</span>&nbsp;<span class="string" id="6992683">&#34;b&#34;</span><span class="op" id="6992686">;</span>&nbsp;<span class="ident" id="6992688">e</span>&nbsp;<span class="op" id="6992690">!=</span>&nbsp;<span class="ident" id="6992693">g</span>&nbsp;<span class="op" id="6992695">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6992699">t</span><span class="op" id="6992700">.</span><span class="ident" id="6992701">Errorf</span><span class="op" id="6992707">(</span><span class="string" id="6992708">&#34;expected&nbsp;FormValue(a)&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6992742">,</span>&nbsp;<span class="ident" id="6992744">e</span><span class="op" id="6992745">,</span>&nbsp;<span class="ident" id="6992747">g</span><span class="op" id="6992748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6992751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6992754">if</span>&nbsp;<span class="ident" id="6992757">req</span><span class="op" id="6992760">.</span><span class="ident" id="6992761">Trailer</span>&nbsp;<span class="op" id="6992769">==</span>&nbsp;<span class="ident" id="6992772">nil</span>&nbsp;<span class="op" id="6992776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6992780">t</span><span class="op" id="6992781">.</span><span class="ident" id="6992782">Errorf</span><span class="op" id="6992788">(</span><span class="string" id="6992789">&#34;unexpected&nbsp;nil&nbsp;Trailer&#34;</span><span class="op" id="6992813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6992816">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6992819">if</span>&nbsp;<span class="ident" id="6992822">req</span><span class="op" id="6992825">.</span><span class="ident" id="6992826">TLS</span>&nbsp;<span class="op" id="6992830">!=</span>&nbsp;<span class="ident" id="6992833">nil</span>&nbsp;<span class="op" id="6992837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6992841">t</span><span class="op" id="6992842">.</span><span class="ident" id="6992843">Errorf</span><span class="op" id="6992849">(</span><span class="string" id="6992850">&#34;expected&nbsp;nil&nbsp;TLS&#34;</span><span class="op" id="6992868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6992871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6992874">if</span>&nbsp;<span class="ident" id="6992877">e</span><span class="op" id="6992878">,</span>&nbsp;<span class="ident" id="6992880">g</span>&nbsp;<span class="op" id="6992882">:=</span>&nbsp;<span class="string" id="6992885">&#34;5.6.7.8:0&#34;</span><span class="op" id="6992896">,</span>&nbsp;<span class="ident" id="6992898">req</span><span class="op" id="6992901">.</span><span class="ident" id="6992902">RemoteAddr</span><span class="op" id="6992912">;</span>&nbsp;<span class="ident" id="6992914">e</span>&nbsp;<span class="op" id="6992916">!=</span>&nbsp;<span class="ident" id="6992919">g</span>&nbsp;<span class="op" id="6992921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6992925">t</span><span class="op" id="6992926">.</span><span class="ident" id="6992927">Errorf</span><span class="op" id="6992933">(</span><span class="string" id="6992934">&#34;RemoteAddr:&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6992963">,</span>&nbsp;<span class="ident" id="6992965">g</span><span class="op" id="6992966">,</span>&nbsp;<span class="ident" id="6992968">e</span><span class="op" id="6992969">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6992972">}</span><br>
<span class="lineno"></span><span class="op" id="6992974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6992977">func</span>&nbsp;<span class="ident" id="6992982">TestRequestWithTLS</span><span class="op" id="6993000">(</span><span class="ident" id="6993001">t</span>&nbsp;<span class="op" id="6993003">*</span><span class="ident" id="6993004">testing</span><span class="op" id="6993011">.</span><span class="ident" id="6993012">T</span><span class="op" id="6993013">)</span>&nbsp;<span class="op" id="6993015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6993018">env</span>&nbsp;<span class="op" id="6993022">:=</span>&nbsp;<span class="keyword" id="6993025">map</span><span class="op" id="6993028">[</span><span class="builtintype" id="6993029">string</span><span class="op" id="6993035">]</span><span class="builtintype" id="6993036">string</span><span class="op" id="6993042">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6993046">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6993063">:</span>&nbsp;<span class="string" id="6993065">&#34;HTTP/1.1&#34;</span><span class="op" id="6993075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6993079">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6993095">:</span>&nbsp;&nbsp;<span class="string" id="6993098">&#34;GET&#34;</span><span class="op" id="6993103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6993107">&#34;HTTP_HOST&#34;</span><span class="op" id="6993118">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6993126">&#34;example.com&#34;</span><span class="op" id="6993139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6993143">&#34;HTTP_REFERER&#34;</span><span class="op" id="6993157">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6993162">&#34;elsewhere&#34;</span><span class="op" id="6993173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6993177">&#34;REQUEST_URI&#34;</span><span class="op" id="6993190">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6993196">&#34;/path?a=b&#34;</span><span class="op" id="6993207">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6993211">&#34;CONTENT_TYPE&#34;</span><span class="op" id="6993225">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6993230">&#34;text/xml&#34;</span><span class="op" id="6993240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6993244">&#34;HTTPS&#34;</span><span class="op" id="6993251">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6993263">&#34;1&#34;</span><span class="op" id="6993266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6993270">&#34;REMOTE_ADDR&#34;</span><span class="op" id="6993283">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6993289">&#34;5.6.7.8&#34;</span><span class="op" id="6993298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6993301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6993304">req</span><span class="op" id="6993307">,</span>&nbsp;<span class="ident" id="6993309">err</span>&nbsp;<span class="op" id="6993313">:=</span>&nbsp;<span class="ident" id="6993316">RequestFromMap</span><span class="op" id="6993330">(</span><span class="ident" id="6993331">env</span><span class="op" id="6993334">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6993337">if</span>&nbsp;<span class="ident" id="6993340">err</span>&nbsp;<span class="op" id="6993344">!=</span>&nbsp;<span class="ident" id="6993347">nil</span>&nbsp;<span class="op" id="6993351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6993355">t</span><span class="op" id="6993356">.</span><span class="ident" id="6993357">Fatalf</span><span class="op" id="6993363">(</span><span class="string" id="6993364">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6993384">,</span>&nbsp;<span class="ident" id="6993386">err</span><span class="op" id="6993389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6993392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6993395">if</span>&nbsp;<span class="ident" id="6993398">g</span><span class="op" id="6993399">,</span>&nbsp;<span class="ident" id="6993401">e</span>&nbsp;<span class="op" id="6993403">:=</span>&nbsp;<span class="ident" id="6993406">req</span><span class="op" id="6993409">.</span><span class="ident" id="6993410">URL</span><span class="op" id="6993413">.</span><span class="ident" id="6993414">String</span><span class="op" id="6993420">(</span><span class="op" id="6993421">)</span><span class="op" id="6993422">,</span>&nbsp;<span class="string" id="6993424">&#34;https://example.com/path?a=b&#34;</span><span class="op" id="6993454">;</span>&nbsp;<span class="ident" id="6993456">e</span>&nbsp;<span class="op" id="6993458">!=</span>&nbsp;<span class="ident" id="6993461">g</span>&nbsp;<span class="op" id="6993463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6993467">t</span><span class="op" id="6993468">.</span><span class="ident" id="6993469">Errorf</span><span class="op" id="6993475">(</span><span class="string" id="6993476">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6993501">,</span>&nbsp;<span class="ident" id="6993503">e</span><span class="op" id="6993504">,</span>&nbsp;<span class="ident" id="6993506">g</span><span class="op" id="6993507">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6993510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6993513">if</span>&nbsp;<span class="ident" id="6993516">req</span><span class="op" id="6993519">.</span><span class="ident" id="6993520">TLS</span>&nbsp;<span class="op" id="6993524">==</span>&nbsp;<span class="ident" id="6993527">nil</span>&nbsp;<span class="op" id="6993531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6993535">t</span><span class="op" id="6993536">.</span><span class="ident" id="6993537">Errorf</span><span class="op" id="6993543">(</span><span class="string" id="6993544">&#34;expected&nbsp;non-nil&nbsp;TLS&#34;</span><span class="op" id="6993566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6993569">}</span><br>
<span class="lineno"></span><span class="op" id="6993571">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="6993574">func</span>&nbsp;<span class="ident" id="6993579">TestRequestWithoutHost</span><span class="op" id="6993601">(</span><span class="ident" id="6993602">t</span>&nbsp;<span class="op" id="6993604">*</span><span class="ident" id="6993605">testing</span><span class="op" id="6993612">.</span><span class="ident" id="6993613">T</span><span class="op" id="6993614">)</span>&nbsp;<span class="op" id="6993616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6993619">env</span>&nbsp;<span class="op" id="6993623">:=</span>&nbsp;<span class="keyword" id="6993626">map</span><span class="op" id="6993629">[</span><span class="builtintype" id="6993630">string</span><span class="op" id="6993636">]</span><span class="builtintype" id="6993637">string</span><span class="op" id="6993643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6993647">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6993664">:</span>&nbsp;<span class="string" id="6993666">&#34;HTTP/1.1&#34;</span><span class="op" id="6993676">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6993680">&#34;HTTP_HOST&#34;</span><span class="op" id="6993691">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6993699">&#34;&#34;</span><span class="op" id="6993701">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6993705">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6993721">:</span>&nbsp;&nbsp;<span class="string" id="6993724">&#34;GET&#34;</span><span class="op" id="6993729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6993733">&#34;REQUEST_URI&#34;</span><span class="op" id="6993746">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6993752">&#34;/path?a=b&#34;</span><span class="op" id="6993763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6993767">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6993783">:</span>&nbsp;&nbsp;<span class="string" id="6993786">&#34;123&#34;</span><span class="op" id="6993791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6993794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6993797">req</span><span class="op" id="6993800">,</span>&nbsp;<span class="ident" id="6993802">err</span>&nbsp;<span class="op" id="6993806">:=</span>&nbsp;<span class="ident" id="6993809">RequestFromMap</span><span class="op" id="6993823">(</span><span class="ident" id="6993824">env</span><span class="op" id="6993827">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6993830">if</span>&nbsp;<span class="ident" id="6993833">err</span>&nbsp;<span class="op" id="6993837">!=</span>&nbsp;<span class="ident" id="6993840">nil</span>&nbsp;<span class="op" id="6993844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6993848">t</span><span class="op" id="6993849">.</span><span class="ident" id="6993850">Fatalf</span><span class="op" id="6993856">(</span><span class="string" id="6993857">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6993877">,</span>&nbsp;<span class="ident" id="6993879">err</span><span class="op" id="6993882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6993885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6993888">if</span>&nbsp;<span class="ident" id="6993891">req</span><span class="op" id="6993894">.</span><span class="ident" id="6993895">URL</span>&nbsp;<span class="op" id="6993899">==</span>&nbsp;<span class="ident" id="6993902">nil</span>&nbsp;<span class="op" id="6993906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6993910">t</span><span class="op" id="6993911">.</span><span class="ident" id="6993912">Fatalf</span><span class="op" id="6993918">(</span><span class="string" id="6993919">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="6993939">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6993942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6993945">if</span>&nbsp;<span class="ident" id="6993948">g</span><span class="op" id="6993949">,</span>&nbsp;<span class="ident" id="6993951">e</span>&nbsp;<span class="op" id="6993953">:=</span>&nbsp;<span class="ident" id="6993956">req</span><span class="op" id="6993959">.</span><span class="ident" id="6993960">URL</span><span class="op" id="6993963">.</span><span class="ident" id="6993964">String</span><span class="op" id="6993970">(</span><span class="op" id="6993971">)</span><span class="op" id="6993972">,</span>&nbsp;<span class="string" id="6993974">&#34;/path?a=b&#34;</span><span class="op" id="6993985">;</span>&nbsp;<span class="ident" id="6993987">e</span>&nbsp;<span class="op" id="6993989">!=</span>&nbsp;<span class="ident" id="6993992">g</span>&nbsp;<span class="op" id="6993994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6993998">t</span><span class="op" id="6993999">.</span><span class="ident" id="6994000">Errorf</span><span class="op" id="6994006">(</span><span class="string" id="6994007">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6994026">,</span>&nbsp;<span class="ident" id="6994028">g</span><span class="op" id="6994029">,</span>&nbsp;<span class="ident" id="6994031">e</span><span class="op" id="6994032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6994035">}</span><br>
<span class="lineno"></span><span class="op" id="6994037">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="6994040">func</span>&nbsp;<span class="ident" id="6994045">TestRequestWithoutRequestURI</span><span class="op" id="6994073">(</span><span class="ident" id="6994074">t</span>&nbsp;<span class="op" id="6994076">*</span><span class="ident" id="6994077">testing</span><span class="op" id="6994084">.</span><span class="ident" id="6994085">T</span><span class="op" id="6994086">)</span>&nbsp;<span class="op" id="6994088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6994091">env</span>&nbsp;<span class="op" id="6994095">:=</span>&nbsp;<span class="keyword" id="6994098">map</span><span class="op" id="6994101">[</span><span class="builtintype" id="6994102">string</span><span class="op" id="6994108">]</span><span class="builtintype" id="6994109">string</span><span class="op" id="6994115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6994119">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6994136">:</span>&nbsp;<span class="string" id="6994138">&#34;HTTP/1.1&#34;</span><span class="op" id="6994148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6994152">&#34;HTTP_HOST&#34;</span><span class="op" id="6994163">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6994171">&#34;example.com&#34;</span><span class="op" id="6994184">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6994188">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6994204">:</span>&nbsp;&nbsp;<span class="string" id="6994207">&#34;GET&#34;</span><span class="op" id="6994212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6994216">&#34;SCRIPT_NAME&#34;</span><span class="op" id="6994229">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6994235">&#34;/dir/scriptname&#34;</span><span class="op" id="6994252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6994256">&#34;PATH_INFO&#34;</span><span class="op" id="6994267">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6994275">&#34;/p1/p2&#34;</span><span class="op" id="6994283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6994287">&#34;QUERY_STRING&#34;</span><span class="op" id="6994301">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6994306">&#34;a=1&amp;b=2&#34;</span><span class="op" id="6994315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6994319">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6994335">:</span>&nbsp;&nbsp;<span class="string" id="6994338">&#34;123&#34;</span><span class="op" id="6994343">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6994346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6994349">req</span><span class="op" id="6994352">,</span>&nbsp;<span class="ident" id="6994354">err</span>&nbsp;<span class="op" id="6994358">:=</span>&nbsp;<span class="ident" id="6994361">RequestFromMap</span><span class="op" id="6994375">(</span><span class="ident" id="6994376">env</span><span class="op" id="6994379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6994382">if</span>&nbsp;<span class="ident" id="6994385">err</span>&nbsp;<span class="op" id="6994389">!=</span>&nbsp;<span class="ident" id="6994392">nil</span>&nbsp;<span class="op" id="6994396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6994400">t</span><span class="op" id="6994401">.</span><span class="ident" id="6994402">Fatalf</span><span class="op" id="6994408">(</span><span class="string" id="6994409">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6994429">,</span>&nbsp;<span class="ident" id="6994431">err</span><span class="op" id="6994434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6994437">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6994440">if</span>&nbsp;<span class="ident" id="6994443">req</span><span class="op" id="6994446">.</span><span class="ident" id="6994447">URL</span>&nbsp;<span class="op" id="6994451">==</span>&nbsp;<span class="ident" id="6994454">nil</span>&nbsp;<span class="op" id="6994458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6994462">t</span><span class="op" id="6994463">.</span><span class="ident" id="6994464">Fatalf</span><span class="op" id="6994470">(</span><span class="string" id="6994471">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="6994491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6994494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6994497">if</span>&nbsp;<span class="ident" id="6994500">g</span><span class="op" id="6994501">,</span>&nbsp;<span class="ident" id="6994503">e</span>&nbsp;<span class="op" id="6994505">:=</span>&nbsp;<span class="ident" id="6994508">req</span><span class="op" id="6994511">.</span><span class="ident" id="6994512">URL</span><span class="op" id="6994515">.</span><span class="ident" id="6994516">String</span><span class="op" id="6994522">(</span><span class="op" id="6994523">)</span><span class="op" id="6994524">,</span>&nbsp;<span class="string" id="6994526">&#34;http://example.com/dir/scriptname/p1/p2?a=1&amp;b=2&#34;</span><span class="op" id="6994575">;</span>&nbsp;<span class="ident" id="6994577">e</span>&nbsp;<span class="op" id="6994579">!=</span>&nbsp;<span class="ident" id="6994582">g</span>&nbsp;<span class="op" id="6994584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6994588">t</span><span class="op" id="6994589">.</span><span class="ident" id="6994590">Errorf</span><span class="op" id="6994596">(</span><span class="string" id="6994597">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6994616">,</span>&nbsp;<span class="ident" id="6994618">g</span><span class="op" id="6994619">,</span>&nbsp;<span class="ident" id="6994621">e</span><span class="op" id="6994622">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6994625">}</span><br>
<span class="lineno"></span><span class="op" id="6994627">}</span>
</div>
</body>
</html>
