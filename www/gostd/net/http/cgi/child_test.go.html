<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7225840">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7225895">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7225949">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7226000">//&nbsp;Tests&nbsp;for&nbsp;CGI&nbsp;(the&nbsp;child&nbsp;process&nbsp;perspective)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7226050">package</span>&nbsp;<span class="ident" id="7226058">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7226063">import</span>&nbsp;<span class="op" id="7226070">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7226073">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7226083">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7226086">func</span>&nbsp;<span class="ident" id="7226091">TestRequest</span><span class="op" id="7226102">(</span><span class="ident" id="7226103">t</span>&nbsp;<span class="op" id="7226105">*</span><span class="ident" id="7226106">testing</span><span class="op" id="7226113">.</span><span class="ident" id="7226114">T</span><span class="op" id="7226115">)</span>&nbsp;<span class="op" id="7226117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7226120">env</span>&nbsp;<span class="op" id="7226124">:=</span>&nbsp;<span class="keyword" id="7226127">map</span><span class="op" id="7226130">[</span><span class="builtintype" id="7226131">string</span><span class="op" id="7226137">]</span><span class="builtintype" id="7226138">string</span><span class="op" id="7226144">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7226148">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7226165">:</span>&nbsp;<span class="string" id="7226167">&#34;HTTP/1.1&#34;</span><span class="op" id="7226177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7226181">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7226197">:</span>&nbsp;&nbsp;<span class="string" id="7226200">&#34;GET&#34;</span><span class="op" id="7226205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7226209">&#34;HTTP_HOST&#34;</span><span class="op" id="7226220">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7226228">&#34;example.com&#34;</span><span class="op" id="7226241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7226245">&#34;HTTP_REFERER&#34;</span><span class="op" id="7226259">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7226264">&#34;elsewhere&#34;</span><span class="op" id="7226275">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7226279">&#34;HTTP_USER_AGENT&#34;</span><span class="op" id="7226296">:</span>&nbsp;<span class="string" id="7226298">&#34;goclient&#34;</span><span class="op" id="7226308">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7226312">&#34;HTTP_FOO_BAR&#34;</span><span class="op" id="7226326">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7226331">&#34;baz&#34;</span><span class="op" id="7226336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7226340">&#34;REQUEST_URI&#34;</span><span class="op" id="7226353">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7226359">&#34;/path?a=b&#34;</span><span class="op" id="7226370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7226374">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7226390">:</span>&nbsp;&nbsp;<span class="string" id="7226393">&#34;123&#34;</span><span class="op" id="7226398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7226402">&#34;CONTENT_TYPE&#34;</span><span class="op" id="7226416">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7226421">&#34;text/xml&#34;</span><span class="op" id="7226431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7226435">&#34;REMOTE_ADDR&#34;</span><span class="op" id="7226448">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7226454">&#34;5.6.7.8&#34;</span><span class="op" id="7226463">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7226466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7226469">req</span><span class="op" id="7226472">,</span>&nbsp;<span class="ident" id="7226474">err</span>&nbsp;<span class="op" id="7226478">:=</span>&nbsp;<span class="ident" id="7226481">RequestFromMap</span><span class="op" id="7226495">(</span><span class="ident" id="7226496">env</span><span class="op" id="7226499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7226502">if</span>&nbsp;<span class="ident" id="7226505">err</span>&nbsp;<span class="op" id="7226509">!=</span>&nbsp;<span class="ident" id="7226512">nil</span>&nbsp;<span class="op" id="7226516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7226520">t</span><span class="op" id="7226521">.</span><span class="ident" id="7226522">Fatalf</span><span class="op" id="7226528">(</span><span class="string" id="7226529">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7226549">,</span>&nbsp;<span class="ident" id="7226551">err</span><span class="op" id="7226554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7226557">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7226560">if</span>&nbsp;<span class="ident" id="7226563">g</span><span class="op" id="7226564">,</span>&nbsp;<span class="ident" id="7226566">e</span>&nbsp;<span class="op" id="7226568">:=</span>&nbsp;<span class="ident" id="7226571">req</span><span class="op" id="7226574">.</span><span class="ident" id="7226575">UserAgent</span><span class="op" id="7226584">(</span><span class="op" id="7226585">)</span><span class="op" id="7226586">,</span>&nbsp;<span class="string" id="7226588">&#34;goclient&#34;</span><span class="op" id="7226598">;</span>&nbsp;<span class="ident" id="7226600">e</span>&nbsp;<span class="op" id="7226602">!=</span>&nbsp;<span class="ident" id="7226605">g</span>&nbsp;<span class="op" id="7226607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7226611">t</span><span class="op" id="7226612">.</span><span class="ident" id="7226613">Errorf</span><span class="op" id="7226619">(</span><span class="string" id="7226620">&#34;expected&nbsp;UserAgent&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7226651">,</span>&nbsp;<span class="ident" id="7226653">e</span><span class="op" id="7226654">,</span>&nbsp;<span class="ident" id="7226656">g</span><span class="op" id="7226657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7226660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7226663">if</span>&nbsp;<span class="ident" id="7226666">g</span><span class="op" id="7226667">,</span>&nbsp;<span class="ident" id="7226669">e</span>&nbsp;<span class="op" id="7226671">:=</span>&nbsp;<span class="ident" id="7226674">req</span><span class="op" id="7226677">.</span><span class="ident" id="7226678">Method</span><span class="op" id="7226684">,</span>&nbsp;<span class="string" id="7226686">&#34;GET&#34;</span><span class="op" id="7226691">;</span>&nbsp;<span class="ident" id="7226693">e</span>&nbsp;<span class="op" id="7226695">!=</span>&nbsp;<span class="ident" id="7226698">g</span>&nbsp;<span class="op" id="7226700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7226704">t</span><span class="op" id="7226705">.</span><span class="ident" id="7226706">Errorf</span><span class="op" id="7226712">(</span><span class="string" id="7226713">&#34;expected&nbsp;Method&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7226741">,</span>&nbsp;<span class="ident" id="7226743">e</span><span class="op" id="7226744">,</span>&nbsp;<span class="ident" id="7226746">g</span><span class="op" id="7226747">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7226750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7226753">if</span>&nbsp;<span class="ident" id="7226756">g</span><span class="op" id="7226757">,</span>&nbsp;<span class="ident" id="7226759">e</span>&nbsp;<span class="op" id="7226761">:=</span>&nbsp;<span class="ident" id="7226764">req</span><span class="op" id="7226767">.</span><span class="ident" id="7226768">Header</span><span class="op" id="7226774">.</span><span class="ident" id="7226775">Get</span><span class="op" id="7226778">(</span><span class="string" id="7226779">&#34;Content-Type&#34;</span><span class="op" id="7226793">)</span><span class="op" id="7226794">,</span>&nbsp;<span class="string" id="7226796">&#34;text/xml&#34;</span><span class="op" id="7226806">;</span>&nbsp;<span class="ident" id="7226808">e</span>&nbsp;<span class="op" id="7226810">!=</span>&nbsp;<span class="ident" id="7226813">g</span>&nbsp;<span class="op" id="7226815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7226819">t</span><span class="op" id="7226820">.</span><span class="ident" id="7226821">Errorf</span><span class="op" id="7226827">(</span><span class="string" id="7226828">&#34;expected&nbsp;Content-Type&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7226862">,</span>&nbsp;<span class="ident" id="7226864">e</span><span class="op" id="7226865">,</span>&nbsp;<span class="ident" id="7226867">g</span><span class="op" id="7226868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7226871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7226874">if</span>&nbsp;<span class="ident" id="7226877">g</span><span class="op" id="7226878">,</span>&nbsp;<span class="ident" id="7226880">e</span>&nbsp;<span class="op" id="7226882">:=</span>&nbsp;<span class="ident" id="7226885">req</span><span class="op" id="7226888">.</span><span class="ident" id="7226889">ContentLength</span><span class="op" id="7226902">,</span>&nbsp;<span class="ident" id="7226904">int64</span><span class="op" id="7226909">(</span><span class="num" id="7226910">123</span><span class="op" id="7226913">)</span><span class="op" id="7226914">;</span>&nbsp;<span class="ident" id="7226916">e</span>&nbsp;<span class="op" id="7226918">!=</span>&nbsp;<span class="ident" id="7226921">g</span>&nbsp;<span class="op" id="7226923">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7226927">t</span><span class="op" id="7226928">.</span><span class="ident" id="7226929">Errorf</span><span class="op" id="7226935">(</span><span class="string" id="7226936">&#34;expected&nbsp;ContentLength&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7226971">,</span>&nbsp;<span class="ident" id="7226973">e</span><span class="op" id="7226974">,</span>&nbsp;<span class="ident" id="7226976">g</span><span class="op" id="7226977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7226980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7226983">if</span>&nbsp;<span class="ident" id="7226986">g</span><span class="op" id="7226987">,</span>&nbsp;<span class="ident" id="7226989">e</span>&nbsp;<span class="op" id="7226991">:=</span>&nbsp;<span class="ident" id="7226994">req</span><span class="op" id="7226997">.</span><span class="ident" id="7226998">Referer</span><span class="op" id="7227005">(</span><span class="op" id="7227006">)</span><span class="op" id="7227007">,</span>&nbsp;<span class="string" id="7227009">&#34;elsewhere&#34;</span><span class="op" id="7227020">;</span>&nbsp;<span class="ident" id="7227022">e</span>&nbsp;<span class="op" id="7227024">!=</span>&nbsp;<span class="ident" id="7227027">g</span>&nbsp;<span class="op" id="7227029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7227033">t</span><span class="op" id="7227034">.</span><span class="ident" id="7227035">Errorf</span><span class="op" id="7227041">(</span><span class="string" id="7227042">&#34;expected&nbsp;Referer&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7227071">,</span>&nbsp;<span class="ident" id="7227073">e</span><span class="op" id="7227074">,</span>&nbsp;<span class="ident" id="7227076">g</span><span class="op" id="7227077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7227080">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7227083">if</span>&nbsp;<span class="ident" id="7227086">req</span><span class="op" id="7227089">.</span><span class="ident" id="7227090">Header</span>&nbsp;<span class="op" id="7227097">==</span>&nbsp;<span class="ident" id="7227100">nil</span>&nbsp;<span class="op" id="7227104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7227108">t</span><span class="op" id="7227109">.</span><span class="ident" id="7227110">Fatalf</span><span class="op" id="7227116">(</span><span class="string" id="7227117">&#34;unexpected&nbsp;nil&nbsp;Header&#34;</span><span class="op" id="7227140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7227143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7227146">if</span>&nbsp;<span class="ident" id="7227149">g</span><span class="op" id="7227150">,</span>&nbsp;<span class="ident" id="7227152">e</span>&nbsp;<span class="op" id="7227154">:=</span>&nbsp;<span class="ident" id="7227157">req</span><span class="op" id="7227160">.</span><span class="ident" id="7227161">Header</span><span class="op" id="7227167">.</span><span class="ident" id="7227168">Get</span><span class="op" id="7227171">(</span><span class="string" id="7227172">&#34;Foo-Bar&#34;</span><span class="op" id="7227181">)</span><span class="op" id="7227182">,</span>&nbsp;<span class="string" id="7227184">&#34;baz&#34;</span><span class="op" id="7227189">;</span>&nbsp;<span class="ident" id="7227191">e</span>&nbsp;<span class="op" id="7227193">!=</span>&nbsp;<span class="ident" id="7227196">g</span>&nbsp;<span class="op" id="7227198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7227202">t</span><span class="op" id="7227203">.</span><span class="ident" id="7227204">Errorf</span><span class="op" id="7227210">(</span><span class="string" id="7227211">&#34;expected&nbsp;Foo-Bar&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7227240">,</span>&nbsp;<span class="ident" id="7227242">e</span><span class="op" id="7227243">,</span>&nbsp;<span class="ident" id="7227245">g</span><span class="op" id="7227246">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7227249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7227252">if</span>&nbsp;<span class="ident" id="7227255">g</span><span class="op" id="7227256">,</span>&nbsp;<span class="ident" id="7227258">e</span>&nbsp;<span class="op" id="7227260">:=</span>&nbsp;<span class="ident" id="7227263">req</span><span class="op" id="7227266">.</span><span class="ident" id="7227267">URL</span><span class="op" id="7227270">.</span><span class="ident" id="7227271">String</span><span class="op" id="7227277">(</span><span class="op" id="7227278">)</span><span class="op" id="7227279">,</span>&nbsp;<span class="string" id="7227281">&#34;http://example.com/path?a=b&#34;</span><span class="op" id="7227310">;</span>&nbsp;<span class="ident" id="7227312">e</span>&nbsp;<span class="op" id="7227314">!=</span>&nbsp;<span class="ident" id="7227317">g</span>&nbsp;<span class="op" id="7227319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7227323">t</span><span class="op" id="7227324">.</span><span class="ident" id="7227325">Errorf</span><span class="op" id="7227331">(</span><span class="string" id="7227332">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7227357">,</span>&nbsp;<span class="ident" id="7227359">e</span><span class="op" id="7227360">,</span>&nbsp;<span class="ident" id="7227362">g</span><span class="op" id="7227363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7227366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7227369">if</span>&nbsp;<span class="ident" id="7227372">g</span><span class="op" id="7227373">,</span>&nbsp;<span class="ident" id="7227375">e</span>&nbsp;<span class="op" id="7227377">:=</span>&nbsp;<span class="ident" id="7227380">req</span><span class="op" id="7227383">.</span><span class="ident" id="7227384">FormValue</span><span class="op" id="7227393">(</span><span class="string" id="7227394">&#34;a&#34;</span><span class="op" id="7227397">)</span><span class="op" id="7227398">,</span>&nbsp;<span class="string" id="7227400">&#34;b&#34;</span><span class="op" id="7227403">;</span>&nbsp;<span class="ident" id="7227405">e</span>&nbsp;<span class="op" id="7227407">!=</span>&nbsp;<span class="ident" id="7227410">g</span>&nbsp;<span class="op" id="7227412">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7227416">t</span><span class="op" id="7227417">.</span><span class="ident" id="7227418">Errorf</span><span class="op" id="7227424">(</span><span class="string" id="7227425">&#34;expected&nbsp;FormValue(a)&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7227459">,</span>&nbsp;<span class="ident" id="7227461">e</span><span class="op" id="7227462">,</span>&nbsp;<span class="ident" id="7227464">g</span><span class="op" id="7227465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7227468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7227471">if</span>&nbsp;<span class="ident" id="7227474">req</span><span class="op" id="7227477">.</span><span class="ident" id="7227478">Trailer</span>&nbsp;<span class="op" id="7227486">==</span>&nbsp;<span class="ident" id="7227489">nil</span>&nbsp;<span class="op" id="7227493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7227497">t</span><span class="op" id="7227498">.</span><span class="ident" id="7227499">Errorf</span><span class="op" id="7227505">(</span><span class="string" id="7227506">&#34;unexpected&nbsp;nil&nbsp;Trailer&#34;</span><span class="op" id="7227530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7227533">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7227536">if</span>&nbsp;<span class="ident" id="7227539">req</span><span class="op" id="7227542">.</span><span class="ident" id="7227543">TLS</span>&nbsp;<span class="op" id="7227547">!=</span>&nbsp;<span class="ident" id="7227550">nil</span>&nbsp;<span class="op" id="7227554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7227558">t</span><span class="op" id="7227559">.</span><span class="ident" id="7227560">Errorf</span><span class="op" id="7227566">(</span><span class="string" id="7227567">&#34;expected&nbsp;nil&nbsp;TLS&#34;</span><span class="op" id="7227585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7227588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7227591">if</span>&nbsp;<span class="ident" id="7227594">e</span><span class="op" id="7227595">,</span>&nbsp;<span class="ident" id="7227597">g</span>&nbsp;<span class="op" id="7227599">:=</span>&nbsp;<span class="string" id="7227602">&#34;5.6.7.8:0&#34;</span><span class="op" id="7227613">,</span>&nbsp;<span class="ident" id="7227615">req</span><span class="op" id="7227618">.</span><span class="ident" id="7227619">RemoteAddr</span><span class="op" id="7227629">;</span>&nbsp;<span class="ident" id="7227631">e</span>&nbsp;<span class="op" id="7227633">!=</span>&nbsp;<span class="ident" id="7227636">g</span>&nbsp;<span class="op" id="7227638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7227642">t</span><span class="op" id="7227643">.</span><span class="ident" id="7227644">Errorf</span><span class="op" id="7227650">(</span><span class="string" id="7227651">&#34;RemoteAddr:&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7227680">,</span>&nbsp;<span class="ident" id="7227682">g</span><span class="op" id="7227683">,</span>&nbsp;<span class="ident" id="7227685">e</span><span class="op" id="7227686">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7227689">}</span><br>
<span class="lineno"></span><span class="op" id="7227691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7227694">func</span>&nbsp;<span class="ident" id="7227699">TestRequestWithTLS</span><span class="op" id="7227717">(</span><span class="ident" id="7227718">t</span>&nbsp;<span class="op" id="7227720">*</span><span class="ident" id="7227721">testing</span><span class="op" id="7227728">.</span><span class="ident" id="7227729">T</span><span class="op" id="7227730">)</span>&nbsp;<span class="op" id="7227732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7227735">env</span>&nbsp;<span class="op" id="7227739">:=</span>&nbsp;<span class="keyword" id="7227742">map</span><span class="op" id="7227745">[</span><span class="builtintype" id="7227746">string</span><span class="op" id="7227752">]</span><span class="builtintype" id="7227753">string</span><span class="op" id="7227759">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7227763">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7227780">:</span>&nbsp;<span class="string" id="7227782">&#34;HTTP/1.1&#34;</span><span class="op" id="7227792">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7227796">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7227812">:</span>&nbsp;&nbsp;<span class="string" id="7227815">&#34;GET&#34;</span><span class="op" id="7227820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7227824">&#34;HTTP_HOST&#34;</span><span class="op" id="7227835">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7227843">&#34;example.com&#34;</span><span class="op" id="7227856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7227860">&#34;HTTP_REFERER&#34;</span><span class="op" id="7227874">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7227879">&#34;elsewhere&#34;</span><span class="op" id="7227890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7227894">&#34;REQUEST_URI&#34;</span><span class="op" id="7227907">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7227913">&#34;/path?a=b&#34;</span><span class="op" id="7227924">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7227928">&#34;CONTENT_TYPE&#34;</span><span class="op" id="7227942">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7227947">&#34;text/xml&#34;</span><span class="op" id="7227957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7227961">&#34;HTTPS&#34;</span><span class="op" id="7227968">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7227980">&#34;1&#34;</span><span class="op" id="7227983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7227987">&#34;REMOTE_ADDR&#34;</span><span class="op" id="7228000">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7228006">&#34;5.6.7.8&#34;</span><span class="op" id="7228015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7228018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7228021">req</span><span class="op" id="7228024">,</span>&nbsp;<span class="ident" id="7228026">err</span>&nbsp;<span class="op" id="7228030">:=</span>&nbsp;<span class="ident" id="7228033">RequestFromMap</span><span class="op" id="7228047">(</span><span class="ident" id="7228048">env</span><span class="op" id="7228051">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7228054">if</span>&nbsp;<span class="ident" id="7228057">err</span>&nbsp;<span class="op" id="7228061">!=</span>&nbsp;<span class="ident" id="7228064">nil</span>&nbsp;<span class="op" id="7228068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7228072">t</span><span class="op" id="7228073">.</span><span class="ident" id="7228074">Fatalf</span><span class="op" id="7228080">(</span><span class="string" id="7228081">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7228101">,</span>&nbsp;<span class="ident" id="7228103">err</span><span class="op" id="7228106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7228109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7228112">if</span>&nbsp;<span class="ident" id="7228115">g</span><span class="op" id="7228116">,</span>&nbsp;<span class="ident" id="7228118">e</span>&nbsp;<span class="op" id="7228120">:=</span>&nbsp;<span class="ident" id="7228123">req</span><span class="op" id="7228126">.</span><span class="ident" id="7228127">URL</span><span class="op" id="7228130">.</span><span class="ident" id="7228131">String</span><span class="op" id="7228137">(</span><span class="op" id="7228138">)</span><span class="op" id="7228139">,</span>&nbsp;<span class="string" id="7228141">&#34;https://example.com/path?a=b&#34;</span><span class="op" id="7228171">;</span>&nbsp;<span class="ident" id="7228173">e</span>&nbsp;<span class="op" id="7228175">!=</span>&nbsp;<span class="ident" id="7228178">g</span>&nbsp;<span class="op" id="7228180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7228184">t</span><span class="op" id="7228185">.</span><span class="ident" id="7228186">Errorf</span><span class="op" id="7228192">(</span><span class="string" id="7228193">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7228218">,</span>&nbsp;<span class="ident" id="7228220">e</span><span class="op" id="7228221">,</span>&nbsp;<span class="ident" id="7228223">g</span><span class="op" id="7228224">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7228227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7228230">if</span>&nbsp;<span class="ident" id="7228233">req</span><span class="op" id="7228236">.</span><span class="ident" id="7228237">TLS</span>&nbsp;<span class="op" id="7228241">==</span>&nbsp;<span class="ident" id="7228244">nil</span>&nbsp;<span class="op" id="7228248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7228252">t</span><span class="op" id="7228253">.</span><span class="ident" id="7228254">Errorf</span><span class="op" id="7228260">(</span><span class="string" id="7228261">&#34;expected&nbsp;non-nil&nbsp;TLS&#34;</span><span class="op" id="7228283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7228286">}</span><br>
<span class="lineno"></span><span class="op" id="7228288">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="7228291">func</span>&nbsp;<span class="ident" id="7228296">TestRequestWithoutHost</span><span class="op" id="7228318">(</span><span class="ident" id="7228319">t</span>&nbsp;<span class="op" id="7228321">*</span><span class="ident" id="7228322">testing</span><span class="op" id="7228329">.</span><span class="ident" id="7228330">T</span><span class="op" id="7228331">)</span>&nbsp;<span class="op" id="7228333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7228336">env</span>&nbsp;<span class="op" id="7228340">:=</span>&nbsp;<span class="keyword" id="7228343">map</span><span class="op" id="7228346">[</span><span class="builtintype" id="7228347">string</span><span class="op" id="7228353">]</span><span class="builtintype" id="7228354">string</span><span class="op" id="7228360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7228364">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7228381">:</span>&nbsp;<span class="string" id="7228383">&#34;HTTP/1.1&#34;</span><span class="op" id="7228393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7228397">&#34;HTTP_HOST&#34;</span><span class="op" id="7228408">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7228416">&#34;&#34;</span><span class="op" id="7228418">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7228422">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7228438">:</span>&nbsp;&nbsp;<span class="string" id="7228441">&#34;GET&#34;</span><span class="op" id="7228446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7228450">&#34;REQUEST_URI&#34;</span><span class="op" id="7228463">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7228469">&#34;/path?a=b&#34;</span><span class="op" id="7228480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7228484">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7228500">:</span>&nbsp;&nbsp;<span class="string" id="7228503">&#34;123&#34;</span><span class="op" id="7228508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7228511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7228514">req</span><span class="op" id="7228517">,</span>&nbsp;<span class="ident" id="7228519">err</span>&nbsp;<span class="op" id="7228523">:=</span>&nbsp;<span class="ident" id="7228526">RequestFromMap</span><span class="op" id="7228540">(</span><span class="ident" id="7228541">env</span><span class="op" id="7228544">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7228547">if</span>&nbsp;<span class="ident" id="7228550">err</span>&nbsp;<span class="op" id="7228554">!=</span>&nbsp;<span class="ident" id="7228557">nil</span>&nbsp;<span class="op" id="7228561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7228565">t</span><span class="op" id="7228566">.</span><span class="ident" id="7228567">Fatalf</span><span class="op" id="7228573">(</span><span class="string" id="7228574">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7228594">,</span>&nbsp;<span class="ident" id="7228596">err</span><span class="op" id="7228599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7228602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7228605">if</span>&nbsp;<span class="ident" id="7228608">req</span><span class="op" id="7228611">.</span><span class="ident" id="7228612">URL</span>&nbsp;<span class="op" id="7228616">==</span>&nbsp;<span class="ident" id="7228619">nil</span>&nbsp;<span class="op" id="7228623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7228627">t</span><span class="op" id="7228628">.</span><span class="ident" id="7228629">Fatalf</span><span class="op" id="7228635">(</span><span class="string" id="7228636">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="7228656">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7228659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7228662">if</span>&nbsp;<span class="ident" id="7228665">g</span><span class="op" id="7228666">,</span>&nbsp;<span class="ident" id="7228668">e</span>&nbsp;<span class="op" id="7228670">:=</span>&nbsp;<span class="ident" id="7228673">req</span><span class="op" id="7228676">.</span><span class="ident" id="7228677">URL</span><span class="op" id="7228680">.</span><span class="ident" id="7228681">String</span><span class="op" id="7228687">(</span><span class="op" id="7228688">)</span><span class="op" id="7228689">,</span>&nbsp;<span class="string" id="7228691">&#34;/path?a=b&#34;</span><span class="op" id="7228702">;</span>&nbsp;<span class="ident" id="7228704">e</span>&nbsp;<span class="op" id="7228706">!=</span>&nbsp;<span class="ident" id="7228709">g</span>&nbsp;<span class="op" id="7228711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7228715">t</span><span class="op" id="7228716">.</span><span class="ident" id="7228717">Errorf</span><span class="op" id="7228723">(</span><span class="string" id="7228724">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7228743">,</span>&nbsp;<span class="ident" id="7228745">g</span><span class="op" id="7228746">,</span>&nbsp;<span class="ident" id="7228748">e</span><span class="op" id="7228749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7228752">}</span><br>
<span class="lineno"></span><span class="op" id="7228754">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="7228757">func</span>&nbsp;<span class="ident" id="7228762">TestRequestWithoutRequestURI</span><span class="op" id="7228790">(</span><span class="ident" id="7228791">t</span>&nbsp;<span class="op" id="7228793">*</span><span class="ident" id="7228794">testing</span><span class="op" id="7228801">.</span><span class="ident" id="7228802">T</span><span class="op" id="7228803">)</span>&nbsp;<span class="op" id="7228805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7228808">env</span>&nbsp;<span class="op" id="7228812">:=</span>&nbsp;<span class="keyword" id="7228815">map</span><span class="op" id="7228818">[</span><span class="builtintype" id="7228819">string</span><span class="op" id="7228825">]</span><span class="builtintype" id="7228826">string</span><span class="op" id="7228832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7228836">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7228853">:</span>&nbsp;<span class="string" id="7228855">&#34;HTTP/1.1&#34;</span><span class="op" id="7228865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7228869">&#34;HTTP_HOST&#34;</span><span class="op" id="7228880">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7228888">&#34;example.com&#34;</span><span class="op" id="7228901">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7228905">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7228921">:</span>&nbsp;&nbsp;<span class="string" id="7228924">&#34;GET&#34;</span><span class="op" id="7228929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7228933">&#34;SCRIPT_NAME&#34;</span><span class="op" id="7228946">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7228952">&#34;/dir/scriptname&#34;</span><span class="op" id="7228969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7228973">&#34;PATH_INFO&#34;</span><span class="op" id="7228984">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7228992">&#34;/p1/p2&#34;</span><span class="op" id="7229000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7229004">&#34;QUERY_STRING&#34;</span><span class="op" id="7229018">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7229023">&#34;a=1&amp;b=2&#34;</span><span class="op" id="7229032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7229036">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7229052">:</span>&nbsp;&nbsp;<span class="string" id="7229055">&#34;123&#34;</span><span class="op" id="7229060">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7229063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7229066">req</span><span class="op" id="7229069">,</span>&nbsp;<span class="ident" id="7229071">err</span>&nbsp;<span class="op" id="7229075">:=</span>&nbsp;<span class="ident" id="7229078">RequestFromMap</span><span class="op" id="7229092">(</span><span class="ident" id="7229093">env</span><span class="op" id="7229096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7229099">if</span>&nbsp;<span class="ident" id="7229102">err</span>&nbsp;<span class="op" id="7229106">!=</span>&nbsp;<span class="ident" id="7229109">nil</span>&nbsp;<span class="op" id="7229113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7229117">t</span><span class="op" id="7229118">.</span><span class="ident" id="7229119">Fatalf</span><span class="op" id="7229125">(</span><span class="string" id="7229126">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7229146">,</span>&nbsp;<span class="ident" id="7229148">err</span><span class="op" id="7229151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7229154">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7229157">if</span>&nbsp;<span class="ident" id="7229160">req</span><span class="op" id="7229163">.</span><span class="ident" id="7229164">URL</span>&nbsp;<span class="op" id="7229168">==</span>&nbsp;<span class="ident" id="7229171">nil</span>&nbsp;<span class="op" id="7229175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7229179">t</span><span class="op" id="7229180">.</span><span class="ident" id="7229181">Fatalf</span><span class="op" id="7229187">(</span><span class="string" id="7229188">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="7229208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7229211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7229214">if</span>&nbsp;<span class="ident" id="7229217">g</span><span class="op" id="7229218">,</span>&nbsp;<span class="ident" id="7229220">e</span>&nbsp;<span class="op" id="7229222">:=</span>&nbsp;<span class="ident" id="7229225">req</span><span class="op" id="7229228">.</span><span class="ident" id="7229229">URL</span><span class="op" id="7229232">.</span><span class="ident" id="7229233">String</span><span class="op" id="7229239">(</span><span class="op" id="7229240">)</span><span class="op" id="7229241">,</span>&nbsp;<span class="string" id="7229243">&#34;http://example.com/dir/scriptname/p1/p2?a=1&amp;b=2&#34;</span><span class="op" id="7229292">;</span>&nbsp;<span class="ident" id="7229294">e</span>&nbsp;<span class="op" id="7229296">!=</span>&nbsp;<span class="ident" id="7229299">g</span>&nbsp;<span class="op" id="7229301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7229305">t</span><span class="op" id="7229306">.</span><span class="ident" id="7229307">Errorf</span><span class="op" id="7229313">(</span><span class="string" id="7229314">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7229333">,</span>&nbsp;<span class="ident" id="7229335">g</span><span class="op" id="7229336">,</span>&nbsp;<span class="ident" id="7229338">e</span><span class="op" id="7229339">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7229342">}</span><br>
<span class="lineno"></span><span class="op" id="7229344">}</span>
</div>
</body>
</html>
