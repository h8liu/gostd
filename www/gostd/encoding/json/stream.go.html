<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3315466">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3315522">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3315576">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3315627">package</span>&nbsp;<span class="ident" id="3315635">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3315641">import</span>&nbsp;<span class="op" id="3315648">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3315651">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3315660">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3315670">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3315675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3315678">//&nbsp;A&nbsp;Decoder&nbsp;reads&nbsp;and&nbsp;decodes&nbsp;JSON&nbsp;objects&nbsp;from&nbsp;an&nbsp;input&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="3315744">type</span>&nbsp;<span class="ident" id="3315749">Decoder</span>&nbsp;<span class="keyword" id="3315757">struct</span>&nbsp;<span class="op" id="3315764">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315767">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315772">io</span><span class="op" id="3315774">.</span><span class="ident" id="3315775">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315783">buf</span>&nbsp;&nbsp;<span class="op" id="3315788">[</span><span class="op" id="3315789">]</span><span class="builtintype" id="3315790">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315796">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315801">decodeState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315814">scan</span>&nbsp;<span class="ident" id="3315819">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315828">err</span>&nbsp;&nbsp;<span class="builtintype" id="3315833">error</span><br>
<span class="lineno">20</span><span class="op" id="3315839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3315842">//&nbsp;NewDecoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;decoder&nbsp;that&nbsp;reads&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3315897">//</span><br>
<span class="lineno"></span><span class="comment" id="3315900">//&nbsp;The&nbsp;decoder&nbsp;introduces&nbsp;its&nbsp;own&nbsp;buffering&nbsp;and&nbsp;may</span><br>
<span class="lineno">25</span><span class="comment" id="3315952">//&nbsp;read&nbsp;data&nbsp;from&nbsp;r&nbsp;beyond&nbsp;the&nbsp;JSON&nbsp;values&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="3316006">func</span>&nbsp;<span class="ident" id="3316011">NewDecoder</span><span class="op" id="3316021">(</span><span class="ident" id="3316022">r</span>&nbsp;<span class="ident" id="3316024">io</span><span class="op" id="3316026">.</span><span class="ident" id="3316027">Reader</span><span class="op" id="3316033">)</span>&nbsp;<span class="op" id="3316035">*</span><span class="ident" id="3316036">Decoder</span>&nbsp;<span class="op" id="3316044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316047">return</span>&nbsp;<span class="op" id="3316054">&amp;</span><span class="ident" id="3316055">Decoder</span><span class="op" id="3316062">{</span><span class="ident" id="3316063">r</span><span class="op" id="3316064">:</span>&nbsp;<span class="ident" id="3316066">r</span><span class="op" id="3316067">}</span><br>
<span class="lineno"></span><span class="op" id="3316069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3316072">//&nbsp;UseNumber&nbsp;causes&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;unmarshal&nbsp;a&nbsp;number&nbsp;into&nbsp;an&nbsp;interface{}&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3316151">//&nbsp;Number&nbsp;instead&nbsp;of&nbsp;as&nbsp;a&nbsp;float64.</span><br>
<span class="lineno"></span><span class="keyword" id="3316186">func</span>&nbsp;<span class="op" id="3316191">(</span><span class="ident" id="3316192">dec</span>&nbsp;<span class="op" id="3316196">*</span><span class="ident" id="3316197">Decoder</span><span class="op" id="3316204">)</span>&nbsp;<span class="ident" id="3316206">UseNumber</span><span class="op" id="3316215">(</span><span class="op" id="3316216">)</span>&nbsp;<span class="op" id="3316218">{</span>&nbsp;<span class="ident" id="3316220">dec</span><span class="op" id="3316223">.</span><span class="ident" id="3316224">d</span><span class="op" id="3316225">.</span><span class="ident" id="3316226">useNumber</span>&nbsp;<span class="op" id="3316236">=</span>&nbsp;<span class="builtintype" id="3316238">true</span>&nbsp;<span class="op" id="3316243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3316246">//&nbsp;Decode&nbsp;reads&nbsp;the&nbsp;next&nbsp;JSON-encoded&nbsp;value&nbsp;from&nbsp;its</span><br>
<span class="lineno">35</span><span class="comment" id="3316299">//&nbsp;input&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to&nbsp;by&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="3316352">//</span><br>
<span class="lineno"></span><span class="comment" id="3316355">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Unmarshal&nbsp;for&nbsp;details&nbsp;about</span><br>
<span class="lineno"></span><span class="comment" id="3316412">//&nbsp;the&nbsp;conversion&nbsp;of&nbsp;JSON&nbsp;into&nbsp;a&nbsp;Go&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3316455">func</span>&nbsp;<span class="op" id="3316460">(</span><span class="ident" id="3316461">dec</span>&nbsp;<span class="op" id="3316465">*</span><span class="ident" id="3316466">Decoder</span><span class="op" id="3316473">)</span>&nbsp;<span class="ident" id="3316475">Decode</span><span class="op" id="3316481">(</span><span class="ident" id="3316482">v</span>&nbsp;<span class="keyword" id="3316484">interface</span><span class="op" id="3316493">{</span><span class="op" id="3316494">}</span><span class="op" id="3316495">)</span>&nbsp;<span class="builtintype" id="3316497">error</span>&nbsp;<span class="op" id="3316503">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316506">if</span>&nbsp;<span class="ident" id="3316509">dec</span><span class="op" id="3316512">.</span><span class="ident" id="3316513">err</span>&nbsp;<span class="op" id="3316517">!=</span>&nbsp;<span class="ident" id="3316520">nil</span>&nbsp;<span class="op" id="3316524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316528">return</span>&nbsp;<span class="ident" id="3316535">dec</span><span class="op" id="3316538">.</span><span class="ident" id="3316539">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316548">n</span><span class="op" id="3316549">,</span>&nbsp;<span class="ident" id="3316551">err</span>&nbsp;<span class="op" id="3316555">:=</span>&nbsp;<span class="ident" id="3316558">dec</span><span class="op" id="3316561">.</span><span class="ident" id="3316562">readValue</span><span class="op" id="3316571">(</span><span class="op" id="3316572">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316575">if</span>&nbsp;<span class="ident" id="3316578">err</span>&nbsp;<span class="op" id="3316582">!=</span>&nbsp;<span class="ident" id="3316585">nil</span>&nbsp;<span class="op" id="3316589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316593">return</span>&nbsp;<span class="ident" id="3316600">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316609">//&nbsp;Don&#39;t&nbsp;save&nbsp;err&nbsp;from&nbsp;unmarshal&nbsp;into&nbsp;dec.err:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316657">//&nbsp;the&nbsp;connection&nbsp;is&nbsp;still&nbsp;usable&nbsp;since&nbsp;we&nbsp;read&nbsp;a&nbsp;complete&nbsp;JSON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316722">//&nbsp;object&nbsp;from&nbsp;it&nbsp;before&nbsp;the&nbsp;error&nbsp;happened.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316768">dec</span><span class="op" id="3316771">.</span><span class="ident" id="3316772">d</span><span class="op" id="3316773">.</span><span class="ident" id="3316774">init</span><span class="op" id="3316778">(</span><span class="ident" id="3316779">dec</span><span class="op" id="3316782">.</span><span class="ident" id="3316783">buf</span><span class="op" id="3316786">[</span><span class="num" id="3316787">0</span><span class="op" id="3316788">:</span><span class="ident" id="3316789">n</span><span class="op" id="3316790">]</span><span class="op" id="3316791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316794">err</span>&nbsp;<span class="op" id="3316798">=</span>&nbsp;<span class="ident" id="3316800">dec</span><span class="op" id="3316803">.</span><span class="ident" id="3316804">d</span><span class="op" id="3316805">.</span><span class="ident" id="3316806">unmarshal</span><span class="op" id="3316815">(</span><span class="ident" id="3316816">v</span><span class="op" id="3316817">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316821">//&nbsp;Slide&nbsp;rest&nbsp;of&nbsp;data&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316850">rest</span>&nbsp;<span class="op" id="3316855">:=</span>&nbsp;<span class="builtinfunc" id="3316858">copy</span><span class="op" id="3316862">(</span><span class="ident" id="3316863">dec</span><span class="op" id="3316866">.</span><span class="ident" id="3316867">buf</span><span class="op" id="3316870">,</span>&nbsp;<span class="ident" id="3316872">dec</span><span class="op" id="3316875">.</span><span class="ident" id="3316876">buf</span><span class="op" id="3316879">[</span><span class="ident" id="3316880">n</span><span class="op" id="3316881">:</span><span class="op" id="3316882">]</span><span class="op" id="3316883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316886">dec</span><span class="op" id="3316889">.</span><span class="ident" id="3316890">buf</span>&nbsp;<span class="op" id="3316894">=</span>&nbsp;<span class="ident" id="3316896">dec</span><span class="op" id="3316899">.</span><span class="ident" id="3316900">buf</span><span class="op" id="3316903">[</span><span class="num" id="3316904">0</span><span class="op" id="3316905">:</span><span class="ident" id="3316906">rest</span><span class="op" id="3316910">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316914">return</span>&nbsp;<span class="ident" id="3316921">err</span><br>
<span class="lineno">60</span><span class="op" id="3316925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3316928">//&nbsp;Buffered&nbsp;returns&nbsp;a&nbsp;reader&nbsp;of&nbsp;the&nbsp;data&nbsp;remaining&nbsp;in&nbsp;the&nbsp;Decoder&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3316996">//&nbsp;buffer.&nbsp;The&nbsp;reader&nbsp;is&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="keyword" id="3317058">func</span>&nbsp;<span class="op" id="3317063">(</span><span class="ident" id="3317064">dec</span>&nbsp;<span class="op" id="3317068">*</span><span class="ident" id="3317069">Decoder</span><span class="op" id="3317076">)</span>&nbsp;<span class="ident" id="3317078">Buffered</span><span class="op" id="3317086">(</span><span class="op" id="3317087">)</span>&nbsp;<span class="ident" id="3317089">io</span><span class="op" id="3317091">.</span><span class="ident" id="3317092">Reader</span>&nbsp;<span class="op" id="3317099">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317102">return</span>&nbsp;<span class="ident" id="3317109">bytes</span><span class="op" id="3317114">.</span><span class="ident" id="3317115">NewReader</span><span class="op" id="3317124">(</span><span class="ident" id="3317125">dec</span><span class="op" id="3317128">.</span><span class="ident" id="3317129">buf</span><span class="op" id="3317132">)</span><br>
<span class="lineno"></span><span class="op" id="3317134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3317137">//&nbsp;readValue&nbsp;reads&nbsp;a&nbsp;JSON&nbsp;value&nbsp;into&nbsp;dec.buf.</span><br>
<span class="lineno"></span><span class="comment" id="3317183">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno">70</span><span class="keyword" id="3317225">func</span>&nbsp;<span class="op" id="3317230">(</span><span class="ident" id="3317231">dec</span>&nbsp;<span class="op" id="3317235">*</span><span class="ident" id="3317236">Decoder</span><span class="op" id="3317243">)</span>&nbsp;<span class="ident" id="3317245">readValue</span><span class="op" id="3317254">(</span><span class="op" id="3317255">)</span>&nbsp;<span class="op" id="3317257">(</span><span class="builtintype" id="3317258">int</span><span class="op" id="3317261">,</span>&nbsp;<span class="builtintype" id="3317263">error</span><span class="op" id="3317268">)</span>&nbsp;<span class="op" id="3317270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317273">dec</span><span class="op" id="3317276">.</span><span class="ident" id="3317277">scan</span><span class="op" id="3317281">.</span><span class="ident" id="3317282">reset</span><span class="op" id="3317287">(</span><span class="op" id="3317288">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317292">scanp</span>&nbsp;<span class="op" id="3317298">:=</span>&nbsp;<span class="num" id="3317301">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317304">var</span>&nbsp;<span class="ident" id="3317308">err</span>&nbsp;<span class="builtintype" id="3317312">error</span><br>
<span class="lineno">75</span><span class="ident" id="3317318">Input</span><span class="op" id="3317323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317326">for</span>&nbsp;<span class="op" id="3317330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317334">//&nbsp;Look&nbsp;in&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317375">for</span>&nbsp;<span class="ident" id="3317379">i</span><span class="op" id="3317380">,</span>&nbsp;<span class="ident" id="3317382">c</span>&nbsp;<span class="op" id="3317384">:=</span>&nbsp;<span class="keyword" id="3317387">range</span>&nbsp;<span class="ident" id="3317393">dec</span><span class="op" id="3317396">.</span><span class="ident" id="3317397">buf</span><span class="op" id="3317400">[</span><span class="ident" id="3317401">scanp</span><span class="op" id="3317406">:</span><span class="op" id="3317407">]</span>&nbsp;<span class="op" id="3317409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317414">dec</span><span class="op" id="3317417">.</span><span class="ident" id="3317418">scan</span><span class="op" id="3317422">.</span><span class="ident" id="3317423">bytes</span><span class="op" id="3317428">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317434">v</span>&nbsp;<span class="op" id="3317436">:=</span>&nbsp;<span class="ident" id="3317439">dec</span><span class="op" id="3317442">.</span><span class="ident" id="3317443">scan</span><span class="op" id="3317447">.</span><span class="ident" id="3317448">step</span><span class="op" id="3317452">(</span><span class="op" id="3317453">&amp;</span><span class="ident" id="3317454">dec</span><span class="op" id="3317457">.</span><span class="ident" id="3317458">scan</span><span class="op" id="3317462">,</span>&nbsp;<span class="builtintype" id="3317464">int</span><span class="op" id="3317467">(</span><span class="ident" id="3317468">c</span><span class="op" id="3317469">)</span><span class="op" id="3317470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317475">if</span>&nbsp;<span class="ident" id="3317478">v</span>&nbsp;<span class="op" id="3317480">==</span>&nbsp;<span class="ident" id="3317483">scanEnd</span>&nbsp;<span class="op" id="3317491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317497">scanp</span>&nbsp;<span class="op" id="3317503">+=</span>&nbsp;<span class="ident" id="3317506">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317512">break</span>&nbsp;<span class="ident" id="3317518">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317527">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317532">//&nbsp;scanEnd&nbsp;is&nbsp;delayed&nbsp;one&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317567">//&nbsp;We&nbsp;might&nbsp;block&nbsp;trying&nbsp;to&nbsp;get&nbsp;that&nbsp;byte&nbsp;from&nbsp;src,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317622">//&nbsp;so&nbsp;instead&nbsp;invent&nbsp;a&nbsp;space&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317660">if</span>&nbsp;<span class="op" id="3317663">(</span><span class="ident" id="3317664">v</span>&nbsp;<span class="op" id="3317666">==</span>&nbsp;<span class="ident" id="3317669">scanEndObject</span>&nbsp;<span class="op" id="3317683">||</span>&nbsp;<span class="ident" id="3317686">v</span>&nbsp;<span class="op" id="3317688">==</span>&nbsp;<span class="ident" id="3317691">scanEndArray</span><span class="op" id="3317703">)</span>&nbsp;<span class="op" id="3317705">&amp;&amp;</span>&nbsp;<span class="ident" id="3317708">dec</span><span class="op" id="3317711">.</span><span class="ident" id="3317712">scan</span><span class="op" id="3317716">.</span><span class="ident" id="3317717">step</span><span class="op" id="3317721">(</span><span class="op" id="3317722">&amp;</span><span class="ident" id="3317723">dec</span><span class="op" id="3317726">.</span><span class="ident" id="3317727">scan</span><span class="op" id="3317731">,</span>&nbsp;<span class="string" id="3317733">&#39;&nbsp;&#39;</span><span class="op" id="3317736">)</span>&nbsp;<span class="op" id="3317738">==</span>&nbsp;<span class="ident" id="3317741">scanEnd</span>&nbsp;<span class="op" id="3317749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317755">scanp</span>&nbsp;<span class="op" id="3317761">+=</span>&nbsp;<span class="ident" id="3317764">i</span>&nbsp;<span class="op" id="3317766">+</span>&nbsp;<span class="num" id="3317768">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317774">break</span>&nbsp;<span class="ident" id="3317780">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317794">if</span>&nbsp;<span class="ident" id="3317797">v</span>&nbsp;<span class="op" id="3317799">==</span>&nbsp;<span class="ident" id="3317802">scanError</span>&nbsp;<span class="op" id="3317812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317818">dec</span><span class="op" id="3317821">.</span><span class="ident" id="3317822">err</span>&nbsp;<span class="op" id="3317826">=</span>&nbsp;<span class="ident" id="3317828">dec</span><span class="op" id="3317831">.</span><span class="ident" id="3317832">scan</span><span class="op" id="3317836">.</span><span class="ident" id="3317837">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317845">return</span>&nbsp;<span class="num" id="3317852">0</span><span class="op" id="3317853">,</span>&nbsp;<span class="ident" id="3317855">dec</span><span class="op" id="3317858">.</span><span class="ident" id="3317859">scan</span><span class="op" id="3317863">.</span><span class="ident" id="3317864">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317879">scanp</span>&nbsp;<span class="op" id="3317885">=</span>&nbsp;<span class="builtinfunc" id="3317887">len</span><span class="op" id="3317890">(</span><span class="ident" id="3317891">dec</span><span class="op" id="3317894">.</span><span class="ident" id="3317895">buf</span><span class="op" id="3317898">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317903">//&nbsp;Did&nbsp;the&nbsp;last&nbsp;read&nbsp;have&nbsp;an&nbsp;error?</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317941">//&nbsp;Delayed&nbsp;until&nbsp;now&nbsp;to&nbsp;allow&nbsp;buffer&nbsp;scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317986">if</span>&nbsp;<span class="ident" id="3317989">err</span>&nbsp;<span class="op" id="3317993">!=</span>&nbsp;<span class="ident" id="3317996">nil</span>&nbsp;<span class="op" id="3318000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318005">if</span>&nbsp;<span class="ident" id="3318008">err</span>&nbsp;<span class="op" id="3318012">==</span>&nbsp;<span class="ident" id="3318015">io</span><span class="op" id="3318017">.</span><span class="ident" id="3318018">EOF</span>&nbsp;<span class="op" id="3318022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318028">if</span>&nbsp;<span class="ident" id="3318031">dec</span><span class="op" id="3318034">.</span><span class="ident" id="3318035">scan</span><span class="op" id="3318039">.</span><span class="ident" id="3318040">step</span><span class="op" id="3318044">(</span><span class="op" id="3318045">&amp;</span><span class="ident" id="3318046">dec</span><span class="op" id="3318049">.</span><span class="ident" id="3318050">scan</span><span class="op" id="3318054">,</span>&nbsp;<span class="string" id="3318056">&#39;&nbsp;&#39;</span><span class="op" id="3318059">)</span>&nbsp;<span class="op" id="3318061">==</span>&nbsp;<span class="ident" id="3318064">scanEnd</span>&nbsp;<span class="op" id="3318072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318079">break</span>&nbsp;<span class="ident" id="3318085">Input</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318101">if</span>&nbsp;<span class="ident" id="3318104">nonSpace</span><span class="op" id="3318112">(</span><span class="ident" id="3318113">dec</span><span class="op" id="3318116">.</span><span class="ident" id="3318117">buf</span><span class="op" id="3318120">)</span>&nbsp;<span class="op" id="3318122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318129">err</span>&nbsp;<span class="op" id="3318133">=</span>&nbsp;<span class="ident" id="3318135">io</span><span class="op" id="3318137">.</span><span class="ident" id="3318138">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318164">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318169">dec</span><span class="op" id="3318172">.</span><span class="ident" id="3318173">err</span>&nbsp;<span class="op" id="3318177">=</span>&nbsp;<span class="ident" id="3318179">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318186">return</span>&nbsp;<span class="num" id="3318193">0</span><span class="op" id="3318194">,</span>&nbsp;<span class="ident" id="3318196">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3318207">//&nbsp;Make&nbsp;room&nbsp;to&nbsp;read&nbsp;more&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318252">const</span>&nbsp;<span class="ident" id="3318258">minRead</span>&nbsp;<span class="op" id="3318266">=</span>&nbsp;<span class="num" id="3318268">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318274">if</span>&nbsp;<span class="builtinfunc" id="3318277">cap</span><span class="op" id="3318280">(</span><span class="ident" id="3318281">dec</span><span class="op" id="3318284">.</span><span class="ident" id="3318285">buf</span><span class="op" id="3318288">)</span><span class="op" id="3318289">-</span><span class="builtinfunc" id="3318290">len</span><span class="op" id="3318293">(</span><span class="ident" id="3318294">dec</span><span class="op" id="3318297">.</span><span class="ident" id="3318298">buf</span><span class="op" id="3318301">)</span>&nbsp;<span class="op" id="3318303">&lt;</span>&nbsp;<span class="ident" id="3318305">minRead</span>&nbsp;<span class="op" id="3318313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318318">newBuf</span>&nbsp;<span class="op" id="3318325">:=</span>&nbsp;<span class="builtinfunc" id="3318328">make</span><span class="op" id="3318332">(</span><span class="op" id="3318333">[</span><span class="op" id="3318334">]</span><span class="builtintype" id="3318335">byte</span><span class="op" id="3318339">,</span>&nbsp;<span class="builtinfunc" id="3318341">len</span><span class="op" id="3318344">(</span><span class="ident" id="3318345">dec</span><span class="op" id="3318348">.</span><span class="ident" id="3318349">buf</span><span class="op" id="3318352">)</span><span class="op" id="3318353">,</span>&nbsp;<span class="num" id="3318355">2</span><span class="op" id="3318356">*</span><span class="builtinfunc" id="3318357">cap</span><span class="op" id="3318360">(</span><span class="ident" id="3318361">dec</span><span class="op" id="3318364">.</span><span class="ident" id="3318365">buf</span><span class="op" id="3318368">)</span><span class="op" id="3318369">+</span><span class="ident" id="3318370">minRead</span><span class="op" id="3318377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3318382">copy</span><span class="op" id="3318386">(</span><span class="ident" id="3318387">newBuf</span><span class="op" id="3318393">,</span>&nbsp;<span class="ident" id="3318395">dec</span><span class="op" id="3318398">.</span><span class="ident" id="3318399">buf</span><span class="op" id="3318402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318407">dec</span><span class="op" id="3318410">.</span><span class="ident" id="3318411">buf</span>&nbsp;<span class="op" id="3318415">=</span>&nbsp;<span class="ident" id="3318417">newBuf</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3318431">//&nbsp;Read.&nbsp;&nbsp;Delay&nbsp;error&nbsp;for&nbsp;next&nbsp;iteration&nbsp;(after&nbsp;scan).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318488">var</span>&nbsp;<span class="ident" id="3318492">n</span>&nbsp;<span class="builtintype" id="3318494">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318500">n</span><span class="op" id="3318501">,</span>&nbsp;<span class="ident" id="3318503">err</span>&nbsp;<span class="op" id="3318507">=</span>&nbsp;<span class="ident" id="3318509">dec</span><span class="op" id="3318512">.</span><span class="ident" id="3318513">r</span><span class="op" id="3318514">.</span><span class="ident" id="3318515">Read</span><span class="op" id="3318519">(</span><span class="ident" id="3318520">dec</span><span class="op" id="3318523">.</span><span class="ident" id="3318524">buf</span><span class="op" id="3318527">[</span><span class="builtinfunc" id="3318528">len</span><span class="op" id="3318531">(</span><span class="ident" id="3318532">dec</span><span class="op" id="3318535">.</span><span class="ident" id="3318536">buf</span><span class="op" id="3318539">)</span><span class="op" id="3318540">:</span><span class="builtinfunc" id="3318541">cap</span><span class="op" id="3318544">(</span><span class="ident" id="3318545">dec</span><span class="op" id="3318548">.</span><span class="ident" id="3318549">buf</span><span class="op" id="3318552">)</span><span class="op" id="3318553">]</span><span class="op" id="3318554">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318558">dec</span><span class="op" id="3318561">.</span><span class="ident" id="3318562">buf</span>&nbsp;<span class="op" id="3318566">=</span>&nbsp;<span class="ident" id="3318568">dec</span><span class="op" id="3318571">.</span><span class="ident" id="3318572">buf</span><span class="op" id="3318575">[</span><span class="num" id="3318576">0</span>&nbsp;<span class="op" id="3318578">:</span>&nbsp;<span class="builtinfunc" id="3318580">len</span><span class="op" id="3318583">(</span><span class="ident" id="3318584">dec</span><span class="op" id="3318587">.</span><span class="ident" id="3318588">buf</span><span class="op" id="3318591">)</span><span class="op" id="3318592">+</span><span class="ident" id="3318593">n</span><span class="op" id="3318594">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318600">return</span>&nbsp;<span class="ident" id="3318607">scanp</span><span class="op" id="3318612">,</span>&nbsp;<span class="ident" id="3318614">nil</span><br>
<span class="lineno"></span><span class="op" id="3318618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="3318621">func</span>&nbsp;<span class="ident" id="3318626">nonSpace</span><span class="op" id="3318634">(</span><span class="ident" id="3318635">b</span>&nbsp;<span class="op" id="3318637">[</span><span class="op" id="3318638">]</span><span class="builtintype" id="3318639">byte</span><span class="op" id="3318643">)</span>&nbsp;<span class="builtintype" id="3318645">bool</span>&nbsp;<span class="op" id="3318650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318653">for</span>&nbsp;<span class="ident" id="3318657">_</span><span class="op" id="3318658">,</span>&nbsp;<span class="ident" id="3318660">c</span>&nbsp;<span class="op" id="3318662">:=</span>&nbsp;<span class="keyword" id="3318665">range</span>&nbsp;<span class="ident" id="3318671">b</span>&nbsp;<span class="op" id="3318673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318677">if</span>&nbsp;<span class="op" id="3318680">!</span><span class="ident" id="3318681">isSpace</span><span class="op" id="3318688">(</span><span class="builtintype" id="3318689">rune</span><span class="op" id="3318693">(</span><span class="ident" id="3318694">c</span><span class="op" id="3318695">)</span><span class="op" id="3318696">)</span>&nbsp;<span class="op" id="3318698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318703">return</span>&nbsp;<span class="builtintype" id="3318710">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318717">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318723">return</span>&nbsp;<span class="builtintype" id="3318730">false</span><br>
<span class="lineno"></span><span class="op" id="3318736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3318739">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;JSON&nbsp;objects&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">140</span><span class="keyword" id="3318794">type</span>&nbsp;<span class="ident" id="3318799">Encoder</span>&nbsp;<span class="keyword" id="3318807">struct</span>&nbsp;<span class="op" id="3318814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318817">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3318821">io</span><span class="op" id="3318823">.</span><span class="ident" id="3318824">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318832">err</span>&nbsp;<span class="builtintype" id="3318836">error</span><br>
<span class="lineno"></span><span class="op" id="3318842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="3318845">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3318899">func</span>&nbsp;<span class="ident" id="3318904">NewEncoder</span><span class="op" id="3318914">(</span><span class="ident" id="3318915">w</span>&nbsp;<span class="ident" id="3318917">io</span><span class="op" id="3318919">.</span><span class="ident" id="3318920">Writer</span><span class="op" id="3318926">)</span>&nbsp;<span class="op" id="3318928">*</span><span class="ident" id="3318929">Encoder</span>&nbsp;<span class="op" id="3318937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318940">return</span>&nbsp;<span class="op" id="3318947">&amp;</span><span class="ident" id="3318948">Encoder</span><span class="op" id="3318955">{</span><span class="ident" id="3318956">w</span><span class="op" id="3318957">:</span>&nbsp;<span class="ident" id="3318959">w</span><span class="op" id="3318960">}</span><br>
<span class="lineno"></span><span class="op" id="3318962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="3318965">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="3319020">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="3319056">//</span><br>
<span class="lineno"></span><span class="comment" id="3319059">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3319118">//&nbsp;conversion&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;JSON.</span><br>
<span class="lineno">155</span><span class="keyword" id="3319154">func</span>&nbsp;<span class="op" id="3319159">(</span><span class="ident" id="3319160">enc</span>&nbsp;<span class="op" id="3319164">*</span><span class="ident" id="3319165">Encoder</span><span class="op" id="3319172">)</span>&nbsp;<span class="ident" id="3319174">Encode</span><span class="op" id="3319180">(</span><span class="ident" id="3319181">v</span>&nbsp;<span class="keyword" id="3319183">interface</span><span class="op" id="3319192">{</span><span class="op" id="3319193">}</span><span class="op" id="3319194">)</span>&nbsp;<span class="builtintype" id="3319196">error</span>&nbsp;<span class="op" id="3319202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319205">if</span>&nbsp;<span class="ident" id="3319208">enc</span><span class="op" id="3319211">.</span><span class="ident" id="3319212">err</span>&nbsp;<span class="op" id="3319216">!=</span>&nbsp;<span class="ident" id="3319219">nil</span>&nbsp;<span class="op" id="3319223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319227">return</span>&nbsp;<span class="ident" id="3319234">enc</span><span class="op" id="3319237">.</span><span class="ident" id="3319238">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319246">e</span>&nbsp;<span class="op" id="3319248">:=</span>&nbsp;<span class="ident" id="3319251">newEncodeState</span><span class="op" id="3319265">(</span><span class="op" id="3319266">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319269">err</span>&nbsp;<span class="op" id="3319273">:=</span>&nbsp;<span class="ident" id="3319276">e</span><span class="op" id="3319277">.</span><span class="ident" id="3319278">marshal</span><span class="op" id="3319285">(</span><span class="ident" id="3319286">v</span><span class="op" id="3319287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319290">if</span>&nbsp;<span class="ident" id="3319293">err</span>&nbsp;<span class="op" id="3319297">!=</span>&nbsp;<span class="ident" id="3319300">nil</span>&nbsp;<span class="op" id="3319304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319308">return</span>&nbsp;<span class="ident" id="3319315">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319324">//&nbsp;Terminate&nbsp;each&nbsp;value&nbsp;with&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319365">//&nbsp;This&nbsp;makes&nbsp;the&nbsp;output&nbsp;look&nbsp;a&nbsp;little&nbsp;nicer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319411">//&nbsp;when&nbsp;debugging,&nbsp;and&nbsp;some&nbsp;kind&nbsp;of&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319454">//&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;encoded&nbsp;value&nbsp;was&nbsp;a&nbsp;number,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319505">//&nbsp;so&nbsp;that&nbsp;the&nbsp;reader&nbsp;knows&nbsp;there&nbsp;aren&#39;t&nbsp;more</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319552">//&nbsp;digits&nbsp;coming.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319571">e</span><span class="op" id="3319572">.</span><span class="ident" id="3319573">WriteByte</span><span class="op" id="3319582">(</span><span class="string" id="3319583">&#39;\n&#39;</span><span class="op" id="3319587">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319591">if</span>&nbsp;<span class="ident" id="3319594">_</span><span class="op" id="3319595">,</span>&nbsp;<span class="ident" id="3319597">err</span>&nbsp;<span class="op" id="3319601">=</span>&nbsp;<span class="ident" id="3319603">enc</span><span class="op" id="3319606">.</span><span class="ident" id="3319607">w</span><span class="op" id="3319608">.</span><span class="ident" id="3319609">Write</span><span class="op" id="3319614">(</span><span class="ident" id="3319615">e</span><span class="op" id="3319616">.</span><span class="ident" id="3319617">Bytes</span><span class="op" id="3319622">(</span><span class="op" id="3319623">)</span><span class="op" id="3319624">)</span><span class="op" id="3319625">;</span>&nbsp;<span class="ident" id="3319627">err</span>&nbsp;<span class="op" id="3319631">!=</span>&nbsp;<span class="ident" id="3319634">nil</span>&nbsp;<span class="op" id="3319638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319642">enc</span><span class="op" id="3319645">.</span><span class="ident" id="3319646">err</span>&nbsp;<span class="op" id="3319650">=</span>&nbsp;<span class="ident" id="3319652">err</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319660">encodeStatePool</span><span class="op" id="3319675">.</span><span class="ident" id="3319676">Put</span><span class="op" id="3319679">(</span><span class="ident" id="3319680">e</span><span class="op" id="3319681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319684">return</span>&nbsp;<span class="ident" id="3319691">err</span><br>
<span class="lineno"></span><span class="op" id="3319695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3319698">//&nbsp;RawMessage&nbsp;is&nbsp;a&nbsp;raw&nbsp;encoded&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="3319742">//&nbsp;It&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="3319793">//&nbsp;be&nbsp;used&nbsp;to&nbsp;delay&nbsp;JSON&nbsp;decoding&nbsp;or&nbsp;precompute&nbsp;a&nbsp;JSON&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3319858">type</span>&nbsp;<span class="ident" id="3319863">RawMessage</span>&nbsp;<span class="op" id="3319874">[</span><span class="op" id="3319875">]</span><span class="builtintype" id="3319876">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3319882">//&nbsp;MarshalJSON&nbsp;returns&nbsp;*m&nbsp;as&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="3319935">func</span>&nbsp;<span class="op" id="3319940">(</span><span class="ident" id="3319941">m</span>&nbsp;<span class="op" id="3319943">*</span><span class="ident" id="3319944">RawMessage</span><span class="op" id="3319954">)</span>&nbsp;<span class="ident" id="3319956">MarshalJSON</span><span class="op" id="3319967">(</span><span class="op" id="3319968">)</span>&nbsp;<span class="op" id="3319970">(</span><span class="op" id="3319971">[</span><span class="op" id="3319972">]</span><span class="builtintype" id="3319973">byte</span><span class="op" id="3319977">,</span>&nbsp;<span class="builtintype" id="3319979">error</span><span class="op" id="3319984">)</span>&nbsp;<span class="op" id="3319986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319989">return</span>&nbsp;<span class="op" id="3319996">*</span><span class="ident" id="3319997">m</span><span class="op" id="3319998">,</span>&nbsp;<span class="ident" id="3320000">nil</span><br>
<span class="lineno"></span><span class="op" id="3320004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="3320007">//&nbsp;UnmarshalJSON&nbsp;sets&nbsp;*m&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3320051">func</span>&nbsp;<span class="op" id="3320056">(</span><span class="ident" id="3320057">m</span>&nbsp;<span class="op" id="3320059">*</span><span class="ident" id="3320060">RawMessage</span><span class="op" id="3320070">)</span>&nbsp;<span class="ident" id="3320072">UnmarshalJSON</span><span class="op" id="3320085">(</span><span class="ident" id="3320086">data</span>&nbsp;<span class="op" id="3320091">[</span><span class="op" id="3320092">]</span><span class="builtintype" id="3320093">byte</span><span class="op" id="3320097">)</span>&nbsp;<span class="builtintype" id="3320099">error</span>&nbsp;<span class="op" id="3320105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320108">if</span>&nbsp;<span class="ident" id="3320111">m</span>&nbsp;<span class="op" id="3320113">==</span>&nbsp;<span class="ident" id="3320116">nil</span>&nbsp;<span class="op" id="3320120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320124">return</span>&nbsp;<span class="ident" id="3320131">errors</span><span class="op" id="3320137">.</span><span class="ident" id="3320138">New</span><span class="op" id="3320141">(</span><span class="string" id="3320142">&#34;json.RawMessage:&nbsp;UnmarshalJSON&nbsp;on&nbsp;nil&nbsp;pointer&#34;</span><span class="op" id="3320189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320192">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320195">*</span><span class="ident" id="3320196">m</span>&nbsp;<span class="op" id="3320198">=</span>&nbsp;<span class="builtinfunc" id="3320200">append</span><span class="op" id="3320206">(</span><span class="op" id="3320207">(</span><span class="op" id="3320208">*</span><span class="ident" id="3320209">m</span><span class="op" id="3320210">)</span><span class="op" id="3320211">[</span><span class="num" id="3320212">0</span><span class="op" id="3320213">:</span><span class="num" id="3320214">0</span><span class="op" id="3320215">]</span><span class="op" id="3320216">,</span>&nbsp;<span class="ident" id="3320218">data</span><span class="op" id="3320222">...</span><span class="op" id="3320225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320228">return</span>&nbsp;<span class="ident" id="3320235">nil</span><br>
<span class="lineno"></span><span class="op" id="3320239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3320242">var</span>&nbsp;<span class="ident" id="3320246">_</span>&nbsp;<span class="ident" id="3320248">Marshaler</span>&nbsp;<span class="op" id="3320258">=</span>&nbsp;<span class="op" id="3320260">(</span><span class="op" id="3320261">*</span><span class="ident" id="3320262">RawMessage</span><span class="op" id="3320272">)</span><span class="op" id="3320273">(</span><span class="ident" id="3320274">nil</span><span class="op" id="3320277">)</span><br>
<span class="lineno">200</span><span class="keyword" id="3320279">var</span>&nbsp;<span class="ident" id="3320283">_</span>&nbsp;<span class="ident" id="3320285">Unmarshaler</span>&nbsp;<span class="op" id="3320297">=</span>&nbsp;<span class="op" id="3320299">(</span><span class="op" id="3320300">*</span><span class="ident" id="3320301">RawMessage</span><span class="op" id="3320311">)</span><span class="op" id="3320312">(</span><span class="ident" id="3320313">nil</span><span class="op" id="3320316">)</span>
</div>
</body>
</html>
