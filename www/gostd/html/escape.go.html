<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html</h2>
<ul>
<li><a href="/gostd/html/entity.go.html">entity.go</a></li>
<li><a href="/gostd/html/entity_test.go.html">entity_test.go</a></li>
<li><a href="/gostd/html/escape.go.html" class="current">escape.go</a></li>
<li><a href="/gostd/html/escape_test.go.html">escape_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5319600">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5319655">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5319709">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5319760">//&nbsp;Package&nbsp;html&nbsp;provides&nbsp;functions&nbsp;for&nbsp;escaping&nbsp;and&nbsp;unescaping&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5319834">package</span>&nbsp;<span class="ident" id="5319842">html</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5319848">import</span>&nbsp;<span class="op" id="5319855">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5319858">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5319867">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5319878">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5319893">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5319896">type</span>&nbsp;<span class="ident" id="5319901">writer</span>&nbsp;<span class="keyword" id="5319908">interface</span>&nbsp;<span class="op" id="5319918">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5319921">WriteString</span><span class="op" id="5319932">(</span><span class="builtintype" id="5319933">string</span><span class="op" id="5319939">)</span>&nbsp;<span class="op" id="5319941">(</span><span class="builtintype" id="5319942">int</span><span class="op" id="5319945">,</span>&nbsp;<span class="builtintype" id="5319947">error</span><span class="op" id="5319952">)</span><br>
<span class="lineno"></span><span class="op" id="5319954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5319957">//&nbsp;These&nbsp;replacements&nbsp;permit&nbsp;compatibility&nbsp;with&nbsp;old&nbsp;numeric&nbsp;entities&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5320031">//&nbsp;assumed&nbsp;Windows-1252&nbsp;encoding.</span><br>
<span class="lineno">20</span><span class="comment" id="5320065">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><span class="keyword" id="5320176">var</span>&nbsp;<span class="ident" id="5320180">replacementTable</span>&nbsp;<span class="op" id="5320197">=</span>&nbsp;<span class="op" id="5320199">[</span><span class="op" id="5320200">...</span><span class="op" id="5320203">]</span><span class="builtintype" id="5320204">rune</span><span class="op" id="5320208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320211">&#39;\u20AC&#39;</span><span class="op" id="5320219">,</span>&nbsp;<span class="comment" id="5320221">//&nbsp;First&nbsp;entry&nbsp;is&nbsp;what&nbsp;0x80&nbsp;should&nbsp;be&nbsp;replaced&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320275">&#39;\u0081&#39;</span><span class="op" id="5320283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320286">&#39;\u201A&#39;</span><span class="op" id="5320294">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320297">&#39;\u0192&#39;</span><span class="op" id="5320305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320308">&#39;\u201E&#39;</span><span class="op" id="5320316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320319">&#39;\u2026&#39;</span><span class="op" id="5320327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320330">&#39;\u2020&#39;</span><span class="op" id="5320338">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320341">&#39;\u2021&#39;</span><span class="op" id="5320349">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320352">&#39;\u02C6&#39;</span><span class="op" id="5320360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320363">&#39;\u2030&#39;</span><span class="op" id="5320371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320374">&#39;\u0160&#39;</span><span class="op" id="5320382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320385">&#39;\u2039&#39;</span><span class="op" id="5320393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320396">&#39;\u0152&#39;</span><span class="op" id="5320404">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320407">&#39;\u008D&#39;</span><span class="op" id="5320415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320418">&#39;\u017D&#39;</span><span class="op" id="5320426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320429">&#39;\u008F&#39;</span><span class="op" id="5320437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320440">&#39;\u0090&#39;</span><span class="op" id="5320448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320451">&#39;\u2018&#39;</span><span class="op" id="5320459">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320462">&#39;\u2019&#39;</span><span class="op" id="5320470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320473">&#39;\u201C&#39;</span><span class="op" id="5320481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320484">&#39;\u201D&#39;</span><span class="op" id="5320492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320495">&#39;\u2022&#39;</span><span class="op" id="5320503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320506">&#39;\u2013&#39;</span><span class="op" id="5320514">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320517">&#39;\u2014&#39;</span><span class="op" id="5320525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320528">&#39;\u02DC&#39;</span><span class="op" id="5320536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320539">&#39;\u2122&#39;</span><span class="op" id="5320547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320550">&#39;\u0161&#39;</span><span class="op" id="5320558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320561">&#39;\u203A&#39;</span><span class="op" id="5320569">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320572">&#39;\u0153&#39;</span><span class="op" id="5320580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320583">&#39;\u009D&#39;</span><span class="op" id="5320591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320594">&#39;\u017E&#39;</span><span class="op" id="5320602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5320605">&#39;\u0178&#39;</span><span class="op" id="5320613">,</span>&nbsp;<span class="comment" id="5320615">//&nbsp;Last&nbsp;entry&nbsp;is&nbsp;0x9F.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5320639">//&nbsp;0x00-&gt;&#39;\uFFFD&#39;&nbsp;is&nbsp;handled&nbsp;programmatically.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5320687">//&nbsp;0x0D-&gt;&#39;\u000D&#39;&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="op" id="5320717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5320720">//&nbsp;unescapeEntity&nbsp;reads&nbsp;an&nbsp;entity&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;from&nbsp;b[src:]&nbsp;and&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5320794">//&nbsp;corresponding&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;b[dst:],&nbsp;returning&nbsp;the&nbsp;incremented&nbsp;dst&nbsp;and&nbsp;src&nbsp;cursors.</span><br>
<span class="lineno">60</span><span class="comment" id="5320874">//&nbsp;Precondition:&nbsp;b[src]&nbsp;==&nbsp;&#39;&amp;&#39;&nbsp;&amp;&amp;&nbsp;dst&nbsp;&lt;=&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="5320920">//&nbsp;attribute&nbsp;should&nbsp;be&nbsp;true&nbsp;if&nbsp;parsing&nbsp;an&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5320979">func</span>&nbsp;<span class="ident" id="5320984">unescapeEntity</span><span class="op" id="5320998">(</span><span class="ident" id="5320999">b</span>&nbsp;<span class="op" id="5321001">[</span><span class="op" id="5321002">]</span><span class="builtintype" id="5321003">byte</span><span class="op" id="5321007">,</span>&nbsp;<span class="ident" id="5321009">dst</span><span class="op" id="5321012">,</span>&nbsp;<span class="ident" id="5321014">src</span>&nbsp;<span class="builtintype" id="5321018">int</span><span class="op" id="5321021">,</span>&nbsp;<span class="ident" id="5321023">attribute</span>&nbsp;<span class="builtintype" id="5321033">bool</span><span class="op" id="5321037">)</span>&nbsp;<span class="op" id="5321039">(</span><span class="ident" id="5321040">dst1</span><span class="op" id="5321044">,</span>&nbsp;<span class="ident" id="5321046">src1</span>&nbsp;<span class="builtintype" id="5321051">int</span><span class="op" id="5321054">)</span>&nbsp;<span class="op" id="5321056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5321059">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5321172">//&nbsp;i&nbsp;starts&nbsp;at&nbsp;1&nbsp;because&nbsp;we&nbsp;already&nbsp;know&nbsp;that&nbsp;s[0]&nbsp;==&nbsp;&#39;&amp;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321232">i</span><span class="op" id="5321233">,</span>&nbsp;<span class="ident" id="5321235">s</span>&nbsp;<span class="op" id="5321237">:=</span>&nbsp;<span class="num" id="5321240">1</span><span class="op" id="5321241">,</span>&nbsp;<span class="ident" id="5321243">b</span><span class="op" id="5321244">[</span><span class="ident" id="5321245">src</span><span class="op" id="5321248">:</span><span class="op" id="5321249">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321253">if</span>&nbsp;<span class="builtinfunc" id="5321256">len</span><span class="op" id="5321259">(</span><span class="ident" id="5321260">s</span><span class="op" id="5321261">)</span>&nbsp;<span class="op" id="5321263">&lt;=</span>&nbsp;<span class="num" id="5321266">1</span>&nbsp;<span class="op" id="5321268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321272">b</span><span class="op" id="5321273">[</span><span class="ident" id="5321274">dst</span><span class="op" id="5321277">]</span>&nbsp;<span class="op" id="5321279">=</span>&nbsp;<span class="ident" id="5321281">b</span><span class="op" id="5321282">[</span><span class="ident" id="5321283">src</span><span class="op" id="5321286">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321290">return</span>&nbsp;<span class="ident" id="5321297">dst</span>&nbsp;<span class="op" id="5321301">+</span>&nbsp;<span class="num" id="5321303">1</span><span class="op" id="5321304">,</span>&nbsp;<span class="ident" id="5321306">src</span>&nbsp;<span class="op" id="5321310">+</span>&nbsp;<span class="num" id="5321312">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321319">if</span>&nbsp;<span class="ident" id="5321322">s</span><span class="op" id="5321323">[</span><span class="ident" id="5321324">i</span><span class="op" id="5321325">]</span>&nbsp;<span class="op" id="5321327">==</span>&nbsp;<span class="string" id="5321330">&#39;#&#39;</span>&nbsp;<span class="op" id="5321334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321338">if</span>&nbsp;<span class="builtinfunc" id="5321341">len</span><span class="op" id="5321344">(</span><span class="ident" id="5321345">s</span><span class="op" id="5321346">)</span>&nbsp;<span class="op" id="5321348">&lt;=</span>&nbsp;<span class="num" id="5321351">3</span>&nbsp;<span class="op" id="5321353">{</span>&nbsp;<span class="comment" id="5321355">//&nbsp;We&nbsp;need&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;&#34;&amp;#.&#34;.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321393">b</span><span class="op" id="5321394">[</span><span class="ident" id="5321395">dst</span><span class="op" id="5321398">]</span>&nbsp;<span class="op" id="5321400">=</span>&nbsp;<span class="ident" id="5321402">b</span><span class="op" id="5321403">[</span><span class="ident" id="5321404">src</span><span class="op" id="5321407">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321412">return</span>&nbsp;<span class="ident" id="5321419">dst</span>&nbsp;<span class="op" id="5321423">+</span>&nbsp;<span class="num" id="5321425">1</span><span class="op" id="5321426">,</span>&nbsp;<span class="ident" id="5321428">src</span>&nbsp;<span class="op" id="5321432">+</span>&nbsp;<span class="num" id="5321434">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321442">i</span><span class="op" id="5321443">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321448">c</span>&nbsp;<span class="op" id="5321450">:=</span>&nbsp;<span class="ident" id="5321453">s</span><span class="op" id="5321454">[</span><span class="ident" id="5321455">i</span><span class="op" id="5321456">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321460">hex</span>&nbsp;<span class="op" id="5321464">:=</span>&nbsp;<span class="builtintype" id="5321467">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321475">if</span>&nbsp;<span class="ident" id="5321478">c</span>&nbsp;<span class="op" id="5321480">==</span>&nbsp;<span class="string" id="5321483">&#39;x&#39;</span>&nbsp;<span class="op" id="5321487">||</span>&nbsp;<span class="ident" id="5321490">c</span>&nbsp;<span class="op" id="5321492">==</span>&nbsp;<span class="string" id="5321495">&#39;X&#39;</span>&nbsp;<span class="op" id="5321499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321504">hex</span>&nbsp;<span class="op" id="5321508">=</span>&nbsp;<span class="builtintype" id="5321510">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321518">i</span><span class="op" id="5321519">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321524">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321529">x</span>&nbsp;<span class="op" id="5321531">:=</span>&nbsp;<span class="string" id="5321534">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321543">for</span>&nbsp;<span class="ident" id="5321547">i</span>&nbsp;<span class="op" id="5321549">&lt;</span>&nbsp;<span class="builtinfunc" id="5321551">len</span><span class="op" id="5321554">(</span><span class="ident" id="5321555">s</span><span class="op" id="5321556">)</span>&nbsp;<span class="op" id="5321558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321563">c</span>&nbsp;<span class="op" id="5321565">=</span>&nbsp;<span class="ident" id="5321567">s</span><span class="op" id="5321568">[</span><span class="ident" id="5321569">i</span><span class="op" id="5321570">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321575">i</span><span class="op" id="5321576">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321582">if</span>&nbsp;<span class="ident" id="5321585">hex</span>&nbsp;<span class="op" id="5321589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321595">if</span>&nbsp;<span class="string" id="5321598">&#39;0&#39;</span>&nbsp;<span class="op" id="5321602">&lt;=</span>&nbsp;<span class="ident" id="5321605">c</span>&nbsp;<span class="op" id="5321607">&amp;&amp;</span>&nbsp;<span class="ident" id="5321610">c</span>&nbsp;<span class="op" id="5321612">&lt;=</span>&nbsp;<span class="string" id="5321615">&#39;9&#39;</span>&nbsp;<span class="op" id="5321619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321626">x</span>&nbsp;<span class="op" id="5321628">=</span>&nbsp;<span class="num" id="5321630">16</span><span class="op" id="5321632">*</span><span class="ident" id="5321633">x</span>&nbsp;<span class="op" id="5321635">+</span>&nbsp;<span class="builtintype" id="5321637">rune</span><span class="op" id="5321641">(</span><span class="ident" id="5321642">c</span><span class="op" id="5321643">)</span>&nbsp;<span class="op" id="5321645">-</span>&nbsp;<span class="string" id="5321647">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321656">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321669">}</span>&nbsp;<span class="keyword" id="5321671">else</span>&nbsp;<span class="keyword" id="5321676">if</span>&nbsp;<span class="string" id="5321679">&#39;a&#39;</span>&nbsp;<span class="op" id="5321683">&lt;=</span>&nbsp;<span class="ident" id="5321686">c</span>&nbsp;<span class="op" id="5321688">&amp;&amp;</span>&nbsp;<span class="ident" id="5321691">c</span>&nbsp;<span class="op" id="5321693">&lt;=</span>&nbsp;<span class="string" id="5321696">&#39;f&#39;</span>&nbsp;<span class="op" id="5321700">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321707">x</span>&nbsp;<span class="op" id="5321709">=</span>&nbsp;<span class="num" id="5321711">16</span><span class="op" id="5321713">*</span><span class="ident" id="5321714">x</span>&nbsp;<span class="op" id="5321716">+</span>&nbsp;<span class="builtintype" id="5321718">rune</span><span class="op" id="5321722">(</span><span class="ident" id="5321723">c</span><span class="op" id="5321724">)</span>&nbsp;<span class="op" id="5321726">-</span>&nbsp;<span class="string" id="5321728">&#39;a&#39;</span>&nbsp;<span class="op" id="5321732">+</span>&nbsp;<span class="num" id="5321734">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321742">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321755">}</span>&nbsp;<span class="keyword" id="5321757">else</span>&nbsp;<span class="keyword" id="5321762">if</span>&nbsp;<span class="string" id="5321765">&#39;A&#39;</span>&nbsp;<span class="op" id="5321769">&lt;=</span>&nbsp;<span class="ident" id="5321772">c</span>&nbsp;<span class="op" id="5321774">&amp;&amp;</span>&nbsp;<span class="ident" id="5321777">c</span>&nbsp;<span class="op" id="5321779">&lt;=</span>&nbsp;<span class="string" id="5321782">&#39;F&#39;</span>&nbsp;<span class="op" id="5321786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321793">x</span>&nbsp;<span class="op" id="5321795">=</span>&nbsp;<span class="num" id="5321797">16</span><span class="op" id="5321799">*</span><span class="ident" id="5321800">x</span>&nbsp;<span class="op" id="5321802">+</span>&nbsp;<span class="builtintype" id="5321804">rune</span><span class="op" id="5321808">(</span><span class="ident" id="5321809">c</span><span class="op" id="5321810">)</span>&nbsp;<span class="op" id="5321812">-</span>&nbsp;<span class="string" id="5321814">&#39;A&#39;</span>&nbsp;<span class="op" id="5321818">+</span>&nbsp;<span class="num" id="5321820">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321828">continue</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321846">}</span>&nbsp;<span class="keyword" id="5321848">else</span>&nbsp;<span class="keyword" id="5321853">if</span>&nbsp;<span class="string" id="5321856">&#39;0&#39;</span>&nbsp;<span class="op" id="5321860">&lt;=</span>&nbsp;<span class="ident" id="5321863">c</span>&nbsp;<span class="op" id="5321865">&amp;&amp;</span>&nbsp;<span class="ident" id="5321868">c</span>&nbsp;<span class="op" id="5321870">&lt;=</span>&nbsp;<span class="string" id="5321873">&#39;9&#39;</span>&nbsp;<span class="op" id="5321877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321883">x</span>&nbsp;<span class="op" id="5321885">=</span>&nbsp;<span class="num" id="5321887">10</span><span class="op" id="5321889">*</span><span class="ident" id="5321890">x</span>&nbsp;<span class="op" id="5321892">+</span>&nbsp;<span class="builtintype" id="5321894">rune</span><span class="op" id="5321898">(</span><span class="ident" id="5321899">c</span><span class="op" id="5321900">)</span>&nbsp;<span class="op" id="5321902">-</span>&nbsp;<span class="string" id="5321904">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321912">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321924">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321929">if</span>&nbsp;<span class="ident" id="5321932">c</span>&nbsp;<span class="op" id="5321934">!=</span>&nbsp;<span class="string" id="5321937">&#39;;&#39;</span>&nbsp;<span class="op" id="5321941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321947">i</span><span class="op" id="5321948">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321959">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321967">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321972">if</span>&nbsp;<span class="ident" id="5321975">i</span>&nbsp;<span class="op" id="5321977">&lt;=</span>&nbsp;<span class="num" id="5321980">3</span>&nbsp;<span class="op" id="5321982">{</span>&nbsp;<span class="comment" id="5321984">//&nbsp;No&nbsp;characters&nbsp;matched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5322013">b</span><span class="op" id="5322014">[</span><span class="ident" id="5322015">dst</span><span class="op" id="5322018">]</span>&nbsp;<span class="op" id="5322020">=</span>&nbsp;<span class="ident" id="5322022">b</span><span class="op" id="5322023">[</span><span class="ident" id="5322024">src</span><span class="op" id="5322027">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5322032">return</span>&nbsp;<span class="ident" id="5322039">dst</span>&nbsp;<span class="op" id="5322043">+</span>&nbsp;<span class="num" id="5322045">1</span><span class="op" id="5322046">,</span>&nbsp;<span class="ident" id="5322048">src</span>&nbsp;<span class="op" id="5322052">+</span>&nbsp;<span class="num" id="5322054">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5322058">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5322063">if</span>&nbsp;<span class="num" id="5322066">0x80</span>&nbsp;<span class="op" id="5322071">&lt;=</span>&nbsp;<span class="ident" id="5322074">x</span>&nbsp;<span class="op" id="5322076">&amp;&amp;</span>&nbsp;<span class="ident" id="5322079">x</span>&nbsp;<span class="op" id="5322081">&lt;=</span>&nbsp;<span class="num" id="5322084">0x9F</span>&nbsp;<span class="op" id="5322089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322094">//&nbsp;Replace&nbsp;characters&nbsp;from&nbsp;Windows-1252&nbsp;with&nbsp;UTF-8&nbsp;equivalents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5322161">x</span>&nbsp;<span class="op" id="5322163">=</span>&nbsp;<span class="ident" id="5322165">replacementTable</span><span class="op" id="5322181">[</span><span class="ident" id="5322182">x</span><span class="op" id="5322183">-</span><span class="num" id="5322184">0x80</span><span class="op" id="5322188">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5322192">}</span>&nbsp;<span class="keyword" id="5322194">else</span>&nbsp;<span class="keyword" id="5322199">if</span>&nbsp;<span class="ident" id="5322202">x</span>&nbsp;<span class="op" id="5322204">==</span>&nbsp;<span class="num" id="5322207">0</span>&nbsp;<span class="op" id="5322209">||</span>&nbsp;<span class="op" id="5322212">(</span><span class="num" id="5322213">0xD800</span>&nbsp;<span class="op" id="5322220">&lt;=</span>&nbsp;<span class="ident" id="5322223">x</span>&nbsp;<span class="op" id="5322225">&amp;&amp;</span>&nbsp;<span class="ident" id="5322228">x</span>&nbsp;<span class="op" id="5322230">&lt;=</span>&nbsp;<span class="num" id="5322233">0xDFFF</span><span class="op" id="5322239">)</span>&nbsp;<span class="op" id="5322241">||</span>&nbsp;<span class="ident" id="5322244">x</span>&nbsp;<span class="op" id="5322246">&gt;</span>&nbsp;<span class="num" id="5322248">0x10FFFF</span>&nbsp;<span class="op" id="5322257">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322262">//&nbsp;Replace&nbsp;invalid&nbsp;characters&nbsp;with&nbsp;the&nbsp;replacement&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5322327">x</span>&nbsp;<span class="op" id="5322329">=</span>&nbsp;<span class="string" id="5322331">&#39;\uFFFD&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5322342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5322347">return</span>&nbsp;<span class="ident" id="5322354">dst</span>&nbsp;<span class="op" id="5322358">+</span>&nbsp;<span class="ident" id="5322360">utf8</span><span class="op" id="5322364">.</span><span class="ident" id="5322365">EncodeRune</span><span class="op" id="5322375">(</span><span class="ident" id="5322376">b</span><span class="op" id="5322377">[</span><span class="ident" id="5322378">dst</span><span class="op" id="5322381">:</span><span class="op" id="5322382">]</span><span class="op" id="5322383">,</span>&nbsp;<span class="ident" id="5322385">x</span><span class="op" id="5322386">)</span><span class="op" id="5322387">,</span>&nbsp;<span class="ident" id="5322389">src</span>&nbsp;<span class="op" id="5322393">+</span>&nbsp;<span class="ident" id="5322395">i</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5322398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322402">//&nbsp;Consume&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;characters&nbsp;possible,&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322466">//&nbsp;consumed&nbsp;characters&nbsp;matching&nbsp;one&nbsp;of&nbsp;the&nbsp;named&nbsp;references.</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5322529">for</span>&nbsp;<span class="ident" id="5322533">i</span>&nbsp;<span class="op" id="5322535">&lt;</span>&nbsp;<span class="builtinfunc" id="5322537">len</span><span class="op" id="5322540">(</span><span class="ident" id="5322541">s</span><span class="op" id="5322542">)</span>&nbsp;<span class="op" id="5322544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5322548">c</span>&nbsp;<span class="op" id="5322550">:=</span>&nbsp;<span class="ident" id="5322553">s</span><span class="op" id="5322554">[</span><span class="ident" id="5322555">i</span><span class="op" id="5322556">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5322560">i</span><span class="op" id="5322561">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322566">//&nbsp;Lower-cased&nbsp;characters&nbsp;are&nbsp;more&nbsp;common&nbsp;in&nbsp;entities,&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;them&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5322651">if</span>&nbsp;<span class="string" id="5322654">&#39;a&#39;</span>&nbsp;<span class="op" id="5322658">&lt;=</span>&nbsp;<span class="ident" id="5322661">c</span>&nbsp;<span class="op" id="5322663">&amp;&amp;</span>&nbsp;<span class="ident" id="5322666">c</span>&nbsp;<span class="op" id="5322668">&lt;=</span>&nbsp;<span class="string" id="5322671">&#39;z&#39;</span>&nbsp;<span class="op" id="5322675">||</span>&nbsp;<span class="string" id="5322678">&#39;A&#39;</span>&nbsp;<span class="op" id="5322682">&lt;=</span>&nbsp;<span class="ident" id="5322685">c</span>&nbsp;<span class="op" id="5322687">&amp;&amp;</span>&nbsp;<span class="ident" id="5322690">c</span>&nbsp;<span class="op" id="5322692">&lt;=</span>&nbsp;<span class="string" id="5322695">&#39;Z&#39;</span>&nbsp;<span class="op" id="5322699">||</span>&nbsp;<span class="string" id="5322702">&#39;0&#39;</span>&nbsp;<span class="op" id="5322706">&lt;=</span>&nbsp;<span class="ident" id="5322709">c</span>&nbsp;<span class="op" id="5322711">&amp;&amp;</span>&nbsp;<span class="ident" id="5322714">c</span>&nbsp;<span class="op" id="5322716">&lt;=</span>&nbsp;<span class="string" id="5322719">&#39;9&#39;</span>&nbsp;<span class="op" id="5322723">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5322728">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5322739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5322743">if</span>&nbsp;<span class="ident" id="5322746">c</span>&nbsp;<span class="op" id="5322748">!=</span>&nbsp;<span class="string" id="5322751">&#39;;&#39;</span>&nbsp;<span class="op" id="5322755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5322760">i</span><span class="op" id="5322761">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5322766">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5322770">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5322777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5322781">entityName</span>&nbsp;<span class="op" id="5322792">:=</span>&nbsp;<span class="builtintype" id="5322795">string</span><span class="op" id="5322801">(</span><span class="ident" id="5322802">s</span><span class="op" id="5322803">[</span><span class="num" id="5322804">1</span><span class="op" id="5322805">:</span><span class="ident" id="5322806">i</span><span class="op" id="5322807">]</span><span class="op" id="5322808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5322811">if</span>&nbsp;<span class="ident" id="5322814">entityName</span>&nbsp;<span class="op" id="5322825">==</span>&nbsp;<span class="string" id="5322828">&#34;&#34;</span>&nbsp;<span class="op" id="5322831">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322835">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5322846">}</span>&nbsp;<span class="keyword" id="5322848">else</span>&nbsp;<span class="keyword" id="5322853">if</span>&nbsp;<span class="ident" id="5322856">attribute</span>&nbsp;<span class="op" id="5322866">&amp;&amp;</span>&nbsp;<span class="ident" id="5322869">entityName</span><span class="op" id="5322879">[</span><span class="builtinfunc" id="5322880">len</span><span class="op" id="5322883">(</span><span class="ident" id="5322884">entityName</span><span class="op" id="5322894">)</span><span class="op" id="5322895">-</span><span class="num" id="5322896">1</span><span class="op" id="5322897">]</span>&nbsp;<span class="op" id="5322899">!=</span>&nbsp;<span class="string" id="5322902">&#39;;&#39;</span>&nbsp;<span class="op" id="5322906">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5322909">len</span><span class="op" id="5322912">(</span><span class="ident" id="5322913">s</span><span class="op" id="5322914">)</span>&nbsp;<span class="op" id="5322916">&gt;</span>&nbsp;<span class="ident" id="5322918">i</span>&nbsp;<span class="op" id="5322920">&amp;&amp;</span>&nbsp;<span class="ident" id="5322923">s</span><span class="op" id="5322924">[</span><span class="ident" id="5322925">i</span><span class="op" id="5322926">]</span>&nbsp;<span class="op" id="5322928">==</span>&nbsp;<span class="string" id="5322931">&#39;=&#39;</span>&nbsp;<span class="op" id="5322935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322939">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5322950">}</span>&nbsp;<span class="keyword" id="5322952">else</span>&nbsp;<span class="keyword" id="5322957">if</span>&nbsp;<span class="ident" id="5322960">x</span>&nbsp;<span class="op" id="5322962">:=</span>&nbsp;<span class="ident" id="5322965">entity</span><span class="op" id="5322971">[</span><span class="ident" id="5322972">entityName</span><span class="op" id="5322982">]</span><span class="op" id="5322983">;</span>&nbsp;<span class="ident" id="5322985">x</span>&nbsp;<span class="op" id="5322987">!=</span>&nbsp;<span class="num" id="5322990">0</span>&nbsp;<span class="op" id="5322992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5322996">return</span>&nbsp;<span class="ident" id="5323003">dst</span>&nbsp;<span class="op" id="5323007">+</span>&nbsp;<span class="ident" id="5323009">utf8</span><span class="op" id="5323013">.</span><span class="ident" id="5323014">EncodeRune</span><span class="op" id="5323024">(</span><span class="ident" id="5323025">b</span><span class="op" id="5323026">[</span><span class="ident" id="5323027">dst</span><span class="op" id="5323030">:</span><span class="op" id="5323031">]</span><span class="op" id="5323032">,</span>&nbsp;<span class="ident" id="5323034">x</span><span class="op" id="5323035">)</span><span class="op" id="5323036">,</span>&nbsp;<span class="ident" id="5323038">src</span>&nbsp;<span class="op" id="5323042">+</span>&nbsp;<span class="ident" id="5323044">i</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323047">}</span>&nbsp;<span class="keyword" id="5323049">else</span>&nbsp;<span class="keyword" id="5323054">if</span>&nbsp;<span class="ident" id="5323057">x</span>&nbsp;<span class="op" id="5323059">:=</span>&nbsp;<span class="ident" id="5323062">entity2</span><span class="op" id="5323069">[</span><span class="ident" id="5323070">entityName</span><span class="op" id="5323080">]</span><span class="op" id="5323081">;</span>&nbsp;<span class="ident" id="5323083">x</span><span class="op" id="5323084">[</span><span class="num" id="5323085">0</span><span class="op" id="5323086">]</span>&nbsp;<span class="op" id="5323088">!=</span>&nbsp;<span class="num" id="5323091">0</span>&nbsp;<span class="op" id="5323093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323097">dst1</span>&nbsp;<span class="op" id="5323102">:=</span>&nbsp;<span class="ident" id="5323105">dst</span>&nbsp;<span class="op" id="5323109">+</span>&nbsp;<span class="ident" id="5323111">utf8</span><span class="op" id="5323115">.</span><span class="ident" id="5323116">EncodeRune</span><span class="op" id="5323126">(</span><span class="ident" id="5323127">b</span><span class="op" id="5323128">[</span><span class="ident" id="5323129">dst</span><span class="op" id="5323132">:</span><span class="op" id="5323133">]</span><span class="op" id="5323134">,</span>&nbsp;<span class="ident" id="5323136">x</span><span class="op" id="5323137">[</span><span class="num" id="5323138">0</span><span class="op" id="5323139">]</span><span class="op" id="5323140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323144">return</span>&nbsp;<span class="ident" id="5323151">dst1</span>&nbsp;<span class="op" id="5323156">+</span>&nbsp;<span class="ident" id="5323158">utf8</span><span class="op" id="5323162">.</span><span class="ident" id="5323163">EncodeRune</span><span class="op" id="5323173">(</span><span class="ident" id="5323174">b</span><span class="op" id="5323175">[</span><span class="ident" id="5323176">dst1</span><span class="op" id="5323180">:</span><span class="op" id="5323181">]</span><span class="op" id="5323182">,</span>&nbsp;<span class="ident" id="5323184">x</span><span class="op" id="5323185">[</span><span class="num" id="5323186">1</span><span class="op" id="5323187">]</span><span class="op" id="5323188">)</span><span class="op" id="5323189">,</span>&nbsp;<span class="ident" id="5323191">src</span>&nbsp;<span class="op" id="5323195">+</span>&nbsp;<span class="ident" id="5323197">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323200">}</span>&nbsp;<span class="keyword" id="5323202">else</span>&nbsp;<span class="keyword" id="5323207">if</span>&nbsp;<span class="op" id="5323210">!</span><span class="ident" id="5323211">attribute</span>&nbsp;<span class="op" id="5323221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323225">maxLen</span>&nbsp;<span class="op" id="5323232">:=</span>&nbsp;<span class="builtinfunc" id="5323235">len</span><span class="op" id="5323238">(</span><span class="ident" id="5323239">entityName</span><span class="op" id="5323249">)</span>&nbsp;<span class="op" id="5323251">-</span>&nbsp;<span class="num" id="5323253">1</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323257">if</span>&nbsp;<span class="ident" id="5323260">maxLen</span>&nbsp;<span class="op" id="5323267">&gt;</span>&nbsp;<span class="ident" id="5323269">longestEntityWithoutSemicolon</span>&nbsp;<span class="op" id="5323299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323304">maxLen</span>&nbsp;<span class="op" id="5323311">=</span>&nbsp;<span class="ident" id="5323313">longestEntityWithoutSemicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323349">for</span>&nbsp;<span class="ident" id="5323353">j</span>&nbsp;<span class="op" id="5323355">:=</span>&nbsp;<span class="ident" id="5323358">maxLen</span><span class="op" id="5323364">;</span>&nbsp;<span class="ident" id="5323366">j</span>&nbsp;<span class="op" id="5323368">&gt;</span>&nbsp;<span class="num" id="5323370">1</span><span class="op" id="5323371">;</span>&nbsp;<span class="ident" id="5323373">j</span><span class="op" id="5323374">--</span>&nbsp;<span class="op" id="5323377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323382">if</span>&nbsp;<span class="ident" id="5323385">x</span>&nbsp;<span class="op" id="5323387">:=</span>&nbsp;<span class="ident" id="5323390">entity</span><span class="op" id="5323396">[</span><span class="ident" id="5323397">entityName</span><span class="op" id="5323407">[</span><span class="op" id="5323408">:</span><span class="ident" id="5323409">j</span><span class="op" id="5323410">]</span><span class="op" id="5323411">]</span><span class="op" id="5323412">;</span>&nbsp;<span class="ident" id="5323414">x</span>&nbsp;<span class="op" id="5323416">!=</span>&nbsp;<span class="num" id="5323419">0</span>&nbsp;<span class="op" id="5323421">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323427">return</span>&nbsp;<span class="ident" id="5323434">dst</span>&nbsp;<span class="op" id="5323438">+</span>&nbsp;<span class="ident" id="5323440">utf8</span><span class="op" id="5323444">.</span><span class="ident" id="5323445">EncodeRune</span><span class="op" id="5323455">(</span><span class="ident" id="5323456">b</span><span class="op" id="5323457">[</span><span class="ident" id="5323458">dst</span><span class="op" id="5323461">:</span><span class="op" id="5323462">]</span><span class="op" id="5323463">,</span>&nbsp;<span class="ident" id="5323465">x</span><span class="op" id="5323466">)</span><span class="op" id="5323467">,</span>&nbsp;<span class="ident" id="5323469">src</span>&nbsp;<span class="op" id="5323473">+</span>&nbsp;<span class="ident" id="5323475">j</span>&nbsp;<span class="op" id="5323477">+</span>&nbsp;<span class="num" id="5323479">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323495">dst1</span><span class="op" id="5323499">,</span>&nbsp;<span class="ident" id="5323501">src1</span>&nbsp;<span class="op" id="5323506">=</span>&nbsp;<span class="ident" id="5323508">dst</span><span class="op" id="5323511">+</span><span class="ident" id="5323512">i</span><span class="op" id="5323513">,</span>&nbsp;<span class="ident" id="5323515">src</span><span class="op" id="5323518">+</span><span class="ident" id="5323519">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5323522">copy</span><span class="op" id="5323526">(</span><span class="ident" id="5323527">b</span><span class="op" id="5323528">[</span><span class="ident" id="5323529">dst</span><span class="op" id="5323532">:</span><span class="ident" id="5323533">dst1</span><span class="op" id="5323537">]</span><span class="op" id="5323538">,</span>&nbsp;<span class="ident" id="5323540">b</span><span class="op" id="5323541">[</span><span class="ident" id="5323542">src</span><span class="op" id="5323545">:</span><span class="ident" id="5323546">src1</span><span class="op" id="5323550">]</span><span class="op" id="5323551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323554">return</span>&nbsp;<span class="ident" id="5323561">dst1</span><span class="op" id="5323565">,</span>&nbsp;<span class="ident" id="5323567">src1</span><br>
<span class="lineno"></span><span class="op" id="5323572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="5323575">//&nbsp;unescape&nbsp;unescapes&nbsp;b&#39;s&nbsp;entities&nbsp;in-place,&nbsp;so&nbsp;that&nbsp;&#34;a&amp;lt;b&#34;&nbsp;becomes&nbsp;&#34;a&lt;b&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5323652">func</span>&nbsp;<span class="ident" id="5323657">unescape</span><span class="op" id="5323665">(</span><span class="ident" id="5323666">b</span>&nbsp;<span class="op" id="5323668">[</span><span class="op" id="5323669">]</span><span class="builtintype" id="5323670">byte</span><span class="op" id="5323674">)</span>&nbsp;<span class="op" id="5323676">[</span><span class="op" id="5323677">]</span><span class="builtintype" id="5323678">byte</span>&nbsp;<span class="op" id="5323683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323686">for</span>&nbsp;<span class="ident" id="5323690">i</span><span class="op" id="5323691">,</span>&nbsp;<span class="ident" id="5323693">c</span>&nbsp;<span class="op" id="5323695">:=</span>&nbsp;<span class="keyword" id="5323698">range</span>&nbsp;<span class="ident" id="5323704">b</span>&nbsp;<span class="op" id="5323706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323710">if</span>&nbsp;<span class="ident" id="5323713">c</span>&nbsp;<span class="op" id="5323715">==</span>&nbsp;<span class="string" id="5323718">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5323722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323727">dst</span><span class="op" id="5323730">,</span>&nbsp;<span class="ident" id="5323732">src</span>&nbsp;<span class="op" id="5323736">:=</span>&nbsp;<span class="ident" id="5323739">unescapeEntity</span><span class="op" id="5323753">(</span><span class="ident" id="5323754">b</span><span class="op" id="5323755">,</span>&nbsp;<span class="ident" id="5323757">i</span><span class="op" id="5323758">,</span>&nbsp;<span class="ident" id="5323760">i</span><span class="op" id="5323761">,</span>&nbsp;<span class="builtintype" id="5323763">false</span><span class="op" id="5323768">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323773">for</span>&nbsp;<span class="ident" id="5323777">src</span>&nbsp;<span class="op" id="5323781">&lt;</span>&nbsp;<span class="builtinfunc" id="5323783">len</span><span class="op" id="5323786">(</span><span class="ident" id="5323787">b</span><span class="op" id="5323788">)</span>&nbsp;<span class="op" id="5323790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323796">c</span>&nbsp;<span class="op" id="5323798">:=</span>&nbsp;<span class="ident" id="5323801">b</span><span class="op" id="5323802">[</span><span class="ident" id="5323803">src</span><span class="op" id="5323806">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323812">if</span>&nbsp;<span class="ident" id="5323815">c</span>&nbsp;<span class="op" id="5323817">==</span>&nbsp;<span class="string" id="5323820">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5323824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323831">dst</span><span class="op" id="5323834">,</span>&nbsp;<span class="ident" id="5323836">src</span>&nbsp;<span class="op" id="5323840">=</span>&nbsp;<span class="ident" id="5323842">unescapeEntity</span><span class="op" id="5323856">(</span><span class="ident" id="5323857">b</span><span class="op" id="5323858">,</span>&nbsp;<span class="ident" id="5323860">dst</span><span class="op" id="5323863">,</span>&nbsp;<span class="ident" id="5323865">src</span><span class="op" id="5323868">,</span>&nbsp;<span class="builtintype" id="5323870">false</span><span class="op" id="5323875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323881">}</span>&nbsp;<span class="keyword" id="5323883">else</span>&nbsp;<span class="op" id="5323888">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323895">b</span><span class="op" id="5323896">[</span><span class="ident" id="5323897">dst</span><span class="op" id="5323900">]</span>&nbsp;<span class="op" id="5323902">=</span>&nbsp;<span class="ident" id="5323904">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323911">dst</span><span class="op" id="5323914">,</span>&nbsp;<span class="ident" id="5323916">src</span>&nbsp;<span class="op" id="5323920">=</span>&nbsp;<span class="ident" id="5323922">dst</span><span class="op" id="5323925">+</span><span class="num" id="5323926">1</span><span class="op" id="5323927">,</span>&nbsp;<span class="ident" id="5323929">src</span><span class="op" id="5323932">+</span><span class="num" id="5323933">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323949">return</span>&nbsp;<span class="ident" id="5323956">b</span><span class="op" id="5323957">[</span><span class="num" id="5323958">0</span><span class="op" id="5323959">:</span><span class="ident" id="5323960">dst</span><span class="op" id="5323963">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323973">return</span>&nbsp;<span class="ident" id="5323980">b</span><br>
<span class="lineno"></span><span class="op" id="5323982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5323985">const</span>&nbsp;<span class="ident" id="5323991">escapedChars</span>&nbsp;<span class="op" id="5324004">=</span>&nbsp;<span class="string" id="5324006">`&amp;&#39;&lt;&gt;&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5324015">func</span>&nbsp;<span class="ident" id="5324020">escape</span><span class="op" id="5324026">(</span><span class="ident" id="5324027">w</span>&nbsp;<span class="ident" id="5324029">writer</span><span class="op" id="5324035">,</span>&nbsp;<span class="ident" id="5324037">s</span>&nbsp;<span class="builtintype" id="5324039">string</span><span class="op" id="5324045">)</span>&nbsp;<span class="builtintype" id="5324047">error</span>&nbsp;<span class="op" id="5324053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5324056">i</span>&nbsp;<span class="op" id="5324058">:=</span>&nbsp;<span class="ident" id="5324061">strings</span><span class="op" id="5324068">.</span><span class="ident" id="5324069">IndexAny</span><span class="op" id="5324077">(</span><span class="ident" id="5324078">s</span><span class="op" id="5324079">,</span>&nbsp;<span class="ident" id="5324081">escapedChars</span><span class="op" id="5324093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324096">for</span>&nbsp;<span class="ident" id="5324100">i</span>&nbsp;<span class="op" id="5324102">!=</span>&nbsp;<span class="op" id="5324105">-</span><span class="num" id="5324106">1</span>&nbsp;<span class="op" id="5324108">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324112">if</span>&nbsp;<span class="ident" id="5324115">_</span><span class="op" id="5324116">,</span>&nbsp;<span class="ident" id="5324118">err</span>&nbsp;<span class="op" id="5324122">:=</span>&nbsp;<span class="ident" id="5324125">w</span><span class="op" id="5324126">.</span><span class="ident" id="5324127">WriteString</span><span class="op" id="5324138">(</span><span class="ident" id="5324139">s</span><span class="op" id="5324140">[</span><span class="op" id="5324141">:</span><span class="ident" id="5324142">i</span><span class="op" id="5324143">]</span><span class="op" id="5324144">)</span><span class="op" id="5324145">;</span>&nbsp;<span class="ident" id="5324147">err</span>&nbsp;<span class="op" id="5324151">!=</span>&nbsp;<span class="builtintype" id="5324154">nil</span>&nbsp;<span class="op" id="5324158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324163">return</span>&nbsp;<span class="ident" id="5324170">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5324176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324180">var</span>&nbsp;<span class="ident" id="5324184">esc</span>&nbsp;<span class="builtintype" id="5324188">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324197">switch</span>&nbsp;<span class="ident" id="5324204">s</span><span class="op" id="5324205">[</span><span class="ident" id="5324206">i</span><span class="op" id="5324207">]</span>&nbsp;<span class="op" id="5324209">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324213">case</span>&nbsp;<span class="string" id="5324218">&#39;&amp;&#39;</span><span class="op" id="5324221">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5324226">esc</span>&nbsp;<span class="op" id="5324230">=</span>&nbsp;<span class="string" id="5324232">&#34;&amp;amp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324242">case</span>&nbsp;<span class="string" id="5324247">&#39;\&#39;&#39;</span><span class="op" id="5324251">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5324256">//&nbsp;&#34;&amp;#39;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;apos;&#34;&nbsp;and&nbsp;apos&nbsp;was&nbsp;not&nbsp;in&nbsp;HTML&nbsp;until&nbsp;HTML5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5324333">esc</span>&nbsp;<span class="op" id="5324337">=</span>&nbsp;<span class="string" id="5324339">&#34;&amp;#39;&#34;</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324349">case</span>&nbsp;<span class="string" id="5324354">&#39;&lt;&#39;</span><span class="op" id="5324357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5324362">esc</span>&nbsp;<span class="op" id="5324366">=</span>&nbsp;<span class="string" id="5324368">&#34;&amp;lt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324377">case</span>&nbsp;<span class="string" id="5324382">&#39;&gt;&#39;</span><span class="op" id="5324385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5324390">esc</span>&nbsp;<span class="op" id="5324394">=</span>&nbsp;<span class="string" id="5324396">&#34;&amp;gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324405">case</span>&nbsp;<span class="string" id="5324410">&#39;&#34;&#39;</span><span class="op" id="5324413">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5324418">//&nbsp;&#34;&amp;#34;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;quot;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5324458">esc</span>&nbsp;<span class="op" id="5324462">=</span>&nbsp;<span class="string" id="5324464">&#34;&amp;#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324474">default</span><span class="op" id="5324481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5324486">panic</span><span class="op" id="5324491">(</span><span class="string" id="5324492">&#34;unrecognized&nbsp;escape&nbsp;character&#34;</span><span class="op" id="5324523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5324527">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5324531">s</span>&nbsp;<span class="op" id="5324533">=</span>&nbsp;<span class="ident" id="5324535">s</span><span class="op" id="5324536">[</span><span class="ident" id="5324537">i</span><span class="op" id="5324538">+</span><span class="num" id="5324539">1</span><span class="op" id="5324540">:</span><span class="op" id="5324541">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324545">if</span>&nbsp;<span class="ident" id="5324548">_</span><span class="op" id="5324549">,</span>&nbsp;<span class="ident" id="5324551">err</span>&nbsp;<span class="op" id="5324555">:=</span>&nbsp;<span class="ident" id="5324558">w</span><span class="op" id="5324559">.</span><span class="ident" id="5324560">WriteString</span><span class="op" id="5324571">(</span><span class="ident" id="5324572">esc</span><span class="op" id="5324575">)</span><span class="op" id="5324576">;</span>&nbsp;<span class="ident" id="5324578">err</span>&nbsp;<span class="op" id="5324582">!=</span>&nbsp;<span class="builtintype" id="5324585">nil</span>&nbsp;<span class="op" id="5324589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324594">return</span>&nbsp;<span class="ident" id="5324601">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5324607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5324611">i</span>&nbsp;<span class="op" id="5324613">=</span>&nbsp;<span class="ident" id="5324615">strings</span><span class="op" id="5324622">.</span><span class="ident" id="5324623">IndexAny</span><span class="op" id="5324631">(</span><span class="ident" id="5324632">s</span><span class="op" id="5324633">,</span>&nbsp;<span class="ident" id="5324635">escapedChars</span><span class="op" id="5324647">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5324650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5324653">_</span><span class="op" id="5324654">,</span>&nbsp;<span class="ident" id="5324656">err</span>&nbsp;<span class="op" id="5324660">:=</span>&nbsp;<span class="ident" id="5324663">w</span><span class="op" id="5324664">.</span><span class="ident" id="5324665">WriteString</span><span class="op" id="5324676">(</span><span class="ident" id="5324677">s</span><span class="op" id="5324678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324681">return</span>&nbsp;<span class="ident" id="5324688">err</span><br>
<span class="lineno"></span><span class="op" id="5324692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="comment" id="5324695">//&nbsp;EscapeString&nbsp;escapes&nbsp;special&nbsp;characters&nbsp;like&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&amp;lt;&#34;.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="5324768">//&nbsp;escapes&nbsp;only&nbsp;five&nbsp;such&nbsp;characters:&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;&#39;&nbsp;and&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5324824">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5324901">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5324917">func</span>&nbsp;<span class="ident" id="5324922">EscapeString</span><span class="op" id="5324934">(</span><span class="ident" id="5324935">s</span>&nbsp;<span class="builtintype" id="5324937">string</span><span class="op" id="5324943">)</span>&nbsp;<span class="builtintype" id="5324945">string</span>&nbsp;<span class="op" id="5324952">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324955">if</span>&nbsp;<span class="ident" id="5324958">strings</span><span class="op" id="5324965">.</span><span class="ident" id="5324966">IndexAny</span><span class="op" id="5324974">(</span><span class="ident" id="5324975">s</span><span class="op" id="5324976">,</span>&nbsp;<span class="ident" id="5324978">escapedChars</span><span class="op" id="5324990">)</span>&nbsp;<span class="op" id="5324992">==</span>&nbsp;<span class="op" id="5324995">-</span><span class="num" id="5324996">1</span>&nbsp;<span class="op" id="5324998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325002">return</span>&nbsp;<span class="ident" id="5325009">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5325012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325015">var</span>&nbsp;<span class="ident" id="5325019">buf</span>&nbsp;<span class="ident" id="5325023">bytes</span><span class="op" id="5325028">.</span><span class="ident" id="5325029">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5325037">escape</span><span class="op" id="5325043">(</span><span class="op" id="5325044">&amp;</span><span class="ident" id="5325045">buf</span><span class="op" id="5325048">,</span>&nbsp;<span class="ident" id="5325050">s</span><span class="op" id="5325051">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325054">return</span>&nbsp;<span class="ident" id="5325061">buf</span><span class="op" id="5325064">.</span><span class="ident" id="5325065">String</span><span class="op" id="5325071">(</span><span class="op" id="5325072">)</span><br>
<span class="lineno"></span><span class="op" id="5325074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5325077">//&nbsp;UnescapeString&nbsp;unescapes&nbsp;entities&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&lt;&#34;.&nbsp;It&nbsp;unescapes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5325156">//&nbsp;larger&nbsp;range&nbsp;of&nbsp;entities&nbsp;than&nbsp;EscapeString&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;&#34;&amp;aacute;&#34;</span><br>
<span class="lineno">240</span><span class="comment" id="5325235">//&nbsp;unescapes&nbsp;to&nbsp;&#34;&#34;,&nbsp;as&nbsp;does&nbsp;&#34;&amp;#225;&#34;&nbsp;and&nbsp;&#34;&amp;xE1;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5325287">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5325364">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5325380">func</span>&nbsp;<span class="ident" id="5325385">UnescapeString</span><span class="op" id="5325399">(</span><span class="ident" id="5325400">s</span>&nbsp;<span class="builtintype" id="5325402">string</span><span class="op" id="5325408">)</span>&nbsp;<span class="builtintype" id="5325410">string</span>&nbsp;<span class="op" id="5325417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325420">for</span>&nbsp;<span class="ident" id="5325424">_</span><span class="op" id="5325425">,</span>&nbsp;<span class="ident" id="5325427">c</span>&nbsp;<span class="op" id="5325429">:=</span>&nbsp;<span class="keyword" id="5325432">range</span>&nbsp;<span class="ident" id="5325438">s</span>&nbsp;<span class="op" id="5325440">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325444">if</span>&nbsp;<span class="ident" id="5325447">c</span>&nbsp;<span class="op" id="5325449">==</span>&nbsp;<span class="string" id="5325452">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5325456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325461">return</span>&nbsp;<span class="builtintype" id="5325468">string</span><span class="op" id="5325474">(</span><span class="ident" id="5325475">unescape</span><span class="op" id="5325483">(</span><span class="op" id="5325484">[</span><span class="op" id="5325485">]</span><span class="builtintype" id="5325486">byte</span><span class="op" id="5325490">(</span><span class="ident" id="5325491">s</span><span class="op" id="5325492">)</span><span class="op" id="5325493">)</span><span class="op" id="5325494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5325498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5325501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325504">return</span>&nbsp;<span class="ident" id="5325511">s</span><br>
<span class="lineno">250</span><span class="op" id="5325513">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
