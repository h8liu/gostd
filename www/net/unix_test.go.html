<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7589170">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7589226">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7589280">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7589331">//&nbsp;+build&nbsp;!nacl,!plan9,!windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7589364">package</span>&nbsp;<span class="ident" id="7589372">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7589377">import</span>&nbsp;<span class="op" id="7589384">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7589387">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7589396">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7589402">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7589413">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7589424">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7589435">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7589446">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7589453">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7589456">func</span>&nbsp;<span class="ident" id="7589461">TestReadUnixgramWithUnnamedSocket</span><span class="op" id="7589494">(</span><span class="ident" id="7589495">t</span>&nbsp;<span class="op" id="7589497">*</span><span class="ident" id="7589498">testing</span><span class="op" id="7589505">.</span><span class="ident" id="7589506">T</span><span class="op" id="7589507">)</span>&nbsp;<span class="op" id="7589509">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589512">addr</span>&nbsp;<span class="op" id="7589517">:=</span>&nbsp;<span class="ident" id="7589520">testUnixAddr</span><span class="op" id="7589532">(</span><span class="op" id="7589533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589536">la</span><span class="op" id="7589538">,</span>&nbsp;<span class="ident" id="7589540">err</span>&nbsp;<span class="op" id="7589544">:=</span>&nbsp;<span class="ident" id="7589547">ResolveUnixAddr</span><span class="op" id="7589562">(</span><span class="string" id="7589563">&#34;unixgram&#34;</span><span class="op" id="7589573">,</span>&nbsp;<span class="ident" id="7589575">addr</span><span class="op" id="7589579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7589582">if</span>&nbsp;<span class="ident" id="7589585">err</span>&nbsp;<span class="op" id="7589589">!=</span>&nbsp;<span class="ident" id="7589592">nil</span>&nbsp;<span class="op" id="7589596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589600">t</span><span class="op" id="7589601">.</span><span class="ident" id="7589602">Fatalf</span><span class="op" id="7589608">(</span><span class="string" id="7589609">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7589637">,</span>&nbsp;<span class="ident" id="7589639">err</span><span class="op" id="7589642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7589645">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589648">c</span><span class="op" id="7589649">,</span>&nbsp;<span class="ident" id="7589651">err</span>&nbsp;<span class="op" id="7589655">:=</span>&nbsp;<span class="ident" id="7589658">ListenUnixgram</span><span class="op" id="7589672">(</span><span class="string" id="7589673">&#34;unixgram&#34;</span><span class="op" id="7589683">,</span>&nbsp;<span class="ident" id="7589685">la</span><span class="op" id="7589687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7589690">if</span>&nbsp;<span class="ident" id="7589693">err</span>&nbsp;<span class="op" id="7589697">!=</span>&nbsp;<span class="ident" id="7589700">nil</span>&nbsp;<span class="op" id="7589704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589708">t</span><span class="op" id="7589709">.</span><span class="ident" id="7589710">Fatalf</span><span class="op" id="7589716">(</span><span class="string" id="7589717">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7589744">,</span>&nbsp;<span class="ident" id="7589746">err</span><span class="op" id="7589749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7589752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7589755">defer</span>&nbsp;<span class="keyword" id="7589761">func</span><span class="op" id="7589765">(</span><span class="op" id="7589766">)</span>&nbsp;<span class="op" id="7589768">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589772">c</span><span class="op" id="7589773">.</span><span class="ident" id="7589774">Close</span><span class="op" id="7589779">(</span><span class="op" id="7589780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589784">os</span><span class="op" id="7589786">.</span><span class="ident" id="7589787">Remove</span><span class="op" id="7589793">(</span><span class="ident" id="7589794">addr</span><span class="op" id="7589798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7589801">}</span><span class="op" id="7589802">(</span><span class="op" id="7589803">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589807">off</span>&nbsp;<span class="op" id="7589811">:=</span>&nbsp;<span class="builtinfunc" id="7589814">make</span><span class="op" id="7589818">(</span><span class="keyword" id="7589819">chan</span>&nbsp;<span class="builtintype" id="7589824">bool</span><span class="op" id="7589828">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589831">data</span>&nbsp;<span class="op" id="7589836">:=</span>&nbsp;<span class="op" id="7589839">[</span><span class="num" id="7589840">5</span><span class="op" id="7589841">]</span><span class="builtintype" id="7589842">byte</span><span class="op" id="7589846">{</span><span class="num" id="7589847">1</span><span class="op" id="7589848">,</span>&nbsp;<span class="num" id="7589850">2</span><span class="op" id="7589851">,</span>&nbsp;<span class="num" id="7589853">3</span><span class="op" id="7589854">,</span>&nbsp;<span class="num" id="7589856">4</span><span class="op" id="7589857">,</span>&nbsp;<span class="num" id="7589859">5</span><span class="op" id="7589860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7589863">go</span>&nbsp;<span class="keyword" id="7589866">func</span><span class="op" id="7589870">(</span><span class="op" id="7589871">)</span>&nbsp;<span class="op" id="7589873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7589877">defer</span>&nbsp;<span class="keyword" id="7589883">func</span><span class="op" id="7589887">(</span><span class="op" id="7589888">)</span>&nbsp;<span class="op" id="7589890">{</span>&nbsp;<span class="ident" id="7589892">off</span>&nbsp;<span class="op" id="7589896">&lt;-</span>&nbsp;<span class="ident" id="7589899">true</span>&nbsp;<span class="op" id="7589904">}</span><span class="op" id="7589905">(</span><span class="op" id="7589906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589910">s</span><span class="op" id="7589911">,</span>&nbsp;<span class="ident" id="7589913">err</span>&nbsp;<span class="op" id="7589917">:=</span>&nbsp;<span class="ident" id="7589920">syscall</span><span class="op" id="7589927">.</span><span class="ident" id="7589928">Socket</span><span class="op" id="7589934">(</span><span class="ident" id="7589935">syscall</span><span class="op" id="7589942">.</span><span class="ident" id="7589943">AF_UNIX</span><span class="op" id="7589950">,</span>&nbsp;<span class="ident" id="7589952">syscall</span><span class="op" id="7589959">.</span><span class="ident" id="7589960">SOCK_DGRAM</span><span class="op" id="7589970">,</span>&nbsp;<span class="num" id="7589972">0</span><span class="op" id="7589973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7589977">if</span>&nbsp;<span class="ident" id="7589980">err</span>&nbsp;<span class="op" id="7589984">!=</span>&nbsp;<span class="ident" id="7589987">nil</span>&nbsp;<span class="op" id="7589991">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7589996">t</span><span class="op" id="7589997">.</span><span class="ident" id="7589998">Errorf</span><span class="op" id="7590004">(</span><span class="string" id="7590005">&#34;syscall.Socket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7590032">,</span>&nbsp;<span class="ident" id="7590034">err</span><span class="op" id="7590037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7590042">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7590051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7590055">defer</span>&nbsp;<span class="ident" id="7590061">syscall</span><span class="op" id="7590068">.</span><span class="ident" id="7590069">Close</span><span class="op" id="7590074">(</span><span class="ident" id="7590075">s</span><span class="op" id="7590076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7590080">rsa</span>&nbsp;<span class="op" id="7590084">:=</span>&nbsp;<span class="op" id="7590087">&amp;</span><span class="ident" id="7590088">syscall</span><span class="op" id="7590095">.</span><span class="ident" id="7590096">SockaddrUnix</span><span class="op" id="7590108">{</span><span class="ident" id="7590109">Name</span><span class="op" id="7590113">:</span>&nbsp;<span class="ident" id="7590115">addr</span><span class="op" id="7590119">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7590123">if</span>&nbsp;<span class="ident" id="7590126">err</span>&nbsp;<span class="op" id="7590130">:=</span>&nbsp;<span class="ident" id="7590133">syscall</span><span class="op" id="7590140">.</span><span class="ident" id="7590141">Sendto</span><span class="op" id="7590147">(</span><span class="ident" id="7590148">s</span><span class="op" id="7590149">,</span>&nbsp;<span class="ident" id="7590151">data</span><span class="op" id="7590155">[</span><span class="op" id="7590156">:</span><span class="op" id="7590157">]</span><span class="op" id="7590158">,</span>&nbsp;<span class="num" id="7590160">0</span><span class="op" id="7590161">,</span>&nbsp;<span class="ident" id="7590163">rsa</span><span class="op" id="7590166">)</span><span class="op" id="7590167">;</span>&nbsp;<span class="ident" id="7590169">err</span>&nbsp;<span class="op" id="7590173">!=</span>&nbsp;<span class="ident" id="7590176">nil</span>&nbsp;<span class="op" id="7590180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7590185">t</span><span class="op" id="7590186">.</span><span class="ident" id="7590187">Errorf</span><span class="op" id="7590193">(</span><span class="string" id="7590194">&#34;syscall.Sendto&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7590221">,</span>&nbsp;<span class="ident" id="7590223">err</span><span class="op" id="7590226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7590231">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7590240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7590243">}</span><span class="op" id="7590244">(</span><span class="op" id="7590245">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7590249">&lt;-</span><span class="ident" id="7590251">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7590256">b</span>&nbsp;<span class="op" id="7590258">:=</span>&nbsp;<span class="builtinfunc" id="7590261">make</span><span class="op" id="7590265">(</span><span class="op" id="7590266">[</span><span class="op" id="7590267">]</span><span class="builtintype" id="7590268">byte</span><span class="op" id="7590272">,</span>&nbsp;<span class="num" id="7590274">64</span><span class="op" id="7590276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7590279">c</span><span class="op" id="7590280">.</span><span class="ident" id="7590281">SetReadDeadline</span><span class="op" id="7590296">(</span><span class="ident" id="7590297">time</span><span class="op" id="7590301">.</span><span class="ident" id="7590302">Now</span><span class="op" id="7590305">(</span><span class="op" id="7590306">)</span><span class="op" id="7590307">.</span><span class="ident" id="7590308">Add</span><span class="op" id="7590311">(</span><span class="num" id="7590312">100</span>&nbsp;<span class="op" id="7590316">*</span>&nbsp;<span class="ident" id="7590318">time</span><span class="op" id="7590322">.</span><span class="ident" id="7590323">Millisecond</span><span class="op" id="7590334">)</span><span class="op" id="7590335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7590338">n</span><span class="op" id="7590339">,</span>&nbsp;<span class="ident" id="7590341">from</span><span class="op" id="7590345">,</span>&nbsp;<span class="ident" id="7590347">err</span>&nbsp;<span class="op" id="7590351">:=</span>&nbsp;<span class="ident" id="7590354">c</span><span class="op" id="7590355">.</span><span class="ident" id="7590356">ReadFrom</span><span class="op" id="7590364">(</span><span class="ident" id="7590365">b</span><span class="op" id="7590366">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7590369">if</span>&nbsp;<span class="ident" id="7590372">err</span>&nbsp;<span class="op" id="7590376">!=</span>&nbsp;<span class="ident" id="7590379">nil</span>&nbsp;<span class="op" id="7590383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7590387">t</span><span class="op" id="7590388">.</span><span class="ident" id="7590389">Fatalf</span><span class="op" id="7590395">(</span><span class="string" id="7590396">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7590426">,</span>&nbsp;<span class="ident" id="7590428">err</span><span class="op" id="7590431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7590434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7590437">if</span>&nbsp;<span class="ident" id="7590440">from</span>&nbsp;<span class="op" id="7590445">!=</span>&nbsp;<span class="ident" id="7590448">nil</span>&nbsp;<span class="op" id="7590452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7590456">t</span><span class="op" id="7590457">.</span><span class="ident" id="7590458">Fatalf</span><span class="op" id="7590464">(</span><span class="string" id="7590465">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="7590489">,</span>&nbsp;<span class="ident" id="7590491">from</span><span class="op" id="7590495">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7590498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7590501">if</span>&nbsp;<span class="op" id="7590504">!</span><span class="ident" id="7590505">bytes</span><span class="op" id="7590510">.</span><span class="ident" id="7590511">Equal</span><span class="op" id="7590516">(</span><span class="ident" id="7590517">b</span><span class="op" id="7590518">[</span><span class="op" id="7590519">:</span><span class="ident" id="7590520">n</span><span class="op" id="7590521">]</span><span class="op" id="7590522">,</span>&nbsp;<span class="ident" id="7590524">data</span><span class="op" id="7590528">[</span><span class="op" id="7590529">:</span><span class="op" id="7590530">]</span><span class="op" id="7590531">)</span>&nbsp;<span class="op" id="7590533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7590537">t</span><span class="op" id="7590538">.</span><span class="ident" id="7590539">Fatalf</span><span class="op" id="7590545">(</span><span class="string" id="7590546">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7590563">,</span>&nbsp;<span class="ident" id="7590565">b</span><span class="op" id="7590566">[</span><span class="op" id="7590567">:</span><span class="ident" id="7590568">n</span><span class="op" id="7590569">]</span><span class="op" id="7590570">,</span>&nbsp;<span class="ident" id="7590572">data</span><span class="op" id="7590576">[</span><span class="op" id="7590577">:</span><span class="op" id="7590578">]</span><span class="op" id="7590579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7590582">}</span><br>
<span class="lineno"></span><span class="op" id="7590584">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7590587">func</span>&nbsp;<span class="ident" id="7590592">TestReadUnixgramWithZeroBytesBuffer</span><span class="op" id="7590627">(</span><span class="ident" id="7590628">t</span>&nbsp;<span class="op" id="7590630">*</span><span class="ident" id="7590631">testing</span><span class="op" id="7590638">.</span><span class="ident" id="7590639">T</span><span class="op" id="7590640">)</span>&nbsp;<span class="op" id="7590642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7590645">//&nbsp;issue&nbsp;4352:&nbsp;Recvfrom&nbsp;failed&nbsp;with&nbsp;&#34;address&nbsp;family&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7590702">//&nbsp;supported&nbsp;by&nbsp;protocol&nbsp;family&#34;&nbsp;if&nbsp;zero-length&nbsp;buffer&nbsp;provided</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7590768">addr</span>&nbsp;<span class="op" id="7590773">:=</span>&nbsp;<span class="ident" id="7590776">testUnixAddr</span><span class="op" id="7590788">(</span><span class="op" id="7590789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7590792">la</span><span class="op" id="7590794">,</span>&nbsp;<span class="ident" id="7590796">err</span>&nbsp;<span class="op" id="7590800">:=</span>&nbsp;<span class="ident" id="7590803">ResolveUnixAddr</span><span class="op" id="7590818">(</span><span class="string" id="7590819">&#34;unixgram&#34;</span><span class="op" id="7590829">,</span>&nbsp;<span class="ident" id="7590831">addr</span><span class="op" id="7590835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7590838">if</span>&nbsp;<span class="ident" id="7590841">err</span>&nbsp;<span class="op" id="7590845">!=</span>&nbsp;<span class="ident" id="7590848">nil</span>&nbsp;<span class="op" id="7590852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7590856">t</span><span class="op" id="7590857">.</span><span class="ident" id="7590858">Fatalf</span><span class="op" id="7590864">(</span><span class="string" id="7590865">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7590893">,</span>&nbsp;<span class="ident" id="7590895">err</span><span class="op" id="7590898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7590901">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7590904">c</span><span class="op" id="7590905">,</span>&nbsp;<span class="ident" id="7590907">err</span>&nbsp;<span class="op" id="7590911">:=</span>&nbsp;<span class="ident" id="7590914">ListenUnixgram</span><span class="op" id="7590928">(</span><span class="string" id="7590929">&#34;unixgram&#34;</span><span class="op" id="7590939">,</span>&nbsp;<span class="ident" id="7590941">la</span><span class="op" id="7590943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7590946">if</span>&nbsp;<span class="ident" id="7590949">err</span>&nbsp;<span class="op" id="7590953">!=</span>&nbsp;<span class="ident" id="7590956">nil</span>&nbsp;<span class="op" id="7590960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7590964">t</span><span class="op" id="7590965">.</span><span class="ident" id="7590966">Fatalf</span><span class="op" id="7590972">(</span><span class="string" id="7590973">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7591000">,</span>&nbsp;<span class="ident" id="7591002">err</span><span class="op" id="7591005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7591008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591011">defer</span>&nbsp;<span class="keyword" id="7591017">func</span><span class="op" id="7591021">(</span><span class="op" id="7591022">)</span>&nbsp;<span class="op" id="7591024">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591028">c</span><span class="op" id="7591029">.</span><span class="ident" id="7591030">Close</span><span class="op" id="7591035">(</span><span class="op" id="7591036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591040">os</span><span class="op" id="7591042">.</span><span class="ident" id="7591043">Remove</span><span class="op" id="7591049">(</span><span class="ident" id="7591050">addr</span><span class="op" id="7591054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7591057">}</span><span class="op" id="7591058">(</span><span class="op" id="7591059">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591063">off</span>&nbsp;<span class="op" id="7591067">:=</span>&nbsp;<span class="builtinfunc" id="7591070">make</span><span class="op" id="7591074">(</span><span class="keyword" id="7591075">chan</span>&nbsp;<span class="builtintype" id="7591080">bool</span><span class="op" id="7591084">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591087">go</span>&nbsp;<span class="keyword" id="7591090">func</span><span class="op" id="7591094">(</span><span class="op" id="7591095">)</span>&nbsp;<span class="op" id="7591097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591101">defer</span>&nbsp;<span class="keyword" id="7591107">func</span><span class="op" id="7591111">(</span><span class="op" id="7591112">)</span>&nbsp;<span class="op" id="7591114">{</span>&nbsp;<span class="ident" id="7591116">off</span>&nbsp;<span class="op" id="7591120">&lt;-</span>&nbsp;<span class="ident" id="7591123">true</span>&nbsp;<span class="op" id="7591128">}</span><span class="op" id="7591129">(</span><span class="op" id="7591130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591134">c</span><span class="op" id="7591135">,</span>&nbsp;<span class="ident" id="7591137">err</span>&nbsp;<span class="op" id="7591141">:=</span>&nbsp;<span class="ident" id="7591144">DialUnix</span><span class="op" id="7591152">(</span><span class="string" id="7591153">&#34;unixgram&#34;</span><span class="op" id="7591163">,</span>&nbsp;<span class="ident" id="7591165">nil</span><span class="op" id="7591168">,</span>&nbsp;<span class="ident" id="7591170">la</span><span class="op" id="7591172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591176">if</span>&nbsp;<span class="ident" id="7591179">err</span>&nbsp;<span class="op" id="7591183">!=</span>&nbsp;<span class="ident" id="7591186">nil</span>&nbsp;<span class="op" id="7591190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591195">t</span><span class="op" id="7591196">.</span><span class="ident" id="7591197">Errorf</span><span class="op" id="7591203">(</span><span class="string" id="7591204">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7591225">,</span>&nbsp;<span class="ident" id="7591227">err</span><span class="op" id="7591230">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591235">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7591244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591248">defer</span>&nbsp;<span class="ident" id="7591254">c</span><span class="op" id="7591255">.</span><span class="ident" id="7591256">Close</span><span class="op" id="7591261">(</span><span class="op" id="7591262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591266">if</span>&nbsp;<span class="ident" id="7591269">_</span><span class="op" id="7591270">,</span>&nbsp;<span class="ident" id="7591272">err</span>&nbsp;<span class="op" id="7591276">:=</span>&nbsp;<span class="ident" id="7591279">c</span><span class="op" id="7591280">.</span><span class="ident" id="7591281">Write</span><span class="op" id="7591286">(</span><span class="op" id="7591287">[</span><span class="op" id="7591288">]</span><span class="builtintype" id="7591289">byte</span><span class="op" id="7591293">{</span><span class="num" id="7591294">1</span><span class="op" id="7591295">,</span>&nbsp;<span class="num" id="7591297">2</span><span class="op" id="7591298">,</span>&nbsp;<span class="num" id="7591300">3</span><span class="op" id="7591301">,</span>&nbsp;<span class="num" id="7591303">4</span><span class="op" id="7591304">,</span>&nbsp;<span class="num" id="7591306">5</span><span class="op" id="7591307">}</span><span class="op" id="7591308">)</span><span class="op" id="7591309">;</span>&nbsp;<span class="ident" id="7591311">err</span>&nbsp;<span class="op" id="7591315">!=</span>&nbsp;<span class="ident" id="7591318">nil</span>&nbsp;<span class="op" id="7591322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591327">t</span><span class="op" id="7591328">.</span><span class="ident" id="7591329">Errorf</span><span class="op" id="7591335">(</span><span class="string" id="7591336">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7591363">,</span>&nbsp;<span class="ident" id="7591365">err</span><span class="op" id="7591368">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591373">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7591382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7591385">}</span><span class="op" id="7591386">(</span><span class="op" id="7591387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7591391">&lt;-</span><span class="ident" id="7591393">off</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591398">c</span><span class="op" id="7591399">.</span><span class="ident" id="7591400">SetReadDeadline</span><span class="op" id="7591415">(</span><span class="ident" id="7591416">time</span><span class="op" id="7591420">.</span><span class="ident" id="7591421">Now</span><span class="op" id="7591424">(</span><span class="op" id="7591425">)</span><span class="op" id="7591426">.</span><span class="ident" id="7591427">Add</span><span class="op" id="7591430">(</span><span class="num" id="7591431">100</span>&nbsp;<span class="op" id="7591435">*</span>&nbsp;<span class="ident" id="7591437">time</span><span class="op" id="7591441">.</span><span class="ident" id="7591442">Millisecond</span><span class="op" id="7591453">)</span><span class="op" id="7591454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591457">_</span><span class="op" id="7591458">,</span>&nbsp;<span class="ident" id="7591460">from</span><span class="op" id="7591464">,</span>&nbsp;<span class="ident" id="7591466">err</span>&nbsp;<span class="op" id="7591470">:=</span>&nbsp;<span class="ident" id="7591473">c</span><span class="op" id="7591474">.</span><span class="ident" id="7591475">ReadFrom</span><span class="op" id="7591483">(</span><span class="ident" id="7591484">nil</span><span class="op" id="7591487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591490">if</span>&nbsp;<span class="ident" id="7591493">err</span>&nbsp;<span class="op" id="7591497">!=</span>&nbsp;<span class="ident" id="7591500">nil</span>&nbsp;<span class="op" id="7591504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591508">t</span><span class="op" id="7591509">.</span><span class="ident" id="7591510">Fatalf</span><span class="op" id="7591516">(</span><span class="string" id="7591517">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7591547">,</span>&nbsp;<span class="ident" id="7591549">err</span><span class="op" id="7591552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7591555">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591558">if</span>&nbsp;<span class="ident" id="7591561">from</span>&nbsp;<span class="op" id="7591566">!=</span>&nbsp;<span class="ident" id="7591569">nil</span>&nbsp;<span class="op" id="7591573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591577">t</span><span class="op" id="7591578">.</span><span class="ident" id="7591579">Fatalf</span><span class="op" id="7591585">(</span><span class="string" id="7591586">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="7591610">,</span>&nbsp;<span class="ident" id="7591612">from</span><span class="op" id="7591616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7591619">}</span><br>
<span class="lineno"></span><span class="op" id="7591621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7591624">func</span>&nbsp;<span class="ident" id="7591629">TestUnixgramAutobind</span><span class="op" id="7591649">(</span><span class="ident" id="7591650">t</span>&nbsp;<span class="op" id="7591652">*</span><span class="ident" id="7591653">testing</span><span class="op" id="7591660">.</span><span class="ident" id="7591661">T</span><span class="op" id="7591662">)</span>&nbsp;<span class="op" id="7591664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591667">if</span>&nbsp;<span class="ident" id="7591670">runtime</span><span class="op" id="7591677">.</span><span class="ident" id="7591678">GOOS</span>&nbsp;<span class="op" id="7591683">!=</span>&nbsp;<span class="string" id="7591686">&#34;linux&#34;</span>&nbsp;<span class="op" id="7591694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591698">t</span><span class="op" id="7591699">.</span><span class="ident" id="7591700">Skip</span><span class="op" id="7591704">(</span><span class="string" id="7591705">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="7591739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7591742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591746">laddr</span>&nbsp;<span class="op" id="7591752">:=</span>&nbsp;<span class="op" id="7591755">&amp;</span><span class="ident" id="7591756">UnixAddr</span><span class="op" id="7591764">{</span><span class="ident" id="7591765">Name</span><span class="op" id="7591769">:</span>&nbsp;<span class="string" id="7591771">&#34;&#34;</span><span class="op" id="7591773">,</span>&nbsp;<span class="ident" id="7591775">Net</span><span class="op" id="7591778">:</span>&nbsp;<span class="string" id="7591780">&#34;unixgram&#34;</span><span class="op" id="7591790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591793">c1</span><span class="op" id="7591795">,</span>&nbsp;<span class="ident" id="7591797">err</span>&nbsp;<span class="op" id="7591801">:=</span>&nbsp;<span class="ident" id="7591804">ListenUnixgram</span><span class="op" id="7591818">(</span><span class="string" id="7591819">&#34;unixgram&#34;</span><span class="op" id="7591829">,</span>&nbsp;<span class="ident" id="7591831">laddr</span><span class="op" id="7591836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591839">if</span>&nbsp;<span class="ident" id="7591842">err</span>&nbsp;<span class="op" id="7591846">!=</span>&nbsp;<span class="ident" id="7591849">nil</span>&nbsp;<span class="op" id="7591853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591857">t</span><span class="op" id="7591858">.</span><span class="ident" id="7591859">Fatalf</span><span class="op" id="7591865">(</span><span class="string" id="7591866">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7591893">,</span>&nbsp;<span class="ident" id="7591895">err</span><span class="op" id="7591898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7591901">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591904">defer</span>&nbsp;<span class="ident" id="7591910">c1</span><span class="op" id="7591912">.</span><span class="ident" id="7591913">Close</span><span class="op" id="7591918">(</span><span class="op" id="7591919">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7591923">//&nbsp;retrieve&nbsp;the&nbsp;autobind&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7591957">autoAddr</span>&nbsp;<span class="op" id="7591966">:=</span>&nbsp;<span class="ident" id="7591969">c1</span><span class="op" id="7591971">.</span><span class="ident" id="7591972">LocalAddr</span><span class="op" id="7591981">(</span><span class="op" id="7591982">)</span><span class="op" id="7591983">.</span><span class="op" id="7591984">(</span><span class="op" id="7591985">*</span><span class="ident" id="7591986">UnixAddr</span><span class="op" id="7591994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7591997">if</span>&nbsp;<span class="builtinfunc" id="7592000">len</span><span class="op" id="7592003">(</span><span class="ident" id="7592004">autoAddr</span><span class="op" id="7592012">.</span><span class="ident" id="7592013">Name</span><span class="op" id="7592017">)</span>&nbsp;<span class="op" id="7592019">&lt;=</span>&nbsp;<span class="num" id="7592022">1</span>&nbsp;<span class="op" id="7592024">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592028">t</span><span class="op" id="7592029">.</span><span class="ident" id="7592030">Fatalf</span><span class="op" id="7592036">(</span><span class="string" id="7592037">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="7592067">,</span>&nbsp;<span class="ident" id="7592069">autoAddr</span><span class="op" id="7592077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592083">if</span>&nbsp;<span class="ident" id="7592086">autoAddr</span><span class="op" id="7592094">.</span><span class="ident" id="7592095">Name</span><span class="op" id="7592099">[</span><span class="num" id="7592100">0</span><span class="op" id="7592101">]</span>&nbsp;<span class="op" id="7592103">!=</span>&nbsp;<span class="string" id="7592106">&#39;@&#39;</span>&nbsp;<span class="op" id="7592110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592114">t</span><span class="op" id="7592115">.</span><span class="ident" id="7592116">Fatalf</span><span class="op" id="7592122">(</span><span class="string" id="7592123">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="7592153">,</span>&nbsp;<span class="ident" id="7592155">autoAddr</span><span class="op" id="7592163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592166">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592170">c2</span><span class="op" id="7592172">,</span>&nbsp;<span class="ident" id="7592174">err</span>&nbsp;<span class="op" id="7592178">:=</span>&nbsp;<span class="ident" id="7592181">DialUnix</span><span class="op" id="7592189">(</span><span class="string" id="7592190">&#34;unixgram&#34;</span><span class="op" id="7592200">,</span>&nbsp;<span class="ident" id="7592202">nil</span><span class="op" id="7592205">,</span>&nbsp;<span class="ident" id="7592207">autoAddr</span><span class="op" id="7592215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592218">if</span>&nbsp;<span class="ident" id="7592221">err</span>&nbsp;<span class="op" id="7592225">!=</span>&nbsp;<span class="ident" id="7592228">nil</span>&nbsp;<span class="op" id="7592232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592236">t</span><span class="op" id="7592237">.</span><span class="ident" id="7592238">Fatalf</span><span class="op" id="7592244">(</span><span class="string" id="7592245">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7592266">,</span>&nbsp;<span class="ident" id="7592268">err</span><span class="op" id="7592271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592274">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592277">defer</span>&nbsp;<span class="ident" id="7592283">c2</span><span class="op" id="7592285">.</span><span class="ident" id="7592286">Close</span><span class="op" id="7592291">(</span><span class="op" id="7592292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592296">if</span>&nbsp;<span class="op" id="7592299">!</span><span class="ident" id="7592300">reflect</span><span class="op" id="7592307">.</span><span class="ident" id="7592308">DeepEqual</span><span class="op" id="7592317">(</span><span class="ident" id="7592318">c1</span><span class="op" id="7592320">.</span><span class="ident" id="7592321">LocalAddr</span><span class="op" id="7592330">(</span><span class="op" id="7592331">)</span><span class="op" id="7592332">,</span>&nbsp;<span class="ident" id="7592334">c2</span><span class="op" id="7592336">.</span><span class="ident" id="7592337">RemoteAddr</span><span class="op" id="7592347">(</span><span class="op" id="7592348">)</span><span class="op" id="7592349">)</span>&nbsp;<span class="op" id="7592351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592355">t</span><span class="op" id="7592356">.</span><span class="ident" id="7592357">Fatalf</span><span class="op" id="7592363">(</span><span class="string" id="7592364">&#34;expected&nbsp;autobind&nbsp;address&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7592402">,</span>&nbsp;<span class="ident" id="7592404">c1</span><span class="op" id="7592406">.</span><span class="ident" id="7592407">LocalAddr</span><span class="op" id="7592416">(</span><span class="op" id="7592417">)</span><span class="op" id="7592418">,</span>&nbsp;<span class="ident" id="7592420">c2</span><span class="op" id="7592422">.</span><span class="ident" id="7592423">RemoteAddr</span><span class="op" id="7592433">(</span><span class="op" id="7592434">)</span><span class="op" id="7592435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592438">}</span><br>
<span class="lineno">140</span><span class="op" id="7592440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7592443">func</span>&nbsp;<span class="ident" id="7592448">TestUnixAutobindClose</span><span class="op" id="7592469">(</span><span class="ident" id="7592470">t</span>&nbsp;<span class="op" id="7592472">*</span><span class="ident" id="7592473">testing</span><span class="op" id="7592480">.</span><span class="ident" id="7592481">T</span><span class="op" id="7592482">)</span>&nbsp;<span class="op" id="7592484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592487">if</span>&nbsp;<span class="ident" id="7592490">runtime</span><span class="op" id="7592497">.</span><span class="ident" id="7592498">GOOS</span>&nbsp;<span class="op" id="7592503">!=</span>&nbsp;<span class="string" id="7592506">&#34;linux&#34;</span>&nbsp;<span class="op" id="7592514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592518">t</span><span class="op" id="7592519">.</span><span class="ident" id="7592520">Skip</span><span class="op" id="7592524">(</span><span class="string" id="7592525">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="7592559">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592565">laddr</span>&nbsp;<span class="op" id="7592571">:=</span>&nbsp;<span class="op" id="7592574">&amp;</span><span class="ident" id="7592575">UnixAddr</span><span class="op" id="7592583">{</span><span class="ident" id="7592584">Name</span><span class="op" id="7592588">:</span>&nbsp;<span class="string" id="7592590">&#34;&#34;</span><span class="op" id="7592592">,</span>&nbsp;<span class="ident" id="7592594">Net</span><span class="op" id="7592597">:</span>&nbsp;<span class="string" id="7592599">&#34;unix&#34;</span><span class="op" id="7592605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592608">ln</span><span class="op" id="7592610">,</span>&nbsp;<span class="ident" id="7592612">err</span>&nbsp;<span class="op" id="7592616">:=</span>&nbsp;<span class="ident" id="7592619">ListenUnix</span><span class="op" id="7592629">(</span><span class="string" id="7592630">&#34;unix&#34;</span><span class="op" id="7592636">,</span>&nbsp;<span class="ident" id="7592638">laddr</span><span class="op" id="7592643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592646">if</span>&nbsp;<span class="ident" id="7592649">err</span>&nbsp;<span class="op" id="7592653">!=</span>&nbsp;<span class="ident" id="7592656">nil</span>&nbsp;<span class="op" id="7592660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592664">t</span><span class="op" id="7592665">.</span><span class="ident" id="7592666">Fatalf</span><span class="op" id="7592672">(</span><span class="string" id="7592673">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7592696">,</span>&nbsp;<span class="ident" id="7592698">err</span><span class="op" id="7592701">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592707">ln</span><span class="op" id="7592709">.</span><span class="ident" id="7592710">Close</span><span class="op" id="7592715">(</span><span class="op" id="7592716">)</span><br>
<span class="lineno"></span><span class="op" id="7592718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7592721">func</span>&nbsp;<span class="ident" id="7592726">TestUnixgramWrite</span><span class="op" id="7592743">(</span><span class="ident" id="7592744">t</span>&nbsp;<span class="op" id="7592746">*</span><span class="ident" id="7592747">testing</span><span class="op" id="7592754">.</span><span class="ident" id="7592755">T</span><span class="op" id="7592756">)</span>&nbsp;<span class="op" id="7592758">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592761">addr</span>&nbsp;<span class="op" id="7592766">:=</span>&nbsp;<span class="ident" id="7592769">testUnixAddr</span><span class="op" id="7592781">(</span><span class="op" id="7592782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592785">laddr</span><span class="op" id="7592790">,</span>&nbsp;<span class="ident" id="7592792">err</span>&nbsp;<span class="op" id="7592796">:=</span>&nbsp;<span class="ident" id="7592799">ResolveUnixAddr</span><span class="op" id="7592814">(</span><span class="string" id="7592815">&#34;unixgram&#34;</span><span class="op" id="7592825">,</span>&nbsp;<span class="ident" id="7592827">addr</span><span class="op" id="7592831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592834">if</span>&nbsp;<span class="ident" id="7592837">err</span>&nbsp;<span class="op" id="7592841">!=</span>&nbsp;<span class="ident" id="7592844">nil</span>&nbsp;<span class="op" id="7592848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592852">t</span><span class="op" id="7592853">.</span><span class="ident" id="7592854">Fatalf</span><span class="op" id="7592860">(</span><span class="string" id="7592861">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7592889">,</span>&nbsp;<span class="ident" id="7592891">err</span><span class="op" id="7592894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7592897">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592900">c</span><span class="op" id="7592901">,</span>&nbsp;<span class="ident" id="7592903">err</span>&nbsp;<span class="op" id="7592907">:=</span>&nbsp;<span class="ident" id="7592910">ListenPacket</span><span class="op" id="7592922">(</span><span class="string" id="7592923">&#34;unixgram&#34;</span><span class="op" id="7592933">,</span>&nbsp;<span class="ident" id="7592935">addr</span><span class="op" id="7592939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7592942">if</span>&nbsp;<span class="ident" id="7592945">err</span>&nbsp;<span class="op" id="7592949">!=</span>&nbsp;<span class="ident" id="7592952">nil</span>&nbsp;<span class="op" id="7592956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7592960">t</span><span class="op" id="7592961">.</span><span class="ident" id="7592962">Fatalf</span><span class="op" id="7592968">(</span><span class="string" id="7592969">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7592994">,</span>&nbsp;<span class="ident" id="7592996">err</span><span class="op" id="7592999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7593002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593005">defer</span>&nbsp;<span class="ident" id="7593011">os</span><span class="op" id="7593013">.</span><span class="ident" id="7593014">Remove</span><span class="op" id="7593020">(</span><span class="ident" id="7593021">addr</span><span class="op" id="7593025">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593028">defer</span>&nbsp;<span class="ident" id="7593034">c</span><span class="op" id="7593035">.</span><span class="ident" id="7593036">Close</span><span class="op" id="7593041">(</span><span class="op" id="7593042">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593046">testUnixgramWriteConn</span><span class="op" id="7593067">(</span><span class="ident" id="7593068">t</span><span class="op" id="7593069">,</span>&nbsp;<span class="ident" id="7593071">laddr</span><span class="op" id="7593076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593079">testUnixgramWritePacketConn</span><span class="op" id="7593106">(</span><span class="ident" id="7593107">t</span><span class="op" id="7593108">,</span>&nbsp;<span class="ident" id="7593110">laddr</span><span class="op" id="7593115">)</span><br>
<span class="lineno"></span><span class="op" id="7593117">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7593120">func</span>&nbsp;<span class="ident" id="7593125">testUnixgramWriteConn</span><span class="op" id="7593146">(</span><span class="ident" id="7593147">t</span>&nbsp;<span class="op" id="7593149">*</span><span class="ident" id="7593150">testing</span><span class="op" id="7593157">.</span><span class="ident" id="7593158">T</span><span class="op" id="7593159">,</span>&nbsp;<span class="ident" id="7593161">raddr</span>&nbsp;<span class="op" id="7593167">*</span><span class="ident" id="7593168">UnixAddr</span><span class="op" id="7593176">)</span>&nbsp;<span class="op" id="7593178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593181">c</span><span class="op" id="7593182">,</span>&nbsp;<span class="ident" id="7593184">err</span>&nbsp;<span class="op" id="7593188">:=</span>&nbsp;<span class="ident" id="7593191">Dial</span><span class="op" id="7593195">(</span><span class="string" id="7593196">&#34;unixgram&#34;</span><span class="op" id="7593206">,</span>&nbsp;<span class="ident" id="7593208">raddr</span><span class="op" id="7593213">.</span><span class="ident" id="7593214">String</span><span class="op" id="7593220">(</span><span class="op" id="7593221">)</span><span class="op" id="7593222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593225">if</span>&nbsp;<span class="ident" id="7593228">err</span>&nbsp;<span class="op" id="7593232">!=</span>&nbsp;<span class="ident" id="7593235">nil</span>&nbsp;<span class="op" id="7593239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593243">t</span><span class="op" id="7593244">.</span><span class="ident" id="7593245">Fatalf</span><span class="op" id="7593251">(</span><span class="string" id="7593252">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7593269">,</span>&nbsp;<span class="ident" id="7593271">err</span><span class="op" id="7593274">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7593277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593280">defer</span>&nbsp;<span class="ident" id="7593286">c</span><span class="op" id="7593287">.</span><span class="ident" id="7593288">Close</span><span class="op" id="7593293">(</span><span class="op" id="7593294">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593298">if</span>&nbsp;<span class="ident" id="7593301">_</span><span class="op" id="7593302">,</span>&nbsp;<span class="ident" id="7593304">err</span>&nbsp;<span class="op" id="7593308">:=</span>&nbsp;<span class="ident" id="7593311">c</span><span class="op" id="7593312">.</span><span class="op" id="7593313">(</span><span class="op" id="7593314">*</span><span class="ident" id="7593315">UnixConn</span><span class="op" id="7593323">)</span><span class="op" id="7593324">.</span><span class="ident" id="7593325">WriteToUnix</span><span class="op" id="7593336">(</span><span class="op" id="7593337">[</span><span class="op" id="7593338">]</span><span class="builtintype" id="7593339">byte</span><span class="op" id="7593343">(</span><span class="string" id="7593344">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7593377">)</span><span class="op" id="7593378">,</span>&nbsp;<span class="ident" id="7593380">raddr</span><span class="op" id="7593385">)</span><span class="op" id="7593386">;</span>&nbsp;<span class="ident" id="7593388">err</span>&nbsp;<span class="op" id="7593392">==</span>&nbsp;<span class="ident" id="7593395">nil</span>&nbsp;<span class="op" id="7593399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593403">t</span><span class="op" id="7593404">.</span><span class="ident" id="7593405">Fatal</span><span class="op" id="7593410">(</span><span class="string" id="7593411">&#34;WriteToUnix&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7593436">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7593439">}</span>&nbsp;<span class="keyword" id="7593441">else</span>&nbsp;<span class="keyword" id="7593446">if</span>&nbsp;<span class="ident" id="7593449">err</span><span class="op" id="7593452">.</span><span class="op" id="7593453">(</span><span class="op" id="7593454">*</span><span class="ident" id="7593455">OpError</span><span class="op" id="7593462">)</span><span class="op" id="7593463">.</span><span class="ident" id="7593464">Err</span>&nbsp;<span class="op" id="7593468">!=</span>&nbsp;<span class="ident" id="7593471">ErrWriteToConnected</span>&nbsp;<span class="op" id="7593491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593495">t</span><span class="op" id="7593496">.</span><span class="ident" id="7593497">Fatalf</span><span class="op" id="7593503">(</span><span class="string" id="7593504">&#34;WriteToUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="7593556">,</span>&nbsp;<span class="ident" id="7593558">err</span><span class="op" id="7593561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7593564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593567">if</span>&nbsp;<span class="ident" id="7593570">_</span><span class="op" id="7593571">,</span>&nbsp;<span class="ident" id="7593573">err</span>&nbsp;<span class="op" id="7593577">=</span>&nbsp;<span class="ident" id="7593579">c</span><span class="op" id="7593580">.</span><span class="op" id="7593581">(</span><span class="op" id="7593582">*</span><span class="ident" id="7593583">UnixConn</span><span class="op" id="7593591">)</span><span class="op" id="7593592">.</span><span class="ident" id="7593593">WriteTo</span><span class="op" id="7593600">(</span><span class="op" id="7593601">[</span><span class="op" id="7593602">]</span><span class="builtintype" id="7593603">byte</span><span class="op" id="7593607">(</span><span class="string" id="7593608">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7593641">)</span><span class="op" id="7593642">,</span>&nbsp;<span class="ident" id="7593644">raddr</span><span class="op" id="7593649">)</span><span class="op" id="7593650">;</span>&nbsp;<span class="ident" id="7593652">err</span>&nbsp;<span class="op" id="7593656">==</span>&nbsp;<span class="ident" id="7593659">nil</span>&nbsp;<span class="op" id="7593663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593667">t</span><span class="op" id="7593668">.</span><span class="ident" id="7593669">Fatal</span><span class="op" id="7593674">(</span><span class="string" id="7593675">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7593696">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7593699">}</span>&nbsp;<span class="keyword" id="7593701">else</span>&nbsp;<span class="keyword" id="7593706">if</span>&nbsp;<span class="ident" id="7593709">err</span><span class="op" id="7593712">.</span><span class="op" id="7593713">(</span><span class="op" id="7593714">*</span><span class="ident" id="7593715">OpError</span><span class="op" id="7593722">)</span><span class="op" id="7593723">.</span><span class="ident" id="7593724">Err</span>&nbsp;<span class="op" id="7593728">!=</span>&nbsp;<span class="ident" id="7593731">ErrWriteToConnected</span>&nbsp;<span class="op" id="7593751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593755">t</span><span class="op" id="7593756">.</span><span class="ident" id="7593757">Fatalf</span><span class="op" id="7593763">(</span><span class="string" id="7593764">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="7593812">,</span>&nbsp;<span class="ident" id="7593814">err</span><span class="op" id="7593817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7593820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7593823">if</span>&nbsp;<span class="ident" id="7593826">_</span><span class="op" id="7593827">,</span>&nbsp;<span class="ident" id="7593829">_</span><span class="op" id="7593830">,</span>&nbsp;<span class="ident" id="7593832">err</span>&nbsp;<span class="op" id="7593836">=</span>&nbsp;<span class="ident" id="7593838">c</span><span class="op" id="7593839">.</span><span class="op" id="7593840">(</span><span class="op" id="7593841">*</span><span class="ident" id="7593842">UnixConn</span><span class="op" id="7593850">)</span><span class="op" id="7593851">.</span><span class="ident" id="7593852">WriteMsgUnix</span><span class="op" id="7593864">(</span><span class="op" id="7593865">[</span><span class="op" id="7593866">]</span><span class="builtintype" id="7593867">byte</span><span class="op" id="7593871">(</span><span class="string" id="7593872">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7593905">)</span><span class="op" id="7593906">,</span>&nbsp;<span class="ident" id="7593908">nil</span><span class="op" id="7593911">,</span>&nbsp;<span class="ident" id="7593913">raddr</span><span class="op" id="7593918">)</span><span class="op" id="7593919">;</span>&nbsp;<span class="ident" id="7593921">err</span>&nbsp;<span class="op" id="7593925">==</span>&nbsp;<span class="ident" id="7593928">nil</span>&nbsp;<span class="op" id="7593932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7593936">t</span><span class="op" id="7593937">.</span><span class="ident" id="7593938">Fatal</span><span class="op" id="7593943">(</span><span class="string" id="7593944">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7593965">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7593968">}</span>&nbsp;<span class="keyword" id="7593970">else</span>&nbsp;<span class="keyword" id="7593975">if</span>&nbsp;<span class="ident" id="7593978">err</span><span class="op" id="7593981">.</span><span class="op" id="7593982">(</span><span class="op" id="7593983">*</span><span class="ident" id="7593984">OpError</span><span class="op" id="7593991">)</span><span class="op" id="7593992">.</span><span class="ident" id="7593993">Err</span>&nbsp;<span class="op" id="7593997">!=</span>&nbsp;<span class="ident" id="7594000">ErrWriteToConnected</span>&nbsp;<span class="op" id="7594020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594024">t</span><span class="op" id="7594025">.</span><span class="ident" id="7594026">Fatalf</span><span class="op" id="7594032">(</span><span class="string" id="7594033">&#34;WriteMsgUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="7594086">,</span>&nbsp;<span class="ident" id="7594088">err</span><span class="op" id="7594091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594097">if</span>&nbsp;<span class="ident" id="7594100">_</span><span class="op" id="7594101">,</span>&nbsp;<span class="ident" id="7594103">err</span>&nbsp;<span class="op" id="7594107">:=</span>&nbsp;<span class="ident" id="7594110">c</span><span class="op" id="7594111">.</span><span class="ident" id="7594112">Write</span><span class="op" id="7594117">(</span><span class="op" id="7594118">[</span><span class="op" id="7594119">]</span><span class="builtintype" id="7594120">byte</span><span class="op" id="7594124">(</span><span class="string" id="7594125">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7594158">)</span><span class="op" id="7594159">)</span><span class="op" id="7594160">;</span>&nbsp;<span class="ident" id="7594162">err</span>&nbsp;<span class="op" id="7594166">!=</span>&nbsp;<span class="ident" id="7594169">nil</span>&nbsp;<span class="op" id="7594173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594177">t</span><span class="op" id="7594178">.</span><span class="ident" id="7594179">Fatalf</span><span class="op" id="7594185">(</span><span class="string" id="7594186">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7594204">,</span>&nbsp;<span class="ident" id="7594206">err</span><span class="op" id="7594209">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594212">}</span><br>
<span class="lineno"></span><span class="op" id="7594214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7594217">func</span>&nbsp;<span class="ident" id="7594222">testUnixgramWritePacketConn</span><span class="op" id="7594249">(</span><span class="ident" id="7594250">t</span>&nbsp;<span class="op" id="7594252">*</span><span class="ident" id="7594253">testing</span><span class="op" id="7594260">.</span><span class="ident" id="7594261">T</span><span class="op" id="7594262">,</span>&nbsp;<span class="ident" id="7594264">raddr</span>&nbsp;<span class="op" id="7594270">*</span><span class="ident" id="7594271">UnixAddr</span><span class="op" id="7594279">)</span>&nbsp;<span class="op" id="7594281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594284">addr</span>&nbsp;<span class="op" id="7594289">:=</span>&nbsp;<span class="ident" id="7594292">testUnixAddr</span><span class="op" id="7594304">(</span><span class="op" id="7594305">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594308">c</span><span class="op" id="7594309">,</span>&nbsp;<span class="ident" id="7594311">err</span>&nbsp;<span class="op" id="7594315">:=</span>&nbsp;<span class="ident" id="7594318">ListenPacket</span><span class="op" id="7594330">(</span><span class="string" id="7594331">&#34;unixgram&#34;</span><span class="op" id="7594341">,</span>&nbsp;<span class="ident" id="7594343">addr</span><span class="op" id="7594347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594350">if</span>&nbsp;<span class="ident" id="7594353">err</span>&nbsp;<span class="op" id="7594357">!=</span>&nbsp;<span class="ident" id="7594360">nil</span>&nbsp;<span class="op" id="7594364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594368">t</span><span class="op" id="7594369">.</span><span class="ident" id="7594370">Fatalf</span><span class="op" id="7594376">(</span><span class="string" id="7594377">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7594402">,</span>&nbsp;<span class="ident" id="7594404">err</span><span class="op" id="7594407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594413">defer</span>&nbsp;<span class="ident" id="7594419">os</span><span class="op" id="7594421">.</span><span class="ident" id="7594422">Remove</span><span class="op" id="7594428">(</span><span class="ident" id="7594429">addr</span><span class="op" id="7594433">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594436">defer</span>&nbsp;<span class="ident" id="7594442">c</span><span class="op" id="7594443">.</span><span class="ident" id="7594444">Close</span><span class="op" id="7594449">(</span><span class="op" id="7594450">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594454">if</span>&nbsp;<span class="ident" id="7594457">_</span><span class="op" id="7594458">,</span>&nbsp;<span class="ident" id="7594460">err</span>&nbsp;<span class="op" id="7594464">:=</span>&nbsp;<span class="ident" id="7594467">c</span><span class="op" id="7594468">.</span><span class="op" id="7594469">(</span><span class="op" id="7594470">*</span><span class="ident" id="7594471">UnixConn</span><span class="op" id="7594479">)</span><span class="op" id="7594480">.</span><span class="ident" id="7594481">WriteToUnix</span><span class="op" id="7594492">(</span><span class="op" id="7594493">[</span><span class="op" id="7594494">]</span><span class="builtintype" id="7594495">byte</span><span class="op" id="7594499">(</span><span class="string" id="7594500">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7594528">)</span><span class="op" id="7594529">,</span>&nbsp;<span class="ident" id="7594531">raddr</span><span class="op" id="7594536">)</span><span class="op" id="7594537">;</span>&nbsp;<span class="ident" id="7594539">err</span>&nbsp;<span class="op" id="7594543">!=</span>&nbsp;<span class="ident" id="7594546">nil</span>&nbsp;<span class="op" id="7594550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594554">t</span><span class="op" id="7594555">.</span><span class="ident" id="7594556">Fatalf</span><span class="op" id="7594562">(</span><span class="string" id="7594563">&#34;WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7594587">,</span>&nbsp;<span class="ident" id="7594589">err</span><span class="op" id="7594592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594595">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594598">if</span>&nbsp;<span class="ident" id="7594601">_</span><span class="op" id="7594602">,</span>&nbsp;<span class="ident" id="7594604">err</span>&nbsp;<span class="op" id="7594608">:=</span>&nbsp;<span class="ident" id="7594611">c</span><span class="op" id="7594612">.</span><span class="ident" id="7594613">WriteTo</span><span class="op" id="7594620">(</span><span class="op" id="7594621">[</span><span class="op" id="7594622">]</span><span class="builtintype" id="7594623">byte</span><span class="op" id="7594627">(</span><span class="string" id="7594628">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7594656">)</span><span class="op" id="7594657">,</span>&nbsp;<span class="ident" id="7594659">raddr</span><span class="op" id="7594664">)</span><span class="op" id="7594665">;</span>&nbsp;<span class="ident" id="7594667">err</span>&nbsp;<span class="op" id="7594671">!=</span>&nbsp;<span class="ident" id="7594674">nil</span>&nbsp;<span class="op" id="7594678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594682">t</span><span class="op" id="7594683">.</span><span class="ident" id="7594684">Fatalf</span><span class="op" id="7594690">(</span><span class="string" id="7594691">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7594711">,</span>&nbsp;<span class="ident" id="7594713">err</span><span class="op" id="7594716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594722">if</span>&nbsp;<span class="ident" id="7594725">_</span><span class="op" id="7594726">,</span>&nbsp;<span class="ident" id="7594728">_</span><span class="op" id="7594729">,</span>&nbsp;<span class="ident" id="7594731">err</span>&nbsp;<span class="op" id="7594735">:=</span>&nbsp;<span class="ident" id="7594738">c</span><span class="op" id="7594739">.</span><span class="op" id="7594740">(</span><span class="op" id="7594741">*</span><span class="ident" id="7594742">UnixConn</span><span class="op" id="7594750">)</span><span class="op" id="7594751">.</span><span class="ident" id="7594752">WriteMsgUnix</span><span class="op" id="7594764">(</span><span class="op" id="7594765">[</span><span class="op" id="7594766">]</span><span class="builtintype" id="7594767">byte</span><span class="op" id="7594771">(</span><span class="string" id="7594772">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7594800">)</span><span class="op" id="7594801">,</span>&nbsp;<span class="ident" id="7594803">nil</span><span class="op" id="7594806">,</span>&nbsp;<span class="ident" id="7594808">raddr</span><span class="op" id="7594813">)</span><span class="op" id="7594814">;</span>&nbsp;<span class="ident" id="7594816">err</span>&nbsp;<span class="op" id="7594820">!=</span>&nbsp;<span class="ident" id="7594823">nil</span>&nbsp;<span class="op" id="7594827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594831">t</span><span class="op" id="7594832">.</span><span class="ident" id="7594833">Fatalf</span><span class="op" id="7594839">(</span><span class="string" id="7594840">&#34;WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7594865">,</span>&nbsp;<span class="ident" id="7594867">err</span><span class="op" id="7594870">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7594876">if</span>&nbsp;<span class="ident" id="7594879">_</span><span class="op" id="7594880">,</span>&nbsp;<span class="ident" id="7594882">err</span>&nbsp;<span class="op" id="7594886">:=</span>&nbsp;<span class="ident" id="7594889">c</span><span class="op" id="7594890">.</span><span class="op" id="7594891">(</span><span class="op" id="7594892">*</span><span class="ident" id="7594893">UnixConn</span><span class="op" id="7594901">)</span><span class="op" id="7594902">.</span><span class="ident" id="7594903">Write</span><span class="op" id="7594908">(</span><span class="op" id="7594909">[</span><span class="op" id="7594910">]</span><span class="builtintype" id="7594911">byte</span><span class="op" id="7594915">(</span><span class="string" id="7594916">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7594944">)</span><span class="op" id="7594945">)</span><span class="op" id="7594946">;</span>&nbsp;<span class="ident" id="7594948">err</span>&nbsp;<span class="op" id="7594952">==</span>&nbsp;<span class="ident" id="7594955">nil</span>&nbsp;<span class="op" id="7594959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7594963">t</span><span class="op" id="7594964">.</span><span class="ident" id="7594965">Fatal</span><span class="op" id="7594970">(</span><span class="string" id="7594971">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7594990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7594993">}</span><br>
<span class="lineno"></span><span class="op" id="7594995">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="7594998">func</span>&nbsp;<span class="ident" id="7595003">TestUnixConnLocalAndRemoteNames</span><span class="op" id="7595034">(</span><span class="ident" id="7595035">t</span>&nbsp;<span class="op" id="7595037">*</span><span class="ident" id="7595038">testing</span><span class="op" id="7595045">.</span><span class="ident" id="7595046">T</span><span class="op" id="7595047">)</span>&nbsp;<span class="op" id="7595049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595052">for</span>&nbsp;<span class="ident" id="7595056">_</span><span class="op" id="7595057">,</span>&nbsp;<span class="ident" id="7595059">laddr</span>&nbsp;<span class="op" id="7595065">:=</span>&nbsp;<span class="keyword" id="7595068">range</span>&nbsp;<span class="op" id="7595074">[</span><span class="op" id="7595075">]</span><span class="builtintype" id="7595076">string</span><span class="op" id="7595082">{</span><span class="string" id="7595083">&#34;&#34;</span><span class="op" id="7595085">,</span>&nbsp;<span class="ident" id="7595087">testUnixAddr</span><span class="op" id="7595099">(</span><span class="op" id="7595100">)</span><span class="op" id="7595101">}</span>&nbsp;<span class="op" id="7595103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595107">laddr</span>&nbsp;<span class="op" id="7595113">:=</span>&nbsp;<span class="ident" id="7595116">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595124">taddr</span>&nbsp;<span class="op" id="7595130">:=</span>&nbsp;<span class="ident" id="7595133">testUnixAddr</span><span class="op" id="7595145">(</span><span class="op" id="7595146">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595150">ta</span><span class="op" id="7595152">,</span>&nbsp;<span class="ident" id="7595154">err</span>&nbsp;<span class="op" id="7595158">:=</span>&nbsp;<span class="ident" id="7595161">ResolveUnixAddr</span><span class="op" id="7595176">(</span><span class="string" id="7595177">&#34;unix&#34;</span><span class="op" id="7595183">,</span>&nbsp;<span class="ident" id="7595185">taddr</span><span class="op" id="7595190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595194">if</span>&nbsp;<span class="ident" id="7595197">err</span>&nbsp;<span class="op" id="7595201">!=</span>&nbsp;<span class="ident" id="7595204">nil</span>&nbsp;<span class="op" id="7595208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595213">t</span><span class="op" id="7595214">.</span><span class="ident" id="7595215">Fatalf</span><span class="op" id="7595221">(</span><span class="string" id="7595222">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7595250">,</span>&nbsp;<span class="ident" id="7595252">err</span><span class="op" id="7595255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7595259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595263">ln</span><span class="op" id="7595265">,</span>&nbsp;<span class="ident" id="7595267">err</span>&nbsp;<span class="op" id="7595271">:=</span>&nbsp;<span class="ident" id="7595274">ListenUnix</span><span class="op" id="7595284">(</span><span class="string" id="7595285">&#34;unix&#34;</span><span class="op" id="7595291">,</span>&nbsp;<span class="ident" id="7595293">ta</span><span class="op" id="7595295">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595299">if</span>&nbsp;<span class="ident" id="7595302">err</span>&nbsp;<span class="op" id="7595306">!=</span>&nbsp;<span class="ident" id="7595309">nil</span>&nbsp;<span class="op" id="7595313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595318">t</span><span class="op" id="7595319">.</span><span class="ident" id="7595320">Fatalf</span><span class="op" id="7595326">(</span><span class="string" id="7595327">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7595350">,</span>&nbsp;<span class="ident" id="7595352">err</span><span class="op" id="7595355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7595359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595363">defer</span>&nbsp;<span class="keyword" id="7595369">func</span><span class="op" id="7595373">(</span><span class="op" id="7595374">)</span>&nbsp;<span class="op" id="7595376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595381">ln</span><span class="op" id="7595383">.</span><span class="ident" id="7595384">Close</span><span class="op" id="7595389">(</span><span class="op" id="7595390">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595395">os</span><span class="op" id="7595397">.</span><span class="ident" id="7595398">Remove</span><span class="op" id="7595404">(</span><span class="ident" id="7595405">taddr</span><span class="op" id="7595410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7595414">}</span><span class="op" id="7595415">(</span><span class="op" id="7595416">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595421">done</span>&nbsp;<span class="op" id="7595426">:=</span>&nbsp;<span class="builtinfunc" id="7595429">make</span><span class="op" id="7595433">(</span><span class="keyword" id="7595434">chan</span>&nbsp;<span class="builtintype" id="7595439">int</span><span class="op" id="7595442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595446">go</span>&nbsp;<span class="ident" id="7595449">transponder</span><span class="op" id="7595460">(</span><span class="ident" id="7595461">t</span><span class="op" id="7595462">,</span>&nbsp;<span class="ident" id="7595464">ln</span><span class="op" id="7595466">,</span>&nbsp;<span class="ident" id="7595468">done</span><span class="op" id="7595472">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595477">la</span><span class="op" id="7595479">,</span>&nbsp;<span class="ident" id="7595481">err</span>&nbsp;<span class="op" id="7595485">:=</span>&nbsp;<span class="ident" id="7595488">ResolveUnixAddr</span><span class="op" id="7595503">(</span><span class="string" id="7595504">&#34;unix&#34;</span><span class="op" id="7595510">,</span>&nbsp;<span class="ident" id="7595512">laddr</span><span class="op" id="7595517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595521">if</span>&nbsp;<span class="ident" id="7595524">err</span>&nbsp;<span class="op" id="7595528">!=</span>&nbsp;<span class="ident" id="7595531">nil</span>&nbsp;<span class="op" id="7595535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595540">t</span><span class="op" id="7595541">.</span><span class="ident" id="7595542">Fatalf</span><span class="op" id="7595548">(</span><span class="string" id="7595549">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7595577">,</span>&nbsp;<span class="ident" id="7595579">err</span><span class="op" id="7595582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7595586">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595590">c</span><span class="op" id="7595591">,</span>&nbsp;<span class="ident" id="7595593">err</span>&nbsp;<span class="op" id="7595597">:=</span>&nbsp;<span class="ident" id="7595600">DialUnix</span><span class="op" id="7595608">(</span><span class="string" id="7595609">&#34;unix&#34;</span><span class="op" id="7595615">,</span>&nbsp;<span class="ident" id="7595617">la</span><span class="op" id="7595619">,</span>&nbsp;<span class="ident" id="7595621">ta</span><span class="op" id="7595623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595627">if</span>&nbsp;<span class="ident" id="7595630">err</span>&nbsp;<span class="op" id="7595634">!=</span>&nbsp;<span class="ident" id="7595637">nil</span>&nbsp;<span class="op" id="7595641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595646">t</span><span class="op" id="7595647">.</span><span class="ident" id="7595648">Fatalf</span><span class="op" id="7595654">(</span><span class="string" id="7595655">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7595676">,</span>&nbsp;<span class="ident" id="7595678">err</span><span class="op" id="7595681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7595685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595689">defer</span>&nbsp;<span class="keyword" id="7595695">func</span><span class="op" id="7595699">(</span><span class="op" id="7595700">)</span>&nbsp;<span class="op" id="7595702">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595707">c</span><span class="op" id="7595708">.</span><span class="ident" id="7595709">Close</span><span class="op" id="7595714">(</span><span class="op" id="7595715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595720">if</span>&nbsp;<span class="ident" id="7595723">la</span>&nbsp;<span class="op" id="7595726">!=</span>&nbsp;<span class="ident" id="7595729">nil</span>&nbsp;<span class="op" id="7595733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595739">defer</span>&nbsp;<span class="ident" id="7595745">os</span><span class="op" id="7595747">.</span><span class="ident" id="7595748">Remove</span><span class="op" id="7595754">(</span><span class="ident" id="7595755">laddr</span><span class="op" id="7595760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7595765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7595769">}</span><span class="op" id="7595770">(</span><span class="op" id="7595771">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595775">if</span>&nbsp;<span class="ident" id="7595778">_</span><span class="op" id="7595779">,</span>&nbsp;<span class="ident" id="7595781">err</span>&nbsp;<span class="op" id="7595785">:=</span>&nbsp;<span class="ident" id="7595788">c</span><span class="op" id="7595789">.</span><span class="ident" id="7595790">Write</span><span class="op" id="7595795">(</span><span class="op" id="7595796">[</span><span class="op" id="7595797">]</span><span class="builtintype" id="7595798">byte</span><span class="op" id="7595802">(</span><span class="string" id="7595803">&#34;UNIXCONN&nbsp;LOCAL&nbsp;AND&nbsp;REMOTE&nbsp;NAME&nbsp;TEST&#34;</span><span class="op" id="7595840">)</span><span class="op" id="7595841">)</span><span class="op" id="7595842">;</span>&nbsp;<span class="ident" id="7595844">err</span>&nbsp;<span class="op" id="7595848">!=</span>&nbsp;<span class="ident" id="7595851">nil</span>&nbsp;<span class="op" id="7595855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595860">t</span><span class="op" id="7595861">.</span><span class="ident" id="7595862">Fatalf</span><span class="op" id="7595868">(</span><span class="string" id="7595869">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7595896">,</span>&nbsp;<span class="ident" id="7595898">err</span><span class="op" id="7595901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7595905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595910">switch</span>&nbsp;<span class="ident" id="7595917">runtime</span><span class="op" id="7595924">.</span><span class="ident" id="7595925">GOOS</span>&nbsp;<span class="op" id="7595930">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595934">case</span>&nbsp;<span class="string" id="7595939">&#34;android&#34;</span><span class="op" id="7595948">,</span>&nbsp;<span class="string" id="7595950">&#34;linux&#34;</span><span class="op" id="7595957">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7595962">if</span>&nbsp;<span class="ident" id="7595965">laddr</span>&nbsp;<span class="op" id="7595971">==</span>&nbsp;<span class="string" id="7595974">&#34;&#34;</span>&nbsp;<span class="op" id="7595977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7595983">laddr</span>&nbsp;<span class="op" id="7595989">=</span>&nbsp;<span class="string" id="7595991">&#34;@&#34;</span>&nbsp;<span class="comment" id="7595995">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596022">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7596026">var</span>&nbsp;<span class="ident" id="7596030">connAddrs</span>&nbsp;<span class="op" id="7596040">=</span>&nbsp;<span class="op" id="7596042">[</span><span class="num" id="7596043">3</span><span class="op" id="7596044">]</span><span class="keyword" id="7596045">struct</span><span class="op" id="7596051">{</span>&nbsp;<span class="ident" id="7596053">got</span><span class="op" id="7596056">,</span>&nbsp;<span class="ident" id="7596058">want</span>&nbsp;<span class="ident" id="7596063">Addr</span>&nbsp;<span class="op" id="7596068">}</span><span class="op" id="7596069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596074">{</span><span class="ident" id="7596075">ln</span><span class="op" id="7596077">.</span><span class="ident" id="7596078">Addr</span><span class="op" id="7596082">(</span><span class="op" id="7596083">)</span><span class="op" id="7596084">,</span>&nbsp;<span class="ident" id="7596086">ta</span><span class="op" id="7596088">}</span><span class="op" id="7596089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596094">{</span><span class="ident" id="7596095">c</span><span class="op" id="7596096">.</span><span class="ident" id="7596097">LocalAddr</span><span class="op" id="7596106">(</span><span class="op" id="7596107">)</span><span class="op" id="7596108">,</span>&nbsp;<span class="op" id="7596110">&amp;</span><span class="ident" id="7596111">UnixAddr</span><span class="op" id="7596119">{</span><span class="ident" id="7596120">Name</span><span class="op" id="7596124">:</span>&nbsp;<span class="ident" id="7596126">laddr</span><span class="op" id="7596131">,</span>&nbsp;<span class="ident" id="7596133">Net</span><span class="op" id="7596136">:</span>&nbsp;<span class="string" id="7596138">&#34;unix&#34;</span><span class="op" id="7596144">}</span><span class="op" id="7596145">}</span><span class="op" id="7596146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596151">{</span><span class="ident" id="7596152">c</span><span class="op" id="7596153">.</span><span class="ident" id="7596154">RemoteAddr</span><span class="op" id="7596164">(</span><span class="op" id="7596165">)</span><span class="op" id="7596166">,</span>&nbsp;<span class="ident" id="7596168">ta</span><span class="op" id="7596170">}</span><span class="op" id="7596171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596175">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7596179">for</span>&nbsp;<span class="ident" id="7596183">_</span><span class="op" id="7596184">,</span>&nbsp;<span class="ident" id="7596186">ca</span>&nbsp;<span class="op" id="7596189">:=</span>&nbsp;<span class="keyword" id="7596192">range</span>&nbsp;<span class="ident" id="7596198">connAddrs</span>&nbsp;<span class="op" id="7596208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7596213">if</span>&nbsp;<span class="op" id="7596216">!</span><span class="ident" id="7596217">reflect</span><span class="op" id="7596224">.</span><span class="ident" id="7596225">DeepEqual</span><span class="op" id="7596234">(</span><span class="ident" id="7596235">ca</span><span class="op" id="7596237">.</span><span class="ident" id="7596238">got</span><span class="op" id="7596241">,</span>&nbsp;<span class="ident" id="7596243">ca</span><span class="op" id="7596245">.</span><span class="ident" id="7596246">want</span><span class="op" id="7596250">)</span>&nbsp;<span class="op" id="7596252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7596258">t</span><span class="op" id="7596259">.</span><span class="ident" id="7596260">Fatalf</span><span class="op" id="7596266">(</span><span class="string" id="7596267">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7596290">,</span>&nbsp;<span class="ident" id="7596292">ca</span><span class="op" id="7596294">.</span><span class="ident" id="7596295">got</span><span class="op" id="7596298">,</span>&nbsp;<span class="ident" id="7596300">ca</span><span class="op" id="7596302">.</span><span class="ident" id="7596303">want</span><span class="op" id="7596307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596316">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596321">&lt;-</span><span class="ident" id="7596323">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596329">}</span><br>
<span class="lineno"></span><span class="op" id="7596331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7596334">func</span>&nbsp;<span class="ident" id="7596339">TestUnixgramConnLocalAndRemoteNames</span><span class="op" id="7596374">(</span><span class="ident" id="7596375">t</span>&nbsp;<span class="op" id="7596377">*</span><span class="ident" id="7596378">testing</span><span class="op" id="7596385">.</span><span class="ident" id="7596386">T</span><span class="op" id="7596387">)</span>&nbsp;<span class="op" id="7596389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7596392">for</span>&nbsp;<span class="ident" id="7596396">_</span><span class="op" id="7596397">,</span>&nbsp;<span class="ident" id="7596399">laddr</span>&nbsp;<span class="op" id="7596405">:=</span>&nbsp;<span class="keyword" id="7596408">range</span>&nbsp;<span class="op" id="7596414">[</span><span class="op" id="7596415">]</span><span class="builtintype" id="7596416">string</span><span class="op" id="7596422">{</span><span class="string" id="7596423">&#34;&#34;</span><span class="op" id="7596425">,</span>&nbsp;<span class="ident" id="7596427">testUnixAddr</span><span class="op" id="7596439">(</span><span class="op" id="7596440">)</span><span class="op" id="7596441">}</span>&nbsp;<span class="op" id="7596443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7596447">laddr</span>&nbsp;<span class="op" id="7596453">:=</span>&nbsp;<span class="ident" id="7596456">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7596464">taddr</span>&nbsp;<span class="op" id="7596470">:=</span>&nbsp;<span class="ident" id="7596473">testUnixAddr</span><span class="op" id="7596485">(</span><span class="op" id="7596486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7596490">ta</span><span class="op" id="7596492">,</span>&nbsp;<span class="ident" id="7596494">err</span>&nbsp;<span class="op" id="7596498">:=</span>&nbsp;<span class="ident" id="7596501">ResolveUnixAddr</span><span class="op" id="7596516">(</span><span class="string" id="7596517">&#34;unixgram&#34;</span><span class="op" id="7596527">,</span>&nbsp;<span class="ident" id="7596529">taddr</span><span class="op" id="7596534">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7596538">if</span>&nbsp;<span class="ident" id="7596541">err</span>&nbsp;<span class="op" id="7596545">!=</span>&nbsp;<span class="ident" id="7596548">nil</span>&nbsp;<span class="op" id="7596552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7596557">t</span><span class="op" id="7596558">.</span><span class="ident" id="7596559">Fatalf</span><span class="op" id="7596565">(</span><span class="string" id="7596566">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7596594">,</span>&nbsp;<span class="ident" id="7596596">err</span><span class="op" id="7596599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7596607">c1</span><span class="op" id="7596609">,</span>&nbsp;<span class="ident" id="7596611">err</span>&nbsp;<span class="op" id="7596615">:=</span>&nbsp;<span class="ident" id="7596618">ListenUnixgram</span><span class="op" id="7596632">(</span><span class="string" id="7596633">&#34;unixgram&#34;</span><span class="op" id="7596643">,</span>&nbsp;<span class="ident" id="7596645">ta</span><span class="op" id="7596647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7596651">if</span>&nbsp;<span class="ident" id="7596654">err</span>&nbsp;<span class="op" id="7596658">!=</span>&nbsp;<span class="ident" id="7596661">nil</span>&nbsp;<span class="op" id="7596665">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7596670">t</span><span class="op" id="7596671">.</span><span class="ident" id="7596672">Fatalf</span><span class="op" id="7596678">(</span><span class="string" id="7596679">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7596706">,</span>&nbsp;<span class="ident" id="7596708">err</span><span class="op" id="7596711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7596719">defer</span>&nbsp;<span class="keyword" id="7596725">func</span><span class="op" id="7596729">(</span><span class="op" id="7596730">)</span>&nbsp;<span class="op" id="7596732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7596737">c1</span><span class="op" id="7596739">.</span><span class="ident" id="7596740">Close</span><span class="op" id="7596745">(</span><span class="op" id="7596746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7596751">os</span><span class="op" id="7596753">.</span><span class="ident" id="7596754">Remove</span><span class="op" id="7596760">(</span><span class="ident" id="7596761">taddr</span><span class="op" id="7596766">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596770">}</span><span class="op" id="7596771">(</span><span class="op" id="7596772">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7596777">var</span>&nbsp;<span class="ident" id="7596781">la</span>&nbsp;<span class="op" id="7596784">*</span><span class="ident" id="7596785">UnixAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7596796">if</span>&nbsp;<span class="ident" id="7596799">laddr</span>&nbsp;<span class="op" id="7596805">!=</span>&nbsp;<span class="string" id="7596808">&#34;&#34;</span>&nbsp;<span class="op" id="7596811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7596816">if</span>&nbsp;<span class="ident" id="7596819">la</span><span class="op" id="7596821">,</span>&nbsp;<span class="ident" id="7596823">err</span>&nbsp;<span class="op" id="7596827">=</span>&nbsp;<span class="ident" id="7596829">ResolveUnixAddr</span><span class="op" id="7596844">(</span><span class="string" id="7596845">&#34;unixgram&#34;</span><span class="op" id="7596855">,</span>&nbsp;<span class="ident" id="7596857">laddr</span><span class="op" id="7596862">)</span><span class="op" id="7596863">;</span>&nbsp;<span class="ident" id="7596865">err</span>&nbsp;<span class="op" id="7596869">!=</span>&nbsp;<span class="ident" id="7596872">nil</span>&nbsp;<span class="op" id="7596876">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7596882">t</span><span class="op" id="7596883">.</span><span class="ident" id="7596884">Fatalf</span><span class="op" id="7596890">(</span><span class="string" id="7596891">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7596919">,</span>&nbsp;<span class="ident" id="7596921">err</span><span class="op" id="7596924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7596933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7596937">c2</span><span class="op" id="7596939">,</span>&nbsp;<span class="ident" id="7596941">err</span>&nbsp;<span class="op" id="7596945">:=</span>&nbsp;<span class="ident" id="7596948">DialUnix</span><span class="op" id="7596956">(</span><span class="string" id="7596957">&#34;unixgram&#34;</span><span class="op" id="7596967">,</span>&nbsp;<span class="ident" id="7596969">la</span><span class="op" id="7596971">,</span>&nbsp;<span class="ident" id="7596973">ta</span><span class="op" id="7596975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7596979">if</span>&nbsp;<span class="ident" id="7596982">err</span>&nbsp;<span class="op" id="7596986">!=</span>&nbsp;<span class="ident" id="7596989">nil</span>&nbsp;<span class="op" id="7596993">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7596998">t</span><span class="op" id="7596999">.</span><span class="ident" id="7597000">Fatalf</span><span class="op" id="7597006">(</span><span class="string" id="7597007">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7597028">,</span>&nbsp;<span class="ident" id="7597030">err</span><span class="op" id="7597033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7597037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7597041">defer</span>&nbsp;<span class="keyword" id="7597047">func</span><span class="op" id="7597051">(</span><span class="op" id="7597052">)</span>&nbsp;<span class="op" id="7597054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7597059">c2</span><span class="op" id="7597061">.</span><span class="ident" id="7597062">Close</span><span class="op" id="7597067">(</span><span class="op" id="7597068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7597073">if</span>&nbsp;<span class="ident" id="7597076">la</span>&nbsp;<span class="op" id="7597079">!=</span>&nbsp;<span class="ident" id="7597082">nil</span>&nbsp;<span class="op" id="7597086">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7597092">defer</span>&nbsp;<span class="ident" id="7597098">os</span><span class="op" id="7597100">.</span><span class="ident" id="7597101">Remove</span><span class="op" id="7597107">(</span><span class="ident" id="7597108">laddr</span><span class="op" id="7597113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7597118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7597122">}</span><span class="op" id="7597123">(</span><span class="op" id="7597124">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7597129">switch</span>&nbsp;<span class="ident" id="7597136">runtime</span><span class="op" id="7597143">.</span><span class="ident" id="7597144">GOOS</span>&nbsp;<span class="op" id="7597149">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7597153">case</span>&nbsp;<span class="string" id="7597158">&#34;android&#34;</span><span class="op" id="7597167">,</span>&nbsp;<span class="string" id="7597169">&#34;linux&#34;</span><span class="op" id="7597176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7597181">if</span>&nbsp;<span class="ident" id="7597184">laddr</span>&nbsp;<span class="op" id="7597190">==</span>&nbsp;<span class="string" id="7597193">&#34;&#34;</span>&nbsp;<span class="op" id="7597196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7597202">laddr</span>&nbsp;<span class="op" id="7597208">=</span>&nbsp;<span class="string" id="7597210">&#34;@&#34;</span>&nbsp;<span class="comment" id="7597214">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7597237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7597241">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7597246">var</span>&nbsp;<span class="ident" id="7597250">connAddrs</span>&nbsp;<span class="op" id="7597260">=</span>&nbsp;<span class="op" id="7597262">[</span><span class="num" id="7597263">4</span><span class="op" id="7597264">]</span><span class="keyword" id="7597265">struct</span><span class="op" id="7597271">{</span>&nbsp;<span class="ident" id="7597273">got</span><span class="op" id="7597276">,</span>&nbsp;<span class="ident" id="7597278">want</span>&nbsp;<span class="ident" id="7597283">Addr</span>&nbsp;<span class="op" id="7597288">}</span><span class="op" id="7597289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7597294">{</span><span class="ident" id="7597295">c1</span><span class="op" id="7597297">.</span><span class="ident" id="7597298">LocalAddr</span><span class="op" id="7597307">(</span><span class="op" id="7597308">)</span><span class="op" id="7597309">,</span>&nbsp;<span class="ident" id="7597311">ta</span><span class="op" id="7597313">}</span><span class="op" id="7597314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7597319">{</span><span class="ident" id="7597320">c1</span><span class="op" id="7597322">.</span><span class="ident" id="7597323">RemoteAddr</span><span class="op" id="7597333">(</span><span class="op" id="7597334">)</span><span class="op" id="7597335">,</span>&nbsp;<span class="ident" id="7597337">nil</span><span class="op" id="7597340">}</span><span class="op" id="7597341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7597346">{</span><span class="ident" id="7597347">c2</span><span class="op" id="7597349">.</span><span class="ident" id="7597350">LocalAddr</span><span class="op" id="7597359">(</span><span class="op" id="7597360">)</span><span class="op" id="7597361">,</span>&nbsp;<span class="op" id="7597363">&amp;</span><span class="ident" id="7597364">UnixAddr</span><span class="op" id="7597372">{</span><span class="ident" id="7597373">Name</span><span class="op" id="7597377">:</span>&nbsp;<span class="ident" id="7597379">laddr</span><span class="op" id="7597384">,</span>&nbsp;<span class="ident" id="7597386">Net</span><span class="op" id="7597389">:</span>&nbsp;<span class="string" id="7597391">&#34;unixgram&#34;</span><span class="op" id="7597401">}</span><span class="op" id="7597402">}</span><span class="op" id="7597403">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7597408">{</span><span class="ident" id="7597409">c2</span><span class="op" id="7597411">.</span><span class="ident" id="7597412">RemoteAddr</span><span class="op" id="7597422">(</span><span class="op" id="7597423">)</span><span class="op" id="7597424">,</span>&nbsp;<span class="ident" id="7597426">ta</span><span class="op" id="7597428">}</span><span class="op" id="7597429">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7597433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7597437">for</span>&nbsp;<span class="ident" id="7597441">_</span><span class="op" id="7597442">,</span>&nbsp;<span class="ident" id="7597444">ca</span>&nbsp;<span class="op" id="7597447">:=</span>&nbsp;<span class="keyword" id="7597450">range</span>&nbsp;<span class="ident" id="7597456">connAddrs</span>&nbsp;<span class="op" id="7597466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7597471">if</span>&nbsp;<span class="op" id="7597474">!</span><span class="ident" id="7597475">reflect</span><span class="op" id="7597482">.</span><span class="ident" id="7597483">DeepEqual</span><span class="op" id="7597492">(</span><span class="ident" id="7597493">ca</span><span class="op" id="7597495">.</span><span class="ident" id="7597496">got</span><span class="op" id="7597499">,</span>&nbsp;<span class="ident" id="7597501">ca</span><span class="op" id="7597503">.</span><span class="ident" id="7597504">want</span><span class="op" id="7597508">)</span>&nbsp;<span class="op" id="7597510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7597516">t</span><span class="op" id="7597517">.</span><span class="ident" id="7597518">Fatalf</span><span class="op" id="7597524">(</span><span class="string" id="7597525">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7597548">,</span>&nbsp;<span class="ident" id="7597550">ca</span><span class="op" id="7597552">.</span><span class="ident" id="7597553">got</span><span class="op" id="7597556">,</span>&nbsp;<span class="ident" id="7597558">ca</span><span class="op" id="7597560">.</span><span class="ident" id="7597561">want</span><span class="op" id="7597565">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7597570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7597574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7597577">}</span><br>
<span class="lineno"></span><span class="op" id="7597579">}</span>
</div>
</body>
</html>
