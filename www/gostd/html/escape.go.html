<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html</h2>
<ul>
<li><a href="/gostd/html/entity.go.html">entity.go</a></li>
<li><a href="/gostd/html/entity_test.go.html">entity_test.go</a></li>
<li><a href="/gostd/html/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/escape_test.go.html">escape_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5316256">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5316311">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5316365">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5316416">//&nbsp;Package&nbsp;html&nbsp;provides&nbsp;functions&nbsp;for&nbsp;escaping&nbsp;and&nbsp;unescaping&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5316490">package</span>&nbsp;<span class="ident" id="5316498">html</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5316504">import</span>&nbsp;<span class="op" id="5316511">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5316514">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5316523">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5316534">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5316549">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5316552">type</span>&nbsp;<span class="ident" id="5316557">writer</span>&nbsp;<span class="keyword" id="5316564">interface</span>&nbsp;<span class="op" id="5316574">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316577">WriteString</span><span class="op" id="5316588">(</span><span class="builtintype" id="5316589">string</span><span class="op" id="5316595">)</span>&nbsp;<span class="op" id="5316597">(</span><span class="builtintype" id="5316598">int</span><span class="op" id="5316601">,</span>&nbsp;<span class="builtintype" id="5316603">error</span><span class="op" id="5316608">)</span><br>
<span class="lineno"></span><span class="op" id="5316610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5316613">//&nbsp;These&nbsp;replacements&nbsp;permit&nbsp;compatibility&nbsp;with&nbsp;old&nbsp;numeric&nbsp;entities&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5316687">//&nbsp;assumed&nbsp;Windows-1252&nbsp;encoding.</span><br>
<span class="lineno">20</span><span class="comment" id="5316721">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><span class="keyword" id="5316832">var</span>&nbsp;<span class="ident" id="5316836">replacementTable</span>&nbsp;<span class="op" id="5316853">=</span>&nbsp;<span class="op" id="5316855">[</span><span class="op" id="5316856">...</span><span class="op" id="5316859">]</span><span class="builtintype" id="5316860">rune</span><span class="op" id="5316864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5316867">&#39;\u20AC&#39;</span><span class="op" id="5316875">,</span>&nbsp;<span class="comment" id="5316877">//&nbsp;First&nbsp;entry&nbsp;is&nbsp;what&nbsp;0x80&nbsp;should&nbsp;be&nbsp;replaced&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5316931">&#39;\u0081&#39;</span><span class="op" id="5316939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5316942">&#39;\u201A&#39;</span><span class="op" id="5316950">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5316953">&#39;\u0192&#39;</span><span class="op" id="5316961">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5316964">&#39;\u201E&#39;</span><span class="op" id="5316972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5316975">&#39;\u2026&#39;</span><span class="op" id="5316983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5316986">&#39;\u2020&#39;</span><span class="op" id="5316994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5316997">&#39;\u2021&#39;</span><span class="op" id="5317005">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317008">&#39;\u02C6&#39;</span><span class="op" id="5317016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317019">&#39;\u2030&#39;</span><span class="op" id="5317027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317030">&#39;\u0160&#39;</span><span class="op" id="5317038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317041">&#39;\u2039&#39;</span><span class="op" id="5317049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317052">&#39;\u0152&#39;</span><span class="op" id="5317060">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317063">&#39;\u008D&#39;</span><span class="op" id="5317071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317074">&#39;\u017D&#39;</span><span class="op" id="5317082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317085">&#39;\u008F&#39;</span><span class="op" id="5317093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317096">&#39;\u0090&#39;</span><span class="op" id="5317104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317107">&#39;\u2018&#39;</span><span class="op" id="5317115">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317118">&#39;\u2019&#39;</span><span class="op" id="5317126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317129">&#39;\u201C&#39;</span><span class="op" id="5317137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317140">&#39;\u201D&#39;</span><span class="op" id="5317148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317151">&#39;\u2022&#39;</span><span class="op" id="5317159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317162">&#39;\u2013&#39;</span><span class="op" id="5317170">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317173">&#39;\u2014&#39;</span><span class="op" id="5317181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317184">&#39;\u02DC&#39;</span><span class="op" id="5317192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317195">&#39;\u2122&#39;</span><span class="op" id="5317203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317206">&#39;\u0161&#39;</span><span class="op" id="5317214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317217">&#39;\u203A&#39;</span><span class="op" id="5317225">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317228">&#39;\u0153&#39;</span><span class="op" id="5317236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317239">&#39;\u009D&#39;</span><span class="op" id="5317247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317250">&#39;\u017E&#39;</span><span class="op" id="5317258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5317261">&#39;\u0178&#39;</span><span class="op" id="5317269">,</span>&nbsp;<span class="comment" id="5317271">//&nbsp;Last&nbsp;entry&nbsp;is&nbsp;0x9F.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5317295">//&nbsp;0x00-&gt;&#39;\uFFFD&#39;&nbsp;is&nbsp;handled&nbsp;programmatically.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5317343">//&nbsp;0x0D-&gt;&#39;\u000D&#39;&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="op" id="5317373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5317376">//&nbsp;unescapeEntity&nbsp;reads&nbsp;an&nbsp;entity&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;from&nbsp;b[src:]&nbsp;and&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5317450">//&nbsp;corresponding&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;b[dst:],&nbsp;returning&nbsp;the&nbsp;incremented&nbsp;dst&nbsp;and&nbsp;src&nbsp;cursors.</span><br>
<span class="lineno">60</span><span class="comment" id="5317530">//&nbsp;Precondition:&nbsp;b[src]&nbsp;==&nbsp;&#39;&amp;&#39;&nbsp;&amp;&amp;&nbsp;dst&nbsp;&lt;=&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="5317576">//&nbsp;attribute&nbsp;should&nbsp;be&nbsp;true&nbsp;if&nbsp;parsing&nbsp;an&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5317635">func</span>&nbsp;<span class="ident" id="5317640">unescapeEntity</span><span class="op" id="5317654">(</span><span class="ident" id="5317655">b</span>&nbsp;<span class="op" id="5317657">[</span><span class="op" id="5317658">]</span><span class="builtintype" id="5317659">byte</span><span class="op" id="5317663">,</span>&nbsp;<span class="ident" id="5317665">dst</span><span class="op" id="5317668">,</span>&nbsp;<span class="ident" id="5317670">src</span>&nbsp;<span class="builtintype" id="5317674">int</span><span class="op" id="5317677">,</span>&nbsp;<span class="ident" id="5317679">attribute</span>&nbsp;<span class="builtintype" id="5317689">bool</span><span class="op" id="5317693">)</span>&nbsp;<span class="op" id="5317695">(</span><span class="ident" id="5317696">dst1</span><span class="op" id="5317700">,</span>&nbsp;<span class="ident" id="5317702">src1</span>&nbsp;<span class="builtintype" id="5317707">int</span><span class="op" id="5317710">)</span>&nbsp;<span class="op" id="5317712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5317715">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5317828">//&nbsp;i&nbsp;starts&nbsp;at&nbsp;1&nbsp;because&nbsp;we&nbsp;already&nbsp;know&nbsp;that&nbsp;s[0]&nbsp;==&nbsp;&#39;&amp;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317888">i</span><span class="op" id="5317889">,</span>&nbsp;<span class="ident" id="5317891">s</span>&nbsp;<span class="op" id="5317893">:=</span>&nbsp;<span class="num" id="5317896">1</span><span class="op" id="5317897">,</span>&nbsp;<span class="ident" id="5317899">b</span><span class="op" id="5317900">[</span><span class="ident" id="5317901">src</span><span class="op" id="5317904">:</span><span class="op" id="5317905">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317909">if</span>&nbsp;<span class="builtinfunc" id="5317912">len</span><span class="op" id="5317915">(</span><span class="ident" id="5317916">s</span><span class="op" id="5317917">)</span>&nbsp;<span class="op" id="5317919">&lt;=</span>&nbsp;<span class="num" id="5317922">1</span>&nbsp;<span class="op" id="5317924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317928">b</span><span class="op" id="5317929">[</span><span class="ident" id="5317930">dst</span><span class="op" id="5317933">]</span>&nbsp;<span class="op" id="5317935">=</span>&nbsp;<span class="ident" id="5317937">b</span><span class="op" id="5317938">[</span><span class="ident" id="5317939">src</span><span class="op" id="5317942">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317946">return</span>&nbsp;<span class="ident" id="5317953">dst</span>&nbsp;<span class="op" id="5317957">+</span>&nbsp;<span class="num" id="5317959">1</span><span class="op" id="5317960">,</span>&nbsp;<span class="ident" id="5317962">src</span>&nbsp;<span class="op" id="5317966">+</span>&nbsp;<span class="num" id="5317968">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317975">if</span>&nbsp;<span class="ident" id="5317978">s</span><span class="op" id="5317979">[</span><span class="ident" id="5317980">i</span><span class="op" id="5317981">]</span>&nbsp;<span class="op" id="5317983">==</span>&nbsp;<span class="string" id="5317986">&#39;#&#39;</span>&nbsp;<span class="op" id="5317990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317994">if</span>&nbsp;<span class="builtinfunc" id="5317997">len</span><span class="op" id="5318000">(</span><span class="ident" id="5318001">s</span><span class="op" id="5318002">)</span>&nbsp;<span class="op" id="5318004">&lt;=</span>&nbsp;<span class="num" id="5318007">3</span>&nbsp;<span class="op" id="5318009">{</span>&nbsp;<span class="comment" id="5318011">//&nbsp;We&nbsp;need&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;&#34;&amp;#.&#34;.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318049">b</span><span class="op" id="5318050">[</span><span class="ident" id="5318051">dst</span><span class="op" id="5318054">]</span>&nbsp;<span class="op" id="5318056">=</span>&nbsp;<span class="ident" id="5318058">b</span><span class="op" id="5318059">[</span><span class="ident" id="5318060">src</span><span class="op" id="5318063">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318068">return</span>&nbsp;<span class="ident" id="5318075">dst</span>&nbsp;<span class="op" id="5318079">+</span>&nbsp;<span class="num" id="5318081">1</span><span class="op" id="5318082">,</span>&nbsp;<span class="ident" id="5318084">src</span>&nbsp;<span class="op" id="5318088">+</span>&nbsp;<span class="num" id="5318090">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318098">i</span><span class="op" id="5318099">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318104">c</span>&nbsp;<span class="op" id="5318106">:=</span>&nbsp;<span class="ident" id="5318109">s</span><span class="op" id="5318110">[</span><span class="ident" id="5318111">i</span><span class="op" id="5318112">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318116">hex</span>&nbsp;<span class="op" id="5318120">:=</span>&nbsp;<span class="builtintype" id="5318123">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318131">if</span>&nbsp;<span class="ident" id="5318134">c</span>&nbsp;<span class="op" id="5318136">==</span>&nbsp;<span class="string" id="5318139">&#39;x&#39;</span>&nbsp;<span class="op" id="5318143">||</span>&nbsp;<span class="ident" id="5318146">c</span>&nbsp;<span class="op" id="5318148">==</span>&nbsp;<span class="string" id="5318151">&#39;X&#39;</span>&nbsp;<span class="op" id="5318155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318160">hex</span>&nbsp;<span class="op" id="5318164">=</span>&nbsp;<span class="builtintype" id="5318166">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318174">i</span><span class="op" id="5318175">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318180">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318185">x</span>&nbsp;<span class="op" id="5318187">:=</span>&nbsp;<span class="string" id="5318190">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318199">for</span>&nbsp;<span class="ident" id="5318203">i</span>&nbsp;<span class="op" id="5318205">&lt;</span>&nbsp;<span class="builtinfunc" id="5318207">len</span><span class="op" id="5318210">(</span><span class="ident" id="5318211">s</span><span class="op" id="5318212">)</span>&nbsp;<span class="op" id="5318214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318219">c</span>&nbsp;<span class="op" id="5318221">=</span>&nbsp;<span class="ident" id="5318223">s</span><span class="op" id="5318224">[</span><span class="ident" id="5318225">i</span><span class="op" id="5318226">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318231">i</span><span class="op" id="5318232">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318238">if</span>&nbsp;<span class="ident" id="5318241">hex</span>&nbsp;<span class="op" id="5318245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318251">if</span>&nbsp;<span class="string" id="5318254">&#39;0&#39;</span>&nbsp;<span class="op" id="5318258">&lt;=</span>&nbsp;<span class="ident" id="5318261">c</span>&nbsp;<span class="op" id="5318263">&amp;&amp;</span>&nbsp;<span class="ident" id="5318266">c</span>&nbsp;<span class="op" id="5318268">&lt;=</span>&nbsp;<span class="string" id="5318271">&#39;9&#39;</span>&nbsp;<span class="op" id="5318275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318282">x</span>&nbsp;<span class="op" id="5318284">=</span>&nbsp;<span class="num" id="5318286">16</span><span class="op" id="5318288">*</span><span class="ident" id="5318289">x</span>&nbsp;<span class="op" id="5318291">+</span>&nbsp;<span class="builtintype" id="5318293">rune</span><span class="op" id="5318297">(</span><span class="ident" id="5318298">c</span><span class="op" id="5318299">)</span>&nbsp;<span class="op" id="5318301">-</span>&nbsp;<span class="string" id="5318303">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318312">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318325">}</span>&nbsp;<span class="keyword" id="5318327">else</span>&nbsp;<span class="keyword" id="5318332">if</span>&nbsp;<span class="string" id="5318335">&#39;a&#39;</span>&nbsp;<span class="op" id="5318339">&lt;=</span>&nbsp;<span class="ident" id="5318342">c</span>&nbsp;<span class="op" id="5318344">&amp;&amp;</span>&nbsp;<span class="ident" id="5318347">c</span>&nbsp;<span class="op" id="5318349">&lt;=</span>&nbsp;<span class="string" id="5318352">&#39;f&#39;</span>&nbsp;<span class="op" id="5318356">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318363">x</span>&nbsp;<span class="op" id="5318365">=</span>&nbsp;<span class="num" id="5318367">16</span><span class="op" id="5318369">*</span><span class="ident" id="5318370">x</span>&nbsp;<span class="op" id="5318372">+</span>&nbsp;<span class="builtintype" id="5318374">rune</span><span class="op" id="5318378">(</span><span class="ident" id="5318379">c</span><span class="op" id="5318380">)</span>&nbsp;<span class="op" id="5318382">-</span>&nbsp;<span class="string" id="5318384">&#39;a&#39;</span>&nbsp;<span class="op" id="5318388">+</span>&nbsp;<span class="num" id="5318390">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318398">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318411">}</span>&nbsp;<span class="keyword" id="5318413">else</span>&nbsp;<span class="keyword" id="5318418">if</span>&nbsp;<span class="string" id="5318421">&#39;A&#39;</span>&nbsp;<span class="op" id="5318425">&lt;=</span>&nbsp;<span class="ident" id="5318428">c</span>&nbsp;<span class="op" id="5318430">&amp;&amp;</span>&nbsp;<span class="ident" id="5318433">c</span>&nbsp;<span class="op" id="5318435">&lt;=</span>&nbsp;<span class="string" id="5318438">&#39;F&#39;</span>&nbsp;<span class="op" id="5318442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318449">x</span>&nbsp;<span class="op" id="5318451">=</span>&nbsp;<span class="num" id="5318453">16</span><span class="op" id="5318455">*</span><span class="ident" id="5318456">x</span>&nbsp;<span class="op" id="5318458">+</span>&nbsp;<span class="builtintype" id="5318460">rune</span><span class="op" id="5318464">(</span><span class="ident" id="5318465">c</span><span class="op" id="5318466">)</span>&nbsp;<span class="op" id="5318468">-</span>&nbsp;<span class="string" id="5318470">&#39;A&#39;</span>&nbsp;<span class="op" id="5318474">+</span>&nbsp;<span class="num" id="5318476">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318484">continue</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318502">}</span>&nbsp;<span class="keyword" id="5318504">else</span>&nbsp;<span class="keyword" id="5318509">if</span>&nbsp;<span class="string" id="5318512">&#39;0&#39;</span>&nbsp;<span class="op" id="5318516">&lt;=</span>&nbsp;<span class="ident" id="5318519">c</span>&nbsp;<span class="op" id="5318521">&amp;&amp;</span>&nbsp;<span class="ident" id="5318524">c</span>&nbsp;<span class="op" id="5318526">&lt;=</span>&nbsp;<span class="string" id="5318529">&#39;9&#39;</span>&nbsp;<span class="op" id="5318533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318539">x</span>&nbsp;<span class="op" id="5318541">=</span>&nbsp;<span class="num" id="5318543">10</span><span class="op" id="5318545">*</span><span class="ident" id="5318546">x</span>&nbsp;<span class="op" id="5318548">+</span>&nbsp;<span class="builtintype" id="5318550">rune</span><span class="op" id="5318554">(</span><span class="ident" id="5318555">c</span><span class="op" id="5318556">)</span>&nbsp;<span class="op" id="5318558">-</span>&nbsp;<span class="string" id="5318560">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318568">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318580">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318585">if</span>&nbsp;<span class="ident" id="5318588">c</span>&nbsp;<span class="op" id="5318590">!=</span>&nbsp;<span class="string" id="5318593">&#39;;&#39;</span>&nbsp;<span class="op" id="5318597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318603">i</span><span class="op" id="5318604">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318615">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318623">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318628">if</span>&nbsp;<span class="ident" id="5318631">i</span>&nbsp;<span class="op" id="5318633">&lt;=</span>&nbsp;<span class="num" id="5318636">3</span>&nbsp;<span class="op" id="5318638">{</span>&nbsp;<span class="comment" id="5318640">//&nbsp;No&nbsp;characters&nbsp;matched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318669">b</span><span class="op" id="5318670">[</span><span class="ident" id="5318671">dst</span><span class="op" id="5318674">]</span>&nbsp;<span class="op" id="5318676">=</span>&nbsp;<span class="ident" id="5318678">b</span><span class="op" id="5318679">[</span><span class="ident" id="5318680">src</span><span class="op" id="5318683">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318688">return</span>&nbsp;<span class="ident" id="5318695">dst</span>&nbsp;<span class="op" id="5318699">+</span>&nbsp;<span class="num" id="5318701">1</span><span class="op" id="5318702">,</span>&nbsp;<span class="ident" id="5318704">src</span>&nbsp;<span class="op" id="5318708">+</span>&nbsp;<span class="num" id="5318710">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318714">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318719">if</span>&nbsp;<span class="num" id="5318722">0x80</span>&nbsp;<span class="op" id="5318727">&lt;=</span>&nbsp;<span class="ident" id="5318730">x</span>&nbsp;<span class="op" id="5318732">&amp;&amp;</span>&nbsp;<span class="ident" id="5318735">x</span>&nbsp;<span class="op" id="5318737">&lt;=</span>&nbsp;<span class="num" id="5318740">0x9F</span>&nbsp;<span class="op" id="5318745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5318750">//&nbsp;Replace&nbsp;characters&nbsp;from&nbsp;Windows-1252&nbsp;with&nbsp;UTF-8&nbsp;equivalents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318817">x</span>&nbsp;<span class="op" id="5318819">=</span>&nbsp;<span class="ident" id="5318821">replacementTable</span><span class="op" id="5318837">[</span><span class="ident" id="5318838">x</span><span class="op" id="5318839">-</span><span class="num" id="5318840">0x80</span><span class="op" id="5318844">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318848">}</span>&nbsp;<span class="keyword" id="5318850">else</span>&nbsp;<span class="keyword" id="5318855">if</span>&nbsp;<span class="ident" id="5318858">x</span>&nbsp;<span class="op" id="5318860">==</span>&nbsp;<span class="num" id="5318863">0</span>&nbsp;<span class="op" id="5318865">||</span>&nbsp;<span class="op" id="5318868">(</span><span class="num" id="5318869">0xD800</span>&nbsp;<span class="op" id="5318876">&lt;=</span>&nbsp;<span class="ident" id="5318879">x</span>&nbsp;<span class="op" id="5318881">&amp;&amp;</span>&nbsp;<span class="ident" id="5318884">x</span>&nbsp;<span class="op" id="5318886">&lt;=</span>&nbsp;<span class="num" id="5318889">0xDFFF</span><span class="op" id="5318895">)</span>&nbsp;<span class="op" id="5318897">||</span>&nbsp;<span class="ident" id="5318900">x</span>&nbsp;<span class="op" id="5318902">&gt;</span>&nbsp;<span class="num" id="5318904">0x10FFFF</span>&nbsp;<span class="op" id="5318913">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5318918">//&nbsp;Replace&nbsp;invalid&nbsp;characters&nbsp;with&nbsp;the&nbsp;replacement&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318983">x</span>&nbsp;<span class="op" id="5318985">=</span>&nbsp;<span class="string" id="5318987">&#39;\uFFFD&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319003">return</span>&nbsp;<span class="ident" id="5319010">dst</span>&nbsp;<span class="op" id="5319014">+</span>&nbsp;<span class="ident" id="5319016">utf8</span><span class="op" id="5319020">.</span><span class="ident" id="5319021">EncodeRune</span><span class="op" id="5319031">(</span><span class="ident" id="5319032">b</span><span class="op" id="5319033">[</span><span class="ident" id="5319034">dst</span><span class="op" id="5319037">:</span><span class="op" id="5319038">]</span><span class="op" id="5319039">,</span>&nbsp;<span class="ident" id="5319041">x</span><span class="op" id="5319042">)</span><span class="op" id="5319043">,</span>&nbsp;<span class="ident" id="5319045">src</span>&nbsp;<span class="op" id="5319049">+</span>&nbsp;<span class="ident" id="5319051">i</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319058">//&nbsp;Consume&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;characters&nbsp;possible,&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319122">//&nbsp;consumed&nbsp;characters&nbsp;matching&nbsp;one&nbsp;of&nbsp;the&nbsp;named&nbsp;references.</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319185">for</span>&nbsp;<span class="ident" id="5319189">i</span>&nbsp;<span class="op" id="5319191">&lt;</span>&nbsp;<span class="builtinfunc" id="5319193">len</span><span class="op" id="5319196">(</span><span class="ident" id="5319197">s</span><span class="op" id="5319198">)</span>&nbsp;<span class="op" id="5319200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319204">c</span>&nbsp;<span class="op" id="5319206">:=</span>&nbsp;<span class="ident" id="5319209">s</span><span class="op" id="5319210">[</span><span class="ident" id="5319211">i</span><span class="op" id="5319212">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319216">i</span><span class="op" id="5319217">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319222">//&nbsp;Lower-cased&nbsp;characters&nbsp;are&nbsp;more&nbsp;common&nbsp;in&nbsp;entities,&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;them&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319307">if</span>&nbsp;<span class="string" id="5319310">&#39;a&#39;</span>&nbsp;<span class="op" id="5319314">&lt;=</span>&nbsp;<span class="ident" id="5319317">c</span>&nbsp;<span class="op" id="5319319">&amp;&amp;</span>&nbsp;<span class="ident" id="5319322">c</span>&nbsp;<span class="op" id="5319324">&lt;=</span>&nbsp;<span class="string" id="5319327">&#39;z&#39;</span>&nbsp;<span class="op" id="5319331">||</span>&nbsp;<span class="string" id="5319334">&#39;A&#39;</span>&nbsp;<span class="op" id="5319338">&lt;=</span>&nbsp;<span class="ident" id="5319341">c</span>&nbsp;<span class="op" id="5319343">&amp;&amp;</span>&nbsp;<span class="ident" id="5319346">c</span>&nbsp;<span class="op" id="5319348">&lt;=</span>&nbsp;<span class="string" id="5319351">&#39;Z&#39;</span>&nbsp;<span class="op" id="5319355">||</span>&nbsp;<span class="string" id="5319358">&#39;0&#39;</span>&nbsp;<span class="op" id="5319362">&lt;=</span>&nbsp;<span class="ident" id="5319365">c</span>&nbsp;<span class="op" id="5319367">&amp;&amp;</span>&nbsp;<span class="ident" id="5319370">c</span>&nbsp;<span class="op" id="5319372">&lt;=</span>&nbsp;<span class="string" id="5319375">&#39;9&#39;</span>&nbsp;<span class="op" id="5319379">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319384">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319399">if</span>&nbsp;<span class="ident" id="5319402">c</span>&nbsp;<span class="op" id="5319404">!=</span>&nbsp;<span class="string" id="5319407">&#39;;&#39;</span>&nbsp;<span class="op" id="5319411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319416">i</span><span class="op" id="5319417">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319422">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319426">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319437">entityName</span>&nbsp;<span class="op" id="5319448">:=</span>&nbsp;<span class="builtintype" id="5319451">string</span><span class="op" id="5319457">(</span><span class="ident" id="5319458">s</span><span class="op" id="5319459">[</span><span class="num" id="5319460">1</span><span class="op" id="5319461">:</span><span class="ident" id="5319462">i</span><span class="op" id="5319463">]</span><span class="op" id="5319464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319467">if</span>&nbsp;<span class="ident" id="5319470">entityName</span>&nbsp;<span class="op" id="5319481">==</span>&nbsp;<span class="string" id="5319484">&#34;&#34;</span>&nbsp;<span class="op" id="5319487">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319491">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319502">}</span>&nbsp;<span class="keyword" id="5319504">else</span>&nbsp;<span class="keyword" id="5319509">if</span>&nbsp;<span class="ident" id="5319512">attribute</span>&nbsp;<span class="op" id="5319522">&amp;&amp;</span>&nbsp;<span class="ident" id="5319525">entityName</span><span class="op" id="5319535">[</span><span class="builtinfunc" id="5319536">len</span><span class="op" id="5319539">(</span><span class="ident" id="5319540">entityName</span><span class="op" id="5319550">)</span><span class="op" id="5319551">-</span><span class="num" id="5319552">1</span><span class="op" id="5319553">]</span>&nbsp;<span class="op" id="5319555">!=</span>&nbsp;<span class="string" id="5319558">&#39;;&#39;</span>&nbsp;<span class="op" id="5319562">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5319565">len</span><span class="op" id="5319568">(</span><span class="ident" id="5319569">s</span><span class="op" id="5319570">)</span>&nbsp;<span class="op" id="5319572">&gt;</span>&nbsp;<span class="ident" id="5319574">i</span>&nbsp;<span class="op" id="5319576">&amp;&amp;</span>&nbsp;<span class="ident" id="5319579">s</span><span class="op" id="5319580">[</span><span class="ident" id="5319581">i</span><span class="op" id="5319582">]</span>&nbsp;<span class="op" id="5319584">==</span>&nbsp;<span class="string" id="5319587">&#39;=&#39;</span>&nbsp;<span class="op" id="5319591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319595">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319606">}</span>&nbsp;<span class="keyword" id="5319608">else</span>&nbsp;<span class="keyword" id="5319613">if</span>&nbsp;<span class="ident" id="5319616">x</span>&nbsp;<span class="op" id="5319618">:=</span>&nbsp;<span class="ident" id="5319621">entity</span><span class="op" id="5319627">[</span><span class="ident" id="5319628">entityName</span><span class="op" id="5319638">]</span><span class="op" id="5319639">;</span>&nbsp;<span class="ident" id="5319641">x</span>&nbsp;<span class="op" id="5319643">!=</span>&nbsp;<span class="num" id="5319646">0</span>&nbsp;<span class="op" id="5319648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319652">return</span>&nbsp;<span class="ident" id="5319659">dst</span>&nbsp;<span class="op" id="5319663">+</span>&nbsp;<span class="ident" id="5319665">utf8</span><span class="op" id="5319669">.</span><span class="ident" id="5319670">EncodeRune</span><span class="op" id="5319680">(</span><span class="ident" id="5319681">b</span><span class="op" id="5319682">[</span><span class="ident" id="5319683">dst</span><span class="op" id="5319686">:</span><span class="op" id="5319687">]</span><span class="op" id="5319688">,</span>&nbsp;<span class="ident" id="5319690">x</span><span class="op" id="5319691">)</span><span class="op" id="5319692">,</span>&nbsp;<span class="ident" id="5319694">src</span>&nbsp;<span class="op" id="5319698">+</span>&nbsp;<span class="ident" id="5319700">i</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319703">}</span>&nbsp;<span class="keyword" id="5319705">else</span>&nbsp;<span class="keyword" id="5319710">if</span>&nbsp;<span class="ident" id="5319713">x</span>&nbsp;<span class="op" id="5319715">:=</span>&nbsp;<span class="ident" id="5319718">entity2</span><span class="op" id="5319725">[</span><span class="ident" id="5319726">entityName</span><span class="op" id="5319736">]</span><span class="op" id="5319737">;</span>&nbsp;<span class="ident" id="5319739">x</span><span class="op" id="5319740">[</span><span class="num" id="5319741">0</span><span class="op" id="5319742">]</span>&nbsp;<span class="op" id="5319744">!=</span>&nbsp;<span class="num" id="5319747">0</span>&nbsp;<span class="op" id="5319749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319753">dst1</span>&nbsp;<span class="op" id="5319758">:=</span>&nbsp;<span class="ident" id="5319761">dst</span>&nbsp;<span class="op" id="5319765">+</span>&nbsp;<span class="ident" id="5319767">utf8</span><span class="op" id="5319771">.</span><span class="ident" id="5319772">EncodeRune</span><span class="op" id="5319782">(</span><span class="ident" id="5319783">b</span><span class="op" id="5319784">[</span><span class="ident" id="5319785">dst</span><span class="op" id="5319788">:</span><span class="op" id="5319789">]</span><span class="op" id="5319790">,</span>&nbsp;<span class="ident" id="5319792">x</span><span class="op" id="5319793">[</span><span class="num" id="5319794">0</span><span class="op" id="5319795">]</span><span class="op" id="5319796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319800">return</span>&nbsp;<span class="ident" id="5319807">dst1</span>&nbsp;<span class="op" id="5319812">+</span>&nbsp;<span class="ident" id="5319814">utf8</span><span class="op" id="5319818">.</span><span class="ident" id="5319819">EncodeRune</span><span class="op" id="5319829">(</span><span class="ident" id="5319830">b</span><span class="op" id="5319831">[</span><span class="ident" id="5319832">dst1</span><span class="op" id="5319836">:</span><span class="op" id="5319837">]</span><span class="op" id="5319838">,</span>&nbsp;<span class="ident" id="5319840">x</span><span class="op" id="5319841">[</span><span class="num" id="5319842">1</span><span class="op" id="5319843">]</span><span class="op" id="5319844">)</span><span class="op" id="5319845">,</span>&nbsp;<span class="ident" id="5319847">src</span>&nbsp;<span class="op" id="5319851">+</span>&nbsp;<span class="ident" id="5319853">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319856">}</span>&nbsp;<span class="keyword" id="5319858">else</span>&nbsp;<span class="keyword" id="5319863">if</span>&nbsp;<span class="op" id="5319866">!</span><span class="ident" id="5319867">attribute</span>&nbsp;<span class="op" id="5319877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319881">maxLen</span>&nbsp;<span class="op" id="5319888">:=</span>&nbsp;<span class="builtinfunc" id="5319891">len</span><span class="op" id="5319894">(</span><span class="ident" id="5319895">entityName</span><span class="op" id="5319905">)</span>&nbsp;<span class="op" id="5319907">-</span>&nbsp;<span class="num" id="5319909">1</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319913">if</span>&nbsp;<span class="ident" id="5319916">maxLen</span>&nbsp;<span class="op" id="5319923">&gt;</span>&nbsp;<span class="ident" id="5319925">longestEntityWithoutSemicolon</span>&nbsp;<span class="op" id="5319955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319960">maxLen</span>&nbsp;<span class="op" id="5319967">=</span>&nbsp;<span class="ident" id="5319969">longestEntityWithoutSemicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320005">for</span>&nbsp;<span class="ident" id="5320009">j</span>&nbsp;<span class="op" id="5320011">:=</span>&nbsp;<span class="ident" id="5320014">maxLen</span><span class="op" id="5320020">;</span>&nbsp;<span class="ident" id="5320022">j</span>&nbsp;<span class="op" id="5320024">&gt;</span>&nbsp;<span class="num" id="5320026">1</span><span class="op" id="5320027">;</span>&nbsp;<span class="ident" id="5320029">j</span><span class="op" id="5320030">--</span>&nbsp;<span class="op" id="5320033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320038">if</span>&nbsp;<span class="ident" id="5320041">x</span>&nbsp;<span class="op" id="5320043">:=</span>&nbsp;<span class="ident" id="5320046">entity</span><span class="op" id="5320052">[</span><span class="ident" id="5320053">entityName</span><span class="op" id="5320063">[</span><span class="op" id="5320064">:</span><span class="ident" id="5320065">j</span><span class="op" id="5320066">]</span><span class="op" id="5320067">]</span><span class="op" id="5320068">;</span>&nbsp;<span class="ident" id="5320070">x</span>&nbsp;<span class="op" id="5320072">!=</span>&nbsp;<span class="num" id="5320075">0</span>&nbsp;<span class="op" id="5320077">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320083">return</span>&nbsp;<span class="ident" id="5320090">dst</span>&nbsp;<span class="op" id="5320094">+</span>&nbsp;<span class="ident" id="5320096">utf8</span><span class="op" id="5320100">.</span><span class="ident" id="5320101">EncodeRune</span><span class="op" id="5320111">(</span><span class="ident" id="5320112">b</span><span class="op" id="5320113">[</span><span class="ident" id="5320114">dst</span><span class="op" id="5320117">:</span><span class="op" id="5320118">]</span><span class="op" id="5320119">,</span>&nbsp;<span class="ident" id="5320121">x</span><span class="op" id="5320122">)</span><span class="op" id="5320123">,</span>&nbsp;<span class="ident" id="5320125">src</span>&nbsp;<span class="op" id="5320129">+</span>&nbsp;<span class="ident" id="5320131">j</span>&nbsp;<span class="op" id="5320133">+</span>&nbsp;<span class="num" id="5320135">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320151">dst1</span><span class="op" id="5320155">,</span>&nbsp;<span class="ident" id="5320157">src1</span>&nbsp;<span class="op" id="5320162">=</span>&nbsp;<span class="ident" id="5320164">dst</span><span class="op" id="5320167">+</span><span class="ident" id="5320168">i</span><span class="op" id="5320169">,</span>&nbsp;<span class="ident" id="5320171">src</span><span class="op" id="5320174">+</span><span class="ident" id="5320175">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5320178">copy</span><span class="op" id="5320182">(</span><span class="ident" id="5320183">b</span><span class="op" id="5320184">[</span><span class="ident" id="5320185">dst</span><span class="op" id="5320188">:</span><span class="ident" id="5320189">dst1</span><span class="op" id="5320193">]</span><span class="op" id="5320194">,</span>&nbsp;<span class="ident" id="5320196">b</span><span class="op" id="5320197">[</span><span class="ident" id="5320198">src</span><span class="op" id="5320201">:</span><span class="ident" id="5320202">src1</span><span class="op" id="5320206">]</span><span class="op" id="5320207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320210">return</span>&nbsp;<span class="ident" id="5320217">dst1</span><span class="op" id="5320221">,</span>&nbsp;<span class="ident" id="5320223">src1</span><br>
<span class="lineno"></span><span class="op" id="5320228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="5320231">//&nbsp;unescape&nbsp;unescapes&nbsp;b&#39;s&nbsp;entities&nbsp;in-place,&nbsp;so&nbsp;that&nbsp;&#34;a&amp;lt;b&#34;&nbsp;becomes&nbsp;&#34;a&lt;b&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5320308">func</span>&nbsp;<span class="ident" id="5320313">unescape</span><span class="op" id="5320321">(</span><span class="ident" id="5320322">b</span>&nbsp;<span class="op" id="5320324">[</span><span class="op" id="5320325">]</span><span class="builtintype" id="5320326">byte</span><span class="op" id="5320330">)</span>&nbsp;<span class="op" id="5320332">[</span><span class="op" id="5320333">]</span><span class="builtintype" id="5320334">byte</span>&nbsp;<span class="op" id="5320339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320342">for</span>&nbsp;<span class="ident" id="5320346">i</span><span class="op" id="5320347">,</span>&nbsp;<span class="ident" id="5320349">c</span>&nbsp;<span class="op" id="5320351">:=</span>&nbsp;<span class="keyword" id="5320354">range</span>&nbsp;<span class="ident" id="5320360">b</span>&nbsp;<span class="op" id="5320362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320366">if</span>&nbsp;<span class="ident" id="5320369">c</span>&nbsp;<span class="op" id="5320371">==</span>&nbsp;<span class="string" id="5320374">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5320378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320383">dst</span><span class="op" id="5320386">,</span>&nbsp;<span class="ident" id="5320388">src</span>&nbsp;<span class="op" id="5320392">:=</span>&nbsp;<span class="ident" id="5320395">unescapeEntity</span><span class="op" id="5320409">(</span><span class="ident" id="5320410">b</span><span class="op" id="5320411">,</span>&nbsp;<span class="ident" id="5320413">i</span><span class="op" id="5320414">,</span>&nbsp;<span class="ident" id="5320416">i</span><span class="op" id="5320417">,</span>&nbsp;<span class="builtintype" id="5320419">false</span><span class="op" id="5320424">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320429">for</span>&nbsp;<span class="ident" id="5320433">src</span>&nbsp;<span class="op" id="5320437">&lt;</span>&nbsp;<span class="builtinfunc" id="5320439">len</span><span class="op" id="5320442">(</span><span class="ident" id="5320443">b</span><span class="op" id="5320444">)</span>&nbsp;<span class="op" id="5320446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320452">c</span>&nbsp;<span class="op" id="5320454">:=</span>&nbsp;<span class="ident" id="5320457">b</span><span class="op" id="5320458">[</span><span class="ident" id="5320459">src</span><span class="op" id="5320462">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320468">if</span>&nbsp;<span class="ident" id="5320471">c</span>&nbsp;<span class="op" id="5320473">==</span>&nbsp;<span class="string" id="5320476">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5320480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320487">dst</span><span class="op" id="5320490">,</span>&nbsp;<span class="ident" id="5320492">src</span>&nbsp;<span class="op" id="5320496">=</span>&nbsp;<span class="ident" id="5320498">unescapeEntity</span><span class="op" id="5320512">(</span><span class="ident" id="5320513">b</span><span class="op" id="5320514">,</span>&nbsp;<span class="ident" id="5320516">dst</span><span class="op" id="5320519">,</span>&nbsp;<span class="ident" id="5320521">src</span><span class="op" id="5320524">,</span>&nbsp;<span class="builtintype" id="5320526">false</span><span class="op" id="5320531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320537">}</span>&nbsp;<span class="keyword" id="5320539">else</span>&nbsp;<span class="op" id="5320544">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320551">b</span><span class="op" id="5320552">[</span><span class="ident" id="5320553">dst</span><span class="op" id="5320556">]</span>&nbsp;<span class="op" id="5320558">=</span>&nbsp;<span class="ident" id="5320560">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320567">dst</span><span class="op" id="5320570">,</span>&nbsp;<span class="ident" id="5320572">src</span>&nbsp;<span class="op" id="5320576">=</span>&nbsp;<span class="ident" id="5320578">dst</span><span class="op" id="5320581">+</span><span class="num" id="5320582">1</span><span class="op" id="5320583">,</span>&nbsp;<span class="ident" id="5320585">src</span><span class="op" id="5320588">+</span><span class="num" id="5320589">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320605">return</span>&nbsp;<span class="ident" id="5320612">b</span><span class="op" id="5320613">[</span><span class="num" id="5320614">0</span><span class="op" id="5320615">:</span><span class="ident" id="5320616">dst</span><span class="op" id="5320619">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320629">return</span>&nbsp;<span class="ident" id="5320636">b</span><br>
<span class="lineno"></span><span class="op" id="5320638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5320641">const</span>&nbsp;<span class="ident" id="5320647">escapedChars</span>&nbsp;<span class="op" id="5320660">=</span>&nbsp;<span class="string" id="5320662">`&amp;&#39;&lt;&gt;&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5320671">func</span>&nbsp;<span class="ident" id="5320676">escape</span><span class="op" id="5320682">(</span><span class="ident" id="5320683">w</span>&nbsp;<span class="ident" id="5320685">writer</span><span class="op" id="5320691">,</span>&nbsp;<span class="ident" id="5320693">s</span>&nbsp;<span class="builtintype" id="5320695">string</span><span class="op" id="5320701">)</span>&nbsp;<span class="builtintype" id="5320703">error</span>&nbsp;<span class="op" id="5320709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320712">i</span>&nbsp;<span class="op" id="5320714">:=</span>&nbsp;<span class="ident" id="5320717">strings</span><span class="op" id="5320724">.</span><span class="ident" id="5320725">IndexAny</span><span class="op" id="5320733">(</span><span class="ident" id="5320734">s</span><span class="op" id="5320735">,</span>&nbsp;<span class="ident" id="5320737">escapedChars</span><span class="op" id="5320749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320752">for</span>&nbsp;<span class="ident" id="5320756">i</span>&nbsp;<span class="op" id="5320758">!=</span>&nbsp;<span class="op" id="5320761">-</span><span class="num" id="5320762">1</span>&nbsp;<span class="op" id="5320764">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320768">if</span>&nbsp;<span class="ident" id="5320771">_</span><span class="op" id="5320772">,</span>&nbsp;<span class="ident" id="5320774">err</span>&nbsp;<span class="op" id="5320778">:=</span>&nbsp;<span class="ident" id="5320781">w</span><span class="op" id="5320782">.</span><span class="ident" id="5320783">WriteString</span><span class="op" id="5320794">(</span><span class="ident" id="5320795">s</span><span class="op" id="5320796">[</span><span class="op" id="5320797">:</span><span class="ident" id="5320798">i</span><span class="op" id="5320799">]</span><span class="op" id="5320800">)</span><span class="op" id="5320801">;</span>&nbsp;<span class="ident" id="5320803">err</span>&nbsp;<span class="op" id="5320807">!=</span>&nbsp;<span class="ident" id="5320810">nil</span>&nbsp;<span class="op" id="5320814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320819">return</span>&nbsp;<span class="ident" id="5320826">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320836">var</span>&nbsp;<span class="ident" id="5320840">esc</span>&nbsp;<span class="builtintype" id="5320844">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320853">switch</span>&nbsp;<span class="ident" id="5320860">s</span><span class="op" id="5320861">[</span><span class="ident" id="5320862">i</span><span class="op" id="5320863">]</span>&nbsp;<span class="op" id="5320865">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320869">case</span>&nbsp;<span class="string" id="5320874">&#39;&amp;&#39;</span><span class="op" id="5320877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320882">esc</span>&nbsp;<span class="op" id="5320886">=</span>&nbsp;<span class="string" id="5320888">&#34;&amp;amp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320898">case</span>&nbsp;<span class="string" id="5320903">&#39;\&#39;&#39;</span><span class="op" id="5320907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5320912">//&nbsp;&#34;&amp;#39;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;apos;&#34;&nbsp;and&nbsp;apos&nbsp;was&nbsp;not&nbsp;in&nbsp;HTML&nbsp;until&nbsp;HTML5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320989">esc</span>&nbsp;<span class="op" id="5320993">=</span>&nbsp;<span class="string" id="5320995">&#34;&amp;#39;&#34;</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321005">case</span>&nbsp;<span class="string" id="5321010">&#39;&lt;&#39;</span><span class="op" id="5321013">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321018">esc</span>&nbsp;<span class="op" id="5321022">=</span>&nbsp;<span class="string" id="5321024">&#34;&amp;lt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321033">case</span>&nbsp;<span class="string" id="5321038">&#39;&gt;&#39;</span><span class="op" id="5321041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321046">esc</span>&nbsp;<span class="op" id="5321050">=</span>&nbsp;<span class="string" id="5321052">&#34;&amp;gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321061">case</span>&nbsp;<span class="string" id="5321066">&#39;&#34;&#39;</span><span class="op" id="5321069">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321074">//&nbsp;&#34;&amp;#34;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;quot;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321114">esc</span>&nbsp;<span class="op" id="5321118">=</span>&nbsp;<span class="string" id="5321120">&#34;&amp;#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321130">default</span><span class="op" id="5321137">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5321142">panic</span><span class="op" id="5321147">(</span><span class="string" id="5321148">&#34;unrecognized&nbsp;escape&nbsp;character&#34;</span><span class="op" id="5321179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321183">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321187">s</span>&nbsp;<span class="op" id="5321189">=</span>&nbsp;<span class="ident" id="5321191">s</span><span class="op" id="5321192">[</span><span class="ident" id="5321193">i</span><span class="op" id="5321194">+</span><span class="num" id="5321195">1</span><span class="op" id="5321196">:</span><span class="op" id="5321197">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321201">if</span>&nbsp;<span class="ident" id="5321204">_</span><span class="op" id="5321205">,</span>&nbsp;<span class="ident" id="5321207">err</span>&nbsp;<span class="op" id="5321211">:=</span>&nbsp;<span class="ident" id="5321214">w</span><span class="op" id="5321215">.</span><span class="ident" id="5321216">WriteString</span><span class="op" id="5321227">(</span><span class="ident" id="5321228">esc</span><span class="op" id="5321231">)</span><span class="op" id="5321232">;</span>&nbsp;<span class="ident" id="5321234">err</span>&nbsp;<span class="op" id="5321238">!=</span>&nbsp;<span class="ident" id="5321241">nil</span>&nbsp;<span class="op" id="5321245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321250">return</span>&nbsp;<span class="ident" id="5321257">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321267">i</span>&nbsp;<span class="op" id="5321269">=</span>&nbsp;<span class="ident" id="5321271">strings</span><span class="op" id="5321278">.</span><span class="ident" id="5321279">IndexAny</span><span class="op" id="5321287">(</span><span class="ident" id="5321288">s</span><span class="op" id="5321289">,</span>&nbsp;<span class="ident" id="5321291">escapedChars</span><span class="op" id="5321303">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321309">_</span><span class="op" id="5321310">,</span>&nbsp;<span class="ident" id="5321312">err</span>&nbsp;<span class="op" id="5321316">:=</span>&nbsp;<span class="ident" id="5321319">w</span><span class="op" id="5321320">.</span><span class="ident" id="5321321">WriteString</span><span class="op" id="5321332">(</span><span class="ident" id="5321333">s</span><span class="op" id="5321334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321337">return</span>&nbsp;<span class="ident" id="5321344">err</span><br>
<span class="lineno"></span><span class="op" id="5321348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="comment" id="5321351">//&nbsp;EscapeString&nbsp;escapes&nbsp;special&nbsp;characters&nbsp;like&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&amp;lt;&#34;.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="5321424">//&nbsp;escapes&nbsp;only&nbsp;five&nbsp;such&nbsp;characters:&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;&#39;&nbsp;and&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5321480">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5321557">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5321573">func</span>&nbsp;<span class="ident" id="5321578">EscapeString</span><span class="op" id="5321590">(</span><span class="ident" id="5321591">s</span>&nbsp;<span class="builtintype" id="5321593">string</span><span class="op" id="5321599">)</span>&nbsp;<span class="builtintype" id="5321601">string</span>&nbsp;<span class="op" id="5321608">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321611">if</span>&nbsp;<span class="ident" id="5321614">strings</span><span class="op" id="5321621">.</span><span class="ident" id="5321622">IndexAny</span><span class="op" id="5321630">(</span><span class="ident" id="5321631">s</span><span class="op" id="5321632">,</span>&nbsp;<span class="ident" id="5321634">escapedChars</span><span class="op" id="5321646">)</span>&nbsp;<span class="op" id="5321648">==</span>&nbsp;<span class="op" id="5321651">-</span><span class="num" id="5321652">1</span>&nbsp;<span class="op" id="5321654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321658">return</span>&nbsp;<span class="ident" id="5321665">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321671">var</span>&nbsp;<span class="ident" id="5321675">buf</span>&nbsp;<span class="ident" id="5321679">bytes</span><span class="op" id="5321684">.</span><span class="ident" id="5321685">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321693">escape</span><span class="op" id="5321699">(</span><span class="op" id="5321700">&amp;</span><span class="ident" id="5321701">buf</span><span class="op" id="5321704">,</span>&nbsp;<span class="ident" id="5321706">s</span><span class="op" id="5321707">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321710">return</span>&nbsp;<span class="ident" id="5321717">buf</span><span class="op" id="5321720">.</span><span class="ident" id="5321721">String</span><span class="op" id="5321727">(</span><span class="op" id="5321728">)</span><br>
<span class="lineno"></span><span class="op" id="5321730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5321733">//&nbsp;UnescapeString&nbsp;unescapes&nbsp;entities&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&lt;&#34;.&nbsp;It&nbsp;unescapes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5321812">//&nbsp;larger&nbsp;range&nbsp;of&nbsp;entities&nbsp;than&nbsp;EscapeString&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;&#34;&amp;aacute;&#34;</span><br>
<span class="lineno">240</span><span class="comment" id="5321891">//&nbsp;unescapes&nbsp;to&nbsp;&#34;á&#34;,&nbsp;as&nbsp;does&nbsp;&#34;&amp;#225;&#34;&nbsp;and&nbsp;&#34;&amp;xE1;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5321943">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5322020">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5322036">func</span>&nbsp;<span class="ident" id="5322041">UnescapeString</span><span class="op" id="5322055">(</span><span class="ident" id="5322056">s</span>&nbsp;<span class="builtintype" id="5322058">string</span><span class="op" id="5322064">)</span>&nbsp;<span class="builtintype" id="5322066">string</span>&nbsp;<span class="op" id="5322073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322076">for</span>&nbsp;<span class="ident" id="5322080">_</span><span class="op" id="5322081">,</span>&nbsp;<span class="ident" id="5322083">c</span>&nbsp;<span class="op" id="5322085">:=</span>&nbsp;<span class="keyword" id="5322088">range</span>&nbsp;<span class="ident" id="5322094">s</span>&nbsp;<span class="op" id="5322096">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322100">if</span>&nbsp;<span class="ident" id="5322103">c</span>&nbsp;<span class="op" id="5322105">==</span>&nbsp;<span class="string" id="5322108">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5322112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322117">return</span>&nbsp;<span class="builtintype" id="5322124">string</span><span class="op" id="5322130">(</span><span class="ident" id="5322131">unescape</span><span class="op" id="5322139">(</span><span class="op" id="5322140">[</span><span class="op" id="5322141">]</span><span class="builtintype" id="5322142">byte</span><span class="op" id="5322146">(</span><span class="ident" id="5322147">s</span><span class="op" id="5322148">)</span><span class="op" id="5322149">)</span><span class="op" id="5322150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322160">return</span>&nbsp;<span class="ident" id="5322167">s</span><br>
<span class="lineno">250</span><span class="op" id="5322169">}</span>
</div>
</body>
</html>
