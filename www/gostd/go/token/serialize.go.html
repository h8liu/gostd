<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html" class="current">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2887365">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2887420">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2887474">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2887525">package</span>&nbsp;<span class="ident" id="2887533">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2887540">type</span>&nbsp;<span class="ident" id="2887545">serializedFile</span>&nbsp;<span class="keyword" id="2887560">struct</span>&nbsp;<span class="op" id="2887567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2887570">//&nbsp;fields&nbsp;correspond&nbsp;1:1&nbsp;to&nbsp;fields&nbsp;with&nbsp;same&nbsp;(lower-case)&nbsp;name&nbsp;in&nbsp;File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887642">Name</span>&nbsp;&nbsp;<span class="builtintype" id="2887648">string</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887656">Base</span>&nbsp;&nbsp;<span class="builtintype" id="2887662">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887667">Size</span>&nbsp;&nbsp;<span class="builtintype" id="2887673">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887678">Lines</span>&nbsp;<span class="op" id="2887684">[</span><span class="op" id="2887685">]</span><span class="builtintype" id="2887686">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887691">Infos</span>&nbsp;<span class="op" id="2887697">[</span><span class="op" id="2887698">]</span><span class="ident" id="2887699">lineInfo</span><br>
<span class="lineno"></span><span class="op" id="2887708">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="2887711">type</span>&nbsp;<span class="ident" id="2887716">serializedFileSet</span>&nbsp;<span class="keyword" id="2887734">struct</span>&nbsp;<span class="op" id="2887741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887744">Base</span>&nbsp;&nbsp;<span class="builtintype" id="2887750">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887755">Files</span>&nbsp;<span class="op" id="2887761">[</span><span class="op" id="2887762">]</span><span class="ident" id="2887763">serializedFile</span><br>
<span class="lineno"></span><span class="op" id="2887778">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="2887781">//&nbsp;Read&nbsp;calls&nbsp;decode&nbsp;to&nbsp;deserialize&nbsp;a&nbsp;file&nbsp;set&nbsp;into&nbsp;s;&nbsp;s&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2887855">func</span>&nbsp;<span class="op" id="2887860">(</span><span class="ident" id="2887861">s</span>&nbsp;<span class="op" id="2887863">*</span><span class="ident" id="2887864">FileSet</span><span class="op" id="2887871">)</span>&nbsp;<span class="ident" id="2887873">Read</span><span class="op" id="2887877">(</span><span class="ident" id="2887878">decode</span>&nbsp;<span class="keyword" id="2887885">func</span><span class="op" id="2887889">(</span><span class="keyword" id="2887890">interface</span><span class="op" id="2887899">{</span><span class="op" id="2887900">}</span><span class="op" id="2887901">)</span>&nbsp;<span class="builtintype" id="2887903">error</span><span class="op" id="2887908">)</span>&nbsp;<span class="builtintype" id="2887910">error</span>&nbsp;<span class="op" id="2887916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887919">var</span>&nbsp;<span class="ident" id="2887923">ss</span>&nbsp;<span class="ident" id="2887926">serializedFileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887945">if</span>&nbsp;<span class="ident" id="2887948">err</span>&nbsp;<span class="op" id="2887952">:=</span>&nbsp;<span class="ident" id="2887955">decode</span><span class="op" id="2887961">(</span><span class="op" id="2887962">&amp;</span><span class="ident" id="2887963">ss</span><span class="op" id="2887965">)</span><span class="op" id="2887966">;</span>&nbsp;<span class="ident" id="2887968">err</span>&nbsp;<span class="op" id="2887972">!=</span>&nbsp;<span class="ident" id="2887975">nil</span>&nbsp;<span class="op" id="2887979">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887983">return</span>&nbsp;<span class="ident" id="2887990">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887999">s</span><span class="op" id="2888000">.</span><span class="ident" id="2888001">mutex</span><span class="op" id="2888006">.</span><span class="ident" id="2888007">Lock</span><span class="op" id="2888011">(</span><span class="op" id="2888012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888015">s</span><span class="op" id="2888016">.</span><span class="ident" id="2888017">base</span>&nbsp;<span class="op" id="2888022">=</span>&nbsp;<span class="ident" id="2888024">ss</span><span class="op" id="2888026">.</span><span class="ident" id="2888027">Base</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888033">files</span>&nbsp;<span class="op" id="2888039">:=</span>&nbsp;<span class="builtinfunc" id="2888042">make</span><span class="op" id="2888046">(</span><span class="op" id="2888047">[</span><span class="op" id="2888048">]</span><span class="op" id="2888049">*</span><span class="ident" id="2888050">File</span><span class="op" id="2888054">,</span>&nbsp;<span class="builtinfunc" id="2888056">len</span><span class="op" id="2888059">(</span><span class="ident" id="2888060">ss</span><span class="op" id="2888062">.</span><span class="ident" id="2888063">Files</span><span class="op" id="2888068">)</span><span class="op" id="2888069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888072">for</span>&nbsp;<span class="ident" id="2888076">i</span>&nbsp;<span class="op" id="2888078">:=</span>&nbsp;<span class="num" id="2888081">0</span><span class="op" id="2888082">;</span>&nbsp;<span class="ident" id="2888084">i</span>&nbsp;<span class="op" id="2888086">&lt;</span>&nbsp;<span class="builtinfunc" id="2888088">len</span><span class="op" id="2888091">(</span><span class="ident" id="2888092">ss</span><span class="op" id="2888094">.</span><span class="ident" id="2888095">Files</span><span class="op" id="2888100">)</span><span class="op" id="2888101">;</span>&nbsp;<span class="ident" id="2888103">i</span><span class="op" id="2888104">++</span>&nbsp;<span class="op" id="2888107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888111">f</span>&nbsp;<span class="op" id="2888113">:=</span>&nbsp;<span class="op" id="2888116">&amp;</span><span class="ident" id="2888117">ss</span><span class="op" id="2888119">.</span><span class="ident" id="2888120">Files</span><span class="op" id="2888125">[</span><span class="ident" id="2888126">i</span><span class="op" id="2888127">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888131">files</span><span class="op" id="2888136">[</span><span class="ident" id="2888137">i</span><span class="op" id="2888138">]</span>&nbsp;<span class="op" id="2888140">=</span>&nbsp;<span class="op" id="2888142">&amp;</span><span class="ident" id="2888143">File</span><span class="op" id="2888147">{</span><span class="ident" id="2888148">s</span><span class="op" id="2888149">,</span>&nbsp;<span class="ident" id="2888151">f</span><span class="op" id="2888152">.</span><span class="ident" id="2888153">Name</span><span class="op" id="2888157">,</span>&nbsp;<span class="ident" id="2888159">f</span><span class="op" id="2888160">.</span><span class="ident" id="2888161">Base</span><span class="op" id="2888165">,</span>&nbsp;<span class="ident" id="2888167">f</span><span class="op" id="2888168">.</span><span class="ident" id="2888169">Size</span><span class="op" id="2888173">,</span>&nbsp;<span class="ident" id="2888175">f</span><span class="op" id="2888176">.</span><span class="ident" id="2888177">Lines</span><span class="op" id="2888182">,</span>&nbsp;<span class="ident" id="2888184">f</span><span class="op" id="2888185">.</span><span class="ident" id="2888186">Infos</span><span class="op" id="2888191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888194">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888197">s</span><span class="op" id="2888198">.</span><span class="ident" id="2888199">files</span>&nbsp;<span class="op" id="2888205">=</span>&nbsp;<span class="ident" id="2888207">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888214">s</span><span class="op" id="2888215">.</span><span class="ident" id="2888216">last</span>&nbsp;<span class="op" id="2888221">=</span>&nbsp;<span class="ident" id="2888223">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888228">s</span><span class="op" id="2888229">.</span><span class="ident" id="2888230">mutex</span><span class="op" id="2888235">.</span><span class="ident" id="2888236">Unlock</span><span class="op" id="2888242">(</span><span class="op" id="2888243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888247">return</span>&nbsp;<span class="ident" id="2888254">nil</span><br>
<span class="lineno">40</span><span class="op" id="2888258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2888261">//&nbsp;Write&nbsp;calls&nbsp;encode&nbsp;to&nbsp;serialize&nbsp;the&nbsp;file&nbsp;set&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2888312">func</span>&nbsp;<span class="op" id="2888317">(</span><span class="ident" id="2888318">s</span>&nbsp;<span class="op" id="2888320">*</span><span class="ident" id="2888321">FileSet</span><span class="op" id="2888328">)</span>&nbsp;<span class="ident" id="2888330">Write</span><span class="op" id="2888335">(</span><span class="ident" id="2888336">encode</span>&nbsp;<span class="keyword" id="2888343">func</span><span class="op" id="2888347">(</span><span class="keyword" id="2888348">interface</span><span class="op" id="2888357">{</span><span class="op" id="2888358">}</span><span class="op" id="2888359">)</span>&nbsp;<span class="builtintype" id="2888361">error</span><span class="op" id="2888366">)</span>&nbsp;<span class="builtintype" id="2888368">error</span>&nbsp;<span class="op" id="2888374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888377">var</span>&nbsp;<span class="ident" id="2888381">ss</span>&nbsp;<span class="ident" id="2888384">serializedFileSet</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888404">s</span><span class="op" id="2888405">.</span><span class="ident" id="2888406">mutex</span><span class="op" id="2888411">.</span><span class="ident" id="2888412">Lock</span><span class="op" id="2888416">(</span><span class="op" id="2888417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888420">ss</span><span class="op" id="2888422">.</span><span class="ident" id="2888423">Base</span>&nbsp;<span class="op" id="2888428">=</span>&nbsp;<span class="ident" id="2888430">s</span><span class="op" id="2888431">.</span><span class="ident" id="2888432">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888438">files</span>&nbsp;<span class="op" id="2888444">:=</span>&nbsp;<span class="builtinfunc" id="2888447">make</span><span class="op" id="2888451">(</span><span class="op" id="2888452">[</span><span class="op" id="2888453">]</span><span class="ident" id="2888454">serializedFile</span><span class="op" id="2888468">,</span>&nbsp;<span class="builtinfunc" id="2888470">len</span><span class="op" id="2888473">(</span><span class="ident" id="2888474">s</span><span class="op" id="2888475">.</span><span class="ident" id="2888476">files</span><span class="op" id="2888481">)</span><span class="op" id="2888482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888485">for</span>&nbsp;<span class="ident" id="2888489">i</span><span class="op" id="2888490">,</span>&nbsp;<span class="ident" id="2888492">f</span>&nbsp;<span class="op" id="2888494">:=</span>&nbsp;<span class="keyword" id="2888497">range</span>&nbsp;<span class="ident" id="2888503">s</span><span class="op" id="2888504">.</span><span class="ident" id="2888505">files</span>&nbsp;<span class="op" id="2888511">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888515">files</span><span class="op" id="2888520">[</span><span class="ident" id="2888521">i</span><span class="op" id="2888522">]</span>&nbsp;<span class="op" id="2888524">=</span>&nbsp;<span class="ident" id="2888526">serializedFile</span><span class="op" id="2888540">{</span><span class="ident" id="2888541">f</span><span class="op" id="2888542">.</span><span class="ident" id="2888543">name</span><span class="op" id="2888547">,</span>&nbsp;<span class="ident" id="2888549">f</span><span class="op" id="2888550">.</span><span class="ident" id="2888551">base</span><span class="op" id="2888555">,</span>&nbsp;<span class="ident" id="2888557">f</span><span class="op" id="2888558">.</span><span class="ident" id="2888559">size</span><span class="op" id="2888563">,</span>&nbsp;<span class="ident" id="2888565">f</span><span class="op" id="2888566">.</span><span class="ident" id="2888567">lines</span><span class="op" id="2888572">,</span>&nbsp;<span class="ident" id="2888574">f</span><span class="op" id="2888575">.</span><span class="ident" id="2888576">infos</span><span class="op" id="2888581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888587">ss</span><span class="op" id="2888589">.</span><span class="ident" id="2888590">Files</span>&nbsp;<span class="op" id="2888596">=</span>&nbsp;<span class="ident" id="2888598">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888605">s</span><span class="op" id="2888606">.</span><span class="ident" id="2888607">mutex</span><span class="op" id="2888612">.</span><span class="ident" id="2888613">Unlock</span><span class="op" id="2888619">(</span><span class="op" id="2888620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888624">return</span>&nbsp;<span class="ident" id="2888631">encode</span><span class="op" id="2888637">(</span><span class="ident" id="2888638">ss</span><span class="op" id="2888640">)</span><br>
<span class="lineno"></span><span class="op" id="2888642">}</span>
</div>
</body>
</html>
