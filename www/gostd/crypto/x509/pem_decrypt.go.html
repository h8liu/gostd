<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html" class="current">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4681399">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4681454">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4681508">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4681559">package</span>&nbsp;<span class="ident" id="4681567">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4681573">//&nbsp;RFC&nbsp;1423&nbsp;describes&nbsp;the&nbsp;encryption&nbsp;of&nbsp;PEM&nbsp;blocks.&nbsp;The&nbsp;algorithm&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4681647">//&nbsp;generate&nbsp;a&nbsp;key&nbsp;from&nbsp;the&nbsp;password&nbsp;was&nbsp;derived&nbsp;by&nbsp;looking&nbsp;at&nbsp;the&nbsp;OpenSSL</span><br>
<span class="lineno"></span><span class="comment" id="4681721">//&nbsp;implementation.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4681741">import</span>&nbsp;<span class="op" id="4681748">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4681751">&#34;crypto/aes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4681765">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4681782">&#34;crypto/des&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4681796">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4681810">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4681826">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4681842">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4681852">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4681858">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4681868">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4681871">type</span>&nbsp;<span class="ident" id="4681876">PEMCipher</span>&nbsp;<span class="builtintype" id="4681886">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4681891">//&nbsp;Possible&nbsp;values&nbsp;for&nbsp;the&nbsp;EncryptPEMBlock&nbsp;encryption&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="4681956">const</span>&nbsp;<span class="op" id="4681962">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681965">_</span>&nbsp;<span class="ident" id="4681967">PEMCipher</span>&nbsp;<span class="op" id="4681977">=</span>&nbsp;<span class="ident" id="4681979">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681985">PEMCipherDES</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681999">PEMCipher3DES</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682014">PEMCipherAES128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682031">PEMCipherAES192</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682048">PEMCipherAES256</span><br>
<span class="lineno"></span><span class="op" id="4682064">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4682067">//&nbsp;rfc1423Algo&nbsp;holds&nbsp;a&nbsp;method&nbsp;for&nbsp;enciphering&nbsp;a&nbsp;PEM&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="4682126">type</span>&nbsp;<span class="ident" id="4682131">rfc1423Algo</span>&nbsp;<span class="keyword" id="4682143">struct</span>&nbsp;<span class="op" id="4682150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682153">cipher</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682164">PEMCipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682175">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4682186">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682194">cipherFunc</span>&nbsp;<span class="keyword" id="4682205">func</span><span class="op" id="4682209">(</span><span class="ident" id="4682210">key</span>&nbsp;<span class="op" id="4682214">[</span><span class="op" id="4682215">]</span><span class="builtintype" id="4682216">byte</span><span class="op" id="4682220">)</span>&nbsp;<span class="op" id="4682222">(</span><span class="ident" id="4682223">cipher</span><span class="op" id="4682229">.</span><span class="ident" id="4682230">Block</span><span class="op" id="4682235">,</span>&nbsp;<span class="builtintype" id="4682237">error</span><span class="op" id="4682242">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682245">keySize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4682256">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682261">blockSize</span>&nbsp;&nbsp;<span class="builtintype" id="4682272">int</span><br>
<span class="lineno"></span><span class="op" id="4682276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4682279">//&nbsp;rfc1423Algos&nbsp;holds&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;possible&nbsp;ways&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;PEM</span><br>
<span class="lineno">45</span><span class="comment" id="4682347">//&nbsp;block.&nbsp;&nbsp;The&nbsp;ivSize&nbsp;numbers&nbsp;were&nbsp;taken&nbsp;from&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4682413">var</span>&nbsp;<span class="ident" id="4682417">rfc1423Algos</span>&nbsp;<span class="op" id="4682430">=</span>&nbsp;<span class="op" id="4682432">[</span><span class="op" id="4682433">]</span><span class="ident" id="4682434">rfc1423Algo</span><span class="op" id="4682445">{</span><span class="op" id="4682446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682449">cipher</span><span class="op" id="4682455">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682461">PEMCipherDES</span><span class="op" id="4682473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682476">name</span><span class="op" id="4682480">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4682488">&#34;DES-CBC&#34;</span><span class="op" id="4682497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682500">cipherFunc</span><span class="op" id="4682510">:</span>&nbsp;<span class="ident" id="4682512">des</span><span class="op" id="4682515">.</span><span class="ident" id="4682516">NewCipher</span><span class="op" id="4682525">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682528">keySize</span><span class="op" id="4682535">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4682540">8</span><span class="op" id="4682541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682544">blockSize</span><span class="op" id="4682553">:</span>&nbsp;&nbsp;<span class="ident" id="4682556">des</span><span class="op" id="4682559">.</span><span class="ident" id="4682560">BlockSize</span><span class="op" id="4682569">,</span><br>
<span class="lineno"></span><span class="op" id="4682571">}</span><span class="op" id="4682572">,</span>&nbsp;<span class="op" id="4682574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682577">cipher</span><span class="op" id="4682583">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682589">PEMCipher3DES</span><span class="op" id="4682602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682605">name</span><span class="op" id="4682609">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4682617">&#34;DES-EDE3-CBC&#34;</span><span class="op" id="4682631">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682634">cipherFunc</span><span class="op" id="4682644">:</span>&nbsp;<span class="ident" id="4682646">des</span><span class="op" id="4682649">.</span><span class="ident" id="4682650">NewTripleDESCipher</span><span class="op" id="4682668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682671">keySize</span><span class="op" id="4682678">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4682683">24</span><span class="op" id="4682685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682688">blockSize</span><span class="op" id="4682697">:</span>&nbsp;&nbsp;<span class="ident" id="4682700">des</span><span class="op" id="4682703">.</span><span class="ident" id="4682704">BlockSize</span><span class="op" id="4682713">,</span><br>
<span class="lineno"></span><span class="op" id="4682715">}</span><span class="op" id="4682716">,</span>&nbsp;<span class="op" id="4682718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682721">cipher</span><span class="op" id="4682727">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682733">PEMCipherAES128</span><span class="op" id="4682748">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682751">name</span><span class="op" id="4682755">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4682763">&#34;AES-128-CBC&#34;</span><span class="op" id="4682776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682779">cipherFunc</span><span class="op" id="4682789">:</span>&nbsp;<span class="ident" id="4682791">aes</span><span class="op" id="4682794">.</span><span class="ident" id="4682795">NewCipher</span><span class="op" id="4682804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682807">keySize</span><span class="op" id="4682814">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4682819">16</span><span class="op" id="4682821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682824">blockSize</span><span class="op" id="4682833">:</span>&nbsp;&nbsp;<span class="ident" id="4682836">aes</span><span class="op" id="4682839">.</span><span class="ident" id="4682840">BlockSize</span><span class="op" id="4682849">,</span><br>
<span class="lineno"></span><span class="op" id="4682851">}</span><span class="op" id="4682852">,</span>&nbsp;<span class="op" id="4682854">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682857">cipher</span><span class="op" id="4682863">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4682869">PEMCipherAES192</span><span class="op" id="4682884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682887">name</span><span class="op" id="4682891">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4682899">&#34;AES-192-CBC&#34;</span><span class="op" id="4682912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682915">cipherFunc</span><span class="op" id="4682925">:</span>&nbsp;<span class="ident" id="4682927">aes</span><span class="op" id="4682930">.</span><span class="ident" id="4682931">NewCipher</span><span class="op" id="4682940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682943">keySize</span><span class="op" id="4682950">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4682955">24</span><span class="op" id="4682957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682960">blockSize</span><span class="op" id="4682969">:</span>&nbsp;&nbsp;<span class="ident" id="4682972">aes</span><span class="op" id="4682975">.</span><span class="ident" id="4682976">BlockSize</span><span class="op" id="4682985">,</span><br>
<span class="lineno">70</span><span class="op" id="4682987">}</span><span class="op" id="4682988">,</span>&nbsp;<span class="op" id="4682990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682993">cipher</span><span class="op" id="4682999">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4683005">PEMCipherAES256</span><span class="op" id="4683020">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683023">name</span><span class="op" id="4683027">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4683035">&#34;AES-256-CBC&#34;</span><span class="op" id="4683048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683051">cipherFunc</span><span class="op" id="4683061">:</span>&nbsp;<span class="ident" id="4683063">aes</span><span class="op" id="4683066">.</span><span class="ident" id="4683067">NewCipher</span><span class="op" id="4683076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683079">keySize</span><span class="op" id="4683086">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4683091">32</span><span class="op" id="4683093">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683096">blockSize</span><span class="op" id="4683105">:</span>&nbsp;&nbsp;<span class="ident" id="4683108">aes</span><span class="op" id="4683111">.</span><span class="ident" id="4683112">BlockSize</span><span class="op" id="4683121">,</span><br>
<span class="lineno"></span><span class="op" id="4683123">}</span><span class="op" id="4683124">,</span><br>
<span class="lineno"></span><span class="op" id="4683126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4683129">//&nbsp;deriveKey&nbsp;uses&nbsp;a&nbsp;key&nbsp;derivation&nbsp;function&nbsp;to&nbsp;stretch&nbsp;the&nbsp;password&nbsp;into&nbsp;a&nbsp;key</span><br>
<span class="lineno">80</span><span class="comment" id="4683208">//&nbsp;with&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;our&nbsp;cipher&nbsp;requires.&nbsp;This&nbsp;algorithm&nbsp;was&nbsp;derived&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4683288">//&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4683311">func</span>&nbsp;<span class="op" id="4683316">(</span><span class="ident" id="4683317">c</span>&nbsp;<span class="ident" id="4683319">rfc1423Algo</span><span class="op" id="4683330">)</span>&nbsp;<span class="ident" id="4683332">deriveKey</span><span class="op" id="4683341">(</span><span class="ident" id="4683342">password</span><span class="op" id="4683350">,</span>&nbsp;<span class="ident" id="4683352">salt</span>&nbsp;<span class="op" id="4683357">[</span><span class="op" id="4683358">]</span><span class="builtintype" id="4683359">byte</span><span class="op" id="4683363">)</span>&nbsp;<span class="op" id="4683365">[</span><span class="op" id="4683366">]</span><span class="builtintype" id="4683367">byte</span>&nbsp;<span class="op" id="4683372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683375">hash</span>&nbsp;<span class="op" id="4683380">:=</span>&nbsp;<span class="ident" id="4683383">md5</span><span class="op" id="4683386">.</span><span class="ident" id="4683387">New</span><span class="op" id="4683390">(</span><span class="op" id="4683391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683394">out</span>&nbsp;<span class="op" id="4683398">:=</span>&nbsp;<span class="builtinfunc" id="4683401">make</span><span class="op" id="4683405">(</span><span class="op" id="4683406">[</span><span class="op" id="4683407">]</span><span class="builtintype" id="4683408">byte</span><span class="op" id="4683412">,</span>&nbsp;<span class="ident" id="4683414">c</span><span class="op" id="4683415">.</span><span class="ident" id="4683416">keySize</span><span class="op" id="4683423">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683426">var</span>&nbsp;<span class="ident" id="4683430">digest</span>&nbsp;<span class="op" id="4683437">[</span><span class="op" id="4683438">]</span><span class="builtintype" id="4683439">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683446">for</span>&nbsp;<span class="ident" id="4683450">i</span>&nbsp;<span class="op" id="4683452">:=</span>&nbsp;<span class="num" id="4683455">0</span><span class="op" id="4683456">;</span>&nbsp;<span class="ident" id="4683458">i</span>&nbsp;<span class="op" id="4683460">&lt;</span>&nbsp;<span class="builtinfunc" id="4683462">len</span><span class="op" id="4683465">(</span><span class="ident" id="4683466">out</span><span class="op" id="4683469">)</span><span class="op" id="4683470">;</span>&nbsp;<span class="ident" id="4683472">i</span>&nbsp;<span class="op" id="4683474">+=</span>&nbsp;<span class="builtinfunc" id="4683477">len</span><span class="op" id="4683480">(</span><span class="ident" id="4683481">digest</span><span class="op" id="4683487">)</span>&nbsp;<span class="op" id="4683489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683493">hash</span><span class="op" id="4683497">.</span><span class="ident" id="4683498">Reset</span><span class="op" id="4683503">(</span><span class="op" id="4683504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683508">hash</span><span class="op" id="4683512">.</span><span class="ident" id="4683513">Write</span><span class="op" id="4683518">(</span><span class="ident" id="4683519">digest</span><span class="op" id="4683525">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683529">hash</span><span class="op" id="4683533">.</span><span class="ident" id="4683534">Write</span><span class="op" id="4683539">(</span><span class="ident" id="4683540">password</span><span class="op" id="4683548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683552">hash</span><span class="op" id="4683556">.</span><span class="ident" id="4683557">Write</span><span class="op" id="4683562">(</span><span class="ident" id="4683563">salt</span><span class="op" id="4683567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683571">digest</span>&nbsp;<span class="op" id="4683578">=</span>&nbsp;<span class="ident" id="4683580">hash</span><span class="op" id="4683584">.</span><span class="ident" id="4683585">Sum</span><span class="op" id="4683588">(</span><span class="ident" id="4683589">digest</span><span class="op" id="4683595">[</span><span class="op" id="4683596">:</span><span class="num" id="4683597">0</span><span class="op" id="4683598">]</span><span class="op" id="4683599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4683603">copy</span><span class="op" id="4683607">(</span><span class="ident" id="4683608">out</span><span class="op" id="4683611">[</span><span class="ident" id="4683612">i</span><span class="op" id="4683613">:</span><span class="op" id="4683614">]</span><span class="op" id="4683615">,</span>&nbsp;<span class="ident" id="4683617">digest</span><span class="op" id="4683623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4683626">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683629">return</span>&nbsp;<span class="ident" id="4683636">out</span><br>
<span class="lineno"></span><span class="op" id="4683640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4683643">//&nbsp;IsEncryptedPEMBlock&nbsp;returns&nbsp;if&nbsp;the&nbsp;PEM&nbsp;block&nbsp;is&nbsp;password&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="4683714">func</span>&nbsp;<span class="ident" id="4683719">IsEncryptedPEMBlock</span><span class="op" id="4683738">(</span><span class="ident" id="4683739">b</span>&nbsp;<span class="op" id="4683741">*</span><span class="ident" id="4683742">pem</span><span class="op" id="4683745">.</span><span class="ident" id="4683746">Block</span><span class="op" id="4683751">)</span>&nbsp;<span class="builtintype" id="4683753">bool</span>&nbsp;<span class="op" id="4683758">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683761">_</span><span class="op" id="4683762">,</span>&nbsp;<span class="ident" id="4683764">ok</span>&nbsp;<span class="op" id="4683767">:=</span>&nbsp;<span class="ident" id="4683770">b</span><span class="op" id="4683771">.</span><span class="ident" id="4683772">Headers</span><span class="op" id="4683779">[</span><span class="string" id="4683780">&#34;DEK-Info&#34;</span><span class="op" id="4683790">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683793">return</span>&nbsp;<span class="ident" id="4683800">ok</span><br>
<span class="lineno"></span><span class="op" id="4683803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4683806">//&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned&nbsp;when&nbsp;an&nbsp;incorrect&nbsp;password&nbsp;is&nbsp;detected.</span><br>
<span class="lineno">105</span><span class="keyword" id="4683884">var</span>&nbsp;<span class="ident" id="4683888">IncorrectPasswordError</span>&nbsp;<span class="op" id="4683911">=</span>&nbsp;<span class="ident" id="4683913">errors</span><span class="op" id="4683919">.</span><span class="ident" id="4683920">New</span><span class="op" id="4683923">(</span><span class="string" id="4683924">&#34;x509:&nbsp;decryption&nbsp;password&nbsp;incorrect&#34;</span><span class="op" id="4683961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4683964">//&nbsp;DecryptPEMBlock&nbsp;takes&nbsp;a&nbsp;password&nbsp;encrypted&nbsp;PEM&nbsp;block&nbsp;and&nbsp;the&nbsp;password&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4684045">//&nbsp;encrypt&nbsp;it&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;decrypted&nbsp;DER&nbsp;encoded&nbsp;bytes.&nbsp;It&nbsp;inspects</span><br>
<span class="lineno"></span><span class="comment" id="4684123">//&nbsp;the&nbsp;DEK-Info&nbsp;header&nbsp;to&nbsp;determine&nbsp;the&nbsp;algorithm&nbsp;used&nbsp;for&nbsp;decryption.&nbsp;If&nbsp;no</span><br>
<span class="lineno">110</span><span class="comment" id="4684200">//&nbsp;DEK-Info&nbsp;header&nbsp;is&nbsp;present,&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;If&nbsp;an&nbsp;incorrect&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="4684278">//&nbsp;is&nbsp;detected&nbsp;an&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="4684332">func</span>&nbsp;<span class="ident" id="4684337">DecryptPEMBlock</span><span class="op" id="4684352">(</span><span class="ident" id="4684353">b</span>&nbsp;<span class="op" id="4684355">*</span><span class="ident" id="4684356">pem</span><span class="op" id="4684359">.</span><span class="ident" id="4684360">Block</span><span class="op" id="4684365">,</span>&nbsp;<span class="ident" id="4684367">password</span>&nbsp;<span class="op" id="4684376">[</span><span class="op" id="4684377">]</span><span class="builtintype" id="4684378">byte</span><span class="op" id="4684382">)</span>&nbsp;<span class="op" id="4684384">(</span><span class="op" id="4684385">[</span><span class="op" id="4684386">]</span><span class="builtintype" id="4684387">byte</span><span class="op" id="4684391">,</span>&nbsp;<span class="builtintype" id="4684393">error</span><span class="op" id="4684398">)</span>&nbsp;<span class="op" id="4684400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684403">dek</span><span class="op" id="4684406">,</span>&nbsp;<span class="ident" id="4684408">ok</span>&nbsp;<span class="op" id="4684411">:=</span>&nbsp;<span class="ident" id="4684414">b</span><span class="op" id="4684415">.</span><span class="ident" id="4684416">Headers</span><span class="op" id="4684423">[</span><span class="string" id="4684424">&#34;DEK-Info&#34;</span><span class="op" id="4684434">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684437">if</span>&nbsp;<span class="op" id="4684440">!</span><span class="ident" id="4684441">ok</span>&nbsp;<span class="op" id="4684444">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684448">return</span>&nbsp;<span class="ident" id="4684455">nil</span><span class="op" id="4684458">,</span>&nbsp;<span class="ident" id="4684460">errors</span><span class="op" id="4684466">.</span><span class="ident" id="4684467">New</span><span class="op" id="4684470">(</span><span class="string" id="4684471">&#34;x509:&nbsp;no&nbsp;DEK-Info&nbsp;header&nbsp;in&nbsp;block&#34;</span><span class="op" id="4684506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684513">idx</span>&nbsp;<span class="op" id="4684517">:=</span>&nbsp;<span class="ident" id="4684520">strings</span><span class="op" id="4684527">.</span><span class="ident" id="4684528">Index</span><span class="op" id="4684533">(</span><span class="ident" id="4684534">dek</span><span class="op" id="4684537">,</span>&nbsp;<span class="string" id="4684539">&#34;,&#34;</span><span class="op" id="4684542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684545">if</span>&nbsp;<span class="ident" id="4684548">idx</span>&nbsp;<span class="op" id="4684552">==</span>&nbsp;<span class="op" id="4684555">-</span><span class="num" id="4684556">1</span>&nbsp;<span class="op" id="4684558">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684562">return</span>&nbsp;<span class="ident" id="4684569">nil</span><span class="op" id="4684572">,</span>&nbsp;<span class="ident" id="4684574">errors</span><span class="op" id="4684580">.</span><span class="ident" id="4684581">New</span><span class="op" id="4684584">(</span><span class="string" id="4684585">&#34;x509:&nbsp;malformed&nbsp;DEK-Info&nbsp;header&#34;</span><span class="op" id="4684618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684625">mode</span><span class="op" id="4684629">,</span>&nbsp;<span class="ident" id="4684631">hexIV</span>&nbsp;<span class="op" id="4684637">:=</span>&nbsp;<span class="ident" id="4684640">dek</span><span class="op" id="4684643">[</span><span class="op" id="4684644">:</span><span class="ident" id="4684645">idx</span><span class="op" id="4684648">]</span><span class="op" id="4684649">,</span>&nbsp;<span class="ident" id="4684651">dek</span><span class="op" id="4684654">[</span><span class="ident" id="4684655">idx</span><span class="op" id="4684658">+</span><span class="num" id="4684659">1</span><span class="op" id="4684660">:</span><span class="op" id="4684661">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684664">ciph</span>&nbsp;<span class="op" id="4684669">:=</span>&nbsp;<span class="ident" id="4684672">cipherByName</span><span class="op" id="4684684">(</span><span class="ident" id="4684685">mode</span><span class="op" id="4684689">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684692">if</span>&nbsp;<span class="ident" id="4684695">ciph</span>&nbsp;<span class="op" id="4684700">==</span>&nbsp;<span class="ident" id="4684703">nil</span>&nbsp;<span class="op" id="4684707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684711">return</span>&nbsp;<span class="ident" id="4684718">nil</span><span class="op" id="4684721">,</span>&nbsp;<span class="ident" id="4684723">errors</span><span class="op" id="4684729">.</span><span class="ident" id="4684730">New</span><span class="op" id="4684733">(</span><span class="string" id="4684734">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4684765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684771">iv</span><span class="op" id="4684773">,</span>&nbsp;<span class="ident" id="4684775">err</span>&nbsp;<span class="op" id="4684779">:=</span>&nbsp;<span class="ident" id="4684782">hex</span><span class="op" id="4684785">.</span><span class="ident" id="4684786">DecodeString</span><span class="op" id="4684798">(</span><span class="ident" id="4684799">hexIV</span><span class="op" id="4684804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684807">if</span>&nbsp;<span class="ident" id="4684810">err</span>&nbsp;<span class="op" id="4684814">!=</span>&nbsp;<span class="ident" id="4684817">nil</span>&nbsp;<span class="op" id="4684821">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684825">return</span>&nbsp;<span class="ident" id="4684832">nil</span><span class="op" id="4684835">,</span>&nbsp;<span class="ident" id="4684837">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684845">if</span>&nbsp;<span class="builtinfunc" id="4684848">len</span><span class="op" id="4684851">(</span><span class="ident" id="4684852">iv</span><span class="op" id="4684854">)</span>&nbsp;<span class="op" id="4684856">!=</span>&nbsp;<span class="ident" id="4684859">ciph</span><span class="op" id="4684863">.</span><span class="ident" id="4684864">blockSize</span>&nbsp;<span class="op" id="4684874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684878">return</span>&nbsp;<span class="ident" id="4684885">nil</span><span class="op" id="4684888">,</span>&nbsp;<span class="ident" id="4684890">errors</span><span class="op" id="4684896">.</span><span class="ident" id="4684897">New</span><span class="op" id="4684900">(</span><span class="string" id="4684901">&#34;x509:&nbsp;incorrect&nbsp;IV&nbsp;size&#34;</span><span class="op" id="4684926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684929">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4684933">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;OpenSSL&nbsp;implementation.&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4685004">//&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685038">key</span>&nbsp;<span class="op" id="4685042">:=</span>&nbsp;<span class="ident" id="4685045">ciph</span><span class="op" id="4685049">.</span><span class="ident" id="4685050">deriveKey</span><span class="op" id="4685059">(</span><span class="ident" id="4685060">password</span><span class="op" id="4685068">,</span>&nbsp;<span class="ident" id="4685070">iv</span><span class="op" id="4685072">[</span><span class="op" id="4685073">:</span><span class="num" id="4685074">8</span><span class="op" id="4685075">]</span><span class="op" id="4685076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685079">block</span><span class="op" id="4685084">,</span>&nbsp;<span class="ident" id="4685086">err</span>&nbsp;<span class="op" id="4685090">:=</span>&nbsp;<span class="ident" id="4685093">ciph</span><span class="op" id="4685097">.</span><span class="ident" id="4685098">cipherFunc</span><span class="op" id="4685108">(</span><span class="ident" id="4685109">key</span><span class="op" id="4685112">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685115">if</span>&nbsp;<span class="ident" id="4685118">err</span>&nbsp;<span class="op" id="4685122">!=</span>&nbsp;<span class="ident" id="4685125">nil</span>&nbsp;<span class="op" id="4685129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685133">return</span>&nbsp;<span class="ident" id="4685140">nil</span><span class="op" id="4685143">,</span>&nbsp;<span class="ident" id="4685145">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685154">data</span>&nbsp;<span class="op" id="4685159">:=</span>&nbsp;<span class="builtinfunc" id="4685162">make</span><span class="op" id="4685166">(</span><span class="op" id="4685167">[</span><span class="op" id="4685168">]</span><span class="builtintype" id="4685169">byte</span><span class="op" id="4685173">,</span>&nbsp;<span class="builtinfunc" id="4685175">len</span><span class="op" id="4685178">(</span><span class="ident" id="4685179">b</span><span class="op" id="4685180">.</span><span class="ident" id="4685181">Bytes</span><span class="op" id="4685186">)</span><span class="op" id="4685187">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685190">dec</span>&nbsp;<span class="op" id="4685194">:=</span>&nbsp;<span class="ident" id="4685197">cipher</span><span class="op" id="4685203">.</span><span class="ident" id="4685204">NewCBCDecrypter</span><span class="op" id="4685219">(</span><span class="ident" id="4685220">block</span><span class="op" id="4685225">,</span>&nbsp;<span class="ident" id="4685227">iv</span><span class="op" id="4685229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685232">dec</span><span class="op" id="4685235">.</span><span class="ident" id="4685236">CryptBlocks</span><span class="op" id="4685247">(</span><span class="ident" id="4685248">data</span><span class="op" id="4685252">,</span>&nbsp;<span class="ident" id="4685254">b</span><span class="op" id="4685255">.</span><span class="ident" id="4685256">Bytes</span><span class="op" id="4685261">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4685265">//&nbsp;Blocks&nbsp;are&nbsp;padded&nbsp;using&nbsp;a&nbsp;scheme&nbsp;where&nbsp;the&nbsp;last&nbsp;n&nbsp;bytes&nbsp;of&nbsp;padding&nbsp;are&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4685344">//&nbsp;equal&nbsp;to&nbsp;n.&nbsp;It&nbsp;can&nbsp;pad&nbsp;from&nbsp;1&nbsp;to&nbsp;blocksize&nbsp;bytes&nbsp;inclusive.&nbsp;See&nbsp;RFC&nbsp;1423.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4685422">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4685439">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;z&nbsp;2&nbsp;2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4685455">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4685479">//&nbsp;If&nbsp;we&nbsp;detect&nbsp;a&nbsp;bad&nbsp;padding,&nbsp;we&nbsp;assume&nbsp;it&nbsp;is&nbsp;an&nbsp;invalid&nbsp;password.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685548">dlen</span>&nbsp;<span class="op" id="4685553">:=</span>&nbsp;<span class="builtinfunc" id="4685556">len</span><span class="op" id="4685559">(</span><span class="ident" id="4685560">data</span><span class="op" id="4685564">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685567">if</span>&nbsp;<span class="ident" id="4685570">dlen</span>&nbsp;<span class="op" id="4685575">==</span>&nbsp;<span class="num" id="4685578">0</span>&nbsp;<span class="op" id="4685580">||</span>&nbsp;<span class="ident" id="4685583">dlen</span><span class="op" id="4685587">%</span><span class="ident" id="4685588">ciph</span><span class="op" id="4685592">.</span><span class="ident" id="4685593">blockSize</span>&nbsp;<span class="op" id="4685603">!=</span>&nbsp;<span class="num" id="4685606">0</span>&nbsp;<span class="op" id="4685608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685612">return</span>&nbsp;<span class="ident" id="4685619">nil</span><span class="op" id="4685622">,</span>&nbsp;<span class="ident" id="4685624">errors</span><span class="op" id="4685630">.</span><span class="ident" id="4685631">New</span><span class="op" id="4685634">(</span><span class="string" id="4685635">&#34;x509:&nbsp;invalid&nbsp;padding&#34;</span><span class="op" id="4685658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685664">last</span>&nbsp;<span class="op" id="4685669">:=</span>&nbsp;<span class="builtintype" id="4685672">int</span><span class="op" id="4685675">(</span><span class="ident" id="4685676">data</span><span class="op" id="4685680">[</span><span class="ident" id="4685681">dlen</span><span class="op" id="4685685">-</span><span class="num" id="4685686">1</span><span class="op" id="4685687">]</span><span class="op" id="4685688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685691">if</span>&nbsp;<span class="ident" id="4685694">dlen</span>&nbsp;<span class="op" id="4685699">&lt;</span>&nbsp;<span class="ident" id="4685701">last</span>&nbsp;<span class="op" id="4685706">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685710">return</span>&nbsp;<span class="ident" id="4685717">nil</span><span class="op" id="4685720">,</span>&nbsp;<span class="ident" id="4685722">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685749">if</span>&nbsp;<span class="ident" id="4685752">last</span>&nbsp;<span class="op" id="4685757">==</span>&nbsp;<span class="num" id="4685760">0</span>&nbsp;<span class="op" id="4685762">||</span>&nbsp;<span class="ident" id="4685765">last</span>&nbsp;<span class="op" id="4685770">&gt;</span>&nbsp;<span class="ident" id="4685772">ciph</span><span class="op" id="4685776">.</span><span class="ident" id="4685777">blockSize</span>&nbsp;<span class="op" id="4685787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685791">return</span>&nbsp;<span class="ident" id="4685798">nil</span><span class="op" id="4685801">,</span>&nbsp;<span class="ident" id="4685803">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685827">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685830">for</span>&nbsp;<span class="ident" id="4685834">_</span><span class="op" id="4685835">,</span>&nbsp;<span class="ident" id="4685837">val</span>&nbsp;<span class="op" id="4685841">:=</span>&nbsp;<span class="keyword" id="4685844">range</span>&nbsp;<span class="ident" id="4685850">data</span><span class="op" id="4685854">[</span><span class="ident" id="4685855">dlen</span><span class="op" id="4685859">-</span><span class="ident" id="4685860">last</span><span class="op" id="4685864">:</span><span class="op" id="4685865">]</span>&nbsp;<span class="op" id="4685867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685871">if</span>&nbsp;<span class="builtintype" id="4685874">int</span><span class="op" id="4685877">(</span><span class="ident" id="4685878">val</span><span class="op" id="4685881">)</span>&nbsp;<span class="op" id="4685883">!=</span>&nbsp;<span class="ident" id="4685886">last</span>&nbsp;<span class="op" id="4685891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685896">return</span>&nbsp;<span class="ident" id="4685903">nil</span><span class="op" id="4685906">,</span>&nbsp;<span class="ident" id="4685908">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685936">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685939">return</span>&nbsp;<span class="ident" id="4685946">data</span><span class="op" id="4685950">[</span><span class="op" id="4685951">:</span><span class="ident" id="4685952">dlen</span><span class="op" id="4685956">-</span><span class="ident" id="4685957">last</span><span class="op" id="4685961">]</span><span class="op" id="4685962">,</span>&nbsp;<span class="ident" id="4685964">nil</span><br>
<span class="lineno"></span><span class="op" id="4685968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4685971">//&nbsp;EncryptPEMBlock&nbsp;returns&nbsp;a&nbsp;PEM&nbsp;block&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;holding&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4686044">//&nbsp;given&nbsp;DER-encoded&nbsp;data&nbsp;encrypted&nbsp;with&nbsp;the&nbsp;specified&nbsp;algorithm&nbsp;and</span><br>
<span class="lineno">175</span><span class="comment" id="4686113">//&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="4686126">func</span>&nbsp;<span class="ident" id="4686131">EncryptPEMBlock</span><span class="op" id="4686146">(</span><span class="ident" id="4686147">rand</span>&nbsp;<span class="ident" id="4686152">io</span><span class="op" id="4686154">.</span><span class="ident" id="4686155">Reader</span><span class="op" id="4686161">,</span>&nbsp;<span class="ident" id="4686163">blockType</span>&nbsp;<span class="builtintype" id="4686173">string</span><span class="op" id="4686179">,</span>&nbsp;<span class="ident" id="4686181">data</span><span class="op" id="4686185">,</span>&nbsp;<span class="ident" id="4686187">password</span>&nbsp;<span class="op" id="4686196">[</span><span class="op" id="4686197">]</span><span class="builtintype" id="4686198">byte</span><span class="op" id="4686202">,</span>&nbsp;<span class="ident" id="4686204">alg</span>&nbsp;<span class="ident" id="4686208">PEMCipher</span><span class="op" id="4686217">)</span>&nbsp;<span class="op" id="4686219">(</span><span class="op" id="4686220">*</span><span class="ident" id="4686221">pem</span><span class="op" id="4686224">.</span><span class="ident" id="4686225">Block</span><span class="op" id="4686230">,</span>&nbsp;<span class="builtintype" id="4686232">error</span><span class="op" id="4686237">)</span>&nbsp;<span class="op" id="4686239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686242">ciph</span>&nbsp;<span class="op" id="4686247">:=</span>&nbsp;<span class="ident" id="4686250">cipherByKey</span><span class="op" id="4686261">(</span><span class="ident" id="4686262">alg</span><span class="op" id="4686265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686268">if</span>&nbsp;<span class="ident" id="4686271">ciph</span>&nbsp;<span class="op" id="4686276">==</span>&nbsp;<span class="ident" id="4686279">nil</span>&nbsp;<span class="op" id="4686283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686287">return</span>&nbsp;<span class="ident" id="4686294">nil</span><span class="op" id="4686297">,</span>&nbsp;<span class="ident" id="4686299">errors</span><span class="op" id="4686305">.</span><span class="ident" id="4686306">New</span><span class="op" id="4686309">(</span><span class="string" id="4686310">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4686341">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686347">iv</span>&nbsp;<span class="op" id="4686350">:=</span>&nbsp;<span class="builtinfunc" id="4686353">make</span><span class="op" id="4686357">(</span><span class="op" id="4686358">[</span><span class="op" id="4686359">]</span><span class="builtintype" id="4686360">byte</span><span class="op" id="4686364">,</span>&nbsp;<span class="ident" id="4686366">ciph</span><span class="op" id="4686370">.</span><span class="ident" id="4686371">blockSize</span><span class="op" id="4686380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686383">if</span>&nbsp;<span class="ident" id="4686386">_</span><span class="op" id="4686387">,</span>&nbsp;<span class="ident" id="4686389">err</span>&nbsp;<span class="op" id="4686393">:=</span>&nbsp;<span class="ident" id="4686396">io</span><span class="op" id="4686398">.</span><span class="ident" id="4686399">ReadFull</span><span class="op" id="4686407">(</span><span class="ident" id="4686408">rand</span><span class="op" id="4686412">,</span>&nbsp;<span class="ident" id="4686414">iv</span><span class="op" id="4686416">)</span><span class="op" id="4686417">;</span>&nbsp;<span class="ident" id="4686419">err</span>&nbsp;<span class="op" id="4686423">!=</span>&nbsp;<span class="ident" id="4686426">nil</span>&nbsp;<span class="op" id="4686430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686434">return</span>&nbsp;<span class="ident" id="4686441">nil</span><span class="op" id="4686444">,</span>&nbsp;<span class="ident" id="4686446">errors</span><span class="op" id="4686452">.</span><span class="ident" id="4686453">New</span><span class="op" id="4686456">(</span><span class="string" id="4686457">&#34;x509:&nbsp;cannot&nbsp;generate&nbsp;IV:&nbsp;&#34;</span>&nbsp;<span class="op" id="4686486">+</span>&nbsp;<span class="ident" id="4686488">err</span><span class="op" id="4686491">.</span><span class="ident" id="4686492">Error</span><span class="op" id="4686497">(</span><span class="op" id="4686498">)</span><span class="op" id="4686499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686502">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4686505">//&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4686569">//&nbsp;matching&nbsp;the&nbsp;key&nbsp;derivation&nbsp;in&nbsp;DecryptPEMBlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686621">key</span>&nbsp;<span class="op" id="4686625">:=</span>&nbsp;<span class="ident" id="4686628">ciph</span><span class="op" id="4686632">.</span><span class="ident" id="4686633">deriveKey</span><span class="op" id="4686642">(</span><span class="ident" id="4686643">password</span><span class="op" id="4686651">,</span>&nbsp;<span class="ident" id="4686653">iv</span><span class="op" id="4686655">[</span><span class="op" id="4686656">:</span><span class="num" id="4686657">8</span><span class="op" id="4686658">]</span><span class="op" id="4686659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686662">block</span><span class="op" id="4686667">,</span>&nbsp;<span class="ident" id="4686669">err</span>&nbsp;<span class="op" id="4686673">:=</span>&nbsp;<span class="ident" id="4686676">ciph</span><span class="op" id="4686680">.</span><span class="ident" id="4686681">cipherFunc</span><span class="op" id="4686691">(</span><span class="ident" id="4686692">key</span><span class="op" id="4686695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686698">if</span>&nbsp;<span class="ident" id="4686701">err</span>&nbsp;<span class="op" id="4686705">!=</span>&nbsp;<span class="ident" id="4686708">nil</span>&nbsp;<span class="op" id="4686712">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686716">return</span>&nbsp;<span class="ident" id="4686723">nil</span><span class="op" id="4686726">,</span>&nbsp;<span class="ident" id="4686728">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686736">enc</span>&nbsp;<span class="op" id="4686740">:=</span>&nbsp;<span class="ident" id="4686743">cipher</span><span class="op" id="4686749">.</span><span class="ident" id="4686750">NewCBCEncrypter</span><span class="op" id="4686765">(</span><span class="ident" id="4686766">block</span><span class="op" id="4686771">,</span>&nbsp;<span class="ident" id="4686773">iv</span><span class="op" id="4686775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686778">pad</span>&nbsp;<span class="op" id="4686782">:=</span>&nbsp;<span class="ident" id="4686785">ciph</span><span class="op" id="4686789">.</span><span class="ident" id="4686790">blockSize</span>&nbsp;<span class="op" id="4686800">-</span>&nbsp;<span class="builtinfunc" id="4686802">len</span><span class="op" id="4686805">(</span><span class="ident" id="4686806">data</span><span class="op" id="4686810">)</span><span class="op" id="4686811">%</span><span class="ident" id="4686812">ciph</span><span class="op" id="4686816">.</span><span class="ident" id="4686817">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686828">encrypted</span>&nbsp;<span class="op" id="4686838">:=</span>&nbsp;<span class="builtinfunc" id="4686841">make</span><span class="op" id="4686845">(</span><span class="op" id="4686846">[</span><span class="op" id="4686847">]</span><span class="builtintype" id="4686848">byte</span><span class="op" id="4686852">,</span>&nbsp;<span class="builtinfunc" id="4686854">len</span><span class="op" id="4686857">(</span><span class="ident" id="4686858">data</span><span class="op" id="4686862">)</span><span class="op" id="4686863">,</span>&nbsp;<span class="builtinfunc" id="4686865">len</span><span class="op" id="4686868">(</span><span class="ident" id="4686869">data</span><span class="op" id="4686873">)</span><span class="op" id="4686874">+</span><span class="ident" id="4686875">pad</span><span class="op" id="4686878">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4686881">//&nbsp;We&nbsp;could&nbsp;save&nbsp;this&nbsp;copy&nbsp;by&nbsp;encrypting&nbsp;all&nbsp;the&nbsp;whole&nbsp;blocks&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4686947">//&nbsp;the&nbsp;data&nbsp;separately,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;seem&nbsp;worth&nbsp;the&nbsp;additional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4687013">//&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4687023">copy</span><span class="op" id="4687027">(</span><span class="ident" id="4687028">encrypted</span><span class="op" id="4687037">,</span>&nbsp;<span class="ident" id="4687039">data</span><span class="op" id="4687043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4687046">//&nbsp;See&nbsp;RFC&nbsp;1423,&nbsp;section&nbsp;1.1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687076">for</span>&nbsp;<span class="ident" id="4687080">i</span>&nbsp;<span class="op" id="4687082">:=</span>&nbsp;<span class="num" id="4687085">0</span><span class="op" id="4687086">;</span>&nbsp;<span class="ident" id="4687088">i</span>&nbsp;<span class="op" id="4687090">&lt;</span>&nbsp;<span class="ident" id="4687092">pad</span><span class="op" id="4687095">;</span>&nbsp;<span class="ident" id="4687097">i</span><span class="op" id="4687098">++</span>&nbsp;<span class="op" id="4687101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687105">encrypted</span>&nbsp;<span class="op" id="4687115">=</span>&nbsp;<span class="builtinfunc" id="4687117">append</span><span class="op" id="4687123">(</span><span class="ident" id="4687124">encrypted</span><span class="op" id="4687133">,</span>&nbsp;<span class="builtintype" id="4687135">byte</span><span class="op" id="4687139">(</span><span class="ident" id="4687140">pad</span><span class="op" id="4687143">)</span><span class="op" id="4687144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687150">enc</span><span class="op" id="4687153">.</span><span class="ident" id="4687154">CryptBlocks</span><span class="op" id="4687165">(</span><span class="ident" id="4687166">encrypted</span><span class="op" id="4687175">,</span>&nbsp;<span class="ident" id="4687177">encrypted</span><span class="op" id="4687186">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687190">return</span>&nbsp;<span class="op" id="4687197">&amp;</span><span class="ident" id="4687198">pem</span><span class="op" id="4687201">.</span><span class="ident" id="4687202">Block</span><span class="op" id="4687207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687211">Type</span><span class="op" id="4687215">:</span>&nbsp;<span class="ident" id="4687217">blockType</span><span class="op" id="4687226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687230">Headers</span><span class="op" id="4687237">:</span>&nbsp;<span class="keyword" id="4687239">map</span><span class="op" id="4687242">[</span><span class="builtintype" id="4687243">string</span><span class="op" id="4687249">]</span><span class="builtintype" id="4687250">string</span><span class="op" id="4687256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4687261">&#34;Proc-Type&#34;</span><span class="op" id="4687272">:</span>&nbsp;<span class="string" id="4687274">&#34;4,ENCRYPTED&#34;</span><span class="op" id="4687287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4687292">&#34;DEK-Info&#34;</span><span class="op" id="4687302">:</span>&nbsp;&nbsp;<span class="ident" id="4687305">ciph</span><span class="op" id="4687309">.</span><span class="ident" id="4687310">name</span>&nbsp;<span class="op" id="4687315">+</span>&nbsp;<span class="string" id="4687317">&#34;,&#34;</span>&nbsp;<span class="op" id="4687321">+</span>&nbsp;<span class="ident" id="4687323">hex</span><span class="op" id="4687326">.</span><span class="ident" id="4687327">EncodeToString</span><span class="op" id="4687341">(</span><span class="ident" id="4687342">iv</span><span class="op" id="4687344">)</span><span class="op" id="4687345">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687349">}</span><span class="op" id="4687350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687354">Bytes</span><span class="op" id="4687359">:</span>&nbsp;<span class="ident" id="4687361">encrypted</span><span class="op" id="4687370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687373">}</span><span class="op" id="4687374">,</span>&nbsp;<span class="ident" id="4687376">nil</span><br>
<span class="lineno"></span><span class="op" id="4687380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="4687383">func</span>&nbsp;<span class="ident" id="4687388">cipherByName</span><span class="op" id="4687400">(</span><span class="ident" id="4687401">name</span>&nbsp;<span class="builtintype" id="4687406">string</span><span class="op" id="4687412">)</span>&nbsp;<span class="op" id="4687414">*</span><span class="ident" id="4687415">rfc1423Algo</span>&nbsp;<span class="op" id="4687427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687430">for</span>&nbsp;<span class="ident" id="4687434">i</span>&nbsp;<span class="op" id="4687436">:=</span>&nbsp;<span class="keyword" id="4687439">range</span>&nbsp;<span class="ident" id="4687445">rfc1423Algos</span>&nbsp;<span class="op" id="4687458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687462">alg</span>&nbsp;<span class="op" id="4687466">:=</span>&nbsp;<span class="op" id="4687469">&amp;</span><span class="ident" id="4687470">rfc1423Algos</span><span class="op" id="4687482">[</span><span class="ident" id="4687483">i</span><span class="op" id="4687484">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687488">if</span>&nbsp;<span class="ident" id="4687491">alg</span><span class="op" id="4687494">.</span><span class="ident" id="4687495">name</span>&nbsp;<span class="op" id="4687500">==</span>&nbsp;<span class="ident" id="4687503">name</span>&nbsp;<span class="op" id="4687508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687513">return</span>&nbsp;<span class="ident" id="4687520">alg</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687532">return</span>&nbsp;<span class="ident" id="4687539">nil</span><br>
<span class="lineno"></span><span class="op" id="4687543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="4687546">func</span>&nbsp;<span class="ident" id="4687551">cipherByKey</span><span class="op" id="4687562">(</span><span class="ident" id="4687563">key</span>&nbsp;<span class="ident" id="4687567">PEMCipher</span><span class="op" id="4687576">)</span>&nbsp;<span class="op" id="4687578">*</span><span class="ident" id="4687579">rfc1423Algo</span>&nbsp;<span class="op" id="4687591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687594">for</span>&nbsp;<span class="ident" id="4687598">i</span>&nbsp;<span class="op" id="4687600">:=</span>&nbsp;<span class="keyword" id="4687603">range</span>&nbsp;<span class="ident" id="4687609">rfc1423Algos</span>&nbsp;<span class="op" id="4687622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687626">alg</span>&nbsp;<span class="op" id="4687630">:=</span>&nbsp;<span class="op" id="4687633">&amp;</span><span class="ident" id="4687634">rfc1423Algos</span><span class="op" id="4687646">[</span><span class="ident" id="4687647">i</span><span class="op" id="4687648">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687652">if</span>&nbsp;<span class="ident" id="4687655">alg</span><span class="op" id="4687658">.</span><span class="ident" id="4687659">cipher</span>&nbsp;<span class="op" id="4687666">==</span>&nbsp;<span class="ident" id="4687669">key</span>&nbsp;<span class="op" id="4687673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687678">return</span>&nbsp;<span class="ident" id="4687685">alg</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687697">return</span>&nbsp;<span class="ident" id="4687704">nil</span><br>
<span class="lineno"></span><span class="op" id="4687708">}</span>
</div>
</body>
</html>
