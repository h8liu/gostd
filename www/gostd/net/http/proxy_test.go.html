<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html" class="current">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7042655">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7042710">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7042764">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7042815">package</span>&nbsp;<span class="ident" id="7042823">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7042829">import</span>&nbsp;<span class="op" id="7042836">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7042839">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7042850">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7042856">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7042866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7042869">//&nbsp;TODO(mattn):</span><br>
<span class="lineno"></span><span class="comment" id="7042885">//&nbsp;&nbsp;&nbsp;&nbsptest&nbsp;ProxyAuth</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7042904">var</span>&nbsp;<span class="ident" id="7042908">UseProxyTests</span>&nbsp;<span class="op" id="7042922">=</span>&nbsp;<span class="op" id="7042924">[</span><span class="op" id="7042925">]</span><span class="keyword" id="7042926">struct</span>&nbsp;<span class="op" id="7042933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7042936">host</span>&nbsp;&nbsp;<span class="builtintype" id="7042942">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7042950">match</span>&nbsp;<span class="builtintype" id="7042956">bool</span><br>
<span class="lineno"></span><span class="op" id="7042961">}</span><span class="op" id="7042962">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7042965">//&nbsp;Never&nbsp;proxy&nbsp;localhost:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7042992">{</span><span class="string" id="7042993">&#34;localhost:80&#34;</span><span class="op" id="7043007">,</span>&nbsp;<span class="builtintype" id="7043009">false</span><span class="op" id="7043014">}</span><span class="op" id="7043015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043018">{</span><span class="string" id="7043019">&#34;127.0.0.1&#34;</span><span class="op" id="7043030">,</span>&nbsp;<span class="builtintype" id="7043032">false</span><span class="op" id="7043037">}</span><span class="op" id="7043038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043041">{</span><span class="string" id="7043042">&#34;127.0.0.2&#34;</span><span class="op" id="7043053">,</span>&nbsp;<span class="builtintype" id="7043055">false</span><span class="op" id="7043060">}</span><span class="op" id="7043061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043064">{</span><span class="string" id="7043065">&#34;[::1]&#34;</span><span class="op" id="7043072">,</span>&nbsp;<span class="builtintype" id="7043074">false</span><span class="op" id="7043079">}</span><span class="op" id="7043080">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043083">{</span><span class="string" id="7043084">&#34;[::2]&#34;</span><span class="op" id="7043091">,</span>&nbsp;<span class="builtintype" id="7043093">true</span><span class="op" id="7043097">}</span><span class="op" id="7043098">,</span>&nbsp;<span class="comment" id="7043100">//&nbsp;not&nbsp;a&nbsp;loopback&nbsp;address</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043128">{</span><span class="string" id="7043129">&#34;barbaz.net&#34;</span><span class="op" id="7043141">,</span>&nbsp;<span class="builtintype" id="7043143">false</span><span class="op" id="7043148">}</span><span class="op" id="7043149">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7043155">//&nbsp;match&nbsp;as&nbsp;.barbaz.net</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043180">{</span><span class="string" id="7043181">&#34;foobar.com&#34;</span><span class="op" id="7043193">,</span>&nbsp;<span class="builtintype" id="7043195">false</span><span class="op" id="7043200">}</span><span class="op" id="7043201">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7043207">//&nbsp;have&nbsp;a&nbsp;port&nbsp;but&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043233">{</span><span class="string" id="7043234">&#34;foofoobar.com&#34;</span><span class="op" id="7043249">,</span>&nbsp;<span class="builtintype" id="7043251">true</span><span class="op" id="7043255">}</span><span class="op" id="7043256">,</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7043260">//&nbsp;not&nbsp;match&nbsp;as&nbsp;a&nbsp;part&nbsp;of&nbsp;foobar.com</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043298">{</span><span class="string" id="7043299">&#34;baz.com&#34;</span><span class="op" id="7043308">,</span>&nbsp;<span class="builtintype" id="7043310">true</span><span class="op" id="7043314">}</span><span class="op" id="7043315">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7043325">//&nbsp;not&nbsp;match&nbsp;as&nbsp;a&nbsp;part&nbsp;of&nbsp;barbaz.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043363">{</span><span class="string" id="7043364">&#34;localhost.net&#34;</span><span class="op" id="7043379">,</span>&nbsp;<span class="builtintype" id="7043381">true</span><span class="op" id="7043385">}</span><span class="op" id="7043386">,</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7043390">//&nbsp;not&nbsp;match&nbsp;as&nbsp;suffix&nbsp;of&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043425">{</span><span class="string" id="7043426">&#34;local.localhost&#34;</span><span class="op" id="7043443">,</span>&nbsp;<span class="builtintype" id="7043445">true</span><span class="op" id="7043449">}</span><span class="op" id="7043450">,</span>&nbsp;<span class="comment" id="7043452">//&nbsp;not&nbsp;match&nbsp;as&nbsp;prefix&nbsp;as&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043487">{</span><span class="string" id="7043488">&#34;barbarbaz.net&#34;</span><span class="op" id="7043503">,</span>&nbsp;<span class="builtintype" id="7043505">true</span><span class="op" id="7043509">}</span><span class="op" id="7043510">,</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7043514">//&nbsp;not&nbsp;match&nbsp;because&nbsp;NO_PROXY&nbsp;have&nbsp;a&nbsp;&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043556">{</span><span class="string" id="7043557">&#34;www.foobar.com&#34;</span><span class="op" id="7043573">,</span>&nbsp;<span class="builtintype" id="7043575">false</span><span class="op" id="7043580">}</span><span class="op" id="7043581">,</span>&nbsp;<span class="comment" id="7043583">//&nbsp;match&nbsp;because&nbsp;NO_PROXY&nbsp;includes&nbsp;&#34;foobar.com&#34;</span><br>
<span class="lineno">35</span><span class="op" id="7043631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7043634">func</span>&nbsp;<span class="ident" id="7043639">TestUseProxy</span><span class="op" id="7043651">(</span><span class="ident" id="7043652">t</span>&nbsp;<span class="op" id="7043654">*</span><span class="ident" id="7043655">testing</span><span class="op" id="7043662">.</span><span class="ident" id="7043663">T</span><span class="op" id="7043664">)</span>&nbsp;<span class="op" id="7043666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7043669">ResetProxyEnv</span><span class="op" id="7043682">(</span><span class="op" id="7043683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7043686">os</span><span class="op" id="7043688">.</span><span class="ident" id="7043689">Setenv</span><span class="op" id="7043695">(</span><span class="string" id="7043696">&#34;NO_PROXY&#34;</span><span class="op" id="7043706">,</span>&nbsp;<span class="string" id="7043708">&#34;foobar.com,&nbsp;.barbaz.net&#34;</span><span class="op" id="7043733">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7043736">for</span>&nbsp;<span class="ident" id="7043740">_</span><span class="op" id="7043741">,</span>&nbsp;<span class="ident" id="7043743">test</span>&nbsp;<span class="op" id="7043748">:=</span>&nbsp;<span class="keyword" id="7043751">range</span>&nbsp;<span class="ident" id="7043757">UseProxyTests</span>&nbsp;<span class="op" id="7043771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7043775">if</span>&nbsp;<span class="ident" id="7043778">useProxy</span><span class="op" id="7043786">(</span><span class="ident" id="7043787">test</span><span class="op" id="7043791">.</span><span class="ident" id="7043792">host</span><span class="op" id="7043796">+</span><span class="string" id="7043797">&#34;:80&#34;</span><span class="op" id="7043802">)</span>&nbsp;<span class="op" id="7043804">!=</span>&nbsp;<span class="ident" id="7043807">test</span><span class="op" id="7043811">.</span><span class="ident" id="7043812">match</span>&nbsp;<span class="op" id="7043818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7043823">t</span><span class="op" id="7043824">.</span><span class="ident" id="7043825">Errorf</span><span class="op" id="7043831">(</span><span class="string" id="7043832">&#34;useProxy(%v)&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7043860">,</span>&nbsp;<span class="ident" id="7043862">test</span><span class="op" id="7043866">.</span><span class="ident" id="7043867">host</span><span class="op" id="7043871">,</span>&nbsp;<span class="op" id="7043873">!</span><span class="ident" id="7043874">test</span><span class="op" id="7043878">.</span><span class="ident" id="7043879">match</span><span class="op" id="7043884">,</span>&nbsp;<span class="ident" id="7043886">test</span><span class="op" id="7043890">.</span><span class="ident" id="7043891">match</span><span class="op" id="7043896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7043903">}</span><br>
<span class="lineno">45</span><span class="op" id="7043905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7043908">var</span>&nbsp;<span class="ident" id="7043912">cacheKeysTests</span>&nbsp;<span class="op" id="7043927">=</span>&nbsp;<span class="op" id="7043929">[</span><span class="op" id="7043930">]</span><span class="keyword" id="7043931">struct</span>&nbsp;<span class="op" id="7043938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7043941">proxy</span>&nbsp;&nbsp;<span class="builtintype" id="7043948">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7043956">scheme</span>&nbsp;<span class="builtintype" id="7043963">string</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7043971">addr</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7043978">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7043986">key</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7043993">string</span><br>
<span class="lineno"></span><span class="op" id="7044000">}</span><span class="op" id="7044001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7044004">{</span><span class="string" id="7044005">&#34;&#34;</span><span class="op" id="7044007">,</span>&nbsp;<span class="string" id="7044009">&#34;http&#34;</span><span class="op" id="7044015">,</span>&nbsp;<span class="string" id="7044017">&#34;foo.com&#34;</span><span class="op" id="7044026">,</span>&nbsp;<span class="string" id="7044028">&#34;|http|foo.com&#34;</span><span class="op" id="7044043">}</span><span class="op" id="7044044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7044047">{</span><span class="string" id="7044048">&#34;&#34;</span><span class="op" id="7044050">,</span>&nbsp;<span class="string" id="7044052">&#34;https&#34;</span><span class="op" id="7044059">,</span>&nbsp;<span class="string" id="7044061">&#34;foo.com&#34;</span><span class="op" id="7044070">,</span>&nbsp;<span class="string" id="7044072">&#34;|https|foo.com&#34;</span><span class="op" id="7044088">}</span><span class="op" id="7044089">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7044092">{</span><span class="string" id="7044093">&#34;http://foo.com&#34;</span><span class="op" id="7044109">,</span>&nbsp;<span class="string" id="7044111">&#34;http&#34;</span><span class="op" id="7044117">,</span>&nbsp;<span class="string" id="7044119">&#34;foo.com&#34;</span><span class="op" id="7044128">,</span>&nbsp;<span class="string" id="7044130">&#34;http://foo.com|http|&#34;</span><span class="op" id="7044152">}</span><span class="op" id="7044153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7044156">{</span><span class="string" id="7044157">&#34;http://foo.com&#34;</span><span class="op" id="7044173">,</span>&nbsp;<span class="string" id="7044175">&#34;https&#34;</span><span class="op" id="7044182">,</span>&nbsp;<span class="string" id="7044184">&#34;foo.com&#34;</span><span class="op" id="7044193">,</span>&nbsp;<span class="string" id="7044195">&#34;http://foo.com|https|foo.com&#34;</span><span class="op" id="7044225">}</span><span class="op" id="7044226">,</span><br>
<span class="lineno"></span><span class="op" id="7044228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7044231">func</span>&nbsp;<span class="ident" id="7044236">TestCacheKeys</span><span class="op" id="7044249">(</span><span class="ident" id="7044250">t</span>&nbsp;<span class="op" id="7044252">*</span><span class="ident" id="7044253">testing</span><span class="op" id="7044260">.</span><span class="ident" id="7044261">T</span><span class="op" id="7044262">)</span>&nbsp;<span class="op" id="7044264">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7044267">for</span>&nbsp;<span class="ident" id="7044271">_</span><span class="op" id="7044272">,</span>&nbsp;<span class="ident" id="7044274">tt</span>&nbsp;<span class="op" id="7044277">:=</span>&nbsp;<span class="keyword" id="7044280">range</span>&nbsp;<span class="ident" id="7044286">cacheKeysTests</span>&nbsp;<span class="op" id="7044301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7044305">var</span>&nbsp;<span class="ident" id="7044309">proxy</span>&nbsp;<span class="op" id="7044315">*</span><span class="ident" id="7044316">url</span><span class="op" id="7044319">.</span><span class="ident" id="7044320">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7044326">if</span>&nbsp;<span class="ident" id="7044329">tt</span><span class="op" id="7044331">.</span><span class="ident" id="7044332">proxy</span>&nbsp;<span class="op" id="7044338">!=</span>&nbsp;<span class="string" id="7044341">&#34;&#34;</span>&nbsp;<span class="op" id="7044344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7044349">u</span><span class="op" id="7044350">,</span>&nbsp;<span class="ident" id="7044352">err</span>&nbsp;<span class="op" id="7044356">:=</span>&nbsp;<span class="ident" id="7044359">url</span><span class="op" id="7044362">.</span><span class="ident" id="7044363">Parse</span><span class="op" id="7044368">(</span><span class="ident" id="7044369">tt</span><span class="op" id="7044371">.</span><span class="ident" id="7044372">proxy</span><span class="op" id="7044377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7044382">if</span>&nbsp;<span class="ident" id="7044385">err</span>&nbsp;<span class="op" id="7044389">!=</span>&nbsp;<span class="ident" id="7044392">nil</span>&nbsp;<span class="op" id="7044396">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7044402">t</span><span class="op" id="7044403">.</span><span class="ident" id="7044404">Fatal</span><span class="op" id="7044409">(</span><span class="ident" id="7044410">err</span><span class="op" id="7044413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7044418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7044423">proxy</span>&nbsp;<span class="op" id="7044429">=</span>&nbsp;<span class="ident" id="7044431">u</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7044435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7044439">cm</span>&nbsp;<span class="op" id="7044442">:=</span>&nbsp;<span class="ident" id="7044445">connectMethod</span><span class="op" id="7044458">{</span><span class="ident" id="7044459">proxy</span><span class="op" id="7044464">,</span>&nbsp;<span class="ident" id="7044466">tt</span><span class="op" id="7044468">.</span><span class="ident" id="7044469">scheme</span><span class="op" id="7044475">,</span>&nbsp;<span class="ident" id="7044477">tt</span><span class="op" id="7044479">.</span><span class="ident" id="7044480">addr</span><span class="op" id="7044484">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7044488">if</span>&nbsp;<span class="ident" id="7044491">got</span>&nbsp;<span class="op" id="7044495">:=</span>&nbsp;<span class="ident" id="7044498">cm</span><span class="op" id="7044500">.</span><span class="ident" id="7044501">key</span><span class="op" id="7044504">(</span><span class="op" id="7044505">)</span><span class="op" id="7044506">.</span><span class="ident" id="7044507">String</span><span class="op" id="7044513">(</span><span class="op" id="7044514">)</span><span class="op" id="7044515">;</span>&nbsp;<span class="ident" id="7044517">got</span>&nbsp;<span class="op" id="7044521">!=</span>&nbsp;<span class="ident" id="7044524">tt</span><span class="op" id="7044526">.</span><span class="ident" id="7044527">key</span>&nbsp;<span class="op" id="7044531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7044536">t</span><span class="op" id="7044537">.</span><span class="ident" id="7044538">Fatalf</span><span class="op" id="7044544">(</span><span class="string" id="7044545">&#34;{%q,&nbsp;%q,&nbsp;%q}&nbsp;cache&nbsp;key&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7044583">,</span>&nbsp;<span class="ident" id="7044585">tt</span><span class="op" id="7044587">.</span><span class="ident" id="7044588">proxy</span><span class="op" id="7044593">,</span>&nbsp;<span class="ident" id="7044595">tt</span><span class="op" id="7044597">.</span><span class="ident" id="7044598">scheme</span><span class="op" id="7044604">,</span>&nbsp;<span class="ident" id="7044606">tt</span><span class="op" id="7044608">.</span><span class="ident" id="7044609">addr</span><span class="op" id="7044613">,</span>&nbsp;<span class="ident" id="7044615">got</span><span class="op" id="7044618">,</span>&nbsp;<span class="ident" id="7044620">tt</span><span class="op" id="7044622">.</span><span class="ident" id="7044623">key</span><span class="op" id="7044626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7044630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7044633">}</span><br>
<span class="lineno"></span><span class="op" id="7044635">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7044638">func</span>&nbsp;<span class="ident" id="7044643">ResetProxyEnv</span><span class="op" id="7044656">(</span><span class="op" id="7044657">)</span>&nbsp;<span class="op" id="7044659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7044662">for</span>&nbsp;<span class="ident" id="7044666">_</span><span class="op" id="7044667">,</span>&nbsp;<span class="ident" id="7044669">v</span>&nbsp;<span class="op" id="7044671">:=</span>&nbsp;<span class="keyword" id="7044674">range</span>&nbsp;<span class="op" id="7044680">[</span><span class="op" id="7044681">]</span><span class="builtintype" id="7044682">string</span><span class="op" id="7044688">{</span><span class="string" id="7044689">&#34;HTTP_PROXY&#34;</span><span class="op" id="7044701">,</span>&nbsp;<span class="string" id="7044703">&#34;http_proxy&#34;</span><span class="op" id="7044715">,</span>&nbsp;<span class="string" id="7044717">&#34;NO_PROXY&#34;</span><span class="op" id="7044727">,</span>&nbsp;<span class="string" id="7044729">&#34;no_proxy&#34;</span><span class="op" id="7044739">}</span>&nbsp;<span class="op" id="7044741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7044745">os</span><span class="op" id="7044747">.</span><span class="ident" id="7044748">Setenv</span><span class="op" id="7044754">(</span><span class="ident" id="7044755">v</span><span class="op" id="7044756">,</span>&nbsp;<span class="string" id="7044758">&#34;&#34;</span><span class="op" id="7044760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7044763">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7044766">ResetCachedEnvironment</span><span class="op" id="7044788">(</span><span class="op" id="7044789">)</span><br>
<span class="lineno"></span><span class="op" id="7044791">}</span>
</div>
</body>
</html>
