<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html" class="current">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3220646">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3220701">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3220755">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3220806">package</span>&nbsp;<span class="ident" id="3220814">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3220819">import</span>&nbsp;<span class="op" id="3220826">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3220829">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3220838">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3220845">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3220857">&#34;sort&#34;</span><br>
<span class="lineno"></span><span class="op" id="3220864">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3220867">type</span>&nbsp;<span class="ident" id="3220872">byPos</span>&nbsp;<span class="op" id="3220878">[</span><span class="op" id="3220879">]</span><span class="op" id="3220880">*</span><span class="ident" id="3220881">CommentGroup</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3220895">func</span>&nbsp;<span class="op" id="3220900">(</span><span class="ident" id="3220901">a</span>&nbsp;<span class="ident" id="3220903">byPos</span><span class="op" id="3220908">)</span>&nbsp;<span class="ident" id="3220910">Len</span><span class="op" id="3220913">(</span><span class="op" id="3220914">)</span>&nbsp;<span class="builtintype" id="3220916">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3220930">{</span>&nbsp;<span class="keyword" id="3220932">return</span>&nbsp;<span class="builtinfunc" id="3220939">len</span><span class="op" id="3220942">(</span><span class="ident" id="3220943">a</span><span class="op" id="3220944">)</span>&nbsp;<span class="op" id="3220946">}</span><br>
<span class="lineno"></span><span class="keyword" id="3220948">func</span>&nbsp;<span class="op" id="3220953">(</span><span class="ident" id="3220954">a</span>&nbsp;<span class="ident" id="3220956">byPos</span><span class="op" id="3220961">)</span>&nbsp;<span class="ident" id="3220963">Less</span><span class="op" id="3220967">(</span><span class="ident" id="3220968">i</span><span class="op" id="3220969">,</span>&nbsp;<span class="ident" id="3220971">j</span>&nbsp;<span class="builtintype" id="3220973">int</span><span class="op" id="3220976">)</span>&nbsp;<span class="builtintype" id="3220978">bool</span>&nbsp;<span class="op" id="3220983">{</span>&nbsp;<span class="keyword" id="3220985">return</span>&nbsp;<span class="ident" id="3220992">a</span><span class="op" id="3220993">[</span><span class="ident" id="3220994">i</span><span class="op" id="3220995">]</span><span class="op" id="3220996">.</span><span class="ident" id="3220997">Pos</span><span class="op" id="3221000">(</span><span class="op" id="3221001">)</span>&nbsp;<span class="op" id="3221003">&lt;</span>&nbsp;<span class="ident" id="3221005">a</span><span class="op" id="3221006">[</span><span class="ident" id="3221007">j</span><span class="op" id="3221008">]</span><span class="op" id="3221009">.</span><span class="ident" id="3221010">Pos</span><span class="op" id="3221013">(</span><span class="op" id="3221014">)</span>&nbsp;<span class="op" id="3221016">}</span><br>
<span class="lineno"></span><span class="keyword" id="3221018">func</span>&nbsp;<span class="op" id="3221023">(</span><span class="ident" id="3221024">a</span>&nbsp;<span class="ident" id="3221026">byPos</span><span class="op" id="3221031">)</span>&nbsp;<span class="ident" id="3221033">Swap</span><span class="op" id="3221037">(</span><span class="ident" id="3221038">i</span><span class="op" id="3221039">,</span>&nbsp;<span class="ident" id="3221041">j</span>&nbsp;<span class="builtintype" id="3221043">int</span><span class="op" id="3221046">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3221053">{</span>&nbsp;<span class="ident" id="3221055">a</span><span class="op" id="3221056">[</span><span class="ident" id="3221057">i</span><span class="op" id="3221058">]</span><span class="op" id="3221059">,</span>&nbsp;<span class="ident" id="3221061">a</span><span class="op" id="3221062">[</span><span class="ident" id="3221063">j</span><span class="op" id="3221064">]</span>&nbsp;<span class="op" id="3221066">=</span>&nbsp;<span class="ident" id="3221068">a</span><span class="op" id="3221069">[</span><span class="ident" id="3221070">j</span><span class="op" id="3221071">]</span><span class="op" id="3221072">,</span>&nbsp;<span class="ident" id="3221074">a</span><span class="op" id="3221075">[</span><span class="ident" id="3221076">i</span><span class="op" id="3221077">]</span>&nbsp;<span class="op" id="3221079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3221082">//&nbsp;sortComments&nbsp;sorts&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="3221148">//</span><br>
<span class="lineno"></span><span class="keyword" id="3221151">func</span>&nbsp;<span class="ident" id="3221156">sortComments</span><span class="op" id="3221168">(</span><span class="ident" id="3221169">list</span>&nbsp;<span class="op" id="3221174">[</span><span class="op" id="3221175">]</span><span class="op" id="3221176">*</span><span class="ident" id="3221177">CommentGroup</span><span class="op" id="3221189">)</span>&nbsp;<span class="op" id="3221191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3221194">//&nbsp;TODO(gri):&nbsp;Does&nbsp;it&nbsp;make&nbsp;sense&nbsp;to&nbsp;check&nbsp;for&nbsp;sorted-ness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3221253">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first&nbsp;(because&nbsp;we&nbsp;know&nbsp;that&nbsp;sorted-ness&nbsp;is</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3221311">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;very&nbsp;likely)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221340">if</span>&nbsp;<span class="ident" id="3221343">orderedList</span>&nbsp;<span class="op" id="3221355">:=</span>&nbsp;<span class="ident" id="3221358">byPos</span><span class="op" id="3221363">(</span><span class="ident" id="3221364">list</span><span class="op" id="3221368">)</span><span class="op" id="3221369">;</span>&nbsp;<span class="op" id="3221371">!</span><span class="ident" id="3221372">sort</span><span class="op" id="3221376">.</span><span class="ident" id="3221377">IsSorted</span><span class="op" id="3221385">(</span><span class="ident" id="3221386">orderedList</span><span class="op" id="3221397">)</span>&nbsp;<span class="op" id="3221399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221403">sort</span><span class="op" id="3221407">.</span><span class="ident" id="3221408">Sort</span><span class="op" id="3221412">(</span><span class="ident" id="3221413">orderedList</span><span class="op" id="3221424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3221427">}</span><br>
<span class="lineno"></span><span class="op" id="3221429">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3221432">//&nbsp;A&nbsp;CommentMap&nbsp;maps&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="3221493">//&nbsp;associated&nbsp;with&nbsp;it.&nbsp;See&nbsp;NewCommentMap&nbsp;for&nbsp;a&nbsp;description&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3221555">//&nbsp;the&nbsp;association.</span><br>
<span class="lineno"></span><span class="comment" id="3221575">//</span><br>
<span class="lineno">35</span><span class="keyword" id="3221578">type</span>&nbsp;<span class="ident" id="3221583">CommentMap</span>&nbsp;<span class="keyword" id="3221594">map</span><span class="op" id="3221597">[</span><span class="ident" id="3221598">Node</span><span class="op" id="3221602">]</span><span class="op" id="3221603">[</span><span class="op" id="3221604">]</span><span class="op" id="3221605">*</span><span class="ident" id="3221606">CommentGroup</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3221620">func</span>&nbsp;<span class="op" id="3221625">(</span><span class="ident" id="3221626">cmap</span>&nbsp;<span class="ident" id="3221631">CommentMap</span><span class="op" id="3221641">)</span>&nbsp;<span class="ident" id="3221643">addComment</span><span class="op" id="3221653">(</span><span class="ident" id="3221654">n</span>&nbsp;<span class="ident" id="3221656">Node</span><span class="op" id="3221660">,</span>&nbsp;<span class="ident" id="3221662">c</span>&nbsp;<span class="op" id="3221664">*</span><span class="ident" id="3221665">CommentGroup</span><span class="op" id="3221677">)</span>&nbsp;<span class="op" id="3221679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221682">list</span>&nbsp;<span class="op" id="3221687">:=</span>&nbsp;<span class="ident" id="3221690">cmap</span><span class="op" id="3221694">[</span><span class="ident" id="3221695">n</span><span class="op" id="3221696">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221699">if</span>&nbsp;<span class="builtinfunc" id="3221702">len</span><span class="op" id="3221705">(</span><span class="ident" id="3221706">list</span><span class="op" id="3221710">)</span>&nbsp;<span class="op" id="3221712">==</span>&nbsp;<span class="num" id="3221715">0</span>&nbsp;<span class="op" id="3221717">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221721">list</span>&nbsp;<span class="op" id="3221726">=</span>&nbsp;<span class="op" id="3221728">[</span><span class="op" id="3221729">]</span><span class="op" id="3221730">*</span><span class="ident" id="3221731">CommentGroup</span><span class="op" id="3221743">{</span><span class="ident" id="3221744">c</span><span class="op" id="3221745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3221748">}</span>&nbsp;<span class="keyword" id="3221750">else</span>&nbsp;<span class="op" id="3221755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221759">list</span>&nbsp;<span class="op" id="3221764">=</span>&nbsp;<span class="builtinfunc" id="3221766">append</span><span class="op" id="3221772">(</span><span class="ident" id="3221773">list</span><span class="op" id="3221777">,</span>&nbsp;<span class="ident" id="3221779">c</span><span class="op" id="3221780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3221783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221786">cmap</span><span class="op" id="3221790">[</span><span class="ident" id="3221791">n</span><span class="op" id="3221792">]</span>&nbsp;<span class="op" id="3221794">=</span>&nbsp;<span class="ident" id="3221796">list</span><br>
<span class="lineno">45</span><span class="op" id="3221801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3221804">type</span>&nbsp;<span class="ident" id="3221809">byInterval</span>&nbsp;<span class="op" id="3221820">[</span><span class="op" id="3221821">]</span><span class="ident" id="3221822">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3221828">func</span>&nbsp;<span class="op" id="3221833">(</span><span class="ident" id="3221834">a</span>&nbsp;<span class="ident" id="3221836">byInterval</span><span class="op" id="3221846">)</span>&nbsp;<span class="ident" id="3221848">Len</span><span class="op" id="3221851">(</span><span class="op" id="3221852">)</span>&nbsp;<span class="builtintype" id="3221854">int</span>&nbsp;<span class="op" id="3221858">{</span>&nbsp;<span class="keyword" id="3221860">return</span>&nbsp;<span class="builtinfunc" id="3221867">len</span><span class="op" id="3221870">(</span><span class="ident" id="3221871">a</span><span class="op" id="3221872">)</span>&nbsp;<span class="op" id="3221874">}</span><br>
<span class="lineno">50</span><span class="keyword" id="3221876">func</span>&nbsp;<span class="op" id="3221881">(</span><span class="ident" id="3221882">a</span>&nbsp;<span class="ident" id="3221884">byInterval</span><span class="op" id="3221894">)</span>&nbsp;<span class="ident" id="3221896">Less</span><span class="op" id="3221900">(</span><span class="ident" id="3221901">i</span><span class="op" id="3221902">,</span>&nbsp;<span class="ident" id="3221904">j</span>&nbsp;<span class="builtintype" id="3221906">int</span><span class="op" id="3221909">)</span>&nbsp;<span class="builtintype" id="3221911">bool</span>&nbsp;<span class="op" id="3221916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3221919">pi</span><span class="op" id="3221921">,</span>&nbsp;<span class="ident" id="3221923">pj</span>&nbsp;<span class="op" id="3221926">:=</span>&nbsp;<span class="ident" id="3221929">a</span><span class="op" id="3221930">[</span><span class="ident" id="3221931">i</span><span class="op" id="3221932">]</span><span class="op" id="3221933">.</span><span class="ident" id="3221934">Pos</span><span class="op" id="3221937">(</span><span class="op" id="3221938">)</span><span class="op" id="3221939">,</span>&nbsp;<span class="ident" id="3221941">a</span><span class="op" id="3221942">[</span><span class="ident" id="3221943">j</span><span class="op" id="3221944">]</span><span class="op" id="3221945">.</span><span class="ident" id="3221946">Pos</span><span class="op" id="3221949">(</span><span class="op" id="3221950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3221953">return</span>&nbsp;<span class="ident" id="3221960">pi</span>&nbsp;<span class="op" id="3221963">&lt;</span>&nbsp;<span class="ident" id="3221965">pj</span>&nbsp;<span class="op" id="3221968">||</span>&nbsp;<span class="ident" id="3221971">pi</span>&nbsp;<span class="op" id="3221974">==</span>&nbsp;<span class="ident" id="3221977">pj</span>&nbsp;<span class="op" id="3221980">&amp;&amp;</span>&nbsp;<span class="ident" id="3221983">a</span><span class="op" id="3221984">[</span><span class="ident" id="3221985">i</span><span class="op" id="3221986">]</span><span class="op" id="3221987">.</span><span class="ident" id="3221988">End</span><span class="op" id="3221991">(</span><span class="op" id="3221992">)</span>&nbsp;<span class="op" id="3221994">&gt;</span>&nbsp;<span class="ident" id="3221996">a</span><span class="op" id="3221997">[</span><span class="ident" id="3221998">j</span><span class="op" id="3221999">]</span><span class="op" id="3222000">.</span><span class="ident" id="3222001">End</span><span class="op" id="3222004">(</span><span class="op" id="3222005">)</span><br>
<span class="lineno"></span><span class="op" id="3222007">}</span><br>
<span class="lineno"></span><span class="keyword" id="3222009">func</span>&nbsp;<span class="op" id="3222014">(</span><span class="ident" id="3222015">a</span>&nbsp;<span class="ident" id="3222017">byInterval</span><span class="op" id="3222027">)</span>&nbsp;<span class="ident" id="3222029">Swap</span><span class="op" id="3222033">(</span><span class="ident" id="3222034">i</span><span class="op" id="3222035">,</span>&nbsp;<span class="ident" id="3222037">j</span>&nbsp;<span class="builtintype" id="3222039">int</span><span class="op" id="3222042">)</span>&nbsp;<span class="op" id="3222044">{</span>&nbsp;<span class="ident" id="3222046">a</span><span class="op" id="3222047">[</span><span class="ident" id="3222048">i</span><span class="op" id="3222049">]</span><span class="op" id="3222050">,</span>&nbsp;<span class="ident" id="3222052">a</span><span class="op" id="3222053">[</span><span class="ident" id="3222054">j</span><span class="op" id="3222055">]</span>&nbsp;<span class="op" id="3222057">=</span>&nbsp;<span class="ident" id="3222059">a</span><span class="op" id="3222060">[</span><span class="ident" id="3222061">j</span><span class="op" id="3222062">]</span><span class="op" id="3222063">,</span>&nbsp;<span class="ident" id="3222065">a</span><span class="op" id="3222066">[</span><span class="ident" id="3222067">i</span><span class="op" id="3222068">]</span>&nbsp;<span class="op" id="3222070">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="3222073">//&nbsp;nodeList&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;n&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="3222141">//</span><br>
<span class="lineno"></span><span class="keyword" id="3222144">func</span>&nbsp;<span class="ident" id="3222149">nodeList</span><span class="op" id="3222157">(</span><span class="ident" id="3222158">n</span>&nbsp;<span class="ident" id="3222160">Node</span><span class="op" id="3222164">)</span>&nbsp;<span class="op" id="3222166">[</span><span class="op" id="3222167">]</span><span class="ident" id="3222168">Node</span>&nbsp;<span class="op" id="3222173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222176">var</span>&nbsp;<span class="ident" id="3222180">list</span>&nbsp;<span class="op" id="3222185">[</span><span class="op" id="3222186">]</span><span class="ident" id="3222187">Node</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3222193">Inspect</span><span class="op" id="3222200">(</span><span class="ident" id="3222201">n</span><span class="op" id="3222202">,</span>&nbsp;<span class="keyword" id="3222204">func</span><span class="op" id="3222208">(</span><span class="ident" id="3222209">n</span>&nbsp;<span class="ident" id="3222211">Node</span><span class="op" id="3222215">)</span>&nbsp;<span class="builtintype" id="3222217">bool</span>&nbsp;<span class="op" id="3222222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3222226">//&nbsp;don&#39;t&nbsp;collect&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222254">switch</span>&nbsp;<span class="ident" id="3222261">n</span><span class="op" id="3222262">.</span><span class="op" id="3222263">(</span><span class="keyword" id="3222264">type</span><span class="op" id="3222268">)</span>&nbsp;<span class="op" id="3222270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222274">case</span>&nbsp;<span class="builtintype" id="3222279">nil</span><span class="op" id="3222282">,</span>&nbsp;<span class="op" id="3222284">*</span><span class="ident" id="3222285">CommentGroup</span><span class="op" id="3222297">,</span>&nbsp;<span class="op" id="3222299">*</span><span class="ident" id="3222300">Comment</span><span class="op" id="3222307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222312">return</span>&nbsp;<span class="builtintype" id="3222319">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3222327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3222331">list</span>&nbsp;<span class="op" id="3222336">=</span>&nbsp;<span class="builtinfunc" id="3222338">append</span><span class="op" id="3222344">(</span><span class="ident" id="3222345">list</span><span class="op" id="3222349">,</span>&nbsp;<span class="ident" id="3222351">n</span><span class="op" id="3222352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222356">return</span>&nbsp;<span class="builtintype" id="3222363">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3222369">}</span><span class="op" id="3222370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3222373">//&nbsp;Note:&nbsp;The&nbsp;current&nbsp;implementation&nbsp;assumes&nbsp;that&nbsp;Inspect&nbsp;traverses&nbsp;the</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3222445">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AST&nbsp;in&nbsp;depth-first&nbsp;and&nbsp;thus&nbsp;_source_&nbsp;order.&nbsp;If&nbsp;AST&nbsp;traversal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3222516">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;does&nbsp;not&nbsp;follow&nbsp;source&nbsp;order,&nbsp;the&nbsp;sorting&nbsp;call&nbsp;below&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3222587">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3222607">//&nbsp;sort.Sort(byInterval(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3222639">return</span>&nbsp;<span class="ident" id="3222646">list</span><br>
<span class="lineno">75</span><span class="op" id="3222651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3222654">//&nbsp;A&nbsp;commentListReader&nbsp;helps&nbsp;iterating&nbsp;through&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups.</span><br>
<span class="lineno"></span><span class="comment" id="3222727">//</span><br>
<span class="lineno"></span><span class="keyword" id="3222730">type</span>&nbsp;<span class="ident" id="3222735">commentListReader</span>&nbsp;<span class="keyword" id="3222753">struct</span>&nbsp;<span class="op" id="3222760">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3222763">fset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3222772">*</span><span class="ident" id="3222773">token</span><span class="op" id="3222778">.</span><span class="ident" id="3222779">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3222788">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3222797">[</span><span class="op" id="3222798">]</span><span class="op" id="3222799">*</span><span class="ident" id="3222800">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3222814">index</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3222823">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3222828">comment</span>&nbsp;&nbsp;<span class="op" id="3222837">*</span><span class="ident" id="3222838">CommentGroup</span>&nbsp;&nbsp;<span class="comment" id="3222852">//&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3222887">pos</span><span class="op" id="3222890">,</span>&nbsp;<span class="ident" id="3222892">end</span>&nbsp;<span class="ident" id="3222896">token</span><span class="op" id="3222901">.</span><span class="ident" id="3222902">Position</span>&nbsp;<span class="comment" id="3222911">//&nbsp;source&nbsp;interval&nbsp;of&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno">85</span><span class="op" id="3222964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3222967">func</span>&nbsp;<span class="op" id="3222972">(</span><span class="ident" id="3222973">r</span>&nbsp;<span class="op" id="3222975">*</span><span class="ident" id="3222976">commentListReader</span><span class="op" id="3222993">)</span>&nbsp;<span class="ident" id="3222995">eol</span><span class="op" id="3222998">(</span><span class="op" id="3222999">)</span>&nbsp;<span class="builtintype" id="3223001">bool</span>&nbsp;<span class="op" id="3223006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3223009">return</span>&nbsp;<span class="ident" id="3223016">r</span><span class="op" id="3223017">.</span><span class="ident" id="3223018">index</span>&nbsp;<span class="op" id="3223024">&gt;=</span>&nbsp;<span class="builtinfunc" id="3223027">len</span><span class="op" id="3223030">(</span><span class="ident" id="3223031">r</span><span class="op" id="3223032">.</span><span class="ident" id="3223033">list</span><span class="op" id="3223037">)</span><br>
<span class="lineno"></span><span class="op" id="3223039">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="3223042">func</span>&nbsp;<span class="op" id="3223047">(</span><span class="ident" id="3223048">r</span>&nbsp;<span class="op" id="3223050">*</span><span class="ident" id="3223051">commentListReader</span><span class="op" id="3223068">)</span>&nbsp;<span class="ident" id="3223070">next</span><span class="op" id="3223074">(</span><span class="op" id="3223075">)</span>&nbsp;<span class="op" id="3223077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3223080">if</span>&nbsp;<span class="op" id="3223083">!</span><span class="ident" id="3223084">r</span><span class="op" id="3223085">.</span><span class="ident" id="3223086">eol</span><span class="op" id="3223089">(</span><span class="op" id="3223090">)</span>&nbsp;<span class="op" id="3223092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223096">r</span><span class="op" id="3223097">.</span><span class="ident" id="3223098">comment</span>&nbsp;<span class="op" id="3223106">=</span>&nbsp;<span class="ident" id="3223108">r</span><span class="op" id="3223109">.</span><span class="ident" id="3223110">list</span><span class="op" id="3223114">[</span><span class="ident" id="3223115">r</span><span class="op" id="3223116">.</span><span class="ident" id="3223117">index</span><span class="op" id="3223122">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223126">r</span><span class="op" id="3223127">.</span><span class="ident" id="3223128">pos</span>&nbsp;<span class="op" id="3223132">=</span>&nbsp;<span class="ident" id="3223134">r</span><span class="op" id="3223135">.</span><span class="ident" id="3223136">fset</span><span class="op" id="3223140">.</span><span class="ident" id="3223141">Position</span><span class="op" id="3223149">(</span><span class="ident" id="3223150">r</span><span class="op" id="3223151">.</span><span class="ident" id="3223152">comment</span><span class="op" id="3223159">.</span><span class="ident" id="3223160">Pos</span><span class="op" id="3223163">(</span><span class="op" id="3223164">)</span><span class="op" id="3223165">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223169">r</span><span class="op" id="3223170">.</span><span class="ident" id="3223171">end</span>&nbsp;<span class="op" id="3223175">=</span>&nbsp;<span class="ident" id="3223177">r</span><span class="op" id="3223178">.</span><span class="ident" id="3223179">fset</span><span class="op" id="3223183">.</span><span class="ident" id="3223184">Position</span><span class="op" id="3223192">(</span><span class="ident" id="3223193">r</span><span class="op" id="3223194">.</span><span class="ident" id="3223195">comment</span><span class="op" id="3223202">.</span><span class="ident" id="3223203">End</span><span class="op" id="3223206">(</span><span class="op" id="3223207">)</span><span class="op" id="3223208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223212">r</span><span class="op" id="3223213">.</span><span class="ident" id="3223214">index</span><span class="op" id="3223219">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3223223">}</span><br>
<span class="lineno"></span><span class="op" id="3223225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="3223228">//&nbsp;A&nbsp;nodeStack&nbsp;keeps&nbsp;track&nbsp;of&nbsp;nested&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="3223272">//&nbsp;A&nbsp;node&nbsp;lower&nbsp;on&nbsp;the&nbsp;stack&nbsp;lexically&nbsp;contains&nbsp;the&nbsp;nodes&nbsp;higher&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="3223351">//</span><br>
<span class="lineno"></span><span class="keyword" id="3223354">type</span>&nbsp;<span class="ident" id="3223359">nodeStack</span>&nbsp;<span class="op" id="3223369">[</span><span class="op" id="3223370">]</span><span class="ident" id="3223371">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3223377">//&nbsp;push&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3223431">//&nbsp;and&nbsp;then&nbsp;pushes&nbsp;n&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="3223466">//</span><br>
<span class="lineno"></span><span class="keyword" id="3223469">func</span>&nbsp;<span class="op" id="3223474">(</span><span class="ident" id="3223475">s</span>&nbsp;<span class="op" id="3223477">*</span><span class="ident" id="3223478">nodeStack</span><span class="op" id="3223487">)</span>&nbsp;<span class="ident" id="3223489">push</span><span class="op" id="3223493">(</span><span class="ident" id="3223494">n</span>&nbsp;<span class="ident" id="3223496">Node</span><span class="op" id="3223500">)</span>&nbsp;<span class="op" id="3223502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223505">s</span><span class="op" id="3223506">.</span><span class="ident" id="3223507">pop</span><span class="op" id="3223510">(</span><span class="ident" id="3223511">n</span><span class="op" id="3223512">.</span><span class="ident" id="3223513">Pos</span><span class="op" id="3223516">(</span><span class="op" id="3223517">)</span><span class="op" id="3223518">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3223521">*</span><span class="ident" id="3223522">s</span>&nbsp;<span class="op" id="3223524">=</span>&nbsp;<span class="builtinfunc" id="3223526">append</span><span class="op" id="3223532">(</span><span class="op" id="3223533">(</span><span class="op" id="3223534">*</span><span class="ident" id="3223535">s</span><span class="op" id="3223536">)</span><span class="op" id="3223537">,</span>&nbsp;<span class="ident" id="3223539">n</span><span class="op" id="3223540">)</span><br>
<span class="lineno"></span><span class="op" id="3223542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3223545">//&nbsp;pop&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="3223600">//&nbsp;(i.e.,&nbsp;whose&nbsp;lexical&nbsp;extent&nbsp;has&nbsp;ended&nbsp;before&nbsp;or&nbsp;at&nbsp;pos).</span><br>
<span class="lineno">115</span><span class="comment" id="3223660">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;last&nbsp;node&nbsp;popped.</span><br>
<span class="lineno"></span><span class="comment" id="3223696">//</span><br>
<span class="lineno"></span><span class="keyword" id="3223699">func</span>&nbsp;<span class="op" id="3223704">(</span><span class="ident" id="3223705">s</span>&nbsp;<span class="op" id="3223707">*</span><span class="ident" id="3223708">nodeStack</span><span class="op" id="3223717">)</span>&nbsp;<span class="ident" id="3223719">pop</span><span class="op" id="3223722">(</span><span class="ident" id="3223723">pos</span>&nbsp;<span class="ident" id="3223727">token</span><span class="op" id="3223732">.</span><span class="ident" id="3223733">Pos</span><span class="op" id="3223736">)</span>&nbsp;<span class="op" id="3223738">(</span><span class="ident" id="3223739">top</span>&nbsp;<span class="ident" id="3223743">Node</span><span class="op" id="3223747">)</span>&nbsp;<span class="op" id="3223749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223752">i</span>&nbsp;<span class="op" id="3223754">:=</span>&nbsp;<span class="builtinfunc" id="3223757">len</span><span class="op" id="3223760">(</span><span class="op" id="3223761">*</span><span class="ident" id="3223762">s</span><span class="op" id="3223763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3223766">for</span>&nbsp;<span class="ident" id="3223770">i</span>&nbsp;<span class="op" id="3223772">&gt;</span>&nbsp;<span class="num" id="3223774">0</span>&nbsp;<span class="op" id="3223776">&amp;&amp;</span>&nbsp;<span class="op" id="3223779">(</span><span class="op" id="3223780">*</span><span class="ident" id="3223781">s</span><span class="op" id="3223782">)</span><span class="op" id="3223783">[</span><span class="ident" id="3223784">i</span><span class="op" id="3223785">-</span><span class="num" id="3223786">1</span><span class="op" id="3223787">]</span><span class="op" id="3223788">.</span><span class="ident" id="3223789">End</span><span class="op" id="3223792">(</span><span class="op" id="3223793">)</span>&nbsp;<span class="op" id="3223795">&lt;=</span>&nbsp;<span class="ident" id="3223798">pos</span>&nbsp;<span class="op" id="3223802">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223806">top</span>&nbsp;<span class="op" id="3223810">=</span>&nbsp;<span class="op" id="3223812">(</span><span class="op" id="3223813">*</span><span class="ident" id="3223814">s</span><span class="op" id="3223815">)</span><span class="op" id="3223816">[</span><span class="ident" id="3223817">i</span><span class="op" id="3223818">-</span><span class="num" id="3223819">1</span><span class="op" id="3223820">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3223824">i</span><span class="op" id="3223825">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3223829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3223832">*</span><span class="ident" id="3223833">s</span>&nbsp;<span class="op" id="3223835">=</span>&nbsp;<span class="op" id="3223837">(</span><span class="op" id="3223838">*</span><span class="ident" id="3223839">s</span><span class="op" id="3223840">)</span><span class="op" id="3223841">[</span><span class="num" id="3223842">0</span><span class="op" id="3223843">:</span><span class="ident" id="3223844">i</span><span class="op" id="3223845">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3223848">return</span>&nbsp;<span class="ident" id="3223855">top</span><br>
<span class="lineno">125</span><span class="op" id="3223859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3223862">//&nbsp;NewCommentMap&nbsp;creates&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;by&nbsp;associating&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="3223935">//&nbsp;of&nbsp;the&nbsp;comments&nbsp;list&nbsp;with&nbsp;the&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="3224004">//</span><br>
<span class="lineno">130</span><span class="comment" id="3224007">//&nbsp;A&nbsp;comment&nbsp;group&nbsp;g&nbsp;is&nbsp;associated&nbsp;with&nbsp;a&nbsp;node&nbsp;n&nbsp;if:</span><br>
<span class="lineno"></span><span class="comment" id="3224060">//</span><br>
<span class="lineno"></span><span class="comment" id="3224063">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;n&nbsp;ends</span><br>
<span class="lineno"></span><span class="comment" id="3224106">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;following&nbsp;n,&nbsp;and&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3224172">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;least&nbsp;one&nbsp;empty&nbsp;line&nbsp;after&nbsp;g&nbsp;and&nbsp;before&nbsp;the&nbsp;next&nbsp;node</span><br>
<span class="lineno">135</span><span class="comment" id="3224236">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;before&nbsp;n&nbsp;and&nbsp;is&nbsp;not&nbsp;associated&nbsp;to&nbsp;the&nbsp;node&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3224304">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;via&nbsp;the&nbsp;previous&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="3224334">//</span><br>
<span class="lineno"></span><span class="comment" id="3224337">//&nbsp;NewCommentMap&nbsp;tries&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;&#34;largest&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3224406">//&nbsp;node&nbsp;possible:&nbsp;For&nbsp;instance,&nbsp;if&nbsp;the&nbsp;comment&nbsp;is&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno">140</span><span class="comment" id="3224471">//&nbsp;trailing&nbsp;an&nbsp;assignment,&nbsp;the&nbsp;comment&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="3224540">//&nbsp;assignment&nbsp;rather&nbsp;than&nbsp;just&nbsp;the&nbsp;last&nbsp;operand&nbsp;in&nbsp;the&nbsp;assignment.</span><br>
<span class="lineno"></span><span class="comment" id="3224607">//</span><br>
<span class="lineno"></span><span class="keyword" id="3224610">func</span>&nbsp;<span class="ident" id="3224615">NewCommentMap</span><span class="op" id="3224628">(</span><span class="ident" id="3224629">fset</span>&nbsp;<span class="op" id="3224634">*</span><span class="ident" id="3224635">token</span><span class="op" id="3224640">.</span><span class="ident" id="3224641">FileSet</span><span class="op" id="3224648">,</span>&nbsp;<span class="ident" id="3224650">node</span>&nbsp;<span class="ident" id="3224655">Node</span><span class="op" id="3224659">,</span>&nbsp;<span class="ident" id="3224661">comments</span>&nbsp;<span class="op" id="3224670">[</span><span class="op" id="3224671">]</span><span class="op" id="3224672">*</span><span class="ident" id="3224673">CommentGroup</span><span class="op" id="3224685">)</span>&nbsp;<span class="ident" id="3224687">CommentMap</span>&nbsp;<span class="op" id="3224698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224701">if</span>&nbsp;<span class="builtinfunc" id="3224704">len</span><span class="op" id="3224707">(</span><span class="ident" id="3224708">comments</span><span class="op" id="3224716">)</span>&nbsp;<span class="op" id="3224718">==</span>&nbsp;<span class="num" id="3224721">0</span>&nbsp;<span class="op" id="3224723">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3224727">return</span>&nbsp;<span class="builtintype" id="3224734">nil</span>&nbsp;<span class="comment" id="3224738">//&nbsp;no&nbsp;comments&nbsp;to&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3224761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224765">cmap</span>&nbsp;<span class="op" id="3224770">:=</span>&nbsp;<span class="builtinfunc" id="3224773">make</span><span class="op" id="3224777">(</span><span class="ident" id="3224778">CommentMap</span><span class="op" id="3224788">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3224792">//&nbsp;set&nbsp;up&nbsp;comment&nbsp;reader&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224820">tmp</span>&nbsp;<span class="op" id="3224824">:=</span>&nbsp;<span class="builtinfunc" id="3224827">make</span><span class="op" id="3224831">(</span><span class="op" id="3224832">[</span><span class="op" id="3224833">]</span><span class="op" id="3224834">*</span><span class="ident" id="3224835">CommentGroup</span><span class="op" id="3224847">,</span>&nbsp;<span class="builtinfunc" id="3224849">len</span><span class="op" id="3224852">(</span><span class="ident" id="3224853">comments</span><span class="op" id="3224861">)</span><span class="op" id="3224862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3224865">copy</span><span class="op" id="3224869">(</span><span class="ident" id="3224870">tmp</span><span class="op" id="3224873">,</span>&nbsp;<span class="ident" id="3224875">comments</span><span class="op" id="3224883">)</span>&nbsp;<span class="comment" id="3224885">//&nbsp;don&#39;t&nbsp;change&nbsp;incoming&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224920">sortComments</span><span class="op" id="3224932">(</span><span class="ident" id="3224933">tmp</span><span class="op" id="3224936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3224939">r</span>&nbsp;<span class="op" id="3224941">:=</span>&nbsp;<span class="ident" id="3224944">commentListReader</span><span class="op" id="3224961">{</span><span class="ident" id="3224962">fset</span><span class="op" id="3224966">:</span>&nbsp;<span class="ident" id="3224968">fset</span><span class="op" id="3224972">,</span>&nbsp;<span class="ident" id="3224974">list</span><span class="op" id="3224978">:</span>&nbsp;<span class="ident" id="3224980">tmp</span><span class="op" id="3224983">}</span>&nbsp;<span class="comment" id="3224985">//&nbsp;!r.eol()&nbsp;because&nbsp;len(comments)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225024">r</span><span class="op" id="3225025">.</span><span class="ident" id="3225026">next</span><span class="op" id="3225030">(</span><span class="op" id="3225031">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3225035">//&nbsp;create&nbsp;node&nbsp;list&nbsp;in&nbsp;lexical&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225073">nodes</span>&nbsp;<span class="op" id="3225079">:=</span>&nbsp;<span class="ident" id="3225082">nodeList</span><span class="op" id="3225090">(</span><span class="ident" id="3225091">node</span><span class="op" id="3225095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225098">nodes</span>&nbsp;<span class="op" id="3225104">=</span>&nbsp;<span class="builtinfunc" id="3225106">append</span><span class="op" id="3225112">(</span><span class="ident" id="3225113">nodes</span><span class="op" id="3225118">,</span>&nbsp;<span class="builtintype" id="3225120">nil</span><span class="op" id="3225123">)</span>&nbsp;<span class="comment" id="3225125">//&nbsp;append&nbsp;sentinel</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3225146">//&nbsp;set&nbsp;up&nbsp;iteration&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3225177">var</span>&nbsp;<span class="op" id="3225181">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225185">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225191">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3225206">//&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225225">pend</span>&nbsp;&nbsp;<span class="ident" id="3225231">token</span><span class="op" id="3225236">.</span><span class="ident" id="3225237">Position</span>&nbsp;<span class="comment" id="3225246">//&nbsp;end&nbsp;of&nbsp;p</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225260">pg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225266">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3225281">//&nbsp;previous&nbsp;node&nbsp;group&nbsp;(enclosing&nbsp;nodes&nbsp;of&nbsp;&#34;importance&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225340">pgend</span>&nbsp;<span class="ident" id="3225346">token</span><span class="op" id="3225351">.</span><span class="ident" id="3225352">Position</span>&nbsp;<span class="comment" id="3225361">//&nbsp;end&nbsp;of&nbsp;pg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225376">stack</span>&nbsp;<span class="ident" id="3225382">nodeStack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3225397">//&nbsp;stack&nbsp;of&nbsp;node&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3225422">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3225426">for</span>&nbsp;<span class="ident" id="3225430">_</span><span class="op" id="3225431">,</span>&nbsp;<span class="ident" id="3225433">q</span>&nbsp;<span class="op" id="3225435">:=</span>&nbsp;<span class="keyword" id="3225438">range</span>&nbsp;<span class="ident" id="3225444">nodes</span>&nbsp;<span class="op" id="3225450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3225454">var</span>&nbsp;<span class="ident" id="3225458">qpos</span>&nbsp;<span class="ident" id="3225463">token</span><span class="op" id="3225468">.</span><span class="ident" id="3225469">Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3225480">if</span>&nbsp;<span class="ident" id="3225483">q</span>&nbsp;<span class="op" id="3225485">!=</span>&nbsp;<span class="builtintype" id="3225488">nil</span>&nbsp;<span class="op" id="3225492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225497">qpos</span>&nbsp;<span class="op" id="3225502">=</span>&nbsp;<span class="ident" id="3225504">fset</span><span class="op" id="3225508">.</span><span class="ident" id="3225509">Position</span><span class="op" id="3225517">(</span><span class="ident" id="3225518">q</span><span class="op" id="3225519">.</span><span class="ident" id="3225520">Pos</span><span class="op" id="3225523">(</span><span class="op" id="3225524">)</span><span class="op" id="3225525">)</span>&nbsp;<span class="comment" id="3225527">//&nbsp;current&nbsp;node&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3225554">}</span>&nbsp;<span class="keyword" id="3225556">else</span>&nbsp;<span class="op" id="3225561">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3225566">//&nbsp;set&nbsp;fake&nbsp;sentinel&nbsp;position&nbsp;to&nbsp;infinity&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3225619">//&nbsp;all&nbsp;comments&nbsp;get&nbsp;processed&nbsp;before&nbsp;the&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3225672">const</span>&nbsp;<span class="ident" id="3225678">infinity</span>&nbsp;<span class="op" id="3225687">=</span>&nbsp;<span class="num" id="3225689">1</span>&nbsp;<span class="op" id="3225691">&lt;&lt;</span>&nbsp;<span class="num" id="3225694">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225700">qpos</span><span class="op" id="3225704">.</span><span class="ident" id="3225705">Offset</span>&nbsp;<span class="op" id="3225712">=</span>&nbsp;<span class="ident" id="3225714">infinity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225726">qpos</span><span class="op" id="3225730">.</span><span class="ident" id="3225731">Line</span>&nbsp;<span class="op" id="3225736">=</span>&nbsp;<span class="ident" id="3225738">infinity</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3225749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3225754">//&nbsp;process&nbsp;comments&nbsp;before&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3225796">for</span>&nbsp;<span class="ident" id="3225800">r</span><span class="op" id="3225801">.</span><span class="ident" id="3225802">end</span><span class="op" id="3225805">.</span><span class="ident" id="3225806">Offset</span>&nbsp;<span class="op" id="3225813">&lt;=</span>&nbsp;<span class="ident" id="3225816">qpos</span><span class="op" id="3225820">.</span><span class="ident" id="3225821">Offset</span>&nbsp;<span class="op" id="3225828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3225833">//&nbsp;determine&nbsp;recent&nbsp;node&nbsp;group</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3225867">if</span>&nbsp;<span class="ident" id="3225870">top</span>&nbsp;<span class="op" id="3225874">:=</span>&nbsp;<span class="ident" id="3225877">stack</span><span class="op" id="3225882">.</span><span class="ident" id="3225883">pop</span><span class="op" id="3225886">(</span><span class="ident" id="3225887">r</span><span class="op" id="3225888">.</span><span class="ident" id="3225889">comment</span><span class="op" id="3225896">.</span><span class="ident" id="3225897">Pos</span><span class="op" id="3225900">(</span><span class="op" id="3225901">)</span><span class="op" id="3225902">)</span><span class="op" id="3225903">;</span>&nbsp;<span class="ident" id="3225905">top</span>&nbsp;<span class="op" id="3225909">!=</span>&nbsp;<span class="builtintype" id="3225912">nil</span>&nbsp;<span class="op" id="3225916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225922">pg</span>&nbsp;<span class="op" id="3225925">=</span>&nbsp;<span class="ident" id="3225927">top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3225935">pgend</span>&nbsp;<span class="op" id="3225941">=</span>&nbsp;<span class="ident" id="3225943">fset</span><span class="op" id="3225947">.</span><span class="ident" id="3225948">Position</span><span class="op" id="3225956">(</span><span class="ident" id="3225957">pg</span><span class="op" id="3225959">.</span><span class="ident" id="3225960">End</span><span class="op" id="3225963">(</span><span class="op" id="3225964">)</span><span class="op" id="3225965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3225970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3225975">//&nbsp;Try&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;first&nbsp;with&nbsp;a&nbsp;node&nbsp;group</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3226032">//&nbsp;(i.e.,&nbsp;a&nbsp;node&nbsp;of&nbsp;&#34;importance&#34;&nbsp;such&nbsp;as&nbsp;a&nbsp;declaration);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3226092">//&nbsp;if&nbsp;that&nbsp;fails,&nbsp;try&nbsp;to&nbsp;associate&nbsp;it&nbsp;with&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3226154">//&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3226166">//&nbsp;TODO(gri)&nbsp;try&nbsp;to&nbsp;simplify&nbsp;the&nbsp;logic&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3226214">var</span>&nbsp;<span class="ident" id="3226218">assoc</span>&nbsp;<span class="ident" id="3226224">Node</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3226232">switch</span>&nbsp;<span class="op" id="3226239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3226244">case</span>&nbsp;<span class="ident" id="3226249">pg</span>&nbsp;<span class="op" id="3226252">!=</span>&nbsp;<span class="builtintype" id="3226255">nil</span>&nbsp;<span class="op" id="3226259">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3226266">(</span><span class="ident" id="3226267">pgend</span><span class="op" id="3226272">.</span><span class="ident" id="3226273">Line</span>&nbsp;<span class="op" id="3226278">==</span>&nbsp;<span class="ident" id="3226281">r</span><span class="op" id="3226282">.</span><span class="ident" id="3226283">pos</span><span class="op" id="3226286">.</span><span class="ident" id="3226287">Line</span>&nbsp;<span class="op" id="3226292">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3226300">pgend</span><span class="op" id="3226305">.</span><span class="ident" id="3226306">Line</span><span class="op" id="3226310">+</span><span class="num" id="3226311">1</span>&nbsp;<span class="op" id="3226313">==</span>&nbsp;<span class="ident" id="3226316">r</span><span class="op" id="3226317">.</span><span class="ident" id="3226318">pos</span><span class="op" id="3226321">.</span><span class="ident" id="3226322">Line</span>&nbsp;<span class="op" id="3226327">&amp;&amp;</span>&nbsp;<span class="ident" id="3226330">r</span><span class="op" id="3226331">.</span><span class="ident" id="3226332">end</span><span class="op" id="3226335">.</span><span class="ident" id="3226336">Line</span><span class="op" id="3226340">+</span><span class="num" id="3226341">1</span>&nbsp;<span class="op" id="3226343">&lt;</span>&nbsp;<span class="ident" id="3226345">qpos</span><span class="op" id="3226349">.</span><span class="ident" id="3226350">Line</span><span class="op" id="3226354">)</span><span class="op" id="3226355">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3226361">//&nbsp;1)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;previous&nbsp;node&nbsp;group&nbsp;ends,&nbsp;or</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3226431">//&nbsp;2)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3226490">//&nbsp;&nbsp;&nbsp;&nbsp;previous&nbsp;node&nbsp;group&nbsp;and&nbsp;there&nbsp;is&nbsp;an&nbsp;empty&nbsp;line&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3226554">//&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3226581">//&nbsp;=&gt;&nbsp;associate&nbsp;comment&nbsp;with&nbsp;previous&nbsp;node&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3226634">assoc</span>&nbsp;<span class="op" id="3226640">=</span>&nbsp;<span class="ident" id="3226642">pg</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3226648">case</span>&nbsp;<span class="ident" id="3226653">p</span>&nbsp;<span class="op" id="3226655">!=</span>&nbsp;<span class="builtintype" id="3226658">nil</span>&nbsp;<span class="op" id="3226662">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3226669">(</span><span class="ident" id="3226670">pend</span><span class="op" id="3226674">.</span><span class="ident" id="3226675">Line</span>&nbsp;<span class="op" id="3226680">==</span>&nbsp;<span class="ident" id="3226683">r</span><span class="op" id="3226684">.</span><span class="ident" id="3226685">pos</span><span class="op" id="3226688">.</span><span class="ident" id="3226689">Line</span>&nbsp;<span class="op" id="3226694">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3226702">pend</span><span class="op" id="3226706">.</span><span class="ident" id="3226707">Line</span><span class="op" id="3226711">+</span><span class="num" id="3226712">1</span>&nbsp;<span class="op" id="3226714">==</span>&nbsp;<span class="ident" id="3226717">r</span><span class="op" id="3226718">.</span><span class="ident" id="3226719">pos</span><span class="op" id="3226722">.</span><span class="ident" id="3226723">Line</span>&nbsp;<span class="op" id="3226728">&amp;&amp;</span>&nbsp;<span class="ident" id="3226731">r</span><span class="op" id="3226732">.</span><span class="ident" id="3226733">end</span><span class="op" id="3226736">.</span><span class="ident" id="3226737">Line</span><span class="op" id="3226741">+</span><span class="num" id="3226742">1</span>&nbsp;<span class="op" id="3226744">&lt;</span>&nbsp;<span class="ident" id="3226746">qpos</span><span class="op" id="3226750">.</span><span class="ident" id="3226751">Line</span>&nbsp;<span class="op" id="3226756">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3226764">q</span>&nbsp;<span class="op" id="3226766">==</span>&nbsp;<span class="builtintype" id="3226769">nil</span><span class="op" id="3226772">)</span><span class="op" id="3226773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3226779">//&nbsp;same&nbsp;rules&nbsp;apply&nbsp;as&nbsp;above&nbsp;for&nbsp;p&nbsp;rather&nbsp;than&nbsp;pg,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3226834">//&nbsp;but&nbsp;also&nbsp;associate&nbsp;with&nbsp;p&nbsp;if&nbsp;we&nbsp;are&nbsp;at&nbsp;the&nbsp;end&nbsp;(q&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3226899">assoc</span>&nbsp;<span class="op" id="3226905">=</span>&nbsp;<span class="ident" id="3226907">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3226912">default</span><span class="op" id="3226919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3226925">//&nbsp;otherwise,&nbsp;associate&nbsp;comment&nbsp;with&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3226979">if</span>&nbsp;<span class="ident" id="3226982">q</span>&nbsp;<span class="op" id="3226984">==</span>&nbsp;<span class="builtintype" id="3226987">nil</span>&nbsp;<span class="op" id="3226991">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3226998">//&nbsp;we&nbsp;can&nbsp;only&nbsp;reach&nbsp;here&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3227047">//&nbsp;which&nbsp;would&nbsp;imply&nbsp;that&nbsp;there&nbsp;were&nbsp;no&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3227098">panic</span><span class="op" id="3227103">(</span><span class="string" id="3227104">&#34;internal&nbsp;error:&nbsp;no&nbsp;comments&nbsp;should&nbsp;be&nbsp;associated&nbsp;with&nbsp;sentinel&#34;</span><span class="op" id="3227168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3227174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3227180">assoc</span>&nbsp;<span class="op" id="3227186">=</span>&nbsp;<span class="ident" id="3227188">q</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3227193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3227198">cmap</span><span class="op" id="3227202">.</span><span class="ident" id="3227203">addComment</span><span class="op" id="3227213">(</span><span class="ident" id="3227214">assoc</span><span class="op" id="3227219">,</span>&nbsp;<span class="ident" id="3227221">r</span><span class="op" id="3227222">.</span><span class="ident" id="3227223">comment</span><span class="op" id="3227230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3227235">if</span>&nbsp;<span class="ident" id="3227238">r</span><span class="op" id="3227239">.</span><span class="ident" id="3227240">eol</span><span class="op" id="3227243">(</span><span class="op" id="3227244">)</span>&nbsp;<span class="op" id="3227246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3227252">return</span>&nbsp;<span class="ident" id="3227259">cmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3227267">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3227272">r</span><span class="op" id="3227273">.</span><span class="ident" id="3227274">next</span><span class="op" id="3227278">(</span><span class="op" id="3227279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3227283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3227288">//&nbsp;update&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3227314">p</span>&nbsp;<span class="op" id="3227316">=</span>&nbsp;<span class="ident" id="3227318">q</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3227322">pend</span>&nbsp;<span class="op" id="3227327">=</span>&nbsp;<span class="ident" id="3227329">fset</span><span class="op" id="3227333">.</span><span class="ident" id="3227334">Position</span><span class="op" id="3227342">(</span><span class="ident" id="3227343">p</span><span class="op" id="3227344">.</span><span class="ident" id="3227345">End</span><span class="op" id="3227348">(</span><span class="op" id="3227349">)</span><span class="op" id="3227350">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3227355">//&nbsp;update&nbsp;previous&nbsp;node&nbsp;group&nbsp;if&nbsp;we&nbsp;see&nbsp;an&nbsp;&#34;important&#34;&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3227417">switch</span>&nbsp;<span class="ident" id="3227424">q</span><span class="op" id="3227425">.</span><span class="op" id="3227426">(</span><span class="keyword" id="3227427">type</span><span class="op" id="3227431">)</span>&nbsp;<span class="op" id="3227433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3227437">case</span>&nbsp;<span class="op" id="3227442">*</span><span class="ident" id="3227443">File</span><span class="op" id="3227447">,</span>&nbsp;<span class="op" id="3227449">*</span><span class="ident" id="3227450">Field</span><span class="op" id="3227455">,</span>&nbsp;<span class="ident" id="3227457">Decl</span><span class="op" id="3227461">,</span>&nbsp;<span class="ident" id="3227463">Spec</span><span class="op" id="3227467">,</span>&nbsp;<span class="ident" id="3227469">Stmt</span><span class="op" id="3227473">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3227478">stack</span><span class="op" id="3227483">.</span><span class="ident" id="3227484">push</span><span class="op" id="3227488">(</span><span class="ident" id="3227489">q</span><span class="op" id="3227490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3227494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3227497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3227501">return</span>&nbsp;<span class="ident" id="3227508">cmap</span><br>
<span class="lineno">240</span><span class="op" id="3227513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3227516">//&nbsp;Update&nbsp;replaces&nbsp;an&nbsp;old&nbsp;node&nbsp;in&nbsp;the&nbsp;comment&nbsp;map&nbsp;with&nbsp;the&nbsp;new&nbsp;node</span><br>
<span class="lineno"></span><span class="comment" id="3227584">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;node.&nbsp;Comments&nbsp;that&nbsp;were&nbsp;associated&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3227652">//&nbsp;old&nbsp;node&nbsp;are&nbsp;associated&nbsp;with&nbsp;the&nbsp;new&nbsp;node.</span><br>
<span class="lineno">245</span><span class="comment" id="3227698">//</span><br>
<span class="lineno"></span><span class="keyword" id="3227701">func</span>&nbsp;<span class="op" id="3227706">(</span><span class="ident" id="3227707">cmap</span>&nbsp;<span class="ident" id="3227712">CommentMap</span><span class="op" id="3227722">)</span>&nbsp;<span class="ident" id="3227724">Update</span><span class="op" id="3227730">(</span><span class="ident" id="3227731">old</span><span class="op" id="3227734">,</span>&nbsp;<span class="builtinfunc" id="3227736">new</span>&nbsp;<span class="ident" id="3227740">Node</span><span class="op" id="3227744">)</span>&nbsp;<span class="ident" id="3227746">Node</span>&nbsp;<span class="op" id="3227751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3227754">if</span>&nbsp;<span class="ident" id="3227757">list</span>&nbsp;<span class="op" id="3227762">:=</span>&nbsp;<span class="ident" id="3227765">cmap</span><span class="op" id="3227769">[</span><span class="ident" id="3227770">old</span><span class="op" id="3227773">]</span><span class="op" id="3227774">;</span>&nbsp;<span class="builtinfunc" id="3227776">len</span><span class="op" id="3227779">(</span><span class="ident" id="3227780">list</span><span class="op" id="3227784">)</span>&nbsp;<span class="op" id="3227786">&gt;</span>&nbsp;<span class="num" id="3227788">0</span>&nbsp;<span class="op" id="3227790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3227794">delete</span><span class="op" id="3227800">(</span><span class="ident" id="3227801">cmap</span><span class="op" id="3227805">,</span>&nbsp;<span class="ident" id="3227807">old</span><span class="op" id="3227810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3227814">cmap</span><span class="op" id="3227818">[</span><span class="builtinfunc" id="3227819">new</span><span class="op" id="3227822">]</span>&nbsp;<span class="op" id="3227824">=</span>&nbsp;<span class="builtinfunc" id="3227826">append</span><span class="op" id="3227832">(</span><span class="ident" id="3227833">cmap</span><span class="op" id="3227837">[</span><span class="builtinfunc" id="3227838">new</span><span class="op" id="3227841">]</span><span class="op" id="3227842">,</span>&nbsp;<span class="ident" id="3227844">list</span><span class="op" id="3227848">...</span><span class="op" id="3227851">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3227854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3227857">return</span>&nbsp;<span class="builtinfunc" id="3227864">new</span><br>
<span class="lineno"></span><span class="op" id="3227868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3227871">//&nbsp;Filter&nbsp;returns&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;consisting&nbsp;of&nbsp;only&nbsp;those</span><br>
<span class="lineno">255</span><span class="comment" id="3227932">//&nbsp;entries&nbsp;of&nbsp;cmap&nbsp;for&nbsp;which&nbsp;a&nbsp;corresponding&nbsp;node&nbsp;exists&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3227992">//&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="3228022">//</span><br>
<span class="lineno"></span><span class="keyword" id="3228025">func</span>&nbsp;<span class="op" id="3228030">(</span><span class="ident" id="3228031">cmap</span>&nbsp;<span class="ident" id="3228036">CommentMap</span><span class="op" id="3228046">)</span>&nbsp;<span class="ident" id="3228048">Filter</span><span class="op" id="3228054">(</span><span class="ident" id="3228055">node</span>&nbsp;<span class="ident" id="3228060">Node</span><span class="op" id="3228064">)</span>&nbsp;<span class="ident" id="3228066">CommentMap</span>&nbsp;<span class="op" id="3228077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3228080">umap</span>&nbsp;<span class="op" id="3228085">:=</span>&nbsp;<span class="builtinfunc" id="3228088">make</span><span class="op" id="3228092">(</span><span class="ident" id="3228093">CommentMap</span><span class="op" id="3228103">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3228106">Inspect</span><span class="op" id="3228113">(</span><span class="ident" id="3228114">node</span><span class="op" id="3228118">,</span>&nbsp;<span class="keyword" id="3228120">func</span><span class="op" id="3228124">(</span><span class="ident" id="3228125">n</span>&nbsp;<span class="ident" id="3228127">Node</span><span class="op" id="3228131">)</span>&nbsp;<span class="builtintype" id="3228133">bool</span>&nbsp;<span class="op" id="3228138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3228142">if</span>&nbsp;<span class="ident" id="3228145">g</span>&nbsp;<span class="op" id="3228147">:=</span>&nbsp;<span class="ident" id="3228150">cmap</span><span class="op" id="3228154">[</span><span class="ident" id="3228155">n</span><span class="op" id="3228156">]</span><span class="op" id="3228157">;</span>&nbsp;<span class="builtinfunc" id="3228159">len</span><span class="op" id="3228162">(</span><span class="ident" id="3228163">g</span><span class="op" id="3228164">)</span>&nbsp;<span class="op" id="3228166">&gt;</span>&nbsp;<span class="num" id="3228168">0</span>&nbsp;<span class="op" id="3228170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3228175">umap</span><span class="op" id="3228179">[</span><span class="ident" id="3228180">n</span><span class="op" id="3228181">]</span>&nbsp;<span class="op" id="3228183">=</span>&nbsp;<span class="ident" id="3228185">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3228189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3228193">return</span>&nbsp;<span class="builtintype" id="3228200">true</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3228206">}</span><span class="op" id="3228207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3228210">return</span>&nbsp;<span class="ident" id="3228217">umap</span><br>
<span class="lineno"></span><span class="op" id="3228222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3228225">//&nbsp;Comments&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;the&nbsp;comment&nbsp;map.</span><br>
<span class="lineno">270</span><span class="comment" id="3228292">//&nbsp;The&nbsp;result&nbsp;is&nbsp;sorted&nbsp;is&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="3228333">//</span><br>
<span class="lineno"></span><span class="keyword" id="3228336">func</span>&nbsp;<span class="op" id="3228341">(</span><span class="ident" id="3228342">cmap</span>&nbsp;<span class="ident" id="3228347">CommentMap</span><span class="op" id="3228357">)</span>&nbsp;<span class="ident" id="3228359">Comments</span><span class="op" id="3228367">(</span><span class="op" id="3228368">)</span>&nbsp;<span class="op" id="3228370">[</span><span class="op" id="3228371">]</span><span class="op" id="3228372">*</span><span class="ident" id="3228373">CommentGroup</span>&nbsp;<span class="op" id="3228386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3228389">list</span>&nbsp;<span class="op" id="3228394">:=</span>&nbsp;<span class="builtinfunc" id="3228397">make</span><span class="op" id="3228401">(</span><span class="op" id="3228402">[</span><span class="op" id="3228403">]</span><span class="op" id="3228404">*</span><span class="ident" id="3228405">CommentGroup</span><span class="op" id="3228417">,</span>&nbsp;<span class="num" id="3228419">0</span><span class="op" id="3228420">,</span>&nbsp;<span class="builtinfunc" id="3228422">len</span><span class="op" id="3228425">(</span><span class="ident" id="3228426">cmap</span><span class="op" id="3228430">)</span><span class="op" id="3228431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3228434">for</span>&nbsp;<span class="ident" id="3228438">_</span><span class="op" id="3228439">,</span>&nbsp;<span class="ident" id="3228441">e</span>&nbsp;<span class="op" id="3228443">:=</span>&nbsp;<span class="keyword" id="3228446">range</span>&nbsp;<span class="ident" id="3228452">cmap</span>&nbsp;<span class="op" id="3228457">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3228461">list</span>&nbsp;<span class="op" id="3228466">=</span>&nbsp;<span class="builtinfunc" id="3228468">append</span><span class="op" id="3228474">(</span><span class="ident" id="3228475">list</span><span class="op" id="3228479">,</span>&nbsp;<span class="ident" id="3228481">e</span><span class="op" id="3228482">...</span><span class="op" id="3228485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3228488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3228491">sortComments</span><span class="op" id="3228503">(</span><span class="ident" id="3228504">list</span><span class="op" id="3228508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3228511">return</span>&nbsp;<span class="ident" id="3228518">list</span><br>
<span class="lineno"></span><span class="op" id="3228523">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="3228526">func</span>&nbsp;<span class="ident" id="3228531">summary</span><span class="op" id="3228538">(</span><span class="ident" id="3228539">list</span>&nbsp;<span class="op" id="3228544">[</span><span class="op" id="3228545">]</span><span class="op" id="3228546">*</span><span class="ident" id="3228547">CommentGroup</span><span class="op" id="3228559">)</span>&nbsp;<span class="builtintype" id="3228561">string</span>&nbsp;<span class="op" id="3228568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3228571">const</span>&nbsp;<span class="ident" id="3228577">maxLen</span>&nbsp;<span class="op" id="3228584">=</span>&nbsp;<span class="num" id="3228586">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3228590">var</span>&nbsp;<span class="ident" id="3228594">buf</span>&nbsp;<span class="ident" id="3228598">bytes</span><span class="op" id="3228603">.</span><span class="ident" id="3228604">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3228613">//&nbsp;collect&nbsp;comments&nbsp;text</span><br>
<span class="lineno"></span><span class="ident" id="3228638">loop</span><span class="op" id="3228642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3228645">for</span>&nbsp;<span class="ident" id="3228649">_</span><span class="op" id="3228650">,</span>&nbsp;<span class="ident" id="3228652">group</span>&nbsp;<span class="op" id="3228658">:=</span>&nbsp;<span class="keyword" id="3228661">range</span>&nbsp;<span class="ident" id="3228667">list</span>&nbsp;<span class="op" id="3228672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3228676">//&nbsp;Note:&nbsp;CommentGroup.Text()&nbsp;does&nbsp;too&nbsp;much&nbsp;work&nbsp;for&nbsp;what&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3228738">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;need&nbsp;and&nbsp;would&nbsp;only&nbsp;replace&nbsp;this&nbsp;innermost&nbsp;loop.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3228798">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;do&nbsp;it&nbsp;explicitly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3228832">for</span>&nbsp;<span class="ident" id="3228836">_</span><span class="op" id="3228837">,</span>&nbsp;<span class="ident" id="3228839">comment</span>&nbsp;<span class="op" id="3228847">:=</span>&nbsp;<span class="keyword" id="3228850">range</span>&nbsp;<span class="ident" id="3228856">group</span><span class="op" id="3228861">.</span><span class="ident" id="3228862">List</span>&nbsp;<span class="op" id="3228867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3228872">if</span>&nbsp;<span class="ident" id="3228875">buf</span><span class="op" id="3228878">.</span><span class="ident" id="3228879">Len</span><span class="op" id="3228882">(</span><span class="op" id="3228883">)</span>&nbsp;<span class="op" id="3228885">&gt;=</span>&nbsp;<span class="ident" id="3228888">maxLen</span>&nbsp;<span class="op" id="3228895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3228901">break</span>&nbsp;<span class="ident" id="3228907">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3228915">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3228920">buf</span><span class="op" id="3228923">.</span><span class="ident" id="3228924">WriteString</span><span class="op" id="3228935">(</span><span class="ident" id="3228936">comment</span><span class="op" id="3228943">.</span><span class="ident" id="3228944">Text</span><span class="op" id="3228948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3228952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3228955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3228959">//&nbsp;truncate&nbsp;if&nbsp;too&nbsp;long</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3228984">if</span>&nbsp;<span class="ident" id="3228987">buf</span><span class="op" id="3228990">.</span><span class="ident" id="3228991">Len</span><span class="op" id="3228994">(</span><span class="op" id="3228995">)</span>&nbsp;<span class="op" id="3228997">&gt;</span>&nbsp;<span class="ident" id="3228999">maxLen</span>&nbsp;<span class="op" id="3229006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3229010">buf</span><span class="op" id="3229013">.</span><span class="ident" id="3229014">Truncate</span><span class="op" id="3229022">(</span><span class="ident" id="3229023">maxLen</span>&nbsp;<span class="op" id="3229030">-</span>&nbsp;<span class="num" id="3229032">3</span><span class="op" id="3229033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3229037">buf</span><span class="op" id="3229040">.</span><span class="ident" id="3229041">WriteString</span><span class="op" id="3229052">(</span><span class="string" id="3229053">&#34;...&#34;</span><span class="op" id="3229058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3229061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3229065">//&nbsp;replace&nbsp;any&nbsp;invisibles&nbsp;with&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3229104">bytes</span>&nbsp;<span class="op" id="3229110">:=</span>&nbsp;<span class="ident" id="3229113">buf</span><span class="op" id="3229116">.</span><span class="ident" id="3229117">Bytes</span><span class="op" id="3229122">(</span><span class="op" id="3229123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3229126">for</span>&nbsp;<span class="ident" id="3229130">i</span><span class="op" id="3229131">,</span>&nbsp;<span class="ident" id="3229133">b</span>&nbsp;<span class="op" id="3229135">:=</span>&nbsp;<span class="keyword" id="3229138">range</span>&nbsp;<span class="ident" id="3229144">bytes</span>&nbsp;<span class="op" id="3229150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3229154">switch</span>&nbsp;<span class="ident" id="3229161">b</span>&nbsp;<span class="op" id="3229163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3229167">case</span>&nbsp;<span class="string" id="3229172">&#39;\t&#39;</span><span class="op" id="3229176">,</span>&nbsp;<span class="string" id="3229178">&#39;\n&#39;</span><span class="op" id="3229182">,</span>&nbsp;<span class="string" id="3229184">&#39;\r&#39;</span><span class="op" id="3229188">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3229193">bytes</span><span class="op" id="3229198">[</span><span class="ident" id="3229199">i</span><span class="op" id="3229200">]</span>&nbsp;<span class="op" id="3229202">=</span>&nbsp;<span class="string" id="3229204">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3229210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3229213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3229217">return</span>&nbsp;<span class="builtintype" id="3229224">string</span><span class="op" id="3229230">(</span><span class="ident" id="3229231">bytes</span><span class="op" id="3229236">)</span><br>
<span class="lineno">315</span><span class="op" id="3229238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3229241">func</span>&nbsp;<span class="op" id="3229246">(</span><span class="ident" id="3229247">cmap</span>&nbsp;<span class="ident" id="3229252">CommentMap</span><span class="op" id="3229262">)</span>&nbsp;<span class="ident" id="3229264">String</span><span class="op" id="3229270">(</span><span class="op" id="3229271">)</span>&nbsp;<span class="builtintype" id="3229273">string</span>&nbsp;<span class="op" id="3229280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3229283">var</span>&nbsp;<span class="ident" id="3229287">buf</span>&nbsp;<span class="ident" id="3229291">bytes</span><span class="op" id="3229296">.</span><span class="ident" id="3229297">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3229305">fmt</span><span class="op" id="3229308">.</span><span class="ident" id="3229309">Fprintln</span><span class="op" id="3229317">(</span><span class="op" id="3229318">&amp;</span><span class="ident" id="3229319">buf</span><span class="op" id="3229322">,</span>&nbsp;<span class="string" id="3229324">&#34;CommentMap&nbsp;{&#34;</span><span class="op" id="3229338">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3229341">for</span>&nbsp;<span class="ident" id="3229345">node</span><span class="op" id="3229349">,</span>&nbsp;<span class="ident" id="3229351">comment</span>&nbsp;<span class="op" id="3229359">:=</span>&nbsp;<span class="keyword" id="3229362">range</span>&nbsp;<span class="ident" id="3229368">cmap</span>&nbsp;<span class="op" id="3229373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3229377">//&nbsp;print&nbsp;name&nbsp;of&nbsp;identifiers;&nbsp;print&nbsp;node&nbsp;type&nbsp;for&nbsp;other&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3229441">var</span>&nbsp;<span class="ident" id="3229445">s</span>&nbsp;<span class="builtintype" id="3229447">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3229456">if</span>&nbsp;<span class="ident" id="3229459">ident</span><span class="op" id="3229464">,</span>&nbsp;<span class="ident" id="3229466">ok</span>&nbsp;<span class="op" id="3229469">:=</span>&nbsp;<span class="ident" id="3229472">node</span><span class="op" id="3229476">.</span><span class="op" id="3229477">(</span><span class="op" id="3229478">*</span><span class="ident" id="3229479">Ident</span><span class="op" id="3229484">)</span><span class="op" id="3229485">;</span>&nbsp;<span class="ident" id="3229487">ok</span>&nbsp;<span class="op" id="3229490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3229495">s</span>&nbsp;<span class="op" id="3229497">=</span>&nbsp;<span class="ident" id="3229499">ident</span><span class="op" id="3229504">.</span><span class="ident" id="3229505">Name</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3229512">}</span>&nbsp;<span class="keyword" id="3229514">else</span>&nbsp;<span class="op" id="3229519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3229524">s</span>&nbsp;<span class="op" id="3229526">=</span>&nbsp;<span class="ident" id="3229528">fmt</span><span class="op" id="3229531">.</span><span class="ident" id="3229532">Sprintf</span><span class="op" id="3229539">(</span><span class="string" id="3229540">&#34;%T&#34;</span><span class="op" id="3229544">,</span>&nbsp;<span class="ident" id="3229546">node</span><span class="op" id="3229550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3229554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3229558">fmt</span><span class="op" id="3229561">.</span><span class="ident" id="3229562">Fprintf</span><span class="op" id="3229569">(</span><span class="op" id="3229570">&amp;</span><span class="ident" id="3229571">buf</span><span class="op" id="3229574">,</span>&nbsp;<span class="string" id="3229576">&#34;\t%p&nbsp;&nbsp;%20s:&nbsp;&nbsp;%s\n&#34;</span><span class="op" id="3229595">,</span>&nbsp;<span class="ident" id="3229597">node</span><span class="op" id="3229601">,</span>&nbsp;<span class="ident" id="3229603">s</span><span class="op" id="3229604">,</span>&nbsp;<span class="ident" id="3229606">summary</span><span class="op" id="3229613">(</span><span class="ident" id="3229614">comment</span><span class="op" id="3229621">)</span><span class="op" id="3229622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3229625">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3229628">fmt</span><span class="op" id="3229631">.</span><span class="ident" id="3229632">Fprintln</span><span class="op" id="3229640">(</span><span class="op" id="3229641">&amp;</span><span class="ident" id="3229642">buf</span><span class="op" id="3229645">,</span>&nbsp;<span class="string" id="3229647">&#34;}&#34;</span><span class="op" id="3229650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3229653">return</span>&nbsp;<span class="ident" id="3229660">buf</span><span class="op" id="3229663">.</span><span class="ident" id="3229664">String</span><span class="op" id="3229670">(</span><span class="op" id="3229671">)</span><br>
<span class="lineno"></span><span class="op" id="3229673">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
