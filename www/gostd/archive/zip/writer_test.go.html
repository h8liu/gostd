<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7702164">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7702219">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7702273">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7702324">package</span>&nbsp;<span class="ident" id="7702332">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7702337">import</span>&nbsp;<span class="op" id="7702344">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7702347">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7702356">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7702362">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7702375">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7702388">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7702394">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7702404">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7702407">//&nbsp;TODO(adg):&nbsp;a&nbsp;more&nbsp;sophisticated&nbsp;test&nbsp;suite</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7702454">type</span>&nbsp;<span class="ident" id="7702459">WriteTest</span>&nbsp;<span class="keyword" id="7702469">struct</span>&nbsp;<span class="op" id="7702476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702479">Name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7702486">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702494">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7702501">[</span><span class="op" id="7702502">]</span><span class="builtintype" id="7702503">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702509">Method</span>&nbsp;<span class="builtintype" id="7702516">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702524">Mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7702531">os</span><span class="op" id="7702533">.</span><span class="ident" id="7702534">FileMode</span><br>
<span class="lineno"></span><span class="op" id="7702543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7702546">var</span>&nbsp;<span class="ident" id="7702550">writeTests</span>&nbsp;<span class="op" id="7702561">=</span>&nbsp;<span class="op" id="7702563">[</span><span class="op" id="7702564">]</span><span class="ident" id="7702565">WriteTest</span><span class="op" id="7702574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702581">Name</span><span class="op" id="7702585">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7702589">&#34;foo&#34;</span><span class="op" id="7702594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702598">Data</span><span class="op" id="7702602">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7702606">[</span><span class="op" id="7702607">]</span><span class="builtintype" id="7702608">byte</span><span class="op" id="7702612">(</span><span class="string" id="7702613">&#34;Rabbits,&nbsp;guinea&nbsp;pigs,&nbsp;gophers,&nbsp;marsupial&nbsp;rats,&nbsp;and&nbsp;quolls.&#34;</span><span class="op" id="7702673">)</span><span class="op" id="7702674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702678">Method</span><span class="op" id="7702684">:</span>&nbsp;<span class="ident" id="7702686">Store</span><span class="op" id="7702691">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702695">Mode</span><span class="op" id="7702699">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7702703">0666</span><span class="op" id="7702707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702710">}</span><span class="op" id="7702711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702718">Name</span><span class="op" id="7702722">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7702726">&#34;bar&#34;</span><span class="op" id="7702731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702735">Data</span><span class="op" id="7702739">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7702743">nil</span><span class="op" id="7702746">,</span>&nbsp;<span class="comment" id="7702748">//&nbsp;large&nbsp;data&nbsp;set&nbsp;in&nbsp;the&nbsp;test</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702780">Method</span><span class="op" id="7702786">:</span>&nbsp;<span class="ident" id="7702788">Deflate</span><span class="op" id="7702795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702799">Mode</span><span class="op" id="7702803">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7702807">0644</span><span class="op" id="7702811">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702814">}</span><span class="op" id="7702815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702822">Name</span><span class="op" id="7702826">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7702830">&#34;setuid&#34;</span><span class="op" id="7702838">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702842">Data</span><span class="op" id="7702846">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7702850">[</span><span class="op" id="7702851">]</span><span class="builtintype" id="7702852">byte</span><span class="op" id="7702856">(</span><span class="string" id="7702857">&#34;setuid&nbsp;file&#34;</span><span class="op" id="7702870">)</span><span class="op" id="7702871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702875">Method</span><span class="op" id="7702881">:</span>&nbsp;<span class="ident" id="7702883">Deflate</span><span class="op" id="7702890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702894">Mode</span><span class="op" id="7702898">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7702902">0755</span>&nbsp;<span class="op" id="7702907">|</span>&nbsp;<span class="ident" id="7702909">os</span><span class="op" id="7702911">.</span><span class="ident" id="7702912">ModeSetuid</span><span class="op" id="7702922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702925">}</span><span class="op" id="7702926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702929">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702933">Name</span><span class="op" id="7702937">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7702941">&#34;setgid&#34;</span><span class="op" id="7702949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702953">Data</span><span class="op" id="7702957">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7702961">[</span><span class="op" id="7702962">]</span><span class="builtintype" id="7702963">byte</span><span class="op" id="7702967">(</span><span class="string" id="7702968">&#34;setgid&nbsp;file&#34;</span><span class="op" id="7702981">)</span><span class="op" id="7702982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702986">Method</span><span class="op" id="7702992">:</span>&nbsp;<span class="ident" id="7702994">Deflate</span><span class="op" id="7703001">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703005">Mode</span><span class="op" id="7703009">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7703013">0755</span>&nbsp;<span class="op" id="7703018">|</span>&nbsp;<span class="ident" id="7703020">os</span><span class="op" id="7703022">.</span><span class="ident" id="7703023">ModeSetgid</span><span class="op" id="7703033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703036">}</span><span class="op" id="7703037">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703044">Name</span><span class="op" id="7703048">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7703052">&#34;symlink&#34;</span><span class="op" id="7703061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703065">Data</span><span class="op" id="7703069">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7703073">[</span><span class="op" id="7703074">]</span><span class="builtintype" id="7703075">byte</span><span class="op" id="7703079">(</span><span class="string" id="7703080">&#34;../link/target&#34;</span><span class="op" id="7703096">)</span><span class="op" id="7703097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703101">Method</span><span class="op" id="7703107">:</span>&nbsp;<span class="ident" id="7703109">Deflate</span><span class="op" id="7703116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703120">Mode</span><span class="op" id="7703124">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7703128">0755</span>&nbsp;<span class="op" id="7703133">|</span>&nbsp;<span class="ident" id="7703135">os</span><span class="op" id="7703137">.</span><span class="ident" id="7703138">ModeSymlink</span><span class="op" id="7703149">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703152">}</span><span class="op" id="7703153">,</span><br>
<span class="lineno"></span><span class="op" id="7703155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7703158">func</span>&nbsp;<span class="ident" id="7703163">TestWriter</span><span class="op" id="7703173">(</span><span class="ident" id="7703174">t</span>&nbsp;<span class="op" id="7703176">*</span><span class="ident" id="7703177">testing</span><span class="op" id="7703184">.</span><span class="ident" id="7703185">T</span><span class="op" id="7703186">)</span>&nbsp;<span class="op" id="7703188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703191">largeData</span>&nbsp;<span class="op" id="7703201">:=</span>&nbsp;<span class="builtinfunc" id="7703204">make</span><span class="op" id="7703208">(</span><span class="op" id="7703209">[</span><span class="op" id="7703210">]</span><span class="builtintype" id="7703211">byte</span><span class="op" id="7703215">,</span>&nbsp;<span class="num" id="7703217">1</span><span class="op" id="7703218">&lt;&lt;</span><span class="num" id="7703220">17</span><span class="op" id="7703222">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703225">for</span>&nbsp;<span class="ident" id="7703229">i</span>&nbsp;<span class="op" id="7703231">:=</span>&nbsp;<span class="keyword" id="7703234">range</span>&nbsp;<span class="ident" id="7703240">largeData</span>&nbsp;<span class="op" id="7703250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703254">largeData</span><span class="op" id="7703263">[</span><span class="ident" id="7703264">i</span><span class="op" id="7703265">]</span>&nbsp;<span class="op" id="7703267">=</span>&nbsp;<span class="builtintype" id="7703269">byte</span><span class="op" id="7703273">(</span><span class="ident" id="7703274">rand</span><span class="op" id="7703278">.</span><span class="ident" id="7703279">Int</span><span class="op" id="7703282">(</span><span class="op" id="7703283">)</span><span class="op" id="7703284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703290">writeTests</span><span class="op" id="7703300">[</span><span class="num" id="7703301">1</span><span class="op" id="7703302">]</span><span class="op" id="7703303">.</span><span class="ident" id="7703304">Data</span>&nbsp;<span class="op" id="7703309">=</span>&nbsp;<span class="ident" id="7703311">largeData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703322">defer</span>&nbsp;<span class="keyword" id="7703328">func</span><span class="op" id="7703332">(</span><span class="op" id="7703333">)</span>&nbsp;<span class="op" id="7703335">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703339">writeTests</span><span class="op" id="7703349">[</span><span class="num" id="7703350">1</span><span class="op" id="7703351">]</span><span class="op" id="7703352">.</span><span class="ident" id="7703353">Data</span>&nbsp;<span class="op" id="7703358">=</span>&nbsp;<span class="ident" id="7703360">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703365">}</span><span class="op" id="7703366">(</span><span class="op" id="7703367">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7703371">//&nbsp;write&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703392">buf</span>&nbsp;<span class="op" id="7703396">:=</span>&nbsp;<span class="builtinfunc" id="7703399">new</span><span class="op" id="7703402">(</span><span class="ident" id="7703403">bytes</span><span class="op" id="7703408">.</span><span class="ident" id="7703409">Buffer</span><span class="op" id="7703415">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703418">w</span>&nbsp;<span class="op" id="7703420">:=</span>&nbsp;<span class="ident" id="7703423">NewWriter</span><span class="op" id="7703432">(</span><span class="ident" id="7703433">buf</span><span class="op" id="7703436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703440">for</span>&nbsp;<span class="ident" id="7703444">_</span><span class="op" id="7703445">,</span>&nbsp;<span class="ident" id="7703447">wt</span>&nbsp;<span class="op" id="7703450">:=</span>&nbsp;<span class="keyword" id="7703453">range</span>&nbsp;<span class="ident" id="7703459">writeTests</span>&nbsp;<span class="op" id="7703470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703474">testCreate</span><span class="op" id="7703484">(</span><span class="ident" id="7703485">t</span><span class="op" id="7703486">,</span>&nbsp;<span class="ident" id="7703488">w</span><span class="op" id="7703489">,</span>&nbsp;<span class="op" id="7703491">&amp;</span><span class="ident" id="7703492">wt</span><span class="op" id="7703494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703497">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703501">if</span>&nbsp;<span class="ident" id="7703504">err</span>&nbsp;<span class="op" id="7703508">:=</span>&nbsp;<span class="ident" id="7703511">w</span><span class="op" id="7703512">.</span><span class="ident" id="7703513">Close</span><span class="op" id="7703518">(</span><span class="op" id="7703519">)</span><span class="op" id="7703520">;</span>&nbsp;<span class="ident" id="7703522">err</span>&nbsp;<span class="op" id="7703526">!=</span>&nbsp;<span class="ident" id="7703529">nil</span>&nbsp;<span class="op" id="7703533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703537">t</span><span class="op" id="7703538">.</span><span class="ident" id="7703539">Fatal</span><span class="op" id="7703544">(</span><span class="ident" id="7703545">err</span><span class="op" id="7703548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7703555">//&nbsp;read&nbsp;it&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703572">r</span><span class="op" id="7703573">,</span>&nbsp;<span class="ident" id="7703575">err</span>&nbsp;<span class="op" id="7703579">:=</span>&nbsp;<span class="ident" id="7703582">NewReader</span><span class="op" id="7703591">(</span><span class="ident" id="7703592">bytes</span><span class="op" id="7703597">.</span><span class="ident" id="7703598">NewReader</span><span class="op" id="7703607">(</span><span class="ident" id="7703608">buf</span><span class="op" id="7703611">.</span><span class="ident" id="7703612">Bytes</span><span class="op" id="7703617">(</span><span class="op" id="7703618">)</span><span class="op" id="7703619">)</span><span class="op" id="7703620">,</span>&nbsp;<span class="ident" id="7703622">int64</span><span class="op" id="7703627">(</span><span class="ident" id="7703628">buf</span><span class="op" id="7703631">.</span><span class="ident" id="7703632">Len</span><span class="op" id="7703635">(</span><span class="op" id="7703636">)</span><span class="op" id="7703637">)</span><span class="op" id="7703638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703641">if</span>&nbsp;<span class="ident" id="7703644">err</span>&nbsp;<span class="op" id="7703648">!=</span>&nbsp;<span class="ident" id="7703651">nil</span>&nbsp;<span class="op" id="7703655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703659">t</span><span class="op" id="7703660">.</span><span class="ident" id="7703661">Fatal</span><span class="op" id="7703666">(</span><span class="ident" id="7703667">err</span><span class="op" id="7703670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703673">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703676">for</span>&nbsp;<span class="ident" id="7703680">i</span><span class="op" id="7703681">,</span>&nbsp;<span class="ident" id="7703683">wt</span>&nbsp;<span class="op" id="7703686">:=</span>&nbsp;<span class="keyword" id="7703689">range</span>&nbsp;<span class="ident" id="7703695">writeTests</span>&nbsp;<span class="op" id="7703706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703710">testReadFile</span><span class="op" id="7703722">(</span><span class="ident" id="7703723">t</span><span class="op" id="7703724">,</span>&nbsp;<span class="ident" id="7703726">r</span><span class="op" id="7703727">.</span><span class="ident" id="7703728">File</span><span class="op" id="7703732">[</span><span class="ident" id="7703733">i</span><span class="op" id="7703734">]</span><span class="op" id="7703735">,</span>&nbsp;<span class="op" id="7703737">&amp;</span><span class="ident" id="7703738">wt</span><span class="op" id="7703740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703743">}</span><br>
<span class="lineno"></span><span class="op" id="7703745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7703748">func</span>&nbsp;<span class="ident" id="7703753">TestWriterFlush</span><span class="op" id="7703768">(</span><span class="ident" id="7703769">t</span>&nbsp;<span class="op" id="7703771">*</span><span class="ident" id="7703772">testing</span><span class="op" id="7703779">.</span><span class="ident" id="7703780">T</span><span class="op" id="7703781">)</span>&nbsp;<span class="op" id="7703783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703786">var</span>&nbsp;<span class="ident" id="7703790">buf</span>&nbsp;<span class="ident" id="7703794">bytes</span><span class="op" id="7703799">.</span><span class="ident" id="7703800">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703808">w</span>&nbsp;<span class="op" id="7703810">:=</span>&nbsp;<span class="ident" id="7703813">NewWriter</span><span class="op" id="7703822">(</span><span class="keyword" id="7703823">struct</span><span class="op" id="7703829">{</span>&nbsp;<span class="ident" id="7703831">io</span><span class="op" id="7703833">.</span><span class="ident" id="7703834">Writer</span>&nbsp;<span class="op" id="7703841">}</span><span class="op" id="7703842">{</span><span class="op" id="7703843">&amp;</span><span class="ident" id="7703844">buf</span><span class="op" id="7703847">}</span><span class="op" id="7703848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703851">_</span><span class="op" id="7703852">,</span>&nbsp;<span class="ident" id="7703854">err</span>&nbsp;<span class="op" id="7703858">:=</span>&nbsp;<span class="ident" id="7703861">w</span><span class="op" id="7703862">.</span><span class="ident" id="7703863">Create</span><span class="op" id="7703869">(</span><span class="string" id="7703870">&#34;foo&#34;</span><span class="op" id="7703875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703878">if</span>&nbsp;<span class="ident" id="7703881">err</span>&nbsp;<span class="op" id="7703885">!=</span>&nbsp;<span class="ident" id="7703888">nil</span>&nbsp;<span class="op" id="7703892">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703896">t</span><span class="op" id="7703897">.</span><span class="ident" id="7703898">Fatal</span><span class="op" id="7703903">(</span><span class="ident" id="7703904">err</span><span class="op" id="7703907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703913">if</span>&nbsp;<span class="ident" id="7703916">buf</span><span class="op" id="7703919">.</span><span class="ident" id="7703920">Len</span><span class="op" id="7703923">(</span><span class="op" id="7703924">)</span>&nbsp;<span class="op" id="7703926">&gt;</span>&nbsp;<span class="num" id="7703928">0</span>&nbsp;<span class="op" id="7703930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703934">t</span><span class="op" id="7703935">.</span><span class="ident" id="7703936">Fatalf</span><span class="op" id="7703942">(</span><span class="string" id="7703943">&#34;Unexpected&nbsp;%d&nbsp;bytes&nbsp;already&nbsp;in&nbsp;buffer&#34;</span><span class="op" id="7703982">,</span>&nbsp;<span class="ident" id="7703984">buf</span><span class="op" id="7703987">.</span><span class="ident" id="7703988">Len</span><span class="op" id="7703991">(</span><span class="op" id="7703992">)</span><span class="op" id="7703993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703996">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703999">if</span>&nbsp;<span class="ident" id="7704002">err</span>&nbsp;<span class="op" id="7704006">:=</span>&nbsp;<span class="ident" id="7704009">w</span><span class="op" id="7704010">.</span><span class="ident" id="7704011">Flush</span><span class="op" id="7704016">(</span><span class="op" id="7704017">)</span><span class="op" id="7704018">;</span>&nbsp;<span class="ident" id="7704020">err</span>&nbsp;<span class="op" id="7704024">!=</span>&nbsp;<span class="ident" id="7704027">nil</span>&nbsp;<span class="op" id="7704031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704035">t</span><span class="op" id="7704036">.</span><span class="ident" id="7704037">Fatal</span><span class="op" id="7704042">(</span><span class="ident" id="7704043">err</span><span class="op" id="7704046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704052">if</span>&nbsp;<span class="ident" id="7704055">buf</span><span class="op" id="7704058">.</span><span class="ident" id="7704059">Len</span><span class="op" id="7704062">(</span><span class="op" id="7704063">)</span>&nbsp;<span class="op" id="7704065">==</span>&nbsp;<span class="num" id="7704068">0</span>&nbsp;<span class="op" id="7704070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704074">t</span><span class="op" id="7704075">.</span><span class="ident" id="7704076">Fatal</span><span class="op" id="7704081">(</span><span class="string" id="7704082">&#34;No&nbsp;bytes&nbsp;written&nbsp;after&nbsp;Flush&#34;</span><span class="op" id="7704112">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704115">}</span><br>
<span class="lineno"></span><span class="op" id="7704117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7704120">func</span>&nbsp;<span class="ident" id="7704125">testCreate</span><span class="op" id="7704135">(</span><span class="ident" id="7704136">t</span>&nbsp;<span class="op" id="7704138">*</span><span class="ident" id="7704139">testing</span><span class="op" id="7704146">.</span><span class="ident" id="7704147">T</span><span class="op" id="7704148">,</span>&nbsp;<span class="ident" id="7704150">w</span>&nbsp;<span class="op" id="7704152">*</span><span class="ident" id="7704153">Writer</span><span class="op" id="7704159">,</span>&nbsp;<span class="ident" id="7704161">wt</span>&nbsp;<span class="op" id="7704164">*</span><span class="ident" id="7704165">WriteTest</span><span class="op" id="7704174">)</span>&nbsp;<span class="op" id="7704176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704179">header</span>&nbsp;<span class="op" id="7704186">:=</span>&nbsp;<span class="op" id="7704189">&amp;</span><span class="ident" id="7704190">FileHeader</span><span class="op" id="7704200">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704204">Name</span><span class="op" id="7704208">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7704212">wt</span><span class="op" id="7704214">.</span><span class="ident" id="7704215">Name</span><span class="op" id="7704219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704223">Method</span><span class="op" id="7704229">:</span>&nbsp;<span class="ident" id="7704231">wt</span><span class="op" id="7704233">.</span><span class="ident" id="7704234">Method</span><span class="op" id="7704240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704246">if</span>&nbsp;<span class="ident" id="7704249">wt</span><span class="op" id="7704251">.</span><span class="ident" id="7704252">Mode</span>&nbsp;<span class="op" id="7704257">!=</span>&nbsp;<span class="num" id="7704260">0</span>&nbsp;<span class="op" id="7704262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704266">header</span><span class="op" id="7704272">.</span><span class="ident" id="7704273">SetMode</span><span class="op" id="7704280">(</span><span class="ident" id="7704281">wt</span><span class="op" id="7704283">.</span><span class="ident" id="7704284">Mode</span><span class="op" id="7704288">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704294">f</span><span class="op" id="7704295">,</span>&nbsp;<span class="ident" id="7704297">err</span>&nbsp;<span class="op" id="7704301">:=</span>&nbsp;<span class="ident" id="7704304">w</span><span class="op" id="7704305">.</span><span class="ident" id="7704306">CreateHeader</span><span class="op" id="7704318">(</span><span class="ident" id="7704319">header</span><span class="op" id="7704325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704328">if</span>&nbsp;<span class="ident" id="7704331">err</span>&nbsp;<span class="op" id="7704335">!=</span>&nbsp;<span class="ident" id="7704338">nil</span>&nbsp;<span class="op" id="7704342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704346">t</span><span class="op" id="7704347">.</span><span class="ident" id="7704348">Fatal</span><span class="op" id="7704353">(</span><span class="ident" id="7704354">err</span><span class="op" id="7704357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704360">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704363">_</span><span class="op" id="7704364">,</span>&nbsp;<span class="ident" id="7704366">err</span>&nbsp;<span class="op" id="7704370">=</span>&nbsp;<span class="ident" id="7704372">f</span><span class="op" id="7704373">.</span><span class="ident" id="7704374">Write</span><span class="op" id="7704379">(</span><span class="ident" id="7704380">wt</span><span class="op" id="7704382">.</span><span class="ident" id="7704383">Data</span><span class="op" id="7704387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704390">if</span>&nbsp;<span class="ident" id="7704393">err</span>&nbsp;<span class="op" id="7704397">!=</span>&nbsp;<span class="ident" id="7704400">nil</span>&nbsp;<span class="op" id="7704404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704408">t</span><span class="op" id="7704409">.</span><span class="ident" id="7704410">Fatal</span><span class="op" id="7704415">(</span><span class="ident" id="7704416">err</span><span class="op" id="7704419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704422">}</span><br>
<span class="lineno"></span><span class="op" id="7704424">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7704427">func</span>&nbsp;<span class="ident" id="7704432">testReadFile</span><span class="op" id="7704444">(</span><span class="ident" id="7704445">t</span>&nbsp;<span class="op" id="7704447">*</span><span class="ident" id="7704448">testing</span><span class="op" id="7704455">.</span><span class="ident" id="7704456">T</span><span class="op" id="7704457">,</span>&nbsp;<span class="ident" id="7704459">f</span>&nbsp;<span class="op" id="7704461">*</span><span class="ident" id="7704462">File</span><span class="op" id="7704466">,</span>&nbsp;<span class="ident" id="7704468">wt</span>&nbsp;<span class="op" id="7704471">*</span><span class="ident" id="7704472">WriteTest</span><span class="op" id="7704481">)</span>&nbsp;<span class="op" id="7704483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704486">if</span>&nbsp;<span class="ident" id="7704489">f</span><span class="op" id="7704490">.</span><span class="ident" id="7704491">Name</span>&nbsp;<span class="op" id="7704496">!=</span>&nbsp;<span class="ident" id="7704499">wt</span><span class="op" id="7704501">.</span><span class="ident" id="7704502">Name</span>&nbsp;<span class="op" id="7704507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704511">t</span><span class="op" id="7704512">.</span><span class="ident" id="7704513">Fatalf</span><span class="op" id="7704519">(</span><span class="string" id="7704520">&#34;File&nbsp;name:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7704548">,</span>&nbsp;<span class="ident" id="7704550">f</span><span class="op" id="7704551">.</span><span class="ident" id="7704552">Name</span><span class="op" id="7704556">,</span>&nbsp;<span class="ident" id="7704558">wt</span><span class="op" id="7704560">.</span><span class="ident" id="7704561">Name</span><span class="op" id="7704565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704568">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704571">testFileMode</span><span class="op" id="7704583">(</span><span class="ident" id="7704584">t</span><span class="op" id="7704585">,</span>&nbsp;<span class="ident" id="7704587">wt</span><span class="op" id="7704589">.</span><span class="ident" id="7704590">Name</span><span class="op" id="7704594">,</span>&nbsp;<span class="ident" id="7704596">f</span><span class="op" id="7704597">,</span>&nbsp;<span class="ident" id="7704599">wt</span><span class="op" id="7704601">.</span><span class="ident" id="7704602">Mode</span><span class="op" id="7704606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704609">rc</span><span class="op" id="7704611">,</span>&nbsp;<span class="ident" id="7704613">err</span>&nbsp;<span class="op" id="7704617">:=</span>&nbsp;<span class="ident" id="7704620">f</span><span class="op" id="7704621">.</span><span class="ident" id="7704622">Open</span><span class="op" id="7704626">(</span><span class="op" id="7704627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704630">if</span>&nbsp;<span class="ident" id="7704633">err</span>&nbsp;<span class="op" id="7704637">!=</span>&nbsp;<span class="ident" id="7704640">nil</span>&nbsp;<span class="op" id="7704644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704648">t</span><span class="op" id="7704649">.</span><span class="ident" id="7704650">Fatal</span><span class="op" id="7704655">(</span><span class="string" id="7704656">&#34;opening:&#34;</span><span class="op" id="7704666">,</span>&nbsp;<span class="ident" id="7704668">err</span><span class="op" id="7704671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704674">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704677">b</span><span class="op" id="7704678">,</span>&nbsp;<span class="ident" id="7704680">err</span>&nbsp;<span class="op" id="7704684">:=</span>&nbsp;<span class="ident" id="7704687">ioutil</span><span class="op" id="7704693">.</span><span class="ident" id="7704694">ReadAll</span><span class="op" id="7704701">(</span><span class="ident" id="7704702">rc</span><span class="op" id="7704704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704707">if</span>&nbsp;<span class="ident" id="7704710">err</span>&nbsp;<span class="op" id="7704714">!=</span>&nbsp;<span class="ident" id="7704717">nil</span>&nbsp;<span class="op" id="7704721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704725">t</span><span class="op" id="7704726">.</span><span class="ident" id="7704727">Fatal</span><span class="op" id="7704732">(</span><span class="string" id="7704733">&#34;reading:&#34;</span><span class="op" id="7704743">,</span>&nbsp;<span class="ident" id="7704745">err</span><span class="op" id="7704748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704754">err</span>&nbsp;<span class="op" id="7704758">=</span>&nbsp;<span class="ident" id="7704760">rc</span><span class="op" id="7704762">.</span><span class="ident" id="7704763">Close</span><span class="op" id="7704768">(</span><span class="op" id="7704769">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704772">if</span>&nbsp;<span class="ident" id="7704775">err</span>&nbsp;<span class="op" id="7704779">!=</span>&nbsp;<span class="ident" id="7704782">nil</span>&nbsp;<span class="op" id="7704786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704790">t</span><span class="op" id="7704791">.</span><span class="ident" id="7704792">Fatal</span><span class="op" id="7704797">(</span><span class="string" id="7704798">&#34;closing:&#34;</span><span class="op" id="7704808">,</span>&nbsp;<span class="ident" id="7704810">err</span><span class="op" id="7704813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704819">if</span>&nbsp;<span class="op" id="7704822">!</span><span class="ident" id="7704823">bytes</span><span class="op" id="7704828">.</span><span class="ident" id="7704829">Equal</span><span class="op" id="7704834">(</span><span class="ident" id="7704835">b</span><span class="op" id="7704836">,</span>&nbsp;<span class="ident" id="7704838">wt</span><span class="op" id="7704840">.</span><span class="ident" id="7704841">Data</span><span class="op" id="7704845">)</span>&nbsp;<span class="op" id="7704847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704851">t</span><span class="op" id="7704852">.</span><span class="ident" id="7704853">Errorf</span><span class="op" id="7704859">(</span><span class="string" id="7704860">&#34;File&nbsp;contents&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7704887">,</span>&nbsp;<span class="ident" id="7704889">b</span><span class="op" id="7704890">,</span>&nbsp;<span class="ident" id="7704892">wt</span><span class="op" id="7704894">.</span><span class="ident" id="7704895">Data</span><span class="op" id="7704899">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704902">}</span><br>
<span class="lineno"></span><span class="op" id="7704904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7704907">func</span>&nbsp;<span class="ident" id="7704912">BenchmarkCompressedZipGarbage</span><span class="op" id="7704941">(</span><span class="ident" id="7704942">b</span>&nbsp;<span class="op" id="7704944">*</span><span class="ident" id="7704945">testing</span><span class="op" id="7704952">.</span><span class="ident" id="7704953">B</span><span class="op" id="7704954">)</span>&nbsp;<span class="op" id="7704956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704959">b</span><span class="op" id="7704960">.</span><span class="ident" id="7704961">ReportAllocs</span><span class="op" id="7704973">(</span><span class="op" id="7704974">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704977">var</span>&nbsp;<span class="ident" id="7704981">buf</span>&nbsp;<span class="ident" id="7704985">bytes</span><span class="op" id="7704990">.</span><span class="ident" id="7704991">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704999">bigBuf</span>&nbsp;<span class="op" id="7705006">:=</span>&nbsp;<span class="ident" id="7705009">bytes</span><span class="op" id="7705014">.</span><span class="ident" id="7705015">Repeat</span><span class="op" id="7705021">(</span><span class="op" id="7705022">[</span><span class="op" id="7705023">]</span><span class="builtintype" id="7705024">byte</span><span class="op" id="7705028">(</span><span class="string" id="7705029">&#34;a&#34;</span><span class="op" id="7705032">)</span><span class="op" id="7705033">,</span>&nbsp;<span class="num" id="7705035">1</span><span class="op" id="7705036">&lt;&lt;</span><span class="num" id="7705038">20</span><span class="op" id="7705040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7705043">for</span>&nbsp;<span class="ident" id="7705047">i</span>&nbsp;<span class="op" id="7705049">:=</span>&nbsp;<span class="num" id="7705052">0</span><span class="op" id="7705053">;</span>&nbsp;<span class="ident" id="7705055">i</span>&nbsp;<span class="op" id="7705057">&lt;</span>&nbsp;<span class="ident" id="7705059">b</span><span class="op" id="7705060">.</span><span class="ident" id="7705061">N</span><span class="op" id="7705062">;</span>&nbsp;<span class="ident" id="7705064">i</span><span class="op" id="7705065">++</span>&nbsp;<span class="op" id="7705068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705072">buf</span><span class="op" id="7705075">.</span><span class="ident" id="7705076">Reset</span><span class="op" id="7705081">(</span><span class="op" id="7705082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705086">zw</span>&nbsp;<span class="op" id="7705089">:=</span>&nbsp;<span class="ident" id="7705092">NewWriter</span><span class="op" id="7705101">(</span><span class="op" id="7705102">&amp;</span><span class="ident" id="7705103">buf</span><span class="op" id="7705106">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7705110">for</span>&nbsp;<span class="ident" id="7705114">j</span>&nbsp;<span class="op" id="7705116">:=</span>&nbsp;<span class="num" id="7705119">0</span><span class="op" id="7705120">;</span>&nbsp;<span class="ident" id="7705122">j</span>&nbsp;<span class="op" id="7705124">&lt;</span>&nbsp;<span class="num" id="7705126">3</span><span class="op" id="7705127">;</span>&nbsp;<span class="ident" id="7705129">j</span><span class="op" id="7705130">++</span>&nbsp;<span class="op" id="7705133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705138">w</span><span class="op" id="7705139">,</span>&nbsp;<span class="ident" id="7705141">_</span>&nbsp;<span class="op" id="7705143">:=</span>&nbsp;<span class="ident" id="7705146">zw</span><span class="op" id="7705148">.</span><span class="ident" id="7705149">CreateHeader</span><span class="op" id="7705161">(</span><span class="op" id="7705162">&amp;</span><span class="ident" id="7705163">FileHeader</span><span class="op" id="7705173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705179">Name</span><span class="op" id="7705183">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7705187">&#34;foo&#34;</span><span class="op" id="7705192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705198">Method</span><span class="op" id="7705204">:</span>&nbsp;<span class="ident" id="7705206">Deflate</span><span class="op" id="7705213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7705218">}</span><span class="op" id="7705219">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705224">w</span><span class="op" id="7705225">.</span><span class="ident" id="7705226">Write</span><span class="op" id="7705231">(</span><span class="ident" id="7705232">bigBuf</span><span class="op" id="7705238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7705242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705246">zw</span><span class="op" id="7705248">.</span><span class="ident" id="7705249">Close</span><span class="op" id="7705254">(</span><span class="op" id="7705255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7705258">}</span><br>
<span class="lineno"></span><span class="op" id="7705260">}</span>
</div>
</body>
</html>
